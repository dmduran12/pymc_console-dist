import{P as e,c as t,e as s,f as n}from"./payload-decoders-DO0uWDQC.js";import{al as r,ak as a,as as o,Y as l,cz as i,cA as c,cB as p}from"./index-a2wAGVcz.js";import{j as d,r as u}from"./vendor-react-Co0R0q1H.js";function x(s){if(!s||s.length<4)return null;const n=e.fromHex(s);if(!n.success||!n.packet)return null;const o=n.packet,l=function(e){const t=3&e,s=e>>2&15,n=e>>6&3;return[{bits:"0-1",field:"Route Type",value:r(t),binary:(3&t).toString(2).padStart(2,"0")},{bits:"2-5",field:"Payload Type",value:a(s),binary:(15&s).toString(2).padStart(4,"0")},{bits:"6-7",field:"Version",value:n.toString(),binary:(3&n).toString(2).padStart(2,"0")}]}(o.header),i=s.slice(0,2);let c=2,p="";o.hasTransportCodes()&&(p=s.slice(2,10),c=10);const d=s.slice(c,c+2),u=c+2,x=u+2*o.pathLen,g=s.slice(u,x),m=s.slice(x),f=t(o);return{packet:o,headerHex:i,headerFields:l,transportCodesHex:p,pathLengthHex:d,pathDataHex:g,payloadHex:m,pathLenByteOffset:Math.floor(c/2),pathByteOffset:Math.floor(u/2),payloadStartByte:Math.floor(x/2),decoded:f}}function g(e){if(!e||e.length<8)return null;const t=parseInt(e.slice(0,2),16),s=parseInt(e.slice(2,4),16),n=parseInt(e.slice(4,6),16),r=parseInt(e.slice(6,8),16);return isNaN(t)||isNaN(s)||isNaN(n)||isNaN(r)?null:((t|s<<8|n<<16|r<<24)>>>0).toString(16).toUpperCase().padStart(8,"0")}function m(e){return e>=10?"excellent":e>=5?"good":e>=0?"fair":e>=-5?"poor":"critical"}function f(e){if(!e.payload)return null;try{const t=o(e.payload),n=function(e){const t=e.original_path||e.forwarded_path||[];if("string"==typeof t)try{const e=JSON.parse(t);if(Array.isArray(e))return e.map(e=>parseInt(e,16))}catch{return[]}else if(Array.isArray(t))return t.map(e=>parseInt(e,16));return[]}(e),r=s(t,n);return r?{packet:e,decoded:r,timestamp:e.timestamp??0,hopCount:r.snrValues.length,rssi:e.rssi,snr:e.snr}:null}catch{return null}}function y(e){const t=new Map;for(const s of e){const e=f(s);if(!e)continue;const n=e.decoded.traceTag,r=t.get(n)||[];r.push(e),t.set(n,r)}for(const[s,n]of t)n.sort((e,t)=>e.timestamp-t.timestamp),t.set(s,n);return t}function h(e,t){if(0===t.length)return{traceTag:e,traceTagValue:0,targetPath:[],targetHopCount:0,observations:[],observationCount:0,firstSeen:0,lastSeen:0,duration:0,isComplete:!1,maxHopsObserved:0,progressPercent:0,bestObservation:null,hopStats:[],linkQuality:null};const s=[...t].sort((e,t)=>e.timestamp-t.timestamp),n=s.reduce((e,t)=>t.hopCount>e.hopCount?t:e,s[0]),r=s[0].timestamp,a=s[s.length-1].timestamp,o=n.decoded.pathHashes,l=o.length,i=n.hopCount,c=n.decoded.isComplete,p=[],d=n.decoded.snrValues;for(let x=0;x<d.length&&x<o.length;x++)p.push({prefix:o[x],snr:d[x],position:x,quality:m(d[x])});let u=null;if(d.length>0){const e=Math.min(...d),t=Math.max(...d);u={minSnr:e,maxSnr:t,avgSnr:d.reduce((e,t)=>e+t,0)/d.length,weakestLinkPosition:d.indexOf(e),strongestLinkPosition:d.indexOf(t)}}return{traceTag:e,traceTagValue:n.decoded.traceTagValue,targetPath:o,targetHopCount:l,observations:s,observationCount:s.length,firstSeen:r,lastSeen:a,duration:a-r,isComplete:c,maxHopsObserved:i,progressPercent:l>0?Math.round(i/l*100):0,bestObservation:n,hopStats:p,linkQuality:u,srcHash:n.packet.src_hash,dstHash:n.packet.dst_hash}}function b(e){if((e.payload_type??e.type)!==l.TRACE||!e.payload)return null;try{const t=o(e.payload);let n=[];if(null!=e._traceSnrPath&&e._traceSnrPath.length>0)n=e._traceSnrPath;else{const t=e.original_path||e.forwarded_path||[];if("string"==typeof t)try{const e=JSON.parse(t);Array.isArray(e)&&(n=e.map(e=>parseInt(e,16)))}catch{n=[]}else Array.isArray(t)&&(n=t.map(e=>parseInt(e,16)))}return s(t,n)}catch{return null}}function N(e){if(!e)return null;const t=e.trim().match(/(-?\d+\.?\d*)\s*[,\s]\s*(-?\d+\.?\d*)/);if(!t)return null;const s=parseFloat(t[1]),n=parseFloat(t[2]);return isNaN(s)||isNaN(n)||s<-90||s>90||n<-180||n>180||0===s&&0===n?null:{lat:s,lon:n}}function v(e,t){const s=e.payload_type??e.type;if(s===l.TRACE){const t=b(e);if(t)return{kind:"trace",data:t,snrValues:t.snrValues}}if(s===l.ADVERT){const t=function(e){if((e.payload_type??e.type)!==l.ADVERT||!e.payload)return null;try{const t=o(e.payload),s=n(t);if(!s)return null;const r=s.publicKey.slice(0,2).toUpperCase(),a={...s,prefix:r};let l=null;return s.latitude&&s.longitude&&(l={latitude:s.latitude,longitude:s.longitude,name:s.name||`Node ${r||"??"}`,prefix:r,publicKey:s.publicKey}),{data:a,sourceNode:l}}catch{return null}}(e);if(t)return{kind:"advert",data:t.data,sourceNode:t.sourceNode}}return s===l.GRP_TXT&&t?{kind:"grp_txt",decoded:t,wardriveCoords:N(t.text),wardriveSourceNode:function(e){var t,s;if(!e.decrypted)return null;if(!(null==(t=e.channelName)?void 0:t.toLowerCase().includes("wardrive")))return null;const n=N(e.text);return n?{latitude:n.lat,longitude:n.lon,name:e.senderName||"Wardrive Ping",prefix:(null==(s=e.senderName)?void 0:s.slice(0,2).toUpperCase())||"WD",nodeType:"wardrive"}:null}(t)}:{kind:"generic"}}const j={zinc:{stem:"bg-zinc-500/40",dot:"bg-zinc-400",row:"bg-zinc-500/8",text:"text-fg-muted/60",chip:"bg-zinc-500/20 text-fg-muted"},green:{stem:"bg-sys-green/50",dot:"bg-sys-green",row:"bg-sys-green/8",text:"text-sys-green",chip:"bg-sys-green/15 text-sys-green"},amber:{stem:"bg-sys-amber/50",dot:"bg-sys-amber",row:"bg-sys-amber/8",text:"text-sys-amber",chip:"bg-sys-amber/15 text-sys-amber"},red:{stem:"bg-sys-red/50",dot:"bg-sys-red",row:"bg-sys-red/8",text:"text-sys-red",chip:"bg-sys-red/15 text-sys-red"},blue:{stem:"bg-sys-blue/50",dot:"bg-sys-blue",row:"bg-sys-blue/8",text:"text-sys-blue",chip:"bg-sys-blue/15 text-sys-blue"},purple:{stem:"bg-sys-purple/50",dot:"bg-sys-purple",row:"bg-sys-purple/8",text:"text-sys-purple",chip:"bg-sys-purple/15 text-sys-purple"},teal:{stem:"bg-sys-teal/50",dot:"bg-sys-teal",row:"bg-sys-teal/8",text:"text-sys-teal",chip:"bg-sys-teal/15 text-sys-teal"},cyan:{stem:"bg-sys-cyan/50",dot:"bg-sys-cyan",row:"bg-sys-cyan/8",text:"text-sys-cyan",chip:"bg-sys-cyan/15 text-sys-cyan"},sky:{stem:"bg-sys-sky/50",dot:"bg-sys-sky",row:"bg-sys-sky/8",text:"text-sys-sky",chip:"bg-sys-sky/15 text-sys-sky"},pink:{stem:"bg-sys-pink/50",dot:"bg-sys-pink",row:"bg-sys-pink/8",text:"text-sys-pink",chip:"bg-sys-pink/15 text-sys-pink"},orange:{stem:"bg-sys-orange/50",dot:"bg-sys-orange",row:"bg-sys-orange/8",text:"text-sys-orange",chip:"bg-sys-orange/15 text-sys-orange"}};Object.fromEntries(Object.entries(j).map(([e,t])=>[e,t.text]));const k=u.createContext("");function S({prefix:e,children:t}){return d.jsx(k.Provider,{value:e,children:t})}function w(){return u.useContext(k)}function C({children:e,color:t="zinc"}){var s;return d.jsx("span",{className:`inline-flex items-center px-1.5 py-px rounded-full text-[9px] font-mono font-medium leading-tight ${(null==(s=j[t])?void 0:s.chip)??j.zinc.chip}`,children:e})}function $({fn:e,value:t,color:s="zinc"}){var n;const r=w(),a=r?`${r}(${e})`:e;return d.jsxs("span",{title:a,className:"inline-flex items-baseline gap-0 font-mono",children:[d.jsx("span",{className:"text-fg-muted/40",children:e}),d.jsx("span",{className:"text-fg-muted/20",children:"("}),t?d.jsx("span",{className:(null==(n=j[s])?void 0:n.text)??j.zinc.text,children:t}):d.jsx("span",{className:"text-fg-muted/20",children:"·"}),d.jsx("span",{className:"text-fg-muted/20",children:")"})]})}function T({label:e,children:t,mono:s=!0,padY:n=!1}){const r=w(),a=e.trim(),o=r?`${r}(${a})`:a;return d.jsxs("div",{className:"flex items-center gap-2 "+(n?"py-1":"py-0.5"),children:[d.jsx("dt",{className:"text-fg-muted shrink-0 w-28 text-right",children:e}),d.jsx("dd",{title:o,className:s?"text-fg-primary break-all":"text-fg-primary",children:t})]})}function z({value:e,className:t}){const s="number"==typeof e?`0x${e.toString(16).toUpperCase().padStart(2,"0")}`:e.startsWith("0x")?e:`0x${e}`;return d.jsx("span",{className:t??"text-sys-blue",children:s})}function P({value:e}){const t="number"==typeof e?e.toString(16).toUpperCase().padStart(2,"0"):e.replace(/^0x/i,"").toUpperCase();return d.jsxs("span",{className:"px-1 py-px rounded bg-zinc-500/15 text-fg-secondary font-mono text-[11px]",children:["0x",t]})}function A({value:e}){return d.jsx("span",{className:"px-1 py-px rounded bg-zinc-500/10 text-fg-muted font-mono text-[10px]",children:e.toString(2).padStart(8,"0")})}function H({raw:e,children:t}){return d.jsxs("span",{className:"inline-flex items-center gap-1.5 flex-wrap",children:[d.jsx("span",{className:"font-mono text-fg-muted",children:e}),d.jsx("span",{className:"text-fg-muted/40 text-[10px]",children:"→"}),t]})}const _={blue:"text-sys-blue",amber:"text-sys-amber",green:"text-sys-green",teal:"text-sys-teal",purple:"text-sys-purple"};function O({hops:e,hexPrefix:t,color:s="amber"}){if(0===e.length)return d.jsx("span",{className:"text-fg-muted italic",children:"∅ zero-hop"});const n=_[s]??_.amber;return d.jsxs("span",{className:"inline-flex items-center gap-1 flex-wrap",children:[t&&d.jsxs(d.Fragment,{children:[d.jsx("span",{className:"font-mono text-fg-muted text-[10px]",children:t}),d.jsx("span",{className:"text-fg-muted/40 text-[10px] mx-0.5",children:"→"})]}),e.map((e,t)=>d.jsxs("span",{className:"inline-flex items-center",children:[t>0&&d.jsx("span",{className:"text-fg-muted/40 text-[10px]",children:"→"}),d.jsx("span",{className:`inline-block border border-edge-subtle rounded px-1.5 py-0.5 font-mono text-[11px] ${n}`,children:e.toUpperCase()})]},t))]})}function M({title:e}){return d.jsx("div",{className:"mt-2 pt-2 border-t border-edge-subtle",children:e&&d.jsx("p",{className:"text-sys-amber font-semibold mb-0.5",children:e})})}function V(e){if(!e||e<=0)return"never";const t=Math.floor(Date.now()/1e3)-e;return t<60?`${t}s ago`:t<3600?`${Math.floor(t/60)}m ago`:t<86400?`${Math.floor(t/3600)}h ago`:`${Math.floor(t/86400)}d ago`}function I(e){return e>0?"green":"zinc"}function R({children:e,c:t}){return d.jsx("span",{className:t??"text-fg-muted",children:e})}function U({tokens:e,label:t="emits"}){const s=e.filter(e=>null!=e.value&&""!==e.value);if(0===s.length)return null;const n=[];let r;for(let a=0;a<s.length;a++){const e=s[a].group;e&&e!==r?(n.push({type:"label",group:e}),r=e):!e&&r&&(r=void 0),n.push({type:"token",token:s[a],idx:a})}return d.jsx("div",{className:"mt-3 pt-2 border-t border-dashed border-edge-subtle/40",children:d.jsxs(i,{children:[d.jsxs(c,{className:"text-[8px] uppercase tracking-widest font-mono w-full text-left",children:[d.jsxs("span",{className:"text-fg-muted/30",children:[t," →"]}),d.jsxs("span",{className:"ml-1.5 text-fg-muted/50",children:[s.length," tokens"]})]}),d.jsx(p,{children:d.jsx("div",{className:"flex flex-wrap items-center gap-x-1.5 gap-y-1 mt-1",children:n.map((e,t)=>{var s;if("label"===e.type)return d.jsx("span",{className:"text-[8px] text-fg-muted/40 uppercase tracking-wider font-mono",children:e.group},`g-${t}`);const n=e.token,r=n.raw?`${n.fn}(${n.raw} → ${n.value})`:`${n.fn}(${n.value})`;return d.jsx("span",{title:r,className:`inline-block border border-edge-subtle rounded px-1.5 py-0.5 font-mono cursor-default ${(null==(s=j[n.color??"zinc"])?void 0:s.text)??j.zinc.text}`,children:n.value},e.idx)})})})]})})}export{j as A,A as B,C,P as H,T as K,O as P,H as R,S,$ as T,b as a,h as b,U as c,v as d,g as e,M as f,y as g,z as h,R as i,V as j,x as p,I as s};
