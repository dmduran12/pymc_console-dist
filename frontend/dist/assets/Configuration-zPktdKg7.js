import{r as e,j as t,f as s,i as a,X as r,a5 as n,ab as l,a_ as c,a$ as i,k as o,p as d,b0 as u,ag as m,b1 as x,b2 as p,b3 as h,aP as b,av as y,b4 as g,ak as f,b5 as j,a8 as v,a2 as N,$ as w,aa as k,b6 as C}from"./vendor-react-0D__tamq.js";import{c as _}from"./recharts-BovJNxPc.js";import{al as S,_ as T,am as F,an as E,O as P,ao as L,ap as R,ak as A}from"./index-By5qf1JJ.js";import{D}from"./DataBox-CNeTiMGH.js";import{C as M}from"./ConfirmModal-novvBPRs.js";import{P as I,b as O,a as z,c as K}from"./PageLayout-lVaYU4M5.js";import{R as q,C as $}from"./Grid-DgTkKuOC.js";import"./vendor-core-WoOfkQwm.js";import"./deckgl-DTsmDcfs.js";async function H(e){return S("/api/update_web_config",{method:"POST",body:JSON.stringify(e)})}const Y=e.memo(function(){const{theme:e}=T(),{colorScheme:s}=e,a=F.find(e=>e.colorScheme===s)??F[0],r=a.displaySize,n=`clamp(${.8*r}rem, ${.6*r}rem + 1.5vw, ${1.4*r}rem)`;return t.jsx("div",{className:"w-32 sm:w-40 flex items-center justify-center flex-shrink-0",children:t.jsx("span",{className:"font-medium transition-all duration-300 leading-none text-center truncate",style:{fontFamily:a.displayFont,color:a.displayColor,fontSize:n,fontOpticalSizing:"auto",letterSpacing:"-0.03em"},children:a.displayName})})}),V=e.memo(function(){const{theme:s,setThemePreset:a,setBrightness:r}=T(),{colorScheme:n,brightness:l}=s,[c,i]=e.useState(!1),[o,d]=e.useState(!1),u=e.useRef(null),m=e.useRef(null),x=(F.find(e=>e.colorScheme===n)??F[0]).id,p=e.useCallback((e,t)=>{if(!m.current)return l;const s=(m.current.y-e)/(t?200:80)*100;return Math.round(Math.max(0,Math.min(100,m.current.brightness+s)))},[l]),h=e.useCallback(e=>{a(e),i(!0)},[a]),b=e.useCallback(e=>{r(e)},[r]),y=e.useCallback(e=>{const t=F.find(t=>t.id===e);t&&E(t.backgroundImage)},[]);return t.jsx("div",{className:"grid grid-cols-4 gap-2 flex-shrink-0",children:F.map(e=>{const s=x===e.id,a=s&&(c||o);return t.jsxs("div",{ref:s?u:void 0,title:e.displayName,className:_("flex flex-col items-center gap-1 p-0.5 rounded-sm transition-all duration-300 ease-out",s?"ring-2 ring-accent-primary scale-105 cursor-ns-resize":"cursor-pointer"),onMouseEnter:()=>{s?i(!0):y(e.id)},onMouseLeave:()=>!o&&i(!1),onClick:()=>!s&&h(e.id),onTouchStart:e=>{if(!s)return;e.preventDefault();const t=e.touches[0];m.current={y:t.clientY,brightness:l},d(!0),i(!0);const a=e=>{e.preventDefault();const t=e.touches[0];b(p(t.clientY,!0))},r=()=>{document.removeEventListener("touchmove",a),document.removeEventListener("touchend",r),m.current=null,d(!1),setTimeout(()=>i(!1),1500)};document.addEventListener("touchmove",a,{passive:!1}),document.addEventListener("touchend",r)},onMouseDown:e=>{if(!s)return;e.preventDefault(),m.current={y:e.clientY,brightness:l},d(!0),i(!0);const t=e=>{b(p(e.clientY,!1))},a=()=>{document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",a),m.current=null,d(!1)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",a)},children:[t.jsxs("div",{className:"glass-thumbnail w-10 h-10",children:["kde breeze"===e.id?t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-[#242627]",style:{opacity:a?.4:1},children:t.jsx("span",{className:"text-[#58b99d] text-xl font-bold font-mono",children:">"})}):t.jsx("div",{className:"absolute bg-cover bg-center transition-opacity duration-200",style:{inset:0,backgroundImage:`url(${e.backgroundImage})`,opacity:a?.4:1,filter:"brightness(1.3)"}}),s&&t.jsxs("div",{className:_("absolute inset-0 transition-opacity duration-200",a?"opacity-100":"opacity-0"),children:[t.jsx("div",{className:"absolute inset-x-0 bottom-0 bg-black/70 transition-all duration-100 ease-out",style:{height:100-l+"%"}}),t.jsx("div",{className:"absolute inset-x-1 h-0.5 bg-white rounded-full shadow-lg transition-all duration-100 ease-out",style:{top:100-l+"%"}}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsxs("span",{className:"text-[10px] font-mono font-bold text-white drop-shadow-lg",children:[l,"%"]})})]})]}),t.jsx("div",{className:"flex flex-col gap-0.5",children:e.paletteColors.map((e,s)=>t.jsx("div",{className:"flex gap-0.5 justify-center",children:e.map((e,s)=>t.jsx("div",{className:"w-1.5 h-1.5 rounded-xs",style:{backgroundColor:e}},s))},s))})]},e.id)})})}),U=e.memo(function({layout:e="horizontal"}){return"logo-only"===e?t.jsx(Y,{}):"thumbnails-only"===e?t.jsx(V,{}):"vertical"===e?t.jsxs("div",{className:"flex flex-col items-center gap-4",children:[t.jsx(Y,{}),t.jsx(V,{})]}):t.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4",children:[t.jsx("div",{className:"flex items-center justify-center",children:t.jsx(Y,{})}),t.jsx("div",{className:"flex-shrink-0",children:t.jsx(V,{})})]})}),B=[{value:7.8,label:"7.8 kHz"},{value:10.4,label:"10.4 kHz"},{value:15.6,label:"15.6 kHz"},{value:20.8,label:"20.8 kHz"},{value:31.25,label:"31.25 kHz"},{value:41.7,label:"41.7 kHz"},{value:62.5,label:"62.5 kHz"},{value:125,label:"125 kHz"},{value:250,label:"250 kHz"},{value:500,label:"500 kHz"}],X=[5,6,7,8,9,10,11,12],J=[{value:5,label:"4/5"},{value:6,label:"4/6"},{value:7,label:"4/7"},{value:8,label:"4/8"}],G="radioConfig",W="repeaterSettings",Q="operatingMode";function Z({node:e,level:s,expandedKeys:a,selectedKeyId:r,globalFloodPolicy:n,onSelect:l,onToggle:c}){const i=a.has(e.id),o=r===e.id,d=e.children&&e.children.length>0,u="allow"===n;return t.jsxs("div",{children:[t.jsxs("div",{className:_("flex items-center gap-2 h-[36px] px-3 rounded-full cursor-pointer transition-colors",o?"bg-accent-primary/15":"hover:bg-white/[0.02]",u&&"opacity-50 cursor-not-allowed"),style:{marginLeft:16*s+"px"},onClick:()=>!u&&l(e.id),children:[d?t.jsx("button",{onClick:t=>{t.stopPropagation(),c(e.id)},className:"p-1 hover:bg-white/[0.05] rounded-full transition-colors",children:t.jsx(k,{className:_("w-3.5 h-3.5 text-text-muted transition-transform",i&&"rotate-90")})}):t.jsx("span",{className:"w-5"}),t.jsx(C,{className:"w-4 h-4 text-accent-primary flex-shrink-0"}),t.jsx("span",{className:"type-data text-text-primary flex-1 truncate",children:e.name}),t.jsx("span",{className:_("type-data-xs px-2 py-0.5 rounded-full","allow"===e.floodPolicy?"bg-accent-success/15 text-accent-success":"bg-accent-danger/15 text-accent-danger"),children:"allow"===e.floodPolicy?"Allow":"Deny"})]}),d&&i&&t.jsx("div",{children:e.children.map(e=>t.jsx(Z,{node:e,level:s+1,expandedKeys:a,selectedKeyId:r,globalFloodPolicy:n,onSelect:l,onToggle:c},e.id))})]})}function ee(){var k,C,T,F,E,Y;const{stats:V,setMode:ee,clearModeMutation:te,setDutyCycleConfig:se,clearDutyCycleMutation:ae,fetchStats:re,startMutation:ne,clearMutation:le}=P(),ce=null==(k=null==V?void 0:V.config)?void 0:k.radio,ie=null==(C=null==V?void 0:V.config)?void 0:C.repeater,oe=null==(T=null==V?void 0:V.config)?void 0:T.duty_cycle,de=(null==V?void 0:V.node_name)||(null==(F=null==V?void 0:V.config)?void 0:F.node_name)||"Unknown Node",ue=(null==ie?void 0:ie.mode)??"forward",me=(null==oe?void 0:oe.enforcement_enabled)??!1,xe=null==(E=null==V?void 0:V.config)?void 0:E.delays,[pe,he]=e.useState(!1),[be,ye]=e.useState(""),[ge,fe]=e.useState(62.5),[je,ve]=e.useState(7),[Ne,we]=e.useState(5),[ke,Ce]=e.useState(""),[_e,Se]=e.useState("idle"),[Te,Fe]=e.useState(null),Ee=e.useRef(null),Pe=e.useRef(null),[Le,Re]=e.useState(!1),[Ae,De]=e.useState(""),[Me,Ie]=e.useState(""),[Oe,ze]=e.useState(""),[Ke,qe]=e.useState("idle"),$e=e.useRef(null),He=e.useRef(null),[Ye,Ve]=e.useState(!1),[Ue,Be]=e.useState(""),[Xe,Je]=e.useState(""),[Ge,We]=e.useState(""),[Qe,Ze]=e.useState(""),[et,tt]=e.useState("idle"),[st,at]=e.useState(null),rt=e.useRef(null),nt=e.useRef(null),[lt,ct]=e.useState("idle"),[it,ot]=e.useState("idle"),[dt,ut]=e.useState(null),[mt,xt]=e.useState(null),pt=e.useRef(!0),ht=e.useRef(null),bt=e.useRef(null),yt=e.useRef(null),gt=e.useRef(null),ft=e.useRef(!1),jt=e.useRef(!1);e.useEffect(()=>(pt.current=!0,()=>{pt.current=!1,ht.current&&clearTimeout(ht.current),bt.current&&clearTimeout(bt.current),yt.current&&clearTimeout(yt.current),gt.current&&clearTimeout(gt.current),_t.current&&clearTimeout(_t.current),St.current&&clearTimeout(St.current),Pe.current&&clearTimeout(Pe.current),$e.current&&clearTimeout($e.current),nt.current&&clearTimeout(nt.current)}),[]),e.useEffect(()=>{const e=e=>{if(pe||Ye||Le)return e.preventDefault(),e.returnValue="You have unsaved changes. Are you sure you want to leave?",e.returnValue};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[pe,Ye,Le]);const vt=null==(Y=null==V?void 0:V.config)?void 0:Y.web,[Nt,wt]=e.useState("idle"),[kt,Ct]=e.useState(null),_t=e.useRef(null),St=e.useRef(null),Tt=e.useRef(!1),[Ft,Et]=e.useState([]),[Pt,Lt]=e.useState(!1),[Rt,At]=e.useState(null),[Dt,Mt]=e.useState(!1),[It,Ot]=e.useState(""),[zt,Kt]=e.useState(null),[qt,$t]=e.useState(!1),[Ht,Yt]=e.useState(null),[Vt,Ut]=e.useState(!1),[Bt,Xt]=e.useState(!1),[Jt,Gt]=e.useState(!1),[Wt,Qt]=e.useState([]),[Zt,es]=e.useState(!1),[ts,ss]=e.useState(null),[as,rs]=e.useState("deny"),[ns,ls]=e.useState(!1),[cs,is]=e.useState(null),[os,ds]=e.useState(new Set),[us,ms]=e.useState(!1),[xs,ps]=e.useState(!1),[hs,bs]=e.useState(!1),[ys,gs]=e.useState(null),[fs,js]=e.useState(null),[vs,Ns]=e.useState(""),[ws,ks]=e.useState("deny"),[Cs,_s]=e.useState(!1),[Ss,Ts]=e.useState(!0),[Fs,Es]=e.useState(!1),[Ps,Ls]=e.useState(!0),[Rs,As]=e.useState("idle"),[Ds,Ms]=e.useState(!1),[Is,Os]=e.useState(!1),zs=e.useRef(!1);e.useEffect(()=>{const e=pe&&!zs.current;zs.current=pe,ce&&e&&(ye((ce.frequency/1e6).toFixed(3)),fe(ce.bandwidth/1e3),ve(ce.spreading_factor),we(ce.coding_rate),Ce(String(ce.tx_power)))},[ce,pe]);const Ks=e.useMemo(()=>{if(!ce||!pe)return!1;const e=ce.frequency/1e6,t=ce.bandwidth/1e3,s=parseFloat(be)||0;return Math.abs(s-e)>1e-4||ge!==t||je!==ce.spreading_factor||Ne!==ce.coding_rate||parseInt(ke)!==ce.tx_power},[ce,pe,be,ge,je,Ne,ke]),qs=e.useCallback(()=>{he(!1),Fe(null),ce&&(ye((ce.frequency/1e6).toFixed(3)),fe(ce.bandwidth/1e3),ve(ce.spreading_factor),we(ce.coding_rate),Ce(String(ce.tx_power)))},[ce]);e.useEffect(()=>{if(!pe)return;const e=e=>{"loading"!==_e&&Ee.current&&!Ee.current.contains(e.target)&&qs()};return document.addEventListener("mouseup",e),()=>{document.removeEventListener("mouseup",e)}},[pe,qs,_e]);const $s=e.useCallback(()=>{const e=null==xe?void 0:xe.tx_delay_factor;return e&&"object"==typeof e&&"parsedValue"in e?e.parsedValue??1:"number"==typeof e?e:1},[xe]),Hs=e.useCallback(()=>{const e=null==xe?void 0:xe.direct_tx_delay_factor;return"number"==typeof e?e:.5},[xe]),Ys=e.useCallback(()=>{const e=null==oe?void 0:oe.max_airtime_percent;return"number"==typeof e?e:e&&"object"==typeof e&&"parsedValue"in e?e.parsedValue??6:6},[oe]),Vs=e.useCallback(()=>{De($s().toFixed(2)),Ie(Hs().toFixed(2)),ze(Ys().toFixed(1)),Re(!0)},[$s,Hs,Ys]),Us=e.useCallback(()=>{Re(!1)},[]);e.useEffect(()=>{if(!Le)return;const e=e=>{"loading"!==Ke&&He.current&&!He.current.contains(e.target)&&Us()};return document.addEventListener("mouseup",e),()=>document.removeEventListener("mouseup",e)},[Le,Us,Ke]);const Bs=e.useCallback(()=>{var e,t,s;Be(de),Je((null==(e=null==ie?void 0:ie.latitude)?void 0:e.toString())||"0"),We((null==(t=null==ie?void 0:ie.longitude)?void 0:t.toString())||"0"),Ze((null==(s=null==ie?void 0:ie.send_advert_interval_hours)?void 0:s.toString())||"0"),at(null),Ve(!0)},[de,ie]),Xs=e.useCallback(()=>{Ve(!1),at(null)},[]);e.useEffect(()=>{if(!Ye)return;const e=e=>{"loading"!==et&&rt.current&&!rt.current.contains(e.target)&&Xs()};return document.addEventListener("mouseup",e),()=>document.removeEventListener("mouseup",e)},[Ye,Xs,et]);const Js=async()=>{var e;if("loading"===Nt)return;const t=(null==vt?void 0:vt.cors_enabled)??!1,s=!t,a=t;_t.current&&clearTimeout(_t.current),St.current&&clearTimeout(St.current),Tt.current=!1,Ct(s),wt("loading"),_t.current=setTimeout(()=>{Tt.current||pt.current&&(Ct(a),wt("error"),St.current=setTimeout(()=>{pt.current&&(wt("idle"),Ct(null))},2e3))},1e4);try{const t=await H({web:{cors_enabled:s}});if(Tt.current=!0,_t.current&&clearTimeout(_t.current),!pt.current)return;t.success||(null==(e=t.data)?void 0:e.persisted)?(await re(),wt("success"),St.current=setTimeout(()=>{pt.current&&(wt("idle"),Ct(null))},2e3)):(Ct(a),wt("error"),St.current=setTimeout(()=>{pt.current&&(wt("idle"),Ct(null))},2e3))}catch{if(Tt.current=!0,_t.current&&clearTimeout(_t.current),!pt.current)return;Ct(a),wt("error"),St.current=setTimeout(()=>{pt.current&&(wt("idle"),Ct(null))},2e3)}};e.useEffect(()=>{(async()=>{Ls(!0);try{const e=await async function(){return S("/api/check_pymc_console")}();e.success&&e.data?Es(e.data.exists):Es(!1);const t=null==vt?void 0:vt.web_path;Ts(!t||""===t)}catch{Es(!1)}finally{Ls(!1)}})()},[null==vt?void 0:vt.web_path]);const Gs=async e=>{var t;if("loading"!==Rs){As("loading");try{const s=await H({web:{web_path:e?null:"/opt/pymc_console/web/html"}});if(!pt.current)return;s.success||(null==(t=s.data)?void 0:t.persisted)?(Ts(e),As("success"),Ms(!0),setTimeout(()=>{pt.current&&As("idle")},2e3)):(As("error"),setTimeout(()=>{pt.current&&As("idle")},2e3))}catch{if(!pt.current)return;As("error"),setTimeout(()=>{pt.current&&As("idle")},2e3)}}},Ws=e.useCallback(async()=>{Lt(!0),At(null);try{const e=await async function(){return S("/auth/tokens")}();Et(e.tokens||[])}catch(e){At(e instanceof Error?e.message:"Failed to fetch tokens")}finally{Lt(!1)}},[]);e.useEffect(()=>{Ws()},[Ws]);const Qs=async()=>{if(It.trim()){Ut(!0),At(null);try{const e=await async function(e){return S("/auth/tokens",{method:"POST",body:JSON.stringify({name:e})})}(It.trim());Kt(e.token||null),Mt(!1),$t(!0),Ot(""),await Ws()}catch(e){At(e instanceof Error?e.message:"Failed to create token")}finally{Ut(!1)}}else At("Token name is required")},Zs=e=>e?new Date(1e3*e).toLocaleString():"Never",ea=e.useCallback(e=>{const t=new Map,s=[];return e.forEach(e=>{const s={id:e.id,name:e.name,floodPolicy:e.flood_policy,transport_key:e.transport_key,last_used:e.last_used,parent_id:e.parent_id,children:[]};t.set(e.id,s)}),t.forEach(e=>{e.parent_id&&t.has(e.parent_id)?t.get(e.parent_id).children.push(e):s.push(e)}),s},[]),ta=e.useCallback(async()=>{es(!0),ss(null);try{const e=await async function(){return S("/api/transport_keys")}();e.success&&e.data?Qt(ea(e.data)):ss(e.error||"Failed to load transport keys")}catch(e){ss(e instanceof Error?e.message:"Unknown error occurred")}finally{es(!1)}},[ea]);e.useEffect(()=>{ta()},[ta]);const sa=e.useCallback((e,t)=>{for(const s of e){if(s.id===t)return s;if(s.children){const e=sa(s.children,t);if(e)return e}}return null},[]),aa=e.useCallback(()=>{if(!cs)return;const e=sa(Wt,cs);return null==e?void 0:e.name},[cs,Wt,sa]),ra=e.useCallback(e=>{ds(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[]),na=async e=>{ls(!0),ss(null);try{const t=await async function(e){return S("/api/global_flood_policy",{method:"POST",body:JSON.stringify({global_flood_allow:e})})}("allow"===e);t.success?rs(e):ss(t.error||"Failed to update global flood policy")}catch(t){ss(t instanceof Error?t.message:"Failed to update global flood policy")}finally{ls(!1)}},la=async()=>{if(vs.trim()){_s(!0),ss(null);try{const e=await async function(e){return S("/api/transport_keys",{method:"POST",body:JSON.stringify(e)})}({name:vs.trim(),flood_policy:ws,parent_id:cs??void 0});e.success?(await ta(),ms(!1),Ns(""),ks("deny")):ss(e.error||"Failed to add transport key")}catch(e){ss(e instanceof Error?e.message:"Failed to add transport key")}finally{_s(!1)}}else ss("Key name is required")},ca=e.useCallback(()=>{if(!cs)return;const e=sa(Wt,cs);e&&(gs({...e}),ps(!0))},[cs,Wt,sa]);e.useEffect(()=>{const e=e=>{"Escape"===e.key&&(us&&(ms(!1),Ns(""),ks("deny")),xs&&(ps(!1),gs(null)),hs&&(bs(!1),js(null)),Dt&&(Mt(!1),Ot("")),qt&&($t(!1),Kt(null)))};if(us||xs||hs||Dt||qt)return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[us,xs,hs,Dt,qt]);const ia=e.useCallback(()=>{if(!cs)return;const e=sa(Wt,cs);e&&(js(e),bs(!0))},[cs,Wt,sa]);return t.jsxs(I,{children:[t.jsx(O,{title:"Configuration",icon:t.jsx(s,{})}),t.jsxs(q,{template:"standard",children:[t.jsx($,{span:12,md:6,children:t.jsx(z,{children:t.jsxs("div",{ref:rt,children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"type-subheading text-text-primary flex items-center gap-2",children:[t.jsx(a,{className:"icon-md text-accent-primary"}),"Repeater Settings"]}),t.jsx("div",{className:"flex items-center gap-1",children:ie&&(Ye?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:Xs,disabled:"loading"===et,className:_("p-2 rounded-lg transition-colors","loading"===et?"text-text-muted cursor-not-allowed":"text-text-muted hover:text-accent-danger hover:bg-accent-danger/10"),title:"Cancel",children:t.jsx(r,{className:"w-4 h-4"})}),t.jsx("button",{onClick:async()=>{if("loading"!==et){nt.current&&clearTimeout(nt.current),ne(W),tt("loading"),at(null);try{const e={};Ue&&Ue!==de&&(e.node_name=Ue);const t=parseFloat(Xe);isNaN(t)||t===(null==ie?void 0:ie.latitude)||(e.latitude=t);const s=parseFloat(Ge);isNaN(s)||s===(null==ie?void 0:ie.longitude)||(e.longitude=s);const a=parseInt(Qe);if(isNaN(a)||a===(null==ie?void 0:ie.send_advert_interval_hours)||(e.flood_advert_interval_hours=a),0===Object.keys(e).length)return at({success:!0,message:"No changes to save"}),tt("idle"),void le(W);const r=await A(e);if(!pt.current)return void le(W);if(r.success&&r.data){const e=r.data.applied.join(", ");at({success:!0,message:`Updated: ${e}`}),await re({force:!0}),tt("success"),nt.current=setTimeout(()=>{pt.current&&(tt("idle"),Ve(!1),at(null),le(W))},1500)}else at({success:!1,message:r.error||"Failed to save"}),tt("error"),le(W),nt.current=setTimeout(()=>{pt.current&&tt("idle")},2e3)}catch(e){if(!pt.current)return void le(W);at({success:!1,message:String(e)}),tt("error"),le(W),nt.current=setTimeout(()=>{pt.current&&tt("idle")},2e3)}}},disabled:"loading"===et,className:_("p-2 rounded-lg transition-colors","loading"===et?"text-accent-primary cursor-wait":"success"===et?"text-accent-success":"error"===et?"text-accent-danger":"text-accent-success hover:bg-accent-success/10"),title:"Save changes",children:"loading"===et?t.jsx(n,{className:"w-4 h-4 animate-spin"}):"success"===et?t.jsx(l,{className:"w-4 h-4"}):"error"===et?t.jsx(r,{className:"w-4 h-4"}):t.jsx(l,{className:"w-4 h-4"})})]}):t.jsx("button",{onClick:Bs,className:"p-2 rounded-lg transition-colors text-text-muted hover:text-text-primary hover:bg-bg-subtle",title:"Edit repeater settings",children:t.jsx(c,{className:"w-4 h-4"})}))})]}),st&&t.jsx("div",{className:_("text-xs mb-3 px-2 py-1.5 rounded-md",st.success?"text-accent-success bg-accent-success/10":"text-accent-danger bg-accent-danger/10"),children:st.message}),ie?t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"col-span-2",children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Node Name"}),t.jsx("div",{className:_("h-[38px] rounded-full px-4 flex items-center transition-colors",Ye?"bg-white/5":"bg-white/[0.02]"),children:Ye?t.jsx("input",{type:"text",value:Ue,onChange:e=>Be(e.target.value),maxLength:50,className:"w-full bg-transparent text-text-primary focus:outline-none type-data",placeholder:"Enter node name"}):t.jsx("span",{className:"type-data text-text-primary",children:de})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:Ye?"Latitude (°)":"Latitude"}),t.jsx("div",{className:_("h-[38px] rounded-full px-4 flex items-center transition-colors",Ye?"bg-white/5":"bg-white/[0.02]"),children:Ye?t.jsx("input",{type:"number",value:Xe,onChange:e=>Je(e.target.value),step:"0.000001",min:"-90",max:"90",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):t.jsx("span",{className:"type-data text-text-primary",children:0!==ie.latitude?ie.latitude.toFixed(6):"Not set"})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:Ye?"Longitude (°)":"Longitude"}),t.jsx("div",{className:_("h-[38px] rounded-full px-4 flex items-center transition-colors",Ye?"bg-white/5":"bg-white/[0.02]"),children:Ye?t.jsx("input",{type:"number",value:Ge,onChange:e=>We(e.target.value),step:"0.000001",min:"-180",max:"180",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):t.jsx("span",{className:"type-data text-text-primary",children:0!==ie.longitude?ie.longitude.toFixed(6):"Not set"})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:Ye?"Advert Interval (hours)":"Advert Interval"}),t.jsx("div",{className:_("h-[38px] rounded-full px-4 flex items-center transition-colors",Ye?"bg-white/5":"bg-white/[0.02]"),children:Ye?t.jsx("input",{type:"number",value:Qe,onChange:e=>Ze(e.target.value),min:"0",max:"48",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):t.jsx("span",{className:"type-data text-text-primary",children:ie.send_advert_interval_hours>0?`${ie.send_advert_interval_hours}h`:"Disabled"})}),Ye&&t.jsx("p",{className:"type-data-xs text-text-muted mt-1 ml-4",children:"0 = disabled, 3-48 hours"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Score-based TX"}),t.jsx("div",{className:"h-[38px] rounded-full px-4 flex items-center bg-white/[0.02]",children:t.jsx("span",{className:"type-data text-text-primary",children:ie.use_score_for_tx?"Enabled":"Disabled"})})]})]}):t.jsx("p",{className:"text-text-muted",children:"Loading repeater settings..."})]})})}),t.jsx($,{span:12,md:6,children:t.jsx(z,{children:t.jsxs("div",{ref:Ee,children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"type-subheading text-text-primary flex items-center gap-2",children:[t.jsx(i,{className:"icon-md text-accent-primary"}),"Radio Configuration"]}),t.jsx("div",{className:"flex items-center gap-1",children:ce&&(pe?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:qs,disabled:"loading"===_e,className:_("p-2 rounded-lg transition-colors","loading"===_e?"text-text-muted cursor-not-allowed":"text-text-muted hover:text-accent-danger hover:bg-accent-danger/10"),title:"Cancel",children:t.jsx(r,{className:"w-4 h-4"})}),t.jsx("button",{onClick:async()=>{if("loading"!==_e){Pe.current&&clearTimeout(Pe.current),ne(G),Se("loading"),Fe(null);try{const e={},t=parseFloat(be),s=ce?ce.frequency/1e6:0;Math.abs(t-s)>1e-4&&(e.frequency_mhz=t);const a=ce?ce.bandwidth/1e3:0;ge!==a&&(e.bandwidth_khz=ge),je!==(null==ce?void 0:ce.spreading_factor)&&(e.spreading_factor=je),Ne!==(null==ce?void 0:ce.coding_rate)&&(e.coding_rate=Ne);const r=parseInt(ke);if(r!==(null==ce?void 0:ce.tx_power)&&(e.tx_power=r),0===Object.keys(e).length)return Fe({success:!0,message:"No changes to save"}),Se("idle"),void le(G);const n=await A(e);if(!pt.current)return void le(G);if(n.success&&n.data){const e=n.data.applied.join(", "),t=n.data.live_update?" (applied live)":" (restart required)";Fe({success:!0,message:`Updated: ${e}${t}`}),await re({force:!0}),Se("success"),Pe.current=setTimeout(()=>{pt.current&&(Se("idle"),he(!1),Fe(null),le(G))},1500)}else Fe({success:!1,message:n.error||"Failed to save"}),Se("error"),le(G),Pe.current=setTimeout(()=>{pt.current&&Se("idle")},2e3)}catch(e){if(!pt.current)return void le(G);Fe({success:!1,message:String(e)}),Se("error"),le(G),Pe.current=setTimeout(()=>{pt.current&&Se("idle")},2e3)}}},disabled:"loading"===_e||!Ks,className:_("p-2 rounded-lg transition-colors","loading"===_e?"text-accent-primary cursor-wait":"success"===_e?"text-accent-success":"error"===_e?"text-accent-danger":Ks?"text-accent-success hover:bg-accent-success/10":"text-text-muted cursor-not-allowed"),title:Ks?"Save changes":"No changes to save",children:"loading"===_e?t.jsx(n,{className:"w-4 h-4 animate-spin"}):"success"===_e?t.jsx(l,{className:"w-4 h-4"}):"error"===_e?t.jsx(r,{className:"w-4 h-4"}):t.jsx(l,{className:"w-4 h-4"})})]}):t.jsx("button",{onClick:()=>{ce&&(ye((ce.frequency/1e6).toFixed(3)),fe(ce.bandwidth/1e3),ve(ce.spreading_factor),we(ce.coding_rate),Ce(String(ce.tx_power))),Fe(null),he(!0)},className:"p-2 rounded-lg transition-colors text-text-muted hover:text-text-primary hover:bg-bg-subtle",title:"Edit radio settings",children:t.jsx(c,{className:"w-4 h-4"})}))})]}),Te&&t.jsx("div",{className:_("text-xs mb-3 px-2 py-1.5 rounded-md",Te.success?"text-accent-success bg-accent-success/10":"text-accent-danger bg-accent-danger/10"),children:Te.message}),ce?t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:pe?"Frequency (MHz)":"Frequency"}),t.jsx("div",{className:_("h-[38px] rounded-full px-4 flex items-center transition-colors",pe?"bg-white/5":"bg-white/[0.02]"),children:pe?t.jsx("input",{type:"number",value:be,onChange:e=>ye(e.target.value),step:"0.001",min:"400",max:"930",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):t.jsx("span",{className:"type-data text-text-primary",children:L(ce.frequency)})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:pe?"TX Power (dBm)":"TX Power"}),t.jsx("div",{className:_("h-[38px] rounded-full px-4 flex items-center transition-colors",pe?"bg-white/5":"bg-white/[0.02]"),children:pe?t.jsx("input",{type:"number",value:ke,onChange:e=>Ce(e.target.value),min:"-9",max:"22",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):t.jsxs("span",{className:"type-data text-text-primary",children:[ce.tx_power," dBm"]})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Bandwidth"}),t.jsx("div",{className:_("h-[38px] rounded-full px-4 flex items-center transition-colors relative",pe?"bg-white/5":"bg-white/[0.02]"),children:pe?t.jsxs(t.Fragment,{children:[t.jsx("select",{value:ge,onChange:e=>fe(parseFloat(e.target.value)),className:"w-full bg-transparent text-text-primary focus:outline-none appearance-none cursor-pointer type-data pr-6",children:B.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))}),t.jsx(o,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]}):t.jsx("span",{className:"type-data text-text-primary",children:R(ce.bandwidth)})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Spreading Factor"}),t.jsx("div",{className:_("h-[38px] rounded-full px-4 flex items-center transition-colors relative",pe?"bg-white/5":"bg-white/[0.02]"),children:pe?t.jsxs(t.Fragment,{children:[t.jsx("select",{value:je,onChange:e=>ve(parseInt(e.target.value)),className:"w-full bg-transparent text-text-primary focus:outline-none appearance-none cursor-pointer type-data pr-6",children:X.map(e=>t.jsxs("option",{value:e,children:["SF",e]},e))}),t.jsx(o,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]}):t.jsxs("span",{className:"type-data text-text-primary",children:["SF",ce.spreading_factor]})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Coding Rate"}),t.jsx("div",{className:_("h-[38px] rounded-full px-4 flex items-center transition-colors relative",pe?"bg-white/5":"bg-white/[0.02]"),children:pe?t.jsxs(t.Fragment,{children:[t.jsx("select",{value:Ne,onChange:e=>we(parseInt(e.target.value)),className:"w-full bg-transparent text-text-primary focus:outline-none appearance-none cursor-pointer type-data pr-6",children:J.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))}),t.jsx(o,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]}):t.jsxs("span",{className:"type-data text-text-primary",children:["4/",ce.coding_rate]})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Preamble"}),t.jsx("div",{className:"h-[38px] rounded-full px-4 flex items-center bg-white/[0.02]",children:t.jsxs("span",{className:"type-data text-text-primary",children:[ce.preamble_length," symbols"]})})]})]}):t.jsx("p",{className:"text-text-muted",children:"Loading radio configuration..."})]})})})]}),t.jsxs(q,{template:"standard",children:[t.jsx($,{span:12,md:6,children:t.jsx(z,{children:t.jsxs("div",{ref:He,children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("h2",{className:"type-subheading text-text-primary flex items-center gap-3",children:[t.jsx(d,{className:"icon-md text-icon-card-title"}),"Operating Mode"]}),t.jsx("div",{className:"flex items-center gap-1",children:Le?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:async()=>{if("loading"!==Ke){$e.current&&clearTimeout($e.current),ne(Q),qe("loading");try{const e=await A({tx_delay_factor:parseFloat(Ae),direct_tx_delay_factor:parseFloat(Me)});if(await se({max_airtime_percent:parseFloat(Oe),enforcement_enabled:me}),!pt.current)return void le(Q);e.success&&e.data?(await re({force:!0}),qe("success"),$e.current=setTimeout(()=>{pt.current&&(qe("idle"),Re(!1),le(Q))},1500)):(qe("error"),le(Q),$e.current=setTimeout(()=>{pt.current&&qe("idle")},2e3))}catch{if(!pt.current)return void le(Q);qe("error"),le(Q),$e.current=setTimeout(()=>{pt.current&&qe("idle")},2e3)}}},disabled:"loading"===Ke,className:_("p-2 rounded-lg transition-colors","loading"===Ke?"text-accent-primary cursor-wait":"success"===Ke?"text-accent-success":"error"===Ke?"text-accent-danger":"text-accent-success hover:bg-accent-success/10"),title:"Save",children:"loading"===Ke?t.jsx(n,{className:"w-4 h-4 animate-spin"}):"success"===Ke?t.jsx(l,{className:"w-4 h-4"}):"error"===Ke?t.jsx(r,{className:"w-4 h-4"}):t.jsx(l,{className:"w-4 h-4"})}),t.jsx("button",{onClick:Us,className:"p-2 rounded-lg text-text-muted hover:text-accent-danger hover:bg-accent-danger/10",title:"Cancel",children:t.jsx(r,{className:"w-4 h-4"})})]}):t.jsx("button",{onClick:Vs,className:"p-2 rounded-lg transition-colors text-text-muted hover:text-text-primary hover:bg-bg-subtle",title:"Edit settings",children:t.jsx(c,{className:"w-4 h-4"})})})]}),t.jsx("p",{className:"type-label text-text-muted mb-3",children:"Control how the repeater handles packets"}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsxs("div",{className:"flex-1 space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"type-label text-text-muted",children:"Repeat"}),t.jsx("div",{className:"flex items-center gap-2",children:(()=>{const e=null!==dt?dt:"forward"===ue;return t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:async()=>{if("loading"===lt)return;const t=!e,s="forward"===ue;ht.current&&clearTimeout(ht.current),bt.current&&clearTimeout(bt.current),ft.current=!1,ut(t),ct("loading"),ht.current=setTimeout(()=>{ft.current||pt.current&&(ut(s),ct("error"),bt.current=setTimeout(()=>{pt.current&&(ct("idle"),ut(null))},2e3))},1e4);try{if(await ee(t?"forward":"monitor"),ft.current=!0,ht.current&&clearTimeout(ht.current),!pt.current)return;ct("success"),bt.current=setTimeout(()=>{pt.current&&(ct("idle"),ut(null),te())},2e3)}catch{if(ft.current=!0,ht.current&&clearTimeout(ht.current),!pt.current)return;ut(s),ct("error"),bt.current=setTimeout(()=>{pt.current&&(ct("idle"),ut(null))},2e3)}},disabled:"loading"===lt,className:_("relative inline-flex h-6 w-11 items-center rounded-full transition-colors border-2",e?"bg-toggle-on border-toggle-on":"bg-toggle-off border-border-subtle","loading"===lt&&"opacity-70"),"aria-label":"Toggle forward mode",children:t.jsx("span",{className:_("inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-lg",e?"translate-x-5":"translate-x-0.5")})}),t.jsx("span",{className:_("type-data text-sm w-7",e?"text-accent-success":"text-text-muted"),children:e?"On":"Off"}),"loading"===lt&&t.jsx(n,{className:"w-4 h-4 text-text-muted animate-spin"}),"success"===lt&&t.jsx(l,{className:"w-4 h-4 text-accent-success"}),"error"===lt&&t.jsx(r,{className:"w-4 h-4 text-accent-danger"})]})})()})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"type-label text-text-muted",children:"Duty Cycle"}),t.jsx("div",{className:"flex items-center gap-2",children:(()=>{const e=null!==mt?mt:me;return t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:async()=>{if("loading"===it)return;const t=!e,s=me;yt.current&&clearTimeout(yt.current),gt.current&&clearTimeout(gt.current),jt.current=!1,xt(t),ot("loading"),yt.current=setTimeout(()=>{jt.current||pt.current&&(xt(s),ot("error"),gt.current=setTimeout(()=>{pt.current&&(ot("idle"),xt(null))},2e3))},1e4);try{if(await se({max_airtime_percent:Ys(),enforcement_enabled:t}),jt.current=!0,yt.current&&clearTimeout(yt.current),!pt.current)return;ot("success"),gt.current=setTimeout(()=>{pt.current&&(ot("idle"),xt(null),ae())},2e3)}catch{if(jt.current=!0,yt.current&&clearTimeout(yt.current),!pt.current)return;xt(s),ot("error"),gt.current=setTimeout(()=>{pt.current&&(ot("idle"),xt(null))},2e3)}},disabled:"loading"===it,className:_("relative inline-flex h-6 w-11 items-center rounded-full transition-colors border-2",e?"bg-toggle-on border-toggle-on":"bg-toggle-off border-border-subtle","loading"===it&&"opacity-70"),"aria-label":"Toggle duty cycle",children:t.jsx("span",{className:_("inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-lg",e?"translate-x-5":"translate-x-0.5")})}),t.jsx("span",{className:_("type-data text-sm w-7",e?"text-accent-success":"text-text-muted"),children:e?"On":"Off"}),"loading"===it&&t.jsx(n,{className:"w-4 h-4 text-text-muted animate-spin"}),"success"===it&&t.jsx(l,{className:"w-4 h-4 text-accent-success"}),"error"===it&&t.jsx(r,{className:"w-4 h-4 text-accent-danger"})]})})()})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"type-label text-text-muted",children:"Max Airtime"}),t.jsx("div",{className:_("h-[32px] rounded-full px-3 flex items-center justify-end transition-colors min-w-[80px]",Le?"bg-white/5":"bg-white/[0.02]"),children:Le?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("input",{type:"number",value:Oe,onChange:e=>ze(e.target.value),step:"0.5",min:"0.1",max:"100",className:"w-12 bg-transparent text-text-primary text-right focus:outline-none type-data"}),t.jsx("span",{className:"text-text-muted type-data",children:"%"})]}):t.jsxs("span",{className:"type-data text-text-primary",children:[Ys().toFixed(1),"%"]})})]})]}),t.jsx("div",{className:"hidden sm:block w-px bg-border-subtle"}),t.jsxs("div",{className:"flex-1 pt-4 sm:pt-0 border-t sm:border-t-0 border-border-subtle",children:[t.jsx("label",{className:"type-label text-text-muted block mb-3",children:"TX Delays"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"type-label text-text-muted",children:"Flood"}),t.jsx("div",{className:_("h-[32px] rounded-full px-3 flex items-center justify-end transition-colors min-w-[80px]",Le?"bg-white/5":"bg-white/[0.02]"),children:Le?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("input",{type:"number",value:Ae,onChange:e=>De(e.target.value),step:"0.1",min:"0",max:"5",className:"w-12 bg-transparent text-text-primary text-right focus:outline-none type-data"}),t.jsx("span",{className:"text-text-muted type-data",children:"x"})]}):t.jsxs("span",{className:"type-data text-text-primary",children:[$s().toFixed(2),"x"]})})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"type-label text-text-muted",children:"Direct"}),t.jsx("div",{className:_("h-[32px] rounded-full px-3 flex items-center justify-end transition-colors min-w-[80px]",Le?"bg-white/5":"bg-white/[0.02]"),children:Le?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("input",{type:"number",value:Me,onChange:e=>Ie(e.target.value),step:"0.1",min:"0",max:"5",className:"w-12 bg-transparent text-text-primary text-right focus:outline-none type-data"}),t.jsx("span",{className:"text-text-muted type-data",children:"s"})]}):t.jsxs("span",{className:"type-data text-text-primary",children:[Hs().toFixed(2),"s"]})})]})]})]})]})]})})}),t.jsx($,{span:12,md:6,children:t.jsxs(z,{children:[t.jsx(K,{icon:t.jsx(s,{}),title:"App Settings",largeTitle:!0}),t.jsx("p",{className:"type-body-sm text-text-muted mb-4",children:"Appearance and web server options."}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("span",{className:"type-body text-text-primary font-medium block",children:"Enable CORS"}),t.jsx("span",{className:"type-body-sm text-text-muted",children:"Allow cross-origin API access"})]}),t.jsx("div",{className:"flex items-center gap-2",children:(()=>{const e=null!==kt?kt:(null==vt?void 0:vt.cors_enabled)??!1;return t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:Js,disabled:"loading"===Nt,className:_("relative inline-flex h-6 w-11 items-center rounded-full transition-colors border-2",e?"bg-toggle-on border-toggle-on":"bg-toggle-off border-border-subtle","loading"===Nt&&"opacity-70"),title:e?"Disable CORS":"Enable CORS",children:t.jsx("span",{className:_("inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-lg",e?"translate-x-5":"translate-x-0.5")})}),"loading"===Nt&&t.jsx(n,{className:"w-4 h-4 text-text-muted animate-spin"}),"success"===Nt&&t.jsx(l,{className:"w-4 h-4 text-accent-success"}),"error"===Nt&&t.jsx(r,{className:"w-4 h-4 text-accent-danger"})]})})()})]}),t.jsxs("div",{children:[t.jsx("span",{className:"type-body text-text-primary font-medium block mb-2",children:"Theme"}),t.jsx(U,{})]})]})]})})]}),t.jsx(q,{template:"auto",children:t.jsxs(z,{children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"type-heading text-text-primary flex items-center gap-2",children:[t.jsx(u,{className:"icon-md text-accent-primary"}),"Regions / Transport Keys"]}),t.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Manage regional key hierarchy for flood control"})]}),t.jsxs("div",{className:"flex gap-2 flex-wrap",children:[t.jsxs("button",{onClick:()=>ms(!0),disabled:"allow"===as,className:_("flex items-center gap-1.5 h-[32px] px-3 rounded-full transition-colors type-body-sm font-medium","allow"===as?"bg-white/[0.02] text-text-muted cursor-not-allowed":"bg-accent-success/10 hover:bg-accent-success/20 text-accent-success"),children:[t.jsx(m,{className:"w-3.5 h-3.5"}),"Add"]}),t.jsx("button",{onClick:ca,disabled:!cs||"allow"===as,className:_("h-[32px] px-3 rounded-full transition-colors type-body-sm font-medium",cs&&"allow"!==as?"bg-accent-primary/10 hover:bg-accent-primary/20 text-accent-primary":"bg-white/[0.02] text-text-muted cursor-not-allowed"),children:"Edit"}),t.jsx("button",{onClick:ia,disabled:!cs||"allow"===as,className:_("h-[32px] px-3 rounded-full transition-colors type-body-sm font-medium",cs&&"allow"!==as?"bg-accent-danger/10 hover:bg-accent-danger/20 text-accent-danger":"bg-white/[0.02] text-text-muted cursor-not-allowed"),children:"Delete"})]})]}),t.jsx("div",{className:"bg-white/[0.02] rounded-2xl p-4 mb-4",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:_("w-10 h-10 rounded-full flex items-center justify-center","allow"===as?"bg-accent-success/20":"bg-accent-danger/20"),children:"allow"===as?t.jsx(x,{className:"w-5 h-5 text-accent-success"}):t.jsx(p,{className:"w-5 h-5 text-accent-danger"})}),t.jsxs("div",{children:[t.jsx("h4",{className:"type-body text-text-primary font-medium",children:"Global Flood Policy"}),t.jsx("p",{className:"type-body-sm text-text-muted",children:"Master control for repeater flooding"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"flex bg-white/[0.02] rounded-full p-1",children:[t.jsx("button",{onClick:()=>na("deny"),disabled:ns,className:_("px-4 py-1.5 rounded-full transition-colors type-body-sm font-medium","deny"===as?"bg-accent-danger/20 text-accent-danger":"text-text-muted hover:text-text-secondary",ns&&"opacity-50"),children:"Deny"}),t.jsx("button",{onClick:()=>na("allow"),disabled:ns,className:_("px-4 py-1.5 rounded-full transition-colors type-body-sm font-medium","allow"===as?"bg-accent-success/20 text-accent-success":"text-text-muted hover:text-text-secondary",ns&&"opacity-50"),children:"Allow"})]}),ns&&t.jsx(n,{className:"w-4 h-4 animate-spin text-text-muted"})]})]})}),ts&&t.jsx("div",{className:"type-body-sm mb-3 px-3 py-2 rounded-full text-accent-danger bg-accent-danger/10",children:ts}),t.jsx("div",{className:"bg-white/[0.02] rounded-2xl p-4 min-h-[120px]",children:Zt?t.jsxs("div",{className:"flex items-center justify-center py-6",children:[t.jsx(n,{className:"w-5 h-5 animate-spin text-accent-primary mr-2"}),t.jsx("span",{className:"type-body-sm text-text-muted",children:"Loading transport keys..."})]}):0===Wt.length?t.jsxs("div",{className:"text-center py-6",children:[t.jsx("div",{className:"w-12 h-12 rounded-full bg-white/[0.02] mx-auto mb-3 flex items-center justify-center",children:t.jsx(u,{className:"w-6 h-6 text-text-muted/50"})}),t.jsx("p",{className:"type-body text-text-muted",children:"No transport keys found"}),t.jsx("p",{className:"type-body-sm text-text-muted/70 mt-1",children:"Add your first transport key to get started"})]}):t.jsx("div",{className:"space-y-1",children:Wt.map(e=>t.jsx(Z,{node:e,level:0,expandedKeys:os,selectedKeyId:cs,globalFloodPolicy:as,onSelect:is,onToggle:ra},e.id))})})]})}),t.jsx(q,{template:"auto",children:t.jsxs(z,{children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"type-heading text-text-primary flex items-center gap-2",children:[t.jsx(h,{className:"icon-md text-accent-primary"}),"API Tokens"]}),t.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Manage API tokens for machine-to-machine authentication"})]}),t.jsxs("button",{onClick:()=>Mt(!0),className:"flex items-center justify-center gap-2 h-[32px] px-4 bg-accent-primary/10 hover:bg-accent-primary/20 text-accent-primary rounded-full transition-colors type-body-sm font-medium",children:[t.jsx(m,{className:"w-4 h-4"}),"Create Token"]})]}),t.jsx("div",{className:"bg-accent-tertiary/5 rounded-2xl p-4 mb-4",children:t.jsxs("div",{className:"flex gap-3",children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-accent-tertiary/20 flex items-center justify-center flex-shrink-0",children:t.jsx(b,{className:"w-4 h-4 text-accent-tertiary"})}),t.jsxs("div",{className:"type-body-sm text-text-muted",children:[t.jsxs("p",{children:[t.jsx("span",{className:"text-text-secondary",children:"API tokens"})," are used for machine-to-machine authentication. Include the token in the ",t.jsx("code",{className:"type-code bg-accent-tertiary/20 px-1.5 py-0.5 rounded-full text-accent-tertiary",children:"X-API-Key"})," header when making API requests."]}),t.jsx("p",{className:"mt-1 text-text-muted/70",children:"Tokens are only shown once at creation. Store them securely."})]})]})}),Rt&&t.jsx("div",{className:"type-body-sm mb-3 px-3 py-2 rounded-full text-accent-danger bg-accent-danger/10",children:Rt}),Pt&&0===Ft.length?t.jsxs("div",{className:"flex items-center justify-center py-6",children:[t.jsx(n,{className:"w-5 h-5 animate-spin text-accent-primary mr-2"}),t.jsx("span",{className:"type-body-sm text-text-muted",children:"Loading tokens..."})]}):Ft.length>0?t.jsx("div",{className:"space-y-2",children:Ft.map(e=>t.jsx("div",{className:"bg-white/[0.02] hover:bg-white/[0.04] rounded-2xl p-4 transition-colors",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-accent-primary/10 flex items-center justify-center flex-shrink-0",children:t.jsx(h,{className:"w-5 h-5 text-accent-primary"})}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("h3",{className:"type-body text-text-primary font-medium truncate",children:e.name}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:gap-4 mt-0.5",children:[t.jsxs("span",{className:"type-data-sm text-text-muted truncate",children:["Created: ",Zs(e.created_at)]}),t.jsxs("span",{className:"type-data-sm text-text-muted truncate",children:["Last used: ",Zs(e.last_used)]})]})]})]}),t.jsxs("button",{onClick:()=>Yt({id:e.id,name:e.name}),disabled:Bt,className:"h-[32px] px-4 bg-accent-danger/10 hover:bg-accent-danger/20 text-accent-danger rounded-full transition-colors disabled:opacity-50 type-body-sm font-medium flex items-center justify-center gap-1.5",children:[t.jsx(y,{className:"w-3.5 h-3.5"}),"Revoke"]})]})},e.id))}):t.jsxs("div",{className:"bg-white/[0.02] rounded-2xl p-6 text-center",children:[t.jsx("div",{className:"w-14 h-14 rounded-full bg-white/[0.02] mx-auto mb-4 flex items-center justify-center",children:t.jsx(h,{className:"w-7 h-7 text-text-muted/50"})}),t.jsx("h3",{className:"type-body text-text-primary font-medium mb-1",children:"No API Tokens"}),t.jsx("p",{className:"type-body-sm text-text-muted mb-4",children:"Create a token to enable API access"}),t.jsx("button",{onClick:()=>Mt(!0),className:"h-[32px] px-4 bg-accent-primary/10 hover:bg-accent-primary/20 text-accent-primary rounded-full transition-colors type-body-sm font-medium",children:"Create Your First Token"})]})]})}),t.jsx(q,{template:"auto",children:t.jsxs(z,{children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:t.jsxs("div",{children:[t.jsxs("h2",{className:"type-heading text-text-primary flex items-center gap-2",children:[t.jsx(g,{className:"icon-md text-accent-primary"}),"Web Frontend"]}),t.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Choose which web interface to use"})]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("label",{className:_("flex items-start gap-3 p-4 bg-white/[0.02] rounded-2xl border-2 cursor-pointer transition-all",Ss?"border-accent-primary bg-accent-primary/5":"border-transparent hover:border-accent-primary/30","loading"===Rs&&"opacity-50 pointer-events-none"),children:[t.jsx("input",{type:"radio",name:"frontend",checked:Ss,onChange:()=>Gs(!0),disabled:"loading"===Rs,className:"mt-1 h-4 w-4 text-accent-primary focus:ring-accent-primary focus:ring-offset-bg-elevated"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"type-body text-text-primary font-medium",children:"Default Frontend"}),t.jsx("a",{href:"https://github.com/rightup/pyMC_Repeater",target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"type-data-xs bg-accent-tertiary/15 text-accent-tertiary px-2.5 py-0.5 rounded-full font-medium hover:bg-accent-tertiary/25 transition-colors",children:"@RightUp"})]}),t.jsx("div",{className:"type-body-sm text-text-muted mt-1",children:"Built-in pyMC Repeater web interface"}),t.jsx("div",{className:"type-data-xs text-text-muted/60 mt-1 font-mono",children:"/opt/pymc_repeater/repeater/web/html"})]})]}),t.jsxs("label",{className:_("flex items-start gap-3 p-4 bg-white/[0.02] rounded-2xl border-2 cursor-pointer transition-all",Ss?"border-transparent hover:border-accent-primary/30":"border-accent-primary bg-accent-primary/5","loading"===Rs&&"opacity-50 pointer-events-none"),children:[t.jsx("input",{type:"radio",name:"frontend",checked:!Ss,onChange:()=>Gs(!1),disabled:"loading"===Rs,className:"mt-1 h-4 w-4 text-accent-primary focus:ring-accent-primary focus:ring-offset-bg-elevated"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"type-body text-text-primary font-medium",children:"PyMC Console"}),t.jsx("span",{className:"type-data-xs bg-accent-secondary/15 text-accent-secondary px-2.5 py-0.5 rounded-full font-medium",children:"@Treehouse ⚡"})]}),t.jsx("div",{className:"type-body-sm text-text-muted mt-1",children:"Alternative web interface for pyMC Repeater"}),t.jsx("div",{className:"type-data-xs text-text-muted/60 mt-1 font-mono",children:"/opt/pymc_console/web/html"})]})]})]}),!Ps&&t.jsx("div",{className:_("bg-white/[0.02] rounded-2xl p-4",Fs?"border border-accent-success/20":"border border-accent-tertiary/20"),children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:_("w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",Fs?"bg-accent-success/20":"bg-accent-tertiary/20"),children:Fs?t.jsx(f,{className:"w-4 h-4 text-accent-success"}):t.jsx(b,{className:"w-4 h-4 text-accent-tertiary"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"type-body text-text-primary font-medium",children:Fs?"PyMC Console has been detected":"PyMC Console Not Installed"}),Fs?t.jsxs("p",{className:"type-body-sm text-text-muted mt-1",children:["PyMC Console is installed at ",t.jsx("code",{className:"type-code bg-accent-success/10 px-1.5 py-0.5 rounded-full text-accent-success",children:"/opt/pymc_console/web/html"})]}):t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"type-body-sm text-text-muted mt-1 mb-3",children:["PyMC Console must be installed at ",t.jsx("code",{className:"type-code bg-accent-tertiary/10 px-1.5 py-0.5 rounded-full text-accent-tertiary",children:"/opt/pymc_console/web/html"})," before selecting this option."]}),t.jsxs("a",{href:"https://github.com/dmduran12/pymc_console-dist",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 h-[32px] px-4 bg-accent-tertiary/10 hover:bg-accent-tertiary/20 text-accent-tertiary rounded-full type-body-sm font-medium transition-colors",children:[t.jsx(j,{className:"w-4 h-4"}),"PyMC Console Install Instructions"]})]})]})]})}),Ds&&t.jsx("div",{className:"bg-white/[0.02] rounded-2xl p-4 border border-accent-secondary/30",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[t.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-accent-secondary/20 flex items-center justify-center flex-shrink-0",children:t.jsx(v,{className:"w-4 h-4 text-accent-secondary"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"type-body text-text-primary font-medium",children:"Service restart required"}),t.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Web frontend changes will take effect after restarting the pymc-repeater service."})]})]}),t.jsx("button",{onClick:async()=>{if(!Is){Os(!0);try{await async function(){return S("/api/restart_service",{method:"POST",body:"{}"})}(),Ms(!1),setTimeout(()=>{window.location.reload()},2e3)}catch{Ms(!1),setTimeout(()=>{window.location.reload()},3e3)}}},disabled:Is,className:"h-[32px] px-4 bg-accent-secondary/10 hover:bg-accent-secondary/20 text-accent-secondary rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 whitespace-nowrap type-body-sm font-medium",children:Is?t.jsxs(t.Fragment,{children:[t.jsx(n,{className:"w-4 h-4 animate-spin"}),"Restarting..."]}):t.jsxs(t.Fragment,{children:[t.jsx(N,{className:"w-4 h-4"}),"Restart Now"]})})]})})]})]})}),t.jsx(q,{template:"auto",children:t.jsxs(z,{children:[t.jsx(K,{icon:t.jsx(d,{}),title:"Node Information",largeTitle:!0}),V?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsxs("div",{children:[t.jsx("span",{className:"type-label text-text-muted",children:"Node Name"}),t.jsx("p",{className:"type-body text-text-primary mt-1",children:de})]}),t.jsxs("div",{children:[t.jsx("span",{className:"type-label text-text-muted",children:"Version"}),t.jsxs("p",{className:"type-data text-text-primary mt-1",children:["v",V.version]})]}),t.jsxs("div",{children:[t.jsx("span",{className:"type-label text-text-muted",children:"Core Version"}),t.jsxs("p",{className:"type-data text-text-primary mt-1",children:["v",V.core_version]})]}),t.jsxs("div",{children:[t.jsx("span",{className:"type-label text-text-muted",children:"Local Hash"}),t.jsx("div",{className:"mt-1",children:V.local_hash?t.jsx(D,{copy:!0,size:"compact",children:V.local_hash}):t.jsx("span",{className:"type-data-sm text-text-muted",children:"N/A"})})]})]}),V.public_key&&t.jsxs("div",{className:"mt-4 pt-4 border-t border-border-subtle",children:[t.jsx("span",{className:"type-label text-text-muted",children:"Public Key"}),t.jsx("div",{className:"mt-1",children:t.jsx(D,{copy:!0,children:V.public_key})})]})]}):t.jsx("p",{className:"text-text-muted",children:"Loading node information..."})]})}),Dt&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&Mt(!1),role:"dialog","aria-modal":"true","aria-labelledby":"create-token-modal-title",children:t.jsxs("div",{className:"bg-bg-elevated border border-border-subtle rounded-xl p-6 max-w-md w-full shadow-2xl",children:[t.jsx("h3",{id:"create-token-modal-title",className:"type-subheading text-text-primary mb-4",children:"Create API Token"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Token Name"}),t.jsx("input",{type:"text",value:It,onChange:e=>Ot(e.target.value),placeholder:"e.g., Production Server, CI/CD Pipeline",className:"w-full px-4 py-2 bg-bg-subtle border border-border-subtle rounded-lg text-text-primary placeholder-text-muted focus:outline-none focus:ring-2 focus:ring-accent-primary/50 transition-colors",onKeyDown:e=>"Enter"===e.key&&Qs(),autoFocus:!0}),t.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Give your token a descriptive name to identify its purpose"})]}),t.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[t.jsx("button",{onClick:()=>{Mt(!1),Ot(""),At(null)},disabled:Vt,className:"px-4 py-2 bg-bg-subtle hover:bg-bg-elevated text-text-secondary rounded-lg border border-border-subtle transition-colors disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:Qs,disabled:Vt||!It.trim(),className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary rounded-lg border border-accent-primary/50 transition-colors disabled:opacity-50 flex items-center gap-2",children:Vt?t.jsxs(t.Fragment,{children:[t.jsx(n,{className:"w-4 h-4 animate-spin"}),"Creating..."]}):"Create Token"})]})]})]})}),qt&&zt&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&$t(!1),role:"dialog","aria-modal":"true","aria-labelledby":"show-token-modal-title",children:t.jsxs("div",{className:"bg-bg-elevated border border-border-subtle rounded-xl p-6 max-w-lg w-full shadow-2xl",children:[t.jsx("h3",{id:"show-token-modal-title",className:"type-subheading text-text-primary mb-4",children:"Token Created Successfully"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"bg-accent-secondary/10 border border-accent-secondary/30 rounded-lg p-3",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx(v,{className:"w-4 h-4 text-accent-secondary flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"text-sm text-text-secondary",children:[t.jsx("strong",{children:"Save this token now!"})," For security reasons, it will not be shown again."]})]})}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Your API Token"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{value:zt,readOnly:!0,className:"flex-1 px-4 py-2 bg-bg-subtle border border-border-subtle rounded-lg text-text-primary font-mono text-sm"}),t.jsxs("button",{onClick:()=>{zt&&(navigator.clipboard.writeText(zt),Gt(!0),setTimeout(()=>Gt(!1),2e3))},className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary rounded-lg border border-accent-primary/50 transition-colors flex items-center gap-2",title:"Copy to clipboard",children:[Jt?t.jsx(l,{className:"w-4 h-4 text-accent-success"}):t.jsx(w,{className:"w-4 h-4"}),Jt?"Copied!":"Copy"]})]})]}),t.jsxs("div",{className:"bg-accent-tertiary/10 border border-accent-tertiary/30 rounded-lg p-3",children:[t.jsx("p",{className:"text-sm text-text-secondary mb-2",children:t.jsx("strong",{children:"Usage Example:"})}),t.jsxs("code",{className:"block bg-accent-tertiary/20 px-3 py-2 rounded text-xs text-accent-tertiary font-mono overflow-x-auto",children:['curl -H "X-API-Key: ',zt.slice(0,12),'..." ',window.location.origin,"/api/stats"]})]}),t.jsx("div",{className:"flex justify-end mt-6",children:t.jsx("button",{onClick:()=>{$t(!1),Kt(null)},className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary rounded-lg border border-accent-primary/50 transition-colors",children:"Done"})})]})]})}),t.jsx(M,{isOpen:!!Ht,title:"Revoke API Token",message:`Are you sure you want to revoke the token '${null==Ht?void 0:Ht.name}'? This action cannot be undone.`,confirmLabel:Bt?"Revoking...":"Revoke",cancelLabel:"Cancel",variant:"danger",onConfirm:async()=>{if(Ht){Xt(!0),At(null);try{await async function(e){return S(`/auth/tokens/${e}`,{method:"DELETE"})}(Ht.id),await Ws(),Yt(null)}catch(e){At(e instanceof Error?e.message:"Failed to revoke token")}finally{Xt(!1)}}},onCancel:()=>Yt(null)}),us&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&ms(!1),role:"dialog","aria-modal":"true","aria-labelledby":"add-key-modal-title",children:t.jsxs("div",{className:"bg-bg-elevated border border-border-subtle rounded-xl p-6 max-w-md w-full shadow-2xl",children:[t.jsx("h3",{id:"add-key-modal-title",className:"type-subheading text-text-primary mb-4",children:"Add Transport Key"}),t.jsxs("div",{className:"space-y-4",children:[cs&&t.jsxs("div",{className:"bg-accent-tertiary/10 border border-accent-tertiary/30 rounded-lg p-3 text-sm text-text-secondary",children:["Adding as child of: ",t.jsx("strong",{className:"text-text-primary",children:aa()})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Key Name"}),t.jsx("input",{type:"text",value:vs,onChange:e=>Ns(e.target.value),placeholder:"e.g., Region Name, Group Key",className:"w-full px-4 py-2 bg-bg-subtle border border-border-subtle rounded-lg text-text-primary placeholder-text-muted focus:outline-none focus:ring-2 focus:ring-accent-primary/50 transition-colors",onKeyDown:e=>"Enter"===e.key&&la(),autoFocus:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Flood Policy"}),t.jsxs("div",{className:"flex bg-bg-subtle rounded-lg border border-border-subtle p-1",children:[t.jsx("button",{onClick:()=>ks("deny"),className:_("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","deny"===ws?"bg-accent-danger/20 text-accent-danger border border-accent-danger/50":"text-text-muted hover:text-text-secondary"),children:"DENY"}),t.jsx("button",{onClick:()=>ks("allow"),className:_("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","allow"===ws?"bg-accent-success/20 text-accent-success border border-accent-success/50":"text-text-muted hover:text-text-secondary"),children:"ALLOW"})]})]}),t.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[t.jsx("button",{onClick:()=>{ms(!1),Ns(""),ks("deny")},disabled:Cs,className:"px-4 py-2 bg-bg-subtle hover:bg-bg-elevated text-text-secondary rounded-lg border border-border-subtle transition-colors disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:la,disabled:Cs||!vs.trim(),className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary rounded-lg border border-accent-primary/50 transition-colors disabled:opacity-50 flex items-center gap-2",children:Cs?t.jsxs(t.Fragment,{children:[t.jsx(n,{className:"w-4 h-4 animate-spin"}),"Adding..."]}):"Add Key"})]})]})]})}),xs&&ys&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&ps(!1),role:"dialog","aria-modal":"true","aria-labelledby":"edit-key-modal-title",children:t.jsxs("div",{className:"bg-bg-elevated border border-border-subtle rounded-xl p-6 max-w-md w-full shadow-2xl",children:[t.jsx("h3",{id:"edit-key-modal-title",className:"type-subheading text-text-primary mb-4",children:"Edit Transport Key"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Key Name"}),t.jsx("input",{type:"text",value:ys.name,onChange:e=>gs({...ys,name:e.target.value}),className:"w-full px-4 py-2 bg-bg-subtle border border-border-subtle rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary/50 transition-colors",autoFocus:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Flood Policy"}),t.jsxs("div",{className:"flex bg-bg-subtle rounded-lg border border-border-subtle p-1",children:[t.jsx("button",{onClick:()=>gs({...ys,floodPolicy:"deny"}),className:_("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","deny"===ys.floodPolicy?"bg-accent-danger/20 text-accent-danger border border-accent-danger/50":"text-text-muted hover:text-text-secondary"),children:"DENY"}),t.jsx("button",{onClick:()=>gs({...ys,floodPolicy:"allow"}),className:_("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","allow"===ys.floodPolicy?"bg-accent-success/20 text-accent-success border border-accent-success/50":"text-text-muted hover:text-text-secondary"),children:"ALLOW"})]})]}),ys.transport_key&&t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Transport Key"}),t.jsx("code",{className:"block bg-bg-subtle px-3 py-2 rounded-lg text-xs text-text-muted font-mono overflow-x-auto",children:ys.transport_key})]}),t.jsxs("div",{className:"flex justify-between gap-3 mt-6",children:[t.jsx("button",{onClick:()=>{ps(!1),js(ys),bs(!0),gs(null)},disabled:Cs,className:"px-4 py-2 bg-accent-danger/20 hover:bg-accent-danger/30 text-accent-danger rounded-lg border border-accent-danger/50 transition-colors disabled:opacity-50",children:"Delete"}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:()=>{ps(!1),gs(null)},disabled:Cs,className:"px-4 py-2 bg-bg-subtle hover:bg-bg-elevated text-text-secondary rounded-lg border border-border-subtle transition-colors disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(ys){_s(!0),ss(null);try{const e=await async function(e,t){return S(`/api/transport_key/${e}`,{method:"PUT",body:JSON.stringify(t)})}(ys.id,{name:ys.name,flood_policy:ys.floodPolicy});e.success?(await ta(),ps(!1),gs(null)):ss(e.error||"Failed to update transport key")}catch(e){ss(e instanceof Error?e.message:"Failed to update transport key")}finally{_s(!1)}}},disabled:Cs||!ys.name.trim(),className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary rounded-lg border border-accent-primary/50 transition-colors disabled:opacity-50 flex items-center gap-2",children:Cs?t.jsxs(t.Fragment,{children:[t.jsx(n,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):"Save"})]})]})]})]})}),hs&&fs&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&bs(!1),role:"dialog","aria-modal":"true","aria-labelledby":"delete-key-modal-title",children:t.jsxs("div",{className:"bg-bg-elevated border border-border-subtle rounded-xl p-6 max-w-md w-full shadow-2xl",children:[t.jsx("h3",{id:"delete-key-modal-title",className:"type-subheading text-text-primary mb-4",children:"Delete Transport Key"}),t.jsxs("p",{className:"text-text-secondary mb-4",children:["Are you sure you want to delete ",t.jsxs("strong",{className:"text-text-primary",children:["'",fs.name,"'"]}),"?"]}),fs.children&&fs.children.length>0&&t.jsx("div",{className:"bg-accent-secondary/10 border border-accent-secondary/30 rounded-lg p-3 mb-4",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx(v,{className:"w-4 h-4 text-accent-secondary flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"text-sm text-text-secondary",children:["This key has ",fs.children.length," child key(s). Deleting will also remove all children."]})]})}),t.jsxs("div",{className:"flex justify-end gap-3",children:[t.jsx("button",{onClick:()=>{bs(!1),js(null)},disabled:Cs,className:"px-4 py-2 bg-bg-subtle hover:bg-bg-elevated text-text-secondary rounded-lg border border-border-subtle transition-colors disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(fs){_s(!0),ss(null);try{const e=await async function(e){return S(`/api/transport_key/${e}`,{method:"DELETE"})}(fs.id);e.success?(await ta(),bs(!1),js(null),is(null)):ss(e.error||"Failed to delete transport key")}catch(e){ss(e instanceof Error?e.message:"Failed to delete transport key")}finally{_s(!1)}}},disabled:Cs,className:"px-4 py-2 bg-accent-danger/20 hover:bg-accent-danger/30 text-accent-danger rounded-lg border border-accent-danger/50 transition-colors disabled:opacity-50 flex items-center gap-2",children:Cs?t.jsxs(t.Fragment,{children:[t.jsx(n,{className:"w-4 h-4 animate-spin"}),"Deleting..."]}):"Delete"})]})]})})]})}export{ee as default};
