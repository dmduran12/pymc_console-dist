const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PathMapMapLibre-Vou6UMwb.js","assets/vendor-react-Co0R0q1H.js","assets/BasemapLayer-DRuifqX0.js","assets/vendor-core-B_fdKJ1g.js","assets/index-DqKbxKNs.js","assets/useMapViewStore-CsBT_uaY.js","assets/index-pqoOyVFk.js","assets/maplibre-gl-B1CfjdFi.css","assets/index-DJRghbIM.css"])))=>i.map(i=>d[i]);
import{c as e,ag as s,ah as t,ai as a,aj as n,B as r,q as l,k as i,ak as c,R as d,al as o,am as x,an as m,ao as p,ap as h,P as u,aq as g,ar as f,m as y,$ as j,p as b,as as N,at as v,au as k,av as w,aw as C,ax as _,ay as S,az as H,aA as P,W as T,w as M,aB as B,aC as F,aD as L,aE as D,a4 as z,a5 as R,A as $,aF as A,a6 as E,aG as U,aH as I}from"./index-DqKbxKNs.js";import{c as V}from"./vendor-core-B_fdKJ1g.js";import{j as Q,c as G,r as O,_ as W,u as q}from"./vendor-react-Co0R0q1H.js";import{p as K,d as X,e as Y,g as J,b as Z}from"./primitives-DLjenaiT.js";import{u as ee,r as se,a as te,b as ae,c as ne,d as re,i as le}from"./consumer-registry-YSD2kQWs.js";import{D as ie,R as ce,P as de,g as oe}from"./badge-colors-CIfybB3y.js";import{g as xe,e as me,a as pe}from"./chat-utils-DaMSj78I.js";import{P as he,d as ue,a as ge,b as fe}from"./payload-decoders-BqapUfFO.js";import{A as ye,S as je,i as be,C as Ne,a as ve,g as ke}from"./SignalIndicator-CmbhiZG_.js";import{a as we,A as Ce}from"./arrow-up-DeF51nH0.js";import{C as _e}from"./chevron-right-wl8HNkYQ.js";import{f as Se,r as He}from"./usePipelineStore-By9zPnnZ.js";import{M as Pe}from"./map-pin-BjGB7f1W.js";import{C as Te}from"./circle-question-mark-B7d1rYjU.js";import{T as Me}from"./triangle-alert-BYQiMrfu.js";import{D as Be}from"./DataBox-DlnGnPLj.js";import{L as Fe}from"./layers-B7eHeoFi.js";import{H as Le}from"./hash-wr7Yvz-p.js";import{A as De}from"./activity-y9IWLQ43.js";import{C as ze}from"./circle-check-q-p2dROh.js";import{D as Re}from"./database-WcOQxr-q.js";import{H as $e,D as Ae,Z as Ee,u as Ue}from"./useMapViewStore-CsBT_uaY.js";import{S as Ie}from"./shield-W5bqR1Qf.js";import{C as Ve}from"./TimeRangeStepper-DBJULLBh.js";const Qe=e("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),Ge=e("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Oe=e("corner-down-right",[["path",{d:"m15 10 5 5-5 5",key:"qqa56n"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]]),We=e("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),qe=e("message-circle-question-mark",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Ke=e("reply",[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]]),Xe=e("route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]),Ye=e("stethoscope",[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]),Je=e("trophy",[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]]),Ze=e("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);function es(e,s){[...s].reverse().forEach(a=>{const n=e.getVariant(a);n&&t(e,n),e.variantChildren&&e.variantChildren.forEach(e=>{es(e,s)})})}function ss(){const e=new Set,a={subscribe:s=>(e.add(s),()=>{e.delete(s)}),start(t,a){const n=[];return e.forEach(e=>{n.push(s(e,t,{transitionOverride:a}))}),Promise.all(n)},set:s=>e.forEach(e=>{!function(e,s){Array.isArray(s)?es(e,s):"string"==typeof s?es(e,[s]):t(e,s)}(e,s)}),stop(){e.forEach(e=>{!function(e){e.values.forEach(e=>e.stop())}(e)})},mount:()=>()=>{a.stop()}};return a}function ts({"aria-label":e="Page navigation",className:s,...t}){return Q.jsx("nav",{"aria-label":e,...t,className:G("flex gap-x-2",s)})}function as({onClick:e,disabled:s=!1,className:t,children:a="Previous"}){return Q.jsx("span",{className:G("grow basis-0",t),children:Q.jsxs(r,{plain:!0,onClick:e,disabled:s,"aria-label":"Previous page",className:G("gap-1",s&&"invisible"),children:[Q.jsx("svg",{className:"size-4 stroke-current",viewBox:"0 0 16 16",fill:"none","aria-hidden":"true",children:Q.jsx("path",{d:"M2.75 8H13.25M2.75 8L5.25 5.5M2.75 8L5.25 10.5",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})}),a]})})}function ns({onClick:e,disabled:s=!1,className:t,children:a="Next"}){return Q.jsx("span",{className:G("flex grow basis-0 justify-end",t),children:Q.jsxs(r,{plain:!0,onClick:e,disabled:s,"aria-label":"Next page",className:G("gap-1",s&&"invisible"),children:[a,Q.jsx("svg",{className:"size-4 stroke-current",viewBox:"0 0 16 16",fill:"none","aria-hidden":"true",children:Q.jsx("path",{d:"M13.25 8L2.75 8M13.25 8L10.75 10.5M13.25 8L10.75 5.5",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})})]})})}function rs({className:e,...s}){return Q.jsx("span",{...s,className:G("hidden items-baseline gap-x-2 sm:flex",e)})}function ls({page:e,current:s=!1,onClick:t,className:a,children:n}){return Q.jsx(r,{plain:!s,outline:s,onClick:()=>null==t?void 0:t(e),"aria-label":`Page ${e}`,"aria-current":s?"page":void 0,className:G("min-w-[2.25rem] before:absolute before:-inset-px before:rounded-lg",s&&"before:bg-subtle-fill",a),children:n??e})}function is({className:e,...s}){return Q.jsx("span",{"aria-hidden":"true",...s,className:G("w-[2.25rem] select-none text-center text-sm text-fg-muted",e),children:"…"})}const cs=V(e=>({requestedHash:null,requestChannel:s=>e({requestedHash:s}),clearRequest:()=>e({requestedHash:null})})),ds={rx:{icon:Ce,label:"Rx",badgeColor:ie.rx,avatarBg:"bg-sys-green/15",avatarText:"text-sys-green"},forward:{icon:ye,label:"Fwd",badgeColor:ie.forward,avatarBg:"bg-sys-cyan/15",avatarText:"text-sys-cyan"},duplicate:{icon:l,label:"Dupe",badgeColor:ie.duplicate,avatarBg:"bg-fg-muted/15",avatarText:"text-fg-secondary"},tx:{icon:we,label:"Tx",badgeColor:ie.tx,avatarBg:"bg-sys-indigo/15",avatarText:"text-sys-indigo"},dropped:{icon:Oe,label:"Drop",badgeColor:ie.dropped,avatarBg:"bg-sys-amber/15",avatarText:"text-sys-amber"}},os={sm:"w-3.5 h-3.5",md:"w-4 h-4",lg:"w-5 h-5"},xs={sm:"w-8 h-8",md:"w-9 h-9",lg:"w-10 h-10"};function ms(e){return"tx_local"===e.packet_origin?"tx":"tx_forward"===e.packet_origin?"forward":e.is_duplicate?"duplicate":e.transmitted?"forward":e.drop_reason?"dropped":"rx"}const ps=O.memo(function({packet:e,showLabel:s=!0,variant:t="avatar",size:a="sm"}){const n=ms(e),r=ds[n],l=r.icon;return"avatar"===t?Q.jsx("div",{className:G("flex items-center justify-center rounded-full flex-shrink-0",r.avatarBg,xs[a]),children:Q.jsx(l,{className:G(os[a],r.avatarText)})}):Q.jsxs(i,{color:r.badgeColor,children:[Q.jsx(l,{className:os[a]}),s&&r.label]})}),hs=O.memo(function({path:e,localHash:s,className:t}){if(!e||0===e.length)return Q.jsx("span",{className:G("text-fg-muted text-xs",t),children:"—"});const a=s?(s.startsWith("0x")?s.slice(2,4):s.slice(0,2)).toUpperCase():null;return Q.jsx("span",{className:G("flex items-center gap-0.5 type-data-xs overflow-hidden",t),children:e.map((s,t)=>{const n=t===e.length-1,r=a&&s.toUpperCase()===a;return Q.jsxs("span",{className:"flex items-center flex-shrink-0",children:[r?Q.jsx("span",{className:"px-1 py-0.5 rounded bg-sys-amber/20 text-sys-amber text-[9px] font-medium",children:"You"}):Q.jsx("span",{className:"px-1 py-0.5 rounded bg-subtle-fill-hover text-fg-secondary",children:s.toUpperCase()}),!n&&Q.jsx(_e,{className:"w-2.5 h-2.5 text-fg-muted mx-0.5 flex-shrink-0"})]},`${s}-${t}`)})})});function us({channelName:e,onClick:s,active:t,compact:a,className:n}){const r=e.startsWith("#")?e:`#${e}`,l=G("inline-flex items-center flex-shrink-0","font-medium",a?"px-1.5 h-4 leading-4 rounded text-[10px]":"px-2 h-5 leading-5 rounded text-xs",t?"bg-sys-blue/20 text-sys-blue":"bg-sys-blue/10 text-sys-blue",s&&!t&&"hover:bg-sys-blue/20 cursor-pointer",n);return s?Q.jsx("button",{type:"button",onClick:s,className:l,children:r}):Q.jsx("span",{className:l,children:r})}function gs(e){return{"--data-box-accent":p[e]}}function fs(e){const s=e.payload_type_name||x(e.payload_type??e.type),t=e.route_type_name||m(e.route_type??e.route);return{payloadType:s,routeType:t,payloadColor:de[s]??"zinc",routeColor:ce[t]??"zinc"}}function ys(e){if(!e)return[];if(Array.isArray(e))return e;try{const s=JSON.parse(e);return Array.isArray(s)?s:[]}catch{return[]}}function js(e,s){if(s){const t=s(e);return{name:t.name,isCompanion:t.isCompanion,isRepeater:t.isRepeater}}return{name:null,isCompanion:!1,isRepeater:!1}}const bs=O.memo(function({packet:e,onClick:s,localHash:t,neighbors:a,resolveSource:n,isFlashing:r=!1,isTraceHighlighted:l,onTraceHover:i,traceTag:x,onViewTraceReport:m,dupeGroupPosition:h,isDupeGroupHovered:u=!1,onDupeGroupHover:g,dupeCount:f,getDecodedContent:y,onChannelClick:j}){const b=!f&&c(e.is_duplicate),N=void 0!==h,{payloadType:v,routeType:k,payloadColor:w,routeColor:C}=fs(e),_="tx_local"===e.packet_origin,S="TRACE"===v,H=ys(e.original_path),P=ys(e.forwarded_path),T=P.length>0?P:H,M=e.src_hash?(e.src_hash.startsWith("0x")?e.src_hash.slice(2,6):e.src_hash.slice(0,4)).toUpperCase():null,{name:B,isRepeater:F}=js(e,n);let L=null,D=null,z=null,R=null;if("GRP_TXT"===v&&y){const s=y(e);(null==s?void 0:s.decrypted)&&(D=s.senderName,z=s.channelName,R=s.channelHash,s.text&&(L=s.text))}else if("TXT_MSG"===v&&e.raw_packet)try{const s=he.fromHex(e.raw_packet);if(s.success&&s.packet){const e=ue(s.packet.payload);e&&!e.encrypted&&(L=e.text)}}catch{}const $=D||(F?null:B),A=!!$,E=!A&&F&&!!B,U=!A&&!E&&"GRP_TXT"===v&&!L,I=e.payload_length??e.length??0;e.lbt_attempts;const V=O.useCallback(()=>{S&&x&&m?m(x):s(e)},[S,x,m,s,e]),W=O.useCallback(()=>{S&&x&&i&&i(x),N&&g&&e.packet_hash&&g(e.packet_hash)},[S,x,i,N,g,e.packet_hash]),q=O.useCallback(()=>{i&&i(null),g&&g(null)},[i,g]),K=p[w]||p.zinc,X=u;return Q.jsxs("div",{onClick:V,onMouseEnter:W,onMouseLeave:q,className:G("group relative cursor-pointer","hover:bg-subtle-fill",b&&!u&&"opacity-40",r&&"flash-row",_&&"bg-sys-indigo/5",l&&"bg-sys-teal/10"),children:[Q.jsx("div",{className:G("absolute pointer-events-none transition-opacity duration-75",N?X?"opacity-100":"opacity-0":"opacity-0 group-hover:opacity-100"),style:(()=>{const e={pointerEvents:"none"};return"first"===h?{...e,borderTop:`2px solid ${K}`,borderLeft:`2px solid ${K}`,borderRight:`2px solid ${K}`,borderBottom:"none",borderRadius:"8px 8px 0 0",inset:"-2px -2px 0 -2px"}:"middle"===h?{...e,borderTop:"none",borderLeft:`2px solid ${K}`,borderRight:`2px solid ${K}`,borderBottom:"none",borderRadius:0,inset:"0 -2px"}:"last"===h?{...e,borderTop:"none",borderLeft:`2px solid ${K}`,borderRight:`2px solid ${K}`,borderBottom:`2px solid ${K}`,borderRadius:"0 0 8px 8px",inset:"0 -2px -2px -2px"}:{...e,border:`2px solid ${K}`,borderRadius:"8px",inset:"-2px"}})()}),Q.jsxs("div",{className:"relative flex items-center gap-2 min-[600px]:gap-3 px-2 py-2 min-[600px]:px-3 min-[600px]:py-2.5",children:[Q.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[Q.jsx("div",{className:"relative flex-shrink-0",children:A?Q.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-1 ring-edge-subtle",style:{backgroundColor:xe(me($).cleanName)},children:me($).emoji?Q.jsx("span",{className:"text-base leading-none",children:me($).emoji}):Q.jsx("span",{className:"text-white text-[10px] font-bold tracking-tighter",children:pe($)})}):E?Q.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-[1.5px] ring-sys-blue",children:Q.jsx(d,{className:"size-5 text-sys-blue"})}):U?Q.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-zinc-500/20 ring-1 ring-edge-subtle",children:Q.jsx(qe,{className:"size-4 text-fg-muted"})}):Q.jsx(ps,{packet:e,variant:"avatar",size:"sm"})}),Q.jsx("div",{className:"min-w-0",children:A?Q.jsxs(Q.Fragment,{children:[Q.jsx("div",{className:"font-semibold text-[13px] text-fg-primary font-sans truncate max-w-[90px]",children:$}),M&&Q.jsx("div",{className:"hidden min-[900px]:block text-[9px] text-fg-muted truncate",children:M})]}):E?Q.jsxs(Q.Fragment,{children:[Q.jsx("div",{className:"font-semibold text-[13px] text-fg-primary font-sans truncate max-w-[90px]",children:B}),M&&Q.jsx("div",{className:"hidden min-[900px]:block text-[9px] text-fg-muted truncate",children:M})]}):Q.jsxs(Q.Fragment,{children:[Q.jsx("div",{className:"font-bold text-[13px] text-fg-primary font-sans truncate",children:M||"—"}),B&&Q.jsx("div",{className:"hidden min-[900px]:block text-[9px] text-fg-muted truncate max-w-[70px]",children:B})]})})]}),Q.jsxs("div",{className:"flex-1 flex items-center gap-1 min-[600px]:gap-1.5 min-[900px]:gap-2 min-w-0",children:[Q.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:gs(w),children:v}),f&&f>1&&Q.jsxs("span",{className:"data-box data-box-compact flex-shrink-0",children:["×",f]}),Q.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:gs(C),children:k}),Q.jsxs("span",{className:"hidden min-[520px]:inline type-data-xs text-fg-muted flex-shrink-0",children:[I,"B"]}),Q.jsx("div",{className:"flex-1 min-w-0 overflow-hidden",children:L||z?Q.jsxs("span",{className:"text-[11px] text-fg-secondary truncate block flex items-center gap-1",children:[z&&Q.jsx(us,{channelName:z,compact:!0,onClick:j&&R?e=>{e.stopPropagation(),j(R)}:void 0}),L&&Q.jsx("span",{className:"italic truncate",children:L})]}):Q.jsx(hs,{path:T,localHash:t})})]}),Q.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[Q.jsx("span",{className:"data-box data-box-compact",children:o(e.timestamp)}),Q.jsx(je,{rssi:e.rssi,snr:e.snr,compact:!0,showValues:!0,validated:be(e)})]})]})]})}),Ns=O.memo(function({packet:e,onClick:s,localHash:t,neighbors:a,resolveSource:n,isFlashing:r=!1,isTraceHighlighted:l,traceTag:i,onViewTraceReport:x,dupeGroupPosition:m,isDupeGroupHovered:h=!1,onDupeGroupHover:u,dupeCount:g,getDecodedContent:f,onChannelClick:y}){const{payloadType:j,routeType:b,payloadColor:N,routeColor:v}=fs(e),k="tx_local"===e.packet_origin,w="TRACE"===j,C=!g&&c(e.is_duplicate),_=ys(e.original_path),S=ys(e.forwarded_path),H=S.length>0?S:_,P=e._hopCount??H.length,T=e.src_hash?(e.src_hash.startsWith("0x")?e.src_hash.slice(2,6):e.src_hash.slice(0,4)).toUpperCase():null,{name:M,isRepeater:B}=js(e,n);let F=null,L=null,D=null,z=null;if("GRP_TXT"===j&&f){const s=f(e);(null==s?void 0:s.decrypted)&&(L=s.senderName,D=s.channelName,z=s.channelHash,s.text&&(F=s.text))}else if("TXT_MSG"===j&&e.raw_packet)try{const s=he.fromHex(e.raw_packet);if(s.success&&s.packet){const e=ue(s.packet.payload);e&&!e.encrypted&&(F=e.text)}}catch{}const R=L||(B?null:M),$=!!R,A=!$&&B&&!!M,E=!$&&!A&&"GRP_TXT"===j&&!F,U=e.payload_length??e.length??0,I=e.lbt_attempts??0,V=p[N]||p.zinc;return Q.jsxs("div",{onClick:()=>{w&&i&&x?x(i):s(e)},className:G("relative pl-3 pr-2.5 py-2 cursor-pointer","active:bg-subtle-fill-hover",C&&"opacity-40",r&&"flash-row",k&&"bg-sys-indigo/5",l&&"bg-sys-teal/10"),children:[Q.jsx("div",{className:"absolute left-0 transition-all",style:(()=>{if(!m)return{opacity:0};const e=h?1:.4,s=h?"3px":"2px";return"first"===m?{backgroundColor:V,opacity:e,width:s,top:"6px",bottom:0,borderRadius:"0 9999px 0 0"}:"middle"===m?{backgroundColor:V,opacity:e,width:s,top:0,bottom:0,borderRadius:0}:"last"===m?{backgroundColor:V,opacity:e,width:s,top:0,bottom:"6px",borderRadius:"0 0 9999px 0"}:{backgroundColor:V,opacity:e,width:s,top:"6px",bottom:"6px",borderRadius:"9999px"}})()}),Q.jsxs("div",{className:"flex items-start gap-2",children:[Q.jsx("div",{className:"relative flex-shrink-0 mt-0.5",children:$?Q.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-1 ring-edge-subtle",style:{backgroundColor:xe(me(R).cleanName)},children:me(R).emoji?Q.jsx("span",{className:"text-base leading-none",children:me(R).emoji}):Q.jsx("span",{className:"text-white text-[10px] font-bold tracking-tighter",children:pe(R)})}):A?Q.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-[1.5px] ring-sys-blue",children:Q.jsx(d,{className:"size-5 text-sys-blue"})}):E?Q.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-zinc-500/20 ring-1 ring-edge-subtle",children:Q.jsx(qe,{className:"size-4 text-fg-muted"})}):Q.jsx(ps,{packet:e,variant:"avatar",size:"sm"})}),Q.jsxs("div",{className:"flex-1 min-w-0 space-y-0.5",children:[Q.jsxs("div",{className:"flex items-center gap-1.5",children:[$?Q.jsx("span",{className:"font-medium text-[14px] text-fg-primary tracking-tight truncate min-w-0",children:R}):A?Q.jsx("span",{className:"font-medium text-[14px] text-fg-primary tracking-tight truncate min-w-0",children:M}):Q.jsxs(Q.Fragment,{children:[Q.jsx("span",{className:"font-semibold text-[14px] text-fg-primary tracking-tight flex-shrink-0",children:T||"—"}),M&&Q.jsx("span",{className:"text-[12px] text-fg-muted truncate min-w-0",children:M})]}),Q.jsx("div",{className:"flex-1"}),Q.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:gs(N),children:j}),Q.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:gs(v),children:b}),g&&g>1&&Q.jsxs("span",{className:"data-box data-box-compact flex-shrink-0",children:["×",g]}),Q.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[Q.jsx("span",{className:"type-data-xs text-fg-muted w-[28px] text-right",children:e.rssi}),Q.jsx(je,{rssi:e.rssi,compact:!0,showValues:!1,validated:be(e)})]})]}),Q.jsxs("div",{className:"flex items-center gap-1 type-data-xs text-fg-muted",children:[Q.jsx("span",{className:"data-box data-box-compact flex-shrink-0",children:o(e.timestamp)}),U>0&&Q.jsxs("span",{children:[U,"B"]}),I>0&&Q.jsxs("span",{className:I>1?"text-sys-amber/60":void 0,children:["LBT:",I]}),null!=e.snr&&Q.jsxs("span",{children:[e.snr.toFixed(0),"dB"]}),F||D?Q.jsxs("span",{className:"text-[11px] text-fg-secondary truncate flex items-center gap-1 min-w-0",children:[D&&Q.jsx(us,{channelName:D,compact:!0,onClick:y&&z?e=>{e.stopPropagation(),y(z)}:void 0}),F&&Q.jsx("span",{className:"italic truncate",children:F})]}):P>0?Q.jsx(hs,{path:H,localHash:t}):null]})]})]})]})}),vs=O.lazy(()=>W(()=>import("./PathMapMapLibre-Vou6UMwb.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])));function ks(e){return`${(100*e).toFixed(0)}%`}function ws(e,s,t){let a;return a=0===s?t.muted:e>=1?t.success:e>=.5?t.secondary:e>=.25?t.poor:e>0?t.danger:t.muted,{color:a}}class Cs extends O.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?Q.jsxs("div",{className:"h-[200px] flex items-center justify-center text-fg-muted",children:[Q.jsx(Me,{className:"w-4 h-4 mr-2"}),"Map failed to load"]}):this.props.children}}function _s({path:e,neighbors:s,localNode:t,localHash:a,srcHash:n,dstHash:r,neighborAffinity:l,prefixLookup:i,hubNodes:c,traceSnr:d,advertiserSource:o}){const[x,m]=O.useState(null),p=O.useMemo(()=>{if(!o)return null;const e="wardrive"===o.nodeType;return{prefix:o.prefix||"??",candidates:[{hash:o.publicKey||o.prefix||"source",name:o.name,latitude:o.latitude,longitude:o.longitude,probability:1,isLocal:!1,isWardrive:e}],confidence:1,totalMatches:1,isSource:!0}},[o]),g=O.useMemo(()=>{if(o)return null;if(!n)return null;const e=u(n),t=s[n];if((null==t?void 0:t.latitude)&&(null==t?void 0:t.longitude)&&(0!==t.latitude||0!==t.longitude))return{prefix:e,candidates:[{hash:n,name:t.node_name||t.name||"Source",latitude:t.latitude,longitude:t.longitude,probability:1,isLocal:!1,isDirectNeighbor:!0===t.zero_hop}],confidence:1,totalMatches:1,isSource:!0};const a=(null==t?void 0:t.node_name)||(null==t?void 0:t.name)||n.slice(0,8);return{prefix:e,candidates:[{hash:n,name:a,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isSource:!0}},[o,n,s]),f=O.useMemo(()=>{const e=(null==r?void 0:r.startsWith("0x"))?r.slice(2):r;if((!e||"00"===e||"0000000000000000"===e)&&t&&a){const e=u(a),s=0!==t.latitude||0!==t.longitude;return{prefix:e,candidates:[{hash:a,name:t.name||"Local Node",latitude:s?t.latitude:0,longitude:s?t.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}if(!r)return null;const n=u(r);if(a&&r===a&&t){const e=0!==t.latitude||0!==t.longitude;return{prefix:n,candidates:[{hash:r,name:t.name||"Local Node",latitude:e?t.latitude:0,longitude:e?t.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}const l=s[r];if((null==l?void 0:l.latitude)&&(null==l?void 0:l.longitude)&&(0!==l.latitude||0!==l.longitude))return{prefix:n,candidates:[{hash:r,name:l.node_name||l.name||"Destination",latitude:l.latitude,longitude:l.longitude,probability:1,isLocal:!1,isDirectNeighbor:!0===l.zero_hop}],confidence:1,totalMatches:1,isDestination:!0};const i=(null==l?void 0:l.node_name)||(null==l?void 0:l.name)||r.slice(0,8);return{prefix:n,candidates:[{hash:r,name:i,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isDestination:!0}},[r,s,t,a]),y=O.useMemo(()=>function(e,s,t,a,n,r){if(!e||0===e.length)return{hops:[],overallConfidence:0,hasValidPath:!1};const l=e.length-1,i=e.map((i,c)=>{const d=c===l,o=e.length-c,{candidates:x,totalMatches:m}=function(e,s,t,a,n=!1,r,l,i){const c=Se(s);let d;l&&(d=He(l,e,{position:i,isLastHop:n}).confidence);const{matches:o,probability:x}=function(e,s,t,a,n=!1){const r=e.toUpperCase(),l=[],i=t&&h(r,t);i&&l.push(t);for(const p of Object.keys(s))h(r,p)&&l.push(p);if(n&&i&&t&&1===l.length)return{matches:l,probability:1,bestMatch:t};if(n&&i&&l.length>1){const e=l.filter(e=>e!==t);if(1===e.length)return{matches:l,probability:1,bestMatch:e[0]}}const c=l.length>0?1/l.length:0,d=[...l].sort();let o=null,x=-1;if(1===d.length)o=d[0];else if(d.length>1&&a){for(const e of d){const s=a.get(e),t=s?"number"==typeof s?s:s.combinedScore:0;t>x&&(x=t,o=e)}o||(o=d[0])}else d.length>0&&(o=d[0]);let m=c;if(l.length>1&&a&&x>0){let e=0;for(const s of l){const t=a.get(s);e+=t?"number"==typeof t?t:t.combinedScore:0}e>0&&(m=Math.min(.95,x/e))}return{matches:l,probability:m,bestMatch:o}}(e,c,a,r,n),m=o.length,p=[],u=e.toUpperCase(),g=t&&void 0!==t.latitude&&void 0!==t.longitude&&(0!==t.latitude||0!==t.longitude);for(const y of o){if(a&&h(u,a)&&y===a&&g&&t){p.push({hash:y,name:t.name||"Local Node",latitude:t.latitude,longitude:t.longitude,probability:n?1:x,isLocal:!0});continue}const e=c[y];(null==e?void 0:e.latitude)&&(null==e?void 0:e.longitude)&&(0!==e.latitude||0!==e.longitude)&&p.push({hash:y,name:e.node_name||e.name||"Unknown",latitude:e.latitude,longitude:e.longitude,probability:x,isLocal:!1,isDirectNeighbor:!0===e.zero_hop})}const f=p.length;if(1===f)p[0].probability=d??1;else if(f>1)if(void 0!==d&&d>0){p[0].probability=d;const e=1-d,s=f-1;p.slice(1).forEach(t=>{t.probability=e/s})}else{let e=0;const s=p.map(s=>{if(s.isLocal)return{candidate:s,score:1};const a=null==r?void 0:r.get(s.hash);let n=.5;var l;let i;return g&&t&&(n=(l=function(e,s,t,a){const n=(t-e)*Math.PI/180,r=(a-s)*Math.PI/180,l=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(t*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3}(t.latitude,t.longitude,s.latitude,s.longitude))<100?1:l<500?.9:l<1e3?.7:l<5e3?.5:l<1e4?.3:.1),a?i=.3*n+.3*a.hopConsistencyScore+.4*a.frequencyScore:(i=n,s.isDirectNeighbor&&(i=Math.max(i,.8))),e+=i,{candidate:s,score:i}});if(e>0)s.forEach(({candidate:s,score:t})=>{s.probability=Math.min(.95,t/e)});else{const e=1/f;p.forEach(s=>s.probability=e)}}return{candidates:p,totalMatches:m}}(i,s,t,a,d,n,r,o),p=x.length>0?Math.max(...x.map(e=>e.probability)):0;return{prefix:i,candidates:x,confidence:p,totalMatches:m}}),c=i.reduce((e,s)=>0===s.confidence?0:e*s.confidence,1),d=i.some(e=>e.candidates.length>0);return{hops:i,overallConfidence:c,hasValidPath:d}}(e,s,t,a,l,i),[e,s,t,a,l,i]),j=O.useMemo(()=>{const e=[];p?e.push(p):g&&e.push(g),e.push(...y.hops),f&&e.push(f);const s=e.reduce((e,s)=>0===s.confidence?0:e*s.confidence,1),t=e.some(e=>e.candidates.some(e=>0!==e.latitude||0!==e.longitude));return{hops:e,overallConfidence:s,hasValidPath:t}},[p,g,y,f]),b=O.useMemo(()=>{const e=getComputedStyle(document.documentElement);return{success:e.getPropertyValue("--sys-green").trim()||"#39D98A",secondary:e.getPropertyValue("--sys-indigo").trim()||"#F9D26F",poor:e.getPropertyValue("--signal-poor").trim()||"#FF8A5C",danger:e.getPropertyValue("--sys-red").trim()||"#FF5C7A",muted:e.getPropertyValue("--text-muted").trim()||"#767688"}},[]);return j.hasValidPath?Q.jsxs("div",{className:"h-full flex flex-col space-y-2",children:[Q.jsxs("div",{className:"flex items-center justify-between text-xs",children:[Q.jsxs("div",{className:"flex items-center gap-1.5",children:[Q.jsx("span",{className:"text-fg-muted",children:"Path Confidence:"}),Q.jsx("span",{className:(N=j.overallConfidence,N>=1?"text-sys-green":N>=.5?"text-sys-indigo":N>=.25?"text-signal-poor":N>0?"text-sys-red":"text-fg-muted"),children:ks(j.overallConfidence)}),Q.jsx("button",{className:"text-fg-muted hover:text-fg-secondary transition-colors",title:"Confidence is calculated based on how many known nodes match each path prefix. Multiple matches reduce confidence due to collision probability.",children:Q.jsx(Te,{className:"w-3 h-3"})})]}),Q.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[Q.jsxs("div",{className:"flex items-center gap-1",children:[Q.jsx("div",{className:"w-2 h-2 rounded-full bg-sys-green"}),Q.jsx("span",{className:"text-fg-muted",children:"Exact"})]}),Q.jsxs("div",{className:"flex items-center gap-1",children:[Q.jsx("div",{className:"w-2 h-2 rounded-full bg-sys-indigo"}),Q.jsx("span",{className:"text-fg-muted",children:"Multi"})]}),Q.jsxs("div",{className:"flex items-center gap-1",children:[Q.jsx("div",{className:"w-2 h-2 rounded-full bg-fg-muted"}),Q.jsx("span",{className:"text-fg-muted",children:"Unknown"})]})]})]}),Q.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:Q.jsx(Cs,{children:Q.jsx(O.Suspense,{fallback:Q.jsx("div",{className:"h-full bg-elevated flex items-center justify-center text-fg-muted text-sm",children:"Loading map..."}),children:Q.jsx(vs,{resolvedPath:j,localNode:t,hubNodes:c,hoveredHopIndex:x,onHoverHop:m,traceSnr:d})})})}),Q.jsx("div",{className:"flex flex-wrap items-center gap-1.5",children:j.hops.map((e,s)=>{var t,a,n;const r=!0===e.isSource,l=!0===e.isDestination,i=x===s;let c;return c=r?`Source: ${(null==(t=e.candidates[0])?void 0:t.name)||"Unknown"}`:l?`Destination: ${(null==(a=e.candidates[0])?void 0:a.name)||"Unknown"}`:0===e.totalMatches?"No matching nodes found":1===e.totalMatches?`Exact match: ${(null==(n=e.candidates[0])?void 0:n.name)||"Unknown"}`:`${e.totalMatches} possible matches (${(100*e.confidence).toFixed(0)}% confidence)`,Q.jsxs("div",{className:G("flex items-center gap-1 px-1.5 py-0.5 rounded type-data-xs cursor-pointer transition-all",i?"bg-sys-blue/20 ring-1 ring-sys-blue/50":"bg-elevated hover:bg-subtle",r&&"border border-sys-green/30",l&&"border border-sys-blue/30"),title:c,onMouseEnter:()=>m(s),onMouseLeave:()=>m(null),children:[r&&Q.jsx("span",{className:"text-sys-green text-[8px] mr-0.5",children:"SRC"}),l&&Q.jsx("span",{className:"text-sys-blue text-[8px] mr-0.5",children:"DST"}),Q.jsx("span",{style:ws(e.confidence,e.totalMatches,b),children:e.prefix}),!r&&!l&&e.totalMatches>1&&Q.jsxs("span",{className:"text-fg-muted",children:["×",e.totalMatches]}),!r&&!l&&0===e.totalMatches&&Q.jsx("span",{className:"text-fg-muted",children:"?"})]},s)})})]}):Q.jsxs("div",{className:"flex items-center justify-center text-fg-muted text-xs py-4",children:[Q.jsx(Pe,{className:"w-3.5 h-3.5 mr-1.5 opacity-50"}),"No location data available for path nodes"]});var N}function Ss(e){return e.match(/.{1,2}/g)||[]}function Hs(e){return null!==e&&e.startsWith("payload:")}const Ps=15,Ts="color-mix(in srgb, var(--elevated) 60%, var(--body))",Ms="\n    inset 0 0 0 1px color-mix(in srgb, var(--fg-primary) 6%, transparent),\n    inset 0 1px 0 color-mix(in srgb, white 3%, transparent),\n    0 1px 2px color-mix(in srgb, black 5%, transparent)\n  ",Bs=2,Fs={type:"tween",duration:.25,ease:[.25,.1,.25,1]};function Ls(e,s){return e?`inset 0 0 0 ${Bs}px ${p[s]}`:Ms}function Ds(e,s){return e?s:`color-mix(in srgb, ${s} ${Ps}%, transparent)`}function zs({segments:e,selectedSegment:s,onSegmentClick:t}){const[a,n]=O.useState(null),[r,l]=O.useState(null),i=e.some(e=>void 0!==e.id)&&t,c=[];for(const o of e){const e=Ss(o.hex);for(const s of e)c.push({byte:s.toUpperCase(),color:o.color,id:o.id})}const d=[];for(let o=0;o<c.length;o+=16)d.push(c.slice(o,o+16));return Q.jsx("div",{className:"space-y-1",children:d.map((e,c)=>{const d=e.length<16;return Q.jsx("div",{className:"flex rounded-md overflow-hidden",children:e.map(({byte:c,color:o,id:x},m)=>{const h=m===e.length-1,u=d&&h,g=p[o],f=x?a===x:r===o,y=Boolean(x&&s===x),j=f||y;return Q.jsx("span",{className:"w-[1.75rem] text-xs text-center py-0.5 font-mono select-text "+(i?"cursor-pointer":""),style:{backgroundColor:Ds(j,g),color:j?"rgba(255,255,255,0.95)":g,transition:j?"none":"background-color 0.15s ease-out, color 0.15s ease-out",touchAction:"manipulation",...u?{borderRadius:"0 0.375rem 0.375rem 0"}:{}},onMouseEnter:()=>{x?n(x):l(o)},onMouseLeave:()=>{n(null),l(null)},onClick:()=>x&&(null==t?void 0:t(x)),onTouchStart:()=>{x?n(x):l(o)},onTouchEnd:()=>{n(null),l(null)},children:c},m)})},c)})})}function Rs({rawHex:e,hexSegments:s,selectedSegment:t,onSegmentClick:a}){const[n,r]=O.useState(!1),i=O.useCallback(async()=>{try{await navigator.clipboard.writeText(e.toUpperCase()),r(!0),setTimeout(()=>r(!1),2e3)}catch(s){}},[e]);return Q.jsxs("div",{className:"bg-black rounded-2xl p-6 relative",children:[Q.jsx(zs,{segments:s,selectedSegment:t,onSegmentClick:a}),Q.jsx("button",{onClick:i,className:"absolute bottom-3 right-3 flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg bg-subtle-fill-hover hover:bg-subtle-fill-strong text-fg-muted hover:text-fg-secondary transition-all text-xs font-sans",title:"Copy raw packet hex",children:n?Q.jsxs(Q.Fragment,{children:[Q.jsx(b,{className:"w-3.5 h-3.5 text-sys-green"}),Q.jsx("span",{className:"text-sys-green",children:"Copied"})]}):Q.jsxs(Q.Fragment,{children:[Q.jsx(l,{className:"w-3.5 h-3.5"}),Q.jsx("span",{children:"Copy"})]})})]})}function $s({bits:e,field:s,value:t,binary:a}){return Q.jsxs("tr",{children:[Q.jsx("td",{className:"py-1.5 text-xs text-fg-muted tabular-nums",children:e}),Q.jsx("td",{className:"py-1.5 text-sm text-fg-secondary",children:s}),Q.jsx("td",{className:"py-1.5",children:(()=>{if("Payload Type"===s){const e=de[t]||"zinc";return Q.jsx(i,{color:e,children:t})}if("Route Type"===s){const e=ce[t]||"zinc";return Q.jsx(i,{color:e,children:t})}return Q.jsx("span",{className:"text-sm text-fg-primary",children:t})})()}),Q.jsx("td",{className:"py-1.5 type-data-xs text-sys-cyan",children:a})]})}function As({id:e,title:s,color:t,hexBytes:a,startByte:n,endByte:r,isSelected:l,children:c}){const d=a?Ss(a):[];return Q.jsxs(y.div,{layout:"position",layoutId:e,transition:Fs,className:"w-full min-w-0 overflow-hidden rounded-xl p-4 sm:p-5 space-y-4",style:{backgroundColor:Ts,boxShadow:Ls(l,t)},children:[Q.jsxs("div",{className:"flex items-start justify-between gap-4",children:[Q.jsxs("div",{className:"flex flex-wrap items-center gap-0.5 min-w-0",children:[Q.jsx(i,{color:t,children:s}),d.length>0&&d.length<=16&&d.map((e,s)=>Q.jsx(i,{color:t,className:"font-mono",children:e.toUpperCase()},s))]}),Q.jsxs("span",{className:"type-data-xs text-fg-muted flex-shrink-0",children:["Bytes ",n,"-",r]})]}),Q.jsx("div",{className:"min-w-0 overflow-hidden",children:c})]})}function Es({advert:e,timestamp:s}){const t=v(s||e.timestamp);return Q.jsx("div",{className:"mb-4",children:Q.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-indigo/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[Q.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[Q.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-indigo) 0%, var(--sys-blue) 100%)"},children:Q.jsx(d,{className:"w-6 h-6 text-white"})}),Q.jsxs("div",{className:"flex-1 min-w-0",children:[Q.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:e.name||"Unknown Node"}),Q.jsx("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:e.nodeType})]})]}),Q.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),Q.jsxs("div",{className:"px-4 py-3 space-y-2",children:[void 0!==e.latitude&&void 0!==e.longitude&&Q.jsxs("div",{className:"flex items-center gap-3",children:[Q.jsx(Pe,{className:"w-4 h-4 text-sys-indigo flex-shrink-0"}),Q.jsxs("span",{className:"text-sm text-fg-secondary font-mono",children:[e.latitude.toFixed(5),"°, ",e.longitude.toFixed(5),"°"]})]}),Q.jsxs("div",{className:"flex items-center gap-3",children:[Q.jsx(Ne,{className:"w-4 h-4 text-sys-indigo flex-shrink-0"}),Q.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:t})]})]})]})})}function Us({decoded:e,timestamp:s}){const t=s?v(s):"Unknown";return Q.jsx("div",{className:"mb-4",children:Q.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-teal/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[Q.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[Q.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-teal) 0%, var(--sys-cyan) 100%)"},children:Q.jsx(Re,{className:"w-6 h-6 text-white"})}),Q.jsxs("div",{className:"flex-1 min-w-0",children:[Q.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:e.channelName||"Channel Data"}),Q.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:[e.dataLength," bytes • ",e.decrypted?"Decrypted":"Encrypted"]})]})]}),Q.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),Q.jsxs("div",{className:"px-4 py-3 space-y-2",children:[Q.jsxs("div",{className:"flex items-center gap-3",children:[Q.jsx(Le,{className:"w-4 h-4 text-sys-teal flex-shrink-0"}),Q.jsxs("span",{className:"text-sm text-fg-secondary font-sans",children:["Channel: ",Q.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]})]}),Q.jsxs("div",{className:"flex items-center gap-3",children:[Q.jsx(Ne,{className:"w-4 h-4 text-sys-teal flex-shrink-0"}),Q.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:t})]}),e.decrypted&&e.decryptedHex&&Q.jsxs("div",{className:"mt-2 pt-2 border-t border-edge-subtle",children:[Q.jsx("p",{className:"type-micro text-fg-muted mb-1 font-sans",children:"Decrypted Data"}),Q.jsx("div",{className:"max-w-full overflow-x-auto",children:Q.jsx(Be,{size:"compact",copy:!0,className:"inline-block",children:Q.jsx("span",{className:"break-all text-xs",children:e.decryptedHex.toUpperCase()})})})]})]})]})})}function Is({decoded:e,timestamp:s,isLoading:t=!1,onDecrypted:a}){const n=s?v(s):"Unknown",[r,l]=O.useState(""),[i,c]=O.useState(!1),[d,o]=O.useState(null),[x,m]=O.useState(!1),p=O.useCallback(async()=>{if(r.trim()&&e.ciphertextHex&&e.macHex){c(!0),o(null);try{const s=parseInt(e.channelHash,16),t=k(e.macHex),n=k(e.ciphertextHex),i=await w(r.trim(),s,t,n);if(i.success){const s=i.result.plaintext,t=new TextDecoder("utf-8",{fatal:!1}).decode(s.slice(5)),n=t.indexOf(": "),r={...e,channelName:i.result.channelName,decrypted:!0,timestamp:s[0]|s[1]<<8|s[2]<<16|s[3]<<24,flags:s[4],senderName:n>0?t.slice(0,n):void 0,text:n>0?t.slice(n+2):t};null==a||a(r),l(""),m(!1)}else o(i.error)}catch(s){o(s instanceof Error?s.message:"Unknown error")}finally{c(!1)}}},[r,e,a]);return t?Q.jsx("div",{className:"mb-4",children:Q.jsxs("div",{className:"rounded-xl p-4 sm:p-5",style:{backgroundColor:"color-mix(in srgb, var(--elevated) 60%, var(--body))",boxShadow:"\n              inset 0 0 0 1px color-mix(in srgb, var(--fg-primary) 6%, transparent),\n              inset 0 1px 0 color-mix(in srgb, white 3%, transparent),\n              0 1px 2px color-mix(in srgb, black 5%, transparent)\n            "},children:[Q.jsxs("div",{className:"flex items-center gap-2 mb-3 h-[15px]",children:[Q.jsx("div",{className:"h-2.5 w-12 rounded bg-subtle-fill-hover animate-pulse"}),Q.jsx("div",{className:"h-2.5 w-16 rounded bg-subtle-fill-hover animate-pulse"})]}),Q.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tl-md",style:{background:"color-mix(in srgb, var(--sys-blue) 30%, transparent)"},children:Q.jsxs("div",{className:"space-y-1.5",children:[Q.jsx("div",{className:"h-3.5 w-48 rounded bg-subtle-fill-strong animate-pulse"}),Q.jsx("div",{className:"h-3.5 w-32 rounded bg-subtle-fill-strong animate-pulse"})]})})]})}):e.decrypted?Q.jsx("div",{className:"mb-4",children:Q.jsxs("div",{className:"rounded-xl p-4 sm:p-5",style:{backgroundColor:"color-mix(in srgb, var(--elevated) 60%, var(--body))",boxShadow:"\n              inset 0 0 0 1px color-mix(in srgb, var(--fg-primary) 6%, transparent),\n              inset 0 1px 0 color-mix(in srgb, white 3%, transparent),\n              0 1px 2px color-mix(in srgb, black 5%, transparent)\n            "},children:[Q.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.senderName&&Q.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:["From ",Q.jsx("span",{className:"text-fg-secondary font-medium",children:e.senderName})]}),e.channelName&&Q.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:["in ",Q.jsx("span",{className:"text-sys-cyan font-medium",children:e.channelName})]})]}),Q.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tl-md",style:{background:"linear-gradient(135deg, var(--sys-blue) 0%, color-mix(in srgb, var(--sys-blue) 85%, var(--sys-cyan)) 100%)"},children:Q.jsx("p",{className:"text-sm text-white font-sans leading-relaxed whitespace-pre-wrap break-words",children:e.text})})]})}):Q.jsx("div",{className:"mb-4",children:Q.jsxs("div",{className:"rounded-2xl overflow-hidden bg-zinc-500/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[Q.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[Q.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--zinc-500) 0%, color-mix(in srgb, var(--zinc-500) 70%, black) 100%)"},children:Q.jsx(We,{className:"w-6 h-6 text-white"})}),Q.jsxs("div",{className:"flex-1 min-w-0",children:[Q.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:e.isPublicHashChannel?"Public Hash Channel":"Encrypted Message"}),Q.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:["Channel hash: ",Q.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]})]})]}),Q.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),Q.jsxs("div",{className:"px-4 py-3 space-y-3",children:[Q.jsxs("div",{className:"flex items-center gap-3",children:[Q.jsx(Ne,{className:"w-4 h-4 text-zinc-400 flex-shrink-0"}),Q.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:n})]}),e.ciphertextHex&&e.macHex&&Q.jsx("div",{className:"space-y-2",children:x?Q.jsxs("div",{className:"space-y-2",children:[Q.jsxs("div",{className:"flex gap-2",children:[Q.jsx("input",{type:"text",value:r,onChange:e=>l(e.target.value),placeholder:"Channel name (e.g. south-bay)",className:"flex-1 px-3 py-1.5 text-sm rounded-lg bg-subtle-fill-strong border border-edge-subtle text-fg-primary placeholder:text-fg-muted focus:outline-none focus:border-zinc-500",onKeyDown:e=>"Enter"===e.key&&p(),disabled:i}),Q.jsx("button",{onClick:p,disabled:i||!r.trim(),className:"px-3 py-1.5 text-sm font-medium rounded-lg bg-zinc-600 hover:bg-zinc-500 text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:i?"Testing...":"Try"}),Q.jsx("button",{onClick:()=>{m(!1),o(null),l("")},className:"px-2 py-1.5 text-sm rounded-lg hover:bg-subtle-fill-strong text-fg-muted transition-colors",children:"×"})]}),d&&Q.jsx("p",{className:"text-xs text-sys-red",children:d})]}):Q.jsx("button",{onClick:()=>m(!0),className:"text-xs text-zinc-400 hover:text-zinc-300 underline underline-offset-2 transition-colors",children:"Know the channel name? Try to decrypt"})}),!x&&Q.jsx("p",{className:"text-xs text-fg-muted",children:e.isPublicHashChannel?"Public hash channel message. Key not in common channel list.":"Unknown hash channel. Channel name required for decryption."})]})]})})}function Vs({decoded:e,timestamp:s}){const t=s?v(s):"Unknown";return Q.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[Q.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:"linear-gradient(135deg, var(--sys-green) 0%, var(--sys-teal) 100%)"},children:Q.jsx(ze,{className:"w-5 h-5 text-white"})}),Q.jsxs("div",{className:"flex-1",children:[Q.jsx("p",{className:"text-sm font-semibold text-fg-primary font-sans",children:"Acknowledgment"}),Q.jsxs("p",{className:"text-xs text-fg-muted font-sans mt-0.5",children:["CRC: ",Q.jsxs("span",{className:"font-mono text-sys-green",children:["0x",e.crc]})," · ",t]})]})]})}function Qs({decoded:e,timestamp:s}){const t=s?v(s):"Unknown",a=e.path.length;return Q.jsx("div",{className:"mb-4",children:Q.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-amber/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[Q.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[Q.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-amber) 0%, var(--sys-orange) 100%)"},children:Q.jsx(Xe,{className:"w-6 h-6 text-white"})}),Q.jsxs("div",{className:"flex-1 min-w-0",children:[Q.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:"Path Response"}),Q.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:[a," ",1===a?"hop":"hops"]})]})]}),Q.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),Q.jsxs("div",{className:"px-4 py-3 space-y-2",children:[Q.jsxs("div",{className:"flex items-center gap-3",children:[Q.jsx(Ne,{className:"w-4 h-4 text-sys-amber flex-shrink-0"}),Q.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:t})]}),e.path.length>0&&Q.jsx("div",{className:"mt-2 pt-2 border-t border-edge-subtle",children:Q.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.path.map((e,s)=>Q.jsxs("div",{className:"flex items-center gap-2",children:[s>0&&Q.jsx(ye,{className:"w-4 h-4 text-sys-amber"}),Q.jsx(i,{color:"amber",className:"font-mono",children:e})]},s))})})]})]})})}function Gs({decoded:e,timestamp:s}){const t=s?v(s):"Unknown",a=e.pathHashes.length,n=e.snrValues.length;return Q.jsx("div",{className:"mb-4",children:Q.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-blue/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[Q.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[Q.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-blue) 0%, var(--sys-indigo) 100%)"},children:Q.jsx(De,{className:"w-6 h-6 text-white"})}),Q.jsxs("div",{className:"flex-1 min-w-0",children:[Q.jsxs("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:["Trace ",e.isComplete?"Complete":"In Progress"]}),Q.jsxs("p",{className:"text-sm text-fg-muted mt-0.5",children:["Tag: 0x",e.traceTag.slice(0,8),e.isComplete&&" • ✓"]})]})]}),Q.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),Q.jsxs("div",{className:"px-4 py-3 space-y-3",children:[Q.jsxs("div",{className:"flex items-center gap-3",children:[Q.jsx(Ne,{className:"w-4 h-4 text-sys-blue flex-shrink-0"}),Q.jsx("span",{className:"text-sm text-fg-secondary",children:t})]}),Q.jsxs("div",{className:"flex items-center gap-4 text-xs text-fg-muted",children:[Q.jsxs("span",{children:[a," target ",1===a?"hop":"hops"]}),Q.jsx("span",{children:"•"}),Q.jsxs("span",{children:[n," SNR ",1===n?"sample":"samples"]}),0!==e.authCode&&Q.jsxs(Q.Fragment,{children:[Q.jsx("span",{children:"•"}),Q.jsxs("span",{children:["Auth: ",e.authCode]})]})]}),e.pathHashes.length>0&&Q.jsx("div",{className:"flex flex-wrap items-center gap-2 pt-1",children:e.pathHashes.map((s,t)=>{const a=e.snrValues[t],n=void 0!==a?(e=>e>=7?"green":e>=0?"yellow":e>=-5?"orange":"red")(a):"zinc",r=void 0!==a;return Q.jsxs("div",{className:"flex items-center gap-2",children:[t>0&&Q.jsx(ye,{className:"w-4 h-4 text-sys-blue flex-shrink-0"}),Q.jsxs("div",{className:"flex items-center gap-1",children:[Q.jsx(i,{color:r?"blue":"zinc",className:"font-mono",children:s}),r&&Q.jsxs(i,{color:n,className:"font-mono",children:[a>=0?"+":"",Number.isInteger(a)?a:a.toFixed(1),"dB"]})]})]},t)})})]})]})})}function Os({decoded:e,timestamp:s}){const t=s?v(s):"Unknown";return e.encrypted?Q.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[Q.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:"linear-gradient(135deg, var(--sys-indigo) 0%, var(--sys-blue) 100%)"},children:Q.jsx(We,{className:"w-5 h-5 text-white"})}),Q.jsxs("div",{className:"flex-1",children:[Q.jsx("p",{className:"text-sm font-semibold text-fg-primary font-sans",children:"Encrypted Message"}),Q.jsxs("p",{className:"text-xs text-fg-muted font-sans mt-0.5",children:[e.srcHash," → ",e.destHash," · ",t]})]})]}):Q.jsxs("div",{className:"mb-4",children:[Q.jsxs("div",{className:"flex items-center gap-2 mb-1.5 px-1",children:[Q.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:[Q.jsx("span",{className:"font-mono text-fg-secondary",children:e.srcHash})," → ",Q.jsx("span",{className:"font-mono text-fg-secondary",children:e.destHash})]}),Q.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:["· ",t]})]}),Q.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tr-md ml-auto",style:{background:"linear-gradient(135deg, var(--sys-green) 0%, var(--sys-teal) 100%)"},children:Q.jsx("p",{className:"text-sm text-white font-sans leading-relaxed whitespace-pre-wrap break-words",children:e.text})})]})}function Ws({decoded:e,timestamp:s}){const t=s?v(s):"Unknown",a=(e.partNumber+1)/e.totalParts*100;return Q.jsx("div",{className:"mb-4",children:Q.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-yellow/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[Q.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[Q.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-yellow) 0%, var(--sys-amber) 100%)"},children:Q.jsx(Fe,{className:"w-6 h-6 text-white"})}),Q.jsxs("div",{className:"flex-1 min-w-0",children:[Q.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:"Multipart Segment"}),Q.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:["Part ",e.partNumber+1," of ",e.totalParts]})]})]}),Q.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),Q.jsxs("div",{className:"px-4 py-3 space-y-3",children:[Q.jsx("div",{children:Q.jsx("div",{className:"h-2 bg-subtle-fill-strong rounded-full overflow-hidden",children:Q.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${a}%`,background:"linear-gradient(90deg, var(--sys-yellow), var(--sys-amber))"}})})}),Q.jsxs("div",{className:"flex items-center gap-3",children:[Q.jsx(Le,{className:"w-4 h-4 text-sys-yellow flex-shrink-0"}),Q.jsxs("span",{className:"text-sm text-fg-secondary font-sans",children:["Message ID: ",Q.jsx("span",{className:"font-mono",children:e.messageId})]})]}),Q.jsxs("div",{className:"flex items-center gap-3",children:[Q.jsx(Ne,{className:"w-4 h-4 text-sys-yellow flex-shrink-0"}),Q.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:t})]})]})]})})}function qs({decoded:e,timestamp:s,payloadType:t}){const a=s?v(s):"Unknown",n=(()=>{switch(t){case j.REQ:return{icon:C,gradient:"var(--sys-orange), var(--sys-red)",bg:"rgba(249, 115, 22, 0.15)",label:"Request"};case j.RESPONSE:return{icon:Ke,gradient:"var(--sys-green), var(--sys-teal)",bg:"rgba(34, 197, 94, 0.15)",label:"Response"};case j.ANON_REQ:return{icon:We,gradient:"var(--sys-indigo), var(--sys-pink)",bg:"rgba(91, 91, 214, 0.15)",label:"Anonymous Request"};default:return{icon:ve,gradient:"var(--sys-gray), var(--sys-slate)",bg:"rgba(107, 114, 128, 0.15)",label:e.payloadTypeName}}})(),r=n.icon;return Q.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[Q.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:`linear-gradient(135deg, ${n.gradient})`},children:Q.jsx(r,{className:"w-5 h-5 text-white"})}),Q.jsxs("div",{className:"flex-1",children:[Q.jsx("p",{className:"text-sm font-semibold text-fg-primary font-sans",children:n.label}),Q.jsxs("p",{className:"text-xs text-fg-muted font-sans mt-0.5",children:[e.length," bytes · ",a]})]})]})}function Ks({pathHex:e}){if(!e)return null;const s=Ss(e);return Q.jsx("div",{className:"flex flex-wrap items-center gap-2 py-2",children:s.map((e,s)=>Q.jsxs("div",{className:"flex items-center gap-2",children:[s>0&&Q.jsx(ye,{className:"w-4 h-4 text-sys-amber flex-shrink-0"}),Q.jsxs("div",{className:"flex items-center gap-1.5",children:[Q.jsx(Be,{size:"compact",copy:!0,children:e.toUpperCase()}),Q.jsx("span",{className:"text-xs text-fg-muted font-sans tabular-nums w-4 text-left",children:s+1})]})]},s))})}function Xs({decoded:e,payloadType:s}){const t=N[s]||`TYPE_${s}`;switch(e.type){case"advert":{const s="chat"===e.nodeType?"companion":e.nodeType.replace("_"," "),t=void 0!==e.latitude&&void 0!==e.longitude&&!(0===e.latitude&&0===e.longitude);return Q.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Role:"})," ",s]}),e.name&&Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Name:"})," ",e.name]}),t&&Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Location:"})," ",e.latitude.toFixed(4),"°, ",e.longitude.toFixed(4),"°"]}),Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Time:"})," ",v(e.timestamp)]}),Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Flags:"})," ",e.flagsDescription]})]})}case"ack":return Q.jsx("div",{className:"text-xs text-fg-primary space-y-0.5",children:Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"CRC:"})," 0x",e.crc]})});case"path":return Q.jsx("div",{className:"text-xs text-fg-primary space-y-1",children:Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Path:"})," ",e.pathString||"(empty)"]})});case"trace":return Q.jsxs("div",{className:"text-xs text-fg-primary space-y-1",children:[Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Tag:"})," 0x",e.traceTag]}),Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Target Path:"})," ",e.pathString||"(empty)"]}),e.snrValues.length>0&&Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"SNR:"})," ",e.snrValues.map(e=>`${e>=0?"+":""}${Number.isInteger(e)?e:e.toFixed(1)}dB`).join(" → ")]}),Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Status:"})," ",e.isComplete?"✓ Complete":`In progress (${e.snrValues.length}/${e.pathHashes.length})`]})]});case"txt_msg":return Q.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Dest:"})," ",e.destHash]}),Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Src:"})," ",e.srcHash]}),e.encrypted?Q.jsx("p",{className:"text-fg-muted italic",children:"Encrypted content"}):Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Text:"})," ",e.text]})]});case"grp_txt":return Q.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Channel:"})," ",e.channelName?Q.jsx("span",{className:"text-sys-green",children:e.channelName}):e.isPublicHashChannel?Q.jsx("span",{className:"text-sys-indigo",children:"Public Hash Channel"}):Q.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]}),e.decrypted?Q.jsxs(Q.Fragment,{children:[e.senderName&&Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"From:"})," ",e.senderName]}),Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Text:"})," ",e.text]})]}):e.isPublicHashChannel?Q.jsx("p",{className:"text-fg-muted italic",children:"Encrypted (public hash channel)"}):Q.jsx("p",{className:"text-fg-muted italic",children:"Encrypted (unknown channel)"})]});case"grp_data":return Q.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Channel:"})," ",e.channelName?Q.jsx("span",{className:"text-sys-teal",children:e.channelName}):Q.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]}),Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Data:"})," ",e.dataLength," bytes ",e.decrypted?"(decrypted)":"(encrypted)"]})]});case"multipart":return Q.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Part:"})," ",e.partNumber+1,"/",e.totalParts]}),Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Message ID:"})," ",e.messageId]})]});case"control":return Q.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Control:"})," ",e.subtypeName]}),e.dataLength>0&&Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Data:"})," ",e.dataLength," bytes"]})]});case"req":case"response":return Q.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Dest:"})," ",e.destHash]}),Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Src:"})," ",e.srcHash]}),Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Ciphertext:"})," ",e.ciphertextLength," bytes"]})]});case"anon_req":return Q.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Dest:"})," ",e.destHash]}),Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Pub Key:"})," ",Q.jsxs("span",{className:"font-mono break-all",children:[e.senderPublicKey.slice(0,16),"…"]})]}),Q.jsxs("p",{children:[Q.jsx("span",{className:"text-fg-muted",children:"Ciphertext:"})," ",e.ciphertextLength," bytes"]})]});default:return Q.jsxs("p",{className:"text-xs text-fg-secondary",children:[t," (","length"in e?e.length:0," bytes)"]})}}const Ys=O.memo(function({packet:e,decodedGrpTxt:s}){var t,a;const n=e.raw_packet||"",r=n.length/2,l=g(),[c,d]=O.useState(null),[o,x]=O.useState(null),[m,p]=O.useState(!1),[h,u]=O.useState(null),b=O.useCallback(e=>{u(s=>s===e?null:e)},[]),N=O.useMemo(()=>K(n),[n]),k=null==(t=null==N?void 0:N.packet)?void 0:t.payloadType,w=(null==N?void 0:N.payloadHex)||"",C=null==(a=null==N?void 0:N.packet)?void 0:a.payload,_=k===j.GRP_TXT,S=k===j.GRP_DATA,H=_&&!s&&(!l||m);if(O.useEffect(()=>{if(d(null),p(!1),s)return;if(!_||!C||C.length<4)return;if(!l)return void p(!0);p(!0);let e=!1;return ge(C).then(s=>{e||(d(s),p(!1))}),()=>{e=!0}},[w,_,l,s]),O.useEffect(()=>{if(x(null),!S||!C||C.length<4)return;if(!l)return;let e=!1;return fe(C).then(s=>{e||x(s)}),()=>{e=!0}},[w,S,l]),!N||0===n.length)return Q.jsx("div",{className:"p-4 text-center text-fg-muted",children:Q.jsx("p",{className:"text-sm",children:"No raw packet data available"})});const{packet:P}=N;let T=N.decoded;s&&"grp_txt"===N.decoded.type?T=s:c&&"grp_txt"===N.decoded.type?T=c:o&&"grp_data"===N.decoded.type&&(T=o);const M=O.useMemo(()=>function(e,s){switch(e.type){case"advert":return function(e,s){const t=[];let a=0;const n=s.slice(0,64);t.push({id:"payload:publicKey",title:"Public Key",color:"pink",hex:n,startByte:a,endByte:a+31,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:e.publicKey.toUpperCase()}),Q.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Ed25519 public key (32 bytes)"})]})}),a+=32;const r=s.slice(64,72);t.push({id:"payload:timestamp",title:"Timestamp",color:"orange",hex:r,startByte:a,endByte:a+3,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsx(Be,{size:"standard",copy:!0,children:r.toUpperCase()}),Q.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:[e.timestamp," (",v(e.timestamp),")"]})]})}),a+=4;const l=s.slice(72,200);t.push({id:"payload:signature",title:"Signature",color:"teal",hex:l,startByte:a,endByte:a+63,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:e.signature.toUpperCase()}),Q.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Ed25519 signature (64 bytes)"})]})}),a+=64;const i=s.slice(200,202);if(t.push({id:"payload:flags",title:"Flags",color:"blue",hex:i,startByte:a,endByte:a,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsxs(Be,{size:"standard",copy:!0,children:["0x",e.flags.toString(16).padStart(2,"0").toUpperCase()]}),Q.jsx("p",{className:"text-xs text-fg-primary mt-1",children:e.flagsDescription}),Q.jsxs("p",{className:"text-xs text-fg-muted",children:["Node Type: ",e.nodeType]})]})}),a+=1,void 0!==e.latitude){const n=s.slice(2*a,2*a+8);t.push({id:"payload:latitude",title:"Latitude",color:"green",hex:n,startByte:a,endByte:a+3,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsx(Be,{size:"standard",copy:!0,children:n.toUpperCase()}),Q.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:[e.latitude.toFixed(6),"°"]})]})}),a+=4}if(void 0!==e.longitude){const n=s.slice(2*a,2*a+8);t.push({id:"payload:longitude",title:"Longitude",color:"indigo",hex:n,startByte:a,endByte:a+3,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsx(Be,{size:"standard",copy:!0,children:n.toUpperCase()}),Q.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:[e.longitude.toFixed(6),"°"]})]})}),a+=4}if(e.name){const n=s.slice(2*a),r=n.length/2;t.push({id:"payload:name",title:"Name",color:"amber",hex:n,startByte:a,endByte:a+r-1,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsx(Be,{size:"standard",copy:!0,children:n.toUpperCase()}),Q.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:['"',e.name,'"']})]})})}return t}(e,s);case"ack":return function(e,s){return[{id:"payload:crc",title:"CRC",color:"green",hex:s.slice(0,8),startByte:0,endByte:3,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsxs(Be,{size:"standard",copy:!0,children:["0x",e.crc]}),Q.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"CRC32 of acknowledged packet"})]})}]}(e,s);case"grp_txt":return function(e,s){const t=[];t.push({id:"payload:channelHash",title:"Channel Hash",color:"blue",hex:s.slice(0,2),startByte:0,endByte:0,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsxs(Be,{size:"standard",copy:!0,children:["0x",e.channelHash]}),e.channelName&&Q.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:["Channel: ",e.channelName]})]})}),e.macHex&&t.push({id:"payload:mac",title:"MAC",color:"indigo",hex:s.slice(2,6),startByte:1,endByte:2,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsx(Be,{size:"standard",copy:!0,children:e.macHex.toUpperCase()}),Q.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Truncated HMAC-SHA256"})]})});const a=s.slice(6);return a&&t.push({id:"payload:ciphertext",title:e.decrypted?"Message":"Ciphertext",color:e.decrypted?"green":"zinc",hex:a,startByte:3,endByte:3+a.length/2-1,decoded:e.decrypted?Q.jsxs(Q.Fragment,{children:[Q.jsxs("p",{className:"text-sm text-fg-primary",children:['"',e.text,'"']}),e.senderName&&Q.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:["From: ",e.senderName]})]}):Q.jsxs(Q.Fragment,{children:[Q.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:a.toUpperCase()}),Q.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"AES-128-ECB encrypted"})]})}),t}(e,s);case"grp_data":return function(e,s){const t=[];t.push({id:"payload:channelHash",title:"Channel Hash",color:"blue",hex:s.slice(0,2),startByte:0,endByte:0,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsxs(Be,{size:"standard",copy:!0,children:["0x",e.channelHash]}),e.channelName&&Q.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:["Channel: ",e.channelName]})]})}),e.macHex&&t.push({id:"payload:mac",title:"MAC",color:"indigo",hex:s.slice(2,6),startByte:1,endByte:2,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsx(Be,{size:"standard",copy:!0,children:e.macHex.toUpperCase()}),Q.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Truncated HMAC-SHA256"})]})});const a=s.slice(6);return a&&t.push({id:"payload:ciphertext",title:e.decrypted?"Decrypted Data":"Encrypted Data",color:e.decrypted?"green":"zinc",hex:a,startByte:3,endByte:3+a.length/2-1,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:(e.decryptedHex||a).toUpperCase()}),Q.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[e.dataLength," bytes",e.decrypted?"":" (AES-128-ECB encrypted)"]})]})}),t}(e,s);case"path":return function(e,s){const t=[];if(t.push({id:"payload:pathLength",title:"Path Length",color:"blue",hex:s.slice(0,2),startByte:0,endByte:0,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsx(Be,{size:"standard",children:e.pathLength}),Q.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[e.pathLength," hop",1!==e.pathLength?"s":""]})]})}),e.path.length>0){const a=s.slice(2,2+2*e.pathLength);t.push({id:"payload:path",title:"Path Hops",color:"amber",hex:a,startByte:1,endByte:e.pathLength,decoded:Q.jsx(Q.Fragment,{children:Q.jsx("div",{className:"flex flex-wrap items-center gap-1",children:e.path.map((e,s)=>Q.jsxs("span",{className:"flex items-center gap-1",children:[s>0&&Q.jsx(ye,{className:"w-3 h-3 text-fg-muted"}),Q.jsx(i,{color:"amber",className:"font-mono",children:e})]},s))})})})}if(null!=e.extraType){const a=1+e.pathLength;t.push({id:"payload:extraType",title:"Extra Type",color:"indigo",hex:s.slice(2*a,2*a+2),startByte:a,endByte:a,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsx(Be,{size:"standard",children:e.extraTypeName??`0x${e.extraType.toString(16).padStart(2,"0")}`}),Q.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Bundled payload type"})]})})}if(e.extraData){const a=1+e.pathLength+1,n=s.slice(2*a);n&&t.push({id:"payload:extraData",title:"Extra Data",color:"indigo",hex:n,startByte:a,endByte:a+n.length/2-1,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:n.toUpperCase()}),Q.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[n.length/2," bytes"]})]})})}return t}(e,s);case"trace":return function(e,s){const t=[];t.push({id:"payload:crc",title:"Trace Tag",color:"blue",hex:s.slice(0,8),startByte:0,endByte:3,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsxs(Be,{size:"standard",copy:!0,children:["0x",e.traceTag]}),Q.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Unique trace request identifier"})]})}),t.push({id:"payload:mac",title:"Auth Code",color:"indigo",hex:s.slice(8,16),startByte:4,endByte:7,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsx(Be,{size:"standard",copy:!0,children:e.authCode}),Q.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Authentication/verification code"})]})}),t.push({id:"payload:flags",title:"Flags",color:"amber",hex:s.slice(16,18),startByte:8,endByte:8,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsxs(Be,{size:"standard",copy:!0,children:["0x",e.flags.toString(16).toUpperCase().padStart(2,"0")]}),Q.jsx("p",{className:"text-xs text-fg-muted mt-1",children:0===e.flags?"No flags set":`Flags: ${e.flags.toString(2).padStart(8,"0")}b`})]})});const a=s.slice(18);return a&&t.push({id:"payload:path",title:"Target Path",color:"indigo",hex:a,startByte:9,endByte:9+a.length/2-1,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsx("div",{className:"flex flex-wrap items-center gap-1",children:e.pathHashes.map((s,t)=>{const a=e.snrValues[t],n=void 0!==a?oe(a):"zinc";return Q.jsxs("span",{className:"flex items-center gap-1",children:[t>0&&Q.jsx(ye,{className:"w-3 h-3 text-fg-muted"}),Q.jsx(i,{color:"indigo",className:"font-mono",children:s}),void 0!==a&&Q.jsxs(i,{color:n,className:"font-mono",children:[a>=0?"+":"",Number.isInteger(a)?a:a.toFixed(1),"dB"]})]},t)})}),Q.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[e.pathHashes.length," target ",1===e.pathHashes.length?"hop":"hops",e.snrValues.length>0&&` • ${e.snrValues.length} SNR ${1===e.snrValues.length?"value":"values"} collected`,e.isComplete&&" • ✓ Complete"]})]})}),t}(e,s);case"multipart":return function(e,s){const t=[];t.push({id:"payload:msgId",title:"Message ID",color:"blue",hex:s.slice(0,4),startByte:0,endByte:1,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsx(Be,{size:"standard",copy:!0,children:e.messageId.toUpperCase()}),Q.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Unique message identifier"})]})}),t.push({id:"payload:partNum",title:"Part Number",color:"amber",hex:s.slice(4,6),startByte:2,endByte:2,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsx(Be,{size:"standard",copy:!0,children:e.partNumber}),Q.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"0-indexed part number"})]})}),t.push({id:"payload:totalParts",title:"Total Parts",color:"orange",hex:s.slice(6,8),startByte:3,endByte:3,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsx(Be,{size:"standard",copy:!0,children:e.totalParts}),Q.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:["Part ",e.partNumber+1," of ",e.totalParts]})]})});const a=s.slice(8);return a&&t.push({id:"payload:partData",title:"Part Data",color:"cyan",hex:a,startByte:4,endByte:4+a.length/2-1,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:a.toUpperCase()}),Q.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[a.length/2," bytes"]})]})}),t}(e,s);default:return[{id:"payload:ciphertext",title:"Raw Data",color:"zinc",hex:s,startByte:0,endByte:s.length/2-1,decoded:Q.jsxs(Q.Fragment,{children:[Q.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:s.toUpperCase()}),Q.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[s.length/2," bytes"]})]})}]}}(T,N.payloadHex),[T,N.payloadHex]),B="payload"===h||Hs(h),F=O.useMemo(()=>{const e=[{id:"header",hex:N.headerHex,color:"red"},...N.transportCodesHex?[{id:"transportCodes",hex:N.transportCodesHex,color:"indigo"}]:[],{id:"pathLength",hex:N.pathLengthHex,color:"green"},...N.pathDataHex?[{id:"pathData",hex:N.pathDataHex,color:"amber"}]:[]];return B?[...e,...(s=M,s.map(e=>({id:e.id,hex:e.hex,color:e.color})))]:[...e,{id:"payload",hex:N.payloadHex,color:"cyan"}];var s},[N,B,M]);return Q.jsxs("div",{className:"font-mono space-y-2 min-w-0 overflow-hidden",children:[(()=>{switch(T.type){case"advert":return Q.jsx(Es,{advert:T,timestamp:e.timestamp});case"grp_data":return Q.jsx(Us,{decoded:T,timestamp:e.timestamp});case"grp_txt":return Q.jsx(Is,{decoded:T,timestamp:e.timestamp,isLoading:H,onDecrypted:d});case"ack":return Q.jsx(Vs,{decoded:T,timestamp:e.timestamp});case"path":return Q.jsx(Qs,{decoded:T,timestamp:e.timestamp});case"trace":return Q.jsx(Gs,{decoded:T,timestamp:e.timestamp});case"txt_msg":return Q.jsx(Os,{decoded:T,timestamp:e.timestamp});case"multipart":return Q.jsx(Ws,{decoded:T,timestamp:e.timestamp});case"generic":return P.payloadType===j.REQ||P.payloadType===j.RESPONSE||P.payloadType===j.ANON_REQ?Q.jsx(qs,{decoded:T,timestamp:e.timestamp,payloadType:P.payloadType}):null;default:return null}})(),Q.jsx(Rs,{rawHex:n,hexSegments:F,selectedSegment:h,onSegmentClick:b}),Q.jsx(f,{children:Q.jsx(y.div,{layout:!0,transition:Fs,className:"space-y-2 min-w-0",children:(()=>{var e,s,t,a;const n=[{id:"header",title:"Header",color:"red",startByte:0,endByte:0,hexBytes:`0x${N.headerHex.toUpperCase()}`,condition:!0,content:Q.jsxs("table",{className:"w-full text-left",children:[Q.jsx("thead",{children:Q.jsxs("tr",{className:"type-micro text-fg-muted border-b border-edge-subtle font-sans",children:[Q.jsx("th",{className:"py-1 font-medium",children:"Bits"}),Q.jsx("th",{className:"py-1 font-medium",children:"Field"}),Q.jsx("th",{className:"py-1 font-medium",children:"Value"}),Q.jsx("th",{className:"py-1 font-medium",children:"Binary"})]})}),Q.jsx("tbody",{children:N.headerFields.map(e=>Q.jsx($s,{...e},e.bits))})]})},{id:"transportCodes",title:"Transport Codes",color:"indigo",startByte:1,endByte:4,hexBytes:(null==(e=N.transportCodesHex)?void 0:e.toUpperCase())||"",condition:!!N.transportCodesHex,content:Q.jsxs(Q.Fragment,{children:[Q.jsx("p",{className:"text-xs text-fg-muted",children:"Two 16-bit transport codes for encrypted routing"}),Q.jsxs("div",{className:"mt-1 text-xs text-fg-secondary",children:["Code 1: 0x",null==(s=N.transportCodesHex)?void 0:s.slice(0,4).toUpperCase()," | Code 2: 0x",null==(t=N.transportCodesHex)?void 0:t.slice(4,8).toUpperCase()]})]})},{id:"pathLength",title:"Path Length",color:"green",startByte:N.transportCodesHex?5:1,endByte:N.transportCodesHex?5:1,hexBytes:`0x${N.pathLengthHex.toUpperCase()}`,condition:!0,content:Q.jsxs("p",{className:"text-xs text-fg-muted pt-1",children:[P.pathLen," bytes showing route taken (increases as packet floods)"]})},{id:"pathData",title:"Path Data",color:"amber",startByte:N.transportCodesHex?6:2,endByte:(N.transportCodesHex?5:1)+P.pathLen,hexBytes:(null==(a=N.pathDataHex)?void 0:a.toUpperCase())||"",condition:P.pathLen>0,content:Q.jsxs("div",{className:"space-y-3",children:[Q.jsx(Ks,{pathHex:N.pathDataHex}),Q.jsx("p",{className:"text-xs text-fg-muted",children:"Historical route taken (bytes are added as packet floods through network)"})]})},{id:"payload",title:"Payload",color:"cyan",startByte:N.payloadStartByte,endByte:r-1,hexBytes:N.payloadHex.toUpperCase(),condition:!0,content:Q.jsxs(Q.Fragment,{children:[!Hs(h)&&Q.jsxs("div",{className:"p-3 rounded-lg bg-black",children:[Q.jsx("p",{className:"type-micro text-fg-muted mb-1.5 font-sans",children:"Decoded"}),Q.jsx(Xs,{decoded:T,payloadType:P.payloadType})]}),!Hs(h)&&M.length>0&&Q.jsx("p",{className:"type-micro text-fg-muted mt-3 font-sans",children:"Click a field below to highlight its bytes"}),Hs(h)&&Q.jsx("p",{className:"type-micro text-fg-muted font-sans",children:"↑ Selected field above • Other fields below ↓"})]})}].filter(e=>e.condition),l=Hs(h)?M.find(e=>e.id===h):null,c=Hs(h)?[...n].sort((e,s)=>"payload"===e.id?-1:"payload"===s.id?1:0):[...n].sort((e,s)=>e.id===h?-1:s.id===h?1:0),d=Hs(h)?M.filter(e=>e.id!==h):[];return Q.jsxs(Q.Fragment,{children:[l&&Q.jsx(As,{id:`subfield-${l.id}`,title:l.title,color:l.color,startByte:N.payloadStartByte+l.startByte,endByte:N.payloadStartByte+l.endByte,hexBytes:l.hex.toUpperCase(),isSelected:!0,children:l.decoded},l.id),c.map(e=>Q.jsx(As,{id:`section-${e.id}`,title:e.title,color:e.color,startByte:e.startByte,endByte:e.endByte,hexBytes:e.hexBytes,isSelected:e.id===h,children:e.content},e.id)),d.map(e=>Q.jsxs(y.div,{layout:"position",layoutId:`subfield-${e.id}`,transition:Fs,className:"w-full min-w-0 overflow-hidden rounded-xl p-4 sm:p-5 space-y-4",style:{backgroundColor:Ts,boxShadow:Ms},children:[Q.jsxs("div",{className:"flex items-start justify-between gap-4",children:[Q.jsxs("div",{className:"flex flex-wrap items-center gap-0.5 min-w-0",children:[Q.jsx(i,{color:e.color,children:e.title}),e.hex.length<=32&&Ss(e.hex).map((s,t)=>Q.jsx(i,{color:e.color,className:"font-mono",children:s.toUpperCase()},t))]}),Q.jsxs("span",{className:"type-data-xs text-fg-muted flex-shrink-0",children:["Bytes ",N.payloadStartByte+e.startByte,"-",N.payloadStartByte+e.endByte]})]}),Q.jsx("div",{className:"min-w-0 overflow-hidden p-3 rounded-lg bg-black",children:e.decoded})]},e.id))]})})()})})]})});function Js(e){if(!e)return[];if(Array.isArray(e))return e;try{const s=JSON.parse(e);return Array.isArray(s)?s:[]}catch{return[]}}function Zs(e){return e?(e.startsWith("0x")?e.slice(2):e).slice(0,2).toUpperCase():""}function et({hop:e,compact:s=!1,index:t=0,highlightIndex:r=-1,isTrace:l=!1}){var i;const c=t===r,d=function(){const e=a(ss);return n(e.mount,[]),e}();return O.useEffect(()=>{c&&l&&d.start({boxShadow:["0 0 0 0px rgba(113, 156, 223, 0)","0 0 0 2px rgba(113, 156, 223, 0.5)","0 0 0 2px rgba(113, 156, 223, 0.5)","0 0 0 0px rgba(113, 156, 223, 0)"],transition:{duration:.5,times:[0,.2,.7,1],ease:"easeInOut"}})},[c,l,d]),Q.jsxs(y.div,{className:G("flex items-center gap-1.5",s?"flex-row":"flex-col"),animate:{scale:c?1.05:1,opacity:c?1:.85},transition:{duration:.3,ease:"easeInOut"},children:[Q.jsxs(y.div,{className:G("flex items-center gap-1.5 px-2.5 py-1 rounded-md","font-mono text-xs font-semibold",e.isLocal?"bg-sys-amber/20 text-sys-amber ring-1 ring-sys-amber/30":"bg-elevated/50 text-fg-primary ring-1 ring-edge-strong/50"),animate:d,initial:{boxShadow:"0 0 0 0px rgba(113, 156, 223, 0)"},children:[e.isLocal&&Q.jsx($e,{className:"w-3 h-3"}),Q.jsx("span",{children:e.prefix}),void 0!==e.confidence&&e.confidence<.9&&Q.jsxs("span",{className:"text-[9px] opacity-70",children:[(100*e.confidence).toFixed(0),"%"]})]}),!s&&(null==(i=e.neighborInfo)?void 0:i.name)&&Q.jsx("span",{className:"text-xs text-fg-muted truncate max-w-[80px]",children:e.neighborInfo.name})]})}function st({snr:e}){const s=S(e),t=_()[s]||"#6b7280",a=Number.isInteger(e)?e.toString():e.toFixed(1);return Q.jsxs(i,{customColor:t,compact:!0,className:"font-mono",children:[e>=0?"+":"",a,"dB"]})}function tt({hops:e,compact:s,isTrace:t=!1}){const[a,n]=O.useState(-1);return O.useEffect(()=>{if(0===e.length)return;const s=setTimeout(()=>{n(0)},400),a=setInterval(()=>{n(s=>{const t=s+1;return t>=e.length?(clearInterval(a),-1):t})},t?500:600);return()=>{clearTimeout(s),clearInterval(a)}},[e.length,t]),Q.jsx("div",{className:"p-6",style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"4px 8px"},children:e.map((n,r)=>{const l=r%2==0,i=r===e.length-1;return Q.jsxs("div",{className:"contents",children:[Q.jsx("div",{className:G("flex items-center","justify-end"),children:l&&Q.jsx(et,{hop:n,compact:s,index:r,highlightIndex:a,isTrace:t})}),Q.jsx("div",{className:"flex flex-col items-center justify-center min-h-[28px]",children:!i&&Q.jsxs(Q.Fragment,{children:[Q.jsx("div",{className:"w-px flex-1 bg-border-strong/40 min-h-[8px]"}),void 0!==n.snr&&Q.jsx(st,{snr:n.snr}),Q.jsx("svg",{className:"w-3 h-3 text-fg-muted flex-shrink-0",viewBox:"0 0 12 12",fill:"none",children:Q.jsx("path",{d:"M6 2v8M3 7l3 3 3-3",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]})}),Q.jsx("div",{className:G("flex items-center","justify-start"),children:!l&&Q.jsx(et,{hop:n,compact:s,index:r,highlightIndex:a,isTrace:t})})]},`${n.prefix}-${r}`)})})}const at=O.memo(function({packet:e,neighbors:s,localHash:t,neighborAffinity:a,ghostPrefixes:n,direction:r="horizontal",compact:l=!1,traceSnr:i,overridePath:c}){const o=void 0!==i&&i.length>0,x=Js(e.original_path),m=Js(e.forwarded_path),p=c??(m.length>0?m:x),h=Zs(t),u=O.useMemo(()=>p.map((e,t)=>{const r=e.toUpperCase(),l=r===h,c=(null==n?void 0:n.has(r))??!1,d=function(e,s,t){const a=e.toUpperCase();if(t){let e=null,n=0;if(t.forEach((s,t)=>{if(Zs(t)===a){const a=s.combinedScore??0;a>n&&(n=a,e=t)}}),e&&s[e])return{hash:e,info:s[e],confidence:n}}for(const[n,r]of Object.entries(s))if(Zs(n)===a)return{hash:n,info:r,confidence:void 0};return null}(r,s,a);return{prefix:r,fullHash:null==d?void 0:d.hash,neighborInfo:null==d?void 0:d.info,isLocal:l,isGhost:c,confidence:null==d?void 0:d.confidence,snr:null==i?void 0:i[t]}}),[p,s,a,h,n,i]);if(0===u.length)return Q.jsxs("div",{className:"flex items-center gap-2 text-fg-muted text-xs",children:[Q.jsx(d,{className:"w-4 h-4 opacity-50"}),Q.jsx("span",{children:"Direct / No path data"})]});if("flowchart"===r)return Q.jsx(tt,{hops:u,compact:l,isTrace:o});const g="horizontal"===r?ye:Ce;return Q.jsx("div",{className:G("flex gap-1.5","horizontal"===r?"flex-row flex-wrap items-center":"flex-col items-start"),children:u.map((e,s)=>Q.jsxs("div",{className:G("flex items-center gap-1.5","vertical"===r&&"flex-col"),children:[Q.jsx(et,{hop:e,compact:l}),s<u.length-1&&Q.jsx(g,{className:"w-3 h-3 text-fg-muted flex-shrink-0"})]},`${e.prefix}-${s}`))})});function nt(e,s){if(null!=e)return"boolean"==typeof e?String(e):"number"==typeof e&&s?`${e} ${s}`:String(e)}const rt=()=>"blue",lt=[{fn:"id",group:"identity",fmt:"int",read:e=>nt(e.id),color:rt},{fn:"packet_hash",group:"identity",fmt:"hex<sha256>",read:e=>e.packet_hash||void 0,color:rt},{fn:"timestamp",group:"identity",fmt:"epoch<s>",read:e=>e.timestamp?String(e.timestamp):void 0,color:rt,annotate:e=>e.timestamp>0?H(e.timestamp):void 0},{fn:"type",group:"classification",fmt:"enum<payload_type>",read:e=>nt(e.type??e.payload_type),color:rt},{fn:"route",group:"classification",fmt:"enum<route_type>",read:e=>nt(e.route??e.route_type),color:rt},{fn:"rssi",group:"signal",fmt:"int<dBm>",read:e=>nt(e.rssi,"dBm"),color:rt},{fn:"snr",group:"signal",fmt:"float<dB>",read:e=>nt(e.snr,"dB"),color:rt},{fn:"path_length",group:"size",fmt:"int<hops>",read:e=>{if(null!=e.path_length)return 0===e.path_length?"zero-hop":`${e.path_length} hops`},color:rt},{fn:"payload_length",group:"size",fmt:"int<B>",read:e=>nt(e.payload_length,"B"),color:rt},{fn:"airtime",group:"size",fmt:"float<ms>",read:e=>nt(e.airtime_ms,"ms"),color:rt},{fn:"src_hash",group:"addressing",fmt:"hex<2>",read:e=>e.src_hash??void 0,color:rt},{fn:"dst_hash",group:"addressing",fmt:"hex<2>",read:e=>e.dst_hash??void 0,color:rt},{fn:"path_hash",group:"addressing",fmt:"hex[]|hex",read:e=>Array.isArray(e.path_hash)?`[${e.path_hash.join(", ")}]`:nt(e.path_hash),color:rt,renderValue:e=>Array.isArray(e.path_hash)?it(e.path_hash):null},{fn:"score",group:"addressing",fmt:"int",read:e=>nt(e.score),color:rt},{fn:"original_path",group:"paths",fmt:"hex[]",read:e=>Array.isArray(e.original_path)?`[${e.original_path.join(", ")}]`:void 0,color:rt,renderValue:e=>Array.isArray(e.original_path)&&e.original_path.length>0?it(e.original_path,e.src_hash||void 0,e.dst_hash||void 0,!0):null},{fn:"forwarded_path",group:"paths",fmt:"hex[]",read:e=>Array.isArray(e.forwarded_path)?`[${e.forwarded_path.join(", ")}]`:void 0,color:rt,renderValue:e=>Array.isArray(e.forwarded_path)&&e.forwarded_path.length>0?it(e.forwarded_path):null},{fn:"transmitted",group:"status",fmt:"bool",read:e=>nt(e.transmitted),color:rt},{fn:"is_duplicate",group:"status",fmt:"bool",read:e=>nt(e.is_duplicate),color:rt},{fn:"drop_reason",group:"status",fmt:"string|null",read:e=>e.drop_reason??void 0,color:rt},{fn:"tx_delay",group:"status",fmt:"int<ms>",read:e=>nt(e.tx_delay_ms,"ms"),color:rt},{fn:"origin",group:"status",fmt:"enum<rx|tx_local|tx_forward>",read:e=>e.packet_origin??void 0,color:rt},{fn:"duplicates",group:"status",fmt:"PacketDuplicate[]",read:e=>null!=e.duplicates&&e.duplicates.length>0?`${e.duplicates.length}`:nt(e.duplicates),color:rt},{fn:"lbt_attempts",group:"lbt",fmt:"int",read:e=>nt(e.lbt_attempts),color:rt},{fn:"lbt_backoff",group:"lbt",fmt:"json<float[]>",read:e=>nt(e.lbt_backoff_delays_ms),color:rt},{fn:"lbt_busy",group:"lbt",fmt:"bool|int",read:e=>nt(e.lbt_channel_busy),color:rt}];function it(e,s,t,a){const n=e.length>0,r=s||a,l=t||a;return Q.jsxs("span",{className:"inline-flex items-center gap-1 flex-wrap",children:[r&&Q.jsxs(Q.Fragment,{children:[s?Q.jsx("span",{className:"inline-block border border-edge-subtle rounded px-1.5 py-0.5 font-mono text-[11px] text-sys-blue",children:s}):Q.jsx("span",{className:"inline-block border border-edge-subtle/50 rounded px-1.5 py-0.5 font-mono text-[11px] text-fg-muted/30",children:"XX"}),(n||l)&&Q.jsx("span",{className:"text-fg-muted/40 text-[10px]",children:"→"})]}),e.map((e,s)=>Q.jsxs(O.Fragment,{children:[s>0&&Q.jsx("span",{className:"text-fg-muted/40 text-[10px]",children:"→"}),Q.jsx("span",{className:"inline-block border border-edge-subtle rounded px-1.5 py-0.5 font-mono text-[11px] text-sys-blue",children:e})]},s)),l&&Q.jsxs(Q.Fragment,{children:[n&&Q.jsx("span",{className:"text-fg-muted/40 text-[10px]",children:"→"}),t?Q.jsx("span",{className:"inline-block border border-edge-subtle rounded px-1.5 py-0.5 font-mono text-[11px] text-sys-blue",children:t}):Q.jsx("span",{className:"inline-block border border-edge-subtle/50 rounded px-1.5 py-0.5 font-mono text-[11px] text-fg-muted/30",children:"XX"})]})]})}let ct=null;function dt(e,s){var t;const a=function(){if(!ct){ct=new Map;for(const e of lt)ct.set(e.fn,e)}return ct}().get(s);if(!a)return null;const n=a.read(e);if(void 0===n)return null;const r=a.color(e),l=null==(t=a.annotate)?void 0:t.call(a,e);return l?{text:n,color:r,annotation:l}:{text:n,color:r}}function ot(e){if(!e)return[];if(Array.isArray(e))return e;try{const s=JSON.parse(e);return Array.isArray(s)?s:[]}catch{return[]}}function xt({packets:e,selectedIndex:s,onSelect:t,compact:a=!1}){if(e.length<=1)return null;const n=s>0,r=s<e.length-1;return Q.jsxs("div",{className:G("flex items-center gap-1",a?"gap-0.5":"gap-1"),children:[Q.jsx("button",{onClick:()=>n&&t(s-1),disabled:!n,className:G("p-0.5 radius-badge transition-base",n?"text-fg-muted hover:text-fg-primary hover-bg":"text-fg-muted cursor-not-allowed"),"aria-label":"Previous observation",children:Q.jsx(Ve,{className:a?"size-3":"size-4"})}),Q.jsx("div",{className:"flex items-center gap-0.5",children:e.map((e,n)=>{const r=n===s,l=new Date(1e3*e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});return Q.jsx(A,{color:r?"cyan":"zinc",filled:r,compact:a,onClick:()=>t(n),title:`Observation ${n+1} at ${l}`,className:G("transition-all duration-150",!r&&"opacity-60 hover:opacity-100"),children:a?Q.jsx("span",{className:"tabular-nums",children:n+1}):Q.jsxs("span",{className:"tabular-nums text-xs",children:["#",n+1,null!=e.rssi&&Q.jsx("span",{className:"ml-1 opacity-70",children:e.rssi})]})},`${e.timestamp}_${n}`)})}),Q.jsx("button",{onClick:()=>r&&t(s+1),disabled:!r,className:G("p-0.5 radius-badge transition-base",r?"text-fg-muted hover:text-fg-primary hover-bg":"text-fg-muted cursor-not-allowed"),"aria-label":"Next observation",children:Q.jsx(_e,{className:a?"size-3":"size-4"})}),Q.jsxs("span",{className:G("text-fg-muted ml-1",a?"text-[9px]":"text-xs"),children:[Q.jsx(l,{className:"inline size-3 mr-0.5 opacity-50"}),e.length]})]})}function mt({icon:e,label:s,disabled:t=!1}){return Q.jsx(y.div,{className:"flex items-center gap-1 text-xs",title:s,animate:{opacity:t?.25:.6},transition:{duration:.15,ease:[.4,0,.2,1]},children:Q.jsx("span",{className:G("flex items-center justify-center size-5 radius-badge border-control transition-base",t?"bg-subtle-fill border-edge-subtle":"bg-subtle-fill"),children:e})})}function pt({hasDuplicates:e,hasPrev:s,hasNext:t,canPrevDupe:a,canNextDupe:n}){return Q.jsxs("div",{className:"flex items-center gap-1.5",children:[Q.jsxs("div",{className:"flex items-center gap-0.5",children:[Q.jsx(mt,{icon:Q.jsx(Qe,{className:"size-3"}),label:"Previous packet (↑)",disabled:!s}),Q.jsx(mt,{icon:Q.jsx(E,{className:"size-3"}),label:"Next packet (↓)",disabled:!t})]}),e&&Q.jsxs(Q.Fragment,{children:[Q.jsx("div",{className:"w-px h-3 bg-subtle-fill-strong"}),Q.jsxs("div",{className:"flex items-center gap-0.5",children:[Q.jsx(mt,{icon:Q.jsx(Ve,{className:"size-3"}),label:"Previous observation (←)",disabled:!a}),Q.jsx(mt,{icon:Q.jsx(_e,{className:"size-3"}),label:"Next observation (→)",disabled:!n})]})]})]})}const ht=O.memo(function({packets:e,initialIndex:s=0,onClose:t,onNavigatePrev:a,onNavigateNext:n,hasPrev:r=!1,hasNext:l=!1,resolveSource:c}){var o;const[h,u]=O.useState(s),g=e[h]??e[0],f=e.length>1,[b,N]=O.useState(null),[v,k]=O.useState(!1);O.useEffect(()=>{if(!g._stripped)return void N(null);let e=!1;k(!0);const s=g.packet_hash;if(s)return P(s).then(s=>{e||(s.success&&s.data&&(N(s.data),(s.data.type??s.data.payload_type)===j.GRP_TXT&&s.data.raw_packet&&T.getState().queueDecryption([s.data])),k(!1))}).catch(()=>{e||k(!1)}),()=>{e=!0};k(!1)},[g]);const w=b??g,C=h>0,_=h<e.length-1,S=O.useCallback(s=>{u(Math.max(0,Math.min(s,e.length-1)))},[e.length]);O.useEffect(()=>{const e=e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement))switch(e.key){case"ArrowUp":e.preventDefault(),null==a||a();break;case"ArrowDown":e.preventDefault(),null==n||n();break;case"ArrowLeft":e.preventDefault(),C&&u(e=>e-1);break;case"ArrowRight":e.preventDefault(),_&&u(e=>e+1)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[a,n,C,_]);const H=M(),A=B(),E=F(),U=L(),I=O.useMemo(()=>new Set(U.map(e=>e.prefix.toUpperCase())),[U]),V=w.payload_type_name||x(w.payload_type??w.type),G=w.route_type_name||m(w.route_type??w.route),W=w.payload_length??w.length??0,q=ot(w.original_path),K=ot(w.forwarded_path),Y=q.length>0||K.length>0,J=K.length>0?K:q,Z=O.useMemo(()=>{var e;if(null==(e=null==H?void 0:H.config)?void 0:e.repeater)return{latitude:H.config.repeater.latitude,longitude:H.config.repeater.longitude,name:H.config.node_name||"Local Node"}},[H]),ee=(null==H?void 0:H.neighbors)??{},se=E.size>0?E:void 0,te=w.raw_packet&&w.raw_packet.length>0,ae=g._stripped&&v,ne=O.useMemo(()=>c?c(w):null,[c,w]),re=D(w.packet_hash),le=O.useMemo(()=>{if((w.payload_type??w.type)!==j.GRP_TXT)return null;if(!(null==re?void 0:re.decoded))return null;const e=re.decoded;return{type:"grp_txt",channelHash:e.channelHash,channelName:e.channelName,text:e.text??"",decrypted:e.decrypted,senderName:e.senderName,timestamp:e.timestamp,flags:e.flags,macCorrupted:e.macCorrupted}},[w,re]),ie=O.useMemo(()=>X(w,le),[w,le]),ce="trace"===ie.kind?ie.data:null,oe="trace"===ie.kind?ie.snrValues:void 0,xe="advert"===ie.kind?ie.data:null,me="advert"===ie.kind?ie.sourceNode:void 0,pe="grp_txt"===ie.kind?ie.wardriveSourceNode??void 0:void 0,he=e=>e&&0!==e?new Date(1e3*e).toLocaleString():"Unknown",ue=(w.payload_type??w.type)===j.ADVERT&&(void 0!==me||Y),ge=void 0!==pe,fe=me??pe;if(0===J.length)return null;const ye=(null==H?void 0:H.local_hash)?(H.local_hash.startsWith("0x")?H.local_hash.slice(2,4):H.local_hash.slice(0,2)).toUpperCase():"";for(const i of J){const e=i.toUpperCase();if(e!==ye)if(se){let s=0,t=0;if(se.forEach((a,n)=>{(n.startsWith("0x")?n.slice(2,4):n.slice(0,2)).toUpperCase()===e&&(s++,t=Math.max(t,a.combinedScore??0))}),0===s)for(const a of Object.keys(ee))if((a.startsWith("0x")?a.slice(2,4):a.slice(0,2)).toUpperCase()===e)break}else for(const s of Object.keys(ee))if((s.startsWith("0x")?s.slice(2,4):s.slice(0,2)).toUpperCase()===e)break}const ve=de[V]??"zinc",we=p[ve]||p.zinc;return Q.jsxs(z,{open:!0,onClose:t,size:"5xl",motionPlus:!0,className:"sm:h-[85vh] sm:max-h-[800px] md:h-[80vh] md:max-h-[900px]",children:[Q.jsxs("div",{className:"sm:hidden",children:[Q.jsx("div",{className:"flex justify-center pt-2 pb-1",children:Q.jsx("div",{className:"w-9 h-1 rounded-full bg-fg-muted","aria-hidden":"true"})}),Q.jsxs("div",{className:"flex items-center justify-between px-3 pb-2",children:[Q.jsxs("div",{className:"flex items-center gap-1.5",children:[Q.jsx(i,{color:de[V]??"zinc",className:"!text-[9px] !px-1.5 !py-0",children:V}),Q.jsx(i,{color:"DIRECT"===G||"T_DIRECT"===G?"cyan":"amber",className:"!text-[9px] !px-1.5 !py-0",children:G}),Q.jsxs(i,{color:"zinc",className:"!text-[9px] !px-1.5 !py-0",children:[W,"B"]})]}),Q.jsx("button",{onClick:t,className:"px-3 py-1.5 text-[15px] font-medium text-sys-blue active:text-sys-blue/80 transition-base flex-shrink-0 radius-inner active:bg-subtle-fill",children:"Done"})]}),f&&Q.jsx("div",{className:"px-3 pb-2",children:Q.jsx(xt,{packets:e,selectedIndex:h,onSelect:S,compact:!0})})]}),Q.jsx("div",{className:"hidden sm:block px-6 pt-5 pb-4",children:Q.jsxs("div",{className:"flex items-center justify-between gap-3",children:[Q.jsxs("div",{className:"flex items-center gap-2",children:[Q.jsx(i,{color:de[V]??"zinc",children:V}),Q.jsx(i,{color:"DIRECT"===G||"T_DIRECT"===G?"cyan":"amber",children:G}),Q.jsxs(i,{color:"zinc",children:[W,"B"]}),f&&Q.jsxs(Q.Fragment,{children:[Q.jsx("div",{className:"w-px h-4 bg-subtle-fill-strong"}),Q.jsx(xt,{packets:e,selectedIndex:h,onSelect:S})]})]}),Q.jsxs("div",{className:"flex items-center gap-3",children:[Q.jsx(pt,{hasDuplicates:f,hasPrev:r,hasNext:l,canPrevDupe:C,canNextDupe:_}),Q.jsx("button",{onClick:t,className:"p-1.5 -m-1.5 text-fg-muted hover:text-fg-primary transition-base radius-inner hover:bg-elevated flex-shrink-0",children:Q.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:Q.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})}),Q.jsx("div",{className:"sm:hidden h-[2px]",style:{backgroundColor:we,opacity:.6}}),Q.jsxs(R,{className:"p-0 overflow-hidden flex-1 flex flex-col min-h-0",children:[Q.jsx("div",{className:"md:hidden flex-1 overflow-y-auto overflow-x-hidden",children:Q.jsxs("div",{className:"p-2 space-y-2",children:[(null!=w.rssi||null!=w.snr)&&Q.jsxs("div",{className:"relative flex items-center justify-between px-2 py-1.5 radius-inner bg-subtle-fill",children:[Q.jsx($,{mode:"popLayout",initial:!1,children:Q.jsxs(y.div,{className:"flex items-center gap-3",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[Q.jsx(je,{rssi:w.rssi,snr:w.snr,compact:!0,showValues:!0,validated:be(w)}),Q.jsx("span",{className:"text-[11px] text-fg-muted",children:ke(w.rssi)})]},h)}),J.length>0&&Q.jsxs("span",{className:"type-data-xs text-fg-muted",children:[J.length," hop",1!==J.length?"s":""]})]}),(Y&&J.length>0||ue||ge)&&Q.jsx("div",{className:"overflow-hidden radius-inset",children:Q.jsx("div",{className:"aspect-[4/3] w-full",children:Q.jsx(_s,{path:J,neighbors:ee,localNode:Z,localHash:null==H?void 0:H.local_hash,srcHash:w.src_hash,dstHash:w.dst_hash,neighborAffinity:se,hubNodes:[...A],traceSnr:oe,advertiserSource:fe})})}),ce&&ce.pathHashes.length>0&&Q.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[Q.jsx("div",{className:"px-3 py-2 space-y-1.5",children:Q.jsxs("div",{className:"flex items-center justify-between",children:[Q.jsx("span",{className:"type-micro text-fg-muted",children:"Trace Route"}),Q.jsx("div",{className:"flex items-center gap-1.5",children:Q.jsx(i,{color:ce.isComplete?"green":"amber",compact:!0,children:ce.isComplete?"Complete":"In Progress"})})]})}),Q.jsx(at,{packet:w,neighbors:ee,localHash:null==H?void 0:H.local_hash,neighborAffinity:se,ghostPrefixes:I,direction:"flowchart",compact:!0,overridePath:ce.pathHashes,traceSnr:ce.snrValues})]}),Y&&!ce&&Q.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[Q.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[Q.jsx("span",{className:"type-micro text-fg-muted",children:"Path"}),Q.jsxs(i,{color:"zinc",compact:!0,children:[J.length," hop",1!==J.length?"s":""]})]}),Q.jsx(at,{packet:w,neighbors:ee,localHash:null==H?void 0:H.local_hash,neighborAffinity:se,ghostPrefixes:I,direction:"flowchart",compact:!0,traceSnr:oe})]}),ne&&(ne.name||ne.hash)&&!xe&&Q.jsxs("div",{className:"radius-inset bg-subtle-fill overflow-hidden",children:[Q.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-edge-subtle",children:[Q.jsx("span",{className:"type-micro text-fg-muted",children:"Source"}),Q.jsx(i,{color:ne.isRepeater?"blue":ne.isCompanion?"violet":"room_server"===ne.type?"lime":"zinc",compact:!0,children:"room_server"===ne.type?"room server":ne.type})]}),Q.jsxs("div",{className:"p-3 space-y-1.5",children:[ne.name&&Q.jsxs("div",{className:"flex items-center gap-2",children:[Q.jsx(Ze,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),Q.jsx("span",{className:"type-label text-fg-primary truncate",children:ne.name}),!ne.confident&&Q.jsx("span",{className:"text-[9px] text-fg-muted/60 italic",children:"ambiguous"})]}),ne.hash&&Q.jsxs("div",{className:"flex items-center gap-2",children:[Q.jsx(Ie,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),Q.jsxs("span",{className:"type-data-xs text-fg-muted truncate font-mono",children:[ne.hash.startsWith("0x")?ne.hash.slice(2,10):ne.hash.slice(0,8),"…"]})]})]})]}),xe&&Q.jsxs("div",{className:"radius-inset bg-subtle-fill overflow-hidden",children:[Q.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-edge-subtle",children:[Q.jsx("span",{className:"type-micro text-fg-muted",children:"Advertiser Info"}),Q.jsx(i,{color:"lime",compact:!0,children:xe.nodeType})]}),Q.jsxs("div",{className:"p-3 space-y-2",children:[xe.name&&Q.jsxs("div",{className:"flex items-center gap-2",children:[Q.jsx(Ze,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),Q.jsx("span",{className:"type-label text-fg-primary truncate",children:xe.name})]}),xe.latitude&&xe.longitude&&Q.jsxs("div",{className:"flex items-center gap-2",children:[Q.jsx(Pe,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),Q.jsxs("span",{className:"type-data-xs text-fg-secondary",children:[xe.latitude.toFixed(5),", ",xe.longitude.toFixed(5)]})]}),Q.jsxs("div",{className:"flex items-center gap-2",children:[Q.jsx(Ie,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),Q.jsxs("span",{className:"type-data-xs text-fg-muted truncate",children:[xe.publicKey.slice(0,16),"...",xe.publicKey.slice(-8)]})]}),xe.timestamp>0&&Q.jsxs("div",{className:"flex items-center gap-2",children:[Q.jsx(Ne,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),Q.jsx("span",{className:"text-xs text-fg-muted",children:he(xe.timestamp)})]}),Q.jsxs("div",{className:"flex items-center gap-2",children:[Q.jsx(d,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),Q.jsx("span",{className:"text-xs text-fg-muted",children:xe.flagsDescription||`Flags: 0x${xe.flags.toString(16).padStart(2,"0")}`})]})]})]}),ae?Q.jsx("div",{className:"pt-1 px-3 py-6 text-center",children:Q.jsx("span",{className:"text-xs text-fg-muted animate-pulse",children:"Loading packet details…"})}):te?Q.jsx("div",{className:"pt-1",children:Q.jsx(Ys,{packet:w,decodedGrpTxt:le})}):null]})}),Q.jsxs("div",{className:"hidden md:grid md:grid-cols-2 flex-1 overflow-hidden",children:[Q.jsx("div",{className:"overflow-y-auto overflow-x-hidden scrollbar-none p-4 border-r border-edge-subtle",children:ae?Q.jsx("div",{className:"flex items-center justify-center h-full",children:Q.jsx("span",{className:"text-sm text-fg-muted animate-pulse",children:"Loading packet details…"})}):te?Q.jsx(Ys,{packet:w,decodedGrpTxt:le}):null}),Q.jsxs("div",{className:"grid overflow-hidden",style:{gridTemplateRows:"minmax(280px, 1fr) auto"},children:[Q.jsx("div",{className:"overflow-hidden p-2",children:Y&&J.length>0||ue||ge?Q.jsx("div",{className:"h-full w-full",children:Q.jsx(_s,{path:J,neighbors:ee,localNode:Z,localHash:null==H?void 0:H.local_hash,srcHash:w.src_hash,dstHash:w.dst_hash,neighborAffinity:se,hubNodes:[...A],traceSnr:oe,advertiserSource:fe})}):Q.jsxs("div",{className:"h-full w-full flex flex-col items-center justify-center text-center px-4",children:[Q.jsx(d,{className:"w-8 h-8 text-fg-muted/50 mb-2"}),Q.jsx("span",{className:"text-sm text-fg-muted",children:"Direct Reception"}),Q.jsx("span",{className:"text-xs text-fg-muted/70 mt-1",children:"Zero-hop packet — received directly from sender"})]})}),Q.jsxs("div",{className:"overflow-y-auto max-h-[200px] p-2 space-y-2",children:[!ce&&J.length<=1&&(null!=w.rssi||null!=w.snr)&&Q.jsx("div",{className:"surface-base radius-inset p-4",children:Q.jsxs("dl",{className:"text-xs grid grid-cols-2 gap-2",children:[Q.jsxs("div",{children:[Q.jsx("dt",{className:"text-fg-muted mb-1",children:"Signal"}),Q.jsx($,{mode:"popLayout",initial:!1,children:Q.jsxs(y.dd,{className:"flex items-center gap-2",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[Q.jsx(je,{rssi:w.rssi,snr:w.snr,validated:be(w)}),Q.jsx("span",{className:"font-medium text-fg-primary",children:ke(w.rssi)})]},h)})]}),Q.jsxs("div",{children:[Q.jsx("dt",{className:"text-fg-muted mb-1",children:"RF"}),Q.jsx($,{mode:"popLayout",initial:!1,children:Q.jsxs(y.dd,{className:"type-data text-fg-secondary",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[null==(o=dt(w,"rssi"))?void 0:o.text,(()=>{const e=dt(w,"snr");return e?` · ${e.text}`:null})()]},h)})]})]})}),ne&&(ne.name||ne.hash)&&!xe&&Q.jsxs("div",{className:"radius-inset bg-subtle-fill overflow-hidden",children:[Q.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-edge-subtle",children:[Q.jsx("span",{className:"type-micro text-fg-muted",children:"Source"}),Q.jsx(i,{color:ne.isRepeater?"blue":ne.isCompanion?"violet":"room_server"===ne.type?"lime":"zinc",compact:!0,children:"room_server"===ne.type?"room server":ne.type})]}),Q.jsxs("div",{className:"p-4 space-y-2",children:[ne.name&&Q.jsxs("div",{className:"flex items-center gap-2",children:[Q.jsx(Ze,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),Q.jsx("span",{className:"type-label text-fg-primary truncate",children:ne.name}),!ne.confident&&Q.jsx("span",{className:"text-[10px] text-fg-muted/60 italic",children:"ambiguous"})]}),ne.hash&&Q.jsxs("div",{className:"flex items-center gap-2",children:[Q.jsx(Ie,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),Q.jsxs("span",{className:"text-[11px] font-mono text-fg-muted truncate",children:[ne.hash.startsWith("0x")?ne.hash.slice(2,10):ne.hash.slice(0,8),"…"]})]})]})]}),xe&&Q.jsxs("div",{className:"radius-inset bg-subtle-fill overflow-hidden",children:[Q.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-edge-subtle",children:[Q.jsx("span",{className:"type-micro text-fg-muted",children:"Advertiser"}),Q.jsx(i,{color:"lime",compact:!0,children:xe.nodeType})]}),Q.jsxs("div",{className:"p-4 space-y-2.5",children:[xe.name&&Q.jsxs("div",{className:"flex items-center gap-2",children:[Q.jsx(Ze,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),Q.jsx("span",{className:"type-label text-fg-primary truncate",children:xe.name})]}),xe.latitude&&xe.longitude&&Q.jsxs("div",{className:"flex items-center gap-2",children:[Q.jsx(Pe,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),Q.jsxs("span",{className:"type-data-xs text-fg-secondary",children:[xe.latitude.toFixed(5),", ",xe.longitude.toFixed(5)]})]}),Q.jsxs("div",{className:"flex items-center gap-2",children:[Q.jsx(Ie,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),Q.jsxs("span",{className:"text-[11px] font-mono text-fg-muted truncate",children:[xe.publicKey.slice(0,16),"...",xe.publicKey.slice(-8)]})]}),xe.timestamp>0&&Q.jsxs("div",{className:"flex items-center gap-2",children:[Q.jsx(Ne,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),Q.jsx("span",{className:"text-xs text-fg-muted",children:he(xe.timestamp)})]}),Q.jsxs("div",{className:"flex items-center gap-2",children:[Q.jsx(d,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),Q.jsx("span",{className:"text-[11px] text-fg-muted",children:xe.flagsDescription||`Flags: 0x${xe.flags.toString(16).padStart(2,"0")}`})]})]})]}),ce&&ce.pathHashes.length>0&&Q.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[Q.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[Q.jsx("span",{className:"type-micro text-fg-muted",children:"Trace Route"}),Q.jsxs("div",{className:"flex items-center gap-1.5",children:[Q.jsx(i,{color:ce.isComplete?"green":"amber",compact:!0,children:ce.isComplete?"Complete":"In Progress"}),Q.jsxs(i,{color:"teal",compact:!0,children:[ce.pathHashes.length,"h"]})]})]}),Q.jsx(at,{packet:w,neighbors:ee,localHash:null==H?void 0:H.local_hash,neighborAffinity:se,ghostPrefixes:I,direction:"flowchart",compact:!0,overridePath:ce.pathHashes,traceSnr:ce.snrValues})]}),Y&&!ce&&Q.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[Q.jsxs("div",{className:"flex items-center justify-between px-4 py-2",children:[Q.jsx("span",{className:"type-micro text-fg-muted",children:"Path"}),Q.jsxs(i,{color:"zinc",compact:!0,children:[J.length,"h"]})]}),Q.jsx(at,{packet:w,neighbors:ee,localHash:null==H?void 0:H.local_hash,neighborAffinity:se,ghostPrefixes:I,direction:"flowchart",compact:!0,traceSnr:oe})]})]})]})]})]})]})});function ut({label:e,numericValue:s,unit:t,icon:a,subtext:n,showSign:r=!1}){return Q.jsxs("div",{className:"radius-inner p-3 sm:radius-inset sm:p-4 bg-subtle-fill ring-1 ring-inset ring-edge-subtle",children:[Q.jsx("div",{className:"mb-1.5 sm:mb-2",children:Q.jsx("span",{className:"text-xs sm:type-micro text-fg-muted",children:e})}),Q.jsxs("div",{className:"flex items-center gap-2",children:[Q.jsx(Ae,{value:s,format:{minimumFractionDigits:1,maximumFractionDigits:1,signDisplay:r?"always":"auto"},className:"type-data-hero tracking-tight text-fg-primary"}),Q.jsxs("div",{className:"flex flex-col items-center justify-center",children:[Q.jsx(a,{className:"w-[14px] h-[14px] text-fg-muted"}),t&&Q.jsx("span",{className:"text-xs font-medium leading-tight text-fg-muted",children:t})]})]}),n&&Q.jsx("p",{className:"mt-1.5 sm:mt-2 type-data-xs sm:text-[11px] text-fg-muted/80 truncate",children:n})]})}function gt({snr:e}){const s=e>=5?"bg-sys-teal":e>=0?"bg-sys-green":e>=-5?"bg-sys-amber":e>=-10?"bg-sys-orange":"bg-sys-red";return Q.jsx("span",{className:G("w-1.5 h-1.5 rounded-full flex-shrink-0",s),title:`SNR: ${e.toFixed(1)} dB`})}function ft({fromPrefix:e,toPrefix:s,fromName:t,toName:a,snr:n,maxSnr:r,isWeakest:l,isStrongest:c,index:d=0}){const o=Math.max(r+5,15),x=Math.max(0,Math.min(100,(n- -20)/(o- -20)*100)),m="bg-[#0074BE]",p=n>=5?"bg-sys-teal":n>=0?"bg-sys-green":n>=-5?"bg-sys-amber":n>=-10?"bg-sys-orange":"bg-sys-red",h=.3+.15*d;return Q.jsxs("div",{className:"relative p-3 pl-5 radius-inner bg-subtle-fill ring-1 ring-inset ring-edge-subtle",children:[Q.jsx("span",{className:G("absolute left-0 top-1/2 -translate-y-1/2 h-4 w-0.5 rounded-full",p)}),Q.jsx("span",{className:"absolute -top-0.5 -right-0.5",children:Q.jsx(gt,{snr:n})}),Q.jsxs("div",{className:"sm:hidden",children:[Q.jsxs("div",{className:"flex items-center justify-between mb-1",children:[Q.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[Q.jsx("span",{className:"text-[13px] font-medium text-fg-secondary truncate",children:t||e}),Q.jsx(ye,{className:"w-3 h-3 text-fg-muted flex-shrink-0"}),Q.jsx("span",{className:"text-[13px] font-semibold text-fg-primary truncate",children:a||s})]}),Q.jsxs("div",{className:"flex items-center gap-1.5 ml-2 flex-shrink-0",children:[l&&Q.jsx(i,{color:"red",compact:!0,children:"Low"}),c&&!l&&Q.jsxs(i,{color:"amber",compact:!0,children:[Q.jsx(Je,{className:"w-2.5 h-2.5"}),"Best"]}),Q.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[12px] font-mono font-bold tabular-nums bg-subtle-fill-hover text-fg-primary ring-1 ring-inset ring-edge-subtle",children:[n>=0?"+":"−",Math.abs(n).toFixed(1)]})]})]}),Q.jsx("div",{className:"h-1.5 bg-subtle-fill-strong rounded-full overflow-hidden",children:Q.jsx(y.div,{className:G("h-full rounded-full",m),initial:{width:0},animate:{width:`${x}%`},transition:{duration:1.5,delay:h,ease:[.25,.1,.25,1]}})})]}),Q.jsxs("div",{className:"hidden sm:block",children:[Q.jsxs("div",{className:"flex items-center justify-between mb-2",children:[Q.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[Q.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[Q.jsx("code",{className:"type-data-xs text-fg-muted",children:e}),t&&Q.jsx("span",{className:"text-xs text-fg-secondary truncate max-w-[100px]",children:t})]}),Q.jsx(ye,{className:"w-3 h-3 text-fg-muted/40 flex-shrink-0"}),Q.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[Q.jsx("code",{className:"font-mono text-xs font-semibold text-fg-primary",children:s}),a&&Q.jsx("span",{className:"text-xs text-fg-secondary truncate max-w-[100px]",children:a})]})]}),Q.jsxs("div",{className:"flex items-center gap-1.5",children:[l&&Q.jsx(i,{color:"red",compact:!0,children:"Bottleneck"}),c&&!l&&Q.jsxs(i,{color:"amber",compact:!0,children:[Q.jsx(Je,{className:"w-3 h-3"}),"Strongest"]}),Q.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-sm font-mono font-semibold tabular-nums bg-subtle-fill-hover text-fg-primary ring-1 ring-inset ring-edge-subtle",children:[n>=0?"+":"−",Math.abs(n).toFixed(1)]})]})]}),Q.jsx("div",{className:"h-1.5 bg-elevated rounded-full overflow-hidden",children:Q.jsx(y.div,{className:G("h-full rounded-full",m),initial:{width:0},animate:{width:`${x}%`},transition:{duration:1.5,delay:h,ease:[.25,.1,.25,1]}})})]})]})}function yt(e,s){if("You"===e)return"You";const t=e.toUpperCase();for(const[a,n]of Object.entries(s))if((a.startsWith("0x")?a.slice(2,4):a.slice(0,2)).toUpperCase()===t)return n.name||n.node_name||void 0}const jt=O.memo(function({report:e,onClose:s}){var t,a;const n=M(),r=(null==n?void 0:n.neighbors)??{},l=(null==(t=null==n?void 0:n.config)?void 0:t.repeater)?{latitude:n.config.repeater.latitude,longitude:n.config.repeater.longitude,name:n.config.node_name||"Local Node"}:void 0,c=null==(a=e.bestObservation)?void 0:a.decoded.snrValues,d=e.linkQuality?e.linkQuality.avgSnr>=5?"excellent":e.linkQuality.avgSnr>=0?"good":e.linkQuality.avgSnr>=-5?"fair":"poor":"unknown",o={excellent:"var(--signal-excellent)",good:"var(--signal-good)",fair:"var(--signal-fair)",poor:"var(--signal-poor)",unknown:"var(--fg-muted)"}[d];return Q.jsxs(z,{open:!0,onClose:s,size:"5xl",motionPlus:!0,children:[Q.jsxs("div",{className:"sm:hidden",children:[Q.jsx("div",{className:"flex justify-center pt-2 pb-1",children:Q.jsx("div",{className:"w-9 h-1 rounded-full bg-fg-primary/30","aria-hidden":"true"})}),Q.jsxs("div",{className:"flex items-center justify-between px-4 pb-2",children:[Q.jsx("h2",{className:"font-semibold text-[17px] text-fg-primary",children:"Trace Report"}),Q.jsx("button",{onClick:s,className:"text-[17px] font-medium text-sys-blue active:text-sys-blue/80",children:"Done"})]})]}),Q.jsx("div",{className:"sm:hidden h-[2px]",style:{backgroundColor:o,opacity:.6}}),Q.jsx("div",{className:"hidden sm:block px-6 pt-5 pb-4",children:Q.jsxs("div",{className:"flex items-start justify-between gap-3",children:[Q.jsxs("div",{className:"flex-1 min-w-0",children:[Q.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[Q.jsx("h2",{className:"type-micro",children:"Trace Report"}),Q.jsxs(i,{color:"excellent"===d||"good"===d?"green":"fair"===d?"amber":"red",children:[Q.jsx(Ye,{className:"w-3 h-3 mr-1"}),"excellent"===d?"Excellent":"good"===d?"Good":"fair"===d?"Fair":"Poor"]})]}),Q.jsx("p",{className:"mt-1 text-xs sm:text-sm font-mono text-fg-muted tabular-nums",children:e.traceTag})]}),Q.jsx("button",{onClick:s,className:"p-1.5 -m-1.5 text-fg-muted hover:text-fg-primary transition-base radius-inner hover:bg-elevated flex-shrink-0",children:Q.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:Q.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})}),Q.jsxs("div",{className:"hidden sm:flex flex-wrap items-center gap-1.5 sm:gap-2 px-4 sm:px-6 pb-3 sm:pb-4 border-b border-edge-subtle",children:[Q.jsxs(i,{color:"teal",children:[Q.jsx("span",{className:"font-mono tabular-nums",children:e.targetHopCount}),Q.jsxs("span",{className:"ml-1",children:["hop",1!==e.targetHopCount?"s":""]})]}),Q.jsxs(i,{color:"zinc",children:[Q.jsx("span",{className:"font-mono tabular-nums",children:e.observationCount}),Q.jsx("span",{className:"ml-1",children:"obs"})]}),e.linkQuality&&Q.jsxs(i,{color:"indigo",children:[Q.jsx("span",{className:"font-mono tabular-nums",children:e.linkQuality.avgSnr.toFixed(1)}),Q.jsx("span",{className:"ml-1",children:"dB avg"})]}),Q.jsx("span",{className:"type-data-xs text-fg-muted",children:U(e.duration)}),e.linkQuality&&Q.jsxs(Q.Fragment,{children:[Q.jsx("span",{className:"text-fg-muted/40",children:"•"}),Q.jsxs("div",{className:"flex items-center gap-1.5",children:[Q.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-xs font-medium bg-sys-red/15 text-sys-red ring-1 ring-inset ring-sys-red/25",children:[Q.jsx("span",{className:"opacity-70",children:"Min"}),Q.jsx("span",{className:"font-mono tabular-nums",children:e.linkQuality.minSnr.toFixed(1)})]}),Q.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-xs font-medium bg-sys-teal/15 text-sys-teal ring-1 ring-inset ring-sys-teal/25",children:[Q.jsx("span",{className:"opacity-70",children:"Max"}),Q.jsx("span",{className:"font-mono tabular-nums",children:e.linkQuality.maxSnr.toFixed(1)})]})]})]})]}),Q.jsxs(R,{className:"p-0 overflow-hidden",children:[Q.jsx("div",{className:"md:hidden h-[75vh] max-h-[calc(100vh-80px)] overflow-y-auto overflow-x-hidden",children:Q.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.linkQuality&&Q.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[Q.jsxs("div",{className:"radius-inner bg-subtle-fill ring-1 ring-inset ring-edge-subtle p-2.5 text-center",children:[Q.jsx(Ae,{value:Math.abs(e.linkQuality.minSnr),format:{maximumFractionDigits:0,signDisplay:"never"},prefix:e.linkQuality.minSnr<0?"-":"",className:"text-[20px] font-bold font-mono tabular-nums flex items-center justify-center text-fg-primary"}),Q.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[Q.jsx(Me,{className:"w-2.5 h-2.5 text-fg-muted"}),Q.jsx("span",{className:"text-xs text-fg-muted",children:"Min dB"})]})]}),Q.jsxs("div",{className:"radius-inner bg-subtle-fill ring-1 ring-inset ring-edge-subtle p-2.5 text-center",children:[Q.jsx(Ae,{value:e.linkQuality.maxSnr,format:{maximumFractionDigits:0,signDisplay:"always"},className:"text-[20px] font-bold font-mono text-fg-primary tabular-nums flex items-center justify-center"}),Q.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[Q.jsx(Ee,{className:"w-2.5 h-2.5 text-fg-muted"}),Q.jsx("span",{className:"text-xs text-fg-muted",children:"Max dB"})]})]})]}),Q.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[Q.jsxs(i,{color:"excellent"===d||"good"===d?"green":"fair"===d?"amber":"red",compact:!0,children:[Q.jsx(Ye,{className:"w-2.5 h-2.5 mr-0.5"}),"excellent"===d?"Excellent":"good"===d?"Good":"fair"===d?"Fair":"Poor"]}),Q.jsxs(i,{color:"teal",compact:!0,children:[e.targetHopCount," hops"]}),Q.jsxs(i,{color:"zinc",compact:!0,children:[e.observationCount," obs"]}),Q.jsx("span",{className:"type-data-xs text-fg-muted ml-auto",children:e.traceTag.slice(0,8)})]}),e.targetPath.length>0&&Q.jsx("div",{className:"overflow-hidden radius-inset",children:Q.jsx("div",{className:"aspect-[4/3] w-full",children:Q.jsx(_s,{path:e.targetPath,neighbors:r,localNode:l,localHash:null==n?void 0:n.local_hash,srcHash:e.srcHash,dstHash:e.dstHash,traceSnr:c})})}),Q.jsxs("div",{className:"radius-inset bg-body overflow-hidden",children:[Q.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-edge-subtle",children:[Q.jsx("span",{className:"text-[11px] font-medium text-fg-secondary",children:"Route Path"}),e.linkQuality&&Q.jsxs("span",{className:"type-data-xs text-fg-muted",children:["SNR ",e.linkQuality.minSnr.toFixed(1)," → ",e.linkQuality.maxSnr.toFixed(1)," dB"]})]}),e.bestObservation?Q.jsx(at,{packet:e.bestObservation.packet,neighbors:r,localHash:null==n?void 0:n.local_hash,direction:"flowchart",compact:!0,overridePath:e.targetPath,traceSnr:e.bestObservation.decoded.snrValues}):Q.jsx("div",{className:"p-6 text-center text-fg-muted text-xs",children:"No path data available"})]}),Q.jsxs("div",{children:[Q.jsxs("h3",{className:"type-micro text-fg-muted mb-2",children:["Link Quality · ",e.hopStats.length," hops"]}),Q.jsx("div",{className:"space-y-1.5",children:e.hopStats.length>0?e.hopStats.map((s,t)=>{var a,n,l;const i=t<e.targetPath.length-1?e.targetPath[t+1]:"You",c=yt(s.prefix,r),d=yt(i,r);return Q.jsx(ft,{fromPrefix:s.prefix,toPrefix:i,fromName:c,toName:d,snr:s.snr,maxSnr:(null==(a=e.linkQuality)?void 0:a.maxSnr)??10,isWeakest:(null==(n=e.linkQuality)?void 0:n.weakestLinkPosition)===t,isStrongest:(null==(l=e.linkQuality)?void 0:l.strongestLinkPosition)===t,index:t},`${s.prefix}-${t}`)}):Q.jsx("div",{className:"text-xs text-fg-muted py-6 text-center",children:"No link data collected"})})]}),Q.jsx("div",{className:"pt-1 pb-2 text-center",children:Q.jsxs("span",{className:"text-xs text-fg-muted",children:["Traced ",H(e.firstSeen)]})})]})}),Q.jsxs("div",{className:"hidden md:flex md:flex-row h-[70vh] max-h-[calc(100vh-200px)] overflow-hidden",children:[Q.jsx("div",{className:"w-1/2 flex flex-col min-w-0 min-h-0 overflow-hidden border-r border-edge-subtle",children:Q.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.linkQuality&&(()=>{const s=e.targetPath[e.linkQuality.weakestLinkPosition],t=e.targetPath[e.linkQuality.weakestLinkPosition+1]||"You",a=yt(s,r),n=yt(t,r),l=e.targetPath[e.linkQuality.strongestLinkPosition],i=e.targetPath[e.linkQuality.strongestLinkPosition+1]||"You",c=yt(l,r),d=yt(i,r);return Q.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[Q.jsx(ut,{label:"Weakest Link",numericValue:e.linkQuality.minSnr,unit:"dB",icon:Me,subtext:`${a||s} → ${n||t}`}),Q.jsx(ut,{label:"Best Link",numericValue:e.linkQuality.maxSnr,showSign:!0,unit:"dB",icon:Ee,subtext:`${c||l} → ${d||i}`})]})})(),Q.jsxs("div",{children:[Q.jsx("h3",{className:"type-micro text-fg-muted mb-3",children:"Link Details"}),Q.jsx("div",{className:"space-y-2",children:e.hopStats.length>0?e.hopStats.map((s,t)=>{var a,n,l;const i=t<e.targetPath.length-1?e.targetPath[t+1]:"You",c=yt(s.prefix,r),d=yt(i,r);return Q.jsx(ft,{fromPrefix:s.prefix,toPrefix:i,fromName:c,toName:d,snr:s.snr,maxSnr:(null==(a=e.linkQuality)?void 0:a.maxSnr)??10,isWeakest:(null==(n=e.linkQuality)?void 0:n.weakestLinkPosition)===t,isStrongest:(null==(l=e.linkQuality)?void 0:l.strongestLinkPosition)===t,index:t},`${s.prefix}-${t}`)}):Q.jsx("div",{className:"text-xs text-fg-muted py-8 text-center",children:"No link data collected"})})]}),Q.jsxs("div",{className:"pt-2 text-center",children:[Q.jsx("span",{className:"text-xs text-fg-muted",children:"Traced "}),Q.jsx("span",{className:"type-data-xs text-fg-muted",children:H(e.firstSeen)})]})]})}),Q.jsxs("div",{className:"w-1/2 min-w-0 overflow-y-auto p-3 space-y-2",children:[e.targetPath.length>0&&Q.jsx("div",{className:"overflow-hidden",children:Q.jsx("div",{className:"aspect-square w-full",children:Q.jsx(_s,{path:e.targetPath,neighbors:r,localNode:l,localHash:null==n?void 0:n.local_hash,srcHash:e.srcHash,dstHash:e.dstHash,traceSnr:c})})}),Q.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[Q.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[Q.jsx("span",{className:"type-micro text-fg-muted",children:"Trace Route"}),Q.jsxs("div",{className:"flex items-center gap-1.5",children:[Q.jsx(i,{color:e.isComplete?"green":"amber",compact:!0,children:e.isComplete?"Complete":`${e.maxHopsObserved}/${e.targetHopCount}`}),Q.jsxs(i,{color:"teal",compact:!0,children:[e.targetHopCount," hop",1!==e.targetHopCount?"s":""]})]})]}),e.linkQuality&&e.bestObservation&&Q.jsxs("div",{className:"flex items-center gap-4 px-4 pb-2 type-data-xs text-fg-muted",children:[Q.jsxs("span",{children:[Q.jsx("span",{className:"opacity-60",children:"Tag"})," ",Q.jsx("code",{className:"text-sys-teal tabular-nums",children:e.traceTag.slice(0,8)})]}),Q.jsxs("span",{children:[Q.jsx("span",{className:"opacity-60",children:"SNR"})," ",Q.jsxs("code",{className:"text-sys-indigo tabular-nums",children:[e.linkQuality.minSnr.toFixed(1),"–",e.linkQuality.maxSnr.toFixed(1)]}),Q.jsx("span",{className:"opacity-60",children:" dB"})]})]}),e.bestObservation?Q.jsx(at,{packet:e.bestObservation.packet,neighbors:r,localHash:null==n?void 0:n.local_hash,direction:"flowchart",compact:!0,overridePath:e.targetPath,traceSnr:e.bestObservation.decoded.snrValues}):Q.jsx("div",{className:"p-8 text-center text-fg-muted text-xs",children:"No path data available"})]})]})]})]})]})}),bt=[{target:"PacketList",fn:"type",minStage:1},{target:"PacketList",fn:"route",minStage:1},{target:"PacketList",fn:"rssi",minStage:1},{target:"PacketList",fn:"snr",minStage:1},{target:"PacketList",fn:"path",minStage:1,when:te},{target:"PacketList",fn:"src_hash",minStage:1,when:ae},{target:"PacketList",fn:"text",minStage:1,when:ne},{target:"PacketList",fn:"ack",minStage:1,when:re},{target:"PacketList",fn:"decrypt",minStage:2,when:le},{target:"PacketList",fn:"duplicates",minStage:1}];se(bt);const Nt="(min-width: 640px)";let vt=null;function kt(e){return"undefined"==typeof window?()=>{}:(vt||(vt=window.matchMedia(Nt)),vt.addEventListener("change",e),()=>null==vt?void 0:vt.removeEventListener("change",e))}function wt(){return"undefined"==typeof window||(vt||(vt=window.matchMedia(Nt)),vt.matches)}function Ct(e){if(!e||e.length<6)return null;const s=e,t=parseInt(s.slice(0,2),16);if(isNaN(t))return null;const a=3&t;let n=2;if(0!==a&&3!==a||(n=10),n+2>s.length)return null;const r=parseInt(s.slice(n,n+2),16);if(isNaN(r))return null;if(n+=2+2*r,n>=s.length)return null;const l=s.slice(n);return l.length>=38?l.slice(0,38):l}function _t({message:e}){return Q.jsxs("div",{className:"flex flex-col items-center justify-center py-14 text-center",children:[Q.jsx(d,{className:"size-6 text-fg-muted mb-2"}),Q.jsx("p",{className:"text-sm text-fg-primary",children:e}),Q.jsx("p",{className:"text-xs text-fg-muted",children:"Packets will appear here"})]})}function St(){return Q.jsx("div",{className:"py-14 text-center text-sm text-fg-muted",children:"Loading packets…"})}function Ht({showPagination:e,currentPage:s,perPage:t,displayCount:a,totalCount:n,action:r}){const l=e?(s-1)*t+1:1,i=e?Math.min(s*t,n):a;return Q.jsxs("div",{className:"flex items-center justify-between gap-4 border-t border-edge-subtle px-4 py-3 text-xs text-fg-muted sm:px-6",children:[Q.jsxs("span",{children:["Showing"," ",Q.jsx("span",{className:"font-medium text-fg-secondary",children:e?`${l}–${i}`:a})," ","of"," ",Q.jsx("span",{className:"font-medium text-fg-secondary",children:n})," ","packets"]}),r]})}function Pt({packets:e,allPackets:s,localHash:t,neighbors:a,loading:n=!1,maxPackets:r,perPage:l=50,showPagination:i=!1,onPacketSelect:c,flashNewest:d=!1,emptyMessage:o="No packets found",className:x,footerAction:m,hideDupes:p=!1,getDecodedContent:h,onChannelClick:u,resolveSource:g,virtualized:f=!0}){ee(bt);const[y,j]=O.useState(null),[b,N]=O.useState(null),[v,k]=O.useState({traceTag:null,dupeGroup:null}),w=O.useRef(null),C=Ue(e=>e.setModalMapOpen);O.useEffect(()=>(C(!!y),()=>C(!1)),[y,C]),O.useLayoutEffect(()=>{k({traceTag:null,dupeGroup:null})},[e]);const _=s??e,S=O.useMemo(()=>r&&r>0&&!p?e.slice(0,r):e,[e,r,p]),H=O.useMemo(()=>{if(!p)return null;const e=function(e){if(0===e.length)return[];const s=[];let t=0;for(;t<e.length;){const a=e[t],n=a.packet_hash;let r=1;if(n)for(;t+r<e.length&&e[t+r].packet_hash===n;)r++;s.push({packet:a,dupeCount:r}),t+=r}return s}(S),s=function(e){if(e.length<=1)return e;const s=new Map,t=new Map,a=new Map;for(let l=0;l<e.length;l++){const{packet:n}=e[l],r=n.payload_type??n.type;if(r!==I.GRP_TXT)continue;const i=n._payloadHexPrefix??Ct(n.raw_packet);if(i){const e=s.get(i);if(void 0!==e){a.set(l,e);continue}s.set(i,l)}const c=`${r}:${n.payload_length??n.length??0}:${Math.floor((n.timestamp??0)/60)}`;if(!i){const e=t.get(c);if(void 0!==e){a.set(l,e);continue}}t.has(c)||t.set(c,l)}if(0===a.size)return e;const n=new Map;for(const[l,i]of a)n.set(i,(n.get(i)??0)+e[l].dupeCount);const r=[];for(let l=0;l<e.length;l++){if(a.has(l))continue;const s=n.get(l)??0;r.push(s>0?{packet:e[l].packet,dupeCount:e[l].dupeCount+s}:e[l])}return r}(e);return r&&r>0?s.slice(0,r):s},[S,p,r]),P=H?H.length:S.length,{currentPage:T,totalPages:M,goToPage:B,pageRange:F}=function(e,s,t){const[a,n]=O.useState(1),r=t?Math.ceil(e/s):1;O.useEffect(()=>{a>r&&r>0&&queueMicrotask(()=>n(1))},[r,a]);const l=O.useCallback(e=>n(Math.max(1,Math.min(e,r))),[r]),i=O.useMemo(()=>function(e,s,t=1){if(s<=7)return Array.from({length:s},(e,s)=>s+1);const a=Math.max(e-t,1),n=Math.min(e+t,s),r=a>2,l=n<s-1;if(!r&&l){const e=3+2*t;return[...Array.from({length:e},(e,s)=>s+1),"gap",s]}if(r&&!l){const e=3+2*t;return[1,"gap",...Array.from({length:e},(t,a)=>s-e+a+1)]}return[1,"gap",...Array.from({length:n-a+1},(e,s)=>a+s),"gap",s]}(a,r),[a,r]);return{currentPage:a,totalPages:r,goToPage:l,pageRange:i}}(P,l,i),L=O.useMemo(()=>{if(p)return S;if(!i)return S;const e=(T-1)*l;return S.slice(e,e+l)},[S,i,T,l,p]),D=O.useMemo(()=>{if(!H)return null;if(!i)return H;const e=(T-1)*l;return H.slice(e,e+l)},[H,i,T,l]),z=O.useMemo(()=>function(e){const s=new Map;for(const t of e)if((t.payload_type??t.type)===I.TRACE&&t.packet_hash){const e=t._traceTag??(t.payload?Y(t.payload):null);e&&s.set(t.packet_hash,e)}return s}(L),[L]),R=O.useMemo(()=>function(e){const s=new Map;if(0===e.length)return s;for(let t=0;t<e.length;t++){const a=e[t].packet_hash;if(!a)continue;const n=e[t-1],r=e[t+1],l=(null==n?void 0:n.packet_hash)===a,i=(null==r?void 0:r.packet_hash)===a;(l||i)&&(l&&i?s.set(t,"middle"):l?s.set(t,"last"):i&&s.set(t,"first"))}return s}(L),[L]),$=function(e,s){const[t,a]=O.useState(null),n=O.useRef(0);return O.useEffect(()=>{var t,r;if(!s||!e.length)return;const l=(null==(t=e[0])?void 0:t.timestamp)??0,i=l>n.current&&n.current>0;if(n.current=l,!i)return;const c=null==(r=e[0])?void 0:r.packet_hash;if(!c)return;const d=requestAnimationFrame(()=>a(c)),o=setTimeout(()=>a(null),600);return()=>{cancelAnimationFrame(d),clearTimeout(o)}},[e,s]),t}(e,d),A=O.useSyncExternalStore(kt,wt,()=>!0),E=O.useMemo(()=>p&&D?D:L,[p,D,L]),U=f&&E.length>100,V=A?48:72,W=q({count:U?E.length:0,getScrollElement:()=>w.current,estimateSize:()=>V,overscan:5}),K=O.useCallback((e,s)=>{var t,a;const n=e.packet_hash;if(!n)return[e];let r=s;for(;r>0&&(null==(t=L[r-1])?void 0:t.packet_hash)===n;)r--;let l=s;for(;l<L.length-1&&(null==(a=L[l+1])?void 0:a.packet_hash)===n;)l++;return r===l?[e]:L.slice(r,l+1)},[L]),X=O.useCallback(e=>{var s,t;const a=null==(s=L[e])?void 0:s.packet_hash;if(!a)return e;let n=e;for(;n>0&&(null==(t=L[n-1])?void 0:t.packet_hash)===a;)n--;return n},[L]),se=O.useCallback(e=>{var s,t;const a=null==(s=L[e])?void 0:s.packet_hash;if(!a)return e;let n=e;for(;n<L.length-1&&(null==(t=L[n+1])?void 0:t.packet_hash)===a;)n++;return n},[L]),te=O.useCallback((e,s)=>{if(c)c(e);else if(void 0!==s){const t=K(e,s),a=t.indexOf(e);j({packets:t,initialIndex:a>=0?a:0,rowIndex:s})}else j({packets:[e],initialIndex:0,rowIndex:0})},[c,K]),ae=O.useCallback(()=>{if(!y)return;const e=X(y.rowIndex)-1;if(e<0)return;const s=L[e];if(!s)return;const t=K(s,e);j({packets:t,initialIndex:0,rowIndex:e})},[y,L,X,K]),ne=O.useCallback(()=>{if(!y)return;const e=se(y.rowIndex)+1;if(e>=L.length)return;const s=L[e];if(!s)return;const t=K(s,e);j({packets:t,initialIndex:0,rowIndex:e})},[y,L,se,K]),re=O.useMemo(()=>!!y&&X(y.rowIndex)>0,[y,X]),le=O.useMemo(()=>!!y&&se(y.rowIndex)<L.length-1,[y,se,L.length]),ie=O.useCallback(e=>k(s=>({...s,traceTag:e})),[]),ce=O.useCallback(e=>k(s=>({...s,dupeGroup:e})),[]),de=O.useCallback(()=>{k({traceTag:null,dupeGroup:null})},[]),oe=O.useCallback(e=>{const s=_.filter(s=>(s.payload_type??s.type)===I.TRACE&&s.payload&&Y(s.payload)===e);if(0===s.length)return;const t=J(s).get(e);(null==t?void 0:t.length)&&N(Z(e,t))},[_]),xe=O.useCallback(e=>{const s=_.find(s=>s.packet_hash===e);s&&(N(null),te(s))},[_,te]),me=O.useCallback((e,s,n)=>{const r=A?bs:Ns;if(n){const{packet:n,dupeCount:l}=e,i=n.packet_hash?z.get(n.packet_hash):void 0,c=null!==v.traceTag&&i===v.traceTag;return Q.jsx(r,{packet:n,onClick:e=>te(e,s),localHash:t,neighbors:a,resolveSource:g,isFlashing:d&&$===n.packet_hash,traceTag:i,isTraceHighlighted:c,onTraceHover:ie,onViewTraceReport:oe,dupeCount:l,getDecodedContent:h,onChannelClick:u},`${n.packet_hash}_${n.timestamp}_${s}`)}const l=e,i=l.packet_hash?z.get(l.packet_hash):void 0,c=null!==v.traceTag&&i===v.traceTag,o=R.get(s),x=void 0!==o&&null!==v.dupeGroup&&l.packet_hash===v.dupeGroup;return Q.jsx(r,{packet:l,onClick:e=>te(e,s),localHash:t,neighbors:a,resolveSource:g,isFlashing:d&&$===l.packet_hash,traceTag:i,isTraceHighlighted:c,onTraceHover:ie,onViewTraceReport:oe,dupeGroupPosition:o,isDupeGroupHovered:x,onDupeGroupHover:ce,getDecodedContent:h,onChannelClick:u},`${l.packet_hash}_${l.timestamp}_${s}`)},[A,z,v.traceTag,v.dupeGroup,te,t,a,g,d,$,ie,oe,R,ce,h,u]);return Q.jsxs("div",{className:G("flex flex-col",x),onMouseLeave:de,children:[U?Q.jsx("div",{ref:w,className:"divide-y divide-edge-subtle overflow-auto",style:{maxHeight:600},children:(()=>{if(n&&0===e.length)return Q.jsx(St,{});if(0===E.length)return Q.jsx(_t,{message:o});const s=p&&null!==D,t=W.getVirtualItems();return Q.jsx("div",{style:{height:`${W.getTotalSize()}px`,width:"100%",position:"relative"},children:t.map(e=>{const t=E[e.index];return Q.jsx("div",{"data-index":e.index,ref:W.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${e.start}px)`},children:me(t,e.index,s)},e.key)})})})()}):Q.jsx("div",{className:"divide-y divide-edge-subtle py-1",children:(()=>{if(n&&0===e.length)return Q.jsx(St,{});if(0===L.length)return Q.jsx(_t,{message:o});const s=p&&null!==D;return(s?D:L).map((e,t)=>me(e,t,s))})()}),i&&M>1&&Q.jsx("nav",{className:"border-t border-edge-subtle px-4 py-3",children:Q.jsxs(ts,{className:"justify-center",children:[Q.jsx(as,{onClick:()=>B(T-1),disabled:1===T}),Q.jsx(rs,{children:F.map((e,s)=>"gap"===e?Q.jsx(is,{},`gap-${s}`):Q.jsx(ls,{page:e,current:e===T,onClick:B},e))}),Q.jsx(ns,{onClick:()=>B(T+1),disabled:T===M})]})}),Q.jsx(Ht,{showPagination:i,currentPage:T,perPage:l,displayCount:D?D.length:L.length,totalCount:i?P:e.length,action:m}),!c&&y&&Q.jsx(ht,{packets:y.packets,initialIndex:y.initialIndex,onClose:()=>j(null),onNavigatePrev:ae,onNavigateNext:ne,hasPrev:re,hasNext:le,resolveSource:g}),b&&Q.jsx(jt,{report:b,onClose:()=>N(null),onViewPacket:xe})]})}export{us as C,Pt as P,Ye as S,Je as T,Ge as a,ms as g,cs as u};
