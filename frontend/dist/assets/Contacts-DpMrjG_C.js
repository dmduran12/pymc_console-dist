const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ContactsMapMapLibre-Z0Ee3_4F.js","assets/index-CLi6xczL.js","assets/recharts-bmHCCfxU.js","assets/maplibre-gl-CFO9X1Ek.js","assets/index-CqOtDftZ.css","assets/maplibre-gl-haoA4z5Y.js","assets/maplibre-gl-B1CfjdFi.css","assets/ConfirmModal-6N9orQPe.js","assets/triangle-alert-CtfeX3hX.js","assets/CollisionExplorerModal-ChC6YKo5.js","assets/leaflet-ClE6qLuu.js","assets/map-pin-BHxLBGAv.js","assets/CollisionExplorerModal-CIGW-MKW.css","assets/loader-circle-BiSCrAz6.js","assets/useThemeColors-aZ327gx7.js","assets/info-D-OJbIcP.js","assets/house-Br0ddgCN.js","assets/refresh-cw-BPBhhAzK.js","assets/map-Dkyc42DP.js","assets/external-link-BG6kqAP_.js","assets/SignalIndicator-C9Bb21cj.js","assets/zap-BMeccDbl.js","assets/activity-BG2a6SBG.js","assets/trending-up-C2PPgLZS.js","assets/HashBadge-Ds68z9zP.js","assets/users-Bu-DfKmx.js","assets/PageLayout-BXoaut2N.js"])))=>i.map(i=>d[i]);
import{c as e,j as t,_ as s,H as a,I as n,B as r,G as c,F as i,C as l,J as o,K as d,M as x,N as h,y as m,O as u,h as p,Q as g,S as j,T as f,g as v,U as N,V as b,R as y,X as w,Y as k}from"./index-CLi6xczL.js";import{b as M,c as C,h as S,T as L,f as H,e as P,L as $}from"./recharts-bmHCCfxU.js";import{a as R}from"./SignalIndicator-C9Bb21cj.js";import{G as F,E as T,C as _,M as E,S as A,a as O,A as z,N as D}from"./CollisionExplorerModal-ChC6YKo5.js";import{T as U,a as W}from"./triangle-alert-CtfeX3hX.js";import{T as K,Z as G,M as V}from"./zap-BMeccDbl.js";import{A as B}from"./activity-BG2a6SBG.js";import{T as I}from"./trending-up-C2PPgLZS.js";import{H as q}from"./HashBadge-Ds68z9zP.js";import{M as Z}from"./map-pin-BHxLBGAv.js";import{U as J}from"./users-Bu-DfKmx.js";import{T as Q,C as Y}from"./ConfirmModal-6N9orQPe.js";import{P as X,a as ee}from"./PageLayout-BXoaut2N.js";import{L as te}from"./loader-circle-BiSCrAz6.js";const se=e("arrow-up-down",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]),ae=e("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),ne=e("file-digit",[["path",{d:"M4 12V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2",key:"jrl274"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 16h2v6",key:"1bxocy"}],["path",{d:"M10 22h4",key:"ceow96"}],["rect",{x:"2",y:"16",width:"4",height:"6",rx:"2",key:"r45zd0"}]]),re=e("ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]),ce=e("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),ie=e("target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);class le extends M.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}render(){var e;return this.state.hasError?t.jsx("div",{className:"map-container-16-9 glass-card flex items-center justify-center",role:"alert","aria-live":"assertive",children:t.jsxs("div",{className:"text-center text-white/50 p-4",children:[t.jsx("p",{className:"text-lg mb-2",children:"Map failed to load"}),t.jsx("p",{className:"text-sm text-white/30",children:(null==(e=this.state.error)?void 0:e.message)||"Unknown error"}),t.jsx("p",{className:"text-xs text-white/20 mt-2",children:"Try refreshing the page or check your browser's WebGL support."})]})}):this.props.children}}const oe=M.lazy(()=>s(()=>import("./ContactsMapMapLibre-Z0Ee3_4F.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26])));function de({neighbors:e,localNode:s,localHash:a,onRemoveNode:n,selectedNodeHash:r,onNodeSelected:c,highlightedEdgeKey:i}){return t.jsx(le,{children:t.jsx(M.Suspense,{fallback:t.jsx("div",{className:"map-container-16-9 glass-card flex items-center justify-center",role:"status","aria-live":"polite","aria-label":"Loading map",children:t.jsxs("div",{className:"text-white/50 flex items-center gap-3",children:[t.jsx("div",{className:"w-5 h-5 border-2 border-accent-primary border-t-transparent rounded-full animate-spin","aria-hidden":"true"}),t.jsx("span",{children:"Loading map..."})]})}),children:t.jsx(oe,{neighbors:e,localNode:s,localHash:a,onRemoveNode:n,selectedNodeHash:r,onNodeSelected:c,highlightedEdgeKey:i})})})}function xe(e){return e>=.7?"text-accent-success":e>=.5?"text-accent-secondary":e>=.3?"text-signal-poor":"text-accent-danger"}function he(e){return`${Math.round(100*e)}%`}function me(e,t){return t.has(e.toUpperCase())}const ue=M.memo(function({path:e,isHighlighted:s,onHighlight:a,ghostPrefixes:n}){const r=function(e){return e>.2?{icon:t.jsx(I,{className:"w-3 h-3"}),color:"text-accent-success"}:e<-.2?{icon:t.jsx(K,{className:"w-3 h-3"}),color:"text-accent-danger"}:{icon:t.jsx(V,{className:"w-3 h-3"}),color:"text-text-muted"}}(e.observationTrend),i=e.weakestLinkKey&&e.weakestLinkConfidence<.5,l=e.hops.some(e=>me(e,n));return t.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-md transition-colors cursor-pointer "+(s?"bg-accent-primary/20 border border-accent-primary/40":"hover:bg-white/5"),onClick:()=>a(s?null:e.weakestLinkKey),children:[t.jsx("div",{className:"flex-shrink-0 w-12 text-center py-1 rounded-md "+(o=e.healthScore,o>=.7?"bg-accent-success/10":o>=.5?"bg-accent-secondary/10":o>=.3?"bg-signal-poor/10":"bg-accent-danger/10"),children:t.jsx("span",{className:`text-xs font-semibold tabular-nums ${xe(e.healthScore)}`,children:he(e.healthScore)})}),t.jsx("div",{className:"flex-1 flex items-center gap-0.5 overflow-x-auto min-w-0",children:e.hops.map((s,a)=>{var r;const l=me(s,n),o=i&&(null==(r=e.weakestLinkKey)?void 0:r.includes(s));return t.jsxs("span",{className:"flex items-center",children:[t.jsxs("span",{className:"text-[10px] font-mono px-1.5 py-0.5 rounded flex items-center gap-0.5 "+(l?"bg-accent-tertiary/20 text-accent-tertiary border border-accent-tertiary/30":o?"bg-accent-danger/20 text-accent-danger":"bg-white/10 text-text-secondary"),children:[l&&t.jsx(c,{className:"w-2.5 h-2.5"}),s]}),a<e.hops.length-1&&t.jsx("span",{className:"text-text-muted mx-0.5",children:"→"})]},a)})}),t.jsxs("div",{className:"flex-shrink-0 flex items-center gap-3",children:[t.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded "+("direct"===e.routeType?"bg-accent-success/20 text-accent-success":"flood"===e.routeType?"bg-accent-primary/20 text-accent-primary":"bg-white/10 text-text-muted"),children:"direct"===e.routeType?"D":"flood"===e.routeType?"F":"M"}),t.jsxs("div",{className:"flex items-center gap-1 text-text-muted",title:"Estimated latency",children:[t.jsx(G,{className:"w-3 h-3"}),t.jsxs("span",{className:"text-[10px] tabular-nums",children:[e.estimatedLatencyMs,"ms"]})]}),t.jsxs("div",{className:"flex items-center gap-1 text-text-muted",title:"Observations",children:[t.jsx(B,{className:"w-3 h-3"}),t.jsx("span",{className:"text-[10px] tabular-nums",children:e.observationCount})]}),t.jsx("div",{className:`flex items-center gap-1 ${r.color}`,title:"Usage trend",children:r.icon}),l&&t.jsx("div",{className:"text-accent-tertiary",title:"Path includes ghost (unknown) nodes",children:t.jsx(c,{className:"w-3 h-3"})}),i&&t.jsx("div",{className:"text-accent-danger",title:`Weak link: ${e.weakestLinkConfidence.toFixed(0)}% confidence`,children:t.jsx(U,{className:"w-3 h-3"})})]})]});var o}),pe=M.memo(function({maxPaths:e=10,onHighlightEdge:s,highlightedEdge:l}){const o=a(),d=n(),x=r(),[h,m]=M.useState(!1),u=M.useMemo(()=>new Set(x.map(e=>e.prefix.toUpperCase())),[x]),p=M.useMemo(()=>o.slice(0,e),[o,e]),g=M.useMemo(()=>0===o.length?null:{avgHealth:o.reduce((e,t)=>e+t.healthScore,0)/o.length,declining:o.filter(e=>e.observationTrend<-.2).length,weakLinks:o.filter(e=>e.weakestLinkConfidence<.5).length,pathsWithGhosts:o.filter(e=>e.hops.some(e=>u.has(e.toUpperCase()))).length},[o,u]),j=e=>{null==s||s(e)};return 0===o.length?null:t.jsxs("div",{className:"chart-container",children:[t.jsxs("button",{onClick:()=>m(!h),className:"w-full chart-header hover:bg-white/5 transition-colors rounded-t-lg cursor-pointer",children:[t.jsxs("div",{className:"chart-title",children:[t.jsx(F,{className:"chart-title-icon"}),"Path Health",t.jsxs("span",{className:"ml-2 text-[10px] font-normal text-text-muted",children:["(",o.length," paths)"]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[g&&t.jsxs("div",{className:"flex items-center gap-3 text-[10px]",children:[t.jsxs("span",{className:`tabular-nums ${xe(g.avgHealth)}`,children:["Avg: ",he(g.avgHealth)]}),g.weakLinks>0&&t.jsxs("span",{className:"text-accent-danger flex items-center gap-1",children:[t.jsx(U,{className:"w-3 h-3"}),g.weakLinks," weak"]}),g.declining>0&&t.jsxs("span",{className:"text-signal-poor flex items-center gap-1",children:[t.jsx(K,{className:"w-3 h-3"}),g.declining," declining"]}),g.pathsWithGhosts>0&&t.jsxs("span",{className:"text-accent-tertiary flex items-center gap-1",children:[t.jsx(c,{className:"w-3 h-3"}),g.pathsWithGhosts," ghost"]})]}),h?t.jsx(ae,{className:"w-4 h-4 text-text-muted"}):t.jsx(i,{className:"w-4 h-4 text-text-muted"})]})]}),h&&t.jsxs("div",{className:"p-3 pt-0 space-y-1",children:[d.totalPaths>0&&t.jsxs("div",{className:"flex items-center gap-3 text-[10px] text-text-muted pb-2 border-b border-white/5",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(T,{className:"w-3 h-3 text-accent-primary"}),t.jsx("span",{className:"text-text-secondary",children:d.totalPaths.toLocaleString()})," Viterbi decoded"]}),d.observationOverrideCount>0&&t.jsxs("span",{className:"text-accent-success",children:[Math.round(d.observationOverrideCount/d.totalPaths*100),"% observation override"]}),x.length>0&&t.jsxs("span",{className:"text-accent-tertiary flex items-center gap-1",children:[t.jsx(c,{className:"w-3 h-3"}),x.length," ghost",1!==x.length?"s":""]})]}),t.jsxs("div",{className:"flex items-center gap-4 text-[10px] text-text-muted pb-2 border-b border-white/5",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"w-2 h-2 rounded-full bg-accent-success"})," Healthy (≥70%)"]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"w-2 h-2 rounded-full bg-accent-secondary"})," Fair (50-70%)"]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"w-2 h-2 rounded-full bg-signal-poor"})," Weak (30-50%)"]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"w-2 h-2 rounded-full bg-accent-danger"})," Critical (<30%)"]}),x.length>0&&t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(c,{className:"w-3 h-3 text-accent-tertiary"})," Ghost"]})]}),t.jsx("div",{className:"space-y-1 max-h-64 overflow-y-auto",children:p.map(e=>t.jsx(ue,{path:e,isHighlighted:l===e.weakestLinkKey,onHighlight:j,ghostPrefixes:u},e.pathKey))}),o.length>e&&t.jsxs("div",{className:"text-center text-[10px] text-text-muted pt-2",children:["Showing top ",e," of ",o.length," paths"]})]})]})});function ge({ghost:e,neighbors:s,isExpanded:a,onToggle:n}){const r=M.useMemo(()=>Array.from(e.commonNeighbors).map(e=>{var t;return{hash:e,name:null==(t=s[e])?void 0:t.name}}),[e.commonNeighbors,s]),d=e.confidence>=.8?"text-accent-success":e.confidence>=.5?"text-accent-secondary":"text-signal-poor",x=e.estimatedLocation?e.estimatedLocation.uncertaintyM>=1e3?`±${(e.estimatedLocation.uncertaintyM/1e3).toFixed(1)}km`:`±${Math.round(e.estimatedLocation.uncertaintyM)}m`:null;return t.jsxs("div",{className:C("rounded-lg border transition-all duration-150",e.isLikelyReal?"border-accent-tertiary/30 bg-accent-tertiary/5":"border-border-muted bg-bg-card/50"),children:[t.jsxs("button",{onClick:n,className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-white/5 rounded-lg",children:[t.jsx(c,{className:C("w-5 h-5 flex-shrink-0",e.isLikelyReal?"text-accent-tertiary":"text-text-muted")}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-mono text-sm font-semibold text-text-primary",children:e.prefix.toUpperCase()}),e.isLikelyReal&&t.jsx("span",{className:"px-1.5 py-0.5 rounded text-xs font-medium bg-accent-tertiary/20 text-accent-tertiary",children:"Likely Real"})]}),t.jsxs("div",{className:"flex items-center gap-3 text-xs text-text-muted mt-0.5",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(T,{className:"w-3 h-3"}),e.observationCount," obs"]}),t.jsxs("span",{className:C("flex items-center gap-1",d),children:[(100*e.confidence).toFixed(0),"% conf"]})]})]}),a?t.jsx(ae,{className:"w-4 h-4 text-text-muted"}):t.jsx(i,{className:"w-4 h-4 text-text-muted"})]}),a&&t.jsxs("div",{className:"px-3 pb-3 space-y-3 border-t border-border-muted/50 mt-1 pt-3",children:[e.estimatedLocation?t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx(Z,{className:"w-4 h-4 text-accent-primary mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"text-xs",children:[t.jsxs("div",{className:"text-text-primary font-medium",children:[e.estimatedLocation.lat.toFixed(5),", ",e.estimatedLocation.lon.toFixed(5)]}),t.jsxs("div",{className:"text-text-muted",children:["Uncertainty: ",x]})]})]}):t.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-muted",children:[t.jsx(U,{className:"w-4 h-4 text-signal-poor"}),"Location unknown (neighbors lack coordinates)"]}),t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx(l,{className:"w-4 h-4 text-text-muted mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"text-xs",children:[t.jsxs("div",{className:"text-text-primary",children:["First seen: ",o(e.firstSeen)," ago"]}),t.jsxs("div",{className:"text-text-muted",children:["Last seen: ",o(e.lastSeen)," ago"]})]})]}),r.length>0&&t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx(J,{className:"w-4 h-4 text-text-muted mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"text-xs",children:[t.jsxs("div",{className:"text-text-muted mb-1",children:["Adjacent to ",r.length," known node",1!==r.length?"s":"",":"]}),t.jsxs("div",{className:"flex flex-wrap gap-1",children:[r.slice(0,5).map(({hash:e})=>t.jsx(q,{hash:e,size:"sm"},e)),r.length>5&&t.jsxs("span",{className:"text-text-muted",children:["+",r.length-5," more"]})]})]})]}),t.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t border-border-muted/30",children:[t.jsx("div",{className:"flex-1 h-2 rounded-full bg-bg-elevated overflow-hidden",children:t.jsx("div",{className:C("h-full rounded-full transition-all",e.confidence>=.8?"bg-accent-success":e.confidence>=.5?"bg-accent-secondary":"bg-signal-poor"),style:{width:100*e.confidence+"%"}})}),t.jsxs("span",{className:"text-xs text-text-muted w-12 text-right",children:[(100*e.confidence).toFixed(0),"%"]})]})]})]})}function je({neighbors:e,className:s}){const a=r(),i=n(),[l,o]=M.useState(new Set),[d,x]=M.useState(!1),{likelyReal:h,uncertain:m}=M.useMemo(()=>{const e=[],t=[];for(const n of a)n.isLikelyReal?e.push(n):t.push(n);const s=(e,t)=>t.confidence-e.confidence||t.observationCount-e.observationCount;return e.sort(s),t.sort(s),{likelyReal:e,uncertain:t}},[a]);if(0===a.length)return null;const u=e=>{o(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},p=d?m:m.slice(0,5);return t.jsxs("div",{className:C("space-y-4",s),children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(c,{className:"w-5 h-5 text-accent-tertiary"}),t.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Discovered Nodes"}),t.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-accent-tertiary/20 text-accent-tertiary",children:a.length})]}),i.totalPaths>0&&t.jsxs("div",{className:"text-xs text-text-muted",children:[i.pathsWithGhosts," / ",i.totalPaths," paths"]})]}),h.length>0&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2 text-xs text-accent-tertiary",children:[t.jsx(W,{className:"w-3.5 h-3.5"}),t.jsxs("span",{className:"font-medium",children:["Likely Undiscovered Repeaters (",h.length,")"]})]}),t.jsx("div",{className:"space-y-2",children:h.map(s=>t.jsx(ge,{ghost:s,neighbors:e,isExpanded:l.has(s.prefix),onToggle:()=>u(s.prefix)},s.prefix))})]}),m.length>0&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-muted",children:[t.jsx(U,{className:"w-3.5 h-3.5"}),t.jsxs("span",{children:["Uncertain (",m.length,")"]})]}),t.jsx("div",{className:"space-y-2",children:p.map(s=>t.jsx(ge,{ghost:s,neighbors:e,isExpanded:l.has(s.prefix),onToggle:()=>u(s.prefix)},s.prefix))}),m.length>5&&t.jsx("button",{onClick:()=>x(!d),className:"w-full py-1.5 text-xs text-accent-primary hover:text-accent-primary/80 transition-colors",children:d?"Show less":`Show ${m.length-5} more`})]}),i.observationOverrideCount>0&&t.jsxs("div",{className:"pt-2 border-t border-border-muted/30 text-xs text-text-muted",children:[t.jsx("span",{className:"text-accent-primary",children:i.observationOverrideCount})," observation overrides • Avg confidence: ",t.jsxs("span",{className:"text-accent-secondary",children:[(100*i.avgPathConfidence).toFixed(0),"%"]})]})]})}const fe="var(--signal-critical)",ve="var(--signal-poor)",Ne="var(--signal-fair)",be="var(--signal-good)",ye="var(--signal-excellent)",we="var(--text-muted)";function ke({active:e,payload:s}){if(!e||!s||!s.length)return null;const a=s[0].payload,n=new Date(a.timestamp),r=`${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getDate().toString().padStart(2,"0")}`;return t.jsxs("div",{className:"bg-tooltip-bg border border-border-subtle rounded px-1.5 py-0.5 text-[10px] shadow-xl",children:[t.jsx("span",{className:"text-text-muted",children:r}),t.jsx("span",{className:"ml-1.5 font-semibold tabular-nums",children:a.count})]})}const Me=M.memo(function({nodeHash:e,width:s=60,height:a=20,color:n,showArea:r=!0,showTooltip:c=!1,className:i=""}){const l=d(e),o=x(),h=n??(l.length>0?function(e){if(0===e.length)return fe;const t=e.slice(-4),s=t.reduce((e,t)=>e+t.count,0),a=s/t.length,n=e.reduce((e,t)=>e+t.count,0)/e.length;if(0===s)return fe;if(n>0){const e=a/n;return e>=1.2?ye:e>=.8?be:e>=.4?Ne:e>=.1?ve:fe}return s>=10?ye:s>=5?be:s>=2?Ne:s>=1?ve:fe}(l):we),m="number"==typeof s?s:60,u=a,p=`sparkline-gradient-${e.slice(-6)}`;if(l.length<2){const e=o?we:fe;return t.jsx("div",{className:`flex items-center justify-center ${i}`,style:{width:m,height:u,color:e},children:t.jsx("svg",{width:m,height:u,viewBox:`0 0 ${m} ${u}`,preserveAspectRatio:"none",children:t.jsx("line",{x1:4,y1:u/2,x2:m-4,y2:u/2,stroke:"currentColor",strokeWidth:1.5,strokeDasharray:"3,2",className:o?"animate-pulse":""})})})}return t.jsx("div",{className:i,style:{width:m,height:u},children:r?t.jsxs(S,{data:l,width:m,height:u,margin:{top:1,right:1,bottom:1,left:1},children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:p,x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"0%",stopColor:h,stopOpacity:.35}),t.jsx("stop",{offset:"100%",stopColor:h,stopOpacity:.05})]})}),c&&t.jsx(L,{content:t.jsx(ke,{}),cursor:{stroke:"rgba(255,255,255,0.2)",strokeWidth:1}}),t.jsx(H,{type:"monotone",dataKey:"count",stroke:"none",fill:`url(#${p})`,isAnimationActive:!1}),t.jsx(P,{type:"monotone",dataKey:"count",stroke:h,strokeWidth:1.5,dot:!1,isAnimationActive:!1})]}):t.jsxs($,{data:l,width:m,height:u,margin:{top:1,right:1,bottom:1,left:1},children:[c&&t.jsx(L,{content:t.jsx(ke,{}),cursor:{stroke:"rgba(255,255,255,0.2)",strokeWidth:1}}),t.jsx(P,{type:"monotone",dataKey:"count",stroke:h,strokeWidth:1.5,dot:!1,isAnimationActive:!1})]})})}),Ce=M.memo(function({hash:e,className:s="",size:a="sm"}){const r=h(),c=n(),[i,l]=M.useState(!1),o=M.useMemo(()=>m(e),[e]),d=M.useMemo(()=>o?r.find(e=>e.prefix===o)??null:null,[o,r]),x=c.totalPaths>0&&c.avgPathConfidence>=.7,u=M.useCallback(e=>{e.preventDefault(),e.stopPropagation(),l(!0)},[]),p=M.useCallback(()=>{l(!1)},[]);if(!d)return null;const g="sm"===a?"w-3.5 h-3.5":"w-4 h-4",j=x?"text-accent-tertiary hover:text-accent-tertiary hover:bg-accent-tertiary/10 focus:ring-accent-tertiary/50":"text-signal-fair hover:text-accent-secondary hover:bg-signal-fair/10 focus:ring-signal-fair/50",f=x?`Prefix conflict resolved by Viterbi HMM (${(100*c.avgPathConfidence).toFixed(0)}% confidence)`:`Prefix conflict: ${d.candidateCount} nodes share prefix "${o}"`;return t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",onClick:u,className:`inline-flex items-center justify-center p-0.5 rounded focus:outline-none focus:ring-2 transition-colors cursor-pointer touch-manipulation ${j} ${s}`,title:f,"aria-label":`View prefix conflict for ${o}${x?" (Viterbi resolved)":""}`,children:x?t.jsxs("span",{className:"relative",children:[t.jsx(T,{className:g}),t.jsx(W,{className:"absolute -bottom-0.5 -right-0.5 w-2 h-2 text-accent-success"})]}):t.jsx(ne,{className:g})}),t.jsx(_,{isOpen:i,prefix:d.prefix,candidateHashes:d.candidateHashes,onClose:p})]})});function Se(e,t,s,a){const n=(s-e)*Math.PI/180,r=(a-t)*Math.PI/180,c=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))*6371e3}const Le=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const{stats:e}=u(),s=p(),a=g(),n=j(),r=f(),c=v(),i=N(),[o,d]=M.useState(null),[x,h]=M.useState("lastHeard"),[m,C]=M.useState("desc"),[S,L]=M.useState(""),[H,P]=M.useState(!1),[$,F]=M.useState(null),[T,_]=M.useState(null),[U,K]=M.useState(null),[G,V]=M.useState(new Map),[I,ae]=M.useState(new Map),ne=M.useMemo(()=>(null==e?void 0:e.neighbors)??{},[null==e?void 0:e.neighbors]),le=M.useMemo(()=>Object.fromEntries(Object.entries(ne).filter(([e])=>!s.has(e))),[ne,s]),oe=M.useMemo(()=>{var t;return(null==(t=null==e?void 0:e.config)?void 0:t.repeater)?{latitude:e.config.repeater.latitude,longitude:e.config.repeater.longitude,name:e.config.node_name||"Local Node"}:void 0},[e]),xe=null==e?void 0:e.local_hash,he=M.useMemo(()=>{const e=new Map;if(!(null==oe?void 0:oe.latitude)||!(null==oe?void 0:oe.longitude))return e;for(const[t,s]of Object.entries(le))s.latitude&&s.longitude&&0!==s.latitude&&0!==s.longitude?e.set(t,Se(oe.latitude,oe.longitude,s.latitude,s.longitude)):e.set(t,null);return e},[le,oe]),{neighborHashSet:me,neighborSignalMap:ue}=M.useMemo(()=>{const e=new Set,t=new Map;for(const s of c)e.add(s.hash),t.set(s.hash,{avgRssi:s.avgRssi,avgSnr:s.avgSnr});return{neighborHashSet:e,neighborSignalMap:t}},[c]),ge=M.useMemo(()=>{const e=S.toLowerCase().trim(),t="neighbor"===e||"neighbors"===e,s=H||t;return Object.fromEntries(Object.entries(le).filter(([a,n])=>{if(s&&!me.has(a))return!1;if(t)return!0;if(!e)return!0;const r=(n.node_name||n.name||"").toLowerCase(),c=a.slice(2,4).toLowerCase();return r.includes(e)||c.includes(e)||a.toLowerCase().includes(e)}))},[le,S,H,me]),fe=M.useMemo(()=>Object.entries(ge).sort(([e,t],[s,a])=>{let n=0;switch(x){case"lastHeard":n=(t.last_seen||0)-(a.last_seen||0);break;case"distance":{const t=he.get(e)??null,a=he.get(s)??null;n=null===t&&null===a?0:null===t?1:null===a?-1:t-a;break}case"centrality":n=(r.get(e)||0)-(r.get(s)||0)}return"desc"===m?-n:n}),[ge,x,m,he,r]),ve=fe.filter(([,e])=>e.latitude&&e.longitude&&0!==e.latitude&&0!==e.longitude).length,Ne=M.useMemo(()=>new Set(n),[n]),be=M.useCallback(e=>{x===e?C(e=>"desc"===e?"asc":"desc"):(h(e),C("desc"))},[x]),ye=M.useCallback(e=>{const t=le[e];(null==t?void 0:t.latitude)&&(null==t?void 0:t.longitude)&&0!==t.latitude&&0!==t.longitude&&F(e)},[le]),we=M.useCallback(()=>{F(null)},[]),ke=M.useCallback(async(e,t)=>{if(t.stopPropagation(),!U){K(e),V(t=>{const s=new Map(t);return s.delete(e),s}),ae(t=>{const s=new Map(t);return s.delete(e),s});try{const t=e.startsWith("0x")?e.slice(0,4):`0x${e.slice(0,2)}`,s=await b(t,30);s.success&&s.data?(V(t=>new Map(t).set(e,s.data)),setTimeout(()=>{V(t=>{const s=new Map(t);return s.delete(e),s})},1e4)):(ae(t=>new Map(t).set(e,s.error||"Ping failed")),setTimeout(()=>{ae(t=>{const s=new Map(t);return s.delete(e),s})},5e3))}catch(s){const t=s instanceof Error?s.message:"Ping failed";ae(s=>new Map(s).set(e,t)),setTimeout(()=>{ae(t=>{const s=new Map(t);return s.delete(e),s})},5e3)}finally{K(null)}}},[U]);return t.jsxs(X,{children:[t.jsx(ee,{title:"Contacts",icon:t.jsx(J,{}),controls:t.jsxs("div",{className:"flex items-baseline gap-3 sm:gap-4",children:[t.jsxs("span",{className:"roster-title tabular-nums",children:[fe.length," node",1!==fe.length?"s":""]}),ve>0&&t.jsxs("span",{className:"roster-title flex items-baseline gap-1.5 tabular-nums",children:[t.jsx(Z,{className:"w-3.5 h-3.5 relative top-[2px]"}),ve," with location"]})]})}),t.jsx("div",{className:"relative",children:t.jsx(de,{neighbors:le,localNode:oe,localHash:xe,onRemoveNode:a,selectedNodeHash:$,onNodeSelected:we,highlightedEdgeKey:T})}),t.jsx(pe,{maxPaths:10,highlightedEdge:T,onHighlightEdge:_}),i.length>0&&t.jsx("div",{className:"chart-container",children:t.jsx(je,{neighbors:le})}),t.jsxs("div",{className:"chart-container",children:[t.jsxs("div",{className:"chart-header",children:[t.jsxs("div",{className:"chart-title",children:[t.jsx(J,{className:"chart-title-icon"}),"Discovered Contacts"]}),t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[me.size>0&&t.jsxs("button",{onClick:()=>P(!H),className:"flex items-center gap-1 px-1.5 sm:px-2.5 py-1.5 text-xs rounded-lg transition-colors "+(H?"bg-accent-success/20 text-accent-success border border-accent-success/30":"text-text-muted hover:text-text-secondary hover:bg-white/5 border border-transparent"),title:H?"Show all contacts":"Show only MeshCore neighbors (direct RF contact)",children:[t.jsx(y,{className:"w-3.5 h-3.5"}),t.jsx("span",{className:"hidden sm:inline",children:"Neighbors"}),t.jsx("span",{className:"sm:hidden tabular-nums",children:me.size})]}),t.jsxs("div",{className:"relative",children:[t.jsx(ce,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-text-muted"}),t.jsx("input",{type:"text",value:S,onChange:e=>L(e.target.value),placeholder:"Search...",className:"w-20 sm:w-28 lg:w-32 pl-6 sm:pl-7 pr-6 py-1.5 text-xs bg-white/5 border border-white/10 rounded-lg text-text-primary placeholder:text-text-muted focus:outline-none focus:border-accent-primary/50"}),S&&t.jsx("button",{onClick:()=>{L(""),"neighbor"!==S.toLowerCase().trim()&&"neighbors"!==S.toLowerCase().trim()||P(!1)},className:"absolute right-1.5 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-secondary p-0.5",children:t.jsx(w,{className:"w-3 h-3"})})]}),t.jsxs("div",{className:"flex items-center gap-0.5 sm:gap-1",children:[t.jsxs("button",{onClick:()=>be("lastHeard"),className:"flex items-center gap-1 p-1.5 sm:px-2 sm:py-1.5 text-xs rounded-lg transition-colors "+("lastHeard"===x?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-secondary hover:bg-white/5"),title:"Sort by last heard",children:[t.jsx(l,{className:"w-3.5 h-3.5"}),t.jsx("span",{className:"hidden sm:inline",children:"Recent"}),"lastHeard"===x&&t.jsx(se,{className:"w-3 h-3 "+("asc"===m?"rotate-180":"")})]}),t.jsxs("button",{onClick:()=>be("distance"),className:"flex items-center gap-1 p-1.5 sm:px-2 sm:py-1.5 text-xs rounded-lg transition-colors "+("distance"===x?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-secondary hover:bg-white/5"),title:"Sort by distance",children:[t.jsx(re,{className:"w-3.5 h-3.5"}),t.jsx("span",{className:"hidden sm:inline",children:"Distance"}),"distance"===x&&t.jsx(se,{className:"w-3 h-3 "+("asc"===m?"rotate-180":"")})]}),t.jsxs("button",{onClick:()=>be("centrality"),className:"flex items-center gap-1 p-1.5 sm:px-2 sm:py-1.5 text-xs rounded-lg transition-colors "+("centrality"===x?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-secondary hover:bg-white/5"),title:"Sort by network centrality",children:[t.jsx(B,{className:"w-3.5 h-3.5"}),t.jsx("span",{className:"hidden sm:inline",children:"Centrality"}),"centrality"===x&&t.jsx(se,{className:"w-3 h-3 "+("asc"===m?"rotate-180":"")})]})]})]})]}),fe.length>0?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"hidden sm:grid contacts-grid-header border-b border-border-subtle/50 px-3 py-2 text-[10px] uppercase tracking-wider text-text-muted",children:[t.jsx("div",{className:"contacts-col-node",children:"Node"}),t.jsx("div",{className:"contacts-col-signal text-right",children:"Signal"}),t.jsx("div",{className:"contacts-col-distance text-right",children:"Distance"}),t.jsx("div",{className:"contacts-col-centrality text-right",children:"Centrality"}),t.jsx("div",{className:"contacts-col-activity text-center",children:"Activity"}),t.jsx("div",{className:"contacts-col-seen text-right",children:"Last Seen"}),t.jsx("div",{className:"contacts-col-actions"})]}),t.jsx("div",{className:"divide-y divide-border-subtle/30",children:fe.map(([e,s])=>{var a;const n=s.latitude&&s.longitude&&0!==s.latitude&&0!==s.longitude,c=s.node_name||s.name||"Unknown",i=Ne.has(e),l=me.has(e),o=he.get(e),x=r.get(e)||0,h=l?ue.get(e):void 0,m=l&&h,u=null==(a=s.contact_type)?void 0:a.toLowerCase(),p="room server"===u||"room_server"===u||"room"===u||"server"===u,g="companion"===u||"client"===u||"cli"===u,j=s.is_repeater||"repeater"===u||"rep"===u,f=l?"direct":"flood",v=l?"Direct RF contact (zero-hop neighbor)":"Flood routing (multi-hop via mesh)";return t.jsxs("div",{className:`contacts-grid-row ${i?"bg-amber-500/5 border-l-2 border-l-amber-400":""} ${n?"cursor-pointer hover:bg-white/[0.02]":""}`,onClick:()=>ye(e),children:[t.jsxs("div",{className:"contacts-col-node flex items-center gap-2 min-w-0",children:[m&&null!==(null==h?void 0:h.avgSnr)?t.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0 self-center "+(b=h.avgSnr,void 0===b?"bg-[var(--signal-unknown)]":b>=5?"bg-[var(--signal-excellent)]":b>=0?"bg-[var(--signal-good)]":b>=-5?"bg-[var(--signal-fair)]":b>=-10?"bg-[var(--signal-poor)]":"bg-[var(--signal-critical)]")}):t.jsx("div",{className:"w-2 flex-shrink-0"}),t.jsx("div",{className:"roster-icon flex-shrink-0",title:v,children:p&&j?t.jsxs("div",{className:"relative w-5 h-5",children:[t.jsx(E,{className:"w-5 h-5 absolute inset-0 text-accent-secondary"}),t.jsx(A,{className:"w-2.5 h-2.5 absolute -bottom-0.5 -right-0.5 text-accent-primary"})]}):p?t.jsx(E,{className:"w-5 h-5 text-accent-secondary"}):g?t.jsx(O,{className:"w-5 h-5 text-text-muted"}):j?"direct"===f?t.jsx(z,{className:"w-5 h-5 text-accent-success"}):t.jsx(A,{className:"w-5 h-5 text-accent-tertiary"}):t.jsx(O,{className:"w-5 h-5 text-text-muted"})}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsxs("div",{className:"flex items-center gap-1.5 overflow-hidden",children:[t.jsx("span",{className:"roster-title truncate",title:c,children:c}),l&&t.jsx("span",{className:"type-badge px-1.5 py-0.5 rounded flex-shrink-0",style:{backgroundColor:"rgba(113, 152, 114, 0.2)",color:"var(--accent-success)"},children:"NBR"}),i&&t.jsxs("span",{className:"type-badge px-1.5 py-0.5 rounded flex items-center gap-1 flex-shrink-0",style:{backgroundColor:"rgba(223, 188, 114, 0.2)",color:"var(--accent-secondary)"},children:[t.jsx(D,{className:"w-3 h-3"}),"HUB"]}),j&&t.jsx("span",{className:"pill-tag flex-shrink-0",children:"RPT"})]}),t.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[t.jsx(q,{hash:e,size:"xs",prefixLength:8,suffixLength:6}),t.jsx(Ce,{hash:e})]})]})]}),t.jsxs("div",{className:"contacts-col-signal flex items-center justify-end gap-2",children:[m&&null!==(null==h?void 0:h.avgRssi)&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(R,{rssi:h.avgRssi,className:"w-3.5 h-3.5"}),t.jsx("span",{className:"type-data-xs tabular-nums text-text-muted",children:Math.round(h.avgRssi)})]}),m&&null!==(null==h?void 0:h.avgSnr)&&t.jsxs("span",{className:"type-data-xs tabular-nums text-text-muted",children:[h.avgSnr.toFixed(1)," dB"]})]}),t.jsx("div",{className:"contacts-col-distance flex items-center justify-end gap-1 text-text-muted",children:null!=o&&t.jsxs(t.Fragment,{children:[t.jsx(re,{className:"w-3 h-3"}),t.jsx("span",{className:"type-data-xs tabular-nums",children:(N=o,N<1e3?`${Math.round(N)}m`:`${(N/1e3).toFixed(1)}km`)})]})}),t.jsx("div",{className:"contacts-col-centrality flex items-center justify-end gap-1",children:x>0&&t.jsxs(t.Fragment,{children:[t.jsx(B,{className:"w-3 h-3 text-accent-secondary"}),t.jsxs("span",{className:"type-data-xs tabular-nums text-text-muted",children:[(100*x).toFixed(0),"%"]})]})}),t.jsx("div",{className:"contacts-col-activity flex items-center justify-center",children:t.jsx(Me,{nodeHash:e,width:48,height:16})}),t.jsx("div",{className:"contacts-col-seen flex items-center justify-end",children:t.jsx("span",{className:"type-data-xs tabular-nums text-text-primary whitespace-nowrap",children:s.last_seen?k(s.last_seen):"—"})}),t.jsxs("div",{className:"contacts-col-actions flex items-center justify-end gap-1",children:[l&&t.jsx(t.Fragment,{children:G.has(e)?t.jsxs("div",{className:"flex items-center gap-1 text-accent-success",title:`RTT: ${G.get(e).rtt_ms.toFixed(0)}ms`,children:[t.jsx(W,{className:"w-3.5 h-3.5"}),t.jsxs("span",{className:"type-data-xs tabular-nums hidden sm:inline",children:[G.get(e).snr_db.toFixed(1),"dB"]})]}):I.has(e)?t.jsx("span",{className:"text-red-400 text-[10px]",title:I.get(e),children:"✗"}):t.jsx("button",{onClick:t=>ke(e,t),disabled:null!==U,className:"p-1 sm:p-1.5 rounded-lg text-text-muted/50 hover:text-accent-primary hover:bg-accent-primary/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Ping neighbor for updated signal info",children:U===e?t.jsx(te,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 animate-spin"}):t.jsx(ie,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})}),t.jsx("button",{onClick:t=>{t.stopPropagation(),d({hash:e,name:c})},className:"p-1 sm:p-1.5 rounded-lg text-text-muted/50 hover:text-red-400 hover:bg-red-500/10 transition-colors",title:"Remove contact",children:t.jsx(Q,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})]})]},e);var N,b})})]}):t.jsxs("div",{className:"roster-empty",children:[t.jsx(J,{className:"roster-empty-icon"}),t.jsx("div",{className:"type-label text-text-secondary",children:"No Contacts Discovered"}),t.jsx("div",{className:"type-data-xs text-text-muted mt-1",children:"Contacts will appear here as they advertise on the mesh network."})]})]}),t.jsx(Y,{isOpen:!!o,title:"Remove Contact",message:`Are you sure you would like to remove ${(null==o?void 0:o.name)||"this contact"}?`,confirmLabel:"Remove",cancelLabel:"Cancel",variant:"danger",onConfirm:()=>{o&&a(o.hash),d(null)},onCancel:()=>d(null)})]})}},Symbol.toStringTag,{value:"Module"}));export{Le as C,Me as N,Ce as P,ie as T};
