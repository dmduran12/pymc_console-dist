const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ContactsMapMapLibre-DaSah_nS.js","assets/vendor-react-Co0R0q1H.js","assets/BasemapLayer-DRuifqX0.js","assets/vendor-core-B_fdKJ1g.js","assets/consumer-registry-B81DMIkb.js","assets/index-Dao0ei72.js","assets/link-scoring-n365qZFY.js","assets/ConfirmModal-HqMwgulL.js","assets/triangle-alert-BF-NLrme.js","assets/DeepAnalysisModal-BOg11Wy1.js","assets/geo-utils-DJn8DnxF.js","assets/git-branch-CwlSb4Ga.js","assets/download-CRcg42H0.js","assets/database-BzLQNjZc.js","assets/TimeRangeStepper-3MDYhKLT.js","assets/chevron-right-Bh1Da-CZ.js","assets/useMapViewStore-BsMWEk7z.js","assets/index-CMPr38lP.js","assets/refresh-cw-jVHy7nPn.js","assets/target-BZbSE6RJ.js","assets/sun-OS1iJ9QL.js","assets/plus-DKHm4Aaf.js","assets/easing-BI2wGQIR.js","assets/wifi-DZUROrs8.js","assets/users-eKHNrd2h.js","assets/node-types-CkseP2Ea.js","assets/badge-colors-CIfybB3y.js","assets/LightSparkline-DnTPTfQA.js","assets/map-pin-4mjMgvDz.js","assets/ping-BJJatHNR.js","assets/PageLayout-CGlrysNA.js","assets/listbox-BultKJp1.js","assets/chat-utils-Cgr6Hl6a.js","assets/SignalIndicator-UUa39x4C.js","assets/CollisionExplorerModal-Bj6SaidY.js","assets/monitor-smartphone-Cbi0C4v2.js","assets/DataBox-CwyEk1Rf.js","assets/network-D-0EUGkj.js","assets/activity-BbR_4jpW.js","assets/search-BXXTFvoI.js","assets/maplibre-gl-B1CfjdFi.css","assets/index-D_cD1jFz.css","assets/ContactsMapMapLibre-BwWOEply.css"])))=>i.map(i=>d[i]);
import{j as e,r as s,c as t,_ as a}from"./vendor-react-Co0R0q1H.js";import{c as n,aF as r,aG as l,aH as i,N as c,o,$ as d,aI as m,R as h,j as x,L as p,aJ as u,y as g,aK as f,aL as j,aM as b,x as y,aN as v,aO as N,aP as w,z as k,a0 as M,D as C,aQ as S,aR as R,h as L,I as P,ac as $}from"./index-Dao0ei72.js";import{p as _}from"./ping-BJJatHNR.js";import{c as z}from"./node-types-CkseP2Ea.js";import{P as F,b as I,B as E}from"./PageLayout-CGlrysNA.js";import{L as T,a as H}from"./listbox-BultKJp1.js";import{M as O,C as D,T as V,a as U}from"./TimeRangeStepper-3MDYhKLT.js";import{u as A,e as q,f as B,r as G}from"./consumer-registry-B81DMIkb.js";import{e as W,g as K,a as Z}from"./chat-utils-Cgr6Hl6a.js";import{A as J,b as Q}from"./SignalIndicator-UUa39x4C.js";import{C as X,S as Y}from"./CollisionExplorerModal-Bj6SaidY.js";import{E as ee,T as se}from"./target-BZbSE6RJ.js";import{D as te}from"./DataBox-CwyEk1Rf.js";import{C as ae}from"./badge-colors-CIfybB3y.js";import{N as ne}from"./network-D-0EUGkj.js";import{A as re}from"./activity-BbR_4jpW.js";import{T as le,C as ie}from"./ConfirmModal-HqMwgulL.js";import{U as ce}from"./users-eKHNrd2h.js";import{M as oe}from"./monitor-smartphone-Cbi0C4v2.js";import{M as de}from"./map-pin-4mjMgvDz.js";import{S as me}from"./search-BXXTFvoI.js";const he=n("arrow-down-left",[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]]),xe=n("arrow-up-down",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]),pe=n("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),ue=n("file-digit",[["path",{d:"M4 12V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2",key:"jrl274"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 16h2v6",key:"1bxocy"}],["path",{d:"M10 22h4",key:"ceow96"}],["rect",{x:"2",y:"16",width:"4",height:"6",rx:"2",key:"r45zd0"}]]),ge=n("list-filter",[["path",{d:"M2 5h20",key:"1fs1ex"}],["path",{d:"M6 12h12",key:"8npq4p"}],["path",{d:"M9 19h6",key:"456am0"}]]),fe=n("move",[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]]),je=n("radio-tower",[["path",{d:"M4.9 16.1C1 12.2 1 5.8 4.9 1.9",key:"s0qx1y"}],["path",{d:"M7.8 4.7a6.14 6.14 0 0 0-.8 7.5",key:"1idnkw"}],["circle",{cx:"12",cy:"9",r:"2",key:"1092wv"}],["path",{d:"M16.2 4.8c2 2 2.26 5.11.8 7.47",key:"ojru2q"}],["path",{d:"M19.1 1.9a9.96 9.96 0 0 1 0 14.1",key:"rhi7fg"}],["path",{d:"M9.5 18h5",key:"mfy3pd"}],["path",{d:"m8 22 4-11 4 11",key:"25yftu"}]]),be=n("ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]),ye=n("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]),ve=n("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]);class Ne extends s.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}render(){var s;return this.state.hasError?e.jsx("div",{className:t("map-container-16-9 flex items-center justify-center rounded-2xl",r),role:"alert","aria-live":"assertive",children:e.jsxs("div",{className:"text-center text-fg-muted p-4",children:[e.jsx("p",{className:"text-lg mb-2",children:"Map failed to load"}),e.jsx("p",{className:"text-sm text-fg-muted",children:(null==(s=this.state.error)?void 0:s.message)||"Unknown error"}),e.jsx("p",{className:"text-xs text-fg-muted mt-2",children:"Try refreshing the page or check your browser's WebGL support."})]})}):this.props.children}}const we=s.lazy(()=>a(()=>import("./ContactsMapMapLibre-DaSah_nS.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42])));function ke({neighbors:a,localNode:n,localHash:l,onRemoveNode:i,selectedNodeHash:c,onNodeSelected:o,highlightedEdgeKey:d,highlightedGhost:m}){return e.jsx(Ne,{children:e.jsx(s.Suspense,{fallback:e.jsx("div",{className:t("map-container-16-9 flex items-center justify-center rounded-2xl",r),role:"status","aria-live":"polite","aria-label":"Loading map",children:e.jsxs("div",{className:"text-fg-muted flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-sys-blue border-t-transparent rounded-full animate-spin","aria-hidden":"true"}),e.jsx("span",{children:"Loading map..."})]})}),children:e.jsx(we,{neighbors:a,localNode:n,localHash:l,onRemoveNode:i,selectedNodeHash:c,onNodeSelected:o,highlightedEdgeKey:d,highlightedGhost:m})})})}const Me=s.memo(function({hash:t,className:a="",size:n="sm",collisionInfo:r,isViterbiResolved:d}){const m=l(),h=i(),[x,p]=s.useState(!1),u=s.useMemo(()=>c(t),[t]),g=s.useMemo(()=>void 0!==r?r:u?m.find(e=>e.prefix===u)??null:null,[u,m,r]),f=d??(h.totalPaths>0&&h.avgPathConfidence>=.7),j=s.useCallback(e=>{e.preventDefault(),e.stopPropagation(),p(!0)},[]),b=s.useCallback(()=>{p(!1)},[]);if(!g)return null;const y="sm"===n?"w-3.5 h-3.5":"w-4 h-4",v=f?"text-sys-cyan hover:text-sys-cyan hover:bg-sys-cyan/10 focus:ring-sys-cyan/50":"text-signal-fair hover:text-sys-indigo hover:bg-signal-fair/10 focus:ring-signal-fair/50",N=f?`Prefix conflict resolved by Viterbi HMM (${(100*h.avgPathConfidence).toFixed(0)}% confidence)`:`Prefix conflict: ${g.candidateCount} nodes share prefix "${u}"`;return e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:j,className:`inline-flex items-center justify-center p-0.5 rounded focus:outline-none focus:ring-2 transition-colors cursor-pointer touch-manipulation ${v} ${a}`,title:N,"aria-label":`View prefix conflict for ${u}${f?" (Viterbi resolved)":""}`,children:f?e.jsxs("span",{className:"relative",children:[e.jsx(ee,{className:y}),e.jsx(o,{className:"absolute -bottom-0.5 -right-0.5 w-2 h-2 text-sys-green"})]}):e.jsx(ue,{className:y})}),e.jsx(X,{isOpen:x,prefix:g.prefix,candidateHashes:g.candidateHashes,onClose:b})]})}),Ce=[{target:"Contacts",fn:"name",minStage:1,when:q},{target:"Contacts",fn:"traceLinks.directed",minStage:2,when:B}];G(Ce);const Se=s.memo(function({hash:s,contact:t,isHub:a,isNeighbor:n,distance:r,centrality:l,sparklineData:i,neighborSignal:c,collisionInfo:u,isViterbiResolved:g,isPinging:f,isPingingThis:j,pingResult:b,pingError:y,gatewayInfo:v,lastForwarderPrefix:N,isMobile:w,pathStability:k,onRowClick:M,onPing:C,onRemove:S}){A(Ce);const R=t.latitude&&t.longitude&&0!==t.latitude&&0!==t.longitude,L=t.node_name||t.name||"Unknown",P=n&&c,$=z(t),{isRepeater:_,isCompanion:F,isRoomServer:I,isClient:E,label:T}=$,H=n?`${T} — Direct RF contact (zero-hop neighbor)`:`${T} — Flood routing (multi-hop via mesh)`,V=t.first_seen?d(t.first_seen).replace(/ ago$/i," old"):null;return e.jsxs("div",{className:`contacts-grid-row ${a?"bg-sys-amber/5 border-l-2 border-l-sys-amber":""} ${R?"cursor-pointer hover:bg-subtle-fill":""}`,onClick:()=>M(s),children:[e.jsxs("div",{className:"contacts-col-node flex items-center gap-2 min-w-0",children:[P&&null!==(null==c?void 0:c.avgSnr)?e.jsx("div",{className:`w-2 h-2 rounded-full flex-shrink-0 self-center ${m(c.avgSnr)}`}):e.jsx("div",{className:"w-2 flex-shrink-0"}),e.jsx("div",{className:"w-6 h-6 flex items-center justify-center flex-shrink-0",title:H,children:(()=>{if(I&&_)return e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx(O,{className:"w-5 h-5 absolute inset-0 text-sys-pink"}),e.jsx(Y,{className:"w-2.5 h-2.5 absolute -bottom-0.5 -right-0.5 text-sys-teal"})]});if(I)return e.jsx(O,{className:"w-5 h-5 text-sys-pink"});if(_)return e.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center ring-[1.5px] ring-sys-blue",children:e.jsx(h,{className:"w-3.5 h-3.5 text-sys-blue"})});if((F||E)&&"Unknown"!==L){const{emoji:s,cleanName:t}=W(L);return e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center",style:{backgroundColor:K(t)},children:s?e.jsx("span",{className:"text-sm leading-none",children:s}):e.jsx("span",{className:"text-white text-[9px] font-bold tracking-tighter",children:Z(L)})})}return e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center bg-zinc-500/20",children:e.jsx(D,{className:"w-3.5 h-3.5 text-sys-amber"})})})()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 overflow-hidden",children:[e.jsx("span",{className:"roster-title truncate",title:L,children:L}),n&&e.jsx(x,{color:ae.neighbor,compact:!0,className:"flex-shrink-0",children:"NBR"}),a&&e.jsxs(x,{color:ae.hub,compact:!0,className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx(ne,{className:"w-3 h-3"}),"HUB"]}),_&&e.jsx(x,{color:ae.repeater,compact:!0,className:"flex-shrink-0",children:"RPT"}),I&&e.jsx(x,{color:ae.room,compact:!0,className:"flex-shrink-0",children:"ROOM"}),F&&e.jsx(x,{color:ae.companion,compact:!0,className:"flex-shrink-0",children:"COMP"}),E&&e.jsx(x,{color:ae.client,compact:!0,className:"flex-shrink-0",children:"CLIENT"}),w&&e.jsxs(x,{color:"cyan",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0",children:[e.jsx(fe,{className:"w-2.5 h-2.5"}),"MOBILE"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[e.jsx(te,{copy:!0,size:"compact",truncate:[8,6],children:s}),e.jsx(Me,{hash:s,collisionInfo:u,isViterbiResolved:g}),!n&&v&&e.jsxs(x,{color:"zinc",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0",title:`Via ${v.name||v.prefix} (${v.hopCount} hop${1!==v.hopCount?"s":""})`,children:[e.jsx(J,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"font-mono",children:v.prefix}),v.hopCount>1&&e.jsxs("span",{className:"opacity-60",children:["+",v.hopCount-1]})]}),N&&!n&&e.jsxs(x,{color:"zinc",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0",title:`Last forwarded by ${N}`,children:[e.jsx(he,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"font-mono",children:N})]}),null!=k&&0!==k&&e.jsx(x,{color:k>0?"green":"amber",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0",title:k>0?"Path stability improving":"Path stability declining",children:k>0?e.jsx(ve,{className:"w-2.5 h-2.5"}):e.jsx(ye,{className:"w-2.5 h-2.5"})}),i.length>0&&(()=>{const s=i.reduce((e,s)=>e+s.count,0);if(0===s)return null;const t=s/24;return e.jsxs(x,{color:"zinc",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0",title:`${s} packets in last 24h (~${t.toFixed(1)}/hr)`,children:[e.jsx(je,{className:"w-2.5 h-2.5"}),e.jsxs("span",{children:[t<1?"<1":t.toFixed(0),"/hr"]})]})})(),V&&e.jsxs(x,{color:"zinc",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0 opacity-70",title:`First discovered ${V}`,children:[e.jsx(pe,{className:"w-2.5 h-2.5"}),e.jsx("span",{children:V})]})]})]})]}),e.jsxs("div",{className:"contacts-col-signal flex items-center justify-end gap-2",children:[P&&null!==(null==c?void 0:c.avgRssi)&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{rssi:c.avgRssi,className:"w-3.5 h-3.5"}),e.jsx("span",{className:"type-data-xs text-fg-muted",children:Math.round(c.avgRssi)})]}),P&&null!==(null==c?void 0:c.avgSnr)&&e.jsxs("span",{className:"type-data-xs text-fg-muted",children:[c.avgSnr.toFixed(1)," dB"]})]}),e.jsx("div",{className:"contacts-col-distance flex items-center justify-end gap-1 text-fg-muted",children:null!=r&&e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-3 h-3"}),e.jsx("span",{className:"type-data-xs",children:(U=r,U<1e3?`${Math.round(U)}m`:`${(U/1e3).toFixed(1)}km`)})]})}),e.jsx("div",{className:"contacts-col-centrality flex items-center justify-end gap-1",children:l>0&&e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-3 h-3 text-sys-indigo"}),e.jsxs("span",{className:"type-data-xs text-fg-muted",children:[(100*l).toFixed(0),"%"]})]})}),e.jsx("div",{className:"contacts-col-seen flex items-center justify-end",children:e.jsx("span",{className:"type-data-xs text-fg-primary whitespace-nowrap",children:t.last_seen?d(t.last_seen):"—"})}),e.jsxs("div",{className:"contacts-col-actions flex items-center justify-end gap-1",children:[n&&e.jsx(e.Fragment,{children:b?e.jsxs("div",{className:"flex items-center gap-1 text-sys-green",title:`RTT: ${b.rtt_ms.toFixed(0)}ms`,children:[e.jsx(o,{className:"w-3.5 h-3.5"}),e.jsxs("span",{className:"type-data-xs hidden sm:inline",children:[b.snr_db.toFixed(1),"dB"]})]}):y?e.jsx("span",{className:"text-sys-red text-xs",title:y,children:"✗"}):e.jsx("button",{onClick:e=>C(s,e),disabled:f,className:"p-1 sm:p-1.5 radius-inner text-fg-muted/50 hover:text-sys-blue hover:bg-sys-blue/10 transition-base disabled:opacity-50 disabled:cursor-not-allowed",title:"Ping neighbor for updated signal info",children:j?e.jsx(p,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 animate-spin"}):e.jsx(se,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),S(s,L)},className:"p-1 sm:p-1.5 radius-inner text-fg-muted/50 hover:text-sys-red hover:bg-sys-red/10 transition-base",title:"Remove contact",children:e.jsx(le,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})]})]});var U}),Re=[],Le=[{field:"lastHeard",icon:U,label:"Recent"},{field:"distance",icon:be,label:"Distance"},{field:"centrality",icon:re,label:"Centrality"}];function Pe(e,s){const{color:a="primary",border:n=!1}=s??{};return t("flex items-center gap-1.5 px-2 py-1.5 text-sm radius-inner transition-base",e?"success"===a?"bg-sys-green/20 text-sys-green":"bg-sys-blue/20 text-sys-blue":"text-fg-muted hover:text-fg-secondary hover-bg",n&&(e?"success"===a?"border border-sys-green/30":"border border-sys-blue/30":"border border-transparent"))}function $e(e,s,t,a){const n=(t-e)*Math.PI/180,r=(a-s)*Math.PI/180,l=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(t*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3}const _e=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const{stats:a}=u(),n=g(),r=f(),d=j(),m=b(),x=y(),U=v(),A=N(),q=w(),B=k(),G=M(),W=C[B],K=l(),Z=i(),J=S(),Q=Z.totalPaths>0&&Z.avgPathConfidence>=.7,X=s.useMemo(()=>{const e=new Map;for(const s of K)e.set(s.prefix,s);return e},[K]),[Y,ee]=s.useState(null),[se,te]=s.useState("lastHeard"),[ae,ne]=s.useState("desc"),[re,le]=s.useState(""),[he,pe]=s.useState(!1),[ue,fe]=s.useState(new Set),[je,be]=s.useState(!1),[ye,ve]=s.useState(null),[Ne,we]=s.useState(null),[Me,Ce]=s.useState(new Map),[_e,ze]=s.useState(new Map),[Fe,Ie]=s.useState(25),[Ee,Te]=s.useState(25),He=s.useRef(null),Oe=s.useMemo(()=>(null==a?void 0:a.neighbors)??{},[null==a?void 0:a.neighbors]),De=s.useMemo(()=>{const e=Date.now()/1e3-60*W.minutes;return Object.fromEntries(Object.entries(Oe).filter(([s,t])=>!n.has(s)&&(t.last_seen??0)>=e))},[Oe,n,W.minutes]),Ve=R(),Ue=null==a?void 0:a.local_hash,Ae=s.useMemo(()=>{const e=new Map;if(!Ue||0===U.size)return e;for(const[s,t]of U)if(s.endsWith(`→${Ue}`)&&t.hops.length>1){const a=s.split("→")[0],n=t.hops[t.hops.length-1];e.set(a,n)}return e},[U,Ue]),qe=s.useMemo(()=>{const e=new Map;if(!(null==Ve?void 0:Ve.latitude)||!(null==Ve?void 0:Ve.longitude))return e;for(const[s,t]of Object.entries(De))t.latitude&&t.longitude&&0!==t.latitude&&0!==t.longitude?e.set(s,$e(Ve.latitude,Ve.longitude,t.latitude,t.longitude)):e.set(s,null);return e},[De,Ve]),{neighborHashSet:Be,neighborSignalMap:Ge}=s.useMemo(()=>{const e=new Set,s=new Map;for(const t of x)e.add(t.hash),s.set(t.hash,{avgRssi:t.avgRssi,avgSnr:t.avgSnr});return{neighborHashSet:e,neighborSignalMap:s}},[x]),We=s.useMemo(()=>{const e=re.toLowerCase().trim(),s="neighbor"===e||"neighbors"===e,t=he||s,a=ue.size>0;return Object.fromEntries(Object.entries(De).filter(([n,r])=>{if(a){const e=function(e){return function(e){switch(e){case"room_server":return"room";case"repeater":return"repeater";case"companion":case"unknown":return"companion"}}(z(e).type)}(r);if(!ue.has(e))return!1}if(t&&!Be.has(n))return!1;if(s)return!0;if(!e)return!0;const l=(r.node_name||r.name||"").toLowerCase(),i=c(n).toLowerCase();return l.includes(e)||i.includes(e)||n.toLowerCase().includes(e)}))},[De,re,he,Be,ue]),Ke=s.useMemo(()=>{const e=Object.entries(We),s=re.toLowerCase().trim(),t=2===s.length&&/^[0-9a-f]{2}$/i.test(s);return e.sort(([e,a],[n,r])=>{if(t){const t=c(e).toLowerCase(),a=c(n).toLowerCase(),r=t===s,l=a===s;if(r&&!l)return-1;if(l&&!r)return 1}let l=0;switch(se){case"lastHeard":l=(a.last_seen||0)-(r.last_seen||0);break;case"distance":{const s=qe.get(e)??null,t=qe.get(n)??null;l=null===s&&null===t?0:null===s?1:null===t?-1:s-t;break}case"centrality":l=(m.get(e)||0)-(m.get(n)||0)}return"desc"===ae?-l:l})},[We,se,ae,qe,m,re]),Ze=s.useMemo(()=>{let e=0,s=0,t=0,a=0,n=0;for(const[,r]of Ke){const l=z(r),i=r.latitude&&r.longitude&&0!==r.latitude&&0!==r.longitude;switch(l.type){case"room_server":t++;break;case"repeater":s++;break;case"companion":e++;break;case"unknown":n++}i&&a++}return{companions:e,repeaters:s,roomServers:t,total:Ke.length,withLocation:a,unknown:n}},[Ke]),Je=s.useMemo(()=>new Set(d),[d]),Qe=s.useMemo(()=>0===Fe?Ke:Ke.slice(0,Ee),[Ke,Ee,Fe]);s.useEffect(()=>{Te(Fe||Ke.length)},[se,ae,re,he,ue,Fe,Ke.length]),s.useEffect(()=>{const e=e=>{e.target.closest("[data-dropdown]")||be(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]),s.useEffect(()=>{if(0===Fe)return;const e=new IntersectionObserver(e=>{e[0].isIntersecting&&Ee<Ke.length&&Te(e=>Math.min(e+Fe,Ke.length))},{threshold:.1,rootMargin:"100px"});return He.current&&e.observe(He.current),()=>e.disconnect()},[Fe,Ee,Ke.length]);const Xe=s.useCallback(e=>{Ie(e),Te(e||Ke.length)},[Ke.length]),Ye=s.useCallback(e=>{se===e?ne(e=>"desc"===e?"asc":"desc"):(te(e),ne("desc"))},[se]),es=s.useCallback(e=>{const s=De[e];(null==s?void 0:s.latitude)&&(null==s?void 0:s.longitude)&&0!==s.latitude&&0!==s.longitude&&ve(e)},[De]),ss=s.useCallback(()=>{ve(null)},[]),ts=s.useCallback((e,s)=>{ee({hash:e,name:s})},[]),as=s.useCallback(async(e,s)=>{if(s.stopPropagation(),!Ne){we(e),Ce(s=>{const t=new Map(s);return t.delete(e),t}),ze(s=>{const t=new Map(s);return t.delete(e),t});try{const s=e.startsWith("0x")?e.slice(0,4):`0x${e.slice(0,2)}`,t=await _(s,30);t.success&&t.data?(Ce(s=>new Map(s).set(e,t.data)),setTimeout(()=>{Ce(s=>{const t=new Map(s);return t.delete(e),t})},1e4)):(ze(s=>new Map(s).set(e,t.error||"Ping failed")),setTimeout(()=>{ze(s=>{const t=new Map(s);return t.delete(e),t})},5e3))}catch(t){const s=t instanceof Error?t.message:"Ping failed";ze(t=>new Map(t).set(e,s)),setTimeout(()=>{ze(s=>{const t=new Map(s);return t.delete(e),t})},5e3)}finally{we(null)}}},[Ne]);return e.jsxs(F,{children:[e.jsx(I,{title:"Contacts",icon:e.jsx(ce,{}),controls:e.jsxs("div",{className:"flex items-center gap-3 sm:gap-5",children:[e.jsxs("div",{className:"hidden sm:flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs text-fg-muted",children:"Total:"}),e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:`${Ze.total} discovered node${1!==Ze.total?"s":""} on the mesh network`,children:[e.jsx(ce,{className:"w-3.5 h-3.5 text-fg-secondary"}),e.jsx("span",{children:Ze.total})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs text-fg-muted",children:"Types:"}),Ze.repeaters>0&&e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:"Repeaters",children:[e.jsx(h,{className:"w-3.5 h-3.5 text-sys-blue"}),e.jsx("span",{children:Ze.repeaters})]}),Ze.companions>0&&e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:"Companions",children:[e.jsx(oe,{className:"w-3.5 h-3.5 text-fg-muted"}),e.jsx("span",{children:Ze.companions})]}),Ze.roomServers>0&&e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:"Room Servers",children:[e.jsx(O,{className:"w-3.5 h-3.5 text-sys-pink"}),e.jsx("span",{children:Ze.roomServers})]}),Ze.withLocation>0&&e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:"With GPS location",children:[e.jsx(de,{className:"w-3.5 h-3.5 text-sys-green"}),e.jsx("span",{children:Ze.withLocation})]}),Ze.unknown>0&&e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:"Unknown type",children:[e.jsx(D,{className:"w-3.5 h-3.5 text-sys-amber"}),e.jsx("span",{children:Ze.unknown})]})]})]}),e.jsxs("div",{className:"flex sm:hidden items-center gap-1.5",children:[e.jsxs("span",{className:"data-box !px-1.5 !py-0.5 !text-[10px] flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3 text-fg-secondary"}),e.jsx("span",{children:Ze.total})]}),Ze.repeaters>0&&e.jsxs("span",{className:"data-box !px-1.5 !py-0.5 !text-[10px] flex items-center gap-1",children:[e.jsx(h,{className:"w-3 h-3 text-sys-blue"}),e.jsx("span",{children:Ze.repeaters})]}),Ze.companions>0&&e.jsxs("span",{className:"data-box !px-1.5 !py-0.5 !text-[10px] flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3 text-fg-muted"}),e.jsx("span",{children:Ze.companions})]}),Ze.roomServers>0&&e.jsxs("span",{className:"data-box !px-1.5 !py-0.5 !text-[10px] flex items-center gap-1",children:[e.jsx(O,{className:"w-3 h-3 text-sys-pink"}),e.jsx("span",{children:Ze.roomServers})]}),e.jsx(V,{ranges:C,selectedIndex:B,onSelect:G,size:"sm"})]}),e.jsx("div",{className:"hidden sm:block",children:e.jsx(V,{ranges:C,selectedIndex:B,onSelect:G})})]})}),e.jsxs(E,{children:[q?e.jsx(ke,{neighbors:De,localNode:Ve??void 0,localHash:Ue,onRemoveNode:r,selectedNodeHash:ye,onNodeSelected:ss}):e.jsx("div",{className:"surface-base radius-card aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-sys-blue border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm text-fg-muted",children:"Loading map..."})]})}),e.jsx(L,{noPadding:!0,children:q?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2.5 border-b border-edge-subtle",children:[e.jsx("span",{className:"icon-md flex items-center justify-center text-icon-card-title flex-shrink-0",children:e.jsx(ce,{})}),e.jsx("span",{className:"type-micro flex-shrink-0 mr-auto hidden sm:block",children:"Discovered Contacts"}),e.jsx(P,{type:"search",size:"sm",value:re,onChange:e=>le(e.target.value),placeholder:"Search...",leadingIcon:e.jsx(me,{className:"w-3.5 h-3.5"}),trailingIcon:re?e.jsx("button",{onClick:()=>{le(""),"neighbor"!==re.toLowerCase().trim()&&"neighbors"!==re.toLowerCase().trim()||pe(!1)},className:"text-fg-muted hover:text-fg-secondary",children:e.jsx($,{className:"w-3 h-3"})}):void 0,className:"w-24 sm:w-32 xl:w-44","aria-label":"Search contacts"}),e.jsx("div",{className:"h-4 w-px bg-border-subtle flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsxs("div",{className:"relative","data-dropdown":!0,children:[e.jsxs("button",{onClick:()=>be(!je),className:Pe(ue.size>0,{border:!0}),title:"Filter by contact type",children:[e.jsx(ge,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden xl:inline",children:"Filter"}),ue.size>0&&e.jsx("span",{className:"tabular-nums text-xs bg-sys-blue/30 px-1 rounded",children:ue.size})]}),je&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 z-50 surface-elevated radius-inner py-1 min-w-[140px]",children:[[{key:"repeater",label:"Repeaters"},{key:"companion",label:"Companions"},{key:"room",label:"Rooms"}].map(({key:s,label:a})=>e.jsxs("button",{onClick:()=>{fe(e=>{const t=new Set(e);return t.has(s)?t.delete(s):t.add(s),t})},className:"w-full px-3 py-1.5 text-sm text-left hover-bg transition-base flex items-center gap-2",children:[e.jsx("span",{className:t("w-4 h-4 flex items-center justify-center radius-badge border",ue.has(s)?"bg-sys-blue border-sys-blue text-white":"border-edge-subtle"),children:ue.has(s)&&e.jsx(o,{className:"w-3 h-3"})}),e.jsx("span",{className:ue.has(s)?"text-fg-primary":"text-fg-secondary",children:a})]},s)),ue.size>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-edge-subtle my-1"}),e.jsx("button",{onClick:()=>fe(new Set),className:"w-full px-3 py-1.5 text-sm text-left text-fg-muted hover:text-fg-secondary hover-bg transition-base",children:"Clear filters"})]})]})]}),Be.size>0&&e.jsxs("button",{onClick:()=>pe(!he),className:Pe(he,{color:"success",border:!0}),title:he?"Show all contacts":"Show only MeshCore neighbors (direct RF contact)",children:[e.jsx(h,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden xl:inline",children:"Neighbors"})]})]}),e.jsx("div",{className:"h-4 w-px bg-border-subtle flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[Le.map(({field:s,icon:a,label:n})=>e.jsxs("button",{onClick:()=>Ye(s),className:Pe(se===s),title:`Sort by ${n.toLowerCase()}`,children:[e.jsx(a,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden xl:inline",children:n}),se===s&&e.jsx(xe,{className:t("w-3 h-3","asc"===ae&&"rotate-180")})]},s)),e.jsx("div",{className:"h-4 w-px bg-border-subtle"}),e.jsxs(T,{value:Fe,onChange:Xe,className:"w-auto min-w-[50px] [&_button]:py-1 [&_button]:px-2 [&_button]:text-xs [&_button]:min-h-0","aria-label":"Items per page",children:[e.jsx(H,{value:25,children:"25"}),e.jsx(H,{value:50,children:"50"}),e.jsx(H,{value:100,children:"100"}),e.jsx(H,{value:0,children:"All"})]})]})]}),Ke.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden sm:grid contacts-grid-header border-b border-edge-subtle/50 px-3 py-2 type-micro text-fg-muted",children:[e.jsx("div",{className:"contacts-col-node",children:"Node"}),e.jsx("div",{className:"contacts-col-signal text-right",children:"Signal"}),e.jsx("div",{className:"contacts-col-distance text-right",children:"Distance"}),e.jsx("div",{className:"contacts-col-centrality text-right",children:"Centrality"}),e.jsx("div",{className:"contacts-col-seen text-right",children:"Last Seen"}),e.jsx("div",{className:"contacts-col-actions"})]}),e.jsx("div",{className:"divide-y divide-edge-subtle/30",children:Qe.map(([s,t])=>{const a=c(s),n=Je.has(s),r=Be.has(s),l=qe.get(s)??null,i=m.get(s)||0,o=r?Ge.get(s):void 0,d=a?X.get(a)??null:null,h=J.get(s)??Re;let x=null;if(!r&&Ue&&U.size>0){const e=`${s}→${Ue}`,t=U.get(e);if(t&&t.hops.length>0){const e=t.hops[0],s=Object.keys(Oe).find(s=>s.toUpperCase().startsWith(e.toUpperCase())),a=s?Oe[s]:null;x={prefix:e,name:(null==a?void 0:a.node_name)??(null==a?void 0:a.name)??null,hopCount:t.hopCount}}}const p=A.has(s),u=Ae.get(s)??null;return e.jsx(Se,{hash:s,contact:t,isHub:n,isNeighbor:r,distance:l,centrality:i,sparklineData:h,neighborSignal:o,collisionInfo:d,isViterbiResolved:Q,isPinging:null!==Ne,isPingingThis:Ne===s,pingResult:Me.get(s),pingError:_e.get(s),gatewayInfo:x,lastForwarderPrefix:u,isMobile:p,onRowClick:es,onPing:as,onRemove:ts},s)})}),Fe>0&&Ee<Ke.length&&e.jsxs("div",{ref:He,className:"flex items-center justify-center py-4 text-fg-muted",children:[e.jsx(p,{className:"w-4 h-4 animate-spin mr-2"}),e.jsx("span",{className:"text-xs",children:"Loading more..."})]}),e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-t border-edge-subtle/50 text-xs text-fg-muted",children:[e.jsxs("span",{className:"tabular-nums",children:["Showing ",Qe.length," of ",Ke.length]}),Fe>0&&Ee<Ke.length&&e.jsx("button",{onClick:()=>Te(e=>Math.min(e+Fe,Ke.length)),className:"text-sys-blue hover:text-sys-blue/80 transition-base",children:"Load more"})]})]}):e.jsxs("div",{className:"roster-empty",children:[e.jsx(ce,{className:"roster-empty-icon"}),e.jsx("div",{className:"type-label text-fg-secondary",children:"No Contacts Discovered"}),e.jsx("div",{className:"type-data-xs text-fg-muted mt-1",children:"Contacts will appear here as they advertise on the mesh network."})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-edge-subtle",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-elevated animate-pulse"}),e.jsx("div",{className:"w-32 h-4 rounded bg-elevated animate-pulse"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 h-6 rounded bg-elevated animate-pulse"}),e.jsx("div",{className:"w-24 h-6 rounded bg-elevated animate-pulse"}),e.jsx("div",{className:"w-16 h-6 rounded bg-elevated animate-pulse"})]})]}),e.jsx("div",{className:"px-3 py-3 space-y-3",children:[...Array(5)].map((s,t)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded bg-elevated animate-pulse"}),e.jsxs("div",{className:"flex-1 space-y-1.5",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-elevated animate-pulse"}),e.jsx("div",{className:"h-3 w-24 rounded bg-elevated animate-pulse"})]}),e.jsx("div",{className:"w-12 h-4 rounded bg-elevated animate-pulse"}),e.jsx("div",{className:"w-16 h-4 rounded bg-elevated animate-pulse"})]},t))})]})})]}),e.jsx(ie,{isOpen:!!Y,title:"Remove Contact",message:`Are you sure you would like to remove ${(null==Y?void 0:Y.name)||"this contact"}?`,confirmLabel:"Remove",cancelLabel:"Cancel",variant:"danger",onConfirm:()=>{Y&&r(Y.hash),ee(null)},onCancel:()=>ee(null)})]})}},Symbol.toStringTag,{value:"Module"}));export{_e as C,Me as P,be as R,ye as T,ve as a};
