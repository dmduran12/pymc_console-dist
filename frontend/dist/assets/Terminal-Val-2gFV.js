import{r as e,j as t,c as a}from"./vendor-react-BKIq8k5U.js";import{bf as r,a3 as s,bg as n,W as o,V as i,j as l,e as c,bh as d,bi as p,bj as m,bk as u,bl as y,bm as g,bn as h}from"./index-CrU_Ps9k.js";import{a as f}from"./ping-t2L803PH.js";import{c as v}from"./vendor-core-D1aqi_5O.js";import{P as b,d as x}from"./payload-decoders-N5zeG9av.js";import{P as w,b as _,B as S,a as O}from"./PageLayout-BlXA3E6H.js";import"./deckgl-DTsmDcfs.js";function k(){const e=new Date;return`${e.toISOString().slice(0,10)}_${e.toTimeString().slice(0,8).replace(/:/g,"-")}`}function $(e,t){return`pymc-${e.toISOString().slice(0,10)}-${e.toTimeString().slice(0,5).replace(":","")}-${t}s.json`}const P=v((e,t)=>({isCapturing:!1,captureStartTime:null,captureStartPacketHashes:new Set,captureTimer:null,reports:[],startCapture:a=>{const{captureTimer:r}=t();r&&clearTimeout(r),e({isCapturing:!0,captureStartTime:new Date,captureStartPacketHashes:new Set(a.map(e=>e.packet_hash))})},stopCapture:a=>{const{isCapturing:r,captureStartTime:s,captureStartPacketHashes:n,captureTimer:o}=t();if(!r||!s)return null;o&&clearTimeout(o);const i=new Date,l=Math.round((i.getTime()-s.getTime())/1e3),c=s.getTime()/1e3,d=a.filter(e=>!n.has(e.packet_hash)&&e.timestamp>=c).sort((e,t)=>e.timestamp-t.timestamp),p={id:k(),filename:$(s,l),startTime:s,endTime:i,durationSec:l,packetCount:d.length,packets:d,sizeBytes:500*d.length};return e(e=>({isCapturing:!1,captureStartTime:null,captureStartPacketHashes:new Set,captureTimer:null,reports:[p,...e.reports].slice(0,10)})),p},getReport:e=>t().reports.find(t=>t.id===e),_setTimer:t=>e({captureTimer:t})}));function C(e){var t;return(null==(t=e.match(/.{1,2}/g))?void 0:t.join(" ").toUpperCase())||""}function T(e){return void 0===e?"UNKNOWN":i[e]??`TYPE_${e}`}function E(e){return void 0===e?"UNKNOWN":o[e]??`ROUTE_${e}`}function N(e,t){switch(e){case 4:return function(e){const t=[];let a=0;if(e.length>=32&&(t.push({name:"public_key",offset:a,length:32,bytes:C(n(e.slice(a,a+32))),decoded:{value:n(e.slice(a,a+32))}}),a+=32),e.length>=a+4){const r=e.slice(a,a+4),s=r[0]|r[1]<<8|r[2]<<16|r[3]<<24;t.push({name:"timestamp",offset:a,length:4,bytes:C(n(r)),decoded:{value:s>>>0,iso:new Date(1e3*s).toISOString()}}),a+=4}if(e.length>=a+64&&(t.push({name:"signature",offset:a,length:64,bytes:C(n(e.slice(a,a+64))),decoded:{value:n(e.slice(a,a+64))}}),a+=64),e.length>a){const r=e[a],s=[];if(1&r&&s.push("CHAT_NODE"),2&r&&s.push("REPEATER"),3&r&&s.push("ROOM_SERVER"),16&r&&s.push("HAS_LOCATION"),128&r&&s.push("HAS_NAME"),t.push({name:"flags",offset:a,length:1,bytes:C(n(e.slice(a,a+1))),decoded:{value:r,binary:r.toString(2).padStart(8,"0"),flags:s}}),a+=1,16&r&&e.length>=a+8){const r=e.slice(a,a+8),s=new ArrayBuffer(8);new Uint8Array(s).set(r);const o=new DataView(s),i=o.getInt32(0,!0),l=o.getInt32(4,!0);t.push({name:"location",offset:a,length:8,bytes:C(n(r)),decoded:{lat_raw:i,lon_raw:l,latitude:i/1e6,longitude:l/1e6}}),a+=8}if(128&r&&e.length>a){const r=e.slice(a);let s=r.indexOf(0);-1===s&&(s=r.length);const o=(new TextDecoder).decode(r.slice(0,s));t.push({name:"name",offset:a,length:s+(0===r[s]?1:0),bytes:C(n(r.slice(0,s+1))),decoded:{value:o,encoding:"utf-8",null_terminated:0===r[s]}})}}return t}(t);case 3:return function(e){if(e.length<4)return[];const t=e.slice(0,4),a=t[0]|t[1]<<8|t[2]<<16|t[3]<<24;return[{name:"crc",offset:0,length:4,bytes:C(n(t)),decoded:{value:a>>>0,hex:(a>>>0).toString(16).toUpperCase().padStart(8,"0"),note:"CRC of the acknowledged packet (little-endian)"}}]}(t);case 9:return function(e){const t=[];if(e.length<9)return t;const a=e.slice(0,4),r=a[0]|a[1]<<8|a[2]<<16|a[3]<<24;t.push({name:"trace_tag",offset:0,length:4,bytes:C(n(a)),decoded:{value:r>>>0,hex:(r>>>0).toString(16).toUpperCase().padStart(8,"0")}});const s=e.slice(4,8),o=s[0]|s[1]<<8|s[2]<<16|s[3]<<24;if(t.push({name:"auth_code",offset:4,length:4,bytes:C(n(s)),decoded:{value:o>>>0}}),t.push({name:"flags",offset:8,length:1,bytes:C(n(e.slice(8,9))),decoded:{value:e[8],binary:e[8].toString(2).padStart(8,"0")}}),e.length>9){const a=e.slice(9),r=Array.from(a).map(e=>e.toString(16).toUpperCase().padStart(2,"0"));t.push({name:"target_path",offset:9,length:a.length,bytes:C(n(a)),decoded:{hops:r,path_string:r.join("->")}})}return t}(t);case 8:return function(e){if(0===e.length)return[];const t=Array.from(e).map(e=>e.toString(16).toUpperCase().padStart(2,"0"));return[{name:"path_hops",offset:0,length:e.length,bytes:C(n(e)),decoded:{hops:t,path_string:t.join("->")}}]}(t);case 5:return function(e){const t=[];if(e.length<1)return t;if(t.push({name:"channel_hash",offset:0,length:1,bytes:C(n(e.slice(0,1))),decoded:{value:e[0].toString(16).toUpperCase().padStart(2,"0")}}),e.length>13){const a=12,r=e.length-1-a;t.push({name:"ciphertext",offset:1,length:r,bytes:C(n(e.slice(1,1+r))),decoded:{length:r,note:"Encrypted message content"}}),t.push({name:"mac",offset:1+r,length:a,bytes:C(n(e.slice(-a))),decoded:{note:"Message authentication code"}})}return t}(t);default:return function(e){return 0===e.length?[]:[{name:"raw_data",offset:0,length:e.length,bytes:C(n(e)),decoded:{length:e.length}}]}(t)}}function j(e){const t=e.type??e.payload_type??0,a=e.route??e.route_type??0,r=e.raw_packet||"";let o,i=null;if(r){const t=b.fromHex(r);if(t.success&&t.packet){const e=t.packet;try{i=x(e)}catch{i=null}const a=s(r);let l=0;const c={offset:0,length:1,bytes:C(r.slice(0,2)),decoded:{route_type:e.routeType,route_name:e.routeTypeName,payload_type:e.payloadType,payload_name:e.payloadTypeName,version:e.payloadVersion}};l+=1,e.hasTransportCodes()&&(l+=4);const d={offset:l,length:1,bytes:C(n(a.slice(l,l+1))),decoded:{value:e.pathLen}};l+=1;const p=l,m=a.slice(l,l+e.pathLen),u=Array.from(e.path).map(e=>e.toString(16).toUpperCase().padStart(2,"0")),y=9===e.payloadType,g={offset:p,length:e.pathLen,bytes:C(n(m)),decoded:{hops:u,path_string:u.length>0?u.join("->"):"(direct)",...y&&{note:"For TRACE packets, path bytes are SNR×4 values, not node hashes",snr_values:Array.from(e.path).map(e=>{let t=e;return t>127&&(t-=256),t/4})}}};l+=e.pathLen,o={header:c,path_length:d,path:g,payload:{offset:l,length:e.payload.length,bytes:C(e.payloadHex),sections:N(e.payloadType,e.payload)}}}else o=D(e)}else o=D(e);return{timestamp:e.timestamp,packet_hash:e.packet_hash,type:t,type_name:T(t),route:a,route_name:E(a),rssi:e.rssi,snr:e.snr,length:e.length??0,src_hash:e.src_hash,dst_hash:e.dst_hash,transmitted:e.transmitted,drop_reason:e.drop_reason,is_duplicate:e.is_duplicate,lbt_attempts:e.lbt_attempts,lbt_backoff_delays_ms:e.lbt_backoff_delays_ms,lbt_channel_busy:e.lbt_channel_busy,raw_packet:r,structure:o,decoded:i}}function D(e){var t;const a=e.type??e.payload_type??0,r=e.route??e.route_type??0,n=e.original_path??e.forwarded_path??[];return{header:{offset:0,length:1,bytes:"??",decoded:{route_type:r,route_name:E(r),payload_type:a,payload_name:T(a),version:0}},path_length:{offset:1,length:1,bytes:n.length.toString(16).toUpperCase().padStart(2,"0"),decoded:{value:n.length}},path:{offset:2,length:n.length,bytes:n.join(" "),decoded:{hops:n,path_string:n.length>0?n.join("->"):"(direct)"}},payload:{offset:2+n.length,length:(null==(t=e.payload)?void 0:t.length)??0,bytes:e.payload??"",sections:e.payload?N(a,s(e.payload)):[]}}}function R(e,t){const a=function(e,t){var a;return{capture:{start:e.startTime.toISOString(),end:e.endTime.toISOString(),duration_sec:e.durationSec,packet_count:e.packetCount,node_name:(null==t?void 0:t.node_name)??"unknown",local_hash:(null==t?void 0:t.local_hash)??"unknown",pymc_console_version:r,pymc_repeater_version:(null==t?void 0:t.version)??"unknown",radio_config:(null==(a=null==t?void 0:t.config)?void 0:a.radio)?{frequency:t.config.radio.frequency,tx_power:t.config.radio.tx_power,bandwidth:t.config.radio.bandwidth,spreading_factor:t.config.radio.spreading_factor}:null},packets:e.packets.map(j)}}(e,t),s=JSON.stringify(a,null,2),n=new Blob([s],{type:"application/json"}),o=URL.createObjectURL(n),i=document.createElement("a");i.href=o,i.download=e.filename,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)}function I(e){return e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(1)} MB`}const G=v(e=>({entries:[],commandHistory:[],isInitialized:!1,addEntry:t=>{const a="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),r={...t,id:a,timestamp:Date.now()};return e(e=>({entries:[...e.entries,r]})),a},updateEntry:(t,a)=>{e(e=>({entries:e.entries.map(e=>e.id===t?{...e,...a}:e)}))},addCommand:t=>{e(e=>({commandHistory:[...e.commandHistory,t]}))},clearEntries:()=>{e({entries:[],commandHistory:[]})},setInitialized:t=>{e({isInitialized:t})}})),A=new Set(["start ota","erase","reboot"]),L=["gps","sensor"],W=[{cmd:"help",desc:"Show available commands"},{cmd:"clear",desc:"Clear terminal screen"},{cmd:"status",desc:"Get repeater status summary"},{cmd:"uptime",desc:"Show system uptime"},{cmd:"packets",desc:"Show packet statistics"},{cmd:"board",desc:"Show board/platform info"},{cmd:"ping",desc:"Ping neighbor (name or 0xXX)",params:"{target} [timeout]",required:!0},{cmd:"convert hex",desc:"Hex → base64 (for config.yaml)",params:"{hex}",required:!0},{cmd:"convert base64",desc:"Base64 → hex",params:"{base64}",required:!0},{cmd:"cap",desc:"Show capture help"},{cmd:"start cap",desc:"Start packet capture (default 120s)",params:"[seconds]"},{cmd:"end cap",desc:"Stop current capture"},{cmd:"list cap",desc:"List capture reports (clickable download)"},{cmd:"export cap",desc:"Download a capture report",params:"{id}"},...[{name:"get adc.multiplier",category:"get",params:[],description:"Get ADC multiplier for battery",serialOnly:!1,hasParam:!1},{name:"get advert.interval",category:"get",params:[],description:"Get local advert interval (minutes)",serialOnly:!1,hasParam:!1},{name:"get af",category:"get",params:[],description:"Get airtime factor",serialOnly:!1,hasParam:!1},{name:"get agc.reset.interval",category:"get",params:[],description:"Get AGC reset interval (seconds)",serialOnly:!1,hasParam:!1},{name:"get allow.read.only",category:"get",params:[],description:"Get read-only access setting",serialOnly:!1,hasParam:!1},{name:"get bridge.baud",category:"get",params:[],description:"Get bridge baud rate",serialOnly:!1,hasParam:!1},{name:"get bridge.channel",category:"get",params:[],description:"Get bridge channel (ESP-NOW)",serialOnly:!1,hasParam:!1},{name:"get bridge.delay",category:"get",params:[],description:"Get bridge delay (ms)",serialOnly:!1,hasParam:!1},{name:"get bridge.enabled",category:"get",params:[],description:"Get bridge enabled status",serialOnly:!1,hasParam:!1},{name:"get bridge.secret",category:"get",params:[],description:"Get bridge encryption secret",serialOnly:!1,hasParam:!1},{name:"get bridge.source",category:"get",params:[],description:"Get bridge packet source",serialOnly:!1,hasParam:!1},{name:"get bridge.type",category:"get",params:[],description:"Get bridge type (rs232/espnow/none)",serialOnly:!1,hasParam:!1},{name:"get direct.txdelay",category:"get",params:[],description:"Get direct TX delay factor",serialOnly:!1,hasParam:!1},{name:"get flood.advert.interval",category:"get",params:[],description:"Get flood advert interval (hours)",serialOnly:!1,hasParam:!1},{name:"get flood.max",category:"get",params:[],description:"Get max flood hops",serialOnly:!1,hasParam:!1},{name:"get freq",category:"get",params:[],description:"Get frequency (MHz)",serialOnly:!1,hasParam:!1},{name:"get guest.password",category:"get",params:[],description:"Get guest password",serialOnly:!1,hasParam:!1},{name:"get int.thresh",category:"get",params:[],description:"Get interference threshold",serialOnly:!1,hasParam:!1},{name:"get lat",category:"get",params:[],description:"Get latitude",serialOnly:!1,hasParam:!1},{name:"get lon",category:"get",params:[],description:"Get longitude",serialOnly:!1,hasParam:!1},{name:"get multi.acks",category:"get",params:[],description:"Get multi-ack setting",serialOnly:!1,hasParam:!1},{name:"get name",category:"get",params:[],description:"Get node name",serialOnly:!1,hasParam:!1},{name:"get prv.key",category:"get",params:[],description:"Get private key (hex)",serialOnly:!1,hasParam:!1},{name:"get public.key",category:"get",params:[],description:"Get public key (hex)",serialOnly:!1,hasParam:!1},{name:"get radio",category:"get",params:[],description:"Get radio params (freq,bw,sf,cr)",serialOnly:!1,hasParam:!1},{name:"get repeat",category:"get",params:[],description:"Get repeat/forward status (on/off)",serialOnly:!1,hasParam:!1},{name:"get role",category:"get",params:[],description:"Get device role",serialOnly:!1,hasParam:!1},{name:"get rxdelay",category:"get",params:[],description:"Get RX delay base",serialOnly:!1,hasParam:!1},{name:"get tx",category:"get",params:[],description:"Get TX power (dBm)",serialOnly:!1,hasParam:!1},{name:"get txdelay",category:"get",params:[],description:"Get TX delay factor",serialOnly:!1,hasParam:!1},{name:"gps",category:"gps",params:[],description:"Show GPS status",serialOnly:!1,hasParam:!1},{name:"gps advert",category:"gps",params:[],description:"Get/set GPS advert location policy",serialOnly:!1,hasParam:!0},{name:"gps off",category:"gps",params:[],description:"Disable GPS",serialOnly:!1,hasParam:!0},{name:"gps on",category:"gps",params:[],description:"Enable GPS",serialOnly:!1,hasParam:!0},{name:"gps setloc",category:"gps",params:[],description:"Set node location from GPS",serialOnly:!1,hasParam:!0},{name:"gps sync",category:"gps",params:[],description:"Sync time from GPS",serialOnly:!1,hasParam:!0},{name:"log",category:"logging",params:[],description:"Dump log file (serial only)",serialOnly:!0,hasParam:!1},{name:"log erase",category:"logging",params:[],description:"Erase log file",serialOnly:!1,hasParam:!0},{name:"log start",category:"logging",params:[],description:"Start packet logging",serialOnly:!1,hasParam:!0},{name:"log stop",category:"logging",params:[],description:"Stop packet logging",serialOnly:!1,hasParam:!0},{name:"neighbor.remove",category:"neighbor",params:[],description:"Remove neighbor by pubkey",serialOnly:!1,hasParam:!0},{name:"neighbors",category:"neighbor",params:[],description:"List neighbors",serialOnly:!1,hasParam:!1},{name:"get",category:"other",params:[],description:"Execute get command",serialOnly:!1,hasParam:!0},{name:"set",category:"other",params:[{name:"value",type:"float"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Execute set command",serialOnly:!1,hasParam:!0},{name:"tempradio",category:"radio",params:[{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Apply temporary radio params (freq bw sf cr timeout_mins)",serialOnly:!1,hasParam:!0},{name:"sensor get",category:"sensor",params:[],description:"Get sensor/custom variable value",serialOnly:!1,hasParam:!0},{name:"sensor list",category:"sensor",params:[{name:"value",type:"int"}],description:"List all sensor/custom variables",serialOnly:!1,hasParam:!0},{name:"sensor set",category:"sensor",params:[],description:"Set sensor/custom variable value",serialOnly:!1,hasParam:!0},{name:"set adc.multiplier",category:"set",params:[{name:"value",type:"float"}],description:"Set ADC multiplier",serialOnly:!1,hasParam:!0},{name:"set advert.interval",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"string"}],description:"Set local advert interval (1-10080 min, 0=off)",serialOnly:!1,hasParam:!0},{name:"set af",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set airtime factor (0-9)",serialOnly:!1,hasParam:!0},{name:"set agc.reset.interval",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set AGC reset interval (seconds, rounded to 4)",serialOnly:!1,hasParam:!0},{name:"set allow.read.only",category:"set",params:[{name:"value",type:"int"}],description:"Set read-only access (on/off)",serialOnly:!1,hasParam:!0},{name:"set bridge.baud",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set bridge baud (9600-115200)",serialOnly:!1,hasParam:!0},{name:"set bridge.channel",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"string"}],description:"Set bridge channel (1-14)",serialOnly:!1,hasParam:!0},{name:"set bridge.delay",category:"set",params:[{name:"value",type:"int"}],description:"Set bridge delay (0-10000 ms)",serialOnly:!1,hasParam:!0},{name:"set bridge.enabled",category:"set",params:[{name:"value",type:"int"}],description:"Enable/disable bridge",serialOnly:!1,hasParam:!0},{name:"set bridge.secret",category:"set",params:[{name:"value",type:"string"},{name:"value",type:"float"}],description:"Set bridge encryption secret",serialOnly:!1,hasParam:!0},{name:"set bridge.source",category:"set",params:[{name:"value",type:"int"}],description:"Set bridge source (rx/tx)",serialOnly:!1,hasParam:!0},{name:"set direct.txdelay",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"}],description:"Set direct TX delay factor",serialOnly:!1,hasParam:!0},{name:"set flood.advert.interval",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set flood advert interval (3-48 hours, 0=off)",serialOnly:!1,hasParam:!0},{name:"set flood.max",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"float"}],description:"Set max flood hops (0-64)",serialOnly:!1,hasParam:!0},{name:"set freq",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"}],description:"Set frequency MHz (serial only, reboot required)",serialOnly:!0,hasParam:!0},{name:"set guest.password",category:"set",params:[{name:"value",type:"string"}],description:"Set guest password",serialOnly:!1,hasParam:!0},{name:"set int.thresh",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set interference threshold",serialOnly:!1,hasParam:!0},{name:"set lat",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"float"},{name:"value",type:"float"}],description:"Set latitude",serialOnly:!1,hasParam:!0},{name:"set lon",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"float"},{name:"value",type:"float"}],description:"Set longitude",serialOnly:!1,hasParam:!0},{name:"set multi.acks",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set multi-ack (0/1)",serialOnly:!1,hasParam:!0},{name:"set name",category:"set",params:[{name:"value",type:"string"},{name:"value",type:"int"}],description:"Set node name",serialOnly:!1,hasParam:!0},{name:"set prv.key",category:"set",params:[{name:"value",type:"string"}],description:"Set private key (hex, restart required)",serialOnly:!1,hasParam:!0},{name:"set radio",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set radio params (freq bw sf cr)",serialOnly:!1,hasParam:!0},{name:"set repeat",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set repeat/forward (on/off)",serialOnly:!1,hasParam:!0},{name:"set rxdelay",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"float"}],description:"Set RX delay base",serialOnly:!1,hasParam:!0},{name:"set tx",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"float"}],description:"Set TX power (dBm)",serialOnly:!1,hasParam:!0},{name:"set txdelay",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"}],description:"Set TX delay factor",serialOnly:!1,hasParam:!0},{name:"stats-core",category:"stats",params:[],description:"Show core statistics (serial only)",serialOnly:!0,hasParam:!1},{name:"stats-packets",category:"stats",params:[],description:"Show packet statistics (serial only)",serialOnly:!0,hasParam:!1},{name:"stats-radio",category:"stats",params:[],description:"Show radio statistics (serial only)",serialOnly:!0,hasParam:!1},{name:"advert",category:"system",params:[],description:"Send self advertisement",serialOnly:!1,hasParam:!1},{name:"board",category:"system",params:[],description:"Show board/manufacturer name",serialOnly:!1,hasParam:!1},{name:"clear stats",category:"system",params:[],description:"Reset statistics counters",serialOnly:!1,hasParam:!0},{name:"clock",category:"system",params:[{name:"value",type:"int"}],description:"Display current time",serialOnly:!1,hasParam:!0},{name:"clock sync",category:"system",params:[],description:"Sync clock from sender timestamp",serialOnly:!1,hasParam:!0},{name:"password",category:"system",params:[{name:"value",type:"string"}],description:"Change admin password",serialOnly:!1,hasParam:!0},{name:"reboot",category:"system",params:[],description:"Reboot the device",serialOnly:!1,hasParam:!1},{name:"start ota",category:"system",params:[{name:"value",type:"int"}],description:"Start OTA firmware update",serialOnly:!1,hasParam:!0},{name:"time",category:"system",params:[{name:"value",type:"int"}],description:"Set time to epoch seconds",serialOnly:!1,hasParam:!0},{name:"ver",category:"system",params:[],description:"Show firmware version and build date",serialOnly:!1,hasParam:!1}].filter(e=>!e.serialOnly&&!A.has(e.name)&&!L.some(t=>e.name.startsWith(t))).map(e=>({cmd:e.name,desc:e.description,params:e.hasParam?"{value}":void 0,required:e.hasParam}))],U={"set mode":["forward","monitor"],"set duty":["on","off"],"set repeat":["on","off"],"set tx":["10","14","17","20","22"],"set sf":["7","8","9","10","11","12"],"set bw":["125","250","500"],"set af":["0.5","1.0","1.5","2.0"],"set txdelay":["0.5","0.7","1.0","1.5"],"set direct.txdelay":["0.3","0.5","0.7"],"set log":["debug","info","warning"],"start cap":["30","60","120","300"]};function F(e){switch(e){case"success":return"text-accent-success";case"error":return"text-accent-danger";case"warning":return"text-amber-400";case"info":return"text-accent-tertiary";case"value":return"text-accent-primary";case"system":return"text-text-muted";default:return"text-text-secondary"}}const H=e.memo(function({entry:r}){const s=P(),n=l(),o=e.useCallback(e=>{const t=s.getReport(e);t?R(t,n):alert("Report no longer available. Captures are stored in session memory only.")},[s,n]);return"command"===r.type?t.jsxs("div",{className:"flex items-center gap-2 py-1",children:[t.jsx("span",{className:"text-text-muted font-medium select-none",children:"$"}),t.jsx("span",{className:"text-text-primary font-semibold",children:r.content})]}):"system"===r.type?t.jsx("div",{className:a("py-0.5",F(r.outputType||"system")),children:r.content}):r.content.includes("██")?t.jsx("pre",{className:a("terminal-ascii font-mono leading-none py-2 whitespace-pre",F(r.outputType||"value")),children:r.content}):t.jsx("div",{className:"ml-4 font-mono text-[13px] py-1",children:r.content.split("\n").map((e,a)=>{const s=function(e,t){if(e.startsWith("REC:::"))return[{text:"●",color:"text-red-500 animate-pulse",isRecording:!0},{text:` ${e.slice(6)}`,color:"text-text-muted"}];const a=e.trimStart();if(a.startsWith("DOWNLOAD:::")){const t=e.slice(0,e.length-a.length),r=a.slice(11).split(":::"),[s,n]=r;return[{text:`${t}⇓ download "${n}"`,color:"text-accent-primary underline cursor-pointer hover:text-accent-secondary",isDownload:!0,downloadId:s,downloadFilename:n}]}if(e.startsWith("HELP_HEADER:::"))return[{text:e.slice(14),color:"text-text-primary font-bold"}];if(e.startsWith("HELP_NOTE:::"))return[{text:e.slice(12),color:"text-text-muted italic"}];const r=e.match(/^([a-z][a-z0-9.]*(?:\s+[a-z][a-z0-9.]*)?):::(.+)$/);if(r){const[,e,t]=r,a=e.split(" "),s=a[0];let n="text-accent-tertiary";"get"===s?n="text-accent-success":"set"===s&&(n="text-amber-400");const o=[{text:`  ${s}`,color:`${n} font-semibold`}];a.length>1&&o.push({text:` ${a.slice(1).join(" ")}`,color:"text-accent-primary"});const i=" ".repeat(Math.max(1,22-e.length));return o.push({text:`${i}${t}`,color:"text-text-muted"}),o}if("error"===t||"warning"===t)return[{text:e,color:F(t)}];if("value"===t)return[{text:e,color:F("value")}];const s=e.match(/^([\w\s.]+):\s*(.+)$/);if(s){const[,e,t]=s;return[{text:`${e}: `,color:"text-text-muted"},{text:t,color:"text-accent-primary font-semibold"}]}return e.startsWith("OK")?[{text:e,color:F("success")}]:[{text:e,color:F(t)}]}(e,r.outputType||"default");return t.jsx("div",{className:"leading-relaxed",children:s.map((e,a)=>e.isDownload?t.jsx("span",{className:e.color,onClick:()=>o(e.downloadId),role:"button",tabIndex:0,onKeyDown:t=>"Enter"===t.key&&o(e.downloadId),children:e.text},a):t.jsx("span",{className:e.color,children:e.text},a))},a)})})});function M(){const r=l(),s=c(),n=P(),o=G(e=>e.entries),i=G(e=>e.commandHistory),v=G(e=>e.isInitialized),{addEntry:b,updateEntry:x,addCommand:k,clearEntries:$,setInitialized:C}=G(),[T,E]=e.useState(""),[N,j]=e.useState(-1),[D,A]=e.useState(!1),[L,F]=e.useState([]),[M,q]=e.useState(0),[z,K]=e.useState(0),[B,X]=e.useState(!1),V=e.useRef(null),J=e.useRef(null),Q=e.useRef(null),Y=e.useRef(s);e.useEffect(()=>{Y.current=s},[s]),e.useEffect(()=>{v||(async()=>{b({type:"output",content:"██████  ██    ██ ███    ███  ██████\n██   ██  ██  ██  ████  ████ ██     \n██████    ████   ██ ████ ██ ██     \n██         ██    ██  ██  ██ ██     \n██         ██    ██      ██  ██████",outputType:"value"}),await new Promise(e=>setTimeout(e,200));const e=b({type:"system",content:"● Initializing terminal...",outputType:"system"});await new Promise(e=>setTimeout(e,400)),x(e,{content:"✓ Initializing terminal...",outputType:"success"});const t=b({type:"system",content:"● Connecting to repeater...",outputType:"system"});await new Promise(e=>setTimeout(e,600)),x(t,{content:"✓ Connected to repeater",outputType:"success"}),b({type:"system",content:"Ready. Type 'help' for commands.",outputType:"system"}),C(!0)})()},[v,b,x,C]),e.useEffect(()=>{J.current&&(J.current.scrollTop=J.current.scrollHeight)},[o]);const Z=e.useCallback(()=>{var e;const t=window.getSelection();t&&t.toString().length>0||null==(e=V.current)||e.focus()},[]),ee=e.useMemo(()=>(null==r?void 0:r.neighbors)?Object.values(r.neighbors).map(e=>e.node_name||e.name).filter(e=>!!e).sort():[],[null==r?void 0:r.neighbors]),te=e.useCallback(e=>{const t=e.trim().toLowerCase();if(!t)return A(!1),void F([]);const a=W.filter(e=>e.cmd.toLowerCase().startsWith(t));if(a.length>0)return F(a),q(0),void A(!0);if(t.includes(" ")){const e=t.lastIndexOf(" "),a=t.substring(0,e),r=t.substring(e+1);if("ping"===a&&ee.length>0){const e=ee.filter(e=>e.toLowerCase().startsWith(r)).slice(0,10).map(e=>({cmd:`ping ${e}`,desc:`→ ${e}`}));if(e.length>0)return F(e),q(0),void A(!0)}if("export cap"===a&&n.reports.length>0){const e=n.reports.map((e,t)=>({id:e.id,index:String(t+1),pkts:e.packetCount,duration:e.durationSec})).filter(e=>e.id.toLowerCase().startsWith(r)||e.index.startsWith(r)).slice(0,10).map(e=>({cmd:`export cap ${e.index}`,desc:`${e.pkts} pkts • ${e.duration}s`}));if(e.length>0)return F(e),q(0),void A(!0)}const s=W.find(e=>e.cmd.toLowerCase()===a);if(s&&U[s.cmd]){const e=U[s.cmd].filter(e=>e.toLowerCase().startsWith(r)).map(e=>({cmd:`${s.cmd} ${e}`,desc:`→ ${e}`}));if(e.length>0)return F(e),q(0),void A(!0)}}A(!1),F([])},[ee,n.reports]),ae=e.useCallback(e=>{var t;const a=L[e];a&&(a.required&&a.params?(E(a.cmd+" "),te(a.cmd+" ")):(E(a.cmd),A(!1)),null==(t=V.current)||t.focus())},[L,te]),re=e.useCallback(async e=>{var t,a,o,i,l,c,h,v,w;const _=e.trim();if(!_)return;const S=_.toLowerCase();if(k(_),b({type:"command",content:_}),"clear"===S)return void $();if("help"===S){const e=W.map(e=>`${e.cmd}:::${e.desc}`).join("\n");return void b({type:"output",content:`HELP_HEADER:::Available commands\n${e}\nHELP_NOTE:::Some MeshCore commands not available via HTTP.`,outputType:"default"})}const O=b({type:"output",content:"processing...",outputType:"system"});try{const e=await d();let k="",$="info";const E=e=>{const t=Math.floor(e/86400),a=Math.floor(e%86400/3600),r=Math.floor(e%3600/60);return t>0?`${t}d ${a}h ${r}m`:a>0?`${a}h ${r}m`:`${r}m`};if("status"===S){k=`Mode: ${(null==(a=null==(t=e.config)?void 0:t.repeater)?void 0:a.mode)||"unknown"} | Neighbors: ${Object.keys(e.neighbors||{}).length} | Uptime: ${E(e.uptime_seconds||0)}`}else if("uptime"===S)k=E(e.uptime_seconds||0),$="value";else if("packets"===S)k=`rx: ${e.rx_count??0}\ntx: ${e.tx_count??0}\nfwd: ${e.forwarded_count??0}\ndrop: ${e.dropped_count??0}`;else if("neighbors"===S){const t=e.neighbors||{},a=Object.entries(t);if(0===a.length)k="No neighbors discovered yet.",$="warning";else{const e=a.map(([e,t])=>{const a=t.name||t.node_name||"Unknown";return`  ${e.slice(0,8)}  ${a}`});k=`Neighbors (${a.length}):\n${e.join("\n")}`}}else if("board"===S)k="pyMC_Repeater (Linux/RPi)",$="value";else if(S.startsWith("get ")){const t=S.slice(4).trim(),a=null==(o=e.config)?void 0:o.delays,r=null==(i=e.config)?void 0:i.radio,s=null==(l=e.config)?void 0:l.repeater,n=null==(c=e.config)?void 0:c.duty_cycle;switch(t){case"name":k=(null==(h=e.config)?void 0:h.node_name)||"Unknown";break;case"role":k="repeater";break;case"lat":k=null!=(null==s?void 0:s.latitude)?String(s.latitude):"not set";break;case"lon":k=null!=(null==s?void 0:s.longitude)?String(s.longitude):"not set";break;case"freq":k=(null==r?void 0:r.frequency)?(r.frequency/1e6).toFixed(3):"?";break;case"tx":k=String((null==r?void 0:r.tx_power)??"?");break;case"bw":k=(null==r?void 0:r.bandwidth)?String(r.bandwidth/1e3):"?";break;case"sf":k=String((null==r?void 0:r.spreading_factor)??"?");break;case"cr":k=String((null==r?void 0:r.coding_rate)??"?");break;case"radio":k=r?`freq: ${(r.frequency/1e6).toFixed(3)} MHz\nbw: ${r.bandwidth/1e3} kHz\nsf: ${r.spreading_factor}\ncr: 4/${r.coding_rate}`:"?";break;case"af":case"txdelay":k=String((null==a?void 0:a.tx_delay_factor)??"1.0");break;case"direct.txdelay":k=String((null==a?void 0:a.direct_tx_delay_factor)??"0.5");break;case"mode":k=(null==s?void 0:s.mode)||"forward";break;case"repeat":k="forward"===(null==s?void 0:s.mode)?"on":"off";break;case"flood.max":k=String((null==s?void 0:s.max_flood_hops)??"3");break;case"flood.advert.interval":k=null!=(null==s?void 0:s.send_advert_interval_hours)?`${s.send_advert_interval_hours}h`:"?";break;case"advert.interval":k=null!=(null==s?void 0:s.advert_interval_minutes)?`${s.advert_interval_minutes}m`:"120m";break;case"rxdelay":k=String((null==a?void 0:a.rx_delay_base)??"0.0");break;case"duty":case"duty.enabled":k=(null==n?void 0:n.enforcement_enabled)?"on":"off";break;case"duty.max":k=null!=(null==n?void 0:n.max_airtime_percent)?`${n.max_airtime_percent}%`:"?";break;case"public.key":k=e.public_key||"not available";break;case"prv.key":k="Private key stored in /etc/pymc_repeater/config.yaml\n\nTo view: sudo grep identity_key /etc/pymc_repeater/config.yaml\nTo set:  sudo ./convert_firmware_key.sh <64-byte-hex>",$="info";break;case"guest.password":case"allow.read.only":k="Security settings not exposed via stats API.\nCheck /etc/pymc_repeater/config.yaml",$="warning";break;default:k=`Unknown parameter: ${t}\nAvailable: name, role, lat, lon, freq, tx, bw, sf, cr, radio, af, txdelay, direct.txdelay, rxdelay, mode, repeat, flood.max, advert.interval, duty, public.key`,$="error"}"error"!==$&&($="value")}else if("advert"===S){const e=await p();k=e.success?"OK - Advert sent":`Error: ${e.error||"Failed"}`,$=e.success?"success":"error"}else if(S.startsWith("set mode ")){const e=S.split(" ")[2];if("forward"!==e&&"monitor"!==e)k='Error: Mode must be "forward" or "monitor"',$="error";else{const t=await m(e);k=t.success?`OK - Mode set to ${e}`:"Error: Failed",$=t.success?"success":"error"}}else if(S.startsWith("set duty ")){const e=S.split(" ")[2],t="on"===e||"1"===e,a=await u(t);k=a.success?"OK - Duty cycle "+(t?"enabled":"disabled"):"Error: Failed",$=a.success?"success":"error"}else if(S.startsWith("set tx ")){const e=parseInt(S.split(" ")[2]);if(isNaN(e)||e<2||e>22)k="Error: TX power must be 2-22 dBm (SX1262 chip max)",$="error";else{const t=await y({tx_power:e});k=t.success?`OK - TX power set to ${e}dBm`:`Error: ${t.error||"Failed"}`,$=t.success?"success":"error"}}else if(S.startsWith("set af ")||S.startsWith("set txdelay ")){const e=parseFloat(S.split(" ")[2]);if(isNaN(e)||e<0||e>5)k="Error: TX delay factor must be 0.0-5.0",$="error";else{const t=await y({tx_delay_factor:e});k=t.success?`OK - TX delay set to ${e}`:`Error: ${t.error||"Failed"}`,$=t.success?"success":"error"}}else if(S.startsWith("set direct.txdelay ")){const e=parseFloat(S.split(" ")[2]);if(isNaN(e)||e<0||e>5)k="Error: Direct TX delay must be 0.0-5.0",$="error";else{const t=await y({direct_tx_delay_factor:e});k=t.success?`OK - Direct TX delay set to ${e}`:`Error: ${t.error||"Failed"}`,$=t.success?"success":"error"}}else if(S.startsWith("set log ")){const e=null==(v=S.split(" ")[2])?void 0:v.toUpperCase();if(["DEBUG","INFO","WARNING","ERROR"].includes(e)){const t=await g(e);k=t.success?`OK - Log level set to ${e}`:`Error: ${t.error||"Failed"}`,$=t.success?"success":"error"}else k="Error: Level must be debug, info, warning, or error",$="error"}else if(S.startsWith("set rxdelay ")){const e=parseFloat(S.split(" ")[2]);if(isNaN(e)||e<0)k="Error: RX delay must be >= 0",$="error";else{const t=await y({rx_delay_base:e});k=t.success?`OK - RX delay base set to ${e}s`:`Error: ${t.error||"Failed"}`,$=t.success?"success":"error"}}else if(S.startsWith("set name ")){const e=_.substring(9).trim();if(e){const t=await y({node_name:e});k=t.success?`OK - Node name set to "${e}"`:`Error: ${t.error||"Failed"}`,$=t.success?"success":"error"}else k="Error: Node name cannot be empty",$="error"}else if(S.startsWith("set lat ")){const e=parseFloat(S.split(" ")[2]);if(isNaN(e)||e<-90||e>90)k="Error: Latitude must be -90 to 90",$="error";else{const t=await y({latitude:e});k=t.success?`OK - Latitude set to ${e}°`:`Error: ${t.error||"Failed"}`,$=t.success?"success":"error"}}else if(S.startsWith("set lon ")){const e=parseFloat(S.split(" ")[2]);if(isNaN(e)||e<-180||e>180)k="Error: Longitude must be -180 to 180",$="error";else{const t=await y({longitude:e});k=t.success?`OK - Longitude set to ${e}°`:`Error: ${t.error||"Failed"}`,$=t.success?"success":"error"}}else if(S.startsWith("set flood.max ")){const e=parseInt(S.split(" ")[2]);if(isNaN(e)||e<0||e>64)k="Error: Max flood hops must be 0-64",$="error";else{const t=await y({max_flood_hops:e});k=t.success?`OK - Max flood hops set to ${e}`:`Error: ${t.error||"Failed"}`,$=t.success?"success":"error"}}else if(S.startsWith("set flood.advert.interval ")){const e=parseInt(S.split(" ")[2]);if(isNaN(e)||0!==e&&(e<3||e>48))k="Error: Flood advert interval must be 0 (off) or 3-48 hours",$="error";else{const t=await y({flood_advert_interval_hours:e});k=t.success?0===e?"OK - Flood adverts disabled":`OK - Flood advert interval set to ${e}h`:`Error: ${t.error||"Failed"}`,$=t.success?"success":"error"}}else if(S.startsWith("set advert.interval ")){const e=parseInt(S.split(" ")[2]);if(isNaN(e)||0!==e&&(e<1||e>10080))k="Error: Advert interval must be 0 (off) or 1-10080 minutes",$="error";else{const t=await y({advert_interval_minutes:e});k=t.success?0===e?"OK - Local adverts disabled":`OK - Local advert interval set to ${e}m`:`Error: ${t.error||"Failed"}`,$=t.success?"success":"error"}}else if(S.startsWith("set prv.key ")){const e=_.substring(12).trim();e?/^[0-9a-fA-F]+$/.test(e)?128!==e.length?(k=`Error: Key must be 64 bytes (128 hex chars), got ${e.length} chars`,$="error"):(k=`To set this key, run on the Pi:\n\n  sudo ./convert_firmware_key.sh ${e}\n\nThen restart: sudo systemctl restart pymc-repeater`,$="info"):(k="Error: Private key must be a hex string",$="error"):(k="Error: Private key cannot be empty",$="error")}else if(S.startsWith("convert hex ")){const e=_.substring(12).trim();if(e)if(/^[0-9a-fA-F]+$/.test(e))if(e.length%2!=0)k="Error: Hex string must have even length",$="error";else try{const t=new Uint8Array(e.length/2);for(let s=0;s<e.length;s+=2)t[s/2]=parseInt(e.substring(s,s+2),16);let a="";const r=8192;for(let e=0;e<t.length;e+=r){const s=t.subarray(e,Math.min(e+r,t.length));a+=String.fromCharCode.apply(null,Array.from(s))}k="function"==typeof globalThis.btoa?globalThis.btoa(a):Buffer.from(a,"binary").toString("base64"),$="value"}catch(C){k=`Error: Failed to convert - ${C instanceof Error?C.message:"unknown error"}`,$="error"}else k="Error: Input must be a hex string",$="error";else k="Usage: convert hex <hex-string>",$="error"}else if(S.startsWith("convert base64 ")){const e=_.substring(15).trim();if(e)try{const t="function"==typeof globalThis.atob?globalThis.atob(e):Buffer.from(e,"base64").toString("binary");let a="";for(let e=0;e<t.length;e++)a+=t.charCodeAt(e).toString(16).padStart(2,"0");k=a.toUpperCase(),$="value"}catch(C){k=`Error: Invalid base64 string - ${C instanceof Error?C.message:"unknown error"}`,$="error"}else k="Usage: convert base64 <base64-string>",$="error"}else if(S.startsWith("ping ")){const e=_.substring(5).trim(),t=e.split(/\s+/),a=t[t.length-1],r=parseInt(a),s=t.length>1&&!isNaN(r)&&r>0,n=s?t.slice(0,-1).join(" "):e,o=s?r:30;if(n){let e=1;const t=setInterval(()=>{e=e%3+1,x(O,{content:`Pinging ${n}${".".repeat(e)}`,outputType:"system"})},800);try{const e=await f(n,o);if(clearInterval(t),e.success&&e.data){const t=e.data,a=(null==(w=t.path)?void 0:w.length)?t.path.join(" → "):"direct";k=`Reply from ${t.target_id}\n  RTT: ${t.rtt_ms.toFixed(1)}ms\n  RSSI: ${t.rssi}dBm\n  SNR: ${t.snr_db}dB\n  Path: ${a}\n  Quality: ${t.quality}`,$="success"}else k=e.error||"Ping failed",$="error"}catch(T){throw clearInterval(t),T}}else k="Usage: ping <node_name> [timeout]",$="error"}else if("cap"===S||"cap help"===S){const e=n.isCapturing?'\nREC:::Recording in progress... use "end cap" to stop':"",t=n.reports.length;k=`HELP_HEADER:::Packet Capture\n\nstart cap:::Start capture (default: 120s)\nend cap:::Stop capture early\nlist cap:::List saved captures${t>0?` (${t} saved)`:""}\nexport cap:::Download capture by ID\n\nHELP_NOTE:::Captures stored in session memory. JSON includes decoded payloads.${e}`,$="info"}else if("start cap"===S||S.startsWith("start cap ")){const e=S.slice(10).trim(),t=e?parseInt(e):120;if(isNaN(t)||t<1||t>3600)k="Error: Duration must be 1-3600 seconds",$="error";else{if(!n.isCapturing){n.startCapture(s);let e=t;x(O,{content:`REC:::Capturing... ${e}s remaining`,outputType:"system"});const a=setInterval(()=>{e--;const t=P.getState();if(e>=0&&t.isCapturing){const a=Y.current.filter(e=>{if(!t.captureStartTime)return!1;const a=t.captureStartTime.getTime()/1e3;return e.timestamp>=a&&!t.captureStartPacketHashes.has(e.packet_hash)}).length;x(O,{content:`REC:::Capturing... ${e>0?`${e}s remaining`:"finishing..."} (${a} captured)`,outputType:"system"})}},1e3),r=setTimeout(()=>{clearInterval(a);const e=P.getState();if(e.isCapturing){const t=Y.current,a=e.stopCapture(t);b(a?{type:"output",content:`✓ Capture complete!\n  Captured: ${a.packetCount} packets\n  Duration: ${a.durationSec}s\n  Size: ~${I(a.sizeBytes)}\n\nDOWNLOAD:::${a.id}:::${a.filename}`,outputType:"success"}:{type:"output",content:"Capture completed with no packets.",outputType:"warning"})}},1e3*t);return void n._setTimer(r)}k='Error: Capture already in progress. Use "end cap" first.',$="error"}}else if("end cap"===S)if(n.isCapturing){const e=n.stopCapture(s);e?(k=`✓ Capture complete!\n  Captured: ${e.packetCount} packets\n  Duration: ${e.durationSec}s\n  Size: ~${I(e.sizeBytes)}\n\nDOWNLOAD:::${e.id}:::${e.filename}`,$="success"):(k="Capture stopped with no packets.",$="warning")}else k="No capture in progress.",$="warning";else if("list cap"===S){const e=n.reports;if(0===e.length)k="No capture reports available.\nStart a capture with: start cap [seconds]",$="info";else{const t=e.map((e,t)=>`  ${t+1}. ${e.packetCount} pkts • ${e.durationSec}s • ~${I(e.sizeBytes)}\n     DOWNLOAD:::${e.id}:::${e.filename}`);k=`Capture Reports (${e.length}):\n${t.join("\n")}`,$="info"}}else if("export cap"===S||S.startsWith("export cap ")){const e=S.slice(11).trim();if(e){const t=n.getReport(e);if(t)R(t,r),k=`✓ Downloading ${t.filename}...`,$="success";else{const t=parseInt(e)-1,a=n.reports[t];a?(R(a,r),k=`✓ Downloading ${a.filename}...`,$="success"):(k=`Error: Report "${e}" not found.\nUse "list cap" to see available reports.`,$="error")}}else{const e=n.reports;0===e.length?(k="No capture reports available.\nStart a capture with: start cap [seconds]",$="info"):(k=`Usage: export cap <id>\n\nAvailable reports:\n${e.map((e,t)=>`  ${t+1}. ${e.id}`).join("\n")}`,$="info")}}else k=`Unknown command: ${_}\nType 'help' for available commands.`,$="error";x(O,{content:k,outputType:$})}catch(E){x(O,{content:`Error: ${E instanceof Error?E.message:"Command failed"}`,outputType:"error"})}},[b,k,x,$,n,s,r]),se=e.useCallback(e=>{var t,a,r,s,n,o;if(D&&L.length>0){if("ArrowDown"===e.key){e.preventDefault();const s=Math.min(M+1,L.length-1);return q(s),void(null==(r=null==(a=null==(t=Q.current)?void 0:t.children[0])?void 0:a.children[s])||r.scrollIntoView({block:"nearest"}))}if("ArrowUp"===e.key){e.preventDefault();const t=Math.max(M-1,0);return q(t),void(null==(o=null==(n=null==(s=Q.current)?void 0:s.children[0])?void 0:n.children[t])||o.scrollIntoView({block:"nearest"}))}if("Tab"===e.key)return e.preventDefault(),void ae(M);if("Escape"===e.key)return e.preventDefault(),void A(!1)}if("Enter"===e.key){if(e.preventDefault(),D&&L.length>0){const e=L[M].cmd;return E(""),j(-1),A(!1),void re(e)}const t=T;return E(""),j(-1),A(!1),void re(t)}if("ArrowUp"!==e.key||D)if("ArrowDown"!==e.key||D);else if(e.preventDefault(),N>0){const e=N-1;j(e),E(i[i.length-1-e]||"")}else 0===N&&(j(-1),E(""));else if(e.preventDefault(),i.length>0&&N<i.length-1){const e=N+1;j(e),E(i[i.length-1-e]||"")}},[D,L,M,ae,T,i,N,re]),ne=e.useCallback(e=>{E(e.target.value),K(e.target.selectionStart||e.target.value.length),te(e.target.value)},[te]),oe=e.useCallback(e=>{const t=e.target;K(t.selectionStart||0)},[]);return t.jsxs(w,{children:[t.jsx(_,{title:"Terminal",icon:t.jsx(h,{})}),t.jsx(S,{children:t.jsxs(O,{noPadding:!0,className:"terminal-card overflow-hidden flex flex-col isolate",onClick:Z,children:[t.jsx("div",{ref:J,className:"flex-1 overflow-y-auto font-mono text-sm p-3 sm:p-4 md:p-5 surface-themed","data-theme":"terminal",children:o.map(e=>t.jsx(H,{entry:e},e.id))}),t.jsxs("div",{className:"relative surface-themed","data-theme":"terminal-input",children:[t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 px-3 sm:px-4 py-2 sm:py-3",children:[t.jsx("span",{className:"text-text-muted font-mono font-bold select-none",children:"$"}),t.jsxs("div",{className:"flex-1 relative font-mono text-sm",children:[t.jsx("input",{ref:V,type:"text",value:T,onChange:ne,onKeyDown:se,onSelect:oe,onFocus:()=>X(!0),onBlur:()=>X(!1),disabled:!v,className:"absolute inset-0 w-full bg-transparent text-transparent outline-none disabled:opacity-50 selection:bg-transparent",style:{caretColor:"transparent"},autoFocus:!0,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1}),t.jsx("div",{className:"relative pointer-events-none select-none","aria-hidden":!0,children:v?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-text-primary",children:T.slice(0,z)}),t.jsx("span",{className:a("inline-block w-[0.6em] h-[1.2em] align-text-bottom",B?"bg-accent-primary":"bg-text-muted/30"),style:{marginBottom:"-0.1em"},children:t.jsx("span",{className:"text-bg-primary",children:T[z]||""})}),t.jsx("span",{className:"text-text-primary",children:T.slice(z+1)})]}):t.jsx("span",{className:"text-text-muted",children:"Connecting..."})})]})]}),t.jsxs("div",{className:"px-3 sm:px-4 py-1 flex justify-between text-[10px] text-text-muted surface-themed","data-theme":"terminal-status",children:[t.jsx("span",{className:"hidden sm:inline",children:"↑↓ History"}),t.jsx("span",{className:"sm:hidden",children:"Terminal"}),(null==r?void 0:r.version)&&t.jsxs("span",{children:["pyMC v",r.version]})]})]}),D&&L.length>0&&t.jsxs("div",{ref:Q,className:"absolute left-2 right-2 bottom-[72px] radius-inset overflow-hidden z-50 surface-themed","data-theme":"terminal-autocomplete",children:[t.jsx("div",{className:"max-h-64 overflow-y-auto",children:L.map((e,r)=>t.jsxs("div",{onClick:()=>ae(r),className:a("px-4 py-2.5 cursor-pointer last:border-b-0 transition-colors surface-divider-bottom",r===M?"bg-accent-primary/25":""),"data-theme":"terminal",onMouseEnter:e=>{r!==M&&(e.currentTarget.style.background="var(--terminal-autocomplete-hover)")},onMouseLeave:e=>{r!==M&&(e.currentTarget.style.background="transparent")},children:[t.jsx("span",{className:a("font-mono text-sm",r===M?"text-accent-primary":"text-text-primary"),children:e.cmd}),t.jsx("span",{className:"text-xs text-text-muted ml-4",children:e.desc})]},e.cmd))}),t.jsx("div",{className:"px-3 py-1.5 text-[10px] text-text-muted text-right surface-divider-top","data-theme":"terminal",style:{backgroundColor:"var(--terminal-autocomplete-hover)"},children:"Tab to select"})]})]})})]})}export{M as default};
