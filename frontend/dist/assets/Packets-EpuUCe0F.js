import{r as e,j as a,H as s,c as l,m as t,B as r,U as i,n as o}from"./vendor-react-54o2BuWt.js";import{C as n,u as c,f as d,e as m,y as u,z as p,E as x,L as h,G as b,R as j,X as v}from"./index-W7HOJkA3.js";import{C as g,a as f}from"./DataBox-B3hWOq8z.js";import{g as y,A as N,P as w}from"./PacketList-BK_3Ivaj.js";import{A as k}from"./arrow-up-B3nwhPdL.js";import{C}from"./SignalIndicator-gITjxuU7.js";import{U as S,F as R}from"./users-DrLuMr7k.js";import{P,b as L,a as M}from"./PageLayout-BreM1jWS.js";import{R as F}from"./refresh-cw-B9GYY3zQ.js";import{C as A}from"./Card-ADh2cW78.js";import"./deckgl-DTsmDcfs.js";import"./vendor-core-dnrJb0w-.js";import"./channel-keys-DJWRrSwE.js";import"./chevron-right-B-fW81Tj.js";import"./loader-circle-BFq8BFSi.js";import"./map-pin-BiNqduy8.js";import"./zap-BAnS4MDP.js";import"./triangle-alert-DJGP4SlO.js";import"./route-B-i3IDor.js";import"./chevron-up-kiCOpps9.js";import"./circle-check-BReqF2aY.js";import"./house-BPur0bhT.js";import"./useThemeColors-BvPNffvW.js";function _({options:o,value:c,onChange:d,defaultValue:m,displayValue:u,filter:p,placeholder:x,disabled:h,invalid:b,name:j,"aria-label":v,className:g,children:f}){const[y,N]=e.useState(""),w=u??(e=>null!=e?String(e):""),k=p??((e,a)=>w(e).toLowerCase().includes(a.toLowerCase())),C=e.useMemo(()=>y?o.filter(e=>k(e,y)):o,[o,y,k]);return a.jsx(s,{value:c,onChange:d,defaultValue:m,disabled:h,name:j,onClose:()=>N(""),children:a.jsxs("div",{className:l("relative",g),children:[a.jsxs("div",{className:"relative",children:[a.jsx(t,{"aria-label":v,displayValue:w,onChange:e=>N(e.target.value),placeholder:x,className:l(["w-full rounded-lg py-2 pl-3 pr-10","text-sm text-text-primary placeholder:text-text-muted","bg-bg-subtle border",b?"border-accent-danger":"border-border-subtle","focus:outline-none focus:border-accent-primary/50 focus:ring-1 focus:ring-accent-primary/20","hover:border-border-strong","disabled:opacity-50 disabled:cursor-not-allowed","transition-colors duration-150"])}),a.jsx(r,{className:"absolute inset-y-0 right-0 flex items-center pr-3 group",children:a.jsx(n,{className:"w-4 h-4 text-text-muted transition-transform duration-200 group-data-[open]:rotate-180"})})]}),a.jsx(i,{anchor:"bottom start",transition:!0,className:l(["w-[var(--input-width)] min-w-[180px]","max-h-60 overflow-y-auto overscroll-contain scroll-py-1","rounded-lg p-1 mt-1","glass-card-elevated","focus:outline-none","transition-opacity duration-150 ease-out","data-[closed]:opacity-0","data-[enter]:duration-150 data-[leave]:duration-100","z-50"]),children:0===C.length&&""!==y?a.jsx("div",{className:"px-3 py-2 text-sm text-text-muted",children:"No results found"}):C.map((s,l)=>a.jsx(e.Fragment,{children:f(s)},l))})]})})}function D({value:s,disabled:t,className:r,children:i}){return a.jsx(o,{as:e.Fragment,value:s,disabled:t,children:({selected:e,focus:s})=>a.jsxs("div",{className:l("flex items-center gap-2 px-3 py-2 rounded-md cursor-default","text-sm",s&&"bg-accent-primary text-white",!s&&"text-text-primary",e&&!s&&"text-accent-primary",t&&"opacity-50 cursor-not-allowed",r),children:[a.jsx("span",{className:"w-4 flex-shrink-0",children:e&&a.jsx(g,{className:"w-4 h-4"})}),a.jsx("span",{className:"truncate flex-1",children:i})]})})}function z({className:e,...s}){return a.jsx("span",{...s,className:l("truncate",e)})}function T({value:e,onChange:s,options:l,placeholder:t,disabled:r,className:i,"aria-label":o}){const n=l.find(a=>a.value===e);return a.jsx(_,{options:l,value:n,onChange:e=>{e&&s(e.value)},displayValue:e=>(null==e?void 0:e.label)??"",filter:(e,a)=>e.label.toLowerCase().includes(a.toLowerCase()),placeholder:t,disabled:r,className:i,"aria-label":o,children:e=>a.jsx(D,{value:e,disabled:e.disabled,children:a.jsx(z,{children:e.label})})})}function V({icon:e,label:s,value:t,color:r,percentage:i}){return a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:l("p-1.5 rounded-md",r),children:e}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-sm font-semibold text-text-primary",children:t.toLocaleString()}),a.jsxs("span",{className:"text-[10px] text-text-muted leading-tight",children:[s,void 0!==i&&a.jsxs("span",{className:"ml-1 opacity-70",children:["(",i,"%)"]})]})]})]})}const B=e.memo(function({packets:s}){const l=e.useMemo(()=>{let e=0,a=0,l=0;const t=new Set;let r=0,i=0;for(const c of s){switch(y(c)){case"forward":e++;break;case"dropped":a++;break;case"duplicate":l++}c.src_hash&&t.add(c.src_hash),c.rssi&&(r+=c.rssi,i++)}const o=s.length,n=i>0?Math.round(r/i):0;return{total:o,rx:o,fwd:e,dropped:a,duplicate:l,uniqueSources:t.size,avgRssi:n,rxPercent:100,fwdPercent:o>0?Math.round(e/o*100):0,droppedPercent:o>0?Math.round(a/o*100):0}},[s]);return 0===s.length?null:a.jsx("div",{className:"glass-card p-3 pr-4",children:a.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:flex sm:items-center sm:justify-between sm:gap-6",children:[a.jsx(V,{icon:a.jsx(k,{className:"w-3.5 h-3.5 text-accent-primary"}),label:"Received",value:l.rx,color:"bg-accent-primary/10",percentage:l.rxPercent}),a.jsx(V,{icon:a.jsx(N,{className:"w-3.5 h-3.5 text-accent-success"}),label:"Forwarded",value:l.fwd,color:"bg-accent-success/10",percentage:l.fwdPercent}),a.jsx(V,{icon:a.jsx(C,{className:"w-3.5 h-3.5 text-accent-danger"}),label:"Dropped",value:l.dropped,color:"bg-accent-danger/10",percentage:l.droppedPercent}),a.jsx(V,{icon:a.jsx(f,{className:"w-3.5 h-3.5 text-text-muted"}),label:"Duplicates",value:l.duplicate,color:"bg-white/5"}),a.jsxs("div",{className:"hidden sm:flex items-center gap-6 ml-auto",children:[a.jsx(V,{icon:a.jsx(S,{className:"w-3.5 h-3.5 text-accent-secondary"}),label:"Sources",value:l.uniqueSources,color:"bg-accent-secondary/10"}),a.jsxs("div",{className:"flex flex-col items-end pr-1",children:[a.jsxs("span",{className:"text-sm font-mono text-text-secondary",children:[l.avgRssi," dBm"]}),a.jsx("span",{className:"text-[10px] text-text-muted",children:"Avg Signal"})]})]})]})})});function H(){const s=c(),t=d(),r=m(),i=u(),o=null==t?void 0:t.local_hash,n=null==t?void 0:t.neighbors,[g,f]=e.useState(!1),[N,k]=e.useState({limit:500,status:"all"}),[C,S]=e.useState(Date.now);e.useEffect(()=>{N.timeRange&&N.timeRange>0&&queueMicrotask(()=>S(Date.now()))},[N.timeRange,s]);const _=e.useMemo(()=>{const e=N.limit??500;return[...s.length<=e?s:s.slice(-e)].sort((e,a)=>(a.timestamp??0)-(e.timestamp??0))},[s,N.limit]),D=0===s.length,z=e.useMemo(()=>{let e=_;if(void 0!==N.type){const a=p[N.type];e=e.filter(e=>{const s=e.type??e.payload_type,l=e.payload_type_name;return s===N.type||l===a})}if(void 0!==N.route){const a=x[N.route];e=e.filter(e=>{const s=e.route??e.route_type,l=e.route_type_name;return s===N.route||l===a})}if(N.status&&"all"!==N.status&&(e=e.filter(e=>y(e)===N.status)),void 0!==N.signalMin&&(e=e.filter(e=>e.rssi>=N.signalMin)),N.timeRange&&N.timeRange>0){const a=C/1e3-3600*N.timeRange;e=e.filter(e=>e.timestamp>=a)}return e},[_,N.type,N.route,N.status,N.signalMin,N.timeRange,C]),V=(e,a)=>k(s=>({...s,[e]:a})),H=void 0!==N.type||void 0!==N.route||N.status&&"all"!==N.status||void 0!==N.signalMin||N.timeRange&&N.timeRange>0;return a.jsxs(P,{children:[a.jsx(L,{title:"Packet History",icon:a.jsx(j,{}),controls:a.jsxs(a.Fragment,{children:[r&&a.jsx(h,{showLabel:!0}),a.jsxs(b,{outline:!0,color:H?"primary":"muted",onClick:()=>f(!g),className:"sm:hidden",children:[a.jsx(R,{"data-slot":"icon"}),H&&a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-accent-primary"})]}),a.jsxs(b,{outline:!0,color:r?"success":"muted",onClick:()=>i(!r),children:[a.jsx(F,{"data-slot":"icon",className:l(r&&"animate-spin")}),a.jsx("span",{className:"hidden xs:inline",children:r?"Live":"Paused"})]})]})}),a.jsxs(M,{noPadding:!0,className:l("overflow-hidden transition-all duration-200",g?"max-h-96 opacity-100":"max-h-0 opacity-0 sm:max-h-96 sm:opacity-100"),children:[a.jsx(A,{listHeader:!0,icon:a.jsx(R,{className:"icon-sm"}),title:"Filters",actions:H?a.jsxs(b,{plain:!0,color:"muted",onClick:()=>k({limit:N.limit,status:"all"}),className:"!text-xs !py-0.5 !px-1.5",children:[a.jsx(v,{"data-slot":"icon",className:"!w-3 !h-3"}),"Clear"]}):void 0}),a.jsx("div",{className:"p-3 sm:p-4",children:a.jsxs("div",{className:"grid grid-cols-2 sm:flex sm:flex-wrap gap-3",children:[a.jsxs("div",{className:"flex-1 min-w-[140px]",children:[a.jsx("label",{className:"type-micro block mb-1",children:"Type"}),a.jsx(T,{value:N.type??"",onChange:e=>V("type",""===e?void 0:Number(e)),options:[{value:"",label:"All Types"},...Object.entries(p).map(([e,a])=>({value:Number(e),label:a}))],placeholder:"Search types...","aria-label":"Filter by packet type"})]}),a.jsxs("div",{className:"flex-1 min-w-[140px]",children:[a.jsx("label",{className:"type-micro block mb-1",children:"Route"}),a.jsx(T,{value:N.route??"",onChange:e=>V("route",""===e?void 0:Number(e)),options:[{value:"",label:"All Routes"},...Object.entries(x).map(([e,a])=>({value:Number(e),label:a}))],placeholder:"Search routes...","aria-label":"Filter by route type"})]}),a.jsxs("div",{className:"flex-1 min-w-[140px]",children:[a.jsx("label",{className:"type-micro block mb-1",children:"Status"}),a.jsx(T,{value:N.status??"all",onChange:e=>V("status",e),options:[{value:"all",label:"All Status"},{value:"rx",label:"Received"},{value:"forward",label:"Forwarded"},{value:"dropped",label:"Dropped"},{value:"duplicate",label:"Duplicate"}],placeholder:"Search status...","aria-label":"Filter by status"})]}),a.jsxs("div",{className:"flex-1 min-w-[120px]",children:[a.jsx("label",{className:"type-micro block mb-1",children:"Time"}),a.jsx(T,{value:N.timeRange??0,onChange:e=>V("timeRange",0===e?void 0:e),options:[{value:0,label:"All Time"},{value:1,label:"Last 1h"},{value:6,label:"Last 6h"},{value:24,label:"Last 24h"},{value:168,label:"Last 7d"}],placeholder:"Search time...","aria-label":"Filter by time range"})]}),a.jsxs("div",{className:"flex-1 min-w-[130px]",children:[a.jsx("label",{className:"type-micro block mb-1",children:"Signal"}),a.jsx(T,{value:N.signalMin??"",onChange:e=>V("signalMin",""===e?void 0:Number(e)),options:[{value:"",label:"Any Signal"},{value:-90,label:"Strong (≥-90)"},{value:-100,label:"Good (≥-100)"},{value:-110,label:"Fair (≥-110)"},{value:-120,label:"Weak (≥-120)"}],placeholder:"Search signal...","aria-label":"Filter by signal strength"})]}),a.jsxs("div",{className:"flex-1 min-w-[100px]",children:[a.jsx("label",{className:"type-micro block mb-1",children:"Limit"}),a.jsx(T,{value:N.limit??500,onChange:e=>V("limit",e),options:[{value:100,label:"100"},{value:200,label:"200"},{value:500,label:"500"},{value:1e3,label:"1000"},{value:2e3,label:"2000"}],placeholder:"Limit...","aria-label":"Packet limit"})]})]})})]}),a.jsx(B,{packets:z}),a.jsx(M,{noPadding:!0,className:"!overflow-visible",children:a.jsx(w,{packets:z,allPackets:s,localHash:o,neighbors:n,loading:D,showPagination:!0,perPage:50,emptyMessage:"No packets found"})})]})}export{H as default};
