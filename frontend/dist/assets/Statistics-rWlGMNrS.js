import{c as e,j as t,C as s,S as a,T as n,f as l,h as i,g as r,U as o,o as c,V as d,k as m,Y as x,R as h}from"./index-B-2Jxr7j.js";import{b as u,d as p,i as f,L as g,C as j,X as y,Y as b,T as v,e as N}from"./recharts-bmHCCfxU.js";import{T as M}from"./TimeRangeSelector-PdoOvEtJ.js";import{u as w}from"./usePolling-DMtQdE_y.js";import{b as k,u as C,c as S,d as $}from"./useThemeColors-zSiXVtFF.js";import{C as R,b as F,P as W,a as T}from"./PageLayout-CdW7LNwg.js";import{C as A,N as L}from"./CollisionExplorerModal-CR_bXIKw.js";import{I as P}from"./info-DsmVqi2a.js";import{T as z}from"./triangle-alert-DgnBDldk.js";import{R as H,C as E}from"./Grid-CWMN38GB.js";import{T as D}from"./trending-up-B8UTa5oU.js";import"./maplibre-gl-CFO9X1Ek.js";import"./leaflet-ClE6qLuu.js";import"./map-pin-DUDH5S76.js";const _=e("chart-pie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]),U=e("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),B=e("compass",[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),q=e("expand",[["path",{d:"m15 15 6 6",key:"1s409w"}],["path",{d:"m15 9 6-6",key:"ko1vev"}],["path",{d:"M21 16v5h-5",key:"1ck2sf"}],["path",{d:"M21 8V3h-5",key:"1qoq8a"}],["path",{d:"M3 16v5h5",key:"1t08am"}],["path",{d:"m3 21 6-6",key:"wwnumi"}],["path",{d:"M3 8V3h5",key:"1ln10m"}],["path",{d:"M9 9 3 3",key:"v551iv"}]]),X=e("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),I=e("shrink",[["path",{d:"m15 15 6 6m-6-6v4.8m0-4.8h4.8",key:"17vawe"}],["path",{d:"M9 19.8V15m0 0H4.2M9 15l-6 6",key:"chjx8e"}],["path",{d:"M15 4.2V9m0 0h4.8M15 9l6-6",key:"lav6yq"}],["path",{d:"M9 4.2V9m0 0H4.2M9 9 3 3",key:"1pxi2q"}]]);function O(e){const t=e.match(/\(([^)]+)\)\s*$/);return t?t[1]:e.length>10?e.slice(0,10):e}function Z({x:e,y:s,width:a,height:n,name:l,size:i,index:r,colors:o,depth:c,hoveredIndex:d,onHover:m,total:x}){if(1!==c)return null;const h=null!==d&&!(d===r),u=o[r%o.length],p=x>0?i/x*100:0,f=a>36&&n>20,g=a>36&&n>32,j=O(l);return t.jsxs("g",{onMouseEnter:e=>m(r,e),onMouseLeave:()=>m(null),style:{cursor:"default"},children:[t.jsx("rect",{x:e,y:s,width:a,height:n,fill:u,opacity:h?.4:1,stroke:"rgba(0,0,0,0.2)",strokeWidth:1,rx:3,style:{transition:"opacity 150ms ease"}}),f&&t.jsxs(t.Fragment,{children:[g&&t.jsxs("text",{x:e+4,y:s+n-4-11,textAnchor:"start",dominantBaseline:"auto",fill:"rgba(0,0,0,0.6)",fontSize:8,fontFamily:"'JetBrains Mono', monospace",fontWeight:500,style:{pointerEvents:"none"},children:[p.toFixed(1),"%"]}),t.jsx("text",{x:e+4,y:s+n-4,textAnchor:"start",dominantBaseline:"auto",fill:"rgba(0,0,0,0.85)",fontSize:9,fontFamily:"'JetBrains Mono', monospace",fontWeight:600,style:{pointerEvents:"none"},children:j})]})]})}function Y({data:e,total:s,color:a,position:n,containerWidth:l}){if(!e||!n)return null;const i=(e.value/s*100).toFixed(1),r=l-n.x<184?Math.max(8,n.x-160-8):n.x+16;return t.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:r,top:Math.max(8,n.y-60)},children:t.jsxs("div",{className:"bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 shadow-xl min-w-[140px]",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-sm flex-shrink-0",style:{backgroundColor:a}}),t.jsx("span",{className:"type-data-sm font-semibold text-text-primary",children:O(e.name)})]}),t.jsxs("div",{className:"space-y-0.5 type-data-xs text-text-muted",children:[t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("span",{children:"Count"}),t.jsx("span",{className:"text-text-primary tabular-nums font-medium",children:e.value.toLocaleString()})]}),t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("span",{children:"Share"}),t.jsxs("span",{className:"text-text-primary tabular-nums font-medium",children:[i,"%"]})]}),t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("span",{children:"Total"}),t.jsx("span",{className:"text-text-primary tabular-nums font-medium",children:s.toLocaleString()})]})]})]})})}const V=u.memo(function({data:e}){var s,a;const[n,l]=u.useState(null),[i,r]=u.useState(null),[o,c]=u.useState(0),d=u.useRef(null),m=k(),{treemapData:x,total:h}=u.useMemo(()=>{const t=e.reduce((e,t)=>e+t.value,0);return{treemapData:[...e].sort((e,t)=>t.value-e.value).filter(e=>t>0&&e.value/t*100>=.5).map((e,t)=>({name:e.name,size:e.value,index:t})),total:t}},[e]),g=u.useCallback((e,t)=>{if(l(e),t&&null!==e){const e=d.current;if(e){const s=e.getBoundingClientRect();c(s.width),r({x:t.clientX-s.left,y:t.clientY-s.top})}}else r(null)},[]),j=null!==n?{name:(null==(s=x[n])?void 0:s.name)??"",value:(null==(a=x[n])?void 0:a.size)??0}:null,y=null!==n?m[n%m.length]:"";return 0===e.length||0===h?t.jsx("div",{className:"h-56 flex items-center justify-center text-text-muted",children:"No packet type data available"}):t.jsxs("div",{className:"h-56 relative treemap-container",ref:d,children:[t.jsx(p,{width:"100%",height:"100%",minWidth:1,minHeight:1,children:t.jsx(f,{data:x,dataKey:"size",aspectRatio:4/3,stroke:"none",isAnimationActive:!1,content:t.jsx(Z,{x:0,y:0,width:0,height:0,name:"",value:0,size:0,index:0,colors:m,depth:0,hoveredIndex:n,onHover:g,total:h})})}),t.jsx(Y,{data:j,total:h,color:y,position:i,containerWidth:o})]})}),G="airtimeSpectrumBlur";function K({active:e,payload:s,label:a}){if(!e||!s||0===s.length)return null;const n=s.filter(e=>null!==e.value&&void 0!==e.value);if(0===n.length)return null;const l=a?new Date(1e3*a).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}):"";return t.jsxs("div",{className:"bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 text-sm shadow-xl",children:[t.jsx("div",{className:"font-medium text-text-primary mb-1 font-mono",children:l}),n.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-0.5",style:{backgroundColor:e.color}}),t.jsxs("span",{className:"text-text-muted",children:[e.name,":"]}),t.jsxs("span",{className:"text-text-primary tabular-nums font-mono",children:[Number(e.value).toFixed(2),"%"]})]},s))]})}function Q({payload:e,showDensityScale:s=!1}){return e?t.jsxs("div",{className:"flex items-center gap-4 justify-start text-xs font-mono pl-11",children:[e.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"w-4 h-0.5",style:{backgroundColor:e.color}}),t.jsx("span",{className:"text-text-muted",children:e.value})]},s)),s&&t.jsxs("div",{className:"flex items-center gap-1.5 ml-2",children:[t.jsx("div",{className:"w-16 h-2 rounded-sm",style:{background:"linear-gradient(to right, \n                rgb(1,26,51), \n                rgb(53,82,85), \n                rgb(85,121,74), \n                rgb(150,149,53), \n                rgb(228,168,98), \n                rgb(250,195,165)\n              )"}}),t.jsx("span",{className:"text-text-muted",children:"Density"})]})]}):null}const J=[[1,26,51],[20,43,67],[38,62,79],[53,82,85],[67,102,83],[85,121,74],[112,137,62],[150,149,53],[192,156,58],[228,168,98],[250,195,165]];function ee(e){const t=Math.max(0,Math.min(1,e))*(J.length-1),s=Math.floor(t),a=Math.min(s+1,J.length-1),n=t-s;return`rgb(${Math.round(J[s][0]+n*(J[a][0]-J[s][0]))},${Math.round(J[s][1]+n*(J[a][1]-J[s][1]))},${Math.round(J[s][2]+n*(J[a][2]-J[s][2]))})`}const te=u.memo(function({samples:e,startTs:a,endTs:n,yMax:l}){const i=C(),r=S(),o=u.useMemo(()=>void 0!==l?l:function(e){if(0===e.length)return 10;let t=0;for(const n of e){const e=n.rxRolling??n.rxUtilW,s=n.txRolling??n.txUtilW;e>t&&(t=e),s>t&&(t=s)}const s=1.05*t,a=5*Math.ceil(s/5);return Math.max(10,a)}(e),[l,e]),c=r.poor,d=i.neutral,{cells:m,cellWidth:x,cellHeight:h}=u.useMemo(()=>function(e,t,s,a,n=120,l=30){const i=100/n+.5+"%",r=100/l+.5+"%";if(0===e.length||s<=t)return{cells:[],cellWidth:i,cellHeight:r};const o=s-t,c=l*n,d=new Float32Array(c),m=new Float32Array(c),x=(e,t)=>e*n+t;for(let b=0;b<e.length;b++){const i=e[b];if(i.timestamp<t||i.timestamp>s)continue;const r=Math.floor((i.timestamp-t)/o*(n-1)),c=Math.max(0,Math.min(n-1,r));if(i.rxUtilW>0){const e=Math.min(i.rxUtilW/a,1),t=Math.floor((1-e)*(l-1));for(let s=t;s<l;s++){const e=l-1-t,a=e>0?1-(s-t)/e*.7:1;d[x(s,c)]+=a}}if(i.txUtilW>0){const e=Math.min(i.txUtilW/a,1),t=Math.floor((1-e)*(l-1));for(let s=t;s<l;s++){const e=l-1-t,a=e>0?1-(s-t)/e*.7:1;m[x(s,c)]+=a}}}const h=[];for(let b=0;b<c;b++)d[b]>0&&h.push(d[b]),m[b]>0&&h.push(m[b]);h.sort((e,t)=>e-t);const u=h.length>0?h[Math.floor(.95*h.length)]:1,p=new Array(n),f=new Array(l),g=100/n,j=100/l;for(let b=0;b<n;b++)p[b]=b*g+"%";for(let b=0;b<l;b++)f[b]=b*j+"%";const y=[];for(let b=0;b<l;b++)for(let e=0;e<n;e++){const t=x(b,e),s=d[t]+.3*m[t];if(s>0&&u>0){const t=Math.min(s/u,1.5),a=Math.sqrt(t/1.5);y.push({xPct:p[e],yPct:f[b],intensity:a})}}return{cells:y,cellWidth:i,cellHeight:r}}(e,a,n,100,200,20),[e,a,n]),f=u.useMemo(()=>{if(0===e.length)return[];const t=Math.max(1,Math.floor(e.length/400)),s=[];for(let a=0;a<e.length;a+=t){const t=e[a];if(t&&"number"==typeof t.timestamp&&!isNaN(t.timestamp)){const e=t.rxRolling??t.rxUtilW,a=t.txRolling??t.txUtilW;s.push({timestamp:t.timestamp,rx:"number"!=typeof e||isNaN(e)?0:e,tx:"number"!=typeof a||isNaN(a)?0:a})}}return s},[e]),M=u.useMemo(()=>{const e=n-a,t=e/3600;return[0,.25,.5,.75,1].map(s=>{const n=new Date(1e3*(a+e*s)),l=n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),i=n.toLocaleDateString([],{weekday:"short"});return{pct:s,label:t>24?`${i} ${l}`:l}})},[a,n]);return 0===e.length?t.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No traffic data available"}):t.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[t.jsx("div",{className:"flex items-center flex-shrink-0 text-text-muted",style:{height:20,paddingLeft:44,paddingRight:8},children:t.jsx("div",{className:"relative w-full h-full flex items-center",children:M.map((e,a)=>t.jsxs("div",{className:"absolute flex items-center gap-1 type-data-xs",style:{left:100*e.pct+"%",transform:0===e.pct?"translateX(0)":1===e.pct?"translateX(-100%)":"translateX(-50%)"},children:[t.jsx(s,{className:"w-2.5 h-2.5 opacity-60"}),t.jsx("span",{className:"tabular-nums",children:e.label})]},a))})}),t.jsx("div",{className:"relative flex-1 min-h-0",children:t.jsx(p,{width:"100%",height:"100%",minWidth:1,minHeight:1,children:t.jsxs(g,{data:f,margin:{top:4,right:8,bottom:0,left:0},children:[t.jsx(j,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.04)",vertical:!1}),t.jsx(y,{dataKey:"timestamp",type:"number",domain:[a,n],axisLine:!1,tickLine:!1,tick:!1,height:0}),t.jsx(b,{axisLine:!1,tickLine:!1,tick:{fill:"rgba(255,255,255,0.4)",fontSize:10,fontFamily:"'JetBrains Mono', monospace"},dx:-8,width:44,tickFormatter:e=>`${e.toFixed(0)}%`,domain:[0,o]}),t.jsx(v,{content:t.jsx(K,{})}),t.jsx(N,{type:"linear",dataKey:"rx",name:"RX Avg",stroke:c,strokeWidth:2.5,strokeOpacity:.9,dot:!1,connectNulls:!1,isAnimationActive:!1}),t.jsx(N,{type:"linear",dataKey:"tx",name:"TX Avg",stroke:d,strokeWidth:2.5,strokeOpacity:.9,dot:!1,connectNulls:!1,isAnimationActive:!1})]})})}),t.jsx("div",{className:"relative overflow-hidden",style:{height:32,marginLeft:44,marginRight:8},children:t.jsxs("svg",{className:"absolute inset-0 w-full h-full",preserveAspectRatio:"none","aria-hidden":"true",children:[t.jsx("defs",{children:t.jsx("filter",{id:G,x:"-100%",y:"-100%",width:"300%",height:"300%",children:t.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"1 3"})})}),t.jsx("g",{filter:`url(#${G})`,children:m.map((e,s)=>t.jsx("rect",{x:e.xPct,y:e.yPct,width:x,height:h,fill:ee(e.intensity),opacity:.9},`cell-${s}`))})]})}),t.jsx("div",{className:"flex-shrink-0",style:{height:24,marginTop:8},children:t.jsx(Q,{payload:[{value:"RX Avg",color:c},{value:"TX Avg",color:d}],showDensityScale:!0})})]})}),se={"1x":1,"2x":.5,"3x":.25},ae=new Set([30,45,60,120,135,150,210,225,240,300,315,330]);function ne(e,t,s,a){const n=Math.PI/180,l=(a-t)*n,i=e*n,r=s*n,o=Math.sin(l)*Math.cos(r),c=Math.cos(i)*Math.sin(r)-Math.sin(i)*Math.cos(r)*Math.cos(l);return(180*Math.atan2(o,c)/Math.PI+360)%360}function le(e,t,s,a){const n=Math.PI/180,l=(s-e)*n,i=(a-t)*n,r=Math.sin(l/2)**2+Math.cos(e*n)*Math.cos(s*n)*Math.sin(i/2)**2;return 12742*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))}const ie=[{min:10,color:"excellent"},{min:4,color:"good"},{min:-5,color:"fair"},{min:-8,color:"poor"},{min:-1/0,color:"critical"}];function re(e,t){return t[ie.find(t=>e>=t.min).color]}const oe=[{min:10,label:"Excellent"},{min:7,label:"Very Good"},{min:4,label:"Good"},{min:1,label:"Fair+"},{min:-2,label:"Fair"},{min:-5,label:"Fair-"},{min:-8,label:"Poor"},{min:-11,label:"Bad"},{min:-1/0,label:"Critical"}],ce=u.memo(function({neighbors:e,quickNeighbors:s,localLat:a,localLon:n,onStatsChange:l}){const[i,r]=u.useState(null),[o,c]=u.useState(new Set),[d,m]=u.useState(0),[x,h]=u.useState({width:320,height:180}),[p,f]=u.useState("1x"),[g,j]=u.useState(new Map),y=u.useRef(null),b=u.useRef({}),v=u.useRef(null),N=u.useRef(g);N.current=g;const M=S(),w=$();u.useEffect(()=>{const e=v.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e){const{width:e,height:s}=t.contentRect;e>0&&s>0&&h({width:e,height:s})}});t.observe(e);const s=e.getBoundingClientRect();return s.width>0&&s.height>0&&h({width:s.width,height:s.height}),()=>t.disconnect()},[]),u.useEffect(()=>{const e=setTimeout(()=>{m(1)},100),t=setInterval(()=>{m(e=>e+1)},9500);return()=>{clearTimeout(e),clearInterval(t)}},[]);const k=u.useMemo(()=>{const e=new Set;if(s)for(const t of s)e.add(t.hash);return e},[s]),C=u.useMemo(()=>{const e=new Map;if(s)for(const t of s)e.set(t.hash,{snr:t.avgSnr,rssi:t.avgRssi});return e},[s]),{processedNeighbors:R,maxDistance:F,totalNeighbors:W,zeroHopCount:T}=u.useMemo(()=>{const t=[];let s=0;const l=[];for(const[c,d]of Object.entries(e)){if(!d.latitude||!d.longitude||0===d.latitude||0===d.longitude)continue;const e=ne(a,n,d.latitude,d.longitude),i=le(a,n,d.latitude,d.longitude);l.push(i);const r=k.has(c);r&&s++;const o=C.get(c);t.push({hash:c.slice(0,8),name:d.node_name||d.name||"Unknown",snr:r?(null==o?void 0:o.snr)??d.snr??null:null,rssi:r?(null==o?void 0:o.rssi)??d.rssi??null:null,bearing:e,distance:i,normalizedDistance:0,lastSeen:d.last_seen,isZeroHop:r})}l.sort((e,t)=>e-t);const i=l.length>0?l[l.length-1]:0,r=se[p];let o=1===r?i:function(e,t){if(0===e.length)return 0;const s=Math.ceil(e.length*t)-1;return e[Math.max(0,Math.min(s,e.length-1))]}(l,r);o<=0&&(o=i||1);for(const e of t){const t=Math.min(e.distance/o,1);e.normalizedDistance=.08+.89*t}return t.sort((e,t)=>!e.isZeroHop&&t.isZeroHop?-1:e.isZeroHop&&!t.isZeroHop?1:e.isZeroHop||t.isZeroHop?(e.snr??-1/0)-(t.snr??-1/0):t.distance-e.distance),{processedNeighbors:t,maxDistance:i,totalNeighbors:t.length,zeroHopCount:s}},[e,a,n,k,C,p]);u.useEffect(()=>{l&&l({zeroHopCount:T,totalCount:W,maxDistanceKm:F})},[T,W,F,l]),u.useEffect(()=>{const e=new Map,t=new Map;for(const n of R){const s=N.current.get(n.hash)??n.normalizedDistance;e.set(n.hash,s),t.set(n.hash,n.normalizedDistance)}y.current&&cancelAnimationFrame(y.current);const s=performance.now(),a=n=>{const l=n-s,i=Math.min(l/400,1),r=(o=i)<.5?8*o*o*o*o:1-Math.pow(-2*o+2,4)/2;var o;const c=new Map;for(const s of R){const a=e.get(s.hash)??s.normalizedDistance,n=t.get(s.hash)??s.normalizedDistance;c.set(s.hash,a+(n-a)*r)}j(c),y.current=i<1?requestAnimationFrame(a):null};return y.current=requestAnimationFrame(a),()=>{y.current&&cancelAnimationFrame(y.current)}},[p,R]),u.useEffect(()=>{const e=[];for(const s of R){const t=b.current[s.hash];void 0!==t&&t!==s.lastSeen&&e.push(s.hash),b.current[s.hash]=s.lastSeen}if(0===e.length)return;queueMicrotask(()=>{c(t=>new Set([...t,...e]))});const t=setTimeout(()=>{c(t=>{const s=new Set(t);return e.forEach(e=>s.delete(e)),s})},600);return()=>clearTimeout(t)},[R]);const A=0!==a&&0!==n,L=u.useMemo(()=>{const{width:e,height:t}=x,s=e/2,a=t/2,n=Math.max(10,e/2-12),l=Math.max(10,t/2-12);return{width:e,height:t,centerX:s,centerY:a,maxRadiusX:n,maxRadiusY:l,cornerRadius:.2*Math.min(n,l)}},[x]),{width:P,height:z,centerX:H,centerY:E,maxRadiusX:D,maxRadiusY:_,cornerRadius:U}=L,q=u.useCallback((e,t=1)=>{const s=D*t,a=_*t,n=Math.min(U*t,s,a),l=(e%360+360)%360,i=l*Math.PI/180,r=180*Math.atan2(a-n,s-n)/Math.PI;let o,c;if(l<=45-r||l>315+r){const e=Math.tan(i);o=Math.max(H-s+n,Math.min(H+s-n,H+a*e*(s/a))),c=E-a}else if(l>45-r&&l<=45+r)o=H+s-n+n*Math.sin(i),c=E-a+n-n*Math.cos(i);else if(l>45+r&&l<=135-r){const e=1/Math.tan(i);c=Math.max(E-a+n,Math.min(E+a-n,E+s*e*(a/s))),o=H+s}else if(l>135-r&&l<=135+r)o=H+s-n+n*Math.sin(i),c=E+a-n-n*Math.cos(i);else if(l>135+r&&l<=225-r){const e=Math.tan(i);o=Math.max(H-s+n,Math.min(H+s-n,H+a*e*(s/a))),c=E+a}else if(l>225-r&&l<=225+r)o=H-s+n+n*Math.sin(i),c=E+a-n-n*Math.cos(i);else if(l>225+r&&l<=315-r){const e=1/Math.tan(i);c=Math.max(E-a+n,Math.min(E+a-n,E+s*e*(a/s))),o=H-s}else o=H-s+n+n*Math.sin(i),c=E-a+n-n*Math.cos(i);return{x:o,y:c}},[H,E,D,_,U]),X=u.useCallback((e,t)=>{const s=q(e,1);return{x:H+(s.x-H)*t,y:E+(s.y-E)*t}},[q,H,E]),I=u.useCallback(e=>({N:{x:H,y:E-_},S:{x:H,y:E+_},E:{x:H+D,y:E},W:{x:H-D,y:E}}[e]),[H,E,D,_]),O=u.useCallback(e=>{const t=D*e,s=_*e,a=Math.min(U*e,t,s),n=H-t,l=H+t,i=E-s,r=E+s;return[`M ${n+a} ${i}`,`L ${l-a} ${i}`,`Q ${l} ${i} ${l} ${i+a}`,`L ${l} ${r-a}`,`Q ${l} ${r} ${l-a} ${r}`,`L ${n+a} ${r}`,`Q ${n} ${r} ${n} ${r-a}`,`L ${n} ${i+a}`,`Q ${n} ${i} ${n+a} ${i}`,"Z"].join(" ")},[H,E,D,_,U]),Z=u.useCallback(e=>{r(e)},[]),Y=u.useCallback(e=>{f(e)},[]),V=u.useMemo(()=>[.25,.5,.75,1],[]);return A?0===W?t.jsxs("div",{ref:v,className:"flex flex-col items-center justify-center h-full text-text-muted",children:[t.jsx(B,{className:"w-8 h-8 mb-2 opacity-50"}),t.jsx("p",{children:"No nodes with location data"})]}):t.jsxs("div",{ref:v,className:"relative h-full w-full overflow-hidden",children:[t.jsxs("svg",{width:P,height:z,className:"absolute inset-0 z-0",children:[t.jsx("defs",{children:t.jsx("style",{children:`\n                @keyframes radar-ring-pop {\n                  0% {\n                    opacity: 0;\n                    stroke-width: 1;\n                  }\n                  10% {\n                    opacity: 0.33;\n                    stroke-width: 2.5;\n                  }\n                  25% {\n                    opacity: 0.25;\n                    stroke-width: 2;\n                  }\n                  50% {\n                    opacity: 0.15;\n                    stroke-width: 1.5;\n                  }\n                  75% {\n                    opacity: 0.05;\n                  }\n                  100% {\n                    opacity: 0;\n                    stroke-width: 1;\n                  }\n                }\n                @keyframes local-node-ping {\n                  0% {\n                    fill: ${M.excellent};\n                  }\n                  100% {\n                    fill: ${w.chart6};\n                  }\n                }\n                @keyframes neighbor-blink-scale {\n                  0%, 100% {\n                    transform: scale(1);\n                    opacity: 0;\n                  }\n                  50% {\n                    transform: scale(1.3);\n                    opacity: 0.8;\n                  }\n                }\n                .radar-ring-0 {\n                  opacity: 0;\n                  animation: radar-ring-pop 875ms cubic-bezier(0.1, 0, 0.3, 1) both;\n                  animation-delay: 0ms;\n                }\n                .radar-ring-1 {\n                  opacity: 0;\n                  animation: radar-ring-pop 875ms cubic-bezier(0.1, 0, 0.3, 1) both;\n                  animation-delay: 450ms;\n                }\n                .radar-ring-2 {\n                  opacity: 0;\n                  animation: radar-ring-pop 875ms cubic-bezier(0.1, 0, 0.3, 1) both;\n                  animation-delay: 900ms;\n                }\n                .radar-ring-3 {\n                  opacity: 0;\n                  animation: radar-ring-pop 875ms cubic-bezier(0.1, 0, 0.3, 1) both;\n                  animation-delay: 1350ms;\n                }\n                .local-node-ping {\n                  animation: local-node-ping 1250ms ease-out forwards;\n                }\n                .neighbor-blink-ring {\n                  transform-origin: center;\n                  animation: neighbor-blink-scale 600ms ease-out forwards;\n                }\n              `})}),d>0&&V.map((e,s)=>t.jsx("path",{d:O(e),fill:"none",stroke:M.critical,strokeWidth:1,className:`radar-ring-${s}`},`${e}-${d}`)),["N","E","S","W"].map(e=>{const s="N"===e||"S"===e,a=s?H:"E"===e?H+D:H-D,n=s?"N"===e?E-_:E+_:E;return t.jsx("line",{x1:H,y1:E,x2:a,y2:n,stroke:"rgba(255,255,255,0.08)",strokeWidth:1},e)}),Array.from({length:24},(e,s)=>{const a=15*s;if(a%90==0||ae.has(a))return null;const n=q(a,1),l=q(a,.96);return t.jsx("line",{x1:l.x,y1:l.y,x2:n.x,y2:n.y,stroke:M.critical,strokeWidth:1.5},a)}),["N","E","S","W"].map(e=>{const s=I(e),a="E"===e?"end":"W"===e?"start":"middle",n="N"===e?"hanging":"S"===e?"auto":"middle";return t.jsx("text",{x:s.x,y:s.y,textAnchor:a,dominantBaseline:n,fill:M.critical,fillOpacity:.9,fontSize:16,fontWeight:600,fontFamily:"'JetBrains Mono', monospace","aria-hidden":"true",children:e},e)}),t.jsx("circle",{cx:H,cy:E,r:5,fill:w.chart6,stroke:"rgba(255,255,255,0.3)",strokeWidth:1,className:d>0?"local-node-ping":"",role:"img","aria-label":"Local node"},`local-${d}`),R.map(e=>{const s=g.get(e.hash)??e.normalizedDistance,{x:a,y:n}=X(e.bearing,s),l=e.isZeroHop&&null!==e.snr?re(e.snr,M):"rgba(107, 114, 128, 0.66)",r=e.isZeroHop?1:.33,c=(null==i?void 0:i.hash)===e.hash,d=o.has(e.hash);return t.jsxs("g",{role:"img","aria-label":`${e.name}: ${e.distance.toFixed(1)}km ${e.bearing.toFixed(0)}°`,children:[d&&t.jsx("circle",{cx:a,cy:n,r:10.5,fill:"none",stroke:"rgba(255,255,255,0.9)",strokeWidth:2,className:"neighbor-blink-ring"}),c&&t.jsx("circle",{cx:a,cy:n,r:10.5,fill:l,opacity:.3}),t.jsx("circle",{cx:a,cy:n,r:c?7:5,fill:l,fillOpacity:c?1:r,stroke:"rgba(0,0,0,0.5)",strokeWidth:1,style:{cursor:"pointer",transition:"r 0.15s, fill-opacity 0.15s"},onMouseEnter:()=>Z(e),onMouseLeave:()=>Z(null)})]},e.hash)})]}),t.jsx("div",{className:"absolute bottom-2 left-2 flex gap-1 z-10",role:"group","aria-label":"Zoom level",children:["1x","2x","3x"].map(e=>t.jsx("button",{onClick:()=>Y(e),"aria-pressed":p===e,className:"px-2 py-0.5 text-xs font-medium rounded-full transition-colors "+(p===e?"bg-accent-primary/20 text-accent-primary":"bg-white/5 text-signal-critical hover:bg-white/10 hover:text-signal-critical/80"),children:e},e))}),i&&t.jsxs("div",{className:"absolute bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 text-sm pointer-events-none z-10 shadow-xl",style:{left:"50%",bottom:8,transform:"translateX(-50%)"},children:[t.jsx("div",{className:"font-medium text-text-primary",children:i.name}),t.jsxs("div",{className:"text-text-muted text-xs font-mono",children:[i.hash,!i.isZeroHop&&t.jsx("span",{className:"ml-2 text-text-muted",children:"(not direct)"})]}),i.isZeroHop&&null!==i.snr?t.jsx("div",{className:"flex gap-3 mt-1 text-xs",children:t.jsxs("span",{children:[t.jsx("span",{className:"text-text-muted",children:"SNR:"})," ",t.jsxs("span",{className:"tabular-nums",style:{color:re(i.snr,M)},children:[i.snr.toFixed(1)," dB"]}),t.jsxs("span",{className:"text-text-muted ml-1",children:["(",(G=i.snr,(null==(K=oe.find(e=>G>=e.min))?void 0:K.label)??"Critical"),")"]})]})}):t.jsx("div",{className:"text-xs text-text-muted mt-1",children:"No direct RF data"}),t.jsxs("div",{className:"flex gap-3 text-xs",children:[t.jsxs("span",{children:[t.jsx("span",{className:"text-text-muted",children:"Distance:"})," ",t.jsxs("span",{className:"tabular-nums text-text-secondary",children:[i.distance.toFixed(2)," km"]})]}),t.jsxs("span",{children:[t.jsx("span",{className:"text-text-muted",children:"Bearing:"})," ",t.jsxs("span",{className:"tabular-nums text-text-secondary",children:[i.bearing.toFixed(0),"°"]})]})]})]})]}):t.jsxs("div",{ref:v,className:"flex flex-col items-center justify-center h-full text-text-muted",children:[t.jsx(B,{className:"w-8 h-8 mb-2 opacity-50"}),t.jsx("p",{children:"Local node coordinates not configured"}),t.jsx("p",{className:"text-xs mt-1",children:"Set latitude/longitude in config to enable"})]});var G,K});function de(e,t){if(0===e.length)return 0;const s=t/100*(e.length-1),a=Math.floor(s),n=Math.ceil(s);return a===n?e[a]:e[a]+(e[n]-e[a])*(s-a)}const me=u.memo(function({timestamps:e,values:s,onStatsChange:a}){var n,l;const i=S(),[r,o]=u.useState(!0),c=u.useMemo(()=>{if(0===s.length)return null;const e=Math.min(...s),t=Math.max(...s),a=s.reduce((e,t)=>e+t,0)/s.length,n=[...s].sort((e,t)=>e-t);return{min:e,max:t,avg:a,p5:de(n,5),p95:de(n,95)}},[s]);u.useEffect(()=>{null==a||a(c)},[c,a]);const d=u.useCallback(()=>{o(e=>!e)},[]),{cells:m,gridInfo:x,xLabels:h,yLabels:p}=u.useMemo(()=>{if(0===e.length||0===s.length||!c)return{cells:[],gridInfo:null,xLabels:[],yLabels:[]};const t=Math.max(100,e.length),a=200;let n,l;if(r){const e=.1*(c.p95-c.p5||1);n=c.p5-e,l=c.p95+e}else{const e=.1*(c.max-c.min||1);n=c.min-e,l=c.max+e}const i=l-n,o=Math.min(...e),d=Math.max(...e)-o||1,m=Array(a).fill(null).map(()=>Array(t).fill(0));for(let r=0;r<e.length;r++){const a=Math.floor((e[r]-o)/d*(t-1)),c=Math.max(n,Math.min(l,s[r])),x=Math.floor((c-n)/i*199),h=Math.max(0,Math.min(t-1,a)),u=Math.max(0,Math.min(199,199-x));m[u][h]++,u>0&&(m[u-1][h]+=.4),u<199&&(m[u+1][h]+=.4),h>0&&(m[u][h-1]+=.3),h<t-1&&(m[u][h+1]+=.3),u>0&&h>0&&(m[u-1][h-1]+=.2),u>0&&h<t-1&&(m[u-1][h+1]+=.2),u<199&&h>0&&(m[u+1][h-1]+=.2),u<199&&h<t-1&&(m[u+1][h+1]+=.2),u>1&&(m[u-2][h]+=.15),u<198&&(m[u+2][h]+=.15),h>1&&(m[u][h-2]+=.1),h<t-2&&(m[u][h+2]+=.1)}let x=0;for(let e=0;e<a;e++)for(let s=0;s<t;s++)m[e][s]>x&&(x=m[e][s]);const h=[];for(let e=0;e<a;e++)for(let s=0;s<t;s++)m[e][s]>0&&h.push({x:s,y:e,intensity:m[e][s]/x});const u=[];for(let e=0;e<=5;e++){const t=o+d*e/5;u.push({pos:e/5*100,label:new Date(1e3*t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})}const p=[];for(let e=0;e<=4;e++){const t=n+i*e/4;p.push({pos:100*(1-e/4),label:`${Math.round(t)}`})}return{cells:h,gridInfo:{cols:t,rows:a},xLabels:u,yLabels:p}},[e,s,c,r]);if(!x||0===m.length)return t.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No noise floor data available"});const f=100/x.cols,g=100/x.rows,j=i.poor;return t.jsxs("div",{className:"relative w-full h-full",role:"img","aria-label":`RF noise floor heatmap showing values from ${(null==(n=null==c?void 0:c.min)?void 0:n.toFixed(0))??"N/A"} to ${(null==(l=null==c?void 0:c.max)?void 0:l.toFixed(0))??"N/A"} dBm`,children:[t.jsx("div",{className:"absolute top-0 left-0 flex flex-col justify-between",style:{width:32,bottom:20},"aria-hidden":"true",children:p.map((e,s)=>t.jsx("span",{className:"type-data-xs text-text-muted tabular-nums text-right pr-1.5",style:{position:"absolute",top:`${e.pos}%`,transform:"translateY(-50%)",right:0},children:e.label},s))}),t.jsxs("div",{className:"absolute overflow-hidden",style:{left:32,right:0,top:0,bottom:20},children:[t.jsx("svg",{className:"absolute inset-0 w-full h-full",preserveAspectRatio:"none","aria-hidden":"true",children:[0,25,50,75,100].map(e=>t.jsx("line",{x1:"0",y1:`${e}%`,x2:"100%",y2:`${e}%`,stroke:"rgba(255,255,255,0.06)",strokeDasharray:"3 3"},e))}),t.jsx("svg",{className:"absolute inset-0 w-full h-full",preserveAspectRatio:"none","aria-hidden":"true",children:m.map((e,s)=>{const a=.2+.8*e.intensity;return t.jsx("rect",{x:e.x*f+"%",y:e.y*g+"%",width:`${f+.1}%`,height:`${g+.1}%`,fill:j,opacity:a},s)})}),t.jsx("button",{type:"button",onClick:d,className:"absolute bottom-1 right-1 p-1.5 rounded bg-tooltip-bg/80 hover:bg-tooltip-bg active:bg-tooltip-bg transition-colors touch-manipulation",title:r?"Show full range (min/max)":"Show trimmed range (P5-P95)","aria-label":r?"Expand to show full data range":"Shrink to show trimmed percentile range","aria-pressed":!r,children:r?t.jsx(q,{className:"w-3.5 h-3.5 text-text-muted","aria-hidden":"true"}):t.jsx(I,{className:"w-3.5 h-3.5 text-text-muted","aria-hidden":"true"})})]}),t.jsx("div",{className:"absolute left-0 right-0 bottom-0",style:{left:32,height:20},"aria-hidden":"true",children:h.map((e,s)=>t.jsx("span",{className:"type-data-xs text-text-muted tabular-nums absolute top-1",style:{left:`${e.pos}%`,transform:"translateX(-50%)"},children:e.label},s))})]})}),xe={repeater:"var(--signal-poor)",companion:"var(--accent-tertiary)",room_server:"var(--accent-secondary)"};function he(e){if(e.contact_type){const t=e.contact_type.toLowerCase();if("repeater"===t||"rep"===t)return"repeater";if("room server"===t||"room_server"===t||"room"===t||"server"===t)return"room_server";if("companion"===t||"client"===t||"cli"===t)return"companion"}return e.is_repeater?"repeater":"companion"}const ue=u.memo(function({neighbors:e}){const s=u.useMemo(()=>{const t={repeater:0,companion:0,room_server:0};for(const a of Object.values(e)){const e=he(a);t[e]=(t[e]||0)+1}const s=Object.values(t).reduce((e,t)=>e+t,0);return{items:[{label:"Repeaters",count:t.repeater,percent:0,color:xe.repeater},{label:"Companions",count:t.companion,percent:0,color:xe.companion},{label:"Room Servers",count:t.room_server,percent:0,color:xe.room_server}].map(e=>({...e,percent:s>0?e.count/s*100:0})).filter(e=>e.count>0).sort((e,t)=>t.count-e.count),total:s}},[e]);return 0===s.total?t.jsx("div",{className:"h-full flex items-center justify-center text-text-muted type-body-sm",children:"No neighbors discovered yet"}):t.jsxs("div",{className:"h-full flex flex-col",children:[t.jsx("div",{className:"flex-1 flex flex-col justify-evenly",children:s.items.map(e=>t.jsxs("div",{className:"flex flex-col gap-1.5",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"type-data-sm text-text-secondary",children:e.label}),t.jsxs("span",{className:"type-data-sm text-text-muted tabular-nums",children:[e.count," ",t.jsxs("span",{className:"text-text-muted/60",children:["(",e.percent.toFixed(0),"%)"]})]})]}),t.jsx("div",{className:"h-2.5 bg-bg-elevated rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full rounded-full transition-all duration-500 ease-out",style:{width:`${e.percent}%`,backgroundColor:e.color,minWidth:e.count>0?"4px":"0"}})})]},e.label))}),t.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border-subtle",children:[t.jsx("span",{className:"type-data-xs text-text-muted",children:"Total Nodes"}),t.jsx("span",{className:"type-data-sm text-text-primary font-medium tabular-nums",children:s.total})]})]})});function pe(e,t,s,a=!0,n=60){const l=new Map(e.map(e=>[e.start,e])),i=new Map(t.map(e=>[e.start,e])),r=Array.from(new Set([...l.keys(),...i.keys()])).sort((e,t)=>e-t).map(e=>{const t=l.get(e),a=i.get(e);return{timestamp:e,rxUtilW:((null==t?void 0:t.airtime_ms)??0)/s*100,txUtilW:((null==a?void 0:a.airtime_ms)??0)/s*100}});return a&&r.length>1?function(e,t=60){if(0===e.length)return[];const s=1-Math.pow(.5,1/t),a=Math.min(e.length,Math.max(10,Math.floor(t/3)));let n=0,l=0;for(let i=0;i<a;i++)n+=e[i].rxUtilW,l+=e[i].txUtilW;return n/=a,l/=a,e.map(e=>(n=s*e.rxUtilW+(1-s)*n,l=s*e.txUtilW+(1-s)*l,{...e,rxRolling:n,txRolling:l}))}(r,n):r}const fe={excellent:"text-signal-excellent",good:"text-signal-good",fair:"text-signal-fair",poor:"text-signal-poor"},ge={excellent:"bg-signal-excellent/10",good:"bg-signal-good/10",fair:"bg-signal-fair/10",poor:"bg-signal-poor/10"};function je({value:e,status:s}){const a={excellent:"bg-signal-excellent",good:"bg-signal-good",fair:"bg-signal-fair",poor:"bg-signal-poor"}[s];return t.jsx("div",{className:"w-full h-2 bg-surface-elevated rounded-full overflow-hidden",children:t.jsx("div",{className:`h-full ${a} transition-all duration-300`,style:{width:`${Math.min(100,Math.max(0,e))}%`}})})}function ye(){const e=a(),s=n(),[l,i]=u.useState(null),r=u.useCallback((e,t)=>{i({prefix:e,candidateHashes:t})},[]),o=u.useCallback(()=>{i(null)},[]);if(!s)return t.jsxs(R,{children:[t.jsx(F,{icon:t.jsx(X,{}),title:"Prefix Conflicts",largeTitle:!0}),t.jsx("div",{className:"flex-1 flex items-center justify-center",children:t.jsxs("div",{className:"text-center text-text-muted",children:[t.jsx(P,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"type-data-xs",children:"No topology data available"}),t.jsx("p",{className:"type-data-xs opacity-70",children:"Run deep analysis to see stats"})]})})]});const c=(d=e.avgConfidence)>=.9?"excellent":d>=.7?"good":d>=.5?"fair":"poor";var d;const m=(x=e.collisionRate)<=10?"excellent":x<=25?"good":"poor";var x;const h="poor"===c||"poor"===m?"poor":"fair"===c||"fair"===m?"fair":"good"===c||"good"===m?"good":"excellent",p="excellent"===h||"good"===h?U:z;return t.jsxs(R,{children:[t.jsx(F,{icon:t.jsx(X,{}),title:"Prefix Conflicts",largeTitle:!0,actions:t.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1 rounded-full ${ge[h]}`,children:[t.jsx(p,{className:`w-3.5 h-3.5 ${fe[h]}`}),t.jsx("span",{className:`type-data-xs font-medium ${fe[h]}`,children:"excellent"===h?"Excellent":"good"===h?"Good":"fair"===h?"Fair":"Needs Attention"})]})}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-baseline justify-between mb-1",children:[t.jsx("span",{className:"type-data-xs text-text-muted",children:"Avg Confidence"}),t.jsxs("span",{className:`type-data-lg font-semibold ${fe[c]}`,children:[(100*e.avgConfidence).toFixed(1),"%"]})]}),t.jsx(je,{value:100*e.avgConfidence,status:c})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-baseline justify-between mb-1",children:[t.jsx("span",{className:"type-data-xs text-text-muted",children:"Collision Rate"}),t.jsxs("span",{className:`type-data-lg font-semibold ${fe[m]}`,children:[e.collisionRate.toFixed(1),"%"]})]}),t.jsx(je,{value:e.collisionRate,status:m})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4 py-3 border-t border-b border-border-subtle",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"type-data-lg font-semibold text-text-primary",children:e.totalPrefixes}),t.jsx("div",{className:"type-data-xs text-text-muted",children:"Prefixes"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"type-data-lg font-semibold text-signal-good",children:e.unambiguousPrefixes}),t.jsx("div",{className:"type-data-xs text-text-muted",children:"Unique"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"type-data-lg font-semibold "+(e.collisionPrefixes>0?"text-signal-poor":"text-text-primary"),children:e.collisionPrefixes}),t.jsx("div",{className:"type-data-xs "+(e.collisionPrefixes>0?"text-signal-poor":"text-text-muted"),children:"Collisions"})]})]}),e.highCollisionPrefixes.length>0&&t.jsxs("div",{className:"mb-3",children:[t.jsx("div",{className:"type-data-xs text-text-muted mb-2",children:"Highest Collisions"}),t.jsx("div",{className:"flex flex-wrap gap-1.5",children:e.highCollisionPrefixes.map(({prefix:e,candidateCount:s,candidateHashes:a})=>t.jsxs("button",{type:"button",onClick:()=>r(e,a),className:"inline-flex items-center gap-1 px-2 py-1 min-h-[28px] rounded bg-surface-elevated text-text-secondary type-data-xs font-mono hover:bg-signal-poor/20 hover:text-signal-poor focus:outline-none focus:ring-2 focus:ring-signal-poor/50 transition-colors cursor-pointer touch-manipulation",title:`Click to explore ${s} candidates matching this prefix`,"aria-label":`Explore prefix ${e} with ${s} colliding candidates`,children:[e,t.jsxs("span",{className:"text-signal-poor",children:["×",s]})]},e))})]}),e.lowConfidencePrefixes.length>0&&t.jsx("div",{className:"mt-auto pt-3 border-t border-border-subtle",children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx(z,{className:"w-3.5 h-3.5 text-signal-poor mt-0.5 flex-shrink-0"}),t.jsxs("div",{children:[t.jsxs("div",{className:"type-data-xs text-signal-poor font-medium",children:[t.jsx("span",{className:"text-signal-poor",children:e.lowConfidencePrefixes.length})," prefix",1!==e.lowConfidencePrefixes.length?"es":""," with low confidence"]}),t.jsxs("div",{className:"type-data-xs text-text-muted mt-0.5 font-mono",children:[e.lowConfidencePrefixes.slice(0,5).join(", "),e.lowConfidencePrefixes.length>5&&t.jsxs("span",{className:"text-signal-poor",children:[" +",e.lowConfidencePrefixes.length-5," more"]})]})]})]})}),0===e.lowConfidencePrefixes.length&&0===e.collisionPrefixes&&t.jsx("div",{className:"mt-auto pt-3 border-t border-border-subtle",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(U,{className:"w-3.5 h-3.5 text-signal-excellent"}),t.jsx("span",{className:"type-data-xs text-signal-excellent",children:"All prefixes uniquely identified"})]})}),t.jsx(A,{isOpen:!!l,prefix:(null==l?void 0:l.prefix)||"",candidateHashes:(null==l?void 0:l.candidateHashes)||[],onClose:o})]})}function be(){var e,s,a,n;const p=l(),f=i(),g=r(),[j,y]=u.useState(null),[b,v]=u.useState(null),[N,k]=u.useState([]),[C,S]=u.useState(null),[$,A]=u.useState(null),[P,z]=u.useState(!0),[U,q]=u.useState(null),[X,I]=u.useState(3),O=function(e){const[t,s]=u.useState(e);return u.useEffect(()=>{const t=setTimeout(()=>s(e),150);return()=>clearTimeout(t)},[e,150]),t}(X),Z=o[O].hours,Y=60*Z,G=Math.ceil(60*Y/10);u.useEffect(()=>{!async function(){var e;q(null);try{const[t,s,a]=await Promise.all([c(Y,G),d(Z),m(Z)]);t.success&&t.data&&y(t.data),s.success&&s.data&&v(s.data),a.success&&(null==(e=a.data)?void 0:e.history)&&k(a.data.history)}catch(t){q(t instanceof Error?t.message:"Failed to load chart data")}finally{z(!1)}}()},[Z,Y,G]);const{utilSamples:K,startTs:Q,endTs:J}=u.useMemo(()=>{if(!j)return{utilSamples:[],startTs:0,endTs:0};const{received:e,transmitted:t,forwarded:s,bucket_duration_seconds:a,start_time:n,end_time:l}=j,i=1e3*a,r=function(e,t){const s=new Map;for(const a of e)s.set(a.start,{...a});for(const a of t){const e=s.get(a.start);e?(e.airtime_ms+=a.airtime_ms,e.count+=a.count):s.set(a.start,{...a})}return Array.from(s.values()).sort((e,t)=>e.start-t.start)}(t,s);return{utilSamples:pe(e,r,i),startTs:n,endTs:l}},[j]),ee=u.useMemo(()=>{switch(Z){case 72:return 6e5;case 168:return 18e5;default:return 3e5}},[Z]),se=u.useCallback(async()=>{try{const e=await c(Y,G);e.success&&e.data&&y(e.data)}catch{}},[Y,G]),ae=u.useCallback(async()=>{try{const e=await d(Z);e.success&&e.data&&v(e.data)}catch{}},[Z]),ne=u.useCallback(async()=>{var e;try{const t=await m(Z);t.success&&(null==(e=t.data)?void 0:e.history)&&k(t.data.history)}catch{}},[Z]);w(se,ee,!0,!0),w(ae,ee,!0,!0),w(ne,ee,!0,!0);const le=u.useMemo(()=>b&&b.series?b.series.map(e=>({name:e.name,value:e.data.reduce((e,t)=>e+(t[1]??0),0)})).filter(e=>e.value>0):[],[b]),ie=u.useMemo(()=>0===N.length?{timestamps:[],values:[]}:{timestamps:N.map(e=>e.timestamp),values:N.map(e=>e.noise_floor_dbm)},[N]),re=o[X],oe=u.useMemo(()=>{const e=(null==p?void 0:p.neighbors)??{};return Object.fromEntries(Object.entries(e).filter(([e])=>!f.has(e)))},[null==p?void 0:p.neighbors,f]),de=u.useMemo(()=>{const e=Date.now()/1e3-3600*Z;return Object.fromEntries(Object.entries(oe).filter(([,t])=>t.last_seen>=e))},[oe,Z]),xe=u.useMemo(()=>0===K.length?{peak:0,mean:0}:{peak:Math.max(...K.map(e=>e.rxUtilW)),mean:K.reduce((e,t)=>e+t.rxUtilW,0)/K.length},[K]);return t.jsxs(W,{children:[t.jsx(T,{title:"Statistics",icon:t.jsx(x,{}),controls:t.jsx(M,{ranges:o,selectedIndex:X,onSelect:I})}),U&&t.jsx(R,{className:"border border-accent-red/50 bg-accent-red/10",children:t.jsx("p",{className:"text-accent-red",children:U})}),P?t.jsx(H,{template:"auto",children:t.jsx(R,{className:"text-center py-12",children:t.jsx("div",{className:"animate-pulse text-text-muted",children:"Loading statistics..."})})}):t.jsxs(t.Fragment,{children:[t.jsxs(H,{template:"panel",children:[t.jsx(E,{span:12,md:6,children:t.jsxs(R,{children:[t.jsx(F,{icon:t.jsx(D,{}),title:"Airtime Utilization",badge:re.label,largeTitle:!0,actions:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("span",{className:"type-data-xs text-text-muted",children:["Peak ",t.jsxs("span",{className:"text-text-secondary tabular-nums font-medium",children:[xe.peak.toFixed(2),"%"]})]}),t.jsxs("span",{className:"type-data-xs text-text-muted",children:["Mean ",t.jsxs("span",{className:"text-text-secondary tabular-nums font-medium",children:[xe.mean.toFixed(2),"%"]})]})]})}),t.jsx("div",{className:"flex-1 min-h-0",children:t.jsx(te,{samples:K,startTs:Q,endTs:J})})]})}),t.jsx(E,{span:12,md:6,children:t.jsxs(R,{children:[t.jsx(F,{icon:t.jsx(B,{}),title:"Link Quality",badge:re.label,largeTitle:!0,actions:$?t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 type-data-xs text-text-muted",children:[t.jsxs("span",{children:[t.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:$.zeroHopCount})," nbr"]}),t.jsxs("span",{children:[t.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:$.totalCount})," obs"]}),t.jsxs("span",{children:[t.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:$.maxDistanceKm.toFixed(0)})," km"]})]}):null}),t.jsx("div",{className:"flex-1 min-h-0",children:t.jsx(ce,{neighbors:de,quickNeighbors:g,localLat:(null==(s=null==(e=null==p?void 0:p.config)?void 0:e.repeater)?void 0:s.latitude)??0,localLon:(null==(n=null==(a=null==p?void 0:p.config)?void 0:a.repeater)?void 0:n.longitude)??0,onStatsChange:A})})]})})]}),t.jsxs(H,{template:"panel",children:[t.jsx(E,{span:12,md:6,children:t.jsxs(R,{children:[t.jsx(F,{icon:t.jsx(_,{}),title:"Packet Types",largeTitle:!0}),t.jsx("div",{className:"flex-1 min-h-0",children:le.length>0?t.jsx(V,{data:le}):t.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No packet type data available"})})]})}),t.jsx(E,{span:12,md:6,children:t.jsxs(R,{children:[t.jsx(F,{icon:t.jsx(L,{}),title:"Network Composition",badge:re.label,largeTitle:!0}),t.jsx("div",{className:"flex-1 min-h-0",children:t.jsx(ue,{neighbors:de})})]})})]}),t.jsxs(H,{template:"panel",children:[t.jsx(E,{span:12,md:6,children:t.jsx(ye,{})}),t.jsx(E,{span:12,md:6,children:t.jsxs(R,{children:[t.jsx(F,{icon:t.jsx(h,{}),title:"RF Noise Floor",largeTitle:!0,actions:C?t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 md:gap-3",children:[t.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["min ",t.jsx("span",{className:"text-text-secondary tabular-nums",children:C.min.toFixed(0)})]}),t.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["avg ",t.jsx("span",{className:"text-text-secondary tabular-nums",children:C.avg.toFixed(0)})]}),t.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["max ",t.jsx("span",{className:"text-text-secondary tabular-nums",children:C.max.toFixed(0)})]}),t.jsx("span",{className:"type-data-xs text-text-muted",children:"dBm"})]}):t.jsx("span",{className:"type-data-xs text-text-muted",children:"dBm"})}),t.jsx("div",{className:"flex-1 min-h-0",children:t.jsx(me,{timestamps:ie.timestamps,values:ie.values,onStatsChange:S})})]})})]})]})]})}export{be as default};
