import{r as e,j as t,c as s}from"./vendor-react-BKIq8k5U.js";import{c as a,u as n,A as i,m as l,U as r,S as o,a as c,b as d,d as m,B as u,e as h,f as x,h as p,j as f,w as g,R as v,L as j,k as b,n as y,o as N,D as w,p as k,q as M,r as C,T as L,t as S,v as _,x as B,y as T,z as R,C as F,E as D,F as H,G as A,H as P,I as $,J as z,K as E,M as I,N as q,O,Q as W}from"./index-CrU_Ps9k.js";import{C as G,S as V,a as U,P as J,b as K,B as Q}from"./PageLayout-BlXA3E6H.js";import{S as X,M as Y,c as Z}from"./link-scoring-CpsMpD17.js";import{A as ee,E as te,T as se}from"./TimeRangeSelector-BzCEWjlJ.js";import{S as ae,A as ne,P as ie,T as le}from"./PacketList-Q1pG-MMT.js";import{T as re,a as oe,M as ce,L as de,b as me}from"./LightSparkline-CE1rnNiF.js";import{C as ue,a as he}from"./DataBox-sJHphnZd.js";import{L as xe,b as pe}from"./vendor-core-D1aqi_5O.js";import{s as fe,Z as ge,C as ve}from"./SignalIndicator-DN65UHiA.js";import{N as je}from"./NodeInformationCard-BjZ_sk1b.js";import{C as be}from"./chevron-right-DBUqxZL-.js";import{H as ye}from"./route-BsYhRSod.js";import{L as Ne}from"./loader-circle-D6Apotf0.js";import{H as we}from"./house-DNrMSmBS.js";import{R as ke,C as Me}from"./Grid-BkE6UU8f.js";import{C as Ce}from"./Card-Cq7dyTi6.js";import"./deckgl-DTsmDcfs.js";import"./index-n30bZfID.js";import"./payload-decoders-N5zeG9av.js";import"./arrow-up-2wZY9TSM.js";import"./map-pin-BUNSWVCM.js";import"./triangle-alert-DrmOKr32.js";import"./activity-DIYCEspu.js";import"./circle-check-DH0TJtTq.js";import"./database-lWroaxsL.js";const Le=a("arrow-up-right",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]),Se=a("audio-waveform",[["path",{d:"M2 13a2 2 0 0 0 2-2V7a2 2 0 0 1 4 0v13a2 2 0 0 0 4 0V4a2 2 0 0 1 4 0v13a2 2 0 0 0 4 0v-4a2 2 0 0 1 2-2",key:"57tc96"}]]),_e=a("ear",[["path",{d:"M6 8.5a6.5 6.5 0 1 1 13 0c0 6-6 6-6 10a3.5 3.5 0 1 1-7 0",key:"1dfaln"}],["path",{d:"M15 8.5a2.5 2.5 0 0 0-5 0v1a2 2 0 1 1 0 4",key:"1qnva7"}]]),Be=a("megaphone",[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]]),Te=a("message-square-text",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}],["path",{d:"M7 11h10",key:"1twpyw"}],["path",{d:"M7 15h6",key:"d9of3u"}],["path",{d:"M7 7h8",key:"af5zfr"}]]),Re=a("satellite-dish",[["path",{d:"M4 10a7.31 7.31 0 0 0 10 10Z",key:"1fzpp3"}],["path",{d:"m9 15 3-3",key:"88sc13"}],["path",{d:"M17 13a6 6 0 0 0-6-6",key:"15cc6u"}],["path",{d:"M21 13A10 10 0 0 0 11 3",key:"11nf8s"}]]),Fe=a("square-activity",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M17 12h-2l-2 5-2-10-2 5H7",key:"15hlnc"}]]),De=a("timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);function He({packets:s,rangeMinutes:a,bucketCount:c}){const d=n(),[m,u]=e.useState(null),[h,x]=e.useState(null),[p,f]=e.useState(null),{buckets:g,activeTypes:v,totalByType:j}=e.useMemo(()=>function(e,t,s){const a=Date.now()/1e3,n=60*t,i=a-n,l=n/s,r=[];for(let c=0;c<s;c++)r.push({start:i+c*l,end:i+(c+1)*l,bytesByType:{},totalBytes:0});const o={};for(const c of e){if(c.transmitted)continue;const e=c.timestamp;if(e<i||e>a)continue;const t=Math.min(s-1,Math.floor((e-i)/l)),n=c.type??c.payload_type??0,d=c.length??c.payload_length??0,m=r[t];m.bytesByType[n]=(m.bytesByType[n]??0)+d,m.totalBytes+=d,o[n]=(o[n]??0)+d}return{buckets:r,activeTypes:Object.keys(o).map(e=>parseInt(e,10)).filter(e=>o[e]>0).sort((e,t)=>o[t]-o[e]),totalByType:o}}(s,a,c),[s,a,c]),b=e.useCallback((e,t,s)=>{u(t),x(s)},[]),y=g.length>0&&v.length>0,N=m?function(e){const t=new Date(1e3*e).getHours();return t>=6&&t<18}(m.start):null,w=m?(k=m.start,new Date(1e3*k).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})):"";var k;const M=null!==p&&null!==N&&p!==N;return N!==p&&f(N),t.jsxs("div",{className:"flex flex-col h-full relative",children:[t.jsx("div",{className:"h-5 relative mb-1 shrink-0",children:m&&null!==h&&t.jsxs("div",{className:"absolute flex items-center gap-1.5 text-sm font-mono tabular-nums -translate-x-1/2",style:{left:`calc(48px + ${100*h}% * (1 - 48px / 100%))`},children:[t.jsx(i,{mode:"wait",children:t.jsx(l.span,{initial:!!M&&{opacity:0,scale:.5,rotate:-90},animate:{opacity:1,scale:1,rotate:0},exit:{opacity:0,scale:.5,rotate:90},transition:{duration:.25,ease:"easeOut"},children:N?t.jsx(X,{className:"w-4 h-4 text-amber-400"}):t.jsx(Y,{className:"w-4 h-4 text-blue-400"})},N?"sun":"moon")}),t.jsx("span",{className:"text-text-secondary",children:w})]})}),t.jsx("div",{className:"flex-1 min-h-0",children:y&&t.jsx(r,{buckets:g,activeTypes:v,gridColor:d.grid,axisTickColor:d.axisTick,onHover:b})}),t.jsx("div",{className:"pt-2 px-1 pb-2 shrink-0",children:y&&t.jsx(o,{activeTypes:v,totalByType:j})})]})}const Ae=e.memo(function({buckets:s,activeTypes:a}){const n=e.useRef(null),i=e.useRef(s),l=e.useRef(a);i.current=s,l.current=a;const r=e.useMemo(()=>[s.map(e=>e.start),s.map(()=>1)],[s]);return e.useEffect(()=>{if(!n.current||0===s.length)return;const e=n.current,t=e.getBoundingClientRect(),a=Math.floor(t.width)||200,o=Math.floor(t.height)||60,u=new c({width:a,height:o,padding:[0,0,0,0],cursor:{show:!1},scales:{x:{time:!1},y:{range:[0,1]}},axes:[{show:!1},{show:!1}],series:[{},{show:!1}],legend:{show:!1},hooks:{draw:[e=>{const t=e.ctx,{left:s,top:a,width:n,height:r}=e.bbox;!function(e,t,s,a,n,i,l){if(0===t.length)return;const r=function(e,t,s){var a,n;if(e.length<=s)return e;const i=e.length/s,l=[];for(let r=0;r<s;r++){const s=Math.floor(r*i),o=Math.floor((r+1)*i),c=e.slice(s,o),d={start:(null==(a=c[0])?void 0:a.start)??0,end:(null==(n=c.at(-1))?void 0:n.end)??0,bytesByType:{},totalBytes:0};for(const e of c){d.totalBytes+=e.totalBytes;for(const s of t){const t=e.bytesByType[s]??0;t>0&&(d.bytesByType[s]=(d.bytesByType[s]??0)+t)}}l.push(d)}return l}(t,s,m.statsCard),o=r.length,c=i/o,u=r.map(e=>e.totalBytes).filter(e=>e>0);if(0===u.length)return;const h=Math.max(...u),x=Math.min(...u),p=h-x;for(let m=0;m<o;m++){const t=r[m],i=a+m*c,o=t.totalBytes;if(0===o)continue;let u,h,f;0===p?(h=.4,f=.3,u=.5):(u=(o-x)/p,f=.15*u,h=Math.max(.3,.3+.5*u));const g=h*l;let v=n+l-f*l-g+g;for(const a of s){const s=t.bytesByType[a]??0;if(0===s)continue;const n=s/o*g,l=v-n;e.fillStyle=d(a),e.globalAlpha=.85,e.fillRect(i,l,c,n),v=l}}e.globalAlpha=1}(t,i.current,l.current,s,a,n,r)}]}},r,e),h=new ResizeObserver(()=>{const t=e.getBoundingClientRect();t.width>0&&t.height>0&&u.setSize({width:Math.floor(t.width),height:Math.floor(t.height)})});return h.observe(e),()=>{h.disconnect(),u.destroy()}},[r,s.length]),0===s.length?t.jsx("div",{className:"h-full flex items-center justify-center",children:t.jsx("div",{className:"w-full h-0.5 rounded-full bg-text-muted/15"})}):t.jsx("div",{ref:n,className:"w-full h-full"})});function Pe({value:s,receivedCount:a,packets:n,rangeMinutes:i,bucketCount:l,timeRangeLabel:r,icon:o,isLoaded:c=!0}){const{buckets:d,activeTypes:m,ratePerHour:h}=e.useMemo(()=>function(e,t,s){const a=Date.now()/1e3,n=60*t,i=a-n,l=n/s,r=[];for(let m=0;m<s;m++)r.push({start:i+m*l,end:i+(m+1)*l,bytesByType:{},totalBytes:0});const o={};let c=0;for(const m of e){if(!("tx_forward"===m.packet_origin||m.transmitted&&"tx_local"!==m.packet_origin))continue;const e=m.timestamp;if(e<i||e>a)continue;const t=Math.min(s-1,Math.floor((e-i)/l)),n=m.type??m.payload_type??0,d=m.length??m.payload_length??0,u=r[t];u.bytesByType[n]=(u.bytesByType[n]??0)+d,u.totalBytes+=d,o[n]=(o[n]??0)+d,c++}const d=t/60;return{buckets:r,activeTypes:Object.keys(o).map(e=>parseInt(e,10)).filter(e=>o[e]>0).sort((e,t)=>o[t]-o[e]),ratePerHour:d>0?Math.round(c/d):0}}(n,i,l),[n,i,l]),x=a>0?(s/a*100).toFixed(1):null;return c?t.jsxs("div",{className:"data-card flex flex-col relative",children:[t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-2 sm:mb-3",children:[o&&t.jsx("span",{className:"icon-sm text-icon-card-title",children:o}),t.jsx("span",{className:"type-micro",children:"FORWARDED"}),r&&t.jsx(u,{color:"zinc",className:"hidden sm:inline-flex",children:r})]}),t.jsx("div",{className:"type-data-xl text-text-primary",children:t.jsx(ee,{value:s,className:"font-mono tabular-nums",priority:"high"})}),t.jsx("div",{className:"flex-1 mt-1 overflow-hidden min-h-[40px] sm:min-h-[60px]",children:m.length>0?t.jsx(Ae,{buckets:d,activeTypes:m}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx("div",{className:"w-full h-0.5 rounded-full bg-text-muted/15"})})}),t.jsx("div",{className:"pt-1.5 sm:pt-2 mt-1",children:t.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"data-box-label",children:"Rate"}),t.jsxs("div",{className:"data-box data-box-fill data-box-left",children:[h,"/hr"]})]}),null!==x&&t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"data-box-label",children:"Ratio"}),t.jsxs("div",{className:"data-box data-box-fill data-box-left",children:[x,"%"]})]})]})})]}):t.jsx("div",{className:"data-card flex flex-col relative",children:t.jsx(G,{})})}function $e({value:s,receivedCount:a,packets:n,rangeMinutes:i,bucketCount:l,timeRangeLabel:r,icon:o,isLoaded:c=!0}){const{buckets:d,activeTypes:m,ratePerHour:h}=e.useMemo(()=>function(e,t,s){const a=Date.now()/1e3,n=60*t,i=a-n,l=n/s,r=[];for(let m=0;m<s;m++)r.push({start:i+m*l,end:i+(m+1)*l,bytesByType:{},totalBytes:0});const o={};let c=0;for(const m of e){if(!m.drop_reason)continue;const e=m.timestamp;if(e<i||e>a)continue;const t=Math.min(s-1,Math.floor((e-i)/l)),n=m.type??m.payload_type??0,d=m.length??m.payload_length??0,u=r[t];u.bytesByType[n]=(u.bytesByType[n]??0)+d,u.totalBytes+=d,o[n]=(o[n]??0)+d,c++}const d=t/60;return{buckets:r,activeTypes:Object.keys(o).map(e=>parseInt(e,10)).filter(e=>o[e]>0).sort((e,t)=>o[t]-o[e]),ratePerHour:d>0?Math.round(c/d):0}}(n,i,l),[n,i,l]),x=a>0?(s/a*100).toFixed(1):null;return c?t.jsxs("div",{className:"data-card flex flex-col relative",children:[t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-2 sm:mb-3",children:[o&&t.jsx("span",{className:"icon-sm text-icon-card-title",children:o}),t.jsx("span",{className:"type-micro",children:"DROPPED"}),r&&t.jsx(u,{color:"zinc",className:"hidden sm:inline-flex",children:r})]}),t.jsx("div",{className:"type-data-xl text-text-primary",children:t.jsx(ee,{value:s,className:"font-mono tabular-nums",priority:"high"})}),t.jsx("div",{className:"flex-1 mt-1 overflow-hidden min-h-[40px] sm:min-h-[60px]",children:m.length>0?t.jsx(Ae,{buckets:d,activeTypes:m}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx("div",{className:"w-full h-0.5 rounded-full bg-text-muted/15"})})}),t.jsx("div",{className:"pt-1.5 sm:pt-2 mt-1",children:t.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"data-box-label",children:"Rate"}),t.jsxs("div",{className:"data-box data-box-fill data-box-left",children:[h,"/hr"]})]}),null!==x&&t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"data-box-label",children:"Drop %"}),t.jsxs("div",{className:"data-box data-box-fill data-box-left",children:[x,"%"]})]})]})})]}):t.jsx("div",{className:"data-card flex flex-col relative",children:t.jsx(G,{})})}const ze={",":"punc",".":"punc-period",":":"punc-colon","/":"punc-slash"},Ee=/([,\.:\/])/g,Ie=e.memo(function({children:s,className:a="",as:n="span"}){const i=e.useMemo(()=>{let e;return e="number"==typeof s?s.toLocaleString():Array.isArray(s)?s.join(""):String(s??""),Ee.test(e)?(Ee.lastIndex=0,e.split(Ee).map((e,s)=>{const a=ze[e];return a?t.jsx("span",{className:a,children:e},s):e})):e},[s]);return t.jsx(n,{className:`data-tight ${a}`.trim(),children:i})}),qe=.2;function Oe(e,t=1){return Math.floor(5*t*e)}function We(e){const t=Math.round(e/qe)*qe;return Math.max(0,Math.min(5,t))}function Ge({stats:s,receivedBuckets:a,droppedBuckets:n,forwardedBuckets:i,bucketDurationSeconds:l,timeRangeLabel:r,isLoaded:o=!0}){var c,d,m,h;const[x,p]=e.useState(!1);if(!o)return t.jsx("div",{className:"data-card flex flex-col relative",children:t.jsx(G,{})});const f=function(e,t,s,a,n){var i,l;const r=e=>(null==e?void 0:e.reduce((e,t)=>e+t.count,0))??0,o=r(t),c=r(s),d=r(a),m=o||(null==e?void 0:e.rx_count)||1,u=c||(null==e?void 0:e.dropped_count)||0,h=m>0?u/(m+u)*100:0;let x=0;if((null==a?void 0:a.length)&&n)x=100*d/(a.length*n*1e3)*100;else if(e){const t=1e3*(e.uptime_seconds||1);x=(e.total_airtime_ms||e.airtime_used_ms||0)/t*100}const p=(null==e?void 0:e.neighbors)??{},f=Object.values(p).filter(e=>e.zero_hop).length;let g=1;h<3?g-=qe:h>15?g+=.4:h>10&&(g+=qe),x>5&&(g+=qe),f>10&&(g+=qe);const v=We(g),j=We(.28*v),b=Oe(v),y=Oe(j),N=Oe((null==(l=null==(i=null==e?void 0:e.config)?void 0:i.delays)?void 0:l.tx_delay_factor)??1);return{floodFactor:v,directFactor:j,floodSlots:b,directSlots:y,adjustment:b>N?"increase":b<N?"decrease":"stable",duplicateRate:Math.round(100*h)/100,txUtilization:Math.round(1e3*x)/1e3,zeroHopCount:f,totalReceived:o,totalDropped:c}}(s,a,n,i,l),g=(null==(d=null==(c=null==s?void 0:s.config)?void 0:c.delays)?void 0:d.tx_delay_factor)??null,v=(null==(h=null==(m=null==s?void 0:s.config)?void 0:m.delays)?void 0:h.direct_tx_delay_factor)??null,j=null!==g?Oe(g):null,b=null!==j&&f.floodSlots!==j,y="increase"===f.adjustment?re:"decrease"===f.adjustment?oe:ce;return t.jsxs("div",{className:"data-card flex flex-col relative",children:[t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-2 sm:mb-3 flex-wrap",children:[t.jsx(ae,{className:"w-4 h-4 text-icon-card-title flex-shrink-0"}),t.jsx("span",{className:"type-micro",children:"DELAY DOCTOR"}),r&&t.jsx(u,{color:"zinc",className:"hidden sm:inline-flex",children:r}),b&&t.jsxs(u,{color:"increase"===f.adjustment?"amber":"emerald",className:"flex items-center gap-1",children:[t.jsx(y,{className:"w-3 h-3"}),"increase"===f.adjustment?"+":"-",Math.abs(f.floodSlots-(j??0))]})]}),t.jsxs("button",{onClick:async()=>{const e=`set txdelay ${f.floodFactor.toFixed(1)}\nset direct.txdelay ${f.directFactor.toFixed(1)}`;try{await navigator.clipboard.writeText(e),p(!0),setTimeout(()=>p(!1),1500)}catch(t){const s=document.createElement("textarea");s.value=e,s.style.position="fixed",s.style.opacity="0",document.body.appendChild(s),s.select();try{document.execCommand("copy"),p(!0),setTimeout(()=>p(!1),1500)}catch{}document.body.removeChild(s)}},className:"flex gap-3 mb-2 sm:mb-3 w-full text-left hover:bg-white/[0.02] radius-inner transition-base p-1 -m-1 group",title:"Click to copy CLI commands",children:[t.jsxs("div",{className:"flex-1 flex flex-col",children:[t.jsx("span",{className:"type-data-xl text-text-primary",children:t.jsxs(Ie,{children:["Ã—",f.floodFactor.toFixed(1)]})}),t.jsx("span",{className:"text-xs font-medium text-text-muted uppercase tracking-wide mt-0.5 sm:mt-1",children:"Flood"})]}),t.jsxs("div",{className:"flex-1 flex flex-col",children:[t.jsx("span",{className:"type-data-xl text-accent-primary",children:t.jsxs(Ie,{children:["Ã—",f.directFactor.toFixed(1)]})}),t.jsx("span",{className:"text-xs font-medium text-text-muted uppercase tracking-wide mt-0.5 sm:mt-1",children:"Direct"})]}),t.jsx("div",{className:"flex items-center self-center opacity-0 group-hover:opacity-100 transition-opacity",children:x?t.jsx(ue,{className:"w-4 h-4 text-green-400"}):t.jsx(he,{className:"w-4 h-4 text-text-muted"})})]}),t.jsx("div",{className:"flex-1 py-2",children:t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"data-box-label",children:"Dupe"}),t.jsxs("div",{className:"data-box data-box-fill data-box-left "+(f.duplicateRate>10?"text-accent-warning":""),children:[f.duplicateRate.toFixed(1),"%"]})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"data-box-label",children:"TX Util"}),t.jsxs("div",{className:"data-box data-box-fill data-box-left",children:[f.txUtilization.toFixed(2),"%"]})]})]})}),t.jsxs("div",{className:"pt-2 mt-2",children:[t.jsx("div",{className:"data-box-label",children:"Current"}),t.jsx("div",{className:"flex gap-2",children:null!==g?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"data-box",children:["Ã—",g.toFixed(2)]}),t.jsxs("div",{className:"data-box",style:{color:"var(--accent-primary)"},children:["Ã—",(null==v?void 0:v.toFixed(2))??"â€”"]})]}):t.jsx("span",{className:"text-sm text-text-muted",children:"No config"})})]})]})}function Ve(){const s=h(),a=x(),n=p(),i=f(),[l,r]=e.useState([]);e.useEffect(()=>{const e=g.subscribe(e=>{r(e)});return r(g.getPendingPackets()),e},[]);const o=e.useMemo(()=>{const e=s.length<=100?s:s.slice(-100),t=new Set(e.map(e=>e.packet_hash));return[...l.filter(e=>!t.has(e.packet.packet_hash)).map(e=>({...e.packet,isPending:!0})),...e].sort((e,t)=>(t.timestamp??0)-(e.timestamp??0))},[s,l]),c=null==i?void 0:i.local_hash,d=null==i?void 0:i.neighbors;return t.jsxs("div",{className:"chart-container h-full flex flex-col !overflow-visible",children:[t.jsxs("div",{className:"chart-header",children:[t.jsxs("div",{className:"chart-title",children:[t.jsx(v,{className:"chart-title-icon"}),"Recent Packets"]}),t.jsxs("div",{className:"flex items-center gap-3",children:[n&&t.jsx(j,{showLabel:!0}),t.jsxs(xe,{to:"/packets",className:"pill-subtle",children:["View all ",t.jsx(ne,{className:"w-3 h-3"})]})]})]}),t.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto px-1",children:t.jsx(ie,{packets:o,allPackets:s,localHash:c,neighbors:d,loading:a,maxPackets:25,showPagination:!1,flashNewest:!0,emptyMessage:"No packets received",footerAction:t.jsxs(xe,{to:"/packets",className:"pill-subtle",children:["View all ",t.jsx(ne,{className:"w-3 h-3"})]})})})]})}const Ue={stable:"M5 12h14",up:"M5 15l7-7 7 7",down:"M19 9l-7 7-7-7"};function Je({trend:e}){return t.jsx("span",{className:`mini-widget-trend ${e}`,children:t.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:Ue[e]})})})}function Ke(){return t.jsx("div",{className:"mini-widget-loading",children:t.jsx("div",{className:"mini-widget-loading-spinner"})})}function Qe({message:e}){return t.jsx("div",{className:"mini-widget-error",children:t.jsx("span",{title:e,children:"No data"})})}function Xe({title:e,icon:s,value:a,unit:n,valueSize:i="md",status:l,subtitle:r,trend:o,children:c,isLoading:d=!1,error:m,className:u="",onClick:h}){const x=["mini-widget-value","lg"===i&&"mini-widget-value-lg","sm"===i&&"mini-widget-value-sm"].filter(Boolean).join(" "),p=["mini-widget",h&&"cursor-pointer",u].filter(Boolean).join(" ");return t.jsxs("div",{className:p,onClick:h,role:h?"button":void 0,children:[t.jsxs("div",{className:"mini-widget-header",children:[s,t.jsx("span",{className:"mini-widget-title",children:e}),l&&"unknown"!==l&&t.jsx("div",{className:`mini-widget-status-dot ${l}`}),o&&t.jsx(Je,{trend:o})]}),d?t.jsx(Ke,{}):m?t.jsx(Qe,{message:m}):t.jsxs(t.Fragment,{children:[void 0!==a&&t.jsxs("div",{className:x,children:["number"==typeof a?t.jsx(ee,{value:a,className:"font-mono tabular-nums",priority:"medium",format:Number.isInteger(a)?void 0:{minimumFractionDigits:1,maximumFractionDigits:1}}):t.jsx(Ie,{children:a}),n&&t.jsx("span",{className:"mini-widget-unit",children:n})]}),r&&t.jsx("div",{className:"mini-widget-subtitle",children:r}),c]})]})}const Ye={DELTA_CRITICAL:10,SLOPE_CRITICAL:4,JITTER_CRITICAL:6,DELTA_WARNING:5,SLOPE_WARNING:2,JITTER_WARNING:4},Ze={baselineMedian:null,baselineP10:null,baselineP90:null,currentMedian:null,currentSampleCount:0,delta:0,slope:0,jitter:0,penalty:0,penaltyReason:null,computedAt:0,isReliable:!1};function et(e,t){if(0===e.length)return null;const s=[...e].sort((e,t)=>e-t),a=t/100*(s.length-1),n=Math.floor(a),i=Math.ceil(a);return n===i?s[n]:s[n]+(s[i]-s[n])*(a-n)}function tt(e){return et(e,50)}function st(e){if(!e)return[];try{const t=JSON.parse(e);if(Array.isArray(t))return t.map(Number).filter(e=>!isNaN(e))}catch{}return[]}function at(e){return null!=e&&0!==e&&!Object.is(e,-0)&&!(e>-50||e<-130)}function nt(e,t,s=2,a=!1){if(null===t)return"stable";const n=e-t;return(0!==t?100*Math.abs(n/t):Math.abs(n))<s?"stable":a?n>0?"up":"down":n>0?"down":"up"}const it={lbtStats:null,noiseFloor:null,sparklineNoiseFloor:[],linkQuality:null,channelHealth:null,nfTrend:Ze,radioConfig:null,trends:null,stats:null,recentPackets:[],quickNeighbors:[],isLoading:!0,error:null,refresh:async()=>{}},lt=e.createContext(it);function rt({children:s}){var a;const n=f(),i=h(),l=b(),r=y(),o=N(),c=w[o],d=Math.max(1,c.minutes/60),m=null===n,u=e.useMemo(()=>function(e,t){const s=3600*t,a=Math.floor(Date.now()/1e3)-s,n=e.filter(e=>e.timestamp>=a&&void 0!==e.lbt_attempts&&e.lbt_attempts>0),i=n.length,l=n.filter(e=>(e.lbt_attempts??0)>1).length,r=i>0?l/i*100:0,o=n.filter(e=>(e.lbt_attempts??0)>1),c=o.length>0?o.reduce((e,t)=>e+(t.lbt_attempts??0),0)/o.length:0,d=n.filter(e=>(e.lbt_attempts??0)>=5).length,m=i>0?d/i*100:0,u=[];for(const b of n){const e=st(b.lbt_backoff_delays_ms);u.push(...e)}const h=u.reduce((e,t)=>e+t,0),x=u.length>0?h/u.length:0,p=u.length>0?Math.min(...u):0,f=u.length>0?Math.max(...u):0,g=s/24,v=[],j=[];for(let b=0;b<24;b++){const e=a+b*g,t=e+g,s=n.filter(s=>s.timestamp>=e&&s.timestamp<t),i=s.filter(e=>(e.lbt_attempts??0)>1).length,l=s.length>0?i/s.length*100:0,r=[];for(const a of s){const e=st(a.lbt_backoff_delays_ms);r.push(...e)}const o=r.length>0?r.reduce((e,t)=>e+t,0)/r.length:0;if(v.push(o),0===s.length)j.push(0);else{const e=s.filter(e=>(e.lbt_attempts??0)>=5).length,t=r.length>0?Math.max(...r):0,a=Math.min(s.length/5,1),n=.15,i=Math.log(1+l*n)/Math.log(1+100*n)*40,c=e/s.length*100,d=Math.min(.5*c,25);let m=0;o>100&&(m=Math.min(8*Math.log10(o/100),15));let u=0;t>500&&o>0&&t>2*o&&(u=Math.min((t-500)/200,5));const h=i+d+m+u;j.push(Math.min(h*a,85))}}return{totalPacketsWithLBT:i,packetsWithRetries:l,retryRate:r,avgRetries:c,channelBusyCount:d,channelBusyRate:m,avgBackoffMs:x,minBackoffMs:p,maxBackoffMs:f,totalBackoffMs:h,sparklineBackoff:v,sparklineCollisionRisk:j,windowHours:t,packetCount:e.length}}(i,d),[i,d]),x=(null==n?void 0:n.noise_floor_dbm)??null,p=e.useMemo(()=>at(x)?x:null,[x]),g=e.useMemo(()=>{var e;const t=null==(e=null==n?void 0:n.config)?void 0:e.radio;return t?{sf:t.spreading_factor??7,bwHz:t.bandwidth??125e3}:null},[null==(a=null==n?void 0:n.config)?void 0:a.radio]),[v,j]=e.useState([]),M=e.useRef({time:0,hours:0});e.useEffect(()=>{const e=async()=>{var e;const t=Date.now(),s=Math.ceil(d);if(0===M.current.time||M.current.hours!==s||t-M.current.time>=6e4){M.current={time:t,hours:s};try{const t=await k(Math.max(s,24));t.success&&(null==(e=t.data)?void 0:e.history)&&j(t.data.history)}catch{}}};e();const t=setInterval(e,6e4);return()=>clearInterval(t)},[d]);const C=e.useMemo(()=>function(e,t){if(0===e.length)return[];const s=e.reduce((e,t)=>Math.max(e,t.timestamp),0);if(0===s)return[];const a=3600*t,n=s-a,i=a/24,l=[];for(let r=0;r<24;r++){const t=n+r*i,s=t+i,a=e.filter(e=>e.timestamp>=t&&e.timestamp<s&&at(e.noise_floor_dbm));if(a.length>0){const e=a.reduce((e,t)=>e+t.noise_floor_dbm,0)/a.length;l.push(e)}else l.push(l.length>0?l[l.length-1]:-100)}return l}(v,d),[v,d]),L=null==n?void 0:n.neighbors,S=e.useMemo(()=>{const e=L??{};return Object.fromEntries(Object.entries(e).filter(([e])=>!r.has(e)))},[L,r]),_=e.useMemo(()=>l.filter(e=>!r.has(e.hash)),[l,r]),B=e.useMemo(()=>function(e){if(0===e.length)return{...Ze,computedAt:Math.floor(Date.now()/1e3)};const t=Math.floor(Date.now()/1e3),s=e.filter(e=>Number.isFinite(e)),a=e.length>0?[e[e.length-1]]:[],n=e.slice(-4).filter(e=>Number.isFinite(e)),i=tt(s),l=et(s,10),r=et(s,90),o=tt(a),c=null!==o&&null!==l?o-l:0,d=function(e){if(e.length<2)return 0;const t=e.length;let s=0,a=0,n=0,i=0;const l=e[0].timestamp;for(const o of e){const e=(o.timestamp-l)/3600,t=o.value;s+=e,a+=t,n+=e*t,i+=e*e}const r=t*i-s*s;return Math.abs(r)<1e-4?0:(t*n-s*a)/r}(n.map((e,s)=>({timestamp:t-3600*(n.length-1-s),value:e}))),m=function(e){if(e.length<2)return 0;const t=e.reduce((e,t)=>e+t,0)/e.length,s=e.map(e=>Math.pow(e-t,2)).reduce((e,t)=>e+t,0)/e.length;return Math.sqrt(s)}(n),u=s.length>=12,[h,x]=u?function(e,t,s){const a=Ye;return e>=a.DELTA_CRITICAL?[2,`Noise floor ${e.toFixed(1)} dB above baseline`]:t>=a.SLOPE_CRITICAL?[2,`Noise floor rising ${t.toFixed(1)} dB/hour`]:s>=a.JITTER_CRITICAL?[2,`Noise floor unstable (Â±${s.toFixed(1)} dB)`]:e>=a.DELTA_WARNING?[1,`Noise floor ${e.toFixed(1)} dB above baseline`]:t>=a.SLOPE_WARNING?[1,`Noise floor rising ${t.toFixed(1)} dB/hour`]:s>=a.JITTER_WARNING?[1,`Noise floor variable (Â±${s.toFixed(1)} dB)`]:[0,null]}(c,d,m):[0,null];return{baselineMedian:i,baselineP10:l,baselineP90:r,currentMedian:o,currentSampleCount:a.length,delta:c,slope:d,jitter:m,penalty:h,penaltyReason:x,computedAt:t,isReliable:u}}(C),[C]),T=e.useMemo(()=>function(e,t,s){if(0===e.length)return{neighbors:[],networkScore:0,neighborCount:0,bestLink:null,worstLink:null};const a=e.map(e=>{const a=function(e,t,s){const a=fe(e,t,s,0);if(a)switch(a.finalGrade){case"excellent":return 100;case"good":return 80;case"fair":return 60;case"poor":return 40;case"critical":return 20}const n=void 0===e?50:e>=10?100:e>=5?80:e>=0?60:e>=-5?40:20,i=void 0===t?50:t>=-70?100:t>=-80?80:t>=-90?60:t>=-100?40:20;return Math.round(.6*n+.4*i)}(e.avgSnr??void 0,e.avgRssi??void 0,s),n=t[e.hash];return{name:(null==n?void 0:n.name)||(null==n?void 0:n.node_name)||e.prefix,hash:e.hash,rssi:e.avgRssi??-100,snr:e.avgSnr??-10,score:a,advertCount:e.count}});a.sort((e,t)=>t.score-e.score);const n=a.length>0?a.reduce((e,t)=>e+t.score,0)/a.length:0;return{neighbors:a,networkScore:Math.round(n),neighborCount:a.length,bestLink:a.length>0?{name:a[0].name,score:a[0].score}:null,worstLink:a.length>0?{name:a[a.length-1].name,score:a[a.length-1].score}:null}}(_,S,g),[_,S,g]),R=e.useMemo(()=>function(e,t,s){const a=e?Math.max(0,Math.min(100,100-5*e.retryRate)):50;let n=50;null!==t&&(n=Math.max(0,Math.min(100,(t+120)/30*100)));const i=(null==s?void 0:s.networkScore)??50,l=Math.round(.35*a+.25*n+.4*i);let r;return r=l>=85?"excellent":l>=70?"good":l>=50?"fair":l>=30?"congested":"critical",{score:l,status:r,components:{lbtHealth:Math.round(a),noiseHealth:Math.round(n),linkHealth:Math.round(i)}}}(u,p,T),[u,p,T]),[F,D]=e.useState({noiseFloor:null,networkScore:null,channelHealth:null}),H=e.useRef(0);e.useEffect(()=>{const e=()=>{const e=Date.now();e-H.current>3e4&&(H.current=e,D({noiseFloor:p,networkScore:(null==T?void 0:T.networkScore)??null,channelHealth:(null==R?void 0:R.score)??null}))};e();const t=setInterval(e,5e3);return()=>clearInterval(t)},[p,null==T?void 0:T.networkScore,null==R?void 0:R.score]);const A=e.useMemo(()=>({noiseFloor:{current:p,previous:F.noiseFloor,trend:null!==p?nt(p,F.noiseFloor,2,!0):"stable"},networkScore:{current:(null==T?void 0:T.networkScore)??0,previous:F.networkScore,trend:nt((null==T?void 0:T.networkScore)??0,F.networkScore,3,!1)},channelHealth:{current:(null==R?void 0:R.score)??0,previous:F.channelHealth,trend:nt((null==R?void 0:R.score)??0,F.channelHealth,3,!1)}}),[p,null==T?void 0:T.networkScore,null==R?void 0:R.score,F]),P={lbtStats:u,noiseFloor:p,sparklineNoiseFloor:C,linkQuality:T,channelHealth:R,nfTrend:B,radioConfig:g,trends:A,stats:n,recentPackets:i,quickNeighbors:l,isLoading:m,error:null,refresh:async()=>{}};return t.jsx(lt.Provider,{value:P,children:s})}function ot(){const t=e.useContext(lt);if(void 0===t)throw new Error("useLBTData must be used within an LBTDataProvider");return t}function ct(e,t){return 0===e?"No backoffs":`${t.toFixed(0)}% retry rate`}function dt(){const{lbtStats:s,isLoading:a,error:n}=ot(),i=pe(),l=(null==s?void 0:s.avgBackoffMs)??0,r=(null==s?void 0:s.retryRate)??0,o=s?(c=l)<100?"excellent":c<250?"good":c<500?"fair":c<1e3?"congested":"critical":"unknown";var c;const d=null==s?void 0:s.sparklineBackoff,m=e.useMemo(()=>!d||d.length<2?[]:d.map((e,t)=>({timestamp:Date.now()-36e5*(d.length-1-t),count:e})),[d]);return t.jsx(Xe,{title:"LBT Backoff",icon:t.jsx(De,{className:"mini-widget-icon"}),value:Math.round(l),unit:"ms",status:o,subtitle:s?ct(l,r):void 0,isLoading:a,error:n,onClick:()=>i("/packets"),children:t.jsx("div",{className:"mini-widget-sparkline w-full",children:t.jsx(de,{data:m,width:9999,height:24,color:"var(--accent-primary)",isLoading:a,className:"w-full"})})})}function mt(e){return 0===e?"â€”":e<1?"<1":Math.round(e).toString()}function ut(){const{lbtStats:e,isLoading:s,error:a}=ot(),n=pe(),i=(null==e?void 0:e.channelBusyCount)??0,l=(null==e?void 0:e.totalPacketsWithLBT)??0,r=(null==e?void 0:e.channelBusyRate)??0,o=(null==e?void 0:e.retryRate)??0,c=(null==e?void 0:e.avgBackoffMs)??0,d=(null==e?void 0:e.minBackoffMs)??0,m=(null==e?void 0:e.maxBackoffMs)??0,u=o>0?Math.max(0,(o-r)/o*100):100;return t.jsx(Xe,{title:"Ch. Busy",icon:t.jsx(te,{className:"mini-widget-icon"}),isLoading:s,error:a,onClick:()=>n("/packets"),children:t.jsx("div",{className:"flex-1 flex items-end",children:t.jsxs("div",{className:"grid grid-cols-[auto_minmax(0,1fr)_auto_minmax(0,1fr)] gap-x-2 gap-y-2 w-full items-baseline",children:[t.jsx("span",{className:"data-box-label mb-0",title:`${i} packets exceeded max CAD attempts (5) out of ${l} total transmissions.`,children:"Failed:"}),t.jsxs("div",{className:"data-box justify-self-start",title:`${i} packets exceeded max CAD attempts (5) out of ${l} total transmissions.`,children:[t.jsx(Ie,{children:i}),t.jsx("span",{className:"text-text-muted punc-slash",children:"/"}),t.jsx(Ie,{children:l})]}),t.jsx("span",{className:"data-box-label mb-0",title:`${u.toFixed(1)}% of packets that needed LBT retries were sent successfully.`,children:"Sent:"}),t.jsx("div",{className:"data-box justify-self-start",title:`${u.toFixed(1)}% of packets that needed LBT retries were sent successfully.`,children:t.jsxs(Ie,{children:[u.toFixed(0),"%"]})}),t.jsx("span",{className:"data-box-label mb-0",title:`Average LBT backoff delay: ${c.toFixed(0)}ms.`,children:"Mean:"}),t.jsxs("div",{className:"data-box justify-self-start",title:`Average LBT backoff delay: ${c.toFixed(0)}ms.`,children:[t.jsx(Ie,{children:mt(c)}),t.jsx("span",{className:"text-text-muted text-xs",children:"ms"})]}),t.jsx("span",{className:"data-box-label mb-0",title:`Backoff range: ${d.toFixed(0)}ms min, ${m.toFixed(0)}ms max.`,children:"Range:"}),t.jsxs("div",{className:"data-box justify-self-start",title:`Backoff range: ${d.toFixed(0)}ms min, ${m.toFixed(0)}ms max.`,children:[t.jsx(Ie,{children:mt(d)}),t.jsx("span",{className:"text-text-muted punc-slash",children:"/"}),t.jsx(Ie,{children:mt(m)})]})]})})})}function ht(e){return null===e?"No reading":e<-115?"Very quiet":e<-105?"Quiet":e<-95?"Moderate":e<-85?"Elevated":"High interference"}function xt(){const{noiseFloor:s,sparklineNoiseFloor:a,trends:n,isLoading:i,error:l}=ot(),r=null===(o=s)||o<-110?"excellent":o<-100?"good":o<-90?"fair":o<-80?"congested":"critical";var o;const c=null==n?void 0:n.noiseFloor.trend,d=e.useMemo(()=>!a||a.length<2?[]:a.map((e,t)=>({timestamp:Date.now()-36e5*(a.length-1-t),count:-e})),[a]),m=null!==s?Math.round(s):"â€”";return t.jsx(Xe,{title:"Noise Floor",icon:t.jsx(Se,{className:"mini-widget-icon"}),value:m,unit:null!==s?"dBm":void 0,status:r,trend:c,subtitle:ht(s),isLoading:i,error:l,children:t.jsx("div",{className:"mini-widget-sparkline w-full",children:t.jsx(de,{data:d,width:9999,height:24,color:"var(--accent-primary)",isLoading:i,className:"w-full"})})})}function pt(){const s=pe(),a=b(),n=h(),i=f(),l=N(),r=60*w[l].minutes,o=M(),c=e.useMemo(()=>{if(0===o)return n;const e=o-r;return n.filter(t=>t.timestamp>=e)},[n,r,o]),d=null===i,m=(null==i?void 0:i.local_hash)?C(i.local_hash):"",u=(null==i?void 0:i.neighbors)??{},{neighborHashes:x,neighborNames:p}=e.useMemo(()=>{const e=new Set,t=new Map;for(const s of a){e.add(s.hash);const a=u[s.hash],n=(null==a?void 0:a.name)||(null==a?void 0:a.node_name)||s.prefix;t.set(s.hash,n)}return{neighborHashes:e,neighborNames:t}},[a,u]),g=e.useMemo(()=>{if(0===x.size||0===c.length||!m)return{champion:null,listener:null,loudest:null};const{scores:e}=Z(c,x,m),t=[];for(const[i,l]of e)0!==l.blendedScore&&t.push({...l,name:p.get(i)??C(i)});let s=null,a=null,n=null;for(const i of t)(!s||i.blendedScore>s.blendedScore)&&(s=i),(!a||i.listenerScore>a.listenerScore)&&(a=i),(!n||i.loudScore>n.loudScore)&&(n=i);return{champion:s,listener:a,loudest:n}},[c,x,m,p]),{champion:v,listener:j,loudest:y}=g,k=v||j||y?t.jsxs("div",{className:"flex flex-col gap-0.5 mt-auto",children:[v&&t.jsx(L,{content:(S=v,t.jsxs("div",{className:"max-w-[220px]",children:[t.jsxs("div",{className:"font-semibold mb-1",children:["ðŸ† Champion: ",S.name]}),t.jsxs("div",{className:"text-text-muted mb-1",children:["Blended Score: ",S.blendedScore,t.jsx("span",{className:"text-text-muted/60 ml-1",children:"(Listener + Loud)"})]}),t.jsxs("div",{className:"border-t border-border-subtle pt-1 mt-1 space-y-0.5",children:[t.jsxs("div",{children:["Listener: ",S.listenerScore,"/100 (",S.listenerCount," shared paths)"]}),t.jsxs("div",{children:["Loud: ",S.loudScore,"/100 (",S.loudCount," packets relayed)"]})]})]})),children:t.jsxs("div",{className:"flex items-center gap-1 text-sm radius-badge px-1 -mx-1 hover-bg transition-base cursor-default",children:[t.jsx(le,{className:"w-3 h-3 text-map-neighbor-color flex-shrink-0"}),t.jsx("span",{className:"font-semibold text-map-neighbor-color font-mono truncate flex-1 min-w-0",children:v.name}),t.jsx("span",{className:"text-map-neighbor-color pl-2 tabular-nums flex-shrink-0 w-9 text-right",children:v.blendedScore})]})}),j&&t.jsx(L,{content:(e=>t.jsxs("div",{className:"max-w-[220px]",children:[t.jsxs("div",{className:"font-semibold mb-1",children:["ðŸ‘‚ Best Listener: ",e.name]}),t.jsxs("div",{className:"text-text-muted mb-1",children:["Score: ",e.listenerScore,"/100"]}),t.jsx("div",{className:"border-t border-border-subtle pt-1 mt-1",children:t.jsxs("div",{children:[e.listenerCount," packets where they heard your transmissions"]})})]}))(j),children:t.jsxs("div",{className:"flex items-center gap-1 text-sm radius-badge px-1 -mx-1 hover-bg transition-base cursor-default",children:[t.jsx(_e,{className:"w-3 h-3 text-text-muted flex-shrink-0"}),t.jsx("span",{className:"text-text-muted font-mono truncate flex-1 min-w-0",children:j.name}),t.jsx("span",{className:"text-text-muted pl-2 tabular-nums flex-shrink-0 w-9 text-right",children:j.listenerScore})]})}),y&&t.jsx(L,{content:(e=>t.jsxs("div",{className:"max-w-[220px]",children:[t.jsxs("div",{className:"font-semibold mb-1",children:["ðŸ“¢ Loudest: ",e.name]}),t.jsxs("div",{className:"text-text-muted mb-1",children:["Score: ",e.loudScore,"/100"]}),t.jsx("div",{className:"border-t border-border-subtle pt-1 mt-1",children:t.jsxs("div",{children:[e.loudCount," packets they relayed directly to you"]})})]}))(y),children:t.jsxs("div",{className:"flex items-center gap-1 text-sm radius-badge px-1 -mx-1 hover-bg transition-base cursor-default",children:[t.jsx(Be,{className:"w-3 h-3 text-text-muted flex-shrink-0"}),t.jsx("span",{className:"text-text-muted font-mono truncate flex-1 min-w-0",children:y.name}),t.jsx("span",{className:"text-text-muted pl-2 tabular-nums flex-shrink-0 w-9 text-right",children:y.loudScore})]})})]}):0===a.length?t.jsx("div",{className:"flex items-center justify-center text-sm text-text-muted mt-auto",children:"No direct neighbors"}):t.jsx("div",{className:"flex items-center justify-center text-sm text-text-muted mt-auto",children:"No routing data yet"});var S;return t.jsx(Xe,{title:"Link Leaders",icon:t.jsx(Re,{className:"mini-widget-icon"}),isLoading:d,onClick:()=>s("/contacts"),children:k})}function ft(){const{lbtStats:s,isLoading:a,error:n}=ot(),i=s?function(e){const{retryRate:t,channelBusyCount:s,totalPacketsWithLBT:a,avgBackoffMs:n,maxBackoffMs:i}=e;if(0===a)return 0;const l=Math.min(a/10,1),r=Math.log(1+.15*t)/Math.log(16)*40,o=s/a*100,c=Math.min(.5*o,25);let d=0;n>100&&(d=Math.min(8*Math.log10(n/100),15));let m=0;i>500&&n>0&&i>2*n&&(m=Math.min((i-500)/200,5));const u=(r+c+d+m)*l;return Math.min(u,85)}(s):0,l=s?(r=i)<15?"excellent":r<30?"good":r<45?"fair":r<60?"congested":"critical":"unknown";var r;const o=(null==s?void 0:s.maxBackoffMs)??0,c=s?o>200?`Max backoff: ${Math.round(o)}ms`:function(e){return e<15?"Clear channel":e<30?"Light traffic":e<45?"Moderate traffic":e<60?"Heavy traffic":e<75?"Congested":"Severe congestion"}(i):void 0,d=null==s?void 0:s.sparklineCollisionRisk,m=e.useMemo(()=>!d||d.length<2?[]:d.map((e,t)=>({timestamp:Date.now()-36e5*(d.length-1-t),count:e})),[d]),u=Math.round(10*i)/10;return t.jsx(Xe,{title:"Collision Risk",icon:t.jsx(ge,{className:"mini-widget-icon"}),value:u,unit:"%",status:l,subtitle:c,isLoading:a,error:n,children:t.jsx("div",{className:"mini-widget-sparkline w-full",children:t.jsx(de,{data:m,width:9999,height:24,color:"var(--accent-primary)",isLoading:a,className:"w-full"})})})}function gt(){const[s,a]=e.useState(!1),[n]=e.useState(0),{stats:i,lbtStats:l,isLoading:r}=ot(),o=e.useMemo(()=>{if(!i)return null;const e=i.airtime_used_ms??0,t=i.max_airtime_ms??1;return{usedMs:e,maxMs:t,remainingMs:i.airtime_remaining_ms??0,utilizationPercent:i.utilization_percent??(t>0?e/t*100:0)}},[i]),c=e.useMemo(()=>l&&0!==l.totalPacketsWithLBT?(l.totalPacketsWithLBT-l.packetsWithRetries)/l.totalPacketsWithLBT*100:100,[l]),d=(null==o?void 0:o.utilizationPercent)??0,m=(u=d)<30?"excellent":u<50?"good":u<70?"fair":u<90?"congested":"critical";var u;const h=(null==o?void 0:o.remainingMs)??0,x=c<95?`${c.toFixed(0)}% clean TX`:((p=h)<1e3?`${Math.round(p)}ms`:p<6e4?`${(p/1e3).toFixed(1)}s`:`${(p/6e4).toFixed(1)}m`)+" remaining";var p;const f=o?t.jsx("div",{className:"mini-widget-progress mt-auto",children:t.jsx("div",{className:`mini-widget-progress-bar ${m}`,style:{width:`${Math.min(d,100)}%`}})}):null;return t.jsx(Xe,{title:"Duty Cycle",icon:t.jsx(v,{className:"mini-widget-icon"}),value:d.toFixed(1),unit:"%",status:m,subtitle:x,isLoading:r,children:f})}function vt(){return t.jsxs("div",{className:"mini-widget",children:[t.jsxs("div",{className:"mini-widget-header",children:[t.jsx(V,{className:"w-4 h-4"}),t.jsx(V,{className:"h-3 w-16"})]}),t.jsx(V,{className:"h-7 w-12 mt-2"}),t.jsx(V,{className:"h-3 w-20 mt-2"})]})}function jt(){return t.jsx("div",{className:"widget-row",children:Array.from({length:6}).map((e,s)=>t.jsx(vt,{},s))})}function bt({className:e="",isLoaded:s=!0}){return t.jsxs("div",{className:`mesh-health-container relative ${e}`,children:[t.jsxs("div",{className:"mesh-health-header",children:[t.jsx(Fe,{className:"w-4 h-4 text-accent-primary"}),t.jsx("span",{className:"type-label text-text-muted",children:"MESH HEALTH"})]}),s?t.jsx(rt,{children:t.jsxs("div",{className:"widget-row",children:[t.jsx(dt,{}),t.jsx(ft,{}),t.jsx(xt,{}),t.jsx(gt,{}),t.jsx(ut,{}),t.jsx(pt,{})]})}):t.jsx(jt,{})]})}const yt={sm:{button:"w-3 h-3",icon:"w-1.5 h-1.5",stroke:"ring-1"},md:{button:"w-3.5 h-3.5",icon:"w-2 h-2",stroke:"ring-1"},lg:{button:"w-4 h-4",icon:"w-2.5 h-2.5",stroke:"ring-[1.5px]"}},Nt=e.forwardRef(function({size:e="md",showIconOnHover:a=!0,className:n,...i},l){const r=yt[e];return t.jsx("button",{ref:l,type:"button","aria-label":"Close",className:s("group relative inline-flex items-center justify-center rounded-full","transition-all duration-150 ease-out",r.button,"bg-[#FF5F57]",r.stroke,"ring-inset ring-[#E0443E]","hover:bg-[#FF6961]","active:bg-[#E04840] active:scale-95","focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2","focus-visible:ring-[#FF5F57] focus-visible:ring-offset-bg-base",n),...i,children:a&&t.jsx("svg",{className:s(r.icon,"opacity-0 group-hover:opacity-100 transition-opacity duration-100","text-[#4A0000]"),fill:"none",viewBox:"0 0 10 10",stroke:"currentColor",strokeWidth:2.5,strokeLinecap:"round",children:t.jsx("path",{d:"M2.5 2.5L7.5 7.5M7.5 2.5L2.5 7.5"})})})});let wt="",kt="",Mt="";function Ct(e){!function(){const e=new Date,t=e.toDateString();if(t!==Mt){Mt=t,wt=t;const s=new Date(e);s.setDate(s.getDate()-1),kt=s.toDateString()}}();const t=new Date(1e3*e).toDateString();return t===wt?"Today":t===kt?"Yesterday":new Date(1e3*e).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"})}function Lt(e){const t=["#22c55e","#3b82f6","#f59e0b","#ec4899","#8b5cf6","#06b6d4","#f97316","#84cc16"];let s=0;for(let a=0;a<e.length;a++)s=e.charCodeAt(a)+((s<<5)-s);return t[Math.abs(s)%t.length]}const St=new RegExp("(?:\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu");function _t(e){const t=e.match(St);return t&&t.length>0?{emoji:t[0],cleanName:e.replace(St,"").trim()||e}:{emoji:null,cleanName:e}}function Bt(e){const{cleanName:t}=_t(e),s=t.split(/[\s-_]+/).filter(Boolean);return s.length>=2?((Array.from(s[0])[0]||"")+(Array.from(s[1])[0]||"")).toUpperCase():Array.from(t).slice(0,2).join("").toUpperCase()}function Tt(e,t,s){return`${e||""}|${t}|${s}`}function Rt(e){const s=/@\[([^\]]+)\]/g,a=[];let n,i=0;for(;null!==(n=s.exec(e));)n.index>i&&a.push(e.slice(i,n.index)),a.push(t.jsx("span",{className:"font-extrabold text-white",children:n[1]},n.index)),i=n.index+n[0].length;return i<e.length&&a.push(e.slice(i)),a.length>0?a:e}const Ft=e.memo(function({message:e,onChannelClick:a,isChannelSelected:n}){const i=e.senderName||"Unknown",{emoji:l,cleanName:r}=_t(i),o=Lt(r),c=Bt(i),d=e.channelName||e.channelHash.slice(0,6);return t.jsxs("div",{className:"flex items-start gap-3 w-full",style:{transform:"translateZ(0)",willChange:"transform"},children:[t.jsxs("div",{className:"flex-shrink-0 w-9 flex flex-col items-center gap-1",children:[t.jsx("div",{className:s("w-9 h-9 rounded-full flex items-center justify-center","shadow-md ring-1 ring-white/10",l?"text-lg":"text-white text-[13px] font-bold tracking-tight"),style:{backgroundColor:o},children:l||c}),t.jsx("span",{className:"text-[10px] text-text-muted tabular-nums h-4 leading-4",children:(m=e.timestamp,new Date(1e3*m).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 h-5 mb-1",children:[t.jsx("span",{className:"text-[13px] font-medium truncate",style:{color:o,lineHeight:"20px"},children:r}),t.jsx("button",{onClick:()=>null==a?void 0:a(e.channelHash),className:s("px-2 rounded text-[10px] font-medium flex-shrink-0","ring-1 ring-inset h-5 leading-5",n?"bg-accent-primary/20 text-accent-primary ring-accent-primary/30":"bg-white/5 text-text-secondary ring-white/10 hover:bg-white/10"),children:d})]}),t.jsx("div",{className:s("inline-block px-3.5 py-2.5 max-w-full","rounded-2xl rounded-tl-md","bg-[#007AFF]"),children:t.jsx("p",{className:"text-sm text-white leading-relaxed tracking-wide whitespace-pre-wrap break-words",children:Rt(e.text)})})]})]});var m},function(e,t){const s=e.message,a=t.message;return s.timestamp===a.timestamp&&s.text===a.text&&s.senderName===a.senderName&&s.channelHash===a.channelHash&&s.channelName===a.channelName&&e.isChannelSelected===t.isChannelSelected&&e.onChannelClick===t.onChannelClick});function Dt({open:a,onClose:n,messages:i,onLoadMore:l,hasMoreToLoad:r,isDecoding:o}){const c=e.useRef(null),d=e.useRef(!0),m=N(),u=H(),h=e.useRef(!1);e.useEffect(()=>{a?(h.current=!0,A.resume()):h.current&&A.pause()},[a]);const x=e.useMemo(()=>{const e=Date.now()/1e3-60*w[m].minutes;return[...i].filter(t=>t.timestamp>=e).sort((e,t)=>e.timestamp-t.timestamp)},[i,m]),p=e.useCallback(()=>{const e=c.current;e&&(d.current=e.scrollTop>=-50)},[]),f=e.useMemo(()=>{const e=new Map;for(const t of x){const s=t.channelHash,a=e.get(s);a?a.count++:e.set(s,{name:t.channelName||t.channelHash.slice(0,6),hash:t.channelHash,count:1})}return Array.from(e.values()).sort((e,t)=>t.count-e.count)},[x]),g=f.length,[v,j]=e.useState(null),[b,y]=e.useState(!1),k=e.useCallback(()=>{l(v,f)},[l,v,f]),M=e.useMemo(()=>v?x.filter(e=>e.channelHash===v):x,[x,v]),C=e.useMemo(()=>{const e=[];let t="";for(const s of M){const a=Ct(s.timestamp);a!==t&&(e.push({type:"date",date:a}),t=a),e.push({type:"message",message:s})}return e},[M]);e.useLayoutEffect(()=>{const e=c.current;e&&d.current&&(e.scrollTop=0)},[M.length]);const L=f.slice(0,19),S=f.slice(19),_=S.length>0;return t.jsxs(P,{open:a,onClose:n,size:"lg",motionPlus:!0,solid:!0,children:[t.jsx(Nt,{onClick:n,size:"md",style:{position:"absolute",top:12,right:12,zIndex:10}}),t.jsxs($,{className:"p-0 flex flex-col h-[80vh] max-h-[700px] rounded-2xl",children:[t.jsx("div",{className:"flex-shrink-0 px-5 py-4 pr-12",children:t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Te,{className:"size-5 text-icon-card-title flex-shrink-0"}),t.jsx("h2",{className:"text-base font-semibold text-text-primary",children:"Public Channels"})]}),t.jsx(se,{ranges:w,selectedIndex:m,onSelect:u,size:"micro"})]})}),t.jsx("div",{className:"flex-shrink-0 px-3 pb-2 relative z-10 isolate",style:{minHeight:g>0?void 0:0},children:g>0&&t.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.jsx("button",{onClick:()=>j(null),className:s("px-2 py-0.5 rounded text-[10px] font-medium transition-all","ring-1 ring-inset",null===v?"bg-accent-primary/20 text-accent-primary ring-accent-primary/30":"bg-white/5 text-text-secondary ring-white/10 hover:bg-white/10"),children:"All"}),L.map(e=>t.jsx("button",{onClick:()=>j(e.hash),className:s("flex items-center gap-1 px-2 py-0.5 rounded text-[10px] font-medium transition-all","ring-1 ring-inset",v===e.hash?"bg-accent-primary/20 text-accent-primary ring-accent-primary/30":"bg-white/5 text-text-secondary ring-white/10 hover:bg-white/10"),children:t.jsx("span",{className:"truncate max-w-[80px]",children:e.name})},e.hash)),_&&t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>y(!b),className:s("flex items-center gap-0.5 px-2 py-0.5 rounded text-[10px] font-medium transition-all","ring-1 ring-inset",b||S.some(e=>e.hash===v)?"bg-accent-primary/20 text-accent-primary ring-accent-primary/30":"bg-white/5 text-text-secondary ring-white/10 hover:bg-white/10"),children:["+",S.length,t.jsx(z,{className:s("size-3 transition-transform",b&&"rotate-180")})]}),b&&t.jsx("div",{className:s("absolute top-full left-0 mt-1 z-50","min-w-[140px] max-h-[200px] overflow-y-auto","p-1 rounded-lg","bg-bg-elevated backdrop-blur-xl","ring-1 ring-border-subtle shadow-xl"),children:S.map(e=>t.jsxs("button",{onClick:()=>{j(e.hash),y(!1)},className:s("w-full flex items-center gap-1.5 px-2 py-1 rounded text-[10px] font-medium transition-all text-left",v===e.hash?"bg-accent-primary/20 text-accent-primary":"text-text-secondary hover:bg-white/10"),children:[t.jsx(ye,{className:"size-2.5 opacity-60 flex-shrink-0"}),t.jsx("span",{className:"truncate",children:e.name}),t.jsxs("span",{className:"opacity-60 ml-auto",children:["(",e.count,")"]})]},e.hash))})]})]})}),t.jsx("div",{ref:c,onScroll:p,className:s("flex-1 overflow-y-auto overflow-x-hidden","mx-3 mb-3 rounded-md","bg-bg-0","ring-1 ring-inset ring-white/10","flex flex-col-reverse"),children:o&&0===M.length?t.jsxs("div",{className:"flex flex-col items-center justify-center h-full min-h-[300px] text-text-muted px-4 py-4",children:[t.jsx(Ne,{className:"size-12 mb-4 text-accent-purple animate-spin"}),t.jsx("p",{className:"text-lg font-medium",children:"Loading messages..."})]}):0===M.length?t.jsxs("div",{className:"flex flex-col items-center justify-center h-full min-h-[300px] text-text-muted px-4 py-4",children:[t.jsx(me,{className:"size-16 mb-4 opacity-20"}),t.jsx("p",{className:"text-lg font-medium",children:"No messages yet"}),t.jsx("p",{className:"text-sm mt-1 opacity-70",children:v?"No messages in this channel":"Public channel messages will appear here"})]}):t.jsxs("div",{className:"px-4 py-4",children:[r&&t.jsx("div",{className:"flex justify-center mb-4",children:t.jsx("button",{onClick:k,disabled:o,className:s("px-4 py-1.5 rounded-full","text-[11px] font-medium","ring-1 ring-inset",o?"bg-white/5 text-text-muted ring-white/5 cursor-wait":"bg-accent-primary/10 text-accent-primary ring-accent-primary/20 hover:bg-accent-primary/20 hover:ring-accent-primary/30"),children:o?t.jsxs("span",{className:"flex items-center gap-1.5",children:[t.jsx(Ne,{className:"size-3 animate-spin"}),"Loading..."]}):"Load older messages"})}),C.map((e,a)=>{if("date"===e.type)return t.jsx("div",{className:"flex justify-center my-4",children:t.jsx("span",{className:s("px-3.5 py-1.5 rounded-full","bg-white/5 backdrop-blur-sm","text-[11px] text-text-muted/80 font-medium","ring-1 ring-white/5"),children:e.date})},`date-${e.date}-${a}`);const n=`msg-${e.message.timestamp}-${e.message.senderName||"anon"}-${e.message.channelHash}`;return t.jsx("div",{className:"mb-3",children:t.jsx(Ft,{message:e.message,onChannelClick:j,isChannelSelected:v===e.message.channelHash})},n)})]})}),t.jsx("div",{className:"flex-shrink-0 px-5 py-2 text-center",children:t.jsxs("p",{className:"text-[11px] text-text-muted",children:[M.length," messages Â· ",g," ",1===g?"channel":"channels",o&&t.jsxs("span",{className:"ml-2 text-accent-purple",children:[t.jsx(Ne,{className:"inline size-3 animate-spin mr-1"}),"Decrypting..."]})]})})]})]})}function Ht({isLoaded:a=!0}){const n=h(),[r,o]=e.useState(!1),c=N(),d=e.useCallback(()=>{o(!0),S.getState().queueDecryption(n)},[n]),m=_(),u=B(),x=T(),p=e.useMemo(()=>function(e){const t=[],s=new Set;for(const a of e.values()){const e=a.decoded;if(!e||!e.decrypted||e.macCorrupted||!e.text)continue;const n=Tt(e.senderName,e.channelHash,e.text);s.has(n)||(s.add(n),t.push({timestamp:a.timestamp,channelName:e.channelName,channelHash:e.channelHash,senderName:e.senderName,text:e.text,rssi:a.rssi,snr:a.snr}))}return t}(m),[m]),f=e.useMemo(()=>{const e=Date.now()/1e3-60*w[c].minutes;return p.filter(t=>t.timestamp>=e)},[p,c]),g=e.useMemo(()=>0===f.length?null:f.reduce((e,t)=>t.timestamp>e.timestamp?t:e),[f]),v=u.isDecoding,j=e.useMemo(()=>{const e=Date.now()/1e3-60*w[c].minutes,t=new Set;let s=0;for(const a of n)(a.type??a.payload_type)===R.GRP_TXT&&((a.timestamp??0)<e||t.has(a.packet_hash)||(t.add(a.packet_hash),s++));return s},[n,c]),b=F(),y=e.useMemo(()=>{const e=Date.now()/1e3-60*w[c].minutes;for(const t of n)if((t.type??t.payload_type)===R.GRP_TXT&&!((t.timestamp??0)<e||b.has(t.packet_hash)))return!0;return!1},[n,b,c]),k=e.useCallback((e,t)=>{if(!v){if(e){const s=t.find(t=>t.hash===e);if(s)return void S.getState().queueChannelDecryption(n,s.name)}S.getState().queueDecryption(n)}},[n,v]);return a?t.jsxs(t.Fragment,{children:[t.jsx("div",{onClick:d,className:s("group cursor-pointer rounded-xl transition-all duration-150","ring-1 ring-inset ring-white/10 hover:ring-accent-primary/50","hover:bg-white/[0.02]","px-3 py-2.5 sm:px-4 sm:py-3"),children:t.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-shrink-0",children:[t.jsx(Te,{className:"size-4 text-icon-card-title flex-shrink-0"}),t.jsx("span",{className:"type-micro",children:"CHAT ACTIVITY"}),j>0&&t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-white/5 ring-1 ring-inset ring-white/10 text-sm tabular-nums text-text-secondary",children:j}),t.jsx(be,{className:"size-4 text-text-muted group-hover:text-accent-purple transition-colors ml-auto sm:hidden"})]}),t.jsxs("div",{className:"flex items-center gap-2 sm:gap-1.5 min-w-0 overflow-hidden",children:[t.jsx(i,{mode:"wait",initial:!1,children:g?t.jsxs(l.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},exit:{opacity:0,y:-16},transition:{duration:.2,ease:[.4,0,.2,1]},className:"flex items-center gap-2 sm:gap-1.5 min-w-0",children:[g.channelName&&t.jsxs("span",{className:"hidden sm:inline-flex items-center px-2 py-1 rounded-md bg-white/5 ring-1 ring-inset ring-white/10 text-sm text-text-secondary flex-shrink-0",children:["#",g.channelName.replace(/^#/,"")]}),t.jsx("div",{className:"hidden sm:flex w-[30px] h-[30px] rounded-full items-center justify-center flex-shrink-0 ring-1 ring-white/10",style:{backgroundColor:Lt(_t(g.senderName||"").cleanName)},children:_t(g.senderName||"").emoji?t.jsx("span",{className:"text-base",children:_t(g.senderName||"").emoji}):t.jsx("span",{className:"text-white text-xs font-bold tracking-tighter",children:Bt(g.senderName||"")})}),t.jsx("div",{className:"inline-flex items-center px-3 py-1.5 rounded-2xl rounded-tr-md bg-[#007AFF] shadow-sm min-w-0 flex-1 sm:flex-initial sm:max-w-xs sm:-ml-px",children:t.jsx("span",{className:"text-sm text-white truncate tracking-wide",children:Rt(g.text)})}),t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-white/5 ring-1 ring-inset ring-white/10 text-sm tabular-nums text-text-secondary flex-shrink-0",children:D(g.timestamp)})]},`msg-${g.timestamp}-${g.senderName}-${g.channelHash}`):x?t.jsx(l.span,{initial:{opacity:0},animate:{opacity:1},className:"text-sm text-text-muted italic",children:"No messages yet"},"empty"):t.jsxs(l.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,y:-16},transition:{duration:.15},className:"flex items-center gap-2 sm:gap-1.5",children:[t.jsx("div",{className:"hidden sm:block w-8 h-4 rounded bg-white/10 animate-pulse"}),t.jsx("div",{className:"hidden sm:block w-[30px] h-[30px] rounded-full bg-white/10 animate-pulse"}),t.jsx("div",{className:"h-8 w-32 sm:w-48 rounded-2xl bg-white/10 animate-pulse"}),t.jsx("div",{className:"w-12 h-6 rounded-md bg-white/10 animate-pulse"})]},"skeleton")}),t.jsx(be,{className:"size-4 text-text-muted group-hover:text-accent-purple transition-colors flex-shrink-0 hidden sm:block ml-1"})]})]})}),t.jsx(Dt,{open:r,onClose:()=>o(!1),messages:p,onLoadMore:k,hasMoreToLoad:y,isDecoding:v})]}):t.jsx("div",{className:"h-14 rounded-xl bg-bg-elevated/50 animate-pulse"})}function At(){var s,a;const n=f(),i=E(),l=h(),r=I(),o=e.useRef(!1);r&&!o.current&&(o.current=!0);const c=o.current,d=N(),m=H(),x=q(),p=w[d],g=5===d&&!x.threeDayLoadComplete,v=6===d&&!x.sevenDayLoadComplete,j=7===d&&!x.fourteenDayLoadComplete,b=x.isBackgroundLoading&&(g||v||j),y=null==(s=null==n?void 0:n.config)?void 0:s.radio,k=e.useMemo(()=>y?{sf:y.spreading_factor??10,bw:y.bandwidth??25e4,cr:y.coding_rate??5,preamble:y.preamble_length??8}:null,[y]),M=l.length,C=e.useMemo(()=>M?O(p.minutes,p.buckets,l,n):null,[M,p.minutes,p.buckets,k]),L=e.useMemo(()=>{const e=e=>(null==e?void 0:e.reduce((e,t)=>e+t.count,0))??0,t=e(null==C?void 0:C.received),s=e(null==C?void 0:C.unique_received),a=e(null==C?void 0:C.forwarded),n=e(null==C?void 0:C.dropped),i=e(null==C?void 0:C.transmitted),l=((null==C?void 0:C.time_range_minutes)??p.minutes)/60;return{received:t,uniqueReceived:s,forwarded:a,dropped:n,transmitted:i,rxPerHour:l>0?Math.round(t/l):0,fwdPerHour:l>0?Math.round(a/l):0}},[C,p.minutes]),S=e.useMemo(()=>{if(!l.length)return{totalBytes:0,kbPerHour:0};const e=Date.now()/1e3,t=e-60*p.minutes;let s=0;for(const n of l)n.transmitted||n.timestamp<t||n.timestamp>e||(s+=n.length??n.payload_length??0);const a=p.minutes/60;return{totalBytes:s,kbPerHour:a>0?Math.round(s/1024/a):0}},[l,p.minutes]),_=(null==n?void 0:n.node_name)??(null==(a=null==n?void 0:n.config)?void 0:a.node_name)??"Unknown Node";return e.useEffect(()=>{_&&"Unknown Node"!==_&&(document.title=`pyMC: ${_}`)},[_]),i?t.jsxs(U,{className:"p-8 text-center",children:[t.jsx("p",{className:"type-subheading text-accent-red mb-2",children:"Failed to connect to backend"}),t.jsx("p",{className:"type-body text-white/50",children:i}),t.jsx("p",{className:"type-data-sm text-white/40 mt-4",children:"Make sure the backend is running on port 8000"})]}):t.jsxs(J,{children:[t.jsx(K,{title:_,icon:t.jsx(we,{}),controls:t.jsx(se,{ranges:w,selectedIndex:d,onSelect:m,isPending:b})}),t.jsxs(Q,{children:[t.jsx(Ht,{isLoaded:c}),t.jsx(ke,{template:"hero-auto",children:t.jsxs(U,{compact:!0,children:[t.jsx(Ce,{icon:t.jsx(W,{}),title:"PACKETS RECEIVED",badge:p.label,badgeColor:"zinc",actions:c?t.jsxs("div",{className:"data-box",children:[S.kbPerHour," KB/hr"]}):t.jsx("div",{className:"data-box opacity-0",children:"0 KB/hr"})}),t.jsxs("div",{className:"flex flex-wrap gap-4 sm:gap-8",children:[t.jsxs("div",{className:"flex items-end gap-2",children:[t.jsx("div",{className:"type-data-xl text-text-primary",children:c?t.jsx(ee,{value:L.received,className:"font-mono tabular-nums",priority:"high"}):t.jsx("span",{className:"opacity-30",children:"â€”"})}),t.jsx(u,{color:"zinc",className:"mb-0.5 sm:mb-1",children:"Total Rx"})]}),t.jsxs("div",{className:"flex items-end gap-2",children:[t.jsx("div",{className:"type-data-xl text-text-primary",children:c?t.jsx(ee,{value:L.uniqueReceived,className:"font-mono tabular-nums",priority:"high"}):t.jsx("span",{className:"opacity-30",children:"â€”"})}),t.jsx(u,{color:"zinc",className:"mb-0.5 sm:mb-1",children:"Unique"})]})]}),t.jsxs("div",{className:"mt-2 packet-byte-chart-height relative",children:[t.jsx("div",{className:"absolute inset-0 flex items-end gap-1 transition-opacity duration-300 "+(c?"opacity-0 pointer-events-none":"opacity-100"),"aria-hidden":c,children:[45,72,33,58,80,42,65,28,55,75,38,62].map((e,s)=>t.jsx("div",{className:"flex-1 bg-subtle-fill rounded-sm animate-pulse",style:{height:`${e}%`}},s))}),t.jsx("div",{className:"h-full transition-opacity duration-300 "+(c?"opacity-100":"opacity-0"),children:t.jsx(He,{packets:l,rangeMinutes:p.minutes,bucketCount:p.buckets})})]})]})}),t.jsxs(ke,{template:"compact",children:[t.jsx(Me,{span:6,lg:4,children:t.jsx(Pe,{value:L.forwarded,receivedCount:L.received,packets:l,rangeMinutes:p.minutes,bucketCount:p.buckets,timeRangeLabel:p.label,icon:t.jsx(Le,{className:"w-4 h-4"}),isLoaded:c})}),t.jsx(Me,{span:6,lg:4,children:t.jsx($e,{value:L.dropped,receivedCount:L.received,packets:l,rangeMinutes:p.minutes,bucketCount:p.buckets,timeRangeLabel:p.label,icon:t.jsx(ve,{className:"w-4 h-4"}),isLoaded:c})}),t.jsx(Me,{span:12,lg:4,children:t.jsx(Ge,{stats:n,receivedBuckets:null==C?void 0:C.received,droppedBuckets:null==C?void 0:C.dropped,forwardedBuckets:null==C?void 0:C.forwarded,bucketDurationSeconds:null==C?void 0:C.bucket_duration_seconds,timeRangeLabel:p.label,isLoaded:c})})]}),t.jsx(bt,{isLoaded:c}),t.jsx(Ve,{}),n&&t.jsx(ke,{template:"auto",children:t.jsx(je,{nodeName:_,repeaterVersion:n.version,coreVersion:n.core_version,localHash:n.local_hash,publicKey:n.public_key})})]})]})}export{At as default};
