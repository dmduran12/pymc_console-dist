var e=Object.defineProperty,t=(t,s,n)=>((t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n)(t,"symbol"!=typeof s?s+"":s,n);import{r as s,j as n,m as a,i,W as r,Z as o}from"./vendor-react-j_fHog8x.js";import{c as l,bc as c,bd as d,be as u,A as m,m as h,aE as x,a6 as p,aN as g,bf as f,bg as v,b3 as b,bh as y,bi as j,aB as N,bj as w,v as C,a_ as k,bk as S,Z as L,F as D,b4 as F,j as R,J as M,bl as H,bm as B,R as P,bn as E,_ as z,L as A,bo as T,bp as $,B as I,o as G,p as O,bq as Z,aH as W}from"./index-ByfjQ7cz.js";import{u as V,G as K,M as _,c as q,E as U,a as X,D as Y,s as J}from"./DeepAnalysisModal-DkutAtt-.js";import{D as Q}from"./DataBox-BqgDuSkt.js";import{h as ee,c as te,D as se}from"./geo-utils-B0aBhZMA.js";import{N as ne,a as ae}from"./badge-colors-YAE4qQ7m.js";import{e as ie,f as re,g as oe}from"./meshcore-tx-constants-BDLT5LMb.js";import{E as le,S as ce,T as de}from"./target-B50Iqnsp.js";import{L as ue}from"./layers-2-j6Agdu.js";import{S as me}from"./search-CEf4Znmm.js";import{S as he}from"./settings-2-wTPPFDHj.js";import{C as xe}from"./chevron-right-BRfzJsRu.js";import{N as pe}from"./network-EWdCxcKC.js";import"./maplibre-gl-b91ci4Kr.js";import"./vendor-core-CmkNwW1A.js";import"./git-branch-72BfdyXq.js";import"./database-CE-Trbqb.js";const ge=l("arrow-right-left",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]),fe=l("focus",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]),ve=l("group",[["path",{d:"M3 7V5c0-1.1.9-2 2-2h2",key:"adw53z"}],["path",{d:"M17 3h2c1.1 0 2 .9 2 2v2",key:"an4l38"}],["path",{d:"M21 17v2c0 1.1-.9 2-2 2h-2",key:"144t0e"}],["path",{d:"M7 21H5c-1.1 0-2-.9-2-2v-2",key:"rtnfgi"}],["rect",{width:"7",height:"5",x:"7",y:"7",rx:"1",key:"1eyiv7"}],["rect",{width:"7",height:"5",x:"10",y:"12",rx:"1",key:"1qlmkx"}]]),be=l("lasso",[["path",{d:"M3.704 14.467A10 8 0 0 1 2 10a10 8 0 0 1 20 0 10 8 0 0 1-10 8 10 8 0 0 1-5.181-1.158",key:"1yant3"}],["path",{d:"M7 22a5 5 0 0 1-2-3.994",key:"1xp6a4"}],["circle",{cx:"5",cy:"16",r:"2",key:"18csp3"}]]),ye=l("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);function je(e){if(null==e)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?`"${t.replace(/"/g,'""')}"`:t}function Ne(e,t){const s=[e.join(",")];for(const n of t)s.push(n.map(je).join(","));return s.join("\n")}function we(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function Ce(e){return!e||e<=0?"":new Date(1e3*e).toISOString()}function ke(e,t){return`${e}-${(new Date).toISOString().replace(/[:.]/g,"-").slice(0,19)}.${t}`}const Se=["hash","prefix","name","nodeClass","communityId","degree","inDegree","outDegree","betweenness","pathDiversity","packetCount","lastSeen","activityLevel","recencyScore","avgRssi","avgSnr","isZeroHop","prefixConfidence","hasCollision","collisionCandidates","isLocal","isHub","isGateway","isBackbone","isMobile","isGhost","isInLoop","latitude","longitude","contactType"];function Le(e){var t,s;return[e.hash,e.prefix,e.name??"",e.nodeClass,e.communityId,e.degree,e.inDegree,e.outDegree,e.betweenness.toFixed(6),e.pathDiversity,e.packetCount,Ce(e.lastSeen),e.activityLevel,e.recencyScore.toFixed(4),(null==(t=e.avgRssi)?void 0:t.toFixed(1))??"",(null==(s=e.avgSnr)?void 0:s.toFixed(1))??"",e.isZeroHop,e.prefixConfidence.toFixed(4),e.hasCollision,e.collisionCandidates,e.isLocal,e.isHub,e.isGateway,e.isBackbone,e.isMobile,e.isGhost,e.isInLoop,e.latitude??"",e.longitude??"",e.contactType??""]}function De(e,t){const s=[];for(const n of e.nodeMetrics.values())!t&&n.isGhost||s.push({hash:n.hash,prefix:n.prefix,name:n.name,nodeClass:n.nodeClass,communityId:n.communityId,degree:n.degree,inDegree:n.inDegree,outDegree:n.outDegree,betweenness:n.betweenness,pathDiversity:n.pathDiversity,packetCount:n.packetCount,lastSeen:n.lastSeen,activityLevel:n.activityLevel,recencyScore:n.recencyScore,avgRssi:n.avgRssi,avgSnr:n.avgSnr,isZeroHop:n.isZeroHop,prefixConfidence:n.prefixConfidence,hasCollision:n.hasCollision,isLocal:n.isLocal,isHub:n.isHub,isGateway:n.isGateway,isBackbone:n.isBackbone,isMobile:n.isMobile,isGhost:n.isGhost,isInLoop:n.isInLoop,latitude:n.latitude,longitude:n.longitude,contactType:n.contactType});return s}const Fe=["fromHash","toHash","key","packetCount","certainCount","avgConfidence","strength","forwardCount","reverseCount","symmetryRatio","dominantDirection","floodCount","directCount","isDirectPathEdge","isZeroHop","isLoopEdge","isCertain","avgRssi","avgSnr","avgRecency","hopDistanceFromLocal","edgeBetweenness","isBackbone"];function Re(e,t){const s=t?e.edges:e.validatedEdges,n=new Set(e.backboneEdges);return s.map(t=>({fromHash:t.fromHash,toHash:t.toHash,key:t.key,packetCount:t.packetCount,certainCount:t.certainCount,avgConfidence:t.avgConfidence,strength:t.strength,forwardCount:t.forwardCount,reverseCount:t.reverseCount,symmetryRatio:t.symmetryRatio,dominantDirection:t.dominantDirection,floodCount:t.floodCount,directCount:t.directCount,isDirectPathEdge:t.isDirectPathEdge,isZeroHop:t.isZeroHop??!1,isLoopEdge:t.isLoopEdge??!1,isCertain:t.isCertain,avgRssi:t.avgRssi??null,avgSnr:t.avgSnr??null,avgRecency:t.avgRecency,hopDistanceFromLocal:t.hopDistanceFromLocal,edgeBetweenness:e.edgeBetweenness.get(t.key)??0,isBackbone:n.has(t.key)}))}const Me=["pathKey","hops","hopCount","healthScore","weakestLinkKey","weakestLinkConfidence","avgEdgeCertainty","observationTrend","alternatePathsCount","estimatedLatencyMs","observationCount","routeType","lastSeen","involvesHub"];function He(e){return[e.pathKey,e.hops.join(">"),e.hops.length,e.healthScore.toFixed(4),e.weakestLinkKey??"",e.weakestLinkConfidence.toFixed(4),e.avgEdgeCertainty.toFixed(4),e.observationTrend.toFixed(4),e.alternatePathsCount,e.estimatedLatencyMs.toFixed(0),e.observationCount,e.routeType,Ce(e.lastSeen),e.involvesHub]}const Be=["nodeHash","nodePrefix","nodeName","networkRole","floodFactor","directFactor","floodSlots","directSlots","trafficIntensity","directNeighborCount","collisionRisk","confidence","adjustment","dataConfidence","observationSymmetry","rationale"];function Pe(e,t,s){const n=s.get(e);return[e,(null==n?void 0:n.prefix)??"",(null==n?void 0:n.name)??"",t.networkRole,t.floodFactor.toFixed(2),t.directFactor.toFixed(2),t.floodSlots,t.directSlots,t.trafficIntensity.toFixed(4),t.directNeighborCount,t.collisionRisk.toFixed(4),t.confidence.toFixed(4),t.adjustment,t.dataConfidence,t.observationSymmetry.toFixed(4),t.rationale]}function Ee(e,t){var s,n;const a=new Set(e.backboneEdges),i=['<?xml version="1.0" encoding="UTF-8"?>','<gexf xmlns="http://gexf.net/1.3" version="1.3">',`  <meta lastmodifieddate="${(new Date).toISOString()}">`,`    <creator>pymc_console v${c}</creator>`,"    <description>MeshCore LoRa Mesh Network Topology</description>","  </meta>",'  <graph defaultedgetype="directed" mode="static">',"","    \x3c!-- Node Attributes --\x3e",'    <attributes class="node">','      <attribute id="n0" title="prefix" type="string"/>','      <attribute id="n1" title="name" type="string"/>','      <attribute id="n2" title="nodeClass" type="string"/>','      <attribute id="n3" title="communityId" type="integer"/>','      <attribute id="n4" title="degree" type="integer"/>','      <attribute id="n5" title="betweenness" type="float"/>','      <attribute id="n6" title="packetCount" type="integer"/>','      <attribute id="n7" title="activityLevel" type="string"/>','      <attribute id="n8" title="isHub" type="boolean"/>','      <attribute id="n9" title="isGateway" type="boolean"/>','      <attribute id="n10" title="isBackbone" type="boolean"/>','      <attribute id="n11" title="isMobile" type="boolean"/>','      <attribute id="n12" title="isGhost" type="boolean"/>','      <attribute id="n13" title="isZeroHop" type="boolean"/>','      <attribute id="n14" title="prefixConfidence" type="float"/>','      <attribute id="n15" title="avgRssi" type="float"/>','      <attribute id="n16" title="avgSnr" type="float"/>',"    </attributes>","","    \x3c!-- Edge Attributes --\x3e",'    <attributes class="edge">','      <attribute id="e0" title="packetCount" type="integer"/>','      <attribute id="e1" title="certainCount" type="integer"/>','      <attribute id="e2" title="confidence" type="float"/>','      <attribute id="e3" title="symmetryRatio" type="float"/>','      <attribute id="e4" title="dominantDirection" type="string"/>','      <attribute id="e5" title="isBackbone" type="boolean"/>','      <attribute id="e6" title="isLoopEdge" type="boolean"/>','      <attribute id="e7" title="isDirectPath" type="boolean"/>','      <attribute id="e8" title="isZeroHop" type="boolean"/>','      <attribute id="e9" title="edgeBetweenness" type="float"/>','      <attribute id="e10" title="floodCount" type="integer"/>','      <attribute id="e11" title="directCount" type="integer"/>',"    </attributes>","","    <nodes>"];for(const r of e.nodeMetrics.values()){if(!t&&r.isGhost)continue;const e=we(r.name??r.prefix);i.push(`      <node id="${we(r.hash)}" label="${e}">`),i.push("        <attvalues>"),i.push(`          <attvalue for="n0" value="${we(r.prefix)}"/>`),i.push(`          <attvalue for="n1" value="${we(r.name??"")}"/>`),i.push(`          <attvalue for="n2" value="${r.nodeClass}"/>`),i.push(`          <attvalue for="n3" value="${r.communityId}"/>`),i.push(`          <attvalue for="n4" value="${r.degree}"/>`),i.push(`          <attvalue for="n5" value="${r.betweenness}"/>`),i.push(`          <attvalue for="n6" value="${r.packetCount}"/>`),i.push(`          <attvalue for="n7" value="${r.activityLevel}"/>`),i.push(`          <attvalue for="n8" value="${r.isHub}"/>`),i.push(`          <attvalue for="n9" value="${r.isGateway}"/>`),i.push(`          <attvalue for="n10" value="${r.isBackbone}"/>`),i.push(`          <attvalue for="n11" value="${r.isMobile}"/>`),i.push(`          <attvalue for="n12" value="${r.isGhost}"/>`),i.push(`          <attvalue for="n13" value="${r.isZeroHop}"/>`),i.push(`          <attvalue for="n14" value="${r.prefixConfidence}"/>`),null!=r.avgRssi&&i.push(`          <attvalue for="n15" value="${r.avgRssi}"/>`),null!=r.avgSnr&&i.push(`          <attvalue for="n16" value="${r.avgSnr}"/>`),i.push("        </attvalues>"),null==r.latitude||null==r.longitude||0===r.latitude&&0===r.longitude||i.push(`        <viz:position x="${r.longitude}" y="${r.latitude}" z="0.0"/>`),i.push("      </node>")}i.push("    </nodes>"),i.push(""),i.push("    <edges>");for(const r of e.validatedEdges){const o=e.nodeMetrics;if(!t&&((null==(s=o.get(r.fromHash))?void 0:s.isGhost)||(null==(n=o.get(r.toHash))?void 0:n.isGhost)))continue;const l=e.edgeBetweenness.get(r.key)??0;i.push(`      <edge id="${we(r.key)}" source="${we(r.fromHash)}" target="${we(r.toHash)}" weight="${r.strength}">`),i.push("        <attvalues>"),i.push(`          <attvalue for="e0" value="${r.packetCount}"/>`),i.push(`          <attvalue for="e1" value="${r.certainCount}"/>`),i.push(`          <attvalue for="e2" value="${r.avgConfidence}"/>`),i.push(`          <attvalue for="e3" value="${r.symmetryRatio}"/>`),i.push(`          <attvalue for="e4" value="${r.dominantDirection}"/>`),i.push(`          <attvalue for="e5" value="${a.has(r.key)}"/>`),i.push(`          <attvalue for="e6" value="${r.isLoopEdge??!1}"/>`),i.push(`          <attvalue for="e7" value="${r.isDirectPathEdge}"/>`),i.push(`          <attvalue for="e8" value="${r.isZeroHop??!1}"/>`),i.push(`          <attvalue for="e9" value="${l}"/>`),i.push(`          <attvalue for="e10" value="${r.floodCount}"/>`),i.push(`          <attvalue for="e11" value="${r.directCount}"/>`),i.push("        </attvalues>"),i.push("      </edge>")}return i.push("    </edges>"),i.push("  </graph>"),i.push("</gexf>"),i.join("\n")}function ze(e,t,s){const n={meta:{exportedAt:(new Date).toISOString(),pymcConsoleVersion:c,nodeCount:e.nodeMetrics.size,edgeCount:e.validatedEdges.length,communityCount:e.communityCount,loopCount:e.loops.length,backboneEdgeCount:e.backboneEdges.length,hubNodes:e.hubNodes.length,gatewayNodes:e.gatewayNodes.length,mobileNodes:e.mobileNodes.length,ghostNodes:e.discoveredNodes.filter(e=>e.isLikelyReal).length},nodes:De(e,t),edges:Re(e,s),pathHealth:e.pathHealth.map(e=>({pathKey:e.pathKey,hops:e.hops,healthScore:e.healthScore,weakestLinkKey:e.weakestLinkKey,weakestLinkConfidence:e.weakestLinkConfidence,avgEdgeCertainty:e.avgEdgeCertainty,observationTrend:e.observationTrend,alternatePathsCount:e.alternatePathsCount,estimatedLatencyMs:e.estimatedLatencyMs,observationCount:e.observationCount,routeType:e.routeType,lastSeen:e.lastSeen,involvesHub:e.involvesHub})),txDelayRecommendations:Array.from(e.txDelayRecommendations.entries()).map(([t,s])=>{var n,a;return{nodeHash:t,nodePrefix:(null==(n=e.nodeMetrics.get(t))?void 0:n.prefix)??"",nodeName:(null==(a=e.nodeMetrics.get(t))?void 0:a.name)??null,networkRole:s.networkRole,floodFactor:s.floodFactor,directFactor:s.directFactor,floodSlots:s.floodSlots,directSlots:s.directSlots,trafficIntensity:s.trafficIntensity,collisionRisk:s.collisionRisk,confidence:s.confidence,adjustment:s.adjustment,dataConfidence:s.dataConfidence,rationale:s.rationale}}),loops:e.loops.map(e=>({id:e.id,nodes:e.nodes,edgeKeys:e.edgeKeys,size:e.size,avgCertainCount:e.avgCertainCount,minCertainCount:e.minCertainCount,includesLocal:e.includesLocal,strength:e.strength})),disambiguationStats:{totalPrefixes:e.disambiguationStats.totalPrefixes,unambiguousPrefixes:e.disambiguationStats.unambiguousPrefixes,collisionPrefixes:e.disambiguationStats.collisionPrefixes,collisionRate:e.disambiguationStats.collisionRate,avgConfidence:e.disambiguationStats.avgConfidence},viterbiStats:{totalPaths:e.viterbiStats.totalPaths,pathsWithGhosts:e.viterbiStats.pathsWithGhosts,avgPathConfidence:e.viterbiStats.avgPathConfidence,tracePacketsProcessed:e.viterbiStats.tracePacketsProcessed,pathPacketsProcessed:e.viterbiStats.pathPacketsProcessed,distantEdgesDiscovered:e.viterbiStats.distantEdgesDiscovered,duplicateGroupsFound:e.viterbiStats.duplicateGroupsFound,echolocationEdgesInferred:e.viterbiStats.echolocationEdgesInferred}};return JSON.stringify(n,null,2)}function Ae(e,t){const s=t.includeGhosts??!0,n=t.includeWeakEdges??!1;switch(t.format){case"csv":{let a,i;switch(t.dataset){case"nodes":case"full":default:a=function(e,t){const s=[];for(const n of e.nodeMetrics.values())!t&&n.isGhost||s.push(Le(n));return Ne(Se,s)}(e,s),i="mesh-nodes";break;case"edges":a=function(e,t){const s=t?e.edges:e.validatedEdges,n=new Set(e.backboneEdges),a=s.map(t=>function(e,t,s){var n,a;return[e.fromHash,e.toHash,e.key,e.packetCount,e.certainCount,e.avgConfidence.toFixed(4),e.strength.toFixed(4),e.forwardCount,e.reverseCount,e.symmetryRatio.toFixed(4),e.dominantDirection,e.floodCount,e.directCount,e.isDirectPathEdge,e.isZeroHop??!1,e.isLoopEdge??!1,e.isCertain,(null==(n=e.avgRssi)?void 0:n.toFixed(1))??"",(null==(a=e.avgSnr)?void 0:a.toFixed(1))??"",e.avgRecency.toFixed(4),e.hopDistanceFromLocal,(t.get(e.key)??0).toFixed(6),s.has(e.key)]}(t,e.edgeBetweenness,n));return Ne(Fe,a)}(e,n),i="mesh-edges";break;case"pathHealth":a=function(e){const t=e.pathHealth.map(He);return Ne(Me,t)}(e),i="mesh-path-health";break;case"txDelay":a=function(e){const t=[];for(const[s,n]of e.txDelayRecommendations)t.push(Pe(s,n,e.nodeMetrics));return Ne(Be,t)}(e),i="mesh-tx-delay"}return{content:a,filename:ke(i,"csv"),mimeType:"text/csv"}}case"gexf":return{content:Ee(e,s),filename:ke("mesh-topology","gexf"),mimeType:"application/xml"};default:return{content:ze(e,s,n),filename:ke("mesh-topology","json"),mimeType:"application/json"}}}function Te(e,t,s=1){const{n:n,adjList:a,totalWeight:i,degree:r}=e;if(0===i)return!1;const o=2*i,l=new Float64Array(n);for(let u=0;u<n;u++)l[t[u]]+=r[u];let c=!1,d=!0;for(;d;){d=!1;for(let e=0;e<n;e++){const n=t[e],u=r[e];if(0===u)continue;const m=new Map;for(const{j:s,w:i}of a[e]){const e=t[s];m.set(e,(m.get(e)??0)+i)}const h=-(m.get(n)??0)/i+s*(u*(l[n]-u))/(o*i);let x=n,p=0;for(const[e,t]of m){if(e===n)continue;const a=h+(t/i-s*(u*l[e])/(o*i));a>p+1e-7&&(p=a,x=e)}x!==n&&(l[n]-=u,l[x]+=u,t[e]=x,d=!0,c=!0)}}return c}function $e(e,t){const{n:s,adjList:n}=e,a=new Set;for(let h=0;h<s;h++)a.add(t[h]);const i=Array.from(a).sort((e,t)=>e-t),r=new Map;for(let h=0;h<i.length;h++)r.set(i[h],h);const o=i.length,l=new Int32Array(s);for(let h=0;h<s;h++)l[h]=r.get(t[h]);const c=new Map,d=new Float64Array(o);let u=0;for(let h=0;h<s;h++){const e=l[h];for(const{j:t,w:s}of n[h]){const n=l[t];if(e===n)continue;const a=e<=n?`${e}-${n}`:`${n}-${e}`;c.set(a,(c.get(a)??0)+s)}}const m=Array.from({length:o},()=>[]);for(const[h,x]of c){const[e,t]=h.split("-").map(Number),s=x/2;m[e].push({j:t,w:s}),m[t].push({j:e,w:s}),d[e]+=s,d[t]+=s,u+=s}return{newGraph:{n:o,adjList:m,totalWeight:u,degree:Array.from(d)},mapping:l}}function Ie(e,t,s){const n=(null==s?void 0:s.resolution)??1,a=(null==s?void 0:s.kWeight)??1,i=t.length;if(0===i)return{communities:new Map,numCommunities:0,modularity:0,passes:0};if(1===i)return{communities:new Map([[t[0],0]]),numCommunities:1,modularity:0,passes:0};const{graph:r}=function(e,t,s=1){const n=t.length,a=new Map;for(let l=0;l<n;l++)a.set(t[l],l);const i=Array.from({length:n},()=>[]),r=new Array(n).fill(0);let o=0;for(const l of e){const e=a.get(l.fromHash),t=a.get(l.toHash);if(void 0===e||void 0===t)continue;if(e===t)continue;const n=Math.max(.01,(l.certainCount+1)*l.avgConfidence*l.strength),c=1===s?n:Math.pow(n,s);i[e].push({j:t,w:c}),i[t].push({j:e,w:c}),r[e]+=c,r[t]+=c,o+=c}return{graph:{n:n,adjList:i,totalWeight:o,degree:r},hashToIdx:a}}(e,t,a);let o=r,l=new Int32Array(i);for(let v=0;v<i;v++)l[v]=v;const c=[];let d=0;for(;d<10&&Te(o,l,n);){d++;const{newGraph:e,mapping:t}=$e(o,l);if(c.push(t),e.n>=o.n)break;o=e,l=new Int32Array(e.n);for(let s=0;s<e.n;s++)l[s]=s}const u=new Int32Array(i);for(let v=0;v<i;v++)u[v]=v;for(const v of c)for(let e=0;e<i;e++)u[e]=v[u[e]];for(let v=0;v<i;v++)u[v]=l[u[v]];const m=new Set;for(let v=0;v<i;v++)m.add(u[v]);const h=Array.from(m).sort((e,t)=>e-t),x=new Map;for(let v=0;v<h.length;v++)x.set(h[v],v);const p=new Map;for(let v=0;v<i;v++)p.set(t[v],x.get(u[v]));const g=new Int32Array(i);for(let v=0;v<i;v++)g[v]=x.get(u[v]);const f=function(e,t,s=1){const{n:n,adjList:a,totalWeight:i,degree:r}=e;if(0===i)return 0;const o=2*i;let l=0;for(let c=0;c<n;c++)for(const{j:e,w:n}of a[c])t[c]===t[e]&&(l+=n-s*(r[c]*r[e])/o);return l/o}(r,g,n);return{communities:p,numCommunities:h.length,modularity:f,passes:d}}const Ge={7:-124,8:-127,9:-130,10:-133,11:-135.5,12:-137},Oe={62.5:3,125:0,250:-3,500:-6},Ze={5:0,6:-.6,7:-1.1,8:-1.5};function We(e,t){if(e<=0)return 0;const s=1e6*t;return 20*Math.log10(e)+20*Math.log10(s)+20*Math.log10(4*Math.PI/299792458)}function Ve(e,t,s=5){return(Ge[e]??Ge[12])+(Oe[t]??0)+(Ze[s]??0)}function Ke(e,t=6){return 10*Math.log10(e)-174+t}function _e(e){return e>=20?"excellent":e>=10?"good":e>=3?"fair":e>=0?"marginal":"critical"}function qe(e){return e>=15?"anomalous-good":e>=5?"better":e>=-5?"expected":e>=-20?"worse":"anomalous-bad"}function Ue(e,t,s,n,a){const i=n.tx_power??22,r=n.spreading_factor??12,o=n.coding_rate??5,l=n.frequency??0,c=l>1e5?l/1e6:l||915,d=n.bandwidth??0,u=d>1e3?d/1e3:d||125,m=(null==a?void 0:a.sensitivityOverrideDbm)??Ve(r,u,o);let h=null,x=null;t&&s&&ee(t.latitude??void 0,t.longitude??void 0)&&ee(s.latitude??void 0,s.longitude??void 0)&&(h=te(t.latitude,t.longitude,s.latitude,s.longitude),x=h/1e3);let p=null,g=null;null!=h&&h>0&&(p=We(h,c),g=i+2.15+2.15-p);const f=e.avgRssi??null,v=e.avgSnr??null;let b=null,y=null;null!=f&&null!=g&&(b=f-g,y=qe(b));let j=null,N=null;null!=f&&(j=f-m,N=_e(j));const w=null!=f,C="anomalous-good"===y||"anomalous-bad"===y;return{edgeKey:e.key,fromHash:e.fromHash,toHash:e.toHash,distanceM:h,distanceKm:x,fsplDb:p,theoreticalRxPowerDbm:g,observedRssiDbm:f,observedSnrDb:v,deviationDb:b,deviationClass:y,marginDb:j,marginClass:N,sensitivityDbm:m,txPowerDbm:i,frequencyMhz:c,spreadingFactor:r,bandwidthKhz:u,noiseFloorDbm:null,isZeroHop:e.isZeroHop??!1,isTraceEstimated:!1,hasData:w,isAnomalous:C}}function Xe(e,t,s,n,a=22,i){const r=e.traceQuality;if(!r)return null;let o=null;if(o=null!=r.forwardSnr&&null!=r.reverseSnr?Math.min(r.forwardSnr,r.reverseSnr):r.forwardSnr??r.reverseSnr,null==o)return null;const l=n.spreading_factor??12,c=n.coding_rate??5,d=n.bandwidth??0,u=d>1e3?d/1e3:d||125,m=1e3*u,h=n.frequency??0,x=h>1e5?h/1e6:h||915,p=(null==i?void 0:i.sensitivityOverrideDbm)??Ve(l,u,c),g=(null==i?void 0:i.observedNoiseFloorDbm)??Ke(m),f=g+o;let v=null,b=null;t&&s&&ee(t.latitude??void 0,t.longitude??void 0)&&ee(s.latitude??void 0,s.longitude??void 0)&&(v=te(t.latitude,t.longitude,s.latitude,s.longitude),b=v/1e3);let y=null,j=null;null!=v&&v>0&&(y=We(v,x),j=a+2.15+2.15-y);let N=null,w=null;null!=j&&(N=f-j,w=qe(N));const C=f-p,k=_e(C);return{edgeKey:e.key,fromHash:e.fromHash,toHash:e.toHash,distanceM:v,distanceKm:b,fsplDb:y,theoreticalRxPowerDbm:j,observedRssiDbm:f,observedSnrDb:o,deviationDb:N,deviationClass:w,marginDb:C,marginClass:k,sensitivityDbm:p,noiseFloorDbm:g,txPowerDbm:a,frequencyMhz:x,spreadingFactor:l,bandwidthKhz:u,isZeroHop:!1,isTraceEstimated:!0,hasData:!0,isAnomalous:"anomalous-good"===w||"anomalous-bad"===w}}const Ye={"anomalous-good":"#2DD4BF",better:"#34D399",expected:"#9CA3AF",worse:"#FB923C","anomalous-bad":"#EF4444"},Je={excellent:"#34D399",good:"#A3E635",fair:"#FBBF24",marginal:"#FB923C",critical:"#EF4444"};function Qe(e,t="margin"){return e.hasData?"deviation"===t?e.deviationClass?Ye[e.deviationClass]:"#505058":e.marginClass?Je[e.marginClass]:"#505058":"#505058"}function et(e,t=.5,s=4){return null==e.marginDb?t:t+Math.max(0,Math.min(1,e.marginDb/40))*(s-t)}let tt=0;function st(){return`ta-${++tt}-${Date.now()}`}function nt(e){return{standard:0,ghost:1,mobile:2,neighbor:3,backbone:4,gateway:5,hub:6,local:7}[e]??0}class at{constructor(e=200){t(this,"prevSnapshot",null),t(this,"log",[]),t(this,"maxLog"),this.maxLog=e}update(e,t){const s=function(e){const t=new Set;for(const o of e.edges)t.add(o.key);const s=new Map,n=new Map,a=new Map,i=new Set;for(const[o,l]of e.nodeMetrics)s.set(o,l.betweenness),n.set(o,l.communityId),a.set(o,l.nodeClass),i.add(o);const r=new Set;for(const o of e.discoveredNodes)o.isLikelyReal&&r.add(o.prefix);return{timestamp:Date.now(),edgeKeys:t,betweenness:s,communities:n,nodeClasses:a,ghostPrefixes:r,nodeHashes:i}}(e);if(!this.prevSnapshot)return this.prevSnapshot=s,{anomalies:[],categoryCounts:{"edge-appeared":0,"edge-disappeared":0,"ghost-appeared":0,"ghost-disappeared":0,"betweenness-shift":0,"community-change":0,"class-change":0,"node-appeared":0,"node-disappeared":0},severityCounts:{info:0,warning:0,critical:0},totalCount:0,timestamp:Date.now()};const n=function(e,t,s){const n=Date.now(),a=[],i=e=>(null==s?void 0:s.get(e))??null;for(const d of t.edgeKeys)if(!e.edgeKeys.has(d)){const[e,t]=d.split("-"),s=i(e)??(null==e?void 0:e.slice(0,6)),r=i(t)??(null==t?void 0:t.slice(0,6));a.push({id:st(),detectedAt:n,category:"edge-appeared",severity:"info",description:`New edge: ${s} ↔ ${r}`,edgeKey:d})}for(const d of e.edgeKeys)if(!t.edgeKeys.has(d)){const[e,t]=d.split("-"),s=i(e)??(null==e?void 0:e.slice(0,6)),r=i(t)??(null==t?void 0:t.slice(0,6));a.push({id:st(),detectedAt:n,category:"edge-disappeared",severity:"warning",description:`Edge lost: ${s} ↔ ${r}`,edgeKey:d})}for(const d of t.nodeHashes)if(!e.nodeHashes.has(d)){const e=i(d);a.push({id:st(),detectedAt:n,category:"node-appeared",severity:"info",description:`Node appeared: ${e??d.slice(0,8)}`,nodeHash:d,nodeName:e??void 0})}for(const d of e.nodeHashes)if(!t.nodeHashes.has(d)){const e=i(d);a.push({id:st(),detectedAt:n,category:"node-disappeared",severity:"warning",description:`Node dropped: ${e??d.slice(0,8)}`,nodeHash:d,nodeName:e??void 0})}for(const d of t.ghostPrefixes)e.ghostPrefixes.has(d)||a.push({id:st(),detectedAt:n,category:"ghost-appeared",severity:"info",description:`Ghost node discovered: ${d.toUpperCase()}`});for(const d of e.ghostPrefixes)t.ghostPrefixes.has(d)||a.push({id:st(),detectedAt:n,category:"ghost-disappeared",severity:"info",description:`Ghost node resolved: ${d.toUpperCase()}`});for(const[d,u]of t.betweenness){const t=e.betweenness.get(d);if(void 0===t)continue;const s=Math.abs(u-t);if(s>=.15){const e=i(d),r=u>t?"increased":"decreased";a.push({id:st(),detectedAt:n,category:"betweenness-shift",severity:s>=.3?"critical":"warning",description:`${e??d.slice(0,8)} betweenness ${r}: ${t.toFixed(3)} → ${u.toFixed(3)}`,nodeHash:d,nodeName:e??void 0,previousValue:t,currentValue:u})}}for(const[d,u]of t.communities){const t=e.communities.get(d);if(void 0!==t&&u!==t){const e=i(d);a.push({id:st(),detectedAt:n,category:"community-change",severity:"info",description:`${e??d.slice(0,8)} moved: community #${t} → #${u}`,nodeHash:d,nodeName:e??void 0,previousValue:t,currentValue:u})}}for(const[d,u]of t.nodeClasses){const t=e.nodeClasses.get(d);if(void 0!==t&&u!==t){const e=i(d),s=nt(u)>nt(t);a.push({id:st(),detectedAt:n,category:"class-change",severity:s?"warning":"info",description:`${e??d.slice(0,8)} ${s?"promoted":"changed"}: ${t} → ${u}`,nodeHash:d,nodeName:e??void 0,previousValue:t,currentValue:u})}}const r={},o={},l=["edge-appeared","edge-disappeared","ghost-appeared","ghost-disappeared","betweenness-shift","community-change","class-change","node-appeared","node-disappeared"],c=["info","warning","critical"];for(const d of l)r[d]=0;for(const d of c)o[d]=0;for(const d of a)r[d.category]++,o[d.severity]++;return a.sort((e,t)=>t.detectedAt-e.detectedAt),{anomalies:a,categoryCounts:r,severityCounts:o,totalCount:a.length,timestamp:n}}(this.prevSnapshot,s,t);this.prevSnapshot=s;try{!function(e,t){const s=t.edgeMap,n=t.nodeMetrics,a=new Set(t.backboneEdges??[]);for(const i of e){if(i.edgeKey&&("edge-appeared"===i.category||"edge-disappeared"===i.category)){const e=null==s?void 0:s.get(i.edgeKey),t=i.edgeKey.split("-"),r=t[0],o=t[1],l=r?null==n?void 0:n.get(r):void 0,c=o?null==n?void 0:n.get(o):void 0;i.edgeDetail=e?{fromName:(null==l?void 0:l.name)??null,toName:(null==c?void 0:c.name)??null,fromClass:(null==l?void 0:l.nodeClass)??null,toClass:(null==c?void 0:c.nodeClass)??null,packetCount:e.packetCount,confidence:e.avgConfidence,symmetryRatio:e.symmetryRatio,isBackbone:a.has(i.edgeKey),isLoop:e.isLoopEdge??!1,isZeroHop:e.isZeroHop??!1,isDirectPath:e.isDirectPathEdge,avgRssi:e.avgRssi??null,avgSnr:e.avgSnr??null,fromBetweenness:(null==l?void 0:l.betweenness)??null,toBetweenness:(null==c?void 0:c.betweenness)??null}:{fromName:(null==l?void 0:l.name)??null,toName:(null==c?void 0:c.name)??null,fromClass:(null==l?void 0:l.nodeClass)??null,toClass:(null==c?void 0:c.nodeClass)??null,packetCount:0,confidence:0,symmetryRatio:0,isBackbone:!1,isLoop:!1,isZeroHop:!1,isDirectPath:!1,avgRssi:null,avgSnr:null,fromBetweenness:(null==l?void 0:l.betweenness)??null,toBetweenness:(null==c?void 0:c.betweenness)??null}}if(i.nodeHash){const e=null==n?void 0:n.get(i.nodeHash);e&&(i.nodeDetail=it(e))}}}(n.anomalies,e)}catch(a){}return this.log.unshift(...n.anomalies),this.log.length>this.maxLog&&(this.log.length=this.maxLog),n}getLog(){return this.log}getFiltered(e){const t=Date.now();return this.log.filter(s=>!(e.category&&s.category!==e.category||e.severity&&s.severity!==e.severity||e.nodeHash&&s.nodeHash!==e.nodeHash||e.maxAge&&t-s.detectedAt>e.maxAge))}clear(){this.log=[],this.prevSnapshot=null}}function it(e){return{nodeClass:e.nodeClass,degree:e.degree,betweenness:e.betweenness,activityLevel:e.activityLevel,isZeroHop:e.isZeroHop,avgRssi:e.avgRssi,avgSnr:e.avgSnr,communityId:e.communityId,packetCount:e.packetCount,connectionCount:e.degree}}function rt(e){if(e.length<2)return 0;const t=e.length;let s=0,n=0,a=0,i=0;for(let o=0;o<t;o++)s+=o,n+=e[o],a+=o*e[o],i+=o*o;const r=t*i-s*s;return 0===r?0:(t*a-s*n)/r}const ot=.15;function lt(e,t,s){if(e.observationCount<5)return null;const n=[];let a=0;e.observationTrend<0&&(a=Math.abs(e.observationTrend),n.push({name:"Declining usage",description:e.observationTrend<-.3?"Traffic rapidly declining":"Traffic gradually declining",score:a,weight:.35}));const i=1-Math.min(1,e.avgEdgeCertainty);i>.3&&n.push({name:"Weak link certainty",description:e.weakestLinkKey?`Weakest: ${e.weakestLinkConfidence<.3?"very low":"low"} confidence`:`Average certainty: ${(100*e.avgEdgeCertainty).toFixed(0)}%`,score:i,weight:.3});let r=0;0===e.alternatePathsCount?(r=1,n.push({name:"No alternate paths",description:"Single route to destination — no failover available",score:r,weight:.2})):1===e.alternatePathsCount&&(r=.5,n.push({name:"Limited redundancy",description:"Only 1 alternate path available",score:r,weight:.2}));let o=0;if(e.weakestLinkKey){const a=t.get(e.weakestLinkKey);if(null!=(null==a?void 0:a.avgRssi)){const e=a.avgRssi-s;e<3?(o=1,n.push({name:"Signal near sensitivity",description:`Weakest link: ${e.toFixed(1)} dB margin (< 3 dB)`,score:o,weight:ot})):e<10&&(o=1-(e-3)/7,n.push({name:"Low signal margin",description:`Weakest link: ${e.toFixed(1)} dB margin`,score:o,weight:ot}))}}const l=.35*a+.3*i+.2*r+o*ot;if(l<.35)return null;let c,d;return l>=.75?(c="critical",d="imminent"):l>=.55?(c="high",d="near-term"):(c="moderate",d="watch"),{pathKey:e.pathKey,hops:e.hops,riskScore:Math.round(100*l)/100,riskLevel:c,factors:n,weakestEdgeKey:e.weakestLinkKey,healthScore:e.healthScore,observationTrend:e.observationTrend,alternatePathsCount:e.alternatePathsCount,urgency:d}}let ct=100;function dt(){return++ct}const ut="meshgraph-panel-";function mt(e){try{const t=localStorage.getItem(ut+e);return t?JSON.parse(t):null}catch{return null}}function ht({id:e,title:t,icon:a,open:i,onClose:r,defaultPosition:o,defaultSize:l,minSize:c={width:180,height:120},maxSize:d,autoHeight:u=!1,headerActions:g,children:f}){const v=V(),b=s.useRef(null),y=s.useRef(null),j=s.useMemo(()=>{const t=mt(e);return t?{x:t.x,y:t.y,w:t.w,h:u?l.height:t.h,minimized:t.minimized}:{x:o.x,y:o.y,w:l.width,h:l.height,minimized:!1}},[e]),[N,w]=s.useState({w:j.w,h:j.h}),[C,k]=s.useState(j.minimized),[S,L]=s.useState(()=>dt()),[D,F]=s.useState({x:j.x,y:j.y});s.useLayoutEffect(()=>{const t=b.current;if(!i||!t)return;const s=t.getBoundingClientRect();if(s.width<1||s.height<1)return;const n=mt(e),a=(r=(null==n?void 0:n.x)??j.x,o=(null==n?void 0:n.y)??j.y,l=(null==n?void 0:n.w)??N.w,c=s.width,d=s.height,{x:Math.max(8,Math.min(r,Math.max(8,c-l-8))),y:Math.max(8,Math.min(o,Math.max(8,d-36)))});var r,o,l,c,d;F(a)},[i,e]);const[R,M]=s.useState(!1),H=s.useRef({startX:0,startY:0,startW:0,startH:0,edge:""}),B=s.useRef(),P=s.useCallback(()=>{B.current&&clearTimeout(B.current),B.current=setTimeout(()=>{const t=y.current;if(!t)return;const s=window.getComputedStyle(t),n=new DOMMatrix(s.transform);!function(e,t){try{localStorage.setItem(ut+e,JSON.stringify(t))}catch{}}(e,{x:n.m41,y:n.m42,w:N.w,h:N.h,minimized:C})},300)},[e,N.w,N.h,C]);s.useEffect(()=>{P()},[N,C,P]);const E=s.useCallback(()=>{L(dt())},[]),z=s.useCallback(()=>{k(e=>!e)},[]),A=s.useCallback((e,t)=>{e.preventDefault(),e.stopPropagation(),M(!0),H.current={startX:e.clientX,startY:e.clientY,startW:N.w,startH:N.h,edge:t},E();const s=e=>{const{startX:t,startY:s,startW:n,startH:a,edge:i}=H.current,r=e.clientX-t,o=e.clientY-s;let l=n,u=a;"e"!==i&&"se"!==i||(l=Math.max(c.width,n+r),d&&(l=Math.min(d.width,l))),"s"!==i&&"se"!==i||(u=Math.max(c.height,a+o),d&&(u=Math.min(d.height,u))),w({w:l,h:u})},n=()=>{M(!1),window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",n)};window.addEventListener("pointermove",s),window.addEventListener("pointerup",n)},[N,c,d,E]);return n.jsx("div",{ref:b,className:"absolute inset-0 pointer-events-none",style:{zIndex:S},children:n.jsx(m,{children:i&&n.jsxs(h.div,{ref:y,drag:!R,dragControls:v,dragConstraints:b,dragElastic:.05,dragMomentum:!1,dragListener:!1,initial:{opacity:0,scale:.96,x:D.x,y:D.y},animate:{opacity:1,scale:1,x:D.x,y:D.y},exit:{opacity:0,scale:.96},transition:{duration:.15},onPointerDown:E,className:"absolute top-0 left-0 pointer-events-auto",style:{width:N.w,touchAction:"none"},children:[n.jsxs("div",{className:"surface-elevated radius-inset shadow-xl overflow-hidden flex flex-col",style:{maxHeight:C?void 0:u?"80vh":N.h},children:[n.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1.5 border-b border-edge-subtle cursor-grab active:cursor-grabbing select-none shrink-0",onPointerDown:e=>{E(),v.start(e)},children:[n.jsx(K,{className:"w-3 h-3 text-fg-muted/50 shrink-0"}),a&&n.jsx("span",{className:"text-fg-muted shrink-0 [&>svg]:w-3 [&>svg]:h-3",children:a}),n.jsx("span",{className:"text-[11px] font-medium text-fg-primary flex-1 truncate",children:t}),g,n.jsx("button",{onClick:z,className:"p-0.5 radius-badge hover-bg transition-base",title:C?"Expand":"Minimize",children:C?n.jsx(_,{className:"w-2.5 h-2.5 text-fg-muted"}):n.jsx(x,{className:"w-2.5 h-2.5 text-fg-muted"})}),n.jsx("button",{onClick:r,className:"p-0.5 radius-badge hover-bg transition-base",title:"Close",children:n.jsx(p,{className:"w-2.5 h-2.5 text-fg-muted"})})]}),n.jsx(m,{initial:!1,children:!C&&n.jsx(h.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.15},className:"overflow-hidden",children:n.jsx("div",{className:"overflow-y-auto",style:{maxHeight:u?"70vh":void 0},children:f})})})]}),!C&&!u&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute top-0 -right-1 w-2 h-full cursor-ew-resize",onPointerDown:e=>A(e,"e")}),n.jsx("div",{className:"absolute -bottom-1 left-0 w-full h-2 cursor-ns-resize",onPointerDown:e=>A(e,"s")}),n.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 cursor-nwse-resize",onPointerDown:e=>A(e,"se"),children:n.jsxs("svg",{className:"w-full h-full text-fg-muted/30",viewBox:"0 0 12 12",children:[n.jsx("path",{d:"M10 2 L10 10 L2 10",fill:"none",stroke:"currentColor",strokeWidth:"1.5"}),n.jsx("path",{d:"M7 5 L7 7 L5 7",fill:"none",stroke:"currentColor",strokeWidth:"1"})]})})]})]})})})}const xt=800,pt={critical:[S.red,S.red],poor:[S.orange,S.orange],fair:[S.amber,S.amber],good:[S.green,S.green],excellent:[S.blue,S.blue]},gt={active:1,recent:.85,stale:.45,inactive:.25},ft=[S.purple,S.green,S.amber,S.red,S.blue,S.pink,S.teal,S.orange],vt=[S.purple,S.green,S.amber,S.red,S.blue,S.pink,S.teal,S.orange];function bt(e,t,s){const n=(e,t)=>parseInt(e.slice(1+2*t,3+2*t),16);return`#${[0,1,2].map(a=>{return(i=a,Math.round(n(e,i)*s+n(t,i)*(1-s))).toString(16).padStart(2,"0");var i}).join("")}`}const yt={zeroHop:bt(S.amber,L[500],.55),directPath:bt(S.teal,L[500],.55),loop:bt(S.purple,L[500],.55),backbone:L[300],standard:L[500],standardDim:L[600],ghost:L[600]},jt={zeroHop:bt(S.amber,L[700],.5),directPath:bt(S.teal,L[700],.5),loop:bt(S.purple,L[700],.5),backbone:L[700],standard:L[400],standardDim:L[300],ghost:L[400]},Nt=!1,wt=!0,Ct=!0,kt=!0,St=!0,Lt=!0,Dt={local:S.amber,hub:S.purple,gateway:S.blue,backbone:S.green,neighbor:S.pink,mobile:S.orange,ghost:L[400],standard:L[300]},Ft={local:S.amber,hub:S.purple,gateway:S.blue,backbone:S.green,neighbor:S.pink,mobile:S.orange,ghost:L[500],standard:L[600]},Rt={local:"Your repeater — the home node running this dashboard",hub:"≥10% of last-hop traffic — dominant forwarder for your local node",gateway:"7-10% of last-hop traffic — significant relay node",backbone:"High betweenness centrality — critical path node connecting clusters",neighbor:"Zero-hop direct RF contact — no intermediate forwarders",mobile:"High path volatility — node appears and disappears frequently",ghost:"Unresolved prefix inferred by Viterbi HMM from path patterns",standard:"<7% of traffic — normal mesh participant"};function Mt(e){const t=e.replace("#","");return[parseInt(t.slice(0,2),16),parseInt(t.slice(2,4),16),parseInt(t.slice(4,6),16)]}function Ht(e,t,s){const[n,a,i]=Mt(e),[r,o,l]=Mt(t),c=Math.max(0,Math.min(1,s)),d=Math.round(n*c+r*(1-c)),u=Math.round(a*c+o*(1-c)),m=Math.round(i*c+l*(1-c));return`#${d.toString(16).padStart(2,"0")}${u.toString(16).padStart(2,"0")}${m.toString(16).padStart(2,"0")}`}function Bt(e,t){return e.isZeroHop?"zero-hop":e.isDirectPathEdge?"direct-path":e.isLoopEdge?"loop":t.has(e.key)?"backbone":"standard"}function Pt(e,t,s){const n=s?yt:jt;switch(e){case"zero-hop":return n.zeroHop;case"direct-path":return n.directPath;case"loop":return n.loop;case"backbone":return n.backbone;case"ghost":return n.ghost;default:return t>=.7?n.standard:n.standardDim}}const Et={"zero-hop":"Zero-Hop (Direct RF)","direct-path":"Direct Path (Unicast)",loop:"Redundant Loop",backbone:"Backbone",standard:"Standard",ghost:"Ghost (Inferred)"},zt={"zero-hop":"Direct radio contact — no intermediate forwarders in path","direct-path":"Unicast-routed edge — verified via DIRECT route type packets",loop:"Redundant path — alternate route between the same endpoints exists",backbone:"High betweenness centrality — critical traffic flow edge",standard:"Normal mesh edge with moderate-to-high confidence",ghost:"Inferred connection from Viterbi HMM ghost node analysis"},At=s.memo(function({timeline:e}){const t=e.buckets;if(t.length<2)return null;const[s,a]=e.rssiRange,i=Math.max(1,a-s),[r,o]=e.snrRange,l=Math.max(1,o-r),c=198/(t.length-1),d=t.map((e,t)=>{const n=1+t*c,a=1+34*(1-(e.avgRssi-s)/i);return`${n.toFixed(1)},${a.toFixed(1)}`}).join(" "),u=t.map((e,t)=>{const s=1+t*c,n=1+34*(1-(e.avgSnr-r)/l);return`${s.toFixed(1)},${n.toFixed(1)}`}).join(" "),m=e.rssiTrend>.1?"↑":e.rssiTrend<-.1?"↓":"→",h=e.snrTrend>.1?"↑":e.snrTrend<-.1?"↓":"→",x=e.rssiTrend>.1?"#34D399":e.rssiTrend<-.1?"#EF4444":"#9CA3AF",p=e.snrTrend>.1?"#34D399":e.snrTrend<-.1?"#EF4444":"#9CA3AF",g=(e.timeSpanMs/36e5).toFixed(1),f=function(e){const t=e.rssiTrend<-.1,s=e.snrTrend<-.1,n=e.rssiTrend>.1,a=e.snrTrend>.1,i=e.rssiRange[1]-e.rssiRange[0],r=e.snrRange[1]-e.snrRange[0];return t&&s?{text:"Both RSSI and SNR declining — possible antenna degradation or increasing distance",color:"#EF4444"}:s&&!t?{text:"SNR declining while RSSI stable — likely RF interference or noise floor increase",color:"#F97316"}:t&&!s?{text:"RSSI declining while SNR stable — possible path obstruction or power change",color:"#F97316"}:n&&a?{text:"Signal improving — conditions favorable or antenna adjustment working",color:"#34D399"}:i>15||r>10?{text:"High signal variance — intermittent obstruction or multipath fading",color:"#FBBF24"}:{text:"Signal stable — no significant degradation detected",color:"#9CA3AF"}}(e);return n.jsxs("div",{className:"mt-2 pt-2 border-t border-edge-subtle/50",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx(M,{content:n.jsxs("div",{className:"max-w-xs space-y-1.5",children:[n.jsx("div",{className:"font-semibold text-fg-primary",children:"Signal Quality Over Time"}),n.jsx("div",{className:"text-fg-secondary text-[11px]",children:"Tracks RSSI (signal power) and SNR (signal-to-noise ratio) for zero-hop packets received directly from this neighbor. Reveals weather effects, interference, and antenna degradation."}),n.jsxs("div",{className:"pt-1 border-t border-edge-subtle/30 space-y-0.5 font-mono text-[10px]",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Samples"}),n.jsx("span",{className:"text-fg-primary tabular-nums",children:e.totalSamples})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Time span"}),n.jsxs("span",{className:"text-fg-primary tabular-nums",children:[g,"h"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Avg RSSI"}),n.jsxs("span",{className:"text-fg-primary tabular-nums",children:[e.avgRssi.toFixed(1)," dBm"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Avg SNR"}),n.jsxs("span",{className:"text-fg-primary tabular-nums",children:[e.avgSnr.toFixed(1)," dB"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"RSSI trend"}),n.jsxs("span",{className:"tabular-nums",style:{color:x},children:[e.rssiTrend>0?"+":"",e.rssiTrend.toFixed(3)," dBm/bucket"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"SNR trend"}),n.jsxs("span",{className:"tabular-nums",style:{color:p},children:[e.snrTrend>0?"+":"",e.snrTrend.toFixed(3)," dB/bucket"]})]})]}),n.jsxs("div",{className:"text-[10px] text-fg-muted italic",children:["Trend is linear regression slope across ",t.length," time buckets. ↑ = improving, ↓ = degrading, → = stable."]})]}),children:n.jsx("span",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Signal Timeline"})}),n.jsxs("span",{className:"text-[9px] text-fg-muted tabular-nums",children:[e.totalSamples," samples · ",g,"h"]})]}),n.jsxs("svg",{viewBox:"0 0 200 36",className:"w-full h-9",preserveAspectRatio:"none",children:[n.jsx("polyline",{points:d,fill:"none",stroke:"#60A5FA",strokeWidth:"1.5",strokeLinejoin:"round",strokeLinecap:"round",opacity:"0.8"}),n.jsx("polyline",{points:u,fill:"none",stroke:"#34D399",strokeWidth:"1",strokeLinejoin:"round",strokeLinecap:"round",opacity:"0.5",strokeDasharray:"3 2"})]}),n.jsxs("div",{className:"flex items-center justify-between text-[9px] mt-0.5",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:"flex items-center gap-0.5",children:[n.jsx("span",{className:"w-2.5 h-[1.5px] bg-[#60A5FA] rounded-full inline-block"}),n.jsx("span",{className:"text-fg-muted",children:"RSSI"}),n.jsx("span",{className:"tabular-nums",style:{color:x},children:m})]}),n.jsxs("span",{className:"flex items-center gap-0.5",children:[n.jsx("span",{className:"w-2.5 h-[1px] bg-[#34D399] rounded-full inline-block opacity-50",style:{borderTop:"1px dashed #34D399"}}),n.jsx("span",{className:"text-fg-muted",children:"SNR"}),n.jsx("span",{className:"tabular-nums",style:{color:p},children:h})]})]}),n.jsxs("div",{className:"flex items-center gap-2 text-fg-muted tabular-nums",children:[n.jsxs("span",{children:[s.toFixed(0),"…",a.toFixed(0)," dBm"]}),n.jsxs("span",{children:[r.toFixed(0),"…",o.toFixed(0)," dB"]})]})]}),n.jsx("div",{className:"mt-1 text-[9px] leading-tight",style:{color:f.color},children:f.text})]})}),Tt=s.memo(function({edge:e,onClose:t}){const[a,i]=s.useState(null);return s.useEffect(()=>{if(!e.isZeroHop&&"zero-hop"!==e.edgeType)return void i(null);const t=W.getState().packets,s=W.getState().cachedLocalHash??void 0,n=function(e,t,s,n,a=24){const i=function(e,t,s,n){var a;const i=[],r=t.replace(/^0x/i,"").slice(0,2).toLowerCase();for(const o of e){if(o.transmitted)continue;if(null==o.rssi||null==o.snr)continue;if(0===o.rssi&&0===o.snr)continue;const e=(null==(a=o.src_hash)?void 0:a.replace(/^0x/i,""))??"";if(e.slice(0,2).toLowerCase()!==r&&e!==t.replace(/^0x/i,""))continue;const s=o.original_path??o.forwarded_path??[],l=d(s,n),c=(null==l?void 0:l.effectiveLength)??0,m=o.route??o.route_type;let h=!1;h=null!=m&&u(m)?c<=1:0===c,h&&i.push({timestamp:1e3*o.timestamp,rssi:o.rssi,snr:o.snr})}if(i.sort((e,t)=>e.timestamp-t.timestamp),i.length>0&&i[0].timestamp<4102444800)for(const o of i)o.timestamp*=1e3;return i}(e,t,0,n);if(i.length<3)return null;const r=function(e,t=24){if(0===e.length)return[];const s=e[0].timestamp,n=e[e.length-1].timestamp-s;if(n<=0)return[{timestamp:s,avgRssi:e.reduce((e,t)=>e+t.rssi,0)/e.length,avgSnr:e.reduce((e,t)=>e+t.snr,0)/e.length,minRssi:Math.min(...e.map(e=>e.rssi)),maxRssi:Math.max(...e.map(e=>e.rssi)),minSnr:Math.min(...e.map(e=>e.snr)),maxSnr:Math.max(...e.map(e=>e.snr)),count:e.length}];const a=n/t,i=[];for(let o=0;o<t;o++)i.push({timestamp:s+(o+.5)*a,avgRssi:0,avgSnr:0,minRssi:1/0,maxRssi:-1/0,minSnr:1/0,maxSnr:-1/0,count:0});for(const o of e){const e=i[Math.min(t-1,Math.floor((o.timestamp-s)/a))];e.avgRssi+=o.rssi,e.avgSnr+=o.snr,e.minRssi=Math.min(e.minRssi,o.rssi),e.maxRssi=Math.max(e.maxRssi,o.rssi),e.minSnr=Math.min(e.minSnr,o.snr),e.maxSnr=Math.max(e.maxSnr,o.snr),e.count++}const r=[];for(const o of i)o.count>0&&(o.avgRssi/=o.count,o.avgSnr/=o.count,r.push(o));return r}(i,a);if(r.length<2)return null;let o=0,l=0,c=1/0,m=-1/0,h=1/0,x=-1/0;for(const d of i)o+=d.rssi,l+=d.snr,c=Math.min(c,d.rssi),m=Math.max(m,d.rssi),h=Math.min(h,d.snr),x=Math.max(x,d.snr);const p=rt(r.map(e=>e.avgRssi)),g=rt(r.map(e=>e.avgSnr)),f=i[0].timestamp,v=i[i.length-1].timestamp;return{buckets:r,totalSamples:i.length,rssiRange:[c,m],snrRange:[h,x],avgRssi:o/i.length,avgSnr:l/i.length,rssiTrend:p,snrTrend:g,timeSpanMs:v-f}}(t,e.source,e.target,s);i(n)},[e.source,e.target,e.isZeroHop,e.edgeType]),n.jsxs(h.div,{variants:J,initial:"hidden",animate:"visible",exit:"exit",className:"absolute inset-x-3 bottom-3 z-20 surface-elevated radius-inset shadow-xl",children:[n.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5 border-b border-edge-subtle/50",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[n.jsx(ge,{className:"size-3.5 text-fg-muted shrink-0"}),n.jsxs("span",{className:"text-sm font-semibold text-fg-primary truncate",children:[e.fromName??e.source.slice(0,6)," → ",e.toName??e.target.slice(0,6)]}),n.jsxs("div",{className:"flex gap-1 shrink-0",children:[n.jsx(R,{color:"zinc",compact:!0,children:Et[e.edgeType]}),e.isBackbone&&n.jsx(R,{color:"emerald",compact:!0,children:"BONE"}),e.isLoopEdge&&n.jsx(R,{color:"indigo",compact:!0,children:"LOOP"}),e.isGhost&&n.jsx(R,{color:"zinc",compact:!0,children:"GHOST"})]})]}),n.jsx(I,{plain:!0,onClick:t,title:"Close",className:"shrink-0",children:n.jsx(p,{className:"size-4"})})]}),n.jsxs("div",{className:"p-3 font-mono text-[11px]",children:[n.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[n.jsxs("div",{children:[n.jsx(M,{content:"Average disambiguation confidence across all observations of this edge",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Confidence"})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[(100*e.confidence).toFixed(0),"%"]})]}),n.jsxs("div",{children:[n.jsx(M,{content:"Observations where both endpoints had high-confidence disambiguation",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Certain"})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:e.certainCount.toLocaleString()})]}),n.jsxs("div",{children:[n.jsx(M,{content:"Total packets observed traversing this edge",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Packets"})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:e.packetCount.toLocaleString()})]}),n.jsxs("div",{children:[n.jsx(M,{content:"Combined certainCount × confidence metric for edge ranking",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Strength"})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:e.strength.toFixed(2)})]})]}),n.jsxs("div",{className:"grid grid-cols-4 gap-3 mt-2",children:[n.jsxs("div",{children:[n.jsx(M,{content:"Bidirectional balance (min/max) — 0 = one-way traffic, 1 = perfectly balanced",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Symmetry"})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:e.symmetryRatio.toFixed(2)})]}),n.jsxs("div",{children:[n.jsx(M,{content:"Dominant traffic flow direction between these nodes",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Direction"})}),n.jsx("div",{className:"text-fg-primary capitalize",children:e.dominantDirection})]}),n.jsxs("div",{children:[n.jsx(M,{content:"Forward (A→B) vs reverse (B→A) observation counts",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Fwd / Rev"})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[e.forwardCount," / ",e.reverseCount]})]}),n.jsxs("div",{children:[n.jsx(M,{content:"Routing method — broadcast flood vs unicast direct routing",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Flood / Direct"})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[e.floodCount," / ",e.directCount]})]})]}),(null!=e.avgRssi||null!=e.avgSnr)&&n.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-2 pt-2 border-t border-edge-subtle/50",children:[null!=e.avgRssi&&n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-fg-muted uppercase",children:"RSSI"}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[e.avgRssi.toFixed(1)," dBm"]})]}),null!=e.avgSnr&&n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-fg-muted uppercase",children:"SNR"}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[e.avgSnr.toFixed(1)," dB"]})]})]}),e.linkBudget&&n.jsxs("div",{className:"grid grid-cols-4 gap-3 mt-2 pt-2 border-t border-edge-subtle/50",children:[null!=e.linkBudget.distanceKm&&n.jsxs("div",{children:[n.jsx(M,{content:"Haversine distance between endpoint locations",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Distance"})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[e.linkBudget.distanceKm.toFixed(2)," km"]})]}),null!=e.linkBudget.fsplDb&&n.jsxs("div",{children:[n.jsx(M,{content:"Free Space Path Loss — theoretical signal attenuation over this distance at configured frequency",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"FSPL"})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[e.linkBudget.fsplDb.toFixed(1)," dB"]})]}),null!=e.linkBudget.marginDb&&n.jsxs("div",{children:[n.jsx(M,{content:"Link margin — observed RSSI minus receiver sensitivity. Positive = signal headroom above minimum.",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Margin"})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",style:{color:e.linkBudget.marginClass?Je[e.linkBudget.marginClass]:void 0},children:[e.linkBudget.marginDb>0?"+":"",e.linkBudget.marginDb.toFixed(1)," dB"]})]}),null!=e.linkBudget.deviationDb&&n.jsxs("div",{children:[n.jsx(M,{content:"Deviation from theoretical FSPL — positive means better signal than free-space prediction",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"vs Theory"})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[e.linkBudget.deviationDb>0?"+":"",e.linkBudget.deviationDb.toFixed(1)," dB"]})]})]}),a&&n.jsx(At,{timeline:a})]})]})}),$t=s.memo(function({node:e,onClose:t,egoMetrics:a,onExpandEgo:i,neighbors:r,onSelectNeighbor:o,txDelayRec:l}){const[c,d]=s.useState(!1),[u,m]=s.useState(!1);return n.jsxs(h.div,{variants:J,initial:"hidden",animate:"visible",exit:"exit",className:"absolute inset-x-3 bottom-3 z-20 surface-elevated radius-inset shadow-xl max-h-[60vh] flex flex-col",children:[n.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5 border-b border-edge-subtle/50",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[n.jsx("span",{className:"size-2 shrink-0 rounded-full",style:{backgroundColor:($()?Dt:Ft)[e.nodeClass]}}),n.jsx("code",{className:"text-sm font-semibold text-fg-primary shrink-0",children:e.prefix}),e.name&&n.jsx("span",{className:"text-sm text-fg-secondary truncate",children:e.name}),n.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.isLocal&&n.jsx(R,{color:"yellow",compact:!0,children:"LOCAL"}),e.isHub&&n.jsx(R,{color:"violet",compact:!0,children:"HUB"}),e.isGateway&&n.jsx(R,{color:"sky",compact:!0,children:"GW"}),e.isBackbone&&n.jsx(R,{color:"emerald",compact:!0,children:"BONE"}),e.isMobile&&n.jsx(R,{color:"orange",compact:!0,children:"MOB"}),e.isZeroHop&&n.jsx(R,{color:"amber",compact:!0,children:"RF"}),e.isGhost&&n.jsx(R,{color:"zinc",compact:!0,children:"GHOST"}),e.isInLoop&&n.jsx(R,{color:"indigo",compact:!0,children:"LOOP"})]})]}),n.jsx(I,{plain:!0,onClick:t,title:"Close",className:"shrink-0",children:n.jsx(p,{className:"size-4"})})]}),n.jsxs("div",{className:"p-3 font-mono text-[11px]",children:[n.jsx(Q,{copy:!0,size:"compact",truncate:[10,6],className:"w-full mb-3",children:e.hash}),n.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[n.jsxs("div",{children:[n.jsx(M,{content:"Total connections (edges) to this node",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Degree"})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:e.degree})]}),n.jsxs("div",{children:[n.jsx(M,{content:"Inbound vs outbound edge count — indicates traffic directionality",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"In / Out"})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[e.inDegree," / ",e.outDegree]})]}),n.jsxs("div",{children:[n.jsx(M,{content:"Betweenness centrality (0–1) — how often this node lies on shortest paths. High value = critical relay.",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Between."})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:e.betweenness.toFixed(3)})]}),n.jsxs("div",{children:[n.jsx(M,{content:"Total packets observed involving this node",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Packets"})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:e.packetCount.toLocaleString()})]})]}),n.jsxs("div",{className:"grid grid-cols-4 gap-3 mt-2",children:[n.jsxs("div",{children:[n.jsx(M,{content:"Number of topology edges connected to this node",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Edges"})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:e.edgeCount})]}),n.jsxs("div",{children:[n.jsx(M,{content:"Community cluster assignment from graph partitioning algorithm",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Community"})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:["#",e.communityId]})]}),n.jsxs("div",{children:[n.jsx(M,{content:"Prefix disambiguation confidence — how certain the 2-char prefix→node mapping is (multi-factor scoring)",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Confidence"})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[(100*e.prefixConfidence).toFixed(0),"%"]})]}),n.jsxs("div",{children:[n.jsx(M,{content:"Recency level — active (<1h), recent (<6h), stale (<24h), inactive (>24h)",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Activity"})}),n.jsx("div",{className:"text-fg-primary capitalize",children:e.activityLevel})]})]}),(null!=e.avgRssi||null!=e.avgSnr)&&n.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-2 pt-2 border-t border-edge-subtle/50",children:[null!=e.avgRssi&&n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-fg-muted uppercase",children:"RSSI"}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[e.avgRssi.toFixed(1)," dBm"]})]}),null!=e.avgSnr&&n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-fg-muted uppercase",children:"SNR"}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[e.avgSnr.toFixed(1)," dB"]})]})]}),a&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-2 pt-2 border-t border-edge-subtle/50",children:[n.jsxs("div",{children:[n.jsx(M,{content:"Number of direct 1-hop neighbors in the topology",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Ego Size"})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:a.neighborCount})]}),n.jsxs("div",{children:[n.jsx(M,{content:"Local clustering coefficient — how interconnected this node's neighbors are (0 = none, 1 = fully connected)",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Clustering"})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:a.clusteringCoeff.toFixed(3)})]}),n.jsxs("div",{children:[n.jsx(M,{content:"Average betweenness centrality of this node's direct neighbors",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Avg Nbr Btw."})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:a.avgNeighborBetweenness.toFixed(3)})]})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-2",children:[n.jsxs("div",{children:[n.jsx(M,{content:"Average disambiguation confidence across all connected edges",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Edge Conf."})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[(100*a.avgEdgeConfidence).toFixed(0),"%"]})]}),null!=a.avgRssi&&n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-fg-muted uppercase",children:"Avg RSSI"}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[a.avgRssi.toFixed(1)," dBm"]})]}),null!=a.avgSnr&&n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-fg-muted uppercase",children:"Avg SNR"}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[a.avgSnr.toFixed(1)," dB"]})]})]})]}),l&&!l.insufficientData&&n.jsxs("div",{className:"mt-2 pt-2 border-t border-edge-subtle/50",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[n.jsx(M,{content:"RF-grounded TX delay recommendation from centralized topology engine. Anchored to MeshCore firmware defaults with observer bias correction.",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase tracking-wide cursor-help",children:"TX Delay Recommendation"})}),n.jsxs("div",{className:"flex items-center gap-1",children:[l.networkRole&&n.jsx(R,{color:ne[l.networkRole],compact:!0,children:l.networkRole}),l.dataConfidence&&n.jsx(R,{color:ae[l.dataConfidence],compact:!0,children:l.dataConfidence})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs("div",{children:[n.jsx(M,{content:`Flood TX delay factor (firmware default: ×${ie})`,children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Flood"})}),n.jsx("div",{className:"text-fg-primary tabular-nums text-sys-amber",children:re(l.floodFactor)})]}),n.jsxs("div",{children:[n.jsx(M,{content:`Direct TX delay factor (firmware default: ×${oe})`,children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Direct"})}),n.jsx("div",{className:"text-fg-primary tabular-nums text-sys-amber",children:re(l.directFactor)})]})]}),l.rationale&&n.jsx("div",{className:"mt-1 text-[9px] text-fg-muted leading-snug",children:l.rationale}),null!=l.observationSymmetry&&l.observationSymmetry<.6&&n.jsxs("div",{className:"mt-1 text-[9px] text-sys-amber/70 leading-snug",children:["⚠ Low observation symmetry (",(100*l.observationSymmetry).toFixed(0),"%) — recommendation damped toward firmware defaults"]}),n.jsxs("button",{onClick:async()=>{const e=`set txdelay ${l.floodFactor.toFixed(1)}\nset direct.txdelay ${l.directFactor.toFixed(1)}`;try{await navigator.clipboard.writeText(e)}catch{}m(!0),setTimeout(()=>m(!1),1500)},className:"mt-1.5 flex items-center gap-1 text-[9px] text-sys-blue hover:text-sys-blue/80 transition-base",children:[u?n.jsx(G,{className:"w-3 h-3 text-sys-green"}):n.jsx(O,{className:"w-3 h-3"}),u?"Copied!":"Copy CLI commands"]})]}),i&&n.jsx("div",{className:"mt-2 pt-2 border-t border-edge-subtle/50",children:n.jsxs("button",{onClick:i,className:"flex items-center gap-1.5 text-[10px] text-sys-blue hover:text-sys-blue/80 transition-base",children:[n.jsx(Z,{className:"w-3 h-3"}),"Expand 2-hop neighborhood"]})}),r&&r.length>0&&n.jsxs("div",{className:"mt-2 pt-2 border-t border-edge-subtle/50",children:[n.jsxs("button",{onClick:()=>d(e=>!e),className:"flex items-center justify-between w-full text-[9px] text-fg-muted uppercase tracking-wide cursor-pointer hover:text-fg-secondary transition-base",children:[n.jsxs("span",{children:["Neighbors (",r.length,")"]}),n.jsx(z,{className:"w-3 h-3 transition-transform "+(c?"rotate-180":"")})]}),c&&n.jsx("div",{className:"mt-1.5 max-h-32 overflow-y-auto space-y-0.5",children:r.map(e=>n.jsxs("button",{onClick:()=>null==o?void 0:o(e.hash),className:"w-full flex items-center gap-2 px-1.5 py-1 radius-badge hover-bg transition-base text-left group",children:[n.jsx("code",{className:"text-[10px] text-sys-blue shrink-0 tabular-nums",children:e.prefix}),n.jsx("span",{className:"text-[10px] text-fg-secondary truncate flex-1",children:e.name||"—"}),null!=e.avgSnr&&n.jsxs("span",{className:"text-[9px] text-fg-muted tabular-nums shrink-0",children:[e.avgSnr.toFixed(0)," dB"]}),null!=e.avgRssi&&n.jsx("span",{className:"text-[9px] text-fg-muted tabular-nums shrink-0",children:e.avgRssi.toFixed(0)}),n.jsxs("span",{className:"text-[9px] text-fg-muted/60 tabular-nums shrink-0",children:[(100*e.edgeConfidence).toFixed(0),"%"]})]},e.hash))})]})]})]})}),It=s.memo(function({metrics:e,onClose:t}){const s=Object.entries(e.communities).sort(([,e],[,t])=>t-e),a=Object.entries(e.nodeClasses).sort(([,e],[,t])=>t-e);return n.jsxs(h.div,{variants:J,initial:"hidden",animate:"visible",exit:"exit",className:"absolute inset-x-3 bottom-3 z-20 surface-elevated radius-inset shadow-xl",children:[n.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5 border-b border-edge-subtle/50",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[n.jsx(be,{className:"size-3.5 text-fg-muted shrink-0"}),n.jsx("span",{className:"text-sm font-semibold text-fg-primary",children:"Subgraph Analysis"}),n.jsxs(R,{color:"violet",compact:!0,children:[e.nodeCount," nodes"]})]}),n.jsx(I,{plain:!0,onClick:t,title:"Close",className:"shrink-0",children:n.jsx(p,{className:"size-4"})})]}),n.jsxs("div",{className:"p-3 font-mono text-[11px]",children:[n.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-fg-muted uppercase",children:"Nodes"}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:e.nodeCount})]}),n.jsxs("div",{children:[n.jsx(M,{content:"Edges where both endpoints are within the lasso selection",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Internal Edges"})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:e.edgeCount})]}),n.jsxs("div",{children:[n.jsx(M,{content:"Mean betweenness centrality of selected nodes",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Avg Between."})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:e.avgBetweenness.toFixed(3)})]}),n.jsxs("div",{children:[n.jsx(M,{content:"Mean edge disambiguation confidence for internal edges",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Avg Confidence"})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[(100*e.avgConfidence).toFixed(0),"%"]})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-2 pt-2 border-t border-edge-subtle/50",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-fg-muted uppercase mb-1",children:"Communities"}),n.jsx("div",{className:"flex flex-wrap gap-1",children:s.map(([e,t])=>n.jsxs("span",{className:"text-fg-secondary",children:["#",e,"×",t]},e))})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-fg-muted uppercase mb-1",children:"Node Types"}),n.jsx("div",{className:"flex flex-wrap gap-1",children:a.map(([e,t])=>n.jsxs("span",{className:"text-fg-secondary capitalize",children:[e,"×",t]},e))})]})]}),e.nodeCount>1&&n.jsx("div",{className:"mt-2 pt-2 border-t border-edge-subtle/50",children:n.jsxs("div",{className:"text-[9px] text-fg-muted flex items-center gap-1 flex-wrap",children:[n.jsx(M,{content:"Fraction of possible edges that exist — 2E / N(N-1)",children:n.jsxs("span",{className:"cursor-help",children:["Density: ",(2*e.edgeCount/(e.nodeCount*(e.nodeCount-1))*100).toFixed(1),"%"]})}),n.jsx("span",{children:"·"}),n.jsx(M,{content:"Mean connections per node — 2E / N",children:n.jsxs("span",{className:"cursor-help",children:["Avg Degree: ",(2*e.edgeCount/e.nodeCount).toFixed(1)]})}),null!=e.avgPathHealth&&n.jsxs(n.Fragment,{children:[n.jsx("span",{children:"·"}),n.jsx(M,{content:"Average health score of paths within the selection",children:n.jsxs("span",{className:"cursor-help",children:["Path Health: ",(100*e.avgPathHealth).toFixed(0),"%"]})})]})]})})]})]})});function Gt(){return n.jsxs("div",{className:"flex flex-col items-center justify-center gap-6 text-center px-8",children:[n.jsx("div",{className:"p-4 radius-pill bg-subtle-fill",children:n.jsx(pe,{className:"w-8 h-8 text-fg-muted"})}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("h2",{className:"type-subheading text-fg-primary",children:"No Topology Data"}),n.jsx("p",{className:"type-body text-fg-muted max-w-sm",children:"The mesh topology will appear here once packets are received and processed."})]}),n.jsxs("div",{className:"flex items-center gap-2 type-data-xs text-fg-muted",children:[n.jsx(P,{className:"w-4 h-4 animate-pulse"}),n.jsx("span",{children:"Waiting for mesh traffic..."})]})]})}const Ot=s.memo(function({label:e,value:t,onChange:a,min:i,max:r,step:o}){const[l,c]=s.useState(!1),[d,u]=s.useState(""),m=s.useRef(null),h=s.useCallback(()=>{const e=parseFloat(d);isNaN(e)||a(Math.min(r,Math.max(i,Math.round(e/o)*o))),c(!1)},[d,a,i,r,o]),x=s.useCallback(()=>{u(t.toFixed(2)),c(!0),setTimeout(()=>{var e;return null==(e=m.current)?void 0:e.select()},0)},[t]);return n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-[10px] text-fg-muted",children:e}),l?n.jsx("input",{ref:m,type:"number",value:d,onChange:e=>u(e.target.value),onBlur:h,onKeyDown:e=>{"Enter"===e.key&&h(),"Escape"===e.key&&c(!1)},min:i,max:r,step:o,className:"w-14 text-right text-[10px] text-fg-secondary tabular-nums bg-subtle-fill radius-badge px-1 py-0.5 border border-edge-subtle focus:outline-none focus:border-sys-blue"}):n.jsx("button",{onClick:x,className:"text-[10px] text-fg-secondary tabular-nums hover:text-sys-blue cursor-text transition-colors",title:"Click to type a value",children:t.toFixed(2)})]}),n.jsx("input",{type:"range",min:i,max:r,step:o,value:t,onChange:e=>a(parseFloat(e.target.value)),className:"w-full h-1 bg-subtle-fill rounded appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:bg-sys-blue [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer"})]})}),Zt=s.memo(function({label:e,checked:t,onChange:s}){return n.jsxs(r,{className:"flex items-center justify-between",children:[n.jsx(o,{className:"text-[10px] text-fg-muted cursor-pointer select-none",children:e}),n.jsx(T,{enabled:t,onChange:s,size:"sm"})]})});function Wt(){var e,t,r,o,l,c,d,u,x,S,T,$,I,G,O;const Z=g(),[W,V]=s.useState(!1),[K,J]=s.useState(!1),Q=s.useRef(!1);s.useEffect(()=>{Z&&!Q.current&&(Q.current=!0,J(!0))},[Z]);const ee=s.useCallback(()=>{J(!1),V(!0)},[]),te=f(),ne=function(e,t=1e3){const[n,a]=s.useState(e),i=s.useRef(Date.now()),r=s.useRef(null);return s.useEffect(()=>{const s=Date.now(),n=t-(s-i.current);return n<=0?(a(e),i.current=s):(r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{a(e),i.current=Date.now()},n)),()=>{r.current&&clearTimeout(r.current)}},[e,t]),n}(v(),2e3),ae=b(),ie=y(),re=j(),oe=N(),pe=w(),ge=C(),je=k(),Ne=je?Dt:Ft,we=je?ft:vt,Ce=s.useMemo(()=>function(e){if("undefined"==typeof document)return e?L[950]:"#EFF0F1";const t=getComputedStyle(document.documentElement).getPropertyValue("--bg-body").trim();return t.startsWith("#")?t:e?L[950]:"#EFF0F1"}(je),[je]),ke=s.useMemo(()=>function(e){if("undefined"==typeof document)return e?L[400]:L[500];const t=getComputedStyle(document.documentElement).getPropertyValue("--text-secondary").trim();return t.startsWith("#")?t:e?L[400]:L[500]}(je),[je]),[Se,Le]=s.useState(!0),[De,Fe]=s.useState(null),[Re,Me]=s.useState(null),[He,Be]=s.useState(!1),[Pe,Ee]=s.useState(""),[ze,Te]=s.useState(!1),[$e,Ge]=s.useState(!1),[Oe,Ze]=s.useState("simulation"),[We,_e]=s.useState(!0),[qe,Ye]=s.useState(!1),[tt,st]=s.useState(!0),[nt,it]=s.useState(!1),[rt,ot]=s.useState(!1),[ct,dt]=s.useState(new Set),[ut,mt]=s.useState(!1),[bt,Mt]=s.useState("spectral"),[Et,At]=s.useState(1),[Wt,Vt]=s.useState(1),[Kt,_t]=s.useState(!1),[qt,Ut]=s.useState(null),[Xt,Yt]=s.useState(!1),[Jt,Qt]=s.useState(!1),[es,ts]=s.useState(null),[ss,ns]=s.useState(null),[as,is]=s.useState(null),[rs,os]=s.useState(null),[ls,cs]=s.useState(null),[ds,us]=s.useState(null),ms=s.useRef(!1),[hs,xs]=s.useState(!1),[ps,gs]=s.useState([]),[fs,vs]=s.useState(0),[bs,ys]=s.useState(null),js=s.useRef(new at),Ns=s.useRef(null),ws=s.useRef(null),[Cs,ks]=s.useState(null),[Ss,Ls]=s.useState(null),[Ds,Fs]=s.useState({}),[Rs,Ms]=s.useState({simulationDecay:2e4,simulationGravity:.05,simulationCenter:.05,simulationRepulsion:5,simulationRepulsionTheta:.4,simulationLinkSpring:.05,simulationLinkDistance:78,simulationFriction:.72,simulationRepulsionFromMouse:0,pointSizeScale:.4,pointOpacity:1,pointGreyoutOpacity:.1,linkWidthScale:.06,linkOpacity:.95,linkGreyoutOpacity:.1,curvedLinks:Nt,curvedLinkWeight:.8,linkDefaultArrows:wt,linkArrowsSizeScale:1.7,scalePointsOnZoom:Ct,scaleLinksOnZoom:kt,renderLinks:St,renderHoveredPointRing:Lt,spaceSize:4096}),Hs=s.useCallback((e,t)=>{Ms(s=>({...s,[e]:t}))},[]),Bs=s.useCallback(()=>{Ms({simulationDecay:2e4,simulationGravity:.05,simulationCenter:.05,simulationRepulsion:5,simulationRepulsionTheta:.4,simulationLinkSpring:.05,simulationLinkDistance:78,simulationFriction:.72,simulationRepulsionFromMouse:0,pointSizeScale:.4,pointOpacity:1,pointGreyoutOpacity:.1,linkWidthScale:.06,linkOpacity:.95,linkGreyoutOpacity:.1,curvedLinks:Nt,curvedLinkWeight:.8,linkDefaultArrows:wt,linkArrowsSizeScale:1.7,scalePointsOnZoom:Ct,scaleLinksOnZoom:kt,renderLinks:St,renderHoveredPointRing:Lt,spaceSize:4096})},[]);s.useEffect(()=>()=>{var e;try{null==(e=ws.current)||e.destroy()}catch{}ws.current=null},[]),s.useEffect(()=>{const e=e=>{var t,s;if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLSelectElement))switch(e.key.toLowerCase()){case"f":e.metaKey||e.ctrlKey||(e.preventDefault(),null==(t=ws.current)||t.fitView(xt));break;case"escape":ze?(Te(!1),Ee("")):De&&(Fe(null),null==(s=ws.current)||s.unselectAllPoints());break;case"/":ze||(e.preventDefault(),Te(!0),setTimeout(()=>{var e;return null==(e=Ns.current)?void 0:e.focus()},50));break;case" ":e.preventDefault(),ws.current&&(Se?ws.current.pause():ws.current.start(),Le(e=>!e));break;case"l":_e(e=>!e)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ze,De,Se]);const Ps=s.useMemo(()=>new Set((null==te?void 0:te.backboneEdges)??[]),[null==te?void 0:te.backboneEdges]),Es=s.useMemo(()=>({resolution:Et,kWeight:Wt}),[Et,Wt]),zs=s.useMemo(()=>{if("louvain"!==bt)return null;const e=null==te?void 0:te.edges;return!e||0===e.length||!ne||ne.size<3?null:Ie(e,Array.from(ne.keys()),Es).communities},[bt,null==te?void 0:te.edges,ne,Es]),As=s.useMemo(()=>{var e;if(!ne||0===ne.size||!W)return[];const t=[],s=(null==ge?void 0:ge.node_name)??(null==(e=null==ge?void 0:ge.config)?void 0:e.node_name)??null,n=je?"#171717":"#EFF0F1";let a=1;for(const i of ne.values())i.degree>a&&(a=i.degree);for(const i of ne.values()){const e=i,r=e.degree>0?Math.log10(e.degree+1)/Math.log10(a+1):0,o=5+23*Math.min(1,r),l=6*e.betweenness,c=e.isLocal?28:Math.min(34,o+l),d=(null==zs?void 0:zs.get(e.hash))??e.communityId,u=ut&&d>=0?we[d%we.length]:Ne[e.nodeClass],m=gt[e.activityLevel]??1,h=e.isLocal?Ne.local:m<1?Ht(u,n,m):u,x=e.isLocal?s??e.name:e.name;t.push({id:e.hash,label:x?`${e.prefix} ${x}`:e.prefix,color:h,size:c,nodeClass:e.nodeClass,name:x,prefix:e.prefix,packetCount:e.packetCount,isLocal:e.isLocal,isHub:e.isHub,isGateway:e.isGateway,isBackbone:e.isBackbone,isMobile:e.isMobile,isZeroHop:e.isZeroHop,isGhost:e.isGhost,degree:e.degree,betweenness:e.betweenness,communityId:(null==zs?void 0:zs.get(e.hash))??e.communityId,activityLevel:e.activityLevel,prefixConfidence:e.prefixConfidence,hasCollision:e.hasCollision,inDegree:e.inDegree,outDegree:e.outDegree,isInLoop:e.isInLoop,avgRssi:e.avgRssi,avgSnr:e.avgSnr})}for(const i of ae){const e=`ghost-${i.prefix}`;if(t.some(t=>t.id===e))continue;const s=Ht(Ne.ghost,n,.6);t.push({id:e,label:`? ${i.prefix.toUpperCase()}`,color:s,size:6,nodeClass:"ghost",name:null,prefix:i.prefix,packetCount:i.observationCount,isLocal:!1,isHub:!1,isGateway:!1,isBackbone:!1,isMobile:!1,isZeroHop:!1,isGhost:!0,degree:i.commonNeighbors.size,betweenness:0,communityId:-1,activityLevel:"active",prefixConfidence:i.confidence,hasCollision:!1,inDegree:0,outDegree:0,isInLoop:!1,avgRssi:null,avgSnr:null})}return t},[ne,W,null==ge?void 0:ge.node_name,null==(e=null==ge?void 0:ge.config)?void 0:e.node_name,Ne,je,ae,we,ut,bt,zs]),Ts=s.useMemo(()=>new Set(As.map(e=>e.id)),[As]),$s=s.useMemo(()=>{const e=new Map;if(!ne)return e;for(const t of ne.values())e.set(t.hash,t.name);return e},[ne]),Is=s.useMemo(()=>{const e=(null==te?void 0:te.edges)??[];if(!e.length||!W)return[];const t=[],s=(null==te?void 0:te.edgeBetweenness)??new Map;for(const a of e){if(!Ts.has(a.fromHash)||!Ts.has(a.toHash))continue;const e=Bt(a,Ps),n=Pt(e,a.avgConfidence,je),i=s.get(a.key)??0,r=i>0?.5+4*i:.5+2*Math.min(1,a.certainCount/50);t.push({source:a.fromHash,target:a.toHash,color:n,width:r,key:a.key,packetCount:a.packetCount,certainCount:a.certainCount,confidence:a.avgConfidence,symmetryRatio:a.symmetryRatio,dominantDirection:a.dominantDirection,isBackbone:Ps.has(a.key),isLoopEdge:a.isLoopEdge??!1,isDirectPath:a.isDirectPathEdge,isZeroHop:a.isZeroHop??!1,isGhost:!1,forwardCount:a.forwardCount,reverseCount:a.reverseCount,floodCount:a.floodCount,directCount:a.directCount,avgRssi:a.avgRssi??null,avgSnr:a.avgSnr??null,strength:a.strength,fromName:$s.get(a.fromHash)??null,toName:$s.get(a.toHash)??null,edgeType:e})}const n=je?yt:jt;for(const a of ae){const e=`ghost-${a.prefix}`;if(Ts.has(e))for(const s of a.commonNeighbors)Ts.has(s)&&t.push({source:e,target:s,color:n.ghost,width:.4,key:`ghost-${a.prefix}-${s}`,packetCount:a.observationCount,certainCount:0,confidence:a.confidence,symmetryRatio:0,dominantDirection:"balanced",isBackbone:!1,isLoopEdge:!1,isDirectPath:!1,isZeroHop:!1,isGhost:!0,forwardCount:0,reverseCount:0,floodCount:0,directCount:0,avgRssi:null,avgSnr:null,strength:a.confidence,fromName:null,toName:$s.get(s)??null,edgeType:"ghost"})}return t},[null==te?void 0:te.edges,null==te?void 0:te.edgeBetweenness,W,Ts,je,Ps,$s,ae]),Gs=null==(r=null==(t=null==ge?void 0:ge.config)?void 0:t.radio)?void 0:r.frequency,Os=null==(l=null==(o=null==ge?void 0:ge.config)?void 0:o.radio)?void 0:l.bandwidth,Zs=null==(d=null==(c=null==ge?void 0:ge.config)?void 0:c.radio)?void 0:d.spreading_factor,Ws=null==(x=null==(u=null==ge?void 0:ge.config)?void 0:u.radio)?void 0:x.tx_power,Vs=null==(T=null==(S=null==ge?void 0:ge.config)?void 0:S.radio)?void 0:T.coding_rate;s.useEffect(()=>{Jt&&!ms.current&&(ms.current=!0,(async()=>{var e,t;try{const s=await D(24);if(s.success&&(null==(t=null==(e=s.data)?void 0:e.history)?void 0:t.length)){const e=s.data.history.map(e=>e.noise_floor_dbm).filter(e=>null!=e&&e>-200&&e<0);if(e.length>0){const t=[...e].sort((e,t)=>e-t),s=t[Math.floor(t.length/2)];us(s)}}}catch{}})())},[Jt]);const Ks=s.useMemo(()=>{if(!te||!Jt)return null;const e={frequency:Gs,bandwidth:null!=as?1e3*as:Os,spreading_factor:ss??Zs,tx_power:es??Ws,coding_rate:rs??Vs},t={};return null!=ls&&(t.sensitivityOverrideDbm=ls),null!=ds&&(t.observedNoiseFloorDbm=ds),function(e,t,s){const n=[],a=e.nodeMetrics,i=new Set,r=t.tx_power??22;for(const o of e.edges){if(!o.isZeroHop)continue;const e=a.get(o.fromHash),r=a.get(o.toHash);n.push(Ue(o,e,r,t,s)),i.add(o.key)}for(const o of e.edges){if(i.has(o.key))continue;if(!o.traceQuality)continue;const e=Xe(o,a.get(o.fromHash),a.get(o.toHash),t,r,s);e&&(n.push(e),i.add(o.key))}return n}(te,e,t)},[te,Jt,Gs,Os,Zs,Ws,Vs,es,ss,as,rs,ls,ds]),_s=s.useMemo(()=>{if(!Ks)return null;const e=new Map;for(const t of Ks)e.set(t.edgeKey,t);return e},[Ks]),qs=s.useMemo(()=>Ks&&0!==Ks.length?function(e){const t={"anomalous-good":0,better:0,expected:0,worse:0,"anomalous-bad":0},s={excellent:0,good:0,fair:0,marginal:0,critical:0};let n=0,a=0,i=null,r=null,o=0,l=0;for(const c of e)c.hasData&&(null!=c.marginDb&&(n+=c.marginDb,a++,(!i||c.marginDb<(i.marginDb??1/0))&&(i=c),(!r||c.marginDb>(r.marginDb??-1/0))&&(r=c)),c.marginClass&&s[c.marginClass]++,null!=c.deviationDb&&c.deviationClass?(t[c.deviationClass]++,l++):o++);return{totalEdges:e.length,analyzedEdges:l,rssiOnlyEdges:o,avgMarginDb:a>0?n/a:null,worstMargin:i,bestMargin:r,deviationCounts:t,marginCounts:s,anomalousCount:t["anomalous-good"]+t["anomalous-bad"]}}(Ks):null,[Ks]),Us=s.useMemo(()=>{if(!Jt||!_s)return Is;const e=je?"#303038":"#D0D0D8";return Is.map(t=>{const s=_s.get(t.key);return s&&s.hasData?{...t,color:Qe(s,"margin"),width:et(s),linkBudget:s}:{...t,color:e,width:.3}})},[Is,Jt,_s,je]),Xs=s.useMemo(()=>0===ct.size?As:As.filter(e=>!ct.has(e.nodeClass)),[As,ct]),Ys=s.useMemo(()=>{if(0===ct.size)return Us;const e=new Set(Xs.map(e=>e.id));return Us.filter(t=>e.has(t.source)&&e.has(t.target))},[Us,Xs,ct]),Js=s.useRef([]);s.useEffect(()=>{Js.current=Ys},[Ys]);const Qs=s.useMemo(()=>{const e=new Map;for(const t of Is)e.set(t.source,(e.get(t.source)??0)+1),e.set(t.target,(e.get(t.target)??0)+1);return e},[Is]),en=s.useMemo(()=>{const e=new Map;for(const t of As)e.set(t.id,t);return e},[As]);s.useEffect(()=>{if(0===Xs.length)return ks(null),Ls(null),void Fs({});let e=!1;const t=setTimeout(async()=>{try{const t=Xs.map(e=>({id:e.id,label:e.label,color:e.color,size:e.size,communityId:String(e.communityId)})),s=Ys.map(e=>({source:e.source,target:e.target,color:e.color,width:e.width})),n={points:{pointIdBy:"id",pointColorBy:"color",pointColorStrategy:"direct",pointDefaultColor:je?"#9CA3AF":"#374151",pointLabelBy:"label",pointSizeBy:"size",pointSizeStrategy:"direct",pointDefaultSize:8,pointSizeScale:1,pointGreyoutOpacity:.3,pointIncludeColumns:["communityId"]},links:{linkSourceBy:"source",linkTargetsBy:["target"],linkColorBy:"color",linkColorStrategy:"direct",linkDefaultColor:je?"#6B7280":"#9CA3AF",linkWidthBy:"width",linkWidthStrategy:"direct",linkDefaultWidth:1,linkWidthScale:1,linkGreyoutOpacity:.1}},a=await i(n,t,s);if(e||!a)return;ks(a.points??null),Ls(a.links??null),Fs(a.cosmographConfig??{})}catch(t){}},100);return()=>{e=!0,clearTimeout(t)}},[Xs,Ys,je]);const tn=s.useCallback(e=>{e&&(ws.current=e,e.start(),setTimeout(()=>{e.fitView(xt)},1500))},[]),sn=s.useCallback(()=>{var e;null==(e=ws.current)||e.fitView(xt)},[]),nn=s.useCallback(()=>{const e=ws.current;e&&(Se?e.pause():e.start(),Le(!Se))},[Se]),an=s.useCallback(async e=>{const t=ws.current,s=en.get(e);if(s){if(t)try{const s=await t.getPointIndicesByIds([e]);s&&s.length>0&&void 0!==s[0]&&(t.zoomToPoint(s[0],400,2.5),t.selectPoint(s[0],!1,!0))}catch{}Me(null),Fe({hash:e,name:s.name,prefix:s.prefix,nodeClass:s.nodeClass,packetCount:s.packetCount,edgeCount:Qs.get(e)??0,degree:s.degree,betweenness:s.betweenness,communityId:s.communityId,isLocal:s.isLocal,isHub:s.isHub,isGateway:s.isGateway,isBackbone:s.isBackbone,isMobile:s.isMobile,isZeroHop:s.isZeroHop,isGhost:s.isGhost,isInLoop:s.isInLoop,activityLevel:s.activityLevel,prefixConfidence:s.prefixConfidence,hasCollision:s.hasCollision,inDegree:s.inDegree,outDegree:s.outDegree,avgRssi:s.avgRssi,avgSnr:s.avgSnr})}},[en,Qs]),rn=s.useRef(null);s.useEffect(()=>{rn.current=_s},[_s]);const on=s.useCallback(e=>{var t;if(void 0===e)return void Me(null);const s=Js.current[e];if(!s)return;const n=null==(t=rn.current)?void 0:t.get(s.key);Me(n&&!s.linkBudget?{...s,linkBudget:n}:s),Fe(null)},[]),ln=s.useCallback(async(e,t,s)=>{var n;if(void 0===e)return Fe(null),Ut(null),void(null==(n=ws.current)||n.unselectAllPoints());Me(null);const a=ws.current;if(a)try{const t=await a.getPointIdsByIndices([e]);if(!t||0===t.length)return;const s=t[0],n=en.get(s);if(!n)return;a.selectPoint(e,!1,!0),Fe({hash:s,name:n.name,prefix:n.prefix,nodeClass:n.nodeClass,packetCount:n.packetCount,edgeCount:Qs.get(s)??0,degree:n.degree,betweenness:n.betweenness,communityId:n.communityId,isLocal:n.isLocal,isHub:n.isHub,isGateway:n.isGateway,isBackbone:n.isBackbone,isMobile:n.isMobile,isZeroHop:n.isZeroHop,isGhost:n.isGhost,isInLoop:n.isInLoop,activityLevel:n.activityLevel,prefixConfidence:n.prefixConfidence,hasCollision:n.hasCollision,inDegree:n.inDegree,outDegree:n.outDegree,avgRssi:n.avgRssi,avgSnr:n.avgSnr})}catch{}},[en,Qs]),cn=s.useMemo(()=>{if(!ze||!Pe.trim())return[];const e=Pe.toLowerCase();return As.filter(t=>{var s;return t.prefix.toLowerCase().includes(e)||(null==(s=t.name)?void 0:s.toLowerCase().includes(e))||t.id.toLowerCase().includes(e)}).slice(0,8)},[As,Pe,ze]),dn=s.useCallback(e=>{Te(!1),Ee(""),an(e.id)},[an]),un=s.useCallback(()=>{Be(e=>!e)},[]),mn=s.useCallback(e=>{dt(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[]),hn=s.useCallback(()=>{mt(e=>{const t=!e,s=ws.current;return s&&s.start(.5),t})},[]),xn=s.useCallback(()=>{_t(e=>{const t=!e,s=ws.current;return s?(t?s.activatePolygonalSelection():(s.deactivatePolygonalSelection(),Ut(null),s.unselectAllPoints()),t):t})},[]),pn=s.useCallback(async()=>{const e=ws.current;if(!e)return;await new Promise(e=>setTimeout(e,80));const t=e.getSelectedPointIndices();if(!t||0===t.length)return void Ut(null);const s=await e.getPointIdsByIndices(t);if(!s||0===s.length)return void Ut(null);const n=new Set(s);let a=0,i=0;for(const m of Js.current)n.has(m.source)&&n.has(m.target)&&(a++,i+=m.confidence);let r=0;const o={},l={};for(const m of s){const e=en.get(m);e&&(r+=e.betweenness,o[e.communityId]=(o[e.communityId]??0)+1,l[e.nodeClass]=(l[e.nodeClass]??0)+1)}const c=new Set;for(const m of s){const e=en.get(m);e&&c.add(e.prefix.toLowerCase())}let d=0,u=0;for(const m of oe)if(m.hops.length>=2){const e=m.hops[0].toLowerCase(),t=m.hops[m.hops.length-1].toLowerCase();c.has(e)&&c.has(t)&&(d+=m.healthScore,u++)}Ut({nodeCount:s.length,edgeCount:a,avgBetweenness:s.length>0?r/s.length:0,avgConfidence:a>0?i/a:0,avgPathHealth:u>0?d/u:null,communities:o,nodeClasses:l}),Fe(null),Me(null)},[en,oe]),gn=s.useCallback(()=>{var e;Ut(null),null==(e=ws.current)||e.unselectAllPoints()},[]),fn=s.useMemo(()=>{var e;if(!De)return null;const t=De.hash,s=new Set;for(const h of Ys)h.source===t?s.add(h.target):h.target===t&&s.add(h.source);if(0===s.size)return{clusteringCoeff:0,avgNeighborBetweenness:0,neighborCount:0,avgEdgeConfidence:0,avgRssi:null,avgSnr:null};let n=0;for(const h of Ys)s.has(h.source)&&s.has(h.target)&&n++;const a=s.size,i=a>1?2*n/(a*(a-1)):0;let r=0;for(const h of s)r+=(null==(e=en.get(h))?void 0:e.betweenness)??0;let o=0,l=0,c=0,d=0,u=0,m=0;for(const h of Ys)h.source!==t&&h.target!==t||(o+=h.confidence,l++,null!=h.avgRssi&&(c+=h.avgRssi,d++),null!=h.avgSnr&&(u+=h.avgSnr,m++));return{clusteringCoeff:Math.min(1,i),avgNeighborBetweenness:r/a,neighborCount:a,avgEdgeConfidence:l>0?o/l:0,avgRssi:d>0?c/d:null,avgSnr:m>0?u/m:null}},[De,Ys,en]),vn=s.useMemo(()=>De&&pe?pe.get(De.hash)??null:null,[De,pe]),bn=s.useMemo(()=>{if(!De)return[];const e=De.hash,t=[],s=new Set;for(const n of Ys){let a=null;if(n.source===e?a=n.target:n.target===e&&(a=n.source),!a||s.has(a))continue;s.add(a);const i=en.get(a);t.push({hash:a,prefix:(null==i?void 0:i.prefix)??a.slice(2,4).toUpperCase(),name:(null==i?void 0:i.name)??null,edgeConfidence:n.confidence,edgeType:n.edgeType,avgRssi:n.avgRssi,avgSnr:n.avgSnr})}return t.sort((e,t)=>t.edgeConfidence-e.edgeConfidence),t},[De,Ys,en]),yn=s.useCallback(async()=>{const e=ws.current;if(!e||!De)return;const t=await e.getPointIndicesByIds([De.hash]);if(!t||void 0===t[0])return;const s=t[0],n=e.getConnectedPointIndices(s)??[],a=new Set([s,...n]);for(const r of n){const t=e.getConnectedPointIndices(r)??[];for(const e of t)a.add(e)}const i=Array.from(a);e.selectPoints(i),e.fitViewByIndices(i,xt,.15)},[De]);s.useEffect(()=>{if(!Kt)return;const e=e=>{var t,s;"Escape"===e.key&&(_t(!1),null==(t=ws.current)||t.deactivatePolygonalSelection(),Ut(null),null==(s=ws.current)||s.unselectAllPoints())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[Kt]);const jn=s.useCallback((e,t)=>{te&&(function(e,t){!function(e){const t=new Blob([e.content],{type:e.mimeType}),s=URL.createObjectURL(t),n=document.createElement("a");n.href=s,n.download=e.filename,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)}(Ae(e,t))}(te,{format:e,dataset:t}),Yt(!1))},[te]),Nn=s.useMemo(()=>{if(!te||!oe.length)return null;const e=te.edges??[];return 0===e.length?null:function(e,t,s=-137){const n=new Map;for(const r of t)n.set(r.key,r);const a=t.filter(e=>null!=e.avgRssi).length,i=[];for(const r of e){const e=lt(r,n,s);e&&i.push(e)}return i.sort((e,t)=>t.riskScore-e.riskScore),{atRiskPaths:i,criticalCount:i.filter(e=>"critical"===e.riskLevel).length,highCount:i.filter(e=>"high"===e.riskLevel).length,moderateCount:i.filter(e=>"moderate"===e.riskLevel).length,edgesAnalyzed:t.length,edgesWithSignal:a}}(oe,e)},[te,oe]),wn=s.useMemo(()=>{const e=null==te?void 0:te.edges;if(!e||0===e.length||!ne||ne.size<3)return null;const t=Array.from(ne.keys());return q(e,t)},[null==te?void 0:te.edges,ne]),Cn=s.useMemo(()=>{if("louvain"!==bt)return null;const e=null==te?void 0:te.edges;return!e||0===e.length||!ne||ne.size<3?null:Ie(e,Array.from(ne.keys()),Es)},[bt,null==te?void 0:te.edges,ne,Es]);s.useEffect(()=>{if(!te)return;const e=new Map;for(const[s,n]of te.nodeMetrics)e.set(s,n.name);const t=js.current.update(te,e);t.totalCount>0&&(gs(js.current.getLog()),vs(e=>e+t.totalCount))},[te]);const kn=s.useCallback(()=>{vs(0),xs(e=>!e)},[]),Sn=s.useMemo(()=>function(e,t){if(null==e)return null;const s=Math.max(0,e),n=s>0?(Math.log10(s)+4)/4.5:0,a=Math.round(Math.max(0,Math.min(100,100*n)));let i,r;a<10?(i="critical",r="Partition risk"):a<30?(i="poor",r="Weak connectivity"):a<55?(i="fair",r="Moderate resilience"):a<80?(i="good",r="Well connected"):(i="excellent",r="Highly resilient");const[o,l]=pt[i];return{score:a,grade:i,label:r,color:t?o:l}}(wn,je),[wn,je]),Ln=n.jsxs("div",{className:"absolute top-0 left-0 right-0 z-20 px-4 py-3 pointer-events-none flex items-start justify-between",children:[n.jsxs("h1",{className:"type-title text-fg-primary flex items-center gap-2 sm:gap-3 pointer-events-auto",children:[n.jsx(F,{className:"w-5 h-5 sm:w-6 sm:h-6 text-icon-page-title"}),n.jsx("span",{children:"MeshGraph"}),n.jsx(R,{color:"violet",compact:!0,children:"Analytics"})]}),Sn&&n.jsx(M,{content:n.jsxs("div",{className:"max-w-xs space-y-2",children:[n.jsx("div",{className:"font-semibold text-fg-primary",children:"Mesh Resilience Score"}),n.jsx("div",{className:"text-fg-secondary",children:"Derived from the Fiedler eigenvalue (λ₂) — the second-smallest eigenvalue of the graph Laplacian. Measures how well-connected the mesh is and how resistant it is to partitioning."}),n.jsxs("div",{className:"space-y-0.5 font-mono text-[10px]",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Raw λ₂"}),n.jsx("span",{className:"text-fg-primary tabular-nums",children:(null==wn?void 0:wn.toFixed(6))??"—"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Score"}),n.jsxs("span",{className:"tabular-nums",style:{color:Sn.color},children:[Sn.score,"/100"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Grade"}),n.jsx("span",{className:"capitalize",style:{color:Sn.color},children:Sn.grade})]})]}),n.jsxs("div",{className:"pt-1 border-t border-edge-subtle/30 space-y-0.5 text-[10px]",children:[n.jsx("div",{className:"text-fg-muted font-medium",children:"Grade thresholds"}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{style:{color:pt.excellent[0]},children:"Excellent"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"80-100 (λ₂ > 0.3)"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{style:{color:pt.good[0]},children:"Good"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"55-79 (λ₂ 0.03-0.3)"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{style:{color:pt.fair[0]},children:"Fair"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"30-54 (λ₂ 0.003-0.03)"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{style:{color:pt.poor[0]},children:"Poor"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"10-29 (λ₂ 0.0001-0.003)"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{style:{color:pt.critical[0]},children:"Critical"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"<10 (λ₂ ≈ 0)"})]})]}),n.jsx("div",{className:"text-[10px] text-fg-muted italic",children:"Near-zero λ₂ = one bridge away from network partition. Log-scale mapping: small λ₂ changes at low values have outsized impact."})]}),children:n.jsxs("div",{className:"pointer-events-auto surface-control radius-inner px-3 py-1.5 flex items-center gap-2 cursor-help",children:[n.jsxs("div",{className:"flex items-baseline gap-1.5",children:[n.jsx("span",{className:"text-[10px] text-fg-muted uppercase tracking-wider",children:"Resilience"}),n.jsx("span",{className:"text-lg font-semibold tabular-nums leading-none",style:{color:Sn.color},children:Sn.score})]}),n.jsx("div",{className:"w-12 h-1.5 rounded-full bg-subtle-fill overflow-hidden",children:n.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${Sn.score}%`,backgroundColor:Sn.color}})})]})})]}),Dn=(e,t=!1)=>{const s="flex flex-col items-center gap-0.5 px-1.5 py-1 radius-inner transition-all duration-100 active:scale-95";return e&&t?`${s} bg-status-warning/15 text-status-warning shadow-inner`:e?`${s} bg-sys-blue/20 text-sys-blue shadow-inner`:`${s} hover:bg-white/5 hover:scale-105 text-fg-secondary`},Fn=n.jsx("div",{className:"w-px h-6 bg-border-subtle/40 mx-0.5 shrink-0"}),Rn=n.jsxs("div",{className:"absolute top-12 right-3 z-10 flex items-center gap-0.5 surface-control radius-inner px-1.5 py-1",children:[n.jsx(M,{content:"Visible nodes / edges in the graph",children:n.jsxs("span",{className:"text-[9px] text-fg-muted tabular-nums mr-1.5 leading-none cursor-help",children:[Xs.length,n.jsx("br",{}),Ys.length]})}),Fn,n.jsx(M,{content:We?"Hide labels (L)":"Show labels (L)",children:n.jsxs("button",{onClick:()=>_e(e=>!e),className:Dn(!We,!0),children:[We?n.jsx(le,{className:"w-3.5 h-3.5"}):n.jsx(U,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Lbl"})]})}),n.jsx(M,{content:ut?"Disable clustering":"Community clustering",children:n.jsxs("button",{onClick:hn,className:Dn(ut),children:[n.jsx(ve,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Grp"})]})}),n.jsx(M,{content:Kt?"Exit lasso (Esc)":"Lasso selection",children:n.jsxs("button",{onClick:xn,className:Dn(Kt,!0),children:[n.jsx(be,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Sel"})]})}),Fn,n.jsx(M,{content:"Legend",children:n.jsxs("button",{onClick:()=>Ye(e=>!e),className:Dn(qe),children:[n.jsx(ue,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Map"})]})}),n.jsx(M,{content:"Search (/)",children:n.jsxs("button",{onClick:()=>{Te(!0),setTimeout(()=>{var e;return null==(e=Ns.current)?void 0:e.focus()},50)},className:Dn(ze),children:[n.jsx(me,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Fnd"})]})}),Fn,n.jsx(M,{content:Se?"Pause (Space)":"Play (Space)",children:n.jsxs("button",{onClick:nn,className:Dn(!Se),children:[Se?n.jsx(H,{className:"w-3.5 h-3.5 text-sys-green"}):n.jsx(B,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:Se?"Run":"Stop"})]})}),n.jsx(M,{content:"Fit view (F)",children:n.jsxs("button",{onClick:sn,className:Dn(!1),children:[n.jsx(fe,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Fit"})]})}),Fn,n.jsx(M,{content:Jt?"Disable link budget":"Link budget overlay",children:n.jsxs("button",{onClick:()=>Qt(e=>!e),className:Dn(Jt),children:[n.jsx(P,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"RF"})]})}),n.jsx(M,{content:"Anomaly log",children:n.jsxs("button",{onClick:kn,className:`relative ${Dn(hs,!0)}`,children:[n.jsx(ce,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Alert"}),fs>0&&n.jsx("span",{className:"absolute -top-1 -right-0.5 w-3 h-3 rounded-full bg-status-danger text-[7px] font-bold text-white flex items-center justify-center",children:fs>9?"9+":fs})]})}),n.jsx(M,{content:"Export topology",children:n.jsxs("button",{onClick:()=>Yt(e=>!e),className:Dn(Xt),children:[n.jsx(se,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Exp"})]})}),n.jsx(M,{content:"Settings",children:n.jsxs("button",{onClick:()=>Ge(e=>!e),className:Dn($e),children:[n.jsx(he,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Cfg"})]})}),Fn,n.jsx(M,{content:He?"Exit fullscreen":"Fullscreen",children:n.jsxs("button",{onClick:un,className:Dn(He),children:[He?n.jsx(X,{className:"w-3.5 h-3.5"}):n.jsx(_,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Max"})]})})]}),Mn=n.jsxs(ht,{id:"settings",title:"Graph Settings",icon:n.jsx(he,{}),open:$e,onClose:()=>Ge(!1),defaultPosition:{x:"undefined"!=typeof window?window.innerWidth-308:600,y:60},defaultSize:{width:288,height:420},minSize:{width:260,height:200},maxSize:{width:400,height:600},headerActions:n.jsx(M,{content:"Reset to defaults",children:n.jsx("button",{onClick:Bs,className:"p-0.5 radius-badge hover-bg transition-base",children:n.jsx(ye,{className:"w-2.5 h-2.5 text-fg-muted"})})}),children:[n.jsx("div",{className:"flex border-b border-edge-subtle",children:["simulation","points","links","rendering"].map(e=>n.jsx("button",{onClick:()=>Ze(e),className:"flex-1 px-2 py-1.5 text-[10px] font-medium capitalize transition-colors "+(Oe===e?"text-sys-blue border-b-2 border-sys-blue":"text-fg-muted hover:text-fg-secondary"),children:e},e))}),n.jsxs("div",{className:"p-3 space-y-3",children:["simulation"===Oe&&n.jsxs(n.Fragment,{children:[n.jsx(Ot,{label:"Gravity",value:Rs.simulationGravity,onChange:e=>Hs("simulationGravity",e),min:0,max:1,step:.01}),n.jsx(Ot,{label:"Repulsion",value:Rs.simulationRepulsion,onChange:e=>Hs("simulationRepulsion",e),min:0,max:5,step:.1}),n.jsx(Ot,{label:"Link Spring",value:Rs.simulationLinkSpring,onChange:e=>Hs("simulationLinkSpring",e),min:0,max:2,step:.05}),n.jsx(Ot,{label:"Link Distance",value:Rs.simulationLinkDistance,onChange:e=>Hs("simulationLinkDistance",e),min:1,max:100,step:1}),n.jsx(Ot,{label:"Friction",value:Rs.simulationFriction,onChange:e=>Hs("simulationFriction",e),min:0,max:1,step:.01}),n.jsx(Ot,{label:"Center Force",value:Rs.simulationCenter,onChange:e=>Hs("simulationCenter",e),min:0,max:1,step:.01}),n.jsx(Ot,{label:"Decay",value:Rs.simulationDecay,onChange:e=>Hs("simulationDecay",e),min:100,max:2e4,step:100}),n.jsx(Ot,{label:"Repulsion Theta",value:Rs.simulationRepulsionTheta,onChange:e=>Hs("simulationRepulsionTheta",e),min:.1,max:3,step:.05}),n.jsx(Ot,{label:"Mouse Repulsion",value:Rs.simulationRepulsionFromMouse,onChange:e=>Hs("simulationRepulsionFromMouse",e),min:0,max:10,step:.5})]}),"points"===Oe&&n.jsxs(n.Fragment,{children:[n.jsx(Ot,{label:"Size Scale",value:Rs.pointSizeScale,onChange:e=>Hs("pointSizeScale",e),min:.1,max:5,step:.1}),n.jsx(Ot,{label:"Opacity",value:Rs.pointOpacity,onChange:e=>Hs("pointOpacity",e),min:0,max:1,step:.05}),n.jsx(Ot,{label:"Greyout Opacity",value:Rs.pointGreyoutOpacity,onChange:e=>Hs("pointGreyoutOpacity",e),min:0,max:1,step:.05}),n.jsx(Zt,{label:"Scale on Zoom",checked:Rs.scalePointsOnZoom,onChange:e=>Hs("scalePointsOnZoom",e)}),n.jsx(Zt,{label:"Hover Ring",checked:Rs.renderHoveredPointRing,onChange:e=>Hs("renderHoveredPointRing",e)})]}),"links"===Oe&&n.jsxs(n.Fragment,{children:[n.jsx(Zt,{label:"Show Links",checked:Rs.renderLinks,onChange:e=>Hs("renderLinks",e)}),n.jsx(Zt,{label:"Curved Links",checked:Rs.curvedLinks,onChange:e=>Hs("curvedLinks",e)}),n.jsx(Zt,{label:"Show Arrows",checked:Rs.linkDefaultArrows,onChange:e=>Hs("linkDefaultArrows",e)}),n.jsx(Ot,{label:"Width Scale",value:Rs.linkWidthScale,onChange:e=>Hs("linkWidthScale",e),min:.1,max:5,step:.1}),n.jsx(Ot,{label:"Opacity",value:Rs.linkOpacity,onChange:e=>Hs("linkOpacity",e),min:0,max:1,step:.05}),n.jsx(Ot,{label:"Greyout Opacity",value:Rs.linkGreyoutOpacity,onChange:e=>Hs("linkGreyoutOpacity",e),min:0,max:1,step:.05}),Rs.curvedLinks&&n.jsx(Ot,{label:"Curve Weight",value:Rs.curvedLinkWeight,onChange:e=>Hs("curvedLinkWeight",e),min:0,max:1,step:.05}),Rs.linkDefaultArrows&&n.jsx(Ot,{label:"Arrow Size",value:Rs.linkArrowsSizeScale,onChange:e=>Hs("linkArrowsSizeScale",e),min:.1,max:3,step:.1}),n.jsx(Zt,{label:"Scale on Zoom",checked:Rs.scaleLinksOnZoom,onChange:e=>Hs("scaleLinksOnZoom",e)})]}),"rendering"===Oe&&n.jsxs(n.Fragment,{children:[n.jsx(Ot,{label:"Space Size",value:Rs.spaceSize,onChange:e=>Hs("spaceSize",e),min:1024,max:16384,step:512}),n.jsx("div",{className:"pt-2 border-t border-edge-subtle/50",children:n.jsx("p",{className:"text-[9px] text-fg-muted",children:"Space size defines the simulation boundary. Larger values allow more spread."})})]})]})]}),Hn=n.jsxs(ht,{id:"export",title:"Export Topology",icon:n.jsx(se,{}),open:Xt,onClose:()=>Yt(!1),defaultPosition:{x:"undefined"!=typeof window?window.innerWidth-280:600,y:100},defaultSize:{width:256,height:320},minSize:{width:220,height:150},autoHeight:!0,children:[n.jsx("div",{className:"py-1",children:[{label:"Full Topology (JSON)",format:"json",dataset:"full",desc:"All data: nodes, edges, paths, TX delay"},{label:"Gephi Graph (GEXF)",format:"gexf",dataset:"full",desc:"Import into Gephi for advanced analysis"},{label:"Nodes (CSV)",format:"csv",dataset:"nodes",desc:"Node metrics: centrality, class, signal"},{label:"Edges (CSV)",format:"csv",dataset:"edges",desc:"Edge metrics: confidence, symmetry, type"},{label:"Path Health (CSV)",format:"csv",dataset:"pathHealth",desc:"Route health scores and trends"},{label:"TX Delay (CSV)",format:"csv",dataset:"txDelay",desc:"TX delay recommendations per node"}].map(({label:e,format:t,dataset:s,desc:a})=>n.jsxs("button",{onClick:()=>jn(t,s),className:"w-full flex flex-col px-3 py-2 text-left hover-bg transition-base",children:[n.jsx("span",{className:"text-[11px] font-medium text-fg-primary",children:e}),n.jsx("span",{className:"text-[9px] text-fg-muted",children:a})]},`${t}-${s}`))}),n.jsx("div",{className:"px-3 py-1.5 border-t border-edge-subtle",children:n.jsxs("span",{className:"text-[9px] text-fg-muted",children:[(null==($=null==te?void 0:te.nodeMetrics)?void 0:$.size)??0," nodes · ",(null==(I=null==te?void 0:te.validatedEdges)?void 0:I.length)??0," edges"]})})]}),Bn={info:{dot:"bg-sys-blue",text:"text-fg-secondary"},warning:{dot:"bg-status-warning",text:"text-status-warning"},critical:{dot:"bg-status-danger",text:"text-status-danger"}},Pn={"edge-appeared":"Link Discovered","edge-disappeared":"Link Lost","ghost-appeared":"Ghost Discovered","ghost-disappeared":"Ghost Resolved","betweenness-shift":"Traffic Rerouting","community-change":"Community Change","class-change":"Role Change","node-appeared":"Node Appeared","node-disappeared":"Node Dropped"},En=(e,t,s)=>null==t||""===t?null:n.jsxs("div",{className:"flex justify-between gap-2",children:[n.jsx("span",{className:"text-fg-muted",children:e}),n.jsx("span",{className:`tabular-nums text-right ${s??"text-fg-secondary"}`,children:t})]}),zn=e=>{const t=[];return e.isZeroHop&&t.push({label:"Zero-Hop",color:"text-status-warning"}),e.isDirectPath&&t.push({label:"Direct",color:"text-sys-blue"}),e.isBackbone&&t.push({label:"Backbone",color:"text-fg-primary"}),e.isLoop&&t.push({label:"Loop",color:"text-sys-indigo"}),0===t.length?null:n.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.map(e=>n.jsx("span",{className:`text-[8px] font-medium uppercase tracking-wider px-1 py-px radius-badge bg-subtle-fill ${e.color}`,children:e.label},e.label))})},An=e=>n.jsxs("div",{className:"text-[9px] space-y-0.5",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"capitalize font-medium text-fg-secondary",children:e.nodeClass}),e.isZeroHop&&n.jsx("span",{className:"text-[8px] font-medium uppercase tracking-wider px-1 py-px radius-badge bg-subtle-fill text-status-warning",children:"Neighbor"})]}),En("Degree",e.degree),e.betweenness>.01&&En("Betweenness",e.betweenness.toFixed(3)),En("Packets",e.packetCount),En("Community",`#${e.communityId}`),En("Activity",e.activityLevel),null!=e.avgRssi&&En("RSSI",`${e.avgRssi.toFixed(0)} dBm`),null!=e.avgSnr&&En("SNR",`${e.avgSnr.toFixed(1)} dB`)]}),Tn=e=>n.jsxs("div",{className:"text-[9px] space-y-0.5",children:[null!=e.previousValue&&null!=e.currentValue&&n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx("span",{className:"text-fg-muted font-mono",children:"number"==typeof e.previousValue?e.previousValue.toFixed(3):e.previousValue}),n.jsx("span",{className:"text-fg-muted/40",children:"→"}),n.jsx("span",{className:"text-fg-secondary font-mono",children:"number"==typeof e.currentValue?e.currentValue.toFixed(3):e.currentValue}),"number"==typeof e.previousValue&&"number"==typeof e.currentValue&&n.jsxs("span",{className:e.currentValue>e.previousValue?"text-sys-green":"text-signal-poor",children:["(",e.currentValue>e.previousValue?"+":"",(e.currentValue-e.previousValue).toFixed(3),")"]})]}),e.nodeDetail&&n.jsxs(n.Fragment,{children:[En("Class",e.nodeDetail.nodeClass),En("Degree",e.nodeDetail.degree),e.nodeDetail.betweenness>.01&&En("Betweenness",e.nodeDetail.betweenness.toFixed(3))]})]}),$n=s.useCallback(e=>{ys(t=>t===e?null:e)},[]),In=n.jsxs(ht,{id:"anomaly",title:"Anomaly Log",icon:n.jsx(ce,{}),open:hs,onClose:()=>xs(!1),defaultPosition:{x:"undefined"!=typeof window?window.innerWidth-328:600,y:100},defaultSize:{width:308,height:400},minSize:{width:260,height:180},maxSize:{width:440,height:700},headerActions:ps.length>0?n.jsx("button",{onClick:()=>{js.current.clear(),gs([]),ys(null)},className:"p-0.5 radius-badge hover-bg transition-base",title:"Clear all",children:n.jsx(ye,{className:"w-2.5 h-2.5 text-fg-muted"})}):void 0,children:[0===ps.length?n.jsxs("div",{className:"px-3 py-6 text-center",children:[n.jsx(ce,{className:"w-5 h-5 text-fg-muted mx-auto mb-1.5"}),n.jsx("p",{className:"text-[11px] text-fg-muted",children:"No anomalies detected yet"}),n.jsx("p",{className:"text-[9px] text-fg-muted/60 mt-0.5",children:"Changes appear after topology recomputes"})]}):n.jsx("div",{className:"overflow-y-auto",children:ps.slice(0,50).map(e=>{const t=Bn[e.severity],s=E(e.detectedAt/1e3),a=bs===e.id,i=!(!e.edgeDetail&&!e.nodeDetail&&null==e.previousValue);return n.jsxs("div",{className:`border-b border-edge-subtle/50 last:border-0 transition-colors ${i?"cursor-pointer hover-bg":""} ${a?"bg-subtle-fill/50":""}`,onClick:i?()=>$n(e.id):void 0,children:[n.jsxs("div",{className:"flex items-start gap-2 px-3 py-1.5",children:[n.jsx("span",{className:`w-1.5 h-1.5 rounded-full shrink-0 mt-1.5 ${t.dot}`}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:`text-[10px] leading-tight ${t.text}`,children:e.description}),n.jsxs("p",{className:"text-[9px] text-fg-muted/60 mt-0.5",children:[Pn[e.category]??e.category," · ",s]})]}),i&&n.jsx(z,{className:"w-3 h-3 text-fg-muted/40 shrink-0 mt-0.5 transition-transform duration-150 "+(a?"rotate-180":"")})]}),a&&n.jsx("div",{className:"px-3 pb-2 pl-6",children:n.jsxs("div",{className:"border-l-2 border-edge-subtle/60 pl-2 py-0.5",children:[e.edgeDetail&&(r=e.edgeDetail,o=e.category,n.jsxs("div",{className:"text-[9px] space-y-0.5",children:[(r.fromClass||r.toClass)&&n.jsxs("div",{className:"flex items-center gap-1 text-fg-muted",children:[n.jsx("span",{className:"capitalize",children:r.fromClass??"?"}),n.jsx("span",{className:"text-fg-muted/40",children:"↔"}),n.jsx("span",{className:"capitalize",children:r.toClass??"?"})]}),"edge-appeared"===o&&r.packetCount>0&&n.jsxs(n.Fragment,{children:[En("Packets",r.packetCount),En("Confidence",`${(100*r.confidence).toFixed(0)}%`,r.confidence>=.8?"text-sys-green":r.confidence>=.5?"text-sys-indigo":"text-signal-poor"),En("Symmetry",`${(100*r.symmetryRatio).toFixed(0)}%`)]}),r.isZeroHop&&null!=r.avgRssi&&En("RSSI",`${r.avgRssi.toFixed(0)} dBm`),r.isZeroHop&&null!=r.avgSnr&&En("SNR",`${r.avgSnr.toFixed(1)} dB`),null!=r.fromBetweenness&&r.fromBetweenness>.01&&En(`${r.fromName??"A"} centrality`,r.fromBetweenness.toFixed(3)),null!=r.toBetweenness&&r.toBetweenness>.01&&En(`${r.toName??"B"} centrality`,r.toBetweenness.toFixed(3)),zn(r)]})),e.nodeDetail&&!e.edgeDetail&&("node-appeared"===e.category||"node-disappeared"===e.category)&&An(e.nodeDetail),("betweenness-shift"===e.category||"community-change"===e.category||"class-change"===e.category)&&Tn(e)]})})]},e.id);var r,o})}),ps.length>0&&n.jsx("div",{className:"px-3 py-1.5 border-t border-edge-subtle",children:n.jsxs("span",{className:"text-[9px] text-fg-muted",children:[ps.length," total · showing ",Math.min(ps.length,50)]})})]}),Gn=s.useMemo(()=>{const e={};for(const t of Is)e[t.edgeType]=(e[t.edgeType]??0)+1;return e},[Is]),On=n.jsxs(ht,{id:"legend",title:"Legend",icon:n.jsx(ue,{}),open:qe,onClose:()=>Ye(!1),defaultPosition:{x:12,y:60},defaultSize:{width:224,height:400},minSize:{width:200,height:150},maxSize:{width:360,height:700},autoHeight:!0,children:[n.jsxs("div",{className:"border-b border-edge-subtle",children:[n.jsxs("button",{onClick:()=>st(e=>!e),className:"w-full flex items-center gap-1.5 px-3 py-1.5 text-[10px] font-medium text-fg-secondary hover-bg transition-base",children:[tt?n.jsx(z,{className:"w-3 h-3"}):n.jsx(xe,{className:"w-3 h-3"}),"Nodes",n.jsx("span",{className:"text-fg-muted ml-auto tabular-nums",children:Xs.length})]}),tt&&n.jsx("div",{className:"px-2 pb-2 space-y-0.5",children:[["local","Local"],["hub","Hub"],["gateway","Gateway"],["backbone","Backbone"],["neighbor","Neighbor"],["mobile","Mobile"],["ghost","Ghost"],["standard","Standard"]].map(([e,t])=>{const s=ie[e]??0;if(0===s&&"local"!==e)return null;const a=ct.has(e);return n.jsx(M,{content:Rt[e],children:n.jsxs("button",{onClick:()=>mn(e),className:"w-full flex items-center gap-2 px-2 py-1 radius-badge transition-base text-left "+(a?"opacity-40":"hover-bg"),children:[n.jsx("span",{className:"w-2.5 h-2.5 rounded-full shrink-0",style:{backgroundColor:Ne[e]}}),n.jsx("span",{className:"text-[10px] text-fg-secondary flex-1",children:t}),n.jsx("span",{className:"text-[10px] text-fg-muted tabular-nums",children:s})]})},e)})})]}),n.jsxs("div",{className:"border-b border-edge-subtle",children:[n.jsxs("button",{onClick:()=>it(e=>!e),className:"w-full flex items-center gap-1.5 px-3 py-1.5 text-[10px] font-medium text-fg-secondary hover-bg transition-base",children:[nt?n.jsx(z,{className:"w-3 h-3"}):n.jsx(xe,{className:"w-3 h-3"}),"Edges",n.jsx("span",{className:"text-fg-muted ml-auto tabular-nums",children:Ys.length})]}),nt&&n.jsx("div",{className:"px-2 pb-2 space-y-0.5",children:[{type:"zero-hop",label:"Zero-Hop RF"},{type:"direct-path",label:"Direct Path"},{type:"loop",label:"Loop"},{type:"backbone",label:"Backbone"},{type:"standard",label:"Standard"},{type:"ghost",label:"Ghost"}].map(({type:e,label:t})=>{const s=Gn[e]??0;if(0===s)return null;const a=Pt(e,.8,je);return n.jsx(M,{content:zt[e],children:n.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 cursor-help",children:[n.jsx("span",{className:"w-4 h-0.5 shrink-0 rounded-full",style:{backgroundColor:a}}),n.jsx("span",{className:"text-[10px] text-fg-secondary flex-1",children:t}),n.jsx("span",{className:"text-[10px] text-fg-muted tabular-nums",children:s})]})},e)})})]}),Jt&&qs&&n.jsxs("div",{className:"border-b border-edge-subtle",children:[n.jsxs("div",{className:"px-3 py-1.5 text-[10px] font-medium text-sys-green flex items-center gap-1.5",children:[n.jsx(P,{className:"w-3 h-3"}),"Link Budget",n.jsxs("span",{className:"text-fg-muted ml-auto tabular-nums",children:[qs.analyzedEdges+qs.rssiOnlyEdges,"/",qs.totalEdges]})]}),n.jsxs("div",{className:"px-3 pb-2 space-y-0.5",children:[(()=>{const e=Gs&&Gs>1e5?Gs/1e6:Gs||915,t=ss??Zs??12,s=as??(Os&&Os>1e3?Os/1e3:Os||125),a=rs??Vs??5,i=es??Ws??22,r=Ve(t,s,a),o=ls??r,l=Ke(1e3*s),c=ds??l,d=(null==Ks?void 0:Ks.filter(e=>e.isTraceEstimated).length)??0,u=(null==Ks?void 0:Ks.filter(e=>e.isZeroHop).length)??0,m=null!=es||null!=ss||null!=as||null!=rs||null!=ls,h="w-10 px-1 py-0 text-[10px] text-right tabular-nums bg-subtle-fill border border-edge-subtle rounded text-fg-secondary focus:outline-none focus:border-sys-blue";return n.jsxs("div",{className:"pb-1 mb-1 border-b border-edge-subtle space-y-0.5",children:[n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx("span",{className:"text-fg-muted",children:"Frequency"}),n.jsxs("span",{className:"text-fg-secondary tabular-nums",children:[e.toFixed(3)," MHz"]})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px] gap-1",children:[n.jsx("span",{className:"text-fg-muted",children:"SF"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("select",{value:t,onChange:e=>{const t=parseInt(e.target.value,10);ns(t===(Zs??12)?null:t)},className:h+" w-12 appearance-none",children:[7,8,9,10,11,12].map(e=>n.jsxs("option",{value:e,children:["SF",e]},e))}),null!=ss&&n.jsx("button",{onClick:()=>ns(null),className:"text-[8px] text-sys-blue hover:underline",title:"Reset",children:"↺"})]})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px] gap-1",children:[n.jsx("span",{className:"text-fg-muted",children:"BW"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("select",{value:s,onChange:e=>{const t=parseFloat(e.target.value);is(t===(Os&&Os>1e3?Os/1e3:Os||125)?null:t)},className:h+" w-14 appearance-none",children:[62.5,125,250,500].map(e=>n.jsxs("option",{value:e,children:[e," kHz"]},e))}),null!=as&&n.jsx("button",{onClick:()=>is(null),className:"text-[8px] text-sys-blue hover:underline",title:"Reset",children:"↺"})]})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px] gap-1",children:[n.jsx("span",{className:"text-fg-muted",children:"CR"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("select",{value:a,onChange:e=>{const t=parseInt(e.target.value,10);os(t===(Vs??5)?null:t)},className:h+" w-12 appearance-none",children:[5,6,7,8].map(e=>n.jsxs("option",{value:e,children:["4/",e]},e))}),null!=rs&&n.jsx("button",{onClick:()=>os(null),className:"text-[8px] text-sys-blue hover:underline",title:"Reset",children:"↺"})]})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px] gap-1",children:[n.jsx("span",{className:"text-fg-muted",children:"TX Power"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("input",{type:"number",min:1,max:36,step:1,value:i,onChange:e=>{const t=parseInt(e.target.value,10);isNaN(t)||ts(t)},onBlur:e=>{const t=parseInt(e.target.value,10);isNaN(t)?ts(null):ts(Math.max(1,Math.min(36,t)))},className:h}),n.jsx("span",{className:"text-fg-muted",children:"dBm"}),null!=es&&n.jsx("button",{onClick:()=>ts(null),className:"text-[8px] text-sys-blue hover:underline",title:"Reset",children:"↺"})]})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px] gap-1",children:[n.jsx("span",{className:"text-fg-muted",children:"Sensitivity"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("input",{type:"number",min:-150,max:-80,step:.5,value:Math.round(10*o)/10,onChange:e=>{const t=parseFloat(e.target.value);isNaN(t)||cs(t)},onBlur:e=>{const t=parseFloat(e.target.value);isNaN(t)?cs(null):cs(Math.max(-150,Math.min(-80,t)))},className:h+" w-12"}),n.jsx("span",{className:"text-fg-muted",children:"dBm"}),null!=ls&&n.jsx("button",{onClick:()=>cs(null),className:"text-[8px] text-sys-blue hover:underline",title:"Reset",children:"↺"})]})]}),d>0&&n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx("span",{className:"text-fg-muted",children:"Noise Floor"}),n.jsxs("span",{className:"text-fg-secondary tabular-nums "+(null!=ds?"":"italic text-fg-muted"),children:[c.toFixed(1)," dBm",null!=ds?"":" (est.)"]})]}),m&&n.jsx("button",{onClick:()=>{ts(null),ns(null),is(null),os(null),cs(null)},className:"w-full text-[9px] text-sys-blue hover:underline text-center pt-0.5",children:"Reset all to radio config"}),(u>0||d>0)&&n.jsxs("div",{className:"flex items-center justify-between text-[10px] pt-0.5",children:[n.jsx("span",{className:"text-fg-muted",children:"Sources"}),n.jsxs("span",{className:"text-fg-secondary tabular-nums",children:[u>0&&n.jsxs("span",{children:[u," direct"]}),u>0&&d>0&&n.jsx("span",{className:"text-fg-muted",children:" · "}),d>0&&n.jsxs("span",{className:"text-sys-indigo",children:[d," trace"]})]})]})]})})(),null!=qs.avgMarginDb&&n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx("span",{className:"text-fg-muted",children:"Avg Margin"}),n.jsxs("span",{className:"text-fg-secondary tabular-nums",children:[qs.avgMarginDb>0?"+":"",qs.avgMarginDb.toFixed(1)," dB"]})]}),["excellent","good","fair","marginal","critical"].map(e=>{const t=qs.marginCounts[e];return 0===t?null:n.jsxs("div",{className:"flex items-center gap-2 px-1 py-0.5",children:[n.jsx("span",{className:"w-3 h-0.5 shrink-0 rounded-full",style:{backgroundColor:Je[e]}}),n.jsx("span",{className:"text-[10px] text-fg-secondary flex-1 capitalize",children:e}),n.jsx("span",{className:"text-[10px] text-fg-muted tabular-nums",children:t})]},e)}),qs.anomalousCount>0&&n.jsxs("div",{className:"flex items-center justify-between text-[10px] pt-0.5",children:[n.jsx("span",{className:"text-status-warning",children:"Anomalous"}),n.jsx("span",{className:"text-status-warning tabular-nums",children:qs.anomalousCount})]})]})]}),Nn&&Nn.atRiskPaths.length>0&&n.jsxs("div",{className:"border-b border-edge-subtle",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsxs("button",{onClick:()=>ot(e=>!e),className:"flex-1 flex items-center gap-1.5 px-3 py-1.5 text-[10px] font-medium text-status-warning hover-bg transition-base",children:[rt?n.jsx(z,{className:"w-3 h-3"}):n.jsx(xe,{className:"w-3 h-3"}),"At-Risk Paths",n.jsxs("span",{className:"text-fg-muted ml-auto tabular-nums",children:[Nn.criticalCount>0&&n.jsxs("span",{className:"text-status-danger",children:[Nn.criticalCount,"c"]}),Nn.criticalCount>0&&Nn.highCount>0&&" ",Nn.highCount>0&&n.jsxs("span",{className:"text-status-warning",children:[Nn.highCount,"h"]}),(Nn.criticalCount>0||Nn.highCount>0)&&Nn.moderateCount>0&&" ",Nn.moderateCount>0&&n.jsxs("span",{className:"text-fg-muted",children:[Nn.moderateCount,"m"]})]})]}),n.jsx(M,{content:n.jsxs("div",{className:"max-w-xs space-y-1.5",children:[n.jsx("div",{className:"font-semibold text-fg-primary",children:"Predictive Path Failure"}),n.jsx("div",{className:"text-fg-secondary text-[11px]",children:"Identifies paths at risk of failure by combining four weighted factors. Paths below the moderate threshold (35%) are not shown."}),n.jsxs("div",{className:"pt-1 border-t border-edge-subtle/30 space-y-0.5 text-[10px]",children:[n.jsx("div",{className:"text-fg-muted font-medium",children:"Factor weights"}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-secondary",children:"Declining usage"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"35%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-secondary",children:"Weak link certainty"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"30%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-secondary",children:"No alternate paths"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"20%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-secondary",children:"Low signal margin"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"15%"})]})]}),n.jsxs("div",{className:"pt-1 border-t border-edge-subtle/30 space-y-0.5 text-[10px]",children:[n.jsx("div",{className:"text-fg-muted font-medium",children:"Risk thresholds"}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-status-danger",children:"Critical"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"≥75% — failure likely imminent"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-status-warning",children:"High"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"55-74% — significant risk"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Moderate"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"35-54% — worth monitoring"})]})]}),n.jsxs("div",{className:"pt-1 border-t border-edge-subtle/30 text-[10px] text-fg-muted font-mono space-y-0.5",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:"Edges analyzed"}),n.jsx("span",{className:"tabular-nums",children:Nn.edgesAnalyzed})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:"With signal data"}),n.jsx("span",{className:"tabular-nums",children:Nn.edgesWithSignal})]})]})]}),children:n.jsx("span",{className:"px-2 py-1.5 text-fg-muted cursor-help",children:n.jsx(ce,{className:"w-3 h-3"})})})]}),rt&&n.jsx("div",{className:"px-2 pb-2 space-y-1",children:Nn.atRiskPaths.slice(0,8).map(e=>{const t="critical"===e.riskLevel?"#EF4444":"high"===e.riskLevel?"#F97316":"#FBBF24",s="imminent"===e.urgency?"IMM":"near-term"===e.urgency?"NEAR":"WATCH";return n.jsx(M,{content:n.jsxs("div",{className:"max-w-xs space-y-1.5",children:[n.jsx("div",{className:"font-semibold text-fg-primary font-mono text-[11px]",children:e.hops.join(" → ")}),n.jsxs("div",{className:"space-y-0.5 text-[10px]",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Risk score"}),n.jsxs("span",{className:"font-semibold tabular-nums",style:{color:t},children:[(100*e.riskScore).toFixed(1),"%"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Health score"}),n.jsxs("span",{className:"text-fg-primary tabular-nums",children:[(100*e.healthScore).toFixed(0),"%"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Obs. trend"}),n.jsxs("span",{className:"tabular-nums "+(e.observationTrend<0?"text-status-danger":"text-fg-secondary"),children:[e.observationTrend>0?"+":"",e.observationTrend.toFixed(3)]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Alt. paths"}),n.jsx("span",{className:"tabular-nums "+(0===e.alternatePathsCount?"text-status-danger":"text-fg-secondary"),children:e.alternatePathsCount})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Urgency"}),n.jsx("span",{className:"capitalize",style:{color:t},children:e.urgency})]})]}),e.factors.length>0&&n.jsxs("div",{className:"pt-1 border-t border-edge-subtle/30 space-y-0.5 text-[10px]",children:[n.jsx("div",{className:"text-fg-muted font-medium",children:"Contributing factors"}),e.factors.map((e,t)=>n.jsxs("div",{className:"space-y-0.5",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-secondary",children:e.name}),n.jsxs("span",{className:"text-fg-muted tabular-nums",children:[(e.score*e.weight*100).toFixed(1),"% (",(100*e.weight).toFixed(0),"w × ",(100*e.score).toFixed(0),"s)"]})]}),n.jsx("div",{className:"text-fg-muted pl-1",children:e.description})]},t))]})]}),children:n.jsxs("div",{className:"px-2 py-1 radius-badge bg-subtle-fill/30 cursor-help",children:[n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx("span",{className:"w-1.5 h-1.5 rounded-full shrink-0",style:{backgroundColor:t}}),n.jsx("span",{className:"text-[10px] text-fg-secondary font-mono truncate flex-1",children:e.hops.join(" → ")}),n.jsx("span",{className:"text-[8px] uppercase tracking-wide px-1 py-px radius-badge",style:{backgroundColor:`${t}20`,color:t},children:s}),n.jsxs("span",{className:"text-[10px] tabular-nums font-semibold",style:{color:t},children:[(100*e.riskScore).toFixed(0),"%"]})]}),n.jsx("div",{className:"flex flex-wrap gap-1 mt-0.5 pl-3",children:e.factors.map((t,s)=>n.jsxs("span",{className:"text-[8px] text-fg-muted",children:[t.name," (",(t.score*t.weight*100).toFixed(0),"%)",s<e.factors.length-1?" ·":""]},s))})]})},e.pathKey)})})]}),n.jsxs("div",{className:"px-3 py-2 space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(M,{content:"Number of detected community clusters via graph partitioning",children:n.jsx("span",{className:"text-fg-muted cursor-help",children:"Communities"})}),n.jsx("span",{className:"text-fg-secondary tabular-nums",children:"louvain"===bt&&Cn?Cn.numCommunities:re})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(M,{content:"Spectral uses eigenvector decomposition; Louvain maximizes modularity iteratively. Click to switch.",children:n.jsx("span",{className:"text-fg-muted cursor-help",children:"Algorithm"})}),n.jsx("button",{onClick:()=>Mt(e=>"spectral"===e?"louvain":"spectral"),className:"text-sys-blue hover:underline cursor-pointer",children:"spectral"===bt?"Spectral":"Louvain"})]}),"louvain"===bt&&Cn&&n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(M,{content:"Louvain modularity score — quality of community partition (higher = better defined communities)",children:n.jsx("span",{className:"text-fg-muted cursor-help",children:"Modularity Q"})}),n.jsx("span",{className:"text-fg-secondary tabular-nums",children:Cn.modularity.toFixed(4)})]}),"louvain"===bt&&n.jsxs("div",{className:"mt-1.5 pt-1.5 border-t border-edge-subtle space-y-1.5",children:[n.jsx(Ot,{label:"Resolution γ",value:Et,onChange:At,min:.01,max:5,step:.01}),n.jsx(Ot,{label:"K-weight",value:Wt,onChange:Vt,min:.01,max:5,step:.01}),(1!==Et||1!==Wt)&&n.jsx("button",{onClick:()=>{At(1),Vt(1)},className:"w-full text-[10px] text-sys-blue hover:underline text-center",children:"Reset defaults"})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(M,{content:"Redundant path cycles in the topology — indicates alternate routing options",children:n.jsx("span",{className:"text-fg-muted cursor-help",children:"Loops"})}),n.jsx("span",{className:"text-fg-secondary tabular-nums",children:(null==(G=null==te?void 0:te.loops)?void 0:G.length)??0})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(M,{content:"High-betweenness edges that carry disproportionate traffic flow",children:n.jsx("span",{className:"text-fg-muted cursor-help",children:"Backbone"})}),n.jsx("span",{className:"text-fg-secondary tabular-nums",children:(null==(O=null==te?void 0:te.backboneEdges)?void 0:O.length)??0})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(M,{content:"Unresolved prefix nodes inferred by Viterbi HMM from repeated path patterns",children:n.jsx("span",{className:"text-fg-muted cursor-help",children:"Ghosts"})}),n.jsx("span",{className:"text-fg-secondary tabular-nums",children:ae.length})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(M,{content:"Community-aware node coloring — groups nodes by cluster assignment",children:n.jsx("span",{className:"text-fg-muted cursor-help",children:"Clustering"})}),n.jsx("span",{className:"tabular-nums "+(ut?"text-sys-blue":"text-fg-muted"),children:ut?"On":"Off"})]}),null!=wn&&n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(M,{content:"Algebraic connectivity — 2nd-smallest eigenvalue of the graph Laplacian. Near-zero = one bridge from network partition.",children:n.jsx("span",{className:"text-fg-muted cursor-help",children:"Fiedler λ₂"})}),n.jsx("span",{className:"tabular-nums "+(wn<.01?"text-status-warning":"text-fg-secondary"),children:wn.toFixed(4)})]}),ct.size>0&&n.jsxs("button",{onClick:()=>dt(new Set),className:"w-full mt-1 text-[10px] text-sys-blue hover:underline text-center",children:["Clear filters (",ct.size,")"]})]})]}),Zn=n.jsx(m,{children:ze&&n.jsx(h.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.15},className:"absolute top-4 left-1/2 -translate-x-1/2 z-30 w-80",children:n.jsxs("div",{className:"surface-elevated radius-inset shadow-2xl overflow-hidden",children:[n.jsxs("div",{className:"flex items-center gap-2 px-3 py-2.5 border-b border-edge-subtle",children:[n.jsx(me,{className:"w-4 h-4 text-fg-muted shrink-0"}),n.jsx("input",{ref:Ns,type:"text",value:Pe,onChange:e=>Ee(e.target.value),placeholder:"Search by name or prefix...",className:"flex-1 bg-transparent text-sm text-fg-primary placeholder:text-fg-muted focus:outline-none",onKeyDown:e=>{"Escape"===e.key?(Te(!1),Ee("")):"Enter"===e.key&&cn.length>0&&dn(cn[0])}}),Pe&&n.jsx("button",{onClick:()=>Ee(""),className:"p-0.5 radius-badge hover-bg transition-base",children:n.jsx(p,{className:"w-3 h-3 text-fg-muted"})})]}),cn.length>0&&n.jsx("div",{className:"max-h-64 overflow-y-auto",children:cn.map((e,t)=>n.jsxs("button",{onClick:()=>dn(e),className:"w-full flex items-center gap-3 px-3 py-2 text-left hover-bg transition-base "+(0===t?"bg-subtle-fill/50":""),children:[n.jsx("span",{className:"w-2.5 h-2.5 rounded-full shrink-0",style:{backgroundColor:Ne[e.nodeClass]}}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-sm text-fg-primary truncate",children:e.name||e.prefix}),e.name&&n.jsx("div",{className:"text-[10px] text-fg-muted",children:e.prefix})]}),n.jsx(de,{className:"w-3 h-3 text-fg-muted shrink-0"})]},e.id))}),Pe&&0===cn.length&&n.jsx("div",{className:"px-3 py-4 text-center text-sm text-fg-muted",children:"No nodes found"}),!Pe&&n.jsx("div",{className:"px-3 py-2 type-data-xs text-fg-muted",children:"Type to search • Enter to select • Esc to close"})]})})});return W?0===As.length?n.jsxs("div",{className:"relative h-[calc(100dvh-56px)] lg:h-dvh min-h-[500px] -mx-4 sm:-mx-6 lg:-mx-8 -mt-5 -mb-4 sm:-mb-6 lg:-mb-8 overflow-hidden",children:[Ln,n.jsx("div",{className:"absolute inset-0 bg-body flex items-center justify-center",children:n.jsx(Gt,{})})]}):Cs?He?n.jsxs("div",{className:"fixed inset-0 z-50 bg-body flex flex-col overflow-hidden",children:[n.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5 surface-header z-10",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(F,{className:"w-5 h-5 text-icon-page-title"}),n.jsxs("h1",{className:"type-title text-fg-primary flex items-center gap-2",children:["MeshGraph",n.jsx(R,{color:"violet",compact:!0,children:"Analytics"})]}),n.jsxs("span",{className:"text-[10px] text-fg-muted tabular-nums",children:[Xs.length," nodes • ",Ys.length," edges"]})]}),n.jsx(M,{content:"Exit fullscreen",children:n.jsx("button",{onClick:un,className:"p-1.5 radius-inner hover-bg transition-base",children:n.jsx(X,{className:"w-4 h-4 text-fg-muted"})})})]}),n.jsxs("div",{className:"flex-1 relative min-h-0 m-2 surface-base radius-inset overflow-hidden border border-edge-subtle",children:[n.jsx(a,{className:"absolute inset-0",points:Cs,links:Ss,...Ds,...Rs,backgroundColor:Ce,fitViewOnInit:!0,fitViewPadding:.15,showLabels:We,showDynamicLabels:!1,showTopLabels:We,showTopLabelsLimit:200,showHoveredPointLabel:!0,pointLabelColor:ke,pointClusterBy:ut?"communityId":void 0,onPolygonSelected:Kt?pn:void 0,polygonalSelectorStrokeColor:je?"#FBBF24":"#D97706",onClick:ln,onLinkClick:on,onMount:tn,hoveredPointRingColor:je?"#FBBF24":"#D97706",hoveredPointCursor:"pointer",hoveredLinkCursor:"pointer"}),Zn,On,Rn,Mn,Hn,In,n.jsxs(m,{children:[De&&n.jsx($t,{node:De,egoMetrics:fn,onExpandEgo:yn,neighbors:bn,onSelectNeighbor:an,txDelayRec:vn,onClose:()=>{var e;Fe(null),null==(e=ws.current)||e.unselectAllPoints()}}),Re&&!De&&n.jsx(Tt,{edge:Re,onClose:()=>Me(null)}),qt&&!De&&!Re&&n.jsx(It,{metrics:qt,onClose:gn})]})]})]}):n.jsxs("div",{className:"relative h-[calc(100dvh-56px)] lg:h-dvh min-h-[500px] -mx-4 sm:-mx-6 lg:-mx-8 -mt-5 -mb-4 sm:-mb-6 lg:-mb-8 overflow-hidden",children:[Ln,n.jsxs("div",{className:"absolute inset-0",children:[n.jsx(a,{className:"absolute inset-0",points:Cs,links:Ss,...Ds,...Rs,backgroundColor:Ce,fitViewOnInit:!0,fitViewPadding:.15,showLabels:We,showDynamicLabels:!1,showTopLabels:We,showTopLabelsLimit:200,showHoveredPointLabel:!0,pointLabelColor:ke,pointClusterBy:ut?"communityId":void 0,onPolygonSelected:Kt?pn:void 0,polygonalSelectorStrokeColor:je?"#FBBF24":"#D97706",onClick:ln,onLinkClick:on,onMount:tn,hoveredPointRingColor:je?"#FBBF24":"#D97706",hoveredPointCursor:"pointer",hoveredLinkCursor:"pointer"}),Zn,On,Rn,Mn,Hn,In,n.jsxs("div",{className:"absolute bottom-4 right-4 z-10 hidden lg:flex items-center gap-3 type-data-xs text-fg-muted/60",children:[n.jsxs("span",{children:[n.jsx("kbd",{className:"px-1 py-0.5 radius-badge bg-subtle-fill/50 font-mono",children:"/"})," Search"]}),n.jsxs("span",{children:[n.jsx("kbd",{className:"px-1 py-0.5 radius-badge bg-subtle-fill/50 font-mono",children:"F"})," Fit"]}),n.jsxs("span",{children:[n.jsx("kbd",{className:"px-1 py-0.5 radius-badge bg-subtle-fill/50 font-mono",children:"L"})," Labels"]}),n.jsxs("span",{children:[n.jsx("kbd",{className:"px-1 py-0.5 radius-badge bg-subtle-fill/50 font-mono",children:"Space"})," Pause"]}),n.jsxs("span",{children:[n.jsx("kbd",{className:"px-1 py-0.5 radius-badge bg-subtle-fill/50 font-mono",children:"Esc"})," Clear"]})]}),n.jsxs(m,{children:[De&&n.jsx($t,{node:De,egoMetrics:fn,onExpandEgo:yn,neighbors:bn,onSelectNeighbor:an,txDelayRec:vn,onClose:()=>{var e;Fe(null),null==(e=ws.current)||e.unselectAllPoints()}}),Re&&!De&&n.jsx(Tt,{edge:Re,onClose:()=>Me(null)}),qt&&!De&&!Re&&n.jsx(It,{metrics:qt,onClose:gn})]})]})]}):n.jsxs("div",{className:"relative h-[calc(100dvh-56px)] lg:h-dvh min-h-[500px] -mx-4 sm:-mx-6 lg:-mx-8 -mt-5 -mb-4 sm:-mb-6 lg:-mb-8 overflow-hidden",children:[Ln,n.jsxs("div",{className:"absolute inset-0 bg-body flex flex-col items-center justify-center gap-3",children:[n.jsx(A,{className:"w-8 h-8 text-sys-blue animate-spin"}),n.jsx("span",{className:"type-body text-fg-muted",children:"Preparing graph..."})]})]}):n.jsxs("div",{className:"relative h-[calc(100dvh-56px)] lg:h-dvh min-h-[500px] -mx-4 sm:-mx-6 lg:-mx-8 -mt-5 -mb-4 sm:-mb-6 lg:-mb-8 overflow-hidden",children:[Ln,n.jsxs("div",{className:"absolute inset-0 bg-body flex items-center justify-center",children:[n.jsx(Y,{isOpen:K,onClose:ee}),!K&&n.jsx(A,{className:"w-8 h-8 text-sys-blue animate-spin"})]})]})}export{Wt as default};
