import{c as e,a7 as t,bN as n,bO as a,aE as s,dy as i,dz as r,V as o,dA as c,W as l,m,k as h,aB as f,Y as d}from"./index-D2kasICP.js";import{c as u,D as p}from"./geo-utils-C_Z9ETES.js";import{r as g,j as x,c as y}from"./vendor-react-j_fHog8x.js";import{G as b}from"./git-branch-Dmp_yEyi.js";import{D as j}from"./database-CmfOXYX-.js";const v=e("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),k=e("grip-vertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),M=e("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]),w=e("minimize-2",[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]]);class N{constructor(){this.componentControls=new Set}subscribe(e){return this.componentControls.add(e),()=>this.componentControls.delete(e)}start(e,t){this.componentControls.forEach(n=>{n.start(e.nativeEvent||e,t)})}cancel(){this.componentControls.forEach(e=>{e.cancel()})}stop(){this.componentControls.forEach(e=>{e.stop()})}}const C=()=>new N;function A(){return t(C)}const H={hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1,transition:{type:"spring",stiffness:400,damping:15}},exit:{opacity:0,scale:.9,transition:{duration:a.fast}}},z={hidden:{opacity:0,y:"100%"},visible:{opacity:1,y:0,transition:{type:"spring",stiffness:400,damping:30}},exit:{opacity:0,y:"100%",transition:{duration:a.medium,ease:n.easeIn}}};function T(e,t){let n=0;for(let a=0;a<e.length;a++)n+=e[a]*t[a];return n}function V(e){const t=function(e){return Math.sqrt(T(e,e))}(e);if(t>0)for(let n=0;n<e.length;n++)e[n]/=t}function D(e,t){const n=T(e,t);for(let a=0;a<e.length;a++)e[a]-=n*t[a]}function E(e,t){const n=e.length,a=new Array(n).fill(0);for(let s=0;s<n;s++)for(let i=0;i<n;i++)a[s]+=e[s][i]*t[i];return a}function L(e){const t=Math.exp(-e/30);return Math.max(.05,t)}function S(e){const t=e.length,n=Array(t).fill(null).map(()=>Array(t).fill(0));for(let a=0;a<t;a++){let s=0;for(let i=0;i<t;i++)s+=e[a][i],n[a][i]=-e[a][i];n[a][a]=s}return n}function P(e){const t=e.length,n=Array(t).fill(1/Math.sqrt(t));let a=0;for(let o=0;o<t;o++){let n=0;for(let a=0;a<t;a++)n+=Math.abs(e[o][a]);a=Math.max(a,n)}const s=Array(t).fill(null).map(()=>Array(t).fill(0));for(let o=0;o<t;o++){for(let n=0;n<t;n++)s[o][n]=-e[o][n];s[o][o]=a+s[o][o]}let i=Array(t).fill(0).map((e,t)=>43758.5453*Math.sin(12.9898*t)%1-.5);D(i,n),V(i);let r=0;for(let o=0;o<100;o++){const e=E(s,i);D(e,n);const t=T(e,e)/T(i,e);if(V(e),i=e,Math.abs(t-r)<1e-8)return{vector:i,eigenvalue:a-t};r=t}return{vector:i,eigenvalue:a-r}}function F(e,t){if(e.length<2)return 0;const n=[];for(const r of e){const e=t.get(r);e&&n.push(e)}if(n.length<2)return 0;const a=Math.min(n.length,20),s=n.length<=a?n:function(e,t){if(t>=e.length)return e;const n=[],a=e.length/t;for(let s=0;s<t;s++)n.push(e[Math.floor(s*a)]);return n}(n,a);let i=0;for(let r=0;r<s.length;r++)for(let e=r+1;e<s.length;e++){const t=u(s[r][0],s[r][1],s[e][0],s[e][1])/1e3;i=Math.max(i,t)}return i}function O(e,t,n,a){const s=t.length;if(s<3)return null;const i=new Set(t),r=e.filter(e=>i.has(e.fromHash)&&i.has(e.toHash));if(0===r.length)return null;const o=function(e,t,n,a){const s=t.length,i=new Map(t.map((e,t)=>[e,t])),r=Array(s).fill(null).map(()=>Array(s).fill(0));for(const o of e){const e=i.get(o.fromHash),t=i.get(o.toHash);if(void 0!==e&&void 0!==t&&e!==t){const s=o.strength*o.certainCount;let i=1;if(n){const e=n.get(o.fromHash),t=n.get(o.toHash);e&&t&&(i=L(u(e[0],e[1],t[0],t[1])/1e3))}let c=1;if(a){const e=[o.fromHash,o.toHash].sort().join("-");c=1-.7*(a.get(e)??0)}const l=.3+.7*(o.symmetryRatio??0),m=Math.pow(s,.7)*Math.pow(i,.3)*c*l;r[e][t]=m,r[t][e]=m}}return r}(r,t,n,a),c=S(o),{vector:l,eigenvalue:m}=P(c);if(m<.001)return null;const h=[],f=[];for(let d=0;d<s;d++)l[d]<0?h.push(t[d]):f.push(t[d]);return h.length<5||f.length<5?null:{group0:h,group1:f,fiedlerValue:m}}function R(e,t,n,a){const s=t.length;if(s<3)return{communities:new Map([[0,t]]),nodePartitions:t.map(e=>({hash:e,community:0,fiedlerValue:0})),numCommunities:1,fiedlerValue:0,isConnected:s<=1};const i=[];let r=1/0;const o=[[t,0]];for(;o.length>0;){const[t,s]=o.shift();if((n?F(t,n):0)>20&&s<4&&t.length>=10){const i=O(e,t,n,a);if(i){r=Math.min(r,i.fiedlerValue),o.push([i.group0,s+1]),o.push([i.group1,s+1]);continue}}i.push(t)}const c=new Map,l=[],m=new Map;for(let h=0;h<i.length;h++){c.set(h,i[h]);for(const e of i[h])m.set(e,h)}for(const h of t)l.push({hash:h,community:m.get(h)??0,fiedlerValue:0});return{communities:c,nodePartitions:l,numCommunities:i.length,fiedlerValue:r===1/0?0:r,isConnected:!0}}function $(e){const t=["rgba(139, 92, 246, 0.25)","rgba(16, 185, 129, 0.25)","rgba(245, 158, 11, 0.25)","rgba(239, 68, 68, 0.25)","rgba(59, 130, 246, 0.25)","rgba(236, 72, 153, 0.25)","rgba(20, 184, 166, 0.25)","rgba(249, 115, 22, 0.25)"];return t[e%t.length]}function q(e,t){if(t.length<3)return 0;const n=t.length,a=new Map(t.map((e,t)=>[e,t])),s=Array(n).fill(null).map(()=>Array(n).fill(0));for(const o of e){const e=a.get(o.fromHash),t=a.get(o.toHash);void 0!==e&&void 0!==t&&e!==t&&(s[e][t]=1,s[t][e]=1)}const i=S(s),{eigenvalue:r}=P(i);return Math.max(0,r)}function B(e){const t=["rgba(139, 92, 246, 0.6)","rgba(16, 185, 129, 0.6)","rgba(245, 158, 11, 0.6)","rgba(239, 68, 68, 0.6)","rgba(59, 130, 246, 0.6)","rgba(236, 72, 153, 0.6)","rgba(20, 184, 166, 0.6)","rgba(249, 115, 22, 0.6)"];return t[e%t.length]}function G({label:e,icon:t,status:n,detail:a}){return x.jsxs("div",{className:y("flex items-center gap-3 py-3 px-4 radius-inset transition-base","active"===n&&"bg-accent-primary/10","complete"===n&&"bg-accent-primary/10 ring-2 ring-inset ring-accent-primary","pending"===n&&"opacity-40"),children:[x.jsx("div",{className:y("w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 transition-all duration-300","active"===n&&"bg-accent-primary/20","complete"===n&&"bg-accent-primary/20","pending"===n&&"bg-subtle-fill"),children:"complete"===n?x.jsx(h,{className:"w-4 h-4 text-accent-primary"}):"active"===n?x.jsx(d,{className:"w-4 h-4 animate-spin text-accent-primary"}):x.jsx("span",{className:"text-text-muted",children:t})}),x.jsxs("div",{className:"flex-1 min-w-0",children:[x.jsx("div",{className:y("text-sm font-medium transition-colors","active"===n&&"text-accent-primary","complete"===n&&"text-accent-primary","pending"===n&&"text-text-muted"),children:e}),a&&"pending"!==n&&x.jsx("div",{className:"text-xs text-text-muted mt-0.5 truncate",children:a})]})]})}const I=g.memo(function({isOpen:e,onClose:t}){const{packetCacheState:n,triggerDeepAnalysis:a}=s(),d=i(),u=r(),y=n.packetCount,[v,k]=g.useState("fetching");g.useEffect(()=>{e&&a()},[e,a]),g.useEffect(()=>{if(e)if(n.isTopologyLoading)k("fetching");else if(d)k("analyzing"),setTimeout(()=>k("building"),500),setTimeout(()=>k("discovering"),1e3);else if(u>0&&!n.isTopologyLoading){k("complete");const e=setTimeout(()=>{t()},1500);return()=>clearTimeout(e)}},[e,n.isTopologyLoading,d,u,t]);const M="complete"===v,w=n.loadProgress,N=g.useMemo(()=>w&&w.target>0?`Loading... ${(w.loaded/1e3).toFixed(1)}k / ${(w.target/1e3).toFixed(1)}k packets (${w.percent}%)`:y>0?`${y.toLocaleString()} packets loaded`:"Connecting to database...",[w,y]),C=e=>{const t=["fetching","analyzing","building","discovering","complete"],n=t.indexOf(v),a=t.indexOf(e);return a<n?"complete":a===n?"active":"pending"},A=M?t:()=>{};return x.jsx(o,{open:e,onClose:A,size:"sm",bottomSheet:!1,children:x.jsx(c,{isLoading:!M,borderRadius:16,children:x.jsx(l,{className:"p-6 radius-card overflow-hidden",children:M?x.jsxs("div",{className:"flex flex-col items-center py-6",children:[x.jsx(m.div,{variants:H,initial:"hidden",animate:"visible",className:"w-16 h-16 rounded-full flex items-center justify-center mb-4 bg-accent-primary/20",children:x.jsx(h,{className:"w-8 h-8 text-accent-primary"})}),x.jsx("h3",{className:"type-micro text-accent-primary",children:"Ready!"}),x.jsx("button",{onClick:t,className:"mt-3 sm:hidden min-h-[44px] min-w-[44px] px-4 flex items-center justify-center text-[15px] font-medium text-accent-primary active:text-accent-primary/70 transition-base radius-inner active:bg-subtle-fill",children:"Done"})]}):x.jsxs(x.Fragment,{children:[x.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[x.jsx("div",{className:"w-10 h-10 radius-inset flex items-center justify-center bg-accent-primary/15",children:x.jsx(b,{className:"w-5 h-5 text-accent-primary"})}),x.jsxs("div",{children:[x.jsx("h3",{className:"type-micro",children:"Deep Analysis"}),x.jsx("p",{className:"text-xs text-text-muted",children:"Building mesh topology"})]})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(G,{label:"Fetching Packets",icon:x.jsx(p,{className:"w-4 h-4"}),status:C("fetching"),detail:N}),x.jsx(G,{label:"Analyzing Database",icon:x.jsx(j,{className:"w-4 h-4"}),status:C("analyzing"),detail:"Processing packet paths"}),x.jsx(G,{label:"Building Topology",icon:x.jsx(b,{className:"w-4 h-4"}),status:C("building"),detail:"Computing mesh edges"}),x.jsx(G,{label:"Discovering Nodes",icon:x.jsx(f,{className:"w-4 h-4"}),status:C("discovering"),detail:"Viterbi HMM ghost detection"})]}),x.jsx("p",{className:"text-xs text-text-muted text-center mt-5",children:"This may take a few seconds..."})]})})})})});export{I as D,v as E,k as G,M,w as a,$ as b,q as c,R as d,B as g,z as s,A as u};
