import{P as O,c as k,e as N,f as D,g as B,h as z}from"./payload-decoders-CzcTN8BF.js";import{bl as A,bk as V,bv as g,eu as S,a7 as p,j as o,r as j,ee as E,ef as M,eg as L}from"./index-BTKkXbas.js";function U(e){const s=e&3,n=e>>2&15,t=e>>6&3;return[{bits:"0-1",field:"Route Type",value:A(s),binary:(s&3).toString(2).padStart(2,"0")},{bits:"2-5",field:"Payload Type",value:V(n),binary:(n&15).toString(2).padStart(4,"0")},{bits:"6-7",field:"Version",value:t.toString(),binary:(t&3).toString(2).padStart(2,"0")}]}function J(e){if(!e||e.length<4)return null;const s=O.fromHex(e);if(!s.success||!s.packet)return null;const n=s.packet,t=U(n.header),a=e.slice(0,2);let r=2,l="";n.hasTransportCodes()&&(l=e.slice(2,10),r=10);const c=e.slice(r,r+2),y=r+2,f=y+n.pathLen*2,m=e.slice(y,f),d=e.slice(f),h=k(n),i=Math.floor(r/2),u=Math.floor(y/2);return{packet:n,headerHex:a,headerFields:t,transportCodesHex:l,pathLengthHex:c,pathDataHex:m,payloadHex:d,pathLenByteOffset:i,pathByteOffset:u,payloadStartByte:Math.floor(f/2),decoded:h}}function Z(e){if(!e||e.length<8)return null;const s=parseInt(e.slice(0,2),16),n=parseInt(e.slice(2,4),16),t=parseInt(e.slice(4,6),16),a=parseInt(e.slice(6,8),16);return isNaN(s)||isNaN(n)||isNaN(t)||isNaN(a)?null:((s|n<<8|t<<16|a<<24)>>>0).toString(16).toUpperCase().padStart(8,"0")}function F(e){return e>=10?"excellent":e>=5?"good":e>=0?"fair":e>=-5?"poor":"critical"}function H(e){if(e._traceSnrPath!=null&&e._traceSnrPath.length>0)return e._traceSnrPath;if(e.raw_packet){const s=e.payload_type??e.type,n=S(e.raw_packet,s);if(n&&n.length>0)return n}return[]}function K(e){if(!e.payload)return null;try{const s=g(e.payload),n=H(e),t=N(s,n);return t?{packet:e,decoded:t,timestamp:e.timestamp??0,hopCount:t.snrValues.length,rssi:e.rssi,snr:e.snr}:null}catch{return null}}function ee(e){const s=new Map;for(const n of e){const t=K(n);if(!t)continue;const a=t.decoded.traceTag,r=s.get(a)||[];r.push(t),s.set(a,r)}for(const[n,t]of s)t.sort((a,r)=>a.timestamp-r.timestamp),s.set(n,t);return s}function te(e,s){if(s.length===0)return{traceTag:e,traceTagValue:0,targetPath:[],targetHopCount:0,observations:[],observationCount:0,firstSeen:0,lastSeen:0,duration:0,isComplete:!1,maxHopsObserved:0,progressPercent:0,bestObservation:null,hopStats:[],linkQuality:null};const n=[...s].sort((i,u)=>i.timestamp-u.timestamp),t=n.reduce((i,u)=>u.hopCount>i.hopCount?u:i,n[0]),a=n[0].timestamp,r=n[n.length-1].timestamp,l=t.decoded.pathHashes,c=l.length,y=t.hopCount,f=t.decoded.isComplete,m=[],d=t.decoded.snrValues;for(let i=0;i<d.length&&i<l.length;i++)m.push({prefix:l[i],snr:d[i],position:i,quality:F(d[i])});let h=null;if(d.length>0){const i=Math.min(...d),u=Math.max(...d),P=d.reduce(($,R)=>$+R,0)/d.length,w=d.indexOf(i),_=d.indexOf(u);h={minSnr:i,maxSnr:u,avgSnr:P,weakestLinkPosition:w,strongestLinkPosition:_}}return{traceTag:e,traceTagValue:t.decoded.traceTagValue,targetPath:l,targetHopCount:c,observations:n,observationCount:n.length,firstSeen:a,lastSeen:r,duration:r-a,isComplete:f,maxHopsObserved:y,progressPercent:c>0?Math.round(y/c*100):0,bestObservation:t,hopStats:m,linkQuality:h,srcHash:t.packet.src_hash,dstHash:t.packet.dst_hash}}function W(e){const s=e.payload_type??e.type;if(s!==p.TRACE||!e.payload)return null;try{const n=g(e.payload);let t=[];if(e._traceSnrPath!=null&&e._traceSnrPath.length>0)t=e._traceSnrPath;else if(e.raw_packet){const a=S(e.raw_packet,s);a&&a.length>0&&(t=a)}return N(n,t)}catch{return null}}function q(e){if((e.payload_type??e.type)!==p.ADVERT||!e.payload)return null;try{const n=g(e.payload),t=D(n);if(!t)return null;const a=t.publicKey.slice(0,2).toUpperCase(),r={...t,prefix:a};let l=null;return t.latitude&&t.longitude&&(l={latitude:t.latitude,longitude:t.longitude,name:t.name||`Node ${a||"??"}`,prefix:a,publicKey:t.publicKey}),{data:r,sourceNode:l}}catch{return null}}function C(e){if(!e)return null;const s=e.trim(),n=/(-?\d+\.?\d*)\s*[,\s]\s*(-?\d+\.?\d*)/,t=s.match(n);if(!t)return null;const a=parseFloat(t[1]),r=parseFloat(t[2]);return isNaN(a)||isNaN(r)||a<-90||a>90||r<-180||r>180||a===0&&r===0?null:{lat:a,lon:r}}function Q(e){var n,t;if(!e.decrypted||!((n=e.channelName)!=null&&n.toLowerCase().includes("wardrive")))return null;const s=C(e.text);return s?{latitude:s.lat,longitude:s.lon,name:e.senderName||"Wardrive Ping",prefix:((t=e.senderName)==null?void 0:t.slice(0,2).toUpperCase())||"WD",nodeType:"wardrive"}:null}function se(e,s){const n=e.payload_type??e.type;if(n===p.TRACE){const t=W(e);if(t)return{kind:"trace",data:t,snrValues:t.snrValues}}if(n===p.ADVERT){const t=q(e);if(t)return{kind:"advert",data:t.data,sourceNode:t.sourceNode}}if(n===p.GRP_TXT&&s){const t=C(s.text),a=Q(s);return{kind:"grp_txt",decoded:s,wardriveCoords:t,wardriveSourceNode:a}}if(n===p.CONTROL){const t=I(e);if(t)return{kind:"control",data:t}}if(n===p.ANON_REQ){const t=G(e);if(t)return{kind:"anon_req",data:t}}return{kind:"generic"}}function I(e){if((e.payload_type??e.type)!==p.CONTROL||!e.payload)return null;try{const n=g(e.payload);return B(n)}catch{return null}}function G(e){if((e.payload_type??e.type)!==p.ANON_REQ||!e.payload)return null;try{const n=g(e.payload),t=z(n);if(!t)return null;const a=t.senderPublicKey.slice(0,2).toUpperCase();return{...t,prefix:a}}catch{return null}}const x={zinc:{stem:"bg-zinc-500/40",dot:"bg-zinc-400",row:"bg-zinc-500/8",text:"text-fg-muted/60",chip:"bg-zinc-500/20 text-fg-muted"},green:{stem:"bg-sys-green/50",dot:"bg-sys-green",row:"bg-sys-green/8",text:"text-sys-green",chip:"bg-sys-green/15 text-sys-green"},amber:{stem:"bg-sys-amber/50",dot:"bg-sys-amber",row:"bg-sys-amber/8",text:"text-sys-amber",chip:"bg-sys-amber/15 text-sys-amber"},red:{stem:"bg-sys-red/50",dot:"bg-sys-red",row:"bg-sys-red/8",text:"text-sys-red",chip:"bg-sys-red/15 text-sys-red"},blue:{stem:"bg-sys-blue/50",dot:"bg-sys-blue",row:"bg-sys-blue/8",text:"text-sys-blue",chip:"bg-sys-blue/15 text-sys-blue"},purple:{stem:"bg-sys-purple/50",dot:"bg-sys-purple",row:"bg-sys-purple/8",text:"text-sys-purple",chip:"bg-sys-purple/15 text-sys-purple"},teal:{stem:"bg-sys-teal/50",dot:"bg-sys-teal",row:"bg-sys-teal/8",text:"text-sys-teal",chip:"bg-sys-teal/15 text-sys-teal"},cyan:{stem:"bg-sys-cyan/50",dot:"bg-sys-cyan",row:"bg-sys-cyan/8",text:"text-sys-cyan",chip:"bg-sys-cyan/15 text-sys-cyan"},sky:{stem:"bg-sys-sky/50",dot:"bg-sys-sky",row:"bg-sys-sky/8",text:"text-sys-sky",chip:"bg-sys-sky/15 text-sys-sky"},pink:{stem:"bg-sys-pink/50",dot:"bg-sys-pink",row:"bg-sys-pink/8",text:"text-sys-pink",chip:"bg-sys-pink/15 text-sys-pink"},orange:{stem:"bg-sys-orange/50",dot:"bg-sys-orange",row:"bg-sys-orange/8",text:"text-sys-orange",chip:"bg-sys-orange/15 text-sys-orange"}};Object.fromEntries(Object.entries(x).map(([e,s])=>[e,s.text]));const T=j.createContext("");function ne({prefix:e,children:s}){return o.jsx(T.Provider,{value:e,children:s})}function v(){return j.useContext(T)}function re({children:e,color:s="zinc"}){var n;return o.jsx("span",{className:`inline-flex items-center px-1.5 py-px rounded-full text-[9px] font-mono font-medium leading-tight ${((n=x[s])==null?void 0:n.chip)??x.zinc.chip}`,children:e})}function ae({fn:e,value:s,color:n="zinc"}){var r;const t=v(),a=t?`${t}(${e})`:e;return o.jsxs("span",{title:a,className:"inline-flex items-baseline gap-0 font-mono",children:[o.jsx("span",{className:"text-fg-muted/40",children:e}),o.jsx("span",{className:"text-fg-muted/20",children:"("}),s?o.jsx("span",{className:((r=x[n])==null?void 0:r.text)??x.zinc.text,children:s}):o.jsx("span",{className:"text-fg-muted/20",children:"·"}),o.jsx("span",{className:"text-fg-muted/20",children:")"})]})}function oe({label:e,children:s,mono:n=!0,padY:t=!1}){const a=v(),r=e.trim(),l=a?`${a}(${r})`:r;return o.jsxs("div",{className:`flex items-center gap-2 ${t?"py-1":"py-0.5"}`,children:[o.jsx("dt",{className:"text-fg-muted shrink-0 w-28 text-right",children:e}),o.jsx("dd",{title:l,className:n?"text-fg-primary break-all":"text-fg-primary",children:s})]})}function le({value:e,className:s}){const n=typeof e=="number"?`0x${e.toString(16).toUpperCase().padStart(2,"0")}`:e.startsWith("0x")?e:`0x${e}`;return o.jsx("span",{className:s??"text-sys-blue",children:n})}function ie({value:e}){const s=typeof e=="number"?e.toString(16).toUpperCase().padStart(2,"0"):e.replace(/^0x/i,"").toUpperCase();return o.jsxs("span",{className:"px-1 py-px rounded bg-zinc-500/15 text-fg-secondary font-mono text-[11px]",children:["0x",s]})}function ce({value:e}){return o.jsx("span",{className:"px-1 py-px rounded bg-zinc-500/10 text-fg-muted font-mono text-[10px]",children:e.toString(2).padStart(8,"0")})}function de({raw:e,children:s}){return o.jsxs("span",{className:"inline-flex items-center gap-1.5 flex-wrap",children:[o.jsx("span",{className:"font-mono text-fg-muted",children:e}),o.jsx("span",{className:"text-fg-muted/40 text-[10px]",children:"→"}),s]})}const b={blue:"text-sys-blue",amber:"text-sys-amber",green:"text-sys-green",teal:"text-sys-teal",purple:"text-sys-purple"};function ue({hops:e,hexPrefix:s,color:n="amber"}){if(e.length===0)return o.jsx("span",{className:"text-fg-muted italic",children:"∅ zero-hop"});const t=b[n]??b.amber;return o.jsxs("span",{className:"inline-flex items-center gap-1 flex-wrap",children:[s&&o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"font-mono text-fg-muted text-[10px]",children:s}),o.jsx("span",{className:"text-fg-muted/40 text-[10px] mx-0.5",children:"→"})]}),e.map((a,r)=>o.jsxs("span",{className:"inline-flex items-center",children:[r>0&&o.jsx("span",{className:"text-fg-muted/40 text-[10px]",children:"→"}),o.jsx("span",{className:`inline-block border border-edge-subtle rounded px-1.5 py-0.5 font-mono text-[11px] ${t}`,children:a.toUpperCase()})]},r))]})}function pe({title:e}){return o.jsx("div",{className:"mt-2 pt-2 border-t border-edge-subtle",children:e&&o.jsx("p",{className:"text-sys-amber font-semibold mb-0.5",children:e})})}function ye(e){if(!e||e<=0)return"never";const s=Math.floor(Date.now()/1e3)-e;return s<60?`${s}s ago`:s<3600?`${Math.floor(s/60)}m ago`:s<86400?`${Math.floor(s/3600)}h ago`:`${Math.floor(s/86400)}d ago`}function fe(e){return e>0?"green":"zinc"}function xe({children:e,c:s}){return o.jsx("span",{className:s??"text-fg-muted",children:e})}function ge({tokens:e,label:s="emits"}){const n=e.filter(r=>r.value!=null&&r.value!=="");if(n.length===0)return null;const t=[];let a;for(let r=0;r<n.length;r++){const l=n[r].group;l&&l!==a?(t.push({type:"label",group:l}),a=l):!l&&a&&(a=void 0),t.push({type:"token",token:n[r],idx:r})}return o.jsx("div",{className:"mt-3 pt-2 border-t border-dashed border-edge-subtle/40",children:o.jsxs(E,{children:[o.jsxs(M,{className:"text-[8px] uppercase tracking-widest font-mono w-full text-left",children:[o.jsxs("span",{className:"text-fg-muted/30",children:[s," →"]}),o.jsxs("span",{className:"ml-1.5 text-fg-muted/50",children:[n.length," tokens"]})]}),o.jsx(L,{children:o.jsx("div",{className:"flex flex-wrap items-center gap-x-1.5 gap-y-1 mt-1",children:t.map((r,l)=>{var f;if(r.type==="label")return o.jsx("span",{className:"text-[8px] text-fg-muted/40 uppercase tracking-wider font-mono",children:r.group},`g-${l}`);const c=r.token,y=c.raw?`${c.fn}(${c.raw} → ${c.value})`:`${c.fn}(${c.value})`;return o.jsx("span",{title:y,className:`inline-block border border-edge-subtle rounded px-1.5 py-0.5 font-mono cursor-default ${((f=x[c.color??"zinc"])==null?void 0:f.text)??x.zinc.text}`,children:c.value},r.idx)})})})]})})}export{x as A,ce as B,re as C,ie as H,oe as K,ue as P,de as R,ne as S,ae as T,W as a,te as b,ge as c,se as d,Z as e,pe as f,ee as g,le as h,xe as i,ye as j,J as p,fe as s};
