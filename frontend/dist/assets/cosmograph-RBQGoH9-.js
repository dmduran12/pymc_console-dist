var iA=Object.defineProperty;var nA=(i,e,t)=>e in i?iA(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var m=(i,e,t)=>nA(i,typeof e!="symbol"?e+"":e,t);function CX(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}const rA="modulepreload",oA=function(i){return"/"+i},bb={},vb=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){let s=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));r=s(t.map(c=>{if(c=oA(c),c in bb)return;bb[c]=!0;const u=c.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":rA,u||(d.as="script"),d.crossOrigin="",d.href=c,l&&d.setAttribute("nonce",l),document.head.appendChild(d),u)return new Promise((f,p)=>{d.addEventListener("load",f),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return r.then(s=>{for(const a of s||[])a.status==="rejected"&&o(a.reason);return e().catch(o)})};var sA=Object.defineProperty,aA=(i,e,t)=>e in i?sA(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,B=(i,e,t)=>aA(i,typeof e!="symbol"?e+"":e,t),om="http://www.w3.org/1999/xhtml";const xb={svg:"http://www.w3.org/2000/svg",xhtml:om,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function tf(i){var e=i+="",t=e.indexOf(":");return t>=0&&(e=i.slice(0,t))!=="xmlns"&&(i=i.slice(t+1)),xb.hasOwnProperty(e)?{space:xb[e],local:i}:i}function lA(i){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===om&&e.documentElement.namespaceURI===om?e.createElement(i):e.createElementNS(t,i)}}function cA(i){return function(){return this.ownerDocument.createElementNS(i.space,i.local)}}function hx(i){var e=tf(i);return(e.local?cA:lA)(e)}function uA(){}function $g(i){return i==null?uA:function(){return this.querySelector(i)}}function hA(i){typeof i!="function"&&(i=$g(i));for(var e=this._groups,t=e.length,n=new Array(t),r=0;r<t;++r)for(var o=e[r],s=o.length,a=n[r]=new Array(s),l,c,u=0;u<s;++u)(l=o[u])&&(c=i.call(l,l.__data__,u,o))&&("__data__"in l&&(c.__data__=l.__data__),a[u]=c);return new an(n,this._parents)}function dA(i){return i==null?[]:Array.isArray(i)?i:Array.from(i)}function fA(){return[]}function dx(i){return i==null?fA:function(){return this.querySelectorAll(i)}}function pA(i){return function(){return dA(i.apply(this,arguments))}}function mA(i){typeof i=="function"?i=pA(i):i=dx(i);for(var e=this._groups,t=e.length,n=[],r=[],o=0;o<t;++o)for(var s=e[o],a=s.length,l,c=0;c<a;++c)(l=s[c])&&(n.push(i.call(l,l.__data__,c,s)),r.push(l));return new an(n,r)}function fx(i){return function(){return this.matches(i)}}function px(i){return function(e){return e.matches(i)}}var gA=Array.prototype.find;function _A(i){return function(){return gA.call(this.children,i)}}function yA(){return this.firstElementChild}function bA(i){return this.select(i==null?yA:_A(typeof i=="function"?i:px(i)))}var vA=Array.prototype.filter;function xA(){return Array.from(this.children)}function wA(i){return function(){return vA.call(this.children,i)}}function SA(i){return this.selectAll(i==null?xA:wA(typeof i=="function"?i:px(i)))}function EA(i){typeof i!="function"&&(i=fx(i));for(var e=this._groups,t=e.length,n=new Array(t),r=0;r<t;++r)for(var o=e[r],s=o.length,a=n[r]=[],l,c=0;c<s;++c)(l=o[c])&&i.call(l,l.__data__,c,o)&&a.push(l);return new an(n,this._parents)}function mx(i){return new Array(i.length)}function CA(){return new an(this._enter||this._groups.map(mx),this._parents)}function zh(i,e){this.ownerDocument=i.ownerDocument,this.namespaceURI=i.namespaceURI,this._next=null,this._parent=i,this.__data__=e}zh.prototype={constructor:zh,appendChild:function(i){return this._parent.insertBefore(i,this._next)},insertBefore:function(i,e){return this._parent.insertBefore(i,e)},querySelector:function(i){return this._parent.querySelector(i)},querySelectorAll:function(i){return this._parent.querySelectorAll(i)}};function TA(i){return function(){return i}}function AA(i,e,t,n,r,o){for(var s=0,a,l=e.length,c=o.length;s<c;++s)(a=e[s])?(a.__data__=o[s],n[s]=a):t[s]=new zh(i,o[s]);for(;s<l;++s)(a=e[s])&&(r[s]=a)}function IA(i,e,t,n,r,o,s){var a,l,c=new Map,u=e.length,h=o.length,d=new Array(u),f;for(a=0;a<u;++a)(l=e[a])&&(d[a]=f=s.call(l,l.__data__,a,e)+"",c.has(f)?r[a]=l:c.set(f,l));for(a=0;a<h;++a)f=s.call(i,o[a],a,o)+"",(l=c.get(f))?(n[a]=l,l.__data__=o[a],c.delete(f)):t[a]=new zh(i,o[a]);for(a=0;a<u;++a)(l=e[a])&&c.get(d[a])===l&&(r[a]=l)}function kA(i){return i.__data__}function LA(i,e){if(!arguments.length)return Array.from(this,kA);var t=e?IA:AA,n=this._parents,r=this._groups;typeof i!="function"&&(i=TA(i));for(var o=r.length,s=new Array(o),a=new Array(o),l=new Array(o),c=0;c<o;++c){var u=n[c],h=r[c],d=h.length,f=RA(i.call(u,u&&u.__data__,c,n)),p=f.length,b=a[c]=new Array(p),g=s[c]=new Array(p),_=l[c]=new Array(d);t(u,h,b,g,_,f,e);for(var T=0,E=0,y,C;T<p;++T)if(y=b[T]){for(T>=E&&(E=T+1);!(C=g[E])&&++E<p;);y._next=C||null}}return s=new an(s,n),s._enter=a,s._exit=l,s}function RA(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function PA(){return new an(this._exit||this._groups.map(mx),this._parents)}function DA(i,e,t){var n=this.enter(),r=this,o=this.exit();return typeof i=="function"?(n=i(n),n&&(n=n.selection())):n=n.append(i+""),e!=null&&(r=e(r),r&&(r=r.selection())),t==null?o.remove():t(o),n&&r?n.merge(r).order():r}function MA(i){for(var e=i.selection?i.selection():i,t=this._groups,n=e._groups,r=t.length,o=n.length,s=Math.min(r,o),a=new Array(r),l=0;l<s;++l)for(var c=t[l],u=n[l],h=c.length,d=a[l]=new Array(h),f,p=0;p<h;++p)(f=c[p]||u[p])&&(d[p]=f);for(;l<r;++l)a[l]=t[l];return new an(a,this._parents)}function NA(){for(var i=this._groups,e=-1,t=i.length;++e<t;)for(var n=i[e],r=n.length-1,o=n[r],s;--r>=0;)(s=n[r])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function BA(i){i||(i=OA);function e(h,d){return h&&d?i(h.__data__,d.__data__):!h-!d}for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o){for(var s=t[o],a=s.length,l=r[o]=new Array(a),c,u=0;u<a;++u)(c=s[u])&&(l[u]=c);l.sort(e)}return new an(r,this._parents).order()}function OA(i,e){return i<e?-1:i>e?1:i>=e?0:NaN}function FA(){var i=arguments[0];return arguments[0]=this,i.apply(null,arguments),this}function zA(){return Array.from(this)}function UA(){for(var i=this._groups,e=0,t=i.length;e<t;++e)for(var n=i[e],r=0,o=n.length;r<o;++r){var s=n[r];if(s)return s}return null}function $A(){let i=0;for(const e of this)++i;return i}function VA(){return!this.node()}function HA(i){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],o=0,s=r.length,a;o<s;++o)(a=r[o])&&i.call(a,a.__data__,o,r);return this}function GA(i){return function(){this.removeAttribute(i)}}function WA(i){return function(){this.removeAttributeNS(i.space,i.local)}}function jA(i,e){return function(){this.setAttribute(i,e)}}function YA(i,e){return function(){this.setAttributeNS(i.space,i.local,e)}}function qA(i,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(i):this.setAttribute(i,t)}}function XA(i,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(i.space,i.local):this.setAttributeNS(i.space,i.local,t)}}function KA(i,e){var t=tf(i);if(arguments.length<2){var n=this.node();return t.local?n.getAttributeNS(t.space,t.local):n.getAttribute(t)}return this.each((e==null?t.local?WA:GA:typeof e=="function"?t.local?XA:qA:t.local?YA:jA)(t,e))}function gx(i){return i.ownerDocument&&i.ownerDocument.defaultView||i.document&&i||i.defaultView}function ZA(i){return function(){this.style.removeProperty(i)}}function QA(i,e,t){return function(){this.style.setProperty(i,e,t)}}function JA(i,e,t){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(i):this.style.setProperty(i,n,t)}}function eI(i,e,t){return arguments.length>1?this.each((e==null?ZA:typeof e=="function"?JA:QA)(i,e,t??"")):Ta(this.node(),i)}function Ta(i,e){return i.style.getPropertyValue(e)||gx(i).getComputedStyle(i,null).getPropertyValue(e)}function tI(i){return function(){delete this[i]}}function iI(i,e){return function(){this[i]=e}}function nI(i,e){return function(){var t=e.apply(this,arguments);t==null?delete this[i]:this[i]=t}}function rI(i,e){return arguments.length>1?this.each((e==null?tI:typeof e=="function"?nI:iI)(i,e)):this.node()[i]}function _x(i){return i.trim().split(/^|\s+/)}function Vg(i){return i.classList||new yx(i)}function yx(i){this._node=i,this._names=_x(i.getAttribute("class")||"")}yx.prototype={add:function(i){var e=this._names.indexOf(i);e<0&&(this._names.push(i),this._node.setAttribute("class",this._names.join(" ")))},remove:function(i){var e=this._names.indexOf(i);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(i){return this._names.indexOf(i)>=0}};function bx(i,e){for(var t=Vg(i),n=-1,r=e.length;++n<r;)t.add(e[n])}function vx(i,e){for(var t=Vg(i),n=-1,r=e.length;++n<r;)t.remove(e[n])}function oI(i){return function(){bx(this,i)}}function sI(i){return function(){vx(this,i)}}function aI(i,e){return function(){(e.apply(this,arguments)?bx:vx)(this,i)}}function lI(i,e){var t=_x(i+"");if(arguments.length<2){for(var n=Vg(this.node()),r=-1,o=t.length;++r<o;)if(!n.contains(t[r]))return!1;return!0}return this.each((typeof e=="function"?aI:e?oI:sI)(t,e))}function cI(){this.textContent=""}function uI(i){return function(){this.textContent=i}}function hI(i){return function(){var e=i.apply(this,arguments);this.textContent=e??""}}function dI(i){return arguments.length?this.each(i==null?cI:(typeof i=="function"?hI:uI)(i)):this.node().textContent}function fI(){this.innerHTML=""}function pI(i){return function(){this.innerHTML=i}}function mI(i){return function(){var e=i.apply(this,arguments);this.innerHTML=e??""}}function gI(i){return arguments.length?this.each(i==null?fI:(typeof i=="function"?mI:pI)(i)):this.node().innerHTML}function _I(){this.nextSibling&&this.parentNode.appendChild(this)}function yI(){return this.each(_I)}function bI(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function vI(){return this.each(bI)}function xI(i){var e=typeof i=="function"?i:hx(i);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function wI(){return null}function SI(i,e){var t=typeof i=="function"?i:hx(i),n=e==null?wI:typeof e=="function"?e:$g(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),n.apply(this,arguments)||null)})}function EI(){var i=this.parentNode;i&&i.removeChild(this)}function CI(){return this.each(EI)}function TI(){var i=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(i,this.nextSibling):i}function AI(){var i=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(i,this.nextSibling):i}function II(i){return this.select(i?AI:TI)}function kI(i){return arguments.length?this.property("__data__",i):this.node().__data__}function LI(i){return function(e){i.call(this,e,this.__data__)}}function RI(i){return i.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}function PI(i){return function(){var e=this.__on;if(e){for(var t=0,n=-1,r=e.length,o;t<r;++t)o=e[t],(!i.type||o.type===i.type)&&o.name===i.name?this.removeEventListener(o.type,o.listener,o.options):e[++n]=o;++n?e.length=n:delete this.__on}}}function DI(i,e,t){return function(){var n=this.__on,r,o=LI(e);if(n){for(var s=0,a=n.length;s<a;++s)if((r=n[s]).type===i.type&&r.name===i.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=t),r.value=e;return}}this.addEventListener(i.type,o,t),r={type:i.type,name:i.name,value:e,listener:o,options:t},n?n.push(r):this.__on=[r]}}function MI(i,e,t){var n=RI(i+""),r,o=n.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,u;l<c;++l)for(r=0,u=a[l];r<o;++r)if((s=n[r]).type===u.type&&s.name===u.name)return u.value}return}for(a=e?DI:PI,r=0;r<o;++r)this.each(a(n[r],e,t));return this}function xx(i,e,t){var n=gx(i),r=n.CustomEvent;typeof r=="function"?r=new r(e,t):(r=n.document.createEvent("Event"),t?(r.initEvent(e,t.bubbles,t.cancelable),r.detail=t.detail):r.initEvent(e,!1,!1)),i.dispatchEvent(r)}function NI(i,e){return function(){return xx(this,i,e)}}function BI(i,e){return function(){return xx(this,i,e.apply(this,arguments))}}function OI(i,e){return this.each((typeof e=="function"?BI:NI)(i,e))}function*FI(){for(var i=this._groups,e=0,t=i.length;e<t;++e)for(var n=i[e],r=0,o=n.length,s;r<o;++r)(s=n[r])&&(yield s)}var wx=[null];function an(i,e){this._groups=i,this._parents=e}function jc(){return new an([[document.documentElement]],wx)}function zI(){return this}an.prototype=jc.prototype={constructor:an,select:hA,selectAll:mA,selectChild:bA,selectChildren:SA,filter:EA,data:LA,enter:CA,exit:PA,join:DA,merge:MA,selection:zI,order:NA,sort:BA,call:FA,nodes:zA,node:UA,size:$A,empty:VA,each:HA,attr:KA,style:eI,property:rI,classed:lI,text:dI,html:gI,raise:yI,lower:vI,append:xI,insert:SI,remove:CI,clone:II,datum:kI,on:MI,dispatch:OI,[Symbol.iterator]:FI};function Yt(i){return typeof i=="string"?new an([[document.querySelector(i)]],[document.documentElement]):new an([[i]],wx)}function UI(i){let e;for(;e=i.sourceEvent;)i=e;return i}function Hr(i,e){if(i=UI(i),e===void 0&&(e=i.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var n=t.createSVGPoint();return n.x=i.clientX,n.y=i.clientY,n=n.matrixTransform(e.getScreenCTM().inverse()),[n.x,n.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[i.clientX-r.left-e.clientLeft,i.clientY-r.top-e.clientTop]}}return[i.pageX,i.pageY]}var $I={value:()=>{}};function nf(){for(var i=0,e=arguments.length,t={},n;i<e;++i){if(!(n=arguments[i]+"")||n in t||/[\s.]/.test(n))throw new Error("illegal type: "+n);t[n]=[]}return new rh(t)}function rh(i){this._=i}function VI(i,e){return i.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}})}rh.prototype=nf.prototype={constructor:rh,on:function(i,e){var t=this._,n=VI(i+"",t),r,o=-1,s=n.length;if(arguments.length<2){for(;++o<s;)if((r=(i=n[o]).type)&&(r=HI(t[r],i.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<s;)if(r=(i=n[o]).type)t[r]=wb(t[r],i.name,e);else if(e==null)for(r in t)t[r]=wb(t[r],i.name,null);return this},copy:function(){var i={},e=this._;for(var t in e)i[t]=e[t].slice();return new rh(i)},call:function(i,e){if((r=arguments.length-2)>0)for(var t=new Array(r),n=0,r,o;n<r;++n)t[n]=arguments[n+2];if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(o=this._[i],n=0,r=o.length;n<r;++n)o[n].value.apply(e,t)},apply:function(i,e,t){if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(var n=this._[i],r=0,o=n.length;r<o;++r)n[r].value.apply(e,t)}};function HI(i,e){for(var t=0,n=i.length,r;t<n;++t)if((r=i[t]).name===e)return r.value}function wb(i,e,t){for(var n=0,r=i.length;n<r;++n)if(i[n].name===e){i[n]=$I,i=i.slice(0,n).concat(i.slice(n+1));break}return t!=null&&i.push({name:e,value:t}),i}var Aa=0,Fl=0,dl=0,Sx=1e3,Uh,zl,$h=0,hs=0,rf=0,mc=typeof performance=="object"&&performance.now?performance:Date,Ex=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(i){setTimeout(i,17)};function Hg(){return hs||(Ex(GI),hs=mc.now()+rf)}function GI(){hs=0}function Vh(){this._call=this._time=this._next=null}Vh.prototype=Cx.prototype={constructor:Vh,restart:function(i,e,t){if(typeof i!="function")throw new TypeError("callback is not a function");t=(t==null?Hg():+t)+(e==null?0:+e),!this._next&&zl!==this&&(zl?zl._next=this:Uh=this,zl=this),this._call=i,this._time=t,sm()},stop:function(){this._call&&(this._call=null,this._time=1/0,sm())}};function Cx(i,e,t){var n=new Vh;return n.restart(i,e,t),n}function WI(){Hg(),++Aa;for(var i=Uh,e;i;)(e=hs-i._time)>=0&&i._call.call(null,e),i=i._next;--Aa}function Sb(){hs=($h=mc.now())+rf,Aa=Fl=0;try{WI()}finally{Aa=0,YI(),hs=0}}function jI(){var i=mc.now(),e=i-$h;e>Sx&&(rf-=e,$h=i)}function YI(){for(var i,e=Uh,t,n=1/0;e;)e._call?(n>e._time&&(n=e._time),i=e,e=e._next):(t=e._next,e._next=null,e=i?i._next=t:Uh=t);zl=i,sm(n)}function sm(i){if(!Aa){Fl&&(Fl=clearTimeout(Fl));var e=i-hs;e>24?(i<1/0&&(Fl=setTimeout(Sb,i-mc.now()-rf)),dl&&(dl=clearInterval(dl))):(dl||($h=mc.now(),dl=setInterval(jI,Sx)),Aa=1,Ex(Sb))}}function Eb(i,e,t){var n=new Vh;return e=e==null?0:+e,n.restart(r=>{n.stop(),i(r+e)},e,t),n}var qI=nf("start","end","cancel","interrupt"),XI=[],Tx=0,Cb=1,am=2,oh=3,Tb=4,lm=5,sh=6;function of(i,e,t,n,r,o){var s=i.__transition;if(!s)i.__transition={};else if(t in s)return;KI(i,t,{name:e,index:n,group:r,on:qI,tween:XI,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:Tx})}function Gg(i,e){var t=Yn(i,e);if(t.state>Tx)throw new Error("too late; already scheduled");return t}function Cr(i,e){var t=Yn(i,e);if(t.state>oh)throw new Error("too late; already running");return t}function Yn(i,e){var t=i.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function KI(i,e,t){var n=i.__transition,r;n[e]=t,t.timer=Cx(o,0,t.time);function o(c){t.state=Cb,t.timer.restart(s,t.delay,t.time),t.delay<=c&&s(c-t.delay)}function s(c){var u,h,d,f;if(t.state!==Cb)return l();for(u in n)if(f=n[u],f.name===t.name){if(f.state===oh)return Eb(s);f.state===Tb?(f.state=sh,f.timer.stop(),f.on.call("interrupt",i,i.__data__,f.index,f.group),delete n[u]):+u<e&&(f.state=sh,f.timer.stop(),f.on.call("cancel",i,i.__data__,f.index,f.group),delete n[u])}if(Eb(function(){t.state===oh&&(t.state=Tb,t.timer.restart(a,t.delay,t.time),a(c))}),t.state=am,t.on.call("start",i,i.__data__,t.index,t.group),t.state===am){for(t.state=oh,r=new Array(d=t.tween.length),u=0,h=-1;u<d;++u)(f=t.tween[u].value.call(i,i.__data__,t.index,t.group))&&(r[++h]=f);r.length=h+1}}function a(c){for(var u=c<t.duration?t.ease.call(null,c/t.duration):(t.timer.restart(l),t.state=lm,1),h=-1,d=r.length;++h<d;)r[h].call(i,u);t.state===lm&&(t.on.call("end",i,i.__data__,t.index,t.group),l())}function l(){t.state=sh,t.timer.stop(),delete n[e];for(var c in n)return;delete i.__transition}}function ah(i,e){var t=i.__transition,n,r,o=!0,s;if(t){e=e==null?null:e+"";for(s in t){if((n=t[s]).name!==e){o=!1;continue}r=n.state>am&&n.state<lm,n.state=sh,n.timer.stop(),n.on.call(r?"interrupt":"cancel",i,i.__data__,n.index,n.group),delete t[s]}o&&delete i.__transition}}function ZI(i){return this.each(function(){ah(this,i)})}function Wg(i,e,t){i.prototype=e.prototype=t,t.constructor=i}function Ax(i,e){var t=Object.create(i.prototype);for(var n in e)t[n]=e[n];return t}function Yc(){}var gc=.7,Hh=1/gc,ha="\\s*([+-]?\\d+)\\s*",_c="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",br="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",QI=/^#([0-9a-f]{3,8})$/,JI=new RegExp(`^rgb\\(${ha},${ha},${ha}\\)$`),ek=new RegExp(`^rgb\\(${br},${br},${br}\\)$`),tk=new RegExp(`^rgba\\(${ha},${ha},${ha},${_c}\\)$`),ik=new RegExp(`^rgba\\(${br},${br},${br},${_c}\\)$`),nk=new RegExp(`^hsl\\(${_c},${br},${br}\\)$`),rk=new RegExp(`^hsla\\(${_c},${br},${br},${_c}\\)$`),Ab={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Wg(Yc,No,{copy(i){return Object.assign(new this.constructor,this,i)},displayable(){return this.rgb().displayable()},hex:Ib,formatHex:Ib,formatHex8:ok,formatHsl:sk,formatRgb:kb,toString:kb});function Ib(){return this.rgb().formatHex()}function ok(){return this.rgb().formatHex8()}function sk(){return Ix(this).formatHsl()}function kb(){return this.rgb().formatRgb()}function No(i){var e,t;return i=(i+"").trim().toLowerCase(),(e=QI.exec(i))?(t=e[1].length,e=parseInt(e[1],16),t===6?Lb(e):t===3?new Vi(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?gu(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?gu(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=JI.exec(i))?new Vi(e[1],e[2],e[3],1):(e=ek.exec(i))?new Vi(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=tk.exec(i))?gu(e[1],e[2],e[3],e[4]):(e=ik.exec(i))?gu(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=nk.exec(i))?Db(e[1],e[2]/100,e[3]/100,1):(e=rk.exec(i))?Db(e[1],e[2]/100,e[3]/100,e[4]):Ab.hasOwnProperty(i)?Lb(Ab[i]):i==="transparent"?new Vi(NaN,NaN,NaN,0):null}function Lb(i){return new Vi(i>>16&255,i>>8&255,i&255,1)}function gu(i,e,t,n){return n<=0&&(i=e=t=NaN),new Vi(i,e,t,n)}function ak(i){return i instanceof Yc||(i=No(i)),i?(i=i.rgb(),new Vi(i.r,i.g,i.b,i.opacity)):new Vi}function cm(i,e,t,n){return arguments.length===1?ak(i):new Vi(i,e,t,n??1)}function Vi(i,e,t,n){this.r=+i,this.g=+e,this.b=+t,this.opacity=+n}Wg(Vi,cm,Ax(Yc,{brighter(i){return i=i==null?Hh:Math.pow(Hh,i),new Vi(this.r*i,this.g*i,this.b*i,this.opacity)},darker(i){return i=i==null?gc:Math.pow(gc,i),new Vi(this.r*i,this.g*i,this.b*i,this.opacity)},rgb(){return this},clamp(){return new Vi(os(this.r),os(this.g),os(this.b),Gh(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Rb,formatHex:Rb,formatHex8:lk,formatRgb:Pb,toString:Pb}));function Rb(){return`#${ts(this.r)}${ts(this.g)}${ts(this.b)}`}function lk(){return`#${ts(this.r)}${ts(this.g)}${ts(this.b)}${ts((isNaN(this.opacity)?1:this.opacity)*255)}`}function Pb(){const i=Gh(this.opacity);return`${i===1?"rgb(":"rgba("}${os(this.r)}, ${os(this.g)}, ${os(this.b)}${i===1?")":`, ${i})`}`}function Gh(i){return isNaN(i)?1:Math.max(0,Math.min(1,i))}function os(i){return Math.max(0,Math.min(255,Math.round(i)||0))}function ts(i){return i=os(i),(i<16?"0":"")+i.toString(16)}function Db(i,e,t,n){return n<=0?i=e=t=NaN:t<=0||t>=1?i=e=NaN:e<=0&&(i=NaN),new Vn(i,e,t,n)}function Ix(i){if(i instanceof Vn)return new Vn(i.h,i.s,i.l,i.opacity);if(i instanceof Yc||(i=No(i)),!i)return new Vn;if(i instanceof Vn)return i;i=i.rgb();var e=i.r/255,t=i.g/255,n=i.b/255,r=Math.min(e,t,n),o=Math.max(e,t,n),s=NaN,a=o-r,l=(o+r)/2;return a?(e===o?s=(t-n)/a+(t<n)*6:t===o?s=(n-e)/a+2:s=(e-t)/a+4,a/=l<.5?o+r:2-o-r,s*=60):a=l>0&&l<1?0:s,new Vn(s,a,l,i.opacity)}function ck(i,e,t,n){return arguments.length===1?Ix(i):new Vn(i,e,t,n??1)}function Vn(i,e,t,n){this.h=+i,this.s=+e,this.l=+t,this.opacity=+n}Wg(Vn,ck,Ax(Yc,{brighter(i){return i=i==null?Hh:Math.pow(Hh,i),new Vn(this.h,this.s,this.l*i,this.opacity)},darker(i){return i=i==null?gc:Math.pow(gc,i),new Vn(this.h,this.s,this.l*i,this.opacity)},rgb(){var i=this.h%360+(this.h<0)*360,e=isNaN(i)||isNaN(this.s)?0:this.s,t=this.l,n=t+(t<.5?t:1-t)*e,r=2*t-n;return new Vi(Vf(i>=240?i-240:i+120,r,n),Vf(i,r,n),Vf(i<120?i+240:i-120,r,n),this.opacity)},clamp(){return new Vn(Mb(this.h),_u(this.s),_u(this.l),Gh(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const i=Gh(this.opacity);return`${i===1?"hsl(":"hsla("}${Mb(this.h)}, ${_u(this.s)*100}%, ${_u(this.l)*100}%${i===1?")":`, ${i})`}`}}));function Mb(i){return i=(i||0)%360,i<0?i+360:i}function _u(i){return Math.max(0,Math.min(1,i||0))}function Vf(i,e,t){return(i<60?e+(t-e)*i/60:i<180?t:i<240?e+(t-e)*(240-i)/60:e)*255}const jg=i=>()=>i;function uk(i,e){return function(t){return i+t*e}}function hk(i,e,t){return i=Math.pow(i,t),e=Math.pow(e,t)-i,t=1/t,function(n){return Math.pow(i+n*e,t)}}function dk(i){return(i=+i)==1?kx:function(e,t){return t-e?hk(e,t,i):jg(isNaN(e)?t:e)}}function kx(i,e){var t=e-i;return t?uk(i,t):jg(isNaN(i)?e:i)}const Wh=(function i(e){var t=dk(e);function n(r,o){var s=t((r=cm(r)).r,(o=cm(o)).r),a=t(r.g,o.g),l=t(r.b,o.b),c=kx(r.opacity,o.opacity);return function(u){return r.r=s(u),r.g=a(u),r.b=l(u),r.opacity=c(u),r+""}}return n.gamma=i,n})(1);function fk(i,e){e||(e=[]);var t=i?Math.min(e.length,i.length):0,n=e.slice(),r;return function(o){for(r=0;r<t;++r)n[r]=i[r]*(1-o)+e[r]*o;return n}}function pk(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function mk(i,e){var t=e?e.length:0,n=i?Math.min(t,i.length):0,r=new Array(n),o=new Array(t),s;for(s=0;s<n;++s)r[s]=Yg(i[s],e[s]);for(;s<t;++s)o[s]=e[s];return function(a){for(s=0;s<n;++s)o[s]=r[s](a);return o}}function gk(i,e){var t=new Date;return i=+i,e=+e,function(n){return t.setTime(i*(1-n)+e*n),t}}function Un(i,e){return i=+i,e=+e,function(t){return i*(1-t)+e*t}}function _k(i,e){var t={},n={},r;(i===null||typeof i!="object")&&(i={}),(e===null||typeof e!="object")&&(e={});for(r in e)r in i?t[r]=Yg(i[r],e[r]):n[r]=e[r];return function(o){for(r in t)n[r]=t[r](o);return n}}var um=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Hf=new RegExp(um.source,"g");function yk(i){return function(){return i}}function bk(i){return function(e){return i(e)+""}}function Lx(i,e){var t=um.lastIndex=Hf.lastIndex=0,n,r,o,s=-1,a=[],l=[];for(i=i+"",e=e+"";(n=um.exec(i))&&(r=Hf.exec(e));)(o=r.index)>t&&(o=e.slice(t,o),a[s]?a[s]+=o:a[++s]=o),(n=n[0])===(r=r[0])?a[s]?a[s]+=r:a[++s]=r:(a[++s]=null,l.push({i:s,x:Un(n,r)})),t=Hf.lastIndex;return t<e.length&&(o=e.slice(t),a[s]?a[s]+=o:a[++s]=o),a.length<2?l[0]?bk(l[0].x):yk(e):(e=l.length,function(c){for(var u=0,h;u<e;++u)a[(h=l[u]).i]=h.x(c);return a.join("")})}function Yg(i,e){var t=typeof e,n;return e==null||t==="boolean"?jg(e):(t==="number"?Un:t==="string"?(n=No(e))?(e=n,Wh):Lx:e instanceof No?Wh:e instanceof Date?gk:pk(e)?fk:Array.isArray(e)?mk:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?_k:Un)(i,e)}function vk(i,e){return i=+i,e=+e,function(t){return Math.round(i*(1-t)+e*t)}}var Nb=180/Math.PI,Rx={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Px(i,e,t,n,r,o){var s,a,l;return(s=Math.sqrt(i*i+e*e))&&(i/=s,e/=s),(l=i*t+e*n)&&(t-=i*l,n-=e*l),(a=Math.sqrt(t*t+n*n))&&(t/=a,n/=a,l/=a),i*n<e*t&&(i=-i,e=-e,l=-l,s=-s),{translateX:r,translateY:o,rotate:Math.atan2(e,i)*Nb,skewX:Math.atan(l)*Nb,scaleX:s,scaleY:a}}var yu;function xk(i){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(i+"");return e.isIdentity?Rx:Px(e.a,e.b,e.c,e.d,e.e,e.f)}function wk(i){return i==null||(yu||(yu=document.createElementNS("http://www.w3.org/2000/svg","g")),yu.setAttribute("transform",i),!(i=yu.transform.baseVal.consolidate()))?Rx:(i=i.matrix,Px(i.a,i.b,i.c,i.d,i.e,i.f))}function Dx(i,e,t,n){function r(c){return c.length?c.pop()+" ":""}function o(c,u,h,d,f,p){if(c!==h||u!==d){var b=f.push("translate(",null,e,null,t);p.push({i:b-4,x:Un(c,h)},{i:b-2,x:Un(u,d)})}else(h||d)&&f.push("translate("+h+e+d+t)}function s(c,u,h,d){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),d.push({i:h.push(r(h)+"rotate(",null,n)-2,x:Un(c,u)})):u&&h.push(r(h)+"rotate("+u+n)}function a(c,u,h,d){c!==u?d.push({i:h.push(r(h)+"skewX(",null,n)-2,x:Un(c,u)}):u&&h.push(r(h)+"skewX("+u+n)}function l(c,u,h,d,f,p){if(c!==h||u!==d){var b=f.push(r(f)+"scale(",null,",",null,")");p.push({i:b-4,x:Un(c,h)},{i:b-2,x:Un(u,d)})}else(h!==1||d!==1)&&f.push(r(f)+"scale("+h+","+d+")")}return function(c,u){var h=[],d=[];return c=i(c),u=i(u),o(c.translateX,c.translateY,u.translateX,u.translateY,h,d),s(c.rotate,u.rotate,h,d),a(c.skewX,u.skewX,h,d),l(c.scaleX,c.scaleY,u.scaleX,u.scaleY,h,d),c=u=null,function(f){for(var p=-1,b=d.length,g;++p<b;)h[(g=d[p]).i]=g.x(f);return h.join("")}}}var Sk=Dx(xk,"px, ","px)","deg)"),Ek=Dx(wk,", ",")",")"),Ck=1e-12;function Bb(i){return((i=Math.exp(i))+1/i)/2}function Tk(i){return((i=Math.exp(i))-1/i)/2}function Ak(i){return((i=Math.exp(2*i))-1)/(i+1)}const Ik=(function i(e,t,n){function r(o,s){var a=o[0],l=o[1],c=o[2],u=s[0],h=s[1],d=s[2],f=u-a,p=h-l,b=f*f+p*p,g,_;if(b<Ck)_=Math.log(d/c)/e,g=function(F){return[a+F*f,l+F*p,c*Math.exp(e*F*_)]};else{var T=Math.sqrt(b),E=(d*d-c*c+n*b)/(2*c*t*T),y=(d*d-c*c-n*b)/(2*d*t*T),C=Math.log(Math.sqrt(E*E+1)-E),I=Math.log(Math.sqrt(y*y+1)-y);_=(I-C)/e,g=function(F){var V=F*_,q=Bb(C),Q=c/(t*T)*(q*Ak(e*V+C)-Tk(C));return[a+Q*f,l+Q*p,c*q/Bb(e*V+C)]}}return g.duration=_*1e3*e/Math.SQRT2,g}return r.rho=function(o){var s=Math.max(.001,+o),a=s*s,l=a*a;return i(s,a,l)},r})(Math.SQRT2,2,4);function kk(i,e){var t,n;return function(){var r=Cr(this,i),o=r.tween;if(o!==t){n=t=o;for(var s=0,a=n.length;s<a;++s)if(n[s].name===e){n=n.slice(),n.splice(s,1);break}}r.tween=n}}function Lk(i,e,t){var n,r;if(typeof t!="function")throw new Error;return function(){var o=Cr(this,i),s=o.tween;if(s!==n){r=(n=s).slice();for(var a={name:e,value:t},l=0,c=r.length;l<c;++l)if(r[l].name===e){r[l]=a;break}l===c&&r.push(a)}o.tween=r}}function Rk(i,e){var t=this._id;if(i+="",arguments.length<2){for(var n=Yn(this.node(),t).tween,r=0,o=n.length,s;r<o;++r)if((s=n[r]).name===i)return s.value;return null}return this.each((e==null?kk:Lk)(t,i,e))}function qg(i,e,t){var n=i._id;return i.each(function(){var r=Cr(this,n);(r.value||(r.value={}))[e]=t.apply(this,arguments)}),function(r){return Yn(r,n).value[e]}}function Mx(i,e){var t;return(typeof e=="number"?Un:e instanceof No?Wh:(t=No(e))?(e=t,Wh):Lx)(i,e)}function Pk(i){return function(){this.removeAttribute(i)}}function Dk(i){return function(){this.removeAttributeNS(i.space,i.local)}}function Mk(i,e,t){var n,r=t+"",o;return function(){var s=this.getAttribute(i);return s===r?null:s===n?o:o=e(n=s,t)}}function Nk(i,e,t){var n,r=t+"",o;return function(){var s=this.getAttributeNS(i.space,i.local);return s===r?null:s===n?o:o=e(n=s,t)}}function Bk(i,e,t){var n,r,o;return function(){var s,a=t(this),l;return a==null?void this.removeAttribute(i):(s=this.getAttribute(i),l=a+"",s===l?null:s===n&&l===r?o:(r=l,o=e(n=s,a)))}}function Ok(i,e,t){var n,r,o;return function(){var s,a=t(this),l;return a==null?void this.removeAttributeNS(i.space,i.local):(s=this.getAttributeNS(i.space,i.local),l=a+"",s===l?null:s===n&&l===r?o:(r=l,o=e(n=s,a)))}}function Fk(i,e){var t=tf(i),n=t==="transform"?Ek:Mx;return this.attrTween(i,typeof e=="function"?(t.local?Ok:Bk)(t,n,qg(this,"attr."+i,e)):e==null?(t.local?Dk:Pk)(t):(t.local?Nk:Mk)(t,n,e))}function zk(i,e){return function(t){this.setAttribute(i,e.call(this,t))}}function Uk(i,e){return function(t){this.setAttributeNS(i.space,i.local,e.call(this,t))}}function $k(i,e){var t,n;function r(){var o=e.apply(this,arguments);return o!==n&&(t=(n=o)&&Uk(i,o)),t}return r._value=e,r}function Vk(i,e){var t,n;function r(){var o=e.apply(this,arguments);return o!==n&&(t=(n=o)&&zk(i,o)),t}return r._value=e,r}function Hk(i,e){var t="attr."+i;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var n=tf(i);return this.tween(t,(n.local?$k:Vk)(n,e))}function Gk(i,e){return function(){Gg(this,i).delay=+e.apply(this,arguments)}}function Wk(i,e){return e=+e,function(){Gg(this,i).delay=e}}function jk(i){var e=this._id;return arguments.length?this.each((typeof i=="function"?Gk:Wk)(e,i)):Yn(this.node(),e).delay}function Yk(i,e){return function(){Cr(this,i).duration=+e.apply(this,arguments)}}function qk(i,e){return e=+e,function(){Cr(this,i).duration=e}}function Xk(i){var e=this._id;return arguments.length?this.each((typeof i=="function"?Yk:qk)(e,i)):Yn(this.node(),e).duration}function Kk(i,e){if(typeof e!="function")throw new Error;return function(){Cr(this,i).ease=e}}function Zk(i){var e=this._id;return arguments.length?this.each(Kk(e,i)):Yn(this.node(),e).ease}function Qk(i,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;Cr(this,i).ease=t}}function Jk(i){if(typeof i!="function")throw new Error;return this.each(Qk(this._id,i))}function eL(i){typeof i!="function"&&(i=fx(i));for(var e=this._groups,t=e.length,n=new Array(t),r=0;r<t;++r)for(var o=e[r],s=o.length,a=n[r]=[],l,c=0;c<s;++c)(l=o[c])&&i.call(l,l.__data__,c,o)&&a.push(l);return new ro(n,this._parents,this._name,this._id)}function tL(i){if(i._id!==this._id)throw new Error;for(var e=this._groups,t=i._groups,n=e.length,r=t.length,o=Math.min(n,r),s=new Array(n),a=0;a<o;++a)for(var l=e[a],c=t[a],u=l.length,h=s[a]=new Array(u),d,f=0;f<u;++f)(d=l[f]||c[f])&&(h[f]=d);for(;a<n;++a)s[a]=e[a];return new ro(s,this._parents,this._name,this._id)}function iL(i){return(i+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function nL(i,e,t){var n,r,o=iL(e)?Gg:Cr;return function(){var s=o(this,i),a=s.on;a!==n&&(r=(n=a).copy()).on(e,t),s.on=r}}function rL(i,e){var t=this._id;return arguments.length<2?Yn(this.node(),t).on.on(i):this.each(nL(t,i,e))}function oL(i){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==i)return;e&&e.removeChild(this)}}function sL(){return this.on("end.remove",oL(this._id))}function aL(i){var e=this._name,t=this._id;typeof i!="function"&&(i=$g(i));for(var n=this._groups,r=n.length,o=new Array(r),s=0;s<r;++s)for(var a=n[s],l=a.length,c=o[s]=new Array(l),u,h,d=0;d<l;++d)(u=a[d])&&(h=i.call(u,u.__data__,d,a))&&("__data__"in u&&(h.__data__=u.__data__),c[d]=h,of(c[d],e,t,d,c,Yn(u,t)));return new ro(o,this._parents,e,t)}function lL(i){var e=this._name,t=this._id;typeof i!="function"&&(i=dx(i));for(var n=this._groups,r=n.length,o=[],s=[],a=0;a<r;++a)for(var l=n[a],c=l.length,u,h=0;h<c;++h)if(u=l[h]){for(var d=i.call(u,u.__data__,h,l),f,p=Yn(u,t),b=0,g=d.length;b<g;++b)(f=d[b])&&of(f,e,t,b,d,p);o.push(d),s.push(u)}return new ro(o,s,e,t)}var cL=jc.prototype.constructor;function uL(){return new cL(this._groups,this._parents)}function hL(i,e){var t,n,r;return function(){var o=Ta(this,i),s=(this.style.removeProperty(i),Ta(this,i));return o===s?null:o===t&&s===n?r:r=e(t=o,n=s)}}function Nx(i){return function(){this.style.removeProperty(i)}}function dL(i,e,t){var n,r=t+"",o;return function(){var s=Ta(this,i);return s===r?null:s===n?o:o=e(n=s,t)}}function fL(i,e,t){var n,r,o;return function(){var s=Ta(this,i),a=t(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(i),Ta(this,i))),s===l?null:s===n&&l===r?o:(r=l,o=e(n=s,a))}}function pL(i,e){var t,n,r,o="style."+e,s="end."+o,a;return function(){var l=Cr(this,i),c=l.on,u=l.value[o]==null?a||(a=Nx(e)):void 0;(c!==t||r!==u)&&(n=(t=c).copy()).on(s,r=u),l.on=n}}function mL(i,e,t){var n=(i+="")=="transform"?Sk:Mx;return e==null?this.styleTween(i,hL(i,n)).on("end.style."+i,Nx(i)):typeof e=="function"?this.styleTween(i,fL(i,n,qg(this,"style."+i,e))).each(pL(this._id,i)):this.styleTween(i,dL(i,n,e),t).on("end.style."+i,null)}function gL(i,e,t){return function(n){this.style.setProperty(i,e.call(this,n),t)}}function _L(i,e,t){var n,r;function o(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&gL(i,s,t)),n}return o._value=e,o}function yL(i,e,t){var n="style."+(i+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;return this.tween(n,_L(i,e,t??""))}function bL(i){return function(){this.textContent=i}}function vL(i){return function(){var e=i(this);this.textContent=e??""}}function xL(i){return this.tween("text",typeof i=="function"?vL(qg(this,"text",i)):bL(i==null?"":i+""))}function wL(i){return function(e){this.textContent=i.call(this,e)}}function SL(i){var e,t;function n(){var r=i.apply(this,arguments);return r!==t&&(e=(t=r)&&wL(r)),e}return n._value=i,n}function EL(i){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(i==null)return this.tween(e,null);if(typeof i!="function")throw new Error;return this.tween(e,SL(i))}function CL(){for(var i=this._name,e=this._id,t=Bx(),n=this._groups,r=n.length,o=0;o<r;++o)for(var s=n[o],a=s.length,l,c=0;c<a;++c)if(l=s[c]){var u=Yn(l,e);of(l,i,t,c,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new ro(n,this._parents,i,t)}function TL(){var i,e,t=this,n=t._id,r=t.size();return new Promise(function(o,s){var a={value:s},l={value:function(){--r===0&&o()}};t.each(function(){var c=Cr(this,n),u=c.on;u!==i&&(e=(i=u).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),c.on=e}),r===0&&o()})}var AL=0;function ro(i,e,t,n){this._groups=i,this._parents=e,this._name=t,this._id=n}function Bx(){return++AL}var Or=jc.prototype;ro.prototype={constructor:ro,select:aL,selectAll:lL,selectChild:Or.selectChild,selectChildren:Or.selectChildren,filter:eL,merge:tL,selection:uL,transition:CL,call:Or.call,nodes:Or.nodes,node:Or.node,size:Or.size,empty:Or.empty,each:Or.each,on:rL,attr:Fk,attrTween:Hk,style:mL,styleTween:yL,text:xL,textTween:EL,remove:sL,tween:Rk,delay:jk,duration:Xk,ease:Zk,easeVarying:Jk,end:TL,[Symbol.iterator]:Or[Symbol.iterator]};function IL(i){return i*i}function kL(i){return i*(2-i)}function LL(i){return((i*=2)<=1?i*i:--i*(2-i)+1)/2}function RL(i){return((i*=2)<=1?i*i*i:(i-=2)*i*i+2)/2}var PL={time:null,delay:0,duration:250,ease:RL};function DL(i,e){for(var t;!(t=i.__transition)||!(t=t[e]);)if(!(i=i.parentNode))throw new Error(`transition ${e} not found`);return t}function ML(i){var e,t;i instanceof ro?(e=i._id,i=i._name):(e=Bx(),(t=PL).time=Hg(),i=i==null?null:i+"");for(var n=this._groups,r=n.length,o=0;o<r;++o)for(var s=n[o],a=s.length,l,c=0;c<a;++c)(l=s[c])&&of(l,i,e,c,s,t||DL(l,e));return new ro(n,this._parents,i,e)}jc.prototype.interrupt=ZI;jc.prototype.transition=ML;function Ob(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();i=e[0]*1e3+e[1]/1e6}else i=Date.now();return i}class Fb{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Ob(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Ob()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class NL{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:n}=e;let r=this.stats[t];return r||(e instanceof Fb?r=e:r=new Fb(t,n),this.stats[t]=r),r}}class BL{constructor(){B(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new NL({id:e})),this.stats.get(e)}}const Ox=new BL,Gf=globalThis,bu=globalThis.process||{},TX=globalThis.navigator||{};function OL(i){var e,t;if(typeof window<"u"&&((e=window.process)==null?void 0:e.type)==="renderer"||typeof process<"u"&&(t=process.versions)!=null&&t.electron)return!0;const n=typeof navigator<"u"&&navigator.userAgent;return!!(n&&n.indexOf("Electron")>=0)}function qc(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||OL()}const Fx="4.1.0";function FL(i){try{const e=window[i],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class zL{constructor(e,t,n="sessionStorage"){this.storage=FL(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function UL(i){let e;return i<10?e=`${i.toFixed(2)}ms`:i<100?e=`${i.toFixed(1)}ms`:i<1e3?e=`${i.toFixed(0)}ms`:e=`${(i/1e3).toFixed(2)}s`,e}function $L(i,e=8){const t=Math.max(e-i.length,0);return`${" ".repeat(t)}${i}`}var jh;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(jh||(jh={}));const VL=10;function zb(i){return typeof i!="string"?i:(i=i.toUpperCase(),jh[i]||jh.WHITE)}function HL(i,e,t){return!qc&&typeof i=="string"&&(e&&(i=`\x1B[${zb(e)}m${i}\x1B[39m`),t&&(i=`\x1B[${zb(t)+VL}m${i}\x1B[49m`)),i}function GL(i,e=["constructor"]){const t=Object.getPrototypeOf(i),n=Object.getOwnPropertyNames(t),r=i;for(const o of n){const s=r[o];typeof s=="function"&&(e.find(a=>o===a)||(r[o]=s.bind(i)))}}function Xg(i,e){if(!i)throw new Error("Assertion failed")}function Bs(){var i,e,t;let n;if(qc()&&Gf.performance)n=(e=(i=Gf==null?void 0:Gf.performance)==null?void 0:i.now)==null?void 0:e.call(i);else if("hrtime"in bu){const r=(t=bu==null?void 0:bu.hrtime)==null?void 0:t.call(bu);n=r[0]*1e3+r[1]/1e6}else n=Date.now();return n}const Os={debug:qc()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},WL={enabled:!0,level:0};function Fs(){}const Ub={},$b={once:!0};class zx{constructor({id:e}={id:""}){this.VERSION=Fx,this._startTs=Bs(),this._deltaTs=Bs(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new zL(`__probe-${this.id}__`,WL),this.timeStamp(`${this.id} started`),GL(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Bs()-this._startTs).toPrecision(10))}getDelta(){return Number((Bs()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Os.warn,arguments,$b)}error(e){return this._getLogFunction(0,e,Os.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Os.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Os.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Os.debug||Os.info,arguments,$b)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||Fs,n&&[n],{tag:YL(t)}):Fs}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Fs)}group(e,t,n={collapsed:!1}){const r=Vb({logLevel:e,message:t,opts:n}),{collapsed:o}=n;return r.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,t,n={}){return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Fs)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Ux(e)}_getLogFunction(e,t,n,r,o){if(this._shouldLog(e)){o=Vb({logLevel:e,message:t,args:r,opts:o}),n=n||o.method,Xg(n),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=Bs();const s=o.tag||o.message;if(o.once&&s)if(!Ub[s])Ub[s]=Bs();else return Fs;return t=jL(this.id,o.message,o),n.bind(console,t,...o.args)}return Fs}}zx.VERSION=Fx;function Ux(i){if(!i)return 0;let e;switch(typeof i){case"number":e=i;break;case"object":e=i.logLevel||i.priority||0;break;default:return 0}return Xg(Number.isFinite(e)&&e>=0),e}function Vb(i){const{logLevel:e,message:t}=i;i.logLevel=Ux(e);const n=i.args?Array.from(i.args):[];for(;n.length&&n.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&n.unshift(t),i.message=e;break;case"object":Object.assign(i,e);break}typeof i.message=="function"&&(i.message=i.message());const r=typeof i.message;return Xg(r==="string"||r==="object"),Object.assign(i,{args:n},i.opts)}function jL(i,e,t){if(typeof e=="string"){const n=t.time?$L(UL(t.total)):"";e=t.time?`${i}: ${n}  ${e}`:`${i}: ${e}`,e=HL(e,t.color,t.background)}return e}function YL(i){for(const e in i)for(const t in i[e])return t||"untitled";return"empty"}const Z=new zx({id:"luma.gl"}),Wf={};function Kg(i="id"){Wf[i]=Wf[i]||1;const e=Wf[i]++;return`${i}-${e}`}class Di{constructor(e,t,n){if(B(this,"id"),B(this,"props"),B(this,"userData",{}),B(this,"_device"),B(this,"destroyed",!1),B(this,"allocatedBytes",0),B(this,"_attachedResources",new Set),!e)throw new Error("no device");this._device=e,this.props=qL(t,n);const r=this.props.id!=="undefined"?this.props.id:Kg(this[Symbol.toStringTag]);this.props.id=r,this.id=r,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}}B(Di,"defaultProps",{id:"undefined",handle:void 0,userData:void 0});function qL(i,e){const t={...e};for(const n in i)i[n]!==void 0&&(t[n]=i[n]);return t}const Ji=class lh extends Di{constructor(e,t){const n={...t};(t.usage||0)&lh.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?n.indexType="uint32":t.data instanceof Uint16Array&&(n.indexType="uint16")),delete n.data,super(e,n,lh.defaultProps),B(this,"usage"),B(this,"indexType"),B(this,"updateTimestamp"),B(this,"debugData",new ArrayBuffer(0)),this.usage=n.usage||0,this.indexType=n.indexType,this.updateTimestamp=e.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(e){return this.device.createBuffer({...this.props,...e})}_setDebugData(e,t,n){const r=ArrayBuffer.isView(e)?e.buffer:e,o=Math.min(e?e.byteLength:n,lh.DEBUG_DATA_MAX_LENGTH);r===null?this.debugData=new ArrayBuffer(o):t===0&&n===r.byteLength?this.debugData=r.slice(0,o):this.debugData=r.slice(t,t+o)}};B(Ji,"INDEX",16),B(Ji,"VERTEX",32),B(Ji,"UNIFORM",64),B(Ji,"STORAGE",128),B(Ji,"INDIRECT",256),B(Ji,"QUERY_RESOLVE",512),B(Ji,"MAP_READ",1),B(Ji,"MAP_WRITE",2),B(Ji,"COPY_SRC",4),B(Ji,"COPY_DST",8),B(Ji,"DEBUG_DATA_MAX_LENGTH",32),B(Ji,"defaultProps",{...Di.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0});let se=Ji;function $x(i){const[e,t,n]=Zg[i],r=i.includes("norm"),o=!r&&!i.startsWith("float"),s=i.startsWith("s");return{signedType:e,primitiveType:t,byteLength:n,normalized:r,integer:o,signed:s}}function XL(i){const e=i;switch(e){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return e}}function KL(i,e){switch(e){case 1:return i;case 2:return i+i%2;default:return i+(4-i%4)%4}}function ZL(i){const e=ArrayBuffer.isView(i)?i.constructor:i;if(e===Uint8ClampedArray)return"uint8";const t=Object.values(Zg).find(n=>e===n[4]);if(!t)throw new Error(e.name);return t[0]}function QL(i){const[,,,,e]=Zg[i];return e}const Zg={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]};function Qg(i){let e;i.endsWith("-webgl")&&(i.replace("-webgl",""),e=!0);const[t,n]=i.split("x"),r=t,o=n?parseInt(n):1,s=$x(r),a={type:r,components:o,byteLength:s.byteLength*o,integer:s.integer,signed:s.signed,normalized:s.normalized};return e&&(a.webglOnly=!0),a}function JL(i,e,t){const n=t?XL(i):i;switch(n){case"unorm8":return e===1?"unorm8":e===3?"unorm8x3-webgl":`${n}x${e}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(e===1||e===3)throw new Error(`size: ${e}`);return`${n}x${e}`;default:return e===1?n:`${n}x${e}`}}function e4(i,e,t){if(!e||e>4)throw new Error(`size ${e}`);const n=e,r=ZL(i);return JL(r,n,t)}function t4(i){let e;switch(i.primitiveType){case"f32":e="float32";break;case"i32":e="sint32";break;case"u32":e="uint32";break;case"f16":return i.components<=2?"float16x2":"float16x4"}return i.components===1?e:`${e}x${i.components}`}const ui="texture-compression-bc",pt="texture-compression-astc",tr="texture-compression-etc2",i4="texture-compression-etc1-webgl",vu="texture-compression-pvrtc-webgl",jf="texture-compression-atc-webgl",xu="float32-renderable-webgl",Yf="float16-renderable-webgl",n4="rgb9e5ufloat-renderable-webgl",qf="snorm8-renderable-webgl",fl="norm16-renderable-webgl",Xf="snorm16-renderable-webgl",wu="float32-filterable",Hb="float16-filterable-webgl";function Vx(i){const e=s4[i];if(!e)throw new Error(`Unsupported texture format ${i}`);return e}const r4={r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:qf},rg8snorm:{render:qf},"rgb8snorm-webgl":{},rgba8snorm:{render:qf},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:fl},rg16unorm:{render:fl},"rgb16unorm-webgl":{f:fl},rgba16unorm:{render:fl},r16snorm:{f:Xf},rg16snorm:{render:Xf},"rgb16snorm-webgl":{f:fl},rgba16snorm:{render:Xf},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:Yf,filter:"float16-filterable-webgl"},rg16float:{render:Yf,filter:Hb},rgba16float:{render:Yf,filter:Hb},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:xu,filter:wu},rg32float:{render:!1,filter:wu},"rgb32float-webgl":{render:xu,filter:wu},rgba32float:{render:xu,filter:wu},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:n4},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:xu},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0}},o4={"bc1-rgb-unorm-webgl":{f:ui},"bc1-rgb-unorm-srgb-webgl":{f:ui},"bc1-rgba-unorm":{f:ui},"bc1-rgba-unorm-srgb":{f:ui},"bc2-rgba-unorm":{f:ui},"bc2-rgba-unorm-srgb":{f:ui},"bc3-rgba-unorm":{f:ui},"bc3-rgba-unorm-srgb":{f:ui},"bc4-r-unorm":{f:ui},"bc4-r-snorm":{f:ui},"bc5-rg-unorm":{f:ui},"bc5-rg-snorm":{f:ui},"bc6h-rgb-ufloat":{f:ui},"bc6h-rgb-float":{f:ui},"bc7-rgba-unorm":{f:ui},"bc7-rgba-unorm-srgb":{f:ui},"etc2-rgb8unorm":{f:tr},"etc2-rgb8unorm-srgb":{f:tr},"etc2-rgb8a1unorm":{f:tr},"etc2-rgb8a1unorm-srgb":{f:tr},"etc2-rgba8unorm":{f:tr},"etc2-rgba8unorm-srgb":{f:tr},"eac-r11unorm":{f:tr},"eac-r11snorm":{f:tr},"eac-rg11unorm":{f:tr},"eac-rg11snorm":{f:tr},"astc-4x4-unorm":{f:pt},"astc-4x4-unorm-srgb":{f:pt},"astc-5x4-unorm":{f:pt},"astc-5x4-unorm-srgb":{f:pt},"astc-5x5-unorm":{f:pt},"astc-5x5-unorm-srgb":{f:pt},"astc-6x5-unorm":{f:pt},"astc-6x5-unorm-srgb":{f:pt},"astc-6x6-unorm":{f:pt},"astc-6x6-unorm-srgb":{f:pt},"astc-8x5-unorm":{f:pt},"astc-8x5-unorm-srgb":{f:pt},"astc-8x6-unorm":{f:pt},"astc-8x6-unorm-srgb":{f:pt},"astc-8x8-unorm":{f:pt},"astc-8x8-unorm-srgb":{f:pt},"astc-10x5-unorm":{f:pt},"astc-10x5-unorm-srgb":{f:pt},"astc-10x6-unorm":{f:pt},"astc-10x6-unorm-srgb":{f:pt},"astc-10x8-unorm":{f:pt},"astc-10x8-unorm-srgb":{f:pt},"astc-10x10-unorm":{f:pt},"astc-10x10-unorm-srgb":{f:pt},"astc-12x10-unorm":{f:pt},"astc-12x10-unorm-srgb":{f:pt},"astc-12x12-unorm":{f:pt},"astc-12x12-unorm-srgb":{f:pt},"pvrtc-rgb4unorm-webgl":{f:vu},"pvrtc-rgba4unorm-webgl":{f:vu},"pvrtc-rbg2unorm-webgl":{f:vu},"pvrtc-rgba2unorm-webgl":{f:vu},"etc1-rbg-unorm-webgl":{f:i4},"atc-rgb-unorm-webgl":{f:jf},"atc-rgba-unorm-webgl":{f:jf},"atc-rgbai-unorm-webgl":{f:jf}},s4={...r4,...o4},a4=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],l4=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;class c4{getInfo(e){return Gb(e)}isColor(e){return e.startsWith("rgba")||e.startsWith("bgra")||e.startsWith("rgb")}isDepthStencil(e){return e.startsWith("depth")||e.startsWith("stencil")}isCompressed(e){return a4.some(t=>e.startsWith(t))}getCapabilities(e){const t=Vx(e),n={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},r=Gb(e),o=e.startsWith("depth")||e.startsWith("stencil"),s=r==null?void 0:r.signed,a=r==null?void 0:r.integer,l=r==null?void 0:r.webgl;return n.render&&(n.render=!s),n.filter&&(n.filter=!o&&!s&&!a&&!l),n}}const rc=new c4;function Gb(i){let e=u4(i);if(rc.isCompressed(i)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const n=h4(i);n&&(e.blockWidth=n.blockWidth,e.blockHeight=n.blockHeight)}const t=l4.exec(i);if(t){const[,n,r,o,s,a]=t,l=`${o}${r}`,c=$x(l),u=c.byteLength*8,h=n.length,d=[u,h>=2?u:0,h>=3?u:0,h>=4?u:0];e={format:i,attachment:e.attachment,dataType:c.signedType,components:h,channels:n,integer:c.integer,signed:c.signed,normalized:c.normalized,bitsPerChannel:d,bytesPerPixel:c.byteLength*n.length,packed:e.packed,srgb:e.srgb},a==="-webgl"&&(e.webgl=!0),s==="-srgb"&&(e.srgb=!0)}return i.endsWith("-webgl")&&(e.webgl=!0),i.endsWith("-srgb")&&(e.srgb=!0),e}function u4(i){var e;const t=Vx(i),n=t.bytesPerPixel||1,r=t.bitsPerChannel||[8,8,8,8];return delete t.bitsPerChannel,delete t.bytesPerPixel,delete t.f,delete t.render,delete t.filter,delete t.blend,delete t.store,{...t,format:i,attachment:t.attachment||"color",channels:t.channels||"r",components:t.components||((e=t.channels)==null?void 0:e.length)||1,bytesPerPixel:n,bitsPerChannel:r,dataType:t.dataType||"uint8",srgb:t.srgb??!1,packed:t.packed??!1,webgl:t.webgl??!1,integer:t.integer??!1,signed:t.signed??!1,normalized:t.normalized??!1,compressed:t.compressed??!1}}function h4(i){const e=/.*-(\d+)x(\d+)-.*/.exec(i);if(e){const[,t,n]=e;return{blockWidth:Number(t),blockHeight:Number(n)}}return null}function d4(i){return typeof ImageData<"u"&&i instanceof ImageData||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement||typeof VideoFrame<"u"&&i instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas}function f4(i){if(typeof ImageData<"u"&&i instanceof ImageData||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas)return{width:i.width,height:i.height};if(typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement)return{width:i.naturalWidth,height:i.naturalHeight};if(typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement)return{width:i.videoWidth,height:i.videoHeight};if(typeof VideoFrame<"u"&&i instanceof VideoFrame)return{width:i.displayWidth,height:i.displayHeight};throw new Error("Unknown image type")}class AX{}class IX{constructor(e=[],t){B(this,"features"),B(this,"disabledFeatures"),this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){var t;return!((t=this.disabledFeatures)!=null&&t[e])&&this.features.has(e)}}const Hx=class Gx{constructor(e){B(this,"id"),B(this,"props"),B(this,"userData",{}),B(this,"statsManager",Ox),B(this,"timestamp",0),B(this,"_reused",!1),B(this,"_lumaData",{}),B(this,"_textureCaps",{}),this.props={...Gx.defaultProps,...e},this.id=this.props.id||Kg(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}getVertexFormatInfo(e){return Qg(e)}isVertexFormatSupported(e){return!0}getTextureFormatInfo(e){return rc.getInfo(e)}getTextureFormatCapabilities(e){let t=this._textureCaps[e];if(!t){const n=this._getDeviceTextureFormatCapabilities(e);t=this._getDeviceSpecificTextureFormatCapabilities(n),this._textureCaps[e]=t}return t}getMipLevelCount(e,t,n=1){const r=Math.max(e,t,n);return 1+Math.floor(Math.log2(r))}isExternalImage(e){return d4(e)}getExternalImageSize(e){return f4(e)}isTextureFormatSupported(e){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return rc.isCompressed(e)}pushDebugGroup(e){this.commandEncoder.pushDebugGroup(e)}popDebugGroup(){var e;(e=this.commandEncoder)==null||e.popDebugGroup()}insertDebugMarker(e){var t;(t=this.commandEncoder)==null||t.insertDebugMarker(e)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(e,t,...n){return this.props.onError(e,t)?()=>{}:Z.error(e.message,t,...n)}debug(){if(this.props.debug)debugger;else Z.once(0,`'Type luma.log.set({debug: true}) in console to enable debug breakpoints',
or create a device with the 'debug: true' prop.`)()}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(e){return this.commandEncoder.beginRenderPass(e)}beginComputePass(e){return this.commandEncoder.beginComputePass(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_getDeviceTextureFormatCapabilities(e){const t=rc.getCapabilities(e),n=o=>(typeof o=="string"?this.features.has(o):o)??!0,r=n(t.create);return{format:e,create:r,render:r&&n(t.render),filter:r&&n(t.filter),blend:r&&n(t.blend),store:r&&n(t.store)}}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};if((e.usage||0)&se.INDEX&&(e.indexType||(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array&&(t.indexType="uint16")),!t.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return t}};B(Hx,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(i,e)=>{},onResize:(i,e)=>{const[t,n]=i.getDevicePixelSize();Z.log(1,`${i} resized => ${t}x${n}px`)()},onPositionChange:(i,e)=>{const[t,n]=i.getPosition();Z.log(1,`${i} repositioned => ${t},${n}`)()},onVisibilityChange:i=>Z.log(1,`${i} Visibility changed ${i.isVisible}`)(),onDevicePixelRatioChange:(i,e)=>Z.log(1,`${i} DPR changed ${e.oldRatio} => ${i.devicePixelRatio}`)(),debug:Z.get("debug")||void 0,debugShaders:Z.get("debug-shaders")||void 0,debugFramebuffers:!!Z.get("debug-framebuffers"),debugFactories:!!Z.get("debug-factories"),debugWebGL:!!Z.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0});let hm=Hx;const p4="set luma.log.level=1 (or higher) to trace rendering",Wb="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",Wx=class dm{constructor(){if(B(this,"stats",Ox),B(this,"log",Z),B(this,"VERSION","9.2.5"),B(this,"spector"),B(this,"preregisteredAdapters",new Map),globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Z.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),Z.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Z.error("This version of luma.gl has already been initialized")()}Z.log(1,`${this.VERSION} - ${p4}`)(),globalThis.luma=this}async createDevice(e={}){const t={...dm.defaultProps,...e},n=this.selectAdapter(t.type,t.adapters);if(!n)throw new Error(Wb);return t.waitForPageLoad&&await n.pageLoaded,await n.create(t)}async attachDevice(e,t){var n;const r=this._getTypeFromHandle(e,t.adapters),o=r&&this.selectAdapter(r,t.adapters);if(!o)throw new Error(Wb);return await((n=o==null?void 0:o.attach)==null?void 0:n.call(o,e,t))}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this._getAdapterMap(e);return Array.from(t).map(([,n])=>n).filter(n=>{var r;return(r=n.isSupported)==null?void 0:r.call(n)}).map(n=>n.type)}getBestAvailableAdapterType(e=[]){var t,n;const r=["webgpu","webgl","null"],o=this._getAdapterMap(e);for(const s of r)if((n=(t=o.get(s))==null?void 0:t.isSupported)!=null&&n.call(t))return s;return null}selectAdapter(e,t=[]){let n=e;e==="best-available"&&(n=this.getBestAvailableAdapterType(t));const r=this._getAdapterMap(t);return n&&r.get(n)||null}enforceWebGL2(e=!0,t=[]){var n;const r=this._getAdapterMap(t).get("webgl");r||Z.warn("enforceWebGL2: webgl adapter not found")(),(n=r==null?void 0:r.enforceWebGL2)==null||n.call(r,e)}setDefaultDeviceProps(e){Object.assign(dm.defaultProps,e)}_getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const n of e)t.set(n.type,n);return t}_getTypeFromHandle(e,t=[]){return e instanceof WebGL2RenderingContext?"webgl":typeof GPUDevice<"u"&&e instanceof GPUDevice||e!=null&&e.queue?"webgpu":e===null?"null":(e instanceof WebGLRenderingContext?Z.warn("WebGL1 is not supported",e)():Z.warn("Unknown handle type",e)(),null)}};B(Wx,"defaultProps",{...hm.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0});let m4=Wx;const g4=new m4;class _4{get pageLoaded(){return v4()}}const y4=qc()&&typeof document<"u",b4=()=>y4&&document.readyState==="complete";let Su=null;function v4(){return Su||(b4()||typeof window>"u"?Su=Promise.resolve():Su=new Promise(i=>window.addEventListener("load",()=>i()))),Su}const jx=class fm extends Di{get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=fm.normalizeProps(e,t),super(e,t,fm.defaultProps)}static normalizeProps(e,t){return t}};B(jx,"defaultProps",{...Di.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Jg=jx;const x4={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"},Oi=class Ul extends Di{constructor(e,t){if(t=Ul.normalizeProps(e,t),super(e,t,Ul.defaultProps),B(this,"dimension"),B(this,"baseDimension"),B(this,"format"),B(this,"width"),B(this,"height"),B(this,"depth"),B(this,"mipLevels"),B(this,"updateTimestamp"),this.dimension=this.props.dimension,this.baseDimension=x4[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,this.props.width===void 0||this.props.height===void 0)if(e.isExternalImage(t.data)){const n=e.getExternalImageSize(t.data);this.width=(n==null?void 0:n.width)||1,this.height=(n==null?void 0:n.height)||1}else this.width=1,this.height=1,(this.props.width===void 0||this.props.height===void 0)&&Z.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=e.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}setSampler(e){this.sampler=e instanceof Jg?e:this.device.createSampler(e)}clone(e){return this.device.createTexture({...this.props,...e})}static normalizeProps(e,t){const n={...t},{width:r,height:o}=n;return typeof r=="number"&&(n.width=Math.max(1,Math.ceil(r))),typeof o=="number"&&(n.height=Math.max(1,Math.ceil(o))),n}_initializeData(e){this.device.isExternalImage(e)?this.copyExternalImage({image:e,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):e&&this.copyImageData({data:e,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(e){const{width:t,height:n,depth:r}=this,o={...Ul.defaultCopyDataOptions,width:t,height:n,depth:r,...e},s=this.device.getTextureFormatInfo(this.format);if(!e.bytesPerRow&&!s.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return o.bytesPerRow=e.bytesPerRow||t*(s.bytesPerPixel||4),o.rowsPerImage=e.rowsPerImage||n,o}_normalizeCopyExternalImageOptions(e){const t=this.device.getExternalImageSize(e.image),n={...Ul.defaultCopyExternalImageOptions,...t,...e};return n.width=Math.min(n.width,this.width-n.x),n.height=Math.min(n.height,this.height-n.y),n}};B(Oi,"SAMPLE",4),B(Oi,"STORAGE",8),B(Oi,"RENDER",16),B(Oi,"COPY_SRC",1),B(Oi,"COPY_DST",2),B(Oi,"TEXTURE",4),B(Oi,"RENDER_ATTACHMENT",16),B(Oi,"defaultProps",{...Di.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:Oi.TEXTURE|Oi.RENDER_ATTACHMENT|Oi.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0}),B(Oi,"defaultCopyDataOptions",{data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"}),B(Oi,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let Ve=Oi;const Yx=class qx extends Di{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,qx.defaultProps)}};B(Yx,"defaultProps",{...Di.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let w4=Yx;function S4(i,e,t){let n="";const r=e.split(/\r?\n/),o=i.slice().sort((s,a)=>s.lineNum-a.lineNum);switch((t==null?void 0:t.showSourceCode)||"no"){case"all":let s=0;for(let a=1;a<=r.length;a++)for(n+=Xx(r[a-1],a,t);o.length>s&&o[s].lineNum===a;){const l=o[s++];n+=Kf(l,r,l.lineNum,{...t,inlineSource:!1})}for(;o.length>s;){const a=o[s++];n+=Kf(a,[],0,{...t,inlineSource:!1})}return n;case"issues":case"no":for(const a of i)n+=Kf(a,r,a.lineNum,{inlineSource:(t==null?void 0:t.showSourceCode)!=="no"});return n}}function Kf(i,e,t,n){if(n!=null&&n.inlineSource){const o=E4(e,t),s=i.linePos>0?`${" ".repeat(i.linePos+5)}^^^
`:"";return`
${o}${s}${i.type.toUpperCase()}: ${i.message}

`}const r=i.type==="error"?"red":"#8B4000";return n!=null&&n.html?`<div class='luma-compiler-log-error' style="color:${r};"><b> ${i.type.toUpperCase()}: ${i.message}</b></div>`:`${i.type.toUpperCase()}: ${i.message}`}function E4(i,e,t){let n="";for(let r=e-2;r<=e;r++){const o=i[r-1];o!==void 0&&(n+=Xx(o,e,t))}return n}function Xx(i,e,t){const n=t!=null&&t.html?T4(i):i;return`${C4(String(e),4)}: ${n}${t!=null&&t.html?"<br/>":`
`}`}function C4(i,e){let t="";for(let n=i.length;n<e;++n)t+=" ";return t+i}function T4(i){return i.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const Kx=class Zx extends Di{constructor(e,t){t={...t,debugShaders:t.debugShaders||e.props.debugShaders||"errors"},super(e,{id:I4(t),...t},Zx.defaultProps),B(this,"stage"),B(this,"source"),B(this,"compilationStatus","pending"),this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const t=await this.getCompilationInfo();e==="warnings"&&(t==null?void 0:t.length)===0||this._displayShaderLog(t,this.id)}_displayShaderLog(e,t){var n;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=t,o=`${this.stage} shader "${r}"`;let s=S4(e,this.source,{showSourceCode:"all",html:!0});const a=this.getTranslatedSource();a&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${a}</pre></code>`);const l=document.createElement("Button");l.innerHTML=`
<h1>Compilation error in ${o}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,l.style.top="10px",l.style.left="10px",l.style.position="absolute",l.style.zIndex="9999",l.style.width="100%",l.style.textAlign="left",document.body.appendChild(l),(n=document.getElementsByClassName("luma-compiler-log-error")[0])==null||n.scrollIntoView(),l.onclick=()=>{const c=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(c)}}};B(Kx,"defaultProps",{...Di.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let A4=Kx;function I4(i){return k4(i.source)||i.id||Kg(`unnamed ${i.stage}-shader`)}function k4(i,e="unnamed"){const t=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(i);return t?t[1]:e}const Qx=class Jx extends Di{constructor(e,t){super(e,t,Jx.defaultProps),B(this,"shaderLayout"),B(this,"bufferLayout"),B(this,"linkStatus","pending"),B(this,"hash",""),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}};B(Qx,"defaultProps",{...Di.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}});let Yh=Qx;const ew=class tw extends Di{constructor(e,t){super(e,t,tw.defaultProps),B(this,"hash",""),B(this,"shaderLayout"),this.shaderLayout=t.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};B(ew,"defaultProps",{...Di.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let jb=ew;function L4(i){return M4[i]}function R4(i){const[e,t]=D4[i],n=e==="i32"||e==="u32",r=e!=="u32",o=P4[e]*t;return{primitiveType:e,components:t,byteLength:o,integer:n,signed:r}}const P4={f32:4,f16:2,i32:4,u32:4},D4={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},M4={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}};function iw(i,e){const t={};for(const n of i.attributes){const r=N4(i,e,n.name);r&&(t[n.name]=r)}return t}function kX(i,e,t=16){const n=iw(i,e),r=new Array(t).fill(null);for(const o of Object.values(n))r[o.location]=o;return r}function N4(i,e,t){const n=B4(i,t),r=O4(e,t);if(!n)return null;const o=R4(n.type),s=t4(o),a=(r==null?void 0:r.vertexFormat)||s,l=Qg(a);return{attributeName:(r==null?void 0:r.attributeName)||n.name,bufferName:(r==null?void 0:r.bufferName)||n.name,location:n.location,shaderType:n.type,primitiveType:o.primitiveType,shaderComponents:o.components,vertexFormat:a,bufferDataType:l.type,bufferComponents:l.components,normalized:l.normalized,integer:o.integer,stepMode:(r==null?void 0:r.stepMode)||n.stepMode||"vertex",byteOffset:(r==null?void 0:r.byteOffset)||0,byteStride:(r==null?void 0:r.byteStride)||0}}function B4(i,e){const t=i.attributes.find(n=>n.name===e);return t||Z.warn(`shader layout attribute "${e}" not present in shader`),t||null}function O4(i,e){F4(i);let t=z4(i,e);return t||(t=U4(i,e),t)?t:(Z.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function F4(i){for(const e of i)(e.attributes&&e.format||!e.attributes&&!e.format)&&Z.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function z4(i,e){for(const t of i)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function U4(i,e){var t;for(const n of i){let r=n.byteStride;if(typeof n.byteStride!="number")for(const s of n.attributes||[]){const a=Qg(s.format);r+=a.byteLength}const o=(t=n.attributes)==null?void 0:t.find(s=>s.attribute===e);if(o)return{attributeName:o.attribute,bufferName:n.name,stepMode:n.stepMode,vertexFormat:o.format,byteOffset:o.byteOffset,byteStride:r}}return null}let Eu;function nw(i){return(!Eu||Eu.byteLength<i)&&(Eu=new ArrayBuffer(i)),Eu}function LX(i,e){const t=nw(i.BYTES_PER_ELEMENT*e);return new i(t,0,e)}function $4(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function qh(i){return Array.isArray(i)?i.length===0||typeof i[0]=="number":$4(i)}const V4=1024;class H4{constructor(e,t={}){B(this,"layout",{}),B(this,"byteLength");let n=0;for(const[o,s]of Object.entries(e)){const a=L4(s),{type:l,components:c}=a,u=c*((t==null?void 0:t[o])??1);n=KL(n,u);const h=n;n+=u,this.layout[o]={type:l,size:u,offset:h}}n+=(4-n%4)%4;const r=n*4;this.byteLength=Math.max(r,V4)}getData(e){const t=nw(this.byteLength),n={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(const[r,o]of Object.entries(e)){const s=this.layout[r];if(!s){Z.warn(`Supplied uniform value ${r} not present in uniform block layout`)();continue}const{type:a,size:l,offset:c}=s,u=n[a];if(l===1){if(typeof o!="number"&&typeof o!="boolean"){Z.warn(`Supplied value for single component uniform ${r} is not a number: ${o}`)();continue}u[c]=Number(o)}else{if(!qh(o)){Z.warn(`Supplied value for multi component / array uniform ${r} is not a numeric array: ${o}`)();continue}u.set(o,c)}}return new Uint8Array(t,0,this.byteLength)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function G4(i,e,t=16){if(i!==e)return!1;const n=i,r=e;if(!qh(n))return!1;if(qh(r)&&n.length===r.length){for(let o=0;o<n.length;++o)if(r[o]!==n[o])return!1}return!0}function W4(i){return qh(i)?i.slice():i}class j4{constructor(e){B(this,"name"),B(this,"uniforms",{}),B(this,"modifiedUniforms",{}),B(this,"modified",!0),B(this,"bindingLayout",{}),B(this,"needsRedraw","initialized");var t;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&e!=null&&e.shaderLayout){const n=(t=e==null?void 0:e.shaderLayout.bindings)==null?void 0:t.find(o=>o.type==="uniform"&&o.name===(e==null?void 0:e.name));if(!n)throw new Error(e==null?void 0:e.name);const r=n;for(const o of r.uniforms||[])this.bindingLayout[o.name]=o}}setUniforms(e){for(const[t,n]of Object.entries(e))this._setUniform(t,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){G4(this.uniforms[e],t)||(this.uniforms[e]=W4(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}let Bt=class{constructor(e){B(this,"uniformBlocks",new Map),B(this,"uniformBufferLayouts",new Map),B(this,"uniformBuffers",new Map);for(const[t,n]of Object.entries(e)){const r=t,o=new H4(n.uniformTypes??{},n.uniformSizes??{});this.uniformBufferLayouts.set(r,o);const s=new j4({name:t});s.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(r,s)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var t;for(const[n,r]of Object.entries(e))(t=this.uniformBlocks.get(n))==null||t.setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){var t;return((t=this.uniformBufferLayouts.get(e))==null?void 0:t.byteLength)||0}getUniformBufferData(e){var t,n;const r=((t=this.uniformBlocks.get(e))==null?void 0:t.getAllUniforms())||{};return(n=this.uniformBufferLayouts.get(e))==null?void 0:n.getData(r)}createUniformBuffer(e,t,n){n&&this.setUniforms(n);const r=this.getUniformBufferByteLength(t),o=e.createBuffer({usage:se.UNIFORM|se.COPY_DST,byteLength:r}),s=this.getUniformBufferData(t);return o.write(s),o}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const n=this.getUniformBufferByteLength(t),r=e.createBuffer({usage:se.UNIFORM|se.COPY_DST,byteLength:n});this.uniformBuffers.set(t,r)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(t);e||(e=n)}return e&&Z.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var t;const n=this.uniformBlocks.get(e);let r=this.uniformBuffers.get(e),o=!1;if(r&&n!=null&&n.needsRedraw){o||(o=n.needsRedraw);const s=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),r==null||r.write(s);const a=(t=this.uniformBlocks.get(e))==null?void 0:t.getAllUniforms();Z.log(4,`Writing to uniform buffer ${String(e)}`,s,a)()}return o}};var ko;(function(i){i[i.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",i[i.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",i[i.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i[i.ZERO=0]="ZERO",i[i.ONE=1]="ONE",i[i.SRC_COLOR=768]="SRC_COLOR",i[i.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",i[i.SRC_ALPHA=770]="SRC_ALPHA",i[i.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",i[i.DST_ALPHA=772]="DST_ALPHA",i[i.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",i[i.DST_COLOR=774]="DST_COLOR",i[i.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",i[i.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",i[i.CONSTANT_COLOR=32769]="CONSTANT_COLOR",i[i.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",i[i.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",i[i.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",i[i.FUNC_ADD=32774]="FUNC_ADD",i[i.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",i[i.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",i[i.BLEND_EQUATION=32777]="BLEND_EQUATION",i[i.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",i[i.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",i[i.BLEND_DST_RGB=32968]="BLEND_DST_RGB",i[i.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",i[i.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",i[i.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",i[i.BLEND_COLOR=32773]="BLEND_COLOR",i[i.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",i[i.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",i[i.LINE_WIDTH=2849]="LINE_WIDTH",i[i.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",i[i.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",i[i.CULL_FACE_MODE=2885]="CULL_FACE_MODE",i[i.FRONT_FACE=2886]="FRONT_FACE",i[i.DEPTH_RANGE=2928]="DEPTH_RANGE",i[i.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",i[i.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",i[i.DEPTH_FUNC=2932]="DEPTH_FUNC",i[i.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",i[i.STENCIL_FUNC=2962]="STENCIL_FUNC",i[i.STENCIL_FAIL=2964]="STENCIL_FAIL",i[i.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",i[i.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",i[i.STENCIL_REF=2967]="STENCIL_REF",i[i.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",i[i.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",i[i.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",i[i.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",i[i.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",i[i.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",i[i.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",i[i.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",i[i.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",i[i.VIEWPORT=2978]="VIEWPORT",i[i.SCISSOR_BOX=3088]="SCISSOR_BOX",i[i.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",i[i.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",i[i.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",i[i.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",i[i.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",i[i.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",i[i.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",i[i.RED_BITS=3410]="RED_BITS",i[i.GREEN_BITS=3411]="GREEN_BITS",i[i.BLUE_BITS=3412]="BLUE_BITS",i[i.ALPHA_BITS=3413]="ALPHA_BITS",i[i.DEPTH_BITS=3414]="DEPTH_BITS",i[i.STENCIL_BITS=3415]="STENCIL_BITS",i[i.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",i[i.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",i[i.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",i[i.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",i[i.SAMPLES=32937]="SAMPLES",i[i.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",i[i.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",i[i.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",i[i.VENDOR=7936]="VENDOR",i[i.RENDERER=7937]="RENDERER",i[i.VERSION=7938]="VERSION",i[i.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",i[i.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",i[i.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",i[i.STATIC_DRAW=35044]="STATIC_DRAW",i[i.STREAM_DRAW=35040]="STREAM_DRAW",i[i.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.BUFFER_SIZE=34660]="BUFFER_SIZE",i[i.BUFFER_USAGE=34661]="BUFFER_USAGE",i[i.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",i[i.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",i[i.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",i[i.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",i[i.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",i[i.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",i[i.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",i[i.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",i[i.CULL_FACE=2884]="CULL_FACE",i[i.FRONT=1028]="FRONT",i[i.BACK=1029]="BACK",i[i.FRONT_AND_BACK=1032]="FRONT_AND_BACK",i[i.BLEND=3042]="BLEND",i[i.DEPTH_TEST=2929]="DEPTH_TEST",i[i.DITHER=3024]="DITHER",i[i.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",i[i.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",i[i.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",i[i.SCISSOR_TEST=3089]="SCISSOR_TEST",i[i.STENCIL_TEST=2960]="STENCIL_TEST",i[i.NO_ERROR=0]="NO_ERROR",i[i.INVALID_ENUM=1280]="INVALID_ENUM",i[i.INVALID_VALUE=1281]="INVALID_VALUE",i[i.INVALID_OPERATION=1282]="INVALID_OPERATION",i[i.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",i[i.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",i[i.CW=2304]="CW",i[i.CCW=2305]="CCW",i[i.DONT_CARE=4352]="DONT_CARE",i[i.FASTEST=4353]="FASTEST",i[i.NICEST=4354]="NICEST",i[i.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",i[i.BYTE=5120]="BYTE",i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.SHORT=5122]="SHORT",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.INT=5124]="INT",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.FLOAT=5126]="FLOAT",i[i.DOUBLE=5130]="DOUBLE",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.ALPHA=6406]="ALPHA",i[i.RGB=6407]="RGB",i[i.RGBA=6408]="RGBA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",i[i.VERTEX_SHADER=35633]="VERTEX_SHADER",i[i.COMPILE_STATUS=35713]="COMPILE_STATUS",i[i.DELETE_STATUS=35712]="DELETE_STATUS",i[i.LINK_STATUS=35714]="LINK_STATUS",i[i.VALIDATE_STATUS=35715]="VALIDATE_STATUS",i[i.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",i[i.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",i[i.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",i[i.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",i[i.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",i[i.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",i[i.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",i[i.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",i[i.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",i[i.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",i[i.SHADER_TYPE=35663]="SHADER_TYPE",i[i.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",i[i.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",i[i.NEVER=512]="NEVER",i[i.LESS=513]="LESS",i[i.EQUAL=514]="EQUAL",i[i.LEQUAL=515]="LEQUAL",i[i.GREATER=516]="GREATER",i[i.NOTEQUAL=517]="NOTEQUAL",i[i.GEQUAL=518]="GEQUAL",i[i.ALWAYS=519]="ALWAYS",i[i.KEEP=7680]="KEEP",i[i.REPLACE=7681]="REPLACE",i[i.INCR=7682]="INCR",i[i.DECR=7683]="DECR",i[i.INVERT=5386]="INVERT",i[i.INCR_WRAP=34055]="INCR_WRAP",i[i.DECR_WRAP=34056]="DECR_WRAP",i[i.NEAREST=9728]="NEAREST",i[i.LINEAR=9729]="LINEAR",i[i.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",i[i.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",i[i.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",i[i.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",i[i.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",i[i.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",i[i.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",i[i.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE=5890]="TEXTURE",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i[i.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",i[i.TEXTURE0=33984]="TEXTURE0",i[i.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",i[i.REPEAT=10497]="REPEAT",i[i.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i[i.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",i[i.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",i[i.FLOAT_VEC2=35664]="FLOAT_VEC2",i[i.FLOAT_VEC3=35665]="FLOAT_VEC3",i[i.FLOAT_VEC4=35666]="FLOAT_VEC4",i[i.INT_VEC2=35667]="INT_VEC2",i[i.INT_VEC3=35668]="INT_VEC3",i[i.INT_VEC4=35669]="INT_VEC4",i[i.BOOL=35670]="BOOL",i[i.BOOL_VEC2=35671]="BOOL_VEC2",i[i.BOOL_VEC3=35672]="BOOL_VEC3",i[i.BOOL_VEC4=35673]="BOOL_VEC4",i[i.FLOAT_MAT2=35674]="FLOAT_MAT2",i[i.FLOAT_MAT3=35675]="FLOAT_MAT3",i[i.FLOAT_MAT4=35676]="FLOAT_MAT4",i[i.SAMPLER_2D=35678]="SAMPLER_2D",i[i.SAMPLER_CUBE=35680]="SAMPLER_CUBE",i[i.LOW_FLOAT=36336]="LOW_FLOAT",i[i.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",i[i.HIGH_FLOAT=36338]="HIGH_FLOAT",i[i.LOW_INT=36339]="LOW_INT",i[i.MEDIUM_INT=36340]="MEDIUM_INT",i[i.HIGH_INT=36341]="HIGH_INT",i[i.FRAMEBUFFER=36160]="FRAMEBUFFER",i[i.RENDERBUFFER=36161]="RENDERBUFFER",i[i.RGBA4=32854]="RGBA4",i[i.RGB5_A1=32855]="RGB5_A1",i[i.RGB565=36194]="RGB565",i[i.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",i[i.STENCIL_INDEX=6401]="STENCIL_INDEX",i[i.STENCIL_INDEX8=36168]="STENCIL_INDEX8",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i[i.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",i[i.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",i[i.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",i[i.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",i[i.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",i[i.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",i[i.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",i[i.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",i[i.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",i[i.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",i[i.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",i[i.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",i[i.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",i[i.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",i[i.NONE=0]="NONE",i[i.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",i[i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",i[i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",i[i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",i[i.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",i[i.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",i[i.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",i[i.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",i[i.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",i[i.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",i[i.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",i[i.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",i[i.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",i[i.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",i[i.READ_BUFFER=3074]="READ_BUFFER",i[i.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",i[i.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",i[i.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",i[i.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",i[i.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",i[i.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",i[i.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",i[i.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",i[i.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",i[i.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",i[i.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",i[i.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",i[i.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",i[i.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",i[i.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",i[i.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",i[i.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",i[i.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",i[i.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",i[i.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",i[i.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",i[i.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",i[i.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",i[i.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",i[i.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",i[i.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",i[i.RED=6403]="RED",i[i.RGB8=32849]="RGB8",i[i.RGBA8=32856]="RGBA8",i[i.RGB10_A2=32857]="RGB10_A2",i[i.TEXTURE_3D=32879]="TEXTURE_3D",i[i.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",i[i.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",i[i.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",i[i.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",i[i.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",i[i.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",i[i.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",i[i.SRGB=35904]="SRGB",i[i.SRGB8=35905]="SRGB8",i[i.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",i[i.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",i[i.RGBA32F=34836]="RGBA32F",i[i.RGB32F=34837]="RGB32F",i[i.RGBA16F=34842]="RGBA16F",i[i.RGB16F=34843]="RGB16F",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",i[i.R11F_G11F_B10F=35898]="R11F_G11F_B10F",i[i.RGB9_E5=35901]="RGB9_E5",i[i.RGBA32UI=36208]="RGBA32UI",i[i.RGB32UI=36209]="RGB32UI",i[i.RGBA16UI=36214]="RGBA16UI",i[i.RGB16UI=36215]="RGB16UI",i[i.RGBA8UI=36220]="RGBA8UI",i[i.RGB8UI=36221]="RGB8UI",i[i.RGBA32I=36226]="RGBA32I",i[i.RGB32I=36227]="RGB32I",i[i.RGBA16I=36232]="RGBA16I",i[i.RGB16I=36233]="RGB16I",i[i.RGBA8I=36238]="RGBA8I",i[i.RGB8I=36239]="RGB8I",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.R8=33321]="R8",i[i.RG8=33323]="RG8",i[i.R16F=33325]="R16F",i[i.R32F=33326]="R32F",i[i.RG16F=33327]="RG16F",i[i.RG32F=33328]="RG32F",i[i.R8I=33329]="R8I",i[i.R8UI=33330]="R8UI",i[i.R16I=33331]="R16I",i[i.R16UI=33332]="R16UI",i[i.R32I=33333]="R32I",i[i.R32UI=33334]="R32UI",i[i.RG8I=33335]="RG8I",i[i.RG8UI=33336]="RG8UI",i[i.RG16I=33337]="RG16I",i[i.RG16UI=33338]="RG16UI",i[i.RG32I=33339]="RG32I",i[i.RG32UI=33340]="RG32UI",i[i.R8_SNORM=36756]="R8_SNORM",i[i.RG8_SNORM=36757]="RG8_SNORM",i[i.RGB8_SNORM=36758]="RGB8_SNORM",i[i.RGBA8_SNORM=36759]="RGBA8_SNORM",i[i.RGB10_A2UI=36975]="RGB10_A2UI",i[i.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",i[i.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.HALF_FLOAT=5131]="HALF_FLOAT",i[i.RG=33319]="RG",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",i[i.CURRENT_QUERY=34917]="CURRENT_QUERY",i[i.QUERY_RESULT=34918]="QUERY_RESULT",i[i.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",i[i.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",i[i.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",i[i.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",i[i.DRAW_BUFFER0=34853]="DRAW_BUFFER0",i[i.DRAW_BUFFER1=34854]="DRAW_BUFFER1",i[i.DRAW_BUFFER2=34855]="DRAW_BUFFER2",i[i.DRAW_BUFFER3=34856]="DRAW_BUFFER3",i[i.DRAW_BUFFER4=34857]="DRAW_BUFFER4",i[i.DRAW_BUFFER5=34858]="DRAW_BUFFER5",i[i.DRAW_BUFFER6=34859]="DRAW_BUFFER6",i[i.DRAW_BUFFER7=34860]="DRAW_BUFFER7",i[i.DRAW_BUFFER8=34861]="DRAW_BUFFER8",i[i.DRAW_BUFFER9=34862]="DRAW_BUFFER9",i[i.DRAW_BUFFER10=34863]="DRAW_BUFFER10",i[i.DRAW_BUFFER11=34864]="DRAW_BUFFER11",i[i.DRAW_BUFFER12=34865]="DRAW_BUFFER12",i[i.DRAW_BUFFER13=34866]="DRAW_BUFFER13",i[i.DRAW_BUFFER14=34867]="DRAW_BUFFER14",i[i.DRAW_BUFFER15=34868]="DRAW_BUFFER15",i[i.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",i[i.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",i[i.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",i[i.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",i[i.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",i[i.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",i[i.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",i[i.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",i[i.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",i[i.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",i[i.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",i[i.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",i[i.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",i[i.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",i[i.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",i[i.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",i[i.SAMPLER_3D=35679]="SAMPLER_3D",i[i.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",i[i.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",i[i.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",i[i.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",i[i.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",i[i.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",i[i.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",i[i.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",i[i.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",i[i.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",i[i.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",i[i.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",i[i.MAX_SAMPLES=36183]="MAX_SAMPLES",i[i.SAMPLER_BINDING=35097]="SAMPLER_BINDING",i[i.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",i[i.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",i[i.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",i[i.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",i[i.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",i[i.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",i[i.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",i[i.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",i[i.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",i[i.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",i[i.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",i[i.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",i[i.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",i[i.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",i[i.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",i[i.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",i[i.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",i[i.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",i[i.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",i[i.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",i[i.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",i[i.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",i[i.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",i[i.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",i[i.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",i[i.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",i[i.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",i[i.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",i[i.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",i[i.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",i[i.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",i[i.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",i[i.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",i[i.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",i[i.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",i[i.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",i[i.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",i[i.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",i[i.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",i[i.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",i[i.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",i[i.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",i[i.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",i[i.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",i[i.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",i[i.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i[i.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",i[i.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",i[i.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",i[i.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",i[i.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",i[i.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",i[i.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",i[i.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",i[i.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",i[i.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",i[i.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",i[i.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",i[i.UNIFORM_TYPE=35383]="UNIFORM_TYPE",i[i.UNIFORM_SIZE=35384]="UNIFORM_SIZE",i[i.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",i[i.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",i[i.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",i[i.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",i[i.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",i[i.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",i[i.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",i[i.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",i[i.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",i[i.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",i[i.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",i[i.OBJECT_TYPE=37138]="OBJECT_TYPE",i[i.SYNC_CONDITION=37139]="SYNC_CONDITION",i[i.SYNC_STATUS=37140]="SYNC_STATUS",i[i.SYNC_FLAGS=37141]="SYNC_FLAGS",i[i.SYNC_FENCE=37142]="SYNC_FENCE",i[i.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",i[i.UNSIGNALED=37144]="UNSIGNALED",i[i.SIGNALED=37145]="SIGNALED",i[i.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",i[i.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",i[i.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",i[i.WAIT_FAILED=37149]="WAIT_FAILED",i[i.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",i[i.COLOR=6144]="COLOR",i[i.DEPTH=6145]="DEPTH",i[i.STENCIL=6146]="STENCIL",i[i.MIN=32775]="MIN",i[i.MAX=32776]="MAX",i[i.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",i[i.STREAM_READ=35041]="STREAM_READ",i[i.STREAM_COPY=35042]="STREAM_COPY",i[i.STATIC_READ=35045]="STATIC_READ",i[i.STATIC_COPY=35046]="STATIC_COPY",i[i.DYNAMIC_READ=35049]="DYNAMIC_READ",i[i.DYNAMIC_COPY=35050]="DYNAMIC_COPY",i[i.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",i[i.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",i[i.INVALID_INDEX=4294967295]="INVALID_INDEX",i[i.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",i[i.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",i[i.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",i[i.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",i[i.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",i[i.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",i[i.R16_EXT=33322]="R16_EXT",i[i.RG16_EXT=33324]="RG16_EXT",i[i.RGB16_EXT=32852]="RGB16_EXT",i[i.RGBA16_EXT=32859]="RGBA16_EXT",i[i.R16_SNORM_EXT=36760]="R16_SNORM_EXT",i[i.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",i[i.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",i[i.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",i[i.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",i[i.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",i[i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",i[i.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",i[i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",i[i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",i[i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i[i.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",i[i.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",i[i.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",i[i.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",i[i.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",i[i.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",i[i.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",i[i.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",i[i.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",i[i.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",i[i.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",i[i.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",i[i.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",i[i.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",i[i.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",i[i.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",i[i.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",i[i.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",i[i.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",i[i.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",i[i.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",i[i.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",i[i.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",i[i.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",i[i.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",i[i.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",i[i.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",i[i.LINE_WEBGL=6913]="LINE_WEBGL",i[i.FILL_WEBGL=6914]="FILL_WEBGL",i[i.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",i[i.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",i[i.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",i[i.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",i[i.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",i[i.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",i[i.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",i[i.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",i[i.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",i[i.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",i[i.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",i[i.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",i[i.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",i[i.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",i[i.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",i[i.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",i[i.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",i[i.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",i[i.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",i[i.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",i[i.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",i[i.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",i[i.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",i[i.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(ko||(ko={}));const Y4={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},q4=i=>({drawBuffersWEBGL(e){return i.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),X4=i=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return i.createVertexArray()},deleteVertexArrayOES(e){return i.deleteVertexArray(e)},isVertexArrayOES(e){return i.isVertexArray(e)},bindVertexArrayOES(e){return i.bindVertexArray(e)}}),K4=i=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return i.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return i.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return i.vertexAttribDivisor(...e)}});function Z4(i=!0){const e=HTMLCanvasElement.prototype;if(!i&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,n){if(t==="webgl"||t==="experimental-webgl"){const r=this.originalGetContext("webgl2",n);return r instanceof HTMLElement&&Q4(r),r}return this.originalGetContext(t,n)}}function Q4(i){i.getExtension("EXT_color_buffer_float");const e={...Y4,WEBGL_disjoint_timer_query:i.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:q4(i),OES_vertex_array_object:X4(i),ANGLE_instanced_arrays:K4(i)},t=i.getExtension;i.getExtension=function(r){return t.call(i,r)||(r in e?e[r]:null)};const n=i.getSupportedExtensions;i.getSupportedExtensions=function(){const r=n.apply(i)||[];return r==null?void 0:r.concat(Object.keys(e))}}async function rw(i,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",i),new Promise((r,o)=>{n.onload=r,n.onerror=s=>o(new Error(`Unable to load script '${i}': ${s}`)),t.appendChild(n)})}const J4=1;let $t=null,Yb=!1;const e_={debugSpectorJS:Z.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function eR(i){if(!globalThis.SPECTOR)try{await rw(i.debugSpectorJSUrl||e_.debugSpectorJSUrl)}catch(e){Z.warn(String(e))}}function PX(i){var e;if(i={...e_,...i},!i.debugSpectorJS)return null;if(!$t&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){Z.probe(J4,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:t}=globalThis.SPECTOR;$t=new t,globalThis.luma&&(globalThis.luma.spector=$t)}if(!$t)return null;if(Yb||(Yb=!0,$t.spyCanvases(),$t==null||$t.onCaptureStarted.add(t=>Z.info("Spector capture started:",t)()),$t==null||$t.onCapture.add(t=>{Z.info("Spector capture complete:",t)(),$t==null||$t.getResultUI(),$t==null||$t.resultView.display(),$t==null||$t.resultView.addCapture(t)})),i.gl){const t=i.gl,n=t.device;$t==null||$t.startCapture(i.gl,500),t.device=n,new Promise(r=>setTimeout(r,2e3)).then(r=>{Z.info("Spector capture stopped after 2 seconds")(),$t==null||$t.stopCapture()})}return $t}const tR="https://unpkg.com/webgl-debug@2.0.1/index.js";function ow(i){return i.luma=i.luma||{},i.luma}async function iR(){qc()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await rw(tR))}function DX(i,e={}){return e.debugWebGL||e.traceWebGL?rR(i,e):nR(i)}function nR(i){const e=ow(i);return e.realContext?e.realContext:i}function rR(i,e){if(!globalThis.WebGLDebugUtils)return Z.warn("webgl-debug not loaded")(),i;const t=ow(i);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...ko,...i});const n=globalThis.WebGLDebugUtils.makeDebugContext(i,oR.bind(null,e),sR.bind(null,e));for(const s in ko)!(s in n)&&typeof ko[s]=="number"&&(n[s]=ko[s]);class r{}Object.setPrototypeOf(n,Object.getPrototypeOf(i)),Object.setPrototypeOf(r,n);const o=Object.create(r);return t.realContext=i,t.debugContext=o,o.debug=!0,o}function qb(i,e){e=Array.from(e).map(n=>n===void 0?"undefined":n);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(i,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${i}(${t})`}function oR(i,e,t,n){n=Array.from(n).map(a=>a===void 0?"undefined":a);const r=globalThis.WebGLDebugUtils.glEnumToString(e),o=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,n),s=`${r} in gl.${t}(${o})`;Z.error(s)();debugger}function sR(i,e,t){let n="";Z.level>=1&&(n=qb(e,t),i.traceWebGL&&Z.log(1,n)());for(const r of t)if(r===void 0){n=n||qb(e,t);debugger}}const Cu=1;class aR extends _4{constructor(){super(),B(this,"type","webgl"),hm.defaultProps={...hm.defaultProps,...e_}}enforceWebGL2(e){Z4(e)}isSupported(){return typeof WebGL2RenderingContext<"u"}isDeviceHandle(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:(typeof WebGLRenderingContext<"u"&&e instanceof WebGLRenderingContext&&Z.warn("WebGL1 is not supported",e)(),!1)}async attach(e,t={}){const{WebGLDevice:n}=await vb(async()=>{const{WebGLDevice:o}=await import("./webgl-device-QoBMYpnS-Cy03oCOv.js");return{WebGLDevice:o}},[]);if(e instanceof n)return e;if((e==null?void 0:e.device)instanceof n)return e.device;if(!lR(e))throw new Error("Invalid WebGL2RenderingContext");const r=t.createCanvasContext===!0?{}:t.createCanvasContext;return new n({...t,_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1,...r}})}async create(e={}){const{WebGLDevice:t}=await vb(async()=>{const{WebGLDevice:n}=await import("./webgl-device-QoBMYpnS-Cy03oCOv.js");return{WebGLDevice:n}},[]);Z.groupCollapsed(Cu,"WebGLDevice created")();try{const n=[];(e.debugWebGL||e.debug)&&n.push(iR()),e.debugSpectorJS&&n.push(eR(e));const r=await Promise.allSettled(n);for(const a of r)a.status==="rejected"&&Z.error(`Failed to initialize debug libraries ${a.reason}`)();const o=new t(e),s=`${o._reused?"Reusing":"Created"} device with WebGL2 ${o.props.debug?"debug ":""}context: ${o.info.vendor}, ${o.info.renderer} for canvas: ${o.canvasContext.id}`;return Z.probe(Cu,s)(),Z.table(Cu,o.info)(),o}finally{Z.groupEnd(Cu)()}}}function lR(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&Number.isFinite(i._version))}const cR=new aR,uR="#b3b3b3",hR=void 0,pm=void 0,dR=1,fR=4,pR="#666666",mR=.1,gR=1,_R=1,sw="#222222",re={enableSimulation:!0,spaceSize:8192,pointSizeScale:1,linkWidthScale:1,linkArrowsSizeScale:1,renderLinks:!0,curvedLinks:!1,curvedLinkSegments:19,curvedLinkWeight:.8,curvedLinkControlPointDistance:.5,linkArrows:!1,linkVisibilityDistanceRange:[50,150],linkVisibilityMinTransparency:.25,hoveredPointCursor:"auto",hoveredLinkCursor:"auto",renderHoveredPointRing:!1,hoveredPointRingColor:"white",hoveredLinkColor:void 0,hoveredLinkWidthIncrease:5,focusedPointRingColor:"white",focusedPointIndex:void 0,simulation:{decay:5e3,gravity:.25,center:0,repulsion:1,repulsionTheta:1.15,linkSpring:1,linkDistance:10,linkDistRandomVariationRange:[1,1.2],repulsionFromMouse:2,friction:.85,cluster:.1},showFPSMonitor:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||2,scalePointsOnZoom:!1,scaleLinksOnZoom:!1,enableZoom:!0,enableSimulationDuringZoom:!1,enableDrag:!1,fitViewOnInit:!0,fitViewDelay:250,fitViewPadding:.1,fitViewDuration:250,pointSamplingDistance:150,attribution:"",rescalePositions:void 0,enableRightClickRepulsion:!1},yR=.7,bR=.95,vR=3;/*! @license DOMPurify 3.2.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.6/LICENSE */const{entries:aw,setPrototypeOf:Xb,isFrozen:xR,getPrototypeOf:wR,getOwnPropertyDescriptor:SR}=Object;let{freeze:Ii,seal:Cn,create:lw}=Object,{apply:mm,construct:gm}=typeof Reflect<"u"&&Reflect;Ii||(Ii=function(i){return i});Cn||(Cn=function(i){return i});mm||(mm=function(i,e,t){return i.apply(e,t)});gm||(gm=function(i,e){return new i(...e)});const Tu=ki(Array.prototype.forEach),ER=ki(Array.prototype.lastIndexOf),Kb=ki(Array.prototype.pop),pl=ki(Array.prototype.push),CR=ki(Array.prototype.splice),ch=ki(String.prototype.toLowerCase),Zf=ki(String.prototype.toString),Zb=ki(String.prototype.match),ml=ki(String.prototype.replace),TR=ki(String.prototype.indexOf),AR=ki(String.prototype.trim),On=ki(Object.prototype.hasOwnProperty),wi=ki(RegExp.prototype.test),gl=IR(TypeError);function ki(i){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return mm(i,e,n)}}function IR(i){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return gm(i,t)}}function Fe(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ch;Xb&&Xb(i,null);let n=e.length;for(;n--;){let r=e[n];if(typeof r=="string"){const o=t(r);o!==r&&(xR(e)||(e[n]=o),r=o)}i[r]=!0}return i}function kR(i){for(let e=0;e<i.length;e++)On(i,e)||(i[e]=null);return i}function $r(i){const e=lw(null);for(const[t,n]of aw(i))On(i,t)&&(Array.isArray(n)?e[t]=kR(n):n&&typeof n=="object"&&n.constructor===Object?e[t]=$r(n):e[t]=n);return e}function _l(i,e){for(;i!==null;){const n=SR(i,e);if(n){if(n.get)return ki(n.get);if(typeof n.value=="function")return ki(n.value)}i=wR(i)}function t(){return null}return t}const Qb=Ii(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Qf=Ii(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Jf=Ii(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),LR=Ii(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),ep=Ii(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),RR=Ii(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Jb=Ii(["#text"]),ev=Ii(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),tp=Ii(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),tv=Ii(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Au=Ii(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),PR=Cn(/\{\{[\w\W]*|[\w\W]*\}\}/gm),DR=Cn(/<%[\w\W]*|[\w\W]*%>/gm),MR=Cn(/\$\{[\w\W]*/gm),NR=Cn(/^data-[\-\w.\u00B7-\uFFFF]+$/),BR=Cn(/^aria-[\-\w]+$/),cw=Cn(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),OR=Cn(/^(?:\w+script|data):/i),FR=Cn(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),uw=Cn(/^html$/i),zR=Cn(/^[a-z][.\w]*(-[.\w]+)+$/i);var iv=Object.freeze({__proto__:null,ARIA_ATTR:BR,ATTR_WHITESPACE:FR,CUSTOM_ELEMENT:zR,DATA_ATTR:NR,DOCTYPE_NAME:uw,ERB_EXPR:DR,IS_ALLOWED_URI:cw,IS_SCRIPT_OR_DATA:OR,MUSTACHE_EXPR:PR,TMPLIT_EXPR:MR});const yl={element:1,text:3,progressingInstruction:7,comment:8,document:9},UR=function(){return typeof window>"u"?null:window},$R=function(i,e){if(typeof i!="object"||typeof i.createPolicy!="function")return null;let t=null;const n="data-tt-policy-suffix";e&&e.hasAttribute(n)&&(t=e.getAttribute(n));const r="dompurify"+(t?"#"+t:"");try{return i.createPolicy(r,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+r+" could not be created."),null}},nv=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function hw(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:UR();const e=A=>hw(A);if(e.version="3.2.6",e.removed=[],!i||!i.document||i.document.nodeType!==yl.document||!i.Element)return e.isSupported=!1,e;let{document:t}=i;const n=t,r=n.currentScript,{DocumentFragment:o,HTMLTemplateElement:s,Node:a,Element:l,NodeFilter:c,NamedNodeMap:u=i.NamedNodeMap||i.MozNamedAttrMap,HTMLFormElement:h,DOMParser:d,trustedTypes:f}=i,p=l.prototype,b=_l(p,"cloneNode"),g=_l(p,"remove"),_=_l(p,"nextSibling"),T=_l(p,"childNodes"),E=_l(p,"parentNode");if(typeof s=="function"){const A=t.createElement("template");A.content&&A.content.ownerDocument&&(t=A.content.ownerDocument)}let y,C="";const{implementation:I,createNodeIterator:F,createDocumentFragment:V,getElementsByTagName:q}=t,{importNode:Q}=n;let M=nv();e.isSupported=typeof aw=="function"&&typeof E=="function"&&I&&I.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:ae,ERB_EXPR:ee,TMPLIT_EXPR:R,DATA_ATTR:X,ARIA_ATTR:O,IS_SCRIPT_OR_DATA:W,ATTR_WHITESPACE:ne,CUSTOM_ELEMENT:Y}=iv;let{IS_ALLOWED_URI:ie}=iv,j=null;const fe=Fe({},[...Qb,...Qf,...Jf,...ep,...Jb]);let de=null;const Ze=Fe({},[...ev,...tp,...tv,...Au]);let oe=Object.seal(lw(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ft=null,$e=null,gt=!0,te=!0,Se=!1,Me=!0,G=!1,Ge=!0,Pe=!1,_t=!1,It=!1,he=!1,We=!1,xi=!1,li=!0,nl=!1;const du="user-content-";let rl=!0,Dr=!1,un={},Xi=null;const Ki=Fe({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Ts=null;const ol=Fe({},["audio","video","img","source","image","track"]);let As=null;const Is=Fe({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Yo="http://www.w3.org/1998/Math/MathML",Mr="http://www.w3.org/2000/svg",Ni="http://www.w3.org/1999/xhtml";let ci=Ni,Jn=!1,qo=null;const sl=Fe({},[Yo,Mr,Ni],Zf);let ks=Fe({},["mi","mo","mn","ms","mtext"]),Nr=Fe({},["annotation-xml"]);const Ls=Fe({},["title","style","font","a","script"]);let Xo=null;const Ko=["application/xhtml+xml","text/html"],$f="text/html";let Ut=null,vt=null;const yo=t.createElement("form"),fu=function(A){return A instanceof RegExp||A instanceof Function},Rs=function(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(vt&&vt===A)){if((!A||typeof A!="object")&&(A={}),A=$r(A),Xo=Ko.indexOf(A.PARSER_MEDIA_TYPE)===-1?$f:A.PARSER_MEDIA_TYPE,Ut=Xo==="application/xhtml+xml"?Zf:ch,j=On(A,"ALLOWED_TAGS")?Fe({},A.ALLOWED_TAGS,Ut):fe,de=On(A,"ALLOWED_ATTR")?Fe({},A.ALLOWED_ATTR,Ut):Ze,qo=On(A,"ALLOWED_NAMESPACES")?Fe({},A.ALLOWED_NAMESPACES,Zf):sl,As=On(A,"ADD_URI_SAFE_ATTR")?Fe($r(Is),A.ADD_URI_SAFE_ATTR,Ut):Is,Ts=On(A,"ADD_DATA_URI_TAGS")?Fe($r(ol),A.ADD_DATA_URI_TAGS,Ut):ol,Xi=On(A,"FORBID_CONTENTS")?Fe({},A.FORBID_CONTENTS,Ut):Ki,ft=On(A,"FORBID_TAGS")?Fe({},A.FORBID_TAGS,Ut):$r({}),$e=On(A,"FORBID_ATTR")?Fe({},A.FORBID_ATTR,Ut):$r({}),un=On(A,"USE_PROFILES")?A.USE_PROFILES:!1,gt=A.ALLOW_ARIA_ATTR!==!1,te=A.ALLOW_DATA_ATTR!==!1,Se=A.ALLOW_UNKNOWN_PROTOCOLS||!1,Me=A.ALLOW_SELF_CLOSE_IN_ATTR!==!1,G=A.SAFE_FOR_TEMPLATES||!1,Ge=A.SAFE_FOR_XML!==!1,Pe=A.WHOLE_DOCUMENT||!1,he=A.RETURN_DOM||!1,We=A.RETURN_DOM_FRAGMENT||!1,xi=A.RETURN_TRUSTED_TYPE||!1,It=A.FORCE_BODY||!1,li=A.SANITIZE_DOM!==!1,nl=A.SANITIZE_NAMED_PROPS||!1,rl=A.KEEP_CONTENT!==!1,Dr=A.IN_PLACE||!1,ie=A.ALLOWED_URI_REGEXP||cw,ci=A.NAMESPACE||Ni,ks=A.MATHML_TEXT_INTEGRATION_POINTS||ks,Nr=A.HTML_INTEGRATION_POINTS||Nr,oe=A.CUSTOM_ELEMENT_HANDLING||{},A.CUSTOM_ELEMENT_HANDLING&&fu(A.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(oe.tagNameCheck=A.CUSTOM_ELEMENT_HANDLING.tagNameCheck),A.CUSTOM_ELEMENT_HANDLING&&fu(A.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(oe.attributeNameCheck=A.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),A.CUSTOM_ELEMENT_HANDLING&&typeof A.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(oe.allowCustomizedBuiltInElements=A.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),G&&(te=!1),We&&(he=!0),un&&(j=Fe({},Jb),de=[],un.html===!0&&(Fe(j,Qb),Fe(de,ev)),un.svg===!0&&(Fe(j,Qf),Fe(de,tp),Fe(de,Au)),un.svgFilters===!0&&(Fe(j,Jf),Fe(de,tp),Fe(de,Au)),un.mathMl===!0&&(Fe(j,ep),Fe(de,tv),Fe(de,Au))),A.ADD_TAGS&&(j===fe&&(j=$r(j)),Fe(j,A.ADD_TAGS,Ut)),A.ADD_ATTR&&(de===Ze&&(de=$r(de)),Fe(de,A.ADD_ATTR,Ut)),A.ADD_URI_SAFE_ATTR&&Fe(As,A.ADD_URI_SAFE_ATTR,Ut),A.FORBID_CONTENTS&&(Xi===Ki&&(Xi=$r(Xi)),Fe(Xi,A.FORBID_CONTENTS,Ut)),rl&&(j["#text"]=!0),Pe&&Fe(j,["html","head","body"]),j.table&&(Fe(j,["tbody"]),delete ft.tbody),A.TRUSTED_TYPES_POLICY){if(typeof A.TRUSTED_TYPES_POLICY.createHTML!="function")throw gl('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof A.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw gl('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');y=A.TRUSTED_TYPES_POLICY,C=y.createHTML("")}else y===void 0&&(y=$R(f,r)),y!==null&&typeof C=="string"&&(C=y.createHTML(""));Ii&&Ii(A),vt=A}},Ps=Fe({},[...Qf,...Jf,...LR]),al=Fe({},[...ep,...RR]),pu=function(A){let z=E(A);(!z||!z.tagName)&&(z={namespaceURI:ci,tagName:"template"});const x=ch(A.tagName),U=ch(z.tagName);return qo[A.namespaceURI]?A.namespaceURI===Mr?z.namespaceURI===Ni?x==="svg":z.namespaceURI===Yo?x==="svg"&&(U==="annotation-xml"||ks[U]):!!Ps[x]:A.namespaceURI===Yo?z.namespaceURI===Ni?x==="math":z.namespaceURI===Mr?x==="math"&&Nr[U]:!!al[x]:A.namespaceURI===Ni?z.namespaceURI===Mr&&!Nr[U]||z.namespaceURI===Yo&&!ks[U]?!1:!al[x]&&(Ls[x]||!Ps[x]):!!(Xo==="application/xhtml+xml"&&qo[A.namespaceURI]):!1},Br=function(A){pl(e.removed,{element:A});try{E(A).removeChild(A)}catch{g(A)}},ii=function(A,z){try{pl(e.removed,{attribute:z.getAttributeNode(A),from:z})}catch{pl(e.removed,{attribute:null,from:z})}if(z.removeAttribute(A),A==="is")if(he||We)try{Br(z)}catch{}else try{z.setAttribute(A,"")}catch{}},er=function(A){let z=null,x=null;if(It)A="<remove></remove>"+A;else{const Te=Zb(A,/^[\r\n\t ]+/);x=Te&&Te[0]}Xo==="application/xhtml+xml"&&ci===Ni&&(A='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+A+"</body></html>");const U=y?y.createHTML(A):A;if(ci===Ni)try{z=new d().parseFromString(U,Xo)}catch{}if(!z||!z.documentElement){z=I.createDocument(ci,"template",null);try{z.documentElement.innerHTML=Jn?C:U}catch{}}const K=z.body||z.documentElement;return A&&x&&K.insertBefore(t.createTextNode(x),K.childNodes[0]||null),ci===Ni?q.call(z,Pe?"html":"body")[0]:Pe?z.documentElement:K},ll=function(A){return F.call(A.ownerDocument||A,A,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT|c.SHOW_PROCESSING_INSTRUCTION|c.SHOW_CDATA_SECTION,null)},Ds=function(A){return A instanceof h&&(typeof A.nodeName!="string"||typeof A.textContent!="string"||typeof A.removeChild!="function"||!(A.attributes instanceof u)||typeof A.removeAttribute!="function"||typeof A.setAttribute!="function"||typeof A.namespaceURI!="string"||typeof A.insertBefore!="function"||typeof A.hasChildNodes!="function")},Ms=function(A){return typeof a=="function"&&A instanceof a};function hn(A,z,x){Tu(A,U=>{U.call(e,z,x,vt)})}const dn=function(A){let z=null;if(hn(M.beforeSanitizeElements,A,null),Ds(A))return Br(A),!0;const x=Ut(A.nodeName);if(hn(M.uponSanitizeElement,A,{tagName:x,allowedTags:j}),Ge&&A.hasChildNodes()&&!Ms(A.firstElementChild)&&wi(/<[/\w!]/g,A.innerHTML)&&wi(/<[/\w!]/g,A.textContent)||A.nodeType===yl.progressingInstruction||Ge&&A.nodeType===yl.comment&&wi(/<[/\w]/g,A.data))return Br(A),!0;if(!j[x]||ft[x]){if(!ft[x]&&ul(x)&&(oe.tagNameCheck instanceof RegExp&&wi(oe.tagNameCheck,x)||oe.tagNameCheck instanceof Function&&oe.tagNameCheck(x)))return!1;if(rl&&!Xi[x]){const U=E(A)||A.parentNode,K=T(A)||A.childNodes;if(K&&U){const Te=K.length;for(let xt=Te-1;xt>=0;--xt){const Qe=b(K[xt],!0);Qe.__removalCount=(A.__removalCount||0)+1,U.insertBefore(Qe,_(A))}}}return Br(A),!0}return A instanceof l&&!pu(A)||(x==="noscript"||x==="noembed"||x==="noframes")&&wi(/<\/no(script|embed|frames)/i,A.innerHTML)?(Br(A),!0):(G&&A.nodeType===yl.text&&(z=A.textContent,Tu([ae,ee,R],U=>{z=ml(z,U," ")}),A.textContent!==z&&(pl(e.removed,{element:A.cloneNode()}),A.textContent=z)),hn(M.afterSanitizeElements,A,null),!1)},cl=function(A,z,x){if(li&&(z==="id"||z==="name")&&(x in t||x in yo))return!1;if(!(te&&!$e[z]&&wi(X,z))&&!(gt&&wi(O,z))){if(!de[z]||$e[z]){if(!(ul(A)&&(oe.tagNameCheck instanceof RegExp&&wi(oe.tagNameCheck,A)||oe.tagNameCheck instanceof Function&&oe.tagNameCheck(A))&&(oe.attributeNameCheck instanceof RegExp&&wi(oe.attributeNameCheck,z)||oe.attributeNameCheck instanceof Function&&oe.attributeNameCheck(z))||z==="is"&&oe.allowCustomizedBuiltInElements&&(oe.tagNameCheck instanceof RegExp&&wi(oe.tagNameCheck,x)||oe.tagNameCheck instanceof Function&&oe.tagNameCheck(x))))return!1}else if(!As[z]&&!wi(ie,ml(x,ne,""))&&!((z==="src"||z==="xlink:href"||z==="href")&&A!=="script"&&TR(x,"data:")===0&&Ts[A])&&!(Se&&!wi(W,ml(x,ne,"")))&&x)return!1}return!0},ul=function(A){return A!=="annotation-xml"&&Zb(A,Y)},hl=function(A){hn(M.beforeSanitizeAttributes,A,null);const{attributes:z}=A;if(!z||Ds(A))return;const x={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:de,forceKeepAttr:void 0};let U=z.length;for(;U--;){const K=z[U],{name:Te,namespaceURI:xt,value:Qe}=K,St=Ut(Te),Zi=Qe;let kt=Te==="value"?Zi:AR(Zi);if(x.attrName=St,x.attrValue=kt,x.keepAttr=!0,x.forceKeepAttr=void 0,hn(M.uponSanitizeAttribute,A,x),kt=x.attrValue,nl&&(St==="id"||St==="name")&&(ii(Te,A),kt=du+kt),Ge&&wi(/((--!?|])>)|<\/(style|title)/i,kt)){ii(Te,A);continue}if(x.forceKeepAttr)continue;if(!x.keepAttr){ii(Te,A);continue}if(!Me&&wi(/\/>/i,kt)){ii(Te,A);continue}G&&Tu([ae,ee,R],Wt=>{kt=ml(kt,Wt," ")});const Ns=Ut(A.nodeName);if(!cl(Ns,St,kt)){ii(Te,A);continue}if(y&&typeof f=="object"&&typeof f.getAttributeType=="function"&&!xt)switch(f.getAttributeType(Ns,St)){case"TrustedHTML":{kt=y.createHTML(kt);break}case"TrustedScriptURL":{kt=y.createScriptURL(kt);break}}if(kt!==Zi)try{xt?A.setAttributeNS(xt,Te,kt):A.setAttribute(Te,kt),Ds(A)?Br(A):Kb(e.removed)}catch{ii(Te,A)}}hn(M.afterSanitizeAttributes,A,null)},mu=function A(z){let x=null;const U=ll(z);for(hn(M.beforeSanitizeShadowDOM,z,null);x=U.nextNode();)hn(M.uponSanitizeShadowNode,x,null),dn(x),hl(x),x.content instanceof o&&A(x.content);hn(M.afterSanitizeShadowDOM,z,null)};return e.sanitize=function(A){let z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},x=null,U=null,K=null,Te=null;if(Jn=!A,Jn&&(A="<!-->"),typeof A!="string"&&!Ms(A))if(typeof A.toString=="function"){if(A=A.toString(),typeof A!="string")throw gl("dirty is not a string, aborting")}else throw gl("toString is not a function");if(!e.isSupported)return A;if(_t||Rs(z),e.removed=[],typeof A=="string"&&(Dr=!1),Dr){if(A.nodeName){const St=Ut(A.nodeName);if(!j[St]||ft[St])throw gl("root node is forbidden and cannot be sanitized in-place")}}else if(A instanceof a)x=er("<!---->"),U=x.ownerDocument.importNode(A,!0),U.nodeType===yl.element&&U.nodeName==="BODY"||U.nodeName==="HTML"?x=U:x.appendChild(U);else{if(!he&&!G&&!Pe&&A.indexOf("<")===-1)return y&&xi?y.createHTML(A):A;if(x=er(A),!x)return he?null:xi?C:""}x&&It&&Br(x.firstChild);const xt=ll(Dr?A:x);for(;K=xt.nextNode();)dn(K),hl(K),K.content instanceof o&&mu(K.content);if(Dr)return A;if(he){if(We)for(Te=V.call(x.ownerDocument);x.firstChild;)Te.appendChild(x.firstChild);else Te=x;return(de.shadowroot||de.shadowrootmode)&&(Te=Q.call(n,Te,!0)),Te}let Qe=Pe?x.outerHTML:x.innerHTML;return Pe&&j["!doctype"]&&x.ownerDocument&&x.ownerDocument.doctype&&x.ownerDocument.doctype.name&&wi(uw,x.ownerDocument.doctype.name)&&(Qe="<!DOCTYPE "+x.ownerDocument.doctype.name+`>
`+Qe),G&&Tu([ae,ee,R],St=>{Qe=ml(Qe,St," ")}),y&&xi?y.createHTML(Qe):Qe},e.setConfig=function(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Rs(A),_t=!0},e.clearConfig=function(){vt=null,_t=!1},e.isValidAttribute=function(A,z,x){vt||Rs({});const U=Ut(A),K=Ut(z);return cl(U,K,x)},e.addHook=function(A,z){typeof z=="function"&&pl(M[A],z)},e.removeHook=function(A,z){if(z!==void 0){const x=ER(M[A],z);return x===-1?void 0:CR(M[A],x,1)[0]}return Kb(M[A])},e.removeHooks=function(A){M[A]=[]},e.removeAllHooks=function(){M=nv()},e}var VR=hw();const HR=i=>typeof i=="function",dw=i=>Array.isArray(i),GR=i=>i instanceof Object,WR=i=>i instanceof Object?i.constructor.name!=="Function"&&i.constructor.name!=="Object":!1,rv=i=>GR(i)&&!dw(i)&&!HR(i)&&!WR(i);function Lo(i){let e;if(dw(i))e=i;else{const t=No(i),n=t==null?void 0:t.rgb();e=[(n==null?void 0:n.r)||0,(n==null?void 0:n.g)||0,(n==null?void 0:n.b)||0,(t==null?void 0:t.opacity)??1]}return[e[0]/255,e[1]/255,e[2]/255,e[3]]}function jR(i,e,t){return .2126*i+.7152*e+.0722*t}function tn(i,e,t=0,n=0,r,o){return i.readPixelsToArrayWebGL(e,{sourceX:t,sourceY:n,sourceWidth:r,sourceHeight:o})}function YR(i,e,t){return Math.min(Math.max(i,e),t)}function fn(i){return i!=null&&!Number.isNaN(i)}function qR(i,e){return VR.sanitize(i,{ALLOWED_TAGS:["a","b","i","em","strong","span","div","p","br"],ALLOWED_ATTR:["href","target","class","id","style"],ALLOW_DATA_ATTR:!1,...e})}class XR{constructor(){this.enableSimulation=re.enableSimulation,this.backgroundColor=sw,this.spaceSize=re.spaceSize,this.pointColor=uR,this.pointDefaultColor=void 0,this.pointGreyoutOpacity=hR,this.pointGreyoutColor=pm,this.pointSize=fR,this.pointDefaultSize=void 0,this.pointOpacity=dR,this.pointSizeScale=re.pointSizeScale,this.hoveredPointCursor=re.hoveredPointCursor,this.hoveredLinkCursor=re.hoveredLinkCursor,this.renderHoveredPointRing=re.renderHoveredPointRing,this.hoveredPointRingColor=re.hoveredPointRingColor,this.focusedPointRingColor=re.focusedPointRingColor,this.focusedPointIndex=re.focusedPointIndex,this.linkColor=pR,this.linkDefaultColor=void 0,this.linkOpacity=gR,this.linkGreyoutOpacity=mR,this.linkWidth=_R,this.linkDefaultWidth=void 0,this.linkWidthScale=re.linkWidthScale,this.hoveredLinkColor=re.hoveredLinkColor,this.hoveredLinkWidthIncrease=re.hoveredLinkWidthIncrease,this.renderLinks=re.renderLinks,this.curvedLinks=re.curvedLinks,this.curvedLinkSegments=re.curvedLinkSegments,this.curvedLinkWeight=re.curvedLinkWeight,this.curvedLinkControlPointDistance=re.curvedLinkControlPointDistance,this.linkArrows=re.linkArrows,this.linkDefaultArrows=void 0,this.linkArrowsSizeScale=re.linkArrowsSizeScale,this.scaleLinksOnZoom=re.scaleLinksOnZoom,this.linkVisibilityDistanceRange=re.linkVisibilityDistanceRange,this.linkVisibilityMinTransparency=re.linkVisibilityMinTransparency,this.simulationDecay=re.simulation.decay,this.simulationGravity=re.simulation.gravity,this.simulationCenter=re.simulation.center,this.simulationRepulsion=re.simulation.repulsion,this.simulationRepulsionTheta=re.simulation.repulsionTheta,this.simulationLinkSpring=re.simulation.linkSpring,this.simulationLinkDistance=re.simulation.linkDistance,this.simulationLinkDistRandomVariationRange=re.simulation.linkDistRandomVariationRange,this.simulationRepulsionFromMouse=re.simulation.repulsionFromMouse,this.enableRightClickRepulsion=re.enableRightClickRepulsion,this.simulationFriction=re.simulation.friction,this.simulationCluster=re.simulation.cluster,this.onSimulationStart=void 0,this.onSimulationTick=void 0,this.onSimulationEnd=void 0,this.onSimulationPause=void 0,this.onSimulationRestart=void 0,this.onSimulationUnpause=void 0,this.onClick=void 0,this.onPointClick=void 0,this.onLinkClick=void 0,this.onBackgroundClick=void 0,this.onMouseMove=void 0,this.onPointMouseOver=void 0,this.onPointMouseOut=void 0,this.onLinkMouseOver=void 0,this.onLinkMouseOut=void 0,this.onZoomStart=void 0,this.onZoom=void 0,this.onZoomEnd=void 0,this.onDragStart=void 0,this.onDrag=void 0,this.onDragEnd=void 0,this.showFPSMonitor=re.showFPSMonitor,this.pixelRatio=re.pixelRatio,this.scalePointsOnZoom=re.scalePointsOnZoom,this.initialZoomLevel=void 0,this.enableZoom=re.enableZoom,this.enableSimulationDuringZoom=re.enableSimulationDuringZoom,this.enableDrag=re.enableDrag,this.fitViewOnInit=re.fitViewOnInit,this.fitViewDelay=re.fitViewDelay,this.fitViewPadding=re.fitViewPadding,this.fitViewDuration=re.fitViewDuration,this.fitViewByPointsInRect=void 0,this.fitViewByPointIndices=void 0,this.randomSeed=void 0,this.pointSamplingDistance=re.pointSamplingDistance,this.attribution=re.attribution,this.rescalePositions=re.rescalePositions}init(e){Object.keys(e).forEach(t=>{this.deepMergeConfig(this.getConfig(),e,t)})}deepMergeConfig(e,t,n){rv(e[n])&&rv(t[n])?Object.keys(t[n]).forEach(r=>{this.deepMergeConfig(e[n],t[n],r)}):e[n]=t[n]}getConfig(){return this}}function t_(i,e){if(!i)throw new Error(e||"shadertools: assertion failed.")}const ip={number:{type:"number",validate(i,e){return Number.isFinite(i)&&typeof e=="object"&&(e.max===void 0||i<=e.max)&&(e.min===void 0||i>=e.min)}},array:{type:"array",validate(i,e){return Array.isArray(i)||ArrayBuffer.isView(i)}}};function KR(i){const e={};for(const[t,n]of Object.entries(i))e[t]=ZR(n);return e}function ZR(i){let e=ov(i);if(e!=="object")return{value:i,...ip[e],type:e};if(typeof i=="object")return i?i.type!==void 0?{...i,...ip[i.type],type:i.type}:i.value===void 0?{type:"object",value:i}:(e=ov(i.value),{...i,...ip[e],type:e}):{type:"object",value:null};throw new Error("props")}function ov(i){return Array.isArray(i)||ArrayBuffer.isView(i)?"array":typeof i}const QR=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,JR=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,e5={vertex:QR,fragment:JR},sv=/void\s+main\s*\([^)]*\)\s*\{\n?/,av=/}\n?[^{}]*$/,np=[],uh="__LUMA_INJECT_DECLARATIONS__";function t5(i){const e={vertex:{},fragment:{}};for(const t in i){let n=i[t];const r=i5(t);typeof n=="string"&&(n={order:0,injection:n}),e[r][t]=n}return e}function i5(i){const e=i.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Xh(i,e,t,n=!1){const r=e==="vertex";for(const o in t){const s=t[o];s.sort((l,c)=>l.order-c.order),np.length=s.length;for(let l=0,c=s.length;l<c;++l)np[l]=s[l].injection;const a=`${np.join(`
`)}
`;switch(o){case"vs:#decl":r&&(i=i.replace(uh,a));break;case"vs:#main-start":r&&(i=i.replace(sv,l=>l+a));break;case"vs:#main-end":r&&(i=i.replace(av,l=>a+l));break;case"fs:#decl":r||(i=i.replace(uh,a));break;case"fs:#main-start":r||(i=i.replace(sv,l=>l+a));break;case"fs:#main-end":r||(i=i.replace(av,l=>a+l));break;default:i=i.replace(o,l=>l+a)}}return i=i.replace(uh,""),n&&(i=i.replace(/\}\s*$/,o=>o+e5[e])),i}function Kh(i){i.map(e=>n5(e))}function n5(i){if(i.instance)return;Kh(i.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:n={}}=i,r={normalizedInjections:t5(n),parsedDeprecations:r5(t)};e&&(r.propValidators=KR(e)),i.instance=r;let o={};e&&(o=Object.entries(e).reduce((s,[a,l])=>{const c=l==null?void 0:l.value;return c&&(s[a]=c),s},{})),i.defaultUniforms={...i.defaultUniforms,...o}}function fw(i,e,t){var n;(n=i.deprecations)==null||n.forEach(r=>{var o;(o=r.regex)!=null&&o.test(e)&&(r.deprecated?t.deprecated(r.old,r.new)():t.removed(r.old,r.new)())})}function r5(i){return i.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),i}function i_(i){Kh(i);const e={},t={};pw({modules:i,level:0,moduleMap:e,moduleDepth:t});const n=Object.keys(t).sort((r,o)=>t[o]-t[r]).map(r=>e[r]);return Kh(n),n}function pw(i){const{modules:e,level:t,moduleMap:n,moduleDepth:r}=i;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const o of e)n[o.name]=o,(r[o.name]===void 0||r[o.name]<t)&&(r[o.name]=t);for(const o of e)o.dependencies&&pw({modules:o.dependencies,level:t+1,moduleMap:n,moduleDepth:r})}function o5(i){switch(i==null?void 0:i.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function s5(i,e){var t;if(Number(((t=i.match(/^#version[ \t]+(\d+)/m))==null?void 0:t[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return i=lv(i,a5),i;case"fragment":return i=lv(i,l5),i;default:throw new Error(e)}}const mw=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],a5=[...mw,[_m("attribute"),"in $1"],[_m("varying"),"out $1"]],l5=[...mw,[_m("varying"),"in $1"]];function lv(i,e){for(const[t,n]of e)i=i.replace(t,n);return i}function _m(i){return new RegExp(`\\b${i}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function gw(i,e){let t="";for(const n in i){const r=i[n];if(t+=`void ${r.signature} {
`,r.header&&(t+=`  ${r.header}`),e[n]){const o=e[n];o.sort((s,a)=>s.order-a.order);for(const s of o)t+=`  ${s.injection}
`}r.footer&&(t+=`  ${r.footer}`),t+=`}
`}return t}function _w(i){const e={vertex:{},fragment:{}};for(const t of i){let n,r;typeof t!="string"?(n=t,r=n.hook):(n={},r=t),r=r.trim();const[o,s]=r.split(":"),a=r.replace(/\(.+/,""),l=Object.assign(n,{signature:s});switch(o){case"vs":e.vertex[a]=l;break;case"fs":e.fragment[a]=l;break;default:throw new Error(o)}}return e}function c5(i,e){return{name:u5(i,e),language:"glsl",version:h5(i)}}function u5(i,e="unnamed"){const t=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(i);return t?t[1]:e}function h5(i){let e=100;const t=i.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const n=parseInt(t[1],10);Number.isFinite(n)&&(e=n)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const yw=`

${uh}
`,d5=`precision highp float;
`;function f5(i){const e=i_(i.modules||[]);return{source:m5(i.platformInfo,{...i,source:i.source,stage:"vertex",modules:e}),getUniforms:bw(e)}}function p5(i){const{vs:e,fs:t}=i,n=i_(i.modules||[]);return{vs:cv(i.platformInfo,{...i,source:e,stage:"vertex",modules:n}),fs:cv(i.platformInfo,{...i,source:t,stage:"fragment",modules:n}),getUniforms:bw(n)}}function m5(i,e){var t;const{source:n,stage:r,modules:o,hookFunctions:s=[],inject:a={},log:l}=e;t_(typeof n=="string","shader source must be a string");const c=n;let u="";const h=_w(s),d={},f={},p={};for(const g in a){const _=typeof a[g]=="string"?{injection:a[g],order:0}:a[g],T=/^(v|f)s:(#)?([\w-]+)$/.exec(g);if(T){const E=T[2],y=T[3];E?y==="decl"?f[g]=[_]:p[g]=[_]:d[g]=[_]}else p[g]=[_]}const b=o;for(const g of b){l&&fw(g,c,l);const _=vw(g,"wgsl");u+=_;const T=((t=g.injections)==null?void 0:t[r])||{};for(const E in T){const y=/^(v|f)s:#([\w-]+)$/.exec(E);if(y){const C=y[2]==="decl"?f:p;C[E]=C[E]||[],C[E].push(T[E])}else d[E]=d[E]||[],d[E].push(T[E])}}return u+=yw,u=Xh(u,r,f),u+=gw(h[r],d),u+=c,u=Xh(u,r,p),u}function cv(i,e){var t;const{source:n,stage:r,language:o="glsl",modules:s,defines:a={},hookFunctions:l=[],inject:c={},prologue:u=!0,log:h}=e;t_(typeof n=="string","shader source must be a string");const d=o==="glsl"?c5(n).version:-1,f=i.shaderLanguageVersion,p=d===100?"#version 100":"#version 300 es",b=n.split(`
`).slice(1).join(`
`),g={};s.forEach(I=>{Object.assign(g,I.defines)}),Object.assign(g,a);let _="";switch(o){case"wgsl":break;case"glsl":_=u?`${p}

// ----- PROLOGUE -------------------------
${`#define SHADER_TYPE_${r.toUpperCase()}`}

${o5(i)}
${r==="fragment"?d5:""}

// ----- APPLICATION DEFINES -------------------------

${g5(g)}

`:`${p}
`;break}const T=_w(l),E={},y={},C={};for(const I in c){const F=typeof c[I]=="string"?{injection:c[I],order:0}:c[I],V=/^(v|f)s:(#)?([\w-]+)$/.exec(I);if(V){const q=V[2],Q=V[3];q?Q==="decl"?y[I]=[F]:C[I]=[F]:E[I]=[F]}else C[I]=[F]}for(const I of s){h&&fw(I,b,h);const F=vw(I,r);_+=F;const V=((t=I.instance)==null?void 0:t.normalizedInjections[r])||{};for(const q in V){const Q=/^(v|f)s:#([\w-]+)$/.exec(q);if(Q){const M=Q[2]==="decl"?y:C;M[q]=M[q]||[],M[q].push(V[q])}else E[q]=E[q]||[],E[q].push(V[q])}}return _+="// ----- MAIN SHADER SOURCE -------------------------",_+=yw,_=Xh(_,r,y),_+=gw(T[r],E),_+=b,_=Xh(_,r,C),o==="glsl"&&d!==f&&(_=s5(_,r)),_.trim()}function bw(i){return function(e){var t;const n={};for(const r of i){const o=(t=r.getUniforms)==null?void 0:t.call(r,e,n);Object.assign(n,o)}return n}}function g5(i={}){let e="";for(const t in i){const n=i[t];(n||Number.isFinite(n))&&(e+=`#define ${t.toUpperCase()} ${i[t]}
`)}return e}function vw(i,e){let t;switch(e){case"vertex":t=i.vs||"";break;case"fragment":t=i.fs||"";break;case"wgsl":t=i.source||"";break;default:t_(!1)}if(!i.name)throw new Error("Shader module must have a name");const n=i.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let r=`// ----- MODULE ${i.name} ---------------

`;return e!=="wgsl"&&(r+=`#define MODULE_${n}
`),r+=`${t}
`,r}const _5=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,y5=/^\s*\#\s*endif\s*$/;function b5(i,e){var t;const n=i.split(`
`),r=[];let o=!0,s=null;for(const a of n){const l=a.match(_5),c=a.match(y5);l?(s=l[1],o=!!((t=void 0)!=null&&t[s])):c?o=!0:o&&r.push(a)}return r.join(`
`)}const xw=class $l{constructor(){B(this,"_hookFunctions",[]),B(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return $l.defaultShaderAssembler=$l.defaultShaderAssembler||new $l,$l.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,{source:r,getUniforms:o}=f5({...e,source:e.source,modules:t,hookFunctions:n});return{source:e.platformInfo.shaderLanguage==="wgsl"?b5(r):r,getUniforms:o,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),n=this._hookFunctions;return{...p5({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:n}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),n={};let r=0;for(let o=0,s=this._defaultModules.length;o<s;++o){const a=this._defaultModules[o],l=a.name;t[r++]=a,n[l]=!0}for(let o=0,s=e.length;o<s;++o){const a=e[o],l=a.name;n[l]||(t[r++]=a,n[l]=!0)}return t.length=r,Kh(t),t}};B(xw,"defaultShaderAssembler");let v5=xw;class En{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class uv{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Ro extends En{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Do extends En{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class ym extends En{constructor(e,t,n){super(e,n),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class ds extends En{constructor(e,t,n,r){super(e,n),this.format=t,this.access=r}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var To;(i=>{i[i.Uniform=0]="Uniform",i[i.Storage=1]="Storage",i[i.Texture=2]="Texture",i[i.Sampler=3]="Sampler",i[i.StorageTexture=4]="StorageTexture"})(To||(To={}));class Iu{constructor(e,t,n,r,o,s,a){this.name=e,this.type=t,this.group=n,this.binding=r,this.attributes=o,this.resourceType=s,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class x5{constructor(e,t){this.name=e,this.type=t}}class w5{constructor(e,t,n,r){this.name=e,this.type=t,this.locationType=n,this.location=r,this.interpolation=null}}class hv{constructor(e,t,n,r){this.name=e,this.type=t,this.locationType=n,this.location=r}}class S5{constructor(e,t,n,r){this.name=e,this.type=t,this.attributes=n,this.id=r}}class E5{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n}}class C5{constructor(e,t=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=n}}class T5{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function A5(i){var e=(32768&i)>>15,t=(31744&i)>>10,n=1023&i;return t==0?(e?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):t==31?n?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,t-15)*(1+n/Math.pow(2,10))}const ww=new Float32Array(1),I5=new Int32Array(ww.buffer),hi=new Uint16Array(1);function k5(i){ww[0]=i;const e=I5[0],t=e>>31&1;let n=e>>23&255,r=8388607&e;if(n===255)return hi[0]=t<<15|31744|(r!==0?512:0),hi[0];if(n===0){if(r===0)return hi[0]=t<<15,hi[0];r|=8388608;let o=113;for(;!(8388608&r);)r<<=1,o--;return n=127-o,r&=8388607,n>0?(r=(r>>126-n)+(r>>127-n&1),hi[0]=t<<15|n<<10|r>>13,hi[0]):(hi[0]=t<<15,hi[0])}return n=n-127+15,n>=31?(hi[0]=t<<15|31744,hi[0]):n<=0?n<-10?(hi[0]=t<<15,hi[0]):(r=(8388608|r)>>1-n,hi[0]=t<<15|r>>13,hi[0]):(r>>=13,hi[0]=t<<15|n<<10|r,hi[0])}const n_=new Uint32Array(1),Sw=new Float32Array(n_.buffer,0,1);function dv(i){const e=112+(i>>6&31)<<23|(63&i)<<17;return n_[0]=e,Sw[0]}function L5(i,e,t,n,r,o,s,a,l){const c=n*(s>>=r)*(o>>=r)+t*s+e*a;switch(l){case"r8unorm":return[nt(i,c,"8unorm",1)[0]];case"r8snorm":return[nt(i,c,"8snorm",1)[0]];case"r8uint":return[nt(i,c,"8uint",1)[0]];case"r8sint":return[nt(i,c,"8sint",1)[0]];case"rg8unorm":{const u=nt(i,c,"8unorm",2);return[u[0],u[1]]}case"rg8snorm":{const u=nt(i,c,"8snorm",2);return[u[0],u[1]]}case"rg8uint":{const u=nt(i,c,"8uint",2);return[u[0],u[1]]}case"rg8sint":{const u=nt(i,c,"8sint",2);return[u[0],u[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const u=nt(i,c,"8unorm",4);return[u[0],u[1],u[2],u[3]]}case"rgba8snorm":{const u=nt(i,c,"8snorm",4);return[u[0],u[1],u[2],u[3]]}case"rgba8uint":{const u=nt(i,c,"8uint",4);return[u[0],u[1],u[2],u[3]]}case"rgba8sint":{const u=nt(i,c,"8sint",4);return[u[0],u[1],u[2],u[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const u=nt(i,c,"8unorm",4);return[u[2],u[1],u[0],u[3]]}case"r16uint":return[nt(i,c,"16uint",1)[0]];case"r16sint":return[nt(i,c,"16sint",1)[0]];case"r16float":return[nt(i,c,"16float",1)[0]];case"rg16uint":{const u=nt(i,c,"16uint",2);return[u[0],u[1]]}case"rg16sint":{const u=nt(i,c,"16sint",2);return[u[0],u[1]]}case"rg16float":{const u=nt(i,c,"16float",2);return[u[0],u[1]]}case"rgba16uint":{const u=nt(i,c,"16uint",4);return[u[0],u[1],u[2],u[3]]}case"rgba16sint":{const u=nt(i,c,"16sint",4);return[u[0],u[1],u[2],u[3]]}case"rgba16float":{const u=nt(i,c,"16float",4);return[u[0],u[1],u[2],u[3]]}case"r32uint":return[nt(i,c,"32uint",1)[0]];case"r32sint":return[nt(i,c,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[nt(i,c,"32float",1)[0]];case"rg32uint":{const u=nt(i,c,"32uint",2);return[u[0],u[1]]}case"rg32sint":{const u=nt(i,c,"32sint",2);return[u[0],u[1]]}case"rg32float":{const u=nt(i,c,"32float",2);return[u[0],u[1]]}case"rgba32uint":{const u=nt(i,c,"32uint",4);return[u[0],u[1],u[2],u[3]]}case"rgba32sint":{const u=nt(i,c,"32sint",4);return[u[0],u[1],u[2],u[3]]}case"rgba32float":{const u=nt(i,c,"32float",4);return[u[0],u[1],u[2],u[3]]}case"rg11b10ufloat":{const u=new Uint32Array(i.buffer,c,1)[0],h=(4192256&u)>>11,d=(4290772992&u)>>22;return[dv(2047&u),dv(h),(function(f){const p=112+(f>>5&31)<<23|(31&f)<<18;return n_[0]=p,Sw[0]})(d),1]}}return null}function nt(i,e,t,n){const r=[0,0,0,0];for(let o=0;o<n;++o)switch(t){case"8unorm":r[o]=i[e]/255,e++;break;case"8snorm":r[o]=i[e]/255*2-1,e++;break;case"8uint":r[o]=i[e],e++;break;case"8sint":r[o]=i[e]-127,e++;break;case"16uint":r[o]=i[e]|i[e+1]<<8,e+=2;break;case"16sint":r[o]=(i[e]|i[e+1]<<8)-32768,e+=2;break;case"16float":r[o]=A5(i[e]|i[e+1]<<8),e+=2;break;case"32uint":case"32sint":r[o]=i[e]|i[e+1]<<8|i[e+2]<<16|i[e+3]<<24,e+=4;break;case"32float":r[o]=new Float32Array(i.buffer,e,1)[0],e+=4}return r}function at(i,e,t,n,r){for(let o=0;o<n;++o)switch(t){case"8unorm":i[e]=255*r[o],e++;break;case"8snorm":i[e]=.5*(r[o]+1)*255,e++;break;case"8uint":i[e]=r[o],e++;break;case"8sint":i[e]=r[o]+127,e++;break;case"16uint":new Uint16Array(i.buffer,e,1)[0]=r[o],e+=2;break;case"16sint":new Int16Array(i.buffer,e,1)[0]=r[o],e+=2;break;case"16float":{const s=k5(r[o]);new Uint16Array(i.buffer,e,1)[0]=s,e+=2;break}case"32uint":new Uint32Array(i.buffer,e,1)[0]=r[o],e+=4;break;case"32sint":new Int32Array(i.buffer,e,1)[0]=r[o],e+=4;break;case"32float":new Float32Array(i.buffer,e,1)[0]=r[o],e+=4}return r}const rp={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Rn{constructor(){this.id=Rn._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(Zh.instance);for(const n of e)n instanceof Array?this.searchBlock(n,t):n.search(t);t(Qh.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}Rn._id=0;class Zh extends Rn{}Zh.instance=new Zh;class Qh extends Rn{}Qh.instance=new Qh;const Ew=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class At extends Rn{constructor(){super()}}class yc extends At{constructor(e,t,n,r,o,s){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=n,this.body=r,this.startLine=o,this.endLine=s}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class R5 extends At{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class Cw extends At{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class bm extends At{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class Tw extends At{constructor(e,t,n,r){super(),this.init=e,this.condition=t,this.increment=n,this.body=r}get astNodeType(){return"for"}search(e){var t,n,r;(t=this.init)===null||t===void 0||t.search(e),(n=this.condition)===null||n===void 0||n.search(e),(r=this.increment)===null||r===void 0||r.search(e),this.searchBlock(this.body,e)}}class Xr extends At{constructor(e,t,n,r,o){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=r,this.value=o}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class r_ extends At{constructor(e,t,n){super(),this.attributes=null,this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class oc extends At{constructor(e,t,n,r,o){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=r,this.value=o}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class hh extends At{constructor(e,t,n,r,o){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=r,this.value=o}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var oa,Vl,N,k;(i=>{i.increment="++",i.decrement="--"})(oa||(oa={})),(i=>{i.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return i[t]}})(oa||(oa={}));class Aw extends At{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(i=>{i.assign="=",i.addAssign="+=",i.subtractAssin="-=",i.multiplyAssign="*=",i.divideAssign="/=",i.moduloAssign="%=",i.andAssign="&=",i.orAssign="|=",i.xorAssign="^=",i.shiftLeftAssign="<<=",i.shiftRightAssign=">>="})(Vl||(Vl={})),(i=>{i.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(Vl||(Vl={}));class Iw extends At{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class o_ extends At{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return Ew.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class kw extends At{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),(t=this.continuing)===null||t===void 0||t.search(e)}}class Lw extends At{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class Rw extends At{constructor(e,t,n,r){super(),this.condition=e,this.body=t,this.elseif=n,this.else=r}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class Pw extends At{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class P5 extends At{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class D5 extends At{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class Dw extends At{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class s_ extends At{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class M5 extends At{constructor(){super()}get astNodeType(){return"discard"}}class Mw extends At{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}let Nw=class extends At{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}},$=class dh extends At{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let n=1;n<e.length;++n){const r=dh._priority.get(t.name);dh._priority.get(e[n].name)<r&&(t=e[n])}return t.name==="x32"?dh.i32:t}getTypeName(){return this.name}};$.x32=new $("x32"),$.f32=new $("f32"),$.i32=new $("i32"),$.u32=new $("u32"),$.f16=new $("f16"),$.bool=new $("bool"),$.void=new $("void"),$._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class fv extends ${constructor(e){super(e)}}class jr extends ${constructor(e,t,n,r){super(e),this.members=t,this.startLine=n,this.endLine=r}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}let D=class extends ${constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}};D.vec2f=new D("vec2",$.f32,null),D.vec3f=new D("vec3",$.f32,null),D.vec4f=new D("vec4",$.f32,null),D.vec2i=new D("vec2",$.i32,null),D.vec3i=new D("vec3",$.i32,null),D.vec4i=new D("vec4",$.i32,null),D.vec2u=new D("vec2",$.u32,null),D.vec3u=new D("vec3",$.u32,null),D.vec4u=new D("vec4",$.u32,null),D.vec2h=new D("vec2",$.f16,null),D.vec3h=new D("vec3",$.f16,null),D.vec4h=new D("vec4",$.f16,null),D.vec2b=new D("vec2",$.bool,null),D.vec3b=new D("vec3",$.bool,null),D.vec4b=new D("vec4",$.bool,null),D.mat2x2f=new D("mat2x2",$.f32,null),D.mat2x3f=new D("mat2x3",$.f32,null),D.mat2x4f=new D("mat2x4",$.f32,null),D.mat3x2f=new D("mat3x2",$.f32,null),D.mat3x3f=new D("mat3x3",$.f32,null),D.mat3x4f=new D("mat3x4",$.f32,null),D.mat4x2f=new D("mat4x2",$.f32,null),D.mat4x3f=new D("mat4x3",$.f32,null),D.mat4x4f=new D("mat4x4",$.f32,null),D.mat2x2h=new D("mat2x2",$.f16,null),D.mat2x3h=new D("mat2x3",$.f16,null),D.mat2x4h=new D("mat2x4",$.f16,null),D.mat3x2h=new D("mat3x2",$.f16,null),D.mat3x3h=new D("mat3x3",$.f16,null),D.mat3x4h=new D("mat3x4",$.f16,null),D.mat4x2h=new D("mat4x2",$.f16,null),D.mat4x3h=new D("mat4x3",$.f16,null),D.mat4x4h=new D("mat4x4",$.f16,null),D.mat2x2i=new D("mat2x2",$.i32,null),D.mat2x3i=new D("mat2x3",$.i32,null),D.mat2x4i=new D("mat2x4",$.i32,null),D.mat3x2i=new D("mat3x2",$.i32,null),D.mat3x3i=new D("mat3x3",$.i32,null),D.mat3x4i=new D("mat3x4",$.i32,null),D.mat4x2i=new D("mat4x2",$.i32,null),D.mat4x3i=new D("mat4x3",$.i32,null),D.mat4x4i=new D("mat4x4",$.i32,null),D.mat2x2u=new D("mat2x2",$.u32,null),D.mat2x3u=new D("mat2x3",$.u32,null),D.mat2x4u=new D("mat2x4",$.u32,null),D.mat3x2u=new D("mat3x2",$.u32,null),D.mat3x3u=new D("mat3x3",$.u32,null),D.mat3x4u=new D("mat3x4",$.u32,null),D.mat4x2u=new D("mat4x2",$.u32,null),D.mat4x3u=new D("mat4x3",$.u32,null),D.mat4x4u=new D("mat4x4",$.u32,null);class fh extends ${constructor(e,t,n,r){super(e),this.storage=t,this.type=n,this.access=r}get astNodeType(){return"pointer"}}class sc extends ${constructor(e,t,n,r){super(e),this.attributes=t,this.format=n,this.count=r}get astNodeType(){return"array"}get isArray(){return!0}}class Hl extends ${constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}}class qn extends Rn{constructor(){super(),this.postfix=null}}class fs extends qn{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class lr extends qn{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class a_ extends qn{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return Ew.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class nn extends qn{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class Bw extends qn{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const n=e.evalExpression(this.initializer,e.context);return n!==null&&this.postfix?n.getSubData(e,this.postfix,e.context):n}return null}search(e){this.initializer.search(e)}}class jt extends qn{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof P}get isVector(){return this.value instanceof w||this.value instanceof Ae}get scalarValue(){return this.value instanceof P?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof w||this.value instanceof Ae?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class Ow extends qn{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Ia extends qn{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class Fw extends qn{constructor(){super()}}class Vt extends Fw{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Bn extends Fw{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?$.f32:e.name==="u32"||t.name==="u32"?$.u32:$.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class zw extends Rn{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class ph extends qn{constructor(){super()}get astNodeType(){return"default"}}class Uw extends zw{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class $w extends zw{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class pv extends Rn{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}}class N5 extends Rn{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class mv extends Rn{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}}class Vw extends Rn{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class Tn{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=Tn._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,n,r){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}Tn._id=0;class vm extends Tn{constructor(){super(new En("void",null),null)}toString(){return"void"}}vm.void=new vm;class zs extends Tn{constructor(e){super(new ym("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,n,r){this.reference.setDataValue(e,t,n,r)}getSubData(e,t,n){return t?this.reference.getSubData(e,t,n):this}toString(){return`&${this.reference.toString()}`}}let P=class Gl extends Tn{constructor(e,t,n=null){super(t,n),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new Gl(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Gl(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Gl(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,n,r){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(t instanceof Gl))return void console.error("SetDataValue: Invalid value",t);let o=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?o=Math.floor(o):this.typeInfo.name==="bool"&&(o=o?1:0),this.data[0]=o}getSubData(e,t,n){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}};function B5(i,e,t){const n=e.length;return n===2?t==="f32"?new w(new Float32Array(e),i.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new w(new Int32Array(e),i.getTypeInfo("vec2i")):t==="u32"?new w(new Uint32Array(e),i.getTypeInfo("vec2u")):t==="f16"?new w(new Float32Array(e),i.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):n===3?t==="f32"?new w(new Float32Array(e),i.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new w(new Int32Array(e),i.getTypeInfo("vec3i")):t==="u32"?new w(new Uint32Array(e),i.getTypeInfo("vec3u")):t==="f16"?new w(new Float32Array(e),i.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):n===4?t==="f32"?new w(new Float32Array(e),i.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new w(new Int32Array(e),i.getTypeInfo("vec4i")):t==="u32"?new w(new Uint32Array(e),i.getTypeInfo("vec4u")):t==="f16"?new w(new Float32Array(e),i.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}let w=class Wl extends Tn{constructor(e,t,n=null){if(super(t,n),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const r=this.typeInfo.name;r==="vec2f"||r==="vec3f"||r==="vec4f"?this.data=new Float32Array(e):r==="vec2i"||r==="vec3i"||r==="vec4i"?this.data=new Int32Array(e):r==="vec2u"||r==="vec3u"||r==="vec4u"?this.data=new Uint32Array(e):r==="vec2h"||r==="vec3h"||r==="vec4h"?this.data=new Float32Array(e):r==="vec2b"||r==="vec3b"||r==="vec4b"?this.data=new Int32Array(e):r==="vec2"||r==="vec3"||r==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${r}`)}}clone(){if(this.data instanceof Float32Array)return new Wl(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Wl(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Wl(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,n,r){n instanceof fs?console.error("TODO: Set vector postfix"):t instanceof Wl?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,n){if(t===null)return this;let r=e.getTypeInfo("f32");if(this.typeInfo instanceof ds)r=this.typeInfo.format||r;else{const s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?r=e.getTypeInfo("f32"):s==="vec2i"||s==="vec3i"||s==="vec4i"?r=e.getTypeInfo("i32"):s==="vec2b"||s==="vec3b"||s==="vec4b"?r=e.getTypeInfo("bool"):s==="vec2u"||s==="vec3u"||s==="vec4u"?r=e.getTypeInfo("u32"):s==="vec2h"||s==="vec3h"||s==="vec4h"?r=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${s}`)}let o=this;for(;t!==null&&o!==null;){if(t instanceof Ia){const s=t.index;let a=-1;if(s instanceof jt){if(!(s.value instanceof P))return console.error(`GetSubData: Invalid array index ${s.value}`),null;a=s.value.value}else{const l=e.evalExpression(s,n);if(!(l instanceof P))return console.error("GetSubData: Unknown index type",s),null;a=l.value}if(a<0||a>=o.data.length)return console.error("GetSubData: Index out of range",a),null;if(o.data instanceof Float32Array){const l=new Float32Array(o.data.buffer,o.data.byteOffset+4*a,1);return new P(l,r)}if(o.data instanceof Int32Array){const l=new Int32Array(o.data.buffer,o.data.byteOffset+4*a,1);return new P(l,r)}if(o.data instanceof Uint32Array){const l=new Uint32Array(o.data.buffer,o.data.byteOffset+4*a,1);return new P(l,r)}throw"GetSubData: Invalid data type"}if(!(t instanceof fs))return console.error("GetSubData: Unknown postfix",t),null;{const s=t.value.toLowerCase();if(s.length===1){let l=0;if(s==="x"||s==="r")l=0;else if(s==="y"||s==="g")l=1;else if(s==="z"||s==="b")l=2;else{if(s!=="w"&&s!=="a")return console.error(`GetSubData: Unknown member ${s}`),null;l=3}if(this.data instanceof Float32Array){let c=new Float32Array(this.data.buffer,this.data.byteOffset+4*l,1);return new P(c,r,this)}if(this.data instanceof Int32Array){let c=new Int32Array(this.data.buffer,this.data.byteOffset+4*l,1);return new P(c,r,this)}if(this.data instanceof Uint32Array){let c=new Uint32Array(this.data.buffer,this.data.byteOffset+4*l,1);return new P(c,r,this)}}const a=[];for(const l of s)l==="x"||l==="r"?a.push(this.data[0]):l==="y"||l==="g"?a.push(this.data[1]):l==="z"||l==="b"?a.push(this.data[2]):l==="w"||l==="a"?a.push(this.data[3]):console.error(`GetDataValue: Unknown member ${l}`);o=B5(e,a,r.name)}t=t.postfix}return o}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}},Ae=class xm extends Tn{constructor(e,t,n=null){super(t,n),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new xm(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,n,r){n instanceof fs?console.error("TODO: Set matrix postfix"):t instanceof xm?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,n){if(t===null)return this;const r=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof ds)this.typeInfo.format;else if(r.endsWith("f"))e.getTypeInfo("f32");else if(r.endsWith("i"))e.getTypeInfo("i32");else if(r.endsWith("u"))e.getTypeInfo("u32");else{if(!r.endsWith("h"))return console.error(`GetDataValue: Unknown type ${r}`),null;e.getTypeInfo("f16")}if(t instanceof Ia){const o=t.index;let s=-1;if(o instanceof jt){if(!(o.value instanceof P))return console.error(`GetDataValue: Invalid array index ${o.value}`),null;s=o.value.value}else{const c=e.evalExpression(o,n);if(!(c instanceof P))return console.error("GetDataValue: Unknown index type",o),null;s=c.value}if(s<0||s>=this.data.length)return console.error("GetDataValue: Index out of range",s),null;const a=r.endsWith("h")?"h":"f";let l;if(r==="mat2x2"||r==="mat2x2f"||r==="mat2x2h"||r==="mat3x2"||r==="mat3x2f"||r==="mat3x2h"||r==="mat4x2"||r==="mat4x2f"||r==="mat4x2h")l=new w(new Float32Array(this.data.buffer,this.data.byteOffset+2*s*4,2),e.getTypeInfo(`vec2${a}`));else if(r==="mat2x3"||r==="mat2x3f"||r==="mat2x3h"||r==="mat3x3"||r==="mat3x3f"||r==="mat3x3h"||r==="mat4x3"||r==="mat4x3f"||r==="mat4x3h")l=new w(new Float32Array(this.data.buffer,this.data.byteOffset+3*s*4,3),e.getTypeInfo(`vec3${a}`));else{if(r!=="mat2x4"&&r!=="mat2x4f"&&r!=="mat2x4h"&&r!=="mat3x4"&&r!=="mat3x4f"&&r!=="mat3x4h"&&r!=="mat4x4"&&r!=="mat4x4f"&&r!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${r}`),null;l=new w(new Float32Array(this.data.buffer,this.data.byteOffset+4*s*4,4),e.getTypeInfo(`vec4${a}`))}return t.postfix?l.getSubData(e,t.postfix,n):l}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}};class Nt extends Tn{constructor(e,t,n=0,r=null){super(t,r),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Nt(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,n,r){if(t===null)return void console.log("setDataValue: NULL data.");let o=this.offset,s=this.typeInfo;for(;n;){if(n instanceof Ia)if(s instanceof Do){const a=n.index;if(a instanceof jt){if(!(a.value instanceof P))return void console.error(`SetDataValue: Invalid index type ${a.value}`);o+=a.value.value*s.stride}else{const l=e.evalExpression(a,r);if(!(l instanceof P))return void console.error("SetDataValue: Unknown index type",a);o+=l.value*s.stride}s=s.format}else console.error(`SetDataValue: Type ${s.getTypeName()} is not an array`);else{if(!(n instanceof fs))return void console.error("SetDataValue: Unknown postfix type",n);{const a=n.value;if(s instanceof Ro){let l=!1;for(const c of s.members)if(c.name===a){o+=c.offset,s=c.type,l=!0;break}if(!l)return void console.error(`SetDataValue: Member ${a} not found`)}else if(s instanceof En){const l=s.getTypeName();let c=0;if(a==="x"||a==="r")c=0;else if(a==="y"||a==="g")c=1;else if(a==="z"||a==="b")c=2;else{if(a!=="w"&&a!=="a")return void console.error(`SetDataValue: Unknown member ${a}`);c=3}if(!(t instanceof P))return void console.error("SetDataValue: Invalid value",t);const u=t.value;return l==="vec2f"?void(new Float32Array(this.buffer,o,2)[c]=u):l==="vec3f"?void(new Float32Array(this.buffer,o,3)[c]=u):l==="vec4f"?void(new Float32Array(this.buffer,o,4)[c]=u):l==="vec2i"?void(new Int32Array(this.buffer,o,2)[c]=u):l==="vec3i"?void(new Int32Array(this.buffer,o,3)[c]=u):l==="vec4i"?void(new Int32Array(this.buffer,o,4)[c]=u):l==="vec2u"?void(new Uint32Array(this.buffer,o,2)[c]=u):l==="vec3u"?void(new Uint32Array(this.buffer,o,3)[c]=u):l==="vec4u"?void(new Uint32Array(this.buffer,o,4)[c]=u):void console.error(`SetDataValue: Type ${l} is not a struct`)}}}n=n.postfix}this.setData(e,t,s,o,r)}setData(e,t,n,r,o){const s=n.getTypeName();if(s!=="f32"&&s!=="f16")if(s!=="i32"&&s!=="atomic<i32>"&&s!=="x32")if(s!=="u32"&&s!=="atomic<u32>")if(s!=="bool"){if(s==="vec2f"||s==="vec2h"){const a=new Float32Array(this.buffer,r,2);return void(t instanceof w?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(s==="vec3f"||s==="vec3h"){const a=new Float32Array(this.buffer,r,3);return void(t instanceof w?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(s==="vec4f"||s==="vec4h"){const a=new Float32Array(this.buffer,r,4);return void(t instanceof w?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(s==="vec2i"){const a=new Int32Array(this.buffer,r,2);return void(t instanceof w?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(s==="vec3i"){const a=new Int32Array(this.buffer,r,3);return void(t instanceof w?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(s==="vec4i"){const a=new Int32Array(this.buffer,r,4);return void(t instanceof w?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(s==="vec2u"){const a=new Uint32Array(this.buffer,r,2);return void(t instanceof w?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(s==="vec3u"){const a=new Uint32Array(this.buffer,r,3);return void(t instanceof w?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(s==="vec4u"){const a=new Uint32Array(this.buffer,r,4);return void(t instanceof w?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(s==="vec2b"){const a=new Uint32Array(this.buffer,r,2);return void(t instanceof w?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(s==="vec3b"){const a=new Uint32Array(this.buffer,r,3);return void(t instanceof w?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(s==="vec4b"){const a=new Uint32Array(this.buffer,r,4);return void(t instanceof w?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(s==="mat2x2f"||s==="mat2x2h"){const a=new Float32Array(this.buffer,r,4);return void(t instanceof Ae?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(s==="mat2x3f"||s==="mat2x3h"){const a=new Float32Array(this.buffer,r,6);return void(t instanceof Ae?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5]))}if(s==="mat2x4f"||s==="mat2x4h"){const a=new Float32Array(this.buffer,r,8);return void(t instanceof Ae?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7]))}if(s==="mat3x2f"||s==="mat3x2h"){const a=new Float32Array(this.buffer,r,6);return void(t instanceof Ae?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5]))}if(s==="mat3x3f"||s==="mat3x3h"){const a=new Float32Array(this.buffer,r,9);return void(t instanceof Ae?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8]))}if(s==="mat3x4f"||s==="mat3x4h"){const a=new Float32Array(this.buffer,r,12);return void(t instanceof Ae?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11]))}if(s==="mat4x2f"||s==="mat4x2h"){const a=new Float32Array(this.buffer,r,8);return void(t instanceof Ae?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7]))}if(s==="mat4x3f"||s==="mat4x3h"){const a=new Float32Array(this.buffer,r,12);return void(t instanceof Ae?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11]))}if(s==="mat4x4f"||s==="mat4x4h"){const a=new Float32Array(this.buffer,r,16);return void(t instanceof Ae?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11],a[12]=t.data[12],a[13]=t.data[13],a[14]=t.data[14],a[15]=t.data[15]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]))}if(t instanceof Nt){if(n===t.typeInfo)return void new Uint8Array(this.buffer,r,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",s,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${s}`)}else t instanceof P&&(new Int32Array(this.buffer,r,1)[0]=t.value);else t instanceof P&&(new Uint32Array(this.buffer,r,1)[0]=t.value);else t instanceof P&&(new Int32Array(this.buffer,r,1)[0]=t.value);else t instanceof P&&(new Float32Array(this.buffer,r,1)[0]=t.value)}getSubData(e,t,n){var r,o,s;if(t===null)return this;let a=this.offset,l=this.typeInfo;for(;t;){if(t instanceof Ia){const u=t.index,h=u instanceof qn?e.evalExpression(u,n):u;let d=0;if(h instanceof P?d=h.value:typeof h=="number"?d=h:console.error("GetDataValue: Invalid index type",u),l instanceof Do)a+=d*l.stride,l=l.format;else{const f=l.getTypeName();f==="mat4x4"||f==="mat4x4f"||f==="mat4x4h"?(a+=16*d,l=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${l.getTypeName()} is not an array`)}}else{if(!(t instanceof fs))return console.error("GetDataValue: Unknown postfix type",t),null;{const u=t.value;if(l instanceof Ro){let h=!1;for(const d of l.members)if(d.name===u){a+=d.offset,l=d.type,h=!0;break}if(!h)return console.error(`GetDataValue: Member ${u} not found`),null}else if(l instanceof En){const h=l.getTypeName();if(h==="vec2f"||h==="vec3f"||h==="vec4f"||h==="vec2i"||h==="vec3i"||h==="vec4i"||h==="vec2u"||h==="vec3u"||h==="vec4u"||h==="vec2b"||h==="vec3b"||h==="vec4b"||h==="vec2h"||h==="vec3h"||h==="vec4h"||h==="vec2"||h==="vec3"||h==="vec4"){if(u.length>0&&u.length<5){let d="f";const f=[];for(let p=0;p<u.length;++p){const b=u[p].toLowerCase();let g=0;if(b==="x"||b==="r")g=0;else if(b==="y"||b==="g")g=1;else if(b==="z"||b==="b")g=2;else{if(b!=="w"&&b!=="a")return console.error(`Unknown member ${u}`),null;g=3}if(u.length===1){if(h.endsWith("f"))return this.buffer.byteLength<a+4*g+4?(console.log("Insufficient buffer data"),null):new P(new Float32Array(this.buffer,a+4*g,1),e.getTypeInfo("f32"),this);if(h.endsWith("h"))return new P(new Float32Array(this.buffer,a+4*g,1),e.getTypeInfo("f16"),this);if(h.endsWith("i"))return new P(new Int32Array(this.buffer,a+4*g,1),e.getTypeInfo("i32"),this);if(h.endsWith("b"))return new P(new Int32Array(this.buffer,a+4*g,1),e.getTypeInfo("bool"),this);if(h.endsWith("u"))return new P(new Uint32Array(this.buffer,a+4*g,1),e.getTypeInfo("i32"),this)}if(h==="vec2f")f.push(new Float32Array(this.buffer,a,2)[g]);else if(h==="vec3f"){if(a+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const _=new Float32Array(this.buffer,a,3);f.push(_[g])}else if(h==="vec4f")f.push(new Float32Array(this.buffer,a,4)[g]);else if(h==="vec2i")d="i",f.push(new Int32Array(this.buffer,a,2)[g]);else if(h==="vec3i")d="i",f.push(new Int32Array(this.buffer,a,3)[g]);else if(h==="vec4i")d="i",f.push(new Int32Array(this.buffer,a,4)[g]);else if(h==="vec2u"){d="u";const _=new Uint32Array(this.buffer,a,2);f.push(_[g])}else h==="vec3u"?(d="u",f.push(new Uint32Array(this.buffer,a,3)[g])):h==="vec4u"&&(d="u",f.push(new Uint32Array(this.buffer,a,4)[g]))}return f.length===2?l=e.getTypeInfo(`vec2${d}`):f.length===3?l=e.getTypeInfo(`vec3${d}`):f.length===4?l=e.getTypeInfo(`vec4${d}`):console.error(`GetDataValue: Invalid vector length ${f.length}`),new w(f,l,null)}return console.error(`GetDataValue: Unknown member ${u}`),null}return console.error(`GetDataValue: Type ${h} is not a struct`),null}}}t=t.postfix}const c=l.getTypeName();return c==="f32"?new P(new Float32Array(this.buffer,a,1),l,this):c==="i32"?new P(new Int32Array(this.buffer,a,1),l,this):c==="u32"?new P(new Uint32Array(this.buffer,a,1),l,this):c==="vec2f"?new w(new Float32Array(this.buffer,a,2),l,this):c==="vec3f"?new w(new Float32Array(this.buffer,a,3),l,this):c==="vec4f"?new w(new Float32Array(this.buffer,a,4),l,this):c==="vec2i"?new w(new Int32Array(this.buffer,a,2),l,this):c==="vec3i"?new w(new Int32Array(this.buffer,a,3),l,this):c==="vec4i"?new w(new Int32Array(this.buffer,a,4),l,this):c==="vec2u"?new w(new Uint32Array(this.buffer,a,2),l,this):c==="vec3u"?new w(new Uint32Array(this.buffer,a,3),l,this):c==="vec4u"?new w(new Uint32Array(this.buffer,a,4),l,this):l instanceof ds&&l.name==="atomic"?((r=l.format)===null||r===void 0?void 0:r.name)==="u32"?new P(new Uint32Array(this.buffer,a,1)[0],l.format,this):((o=l.format)===null||o===void 0?void 0:o.name)==="i32"?new P(new Int32Array(this.buffer,a,1)[0],l.format,this):(console.error(`GetDataValue: Invalid atomic format ${(s=l.format)===null||s===void 0?void 0:s.name}`),null):new Nt(this.buffer,l,a,this)}toString(){let e="";if(this.typeInfo instanceof Do)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let n=1;n<t.length/2;++n)e+=`, [${t[2*n]}, ${t[2*n+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}, ${t[n+3]}]`}else e="[...]";else this.typeInfo instanceof Ro?e+="{...}":e="[...]";return e}}class Yr extends Tn{constructor(e,t,n,r){super(t,null),this.data=e,this.descriptor=n,this.view=r}clone(){return new Yr(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>0?(e=n[0])!==null&&e!==void 0?e:0:n instanceof Object&&(t=n.width)!==null&&t!==void 0?t:0}get height(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>1?(e=n[1])!==null&&e!==void 0?e:0:n instanceof Object&&(t=n.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>2?(e=n[2])!==null&&e!==void 0?e:0:n instanceof Object&&(t=n.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<t.length;++n)t[n]=Math.max(1,t[n]>>e);return t}get texelByteSize(){const e=this.format,t=rp[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=rp[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=rp[e],n=this.width;if(!e||n<=0||!t)return-1;const r=this.height,o=this.depthOrArrayLayers,s=this.dimension;return n/t.blockWidth*(s==="1d"?1:r/t.blockHeight)*t.bytesPerBlock*o}getPixel(e,t,n=0,r=0){const o=this.texelByteSize,s=this.bytesPerRow,a=this.height,l=this.data[r];return L5(new Uint8Array(l),e,t,n,r,a,s,o,this.format)}setPixel(e,t,n,r,o){const s=this.texelByteSize,a=this.bytesPerRow,l=this.height,c=this.data[r];(function(u,h,d,f,p,b,g,_,T,E){const y=f*(g>>=p)*(b>>=p)+d*g+h*_;switch(T){case"r8unorm":return void at(u,y,"8unorm",1,E);case"r8snorm":return void at(u,y,"8snorm",1,E);case"r8uint":return void at(u,y,"8uint",1,E);case"r8sint":return void at(u,y,"8sint",1,E);case"rg8unorm":return void at(u,y,"8unorm",2,E);case"rg8snorm":return void at(u,y,"8snorm",2,E);case"rg8uint":return void at(u,y,"8uint",2,E);case"rg8sint":return void at(u,y,"8sint",2,E);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void at(u,y,"8unorm",4,E);case"rgba8snorm":return void at(u,y,"8snorm",4,E);case"rgba8uint":return void at(u,y,"8uint",4,E);case"rgba8sint":return void at(u,y,"8sint",4,E);case"r16uint":return void at(u,y,"16uint",1,E);case"r16sint":return void at(u,y,"16sint",1,E);case"r16float":return void at(u,y,"16float",1,E);case"rg16uint":return void at(u,y,"16uint",2,E);case"rg16sint":return void at(u,y,"16sint",2,E);case"rg16float":return void at(u,y,"16float",2,E);case"rgba16uint":return void at(u,y,"16uint",4,E);case"rgba16sint":return void at(u,y,"16sint",4,E);case"rgba16float":return void at(u,y,"16float",4,E);case"r32uint":return void at(u,y,"32uint",1,E);case"r32sint":return void at(u,y,"32sint",1,E);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void at(u,y,"32float",1,E);case"rg32uint":return void at(u,y,"32uint",2,E);case"rg32sint":return void at(u,y,"32sint",2,E);case"rg32float":return void at(u,y,"32float",2,E);case"rgba32uint":return void at(u,y,"32uint",4,E);case"rgba32sint":return void at(u,y,"32sint",4,E);case"rgba32float":return void at(u,y,"32float",4,E);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(c),e,t,n,r,l,a,s,this.format,o)}}(i=>{i[i.token=0]="token",i[i.keyword=1]="keyword",i[i.reserved=2]="reserved"})(k||(k={}));let L=class{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}},v=class{};N=v,v.none=new L("",k.reserved,""),v.eof=new L("EOF",k.token,""),v.reserved={asm:new L("asm",k.reserved,"asm"),bf16:new L("bf16",k.reserved,"bf16"),do:new L("do",k.reserved,"do"),enum:new L("enum",k.reserved,"enum"),f16:new L("f16",k.reserved,"f16"),f64:new L("f64",k.reserved,"f64"),handle:new L("handle",k.reserved,"handle"),i8:new L("i8",k.reserved,"i8"),i16:new L("i16",k.reserved,"i16"),i64:new L("i64",k.reserved,"i64"),mat:new L("mat",k.reserved,"mat"),premerge:new L("premerge",k.reserved,"premerge"),regardless:new L("regardless",k.reserved,"regardless"),typedef:new L("typedef",k.reserved,"typedef"),u8:new L("u8",k.reserved,"u8"),u16:new L("u16",k.reserved,"u16"),u64:new L("u64",k.reserved,"u64"),unless:new L("unless",k.reserved,"unless"),using:new L("using",k.reserved,"using"),vec:new L("vec",k.reserved,"vec"),void:new L("void",k.reserved,"void")},v.keywords={array:new L("array",k.keyword,"array"),atomic:new L("atomic",k.keyword,"atomic"),bool:new L("bool",k.keyword,"bool"),f32:new L("f32",k.keyword,"f32"),i32:new L("i32",k.keyword,"i32"),mat2x2:new L("mat2x2",k.keyword,"mat2x2"),mat2x3:new L("mat2x3",k.keyword,"mat2x3"),mat2x4:new L("mat2x4",k.keyword,"mat2x4"),mat3x2:new L("mat3x2",k.keyword,"mat3x2"),mat3x3:new L("mat3x3",k.keyword,"mat3x3"),mat3x4:new L("mat3x4",k.keyword,"mat3x4"),mat4x2:new L("mat4x2",k.keyword,"mat4x2"),mat4x3:new L("mat4x3",k.keyword,"mat4x3"),mat4x4:new L("mat4x4",k.keyword,"mat4x4"),ptr:new L("ptr",k.keyword,"ptr"),sampler:new L("sampler",k.keyword,"sampler"),sampler_comparison:new L("sampler_comparison",k.keyword,"sampler_comparison"),struct:new L("struct",k.keyword,"struct"),texture_1d:new L("texture_1d",k.keyword,"texture_1d"),texture_2d:new L("texture_2d",k.keyword,"texture_2d"),texture_2d_array:new L("texture_2d_array",k.keyword,"texture_2d_array"),texture_3d:new L("texture_3d",k.keyword,"texture_3d"),texture_cube:new L("texture_cube",k.keyword,"texture_cube"),texture_cube_array:new L("texture_cube_array",k.keyword,"texture_cube_array"),texture_multisampled_2d:new L("texture_multisampled_2d",k.keyword,"texture_multisampled_2d"),texture_storage_1d:new L("texture_storage_1d",k.keyword,"texture_storage_1d"),texture_storage_2d:new L("texture_storage_2d",k.keyword,"texture_storage_2d"),texture_storage_2d_array:new L("texture_storage_2d_array",k.keyword,"texture_storage_2d_array"),texture_storage_3d:new L("texture_storage_3d",k.keyword,"texture_storage_3d"),texture_depth_2d:new L("texture_depth_2d",k.keyword,"texture_depth_2d"),texture_depth_2d_array:new L("texture_depth_2d_array",k.keyword,"texture_depth_2d_array"),texture_depth_cube:new L("texture_depth_cube",k.keyword,"texture_depth_cube"),texture_depth_cube_array:new L("texture_depth_cube_array",k.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new L("texture_depth_multisampled_2d",k.keyword,"texture_depth_multisampled_2d"),texture_external:new L("texture_external",k.keyword,"texture_external"),u32:new L("u32",k.keyword,"u32"),vec2:new L("vec2",k.keyword,"vec2"),vec3:new L("vec3",k.keyword,"vec3"),vec4:new L("vec4",k.keyword,"vec4"),bitcast:new L("bitcast",k.keyword,"bitcast"),block:new L("block",k.keyword,"block"),break:new L("break",k.keyword,"break"),case:new L("case",k.keyword,"case"),continue:new L("continue",k.keyword,"continue"),continuing:new L("continuing",k.keyword,"continuing"),default:new L("default",k.keyword,"default"),diagnostic:new L("diagnostic",k.keyword,"diagnostic"),discard:new L("discard",k.keyword,"discard"),else:new L("else",k.keyword,"else"),enable:new L("enable",k.keyword,"enable"),fallthrough:new L("fallthrough",k.keyword,"fallthrough"),false:new L("false",k.keyword,"false"),fn:new L("fn",k.keyword,"fn"),for:new L("for",k.keyword,"for"),function:new L("function",k.keyword,"function"),if:new L("if",k.keyword,"if"),let:new L("let",k.keyword,"let"),const:new L("const",k.keyword,"const"),loop:new L("loop",k.keyword,"loop"),while:new L("while",k.keyword,"while"),private:new L("private",k.keyword,"private"),read:new L("read",k.keyword,"read"),read_write:new L("read_write",k.keyword,"read_write"),return:new L("return",k.keyword,"return"),requires:new L("requires",k.keyword,"requires"),storage:new L("storage",k.keyword,"storage"),switch:new L("switch",k.keyword,"switch"),true:new L("true",k.keyword,"true"),alias:new L("alias",k.keyword,"alias"),type:new L("type",k.keyword,"type"),uniform:new L("uniform",k.keyword,"uniform"),var:new L("var",k.keyword,"var"),override:new L("override",k.keyword,"override"),workgroup:new L("workgroup",k.keyword,"workgroup"),write:new L("write",k.keyword,"write"),r8unorm:new L("r8unorm",k.keyword,"r8unorm"),r8snorm:new L("r8snorm",k.keyword,"r8snorm"),r8uint:new L("r8uint",k.keyword,"r8uint"),r8sint:new L("r8sint",k.keyword,"r8sint"),r16uint:new L("r16uint",k.keyword,"r16uint"),r16sint:new L("r16sint",k.keyword,"r16sint"),r16float:new L("r16float",k.keyword,"r16float"),rg8unorm:new L("rg8unorm",k.keyword,"rg8unorm"),rg8snorm:new L("rg8snorm",k.keyword,"rg8snorm"),rg8uint:new L("rg8uint",k.keyword,"rg8uint"),rg8sint:new L("rg8sint",k.keyword,"rg8sint"),r32uint:new L("r32uint",k.keyword,"r32uint"),r32sint:new L("r32sint",k.keyword,"r32sint"),r32float:new L("r32float",k.keyword,"r32float"),rg16uint:new L("rg16uint",k.keyword,"rg16uint"),rg16sint:new L("rg16sint",k.keyword,"rg16sint"),rg16float:new L("rg16float",k.keyword,"rg16float"),rgba8unorm:new L("rgba8unorm",k.keyword,"rgba8unorm"),rgba8unorm_srgb:new L("rgba8unorm_srgb",k.keyword,"rgba8unorm_srgb"),rgba8snorm:new L("rgba8snorm",k.keyword,"rgba8snorm"),rgba8uint:new L("rgba8uint",k.keyword,"rgba8uint"),rgba8sint:new L("rgba8sint",k.keyword,"rgba8sint"),bgra8unorm:new L("bgra8unorm",k.keyword,"bgra8unorm"),bgra8unorm_srgb:new L("bgra8unorm_srgb",k.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new L("rgb10a2unorm",k.keyword,"rgb10a2unorm"),rg11b10float:new L("rg11b10float",k.keyword,"rg11b10float"),rg32uint:new L("rg32uint",k.keyword,"rg32uint"),rg32sint:new L("rg32sint",k.keyword,"rg32sint"),rg32float:new L("rg32float",k.keyword,"rg32float"),rgba16uint:new L("rgba16uint",k.keyword,"rgba16uint"),rgba16sint:new L("rgba16sint",k.keyword,"rgba16sint"),rgba16float:new L("rgba16float",k.keyword,"rgba16float"),rgba32uint:new L("rgba32uint",k.keyword,"rgba32uint"),rgba32sint:new L("rgba32sint",k.keyword,"rgba32sint"),rgba32float:new L("rgba32float",k.keyword,"rgba32float"),static_assert:new L("static_assert",k.keyword,"static_assert")},v.tokens={decimal_float_literal:new L("decimal_float_literal",k.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new L("hex_float_literal",k.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new L("int_literal",k.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new L("uint_literal",k.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new L("name",k.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new L("ident",k.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new L("and",k.token,"&"),and_and:new L("and_and",k.token,"&&"),arrow:new L("arrow ",k.token,"->"),attr:new L("attr",k.token,"@"),forward_slash:new L("forward_slash",k.token,"/"),bang:new L("bang",k.token,"!"),bracket_left:new L("bracket_left",k.token,"["),bracket_right:new L("bracket_right",k.token,"]"),brace_left:new L("brace_left",k.token,"{"),brace_right:new L("brace_right",k.token,"}"),colon:new L("colon",k.token,":"),comma:new L("comma",k.token,","),equal:new L("equal",k.token,"="),equal_equal:new L("equal_equal",k.token,"=="),not_equal:new L("not_equal",k.token,"!="),greater_than:new L("greater_than",k.token,">"),greater_than_equal:new L("greater_than_equal",k.token,">="),shift_right:new L("shift_right",k.token,">>"),less_than:new L("less_than",k.token,"<"),less_than_equal:new L("less_than_equal",k.token,"<="),shift_left:new L("shift_left",k.token,"<<"),modulo:new L("modulo",k.token,"%"),minus:new L("minus",k.token,"-"),minus_minus:new L("minus_minus",k.token,"--"),period:new L("period",k.token,"."),plus:new L("plus",k.token,"+"),plus_plus:new L("plus_plus",k.token,"++"),or:new L("or",k.token,"|"),or_or:new L("or_or",k.token,"||"),paren_left:new L("paren_left",k.token,"("),paren_right:new L("paren_right",k.token,")"),semicolon:new L("semicolon",k.token,";"),star:new L("star",k.token,"*"),tilde:new L("tilde",k.token,"~"),underscore:new L("underscore",k.token,"_"),xor:new L("xor",k.token,"^"),plus_equal:new L("plus_equal",k.token,"+="),minus_equal:new L("minus_equal",k.token,"-="),times_equal:new L("times_equal",k.token,"*="),division_equal:new L("division_equal",k.token,"/="),modulo_equal:new L("modulo_equal",k.token,"%="),and_equal:new L("and_equal",k.token,"&="),or_equal:new L("or_equal",k.token,"|="),xor_equal:new L("xor_equal",k.token,"^="),shift_right_equal:new L("shift_right_equal",k.token,">>="),shift_left_equal:new L("shift_left_equal",k.token,"<<=")},v.simpleTokens={"@":N.tokens.attr,"{":N.tokens.brace_left,"}":N.tokens.brace_right,":":N.tokens.colon,",":N.tokens.comma,"(":N.tokens.paren_left,")":N.tokens.paren_right,";":N.tokens.semicolon},v.literalTokens={"&":N.tokens.and,"&&":N.tokens.and_and,"->":N.tokens.arrow,"/":N.tokens.forward_slash,"!":N.tokens.bang,"[":N.tokens.bracket_left,"]":N.tokens.bracket_right,"=":N.tokens.equal,"==":N.tokens.equal_equal,"!=":N.tokens.not_equal,">":N.tokens.greater_than,">=":N.tokens.greater_than_equal,">>":N.tokens.shift_right,"<":N.tokens.less_than,"<=":N.tokens.less_than_equal,"<<":N.tokens.shift_left,"%":N.tokens.modulo,"-":N.tokens.minus,"--":N.tokens.minus_minus,".":N.tokens.period,"+":N.tokens.plus,"++":N.tokens.plus_plus,"|":N.tokens.or,"||":N.tokens.or_or,"*":N.tokens.star,"~":N.tokens.tilde,_:N.tokens.underscore,"^":N.tokens.xor,"+=":N.tokens.plus_equal,"-=":N.tokens.minus_equal,"*=":N.tokens.times_equal,"/=":N.tokens.division_equal,"%=":N.tokens.modulo_equal,"&=":N.tokens.and_equal,"|=":N.tokens.or_equal,"^=":N.tokens.xor_equal,">>=":N.tokens.shift_right_equal,"<<=":N.tokens.shift_left_equal},v.regexTokens={decimal_float_literal:N.tokens.decimal_float_literal,hex_float_literal:N.tokens.hex_float_literal,int_literal:N.tokens.int_literal,uint_literal:N.tokens.uint_literal,ident:N.tokens.ident},v.storage_class=[N.keywords.function,N.keywords.private,N.keywords.workgroup,N.keywords.uniform,N.keywords.storage],v.access_mode=[N.keywords.read,N.keywords.write,N.keywords.read_write],v.sampler_type=[N.keywords.sampler,N.keywords.sampler_comparison],v.sampled_texture_type=[N.keywords.texture_1d,N.keywords.texture_2d,N.keywords.texture_2d_array,N.keywords.texture_3d,N.keywords.texture_cube,N.keywords.texture_cube_array],v.multisampled_texture_type=[N.keywords.texture_multisampled_2d],v.storage_texture_type=[N.keywords.texture_storage_1d,N.keywords.texture_storage_2d,N.keywords.texture_storage_2d_array,N.keywords.texture_storage_3d],v.depth_texture_type=[N.keywords.texture_depth_2d,N.keywords.texture_depth_2d_array,N.keywords.texture_depth_cube,N.keywords.texture_depth_cube_array,N.keywords.texture_depth_multisampled_2d],v.texture_external_type=[N.keywords.texture_external],v.any_texture_type=[...N.sampled_texture_type,...N.multisampled_texture_type,...N.storage_texture_type,...N.depth_texture_type,...N.texture_external_type],v.texel_format=[N.keywords.r8unorm,N.keywords.r8snorm,N.keywords.r8uint,N.keywords.r8sint,N.keywords.r16uint,N.keywords.r16sint,N.keywords.r16float,N.keywords.rg8unorm,N.keywords.rg8snorm,N.keywords.rg8uint,N.keywords.rg8sint,N.keywords.r32uint,N.keywords.r32sint,N.keywords.r32float,N.keywords.rg16uint,N.keywords.rg16sint,N.keywords.rg16float,N.keywords.rgba8unorm,N.keywords.rgba8unorm_srgb,N.keywords.rgba8snorm,N.keywords.rgba8uint,N.keywords.rgba8sint,N.keywords.bgra8unorm,N.keywords.bgra8unorm_srgb,N.keywords.rgb10a2unorm,N.keywords.rg11b10float,N.keywords.rg32uint,N.keywords.rg32sint,N.keywords.rg32float,N.keywords.rgba16uint,N.keywords.rgba16sint,N.keywords.rgba16float,N.keywords.rgba32uint,N.keywords.rgba32sint,N.keywords.rgba32float],v.const_literal=[N.tokens.int_literal,N.tokens.uint_literal,N.tokens.decimal_float_literal,N.tokens.hex_float_literal,N.keywords.true,N.keywords.false],v.literal_or_ident=[N.tokens.ident,N.tokens.int_literal,N.tokens.uint_literal,N.tokens.decimal_float_literal,N.tokens.hex_float_literal,N.tokens.name],v.element_count_expression=[N.tokens.int_literal,N.tokens.uint_literal,N.tokens.ident],v.template_types=[N.keywords.vec2,N.keywords.vec3,N.keywords.vec4,N.keywords.mat2x2,N.keywords.mat2x3,N.keywords.mat2x4,N.keywords.mat3x2,N.keywords.mat3x3,N.keywords.mat3x4,N.keywords.mat4x2,N.keywords.mat4x3,N.keywords.mat4x4,N.keywords.atomic,N.keywords.bitcast,...N.any_texture_type],v.attribute_name=[N.tokens.ident,N.keywords.block,N.keywords.diagnostic],v.assignment_operators=[N.tokens.equal,N.tokens.plus_equal,N.tokens.minus_equal,N.tokens.times_equal,N.tokens.division_equal,N.tokens.modulo_equal,N.tokens.and_equal,N.tokens.or_equal,N.tokens.xor_equal,N.tokens.shift_right_equal,N.tokens.shift_left_equal],v.increment_operators=[N.tokens.plus_plus,N.tokens.minus_minus];class gv{constructor(e,t,n,r,o){this.type=e,this.lexeme=t,this.line=n,this.start=r,this.end=o}toString(){return this.lexeme}isTemplateType(){return v.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==v.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class O5{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new gv(v.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let s=1;for(;s>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),s--,s==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),s++)}return!0}}const t=v.simpleTokens[e];if(t)return this._addToken(t),!0;let n=v.none;const r=this._isAlpha(e),o=e==="_";if(this._isAlphaNumeric(e)){let s=this._peekAhead();for(;this._isAlphaNumeric(s);)e+=this._advance(),s=this._peekAhead()}if(r){const s=v.keywords[e];if(s)return this._addToken(s),!0}if(r||o)return this._addToken(v.tokens.ident),!0;for(;;){let s=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(v.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(v.tokens.minus_minus),!0;const l=this._tokens.length-1;if((v.literal_or_ident.indexOf(this._tokens[l].type)!=-1||this._tokens[l].type==v.tokens.paren_right)&&a!=">")return this._addToken(s),!0}if(e==">"&&(a==">"||a=="=")){let l=!1,c=this._tokens.length-1;for(let u=0;u<5&&c>=0&&v.assignment_operators.indexOf(this._tokens[c].type)===-1;++u,--c)if(this._tokens[c].type===v.tokens.less_than){c>0&&this._tokens[c-1].isArrayOrTemplateType()&&(l=!0);break}if(l)return this._addToken(s),!0}if(s===v.none){let l=e,c=0;const u=2;for(let h=0;h<u;++h)if(l+=this._peekAhead(h),s=this._findType(l),s!==v.none){c=h;break}if(s===v.none)return n!==v.none&&(this._current--,this._addToken(n),!0);e=l,this._current+=c+1}if(n=s,this._isAtEnd())break;e+=this._advance()}return n!==v.none&&(this._addToken(n),!0)}_findType(e){for(const t in v.regexTokens){const n=v.regexTokens[t];if(this._match(e,n.rule))return n}return v.literalTokens[e]||v.none}_match(e,t){const n=t.exec(e);return n&&n.index==0&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new gv(e,t,this._line,this._start,this._current))}}function J(i){return Array.isArray(i)||(i==null?void 0:i.buffer)instanceof ArrayBuffer}const Jh=new Float32Array(1),F5=new Uint32Array(Jh.buffer),z5=new Uint32Array(Jh.buffer),ed=new Int32Array(1),U5=new Float32Array(ed.buffer),$5=new Uint32Array(ed.buffer),td=new Uint32Array(1),V5=new Float32Array(td.buffer),H5=new Int32Array(td.buffer);function _v(i,e,t){if(e===t)return i;if(e==="f32"){if(t==="i32"||t==="x32")return Jh[0]=i,F5[0];if(t==="u32")return Jh[0]=i,z5[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return ed[0]=i,U5[0];if(t==="u32")return ed[0]=i,$5[0]}else if(e==="u32"){if(t==="f32")return td[0]=i,V5[0];if(t==="i32"||t==="x32")return td[0]=i,H5[0]}return console.error(`Unsupported cast from ${e} to ${t}`),i}class G5{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class ku{constructor(e,t){this.align=e,this.size=t}}class fr{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new T5,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof yc&&this._functions.set(t.name,new G5(t));for(const t of e)if(t instanceof jr){const n=this.getTypeInfo(t,null);n instanceof Ro&&this.structs.push(n)}for(const t of e)if(t instanceof s_)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof r_){const n=t,r=this._getAttributeNum(n.attributes,"id",0),o=n.type!=null?this.getTypeInfo(n.type,n.attributes):null;this.overrides.push(new S5(n.name,o,n.attributes,r));continue}if(this._isUniformVar(t)){const n=t,r=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),s=this.getTypeInfo(n.type,n.attributes),a=new Iu(n.name,s,r,o,n.attributes,To.Uniform,n.access);a.access||(a.access="read"),this.uniforms.push(a);continue}if(this._isStorageVar(t)){const n=t,r=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),s=this.getTypeInfo(n.type,n.attributes),a=this._isStorageTexture(s),l=new Iu(n.name,s,r,o,n.attributes,a?To.StorageTexture:To.Storage,n.access);l.access||(l.access="read"),this.storage.push(l);continue}if(this._isTextureVar(t)){const n=t,r=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),s=this.getTypeInfo(n.type,n.attributes),a=this._isStorageTexture(s),l=new Iu(n.name,s,r,o,n.attributes,a?To.StorageTexture:To.Texture,n.access);l.access||(l.access="read"),a?this.storage.push(l):this.textures.push(l);continue}if(this._isSamplerVar(t)){const n=t,r=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),s=this.getTypeInfo(n.type,n.attributes),a=new Iu(n.name,s,r,o,n.attributes,To.Sampler,n.access);this.samplers.push(a);continue}}for(const t of e)if(t instanceof yc){const n=this._getAttribute(t,"vertex"),r=this._getAttribute(t,"fragment"),o=this._getAttribute(t,"compute"),s=n||r||o,a=new C5(t.name,s==null?void 0:s.name,t.attributes);a.attributes=t.attributes,a.startLine=t.startLine,a.endLine=t.endLine,this.functions.push(a),this._functions.get(t.name).info=a,s&&(this._functions.get(t.name).inUse=!0,a.inUse=!0,a.resources=this._findResources(t,!!s),a.inputs=this._getInputs(t.args),a.outputs=this._getOutputs(t.returnType),this.entry[s.name].push(a)),a.arguments=t.args.map(l=>new E5(l.name,this.getTypeInfo(l.type,l.attributes),l.attributes)),a.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(n=>{var r,o,s;if(n instanceof Vw){if(n.value)if(J(n.value))for(const a of n.value)for(const l of this.overrides)a===l.name&&((r=t.info)===null||r===void 0||r.overrides.push(l));else for(const a of this.overrides)n.value===a.name&&((o=t.info)===null||o===void 0||o.overrides.push(a))}else if(n instanceof nn)for(const a of this.overrides)n.name===a.name&&((s=t.info)===null||s===void 0||s.overrides.push(a))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getFunctionInfo(e){for(const t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var n;for(const r of e.calls){const o=(n=this._functions.get(r.name))===null||n===void 0?void 0:n.info;o&&t.add(o)}}findResource(e,t,n){if(n){for(const r of this.entry.compute)if(r.name===n){for(const o of r.resources)if(o.group==e&&o.binding==t)return o}for(const r of this.entry.vertex)if(r.name===n){for(const o of r.resources)if(o.group==e&&o.binding==t)return o}for(const r of this.entry.fragment)if(r.name===n){for(const o of r.resources)if(o.group==e&&o.binding==t)return o}}for(const r of this.uniforms)if(r.group==e&&r.binding==t)return r;for(const r of this.storage)if(r.group==e&&r.binding==t)return r;for(const r of this.textures)if(r.group==e&&r.binding==t)return r;for(const r of this.samplers)if(r.group==e&&r.binding==t)return r;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const n=[],r=this,o=[];return e.search(s=>{if(s instanceof Zh)o.push({});else if(s instanceof Qh)o.pop();else if(s instanceof Xr){const a=s;t&&a.type!==null&&this._markStructsFromAST(a.type),o.length>0&&(o[o.length-1][a.name]=a)}else if(s instanceof lr){const a=s;t&&a.type!==null&&this._markStructsFromAST(a.type)}else if(s instanceof oc){const a=s;t&&a.type!==null&&this._markStructsFromAST(a.type),o.length>0&&(o[o.length-1][a.name]=a)}else if(s instanceof nn){const a=s;if(o.length>0&&o[o.length-1][a.name])return;const l=r._findResource(a.name);l&&n.push(l)}else if(s instanceof a_){const a=s,l=r._functions.get(a.name);l&&(t&&(l.inUse=!0),e.calls.add(l.node),l.resources===null&&(l.resources=r._findResources(l.node,t)),n.push(...l.resources))}else if(s instanceof o_){const a=s,l=r._functions.get(a.name);l&&(t&&(l.inUse=!0),e.calls.add(l.node),l.resources===null&&(l.resources=r._findResources(l.node,t)),n.push(...l.resources))}}),[...new Map(n.map(s=>[s.name,s])).values()]}getBindGroups(){const e=[];function t(n,r){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),r>=e[n].length&&(e[n].length=r+1)}for(const n of this.uniforms)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)t(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof jr)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);n!==null&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof jr)this._getStructOutputs(n.type,t);else{const r=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(r!==null){const o=this.getTypeInfo(n.type,n.type.attributes),s=this._parseInt(r.value),a=new hv(n.name,o,r.name,s);t.push(a)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const n=this.getTypeInfo(e,e.attributes),r=this._parseInt(t.value);return new hv("",n,t.name,r)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const n of e)if(n.type instanceof jr)this._getStructInputs(n.type,t);else{const r=this._getInputInfo(n);r!==null&&t.push(r)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof jr)this._getStructInputs(n.type,t);else{const r=this._getInputInfo(n);r!==null&&t.push(r)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const n=this._getAttribute(e,"interpolation"),r=this.getTypeInfo(e.type,e.attributes),o=this._parseInt(t.value),s=new w5(e.name,r,t.name,o);return n!==null&&(s.interpolation=this._parseString(n.value)),s}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new x5(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof fh){const r=e.type?this.getTypeInfo(e.type,e.attributes):null,o=new ym(e.name,r,t);return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof sc){const r=e,o=r.format?this.getTypeInfo(r.format,r.attributes):null,s=new Do(r.name,t);return s.format=o,s.count=r.count,this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof jr){const r=e,o=new Ro(r.name,t);o.startLine=r.startLine,o.endLine=r.endLine;for(const s of r.members){const a=this.getTypeInfo(s.type,s.attributes);o.members.push(new uv(s.name,a,s.attributes))}return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Hl){const r=e,o=r.format instanceof $,s=r.format?o?this.getTypeInfo(r.format,null):new En(r.format,null):null,a=new ds(r.name,s,t,r.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof D){const r=e,o=r.format?this.getTypeInfo(r.format,null):null,s=new ds(r.name,o,t,r.access);return this._types.set(e,s),this._updateTypeInfo(s),s}const n=new En(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n,r;const o=this._getTypeSize(e);if(e.size=(t=o==null?void 0:o.size)!==null&&t!==void 0?t:0,e instanceof Do&&e.format){const s=this._getTypeSize(e.format);e.stride=Math.max((n=s==null?void 0:s.size)!==null&&n!==void 0?n:0,(r=s==null?void 0:s.align)!==null&&r!==void 0?r:0),this._updateTypeInfo(e.format)}e instanceof ym&&this._updateTypeInfo(e.format),e instanceof Ro&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,r=0,o=0,s=0;for(let a=0,l=e.members.length;a<l;++a){const c=e.members[a],u=this._getTypeSize(c);if(!u)continue;(t=this._getAlias(c.type.name))!==null&&t!==void 0||c.type;const h=u.align,d=u.size;n=this._roundUp(h,n+r),r=d,o=n,s=Math.max(s,h),c.offset=n,c.size=d,this._updateTypeInfo(c.type)}e.size=this._roundUp(s,o+r),e.align=s}_getTypeSize(e){var t,n;if(e==null)return null;const r=this._getAttributeNum(e.attributes,"size",0),o=this._getAttributeNum(e.attributes,"align",0);if(e instanceof uv&&(e=e.type),e instanceof En){const s=this._getAlias(e.name);s!==null&&(e=s)}{const s=fr._typeInfo[e.name];if(s!==void 0){const a=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new ku(Math.max(o,s.align/a),Math.max(r,s.size/a))}}{const s=fr._typeInfo[e.name.substring(0,e.name.length-1)];if(s){const a=e.name[e.name.length-1]==="h"?2:1;return new ku(Math.max(o,s.align/a),Math.max(r,s.size/a))}}if(e instanceof Do){let s=e,a=8,l=8;const c=this._getTypeSize(s.format);return c!==null&&(l=c.size,a=c.align),l=s.count*this._getAttributeNum((n=e==null?void 0:e.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(a,l)),r&&(l=r),new ku(Math.max(o,a),Math.max(r,l))}if(e instanceof Ro){let s=0,a=0,l=0,c=0,u=0;for(const h of e.members){const d=this._getTypeSize(h.type);d!==null&&(s=Math.max(d.align,s),l=this._roundUp(d.align,l+c),c=d.size,u=l)}return a=this._roundUp(s,u+c),new ku(Math.max(o,s),Math.max(r,a))}return null}_isUniformVar(e){return e instanceof Xr&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Xr&&e.storage=="storage"}_isTextureVar(e){return e instanceof Xr&&e.type!==null&&fr._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Xr&&e.type!==null&&fr._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const r=n.attributes;for(let o of r)if(o.name==t)return o;return null}_getAttributeNum(e,t,n){if(e===null)return n;for(let r of e)if(r.name==t){let o=r!==null&&r.value!==null?r.value:n;return o instanceof Array&&(o=o[0]),typeof o=="number"?o:typeof o=="string"?parseInt(o):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}}fr._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},fr._textureTypes=v.any_texture_type.map(i=>i.name),fr._samplerTypes=v.sampler_type.map(i=>i.name);let l_=0;class c_{constructor(e,t,n){this.id=l_++,this.name=e,this.value=t,this.node=n}clone(){return new c_(this.name,this.value,this.node)}}class u_{constructor(e){this.id=l_++,this.name=e.name,this.node=e}clone(){return new u_(this.node)}}class h_{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=l_++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,n){this.variables.set(e,new c_(e,t,n??null))}setVariable(e,t,n){const r=this.getVariable(e);r!==null?r.value=t:this.createVariable(e,t,n)}getVariableValue(e){var t;const n=this.getVariable(e);return(t=n==null?void 0:n.value)!==null&&t!==void 0?t:null}clone(){return new h_(this)}}class W5{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class j5{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const n=this.exec.evalExpression(e.args[0],t);let r=!0;if(n instanceof w)return n.data.forEach(o=>{o||(r=!1)}),new P(r?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w){const r=n.data.some(o=>o);return new P(r?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const n=this.exec.evalExpression(e.args[2],t);if(!(n instanceof P))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return n.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let n=e.args[0];n instanceof Vt&&(n=n.right);const r=this.exec.evalExpression(n,t);if(r instanceof Nt&&r.typeInfo.size===0){const o=r.typeInfo,s=r.buffer.byteLength/o.stride;return new P(s,this.getTypeInfo("u32"))}return new P(r.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.abs(o)),n.typeInfo);const r=n;return new P(Math.abs(r.value),r.typeInfo)}Acos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.acos(o)),n.typeInfo);const r=n;return new P(Math.acos(r.value),n.typeInfo)}Acosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.acosh(o)),n.typeInfo);const r=n;return new P(Math.acosh(r.value),n.typeInfo)}Asin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.asin(o)),n.typeInfo);const r=n;return new P(Math.asin(r.value),n.typeInfo)}Asinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.asinh(o)),n.typeInfo);const r=n;return new P(Math.asinh(r.value),n.typeInfo)}Atan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.atan(o)),n.typeInfo);const r=n;return new P(Math.atan(r.value),n.typeInfo)}Atanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.atanh(o)),n.typeInfo);const r=n;return new P(Math.atanh(r.value),n.typeInfo)}Atan2(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof w&&r instanceof w)return new w(n.data.map((a,l)=>Math.atan2(a,r.data[l])),n.typeInfo);const o=n,s=r;return new P(Math.atan2(o.value,s.value),n.typeInfo)}Ceil(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.ceil(o)),n.typeInfo);const r=n;return new P(Math.ceil(r.value),n.typeInfo)}_clamp(e,t,n){return Math.min(Math.max(e,t),n)}Clamp(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(n instanceof w&&r instanceof w&&o instanceof w)return new w(n.data.map((c,u)=>this._clamp(c,r.data[u],o.data[u])),n.typeInfo);const s=n,a=r,l=o;return new P(this._clamp(s.value,a.value,l.value),n.typeInfo)}Cos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.cos(o)),n.typeInfo);const r=n;return new P(Math.cos(r.value),n.typeInfo)}Cosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.cosh(o)),n.typeInfo);const r=n;return new P(Math.cos(r.value),n.typeInfo)}CountLeadingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.clz32(o)),n.typeInfo);const r=n;return new P(Math.clz32(r.value),n.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>this._countOneBits(o)),n.typeInfo);const r=n;return new P(this._countOneBits(r.value),n.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>this._countTrailingZeros(o)),n.typeInfo);const r=n;return new P(this._countTrailingZeros(r.value),n.typeInfo)}Cross(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof w&&r instanceof w){if(n.data.length!==3||r.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const o=n.data,s=r.data;return new w([o[1]*s[2]-s[1]*o[2],o[2]*s[0]-s[2]*o[0],o[0]*s[1]-s[0]*o[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const n=this.exec.evalExpression(e.args[0],t),r=180/Math.PI;return n instanceof w?new w(n.data.map(o=>o*r),n.typeInfo):new P(n.value*r,this.getTypeInfo("f32"))}Determinant(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ae){const r=n.data,o=n.typeInfo.getTypeName(),s=o.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(o==="mat2x2"||o==="mat2x2f"||o==="mat2x2h")return new P(r[0]*r[3]-r[1]*r[2],s);if(o==="mat2x3"||o==="mat2x3f"||o==="mat2x3h")return new P(r[0]*(r[4]*r[8]-r[5]*r[7])-r[1]*(r[3]*r[8]-r[5]*r[6])+r[2]*(r[3]*r[7]-r[4]*r[6]),s);if(o==="mat2x4"||o==="mat2x4f"||o==="mat2x4h")console.error(`TODO: Determinant for ${o}`);else if(o==="mat3x2"||o==="mat3x2f"||o==="mat3x2h")console.error(`TODO: Determinant for ${o}`);else{if(o==="mat3x3"||o==="mat3x3f"||o==="mat3x3h")return new P(r[0]*(r[4]*r[8]-r[5]*r[7])-r[1]*(r[3]*r[8]-r[5]*r[6])+r[2]*(r[3]*r[7]-r[4]*r[6]),s);o==="mat3x4"||o==="mat3x4f"||o==="mat3x4h"||o==="mat4x2"||o==="mat4x2f"||o==="mat4x2h"||o==="mat4x3"||o==="mat4x3f"||o==="mat4x3h"?console.error(`TODO: Determinant for ${o}`):o!=="mat4x4"&&o!=="mat4x4f"&&o!=="mat4x4h"||console.error(`TODO: Determinant for ${o}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof w&&r instanceof w){let a=0;for(let l=0;l<n.data.length;++l)a+=(n.data[l]-r.data[l])*(n.data[l]-r.data[l]);return new P(Math.sqrt(a),this.getTypeInfo("f32"))}const o=n,s=r;return new P(Math.abs(o.value-s.value),n.typeInfo)}_dot(e,t){let n=0;for(let r=0;r<e.length;++r)n+=t[r]*e[r];return n}Dot(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);return n instanceof w&&r instanceof w?new P(this._dot(n.data,r.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.exp(o)),n.typeInfo);const r=n;return new P(Math.exp(r.value),n.typeInfo)}Exp2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.pow(2,o)),n.typeInfo);const r=n;return new P(Math.pow(2,r.value),n.typeInfo)}ExtractBits(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(r.typeInfo.name!=="u32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const s=r.value,a=o.value;if(n instanceof w)return new w(n.data.map(c=>c>>s&(1<<a)-1),n.typeInfo);if(n.typeInfo.name!=="i32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const l=n.value;return new P(l>>s&(1<<a)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(n instanceof w&&r instanceof w&&o instanceof w){const s=this._dot(r.data,o.data);return new w(s<0?Array.from(n.data):n.data.map(a=>-a),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>this._firstLeadingBit(o)),n.typeInfo);const r=n;return new P(this._firstLeadingBit(r.value),n.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>this._firstTrailingBit(o)),n.typeInfo);const r=n;return new P(this._firstTrailingBit(r.value),n.typeInfo)}Floor(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.floor(o)),n.typeInfo);const r=n;return new P(Math.floor(r.value),n.typeInfo)}Fma(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(n instanceof w&&r instanceof w&&o instanceof w)return n.data.length!==r.data.length||n.data.length!==o.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new w(n.data.map((c,u)=>c*r.data[u]+o.data[u]),n.typeInfo);const s=n,a=r,l=o;return new P(s.value*a.value+l.value,s.typeInfo)}Fract(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>o-Math.floor(o)),n.typeInfo);const r=n;return new P(r.value-Math.floor(r.value),n.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t),s=this.exec.evalExpression(e.args[3],t);if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const a=o.value,l=(1<<s.value)-1<<a,c=~l;if(n instanceof w&&r instanceof w)return new w(n.data.map((d,f)=>d&c|r.data[f]<<a&l),n.typeInfo);const u=n.value,h=r.value;return new P(u&c|h<<a&l,n.typeInfo)}InverseSqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>1/Math.sqrt(o)),n.typeInfo);const r=n;return new P(1/Math.sqrt(r.value),n.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w){let o=0;return n.data.forEach(s=>{o+=s*s}),new P(Math.sqrt(o),this.getTypeInfo("f32"))}const r=n;return new P(Math.abs(r.value),n.typeInfo)}Log(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.log(o)),n.typeInfo);const r=n;return new P(Math.log(r.value),n.typeInfo)}Log2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.log2(o)),n.typeInfo);const r=n;return new P(Math.log2(r.value),n.typeInfo)}Max(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof w&&r instanceof w)return new w(n.data.map((a,l)=>Math.max(a,r.data[l])),n.typeInfo);const o=n,s=r;return new P(Math.max(o.value,s.value),n.typeInfo)}Min(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof w&&r instanceof w)return new w(n.data.map((a,l)=>Math.min(a,r.data[l])),n.typeInfo);const o=n,s=r;return new P(Math.min(o.value,s.value),n.typeInfo)}Mix(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(n instanceof w&&r instanceof w&&o instanceof w)return new w(n.data.map((l,c)=>n.data[c]*(1-o.data[c])+r.data[c]*o.data[c]),n.typeInfo);const s=r,a=o;return new P(n.value*(1-a.value)+s.value*a.value,n.typeInfo)}Modf(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof w&&r instanceof w)return new w(n.data.map((s,a)=>s%r.data[a]),n.typeInfo);const o=r;return new P(n.value%o.value,n.typeInfo)}Normalize(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w){const r=this.Length(e,t).value;return new w(n.data.map(o=>o/r),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof w&&r instanceof w)return new w(n.data.map((a,l)=>Math.pow(a,r.data[l])),n.typeInfo);const o=n,s=r;return new P(Math.pow(o.value,s.value),n.typeInfo)}QuantizeToF16(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof w?new w(n.data.map(r=>r),n.typeInfo):new P(n.value,n.typeInfo)}Radians(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof w?new w(n.data.map(r=>r*Math.PI/180),n.typeInfo):new P(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof w&&r instanceof w){const o=this._dot(n.data,r.data);return new w(n.data.map((s,a)=>s-2*o*r.data[a]),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(n instanceof w&&r instanceof w&&o instanceof P){const s=this._dot(r.data,n.data);return new w(n.data.map((a,l)=>{const c=1-o.value*o.value*(1-s*s);if(c<0)return 0;const u=Math.sqrt(c);return o.value*a-(o.value*s+u)*r.data[l]}),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.round(o)),n.typeInfo);const r=n;return new P(Math.round(r.value),n.typeInfo)}Saturate(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.min(Math.max(o,0),1)),n.typeInfo);const r=n;return new P(Math.min(Math.max(r.value,0),1),n.typeInfo)}Sign(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.sign(o)),n.typeInfo);const r=n;return new P(Math.sign(r.value),n.typeInfo)}Sin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.sin(o)),n.typeInfo);const r=n;return new P(Math.sin(r.value),n.typeInfo)}Sinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.sinh(o)),n.typeInfo);const r=n;return new P(Math.sinh(r.value),n.typeInfo)}_smoothstep(e,t,n){const r=Math.min(Math.max((n-e)/(t-e),0),1);return r*r*(3-2*r)}SmoothStep(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(o instanceof w&&n instanceof w&&r instanceof w)return new w(o.data.map((c,u)=>this._smoothstep(n.data[u],r.data[u],c)),o.typeInfo);const s=n,a=r,l=o;return new P(this._smoothstep(s.value,a.value,l.value),o.typeInfo)}Sqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.sqrt(o)),n.typeInfo);const r=n;return new P(Math.sqrt(r.value),n.typeInfo)}Step(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(r instanceof w&&n instanceof w)return new w(r.data.map((s,a)=>s<n.data[a]?0:1),r.typeInfo);const o=n;return new P(r.value<o.value?0:1,o.typeInfo)}Tan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.tan(o)),n.typeInfo);const r=n;return new P(Math.tan(r.value),n.typeInfo)}Tanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.tanh(o)),n.typeInfo);const r=n;return new P(Math.tanh(r.value),n.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const n=this.exec.evalExpression(e.args[0],t);if(!(n instanceof Ae))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const r=this._getTransposeType(n.typeInfo);if(n.typeInfo.name==="mat2x2"||n.typeInfo.name==="mat2x2f"||n.typeInfo.name==="mat2x2h"){const o=n.data;return new Ae([o[0],o[2],o[1],o[3]],r)}if(n.typeInfo.name==="mat2x3"||n.typeInfo.name==="mat2x3f"||n.typeInfo.name==="mat2x3h"){const o=n.data;return new Ae([o[0],o[3],o[6],o[1],o[4],o[7]],r)}if(n.typeInfo.name==="mat2x4"||n.typeInfo.name==="mat2x4f"||n.typeInfo.name==="mat2x4h"){const o=n.data;return new Ae([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13]],r)}if(n.typeInfo.name==="mat3x2"||n.typeInfo.name==="mat3x2f"||n.typeInfo.name==="mat3x2h"){const o=n.data;return new Ae([o[0],o[3],o[1],o[4],o[2],o[5]],r)}if(n.typeInfo.name==="mat3x3"||n.typeInfo.name==="mat3x3f"||n.typeInfo.name==="mat3x3h"){const o=n.data;return new Ae([o[0],o[3],o[6],o[1],o[4],o[7],o[2],o[5],o[8]],r)}if(n.typeInfo.name==="mat3x4"||n.typeInfo.name==="mat3x4f"||n.typeInfo.name==="mat3x4h"){const o=n.data;return new Ae([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14]],r)}if(n.typeInfo.name==="mat4x2"||n.typeInfo.name==="mat4x2f"||n.typeInfo.name==="mat4x2h"){const o=n.data;return new Ae([o[0],o[4],o[1],o[5],o[2],o[6]],r)}if(n.typeInfo.name==="mat4x3"||n.typeInfo.name==="mat4x3f"||n.typeInfo.name==="mat4x3h"){const o=n.data;return new Ae([o[0],o[4],o[8],o[1],o[5],o[9],o[2],o[6],o[10]],r)}if(n.typeInfo.name==="mat4x4"||n.typeInfo.name==="mat4x4f"||n.typeInfo.name==="mat4x4h"){const o=n.data;return new Ae([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14],o[3],o[7],o[11],o[15]],r)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof w)return new w(n.data.map(o=>Math.trunc(o)),n.typeInfo);const r=n;return new P(Math.trunc(r.value),n.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const n=e.args[0],r=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(n instanceof nn){const o=n.name,s=t.getVariableValue(o);if(s instanceof Yr){if(r<0||r>=s.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const a=s.getMipLevelSize(r),l=s.dimension;return l==="1d"?new P(a[0],this.getTypeInfo("u32")):l==="3d"?new w(a,this.getTypeInfo("vec3u")):l==="2d"?new w(a.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${l} not found. Line ${e.line}`),null)}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const n=e.args[0],r=this.exec.evalExpression(e.args[1],t),o=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(r instanceof w)||r.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(n instanceof nn){const s=n.name,a=t.getVariableValue(s);if(a instanceof Yr){const l=Math.floor(r.data[0]),c=Math.floor(r.data[1]);if(l<0||l>=a.width||c<0||c>=a.height)return console.error(`Texture ${s} out of bounds. Line ${e.line}`),null;const u=a.getPixel(l,c,0,o);return u===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new w(u,this.getTypeInfo("vec4f"))}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const n=e.args[0];if(n instanceof nn){const r=n.name,o=t.getVariableValue(r);return o instanceof Yr?new P(o.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const n=e.args[0];if(n instanceof nn){const r=n.name,o=t.getVariableValue(r);return o instanceof Yr?new P(o.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const n=e.args[0];if(n instanceof nn){const r=n.name,o=t.getVariableValue(r);return o instanceof Yr?new P(o.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const n=e.args[0],r=this.exec.evalExpression(e.args[1],t),o=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,s=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(s.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(r instanceof w)||r.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(n instanceof nn){const a=n.name,l=t.getVariableValue(a);if(l instanceof Yr){const c=l.getMipLevelSize(0),u=Math.floor(r.data[0]),h=Math.floor(r.data[1]);return u<0||u>=c[0]||h<0||h>=c[1]?(console.error(`Texture ${a} out of bounds. Line ${e.line}`),null):(l.setPixel(u,h,0,o,Array.from(s)),null)}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let n=e.args[0];n instanceof Vt&&(n=n.right);const r=this.exec.getVariableName(n,t);return t.getVariable(r).value.getSubData(this.exec,n.postfix,t)}AtomicStore(e,t){let n=e.args[0];n instanceof Vt&&(n=n.right);const r=this.exec.getVariableName(n,t),o=t.getVariable(r);let s=e.args[1];const a=this.exec.evalExpression(s,t),l=o.value.getSubData(this.exec,n.postfix,t);return l instanceof P&&a instanceof P&&(l.value=a.value),o.value instanceof Nt&&o.value.setDataValue(this.exec,l,n.postfix,t),null}AtomicAdd(e,t){let n=e.args[0];n instanceof Vt&&(n=n.right);const r=this.exec.getVariableName(n,t),o=t.getVariable(r);let s=e.args[1];const a=this.exec.evalExpression(s,t),l=o.value.getSubData(this.exec,n.postfix,t),c=new P(l.value,l.typeInfo);return l instanceof P&&a instanceof P&&(l.value+=a.value),o.value instanceof Nt&&o.value.setDataValue(this.exec,l,n.postfix,t),c}AtomicSub(e,t){let n=e.args[0];n instanceof Vt&&(n=n.right);const r=this.exec.getVariableName(n,t),o=t.getVariable(r);let s=e.args[1];const a=this.exec.evalExpression(s,t),l=o.value.getSubData(this.exec,n.postfix,t),c=new P(l.value,l.typeInfo);return l instanceof P&&a instanceof P&&(l.value-=a.value),o.value instanceof Nt&&o.value.setDataValue(this.exec,l,n.postfix,t),c}AtomicMax(e,t){let n=e.args[0];n instanceof Vt&&(n=n.right);const r=this.exec.getVariableName(n,t),o=t.getVariable(r);let s=e.args[1];const a=this.exec.evalExpression(s,t),l=o.value.getSubData(this.exec,n.postfix,t),c=new P(l.value,l.typeInfo);return l instanceof P&&a instanceof P&&(l.value=Math.max(l.value,a.value)),o.value instanceof Nt&&o.value.setDataValue(this.exec,l,n.postfix,t),c}AtomicMin(e,t){let n=e.args[0];n instanceof Vt&&(n=n.right);const r=this.exec.getVariableName(n,t),o=t.getVariable(r);let s=e.args[1];const a=this.exec.evalExpression(s,t),l=o.value.getSubData(this.exec,n.postfix,t),c=new P(l.value,l.typeInfo);return l instanceof P&&a instanceof P&&(l.value=Math.min(l.value,a.value)),o.value instanceof Nt&&o.value.setDataValue(this.exec,l,n.postfix,t),c}AtomicAnd(e,t){let n=e.args[0];n instanceof Vt&&(n=n.right);const r=this.exec.getVariableName(n,t),o=t.getVariable(r);let s=e.args[1];const a=this.exec.evalExpression(s,t),l=o.value.getSubData(this.exec,n.postfix,t),c=new P(l.value,l.typeInfo);return l instanceof P&&a instanceof P&&(l.value=l.value&a.value),o.value instanceof Nt&&o.value.setDataValue(this.exec,l,n.postfix,t),c}AtomicOr(e,t){let n=e.args[0];n instanceof Vt&&(n=n.right);const r=this.exec.getVariableName(n,t),o=t.getVariable(r);let s=e.args[1];const a=this.exec.evalExpression(s,t),l=o.value.getSubData(this.exec,n.postfix,t),c=new P(l.value,l.typeInfo);return l instanceof P&&a instanceof P&&(l.value=l.value|a.value),o.value instanceof Nt&&o.value.setDataValue(this.exec,l,n.postfix,t),c}AtomicXor(e,t){let n=e.args[0];n instanceof Vt&&(n=n.right);const r=this.exec.getVariableName(n,t),o=t.getVariable(r);let s=e.args[1];const a=this.exec.evalExpression(s,t),l=o.value.getSubData(this.exec,n.postfix,t),c=new P(l.value,l.typeInfo);return l instanceof P&&a instanceof P&&(l.value=l.value^a.value),o.value instanceof Nt&&o.value.setDataValue(this.exec,l,n.postfix,t),c}AtomicExchange(e,t){let n=e.args[0];n instanceof Vt&&(n=n.right);const r=this.exec.getVariableName(n,t),o=t.getVariable(r);let s=e.args[1];const a=this.exec.evalExpression(s,t),l=o.value.getSubData(this.exec,n.postfix,t),c=new P(l.value,l.typeInfo);return l instanceof P&&a instanceof P&&(l.value=a.value),o.value instanceof Nt&&o.value.setDataValue(this.exec,l,n.postfix,t),c}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const op={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Si={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class pi extends W5{constructor(e,t){var n;super(),this.ast=e??[],this.reflection=new fr,this.reflection.updateAST(this.ast),this.context=(n=t==null?void 0:t.clone())!==null&&n!==void 0?n:new h_,this.builtins=new j5(this),this.typeInfo={bool:this.getTypeInfo($.bool),i32:this.getTypeInfo($.i32),u32:this.getTypeInfo($.u32),f32:this.getTypeInfo($.f32),f16:this.getTypeInfo($.f16),vec2f:this.getTypeInfo(D.vec2f),vec2u:this.getTypeInfo(D.vec2u),vec2i:this.getTypeInfo(D.vec2i),vec2h:this.getTypeInfo(D.vec2h),vec3f:this.getTypeInfo(D.vec3f),vec3u:this.getTypeInfo(D.vec3u),vec3i:this.getTypeInfo(D.vec3i),vec3h:this.getTypeInfo(D.vec3h),vec4f:this.getTypeInfo(D.vec4f),vec4u:this.getTypeInfo(D.vec4u),vec4i:this.getTypeInfo(D.vec4i),vec4h:this.getTypeInfo(D.vec4h),mat2x2f:this.getTypeInfo(D.mat2x2f),mat2x3f:this.getTypeInfo(D.mat2x3f),mat2x4f:this.getTypeInfo(D.mat2x4f),mat3x2f:this.getTypeInfo(D.mat3x2f),mat3x3f:this.getTypeInfo(D.mat3x3f),mat3x4f:this.getTypeInfo(D.mat3x4f),mat4x2f:this.getTypeInfo(D.mat4x2f),mat4x3f:this.getTypeInfo(D.mat4x3f),mat4x4f:this.getTypeInfo(D.mat4x4f)}}getVariableValue(e){var t,n;const r=(n=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&n!==void 0?n:null;if(r===null)return null;if(r instanceof P)return r.value;if(r instanceof w||r instanceof Ae)return Array.from(r.data);if(r instanceof Nt&&r.typeInfo instanceof Do){if(r.typeInfo.format.name==="u32")return Array.from(new Uint32Array(r.buffer,r.offset,r.typeInfo.count));if(r.typeInfo.format.name==="i32")return Array.from(new Int32Array(r.buffer,r.offset,r.typeInfo.count));if(r.typeInfo.format.name==="f32")return Array.from(new Float32Array(r.buffer,r.offset,r.typeInfo.count))}return console.error(`Unsupported return variable type ${r.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,n,r){const o=this.context.clone();(r=r??{}).constants&&this._setOverrides(r.constants,o),this._execStatements(this.ast,o);const s=o.getFunction(e);if(!s)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const a=t[0],l=t[1],c=t[2],u=this.getTypeInfo("vec3u");o.setVariable("@num_workgroups",new w(t,u));const h=this.reflection.getFunctionInfo(e);h===null&&console.error(`Function ${e} not found in reflection data`);for(const d in n)for(const f in n[d]){const p=n[d][f];o.variables.forEach(b=>{var g;const _=b.node;if(_!=null&&_.attributes){let T=null,E=null;for(const y of _.attributes)y.name==="binding"?T=y.value:y.name==="group"&&(E=y.value);if(f==T&&d==E){let y=!1;for(const C of h.resources)if(C.name===b.name&&C.group===parseInt(d)&&C.binding===parseInt(f)){y=!0;break}if(y)if(p.texture!==void 0&&p.descriptor!==void 0){const C=new Yr(p.texture,this.getTypeInfo(_.type),p.descriptor,(g=p.texture.view)!==null&&g!==void 0?g:null);b.value=C}else p.uniform!==void 0?b.value=new Nt(p.uniform,this.getTypeInfo(_.type)):b.value=new Nt(p,this.getTypeInfo(_.type))}}})}for(let d=0;d<c;++d)for(let f=0;f<l;++f)for(let p=0;p<a;++p)o.setVariable("@workgroup_id",new w([p,f,d],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(s,[p,f,d],o)}execStatement(e,t){if(e instanceof Pw)return this.evalExpression(e.value,t);if(e instanceof Mw){if(e.condition){const n=this.evalExpression(e.condition,t);if(!(n instanceof P))throw new Error("Invalid break-if condition");if(!n.value)return null}return pi._breakObj}if(e instanceof Nw)return pi._continueObj;if(e instanceof oc)this._let(e,t);else if(e instanceof Xr)this._var(e,t);else if(e instanceof hh)this._const(e,t);else if(e instanceof yc)this._function(e,t);else{if(e instanceof Rw)return this._if(e,t);if(e instanceof Lw)return this._switch(e,t);if(e instanceof Tw)return this._for(e,t);if(e instanceof Cw)return this._while(e,t);if(e instanceof kw)return this._loop(e,t);if(e instanceof bm){const n=t.clone();return n.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof Iw)this._assign(e,t);else if(e instanceof Aw)this._increment(e,t);else{if(e instanceof jr)return null;if(e instanceof r_){const n=e.name;t.getVariable(n)===null&&t.setVariable(n,new P(0,this.getTypeInfo("u32")))}else if(e instanceof o_)this._call(e,t);else{if(e instanceof Dw||e instanceof s_)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Bn?this._evalBinaryOp(e,t):e instanceof jt?this._evalLiteral(e,t):e instanceof nn?this._evalVariable(e,t):e instanceof a_?this._evalCall(e,t):e instanceof lr?this._evalCreate(e,t):e instanceof Bw?this._evalConst(e,t):e instanceof Ow?this._evalBitcast(e,t):e instanceof Vt?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof $){const r=this.reflection.getTypeInfo(e);if(r!==null)return r}let n=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return n!==null||(n=this.reflection.getTypeInfoByName(e)),n}_setOverrides(e,t){for(const n in e){const r=e[n],o=this.reflection.getOverrideInfo(n);o!==null?(o.type===null&&(o.type=this.getTypeInfo("u32")),o.type.name==="u32"||o.type.name==="i32"||o.type.name==="f32"||o.type.name==="f16"?t.setVariable(n,new P(r,o.type)):o.type.name==="bool"?t.setVariable(n,new P(r?1:0,o.type)):o.type.name==="vec2"||o.type.name==="vec3"||o.type.name==="vec4"||o.type.name==="vec2f"||o.type.name==="vec3f"||o.type.name==="vec4f"||o.type.name==="vec2i"||o.type.name==="vec3i"||o.type.name==="vec4i"||o.type.name==="vec2u"||o.type.name==="vec3u"||o.type.name==="vec4u"||o.type.name==="vec2h"||o.type.name==="vec3h"||o.type.name==="vec4h"?t.setVariable(n,new w(r,o.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,n){const r=[1,1,1];for(const u of e.node.attributes)if(u.name==="workgroup_size"){if(u.value.length>0){const h=n.getVariableValue(u.value[0]);r[0]=h instanceof P?h.value:parseInt(u.value[0])}if(u.value.length>1){const h=n.getVariableValue(u.value[1]);r[1]=h instanceof P?h.value:parseInt(u.value[1])}if(u.value.length>2){const h=n.getVariableValue(u.value[2]);r[2]=h instanceof P?h.value:parseInt(u.value[2])}}const o=this.getTypeInfo("vec3u"),s=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new w(r,o));const a=r[0],l=r[1],c=r[2];for(let u=0,h=0;u<c;++u)for(let d=0;d<l;++d)for(let f=0;f<a;++f,++h){const p=[f,d,u],b=[f+t[0]*r[0],d+t[1]*r[1],u+t[2]*r[2]];n.setVariable("@local_invocation_id",new w(p,o)),n.setVariable("@global_invocation_id",new w(b,o)),n.setVariable("@local_invocation_index",new P(h,s)),this._dispatchExec(e,n)}}_dispatchExec(e,t){for(const n of e.node.args)for(const r of n.attributes)if(r.name==="builtin"){const o=`@${r.value}`,s=t.getVariable(o);s!==void 0&&t.variables.set(n.name,s)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof Vt;)e=e.right;return e instanceof nn?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const n of e){if(n instanceof Array){const o=t.clone(),s=this._execStatements(n,o);if(s)return s;continue}const r=this.execStatement(n,t);if(r)return r}return null}_call(e,t){const n=t.clone();n.currentFunctionName=e.name;const r=t.getFunction(e.name);if(r){for(let o=0;o<r.node.args.length;++o){const s=r.node.args[o],a=this.evalExpression(e.args[o],n);n.setVariable(s.name,a,s)}this._execStatements(r.node.body,n)}else e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const n=this.getVariableName(e.variable,t),r=t.getVariable(n);r?e.operator==="++"?r.value instanceof P?r.value.value++:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):e.operator==="--"?r.value instanceof P?r.value.value--:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${n} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof nn){const n=this.getVariableName(e,t),r=t.getVariable(n);return r===null?(console.error(`Variable ${n} not found. Line ${e.line}`),null):r.value.getSubData(this,e.postfix,t)}if(e instanceof Vt){if(e.operator==="*"){const n=this._getVariableData(e.right,t);return n instanceof zs?n.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const n=this._getVariableData(e.right,t);return new zs(n)}}return null}_assign(e,t){let n=null,r="<var>",o=null;if(e.variable instanceof Vt){const l=this._getVariableData(e.variable,t),c=this.evalExpression(e.value,t),u=e.operator;if(u==="="){if(l instanceof P||l instanceof w||l instanceof Ae){if(c instanceof P||c instanceof w||c instanceof Ae&&l.data.length===c.data.length)return void l.data.set(c.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(l instanceof Nt&&c instanceof Nt&&l.buffer.byteLength-l.offset>=c.buffer.byteLength-c.offset)return void(l.buffer.byteLength%4==0?new Uint32Array(l.buffer,l.offset,l.typeInfo.size/4).set(new Uint32Array(c.buffer,c.offset,c.typeInfo.size/4)):new Uint8Array(l.buffer,l.offset,l.typeInfo.size).set(new Uint8Array(c.buffer,c.offset,c.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(u==="+=")return l instanceof P||l instanceof w||l instanceof Ae?c instanceof P||c instanceof w||c instanceof Ae?void l.data.set(c.data.map((h,d)=>l.data[d]+h)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(u==="-=")return(l instanceof P||l instanceof w||l instanceof Ae)&&(c instanceof P||c instanceof w||c instanceof Ae)?void l.data.set(c.data.map((h,d)=>l.data[d]-h)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof Vt){if(e.variable.operator==="*"){r=this.getVariableName(e.variable.right,t);const l=t.getVariable(r);if(!(l&&l.value instanceof zs))return void console.error(`Variable ${r} is not a pointer. Line ${e.line}`);n=l.value.reference;let c=e.variable.postfix;if(!c){let u=e.variable.right;for(;u instanceof Vt;){if(u.postfix){c=u.postfix;break}u=u.right}}c&&(n=n.getSubData(this,c,t))}}else{o=e.variable.postfix,r=this.getVariableName(e.variable,t);const l=t.getVariable(r);if(l===null)return void console.error(`Variable ${r} not found. Line ${e.line}`);n=l.value}if(n instanceof zs&&(n=n.reference),n===null)return void console.error(`Variable ${r} not found. Line ${e.line}`);const s=this.evalExpression(e.value,t),a=e.operator;if(a!=="="){const l=n.getSubData(this,o,t);if(l instanceof w&&s instanceof P){const c=l.data,u=s.value;if(a==="+=")for(let h=0;h<c.length;++h)c[h]+=u;else if(a==="-=")for(let h=0;h<c.length;++h)c[h]-=u;else if(a==="*=")for(let h=0;h<c.length;++h)c[h]*=u;else if(a==="/=")for(let h=0;h<c.length;++h)c[h]/=u;else if(a==="%=")for(let h=0;h<c.length;++h)c[h]%=u;else if(a==="&=")for(let h=0;h<c.length;++h)c[h]&=u;else if(a==="|=")for(let h=0;h<c.length;++h)c[h]|=u;else if(a==="^=")for(let h=0;h<c.length;++h)c[h]^=u;else if(a==="<<=")for(let h=0;h<c.length;++h)c[h]<<=u;else if(a===">>=")for(let h=0;h<c.length;++h)c[h]>>=u;else console.error(`Invalid operator ${a}. Line ${e.line}`)}else if(l instanceof w&&s instanceof w){const c=l.data,u=s.data;if(c.length!==u.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(a==="+=")for(let h=0;h<c.length;++h)c[h]+=u[h];else if(a==="-=")for(let h=0;h<c.length;++h)c[h]-=u[h];else if(a==="*=")for(let h=0;h<c.length;++h)c[h]*=u[h];else if(a==="/=")for(let h=0;h<c.length;++h)c[h]/=u[h];else if(a==="%=")for(let h=0;h<c.length;++h)c[h]%=u[h];else if(a==="&=")for(let h=0;h<c.length;++h)c[h]&=u[h];else if(a==="|=")for(let h=0;h<c.length;++h)c[h]|=u[h];else if(a==="^=")for(let h=0;h<c.length;++h)c[h]^=u[h];else if(a==="<<=")for(let h=0;h<c.length;++h)c[h]<<=u[h];else if(a===">>=")for(let h=0;h<c.length;++h)c[h]>>=u[h];else console.error(`Invalid operator ${a}. Line ${e.line}`)}else{if(!(l instanceof P&&s instanceof P))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);a==="+="?l.value+=s.value:a==="-="?l.value-=s.value:a==="*="?l.value*=s.value:a==="/="?l.value/=s.value:a==="%="?l.value%=s.value:a==="&="?l.value&=s.value:a==="|="?l.value|=s.value:a==="^="?l.value^=s.value:a==="<<="?l.value<<=s.value:a===">>="?l.value>>=s.value:console.error(`Invalid operator ${a}. Line ${e.line}`)}return void(n instanceof Nt&&n.setDataValue(this,l,o,t))}if(n instanceof Nt)n.setDataValue(this,s,o,t);else if(o){if(!(n instanceof w||n instanceof Ae))return void console.error(`Variable ${r} is not a vector or matrix. Line ${e.line}`);if(o instanceof Ia){const l=this.evalExpression(o.index,t).value;if(n instanceof w){if(!(s instanceof P))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[l]=s.value}else{if(!(n instanceof Ae))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);{const c=this.evalExpression(o.index,t).value;if(c<0)return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);if(!(s instanceof w))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);{const u=n.typeInfo.getTypeName();if(u==="mat2x2"||u==="mat2x2f"||u==="mat2x2h"){if(!(c<2&&s.data.length===2))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[2*c]=s.data[0],n.data[2*c+1]=s.data[1]}else if(u==="mat2x3"||u==="mat2x3f"||u==="mat2x3h"){if(!(c<2&&s.data.length===3))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[3*c]=s.data[0],n.data[3*c+1]=s.data[1],n.data[3*c+2]=s.data[2]}else if(u==="mat2x4"||u==="mat2x4f"||u==="mat2x4h"){if(!(c<2&&s.data.length===4))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[4*c]=s.data[0],n.data[4*c+1]=s.data[1],n.data[4*c+2]=s.data[2],n.data[4*c+3]=s.data[3]}else if(u==="mat3x2"||u==="mat3x2f"||u==="mat3x2h"){if(!(c<3&&s.data.length===2))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[2*c]=s.data[0],n.data[2*c+1]=s.data[1]}else if(u==="mat3x3"||u==="mat3x3f"||u==="mat3x3h"){if(!(c<3&&s.data.length===3))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[3*c]=s.data[0],n.data[3*c+1]=s.data[1],n.data[3*c+2]=s.data[2]}else if(u==="mat3x4"||u==="mat3x4f"||u==="mat3x4h"){if(!(c<3&&s.data.length===4))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[4*c]=s.data[0],n.data[4*c+1]=s.data[1],n.data[4*c+2]=s.data[2],n.data[4*c+3]=s.data[3]}else if(u==="mat4x2"||u==="mat4x2f"||u==="mat4x2h"){if(!(c<4&&s.data.length===2))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[2*c]=s.data[0],n.data[2*c+1]=s.data[1]}else if(u==="mat4x3"||u==="mat4x3f"||u==="mat4x3h"){if(!(c<4&&s.data.length===3))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[3*c]=s.data[0],n.data[3*c+1]=s.data[1],n.data[3*c+2]=s.data[2]}else{if(u!=="mat4x4"&&u!=="mat4x4f"&&u!=="mat4x4h")return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);if(!(c<4&&s.data.length===4))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[4*c]=s.data[0],n.data[4*c+1]=s.data[1],n.data[4*c+2]=s.data[2],n.data[4*c+3]=s.data[3]}}}}}else if(o instanceof fs){const l=o.value;if(!(n instanceof w))return void console.error(`Invalid assignment to ${l}. Variable ${r} is not a vector. Line ${e.line}`);if(s instanceof P){if(l.length>1)return void console.error(`Invalid assignment to ${l} for variable ${r}. Line ${e.line}`);if(l==="x")n.data[0]=s.value;else if(l==="y"){if(n.data.length<2)return void console.error(`Invalid assignment to ${l} for variable ${r}. Line ${e.line}`);n.data[1]=s.value}else if(l==="z"){if(n.data.length<3)return void console.error(`Invalid assignment to ${l} for variable ${r}. Line ${e.line}`);n.data[2]=s.value}else if(l==="w"){if(n.data.length<4)return void console.error(`Invalid assignment to ${l} for variable ${r}. Line ${e.line}`);n.data[3]=s.value}}else{if(!(s instanceof w))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);if(l.length!==s.data.length)return void console.error(`Invalid assignment to ${l} for variable ${r}. Line ${e.line}`);for(let c=0;c<l.length;++c){const u=l[c];if(u==="x"||u==="r")n.data[0]=s.data[c];else if(u==="y"||u==="g"){if(s.data.length<2)return void console.error(`Invalid assignment to ${u} for variable ${r}. Line ${e.line}`);n.data[1]=s.data[c]}else if(u==="z"||u==="b"){if(s.data.length<3)return void console.error(`Invalid assignment to ${u} for variable ${r}. Line ${e.line}`);n.data[2]=s.data[c]}else{if(u!=="w"&&u!=="a")return void console.error(`Invalid assignment to ${u} for variable ${r}. Line ${e.line}`);if(s.data.length<4)return void console.error(`Invalid assignment to ${u} for variable ${r}. Line ${e.line}`);n.data[3]=s.data[c]}}}}}else n instanceof P&&s instanceof P?n.value=s.value:n instanceof w&&s instanceof w||n instanceof Ae&&s instanceof Ae?n.data.set(s.data):console.error(`Invalid assignment to ${r}. Line ${e.line}`)}_function(e,t){const n=new u_(e);t.functions.set(e.name,n)}_const(e,t){let n=null;e.value!==null&&(n=this.evalExpression(e.value,t)),t.createVariable(e.name,n,e)}_let(e,t){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,t),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Vt||(n=n.clone())}else{const r=e.type.name;if(r==="f32"||r==="i32"||r==="u32"||r==="bool"||r==="f16"||r==="vec2"||r==="vec3"||r==="vec4"||r==="vec2f"||r==="vec3f"||r==="vec4f"||r==="vec2i"||r==="vec3i"||r==="vec4i"||r==="vec2u"||r==="vec3u"||r==="vec4u"||r==="vec2h"||r==="vec3h"||r==="vec4h"||r==="vec2b"||r==="vec3b"||r==="vec4b"||r==="mat2x2"||r==="mat2x3"||r==="mat2x4"||r==="mat3x2"||r==="mat3x3"||r==="mat3x4"||r==="mat4x2"||r==="mat4x3"||r==="mat4x4"||r==="mat2x2f"||r==="mat2x3f"||r==="mat2x4f"||r==="mat3x2f"||r==="mat3x3f"||r==="mat3x4f"||r==="mat4x2f"||r==="mat4x3f"||r==="mat4x4f"||r==="mat2x2h"||r==="mat2x3h"||r==="mat2x4h"||r==="mat3x2h"||r==="mat3x3h"||r==="mat3x4h"||r==="mat4x2h"||r==="mat4x3h"||r==="mat4x4h"||r==="array"){const o=new lr(e.type,[]);n=this._evalCreate(o,t)}}t.createVariable(e.name,n,e)}_var(e,t){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,t),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Vt||(n=n.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const r=e.type.name;if(r==="f32"||r==="i32"||r==="u32"||r==="bool"||r==="f16"||r==="vec2"||r==="vec3"||r==="vec4"||r==="vec2f"||r==="vec3f"||r==="vec4f"||r==="vec2i"||r==="vec3i"||r==="vec4i"||r==="vec2u"||r==="vec3u"||r==="vec4u"||r==="vec2h"||r==="vec3h"||r==="vec4h"||r==="vec2b"||r==="vec3b"||r==="vec4b"||r==="mat2x2"||r==="mat2x3"||r==="mat2x4"||r==="mat3x2"||r==="mat3x3"||r==="mat3x4"||r==="mat4x2"||r==="mat4x3"||r==="mat4x4"||r==="mat2x2f"||r==="mat2x3f"||r==="mat2x4f"||r==="mat3x2f"||r==="mat3x3f"||r==="mat3x4f"||r==="mat4x2f"||r==="mat4x3f"||r==="mat4x4f"||r==="mat2x2h"||r==="mat2x3h"||r==="mat2x4h"||r==="mat3x2h"||r==="mat3x3h"||r==="mat3x4h"||r==="mat4x2h"||r==="mat4x3h"||r==="mat4x4h"||e.type instanceof sc||e.type instanceof jr||e.type instanceof D){const o=new lr(e.type,[]);n=this._evalCreate(o,t)}}t.createVariable(e.name,n,e)}_switch(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof P))return console.error(`Invalid if condition. Line ${e.line}`),null;let r=null;for(const o of e.cases)if(o instanceof Uw)for(const s of o.selectors){if(s instanceof ph){r=o;continue}const a=this.evalExpression(s,t);if(!(a instanceof P))return console.error(`Invalid case selector. Line ${e.line}`),null;if(a.value===n.value)return this._execStatements(o.body,t)}else o instanceof $w&&(r=o);return r?this._execStatements(r.body,t):null}_if(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof P))return console.error(`Invalid if condition. Line ${e.line}`),null;if(n.value)return this._execStatements(e.body,t);for(const r of e.elseif){const o=this.evalExpression(r.condition,t);if(!(o instanceof P))return console.error(`Invalid if condition. Line ${e.line}`),null;if(o.value)return this._execStatements(r.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof P?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===pi._breakObj)break;if(n!==null&&n!==pi._continueObj)return n;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const n=this._execStatements(e.body,t);if(n===pi._breakObj)break;if(n===pi._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===pi._breakObj)break}else if(n!==null)return n}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===pi._breakObj)break;if(n!==pi._continueObj&&n!==null)return n}return null}_evalBitcast(e,t){const n=this.evalExpression(e.value,t),r=e.type;if(n instanceof P){const o=_v(n.value,n.typeInfo.name,r.name);return new P(o,this.getTypeInfo(r))}if(n instanceof w){const o=n.typeInfo.getTypeName();let s="";if(o.endsWith("f"))s="f32";else if(o.endsWith("i"))s="i32";else if(o.endsWith("u"))s="u32";else if(o.endsWith("b"))s="bool";else{if(!o.endsWith("h"))return console.error(`Unknown vector type ${o}. Line ${e.line}`),null;s="f16"}const a=r.getTypeName();let l="";if(a.endsWith("f"))l="f32";else if(a.endsWith("i"))l="i32";else if(a.endsWith("u"))l="u32";else if(a.endsWith("b"))l="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${l}. Line ${e.line}`),null;l="f16"}const c=(function(u,h,d){if(h===d)return u;const f=new Array(u.length);for(let p=0;p<u.length;p++)f[p]=_v(u[p],h,d);return f})(Array.from(n.data),s,l);return new w(c,this.getTypeInfo(r))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var n;if(e instanceof lr){if(e.type===null)return vm.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const r=e instanceof lr?e.type.name:e.name,o=e instanceof lr?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(o===null)return console.error(`Unknown type ${r}. Line ${e.line}`),null;if(o.size===0)return null;const s=new Nt(new ArrayBuffer(o.size),o,0);if(o instanceof Ro){if(e.args)for(let a=0;a<e.args.length;++a){const l=o.members[a],c=e.args[a],u=this.evalExpression(c,t);s.setData(this,u,l.type,l.offset,t)}}else if(o instanceof Do){let a=0;if(e.args)for(let l=0;l<e.args.length;++l){const c=e.args[l],u=this.evalExpression(c,t);o.format===null&&(((n=u.typeInfo)===null||n===void 0?void 0:n.name)==="x32"?o.format=this.getTypeInfo("i32"):o.format=u.typeInfo),s.setData(this,u,o.format,a,t),a+=o.stride}}else console.error(`Unknown type "${r}". Line ${e.line}`);return e instanceof lr?s.getSubData(this,e.postfix,t):s}_evalLiteral(e,t){const n=this.getTypeInfo(e.type),r=n.name;return r==="x32"||r==="u32"||r==="f32"||r==="f16"||r==="i32"||r==="bool"?new P(e.scalarValue,n):r==="vec2"||r==="vec3"||r==="vec4"||r==="vec2f"||r==="vec3f"||r==="vec4f"||r==="vec2h"||r==="vec3h"||r==="vec4h"||r==="vec2i"||r==="vec3i"||r==="vec4i"||r==="vec2u"||r==="vec3u"||r==="vec4u"?this._callConstructorVec(e,t):r==="mat2x2"||r==="mat2x3"||r==="mat2x4"||r==="mat3x2"||r==="mat3x3"||r==="mat3x4"||r==="mat4x2"||r==="mat4x3"||r==="mat4x4"||r==="mat2x2f"||r==="mat2x3f"||r==="mat2x4f"||r==="mat3x2f"||r==="mat3x3f"||r==="mat3x4f"||r==="mat4x2f"||r==="mat4x3f"||r==="mat4x4f"||r==="mat2x2h"||r==="mat2x3h"||r==="mat2x4h"||r==="mat3x2h"||r==="mat3x3h"||r==="mat3x4h"||r==="mat4x2h"||r==="mat4x3h"||r==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const n=t.getVariableValue(e.name);return n===null?n:n.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let n=1;n<e.length;++n){const r=pi._priority.get(t.name);pi._priority.get(e[n].name)<r&&(t=e[n])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const n=this.evalExpression(e.right,t);if(e.operator==="&")return new zs(n);if(e.operator==="*")return n instanceof zs?n.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const r=n instanceof P?n.value:n instanceof w?Array.from(n.data):null;switch(e.operator){case"+":{if(J(r)){const a=r.map((l,c)=>+l);return new w(a,n.typeInfo)}const o=r,s=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new P(+o,s)}case"-":{if(J(r)){const a=r.map((l,c)=>-l);return new w(a,n.typeInfo)}const o=r,s=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new P(-o,s)}case"!":{if(J(r)){const a=r.map((l,c)=>l?0:1);return new w(a,n.typeInfo)}const o=r,s=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new P(o?0:1,s)}case"~":{if(J(r)){const a=r.map((l,c)=>~l);return new w(a,n.typeInfo)}const o=r,s=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new P(~o,s)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const n=this.evalExpression(e.left,t),r=this.evalExpression(e.right,t),o=n instanceof P?n.value:n instanceof w||n instanceof Ae?Array.from(n.data):null,s=r instanceof P?r.value:r instanceof w||r instanceof Ae?Array.from(r.data):null;switch(e.operator){case"+":{if(J(o)&&J(s)){const u=o,h=s;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((f,p)=>f+h[p]);return new w(d,n.typeInfo)}if(J(o)){const u=s,h=o.map((d,f)=>d+u);return new w(h,n.typeInfo)}if(J(s)){const u=o,h=s.map((d,f)=>u+d);return new w(h,r.typeInfo)}const a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new P(a+l,c)}case"-":{if(J(o)&&J(s)){const u=o,h=s;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((f,p)=>f-h[p]);return new w(d,n.typeInfo)}if(J(o)){const u=s,h=o.map((d,f)=>d-u);return new w(h,n.typeInfo)}if(J(s)){const u=o,h=s.map((d,f)=>u-d);return new w(h,r.typeInfo)}const a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new P(a-l,c)}case"*":{if(J(o)&&J(s)){const u=o,h=s;if(n instanceof Ae&&r instanceof Ae){const d=(function(g,_,T,E){if(Si[_.name]===void 0||Si[E.name]===void 0)return null;const y=Si[_.name][0],C=Si[_.name][1],I=Si[E.name][0];if(y!==Si[E.name][1])return null;const F=new Array(I*C);for(let V=0;V<C;V++)for(let q=0;q<I;q++){let Q=0;for(let M=0;M<y;M++)Q+=g[M*C+V]*T[q*y+M];F[V*I+q]=Q}return F})(u,n.typeInfo,h,r.typeInfo);if(d===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const f=Si[r.typeInfo.name][0],p=Si[n.typeInfo.name][1],b=this.getTypeInfo(`mat${f}x${p}f`);return new Ae(d,b)}if(n instanceof Ae&&r instanceof w){const d=(function(f,p,b,g){if(Si[p.name]===void 0||op[g.name]===void 0)return null;const _=Si[p.name][0],T=Si[p.name][1];if(_!==b.length)return null;const E=new Array(T);for(let y=0;y<T;y++){let C=0;for(let I=0;I<_;I++)C+=f[I*T+y]*b[I];E[y]=C}return E})(u,n.typeInfo,h,r.typeInfo);return d===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new w(d,r.typeInfo)}if(n instanceof w&&r instanceof Ae){const d=(function(f,p,b,g){if(op[p.name]===void 0||Si[g.name]===void 0)return null;const _=Si[g.name][0],T=Si[g.name][1];if(T!==f.length)return null;const E=[];for(let y=0;y<_;y++){let C=0;for(let I=0;I<T;I++)C+=f[I]*b[I*_+y];E[y]=C}return E})(u,n.typeInfo,h,r.typeInfo);return d===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new w(d,n.typeInfo)}{if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((f,p)=>f*h[p]);return new w(d,n.typeInfo)}}if(J(o)){const u=s,h=o.map((d,f)=>d*u);return n instanceof Ae?new Ae(h,n.typeInfo):new w(h,n.typeInfo)}if(J(s)){const u=o,h=s.map((d,f)=>u*d);return r instanceof Ae?new Ae(h,r.typeInfo):new w(h,r.typeInfo)}const a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new P(a*l,c)}case"%":{if(J(o)&&J(s)){const u=o,h=s;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((f,p)=>f%h[p]);return new w(d,n.typeInfo)}if(J(o)){const u=s,h=o.map((d,f)=>d%u);return new w(h,n.typeInfo)}if(J(s)){const u=o,h=s.map((d,f)=>u%d);return new w(h,r.typeInfo)}const a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new P(a%l,c)}case"/":{if(J(o)&&J(s)){const u=o,h=s;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((f,p)=>f/h[p]);return new w(d,n.typeInfo)}if(J(o)){const u=s,h=o.map((d,f)=>d/u);return new w(h,n.typeInfo)}if(J(s)){const u=o,h=s.map((d,f)=>u/d);return new w(h,r.typeInfo)}const a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new P(a/l,c)}case"&":{if(J(o)&&J(s)){const u=o,h=s;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((f,p)=>f&h[p]);return new w(d,n.typeInfo)}if(J(o)){const u=s,h=o.map((d,f)=>d&u);return new w(h,n.typeInfo)}if(J(s)){const u=o,h=s.map((d,f)=>u&d);return new w(h,r.typeInfo)}const a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new P(a&l,c)}case"|":{if(J(o)&&J(s)){const u=o,h=s;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((f,p)=>f|h[p]);return new w(d,n.typeInfo)}if(J(o)){const u=s,h=o.map((d,f)=>d|u);return new w(h,n.typeInfo)}if(J(s)){const u=o,h=s.map((d,f)=>u|d);return new w(h,r.typeInfo)}const a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new P(a|l,c)}case"^":{if(J(o)&&J(s)){const u=o,h=s;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((f,p)=>f^h[p]);return new w(d,n.typeInfo)}if(J(o)){const u=s,h=o.map((d,f)=>d^u);return new w(h,n.typeInfo)}if(J(s)){const u=o,h=s.map((d,f)=>u^d);return new w(h,r.typeInfo)}const a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new P(a^l,c)}case"<<":{if(J(o)&&J(s)){const u=o,h=s;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((f,p)=>f<<h[p]);return new w(d,n.typeInfo)}if(J(o)){const u=s,h=o.map((d,f)=>d<<u);return new w(h,n.typeInfo)}if(J(s)){const u=o,h=s.map((d,f)=>u<<d);return new w(h,r.typeInfo)}const a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new P(a<<l,c)}case">>":{if(J(o)&&J(s)){const u=o,h=s;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((f,p)=>f>>h[p]);return new w(d,n.typeInfo)}if(J(o)){const u=s,h=o.map((d,f)=>d>>u);return new w(h,n.typeInfo)}if(J(s)){const u=o,h=s.map((d,f)=>u>>d);return new w(h,r.typeInfo)}const a=o,l=s,c=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new P(a>>l,c)}case">":if(J(o)&&J(s)){const a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=a.map((u,h)=>u>l[h]?1:0);return new w(c,n.typeInfo)}if(J(o)){const a=s,l=o.map((c,u)=>c>a?1:0);return new w(l,n.typeInfo)}if(J(s)){const a=o,l=s.map((c,u)=>a>c?1:0);return new w(l,r.typeInfo)}return new P(o>s?1:0,this.getTypeInfo("bool"));case"<":if(J(o)&&J(s)){const a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=a.map((u,h)=>u<l[h]?1:0);return new w(c,n.typeInfo)}if(J(o)){const a=s,l=o.map((c,u)=>c<a?1:0);return new w(l,n.typeInfo)}if(J(s)){const a=o,l=s.map((c,u)=>a<c?1:0);return new w(l,r.typeInfo)}return new P(o<s?1:0,this.getTypeInfo("bool"));case"==":if(J(o)&&J(s)){const a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=a.map((u,h)=>u===l[h]?1:0);return new w(c,n.typeInfo)}if(J(o)){const a=s,l=o.map((c,u)=>c==a?1:0);return new w(l,n.typeInfo)}if(J(s)){const a=o,l=s.map((c,u)=>a==c?1:0);return new w(l,r.typeInfo)}return new P(o===s?1:0,this.getTypeInfo("bool"));case"!=":if(J(o)&&J(s)){const a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=a.map((u,h)=>u!==l[h]?1:0);return new w(c,n.typeInfo)}if(J(o)){const a=s,l=o.map((c,u)=>c!==a?1:0);return new w(l,n.typeInfo)}if(J(s)){const a=o,l=s.map((c,u)=>a!==c?1:0);return new w(l,r.typeInfo)}return new P(o!==s?1:0,this.getTypeInfo("bool"));case">=":if(J(o)&&J(s)){const a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=a.map((u,h)=>u>=l[h]?1:0);return new w(c,n.typeInfo)}if(J(o)){const a=s,l=o.map((c,u)=>c>=a?1:0);return new w(l,n.typeInfo)}if(J(s)){const a=o,l=s.map((c,u)=>a>=c?1:0);return new w(l,r.typeInfo)}return new P(o>=s?1:0,this.getTypeInfo("bool"));case"<=":if(J(o)&&J(s)){const a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=a.map((u,h)=>u<=l[h]?1:0);return new w(c,n.typeInfo)}if(J(o)){const a=s,l=o.map((c,u)=>c<=a?1:0);return new w(l,n.typeInfo)}if(J(s)){const a=o,l=s.map((c,u)=>a<=c?1:0);return new w(l,r.typeInfo)}return new P(o<=s?1:0,this.getTypeInfo("bool"));case"&&":if(J(o)&&J(s)){const a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=a.map((u,h)=>u&&l[h]?1:0);return new w(c,n.typeInfo)}if(J(o)){const a=s,l=o.map((c,u)=>c&&a?1:0);return new w(l,n.typeInfo)}if(J(s)){const a=o,l=s.map((c,u)=>a&&c?1:0);return new w(l,r.typeInfo)}return new P(o&&s?1:0,this.getTypeInfo("bool"));case"||":if(J(o)&&J(s)){const a=o,l=s;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=a.map((u,h)=>u||l[h]?1:0);return new w(c,n.typeInfo)}if(J(o)){const a=s,l=o.map((c,u)=>c||a?1:0);return new w(l,n.typeInfo)}if(J(s)){const a=o,l=s.map((c,u)=>a||c?1:0);return new w(l,r.typeInfo)}return new P(o||s?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const n=t.clone();n.currentFunctionName=e.name;const r=t.getFunction(e.name);if(!r)return e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let o=0;o<r.node.args.length;++o){const s=r.node.args[o],a=this.evalExpression(e.args[o],n);n.createVariable(s.name,a,s)}return this._execStatements(r.node.body,n)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const n=t.getFunction(e.name);if(n){const r=t.clone();for(let o=0;o<n.node.args.length;++o){const s=n.node.args[o],a=this.evalExpression(e.args[o],r);r.setVariable(s.name,a,s)}return this._execStatements(n.node.body,r)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new P(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],t);return n.typeInfo=this.getTypeInfo(e.type),n.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const n=this.getTypeInfo(e.type),r=e.type.getTypeName(),o=op[r];if(o===void 0)return console.error(`Invalid vec constructor ${r}. Line ${e.line}`),null;const s=[];if(e instanceof jt)if(e.isVector){const a=e.vectorValue;for(const l of a)s.push(l)}else s.push(e.scalarValue);else if(e.args)for(const a of e.args){const l=this.evalExpression(a,t);if(l instanceof w){const c=l.data;for(let u=0;u<c.length;++u){let h=c[u];s.push(h)}}else if(l instanceof P){let c=l.value;s.push(c)}}if(e.type instanceof D&&e.type.format===null&&(e.type.format=D.f32),s.length===0){const a=new Array(o).fill(0);return new w(a,n).getSubData(this,e.postfix,t)}if(s.length===1)for(;s.length<o;)s.push(s[0]);return s.length<o?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new w(s.length>o?s.slice(0,o):s,n).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const n=this.getTypeInfo(e.type),r=e.type.getTypeName(),o=Si[r];if(o===void 0)return console.error(`Invalid matrix constructor ${r}. Line ${e.line}`),null;const s=[];if(e instanceof jt)if(e.isVector){const a=e.vectorValue;for(const l of a)s.push(l)}else s.push(e.scalarValue);else if(e.args)for(const a of e.args){const l=this.evalExpression(a,t);l instanceof w?s.push(...l.data):l instanceof P?s.push(l.value):l instanceof Ae&&s.push(...l.data)}if(n instanceof ds&&n.format===null&&(n.format=this.getTypeInfo("f32")),s.length===0){const a=new Array(o[2]).fill(0);return new Ae(a,n).getSubData(this,e.postfix,t)}return s.length!==o[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Ae(s,n).getSubData(this,e.postfix,t)}}pi._breakObj=new Tn(new En("BREAK",null),null),pi._continueObj=new Tn(new En("CONTINUE",null),null),pi._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Y5{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class q5{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new Y5,this._exec=new pi,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;t.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const r=n.arrayType,o=n.countNode;if(o instanceof nn){const s=o.name,a=this._context.constants.get(s);if(a)try{const l=a.constEvaluate(this._exec);r.count=l}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const n of t)n.search(r=>{r instanceof mv||r instanceof fh?r.type=this._forwardType(r.type):r instanceof sc?r.format=this._forwardType(r.format):r instanceof Xr||r instanceof oc||r instanceof hh?r.type=this._forwardType(r.type):r instanceof yc?r.returnType=this._forwardType(r.returnType):r instanceof pv&&(r.type=this._forwardType(r.type))});return t}_forwardType(e){if(e instanceof fv){const t=this._getType(e.name);if(t)return t}else e instanceof fh?e.type=this._forwardType(e.type):e instanceof sc&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new O5(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==v.eof}_match(e){if(e instanceof L)return!!this._check(e)&&(this._advance(),!0);for(let t=0,n=e.length;t<n;++t){const r=e[t];if(this._check(r))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const n=t.type;let r=!1;for(const o of e){if(n===o)return!0;o===v.tokens.name&&(r=!0)}if(r){const o=v.tokens.name.rule.exec(t.lexeme);if(o&&o.index==0&&o[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===v.tokens.name){const n=v.tokens.name.rule.exec(t.lexeme);return n&&n.index==0&&n[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(v.tokens.semicolon)&&!this._isAtEnd(););if(this._match(v.keywords.alias)){const t=this._type_alias();return this._consume(v.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(v.keywords.diagnostic)){const t=this._diagnostic();return this._consume(v.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(v.keywords.requires)){const t=this._requires_directive();return this._consume(v.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(v.keywords.enable)){const t=this._enable_directive();return this._consume(v.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(v.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(v.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(v.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(v.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(v.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(v.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(v.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(v.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(v.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(v.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(v.keywords.fn))return null;const e=this._currentLine,t=this._consume(v.tokens.ident,"Expected function name.").toString();this._consume(v.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(v.tokens.paren_right))do{if(this._check(v.tokens.paren_right))break;const a=this._attribute(),l=this._consume(v.tokens.name,"Expected argument name.").toString();this._consume(v.tokens.colon,"Expected ':' for argument type.");const c=this._attribute(),u=this._type_decl();u!=null&&(u.attributes=c,n.push(this._updateNode(new pv(l,u,a))))}while(this._match(v.tokens.comma));this._consume(v.tokens.paren_right,"Expected ')' after function arguments.");let r=null;if(this._match(v.tokens.arrow)){const a=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=a)}const o=this._compound_statement(),s=this._currentLine;return this._updateNode(new yc(t,n,r,o,e,s),e)}_compound_statement(){const e=[];for(this._consume(v.tokens.brace_left,"Expected '{' for block.");!this._check(v.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(v.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(v.tokens.semicolon)&&!this._isAtEnd(););if(this._check(v.tokens.attr)&&this._attribute(),this._check(v.keywords.if))return this._if_statement();if(this._check(v.keywords.switch))return this._switch_statement();if(this._check(v.keywords.loop))return this._loop_statement();if(this._check(v.keywords.for))return this._for_statement();if(this._check(v.keywords.while))return this._while_statement();if(this._check(v.keywords.continuing))return this._continuing_statement();if(this._check(v.keywords.static_assert))return this._static_assert_statement();if(this._check(v.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(v.keywords.return))e=this._return_statement();else if(this._check([v.keywords.var,v.keywords.let,v.keywords.const]))e=this._variable_statement();else if(this._match(v.keywords.discard))e=this._updateNode(new M5);else if(this._match(v.keywords.break)){const t=this._updateNode(new Mw);if(this._currentLoop.length>0){const n=this._currentLoop[this._currentLoop.length-1];t.loopId=n.id}e=t,this._check(v.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(v.keywords.continue)){const t=this._updateNode(new Nw);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const n=this._currentLoop[this._currentLoop.length-1];t.loopId=n.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(v.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(v.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new R5(t),e)}_while_statement(){if(!this._match(v.keywords.while))return null;const e=this._updateNode(new Cw(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(v.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(v.keywords.continuing))return null;const t=this._currentLine,n=this._compound_statement();return this._updateNode(new bm(n,e),t)}_for_statement(){if(!this._match(v.keywords.for))return null;this._consume(v.tokens.paren_left,"Expected '('.");const e=this._updateNode(new Tw(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(v.tokens.semicolon)?null:this._for_init(),this._consume(v.tokens.semicolon,"Expected ';'."),e.condition=this._check(v.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(v.tokens.semicolon,"Expected ';'."),e.increment=this._check(v.tokens.paren_right)?null:this._for_increment(),this._consume(v.tokens.paren_right,"Expected ')'."),this._check(v.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(v.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(v.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new Xr(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(v.keywords.let)){const e=this._currentLine,t=this._consume(v.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(v.tokens.colon)){const o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}this._consume(v.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return this._updateNode(new oc(t,n,null,null,r),e)}if(this._match(v.keywords.const)){const e=this._currentLine,t=this._consume(v.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(v.tokens.colon)){const o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}this._consume(v.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return n===null&&r instanceof jt&&(n=r.type),this._updateNode(new hh(t,n,null,null,r),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(v.increment_operators))return this._current=e,null;const n=this._consume(v.increment_operators,"Expected increment operator");return this._updateNode(new Aw(n.type===v.tokens.plus_plus?oa.increment:oa.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(v.tokens.brace_right))return null;let n=this._match(v.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const r=this._consume(v.assignment_operators,"Expected assignment operator."),o=this._short_circuit_or_expression();return this._updateNode(new Iw(Vl.parse(r.lexeme),e,o),t)}_func_call_statement(){if(!this._check(v.tokens.ident))return null;const e=this._currentLine,t=this._current,n=this._consume(v.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=t,null):this._updateNode(new o_(n.lexeme,r),e)}_loop_statement(){if(!this._match(v.keywords.loop))return null;this._check(v.tokens.attr)&&this._attribute(),this._consume(v.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new kw([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let n of t)e.body.push(n);else e.body.push(t);if(t instanceof bm){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(v.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(v.keywords.switch))return null;const e=this._updateNode(new Lw(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(v.tokens.attr)&&this._attribute(),this._consume(v.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(v.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([v.keywords.default,v.keywords.case]);){if(this._match(v.keywords.case)){const n=this._case_selectors();for(const o of n)if(o instanceof ph){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(v.tokens.colon),this._check(v.tokens.attr)&&this._attribute(),this._consume(v.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(v.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new Uw(n,r)))}if(this._match(v.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(v.tokens.colon),this._check(v.tokens.attr)&&this._attribute(),this._consume(v.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(v.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new $w(n)))}}return e}_case_selectors(){const e=[];for(this._match(v.keywords.default)?e.push(this._updateNode(new ph)):e.push(this._shift_expression());this._match(v.tokens.comma);)this._match(v.keywords.default)?e.push(this._updateNode(new ph)):e.push(this._shift_expression());return e}_case_body(){if(this._match(v.keywords.fallthrough))return this._consume(v.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(v.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(v.tokens.attr)&&this._attribute();const n=this._compound_statement();let r=[];this._match_elseif()&&(this._check(v.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let o=null;return this._match(v.keywords.else)&&(this._check(v.tokens.attr)&&this._attribute(),o=this._compound_statement()),this._updateNode(new Rw(t,n,r,o),e)}_match_elseif(){return this._tokens[this._current].type===v.keywords.else&&this._tokens[this._current+1].type===v.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new N5(t,n))),this._match_elseif()&&(this._check(v.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(v.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new Pw(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(v.tokens.or_or);)e=this._updateNode(new Bn(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(v.tokens.and_and);)e=this._updateNode(new Bn(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(v.tokens.or);)e=this._updateNode(new Bn(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(v.tokens.xor);)e=this._updateNode(new Bn(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(v.tokens.and);)e=this._updateNode(new Bn(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([v.tokens.equal_equal,v.tokens.not_equal])?this._updateNode(new Bn(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([v.tokens.less_than,v.tokens.greater_than,v.tokens.less_than_equal,v.tokens.greater_than_equal]);)e=this._updateNode(new Bn(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([v.tokens.shift_left,v.tokens.shift_right]);)e=this._updateNode(new Bn(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([v.tokens.plus,v.tokens.minus]);)e=this._updateNode(new Bn(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([v.tokens.star,v.tokens.forward_slash,v.tokens.modulo]);)e=this._updateNode(new Bn(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([v.tokens.minus,v.tokens.bang,v.tokens.tilde,v.tokens.star,v.tokens.and])?this._updateNode(new Vt(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(v.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(v.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new Ia(e)),n=this._postfix_expression();return n&&(t.postfix=n),t}if(this._match(v.tokens.period)){const e=this._consume(v.tokens.name,"Expected member name."),t=this._postfix_expression(),n=this._updateNode(new fs(e.lexeme));return t&&(n.postfix=t),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return $.void;case"bool":return $.bool;case"i32":return $.i32;case"u32":return $.u32;case"f32":return $.f32;case"f16":return $.f16;case"vec2f":return D.vec2f;case"vec3f":return D.vec3f;case"vec4f":return D.vec4f;case"vec2i":return D.vec2i;case"vec3i":return D.vec3i;case"vec4i":return D.vec4i;case"vec2u":return D.vec2u;case"vec3u":return D.vec3u;case"vec4u":return D.vec4u;case"vec2h":return D.vec2h;case"vec3h":return D.vec3h;case"vec4h":return D.vec4h;case"mat2x2f":return D.mat2x2f;case"mat2x3f":return D.mat2x3f;case"mat2x4f":return D.mat2x4f;case"mat3x2f":return D.mat3x2f;case"mat3x3f":return D.mat3x3f;case"mat3x4f":return D.mat3x4f;case"mat4x2f":return D.mat4x2f;case"mat4x3f":return D.mat4x3f;case"mat4x4f":return D.mat4x4f;case"mat2x2h":return D.mat2x2h;case"mat2x3h":return D.mat2x3h;case"mat2x4h":return D.mat2x4h;case"mat3x2h":return D.mat3x2h;case"mat3x3h":return D.mat3x3h;case"mat3x4h":return D.mat3x4h;case"mat4x2h":return D.mat4x2h;case"mat4x3h":return D.mat4x3h;case"mat4x4h":return D.mat4x4h;case"mat2x2i":return D.mat2x2i;case"mat2x3i":return D.mat2x3i;case"mat2x4i":return D.mat2x4i;case"mat3x2i":return D.mat3x2i;case"mat3x3i":return D.mat3x3i;case"mat3x4i":return D.mat3x4i;case"mat4x2i":return D.mat4x2i;case"mat4x3i":return D.mat4x3i;case"mat4x4i":return D.mat4x4i;case"mat2x2u":return D.mat2x2u;case"mat2x3u":return D.mat2x3u;case"mat2x4u":return D.mat2x4u;case"mat3x2u":return D.mat3x2u;case"mat3x3u":return D.mat3x3u;case"mat3x4u":return D.mat3x4u;case"mat4x2u":return D.mat4x2u;case"mat4x3u":return D.mat4x3u;case"mat4x4u":return D.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(v.tokens.ident)){const n=this._previous().toString();if(this._check(v.tokens.paren_left)){const r=this._argument_expression_list(),o=this._getType(n);return o!==null?this._updateNode(new lr(o,r)):this._updateNode(new a_(n,r))}if(this._context.constants.has(n)){const r=this._context.constants.get(n);return this._updateNode(new Bw(n,r.value))}return this._updateNode(new nn(n))}if(this._match(v.tokens.int_literal)){const n=this._previous().toString();let r=n.endsWith("i")||n.endsWith("i")?$.i32:n.endsWith("u")||n.endsWith("U")?$.u32:$.x32;const o=parseInt(n);return this._validateTypeRange(o,r),this._updateNode(new jt(new P(o,this._exec.getTypeInfo(r)),r))}if(this._match(v.tokens.uint_literal)){const n=parseInt(this._previous().toString());return this._validateTypeRange(n,$.u32),this._updateNode(new jt(new P(n,this._exec.getTypeInfo($.u32)),$.u32))}if(this._match([v.tokens.decimal_float_literal,v.tokens.hex_float_literal])){let n=this._previous().toString(),r=n.endsWith("h");r&&(n=n.substring(0,n.length-1));const o=parseFloat(n);this._validateTypeRange(o,r?$.f16:$.f32);const s=r?$.f16:$.f32;return this._updateNode(new jt(new P(o,this._exec.getTypeInfo(s)),s))}if(this._match([v.keywords.true,v.keywords.false])){let n=this._previous().toString()===v.keywords.true.rule;return this._updateNode(new jt(new P(n?1:0,this._exec.getTypeInfo($.bool)),$.bool))}if(this._check(v.tokens.paren_left))return this._paren_expression();if(this._match(v.keywords.bitcast)){this._consume(v.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(v.tokens.greater_than,"Expected '>'.");const r=this._paren_expression();return this._updateNode(new Ow(n,r))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new lr(e,t))}_argument_expression_list(){if(!this._match(v.tokens.paren_left))return null;const e=[];do{if(this._check(v.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(v.tokens.comma));return this._consume(v.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(v.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(v.tokens.paren_right),e}_paren_expression(){this._consume(v.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(v.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(v.keywords.struct))return null;const e=this._currentLine,t=this._consume(v.tokens.ident,"Expected name for struct.").toString();this._consume(v.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(v.tokens.brace_right);){const s=this._attribute(),a=this._consume(v.tokens.name,"Expected variable name.").toString();this._consume(v.tokens.colon,"Expected ':' for struct member type.");const l=this._attribute(),c=this._type_decl();c!=null&&(c.attributes=l),this._check(v.tokens.brace_right)?this._match(v.tokens.comma):this._consume(v.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new mv(a,c,s)))}this._consume(v.tokens.brace_right,"Expected '}' after struct body.");const r=this._currentLine,o=this._updateNode(new jr(t,n,e,r),e);return this._context.structs.set(t,o),o}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(v.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof jt){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof jt&&(e.type=e.value.type.name==="x32"?$.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(v.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(v.keywords.const))return null;const t=this._consume(v.tokens.name,"Expected variable name"),n=this._currentLine;let r=null;if(this._match(v.tokens.colon)){const l=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=l)}let o=null;this._consume(v.tokens.equal,"const declarations require an assignment");const s=this._short_circuit_or_expression();try{let l=[$.f32],c=s.constEvaluate(this._exec,l);c instanceof P&&this._validateTypeRange(c.value,l[0]),l[0]instanceof D&&l[0].format===null&&c.typeInfo instanceof ds&&c.typeInfo.format!==null&&(c.typeInfo.format.name==="f16"?l[0].format=$.f16:c.typeInfo.format.name==="f32"?l[0].format=$.f32:c.typeInfo.format.name==="i32"?l[0].format=$.i32:c.typeInfo.format.name==="u32"?l[0].format=$.u32:c.typeInfo.format.name==="bool"?l[0].format=$.bool:console.error(`TODO: impelement template format type ${c.typeInfo.format.name}`)),o=this._updateNode(new jt(c,l[0])),this._exec.context.setVariable(t.toString(),c)}catch{o=s}if(r!==null&&o instanceof jt){if(o.type.name!=="x32"&&r.getTypeName()!==o.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${o.type.name} to ${r.name}. Line:${this._currentLine}`);o.type=r,o.isScalar&&this._validateTypeRange(o.scalarValue,o.type)}else r===null&&o instanceof jt&&(r=(e=o==null?void 0:o.type)!==null&&e!==void 0?e:$.f32,r===$.x32&&(r=$.i32));const a=this._updateNode(new hh(t.toString(),r,"","",o),n);return this._context.constants.set(a.name,a),a}_global_let_decl(){if(!this._match(v.keywords.let))return null;const e=this._currentLine,t=this._consume(v.tokens.name,"Expected variable name");let n=null;if(this._match(v.tokens.colon)){const o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}let r=null;if(this._match(v.tokens.equal)&&(r=this._const_expression()),n!==null&&r instanceof jt){if(r.type.name!=="x32"&&n.getTypeName()!==r.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${r.type.name} to ${n.name}. Line:${this._currentLine}`);r.type=n}else n===null&&r instanceof jt&&(n=r.type.name==="x32"?$.i32:r.type);return r instanceof jt&&r.isScalar&&this._validateTypeRange(r.scalarValue,n),this._updateNode(new oc(t.toString(),n,"","",r),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(v.keywords.var))return null;const e=this._currentLine;let t="",n="";this._match(v.tokens.less_than)&&(t=this._consume(v.storage_class,"Expected storage_class.").toString(),this._match(v.tokens.comma)&&(n=this._consume(v.access_mode,"Expected access_mode.").toString()),this._consume(v.tokens.greater_than,"Expected '>'."));const r=this._consume(v.tokens.name,"Expected variable name");let o=null;if(this._match(v.tokens.colon)){const s=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=s)}return this._updateNode(new Xr(r.toString(),o,t,n,null),e)}_override_decl(){if(!this._match(v.keywords.override))return null;const e=this._consume(v.tokens.name,"Expected variable name");let t=null;if(this._match(v.tokens.colon)){const n=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=n)}return this._updateNode(new r_(e.toString(),t,null))}_diagnostic(){this._consume(v.tokens.paren_left,"Expected '('");const e=this._consume(v.tokens.ident,"Expected severity control name.");this._consume(v.tokens.comma,"Expected ','");let t=this._consume(v.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(v.tokens.period)&&(t+=`.${this._consume(v.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(v.tokens.paren_right,"Expected ')'"),this._updateNode(new Dw(e.toString(),t))}_enable_directive(){const e=this._consume(v.tokens.ident,"identity expected.");return this._updateNode(new P5(e.toString()))}_requires_directive(){const e=[this._consume(v.tokens.ident,"identity expected.").toString()];for(;this._match(v.tokens.comma);){const t=this._consume(v.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new D5(e))}_type_alias(){const e=this._consume(v.tokens.ident,"identity expected.");this._consume(v.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=this._updateNode(new s_(e.toString(),t));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([v.tokens.ident,...v.texel_format,v.keywords.bool,v.keywords.f32,v.keywords.i32,v.keywords.u32])){const n=this._advance().toString();if(this._context.structs.has(n))return this._context.structs.get(n);if(this._context.aliases.has(n))return this._context.aliases.get(n).type;if(!this._getType(n)){const r=this._updateNode(new fv(n));return this._forwardTypeCount++,r}return this._updateNode(new $(n))}let e=this._texture_sampler_types();if(e)return e;if(this._check(v.template_types)){let n=this._advance().toString(),r=null,o=null;return this._match(v.tokens.less_than)&&(r=this._type_decl(),o=null,this._match(v.tokens.comma)&&(o=this._consume(v.access_mode,"Expected access_mode for pointer").toString()),this._consume(v.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new D(n,r,o))}if(this._match(v.keywords.ptr)){let n=this._previous().toString();this._consume(v.tokens.less_than,"Expected '<' for pointer.");const r=this._consume(v.storage_class,"Expected storage_class for pointer");this._consume(v.tokens.comma,"Expected ',' for pointer.");const o=this._type_decl();let s=null;return this._match(v.tokens.comma)&&(s=this._consume(v.access_mode,"Expected access_mode for pointer").toString()),this._consume(v.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new fh(n,r.toString(),o,s))}const t=this._attribute();if(this._match(v.keywords.array)){let n=null,r=-1;const o=this._previous();let s=null;if(this._match(v.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let l="";if(this._match(v.tokens.comma)){s=this._shift_expression();try{l=s.constEvaluate(this._exec).toString(),s=null}catch{l="1"}}this._consume(v.tokens.greater_than,"Expected '>' for array."),r=l?parseInt(l):0}const a=this._updateNode(new sc(o.toString(),t,n,r));return s&&this._deferArrayCountEval.push({arrayType:a,countNode:s}),a}return null}_texture_sampler_types(){if(this._match(v.sampler_type))return this._updateNode(new Hl(this._previous().toString(),null,null));if(this._match(v.depth_texture_type))return this._updateNode(new Hl(this._previous().toString(),null,null));if(this._match(v.sampled_texture_type)||this._match(v.multisampled_texture_type)){const e=this._previous();this._consume(v.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(v.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Hl(e.toString(),t,null))}if(this._match(v.storage_texture_type)){const e=this._previous();this._consume(v.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(v.texel_format,"Invalid texel format.").toString();this._consume(v.tokens.comma,"Expected ',' after texel format.");const n=this._consume(v.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(v.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Hl(e.toString(),t,n))}return null}_attribute(){let e=[];for(;this._match(v.tokens.attr);){const t=this._consume(v.attribute_name,"Expected attribute name"),n=this._updateNode(new Vw(t.toString(),null));if(this._match(v.tokens.paren_left)){if(n.value=this._consume(v.literal_or_ident,"Expected attribute value").toString(),this._check(v.tokens.comma)){this._advance();do{const r=this._consume(v.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(r)}while(this._match(v.tokens.comma))}this._consume(v.tokens.paren_right,"Expected ')'")}e.push(n)}return e.length==0?null:e}}class X5 extends fr{constructor(e){super(),e&&this.update(e)}update(e){const t=new q5().parse(e);this.updateAST(t)}}function K5(i){var e;const t={attributes:[],bindings:[]};let n;try{n=Z5(i)}catch(s){return Z.error(s.message)(),t}for(const s of n.uniforms){const a=[];for(const l of((e=s.type)==null?void 0:e.members)||[])a.push({name:l.name,type:yv(l.type)});t.bindings.push({type:"uniform",name:s.name,group:s.group,location:s.binding,members:a})}for(const s of n.textures)t.bindings.push({type:"texture",name:s.name,group:s.group,location:s.binding});for(const s of n.samplers)t.bindings.push({type:"sampler",name:s.name,group:s.group,location:s.binding});const r=n.entry.vertex[0],o=(r==null?void 0:r.inputs.length)||0;for(let s=0;s<o;s++){const a=r.inputs[s];if(a.locationType==="location"){const l=yv(a.type);t.attributes.push({name:a.name,location:Number(a.location),type:l})}}return t}function yv(i){return i!=null&&i.format?`${i.name}<${i.format.name}>`:i.name}function Z5(i){try{return new X5(i)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&e!=null&&e.message&&(t+=`: ${e.message} `),typeof e=="object"&&e!=null&&e.token&&(t+=e.token.line||""),new Error(t,{cause:e})}}const sp={};function sf(i="id"){sp[i]=sp[i]||1;const e=sp[i]++;return`${i}-${e}`}class bv{constructor(e){if(B(this,"id"),B(this,"userData",{}),B(this,"topology"),B(this,"bufferLayout",[]),B(this,"vertexCount"),B(this,"indices"),B(this,"attributes"),this.id=e.id||sf("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&se.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function Q5(i,e){if(e instanceof bv)return e;const t=J5(i,e),{attributes:n,bufferLayout:r}=eP(i,e);return new bv({topology:e.topology||"triangle-list",bufferLayout:r,vertexCount:e.vertexCount,indices:t,attributes:n})}function J5(i,e){if(!e.indices)return;const t=e.indices.value;return i.createBuffer({usage:se.INDEX,data:t})}function eP(i,e){const t=[],n={};for(const[o,s]of Object.entries(e.attributes)){let a=o;switch(o){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}if(s){n[a]=i.createBuffer({data:s.value,id:`${o}-buffer`});const{value:l,size:c,normalized:u}=s;t.push({name:a,format:e4(l,c,u)})}}const r=e._calculateVertexCount(e.attributes,e.indices);return{attributes:n,bufferLayout:t,vertexCount:r}}const Hw=class Gw{constructor(e){B(this,"device"),B(this,"cachingEnabled"),B(this,"destroyPolicy"),B(this,"debug"),B(this,"_hashCounter",0),B(this,"_hashes",{}),B(this,"_renderPipelineCache",{}),B(this,"_computePipelineCache",{}),this.device=e,this.cachingEnabled=e.props._cachePipelines,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=e.props.debugFactories}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Gw(e),e._lumaData.defaultPipelineFactory}get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}createRenderPipeline(e){var t;if(!this.cachingEnabled)return this.device.createRenderPipeline(e);const n={...Yh.defaultProps,...e},r=this._renderPipelineCache,o=this._hashRenderPipeline(n);let s=(t=r[o])==null?void 0:t.pipeline;return s?(r[o].useCount++,this.debug&&Z.log(3,`${this}: ${r[o].pipeline} reused, count=${r[o].useCount}, (id=${e.id})`)()):(s=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:sf("unnamed-cached")}),s.hash=o,r[o]={pipeline:s,useCount:1},this.debug&&Z.log(3,`${this}: ${s} created, count=${r[o].useCount}`)()),s}createComputePipeline(e){var t;if(!this.cachingEnabled)return this.device.createComputePipeline(e);const n={...jb.defaultProps,...e},r=this._computePipelineCache,o=this._hashComputePipeline(n);let s=(t=r[o])==null?void 0:t.pipeline;return s?(r[o].useCount++,this.debug&&Z.log(3,`${this}: ${r[o].pipeline} reused, count=${r[o].useCount}, (id=${e.id})`)()):(s=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0}),s.hash=o,r[o]={pipeline:s,useCount:1},this.debug&&Z.log(3,`${this}: ${s} created, count=${r[o].useCount}`)()),s}release(e){if(!this.cachingEnabled){e.destroy();return}const t=this._getCache(e),n=e.hash;t[n].useCount--,t[n].useCount===0?(this._destroyPipeline(e),this.debug&&Z.log(3,`${this}: ${e} released and destroyed`)()):t[n].useCount<0?(Z.error(`${this}: ${e} released, useCount < 0, resetting`)(),t[n].useCount=0):this.debug&&Z.log(3,`${this}: ${e} released, count=${t[n].useCount}`)()}_destroyPipeline(e){const t=this._getCache(e);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete t[e.hash],e.destroy(),!0}}_getCache(e){let t;if(e instanceof jb&&(t=this._computePipelineCache),e instanceof Yh&&(t=this._renderPipelineCache),!t)throw new Error(`${this}`);if(!t[e.hash])throw new Error(`${this}: ${e} matched incorrect entry`);return t}_hashComputePipeline(e){const{type:t}=this.device,n=this._getHash(e.shader.source);return`${t}/C/${n}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,r="-",o=this._getHash(JSON.stringify(e.bufferLayout)),{type:s}=this.device;switch(s){case"webgl":return`${s}/R/${t}/${n}V${r}BL${o}`;case"webgpu":default:const a=this._getHash(JSON.stringify(e.parameters));return`${s}/R/${t}/${n}V${r}T${e.topology}P${a}BL${o}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};B(Hw,"defaultProps",{...Yh.defaultProps});let tP=Hw;const Ww=class jw{constructor(e){B(this,"device"),B(this,"cachingEnabled"),B(this,"destroyPolicy"),B(this,"debug"),B(this,"_cache",{}),this.device=e,this.cachingEnabled=e.props._cacheShaders,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=!0}static getDefaultShaderFactory(e){var t;return(t=e._lumaData).defaultShaderFactory||(t.defaultShaderFactory=new jw(e)),e._lumaData.defaultShaderFactory}get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}createShader(e){if(!this.cachingEnabled)return this.device.createShader(e);const t=this._hashShader(e);let n=this._cache[t];if(n)n.useCount++,this.debug&&Z.log(3,`${this}: Reusing shader ${n.shader.id} count=${n.useCount}`)();else{const r=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=n={shader:r,useCount:1},this.debug&&Z.log(3,`${this}: Created new shader ${r.id}`)()}return n.shader}release(e){if(!this.cachingEnabled){e.destroy();return}const t=this._hashShader(e),n=this._cache[t];if(n)if(n.useCount--,n.useCount===0)this.destroyPolicy==="unused"&&(delete this._cache[t],n.shader.destroy(),this.debug&&Z.log(3,`${this}: Releasing shader ${e.id}, destroyed`)());else{if(n.useCount<0)throw new Error(`ShaderFactory: Shader ${e.id} released too many times`);this.debug&&Z.log(3,`${this}: Releasing shader ${e.id} count=${n.useCount}`)()}}_hashShader(e){return`${e.stage}:${e.source}`}};B(Ww,"defaultProps",{...A4.defaultProps});let iP=Ww;function nP(i,e){var t;const n={},r="Values";if(i.attributes.length===0&&!((t=i.varyings)!=null&&t.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const o of i.attributes)if(o){const s=`${o.location} ${o.name}: ${o.type}`;n[`in ${s}`]={[r]:o.stepMode||"vertex"}}for(const o of i.varyings||[]){const s=`${o.location} ${o.name}`;n[`out ${s}`]={[r]:JSON.stringify(o)}}return n}let Zt=null,bl=null;function rP(i,{id:e,minimap:t,opaque:n,top:r="0",left:o="0",rgbaScale:s=1}){Zt||(Zt=document.createElement("canvas"),Zt.id=e,Zt.title=e,Zt.style.zIndex="100",Zt.style.position="absolute",Zt.style.top=r,Zt.style.left=o,Zt.style.border="blue 5px solid",Zt.style.transform="scaleY(-1)",document.body.appendChild(Zt),bl=Zt.getContext("2d")),(Zt.width!==i.width||Zt.height!==i.height)&&(Zt.width=i.width/2,Zt.height=i.height/2,Zt.style.width="400px",Zt.style.height="400px");const a=i.device.readPixelsToArrayWebGL(i),l=bl==null?void 0:bl.createImageData(i.width,i.height);if(l){for(let c=0;c<a.length;c+=4)l.data[0+c+0]=a[c+0]*s,l.data[0+c+1]=a[c+1]*s,l.data[0+c+2]=a[c+2]*s,l.data[0+c+3]=n?255:a[c+3]*s;bl==null||bl.putImageData(l,0,0)}}function wm(i,e,t){if(i===e)return!0;if(!t||!i||!e)return!1;if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(!wm(i[n],e[n],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof i=="object"&&typeof e=="object"){const n=Object.keys(i),r=Object.keys(e);if(n.length!==r.length)return!1;for(const o of n)if(!e.hasOwnProperty(o)||!wm(i[o],e[o],t-1))return!1;return!0}return!1}class ap{constructor(e){B(this,"bufferLayouts"),this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){var t;return e.attributes?(t=e.attributes)==null?void 0:t.map(n=>n.attribute):[e.name]}mergeBufferLayouts(e,t){const n=[...e];for(const r of t){const o=n.findIndex(s=>s.name===r.name);o<0?n.push(r):n[o]=r}return n}getBufferIndex(e){const t=this.bufferLayouts.findIndex(n=>n.name===e);return t===-1&&Z.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function oP(i,e){const t=Object.fromEntries(i.attributes.map(r=>[r.name,r.location])),n=e.slice();return n.sort((r,o)=>{const s=r.attributes?r.attributes.map(u=>u.attribute):[r.name],a=o.attributes?o.attributes.map(u=>u.attribute):[o.name],l=Math.min(...s.map(u=>t[u])),c=Math.min(...a.map(u=>t[u]));return l-c}),n}function sP(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function aP(i){return Array.isArray(i)?i.length===0||typeof i[0]=="number":!1}function lP(i){return sP(i)||aP(i)}function cP(i){return lP(i)||typeof i=="number"||typeof i=="boolean"}function uP(i){const e={bindings:{},uniforms:{}};return Object.keys(i).forEach(t=>{const n=i[t];cP(n)?e.uniforms[t]=n:e.bindings[t]=n}),e}class hP{constructor(e,t){B(this,"options",{disableWarnings:!1}),B(this,"modules"),B(this,"moduleUniforms"),B(this,"moduleBindings"),Object.assign(this.options,t);const n=i_(Object.values(e).filter(r=>r.dependencies));for(const r of n)e[r.name]=r;Z.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[r,o]of Object.entries(e))this._addModule(o),o.name&&r!==o.name&&!this.options.disableWarnings&&Z.warn(`Module name: ${r} vs ${o.name}`)()}destroy(){}setProps(e){var t;for(const n of Object.keys(e)){const r=n,o=e[r]||{},s=this.modules[r];if(!s){this.options.disableWarnings||Z.warn(`Module ${n} not found`)();continue}const a=this.moduleUniforms[r],l=this.moduleBindings[r],c=((t=s.getUniforms)==null?void 0:t.call(s,o,a))||o,{uniforms:u,bindings:h}=uP(c);this.moduleUniforms[r]={...a,...u},this.moduleBindings[r]={...l,...h}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var e;const t={};for(const[n,r]of Object.entries(this.moduleUniforms))for(const[o,s]of Object.entries(r))t[`${n}.${o}`]={type:(e=this.modules[n].uniformTypes)==null?void 0:e[o],value:String(s)};return t}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let dP="";async function fP(i,e){const t=new Image;return t.crossOrigin="anonymous",t.src=i.startsWith("http")?i:dP+i,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}const pP=["+X","-X","+Y","-Y","+Z","-Z"],mP=["+X","-X","+Y","-Y","+Z","-Z"],Yw=class qw{constructor(e,t){B(this,"device"),B(this,"id"),B(this,"props"),B(this,"texture"),B(this,"sampler"),B(this,"view"),B(this,"ready"),B(this,"isReady",!1),B(this,"destroyed",!1),B(this,"resolveReady",()=>{}),B(this,"rejectReady",()=>{}),this.device=e;const n=sf("async-texture");this.props={...qw.defaultProps,id:n,...t},this.id=this.props.id,t={...t},typeof(t==null?void 0:t.data)=="string"&&t.dimension==="2d"&&(t.data=fP(t.data)),t.mipmaps&&(t.mipLevels="auto"),this.ready=new Promise((r,o)=>{this.resolveReady=()=>{this.isReady=!0,r()},this.rejectReady=o}),this.initAsync(t)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){const t=e.data,n=await Xw(t).then(void 0,this.rejectReady);if(this.destroyed)return;const r=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(n);if(!r)throw new Error("Texture size could not be determined");const o={...r,...e,data:void 0,mipLevels:1},s=this.device.getMipLevelCount(o.width,o.height);if(o.mipLevels=this.props.mipLevels==="auto"?s:Math.min(s,this.props.mipLevels),this.texture=this.device.createTexture(o),this.sampler=this.texture.sampler,this.view=this.texture.view,e.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,n);break;case"2d":this._setTexture2DData(n);break;case"3d":this._setTexture3DData(this.texture,n);break;case"2d-array":this._setTextureArrayData(this.texture,n);break;case"cube":this._setTextureCubeData(this.texture,n);break;case"cube-array":this._setTextureCubeArrayData(this.texture,n);break}this.props.mipmaps&&this.generateMipmaps(),Z.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(e={}){this.texture.setSampler(e instanceof Jg?e:this.device.createSampler(e))}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}isTextureLevelData(e){const t=e==null?void 0:e.data;return ArrayBuffer.isView(t)}getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return this.getTextureDataSize(e[0]);if(this.device.isExternalImage(e))return this.device.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const t=Object.values(e)[0];return{width:t.width,height:t.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}setTextureData(e){}_setTexture1DData(e,t){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(e,t=0){if(!this.texture)throw new Error("Texture not initialized");const n=this._normalizeTextureData(e);n.length>1&&this.props.mipmaps!==!1&&Z.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let r=0;r<n.length;r++){const o=n[r];this.device.isExternalImage(o)?this.texture.copyExternalImage({image:o,depth:t,mipLevel:r,flipY:!0}):this.texture.copyImageData({data:o.data,mipLevel:r})}}_setTexture3DData(e,t){var n;if(((n=this.texture)==null?void 0:n.props.dimension)!=="3d")throw new Error(this.id);for(let r=0;r<t.length;r++)this._setTexture2DData(t[r],r)}_setTextureCubeData(e,t){var n;if(((n=this.texture)==null?void 0:n.props.dimension)!=="cube")throw new Error(this.id);for(const[r,o]of Object.entries(t)){const s=mP.indexOf(r);this._setTexture2DData(o,s)}}_setTextureArrayData(e,t){var n;if(((n=this.texture)==null?void 0:n.props.dimension)!=="2d-array")throw new Error(this.id);for(let r=0;r<t.length;r++)this._setTexture2DData(t[r],r)}_setTextureCubeArrayData(e,t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(e,t,n,r=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&Z.warn(`${this.id} has mipmap and multiple LODs.`)();const o=pP.indexOf(n);this._setTexture2DData(t,o)}_normalizeTextureData(e){const t=this.texture;let n;return ArrayBuffer.isView(e)?n=[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?n=e:n=[e],n}};B(Yw,"defaultProps",{...Ve.defaultProps,data:null,mipmaps:!1});let lp=Yw;async function Xw(i){if(i=await i,Array.isArray(i))return await Promise.all(i.map(Xw));if(i&&typeof i=="object"&&i.constructor===Object){const e=i,t=await Promise.all(Object.values(e)),n=Object.keys(e),r={};for(let o=0;o<n.length;o++)r[n[o]]=t[o];return r}return i}const Zo=2,gP=1e4,Kw=class Zw{constructor(e,t){B(this,"device"),B(this,"id"),B(this,"source"),B(this,"vs"),B(this,"fs"),B(this,"pipelineFactory"),B(this,"shaderFactory"),B(this,"userData",{}),B(this,"parameters"),B(this,"topology"),B(this,"bufferLayout"),B(this,"isInstanced"),B(this,"instanceCount",0),B(this,"vertexCount"),B(this,"indexBuffer",null),B(this,"bufferAttributes",{}),B(this,"constantAttributes",{}),B(this,"bindings",{}),B(this,"vertexArray"),B(this,"transformFeedback",null),B(this,"pipeline"),B(this,"shaderInputs"),B(this,"_uniformStore"),B(this,"_attributeInfos",{}),B(this,"_gpuGeometry",null),B(this,"props"),B(this,"_pipelineNeedsUpdate","newly created"),B(this,"_needsRedraw","initializing"),B(this,"_destroyed",!1),B(this,"_lastDrawTimestamp",-1),B(this,"_lastLogTime",0),B(this,"_logOpen",!1),B(this,"_drawCount",0);var n,r,o,s;this.props={...Zw.defaultProps,...t},t=this.props,this.id=t.id||sf("model"),this.device=e,Object.assign(this.userData,t.userData);const a=Object.fromEntries(((n=this.props.modules)==null?void 0:n.map(h=>[h.name,h]))||[]),l=t.shaderInputs||new hP(a,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(l);const c=yP(e),u=(((r=this.props.modules)==null?void 0:r.length)>0?this.props.modules:(o=this.shaderInputs)==null?void 0:o.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:h,getUniforms:d}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:c,...this.props,modules:u});this.source=h,this._getModuleUniforms=d,(s=this.props).shaderLayout||(s.shaderLayout=K5(this.source))}else{const{vs:h,fs:d,getUniforms:f}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:c,...this.props,modules:u});this.vs=h,this.fs=d,this._getModuleUniforms=f}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||tP.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||iP.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return Z.info(Zo,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const r=this._getBindings();this.pipeline.setBindings(r,{disableWarnings:this.props.disableWarnings});const{indexBuffer:o}=this.vertexArray,s=o?o.byteLength/(o.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:s,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var t;(t=this._gpuGeometry)==null||t.destroy();const n=e&&Q5(this.device,e);if(n){this.setTopology(n.topology||"triangle-list");const r=new ap(this.bufferLayout);this.bufferLayout=r.mergeBufferLayouts(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)}this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new ap(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){wm(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new Bt(this.shaderInputs.modules);for(const[t,n]of Object.entries(this.shaderInputs.modules))if(_P(n)){const r=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=r}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const n=(t==null?void 0:t.disableWarnings)??this.props.disableWarnings;e.indices&&Z.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=oP(this.pipeline.shaderLayout,this.bufferLayout);const r=new ap(this.bufferLayout);for(const[o,s]of Object.entries(e)){const a=r.getBufferLayout(o);if(!a){n||Z.warn(`Model(${this.id}): Missing layout for buffer "${o}".`)();continue}const l=r.getAttributeNamesForBuffer(a);let c=!1;for(const u of l){const h=this._attributeInfos[u];if(h){const d=this.device.type==="webgpu"?r.getBufferIndex(h.bufferName):h.location;this.vertexArray.setBuffer(d,s),c=!0}}!c&&!n&&Z.warn(`Model(${this.id}): Ignoring buffer "${s.id}" for unknown attribute "${o}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[n,r]of Object.entries(e)){const o=this._attributeInfos[n];o?this.vertexArray.setConstantWebGL(o.location,r):((t==null?void 0:t.disableWarnings)??this.props.disableWarnings)||Z.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof lp&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,n]of Object.entries(this.bindings))n instanceof lp?n.isReady&&(e[t]=n.texture):e[t]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof w4?e=Math.max(e,t.texture.updateTimestamp):t instanceof se||t instanceof Ve?e=Math.max(e,t.updateTimestamp):t instanceof lp?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof Jg||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[n]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(r=>r.name===n)&&n!=="positions"&&delete t[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(Z.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let r=null;this.source?r=n:this.fs&&(r=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:r}),this._attributeInfos=iw(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=Z.level>3?0:gP;Z.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Z.group(Zo,`>>> DRAWING MODEL ${this.id}`,{collapsed:Z.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=nP(this.pipeline.shaderLayout,this.id);Z.table(Zo,e)();const t=this.shaderInputs.getDebugTable();Z.table(Zo,t)();const n=this._getAttributeDebugTable();Z.table(Zo,this._attributeInfos)(),Z.table(Zo,n)(),Z.groupEnd(Zo)(),this._logOpen=!1}}_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const n=e.props.framebuffer;n&&rP(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,n]of Object.entries(this._attributeInfos)){const r=this.vertexArray.attributes[n.location];e[n.location]={name:t,type:n.shaderType,values:r?this._getBufferOrConstantValues(r,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,n=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,t){const n=QL(t);return(e instanceof se?new n(e.debugData):e).toString()}};B(Kw,"defaultProps",{...Yh.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:v5.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Ft=Kw;function _P(i){return!!(i.uniformTypes&&!bP(i.uniformTypes))}function yP(i){return{type:i.type,shaderLanguage:i.info.shadingLanguage,shaderLanguageVersion:i.info.shadingLanguageVersion,gpu:i.info.gpu,features:i.features}}function bP(i){for(const e in i)return!1;return!0}class Go{constructor(e,t,n,r,o){this._debugRandomNumber=Math.floor(Math.random()*1e3),this.device=e,this.config=t,this.store=n,this.data=r,o&&(this.points=o)}}const vP=`#version 300 es
precision highp float;

in vec4 rgba;
out vec4 fragColor;

void main() {
  fragColor = rgba;
}`,xP=`#version 300 es
precision highp float;

uniform sampler2D positionsTexture;

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform calculateCentermassUniforms {
  float pointsTextureSize;
} calculateCentermass;

#define pointsTextureSize calculateCentermass.pointsTextureSize
#else
uniform float pointsTextureSize;
#endif

in vec2 pointIndices;

out vec4 rgba;

void main() {
  vec4 pointPosition = texture(positionsTexture, pointIndices / pointsTextureSize);
  rgba = vec4(pointPosition.xy, 1.0, 0.0);

  gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
  gl_PointSize = 1.0;
}
`,wP=`#version 300 es
precision highp float;

uniform sampler2D positionsTexture;
uniform sampler2D centermassTexture;

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform forceCenterUniforms {
  float centerForce;
  float alpha;
} forceCenter;

#define centerForce forceCenter.centerForce
#define alpha forceCenter.alpha
#else
uniform float centerForce;
uniform float alpha;
#endif

in vec2 textureCoords;
out vec4 fragColor;

void main() {
  vec4 pointPosition = texture(positionsTexture, textureCoords);
  vec4 velocity = vec4(0.0);
  vec4 centermassValues = texture(centermassTexture, vec2(0.0));
  vec2 centermassPosition = centermassValues.xy / centermassValues.b;
  vec2 distVector = centermassPosition - pointPosition.xy;
  float dist = sqrt(dot(distVector, distVector));
  if (dist > 0.0) {
    float angle = atan(distVector.y, distVector.x);
    float addV = alpha * centerForce * dist * 0.01;
    velocity.rg += addV * vec2(cos(angle), sin(angle));
  }

  fragColor = velocity;
}`;function af(i){const e=new Float32Array(i*i*2);for(let t=0;t<i;t++)for(let n=0;n<i;n++){const r=t*i*2+n*2;e[r+0]=n,e[r+1]=t}return e}function Ue(i,e){const t=rc.getInfo(i);return e*(t.bytesPerPixel??0)}const wn=`#version 300 es
#ifdef GL_ES
precision highp float;
#endif

in vec2 vertexCoord; // Vertex coordinates in normalized device coordinates
out vec2 textureCoords; // Texture coordinates to pass to the fragment shader

void main() {
    // Convert vertex coordinates from [-1, 1] range to [0, 1] range for texture sampling
    textureCoords = (vertexCoord + 1.0) / 2.0;
    gl_Position = vec4(vertexCoord, 0, 1);
}
`;class SP extends Go{create(){var e;const{device:t,store:n}=this,{pointsTextureSize:r}=n;if(r){if(this.centermassTexture||(this.centermassTexture=t.createTexture({width:1,height:1,format:"rgba32float",usage:Ve.SAMPLE|Ve.RENDER|Ve.COPY_DST})),this.centermassTexture.copyImageData({data:new Float32Array(4).fill(0),bytesPerRow:Ue("rgba32float",1),mipLevel:0,x:0,y:0}),this.centermassFbo||(this.centermassFbo=t.createFramebuffer({width:1,height:1,colorAttachments:[this.centermassTexture]})),!this.pointIndices||this.previousPointsTextureSize!==n.pointsTextureSize){this.pointIndices&&!this.pointIndices.destroyed&&this.pointIndices.destroy();const o=af(n.pointsTextureSize);this.pointIndices=t.createBuffer({data:o,usage:se.VERTEX|se.COPY_DST}),(e=this.calculateCentermassCommand)==null||e.setAttributes({pointIndices:this.pointIndices})}this.previousPointsTextureSize=r}}initPrograms(){const{device:e,store:t,points:n}=this;!n||!t.pointsTextureSize||!this.centermassFbo||this.centermassFbo.destroyed||!this.centermassTexture||this.centermassTexture.destroyed||(this.forceVertexCoordBuffer||(this.forceVertexCoordBuffer=e.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.calculateUniformStore||(this.calculateUniformStore=new Bt({calculateCentermassUniforms:{uniformTypes:{pointsTextureSize:"f32"}}})),this.forceUniformStore||(this.forceUniformStore=new Bt({forceCenterUniforms:{uniformTypes:{centerForce:"f32",alpha:"f32"}}})),this.calculateCentermassCommand||(this.calculateCentermassCommand=new Ft(e,{fs:vP,vs:xP,topology:"point-list",attributes:{...this.pointIndices&&{pointIndices:this.pointIndices}},bufferLayout:[{name:"pointIndices",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{calculateCentermassUniforms:this.calculateUniformStore.getManagedUniformBuffer(e,"calculateCentermassUniforms")},parameters:{blend:!0,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"add",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",depthWriteEnabled:!1,depthCompare:"always"}})),this.calculateCentermassCommand.setVertexCount(this.data.pointsNumber??0),this.runCommand||(this.runCommand=new Ft(e,{fs:wP,vs:wn,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.forceVertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{forceCenterUniforms:this.forceUniformStore.getManagedUniformBuffer(e,"forceCenterUniforms")},parameters:{depthWriteEnabled:!1,depthCompare:"always"}})))}run(){const{device:e,store:t,points:n}=this;if(!n||!this.calculateCentermassCommand||!this.calculateUniformStore||!this.runCommand||!this.forceUniformStore||!this.centermassFbo||!this.centermassTexture||!n.previousPositionTexture||n.previousPositionTexture.destroyed||!n.velocityFbo||n.velocityFbo.destroyed||t.pointsTextureSize!==this.previousPointsTextureSize||!this.pointIndices)return;const r=e.beginRenderPass({framebuffer:this.centermassFbo,clearColor:[0,0,0,0]});this.calculateUniformStore.setUniforms({calculateCentermassUniforms:{pointsTextureSize:t.pointsTextureSize??0}}),this.calculateCentermassCommand.setBindings({positionsTexture:n.previousPositionTexture}),this.calculateCentermassCommand.draw(r),r.end(),this.forceUniformStore.setUniforms({forceCenterUniforms:{centerForce:this.config.simulationCenter??0,alpha:t.alpha}}),this.runCommand.setBindings({positionsTexture:n.previousPositionTexture,centermassTexture:this.centermassTexture});const o=e.beginRenderPass({framebuffer:n.velocityFbo,clearColor:[0,0,0,0]});this.runCommand.draw(o),o.end()}destroy(){var e,t,n,r;(e=this.calculateCentermassCommand)==null||e.destroy(),this.calculateCentermassCommand=void 0,(t=this.runCommand)==null||t.destroy(),this.runCommand=void 0,this.centermassFbo&&!this.centermassFbo.destroyed&&this.centermassFbo.destroy(),this.centermassFbo=void 0,this.centermassTexture&&!this.centermassTexture.destroyed&&this.centermassTexture.destroy(),this.centermassTexture=void 0,(n=this.calculateUniformStore)==null||n.destroy(),this.calculateUniformStore=void 0,(r=this.forceUniformStore)==null||r.destroy(),this.forceUniformStore=void 0,this.pointIndices&&!this.pointIndices.destroyed&&this.pointIndices.destroy(),this.pointIndices=void 0,this.forceVertexCoordBuffer&&!this.forceVertexCoordBuffer.destroyed&&this.forceVertexCoordBuffer.destroy(),this.forceVertexCoordBuffer=void 0,this.previousPointsTextureSize=void 0}}const EP=`#version 300 es
precision highp float;

uniform sampler2D positionsTexture;

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform forceGravityUniforms {
  float gravity;
  float spaceSize;
  float alpha;
} forceGravity;

#define gravity forceGravity.gravity
#define spaceSize forceGravity.spaceSize
#define alpha forceGravity.alpha
#else
uniform float gravity;
uniform float spaceSize;
uniform float alpha;
#endif

in vec2 textureCoords;
out vec4 fragColor;

void main() {
  vec4 pointPosition = texture(positionsTexture, textureCoords);

  vec4 velocity = vec4(0.0);

  vec2 centerPosition = vec2(spaceSize * 0.5);
  vec2 distVector = centerPosition - pointPosition.rg;
  float dist = sqrt(dot(distVector, distVector));
  if (dist > 0.0) {
    float angle = atan(distVector.y, distVector.x);
    float additionalVelocity = alpha * gravity * dist * 0.1;
    velocity.rg += additionalVelocity * vec2(cos(angle), sin(angle));
  }

  fragColor = velocity;
}`;class CP extends Go{initPrograms(){const{device:e,points:t,store:n}=this;!t||!n.pointsTextureSize||(this.vertexCoordBuffer||(this.vertexCoordBuffer=e.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.uniformStore||(this.uniformStore=new Bt({forceGravityUniforms:{uniformTypes:{gravity:"f32",spaceSize:"f32",alpha:"f32"}}})),this.runCommand||(this.runCommand=new Ft(e,{fs:EP,vs:wn,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.vertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{forceGravityUniforms:this.uniformStore.getManagedUniformBuffer(e,"forceGravityUniforms")},parameters:{depthWriteEnabled:!1,depthCompare:"always"}})))}run(){const{device:e,points:t,store:n}=this;if(!t||!this.runCommand||!this.uniformStore||!t.previousPositionTexture||t.previousPositionTexture.destroyed||!t.velocityFbo||t.velocityFbo.destroyed)return;this.uniformStore.setUniforms({forceGravityUniforms:{gravity:this.config.simulationGravity??0,spaceSize:n.adjustedSpaceSize??0,alpha:n.alpha}}),this.runCommand.setBindings({positionsTexture:t.previousPositionTexture});const r=e.beginRenderPass({framebuffer:t.velocityFbo,clearColor:[0,0,0,0]});this.runCommand.draw(r),r.end()}destroy(){var e,t;(e=this.runCommand)==null||e.destroy(),this.runCommand=void 0,(t=this.uniformStore)==null||t.destroy(),this.uniformStore=void 0,this.vertexCoordBuffer&&!this.vertexCoordBuffer.destroyed&&this.vertexCoordBuffer.destroy(),this.vertexCoordBuffer=void 0}}function TP(i){return`#version 300 es
precision highp float;

uniform sampler2D positionsTexture;
uniform sampler2D linkInfoTexture; // Texture storing first link indices and amount
uniform sampler2D linkIndicesTexture;
uniform sampler2D linkPropertiesTexture; // Texture storing link bias and strength
uniform sampler2D linkRandomDistanceTexture;

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform forceLinkUniforms {
  float linkSpring;
  float linkDistance;
  vec2 linkDistRandomVariationRange;
  float pointsTextureSize;
  float linksTextureSize;
  float alpha;
} forceLink;

#define linkSpring forceLink.linkSpring
#define linkDistance forceLink.linkDistance
#define linkDistRandomVariationRange forceLink.linkDistRandomVariationRange
#define pointsTextureSize forceLink.pointsTextureSize
#define linksTextureSize forceLink.linksTextureSize
#define alpha forceLink.alpha
#else
uniform float linkSpring;
uniform float linkDistance;
uniform vec2 linkDistRandomVariationRange;
uniform float pointsTextureSize;
uniform float linksTextureSize;
uniform float alpha;
#endif

in vec2 textureCoords;
out vec4 fragColor;

const float MAX_LINKS = ${i}.0;

void main() {
  vec4 pointPosition = texture(positionsTexture, textureCoords);
  vec4 velocity = vec4(0.0);

  vec4 linkInfo = texture(linkInfoTexture, textureCoords);
  float iCount = linkInfo.r;
  float jCount = linkInfo.g;
  float linkAmount = linkInfo.b;
  if (linkAmount > 0.0) {
    for (float i = 0.0; i < MAX_LINKS; i += 1.0) {
      if (i < linkAmount) {
        if (iCount >= linksTextureSize) {
          iCount = 0.0;
          jCount += 1.0;
        }
        vec2 linkTextureIndex = (vec2(iCount, jCount) + 0.5) / linksTextureSize;
        vec4 connectedPointIndex = texture(linkIndicesTexture, linkTextureIndex);
        vec4 biasAndStrength = texture(linkPropertiesTexture, linkTextureIndex);
        vec4 randomMinDistance = texture(linkRandomDistanceTexture, linkTextureIndex);
        float bias = biasAndStrength.r;
        float strength = biasAndStrength.g;
        float randomMinLinkDist = randomMinDistance.r * (linkDistRandomVariationRange.g - linkDistRandomVariationRange.r) + linkDistRandomVariationRange.r;
        randomMinLinkDist *= linkDistance;

        iCount += 1.0;

        vec4 connectedPointPosition = texture(positionsTexture, (connectedPointIndex.rg + 0.5) / pointsTextureSize);
        float x = connectedPointPosition.x - (pointPosition.x + velocity.x);
        float y = connectedPointPosition.y - (pointPosition.y + velocity.y);
        float l = sqrt(x * x + y * y);

        // Apply the link force
        l = max(l, randomMinLinkDist * 0.99);
        l = (l - randomMinLinkDist) / l;
        l *= linkSpring * alpha;
        l *= strength;
        l *= bias;
        x *= l;
        y *= l;
        velocity.x += x;
        velocity.y += y;
      }
    }
  }

  fragColor = vec4(velocity.rg, 0.0, 0.0);
}
  `}function Ke(i,e){return!i||i.length!==2?e:[i[0],i[1]]}function ni(i,e){return!i||i.length!==4?e:[i[0],i[1],i[2],i[3]]}var Sm=(i=>(i.OUTGOING="outgoing",i.INCOMING="incoming",i))(Sm||{});class vv extends Go{constructor(){super(...arguments),this.linkFirstIndicesAndAmount=new Float32Array,this.indices=new Float32Array,this.maxPointDegree=0}create(e){var t;const{device:n,store:{pointsTextureSize:r,linksTextureSize:o},data:s}=this;if(!r||!o)return;this.linkFirstIndicesAndAmount=new Float32Array(r*r*4),this.indices=new Float32Array(o*o*4);const a=new Float32Array(o*o*4),l=new Float32Array(o*o*4),c=e==="incoming"?s.sourceIndexToTargetIndices:s.targetIndexToSourceIndices;this.maxPointDegree=0;let u=0;c==null||c.forEach((f,p)=>{f&&(this.linkFirstIndicesAndAmount[p*4+0]=u%o,this.linkFirstIndicesAndAmount[p*4+1]=Math.floor(u/o),this.linkFirstIndicesAndAmount[p*4+2]=f.length??0,f.forEach(([b,g])=>{var _,T,E;this.indices[u*4+0]=b%r,this.indices[u*4+1]=Math.floor(b/r);const y=((_=s.degree)==null?void 0:_[b])??0,C=((T=s.degree)==null?void 0:T[p])??0,I=y+C,F=I!==0?y/I:.5,V=Math.min(y,C);let q=((E=s.linkStrength)==null?void 0:E[g])??1/Math.max(V,1);q=Math.sqrt(q),a[u*4+0]=F,a[u*4+1]=q,l[u*4]=this.store.getRandomFloat(0,1),u+=1}),this.maxPointDegree=Math.max(this.maxPointDegree,f.length??0))});const h=!this.linkFirstIndicesAndAmountTexture||this.linkFirstIndicesAndAmountTexture.width!==r||this.linkFirstIndicesAndAmountTexture.height!==r,d=!this.indicesTexture||this.indicesTexture.width!==o||this.indicesTexture.height!==o;h&&(this.linkFirstIndicesAndAmountTexture&&!this.linkFirstIndicesAndAmountTexture.destroyed&&this.linkFirstIndicesAndAmountTexture.destroy(),this.linkFirstIndicesAndAmountTexture=n.createTexture({width:r,height:r,format:"rgba32float",usage:Ve.SAMPLE|Ve.COPY_DST})),this.linkFirstIndicesAndAmountTexture.copyImageData({data:this.linkFirstIndicesAndAmount,bytesPerRow:Ue("rgba32float",r),mipLevel:0,x:0,y:0}),d&&(this.indicesTexture&&!this.indicesTexture.destroyed&&this.indicesTexture.destroy(),this.biasAndStrengthTexture&&!this.biasAndStrengthTexture.destroyed&&this.biasAndStrengthTexture.destroy(),this.randomDistanceTexture&&!this.randomDistanceTexture.destroyed&&this.randomDistanceTexture.destroy(),this.indicesTexture=n.createTexture({width:o,height:o,format:"rgba32float",usage:Ve.SAMPLE|Ve.COPY_DST}),this.biasAndStrengthTexture=n.createTexture({width:o,height:o,format:"rgba32float",usage:Ve.SAMPLE|Ve.COPY_DST}),this.randomDistanceTexture=n.createTexture({width:o,height:o,format:"rgba32float",usage:Ve.SAMPLE|Ve.COPY_DST})),this.indicesTexture.copyImageData({data:this.indices,bytesPerRow:Ue("rgba32float",o),mipLevel:0,x:0,y:0}),this.biasAndStrengthTexture.copyImageData({data:a,bytesPerRow:Ue("rgba32float",o),mipLevel:0,x:0,y:0}),this.randomDistanceTexture.copyImageData({data:l,bytesPerRow:Ue("rgba32float",o),mipLevel:0,x:0,y:0}),this.previousMaxPointDegree!==void 0&&this.previousMaxPointDegree!==this.maxPointDegree&&((t=this.runCommand)==null||t.destroy(),this.runCommand=void 0),this.previousMaxPointDegree=this.maxPointDegree,this.previousPointsTextureSize=r,this.previousLinksTextureSize=o}initPrograms(){const{device:e,store:t,points:n}=this;!n||!t.pointsTextureSize||!t.linksTextureSize||!this.linkFirstIndicesAndAmountTexture||!this.indicesTexture||!this.biasAndStrengthTexture||!this.randomDistanceTexture||(this.vertexCoordBuffer||(this.vertexCoordBuffer=e.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.uniformStore||(this.uniformStore=new Bt({forceLinkUniforms:{uniformTypes:{linkSpring:"f32",linkDistance:"f32",linkDistRandomVariationRange:"vec2<f32>",pointsTextureSize:"f32",linksTextureSize:"f32",alpha:"f32"}}})),this.runCommand||(this.runCommand=new Ft(e,{fs:TP(this.maxPointDegree),vs:wn,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.vertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{forceLinkUniforms:this.uniformStore.getManagedUniformBuffer(e,"forceLinkUniforms")},parameters:{depthWriteEnabled:!1,depthCompare:"always"}})))}run(){const{device:e,store:t,points:n}=this;if(!n||!this.runCommand||!this.uniformStore||!n.previousPositionTexture||n.previousPositionTexture.destroyed||!this.linkFirstIndicesAndAmountTexture||!this.indicesTexture||!this.biasAndStrengthTexture||!this.randomDistanceTexture||!n.velocityFbo||n.velocityFbo.destroyed||t.pointsTextureSize!==this.previousPointsTextureSize||t.linksTextureSize!==this.previousLinksTextureSize)return;this.uniformStore.setUniforms({forceLinkUniforms:{linkSpring:this.config.simulationLinkSpring??0,linkDistance:this.config.simulationLinkDistance??0,linkDistRandomVariationRange:Ke(this.config.simulationLinkDistRandomVariationRange,[0,0]),pointsTextureSize:t.pointsTextureSize,linksTextureSize:t.linksTextureSize,alpha:t.alpha}}),this.runCommand.setBindings({positionsTexture:n.previousPositionTexture,linkInfoTexture:this.linkFirstIndicesAndAmountTexture,linkIndicesTexture:this.indicesTexture,linkPropertiesTexture:this.biasAndStrengthTexture,linkRandomDistanceTexture:this.randomDistanceTexture});const r=e.beginRenderPass({framebuffer:n.velocityFbo,clearColor:[0,0,0,0]});this.runCommand.draw(r),r.end()}destroy(){var e,t;(e=this.runCommand)==null||e.destroy(),this.runCommand=void 0,this.linkFirstIndicesAndAmountTexture&&!this.linkFirstIndicesAndAmountTexture.destroyed&&this.linkFirstIndicesAndAmountTexture.destroy(),this.linkFirstIndicesAndAmountTexture=void 0,this.indicesTexture&&!this.indicesTexture.destroyed&&this.indicesTexture.destroy(),this.indicesTexture=void 0,this.biasAndStrengthTexture&&!this.biasAndStrengthTexture.destroyed&&this.biasAndStrengthTexture.destroy(),this.biasAndStrengthTexture=void 0,this.randomDistanceTexture&&!this.randomDistanceTexture.destroyed&&this.randomDistanceTexture.destroy(),this.randomDistanceTexture=void 0,(t=this.uniformStore)==null||t.destroy(),this.uniformStore=void 0,this.vertexCoordBuffer&&!this.vertexCoordBuffer.destroyed&&this.vertexCoordBuffer.destroy(),this.vertexCoordBuffer=void 0}}const AP=`#version 300 es
precision highp float;

in vec4 vColor;
out vec4 fragColor;

void main() {
  fragColor = vColor;
}`,IP=`#version 300 es
precision highp float;

uniform sampler2D positionsTexture;

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform calculateLevelsUniforms {
  float pointsTextureSize;
  float levelTextureSize;
  float cellSize;
} calculateLevels;

#define pointsTextureSize calculateLevels.pointsTextureSize
#define levelTextureSize calculateLevels.levelTextureSize
#define cellSize calculateLevels.cellSize
#else
uniform float pointsTextureSize;
uniform float levelTextureSize;
uniform float cellSize;
#endif

in vec2 pointIndices;

out vec4 vColor;

void main() {
  vec4 pointPosition = texture(positionsTexture, pointIndices / pointsTextureSize);
  vColor = vec4(pointPosition.rg, 1.0, 0.0);

  float n = floor(pointPosition.x / cellSize);
  float m = floor(pointPosition.y / cellSize);
  
  vec2 levelPosition = 2.0 * (vec2(n, m) + 0.5) / levelTextureSize - 1.0;

  gl_Position = vec4(levelPosition, 0.0, 1.0);
  gl_PointSize = 1.0;
}`,kP=`#version 300 es
precision highp float;

uniform sampler2D positionsTexture;
uniform sampler2D levelFbo;

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform forceUniforms {
  float level;
  float levels;
  float levelTextureSize;
  float repulsion;
  float alpha;
  float spaceSize;
  float theta;
} force;

#define level force.level
#define levels force.levels
#define levelTextureSize force.levelTextureSize
#define repulsion force.repulsion
#define alpha force.alpha
#define spaceSize force.spaceSize
#define theta force.theta
#else
uniform float level;
uniform float levels;
uniform float levelTextureSize;
uniform float repulsion;
uniform float alpha;
uniform float spaceSize;
uniform float theta;
#endif

in vec2 textureCoords;
out vec4 fragColor;

const float MAX_LEVELS_NUM = 14.0;

vec2 calculateAdditionalVelocity (vec2 ij, vec2 pp) {
  vec2 add = vec2(0.0);
  vec4 centermass = texture(levelFbo, ij);
  if (centermass.r > 0.0 && centermass.g > 0.0 && centermass.b > 0.0) {
    vec2 centermassPosition = vec2(centermass.rg / centermass.b);
    vec2 distVector = pp - centermassPosition;
    float l = dot(distVector, distVector);
    float dist = sqrt(l);
    if (l > 0.0) {
      float c = alpha * repulsion * centermass.b;

      float distanceMin2 = 1.0;
      if (l < distanceMin2) l = sqrt(distanceMin2 * l);
      float addV = c / sqrt(l);
      add = addV * normalize(distVector);
    }
  }
  return add;
}

void main() {
  vec4 pointPosition = texture(positionsTexture, textureCoords);
  float x = pointPosition.x;
  float y = pointPosition.y;

  float left = 0.0;
  float top = 0.0;
  float right = spaceSize;
  float bottom = spaceSize;

  float n_left = 0.0;
  float n_top = 0.0;
  float n_right = 0.0;
  float n_bottom = 0.0;

  float cellSize = 0.0;

  // Iterate over levels to adjust the boundaries based on the current level
  for (float i = 0.0; i < MAX_LEVELS_NUM; i += 1.0) {
    if (i <= level) {
      left += cellSize * n_left;
      top += cellSize * n_top;
      right -= cellSize * n_right;
      bottom -= cellSize * n_bottom;

      cellSize = pow(2.0 , levels - i - 1.0);

      float dist_left = x - left;
      n_left = max(0.0, floor(dist_left / cellSize - theta));

      float dist_top = y - top;
      n_top = max(0.0, floor(dist_top / cellSize - theta));
      
      float dist_right = right - x;
      n_right = max(0.0, floor(dist_right / cellSize - theta));

      float dist_bottom = bottom - y;
      n_bottom = max(0.0, floor(dist_bottom / cellSize - theta));

    }
  }

  vec4 velocity = vec4(vec2(0.0), 1.0, 0.0);

  // Calculate the additional velocity based on neighboring cells
  for (float i = 0.0; i < 12.0; i += 1.0) {
    for (float j = 0.0; j < 4.0; j += 1.0) {
      float n = left + cellSize * j;
      float m = top + cellSize * n_top + cellSize * i;

      if (n < (left + n_left * cellSize) && m < bottom) {
        velocity.xy += calculateAdditionalVelocity(vec2(n / cellSize, m / cellSize) / levelTextureSize, pointPosition.xy);
      }

      n = left + cellSize * i;
      m = top + cellSize * j;

      if (n < (right - n_right * cellSize) && m < (top + n_top * cellSize)) {
        velocity.xy += calculateAdditionalVelocity(vec2(n / cellSize, m / cellSize) / levelTextureSize, pointPosition.xy);
      }

      n = right - n_right * cellSize + cellSize * j;
      m = top + cellSize * i;

      if (n < right && m < (bottom - n_bottom * cellSize)) {
        velocity.xy += calculateAdditionalVelocity(vec2(n / cellSize, m / cellSize) / levelTextureSize, pointPosition.xy);
      }

      n = left + n_left * cellSize + cellSize * i;
      m = bottom - n_bottom * cellSize + cellSize * j;

      if (n < right && m < bottom) {
        velocity.xy += calculateAdditionalVelocity(vec2(n / cellSize, m / cellSize) / levelTextureSize, pointPosition.xy);
      }
    }
  }

  fragColor = velocity;
}`,LP=`#version 300 es
precision highp float;

uniform sampler2D positionsTexture;
uniform sampler2D levelFbo;
uniform sampler2D randomValues;

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform forceCenterUniforms {
  float levelTextureSize;
  float repulsion;
  float alpha;
} forceCenter;

#define levelTextureSize forceCenter.levelTextureSize
#define repulsion forceCenter.repulsion
#define alpha forceCenter.alpha
#else
uniform float levelTextureSize;
uniform float repulsion;
uniform float alpha;
#endif

in vec2 textureCoords;
out vec4 fragColor;

// Calculate the additional velocity based on the center of mass
vec2 calculateAdditionalVelocity (vec2 ij, vec2 pp) {
  vec2 add = vec2(0.0);
  vec4 centermass = texture(levelFbo, ij);
  if (centermass.r > 0.0 && centermass.g > 0.0 && centermass.b > 0.0) {
    vec2 centermassPosition = vec2(centermass.rg / centermass.b);
    vec2 distVector = pp - centermassPosition;
    float l = dot(distVector, distVector);
    float dist = sqrt(l);
    if (l > 0.0) {
      float angle = atan(distVector.y, distVector.x);
      float c = alpha * repulsion * centermass.b;

      float distanceMin2 = 1.0;
      if (l < distanceMin2) l = sqrt(distanceMin2 * l);
      float addV = c / sqrt(l);
      add = addV * vec2(cos(angle), sin(angle));
    }
  }
  return add;
}

void main() {
  vec4 pointPosition = texture(positionsTexture, textureCoords);
  vec4 random = texture(randomValues, textureCoords);

  vec4 velocity = vec4(0.0);

  // Calculate additional velocity based on the point position
  velocity.xy += calculateAdditionalVelocity(pointPosition.xy / levelTextureSize, pointPosition.xy);
  // Apply random factor to the velocity
  velocity.xy += velocity.xy * random.rg;

  fragColor = velocity;
}`;class RP extends Go{constructor(){super(...arguments),this.levels=0,this.levelTargets=new Map}create(){var e;const{device:t,store:n}=this;if(!n.pointsTextureSize)return;this.levels=Math.log2(n.adjustedSpaceSize);for(let s=0;s<this.levels;s+=1){const a=Math.pow(2,s+1),l=this.levelTargets.get(s);if(l&&l.texture.width===a&&l.texture.height===a){l.texture.copyImageData({data:new Float32Array(a*a*4).fill(0),bytesPerRow:Ue("rgba32float",a),mipLevel:0,x:0,y:0});continue}l&&(l.fbo.destroyed||l.fbo.destroy(),l.texture.destroyed||l.texture.destroy());const c=t.createTexture({width:a,height:a,format:"rgba32float",usage:Ve.SAMPLE|Ve.RENDER|Ve.COPY_DST});c.copyImageData({data:new Float32Array(a*a*4).fill(0),bytesPerRow:Ue("rgba32float",a),mipLevel:0,x:0,y:0});const u=t.createFramebuffer({width:a,height:a,colorAttachments:[c]});this.levelTargets.set(s,{texture:c,fbo:u})}for(const[s,a]of Array.from(this.levelTargets.entries()))s>=this.levels&&(a.fbo.destroyed||a.fbo.destroy(),a.texture.destroyed||a.texture.destroy(),this.levelTargets.delete(s));const r=n.pointsTextureSize*n.pointsTextureSize,o=new Float32Array(r*4);for(let s=0;s<r;++s)o[s*4]=n.getRandomFloat(-1,1)*1e-5,o[s*4+1]=n.getRandomFloat(-1,1)*1e-5;if((!this.randomValuesTexture||this.randomValuesTexture.destroyed||this.randomValuesTexture.width!==n.pointsTextureSize||this.randomValuesTexture.height!==n.pointsTextureSize)&&(this.randomValuesTexture&&!this.randomValuesTexture.destroyed&&this.randomValuesTexture.destroy(),this.randomValuesTexture=t.createTexture({width:n.pointsTextureSize,height:n.pointsTextureSize,format:"rgba32float",usage:Ve.SAMPLE|Ve.COPY_DST})),this.randomValuesTexture.copyImageData({data:o,bytesPerRow:Ue("rgba32float",n.pointsTextureSize),mipLevel:0,x:0,y:0}),!this.pointIndices||this.previousPointsTextureSize!==n.pointsTextureSize){this.pointIndices&&!this.pointIndices.destroyed&&this.pointIndices.destroy();const s=af(n.pointsTextureSize);this.pointIndices=t.createBuffer({data:s,usage:se.VERTEX|se.COPY_DST}),(e=this.calculateLevelsCommand)==null||e.setAttributes({pointIndices:this.pointIndices})}this.previousPointsTextureSize=n.pointsTextureSize,this.previousSpaceSize=n.adjustedSpaceSize}initPrograms(){const{device:e,store:t,data:n,points:r}=this;!n.pointsNumber||!r||!t.pointsTextureSize||(this.calculateLevelsUniformStore||(this.calculateLevelsUniformStore=new Bt({calculateLevelsUniforms:{uniformTypes:{pointsTextureSize:"f32",levelTextureSize:"f32",cellSize:"f32"},defaultUniforms:{pointsTextureSize:t.pointsTextureSize,levelTextureSize:0,cellSize:0}}})),this.calculateLevelsCommand||(this.calculateLevelsCommand=new Ft(e,{fs:AP,vs:IP,topology:"point-list",vertexCount:n.pointsNumber,attributes:{...this.pointIndices&&{pointIndices:this.pointIndices}},bufferLayout:[{name:"pointIndices",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{calculateLevelsUniforms:this.calculateLevelsUniformStore.getManagedUniformBuffer(e,"calculateLevelsUniforms")},parameters:{blend:!0,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"add",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",depthWriteEnabled:!1,depthCompare:"always"}})),this.forceUniformStore||(this.forceUniformStore=new Bt({forceUniforms:{uniformTypes:{level:"f32",levels:"f32",levelTextureSize:"f32",alpha:"f32",repulsion:"f32",spaceSize:"f32",theta:"f32"},defaultUniforms:{level:0,levels:this.levels,levelTextureSize:0,alpha:t.alpha,repulsion:this.config.simulationRepulsion??0,spaceSize:t.adjustedSpaceSize??0,theta:this.config.simulationRepulsionTheta??0}}})),this.forceVertexCoordBuffer||(this.forceVertexCoordBuffer=e.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.forceCommand||(this.forceCommand=new Ft(e,{fs:kP,vs:wn,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.forceVertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{forceUniforms:this.forceUniformStore.getManagedUniformBuffer(e,"forceUniforms")},parameters:{blend:!0,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"add",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",depthWriteEnabled:!1,depthCompare:"always"}})),this.forceCenterUniformStore||(this.forceCenterUniformStore=new Bt({forceCenterUniforms:{uniformTypes:{levelTextureSize:"f32",alpha:"f32",repulsion:"f32"},defaultUniforms:{levelTextureSize:0,alpha:t.alpha,repulsion:this.config.simulationRepulsion??0}}})),this.forceFromItsOwnCentermassCommand||(this.forceFromItsOwnCentermassCommand=new Ft(e,{fs:LP,vs:wn,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.forceVertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{forceCenterUniforms:this.forceCenterUniformStore.getManagedUniformBuffer(e,"forceCenterUniforms")},parameters:{blend:!0,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"add",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",depthWriteEnabled:!1,depthCompare:"always"}})))}run(){this.store.pointsTextureSize!==this.previousPointsTextureSize||this.store.adjustedSpaceSize!==this.previousSpaceSize||(this.drawLevels(),this.drawForces())}destroy(){var e,t,n,r,o,s;(e=this.calculateLevelsCommand)==null||e.destroy(),this.calculateLevelsCommand=void 0,(t=this.forceCommand)==null||t.destroy(),this.forceCommand=void 0,(n=this.forceFromItsOwnCentermassCommand)==null||n.destroy(),this.forceFromItsOwnCentermassCommand=void 0;for(const a of this.levelTargets.values())a.fbo&&!a.fbo.destroyed&&a.fbo.destroy();this.randomValuesTexture&&!this.randomValuesTexture.destroyed&&this.randomValuesTexture.destroy(),this.randomValuesTexture=void 0;for(const a of this.levelTargets.values())a.texture&&!a.texture.destroyed&&a.texture.destroy();this.levelTargets.clear(),(r=this.calculateLevelsUniformStore)==null||r.destroy(),this.calculateLevelsUniformStore=void 0,(o=this.forceUniformStore)==null||o.destroy(),this.forceUniformStore=void 0,(s=this.forceCenterUniformStore)==null||s.destroy(),this.forceCenterUniformStore=void 0,this.pointIndices&&!this.pointIndices.destroyed&&this.pointIndices.destroy(),this.pointIndices=void 0,this.forceVertexCoordBuffer&&!this.forceVertexCoordBuffer.destroyed&&this.forceVertexCoordBuffer.destroy(),this.forceVertexCoordBuffer=void 0}drawLevels(){const{device:e,store:t,data:n,points:r}=this;if(r&&!(!this.calculateLevelsCommand||!this.calculateLevelsUniformStore)&&!(!r.previousPositionTexture||r.previousPositionTexture.destroyed)&&n.pointsNumber&&this.pointIndices)for(let o=0;o<this.levels;o+=1){const s=this.levelTargets.get(o);if(!s||s.fbo.destroyed||s.texture.destroyed)continue;const a=Math.pow(2,o+1),l=(t.adjustedSpaceSize??0)/a;this.calculateLevelsUniformStore.setUniforms({calculateLevelsUniforms:{pointsTextureSize:t.pointsTextureSize??0,levelTextureSize:a,cellSize:l}}),this.calculateLevelsCommand.setVertexCount(n.pointsNumber),this.calculateLevelsCommand.setBindings({positionsTexture:r.previousPositionTexture});const c=e.beginRenderPass({framebuffer:s.fbo,clearColor:[0,0,0,0]});this.calculateLevelsCommand.draw(c),c.end()}}drawForces(){const{device:e,store:t,points:n}=this;if(!n||!this.forceCommand||!this.forceUniformStore||!this.forceFromItsOwnCentermassCommand||!this.forceCenterUniformStore||!n.previousPositionTexture||n.previousPositionTexture.destroyed||!this.randomValuesTexture||this.randomValuesTexture.destroyed||!n.velocityFbo||n.velocityFbo.destroyed)return;const r=e.beginRenderPass({framebuffer:n.velocityFbo,clearColor:[0,0,0,0]});for(let o=0;o<this.levels;o+=1){const s=this.levelTargets.get(o);if(!s||s.texture.destroyed)continue;const a=Math.pow(2,o+1);this.forceUniformStore.setUniforms({forceUniforms:{level:o,levels:this.levels,levelTextureSize:a,alpha:t.alpha,repulsion:this.config.simulationRepulsion??0,spaceSize:t.adjustedSpaceSize??0,theta:this.config.simulationRepulsionTheta??0}}),this.forceCommand.setBindings({positionsTexture:n.previousPositionTexture,levelFbo:s.texture}),this.forceCommand.draw(r),o===this.levels-1&&(this.forceCenterUniformStore.setUniforms({forceCenterUniforms:{levelTextureSize:a,alpha:t.alpha,repulsion:this.config.simulationRepulsion??0}}),this.forceFromItsOwnCentermassCommand.setBindings({positionsTexture:n.previousPositionTexture,randomValues:this.randomValuesTexture,levelFbo:s.texture}),this.forceFromItsOwnCentermassCommand.draw(r))}r.end()}}const PP=`#version 300 es
precision highp float;

uniform sampler2D positionsTexture;

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform forceMouseUniforms {
  float repulsion;
  vec2 mousePos;
} forceMouse;

#define repulsion forceMouse.repulsion
#define mousePos forceMouse.mousePos
#else
uniform float repulsion;
uniform vec2 mousePos;
#endif

in vec2 textureCoords;
out vec4 fragColor;

void main() {
  vec4 pointPosition = texture(positionsTexture, textureCoords);
  vec4 velocity = vec4(0.0);
  vec2 mouse = mousePos;
  // Move particles away from the mouse position using a repulsive force
  vec2 distVector = mouse - pointPosition.rg;
  float dist = sqrt(dot(distVector, distVector));
  dist = max(dist, 10.0);
  float angle = atan(distVector.y, distVector.x);
  float addV = 100.0 * repulsion / (dist * dist);
  velocity.rg -= addV * vec2(cos(angle), sin(angle));

  fragColor = velocity;
}`;class DP extends Go{initPrograms(){const{device:e,points:t}=this;t&&(this.vertexCoordBuffer||(this.vertexCoordBuffer=e.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.uniformStore||(this.uniformStore=new Bt({forceMouseUniforms:{uniformTypes:{repulsion:"f32",mousePos:"vec2<f32>"}}})),this.runCommand||(this.runCommand=new Ft(e,{fs:PP,vs:wn,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.vertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{forceMouseUniforms:this.uniformStore.getManagedUniformBuffer(e,"forceMouseUniforms")},parameters:{depthWriteEnabled:!1,depthCompare:"always"}})))}run(){const{device:e,points:t,store:n}=this;if(!t||!this.runCommand||!this.uniformStore||!t.previousPositionTexture||t.previousPositionTexture.destroyed||!t.velocityFbo||t.velocityFbo.destroyed)return;this.uniformStore.setUniforms({forceMouseUniforms:{repulsion:this.config.simulationRepulsionFromMouse??0,mousePos:Ke(n.mousePosition,[0,0])}}),this.runCommand.setBindings({positionsTexture:t.previousPositionTexture});const r=e.beginRenderPass({framebuffer:t.velocityFbo,clearColor:[0,0,0,0]});this.runCommand.draw(r),r.end()}destroy(){var e,t;(e=this.runCommand)==null||e.destroy(),this.runCommand=void 0,(t=this.uniformStore)==null||t.destroy(),this.uniformStore=void 0,this.vertexCoordBuffer&&!this.vertexCoordBuffer.destroyed&&this.vertexCoordBuffer.destroy(),this.vertexCoordBuffer=void 0}}const MP=`#version 300 es
#ifdef GL_ES
precision highp float;
#endif

in vec4 rgba;

out vec4 fragColor;

void main() {
  fragColor = rgba;
}`,NP=`#version 300 es
#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D positionsTexture;
uniform sampler2D clusterTexture;

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform calculateCentermassUniforms {
  float pointsTextureSize;
  float clustersTextureSize;
} calculateCentermass;

#define pointsTextureSize calculateCentermass.pointsTextureSize
#define clustersTextureSize calculateCentermass.clustersTextureSize
#else
uniform float pointsTextureSize;
uniform float clustersTextureSize;
#endif

in vec2 pointIndices;

out vec4 rgba;

void main() {
  vec4 pointPosition = texture(positionsTexture, pointIndices / pointsTextureSize);
  rgba = vec4(pointPosition.xy, 1.0, 0.0);

  vec4 pointClusterIndices = texture(clusterTexture, pointIndices / pointsTextureSize);
  vec2 xy = vec2(0.0);
  if (pointClusterIndices.x >= 0.0 && pointClusterIndices.y >= 0.0) {
    xy = 2.0 * (pointClusterIndices.xy + 0.5) / clustersTextureSize - 1.0;
  }
  
  gl_Position = vec4(xy, 0.0, 1.0);
  gl_PointSize = 1.0;
}
`,BP=`#version 300 es
#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D positionsTexture;
uniform sampler2D centermassTexture;
uniform sampler2D clusterTexture;
uniform sampler2D clusterPositionsTexture;
uniform sampler2D clusterForceCoefficient;

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform applyForcesUniforms {
  float alpha;
  float clustersTextureSize;
  float clusterCoefficient;
} applyForces;

#define alpha applyForces.alpha
#define clustersTextureSize applyForces.clustersTextureSize
#define clusterCoefficient applyForces.clusterCoefficient
#else
uniform float alpha;
uniform float clustersTextureSize;
uniform float clusterCoefficient;
#endif

in vec2 textureCoords;

out vec4 fragColor;


void main() {
  vec4 pointPosition = texture(positionsTexture, textureCoords);
  vec4 velocity = vec4(0.0);
  vec4 pointClusterIndices = texture(clusterTexture, textureCoords);
  // no cluster, so no forces
  if (pointClusterIndices.x >= 0.0 && pointClusterIndices.y >= 0.0) {
    // positioning points to custom cluster position or either to the center of mass
    vec2 clusterPositions = texture(clusterPositionsTexture, pointClusterIndices.xy / clustersTextureSize).xy;
    if (clusterPositions.x < 0.0 || clusterPositions.y < 0.0) {
      vec4 centermassValues = texture(centermassTexture, pointClusterIndices.xy / clustersTextureSize);
      clusterPositions = centermassValues.xy / centermassValues.b;
    }
    vec4 clusterCustomCoeff = texture(clusterForceCoefficient, textureCoords);
    vec2 distVector = clusterPositions.xy - pointPosition.xy;
    float dist = length(distVector);
    if (dist > 0.0) {
      float addV = alpha * dist * clusterCoefficient * clusterCustomCoeff.r;
      velocity.rg += addV * normalize(distVector);
    }
  }

  fragColor = velocity;
}`;class OP extends Go{create(){var e,t;const{device:n,store:r,data:o}=this,{pointsTextureSize:s}=r;if(o.pointsNumber===void 0||!o.pointClusters&&!o.clusterPositions)return;this.clusterCount=(o.pointClusters??[]).reduce((f,p)=>p===void 0||p<0?f:Math.max(f,p),0)+1,this.clustersTextureSize=Math.ceil(Math.sqrt(this.clusterCount));const a=this.previousPointsTextureSize!==s||this.previousClustersTextureSize!==this.clustersTextureSize||this.previousClusterCount!==this.clusterCount,l=s*s*4,c=this.clustersTextureSize*this.clustersTextureSize*4,u=new Float32Array(l),h=new Float32Array(c).fill(-1),d=new Float32Array(l).fill(1);if(o.clusterPositions)for(let f=0;f<this.clusterCount;++f)h[f*4+0]=o.clusterPositions[f*2+0]??-1,h[f*4+1]=o.clusterPositions[f*2+1]??-1;for(let f=0;f<o.pointsNumber;++f){const p=(e=o.pointClusters)==null?void 0:e[f];p===void 0?(u[f*4+0]=-1,u[f*4+1]=-1):(u[f*4+0]=p%this.clustersTextureSize,u[f*4+1]=Math.floor(p/this.clustersTextureSize)),o.clusterStrength&&(d[f*4+0]=o.clusterStrength[f]??1)}if(!this.clusterTexture||a?(this.clusterTexture&&!this.clusterTexture.destroyed&&this.clusterTexture.destroy(),this.clusterTexture=n.createTexture({width:s,height:s,format:"rgba32float",usage:Ve.SAMPLE|Ve.RENDER|Ve.COPY_DST}),this.clusterTexture.copyImageData({data:u,bytesPerRow:Ue("rgba32float",s),mipLevel:0,x:0,y:0})):this.clusterTexture.copyImageData({data:u,bytesPerRow:Ue("rgba32float",s),mipLevel:0,x:0,y:0}),!this.clusterPositionsTexture||a?(this.clusterPositionsTexture&&!this.clusterPositionsTexture.destroyed&&this.clusterPositionsTexture.destroy(),this.clusterPositionsTexture=n.createTexture({width:this.clustersTextureSize,height:this.clustersTextureSize,format:"rgba32float",usage:Ve.SAMPLE|Ve.RENDER|Ve.COPY_DST}),this.clusterPositionsTexture.copyImageData({data:h,bytesPerRow:Ue("rgba32float",this.clustersTextureSize),mipLevel:0,x:0,y:0})):this.clusterPositionsTexture.copyImageData({data:h,bytesPerRow:Ue("rgba32float",this.clustersTextureSize),mipLevel:0,x:0,y:0}),!this.clusterForceCoefficientTexture||a?(this.clusterForceCoefficientTexture&&!this.clusterForceCoefficientTexture.destroyed&&this.clusterForceCoefficientTexture.destroy(),this.clusterForceCoefficientTexture=n.createTexture({width:s,height:s,format:"rgba32float",usage:Ve.SAMPLE|Ve.RENDER|Ve.COPY_DST}),this.clusterForceCoefficientTexture.copyImageData({data:d,bytesPerRow:Ue("rgba32float",s),mipLevel:0,x:0,y:0})):this.clusterForceCoefficientTexture.copyImageData({data:d,bytesPerRow:Ue("rgba32float",s),mipLevel:0,x:0,y:0}),!this.centermassTexture||this.previousClustersTextureSize!==this.clustersTextureSize?(this.centermassFbo&&!this.centermassFbo.destroyed&&this.centermassFbo.destroy(),this.centermassTexture&&!this.centermassTexture.destroyed&&this.centermassTexture.destroy(),this.centermassTexture=n.createTexture({width:this.clustersTextureSize,height:this.clustersTextureSize,format:"rgba32float",usage:Ve.SAMPLE|Ve.RENDER|Ve.COPY_DST}),this.centermassTexture.copyImageData({data:new Float32Array(c).fill(0),bytesPerRow:Ue("rgba32float",this.clustersTextureSize),mipLevel:0,x:0,y:0}),this.centermassFbo=n.createFramebuffer({width:this.clustersTextureSize,height:this.clustersTextureSize,colorAttachments:[this.centermassTexture]})):this.centermassTexture.copyImageData({data:new Float32Array(c).fill(0),bytesPerRow:Ue("rgba32float",this.clustersTextureSize),mipLevel:0,x:0,y:0}),!this.pointIndices||this.previousPointsTextureSize!==s){this.pointIndices&&!this.pointIndices.destroyed&&this.pointIndices.destroy();const f=af(r.pointsTextureSize);this.pointIndices=n.createBuffer({data:f,usage:se.VERTEX|se.COPY_DST}),(t=this.calculateCentermassCommand)==null||t.setAttributes({pointIndices:this.pointIndices})}this.previousPointsTextureSize=s,this.previousClustersTextureSize=this.clustersTextureSize,this.previousClusterCount=this.clusterCount}initPrograms(){const{device:e,store:t,data:n}=this;n.pointsNumber===void 0||!n.pointClusters&&!n.clusterPositions||(this.calculateCentermassUniformStore||(this.calculateCentermassUniformStore=new Bt({calculateCentermassUniforms:{uniformTypes:{pointsTextureSize:"f32",clustersTextureSize:"f32"},defaultUniforms:{pointsTextureSize:t.pointsTextureSize,clustersTextureSize:this.clustersTextureSize??0}}})),this.calculateCentermassCommand||(this.calculateCentermassCommand=new Ft(e,{fs:MP,vs:NP,topology:"point-list",vertexCount:n.pointsNumber??0,attributes:{...this.pointIndices&&{pointIndices:this.pointIndices}},bufferLayout:[{name:"pointIndices",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{calculateCentermassUniforms:this.calculateCentermassUniformStore.getManagedUniformBuffer(e,"calculateCentermassUniforms")},parameters:{blend:!0,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"add",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",depthWriteEnabled:!1,depthCompare:"always"}})),this.applyForcesUniformStore||(this.applyForcesUniformStore=new Bt({applyForcesUniforms:{uniformTypes:{alpha:"f32",clustersTextureSize:"f32",clusterCoefficient:"f32"},defaultUniforms:{alpha:t.alpha,clustersTextureSize:this.clustersTextureSize??0,clusterCoefficient:this.config.simulationCluster??0}}})),this.applyForcesVertexCoordBuffer||(this.applyForcesVertexCoordBuffer=e.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.applyForcesCommand||(this.applyForcesCommand=new Ft(e,{fs:BP,vs:wn,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.applyForcesVertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{applyForcesUniforms:this.applyForcesUniformStore.getManagedUniformBuffer(e,"applyForcesUniforms")}})))}calculateCentermass(){const{device:e,points:t}=this;if(!t||!this.calculateCentermassCommand||!this.calculateCentermassUniformStore||!this.pointIndices||!this.centermassFbo||this.centermassFbo.destroyed||!this.clusterTexture||this.clusterTexture.destroyed||!t.previousPositionTexture||t.previousPositionTexture.destroyed)return;this.calculateCentermassCommand.setVertexCount(this.data.pointsNumber??0),this.calculateCentermassUniformStore.setUniforms({calculateCentermassUniforms:{pointsTextureSize:this.store.pointsTextureSize,clustersTextureSize:this.clustersTextureSize??0}}),this.calculateCentermassCommand.setBindings({clusterTexture:this.clusterTexture,positionsTexture:t.previousPositionTexture});const n=e.beginRenderPass({framebuffer:this.centermassFbo,clearColor:[0,0,0,0]});this.calculateCentermassCommand.draw(n),n.end()}run(){var e;if(!this.data.pointClusters&&!this.data.clusterPositions||(this.calculateCentermass(),!this.applyForcesCommand||!this.applyForcesUniformStore)||!this.clusterTexture||this.clusterTexture.destroyed||!this.centermassTexture||this.centermassTexture.destroyed||!this.clusterPositionsTexture||this.clusterPositionsTexture.destroyed||!this.clusterForceCoefficientTexture||this.clusterForceCoefficientTexture.destroyed||!((e=this.points)!=null&&e.previousPositionTexture)||this.points.previousPositionTexture.destroyed||!this.points.velocityFbo||this.points.velocityFbo.destroyed)return;this.applyForcesUniformStore.setUniforms({applyForcesUniforms:{alpha:this.store.alpha,clustersTextureSize:this.clustersTextureSize??0,clusterCoefficient:this.config.simulationCluster??0}}),this.applyForcesCommand.setBindings({clusterTexture:this.clusterTexture,centermassTexture:this.centermassTexture,clusterPositionsTexture:this.clusterPositionsTexture,clusterForceCoefficient:this.clusterForceCoefficientTexture,positionsTexture:this.points.previousPositionTexture});const t=this.device.beginRenderPass({framebuffer:this.points.velocityFbo,clearColor:[0,0,0,0]});this.applyForcesCommand.draw(t),t.end()}destroy(){var e,t,n,r;(e=this.calculateCentermassCommand)==null||e.destroy(),this.calculateCentermassCommand=void 0,(t=this.applyForcesCommand)==null||t.destroy(),this.applyForcesCommand=void 0,this.centermassFbo&&!this.centermassFbo.destroyed&&this.centermassFbo.destroy(),this.centermassFbo=void 0,this.clusterTexture&&!this.clusterTexture.destroyed&&this.clusterTexture.destroy(),this.clusterTexture=void 0,this.clusterPositionsTexture&&!this.clusterPositionsTexture.destroyed&&this.clusterPositionsTexture.destroy(),this.clusterPositionsTexture=void 0,this.clusterForceCoefficientTexture&&!this.clusterForceCoefficientTexture.destroyed&&this.clusterForceCoefficientTexture.destroy(),this.clusterForceCoefficientTexture=void 0,this.centermassTexture&&!this.centermassTexture.destroyed&&this.centermassTexture.destroy(),this.centermassTexture=void 0,(n=this.calculateCentermassUniformStore)==null||n.destroy(),this.calculateCentermassUniformStore=void 0,(r=this.applyForcesUniformStore)==null||r.destroy(),this.applyForcesUniformStore=void 0,this.pointIndices&&!this.pointIndices.destroyed&&this.pointIndices.destroy(),this.pointIndices=void 0,this.applyForcesVertexCoordBuffer&&!this.applyForcesVertexCoordBuffer.destroyed&&this.applyForcesVertexCoordBuffer.destroy(),this.applyForcesVertexCoordBuffer=void 0}}function Qw(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function FP(i){if(Object.prototype.hasOwnProperty.call(i,"__esModule"))return i;var e=i.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var r=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return i[n]}})}),t}var Em={exports:{}},zP=Em.exports,xv;function UP(){return xv||(xv=1,(function(i,e){(function(t,n){i.exports=n()})(zP,function(){var t=`<div class="gl-box">
  <svg viewBox="0 0 55 60">
    <text x="27" y="56" class="gl-fps">00 FPS</text>
    <text x="28" y="8" class="gl-mem"></text>
    <rect x="0" y="14" rx="4" ry="4" width="55" height="32"></rect>
    <polyline class="gl-chart"></polyline>
  </svg>
  <svg viewBox="0 0 14 60" class="gl-cpu-svg">
    <line x1="7" y1="38" x2="7" y2="11" class="opacity"/>
    <line x1="7" y1="38" x2="7" y2="11" class="gl-cpu" stroke-dasharray="0 27"/>
    <path d="M5.35 43c-.464 0-.812.377-.812.812v1.16c-.783.1972-1.421.812-1.595 1.624h-1.16c-.435 0-.812.348-.812.812s.348.812.812.812h1.102v1.653H1.812c-.464 0-.812.377-.812.812 0 .464.377.812.812.812h1.131c.1943.783.812 1.392 1.595 1.595v1.131c0 .464.377.812.812.812.464 0 .812-.377.812-.812V53.15h1.653v1.073c0 .464.377.812.812.812.464 0 .812-.377.812-.812v-1.131c.783-.1943 1.392-.812 1.595-1.595h1.131c.464 0 .812-.377.812-.812 0-.464-.377-.812-.812-.812h-1.073V48.22h1.102c.435 0 .812-.348.812-.812s-.348-.812-.812-.812h-1.16c-.1885-.783-.812-1.421-1.595-1.624v-1.131c0-.464-.377-.812-.812-.812-.464 0-.812.377-.812.812v1.073H6.162v-1.073c0-.464-.377-.812-.812-.812zm.58 3.48h2.088c.754 0 1.363.609 1.363 1.363v2.088c0 .754-.609 1.363-1.363 1.363H5.93c-.754 0-1.363-.609-1.363-1.363v-2.088c0-.754.609-1.363 1.363-1.363z"/>
  </svg>
  <svg viewBox="0 0 14 60" class="gl-gpu-svg">
    <line x1="7" y1="38" x2="7" y2="11" class="opacity"/>
    <line x1="7" y1="38" x2="7" y2="11" class="gl-gpu" stroke-dasharray="0 27"/>
    <path d="M1.94775 43.3772a.736.736 0 10-.00416 1.472c.58535.00231.56465.1288.6348.3197.07015.18975.04933.43585.04933.43585l-.00653.05405v8.671a.736.736 0 101.472 0v-1.4145c.253.09522.52785.1495.81765.1495h5.267c1.2535 0 2.254-.9752 2.254-2.185v-3.105c0-1.2075-1.00625-2.185-2.254-2.185h-5.267c-.28865 0-.5635.05405-.8165.1495.01806-.16445.04209-.598-.1357-1.0787-.22425-.6072-.9499-1.2765-2.0125-1.2765zm2.9095 3.6455c.42435 0 .7659.36225.7659.8119v2.9785c0 .44965-.34155.8119-.7659.8119s-.7659-.36225-.7659-.8119v-2.9785c0-.44965.34155-.8119.7659-.8119zm4.117 0a2.3 2.3 0 012.3 2.3 2.3 2.3 0 01-2.3 2.3 2.3 2.3 0 01-2.3-2.3 2.3 2.3 0 012.3-2.3z"/>
  </svg>
</div>`,n=`#gl-bench {
  position:absolute;
  left:0;
  top:0;
  z-index:1000;
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
}

#gl-bench div {
  position: relative;
  display: block;
  margin: 4px;
  padding: 0 7px 0 10px;
  background: #6c6;
  border-radius: 15px;
  cursor: pointer;
  opacity: 0.9;
}

#gl-bench svg {
  height: 60px;
  margin: 0 -1px;
}

#gl-bench text {
  font-size: 12px;
  font-family: Helvetica,Arial,sans-serif;
  font-weight: 700;
  dominant-baseline: middle;
  text-anchor: middle;
}

#gl-bench .gl-mem {
  font-size: 9px;
}

#gl-bench line {
  stroke-width: 5;
  stroke: #112211;
  stroke-linecap: round;
}

#gl-bench polyline {
  fill: none;
  stroke: #112211;
  stroke-linecap: round;
  stroke-linejoin: round;
  stroke-width: 3.5;
}

#gl-bench rect {
  fill: #448844;
}

#gl-bench .opacity {
  stroke: #448844;
}
`;class r{constructor(s,a={}){this.css=n,this.svg=t,this.paramLogger=()=>{},this.chartLogger=()=>{},this.chartLen=20,this.chartHz=20,this.names=[],this.cpuAccums=[],this.gpuAccums=[],this.activeAccums=[],this.chart=new Array(this.chartLen),this.now=()=>performance&&performance.now?performance.now():Date.now(),this.updateUI=()=>{[].forEach.call(this.nodes["gl-gpu-svg"],d=>{d.style.display=this.trackGPU?"inline":"none"})},Object.assign(this,a),this.detected=0,this.finished=[],this.isFramebuffer=0,this.frameId=0;let l,c=0,u,h=d=>{++c<20?l=requestAnimationFrame(h):(this.detected=Math.ceil(1e3*c/(d-u)/70),cancelAnimationFrame(l)),u||(u=d)};if(requestAnimationFrame(h),s){const d=async(p,b)=>Promise.resolve(setTimeout(()=>{s.getError();const g=this.now()-p;b.forEach((_,T)=>{_&&(this.gpuAccums[T]+=g)})},0)),f=(p,b,g)=>function(){const _=b.now();p.apply(g,arguments),b.trackGPU&&b.finished.push(d(_,b.activeAccums.slice(0)))};["drawArrays","drawElements","drawArraysInstanced","drawBuffers","drawElementsInstanced","drawRangeElements"].forEach(p=>{s[p]&&(s[p]=f(s[p],this,s))}),s.getExtension=((p,b)=>function(){let g=p.apply(s,arguments);return g&&["drawElementsInstancedANGLE","drawBuffersWEBGL"].forEach(_=>{g[_]&&(g[_]=f(g[_],b,g))}),g})(s.getExtension,this)}if(!this.withoutUI){this.dom||(this.dom=document.body);let d=document.createElement("div");d.id="gl-bench",this.dom.appendChild(d),this.dom.insertAdjacentHTML("afterbegin",'<style id="gl-bench-style">'+this.css+"</style>"),this.dom=d,this.dom.addEventListener("click",()=>{this.trackGPU=!this.trackGPU,this.updateUI()}),this.paramLogger=((f,p,b)=>{const g=["gl-cpu","gl-gpu","gl-mem","gl-fps","gl-gpu-svg","gl-chart"],_=Object.assign({},g);return g.forEach(T=>_[T]=p.getElementsByClassName(T)),this.nodes=_,(T,E,y,C,I,F,V)=>{_["gl-cpu"][T].style.strokeDasharray=(E*.27).toFixed(0)+" 100",_["gl-gpu"][T].style.strokeDasharray=(y*.27).toFixed(0)+" 100",_["gl-mem"][T].innerHTML=b[T]?b[T]:C?"mem: "+C.toFixed(0)+"mb":"",_["gl-fps"][T].innerHTML=I.toFixed(0)+" FPS",f(b[T],E,y,C,I,F,V)}})(this.paramLogger,this.dom,this.names),this.chartLogger=((f,p)=>{let b={"gl-chart":p.getElementsByClassName("gl-chart")};return(g,_,T)=>{let E="",y=_.length;for(let C=0;C<y;C++){let I=(T+C+1)%y;_[I]!=null&&(E=E+" "+(55*C/(y-1)).toFixed(1)+","+(45-_[I]*22/60/this.detected).toFixed(1))}b["gl-chart"][g].setAttribute("points",E),f(this.names[g],_,T)}})(this.chartLogger,this.dom)}}addUI(s){this.names.indexOf(s)==-1&&(this.names.push(s),this.dom&&(this.dom.insertAdjacentHTML("beforeend",this.svg),this.updateUI()),this.cpuAccums.push(0),this.gpuAccums.push(0),this.activeAccums.push(!1))}nextFrame(s){this.frameId++;const a=s||this.now();if(this.frameId<=1)this.paramFrame=this.frameId,this.paramTime=a;else{let l=a-this.paramTime;if(l>=1e3){const c=this.frameId-this.paramFrame,u=c/l*1e3;for(let h=0;h<this.names.length;h++){const d=this.cpuAccums[h]/l*100,f=this.gpuAccums[h]/l*100,p=performance&&performance.memory?performance.memory.usedJSHeapSize/(1<<20):0;this.paramLogger(h,d,f,p,u,l,c),this.cpuAccums[h]=0,Promise.all(this.finished).then(()=>{this.gpuAccums[h]=0,this.finished=[]})}this.paramFrame=this.frameId,this.paramTime=a}}if(!this.detected||!this.chartFrame)this.chartFrame=this.frameId,this.chartTime=a,this.circularId=0;else{let l=a-this.chartTime,c=this.chartHz*l/1e3;for(;--c>0&&this.detected;){const u=(this.frameId-this.chartFrame)/l*1e3;this.chart[this.circularId%this.chartLen]=u;for(let h=0;h<this.names.length;h++)this.chartLogger(h,this.chart,this.circularId);this.circularId++,this.chartFrame=this.frameId,this.chartTime=a}}}begin(s){this.updateAccums(s)}end(s){this.updateAccums(s)}updateAccums(s){let a=this.names.indexOf(s);a==-1&&(a=this.names.length,this.addUI(s));const l=this.now(),c=l-this.t0;for(let u=0;u<a+1;u++)this.activeAccums[u]&&(this.cpuAccums[u]+=c);this.activeAccums[a]=!this.activeAccums[a],this.t0=l}}return r})})(Em)),Em.exports}var $P=UP();const VP=Qw($P),HP=`
  #gl-bench {
    position:absolute;
    right:0;
    top:0;
    z-index:1000;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  #gl-bench div {
    position: relative;
    display: block;
    margin: 4px;
    padding: 0 7px 0 10px;
    background: #5f69de;
    border-radius: 15px;
    cursor: pointer;
    opacity: 0.9;
  }
  #gl-bench svg {
    height: 60px;
    margin: 0 -1px;
  }
  #gl-bench text {
    font-size: 12px;
    font-family: Helvetica,Arial,sans-serif;
    font-weight: 700;
    dominant-baseline: middle;
    text-anchor: middle;
  }
  #gl-bench .gl-mem {
    font-size: 9px;
  }
  #gl-bench line {
    stroke-width: 5;
    stroke: #112211;
    stroke-linecap: round;
  }
  #gl-bench polyline {
    fill: none;
    stroke: #112211;
    stroke-linecap: round;
    stroke-linejoin: round;
    stroke-width: 3.5;
  }
  #gl-bench rect {
    fill: #8288e4;
  }
  #gl-bench .opacity {
    stroke: #8288e4;
  }
`;class wv{constructor(e){this.destroy();const t=e.getContext("webgl")||e.getContext("experimental-webgl");this.bench=new VP(t,{css:HP})}begin(){var e;(e=this.bench)==null||e.begin("frame")}end(e){var t,n;(t=this.bench)==null||t.end("frame"),(n=this.bench)==null||n.nextFrame(e)}destroy(){this.bench=void 0,Yt("#gl-bench").remove()}}class GP{constructor(e){this._config=e}get pointsNumber(){return this.pointPositions&&this.pointPositions.length/2}get linksNumber(){return this.links&&this.links.length/2}updatePoints(){this.pointPositions=this.inputPointPositions}updatePointColor(){if(this.pointsNumber===void 0){this.pointColors=void 0;return}const e=Lo(this._config.pointDefaultColor??this._config.pointColor);if(this.inputPointColors===void 0||this.inputPointColors.length/4!==this.pointsNumber){this.pointColors=new Float32Array(this.pointsNumber*4);for(let t=0;t<this.pointColors.length/4;t++)this.pointColors[t*4]=e[0],this.pointColors[t*4+1]=e[1],this.pointColors[t*4+2]=e[2],this.pointColors[t*4+3]=e[3]}else{this.pointColors=this.inputPointColors;for(let t=0;t<this.pointColors.length/4;t++)fn(this.pointColors[t*4])||(this.pointColors[t*4]=e[0]),fn(this.pointColors[t*4+1])||(this.pointColors[t*4+1]=e[1]),fn(this.pointColors[t*4+2])||(this.pointColors[t*4+2]=e[2]),fn(this.pointColors[t*4+3])||(this.pointColors[t*4+3]=e[3])}}updatePointSize(){if(this.pointsNumber===void 0){this.pointSizes=void 0;return}const e=this._config.pointDefaultSize??this._config.pointSize;if(this.inputPointSizes===void 0||this.inputPointSizes.length!==this.pointsNumber)this.pointSizes=new Float32Array(this.pointsNumber).fill(e);else{this.pointSizes=this.inputPointSizes;for(let t=0;t<this.pointSizes.length;t++)fn(this.pointSizes[t])||(this.pointSizes[t]=e)}}updatePointShape(){if(this.pointsNumber===void 0){this.pointShapes=void 0;return}const e=0;if(this.inputPointShapes===void 0||this.inputPointShapes.length!==this.pointsNumber)this.pointShapes=new Float32Array(this.pointsNumber).fill(e);else{this.pointShapes=new Float32Array(this.inputPointShapes);const t=this.pointShapes;for(let n=0;n<t.length;n++){const r=t[n];(r==null||!fn(r)||r<0||r>8)&&(t[n]=e)}}}updatePointImageIndices(){if(this.pointsNumber===void 0){this.pointImageIndices=void 0;return}if(this.inputPointImageIndices===void 0||this.inputPointImageIndices.length!==this.pointsNumber)this.pointImageIndices=new Float32Array(this.pointsNumber).fill(-1);else{const e=new Float32Array(this.inputPointImageIndices);for(let t=0;t<e.length;t++){const n=e[t],r=n===void 0?NaN:n;!Number.isFinite(r)||r<0?e[t]=-1:e[t]=Math.trunc(r)}this.pointImageIndices=e}}updatePointImageSizes(){var e;if(this.pointsNumber===void 0){this.pointImageSizes=void 0;return}const t=this._config.pointDefaultSize??this._config.pointSize;if(this.inputPointImageSizes===void 0||this.inputPointImageSizes.length!==this.pointsNumber)this.pointImageSizes=this.pointSizes?new Float32Array(this.pointSizes):new Float32Array(this.pointsNumber).fill(t);else{this.pointImageSizes=new Float32Array(this.inputPointImageSizes);for(let n=0;n<this.pointImageSizes.length;n++)fn(this.pointImageSizes[n])||(this.pointImageSizes[n]=((e=this.pointSizes)==null?void 0:e[n])??t)}}updateLinks(){this.links=this.inputLinks}updateLinkColor(){if(this.linksNumber===void 0){this.linkColors=void 0;return}const e=Lo(this._config.linkDefaultColor??this._config.linkColor);if(this.inputLinkColors===void 0||this.inputLinkColors.length/4!==this.linksNumber){this.linkColors=new Float32Array(this.linksNumber*4);for(let t=0;t<this.linkColors.length/4;t++)this.linkColors[t*4]=e[0],this.linkColors[t*4+1]=e[1],this.linkColors[t*4+2]=e[2],this.linkColors[t*4+3]=e[3]}else{this.linkColors=this.inputLinkColors;for(let t=0;t<this.linkColors.length/4;t++)fn(this.linkColors[t*4])||(this.linkColors[t*4]=e[0]),fn(this.linkColors[t*4+1])||(this.linkColors[t*4+1]=e[1]),fn(this.linkColors[t*4+2])||(this.linkColors[t*4+2]=e[2]),fn(this.linkColors[t*4+3])||(this.linkColors[t*4+3]=e[3])}}updateLinkWidth(){if(this.linksNumber===void 0){this.linkWidths=void 0;return}const e=this._config.linkDefaultWidth??this._config.linkWidth;if(this.inputLinkWidths===void 0||this.inputLinkWidths.length!==this.linksNumber)this.linkWidths=new Float32Array(this.linksNumber).fill(e);else{this.linkWidths=this.inputLinkWidths;for(let t=0;t<this.linkWidths.length;t++)fn(this.linkWidths[t])||(this.linkWidths[t]=e)}}updateArrows(){if(this.linksNumber===void 0){this.linkArrows=void 0;return}const e=this._config.linkDefaultArrows??this._config.linkArrows;this.linkArrowsBoolean===void 0||this.linkArrowsBoolean.length!==this.linksNumber?this.linkArrows=new Array(this.linksNumber).fill(+e):this.linkArrows=this.linkArrowsBoolean.map(t=>+t)}updateLinkStrength(){this.linksNumber===void 0&&(this.linkStrength=void 0),this.inputLinkStrength===void 0||this.inputLinkStrength.length!==this.linksNumber?this.linkStrength=void 0:this.linkStrength=this.inputLinkStrength}updateClusters(){if(this.pointsNumber===void 0){this.pointClusters=void 0,this.clusterPositions=void 0;return}this.inputPointClusters===void 0||this.inputPointClusters.length!==this.pointsNumber?this.pointClusters=void 0:this.pointClusters=this.inputPointClusters,this.inputClusterPositions===void 0?this.clusterPositions=void 0:this.clusterPositions=this.inputClusterPositions,this.inputClusterStrength===void 0||this.inputClusterStrength.length!==this.pointsNumber?this.clusterStrength=void 0:this.clusterStrength=this.inputClusterStrength}update(){this.updatePoints(),this.updatePointColor(),this.updatePointSize(),this.updatePointShape(),this.updatePointImageIndices(),this.updatePointImageSizes(),this.updateLinks(),this.updateLinkColor(),this.updateLinkWidth(),this.updateArrows(),this.updateLinkStrength(),this.updateClusters(),this._createAdjacencyLists(),this._calculateDegrees()}getAdjacentIndices(e){var t,n,r,o;return[...((n=(t=this.sourceIndexToTargetIndices)==null?void 0:t[e])==null?void 0:n.map(s=>s[0]))||[],...((o=(r=this.targetIndexToSourceIndices)==null?void 0:r[e])==null?void 0:o.map(s=>s[0]))||[]]}_createAdjacencyLists(){var e,t;if(this.linksNumber===void 0||this.links===void 0){this.sourceIndexToTargetIndices=void 0,this.targetIndexToSourceIndices=void 0;return}this.sourceIndexToTargetIndices=new Array(this.pointsNumber).fill(void 0),this.targetIndexToSourceIndices=new Array(this.pointsNumber).fill(void 0);for(let n=0;n<this.linksNumber;n++){const r=this.links[n*2],o=this.links[n*2+1];r!==void 0&&o!==void 0&&(this.sourceIndexToTargetIndices[r]===void 0&&(this.sourceIndexToTargetIndices[r]=[]),(e=this.sourceIndexToTargetIndices[r])==null||e.push([o,n]),this.targetIndexToSourceIndices[o]===void 0&&(this.targetIndexToSourceIndices[o]=[]),(t=this.targetIndexToSourceIndices[o])==null||t.push([r,n]))}}_calculateDegrees(){var e,t,n,r;if(this.pointsNumber===void 0){this.degree=void 0,this.inDegree=void 0,this.outDegree=void 0;return}this.degree=new Array(this.pointsNumber).fill(0),this.inDegree=new Array(this.pointsNumber).fill(0),this.outDegree=new Array(this.pointsNumber).fill(0);for(let o=0;o<this.pointsNumber;o++)this.inDegree[o]=((t=(e=this.targetIndexToSourceIndices)==null?void 0:e[o])==null?void 0:t.length)??0,this.outDegree[o]=((r=(n=this.sourceIndexToTargetIndices)==null?void 0:n[o])==null?void 0:r.length)??0,this.degree[o]=(this.inDegree[o]??0)+(this.outDegree[o]??0)}}const WP=`#version 300 es
#ifdef GL_ES
precision highp float;
#endif

in vec4 rgbaColor;
in vec2 pos;
in float arrowLength;
in float useArrow;
in float smoothing;
in float arrowWidthFactor;
in float linkIndex;

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform drawLineFragmentUniforms {
  float renderMode;
} drawLineFrag;

#define renderMode drawLineFrag.renderMode
#else
// renderMode: 0.0 = normal rendering, 1.0 = index buffer rendering for picking
uniform float renderMode;
#endif

out vec4 fragColor;

float map(float value, float min1, float max1, float min2, float max2) {
  return min2 + (value - min1) * (max2 - min2) / (max1 - min1);
}

void main() {
  float opacity = 1.0;
  vec3 color = rgbaColor.rgb;

  if (useArrow > 0.5) {
    float end_arrow = 0.5 + arrowLength / 2.0;
    float start_arrow = end_arrow - arrowLength;
    float arrowWidthDelta = arrowWidthFactor / 2.0;
    float linkOpacity = rgbaColor.a * smoothstep(0.5 - arrowWidthDelta, 0.5 - arrowWidthDelta - smoothing / 2.0, abs(pos.y));
    float arrowOpacity = 1.0;
    if (pos.x > start_arrow && pos.x < start_arrow + arrowLength) {
      float xmapped = map(pos.x, start_arrow, end_arrow, 0.0, 1.0);
      arrowOpacity = rgbaColor.a * smoothstep(xmapped - smoothing, xmapped, map(abs(pos.y), 0.5, 0.0, 0.0, 1.0));
      if (linkOpacity != arrowOpacity) {
        linkOpacity = max(linkOpacity, arrowOpacity);
      }
    }
    opacity = linkOpacity;
  } else opacity = rgbaColor.a * smoothstep(0.5, 0.5 - smoothing, abs(pos.y));
  
  if (renderMode > 0.0) {
    if (opacity > 0.0) {
      fragColor = vec4(linkIndex, 0.0, 0.0, 1.0);
    } else {
      fragColor = vec4(-1.0, 0.0, 0.0, 0.0);
    }
  } else fragColor = vec4(color, opacity);

}`,jP=`#version 300 es
#ifdef GL_ES
precision highp float;
#endif

in vec2 position, pointA, pointB;
in vec4 color;
in float width;
in float arrow;
in float linkIndices;

uniform sampler2D positionsTexture;
uniform sampler2D pointGreyoutStatus;

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform drawLineUniforms {
  mat4 transformationMatrix;
  float pointsTextureSize;
  float widthScale;
  float linkArrowsSizeScale;
  float spaceSize;
  vec2 screenSize;
  vec2 linkVisibilityDistanceRange;
  float linkVisibilityMinTransparency;
  float linkOpacity;
  float greyoutOpacity;
  float curvedWeight;
  float curvedLinkControlPointDistance;
  float curvedLinkSegments;
  float scaleLinksOnZoom;
  float maxPointSize;
  float renderMode;
  float hoveredLinkIndex;
  vec4 hoveredLinkColor;
  float hoveredLinkWidthIncrease;
} drawLine;

#define transformationMatrix drawLine.transformationMatrix
#define pointsTextureSize drawLine.pointsTextureSize
#define widthScale drawLine.widthScale
#define linkArrowsSizeScale drawLine.linkArrowsSizeScale
#define spaceSize drawLine.spaceSize
#define screenSize drawLine.screenSize
#define linkVisibilityDistanceRange drawLine.linkVisibilityDistanceRange
#define linkVisibilityMinTransparency drawLine.linkVisibilityMinTransparency
#define linkOpacity drawLine.linkOpacity
#define greyoutOpacity drawLine.greyoutOpacity
#define curvedWeight drawLine.curvedWeight
#define curvedLinkControlPointDistance drawLine.curvedLinkControlPointDistance
#define curvedLinkSegments drawLine.curvedLinkSegments
#define scaleLinksOnZoom drawLine.scaleLinksOnZoom
#define maxPointSize drawLine.maxPointSize
#define renderMode drawLine.renderMode
#define hoveredLinkIndex drawLine.hoveredLinkIndex
#define hoveredLinkColor drawLine.hoveredLinkColor
#define hoveredLinkWidthIncrease drawLine.hoveredLinkWidthIncrease
#else
uniform mat3 transformationMatrix;
uniform float pointsTextureSize;
uniform float widthScale;
uniform float linkArrowsSizeScale;
uniform float spaceSize;
uniform vec2 screenSize;
uniform vec2 linkVisibilityDistanceRange;
uniform float linkVisibilityMinTransparency;
uniform float linkOpacity;
uniform float greyoutOpacity;
uniform float curvedWeight;
uniform float curvedLinkControlPointDistance;
uniform float curvedLinkSegments;
uniform bool scaleLinksOnZoom;
uniform float maxPointSize;
// renderMode: 0.0 = normal rendering, 1.0 = index buffer rendering for picking
uniform float renderMode;
uniform float hoveredLinkIndex;
uniform vec4 hoveredLinkColor;
uniform float hoveredLinkWidthIncrease;
#endif

out vec4 rgbaColor;
out vec2 pos;
out float arrowLength;
out float useArrow;
out float smoothing;
out float arrowWidthFactor;
out float linkIndex;

float map(float value, float min1, float max1, float min2, float max2) {
  return min2 + (value - min1) * (max2 - min2) / (max1 - min1);
}

vec2 conicParametricCurve(vec2 A, vec2 B, vec2 ControlPoint, float t, float w) {
  vec2 divident = (1.0 - t) * (1.0 - t) * A + 2.0 * (1.0 - t) * t * w * ControlPoint + t * t * B;
  float divisor = (1.0 - t) * (1.0 - t) + 2.0 * (1.0 - t) * t * w + t * t;
  return divident / divisor;
}

float calculateLinkWidth(float width) {
  float linkWidth;
  if (scaleLinksOnZoom > 0.0) {
    // Use original width if links should scale with zoom
    linkWidth = width;
  } else {
    // Adjust width based on zoom level to maintain visual size
    linkWidth = width / transformationMatrix[0][0];
    // Apply a non-linear scaling to avoid extreme widths
    linkWidth *= min(5.0, max(1.0, transformationMatrix[0][0] * 0.01));
  }
  // Limit link width based on whether it has an arrow
  if (useArrow > 0.5) {
    return min(linkWidth, (maxPointSize * 2.0) / transformationMatrix[0][0]);
  } else {
    return min(linkWidth, maxPointSize / transformationMatrix[0][0]);
  }
}

float calculateArrowWidth(float arrowWidth) {
  if (scaleLinksOnZoom > 0.0) {
    return arrowWidth;
  } else {
    // Apply the same scaling logic as calculateLinkWidth to maintain proportionality
    arrowWidth = arrowWidth / transformationMatrix[0][0];
    // Apply the same non-linear scaling to avoid extreme widths
    arrowWidth *= min(5.0, max(1.0, transformationMatrix[0][0] * 0.01));
    return arrowWidth;
  }
}

void main() {
  pos = position;
  linkIndex = linkIndices;

  vec2 pointTexturePosA = (pointA + 0.5) / pointsTextureSize;
  vec2 pointTexturePosB = (pointB + 0.5) / pointsTextureSize;
  
  vec4 greyoutStatusA = texture(pointGreyoutStatus, pointTexturePosA);
  vec4 greyoutStatusB = texture(pointGreyoutStatus, pointTexturePosB);
  
  vec4 pointPositionA = texture(positionsTexture, pointTexturePosA);
  vec4 pointPositionB = texture(positionsTexture, pointTexturePosB);
  vec2 a = pointPositionA.xy;
  vec2 b = pointPositionB.xy;
  
  // Calculate direction vector and its perpendicular
  vec2 xBasis = b - a;
  vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));

  // Calculate link distance and control point for curved link
  float linkDist = length(xBasis);
  float h = curvedLinkControlPointDistance;
  vec2 controlPoint = (a + b) / 2.0 + yBasis * linkDist * h;

  // Convert link distance to screen pixels
  float linkDistPx = linkDist * transformationMatrix[0][0];
  
  // Calculate line width using the width scale
  float linkWidth = width * widthScale;
  float k = 2.0;
  // Arrow width is proportionally larger than the line width
  float arrowWidth = linkWidth * k;
  arrowWidth *= linkArrowsSizeScale;

  // Ensure arrow width difference is non-negative to prevent unwanted changes to link width
  float arrowWidthDifference = max(0.0, arrowWidth - linkWidth);

  // Calculate arrow width in pixels
  float arrowWidthPx = calculateArrowWidth(arrowWidth);

  // Calculate arrow length proportional to its width
  // 0.866 is approximately sqrt(3)/2 - related to equilateral triangle geometry
  // Cap the length to avoid overly long arrows on short links
  arrowLength = min(0.3, (0.866 * arrowWidthPx * 2.0) / linkDist);

  useArrow = arrow;
  if (useArrow > 0.5) {
    linkWidth += arrowWidthDifference;
  }

  arrowWidthFactor = arrowWidthDifference / linkWidth;

  // Calculate final link width in pixels with smoothing
  float linkWidthPx = calculateLinkWidth(linkWidth);
    
  if (renderMode > 0.0) {
    // Add 5 pixels padding for better hover detection
    linkWidthPx += 5.0 / transformationMatrix[0][0];
  } else {
      // Add pixel increase if this is the hovered link
    if (hoveredLinkIndex == linkIndex) {
      linkWidthPx += hoveredLinkWidthIncrease / transformationMatrix[0][0];
    }
  }
  float smoothingPx = 0.5 / transformationMatrix[0][0];
  smoothing = smoothingPx / linkWidthPx;
  linkWidthPx += smoothingPx;



  // Calculate final color with opacity based on link distance
  vec3 rgbColor = color.rgb;
  // Adjust opacity based on link distance
  float opacity = color.a * linkOpacity * max(linkVisibilityMinTransparency, map(linkDistPx, linkVisibilityDistanceRange.g, linkVisibilityDistanceRange.r, 0.0, 1.0));

  // Apply greyed out opacity if either endpoint is greyed out
  if (greyoutStatusA.r > 0.0 || greyoutStatusB.r > 0.0) {
    opacity *= greyoutOpacity;
  }

  // Pass final color to fragment shader
  rgbaColor = vec4(rgbColor, opacity);

  // Apply hover color if this is the hovered link and hover color is defined
  if (hoveredLinkIndex == linkIndex && hoveredLinkColor.a > -0.5) {
    // Keep existing RGB values but multiply opacity with hover color opacity
    rgbaColor.rgb = hoveredLinkColor.rgb;
    rgbaColor.a *= hoveredLinkColor.a;
  }

  // Calculate position on the curved path
  float t = position.x;
  float w = curvedWeight;
  
  float tPrev = t - 1.0 / curvedLinkSegments;
  float tNext = t + 1.0 / curvedLinkSegments;
  
  vec2 pointCurr = conicParametricCurve(a, b, controlPoint, t, w);
  
  vec2 pointPrev = conicParametricCurve(a, b, controlPoint, max(0.0, tPrev), w);
  vec2 pointNext = conicParametricCurve(a, b, controlPoint, min(tNext, 1.0), w);
  
  vec2 xBasisCurved = pointNext - pointPrev;
  vec2 yBasisCurved = normalize(vec2(-xBasisCurved.y, xBasisCurved.x));
  
  pointCurr += yBasisCurved * linkWidthPx * position.y;
  
  // Transform to clip space coordinates
  vec2 p = 2.0 * pointCurr / spaceSize - 1.0;
  p *= spaceSize / screenSize;
  
  #ifdef USE_UNIFORM_BUFFERS
  mat3 transformMat3 = mat3(transformationMatrix);
  vec3 final = transformMat3 * vec3(p, 1);
  #else
  vec3 final = transformationMatrix * vec3(p, 1);
  #endif
  
  gl_Position = vec4(final.rg, 0, 1);
}`,YP=`#version 300 es
#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D linkIndexTexture;

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform hoveredLineIndexUniforms {
  vec2 mousePosition;
  vec2 screenSize;
} hoveredLine;

#define mousePosition hoveredLine.mousePosition
#define screenSize hoveredLine.screenSize
#else
uniform vec2 mousePosition;
uniform vec2 screenSize;
#endif

out vec4 fragColor;

void main() {
  // Convert mouse position to texture coordinates
  vec2 texCoord = mousePosition / screenSize;
  
  // Read the link index from the linkIndexFbo texture at mouse position
  vec4 linkIndexData = texture(linkIndexTexture, texCoord);
  
  // Extract the link index (stored in the red channel)
  float linkIndex = linkIndexData.r;
  
  // Check if there's a valid link at this position (alpha > 0)
  if (linkIndexData.a > 0.0 && linkIndex >= 0.0) {
    // Output the link index
    fragColor = vec4(linkIndex, 0.0, 0.0, 1.0);
  } else {
    // No link at this position, output -1 to indicate no hover
    fragColor = vec4(-1.0, 0.0, 0.0, 0.0);
  }
} `,qP=`#version 300 es
#ifdef GL_ES
precision highp float;
#endif

in vec2 vertexCoord;

void main() {
  gl_Position = vec4(vertexCoord, 0.0, 1.0);
} `;function mh(i,e){return i==null||e==null?NaN:i<e?-1:i>e?1:i>=e?0:NaN}function XP(i,e){return i==null||e==null?NaN:e<i?-1:e>i?1:e>=i?0:NaN}function Jw(i){let e,t,n;i.length!==2?(e=mh,t=(a,l)=>mh(i(a),l),n=(a,l)=>i(a)-l):(e=i===mh||i===XP?i:KP,t=i,n=i);function r(a,l,c=0,u=a.length){if(c<u){if(e(l,l)!==0)return u;do{const h=c+u>>>1;t(a[h],l)<0?c=h+1:u=h}while(c<u)}return c}function o(a,l,c=0,u=a.length){if(c<u){if(e(l,l)!==0)return u;do{const h=c+u>>>1;t(a[h],l)<=0?c=h+1:u=h}while(c<u)}return c}function s(a,l,c=0,u=a.length){const h=r(a,l,c,u-1);return h>c&&n(a[h-1],l)>-n(a[h],l)?h-1:h}return{left:r,center:s,right:o}}function KP(){return 0}function ZP(i){return i===null?NaN:+i}const QP=Jw(mh),JP=QP.right;Jw(ZP).center;function Sv(i,e){let t,n;for(const r of i)r!=null&&(t===void 0?r>=r&&(t=n=r):(t>r&&(t=r),n<r&&(n=r)));return[t,n]}var Cm=Math.sqrt(50),Tm=Math.sqrt(10),Am=Math.sqrt(2);function eD(i,e,t){var n,r=-1,o,s,a;if(e=+e,i=+i,t=+t,i===e&&t>0)return[i];if((n=e<i)&&(o=i,i=e,e=o),(a=eS(i,e,t))===0||!isFinite(a))return[];if(a>0){let l=Math.round(i/a),c=Math.round(e/a);for(l*a<i&&++l,c*a>e&&--c,s=new Array(o=c-l+1);++r<o;)s[r]=(l+r)*a}else{a=-a;let l=Math.round(i*a),c=Math.round(e*a);for(l/a<i&&++l,c/a>e&&--c,s=new Array(o=c-l+1);++r<o;)s[r]=(l+r)/a}return n&&s.reverse(),s}function eS(i,e,t){var n=(e-i)/Math.max(0,t),r=Math.floor(Math.log(n)/Math.LN10),o=n/Math.pow(10,r);return r>=0?(o>=Cm?10:o>=Tm?5:o>=Am?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(o>=Cm?10:o>=Tm?5:o>=Am?2:1)}function tD(i,e,t){var n=Math.abs(e-i)/Math.max(0,t),r=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),o=n/r;return o>=Cm?r*=10:o>=Tm?r*=5:o>=Am&&(r*=2),e<i?-r:r}function iD(i,e,t){i=+i,e=+e,t=(r=arguments.length)<2?(e=i,i=0,1):r<3?1:+t;for(var n=-1,r=Math.max(0,Math.ceil((e-i)/t))|0,o=new Array(r);++n<r;)o[n]=i+n*t;return o}function tS(i,e){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(e).domain(i);break}return this}function nD(i){return function(){return i}}function rD(i){return+i}var Ev=[0,1];function pr(i){return i}function Im(i,e){return(e-=i=+i)?function(t){return(t-i)/e}:nD(isNaN(e)?NaN:.5)}function oD(i,e){var t;return i>e&&(t=i,i=e,e=t),function(n){return Math.max(i,Math.min(e,n))}}function sD(i,e,t){var n=i[0],r=i[1],o=e[0],s=e[1];return r<n?(n=Im(r,n),o=t(s,o)):(n=Im(n,r),o=t(o,s)),function(a){return o(n(a))}}function aD(i,e,t){var n=Math.min(i.length,e.length)-1,r=new Array(n),o=new Array(n),s=-1;for(i[n]<i[0]&&(i=i.slice().reverse(),e=e.slice().reverse());++s<n;)r[s]=Im(i[s],i[s+1]),o[s]=t(e[s],e[s+1]);return function(a){var l=JP(i,a,1,n)-1;return o[l](r[l](a))}}function iS(i,e){return e.domain(i.domain()).range(i.range()).interpolate(i.interpolate()).clamp(i.clamp()).unknown(i.unknown())}function nS(){var i=Ev,e=Ev,t=Yg,n,r,o,s=pr,a,l,c;function u(){var d=Math.min(i.length,e.length);return s!==pr&&(s=oD(i[0],i[d-1])),a=d>2?aD:sD,l=c=null,h}function h(d){return d==null||isNaN(d=+d)?o:(l||(l=a(i.map(n),e,t)))(n(s(d)))}return h.invert=function(d){return s(r((c||(c=a(e,i.map(n),Un)))(d)))},h.domain=function(d){return arguments.length?(i=Array.from(d,rD),u()):i.slice()},h.range=function(d){return arguments.length?(e=Array.from(d),u()):e.slice()},h.rangeRound=function(d){return e=Array.from(d),t=vk,u()},h.clamp=function(d){return arguments.length?(s=d?!0:pr,u()):s!==pr},h.interpolate=function(d){return arguments.length?(t=d,u()):t},h.unknown=function(d){return arguments.length?(o=d,h):o},function(d,f){return n=d,r=f,u()}}function lD(){return nS()(pr,pr)}function cD(i){return Math.abs(i=Math.round(i))>=1e21?i.toLocaleString("en").replace(/,/g,""):i.toString(10)}function id(i,e){if((t=(i=e?i.toExponential(e-1):i.toExponential()).indexOf("e"))<0)return null;var t,n=i.slice(0,t);return[n.length>1?n[0]+n.slice(2):n,+i.slice(t+1)]}function ka(i){return i=id(Math.abs(i)),i?i[1]:NaN}function uD(i,e){return function(t,n){for(var r=t.length,o=[],s=0,a=i[0],l=0;r>0&&a>0&&(l+a+1>n&&(a=Math.max(1,n-l)),o.push(t.substring(r-=a,r+a)),!((l+=a+1)>n));)a=i[s=(s+1)%i.length];return o.reverse().join(e)}}function hD(i){return function(e){return e.replace(/[0-9]/g,function(t){return i[+t]})}}var dD=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function nd(i){if(!(e=dD.exec(i)))throw new Error("invalid format: "+i);var e;return new d_({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}nd.prototype=d_.prototype;function d_(i){this.fill=i.fill===void 0?" ":i.fill+"",this.align=i.align===void 0?">":i.align+"",this.sign=i.sign===void 0?"-":i.sign+"",this.symbol=i.symbol===void 0?"":i.symbol+"",this.zero=!!i.zero,this.width=i.width===void 0?void 0:+i.width,this.comma=!!i.comma,this.precision=i.precision===void 0?void 0:+i.precision,this.trim=!!i.trim,this.type=i.type===void 0?"":i.type+""}d_.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function fD(i){e:for(var e=i.length,t=1,n=-1,r;t<e;++t)switch(i[t]){case".":n=r=t;break;case"0":n===0&&(n=t),r=t;break;default:if(!+i[t])break e;n>0&&(n=0);break}return n>0?i.slice(0,n)+i.slice(r+1):i}var rS;function pD(i,e){var t=id(i,e);if(!t)return i+"";var n=t[0],r=t[1],o=r-(rS=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,s=n.length;return o===s?n:o>s?n+new Array(o-s+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+id(i,Math.max(0,e+o-1))[0]}function Cv(i,e){var t=id(i,e);if(!t)return i+"";var n=t[0],r=t[1];return r<0?"0."+new Array(-r).join("0")+n:n.length>r+1?n.slice(0,r+1)+"."+n.slice(r+1):n+new Array(r-n.length+2).join("0")}const Tv={"%":(i,e)=>(i*100).toFixed(e),b:i=>Math.round(i).toString(2),c:i=>i+"",d:cD,e:(i,e)=>i.toExponential(e),f:(i,e)=>i.toFixed(e),g:(i,e)=>i.toPrecision(e),o:i=>Math.round(i).toString(8),p:(i,e)=>Cv(i*100,e),r:Cv,s:pD,X:i=>Math.round(i).toString(16).toUpperCase(),x:i=>Math.round(i).toString(16)};function Av(i){return i}var Iv=Array.prototype.map,kv=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function mD(i){var e=i.grouping===void 0||i.thousands===void 0?Av:uD(Iv.call(i.grouping,Number),i.thousands+""),t=i.currency===void 0?"":i.currency[0]+"",n=i.currency===void 0?"":i.currency[1]+"",r=i.decimal===void 0?".":i.decimal+"",o=i.numerals===void 0?Av:hD(Iv.call(i.numerals,String)),s=i.percent===void 0?"%":i.percent+"",a=i.minus===void 0?"":i.minus+"",l=i.nan===void 0?"NaN":i.nan+"";function c(h){h=nd(h);var d=h.fill,f=h.align,p=h.sign,b=h.symbol,g=h.zero,_=h.width,T=h.comma,E=h.precision,y=h.trim,C=h.type;C==="n"?(T=!0,C="g"):Tv[C]||(E===void 0&&(E=12),y=!0,C="g"),(g||d==="0"&&f==="=")&&(g=!0,d="0",f="=");var I=b==="$"?t:b==="#"&&/[boxX]/.test(C)?"0"+C.toLowerCase():"",F=b==="$"?n:/[%p]/.test(C)?s:"",V=Tv[C],q=/[defgprs%]/.test(C);E=E===void 0?6:/[gprs]/.test(C)?Math.max(1,Math.min(21,E)):Math.max(0,Math.min(20,E));function Q(M){var ae=I,ee=F,R,X,O;if(C==="c")ee=V(M)+ee,M="";else{M=+M;var W=M<0||1/M<0;if(M=isNaN(M)?l:V(Math.abs(M),E),y&&(M=fD(M)),W&&+M==0&&p!=="+"&&(W=!1),ae=(W?p==="("?p:a:p==="-"||p==="("?"":p)+ae,ee=(C==="s"?kv[8+rS/3]:"")+ee+(W&&p==="("?")":""),q){for(R=-1,X=M.length;++R<X;)if(O=M.charCodeAt(R),48>O||O>57){ee=(O===46?r+M.slice(R+1):M.slice(R))+ee,M=M.slice(0,R);break}}}T&&!g&&(M=e(M,1/0));var ne=ae.length+M.length+ee.length,Y=ne<_?new Array(_-ne+1).join(d):"";switch(T&&g&&(M=e(Y+M,Y.length?_-ee.length:1/0),Y=""),f){case"<":M=ae+M+ee+Y;break;case"=":M=ae+Y+M+ee;break;case"^":M=Y.slice(0,ne=Y.length>>1)+ae+M+ee+Y.slice(ne);break;default:M=Y+ae+M+ee;break}return o(M)}return Q.toString=function(){return h+""},Q}function u(h,d){var f=c((h=nd(h),h.type="f",h)),p=Math.max(-8,Math.min(8,Math.floor(ka(d)/3)))*3,b=Math.pow(10,-p),g=kv[8+p/3];return function(_){return f(b*_)+g}}return{format:c,formatPrefix:u}}var Lu,oS,sS;gD({thousands:",",grouping:[3],currency:["$",""]});function gD(i){return Lu=mD(i),oS=Lu.format,sS=Lu.formatPrefix,Lu}function _D(i){return Math.max(0,-ka(Math.abs(i)))}function yD(i,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(ka(e)/3)))*3-ka(Math.abs(i)))}function bD(i,e){return i=Math.abs(i),e=Math.abs(e)-i,Math.max(0,ka(e)-ka(i))+1}function vD(i,e,t,n){var r=tD(i,e,t),o;switch(n=nd(n??",f"),n.type){case"s":{var s=Math.max(Math.abs(i),Math.abs(e));return n.precision==null&&!isNaN(o=yD(r,s))&&(n.precision=o),sS(n,s)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=bD(r,Math.max(Math.abs(i),Math.abs(e))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=_D(r))&&(n.precision=o-(n.type==="%")*2);break}}return oS(n)}function aS(i){var e=i.domain;return i.ticks=function(t){var n=e();return eD(n[0],n[n.length-1],t??10)},i.tickFormat=function(t,n){var r=e();return vD(r[0],r[r.length-1],t??10,n)},i.nice=function(t){t==null&&(t=10);var n=e(),r=0,o=n.length-1,s=n[r],a=n[o],l,c,u=10;for(a<s&&(c=s,s=a,a=c,c=r,r=o,o=c);u-- >0;){if(c=eS(s,a,t),c===l)return n[r]=s,n[o]=a,e(n);if(c>0)s=Math.floor(s/c)*c,a=Math.ceil(a/c)*c;else if(c<0)s=Math.ceil(s*c)/c,a=Math.floor(a*c)/c;else break;l=c}return i},i}function km(){var i=lD();return i.copy=function(){return iS(i,km())},tS.apply(i,arguments),aS(i)}function Lv(i){return function(e){return e<0?-Math.pow(-e,i):Math.pow(e,i)}}function xD(i){return i<0?-Math.sqrt(-i):Math.sqrt(i)}function wD(i){return i<0?-i*i:i*i}function SD(i){var e=i(pr,pr),t=1;function n(){return t===1?i(pr,pr):t===.5?i(xD,wD):i(Lv(t),Lv(1/t))}return e.exponent=function(r){return arguments.length?(t=+r,n()):t},aS(e)}function lS(){var i=SD(nS());return i.copy=function(){return iS(i,lS()).exponent(i.exponent())},tS.apply(i,arguments),i}const ED=i=>{const e=lS().exponent(2).range([0,1]).domain([-1,1]),t=iD(0,i).map(r=>-.5+r/i);t.push(.5);const n=new Array(t.length*2);return t.forEach((r,o)=>{n[o*2]=[e(r*2),.5],n[o*2+1]=[e(r*2),-.5]}),n};class CD extends Go{initPrograms(){var e;const{device:t,config:n,store:r}=this;this.updateLinkIndexFbo(),this.hoveredLineIndexTexture||(this.hoveredLineIndexTexture=t.createTexture({width:1,height:1,format:"rgba32float",usage:Ve.SAMPLE|Ve.RENDER|Ve.COPY_DST,data:new Float32Array(4).fill(0)})),this.hoveredLineIndexFbo||(this.hoveredLineIndexFbo=t.createFramebuffer({width:1,height:1,colorAttachments:[this.hoveredLineIndexTexture]})),this.curveLineGeometry||this.updateCurveLineGeometry();const o=this.data.linksNumber??0;this.pointABuffer||(this.pointABuffer=t.createBuffer({data:new Float32Array(o*2),usage:se.VERTEX|se.COPY_DST})),this.pointBBuffer||(this.pointBBuffer=t.createBuffer({data:new Float32Array(o*2),usage:se.VERTEX|se.COPY_DST})),this.colorBuffer||(this.colorBuffer=t.createBuffer({data:new Float32Array(o*4),usage:se.VERTEX|se.COPY_DST})),this.widthBuffer||(this.widthBuffer=t.createBuffer({data:new Float32Array(o),usage:se.VERTEX|se.COPY_DST})),this.arrowBuffer||(this.arrowBuffer=t.createBuffer({data:new Float32Array(o),usage:se.VERTEX|se.COPY_DST})),this.linkIndexBuffer||(this.linkIndexBuffer=t.createBuffer({data:new Float32Array(o),usage:se.VERTEX|se.COPY_DST})),this.drawLineUniformStore||(this.drawLineUniformStore=new Bt({drawLineUniforms:{uniformTypes:{transformationMatrix:"mat4x4<f32>",pointsTextureSize:"f32",widthScale:"f32",linkArrowsSizeScale:"f32",spaceSize:"f32",screenSize:"vec2<f32>",linkVisibilityDistanceRange:"vec2<f32>",linkVisibilityMinTransparency:"f32",linkOpacity:"f32",greyoutOpacity:"f32",curvedWeight:"f32",curvedLinkControlPointDistance:"f32",curvedLinkSegments:"f32",scaleLinksOnZoom:"f32",maxPointSize:"f32",renderMode:"f32",hoveredLinkIndex:"f32",hoveredLinkColor:"vec4<f32>",hoveredLinkWidthIncrease:"f32"},defaultUniforms:{transformationMatrix:r.transformationMatrix4x4,pointsTextureSize:r.pointsTextureSize,widthScale:n.linkWidthScale??1,linkArrowsSizeScale:n.linkArrowsSizeScale??1,spaceSize:r.adjustedSpaceSize??0,screenSize:Ke(r.screenSize,[0,0]),linkVisibilityDistanceRange:Ke(n.linkVisibilityDistanceRange,[0,0]),linkVisibilityMinTransparency:n.linkVisibilityMinTransparency??0,linkOpacity:n.linkOpacity??1,greyoutOpacity:n.linkGreyoutOpacity??1,curvedWeight:n.curvedLinkWeight??0,curvedLinkControlPointDistance:n.curvedLinkControlPointDistance??0,curvedLinkSegments:n.curvedLinks?n.curvedLinkSegments??re.curvedLinkSegments:1,scaleLinksOnZoom:n.scaleLinksOnZoom??!0?1:0,maxPointSize:r.maxPointSize??100,renderMode:0,hoveredLinkIndex:r.hoveredLinkIndex??-1,hoveredLinkColor:ni(r.hoveredLinkColor,[-1,-1,-1,-1]),hoveredLinkWidthIncrease:n.hoveredLinkWidthIncrease??0}},drawLineFragmentUniforms:{uniformTypes:{renderMode:"f32"},defaultUniforms:{renderMode:0}}})),this.drawCurveCommand||(this.drawCurveCommand=new Ft(t,{vs:jP,fs:WP,topology:"triangle-strip",vertexCount:((e=this.curveLineGeometry)==null?void 0:e.length)??0,attributes:{...this.curveLineBuffer&&{position:this.curveLineBuffer},...this.pointABuffer&&{pointA:this.pointABuffer},...this.pointBBuffer&&{pointB:this.pointBBuffer},...this.colorBuffer&&{color:this.colorBuffer},...this.widthBuffer&&{width:this.widthBuffer},...this.arrowBuffer&&{arrow:this.arrowBuffer},...this.linkIndexBuffer&&{linkIndices:this.linkIndexBuffer}},bufferLayout:[{name:"position",format:"float32x2"},{name:"pointA",format:"float32x2",stepMode:"instance"},{name:"pointB",format:"float32x2",stepMode:"instance"},{name:"color",format:"float32x4",stepMode:"instance"},{name:"width",format:"float32",stepMode:"instance"},{name:"arrow",format:"float32",stepMode:"instance"},{name:"linkIndices",format:"float32",stepMode:"instance"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{drawLineUniforms:this.drawLineUniformStore.getManagedUniformBuffer(t,"drawLineUniforms"),drawLineFragmentUniforms:this.drawLineUniformStore.getManagedUniformBuffer(t,"drawLineFragmentUniforms")},parameters:{cullMode:"back",blend:!0,blendColorOperation:"add",blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaOperation:"add",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",depthWriteEnabled:!1,depthCompare:"always"}})),this.quadBuffer||(this.quadBuffer=t.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1]),usage:se.VERTEX|se.COPY_DST})),this.hoveredLineIndexUniformStore||(this.hoveredLineIndexUniformStore=new Bt({hoveredLineIndexUniforms:{uniformTypes:{mousePosition:"vec2<f32>",screenSize:"vec2<f32>"},defaultUniforms:{mousePosition:Ke(r.screenMousePosition,[0,0]),screenSize:Ke(r.screenSize,[0,0])}}})),this.hoveredLineIndexCommand||(this.hoveredLineIndexCommand=new Ft(t,{vs:qP,fs:YP,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.quadBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{hoveredLineIndexUniforms:this.hoveredLineIndexUniformStore.getManagedUniformBuffer(t,"hoveredLineIndexUniforms")}}))}draw(e){const{config:t,points:n,store:r}=this;n&&(!n.currentPositionTexture||n.currentPositionTexture.destroyed||!n.greyoutStatusTexture||n.greyoutStatusTexture.destroyed||((!this.pointABuffer||!this.pointBBuffer)&&this.updatePointsBuffer(),this.colorBuffer||this.updateColor(),this.widthBuffer||this.updateWidth(),this.arrowBuffer||this.updateArrow(),this.curveLineGeometry||this.updateCurveLineGeometry(),!(!this.drawCurveCommand||!this.drawLineUniformStore)&&(this.drawLineUniformStore.setUniforms({drawLineUniforms:{transformationMatrix:r.transformationMatrix4x4,pointsTextureSize:r.pointsTextureSize,widthScale:t.linkWidthScale??1,linkArrowsSizeScale:t.linkArrowsSizeScale??1,spaceSize:r.adjustedSpaceSize??0,screenSize:Ke(r.screenSize,[0,0]),linkVisibilityDistanceRange:Ke(t.linkVisibilityDistanceRange,[0,0]),linkVisibilityMinTransparency:t.linkVisibilityMinTransparency??0,linkOpacity:t.linkOpacity??1,greyoutOpacity:t.linkGreyoutOpacity??1,curvedWeight:t.curvedLinkWeight??0,curvedLinkControlPointDistance:t.curvedLinkControlPointDistance??0,curvedLinkSegments:t.curvedLinks?t.curvedLinkSegments??re.curvedLinkSegments:1,scaleLinksOnZoom:t.scaleLinksOnZoom??!0?1:0,maxPointSize:r.maxPointSize??100,renderMode:0,hoveredLinkIndex:r.hoveredLinkIndex??-1,hoveredLinkColor:ni(r.hoveredLinkColor,[-1,-1,-1,-1]),hoveredLinkWidthIncrease:t.hoveredLinkWidthIncrease??0},drawLineFragmentUniforms:{renderMode:0}}),this.drawCurveCommand.setBindings({positionsTexture:n.currentPositionTexture,pointGreyoutStatus:n.greyoutStatusTexture}),this.drawCurveCommand.setInstanceCount(this.data.linksNumber??0),this.drawCurveCommand.draw(e))))}updateLinkIndexFbo(){var e,t;const{device:n,store:r}=this;if(!this.store.isLinkHoveringEnabled)return;const o=r.screenSize??[0,0],s=o[0],a=o[1];if(!s||!a)return;const l=((e=this.previousScreenSize)==null?void 0:e[0])!==s||((t=this.previousScreenSize)==null?void 0:t[1])!==a;(!this.linkIndexTexture||l)&&(this.linkIndexFbo&&!this.linkIndexFbo.destroyed&&this.linkIndexFbo.destroy(),this.linkIndexTexture&&!this.linkIndexTexture.destroyed&&this.linkIndexTexture.destroy(),this.linkIndexTexture=n.createTexture({width:s,height:a,format:"rgba32float",usage:Ve.SAMPLE|Ve.RENDER|Ve.COPY_DST}),this.linkIndexTexture.copyImageData({data:new Float32Array(s*a*4).fill(0),bytesPerRow:Ue("rgba32float",s),mipLevel:0,x:0,y:0}),this.linkIndexFbo=n.createFramebuffer({width:s,height:a,colorAttachments:[this.linkIndexTexture]}),this.previousScreenSize=[s,a])}updatePointsBuffer(){var e;const{device:t,data:n,store:r}=this;if(n.linksNumber===void 0||n.links===void 0||!r.pointsTextureSize)return;const o=new Float32Array(n.linksNumber*2),s=new Float32Array(n.linksNumber*2);for(let c=0;c<n.linksNumber;c++){const u=n.links[c*2],h=n.links[c*2+1],d=u%r.pointsTextureSize,f=Math.floor(u/r.pointsTextureSize),p=h%r.pointsTextureSize,b=Math.floor(h/r.pointsTextureSize);o[c*2]=d,o[c*2+1]=f,s[c*2]=p,s[c*2+1]=b}const a=(((e=this.pointABuffer)==null?void 0:e.byteLength)??0)/(Float32Array.BYTES_PER_ELEMENT*2);!this.pointABuffer||a!==n.linksNumber?(this.pointABuffer&&!this.pointABuffer.destroyed&&this.pointABuffer.destroy(),this.pointABuffer=t.createBuffer({data:o,usage:se.VERTEX|se.COPY_DST})):this.pointABuffer.write(o),!this.pointBBuffer||a!==n.linksNumber?(this.pointBBuffer&&!this.pointBBuffer.destroyed&&this.pointBBuffer.destroy(),this.pointBBuffer=t.createBuffer({data:s,usage:se.VERTEX|se.COPY_DST})):this.pointBBuffer.write(s);const l=new Float32Array(n.linksNumber);for(let c=0;c<n.linksNumber;c++)l[c]=c;!this.linkIndexBuffer||a!==n.linksNumber?(this.linkIndexBuffer&&!this.linkIndexBuffer.destroyed&&this.linkIndexBuffer.destroy(),this.linkIndexBuffer=t.createBuffer({data:l,usage:se.VERTEX|se.COPY_DST})):this.linkIndexBuffer.write(l),this.drawCurveCommand&&this.drawCurveCommand.setAttributes({pointA:this.pointABuffer,pointB:this.pointBBuffer,linkIndices:this.linkIndexBuffer})}updateColor(){const{device:e,data:t}=this,n=t.linksNumber??0,r=t.linkColors??new Float32Array(n*4).fill(0);this.colorBuffer?(this.colorBuffer.byteLength??0)/(Float32Array.BYTES_PER_ELEMENT*4)!==n?(this.colorBuffer&&!this.colorBuffer.destroyed&&this.colorBuffer.destroy(),this.colorBuffer=e.createBuffer({data:r,usage:se.VERTEX|se.COPY_DST})):this.colorBuffer.write(r):this.colorBuffer=e.createBuffer({data:r,usage:se.VERTEX|se.COPY_DST}),this.drawCurveCommand&&this.drawCurveCommand.setAttributes({color:this.colorBuffer})}updateWidth(){const{device:e,data:t}=this,n=t.linksNumber??0,r=t.linkWidths??new Float32Array(n).fill(0);this.widthBuffer?(this.widthBuffer.byteLength??0)/Float32Array.BYTES_PER_ELEMENT!==n?(this.widthBuffer&&!this.widthBuffer.destroyed&&this.widthBuffer.destroy(),this.widthBuffer=e.createBuffer({data:r,usage:se.VERTEX|se.COPY_DST})):this.widthBuffer.write(r):this.widthBuffer=e.createBuffer({data:r,usage:se.VERTEX|se.COPY_DST}),this.drawCurveCommand&&this.drawCurveCommand.setAttributes({width:this.widthBuffer})}updateArrow(){const{device:e,data:t}=this,n=t.linksNumber??0,r=t.linkArrows?new Float32Array(t.linkArrows):new Float32Array(n).fill(0);this.arrowBuffer?(this.arrowBuffer.byteLength??0)/Float32Array.BYTES_PER_ELEMENT!==n?(this.arrowBuffer&&!this.arrowBuffer.destroyed&&this.arrowBuffer.destroy(),this.arrowBuffer=e.createBuffer({data:r,usage:se.VERTEX|se.COPY_DST})):this.arrowBuffer.write(r):this.arrowBuffer=e.createBuffer({data:r,usage:se.VERTEX|se.COPY_DST}),this.drawCurveCommand&&this.drawCurveCommand.setAttributes({arrow:this.arrowBuffer})}updateCurveLineGeometry(){var e;const{device:t,config:{curvedLinks:n,curvedLinkSegments:r}}=this;this.curveLineGeometry=ED(n?r??re.curvedLinkSegments:1);const o=new Float32Array(this.curveLineGeometry.length*2);for(let s=0;s<this.curveLineGeometry.length;s++)o[s*2]=this.curveLineGeometry[s][0],o[s*2+1]=this.curveLineGeometry[s][1];!this.curveLineBuffer||this.curveLineBuffer.byteLength!==o.byteLength?((e=this.curveLineBuffer)==null||e.destroy(),this.curveLineBuffer=t.createBuffer({data:o,usage:se.VERTEX|se.COPY_DST})):this.curveLineBuffer.write(o),this.drawCurveCommand&&(this.drawCurveCommand.setAttributes({position:this.curveLineBuffer}),this.drawCurveCommand.setVertexCount(this.curveLineGeometry.length))}findHoveredLine(){const{config:e,points:t,store:n}=this;if(!t||!t.currentPositionTexture||t.currentPositionTexture.destroyed||!t.greyoutStatusTexture||t.greyoutStatusTexture.destroyed||!this.data.linksNumber||!this.store.isLinkHoveringEnabled||!this.linkIndexFbo||!this.drawCurveCommand||!this.drawLineUniformStore||!this.linkIndexTexture||this.linkIndexTexture.destroyed)return;this.drawLineUniformStore.setUniforms({drawLineUniforms:{transformationMatrix:n.transformationMatrix4x4,pointsTextureSize:n.pointsTextureSize,widthScale:e.linkWidthScale??1,linkArrowsSizeScale:e.linkArrowsSizeScale??1,spaceSize:n.adjustedSpaceSize??0,screenSize:Ke(n.screenSize,[0,0]),linkVisibilityDistanceRange:Ke(e.linkVisibilityDistanceRange,[0,0]),linkVisibilityMinTransparency:e.linkVisibilityMinTransparency??0,linkOpacity:e.linkOpacity??1,greyoutOpacity:e.linkGreyoutOpacity??1,curvedWeight:e.curvedLinkWeight??0,curvedLinkControlPointDistance:e.curvedLinkControlPointDistance??0,curvedLinkSegments:e.curvedLinks?e.curvedLinkSegments??re.curvedLinkSegments:1,scaleLinksOnZoom:e.scaleLinksOnZoom??!0?1:0,maxPointSize:n.maxPointSize??100,renderMode:1,hoveredLinkIndex:n.hoveredLinkIndex??-1,hoveredLinkColor:ni(n.hoveredLinkColor,[-1,-1,-1,-1]),hoveredLinkWidthIncrease:e.hoveredLinkWidthIncrease??0},drawLineFragmentUniforms:{renderMode:1}}),this.drawCurveCommand.setBindings({positionsTexture:t.currentPositionTexture,pointGreyoutStatus:t.greyoutStatusTexture}),this.drawCurveCommand.setInstanceCount(this.data.linksNumber??0);const r=this.device.beginRenderPass({framebuffer:this.linkIndexFbo,clearColor:[0,0,0,0]});if(this.drawCurveCommand.draw(r),r.end(),this.hoveredLineIndexCommand&&this.hoveredLineIndexFbo&&this.hoveredLineIndexUniformStore){this.hoveredLineIndexUniformStore.setUniforms({hoveredLineIndexUniforms:{mousePosition:Ke(n.screenMousePosition,[0,0]),screenSize:Ke(n.screenSize,[0,0])}}),this.hoveredLineIndexCommand.setBindings({linkIndexTexture:this.linkIndexTexture});const o=this.device.beginRenderPass({framebuffer:this.hoveredLineIndexFbo});this.hoveredLineIndexCommand.draw(o),o.end()}}destroy(){var e,t,n,r;(e=this.drawCurveCommand)==null||e.destroy(),this.drawCurveCommand=void 0,(t=this.hoveredLineIndexCommand)==null||t.destroy(),this.hoveredLineIndexCommand=void 0,this.linkIndexFbo&&!this.linkIndexFbo.destroyed&&this.linkIndexFbo.destroy(),this.linkIndexFbo=void 0,this.hoveredLineIndexFbo&&!this.hoveredLineIndexFbo.destroyed&&this.hoveredLineIndexFbo.destroy(),this.hoveredLineIndexFbo=void 0,this.linkIndexTexture&&!this.linkIndexTexture.destroyed&&this.linkIndexTexture.destroy(),this.linkIndexTexture=void 0,this.hoveredLineIndexTexture&&!this.hoveredLineIndexTexture.destroyed&&this.hoveredLineIndexTexture.destroy(),this.hoveredLineIndexTexture=void 0,(n=this.drawLineUniformStore)==null||n.destroy(),this.drawLineUniformStore=void 0,(r=this.hoveredLineIndexUniformStore)==null||r.destroy(),this.hoveredLineIndexUniformStore=void 0,this.pointABuffer&&!this.pointABuffer.destroyed&&this.pointABuffer.destroy(),this.pointABuffer=void 0,this.pointBBuffer&&!this.pointBBuffer.destroyed&&this.pointBBuffer.destroy(),this.pointBBuffer=void 0,this.colorBuffer&&!this.colorBuffer.destroyed&&this.colorBuffer.destroy(),this.colorBuffer=void 0,this.widthBuffer&&!this.widthBuffer.destroyed&&this.widthBuffer.destroy(),this.widthBuffer=void 0,this.arrowBuffer&&!this.arrowBuffer.destroyed&&this.arrowBuffer.destroy(),this.arrowBuffer=void 0,this.curveLineBuffer&&!this.curveLineBuffer.destroyed&&this.curveLineBuffer.destroy(),this.curveLineBuffer=void 0,this.linkIndexBuffer&&!this.linkIndexBuffer.destroyed&&this.linkIndexBuffer.destroy(),this.linkIndexBuffer=void 0,this.quadBuffer&&!this.quadBuffer.destroyed&&this.quadBuffer.destroy(),this.quadBuffer=void 0}}const TD=`#version 300 es
#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D imageAtlasTexture;

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform drawFragmentUniforms {
  float greyoutOpacity;
  float pointOpacity;
  float isDarkenGreyout;
  vec4 backgroundColor;
} drawFragment;

#define greyoutOpacity drawFragment.greyoutOpacity
#define pointOpacity drawFragment.pointOpacity
#define isDarkenGreyout drawFragment.isDarkenGreyout
#define backgroundColor drawFragment.backgroundColor
#else
uniform float greyoutOpacity;
uniform float pointOpacity;
uniform float isDarkenGreyout;
uniform vec4 backgroundColor;
#endif


in float pointShape;
in float isGreyedOut;
in vec4 shapeColor;
in vec4 imageAtlasUV;
in float shapeSize;
in float imageSizeVarying;
in float overallSize;

out vec4 fragColor;

// Smoothing controls the smoothness of the point's edge
const float smoothing = 0.9;

// Shape constants
const float CIRCLE = 0.0;
const float SQUARE = 1.0;
const float TRIANGLE = 2.0;
const float DIAMOND = 3.0;
const float PENTAGON = 4.0;
const float HEXAGON = 5.0;
const float STAR = 6.0;
const float CROSS = 7.0;
const float NONE = 8.0;

// Distance functions for different shapes
float circleDistance(vec2 p) {
    return dot(p, p);
}

// Function to apply greyout logic to image colors
vec4 applyGreyoutToImage(vec4 imageColor, float isGreyedOutValue) {
    vec3 finalColor = imageColor.rgb;
    float finalAlpha = imageColor.a;
    
    if (isGreyedOutValue > 0.0) {
        float blendFactor = 0.65; // Controls how much to modify (0.0 = original, 1.0 = target color)
        
        if (isDarkenGreyout > 0.0) {
            finalColor = mix(finalColor, vec3(0.2), blendFactor);
        } else {
            finalColor = mix(finalColor, max(backgroundColor.rgb, vec3(0.8)), blendFactor);
        }
    }
    
    return vec4(finalColor, finalAlpha);
}

float squareDistance(vec2 p) {
    vec2 d = abs(p) - vec2(0.8);
    return length(max(d, 0.0)) + min(max(d.x, d.y), 0.0);
}

float triangleDistance(vec2 p) {
    const float k = sqrt(3.0);   // 1.732; slope of 60 lines for an equilateral triangle
    p.x = abs(p.x) - 0.9;        // fold the X axis and shift: brings left and right halves together
    p.y = p.y + 0.55;             // move the whole shape up slightly so it is centred vertically

    // reflect points that fall outside the main triangle back inside, to reuse the same maths
    if (p.x + k * p.y > 0.0)
        p = vec2(p.x - k * p.y,  -k * p.x - p.y) / 2.0;

    p.x -= clamp(p.x, -1.0, 0.0); // clip any remainder on the left side

    // Return signed distance: negative = inside; positive = outside
    return -length(p) * sign(p.y);
}

float diamondDistance(vec2 p) {
    // aspect > 1    taller diamond
    const float aspect = 1.2;
    return abs(p.x) + abs(p.y) / aspect - 0.8;
}

float pentagonDistance(vec2 p) {
    // Regular pentagon signed-distance (Inigo Quilez)
    const vec3 k = vec3(0.809016994, 0.587785252, 0.726542528);
    p.x = abs(p.x);

    // Reflect across the two tilted edges  only if point is outside
    p -= 2.0 * min(dot(vec2(-k.x, k.y), p), 0.0) * vec2(-k.x, k.y);
    p -= 2.0 * min(dot(vec2( k.x, k.y), p), 0.0) * vec2( k.x, k.y);

    // Clip against the top horizontal edge (keeps top point sharp)
    p -= vec2(clamp(p.x, -k.z * k.x, k.z * k.x), k.z);

    // Return signed distance (negative  inside, positive  outside)
    return length(p) * sign(p.y);
}

float hexagonDistance(vec2 p) {
    const vec3 k = vec3(-0.866025404, 0.5, 0.577350269);
    p = abs(p);
    p -= 2.0 * min(dot(k.xy, p), 0.0) * k.xy;
    p -= vec2(clamp(p.x, -k.z * 0.8, k.z * 0.8), 0.8);
    return length(p) * sign(p.y);
}

float starDistance(vec2 p) {
    // 5-point star signed-distance function (adapted from Inigo Quilez)
    // r   outer radius, rf  inner/outer radius ratio
    const float r  = 0.9;
    const float rf = 0.45;

    // Pre-computed rotation vectors for the star arms (36 increments)
    const vec2 k1 = vec2(0.809016994, -0.587785252);
    const vec2 k2 = vec2(-k1.x, k1.y);

    // Fold the plane into a single arm sector
    p.x = abs(p.x);
    p -= 2.0 * max(dot(k1, p), 0.0) * k1;
    p -= 2.0 * max(dot(k2, p), 0.0) * k2;
    p.x = abs(p.x);

    // Translate so the top tip of the star lies on the X-axis
    p.y -= r;

    // Vector describing the edge between an outer tip and its adjacent inner point
    vec2 ba = rf * vec2(-k1.y, k1.x) - vec2(0.0, 1.0);
    // Project the point onto that edge and clamp the projection to the segment
    float h = clamp(dot(p, ba) / dot(ba, ba), 0.0, r);

    // Return signed distance (negative => inside, positive => outside)
    return length(p - ba * h) * sign(p.y * ba.x - p.x * ba.y);
}

float crossDistance(vec2 p) {
    // Signed distance function for a cross (union of two rectangles)
    // Adapted from Inigo Quilez (https://iquilezles.org/)
    // Each arm has half-sizes 0.3 (thickness) and 0.8 (length)
    p = abs(p);
    if (p.y > p.x) p = p.yx;       // exploit symmetry

    vec2 q = p - vec2(0.8, 0.3);   // subtract half-sizes (length, thickness)

    // Standard rectangle SDF, then take union of the two arms
    return length(max(q, 0.0)) + min(max(q.x, q.y), 0.0);
}

float getShapeDistance(vec2 p, float shape) {
    if (shape == SQUARE) return squareDistance(p);
    else if (shape == TRIANGLE) return triangleDistance(p);
    else if (shape == DIAMOND) return diamondDistance(p);
    else if (shape == PENTAGON) return pentagonDistance(p);
    else if (shape == HEXAGON) return hexagonDistance(p);
    else if (shape == STAR) return starDistance(p);
    else if (shape == CROSS) return crossDistance(p);
    else return circleDistance(p); // Default to circle
}

void main() {
    // Discard the fragment if the point is fully transparent and has no image
    if (shapeColor.a == 0.0 && imageAtlasUV.x == -1.0) {
        discard;
    }

    // Discard the fragment if the point has no shape and no image
    if (pointShape == NONE && imageAtlasUV.x == -1.0) {
        discard;
    }

    // Calculate coordinates within the point
    vec2 pointCoord = 2.0 * gl_PointCoord - 1.0;

    vec4 finalShapeColor = vec4(0.0);
    vec4 finalImageColor = vec4(0.0);
    
    // Handle shape rendering with centering logic
    if (pointShape != NONE) {
        // Calculate shape coordinates with centering
        vec2 shapeCoord = pointCoord;
        if (overallSize > shapeSize && shapeSize > 0.0) {
            // Shape is smaller than overall size, center it
            float scale = shapeSize / overallSize;
            shapeCoord = pointCoord / scale;
        }
        
        float opacity;
        if (pointShape == CIRCLE) {
            // For circles, use the original distance calculation
            float pointCenterDistance = dot(shapeCoord, shapeCoord);
            opacity = 1.0 - smoothstep(smoothing, 1.0, pointCenterDistance);
        } else {
            // For other shapes, use the shape distance function
            float shapeDistance = getShapeDistance(shapeCoord, pointShape);
            opacity = 1.0 - smoothstep(-0.01, 0.01, shapeDistance);
        }
        opacity *= shapeColor.a;

        finalShapeColor = vec4(shapeColor.rgb, opacity);
    }

    // Handle image rendering with centering logic
    if (imageAtlasUV.x != -1.0) {
        // Calculate image coordinates with centering
        vec2 imageCoord = pointCoord;
        if (overallSize > imageSizeVarying && imageSizeVarying > 0.0) {
            // Image is smaller than overall size, center it
            float scale = imageSizeVarying / overallSize;
            imageCoord = pointCoord / scale;
            
            // Check if we're outside the valid image area
            if (abs(imageCoord.x) > 1.0 || abs(imageCoord.y) > 1.0) {
                // We're outside the image bounds, don't render the image
                finalImageColor = vec4(0.0);
            } else {
                // Sample from texture atlas
                vec2 atlasUV = mix(imageAtlasUV.xy, imageAtlasUV.zw, (imageCoord + 1.0) * 0.5);
                vec4 imageColor = texture(imageAtlasTexture, atlasUV);
                finalImageColor = applyGreyoutToImage(imageColor, isGreyedOut);
            }
        } else {
            // Image is same size or larger than overall size, no scaling needed
            // Sample from texture atlas
            vec2 atlasUV = mix(imageAtlasUV.xy, imageAtlasUV.zw, (imageCoord + 1.0) * 0.5);
            vec4 imageColor = texture(imageAtlasTexture, atlasUV);
            finalImageColor = applyGreyoutToImage(imageColor, isGreyedOut);
        }
    }

    float finalPointAlpha = max(finalShapeColor.a, finalImageColor.a);
    if (isGreyedOut > 0.0 && greyoutOpacity != -1.0) {
        finalPointAlpha *= greyoutOpacity;
    } else {
        finalPointAlpha *= pointOpacity;
    }

    // Blend image color above point color
    fragColor = vec4(
        mix(finalShapeColor.rgb, finalImageColor.rgb, finalImageColor.a),
        finalPointAlpha
    );
}
`,AD=`#version 300 es
#ifdef GL_ES
precision highp float;
#endif

in vec2 pointIndices;
in float size;
in vec4 color;
in float shape;
in float imageIndex;
in float imageSize;

uniform sampler2D positionsTexture;
uniform sampler2D pointGreyoutStatus;
uniform sampler2D imageAtlasCoords;

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform drawVertexUniforms {
  float ratio;
  mat4 transformationMatrix;
  float pointsTextureSize;
  float sizeScale;
  float spaceSize;
  vec2 screenSize;
  vec4 greyoutColor;
  vec4 backgroundColor;
  float scalePointsOnZoom;
  float maxPointSize;
  float isDarkenGreyout;
  float skipSelected;
  float skipUnselected;
  float hasImages;
  float imageCount;
  float imageAtlasCoordsTextureSize;
} drawVertex;

#define ratio drawVertex.ratio
#define transformationMatrix drawVertex.transformationMatrix
#define pointsTextureSize drawVertex.pointsTextureSize
#define sizeScale drawVertex.sizeScale
#define spaceSize drawVertex.spaceSize
#define screenSize drawVertex.screenSize
#define greyoutColor drawVertex.greyoutColor
#define backgroundColor drawVertex.backgroundColor
#define scalePointsOnZoom drawVertex.scalePointsOnZoom
#define maxPointSize drawVertex.maxPointSize
#define isDarkenGreyout drawVertex.isDarkenGreyout
#define skipSelected drawVertex.skipSelected
#define skipUnselected drawVertex.skipUnselected
#define hasImages drawVertex.hasImages
#define imageCount drawVertex.imageCount
#define imageAtlasCoordsTextureSize drawVertex.imageAtlasCoordsTextureSize
#else
uniform float ratio;
uniform mat3 transformationMatrix;
uniform float pointsTextureSize;
uniform float sizeScale;
uniform float spaceSize;
uniform vec2 screenSize;
uniform vec4 greyoutColor;
uniform vec4 backgroundColor;
uniform float scalePointsOnZoom;
uniform float maxPointSize;
uniform float isDarkenGreyout;
uniform float skipSelected;
uniform float skipUnselected;
uniform float hasImages;
uniform float imageCount;
uniform float imageAtlasCoordsTextureSize;
#endif

out float pointShape;
out float isGreyedOut;
out vec4 shapeColor;
out vec4 imageAtlasUV;
out float shapeSize;
out float imageSizeVarying;
out float overallSize;

float calculatePointSize(float size) {
  float pSize;

  if (scalePointsOnZoom > 0.0) { 
    pSize = size * ratio * transformationMatrix[0][0];
  } else {
    pSize = size * ratio * min(5.0, max(1.0, transformationMatrix[0][0] * 0.01));
  }

  return min(pSize, maxPointSize * ratio);
}

void main() {    
  // Check greyout status for selective rendering
  vec4 greyoutStatus = texture(pointGreyoutStatus, (pointIndices + 0.5) / pointsTextureSize);
  isGreyedOut = greyoutStatus.r;
  float isSelected = (greyoutStatus.r == 0.0) ? 1.0 : 0.0;
  
  // Discard point based on rendering mode
  if (skipSelected > 0.0 && isSelected > 0.0) {
    gl_Position = vec4(2.0, 2.0, 2.0, 1.0); // Move off-screen
    gl_PointSize = 0.0;
    return;
  }
  if (skipUnselected > 0.0 && isSelected <= 0.0) {
    gl_Position = vec4(2.0, 2.0, 2.0, 1.0); // Move off-screen
    gl_PointSize = 0.0;
    return;
  }
  
  // Position
  vec4 pointPosition = texture(positionsTexture, (pointIndices + 0.5) / pointsTextureSize);
  vec2 point = pointPosition.rg;

  // Transform point position to normalized device coordinates
  // Convert from space coordinates [0, spaceSize] to normalized [-1, 1]
  vec2 normalizedPosition = 2.0 * point / spaceSize - 1.0;
  
  // Apply aspect ratio correction - this is needed to map the square space to the rectangular screen
  // The transformation matrix handles zoom/pan, but we need this to handle aspect ratio
  normalizedPosition *= spaceSize / screenSize;
  
  #ifdef USE_UNIFORM_BUFFERS
  mat3 transformMat3 = mat3(transformationMatrix);
  vec3 finalPosition = transformMat3 * vec3(normalizedPosition, 1);
  #else
  vec3 finalPosition = transformationMatrix * vec3(normalizedPosition, 1);
  #endif
  gl_Position = vec4(finalPosition.rg, 0, 1);

  // Calculate sizes for shape and image
  float shapeSizeValue = calculatePointSize(size * sizeScale);
  float imageSizeValue = calculatePointSize(imageSize * sizeScale);
  
  // Use the larger of the two sizes for the overall point size
  float overallSizeValue = max(shapeSizeValue, imageSizeValue);
  gl_PointSize = overallSizeValue;

  // Pass size information to fragment shader
  shapeSize = shapeSizeValue;
  imageSizeVarying = imageSizeValue;
  overallSize = overallSizeValue;

  shapeColor = color;
  pointShape = shape;

  // Adjust alpha of selected points
  if (isGreyedOut > 0.0) {
    if (greyoutColor[0] != -1.0) {
      shapeColor = greyoutColor;
    } else {
      // If greyoutColor is not set, make color lighter or darker based on isDarkenGreyout
      float blendFactor = 0.65; // Controls how much to modify (0.0 = original, 1.0 = target color)
      
      #ifdef USE_UNIFORM_BUFFERS
      if (isDarkenGreyout > 0.0) {
        // Darken the color
        shapeColor.rgb = mix(shapeColor.rgb, vec3(0.2), blendFactor);
      } else {
        // Lighten the color
        shapeColor.rgb = mix(shapeColor.rgb, max(backgroundColor.rgb, vec3(0.8)), blendFactor);
      }
      #else
      if (isDarkenGreyout > 0.0) {
        // Darken the color
        shapeColor.rgb = mix(shapeColor.rgb, vec3(0.2), blendFactor);
      } else {
        // Lighten the color
        shapeColor.rgb = mix(shapeColor.rgb, max(backgroundColor.rgb, vec3(0.8)), blendFactor);
      }
      #endif
    }
  }

  #ifdef USE_UNIFORM_BUFFERS
  if (hasImages <= 0.0 || imageIndex < 0.0 || imageIndex >= imageCount) {
    imageAtlasUV = vec4(-1.0);
  } else {
    // Calculate image atlas UV coordinates based on imageIndex
    float atlasCoordIndex = imageIndex;
    // Calculate the position in the texture grid
    float texX = mod(atlasCoordIndex, imageAtlasCoordsTextureSize);
    float texY = floor(atlasCoordIndex / imageAtlasCoordsTextureSize);
    // Convert to texture coordinates (0.0 to 1.0)
    vec2 atlasCoordTexCoord = (vec2(texX, texY) + 0.5) / imageAtlasCoordsTextureSize;
    vec4 atlasCoords = texture(imageAtlasCoords, atlasCoordTexCoord);
    imageAtlasUV = atlasCoords;
  }
  #else
  if (hasImages <= 0.0 || imageIndex < 0.0 || imageIndex >= imageCount) {
    imageAtlasUV = vec4(-1.0);
  } else {
    // Calculate image atlas UV coordinates based on imageIndex
    float atlasCoordIndex = imageIndex;
    // Calculate the position in the texture grid
    float texX = mod(atlasCoordIndex, imageAtlasCoordsTextureSize);
    float texY = floor(atlasCoordIndex / imageAtlasCoordsTextureSize);
    // Convert to texture coordinates (0.0 to 1.0)
    vec2 atlasCoordTexCoord = (vec2(texX, texY) + 0.5) / imageAtlasCoordsTextureSize;
    vec4 atlasCoords = texture(imageAtlasCoords, atlasCoordTexCoord);
    imageAtlasUV = atlasCoords;
  }
  #endif
} `,ID=`#version 300 es
#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D positionsTexture;
uniform sampler2D pointSize;

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform findPointsOnAreaSelectionUniforms {
  float sizeScale;
  float spaceSize;
  vec2 screenSize;
  float ratio;
  mat4 transformationMatrix;
  vec2 selection0;
  vec2 selection1;
  float scalePointsOnZoom;
  float maxPointSize;
} findPointsOnAreaSelection;

#define sizeScale findPointsOnAreaSelection.sizeScale
#define spaceSize findPointsOnAreaSelection.spaceSize
#define screenSize findPointsOnAreaSelection.screenSize
#define ratio findPointsOnAreaSelection.ratio
#define transformationMatrix findPointsOnAreaSelection.transformationMatrix
#define selection0 findPointsOnAreaSelection.selection0
#define selection1 findPointsOnAreaSelection.selection1
#define scalePointsOnZoom findPointsOnAreaSelection.scalePointsOnZoom
#define maxPointSize findPointsOnAreaSelection.maxPointSize
#else
uniform float sizeScale;
uniform float spaceSize;
uniform vec2 screenSize;
uniform float ratio;
uniform mat3 transformationMatrix;
uniform vec2 selection0;
uniform vec2 selection1;
uniform float scalePointsOnZoom;
uniform float maxPointSize;
#endif

in vec2 textureCoords;

out vec4 fragColor;

float pointSizeF(float size) {
  float pSize;
  // Extract top-left element from mat4 (or use mat3 conversion)
  #ifdef USE_UNIFORM_BUFFERS
  float scale = transformationMatrix[0][0]; // mat4 first element
  #else
  float scale = transformationMatrix[0][0]; // mat3 first element
  #endif
  if (scalePointsOnZoom > 0.0) { 
    pSize = size * ratio * scale;
  } else {
    pSize = size * ratio * min(5.0, max(1.0, scale * 0.01));
  }
  return min(pSize, maxPointSize * ratio);
}

void main() {
  vec4 pointPosition = texture(positionsTexture, textureCoords);
  vec2 p = 2.0 * pointPosition.rg / spaceSize - 1.0;
  p *= spaceSize / screenSize;
  #ifdef USE_UNIFORM_BUFFERS
  // Convert mat4 to mat3 for vec3 multiplication
  mat3 transformMat3 = mat3(transformationMatrix);
  vec3 final = transformMat3 * vec3(p, 1);
  #else
  vec3 final = transformationMatrix * vec3(p, 1);
  #endif

  vec4 pSize = texture(pointSize, textureCoords);
  float size = pSize.r * sizeScale;

  float left = 2.0 * (selection0.x - 0.5 * pointSizeF(size)) / screenSize.x - 1.0;
  float right = 2.0 * (selection1.x + 0.5 * pointSizeF(size)) / screenSize.x - 1.0;
  float top =  2.0 * (selection0.y - 0.5 * pointSizeF(size)) / screenSize.y - 1.0;
  float bottom =  2.0 * (selection1.y + 0.5 * pointSizeF(size)) / screenSize.y - 1.0;

  fragColor = vec4(0.0, 0.0, pointPosition.r, pointPosition.g);
  if (final.x >= left && final.x <= right && final.y >= top && final.y <= bottom) {
    fragColor.r = 1.0;
  }
}

`,kD=`#version 300 es
#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D positionsTexture;
uniform sampler2D polygonPathTexture; // Texture containing polygon path points

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform findPointsOnPolygonSelectionUniforms {
  float spaceSize;
  vec2 screenSize;
  mat4 transformationMatrix;
  float polygonPathLength;
} findPointsOnPolygonSelection;

#define spaceSize findPointsOnPolygonSelection.spaceSize
#define screenSize findPointsOnPolygonSelection.screenSize
#define transformationMatrix findPointsOnPolygonSelection.transformationMatrix
#define polygonPathLength int(findPointsOnPolygonSelection.polygonPathLength)
#else
uniform int polygonPathLength;
uniform float spaceSize;
uniform vec2 screenSize;
uniform mat3 transformationMatrix;
#endif

in vec2 textureCoords;

out vec4 fragColor;

// Get a point from the polygon path texture at a specific index
vec2 getPolygonPoint(sampler2D pathTexture, int index, int pathLength) {
  if (index >= pathLength) return vec2(0.0);
  
  // Calculate texture coordinates for the index
  int textureSize = int(ceil(sqrt(float(pathLength))));
  int x = index - (index / textureSize) * textureSize;
  int y = index / textureSize;
  
  vec2 texCoord = (vec2(float(x), float(y)) + 0.5) / float(textureSize);
  vec4 pathData = texture(pathTexture, texCoord);
  
  return pathData.xy;
}

// Point-in-polygon algorithm using ray casting
bool pointInPolygon(vec2 point, sampler2D pathTexture, int pathLength) {
  bool inside = false;
  
  for (int i = 0; i < 2048; i++) {
    if (i >= pathLength) break;
    
    int j = int(mod(float(i + 1), float(pathLength)));
    
    vec2 pi = getPolygonPoint(pathTexture, i, pathLength);
    vec2 pj = getPolygonPoint(pathTexture, j, pathLength);
    
    if (((pi.y > point.y) != (pj.y > point.y)) &&
        (point.x < (pj.x - pi.x) * (point.y - pi.y) / (pj.y - pi.y) + pi.x)) {
      inside = !inside;
    }
  }
  
  return inside;
}

void main() {
  vec4 pointPosition = texture(positionsTexture, textureCoords);
  vec2 p = 2.0 * pointPosition.rg / spaceSize - 1.0;
  p *= spaceSize / screenSize;
  #ifdef USE_UNIFORM_BUFFERS
  // Convert mat4 to mat3 for vec3 multiplication
  mat3 transformMat3 = mat3(transformationMatrix);
  vec3 final = transformMat3 * vec3(p, 1);
  #else
  vec3 final = transformationMatrix * vec3(p, 1);
  #endif

  // Convert to screen coordinates for polygon check
  vec2 screenPos = (final.xy + 1.0) * screenSize / 2.0;
  
  fragColor = vec4(0.0, 0.0, pointPosition.r, pointPosition.g);
  
  // Check if point center is inside the polygon
  if (pointInPolygon(screenPos, polygonPathTexture, polygonPathLength)) {
    fragColor.r = 1.0;
  }
} `,LD=`#version 300 es
#ifdef GL_ES
precision highp float;
#endif

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform drawHighlightedUniforms {
  float size;
  mat4 transformationMatrix;
  float pointsTextureSize;
  float sizeScale;
  float spaceSize;
  vec2 screenSize;
  float scalePointsOnZoom;
  float pointIndex;
  float maxPointSize;
  vec4 color;
  float universalPointOpacity;
  float greyoutOpacity;
  float isDarkenGreyout;
  vec4 backgroundColor;
  vec4 greyoutColor;
  float width;
} drawHighlighted;

#define width drawHighlighted.width
#else
uniform float width;
#endif

in vec2 vertexPosition;
in float pointOpacity;
in vec3 rgbColor;

out vec4 fragColor;

const float smoothing = 1.05;

void main () {
  float r = dot(vertexPosition, vertexPosition);
  float opacity = smoothstep(r, r * smoothing, 1.0);
  float stroke = smoothstep(width, width * smoothing, r);
  fragColor = vec4(rgbColor, opacity * stroke * pointOpacity);
}`,RD=`#version 300 es
#ifdef GL_ES
precision highp float;
#endif

in vec2 vertexCoord;

uniform sampler2D positionsTexture;
uniform sampler2D pointGreyoutStatusTexture;

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform drawHighlightedUniforms {
  float size;
  mat4 transformationMatrix;
  float pointsTextureSize;
  float sizeScale;
  float spaceSize;
  vec2 screenSize;
  float scalePointsOnZoom;
  float pointIndex;
  float maxPointSize;
  vec4 color;
  float universalPointOpacity;
  float greyoutOpacity;
  float isDarkenGreyout;
  vec4 backgroundColor;
  vec4 greyoutColor;
  float width;
} drawHighlighted;

#define size drawHighlighted.size
#define transformationMatrix drawHighlighted.transformationMatrix
#define pointsTextureSize drawHighlighted.pointsTextureSize
#define sizeScale drawHighlighted.sizeScale
#define spaceSize drawHighlighted.spaceSize
#define screenSize drawHighlighted.screenSize
#define scalePointsOnZoom drawHighlighted.scalePointsOnZoom
#define pointIndex drawHighlighted.pointIndex
#define maxPointSize drawHighlighted.maxPointSize
#define color drawHighlighted.color
#define universalPointOpacity drawHighlighted.universalPointOpacity
#define greyoutOpacity drawHighlighted.greyoutOpacity
#define isDarkenGreyout drawHighlighted.isDarkenGreyout
#define backgroundColor drawHighlighted.backgroundColor
#define greyoutColor drawHighlighted.greyoutColor
#else
uniform float size;
uniform mat3 transformationMatrix;
uniform float pointsTextureSize;
uniform float sizeScale;
uniform float spaceSize;
uniform vec2 screenSize;
uniform float scalePointsOnZoom;
uniform float pointIndex;
uniform float maxPointSize;
uniform vec4 color;
uniform float universalPointOpacity;
uniform float greyoutOpacity;
uniform float isDarkenGreyout;
uniform vec4 backgroundColor;
uniform vec4 greyoutColor;
uniform float width;
#endif
out vec2 vertexPosition;
out float pointOpacity;
out vec3 rgbColor;

float calculatePointSize(float pointSize) {
  float pSize;

  if (scalePointsOnZoom > 0.0) { 
    pSize = pointSize * transformationMatrix[0][0];
  } else {
    pSize = pointSize * min(5.0, max(1.0, transformationMatrix[0][0] * 0.01));
  }

  return min(pSize, maxPointSize);
}

const float relativeRingRadius = 1.3;

void main () {
  vertexPosition = vertexCoord;

  vec2 textureCoordinates = vec2(mod(pointIndex, pointsTextureSize), floor(pointIndex / pointsTextureSize)) + 0.5;
  vec4 pointPosition = texture(positionsTexture, textureCoordinates / pointsTextureSize);

  rgbColor = color.rgb;
  pointOpacity = color.a * universalPointOpacity;
  vec4 greyoutStatus = texture(pointGreyoutStatusTexture, textureCoordinates / pointsTextureSize);
  if (greyoutStatus.r > 0.0) {
    if (greyoutColor[0] != -1.0) {
      rgbColor = greyoutColor.rgb;
      pointOpacity = greyoutColor.a;
    } else {
      // If greyoutColor is not set, make color lighter or darker based on isDarkenGreyout
      float blendFactor = 0.65; // Controls how much to modify (0.0 = original, 1.0 = target color)
      
      #ifdef USE_UNIFORM_BUFFERS
      if (isDarkenGreyout > 0.0) {
        // Darken the color
        rgbColor = mix(rgbColor, vec3(0.2), blendFactor);
      } else {
        // Lighten the color
        rgbColor = mix(rgbColor, max(backgroundColor.rgb, vec3(0.8)), blendFactor);
      }
      #else
      if (isDarkenGreyout > 0.0) {
        // Darken the color
        rgbColor = mix(rgbColor, vec3(0.2), blendFactor);
      } else {
        // Lighten the color
        rgbColor = mix(rgbColor, max(backgroundColor.rgb, vec3(0.8)), blendFactor);
      }
      #endif
    }

    if (greyoutOpacity != -1.0) {
      pointOpacity *= greyoutOpacity;
    }
  }

  // Calculate point radius
  float pointSize = (calculatePointSize(size * sizeScale) * relativeRingRadius) / transformationMatrix[0][0];
  float radius = pointSize * 0.5;

  // Calculate point position in screen space
  vec2 a = pointPosition.xy;
  vec2 b = pointPosition.xy + vec2(0.0, radius);
  vec2 xBasis = b - a;
  vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));
  vec2 pointPositionInScreenSpace = a + xBasis * vertexCoord.x + yBasis * radius * vertexCoord.y;

  // Transform point position to normalized device coordinates
  vec2 p = 2.0 * pointPositionInScreenSpace / spaceSize - 1.0;
  p *= spaceSize / screenSize;
  #ifdef USE_UNIFORM_BUFFERS
  mat3 transformMat3 = mat3(transformationMatrix);
  vec3 final = transformMat3 * vec3(p, 1);
  #else
  vec3 final = transformationMatrix * vec3(p, 1);
  #endif
  
  gl_Position = vec4(final.rg, 0, 1);
}`,PD=`#version 300 es
#ifdef GL_ES
precision highp float;
#endif

in vec4 rgba;

out vec4 fragColor;

void main() {
  if (rgba.g <= 0.0) {
    discard;
  }
  fragColor = rgba;
}`,DD=`#version 300 es
#ifdef GL_ES
precision highp float;
#endif

in vec2 pointIndices;
in float size;

uniform sampler2D positionsTexture;

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform findHoveredPointUniforms {
  float pointsTextureSize;
  float sizeScale;
  float spaceSize;
  vec2 screenSize;
  float ratio;
  mat4 transformationMatrix;
  vec2 mousePosition;
  float scalePointsOnZoom;
  float maxPointSize;
} findHoveredPoint;

#define pointsTextureSize findHoveredPoint.pointsTextureSize
#define sizeScale findHoveredPoint.sizeScale
#define spaceSize findHoveredPoint.spaceSize
#define screenSize findHoveredPoint.screenSize
#define ratio findHoveredPoint.ratio
#define transformationMatrix findHoveredPoint.transformationMatrix
#define mousePosition findHoveredPoint.mousePosition
#define scalePointsOnZoom findHoveredPoint.scalePointsOnZoom
#define maxPointSize findHoveredPoint.maxPointSize
#else
uniform float pointsTextureSize;
uniform float sizeScale;
uniform float spaceSize;
uniform vec2 screenSize;
uniform float ratio;
uniform mat3 transformationMatrix;
uniform vec2 mousePosition;
uniform float scalePointsOnZoom;
uniform float maxPointSize;
#endif

out vec4 rgba;

float calculatePointSize(float size) {
  float pSize;

  if (scalePointsOnZoom > 0.0) { 
    pSize = size * ratio * transformationMatrix[0][0];
  } else {
    pSize = size * ratio * min(5.0, max(1.0, transformationMatrix[0][0] * 0.01));
  }

  return min(pSize, maxPointSize * ratio);
}

float euclideanDistance (float x1, float x2, float y1, float y2) {
  return sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));
}

void main() {
  vec4 pointPosition = texture(positionsTexture, (pointIndices + 0.5) / pointsTextureSize);
  vec2 point = pointPosition.rg;

  vec2 normalizedPosition = 2.0 * point / spaceSize - 1.0;
  normalizedPosition *= spaceSize / screenSize;
  
  #ifdef USE_UNIFORM_BUFFERS
  mat3 transformMat3 = mat3(transformationMatrix);
  vec3 finalPosition = transformMat3 * vec3(normalizedPosition, 1);
  #else
  vec3 finalPosition = transformationMatrix * vec3(normalizedPosition, 1);
  #endif

  float pointRadius = 0.5 * calculatePointSize(size * sizeScale);
  vec2 pointScreenPosition = (finalPosition.xy + 1.0) * screenSize / 2.0;
  
  rgba = vec4(0.0);
  gl_Position = vec4(0.5, 0.5, 0.0, 1.0);
  
  if (euclideanDistance(pointScreenPosition.x, mousePosition.x, pointScreenPosition.y, mousePosition.y) < pointRadius / ratio) {
    float index = pointIndices.g * pointsTextureSize + pointIndices.r;
    rgba = vec4(index, size, pointPosition.xy);
    gl_Position = vec4(-0.5, -0.5, 0.0, 1.0);
  }

  gl_PointSize = 1.0;
}`,MD=`#version 300 es
#ifdef GL_ES
precision highp float;
#endif

in vec4 rgba;

out vec4 fragColor;

void main() {
  fragColor = rgba;
}`,ND=`#version 300 es
#ifdef GL_ES
precision highp float;
#endif

in vec2 pointIndices;

uniform sampler2D positionsTexture;

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform fillSampledPointsUniforms {
  float pointsTextureSize;
  mat4 transformationMatrix;
  float spaceSize;
  vec2 screenSize;
} fillSampledPoints;

#define pointsTextureSize fillSampledPoints.pointsTextureSize
#define transformationMatrix fillSampledPoints.transformationMatrix
#define spaceSize fillSampledPoints.spaceSize
#define screenSize fillSampledPoints.screenSize
#else
uniform float pointsTextureSize;
uniform float spaceSize;
uniform vec2 screenSize;
uniform mat3 transformationMatrix;
#endif

out vec4 rgba;

void main() {
  vec4 pointPosition = texture(positionsTexture, (pointIndices + 0.5) / pointsTextureSize);
  vec2 p = 2.0 * pointPosition.rg / spaceSize - 1.0;
  p *= spaceSize / screenSize;
  #ifdef USE_UNIFORM_BUFFERS
  // Convert mat4 to mat3 for vec3 multiplication
  mat3 transformMat3 = mat3(transformationMatrix);
  vec3 final = transformMat3 * vec3(p, 1);
  #else
  vec3 final = transformationMatrix * vec3(p, 1);
  #endif

  vec2 pointScreenPosition = (final.xy + 1.0) * screenSize / 2.0;
  float index = pointIndices.g * pointsTextureSize + pointIndices.r;
  rgba = vec4(index, 1.0, pointPosition.xy);
  float i = (pointScreenPosition.x + 0.5) / screenSize.x;
  float j = (pointScreenPosition.y + 0.5) / screenSize.y;
  gl_Position = vec4(2.0 * vec2(i, j) - 1.0, 0.0, 1.0);

  gl_PointSize = 1.0;
}`,BD=`#version 300 es
#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D positionsTexture;
uniform sampler2D velocity;
uniform sampler2D pinnedStatusTexture;

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform updatePositionUniforms {
  float friction;
  float spaceSize;
} updatePosition;

#define friction updatePosition.friction
#define spaceSize updatePosition.spaceSize
#else
uniform float friction;
uniform float spaceSize;
#endif

in vec2 textureCoords;

out vec4 fragColor;

void main() {
  vec4 pointPosition = texture(positionsTexture, textureCoords);
  vec4 pointVelocity = texture(velocity, textureCoords);

  // Check if point is pinned
  // pinnedStatusTexture has the same size and layout as positionsTexture
  // Each pixel corresponds to a point: red channel > 0.5 means the point is pinned
  vec4 pinnedStatus = texture(pinnedStatusTexture, textureCoords);
  
  // If pinned, don't update position
  if (pinnedStatus.r > 0.5) {
    fragColor = pointPosition;
    return;
  }

  // Friction
  pointVelocity.rg *= friction;

  pointPosition.rg += pointVelocity.rg;

  pointPosition.r = clamp(pointPosition.r, 0.0, spaceSize);
  pointPosition.g = clamp(pointPosition.g, 0.0, spaceSize);
  
  fragColor = pointPosition;
}`,OD=`#version 300 es
#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D positionsTexture;
uniform sampler2D trackedIndices;

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform trackPointsUniforms {
  float pointsTextureSize;
} trackPoints;

#define pointsTextureSize trackPoints.pointsTextureSize
#else
uniform float pointsTextureSize;
#endif

in vec2 textureCoords;

out vec4 fragColor;

void main() {
  vec4 trackedPointIndices = texture(trackedIndices, textureCoords);
  if (trackedPointIndices.r < 0.0) discard;
  vec4 pointPosition = texture(positionsTexture, (trackedPointIndices.rg + 0.5) / pointsTextureSize);

  fragColor = vec4(pointPosition.rg, 1.0, 1.0);
}

`,FD=`#version 300 es
#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D positionsTexture;

#ifdef USE_UNIFORM_BUFFERS
layout(std140) uniform dragPointUniforms {
  vec2 mousePos;
  float index;
} dragPoint;

#define mousePos dragPoint.mousePos
#define index dragPoint.index
#else
uniform vec2 mousePos;
uniform float index;
#endif

in vec2 textureCoords;

out vec4 fragColor;

void main() {
  vec4 pointPosition = texture(positionsTexture, textureCoords);

  // Check if a point is being dragged
  if (index >= 0.0 && index == pointPosition.b) {
    pointPosition.rg = mousePos.rg;
  }

  fragColor = pointPosition;
}`;function zD(i,e=16384){if(!(i!=null&&i.length))return null;let t=0;for(const c of i){const u=Math.max(c.width,c.height);u>t&&(t=u)}if(t===0)return console.warn("Invalid image dimensions: all images have zero width or height"),null;const n=t,r=Math.ceil(Math.sqrt(i.length));let o=r*t,s=1;o>e&&(s=e/o,t=Math.max(1,Math.floor(t*s)),o=Math.max(1,Math.floor(o*s)),console.warn(`  Atlas scaling required: Original size ${(n*r).toLocaleString()}px exceeds WebGL limit ${e.toLocaleString()}px. Scaling down to ${o.toLocaleString()}px (${Math.round(s*100)}% of original quality)`));const a=new Uint8Array(o*o*4).fill(0),l=new Float32Array(r*r*4).fill(-1);for(const[c,u]of i.entries()){const h=u.width,d=u.height;if(h===0||d===0)continue;const f=Math.min(1,t/Math.max(h,d)),p=Math.floor(h*f),b=Math.floor(d*f),g=Math.floor(c/r),_=c%r*t,T=g*t;l[c*4]=_/o,l[c*4+1]=T/o,l[c*4+2]=(_+p)/o,l[c*4+3]=(T+b)/o;for(let E=0;E<b;E++)for(let y=0;y<p;y++){const C=Math.floor(y*(h/p)),I=(Math.floor(E*(d/b))*h+C)*4,F=((T+E)*o+(_+y))*4;a[F]=u.data[I]??0,a[F+1]=u.data[I+1]??0,a[F+2]=u.data[I+2]??0,a[F+3]=u.data[I+3]??255}}return{atlasData:a,atlasSize:o,atlasCoords:l,atlasCoordsSize:r}}class UD extends Go{constructor(){super(...arguments),this.imageCount=0,this.isPositionsUpToDate=!1,this.polygonPathLength=0}updatePositions(){var e,t,n;const{device:r,store:o,data:s,config:{rescalePositions:a,enableSimulation:l}}=this,{pointsTextureSize:c}=o;if(!c||!s.pointPositions||s.pointsNumber===void 0)return;const u=c*c*4,h=new Float32Array(u),d=c*c*4*4,f=h.byteLength;f!==d&&console.error("Texture data size mismatch:",{pointsTextureSize:c,expectedBytes:d,actualBytes:f,textureDataSize:u,dataLength:h.length});let p=a;a===void 0&&!l&&(p=!0),this.shouldSkipRescale&&(p=!1),p?this.rescaleInitialNodePositions():this.shouldSkipRescale||(this.scaleX=void 0,this.scaleY=void 0),this.shouldSkipRescale=void 0;for(let _=0;_<s.pointsNumber;++_)h[_*4+0]=s.pointPositions[_*2+0],h[_*4+1]=s.pointPositions[_*2+1],h[_*4+2]=_;if(!this.currentPositionTexture||this.currentPositionTexture.width!==c||this.currentPositionTexture.height!==c?(this.currentPositionTexture&&this.currentPositionTexture.destroy(),this.currentPositionFbo&&this.currentPositionFbo.destroy(),this.currentPositionTexture=r.createTexture({width:c,height:c,format:"rgba32float"}),this.currentPositionTexture.copyImageData({data:h,bytesPerRow:Ue("rgba32float",c),mipLevel:0,x:0,y:0}),this.currentPositionFbo=r.createFramebuffer({width:c,height:c,colorAttachments:[this.currentPositionTexture]})):this.currentPositionTexture.copyImageData({data:h,bytesPerRow:Ue("rgba32float",c),mipLevel:0,x:0,y:0}),!this.previousPositionTexture||this.previousPositionTexture.width!==c||this.previousPositionTexture.height!==c?(this.previousPositionTexture&&this.previousPositionTexture.destroy(),this.previousPositionFbo&&this.previousPositionFbo.destroy(),this.previousPositionTexture=r.createTexture({width:c,height:c,format:"rgba32float"}),this.previousPositionTexture.copyImageData({data:h,bytesPerRow:Ue("rgba32float",c),mipLevel:0,x:0,y:0}),this.previousPositionFbo=r.createFramebuffer({width:c,height:c,colorAttachments:[this.previousPositionTexture]})):this.previousPositionTexture.copyImageData({data:h,bytesPerRow:Ue("rgba32float",c),mipLevel:0,x:0,y:0}),this.config.enableSimulation){const _=new Float32Array(c*c*4).fill(0);!this.velocityTexture||this.velocityTexture.width!==c||this.velocityTexture.height!==c?(this.velocityTexture&&this.velocityTexture.destroy(),this.velocityFbo&&this.velocityFbo.destroy(),this.velocityTexture=r.createTexture({width:c,height:c,format:"rgba32float"}),this.velocityTexture.copyImageData({data:_,bytesPerRow:Ue("rgba32float",c),mipLevel:0,x:0,y:0}),this.velocityFbo=r.createFramebuffer({width:c,height:c,colorAttachments:[this.velocityTexture]})):this.velocityTexture.copyImageData({data:_,bytesPerRow:Ue("rgba32float",c),mipLevel:0,x:0,y:0})}!this.selectedTexture||this.selectedTexture.width!==c||this.selectedTexture.height!==c?(this.selectedTexture&&this.selectedTexture.destroy(),this.selectedFbo&&this.selectedFbo.destroy(),this.selectedTexture=r.createTexture({width:c,height:c,format:"rgba32float"}),this.selectedTexture.copyImageData({data:h,bytesPerRow:Ue("rgba32float",c),mipLevel:0,x:0,y:0}),this.selectedFbo=r.createFramebuffer({width:c,height:c,colorAttachments:[this.selectedTexture]})):this.selectedTexture.copyImageData({data:h,bytesPerRow:Ue("rgba32float",c),mipLevel:0,x:0,y:0}),this.hoveredFbo||(this.hoveredFbo=r.createFramebuffer({width:2,height:2,colorAttachments:["rgba32float"]}));const b=af(o.pointsTextureSize),g=b.byteLength;!this.drawPointIndices||this.drawPointIndices.byteLength!==g?((e=this.drawPointIndices)==null||e.destroy(),this.drawPointIndices=r.createBuffer({data:b,usage:se.VERTEX|se.COPY_DST})):this.drawPointIndices.write(b),this.drawCommand&&this.drawCommand.setAttributes({pointIndices:this.drawPointIndices}),!this.hoveredPointIndices||this.hoveredPointIndices.byteLength!==g?((t=this.hoveredPointIndices)==null||t.destroy(),this.hoveredPointIndices=r.createBuffer({data:b,usage:se.VERTEX|se.COPY_DST})):this.hoveredPointIndices.write(b),!this.sampledPointIndices||this.sampledPointIndices.byteLength!==g?((n=this.sampledPointIndices)==null||n.destroy(),this.sampledPointIndices=r.createBuffer({data:b,usage:se.VERTEX|se.COPY_DST})):this.sampledPointIndices.write(b),this.fillSampledPointsFboCommand&&this.fillSampledPointsFboCommand.setAttributes({pointIndices:this.sampledPointIndices}),this.updateGreyoutStatus(),this.updatePinnedStatus(),this.updateSampledPointsGrid(),this.trackPointsByIndices()}initPrograms(){var e,t,n;const{device:r,config:o,store:s,data:a}=this;(!this.imageAtlasCoordsTexture||!this.imageAtlasTexture)&&this.createAtlas(),this.colorBuffer||this.updateColor(),this.sizeBuffer||this.updateSize(),this.shapeBuffer||this.updateShape(),this.imageIndicesBuffer||this.updateImageIndices(),this.imageSizesBuffer||this.updateImageSizes(),this.greyoutStatusTexture||this.updateGreyoutStatus(),o.enableSimulation&&(this.updatePositionVertexCoordBuffer||(this.updatePositionVertexCoordBuffer=r.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.updatePositionUniformStore||(this.updatePositionUniformStore=new Bt({updatePositionUniforms:{uniformTypes:{friction:"f32",spaceSize:"f32"},defaultUniforms:{friction:o.simulationFriction??0,spaceSize:s.adjustedSpaceSize??0}}})),this.updatePositionCommand||(this.updatePositionCommand=new Ft(r,{fs:BD,vs:wn,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.updatePositionVertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{updatePositionUniforms:this.updatePositionUniformStore.getManagedUniformBuffer(r,"updatePositionUniforms")}}))),this.dragPointVertexCoordBuffer||(this.dragPointVertexCoordBuffer=r.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.dragPointUniformStore||(this.dragPointUniformStore=new Bt({dragPointUniforms:{uniformTypes:{mousePos:"vec2<f32>",index:"f32"},defaultUniforms:{mousePos:Ke(s.mousePosition,[0,0]),index:((e=s.hoveredPoint)==null?void 0:e.index)??-1}}})),this.dragPointCommand||(this.dragPointCommand=new Ft(r,{fs:FD,vs:wn,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.dragPointVertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{dragPointUniforms:this.dragPointUniformStore.getManagedUniformBuffer(r,"dragPointUniforms")}})),this.drawUniformStore||(this.drawUniformStore=new Bt({drawVertexUniforms:{uniformTypes:{ratio:"f32",transformationMatrix:"mat4x4<f32>",pointsTextureSize:"f32",sizeScale:"f32",spaceSize:"f32",screenSize:"vec2<f32>",greyoutColor:"vec4<f32>",backgroundColor:"vec4<f32>",scalePointsOnZoom:"f32",maxPointSize:"f32",isDarkenGreyout:"f32",skipSelected:"f32",skipUnselected:"f32",hasImages:"f32",imageCount:"f32",imageAtlasCoordsTextureSize:"f32"},defaultUniforms:{ratio:o.pixelRatio??re.pixelRatio,transformationMatrix:(()=>{const l=s.transform??[1,0,0,0,1,0,0,0,1];return[l[0],l[1],l[2],0,l[3],l[4],l[5],0,l[6],l[7],l[8],0,0,0,0,1]})(),pointsTextureSize:s.pointsTextureSize??0,sizeScale:o.pointSizeScale??1,spaceSize:s.adjustedSpaceSize??0,screenSize:Ke(s.screenSize,[0,0]),greyoutColor:ni(s.greyoutPointColor,[0,0,0,1]),backgroundColor:ni(s.backgroundColor,[0,0,0,1]),scalePointsOnZoom:o.scalePointsOnZoom??!0?1:0,maxPointSize:s.maxPointSize??100,isDarkenGreyout:s.isDarkenGreyout??!1?1:0,skipSelected:0,skipUnselected:0,hasImages:this.imageCount>0?1:0,imageCount:this.imageCount,imageAtlasCoordsTextureSize:this.imageAtlasCoordsTextureSize??0}},drawFragmentUniforms:{uniformTypes:{greyoutOpacity:"f32",pointOpacity:"f32",isDarkenGreyout:"f32",backgroundColor:"vec4<f32>"},defaultUniforms:{greyoutOpacity:o.pointGreyoutOpacity??-1,pointOpacity:o.pointOpacity??1,isDarkenGreyout:s.isDarkenGreyout??!1?1:0,backgroundColor:ni(s.backgroundColor,[0,0,0,1])}}})),this.drawCommand||(this.drawCommand=new Ft(r,{fs:TD,vs:AD,topology:"point-list",vertexCount:a.pointsNumber??0,attributes:{...this.drawPointIndices&&{pointIndices:this.drawPointIndices},...this.sizeBuffer&&{size:this.sizeBuffer},...this.colorBuffer&&{color:this.colorBuffer},...this.shapeBuffer&&{shape:this.shapeBuffer},...this.imageIndicesBuffer&&{imageIndex:this.imageIndicesBuffer},...this.imageSizesBuffer&&{imageSize:this.imageSizesBuffer}},bufferLayout:[{name:"pointIndices",format:"float32x2"},{name:"size",format:"float32"},{name:"color",format:"float32x4"},{name:"shape",format:"float32"},{name:"imageIndex",format:"float32"},{name:"imageSize",format:"float32"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{drawVertexUniforms:this.drawUniformStore.getManagedUniformBuffer(r,"drawVertexUniforms"),drawFragmentUniforms:this.drawUniformStore.getManagedUniformBuffer(r,"drawFragmentUniforms")},parameters:{blend:!0,blendColorOperation:"add",blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaOperation:"add",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",depthWriteEnabled:!1,depthCompare:"always"}})),this.findPointsOnAreaSelectionVertexCoordBuffer||(this.findPointsOnAreaSelectionVertexCoordBuffer=r.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.findPointsOnAreaSelectionUniformStore||(this.findPointsOnAreaSelectionUniformStore=new Bt({findPointsOnAreaSelectionUniforms:{uniformTypes:{sizeScale:"f32",spaceSize:"f32",screenSize:"vec2<f32>",ratio:"f32",transformationMatrix:"mat4x4<f32>",selection0:"vec2<f32>",selection1:"vec2<f32>",scalePointsOnZoom:"f32",maxPointSize:"f32"},defaultUniforms:{sizeScale:o.pointSizeScale??1,spaceSize:s.adjustedSpaceSize??0,screenSize:Ke(s.screenSize,[0,0]),ratio:o.pixelRatio??re.pixelRatio,transformationMatrix:s.transformationMatrix4x4,selection0:Ke((t=s.selectedArea)==null?void 0:t[0],[0,0]),selection1:Ke((n=s.selectedArea)==null?void 0:n[1],[0,0]),scalePointsOnZoom:o.scalePointsOnZoom??!0?1:0,maxPointSize:s.maxPointSize??100}}})),this.findPointsOnAreaSelectionCommand||(this.findPointsOnAreaSelectionCommand=new Ft(r,{fs:ID,vs:wn,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.findPointsOnAreaSelectionVertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{findPointsOnAreaSelectionUniforms:this.findPointsOnAreaSelectionUniformStore.getManagedUniformBuffer(r,"findPointsOnAreaSelectionUniforms")}})),this.findPointsOnPolygonSelectionVertexCoordBuffer||(this.findPointsOnPolygonSelectionVertexCoordBuffer=r.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.findPointsOnPolygonSelectionUniformStore||(this.findPointsOnPolygonSelectionUniformStore=new Bt({findPointsOnPolygonSelectionUniforms:{uniformTypes:{spaceSize:"f32",screenSize:"vec2<f32>",transformationMatrix:"mat4x4<f32>",polygonPathLength:"f32"},defaultUniforms:{spaceSize:s.adjustedSpaceSize??0,screenSize:Ke(s.screenSize,[0,0]),transformationMatrix:s.transformationMatrix4x4,polygonPathLength:this.polygonPathLength}}})),this.findPointsOnPolygonSelectionCommand||(this.findPointsOnPolygonSelectionCommand=new Ft(r,{fs:kD,vs:wn,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.findPointsOnPolygonSelectionVertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{findPointsOnPolygonSelectionUniforms:this.findPointsOnPolygonSelectionUniformStore.getManagedUniformBuffer(r,"findPointsOnPolygonSelectionUniforms")}})),this.findHoveredPointUniformStore||(this.findHoveredPointUniformStore=new Bt({findHoveredPointUniforms:{uniformTypes:{pointsTextureSize:"f32",sizeScale:"f32",spaceSize:"f32",screenSize:"vec2<f32>",ratio:"f32",transformationMatrix:"mat4x4<f32>",mousePosition:"vec2<f32>",scalePointsOnZoom:"f32",maxPointSize:"f32"},defaultUniforms:{pointsTextureSize:s.pointsTextureSize??0,sizeScale:o.pointSizeScale??1,spaceSize:s.adjustedSpaceSize??0,screenSize:Ke(s.screenSize,[0,0]),ratio:o.pixelRatio??re.pixelRatio,transformationMatrix:s.transformationMatrix4x4,mousePosition:Ke(s.screenMousePosition,[0,0]),scalePointsOnZoom:o.scalePointsOnZoom??!0?1:0,maxPointSize:s.maxPointSize??100}}})),this.findHoveredPointCommand||(this.findHoveredPointCommand=new Ft(r,{fs:PD,vs:DD,topology:"point-list",vertexCount:a.pointsNumber??0,attributes:{...this.hoveredPointIndices&&{pointIndices:this.hoveredPointIndices},...this.sizeBuffer&&{size:this.sizeBuffer}},bufferLayout:[{name:"pointIndices",format:"float32x2"},{name:"size",format:"float32"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{findHoveredPointUniforms:this.findHoveredPointUniformStore.getManagedUniformBuffer(r,"findHoveredPointUniforms")},parameters:{depthWriteEnabled:!1,depthCompare:"always",blend:!1}})),this.fillSampledPointsUniformStore||(this.fillSampledPointsUniformStore=new Bt({fillSampledPointsUniforms:{uniformTypes:{pointsTextureSize:"f32",transformationMatrix:"mat4x4<f32>",spaceSize:"f32",screenSize:"vec2<f32>"},defaultUniforms:{pointsTextureSize:s.pointsTextureSize??0,transformationMatrix:s.transformationMatrix4x4,spaceSize:s.adjustedSpaceSize??0,screenSize:Ke(s.screenSize,[0,0])}}})),this.fillSampledPointsFboCommand||(this.fillSampledPointsFboCommand=new Ft(r,{fs:MD,vs:ND,topology:"point-list",vertexCount:a.pointsNumber??0,attributes:{...this.sampledPointIndices&&{pointIndices:this.sampledPointIndices}},bufferLayout:[{name:"pointIndices",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{fillSampledPointsUniforms:this.fillSampledPointsUniformStore.getManagedUniformBuffer(r,"fillSampledPointsUniforms")},parameters:{depthWriteEnabled:!1,depthCompare:"always"}})),this.drawHighlightedVertexCoordBuffer||(this.drawHighlightedVertexCoordBuffer=r.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.drawHighlightedUniformStore||(this.drawHighlightedUniformStore=new Bt({drawHighlightedUniforms:{uniformTypes:{size:"f32",transformationMatrix:"mat4x4<f32>",pointsTextureSize:"f32",sizeScale:"f32",spaceSize:"f32",screenSize:"vec2<f32>",scalePointsOnZoom:"f32",pointIndex:"f32",maxPointSize:"f32",color:"vec4<f32>",universalPointOpacity:"f32",greyoutOpacity:"f32",isDarkenGreyout:"f32",backgroundColor:"vec4<f32>",greyoutColor:"vec4<f32>",width:"f32"},defaultUniforms:{size:1,transformationMatrix:s.transformationMatrix4x4,pointsTextureSize:s.pointsTextureSize??0,sizeScale:o.pointSizeScale??1,spaceSize:s.adjustedSpaceSize??0,screenSize:Ke(s.screenSize,[0,0]),scalePointsOnZoom:o.scalePointsOnZoom??!0?1:0,pointIndex:-1,maxPointSize:s.maxPointSize??100,color:[0,0,0,1],universalPointOpacity:o.pointOpacity??1,greyoutOpacity:o.pointGreyoutOpacity??-1,isDarkenGreyout:s.isDarkenGreyout??!1?1:0,backgroundColor:ni(s.backgroundColor,[0,0,0,1]),greyoutColor:ni(s.greyoutPointColor,[0,0,0,1]),width:.85}}})),this.drawHighlightedCommand||(this.drawHighlightedCommand=new Ft(r,{fs:LD,vs:RD,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.drawHighlightedVertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{drawHighlightedUniforms:this.drawHighlightedUniformStore.getManagedUniformBuffer(r,"drawHighlightedUniforms")},parameters:{blend:!0,blendColorOperation:"add",blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaOperation:"add",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",depthWriteEnabled:!1,depthCompare:"always"}})),this.trackPointsVertexCoordBuffer||(this.trackPointsVertexCoordBuffer=r.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.trackPointsUniformStore||(this.trackPointsUniformStore=new Bt({trackPointsUniforms:{uniformTypes:{pointsTextureSize:"f32"},defaultUniforms:{pointsTextureSize:s.pointsTextureSize??0}}})),this.trackPointsCommand||(this.trackPointsCommand=new Ft(r,{fs:OD,vs:wn,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.trackPointsVertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{trackPointsUniforms:this.trackPointsUniformStore.getManagedUniformBuffer(r,"trackPointsUniforms")}}))}updateColor(){var e;const{device:t,store:{pointsTextureSize:n},data:r}=this;if(!n)return;const o=r.pointColors,s=o.byteLength;!this.colorBuffer||this.colorBuffer.byteLength!==s?((e=this.colorBuffer)==null||e.destroy(),this.colorBuffer=t.createBuffer({data:o,usage:se.VERTEX|se.COPY_DST})):this.colorBuffer.write(o),this.drawCommand&&this.drawCommand.setAttributes({color:this.colorBuffer})}updateGreyoutStatus(){const{device:e,store:{selectedIndices:t,pointsTextureSize:n}}=this;if(!n)return;const r=new Float32Array(n*n*4).fill(t?1:0);if(t)for(const o of t)r[o*4]=0;!this.greyoutStatusTexture||this.greyoutStatusTexture.width!==n||this.greyoutStatusTexture.height!==n?(this.greyoutStatusTexture&&this.greyoutStatusTexture.destroy(),this.greyoutStatusTexture=e.createTexture({width:n,height:n,format:"rgba32float"}),this.greyoutStatusTexture.copyImageData({data:r,bytesPerRow:Ue("rgba32float",n),mipLevel:0,x:0,y:0})):this.greyoutStatusTexture.copyImageData({data:r,bytesPerRow:Ue("rgba32float",n),mipLevel:0,x:0,y:0})}updatePinnedStatus(){const{device:e,store:{pointsTextureSize:t},data:n}=this;if(!t)return;const r=new Float32Array(t*t*4).fill(0);if(n.inputPinnedPoints&&n.pointsNumber!==void 0)for(const o of n.inputPinnedPoints)o>=0&&o<n.pointsNumber&&(r[o*4]=1);!this.pinnedStatusTexture||this.pinnedStatusTexture.width!==t||this.pinnedStatusTexture.height!==t?(this.pinnedStatusTexture&&this.pinnedStatusTexture.destroy(),this.pinnedStatusTexture=e.createTexture({width:t,height:t,format:"rgba32float"}),this.pinnedStatusTexture.copyImageData({data:r,bytesPerRow:Ue("rgba32float",t),mipLevel:0,x:0,y:0})):this.pinnedStatusTexture.copyImageData({data:r,bytesPerRow:Ue("rgba32float",t),mipLevel:0,x:0,y:0})}updateSize(){var e;const{device:t,store:{pointsTextureSize:n},data:r}=this;if(!n||r.pointsNumber===void 0||r.pointSizes===void 0)return;const o=r.pointSizes,s=o.byteLength;!this.sizeBuffer||this.sizeBuffer.byteLength!==s?((e=this.sizeBuffer)==null||e.destroy(),this.sizeBuffer=t.createBuffer({data:o,usage:se.VERTEX|se.COPY_DST})):this.sizeBuffer.write(o),this.drawCommand&&this.drawCommand.setAttributes({size:this.sizeBuffer});const a=new Float32Array(n*n*4);for(let l=0;l<r.pointsNumber;l++)a[l*4]=r.pointSizes[l];!this.sizeTexture||this.sizeTexture.width!==n||this.sizeTexture.height!==n?(this.sizeTexture&&this.sizeTexture.destroy(),this.sizeTexture=t.createTexture({width:n,height:n,format:"rgba32float"}),this.sizeTexture.copyImageData({data:a,bytesPerRow:Ue("rgba32float",n),mipLevel:0,x:0,y:0})):this.sizeTexture.copyImageData({data:a,bytesPerRow:Ue("rgba32float",n),mipLevel:0,x:0,y:0})}updateShape(){var e;const{device:t,data:n}=this;if(n.pointsNumber===void 0||n.pointShapes===void 0)return;const r=n.pointShapes,o=r.byteLength;!this.shapeBuffer||this.shapeBuffer.byteLength!==o?((e=this.shapeBuffer)==null||e.destroy(),this.shapeBuffer=t.createBuffer({data:r,usage:se.VERTEX|se.COPY_DST})):this.shapeBuffer.write(r),this.drawCommand&&this.drawCommand.setAttributes({shape:this.shapeBuffer})}updateImageIndices(){var e;const{device:t,data:n}=this;if(n.pointsNumber===void 0||n.pointImageIndices===void 0)return;const r=n.pointImageIndices,o=r.byteLength;!this.imageIndicesBuffer||this.imageIndicesBuffer.byteLength!==o?((e=this.imageIndicesBuffer)==null||e.destroy(),this.imageIndicesBuffer=t.createBuffer({data:r,usage:se.VERTEX|se.COPY_DST})):this.imageIndicesBuffer.write(r),this.drawCommand&&this.drawCommand.setAttributes({imageIndex:this.imageIndicesBuffer})}updateImageSizes(){var e;const{device:t,data:n}=this;if(n.pointsNumber===void 0||n.pointImageSizes===void 0)return;const r=n.pointImageSizes,o=r.byteLength;!this.imageSizesBuffer||this.imageSizesBuffer.byteLength!==o?((e=this.imageSizesBuffer)==null||e.destroy(),this.imageSizesBuffer=t.createBuffer({data:r,usage:se.VERTEX|se.COPY_DST})):this.imageSizesBuffer.write(r),this.drawCommand&&this.drawCommand.setAttributes({imageSize:this.imageSizesBuffer})}createAtlas(){var e,t,n;const{device:r,data:o,store:s}=this;if(!((e=o.inputImageData)!=null&&e.length)){this.imageCount=0,this.imageAtlasCoordsTextureSize=0,this.imageAtlasCoordsTexture||(this.imageAtlasCoordsTexture=r.createTexture({data:new Float32Array(4).fill(0),width:1,height:1,format:"rgba32float"})),this.imageAtlasTexture||(this.imageAtlasTexture=r.createTexture({data:new Uint8Array(4).fill(0),width:1,height:1,format:"rgba8unorm"}));return}const a=zD(o.inputImageData,s.webglMaxTextureSize);if(!a){console.warn("Failed to create atlas from image data");return}this.imageCount=o.inputImageData.length;const{atlasData:l,atlasSize:c,atlasCoords:u,atlasCoordsSize:h}=a;this.imageAtlasCoordsTextureSize=h,(t=this.imageAtlasTexture)==null||t.destroy(),this.imageAtlasTexture=r.createTexture({width:c,height:c,format:"rgba8unorm"}),this.imageAtlasTexture.copyImageData({data:l,bytesPerRow:Ue("rgba8unorm",c),rowsPerImage:c,mipLevel:0,x:0,y:0}),(n=this.imageAtlasCoordsTexture)==null||n.destroy(),this.imageAtlasCoordsTexture=r.createTexture({width:h,height:h,format:"rgba32float"}),this.imageAtlasCoordsTexture.copyImageData({data:u,bytesPerRow:Ue("rgba32float",h),rowsPerImage:h,mipLevel:0,x:0,y:0})}updateSampledPointsGrid(){const{store:{screenSize:e},config:{pointSamplingDistance:t},device:n}=this;let r=t??Math.min(...e)/2;r===0&&(r=re.pointSamplingDistance);const o=Math.ceil(e[0]/r),s=Math.ceil(e[1]/r);(!this.sampledPointsFbo||this.sampledPointsFbo.width!==o||this.sampledPointsFbo.height!==s)&&(this.sampledPointsFbo&&!this.sampledPointsFbo.destroyed&&this.sampledPointsFbo.destroy(),this.sampledPointsFbo=n.createFramebuffer({width:o,height:s,colorAttachments:["rgba32float"]}))}trackPoints(){var e;if(!((e=this.trackedIndices)!=null&&e.length)||!this.trackPointsCommand||!this.trackPointsUniformStore||!this.trackedPositionsFbo||this.trackedPositionsFbo.destroyed||!this.currentPositionTexture||this.currentPositionTexture.destroyed||!this.trackedIndicesTexture||this.trackedIndicesTexture.destroyed)return;this.trackPointsUniformStore.setUniforms({trackPointsUniforms:{pointsTextureSize:this.store.pointsTextureSize??0}}),this.trackPointsCommand.setBindings({positionsTexture:this.currentPositionTexture,trackedIndices:this.trackedIndicesTexture});const t=this.device.beginRenderPass({framebuffer:this.trackedPositionsFbo});this.trackPointsCommand.draw(t),t.end()}draw(e){var t,n;const{data:r,config:o,store:s}=this;if(this.colorBuffer||this.updateColor(),this.sizeBuffer||this.updateSize(),this.shapeBuffer||this.updateShape(),this.imageIndicesBuffer||this.updateImageIndices(),this.imageSizesBuffer||this.updateImageSizes(),!this.drawCommand||!this.drawUniformStore||!this.currentPositionTexture||this.currentPositionTexture.destroyed||!this.greyoutStatusTexture||this.greyoutStatusTexture.destroyed||(!this.imageAtlasTexture||!this.imageAtlasCoordsTexture)&&(this.createAtlas(),!this.imageAtlasTexture||!this.imageAtlasCoordsTexture)||this.imageAtlasTexture.destroyed||this.imageAtlasCoordsTexture.destroyed||!r.pointsNumber||r.pointsNumber===0||!s.screenSize||s.screenSize[0]===0||s.screenSize[1]===0)return;this.drawCommand.setVertexCount(r.pointsNumber);const a={ratio:o.pixelRatio??re.pixelRatio,transformationMatrix:s.transformationMatrix4x4,pointsTextureSize:s.pointsTextureSize??0,sizeScale:o.pointSizeScale??1,spaceSize:s.adjustedSpaceSize??0,screenSize:Ke(s.screenSize,[0,0]),greyoutColor:ni(s.greyoutPointColor,[-1,-1,-1,-1]),backgroundColor:ni(s.backgroundColor,[0,0,0,1]),scalePointsOnZoom:o.scalePointsOnZoom??!0?1:0,maxPointSize:s.maxPointSize??100,isDarkenGreyout:s.isDarkenGreyout??!1?1:0,hasImages:this.imageCount>0?1:0,imageCount:this.imageCount,imageAtlasCoordsTextureSize:this.imageAtlasCoordsTextureSize??0},l={greyoutOpacity:o.pointGreyoutOpacity??-1,pointOpacity:o.pointOpacity??1,isDarkenGreyout:s.isDarkenGreyout??!1?1:0,backgroundColor:ni(s.backgroundColor,[0,0,0,1])};if(s.selectedIndices&&s.selectedIndices.length>0?(this.drawUniformStore.setUniforms({drawVertexUniforms:{...a,skipSelected:1,skipUnselected:0},drawFragmentUniforms:l}),this.drawCommand.setBindings({positionsTexture:this.currentPositionTexture,pointGreyoutStatus:this.greyoutStatusTexture,imageAtlasTexture:this.imageAtlasTexture,imageAtlasCoords:this.imageAtlasCoordsTexture}),this.drawCommand.draw(e),this.drawUniformStore.setUniforms({drawVertexUniforms:{...a,skipSelected:0,skipUnselected:1},drawFragmentUniforms:l}),this.drawCommand.setBindings({positionsTexture:this.currentPositionTexture,pointGreyoutStatus:this.greyoutStatusTexture,imageAtlasTexture:this.imageAtlasTexture,imageAtlasCoords:this.imageAtlasCoordsTexture}),this.drawCommand.draw(e)):(this.drawUniformStore.setUniforms({drawVertexUniforms:{...a,skipSelected:0,skipUnselected:0},drawFragmentUniforms:l}),this.drawCommand.setBindings({positionsTexture:this.currentPositionTexture,pointGreyoutStatus:this.greyoutStatusTexture,imageAtlasTexture:this.imageAtlasTexture,imageAtlasCoords:this.imageAtlasCoordsTexture}),this.drawCommand.draw(e)),o.renderHoveredPointRing&&s.hoveredPoint&&this.drawHighlightedCommand&&this.drawHighlightedUniformStore){if(!this.currentPositionTexture||this.currentPositionTexture.destroyed||!this.greyoutStatusTexture||this.greyoutStatusTexture.destroyed)return;const c=((t=r.pointSizes)==null?void 0:t[s.hoveredPoint.index])??1;this.drawHighlightedUniformStore.setUniforms({drawHighlightedUniforms:{size:c,transformationMatrix:s.transformationMatrix4x4,pointsTextureSize:s.pointsTextureSize??0,sizeScale:o.pointSizeScale??1,spaceSize:s.adjustedSpaceSize??0,screenSize:Ke(s.screenSize,[0,0]),scalePointsOnZoom:o.scalePointsOnZoom??!0?1:0,pointIndex:s.hoveredPoint.index,maxPointSize:s.maxPointSize??100,color:ni(s.hoveredPointRingColor,[0,0,0,1]),universalPointOpacity:o.pointOpacity??1,greyoutOpacity:o.pointGreyoutOpacity??-1,isDarkenGreyout:s.isDarkenGreyout??!1?1:0,backgroundColor:ni(s.backgroundColor,[0,0,0,1]),greyoutColor:ni(s.greyoutPointColor,[0,0,0,1]),width:.85}}),this.drawHighlightedCommand.setBindings({positionsTexture:this.currentPositionTexture,pointGreyoutStatusTexture:this.greyoutStatusTexture}),this.drawHighlightedCommand.draw(e)}if(s.focusedPoint&&this.drawHighlightedCommand&&this.drawHighlightedUniformStore){if(!this.currentPositionTexture||this.currentPositionTexture.destroyed||!this.greyoutStatusTexture||this.greyoutStatusTexture.destroyed)return;const c=((n=r.pointSizes)==null?void 0:n[s.focusedPoint.index])??1;this.drawHighlightedUniformStore.setUniforms({drawHighlightedUniforms:{size:c,transformationMatrix:s.transformationMatrix4x4,pointsTextureSize:s.pointsTextureSize??0,sizeScale:o.pointSizeScale??1,spaceSize:s.adjustedSpaceSize??0,screenSize:Ke(s.screenSize,[0,0]),scalePointsOnZoom:o.scalePointsOnZoom??!0?1:0,pointIndex:s.focusedPoint.index,maxPointSize:s.maxPointSize??100,color:ni(s.focusedPointRingColor,[0,0,0,1]),universalPointOpacity:o.pointOpacity??1,greyoutOpacity:o.pointGreyoutOpacity??-1,isDarkenGreyout:s.isDarkenGreyout??!1?1:0,backgroundColor:ni(s.backgroundColor,[0,0,0,1]),greyoutColor:ni(s.greyoutPointColor,[0,0,0,1]),width:.85}}),this.drawHighlightedCommand.setBindings({positionsTexture:this.currentPositionTexture,pointGreyoutStatusTexture:this.greyoutStatusTexture}),this.drawHighlightedCommand.draw(e)}}updatePosition(){if(!this.updatePositionCommand||!this.updatePositionUniformStore||!this.currentPositionFbo||this.currentPositionFbo.destroyed||!this.previousPositionTexture||this.previousPositionTexture.destroyed||!this.velocityTexture||this.velocityTexture.destroyed||!this.pinnedStatusTexture||this.pinnedStatusTexture.destroyed)return;this.updatePositionUniformStore.setUniforms({updatePositionUniforms:{friction:this.config.simulationFriction??0,spaceSize:this.store.adjustedSpaceSize??0}}),this.updatePositionCommand.setBindings({positionsTexture:this.previousPositionTexture,velocity:this.velocityTexture,pinnedStatusTexture:this.pinnedStatusTexture});const e=this.device.beginRenderPass({framebuffer:this.currentPositionFbo});this.updatePositionCommand.draw(e),e.end(),this.swapFbo(),this.isPositionsUpToDate=!1}drag(){var e;if(!this.dragPointCommand||!this.dragPointUniformStore||!this.currentPositionFbo||this.currentPositionFbo.destroyed||!this.previousPositionTexture||this.previousPositionTexture.destroyed)return;this.dragPointUniformStore.setUniforms({dragPointUniforms:{mousePos:Ke(this.store.mousePosition,[0,0]),index:((e=this.store.hoveredPoint)==null?void 0:e.index)??-1}}),this.dragPointCommand.setBindings({positionsTexture:this.previousPositionTexture});const t=this.device.beginRenderPass({framebuffer:this.currentPositionFbo});this.dragPointCommand.draw(t),t.end(),this.swapFbo(),this.isPositionsUpToDate=!1}findPointsOnAreaSelection(){var e,t;if(!this.findPointsOnAreaSelectionCommand||!this.findPointsOnAreaSelectionUniformStore||!this.selectedFbo||this.selectedFbo.destroyed||!this.currentPositionTexture||this.currentPositionTexture.destroyed||!this.sizeTexture||this.sizeTexture.destroyed)return;this.findPointsOnAreaSelectionUniformStore.setUniforms({findPointsOnAreaSelectionUniforms:{spaceSize:this.store.adjustedSpaceSize??0,screenSize:Ke(this.store.screenSize,[0,0]),sizeScale:this.config.pointSizeScale??1,transformationMatrix:this.store.transformationMatrix4x4,ratio:this.config.pixelRatio??re.pixelRatio,selection0:Ke((e=this.store.selectedArea)==null?void 0:e[0],[0,0]),selection1:Ke((t=this.store.selectedArea)==null?void 0:t[1],[0,0]),scalePointsOnZoom:this.config.scalePointsOnZoom??!0?1:0,maxPointSize:this.store.maxPointSize??100}}),this.findPointsOnAreaSelectionCommand.setBindings({positionsTexture:this.currentPositionTexture,pointSize:this.sizeTexture});const n=this.device.beginRenderPass({framebuffer:this.selectedFbo});this.findPointsOnAreaSelectionCommand.draw(n),n.end()}findPointsOnPolygonSelection(){if(!this.findPointsOnPolygonSelectionCommand||!this.findPointsOnPolygonSelectionUniformStore||!this.selectedFbo||this.selectedFbo.destroyed||!this.currentPositionTexture||this.currentPositionTexture.destroyed||!this.polygonPathTexture||this.polygonPathTexture.destroyed)return;this.findPointsOnPolygonSelectionUniformStore.setUniforms({findPointsOnPolygonSelectionUniforms:{spaceSize:this.store.adjustedSpaceSize??0,screenSize:Ke(this.store.screenSize,[0,0]),transformationMatrix:this.store.transformationMatrix4x4,polygonPathLength:this.polygonPathLength}}),this.findPointsOnPolygonSelectionCommand.setBindings({positionsTexture:this.currentPositionTexture,polygonPathTexture:this.polygonPathTexture});const e=this.device.beginRenderPass({framebuffer:this.selectedFbo});this.findPointsOnPolygonSelectionCommand.draw(e),e.end()}updatePolygonPath(e){const{device:t}=this;if(this.polygonPathLength=e.length,e.length===0){this.polygonPathTexture&&!this.polygonPathTexture.destroyed&&this.polygonPathTexture.destroy(),this.polygonPathTexture=void 0;return}const n=Math.ceil(Math.sqrt(e.length)),r=new Float32Array(n*n*4);for(const[o,s]of e.entries()){const[a,l]=s;r[o*4]=a,r[o*4+1]=l,r[o*4+2]=0,r[o*4+3]=0}!this.polygonPathTexture||this.polygonPathTexture.width!==n||this.polygonPathTexture.height!==n?(this.polygonPathTexture&&!this.polygonPathTexture.destroyed&&this.polygonPathTexture.destroy(),this.polygonPathTexture=t.createTexture({width:n,height:n,format:"rgba32float"}),this.polygonPathTexture.copyImageData({data:r,bytesPerRow:Ue("rgba32float",n),mipLevel:0,x:0,y:0})):this.polygonPathTexture.copyImageData({data:r,bytesPerRow:Ue("rgba32float",n),mipLevel:0,x:0,y:0})}findHoveredPoint(){if(!this.hoveredFbo||this.hoveredFbo.destroyed||!this.findHoveredPointCommand||!this.findHoveredPointUniformStore||!this.currentPositionTexture||this.currentPositionTexture.destroyed)return;this.findHoveredPointCommand.setVertexCount(this.data.pointsNumber??0),this.findHoveredPointCommand.setAttributes({...this.hoveredPointIndices&&{pointIndices:this.hoveredPointIndices},...this.sizeBuffer&&{size:this.sizeBuffer}}),this.findHoveredPointUniformStore.setUniforms({findHoveredPointUniforms:{ratio:this.config.pixelRatio??re.pixelRatio,sizeScale:this.config.pointSizeScale??1,pointsTextureSize:this.store.pointsTextureSize??0,transformationMatrix:this.store.transformationMatrix4x4,spaceSize:this.store.adjustedSpaceSize??0,screenSize:Ke(this.store.screenSize,[0,0]),scalePointsOnZoom:this.config.scalePointsOnZoom??!0?1:0,mousePosition:Ke(this.store.screenMousePosition,[0,0]),maxPointSize:this.store.maxPointSize??100}}),this.findHoveredPointCommand.setBindings({positionsTexture:this.currentPositionTexture});const e=this.device.beginRenderPass({framebuffer:this.hoveredFbo,clearColor:[0,0,0,0]});this.findHoveredPointCommand.draw(e),e.end()}trackPointsByIndices(e){const{store:{pointsTextureSize:t},device:n}=this;if(this.trackedIndices=e,this.trackedPositions=void 0,this.isPositionsUpToDate=!1,!(e!=null&&e.length)||!t)return;const r=Math.ceil(Math.sqrt(e.length)),o=new Float32Array(r*r*4).fill(-1);for(const[s,a]of e.entries())a!==void 0&&(o[s*4]=a%t,o[s*4+1]=Math.floor(a/t),o[s*4+2]=0,o[s*4+3]=0);!this.trackedIndicesTexture||this.trackedIndicesTexture.width!==r||this.trackedIndicesTexture.height!==r?(this.trackedIndicesTexture&&!this.trackedIndicesTexture.destroyed&&this.trackedIndicesTexture.destroy(),this.trackedIndicesTexture=n.createTexture({width:r,height:r,format:"rgba32float"}),this.trackedIndicesTexture.copyImageData({data:o,bytesPerRow:Ue("rgba32float",r),mipLevel:0,x:0,y:0})):this.trackedIndicesTexture.copyImageData({data:o,bytesPerRow:Ue("rgba32float",r),mipLevel:0,x:0,y:0}),(!this.trackedPositionsFbo||this.trackedPositionsFbo.width!==r||this.trackedPositionsFbo.height!==r)&&(this.trackedPositionsFbo&&!this.trackedPositionsFbo.destroyed&&this.trackedPositionsFbo.destroy(),this.trackedPositionsFbo=n.createFramebuffer({width:r,height:r,colorAttachments:["rgba32float"]})),this.trackPoints()}getTrackedPositionsMap(){if(!this.trackedIndices)return new Map;const{config:{enableSimulation:e},store:{isSimulationRunning:t}}=this;if((!e||!t)&&this.isPositionsUpToDate&&this.trackedPositions)return this.trackedPositions;if(!this.trackedPositionsFbo||this.trackedPositionsFbo.destroyed)return new Map;const n=tn(this.device,this.trackedPositionsFbo),r=new Map;for(let o=0;o<n.length/4;o+=1){const s=n[o*4],a=n[o*4+1],l=this.trackedIndices[o];s!==void 0&&a!==void 0&&l!==void 0&&r.set(l,[s,a])}return(!e||!t)&&(this.trackedPositions=r,this.isPositionsUpToDate=!0),r}getSampledPointPositionsMap(){const e=new Map;if(!this.sampledPointsFbo||this.sampledPointsFbo.destroyed)return e;if(this.fillSampledPointsFboCommand&&this.fillSampledPointsUniformStore&&this.sampledPointsFbo){if(!this.currentPositionTexture||this.currentPositionTexture.destroyed)return e;this.fillSampledPointsFboCommand.setVertexCount(this.data.pointsNumber??0),this.fillSampledPointsUniformStore.setUniforms({fillSampledPointsUniforms:{pointsTextureSize:this.store.pointsTextureSize??0,transformationMatrix:this.store.transformationMatrix4x4,spaceSize:this.store.adjustedSpaceSize??0,screenSize:Ke(this.store.screenSize,[0,0])}}),this.fillSampledPointsFboCommand.setBindings({positionsTexture:this.currentPositionTexture});const n=this.device.beginRenderPass({framebuffer:this.sampledPointsFbo,clearColor:[0,0,0,0]});this.fillSampledPointsFboCommand.draw(n),n.end()}const t=tn(this.device,this.sampledPointsFbo);for(let n=0;n<t.length/4;n++){const r=t[n*4],o=!!t[n*4+1],s=t[n*4+2],a=t[n*4+3];o&&r!==void 0&&s!==void 0&&a!==void 0&&e.set(r,[s,a])}return e}getSampledPoints(){const e=[],t=[];if(!this.sampledPointsFbo||this.sampledPointsFbo.destroyed)return{indices:e,positions:t};if(this.fillSampledPointsFboCommand&&this.fillSampledPointsUniformStore&&this.sampledPointsFbo){if(!this.currentPositionTexture||this.currentPositionTexture.destroyed)return{indices:e,positions:t};this.fillSampledPointsFboCommand.setVertexCount(this.data.pointsNumber??0),this.fillSampledPointsUniformStore.setUniforms({fillSampledPointsUniforms:{pointsTextureSize:this.store.pointsTextureSize??0,transformationMatrix:this.store.transformationMatrix4x4,spaceSize:this.store.adjustedSpaceSize??0,screenSize:Ke(this.store.screenSize,[0,0])}}),this.fillSampledPointsFboCommand.setBindings({positionsTexture:this.currentPositionTexture});const r=this.device.beginRenderPass({framebuffer:this.sampledPointsFbo,clearColor:[0,0,0,0]});this.fillSampledPointsFboCommand.draw(r),r.end()}const n=tn(this.device,this.sampledPointsFbo);for(let r=0;r<n.length/4;r++){const o=n[r*4],s=!!n[r*4+1],a=n[r*4+2],l=n[r*4+3];s&&o!==void 0&&a!==void 0&&l!==void 0&&(e.push(o),t.push(a,l))}return{indices:e,positions:t}}getTrackedPositionsArray(){const e=[];if(!this.trackedIndices||!this.trackedPositionsFbo||this.trackedPositionsFbo.destroyed)return e;e.length=this.trackedIndices.length*2;const t=tn(this.device,this.trackedPositionsFbo);for(let n=0;n<t.length/4;n+=1){const r=t[n*4],o=t[n*4+1],s=this.trackedIndices[n];r!==void 0&&o!==void 0&&s!==void 0&&(e[n*2]=r,e[n*2+1]=o)}return e}destroy(){var e,t,n,r,o,s,a,l,c,u,h,d,f,p,b,g,_,T;(e=this.drawCommand)==null||e.destroy(),this.drawCommand=void 0,(t=this.drawHighlightedCommand)==null||t.destroy(),this.drawHighlightedCommand=void 0,(n=this.updatePositionCommand)==null||n.destroy(),this.updatePositionCommand=void 0,(r=this.dragPointCommand)==null||r.destroy(),this.dragPointCommand=void 0,(o=this.findPointsOnAreaSelectionCommand)==null||o.destroy(),this.findPointsOnAreaSelectionCommand=void 0,(s=this.findPointsOnPolygonSelectionCommand)==null||s.destroy(),this.findPointsOnPolygonSelectionCommand=void 0,(a=this.findHoveredPointCommand)==null||a.destroy(),this.findHoveredPointCommand=void 0,(l=this.fillSampledPointsFboCommand)==null||l.destroy(),this.fillSampledPointsFboCommand=void 0,(c=this.trackPointsCommand)==null||c.destroy(),this.trackPointsCommand=void 0,this.currentPositionFbo&&!this.currentPositionFbo.destroyed&&this.currentPositionFbo.destroy(),this.currentPositionFbo=void 0,this.previousPositionFbo&&!this.previousPositionFbo.destroyed&&this.previousPositionFbo.destroy(),this.previousPositionFbo=void 0,this.velocityFbo&&!this.velocityFbo.destroyed&&this.velocityFbo.destroy(),this.velocityFbo=void 0,this.selectedFbo&&!this.selectedFbo.destroyed&&this.selectedFbo.destroy(),this.selectedFbo=void 0,this.hoveredFbo&&!this.hoveredFbo.destroyed&&this.hoveredFbo.destroy(),this.hoveredFbo=void 0,this.trackedPositionsFbo&&!this.trackedPositionsFbo.destroyed&&this.trackedPositionsFbo.destroy(),this.trackedPositionsFbo=void 0,this.sampledPointsFbo&&!this.sampledPointsFbo.destroyed&&this.sampledPointsFbo.destroy(),this.sampledPointsFbo=void 0,this.currentPositionTexture&&!this.currentPositionTexture.destroyed&&this.currentPositionTexture.destroy(),this.currentPositionTexture=void 0,this.previousPositionTexture&&!this.previousPositionTexture.destroyed&&this.previousPositionTexture.destroy(),this.previousPositionTexture=void 0,this.velocityTexture&&!this.velocityTexture.destroyed&&this.velocityTexture.destroy(),this.velocityTexture=void 0,this.selectedTexture&&!this.selectedTexture.destroyed&&this.selectedTexture.destroy(),this.selectedTexture=void 0,this.greyoutStatusTexture&&!this.greyoutStatusTexture.destroyed&&this.greyoutStatusTexture.destroy(),this.greyoutStatusTexture=void 0,this.sizeTexture&&!this.sizeTexture.destroyed&&this.sizeTexture.destroy(),this.sizeTexture=void 0,this.trackedIndicesTexture&&!this.trackedIndicesTexture.destroyed&&this.trackedIndicesTexture.destroy(),this.trackedIndicesTexture=void 0,this.polygonPathTexture&&!this.polygonPathTexture.destroyed&&this.polygonPathTexture.destroy(),this.polygonPathTexture=void 0,this.imageAtlasTexture&&!this.imageAtlasTexture.destroyed&&this.imageAtlasTexture.destroy(),this.imageAtlasTexture=void 0,this.imageAtlasCoordsTexture&&!this.imageAtlasCoordsTexture.destroyed&&this.imageAtlasCoordsTexture.destroy(),this.imageAtlasCoordsTexture=void 0,this.pinnedStatusTexture&&!this.pinnedStatusTexture.destroyed&&this.pinnedStatusTexture.destroy(),this.pinnedStatusTexture=void 0,(u=this.updatePositionUniformStore)==null||u.destroy(),this.updatePositionUniformStore=void 0,(h=this.dragPointUniformStore)==null||h.destroy(),this.dragPointUniformStore=void 0,(d=this.drawUniformStore)==null||d.destroy(),this.drawUniformStore=void 0,(f=this.findPointsOnAreaSelectionUniformStore)==null||f.destroy(),this.findPointsOnAreaSelectionUniformStore=void 0,(p=this.findPointsOnPolygonSelectionUniformStore)==null||p.destroy(),this.findPointsOnPolygonSelectionUniformStore=void 0,(b=this.findHoveredPointUniformStore)==null||b.destroy(),this.findHoveredPointUniformStore=void 0,(g=this.fillSampledPointsUniformStore)==null||g.destroy(),this.fillSampledPointsUniformStore=void 0,(_=this.drawHighlightedUniformStore)==null||_.destroy(),this.drawHighlightedUniformStore=void 0,(T=this.trackPointsUniformStore)==null||T.destroy(),this.trackPointsUniformStore=void 0,this.colorBuffer&&!this.colorBuffer.destroyed&&this.colorBuffer.destroy(),this.colorBuffer=void 0,this.sizeBuffer&&!this.sizeBuffer.destroyed&&this.sizeBuffer.destroy(),this.sizeBuffer=void 0,this.shapeBuffer&&!this.shapeBuffer.destroyed&&this.shapeBuffer.destroy(),this.shapeBuffer=void 0,this.imageIndicesBuffer&&!this.imageIndicesBuffer.destroyed&&this.imageIndicesBuffer.destroy(),this.imageIndicesBuffer=void 0,this.imageSizesBuffer&&!this.imageSizesBuffer.destroyed&&this.imageSizesBuffer.destroy(),this.imageSizesBuffer=void 0,this.drawPointIndices&&!this.drawPointIndices.destroyed&&this.drawPointIndices.destroy(),this.drawPointIndices=void 0,this.hoveredPointIndices&&!this.hoveredPointIndices.destroyed&&this.hoveredPointIndices.destroy(),this.hoveredPointIndices=void 0,this.sampledPointIndices&&!this.sampledPointIndices.destroyed&&this.sampledPointIndices.destroy(),this.sampledPointIndices=void 0,this.updatePositionVertexCoordBuffer&&!this.updatePositionVertexCoordBuffer.destroyed&&this.updatePositionVertexCoordBuffer.destroy(),this.updatePositionVertexCoordBuffer=void 0,this.dragPointVertexCoordBuffer&&!this.dragPointVertexCoordBuffer.destroyed&&this.dragPointVertexCoordBuffer.destroy(),this.dragPointVertexCoordBuffer=void 0,this.findPointsOnAreaSelectionVertexCoordBuffer&&!this.findPointsOnAreaSelectionVertexCoordBuffer.destroyed&&this.findPointsOnAreaSelectionVertexCoordBuffer.destroy(),this.findPointsOnAreaSelectionVertexCoordBuffer=void 0,this.findPointsOnPolygonSelectionVertexCoordBuffer&&!this.findPointsOnPolygonSelectionVertexCoordBuffer.destroyed&&this.findPointsOnPolygonSelectionVertexCoordBuffer.destroy(),this.findPointsOnPolygonSelectionVertexCoordBuffer=void 0,this.drawHighlightedVertexCoordBuffer&&!this.drawHighlightedVertexCoordBuffer.destroyed&&this.drawHighlightedVertexCoordBuffer.destroy(),this.drawHighlightedVertexCoordBuffer=void 0,this.trackPointsVertexCoordBuffer&&!this.trackPointsVertexCoordBuffer.destroyed&&this.trackPointsVertexCoordBuffer.destroy(),this.trackPointsVertexCoordBuffer=void 0}swapFbo(){if(!this.currentPositionTexture||this.currentPositionTexture.destroyed||!this.previousPositionTexture||this.previousPositionTexture.destroyed||!this.currentPositionFbo||this.currentPositionFbo.destroyed||!this.previousPositionFbo||this.previousPositionFbo.destroyed)return;const e=this.previousPositionTexture,t=this.previousPositionFbo;this.previousPositionTexture=this.currentPositionTexture,this.previousPositionFbo=this.currentPositionFbo,this.currentPositionTexture=e,this.currentPositionFbo=t}rescaleInitialNodePositions(){const{config:{spaceSize:e}}=this;if(!this.data.pointPositions||!e)return;const t=this.data.pointPositions,n=t.length/2;let r=1/0,o=-1/0,s=1/0,a=-1/0;for(let b=0;b<t.length;b+=2){const g=t[b],_=t[b+1];r=Math.min(r,g),o=Math.max(o,g),s=Math.min(s,_),a=Math.max(a,_)}const l=o-r,c=a-s,u=Math.max(l,c);if(u>e){this.scaleX=void 0,this.scaleY=void 0;return}const h=e*e*.001,d=(n>h?e*Math.max(1.2,Math.sqrt(n)/e):e*.1)/u,f=(u-l)/2*d,p=(u-c)/2*d;this.scaleX=b=>(b-r)*d+f,this.scaleY=b=>(b-s)*d+p;for(let b=0;b<n;b++)this.data.pointPositions[b*2]=this.scaleX(t[b*2]),this.data.pointPositions[b*2+1]=this.scaleY(t[b*2+1])}}var Rv=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});function $D(){var i=new Rv(9);return Rv!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Pv(i,e,t){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=t[0],f=t[1];return i[0]=n,i[1]=r,i[2]=o,i[3]=s,i[4]=a,i[5]=l,i[6]=d*n+f*s+c,i[7]=d*r+f*a+u,i[8]=d*o+f*l+h,i}function cp(i,e,t){var n=t[0],r=t[1];return i[0]=n*e[0],i[1]=n*e[1],i[2]=n*e[2],i[3]=r*e[3],i[4]=r*e[4],i[5]=r*e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i}function VD(i,e,t){return i[0]=2/e,i[1]=0,i[2]=0,i[3]=0,i[4]=-2/t,i[5]=0,i[6]=-1,i[7]=1,i[8]=1,i}var Lm={exports:{}},HD=Lm.exports,Dv;function GD(){return Dv||(Dv=1,(function(i){(function(e,t,n){function r(l){var c=this,u=a();c.next=function(){var h=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=h-(c.c=h|0)},c.c=1,c.s0=u(" "),c.s1=u(" "),c.s2=u(" "),c.s0-=u(l),c.s0<0&&(c.s0+=1),c.s1-=u(l),c.s1<0&&(c.s1+=1),c.s2-=u(l),c.s2<0&&(c.s2+=1),u=null}function o(l,c){return c.c=l.c,c.s0=l.s0,c.s1=l.s1,c.s2=l.s2,c}function s(l,c){var u=new r(l),h=c&&c.state,d=u.next;return d.int32=function(){return u.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,h&&(typeof h=="object"&&o(h,u),d.state=function(){return o(u,{})}),d}function a(){var l=4022871197,c=function(u){u=String(u);for(var h=0;h<u.length;h++){l+=u.charCodeAt(h);var d=.02519603282416938*l;l=d>>>0,d-=l,d*=l,l=d>>>0,d-=l,l+=d*4294967296}return(l>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=s:this.alea=s})(HD,i)})(Lm)),Lm.exports}var Rm={exports:{}},WD=Rm.exports,Mv;function jD(){return Mv||(Mv=1,(function(i){(function(e,t,n){function r(a){var l=this,c="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var h=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^h^h>>>8},a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function s(a,l){var c=new r(a),u=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var d=c.next()>>>11,f=(c.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=c.next,h.quick=h,u&&(typeof u=="object"&&o(u,c),h.state=function(){return o(c,{})}),h}t&&t.exports?t.exports=s:this.xor128=s})(WD,i)})(Rm)),Rm.exports}var Pm={exports:{}},YD=Pm.exports,Nv;function qD(){return Nv||(Nv=1,(function(i){(function(e,t,n){function r(a){var l=this,c="";l.next=function(){var h=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(h^h<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,u==c.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function s(a,l){var c=new r(a),u=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var d=c.next()>>>11,f=(c.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=c.next,h.quick=h,u&&(typeof u=="object"&&o(u,c),h.state=function(){return o(c,{})}),h}t&&t.exports?t.exports=s:this.xorwow=s})(YD,i)})(Pm)),Pm.exports}var Dm={exports:{}},XD=Dm.exports,Bv;function KD(){return Bv||(Bv=1,(function(i){(function(e,t,n){function r(a){var l=this;l.next=function(){var u=l.x,h=l.i,d,f;return d=u[h],d^=d>>>7,f=d^d<<24,d=u[h+1&7],f^=d^d>>>10,d=u[h+3&7],f^=d^d>>>3,d=u[h+4&7],f^=d^d<<7,d=u[h+7&7],d=d^d<<13,f^=d^d<<9,u[h]=f,l.i=h+1&7,f};function c(u,h){var d,f=[];if(h===(h|0))f[0]=h;else for(h=""+h,d=0;d<h.length;++d)f[d&7]=f[d&7]<<15^h.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?f[7]=-1:f[d],u.x=f,u.i=0,d=256;d>0;--d)u.next()}c(l,a)}function o(a,l){return l.x=a.x.slice(),l.i=a.i,l}function s(a,l){a==null&&(a=+new Date);var c=new r(a),u=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var d=c.next()>>>11,f=(c.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=c.next,h.quick=h,u&&(u.x&&o(u,c),h.state=function(){return o(c,{})}),h}t&&t.exports?t.exports=s:this.xorshift7=s})(XD,i)})(Dm)),Dm.exports}var Mm={exports:{}},ZD=Mm.exports,Ov;function QD(){return Ov||(Ov=1,(function(i){(function(e,t,n){function r(a){var l=this;l.next=function(){var u=l.w,h=l.X,d=l.i,f,p;return l.w=u=u+1640531527|0,p=h[d+34&127],f=h[d=d+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,p=h[d]=p^f,l.i=d,p+(u^u>>>16)|0};function c(u,h){var d,f,p,b,g,_=[],T=128;for(h===(h|0)?(f=h,h=null):(h=h+"\0",f=0,T=Math.max(T,h.length)),p=0,b=-32;b<T;++b)h&&(f^=h.charCodeAt((b+32)%h.length)),b===0&&(g=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,b>=0&&(g=g+1640531527|0,d=_[b&127]^=f+g,p=d==0?p+1:0);for(p>=128&&(_[(h&&h.length||0)&127]=-1),p=127,b=512;b>0;--b)f=_[p+34&127],d=_[p=p+1&127],f^=f<<13,d^=d<<17,f^=f>>>15,d^=d>>>12,_[p]=f^d;u.w=g,u.X=_,u.i=p}c(l,a)}function o(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function s(a,l){a==null&&(a=+new Date);var c=new r(a),u=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var d=c.next()>>>11,f=(c.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=c.next,h.quick=h,u&&(u.X&&o(u,c),h.state=function(){return o(c,{})}),h}t&&t.exports?t.exports=s:this.xor4096=s})(ZD,i)})(Mm)),Mm.exports}var Nm={exports:{}},JD=Nm.exports,Fv;function eM(){return Fv||(Fv=1,(function(i){(function(e,t,n){function r(a){var l=this,c="";l.next=function(){var h=l.b,d=l.c,f=l.d,p=l.a;return h=h<<25^h>>>7^d,d=d-f|0,f=f<<24^f>>>8^p,p=p-h|0,l.b=h=h<<20^h>>>12^d,l.c=d=d-f|0,l.d=f<<16^d>>>16^p,l.a=p-h|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):c+=a;for(var u=0;u<c.length+20;u++)l.b^=c.charCodeAt(u)|0,l.next()}function o(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function s(a,l){var c=new r(a),u=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var d=c.next()>>>11,f=(c.next()>>>0)/4294967296,p=(d+f)/(1<<21);while(p===0);return p},h.int32=c.next,h.quick=h,u&&(typeof u=="object"&&o(u,c),h.state=function(){return o(c,{})}),h}t&&t.exports?t.exports=s:this.tychei=s})(JD,i)})(Nm)),Nm.exports}var Bm={exports:{}};const tM={},iM=Object.freeze(Object.defineProperty({__proto__:null,default:tM},Symbol.toStringTag,{value:"Module"})),nM=FP(iM);var rM=Bm.exports,zv;function oM(){return zv||(zv=1,(function(i){(function(e,t,n){var r=256,o=6,s=52,a="random",l=n.pow(r,o),c=n.pow(2,s),u=c*2,h=r-1,d;function f(y,C,I){var F=[];C=C==!0?{entropy:!0}:C||{};var V=_(g(C.entropy?[y,E(t)]:y??T(),3),F),q=new p(F),Q=function(){for(var M=q.g(o),ae=l,ee=0;M<c;)M=(M+ee)*r,ae*=r,ee=q.g(1);for(;M>=u;)M/=2,ae/=2,ee>>>=1;return(M+ee)/ae};return Q.int32=function(){return q.g(4)|0},Q.quick=function(){return q.g(4)/4294967296},Q.double=Q,_(E(q.S),t),(C.pass||I||function(M,ae,ee,R){return R&&(R.S&&b(R,q),M.state=function(){return b(q,{})}),ee?(n[a]=M,ae):M})(Q,V,"global"in C?C.global:this==n,C.state)}function p(y){var C,I=y.length,F=this,V=0,q=F.i=F.j=0,Q=F.S=[];for(I||(y=[I++]);V<r;)Q[V]=V++;for(V=0;V<r;V++)Q[V]=Q[q=h&q+y[V%I]+(C=Q[V])],Q[q]=C;(F.g=function(M){for(var ae,ee=0,R=F.i,X=F.j,O=F.S;M--;)ae=O[R=h&R+1],ee=ee*r+O[h&(O[R]=O[X=h&X+ae])+(O[X]=ae)];return F.i=R,F.j=X,ee})(r)}function b(y,C){return C.i=y.i,C.j=y.j,C.S=y.S.slice(),C}function g(y,C){var I=[],F=typeof y,V;if(C&&F=="object")for(V in y)try{I.push(g(y[V],C-1))}catch{}return I.length?I:F=="string"?y:y+"\0"}function _(y,C){for(var I=y+"",F,V=0;V<I.length;)C[h&V]=h&(F^=C[h&V]*19)+I.charCodeAt(V++);return E(C)}function T(){try{var y;return d&&(y=d.randomBytes)?y=y(r):(y=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(y)),E(y)}catch{var C=e.navigator,I=C&&C.plugins;return[+new Date,e,I,e.screen,E(t)]}}function E(y){return String.fromCharCode.apply(0,y)}if(_(n.random(),t),i.exports){i.exports=f;try{d=nM}catch{}}else n["seed"+a]=f})(typeof self<"u"?self:rM,[],Math)})(Bm)),Bm.exports}var up,Uv;function sM(){if(Uv)return up;Uv=1;var i=GD(),e=jD(),t=qD(),n=KD(),r=QD(),o=eM(),s=oM();return s.alea=i,s.xor128=e,s.xorwow=t,s.xorshift7=n,s.xor4096=r,s.tychei=o,up=s,up}var aM=sM();const lM=Qw(aM);function cM(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,hM(n.key),n)}}function f_(i,e,t){return e&&cM(i.prototype,e),Object.defineProperty(i,"prototype",{writable:!1}),i}function cS(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i,Om(i,e)}function Om(i,e){return Om=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},Om(i,e)}function uM(i,e){if(typeof i!="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}function hM(i){var e=uM(i,"string");return typeof e=="symbol"?e:String(e)}var lf=(function(){function i(){}var e=i.prototype;return e._seed=function(t,n){if(t===(t||0))return t;for(var r=""+t,o=0,s=0;s<r.length;++s)o^=r.charCodeAt(s)|0;return o},i})(),$v=(function(i){cS(e,i);function e(n,r){var o;return o=i.call(this)||this,o._rng=void 0,o.seed(n,r),o}var t=e.prototype;return t.next=function(){return this._rng()},t.seed=function(n,r){this._rng=n},t.clone=function(n,r){return new e(this._rng,r)},f_(e,[{key:"name",get:function(){return"function"}}]),e})(lf),Vv=function(){var i=[].slice.call(arguments),e=i,t=e[0],n=t===void 0?"default":t;switch(typeof n){case"object":if(n instanceof lf)return n;break;case"function":return new $v(n);case"number":case"string":default:return new $v(lM.apply(void 0,i))}throw new Error('invalid RNG "'+n+'"')},dM=function(i,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),function(){return i.next()*(t-e)+e}};function jn(i){return new fM(i)}var fM=function(i){var e=this;this.n=void 0,this.isInt=function(){if(Number.isInteger(e.n))return e;throw new Error("Expected number to be an integer, got "+e.n)},this.isPositive=function(){if(e.n>0)return e;throw new Error("Expected number to be positive, got "+e.n)},this.lessThan=function(t){if(e.n<t)return e;throw new Error("Expected number to be less than "+t+", got "+e.n)},this.greaterThanOrEqual=function(t){if(e.n>=t)return e;throw new Error("Expected number to be greater than or equal to "+t+", got "+e.n)},this.greaterThan=function(t){if(e.n>t)return e;throw new Error("Expected number to be greater than "+t+", got "+e.n)},this.n=i},pM=function(i,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),t===void 0&&(t=e===void 0?1:e,e=0),jn(e).isInt(),jn(t).isInt(),function(){return Math.floor(i.next()*(t-e+1)+e)}},mM=function(i){return function(){return i.next()>=.5}},gM=function(i,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),function(){var n,r,o;do n=i.next()*2-1,r=i.next()*2-1,o=n*n+r*r;while(!o||o>1);return e+t*r*Math.sqrt(-2*Math.log(o)/o)}},_M=function(i,e,t){e===void 0&&(e=0),t===void 0&&(t=1);var n=i.normal(e,t);return function(){return Math.exp(n())}},yM=function(i,e){return e===void 0&&(e=.5),jn(e).greaterThanOrEqual(0).lessThan(1),function(){return Math.floor(i.next()+e)}},bM=function(i,e,t){return e===void 0&&(e=1),t===void 0&&(t=.5),jn(e).isInt().isPositive(),jn(t).greaterThanOrEqual(0).lessThan(1),function(){for(var n=0,r=0;n++<e;)i.next()<t&&r++;return r}},vM=function(i,e){e===void 0&&(e=.5),jn(e).greaterThan(0).lessThan(1);var t=1/Math.log(1-e);return function(){return Math.floor(1+Math.log(i.next())*t)}},xM=[0,0,.6931471805599453,1.791759469228055,3.1780538303479458,4.787491742782046,6.579251212010101,8.525161361065415,10.60460290274525,12.801827480081469],wM=function(i){return xM[i]},SM=.9189385332046727,EM=function(i,e){if(e===void 0&&(e=1),jn(e).isPositive(),e<10){var t=Math.exp(-e);return function(){for(var l=t,c=0,u=i.next();u>l;)u=u-l,l=e*l/++c;return c}}else{var n=Math.sqrt(e),r=.931+2.53*n,o=-.059+.02483*r,s=1.1239+1.1328/(r-3.4),a=.9277-3.6224/(r-2);return function(){for(;;){var l=void 0,c=i.next();if(c<=.86*a)return l=c/a-.43,Math.floor((2*o/(.5-Math.abs(l))+r)*l+e+.445);c>=a?l=i.next()-.5:(l=c/a-.93,l=(l<0?-.5:.5)-l,c=i.next()*a);var u=.5-Math.abs(l);if(!(u<.013&&c>u)){var h=Math.floor((2*o/u+r)*l+e+.445);if(c=c*s/(o/(u*u)+r),h>=10){var d=(h+.5)*Math.log(e/h)-e-SM+h-(.08333333333333333-(.002777777777777778-1/(1260*h*h))/(h*h))/h;if(Math.log(c*n)<=d)return h}else if(h>=0){var f,p=(f=wM(h))!=null?f:0;if(Math.log(c)<=h*Math.log(e)-e-p)return h}}}}}},CM=function(i,e){return e===void 0&&(e=1),jn(e).isPositive(),function(){return-Math.log(1-i.next())/e}},TM=function(i,e){return e===void 0&&(e=1),jn(e).isInt().greaterThanOrEqual(0),function(){for(var t=0,n=0;n<e;++n)t+=i.next();return t}},AM=function(i,e){e===void 0&&(e=1),jn(e).isInt().isPositive();var t=i.irwinHall(e);return function(){return t()/e}},IM=function(i,e){e===void 0&&(e=1),jn(e).greaterThanOrEqual(0);var t=1/e;return function(){return 1/Math.pow(1-i.next(),t)}},kM=(function(i){cS(e,i);function e(){return i.apply(this,arguments)||this}var t=e.prototype;return t.next=function(){return Math.random()},t.seed=function(n,r){},t.clone=function(){return new e},f_(e,[{key:"name",get:function(){return"default"}}]),e})(lf),uS=(function(){function i(t){var n=this;this._rng=void 0,this._patch=void 0,this._cache={},this.next=function(){return n._rng.next()},this.float=function(r,o){return n.uniform(r,o)()},this.int=function(r,o){return n.uniformInt(r,o)()},this.integer=function(r,o){return n.uniformInt(r,o)()},this.bool=function(){return n.uniformBoolean()()},this.boolean=function(){return n.uniformBoolean()()},this.uniform=function(r,o){return n._memoize("uniform",dM,r,o)},this.uniformInt=function(r,o){return n._memoize("uniformInt",pM,r,o)},this.uniformBoolean=function(){return n._memoize("uniformBoolean",mM)},this.normal=function(r,o){return gM(n,r,o)},this.logNormal=function(r,o){return _M(n,r,o)},this.bernoulli=function(r){return yM(n,r)},this.binomial=function(r,o){return bM(n,r,o)},this.geometric=function(r){return vM(n,r)},this.poisson=function(r){return EM(n,r)},this.exponential=function(r){return CM(n,r)},this.irwinHall=function(r){return TM(n,r)},this.bates=function(r){return AM(n,r)},this.pareto=function(r){return IM(n,r)},t&&t instanceof lf?this.use(t):this.use(new kM),this._cache={}}var e=i.prototype;return e.clone=function(){var t=[].slice.call(arguments);return t.length?new i(Vv.apply(void 0,t)):new i(this.rng.clone())},e.use=function(){this._rng=Vv.apply(void 0,[].slice.call(arguments))},e.patch=function(){if(this._patch)throw new Error("Math.random already patched");this._patch=Math.random,Math.random=this.uniform()},e.unpatch=function(){this._patch&&(Math.random=this._patch,delete this._patch)},e.choice=function(t){if(!Array.isArray(t))throw new Error("Random.choice expected input to be an array, got "+typeof t);var n=t==null?void 0:t.length;if(n>0){var r=this.uniformInt(0,n-1)();return t[r]}else return},e._memoize=function(t,n){var r=[].slice.call(arguments,2),o=""+r.join(";"),s=this._cache[t];return(s===void 0||s.key!==o)&&(s={key:o,distribution:n.apply(void 0,[this].concat(r))},this._cache[t]=s),s.distribution},f_(i,[{key:"rng",get:function(){return this._rng}}]),i})();new uS;const Fm=.001,zm=64,LM=4;class RM{constructor(){this.pointsTextureSize=0,this.linksTextureSize=0,this.alpha=1,this.transform=$D(),this.screenSize=[0,0],this.mousePosition=[0,0],this.screenMousePosition=[0,0],this.selectedArea=[[0,0],[0,0]],this.isSimulationRunning=!1,this.simulationProgress=0,this.selectedIndices=null,this.maxPointSize=zm,this.hoveredPoint=void 0,this.focusedPoint=void 0,this.draggingPointIndex=void 0,this.hoveredLinkIndex=void 0,this.adjustedSpaceSize=re.spaceSize,this.isSpaceKeyPressed=!1,this.webglMaxTextureSize=16384,this.hoveredPointRingColor=[1,1,1,yR],this.focusedPointRingColor=[1,1,1,bR],this.hoveredLinkColor=[-1,-1,-1,-1],this.greyoutPointColor=[-1,-1,-1,-1],this.isDarkenGreyout=!1,this.isLinkHoveringEnabled=!1,this.alphaTarget=0,this.scalePointX=km(),this.scalePointY=km(),this.random=new uS,this._backgroundColor=[0,0,0,0],this.alphaDecay=e=>1-Math.pow(Fm,1/e)}get backgroundColor(){return this._backgroundColor}get transformationMatrix4x4(){const e=this.transform;if(e.length!==9)throw new Error(`Transform must be a 9-element array (3x3 matrix), got ${e.length} elements`);return[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]}set backgroundColor(e){this._backgroundColor=e;const t=jR(e[0],e[1],e[2]);document.documentElement.style.setProperty("--cosmosgl-attribution-color",t>.65?"black":"white"),document.documentElement.style.setProperty("--cosmosgl-error-message-color",t>.65?"black":"white"),this.div&&(this.div.style.backgroundColor=`rgba(${e[0]*255}, ${e[1]*255}, ${e[2]*255}, ${e[3]})`),this.isDarkenGreyout=t<.65}addRandomSeed(e){this.random=this.random.clone(e)}getRandomFloat(e,t){return this.random.float(e,t)}adjustSpaceSize(e,t){(e<=0||!isFinite(e))&&(console.error(`Invalid spaceSize value: ${e}. Using default value of ${re.spaceSize}`),e=re.spaceSize);const n=2;e<n&&(console.warn(`spaceSize (${e}) is too small. Using minimum value of ${n}`),e=n),e>=t?(this.adjustedSpaceSize=Math.max(t/2,n),console.warn(`The \`spaceSize\` has been reduced to ${this.adjustedSpaceSize} due to WebGL limits`)):this.adjustedSpaceSize=e}setWebGLMaxTextureSize(e){this.webglMaxTextureSize=e}updateScreenSize(e,t){const{adjustedSpaceSize:n}=this;this.screenSize=[e,t],this.scalePointX.domain([0,n]).range([(e-n)/2,(e+n)/2]),this.scalePointY.domain([n,0]).range([(t-n)/2,(t+n)/2])}scaleX(e){return this.scalePointX(e)}scaleY(e){return this.scalePointY(e)}setHoveredPointRingColor(e){const t=Lo(e);this.hoveredPointRingColor[0]=t[0],this.hoveredPointRingColor[1]=t[1],this.hoveredPointRingColor[2]=t[2]}setFocusedPointRingColor(e){const t=Lo(e);this.focusedPointRingColor[0]=t[0],this.focusedPointRingColor[1]=t[1],this.focusedPointRingColor[2]=t[2]}setGreyoutPointColor(e){if(e===void 0){this.greyoutPointColor=[-1,-1,-1,-1];return}const t=Lo(e);this.greyoutPointColor[0]=t[0],this.greyoutPointColor[1]=t[1],this.greyoutPointColor[2]=t[2],this.greyoutPointColor[3]=t[3]}updateLinkHoveringEnabled(e){this.isLinkHoveringEnabled=!!(e.onLinkClick||e.onLinkMouseOver||e.onLinkMouseOut),this.isLinkHoveringEnabled||(this.hoveredLinkIndex=void 0)}setHoveredLinkColor(e){if(e===void 0){this.hoveredLinkColor=[-1,-1,-1,-1];return}const t=Lo(e);this.hoveredLinkColor[0]=t[0],this.hoveredLinkColor[1]=t[1],this.hoveredLinkColor[2]=t[2],this.hoveredLinkColor[3]=t[3]}setFocusedPoint(e){e!==void 0?this.focusedPoint={index:e}:this.focusedPoint=void 0}addAlpha(e){return(this.alphaTarget-this.alpha)*this.alphaDecay(e)}}const PM={passive:!1},bc={capture:!0,passive:!1};function hp(i){i.stopImmediatePropagation()}function da(i){i.preventDefault(),i.stopImmediatePropagation()}function hS(i){var e=i.document.documentElement,t=Yt(i).on("dragstart.drag",da,bc);"onselectstart"in e?t.on("selectstart.drag",da,bc):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function dS(i,e){var t=i.document.documentElement,n=Yt(i).on("dragstart.drag",null);e&&(n.on("click.drag",da,bc),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in t?n.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}const Ru=i=>()=>i;function Um(i,{sourceEvent:e,subject:t,target:n,identifier:r,active:o,x:s,y:a,dx:l,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:i,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}Um.prototype.on=function(){var i=this._.on.apply(this._,arguments);return i===this._?this:i};function DM(i){return!i.ctrlKey&&!i.button}function MM(){return this.parentNode}function NM(i,e){return e??{x:i.x,y:i.y}}function BM(){return navigator.maxTouchPoints||"ontouchstart"in this}function OM(){var i=DM,e=MM,t=NM,n=BM,r={},o=nf("start","drag","end"),s=0,a,l,c,u,h=0;function d(y){y.on("mousedown.drag",f).filter(n).on("touchstart.drag",g).on("touchmove.drag",_,PM).on("touchend.drag touchcancel.drag",T).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(y,C){if(!(u||!i.call(this,y,C))){var I=E(this,e.call(this,y,C),y,C,"mouse");I&&(Yt(y.view).on("mousemove.drag",p,bc).on("mouseup.drag",b,bc),hS(y.view),hp(y),c=!1,a=y.clientX,l=y.clientY,I("start",y))}}function p(y){if(da(y),!c){var C=y.clientX-a,I=y.clientY-l;c=C*C+I*I>h}r.mouse("drag",y)}function b(y){Yt(y.view).on("mousemove.drag mouseup.drag",null),dS(y.view,c),da(y),r.mouse("end",y)}function g(y,C){if(i.call(this,y,C)){var I=y.changedTouches,F=e.call(this,y,C),V=I.length,q,Q;for(q=0;q<V;++q)(Q=E(this,F,y,C,I[q].identifier,I[q]))&&(hp(y),Q("start",y,I[q]))}}function _(y){var C=y.changedTouches,I=C.length,F,V;for(F=0;F<I;++F)(V=r[C[F].identifier])&&(da(y),V("drag",y,C[F]))}function T(y){var C=y.changedTouches,I=C.length,F,V;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),F=0;F<I;++F)(V=r[C[F].identifier])&&(hp(y),V("end",y,C[F]))}function E(y,C,I,F,V,q){var Q=o.copy(),M=Hr(q||I,C),ae,ee,R;if((R=t.call(y,new Um("beforestart",{sourceEvent:I,target:d,identifier:V,active:s,x:M[0],y:M[1],dx:0,dy:0,dispatch:Q}),F))!=null)return ae=R.x-M[0]||0,ee=R.y-M[1]||0,function X(O,W,ne){var Y=M,ie;switch(O){case"start":r[V]=X,ie=s++;break;case"end":delete r[V],--s;case"drag":M=Hr(ne||W,C),ie=s;break}Q.call(O,y,new Um(O,{sourceEvent:W,subject:R,target:d,identifier:V,active:ie,x:M[0]+ae,y:M[1]+ee,dx:M[0]-Y[0],dy:M[1]-Y[1],dispatch:Q}),F)}}return d.filter=function(y){return arguments.length?(i=typeof y=="function"?y:Ru(!!y),d):i},d.container=function(y){return arguments.length?(e=typeof y=="function"?y:Ru(y),d):e},d.subject=function(y){return arguments.length?(t=typeof y=="function"?y:Ru(y),d):t},d.touchable=function(y){return arguments.length?(n=typeof y=="function"?y:Ru(!!y),d):n},d.on=function(){var y=o.on.apply(o,arguments);return y===o?d:y},d.clickDistance=function(y){return arguments.length?(h=(y=+y)*y,d):Math.sqrt(h)},d}const Pu=i=>()=>i;function FM(i,{sourceEvent:e,target:t,transform:n,dispatch:r}){Object.defineProperties(this,{type:{value:i,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:t,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:r}})}function eo(i,e,t){this.k=i,this.x=e,this.y=t}eo.prototype={constructor:eo,scale:function(i){return i===1?this:new eo(this.k*i,this.x,this.y)},translate:function(i,e){return i===0&e===0?this:new eo(this.k,this.x+this.k*i,this.y+this.k*e)},apply:function(i){return[i[0]*this.k+this.x,i[1]*this.k+this.y]},applyX:function(i){return i*this.k+this.x},applyY:function(i){return i*this.k+this.y},invert:function(i){return[(i[0]-this.x)/this.k,(i[1]-this.y)/this.k]},invertX:function(i){return(i-this.x)/this.k},invertY:function(i){return(i-this.y)/this.k},rescaleX:function(i){return i.copy().domain(i.range().map(this.invertX,this).map(i.invert,i))},rescaleY:function(i){return i.copy().domain(i.range().map(this.invertY,this).map(i.invert,i))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var ac=new eo(1,0,0);eo.prototype;function dp(i){i.stopImmediatePropagation()}function vl(i){i.preventDefault(),i.stopImmediatePropagation()}function zM(i){return(!i.ctrlKey||i.type==="wheel")&&!i.button}function UM(){var i=this;return i instanceof SVGElement?(i=i.ownerSVGElement||i,i.hasAttribute("viewBox")?(i=i.viewBox.baseVal,[[i.x,i.y],[i.x+i.width,i.y+i.height]]):[[0,0],[i.width.baseVal.value,i.height.baseVal.value]]):[[0,0],[i.clientWidth,i.clientHeight]]}function Hv(){return this.__zoom||ac}function $M(i){return-i.deltaY*(i.deltaMode===1?.05:i.deltaMode?1:.002)*(i.ctrlKey?10:1)}function VM(){return navigator.maxTouchPoints||"ontouchstart"in this}function HM(i,e,t){var n=i.invertX(e[0][0])-t[0][0],r=i.invertX(e[1][0])-t[1][0],o=i.invertY(e[0][1])-t[0][1],s=i.invertY(e[1][1])-t[1][1];return i.translate(r>n?(n+r)/2:Math.min(0,n)||Math.max(0,r),s>o?(o+s)/2:Math.min(0,o)||Math.max(0,s))}function GM(){var i=zM,e=UM,t=HM,n=$M,r=VM,o=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],a=250,l=Ik,c=nf("start","zoom","end"),u,h,d,f=500,p=150,b=0,g=10;function _(R){R.property("__zoom",Hv).on("wheel.zoom",V,{passive:!1}).on("mousedown.zoom",q).on("dblclick.zoom",Q).filter(r).on("touchstart.zoom",M).on("touchmove.zoom",ae).on("touchend.zoom touchcancel.zoom",ee).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}_.transform=function(R,X,O,W){var ne=R.selection?R.selection():R;ne.property("__zoom",Hv),R!==ne?C(R,X,O,W):ne.interrupt().each(function(){I(this,arguments).event(W).start().zoom(null,typeof X=="function"?X.apply(this,arguments):X).end()})},_.scaleBy=function(R,X,O,W){_.scaleTo(R,function(){var ne=this.__zoom.k,Y=typeof X=="function"?X.apply(this,arguments):X;return ne*Y},O,W)},_.scaleTo=function(R,X,O,W){_.transform(R,function(){var ne=e.apply(this,arguments),Y=this.__zoom,ie=O==null?y(ne):typeof O=="function"?O.apply(this,arguments):O,j=Y.invert(ie),fe=typeof X=="function"?X.apply(this,arguments):X;return t(E(T(Y,fe),ie,j),ne,s)},O,W)},_.translateBy=function(R,X,O,W){_.transform(R,function(){return t(this.__zoom.translate(typeof X=="function"?X.apply(this,arguments):X,typeof O=="function"?O.apply(this,arguments):O),e.apply(this,arguments),s)},null,W)},_.translateTo=function(R,X,O,W,ne){_.transform(R,function(){var Y=e.apply(this,arguments),ie=this.__zoom,j=W==null?y(Y):typeof W=="function"?W.apply(this,arguments):W;return t(ac.translate(j[0],j[1]).scale(ie.k).translate(typeof X=="function"?-X.apply(this,arguments):-X,typeof O=="function"?-O.apply(this,arguments):-O),Y,s)},W,ne)};function T(R,X){return X=Math.max(o[0],Math.min(o[1],X)),X===R.k?R:new eo(X,R.x,R.y)}function E(R,X,O){var W=X[0]-O[0]*R.k,ne=X[1]-O[1]*R.k;return W===R.x&&ne===R.y?R:new eo(R.k,W,ne)}function y(R){return[(+R[0][0]+ +R[1][0])/2,(+R[0][1]+ +R[1][1])/2]}function C(R,X,O,W){R.on("start.zoom",function(){I(this,arguments).event(W).start()}).on("interrupt.zoom end.zoom",function(){I(this,arguments).event(W).end()}).tween("zoom",function(){var ne=this,Y=arguments,ie=I(ne,Y).event(W),j=e.apply(ne,Y),fe=O==null?y(j):typeof O=="function"?O.apply(ne,Y):O,de=Math.max(j[1][0]-j[0][0],j[1][1]-j[0][1]),Ze=ne.__zoom,oe=typeof X=="function"?X.apply(ne,Y):X,ft=l(Ze.invert(fe).concat(de/Ze.k),oe.invert(fe).concat(de/oe.k));return function($e){if($e===1)$e=oe;else{var gt=ft($e),te=de/gt[2];$e=new eo(te,fe[0]-gt[0]*te,fe[1]-gt[1]*te)}ie.zoom(null,$e)}})}function I(R,X,O){return!O&&R.__zooming||new F(R,X)}function F(R,X){this.that=R,this.args=X,this.active=0,this.sourceEvent=null,this.extent=e.apply(R,X),this.taps=0}F.prototype={event:function(R){return R&&(this.sourceEvent=R),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(R,X){return this.mouse&&R!=="mouse"&&(this.mouse[1]=X.invert(this.mouse[0])),this.touch0&&R!=="touch"&&(this.touch0[1]=X.invert(this.touch0[0])),this.touch1&&R!=="touch"&&(this.touch1[1]=X.invert(this.touch1[0])),this.that.__zoom=X,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(R){var X=Yt(this.that).datum();c.call(R,this.that,new FM(R,{sourceEvent:this.sourceEvent,target:_,transform:this.that.__zoom,dispatch:c}),X)}};function V(R,...X){if(!i.apply(this,arguments))return;var O=I(this,X).event(R),W=this.__zoom,ne=Math.max(o[0],Math.min(o[1],W.k*Math.pow(2,n.apply(this,arguments)))),Y=Hr(R);if(O.wheel)(O.mouse[0][0]!==Y[0]||O.mouse[0][1]!==Y[1])&&(O.mouse[1]=W.invert(O.mouse[0]=Y)),clearTimeout(O.wheel);else{if(W.k===ne)return;O.mouse=[Y,W.invert(Y)],ah(this),O.start()}vl(R),O.wheel=setTimeout(ie,p),O.zoom("mouse",t(E(T(W,ne),O.mouse[0],O.mouse[1]),O.extent,s));function ie(){O.wheel=null,O.end()}}function q(R,...X){if(d||!i.apply(this,arguments))return;var O=R.currentTarget,W=I(this,X,!0).event(R),ne=Yt(R.view).on("mousemove.zoom",fe,!0).on("mouseup.zoom",de,!0),Y=Hr(R,O),ie=R.clientX,j=R.clientY;hS(R.view),dp(R),W.mouse=[Y,this.__zoom.invert(Y)],ah(this),W.start();function fe(Ze){if(vl(Ze),!W.moved){var oe=Ze.clientX-ie,ft=Ze.clientY-j;W.moved=oe*oe+ft*ft>b}W.event(Ze).zoom("mouse",t(E(W.that.__zoom,W.mouse[0]=Hr(Ze,O),W.mouse[1]),W.extent,s))}function de(Ze){ne.on("mousemove.zoom mouseup.zoom",null),dS(Ze.view,W.moved),vl(Ze),W.event(Ze).end()}}function Q(R,...X){if(i.apply(this,arguments)){var O=this.__zoom,W=Hr(R.changedTouches?R.changedTouches[0]:R,this),ne=O.invert(W),Y=O.k*(R.shiftKey?.5:2),ie=t(E(T(O,Y),W,ne),e.apply(this,X),s);vl(R),a>0?Yt(this).transition().duration(a).call(C,ie,W,R):Yt(this).call(_.transform,ie,W,R)}}function M(R,...X){if(i.apply(this,arguments)){var O=R.touches,W=O.length,ne=I(this,X,R.changedTouches.length===W).event(R),Y,ie,j,fe;for(dp(R),ie=0;ie<W;++ie)j=O[ie],fe=Hr(j,this),fe=[fe,this.__zoom.invert(fe),j.identifier],ne.touch0?!ne.touch1&&ne.touch0[2]!==fe[2]&&(ne.touch1=fe,ne.taps=0):(ne.touch0=fe,Y=!0,ne.taps=1+!!u);u&&(u=clearTimeout(u)),Y&&(ne.taps<2&&(h=fe[0],u=setTimeout(function(){u=null},f)),ah(this),ne.start())}}function ae(R,...X){if(this.__zooming){var O=I(this,X).event(R),W=R.changedTouches,ne=W.length,Y,ie,j,fe;for(vl(R),Y=0;Y<ne;++Y)ie=W[Y],j=Hr(ie,this),O.touch0&&O.touch0[2]===ie.identifier?O.touch0[0]=j:O.touch1&&O.touch1[2]===ie.identifier&&(O.touch1[0]=j);if(ie=O.that.__zoom,O.touch1){var de=O.touch0[0],Ze=O.touch0[1],oe=O.touch1[0],ft=O.touch1[1],$e=($e=oe[0]-de[0])*$e+($e=oe[1]-de[1])*$e,gt=(gt=ft[0]-Ze[0])*gt+(gt=ft[1]-Ze[1])*gt;ie=T(ie,Math.sqrt($e/gt)),j=[(de[0]+oe[0])/2,(de[1]+oe[1])/2],fe=[(Ze[0]+ft[0])/2,(Ze[1]+ft[1])/2]}else if(O.touch0)j=O.touch0[0],fe=O.touch0[1];else return;O.zoom("touch",t(E(ie,j,fe),O.extent,s))}}function ee(R,...X){if(this.__zooming){var O=I(this,X).event(R),W=R.changedTouches,ne=W.length,Y,ie;for(dp(R),d&&clearTimeout(d),d=setTimeout(function(){d=null},f),Y=0;Y<ne;++Y)ie=W[Y],O.touch0&&O.touch0[2]===ie.identifier?delete O.touch0:O.touch1&&O.touch1[2]===ie.identifier&&delete O.touch1;if(O.touch1&&!O.touch0&&(O.touch0=O.touch1,delete O.touch1),O.touch0)O.touch0[1]=this.__zoom.invert(O.touch0[0]);else if(O.end(),O.taps===2&&(ie=Hr(ie,this),Math.hypot(h[0]-ie[0],h[1]-ie[1])<g)){var j=Yt(this).on("dblclick.zoom");j&&j.apply(this,arguments)}}}return _.wheelDelta=function(R){return arguments.length?(n=typeof R=="function"?R:Pu(+R),_):n},_.filter=function(R){return arguments.length?(i=typeof R=="function"?R:Pu(!!R),_):i},_.touchable=function(R){return arguments.length?(r=typeof R=="function"?R:Pu(!!R),_):r},_.extent=function(R){return arguments.length?(e=typeof R=="function"?R:Pu([[+R[0][0],+R[0][1]],[+R[1][0],+R[1][1]]]),_):e},_.scaleExtent=function(R){return arguments.length?(o[0]=+R[0],o[1]=+R[1],_):[o[0],o[1]]},_.translateExtent=function(R){return arguments.length?(s[0][0]=+R[0][0],s[1][0]=+R[1][0],s[0][1]=+R[0][1],s[1][1]=+R[1][1],_):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},_.constrain=function(R){return arguments.length?(t=R,_):t},_.duration=function(R){return arguments.length?(a=+R,_):a},_.interpolate=function(R){return arguments.length?(l=R,_):l},_.on=function(){var R=c.on.apply(c,arguments);return R===c?_:R},_.clickDistance=function(R){return arguments.length?(b=(R=+R)*R,_):Math.sqrt(b)},_.tapDistance=function(R){return arguments.length?(g=+R,_):g},_}class WM{constructor(e,t){this.eventTransform=ac,this.behavior=GM().scaleExtent([.001,1/0]).on("start",n=>{var r,o;this.isRunning=!0;const s=!!n.sourceEvent;(o=(r=this.config)==null?void 0:r.onZoomStart)==null||o.call(r,n,s)}).on("zoom",n=>{var r,o;this.eventTransform=n.transform;const{eventTransform:{x:s,y:a,k:l},store:{transform:c,screenSize:u}}=this,h=u[0],d=u[1];if(!h||!d)return;VD(c,h,d),Pv(c,c,[s,a]),cp(c,c,[l,l]),Pv(c,c,[h/2,d/2]),cp(c,c,[h/2,d/2]),cp(c,c,[1,-1]);const f=!!n.sourceEvent;(o=(r=this.config)==null?void 0:r.onZoom)==null||o.call(r,n,f)}).on("end",n=>{var r,o;this.isRunning=!1;const s=!!n.sourceEvent;(o=(r=this.config)==null?void 0:r.onZoomEnd)==null||o.call(r,n,s)}),this.isRunning=!1,this.store=e,this.config=t}getTransform(e,t,n=.1){if(e.length===0)return this.eventTransform;const{store:{screenSize:r}}=this,o=r[0],s=r[1],a=Sv(e.map(g=>g[0])),l=Sv(e.map(g=>g[1]));a[0]=this.store.scaleX(a[0]),a[1]=this.store.scaleX(a[1]),l[0]=this.store.scaleY(l[0]),l[1]=this.store.scaleY(l[1]),a[0]===a[1]&&(a[0]-=.5,a[1]+=.5),l[0]===l[1]&&(l[0]+=.5,l[1]-=.5);const c=o*(1-n*2)/(a[1]-a[0]),u=s*(1-n*2)/(l[0]-l[1]),h=YR(t??Math.min(c,u),...this.behavior.scaleExtent()),d=(a[1]+a[0])/2,f=(l[1]+l[0])/2,p=o/2-d*h,b=s/2-f*h;return ac.translate(p,b).scale(h)}getDistanceToPoint(e){const{x:t,y:n,k:r}=this.eventTransform,o=this.getTransform([e],r),s=t-o.x,a=n-o.y;return Math.sqrt(s*s+a*a)}getMiddlePointTransform(e){const{store:{screenSize:t},eventTransform:{x:n,y:r,k:o}}=this,s=t[0],a=t[1],l=(s/2-n)/o,c=(a/2-r)/o,u=this.store.scaleX(e[0]),h=this.store.scaleY(e[1]),d=(l+u)/2,f=(c+h)/2,p=1,b=s/2-d*p,g=a/2-f*p;return ac.translate(b,g).scale(p)}convertScreenToSpacePosition(e){const{eventTransform:{x:t,y:n,k:r},store:{screenSize:o}}=this,s=o[0],a=o[1],l=(e[0]-t)/r,c=(e[1]-n)/r,u=[l,a-c];return u[0]-=(s-this.store.adjustedSpaceSize)/2,u[1]-=(a-this.store.adjustedSpaceSize)/2,u}convertSpaceToScreenPosition(e){const t=this.eventTransform.applyX(this.store.scaleX(e[0])),n=this.eventTransform.applyY(this.store.scaleY(e[1]));return[t,n]}convertSpaceToScreenRadius(e){const{config:{scalePointsOnZoom:t},store:{maxPointSize:n},eventTransform:{k:r}}=this;let o=e*2;return t?o*=r:o*=Math.min(5,Math.max(1,r*.01)),Math.min(o,n)/2}}class jM{constructor(e,t){this.isActive=!1,this.behavior=OM().subject(n=>this.store.hoveredPoint&&!this.store.isSpaceKeyPressed?{x:n.x,y:n.y}:void 0).on("start",n=>{var r,o;this.store.hoveredPoint&&(this.store.draggingPointIndex=this.store.hoveredPoint.index,this.isActive=!0,(o=(r=this.config)==null?void 0:r.onDragStart)==null||o.call(r,n))}).on("drag",n=>{var r,o;(o=(r=this.config)==null?void 0:r.onDrag)==null||o.call(r,n)}).on("end",n=>{var r,o;this.isActive=!1,this.store.draggingPointIndex=void 0,(o=(r=this.config)==null?void 0:r.onDragEnd)==null||o.call(r,n)}),this.store=e,this.config=t}}class YM{constructor(e,t,n){if(this.config=new XR,this.graph=new GP(this.config),this.requestAnimationFrameId=0,this.isRightClickMouse=!1,this.store=new RM,this.zoomInstance=new WM(this.store,this.config),this.dragInstance=new jM(this.store,this.config),this._findHoveredItemExecutionCount=0,this._isMouseOnCanvas=!1,this._isFirstRenderAfterInit=!0,this.isPointPositionsUpdateNeeded=!1,this.isPointColorUpdateNeeded=!1,this.isPointSizeUpdateNeeded=!1,this.isPointShapeUpdateNeeded=!1,this.isPointImageIndicesUpdateNeeded=!1,this.isLinksUpdateNeeded=!1,this.isLinkColorUpdateNeeded=!1,this.isLinkWidthUpdateNeeded=!1,this.isLinkArrowUpdateNeeded=!1,this.isPointClusterUpdateNeeded=!1,this.isForceManyBodyUpdateNeeded=!1,this.isForceLinkUpdateNeeded=!1,this.isForceCenterUpdateNeeded=!1,this.isPointImageSizesUpdateNeeded=!1,this._isDestroyed=!1,t&&this.config.init(t),n)this.deviceInitPromise=n;else{const r=document.createElement("canvas");this.deviceInitPromise=this.createDevice(r)}this.deviceInitPromise.then(r=>{if(this._isDestroyed)return r.destroy(),r;this.device=r;const o=this.validateDevice(r);n&&o.setProps({useDevicePixels:this.config.pixelRatio}),this.store.div=e;const s=o.canvas;s.parentNode!==this.store.div&&(s.parentNode&&s.parentNode.removeChild(s),this.store.div.appendChild(s)),this.addAttribution(),s.style.width="100%",s.style.height="100%",this.canvas=s;const a=this.canvas.clientWidth,l=this.canvas.clientHeight;this.store.adjustSpaceSize(this.config.spaceSize,this.device.limits.maxTextureDimension2D),this.store.setWebGLMaxTextureSize(this.device.limits.maxTextureDimension2D),this.store.updateScreenSize(a,l),this.canvasD3Selection=Yt(this.canvas),this.canvasD3Selection.on("mouseenter.cosmos",()=>{this._isMouseOnCanvas=!0}).on("mousemove.cosmos",()=>{this._isMouseOnCanvas=!0}).on("mouseleave.cosmos",u=>{this._isMouseOnCanvas=!1,this.currentEvent=u,this.store.hoveredPoint!==void 0&&this.config.onPointMouseOut&&this.config.onPointMouseOut(u),this.store.hoveredLinkIndex!==void 0&&this.config.onLinkMouseOut&&this.config.onLinkMouseOut(u),this.isRightClickMouse=!1,this.store.hoveredPoint=void 0,this.store.hoveredLinkIndex=void 0,this.updateCanvasCursor()}),Yt(document).on("keydown.cosmos",u=>{u.code==="Space"&&(this.store.isSpaceKeyPressed=!0)}).on("keyup.cosmos",u=>{u.code==="Space"&&(this.store.isSpaceKeyPressed=!1)}),this.zoomInstance.behavior.on("start.detect",u=>{this.currentEvent=u}).on("zoom.detect",u=>{u.sourceEvent&&this.updateMousePosition(u.sourceEvent),this.currentEvent=u}).on("end.detect",u=>{this.currentEvent=u}),this.dragInstance.behavior.on("start.detect",u=>{this.currentEvent=u,this.updateCanvasCursor()}).on("drag.detect",u=>{this.dragInstance.isActive&&this.updateMousePosition(u),this.currentEvent=u}).on("end.detect",u=>{this.currentEvent=u,this.updateCanvasCursor()}),this.canvasD3Selection.call(this.dragInstance.behavior).call(this.zoomInstance.behavior).on("click",this.onClick.bind(this)).on("mousemove",this.onMouseMove.bind(this)).on("contextmenu",this.onRightClickMouse.bind(this)),(!this.config.enableZoom||!this.config.enableDrag)&&this.updateZoomDragBehaviors(),this.setZoomLevel(this.config.initialZoomLevel??1);const c=r.gl.getParameter(ko.ALIASED_POINT_SIZE_RANGE);return this.store.maxPointSize=((c==null?void 0:c[1])??zm)/this.config.pixelRatio,this.store.isSimulationRunning=this.config.enableSimulation,this.points=new UD(r,this.config,this.store,this.graph),this.lines=new CD(r,this.config,this.store,this.graph,this.points),this.config.enableSimulation&&(this.forceGravity=new CP(r,this.config,this.store,this.graph,this.points),this.forceCenter=new SP(r,this.config,this.store,this.graph,this.points),this.forceManyBody=new RP(r,this.config,this.store,this.graph,this.points),this.forceLinkIncoming=new vv(r,this.config,this.store,this.graph,this.points),this.forceLinkOutgoing=new vv(r,this.config,this.store,this.graph,this.points),this.forceMouse=new DP(r,this.config,this.store,this.graph,this.points)),this.clusters=new OP(r,this.config,this.store,this.graph,this.points),this.store.backgroundColor=Lo(this.config.backgroundColor),this.store.setHoveredPointRingColor(this.config.hoveredPointRingColor??re.hoveredPointRingColor),this.store.setFocusedPointRingColor(this.config.focusedPointRingColor??re.focusedPointRingColor),this.config.focusedPointIndex!==void 0&&this.store.setFocusedPoint(this.config.focusedPointIndex),this.store.setGreyoutPointColor(this.config.pointGreyoutColor??pm),this.store.setHoveredLinkColor(this.config.hoveredLinkColor??re.hoveredLinkColor),this.store.updateLinkHoveringEnabled(this.config),this.config.showFPSMonitor&&(this.fpsMonitor=new wv(this.canvas)),this.config.randomSeed!==void 0&&this.store.addRandomSeed(this.config.randomSeed),r}).catch(r=>{throw console.error("Device initialization failed:",r),r})}get progress(){return this._isDestroyed?0:this.store.simulationProgress}get isSimulationRunning(){return this._isDestroyed?!1:this.store.isSimulationRunning}get maxPointSize(){return this._isDestroyed?0:this.store.maxPointSize}setConfig(e){var t,n,r,o,s,a,l,c,u;if(this._isDestroyed||this.ensureDevice(()=>this.setConfig(e)))return;const h={...this.config};if(this.config.init(e),(h.pointDefaultColor!==this.config.pointDefaultColor||h.pointColor!==this.config.pointColor)&&(this.graph.updatePointColor(),(t=this.points)==null||t.updateColor()),(h.pointDefaultSize!==this.config.pointDefaultSize||h.pointSize!==this.config.pointSize)&&(this.graph.updatePointSize(),(n=this.points)==null||n.updateSize()),(h.linkDefaultColor!==this.config.linkDefaultColor||h.linkColor!==this.config.linkColor)&&(this.graph.updateLinkColor(),(r=this.lines)==null||r.updateColor()),(h.linkDefaultWidth!==this.config.linkDefaultWidth||h.linkWidth!==this.config.linkWidth)&&(this.graph.updateLinkWidth(),(o=this.lines)==null||o.updateWidth()),(h.linkDefaultArrows!==this.config.linkDefaultArrows||h.linkArrows!==this.config.linkArrows)&&(this.graph.updateArrows(),(s=this.lines)==null||s.updateArrow()),(h.curvedLinkSegments!==this.config.curvedLinkSegments||h.curvedLinks!==this.config.curvedLinks)&&((a=this.lines)==null||a.updateCurveLineGeometry()),h.backgroundColor!==this.config.backgroundColor&&(this.store.backgroundColor=Lo(this.config.backgroundColor??sw)),h.hoveredPointRingColor!==this.config.hoveredPointRingColor&&this.store.setHoveredPointRingColor(this.config.hoveredPointRingColor??re.hoveredPointRingColor),h.focusedPointRingColor!==this.config.focusedPointRingColor&&this.store.setFocusedPointRingColor(this.config.focusedPointRingColor??re.focusedPointRingColor),h.pointGreyoutColor!==this.config.pointGreyoutColor&&this.store.setGreyoutPointColor(this.config.pointGreyoutColor??pm),h.hoveredLinkColor!==this.config.hoveredLinkColor&&this.store.setHoveredLinkColor(this.config.hoveredLinkColor??re.hoveredLinkColor),h.focusedPointIndex!==this.config.focusedPointIndex&&this.store.setFocusedPoint(this.config.focusedPointIndex),h.pixelRatio!==this.config.pixelRatio&&(l=this.device)!=null&&l.canvasContext){this.device.canvasContext.setProps({useDevicePixels:this.config.pixelRatio});const d=this.device.gl.getParameter(ko.ALIASED_POINT_SIZE_RANGE);this.store.maxPointSize=((d==null?void 0:d[1])??zm)/this.config.pixelRatio}h.spaceSize!==this.config.spaceSize&&(this.store.adjustSpaceSize(this.config.spaceSize,((c=this.device)==null?void 0:c.limits.maxTextureDimension2D)??4096),this.resizeCanvas(!0),this.update(this.store.isSimulationRunning?this.store.alpha:0)),h.showFPSMonitor!==this.config.showFPSMonitor&&(this.config.showFPSMonitor?this.fpsMonitor=new wv(this.canvas):((u=this.fpsMonitor)==null||u.destroy(),this.fpsMonitor=void 0)),(h.enableZoom!==this.config.enableZoom||h.enableDrag!==this.config.enableDrag)&&this.updateZoomDragBehaviors(),(h.onLinkClick!==this.config.onLinkClick||h.onLinkMouseOver!==this.config.onLinkMouseOver||h.onLinkMouseOut!==this.config.onLinkMouseOut)&&this.store.updateLinkHoveringEnabled(this.config)}setPointPositions(e,t){this._isDestroyed||this.ensureDevice(()=>this.setPointPositions(e,t))||(this.graph.inputPointPositions=e,this.points.shouldSkipRescale=t,this.isPointPositionsUpdateNeeded=!0,this.isLinksUpdateNeeded=!0,this.isPointColorUpdateNeeded=!0,this.isPointSizeUpdateNeeded=!0,this.isPointShapeUpdateNeeded=!0,this.isPointImageIndicesUpdateNeeded=!0,this.isPointImageSizesUpdateNeeded=!0,this.isPointClusterUpdateNeeded=!0,this.isForceManyBodyUpdateNeeded=!0,this.isForceLinkUpdateNeeded=!0,this.isForceCenterUpdateNeeded=!0)}setPointColors(e){this._isDestroyed||this.ensureDevice(()=>this.setPointColors(e))||(this.graph.inputPointColors=e,this.isPointColorUpdateNeeded=!0)}getPointColors(){return this._isDestroyed?new Float32Array:this.graph.pointColors??new Float32Array}setPointSizes(e){this._isDestroyed||this.ensureDevice(()=>this.setPointSizes(e))||(this.graph.inputPointSizes=e,this.isPointSizeUpdateNeeded=!0)}setPointShapes(e){this._isDestroyed||this.ensureDevice(()=>this.setPointShapes(e))||(this.graph.inputPointShapes=e,this.isPointShapeUpdateNeeded=!0)}setImageData(e){var t;this._isDestroyed||this.ensureDevice(()=>this.setImageData(e))||(this.graph.inputImageData=e,(t=this.points)==null||t.createAtlas())}setPointImageIndices(e){this._isDestroyed||this.ensureDevice(()=>this.setPointImageIndices(e))||(this.graph.inputPointImageIndices=e,this.isPointImageIndicesUpdateNeeded=!0)}setPointImageSizes(e){this._isDestroyed||this.ensureDevice(()=>this.setPointImageSizes(e))||(this.graph.inputPointImageSizes=e,this.isPointImageSizesUpdateNeeded=!0)}getPointSizes(){return this._isDestroyed?new Float32Array:this.graph.pointSizes??new Float32Array}setLinks(e){this._isDestroyed||this.ensureDevice(()=>this.setLinks(e))||(this.graph.inputLinks=e,this.isLinksUpdateNeeded=!0,this.isLinkColorUpdateNeeded=!0,this.isLinkWidthUpdateNeeded=!0,this.isLinkArrowUpdateNeeded=!0,this.isForceLinkUpdateNeeded=!0)}setLinkColors(e){this._isDestroyed||this.ensureDevice(()=>this.setLinkColors(e))||(this.graph.inputLinkColors=e,this.isLinkColorUpdateNeeded=!0)}getLinkColors(){return this._isDestroyed?new Float32Array:this.graph.linkColors??new Float32Array}setLinkWidths(e){this._isDestroyed||this.ensureDevice(()=>this.setLinkWidths(e))||(this.graph.inputLinkWidths=e,this.isLinkWidthUpdateNeeded=!0)}getLinkWidths(){return this._isDestroyed?new Float32Array:this.graph.linkWidths??new Float32Array}setLinkArrows(e){this._isDestroyed||this.ensureDevice(()=>this.setLinkArrows(e))||(this.graph.linkArrowsBoolean=e,this.isLinkArrowUpdateNeeded=!0)}setLinkStrength(e){this._isDestroyed||this.ensureDevice(()=>this.setLinkStrength(e))||(this.graph.inputLinkStrength=e,this.isForceLinkUpdateNeeded=!0)}setPointClusters(e){this._isDestroyed||this.ensureDevice(()=>this.setPointClusters(e))||(this.graph.inputPointClusters=e,this.isPointClusterUpdateNeeded=!0)}setClusterPositions(e){this._isDestroyed||this.ensureDevice(()=>this.setClusterPositions(e))||(this.graph.inputClusterPositions=e,this.isPointClusterUpdateNeeded=!0)}setPointClusterStrength(e){this._isDestroyed||this.ensureDevice(()=>this.setPointClusterStrength(e))||(this.graph.inputClusterStrength=e,this.isPointClusterUpdateNeeded=!0)}setPinnedPoints(e){var t;this._isDestroyed||this.ensureDevice(()=>this.setPinnedPoints(e))||(this.graph.inputPinnedPoints=e&&e.length>0?e:void 0,(t=this.points)==null||t.updatePinnedStatus())}render(e){if(this._isDestroyed||this.ensureDevice(()=>this.render(e)))return;this.graph.update();const{fitViewOnInit:t,fitViewDelay:n,fitViewPadding:r,fitViewDuration:o,fitViewByPointsInRect:s,fitViewByPointIndices:a,initialZoomLevel:l}=this.config;if(!this.graph.pointsNumber&&!this.graph.linksNumber){this.stopFrames(),Yt(this.canvas).style("cursor",null),this.device&&this.device.beginRenderPass({clearColor:this.store.backgroundColor,clearDepth:1,clearStencil:0}).end();return}this._isFirstRenderAfterInit&&t&&l===void 0&&(this._fitViewOnInitTimeoutID=window.setTimeout(()=>{a?this.fitViewByPointIndices(a,o,r):s?this.setZoomTransformByPointPositions(s,o,void 0,r):this.fitView(o,r)},n)),this.update(e),this.startFrames(),this._isFirstRenderAfterInit=!1}zoomToPointByIndex(e,t=700,n=vR,r=!0){if(this._isDestroyed||this.ensureDevice(()=>this.zoomToPointByIndex(e,t,n,r))||!this.device||!this.points||!this.canvasD3Selection)return;const{store:{screenSize:o}}=this,s=tn(this.device,this.points.currentPositionFbo);if(e===void 0)return;const a=s[e*4+0],l=s[e*4+1];if(a===void 0||l===void 0)return;const c=this.zoomInstance.getDistanceToPoint([a,l]),u=r?n:Math.max(this.getZoomLevel(),n);if(c<Math.min(o[0],o[1]))this.setZoomTransformByPointPositions([a,l],t,u);else{const h=this.zoomInstance.getTransform([[a,l]],u),d=this.zoomInstance.getMiddlePointTransform([a,l]);this.canvasD3Selection.transition().ease(IL).duration(t/2).call(this.zoomInstance.behavior.transform,d).transition().ease(kL).duration(t/2).call(this.zoomInstance.behavior.transform,h)}}zoom(e,t=0){this._isDestroyed||this.setZoomLevel(e,t)}setZoomLevel(e,t=0){this._isDestroyed||this.ensureDevice(()=>this.setZoomLevel(e,t))||this.canvasD3Selection&&(t===0?this.canvasD3Selection.call(this.zoomInstance.behavior.scaleTo,e):this.canvasD3Selection.transition().duration(t).call(this.zoomInstance.behavior.scaleTo,e))}getZoomLevel(){return this._isDestroyed?0:this.zoomInstance.eventTransform.k}getPointPositions(){if(this._isDestroyed||!this.device||!this.points)return[];if(this.graph.pointsNumber===void 0)return[];const e=[],t=tn(this.device,this.points.currentPositionFbo);e.length=this.graph.pointsNumber*2;for(let n=0;n<this.graph.pointsNumber;n+=1){const r=t[n*4+0],o=t[n*4+1];r!==void 0&&o!==void 0&&(e[n*2]=r,e[n*2+1]=o)}return e}getClusterPositions(){if(this._isDestroyed||!this.device||!this.clusters)return[];if(this.graph.pointClusters===void 0||this.clusters.clusterCount===void 0)return[];this.clusters.calculateCentermass();const e=[],t=tn(this.device,this.clusters.centermassFbo);e.length=this.clusters.clusterCount*2;for(let n=0;n<e.length/2;n+=1){const r=t[n*4+0],o=t[n*4+1],s=t[n*4+2];r!==void 0&&o!==void 0&&s!==void 0&&(e[n*2]=r/s,e[n*2+1]=o/s)}return e}fitView(e=250,t=.1){this._isDestroyed||this.ensureDevice(()=>this.fitView(e,t))||this.setZoomTransformByPointPositions(this.getPointPositions(),e,void 0,t)}fitViewByPointIndices(e,t=250,n=.1){if(this._isDestroyed||this.ensureDevice(()=>this.fitViewByPointIndices(e,t,n)))return;const r=this.getPointPositions(),o=new Array(e.length*2);for(const[s,a]of e.entries())o[s*2]=r[a*2],o[s*2+1]=r[a*2+1];this.setZoomTransformByPointPositions(o,t,void 0,n)}fitViewByPointPositions(e,t=250,n=.1){this._isDestroyed||this.ensureDevice(()=>this.fitViewByPointPositions(e,t,n))||this.setZoomTransformByPointPositions(e,t,void 0,n)}getPointsInRect(e){if(this._isDestroyed||!this.device||!this.points)return new Float32Array;const t=this.store.screenSize[1];return this.store.selectedArea=[[e[0][0],t-e[1][1]],[e[1][0],t-e[0][1]]],this.points.findPointsOnAreaSelection(),tn(this.device,this.points.selectedFbo).map((n,r)=>r%4===0&&n!==0?r/4:-1).filter(n=>n!==-1)}getPointsInRange(e){return this.getPointsInRect(e)}getPointsInPolygon(e){if(this._isDestroyed||!this.device||!this.points)return new Float32Array;if(e.length<3)return new Float32Array;const t=this.store.screenSize[1],n=e.map(([r,o])=>[r,t-o]);return this.points.updatePolygonPath(n),this.points.findPointsOnPolygonSelection(),tn(this.device,this.points.selectedFbo).map((r,o)=>o%4===0&&r!==0?o/4:-1).filter(r=>r!==-1)}selectPointsInRect(e){if(!this._isDestroyed&&!this.ensureDevice(()=>this.selectPointsInRect(e))&&!(!this.device||!this.points)){if(e){const t=this.store.screenSize[1];this.store.selectedArea=[[e[0][0],t-e[1][1]],[e[1][0],t-e[0][1]]],this.points.findPointsOnAreaSelection();const n=tn(this.device,this.points.selectedFbo);this.store.selectedIndices=n.map((r,o)=>o%4===0&&r!==0?o/4:-1).filter(r=>r!==-1)}else this.store.selectedIndices=null;this.points.updateGreyoutStatus()}}selectPointsInRange(e){return this.selectPointsInRect(e)}selectPointsInPolygon(e){if(!this._isDestroyed&&!this.ensureDevice(()=>this.selectPointsInPolygon(e))&&!(!this.device||!this.points)){if(e){if(e.length<3){console.warn("Polygon path requires at least 3 points to form a polygon.");return}const t=this.store.screenSize[1],n=e.map(([o,s])=>[o,t-s]);this.points.updatePolygonPath(n),this.points.findPointsOnPolygonSelection();const r=tn(this.device,this.points.selectedFbo);this.store.selectedIndices=r.map((o,s)=>s%4===0&&o!==0?s/4:-1).filter(o=>o!==-1)}else this.store.selectedIndices=null;this.points.updateGreyoutStatus()}}selectPointByIndex(e,t=!1){if(!this._isDestroyed&&!this.ensureDevice(()=>this.selectPointByIndex(e,t)))if(t){const n=this.graph.getAdjacentIndices(e)??[];this.selectPointsByIndices([e,...n])}else this.selectPointsByIndices([e])}selectPointsByIndices(e){this._isDestroyed||this.ensureDevice(()=>this.selectPointsByIndices(e))||this.points&&(e?e.length===0?this.store.selectedIndices=new Float32Array:this.store.selectedIndices=new Float32Array(e.filter(t=>t!==void 0)):this.store.selectedIndices=null,this.points.updateGreyoutStatus())}unselectPoints(){this._isDestroyed||this.ensureDevice(()=>this.unselectPoints())||this.points&&(this.store.selectedIndices=null,this.points.updateGreyoutStatus())}getSelectedIndices(){if(this._isDestroyed)return null;const{selectedIndices:e}=this.store;return e?Array.from(e):null}getAdjacentIndices(e){if(!this._isDestroyed)return this.graph.getAdjacentIndices(e)}spaceToScreenPosition(e){return this._isDestroyed?[0,0]:this.zoomInstance.convertSpaceToScreenPosition(e)}screenToSpacePosition(e){return this._isDestroyed?[0,0]:this.zoomInstance.convertScreenToSpacePosition(e)}spaceToScreenRadius(e){return this._isDestroyed?0:this.zoomInstance.convertSpaceToScreenRadius(e)}getPointRadiusByIndex(e){var t;if(!this._isDestroyed)return(t=this.graph.pointSizes)==null?void 0:t[e]}trackPointPositionsByIndices(e){this._isDestroyed||this.ensureDevice(()=>this.trackPointPositionsByIndices(e))||this.points&&this.points.trackPointsByIndices(e)}getTrackedPointPositionsMap(){return this._isDestroyed||!this.points?new Map:this.points.getTrackedPositionsMap()}getTrackedPointPositionsArray(){return this._isDestroyed||!this.points?[]:this.points.getTrackedPositionsArray()}getSampledPointPositionsMap(){return this._isDestroyed||!this.points?new Map:this.points.getSampledPointPositionsMap()}getSampledPoints(){return this._isDestroyed||!this.points?{indices:[],positions:[]}:this.points.getSampledPoints()}getScaleX(){if(!(this._isDestroyed||!this.points))return this.points.scaleX}getScaleY(){if(!(this._isDestroyed||!this.points))return this.points.scaleY}start(e=1){var t,n;this._isDestroyed||this.ensureDevice(()=>this.start(e))||this.graph.pointsNumber&&(this.store.isSimulationRunning=!0,this.store.simulationProgress=0,this.store.alpha=e,(n=(t=this.config).onSimulationStart)==null||n.call(t))}stop(){var e,t;this._isDestroyed||(this.store.isSimulationRunning=!1,this.store.simulationProgress=0,this.store.alpha=0,(t=(e=this.config).onSimulationEnd)==null||t.call(e))}pause(){var e,t;this._isDestroyed||this.ensureDevice(()=>this.pause())||(this.store.isSimulationRunning=!1,(t=(e=this.config).onSimulationPause)==null||t.call(e))}unpause(){var e,t;this._isDestroyed||this.ensureDevice(()=>this.unpause())||(this.store.isSimulationRunning=!0,(t=(e=this.config).onSimulationUnpause)==null||t.call(e))}restart(){var e,t;this._isDestroyed||this.ensureDevice(()=>this.restart())||(this.store.isSimulationRunning=!0,(t=(e=this.config).onSimulationRestart)==null||t.call(e))}step(){this._isDestroyed||this.ensureDevice(()=>this.step())||this.config.enableSimulation&&this.store.pointsTextureSize&&this.runSimulationStep(!0)}destroy(){var e,t,n,r,o,s,a,l,c,u,h,d,f;this._isDestroyed||(this._isDestroyed=!0,window.clearTimeout(this._fitViewOnInitTimeoutID),this.stopFrames(),this.canvasD3Selection&&this.canvasD3Selection.on("mouseenter.cosmos",null).on("mousemove.cosmos",null).on("mouseleave.cosmos",null).on("click",null).on("mousemove",null).on("contextmenu",null).on(".drag",null).on(".zoom",null),Yt(document).on("keydown.cosmos",null).on("keyup.cosmos",null),(e=this.zoomInstance)!=null&&e.behavior&&this.zoomInstance.behavior.on("start.detect",null).on("zoom.detect",null).on("end.detect",null),(t=this.dragInstance)!=null&&t.behavior&&this.dragInstance.behavior.on("start.detect",null).on("drag.detect",null).on("end.detect",null),(n=this.fpsMonitor)==null||n.destroy(),(r=this.points)==null||r.destroy(),(o=this.lines)==null||o.destroy(),(s=this.clusters)==null||s.destroy(),(a=this.forceGravity)==null||a.destroy(),(l=this.forceCenter)==null||l.destroy(),(c=this.forceManyBody)==null||c.destroy(),(u=this.forceLinkIncoming)==null||u.destroy(),(h=this.forceLinkOutgoing)==null||h.destroy(),(d=this.forceMouse)==null||d.destroy(),this.device&&(this.device.beginRenderPass({clearColor:this.store.backgroundColor,clearDepth:1,clearStencil:0}).end(),this.device.destroy()),this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.attributionDivElement&&this.attributionDivElement.parentNode&&this.attributionDivElement.parentNode.removeChild(this.attributionDivElement),(f=document.getElementById("gl-bench-style"))==null||f.remove(),this.canvasD3Selection=void 0,this.attributionDivElement=void 0)}create(){var e,t,n,r,o;this._isDestroyed||this.ensureDevice(()=>this.create())||this.points&&this.lines&&(this.isPointPositionsUpdateNeeded&&this.points.updatePositions(),this.isPointColorUpdateNeeded&&this.points.updateColor(),this.isPointSizeUpdateNeeded&&this.points.updateSize(),this.isPointShapeUpdateNeeded&&this.points.updateShape(),this.isPointImageIndicesUpdateNeeded&&this.points.updateImageIndices(),this.isPointImageSizesUpdateNeeded&&this.points.updateImageSizes(),this.isLinksUpdateNeeded&&this.lines.updatePointsBuffer(),this.isLinkColorUpdateNeeded&&this.lines.updateColor(),this.isLinkWidthUpdateNeeded&&this.lines.updateWidth(),this.isLinkArrowUpdateNeeded&&this.lines.updateArrow(),this.isForceManyBodyUpdateNeeded&&((e=this.forceManyBody)==null||e.create()),this.isForceLinkUpdateNeeded&&((t=this.forceLinkIncoming)==null||t.create(Sm.INCOMING),(n=this.forceLinkOutgoing)==null||n.create(Sm.OUTGOING)),this.isForceCenterUpdateNeeded&&((r=this.forceCenter)==null||r.create()),this.isPointClusterUpdateNeeded&&((o=this.clusters)==null||o.create()),this.isPointPositionsUpdateNeeded=!1,this.isPointColorUpdateNeeded=!1,this.isPointSizeUpdateNeeded=!1,this.isPointShapeUpdateNeeded=!1,this.isPointImageIndicesUpdateNeeded=!1,this.isPointImageSizesUpdateNeeded=!1,this.isLinksUpdateNeeded=!1,this.isLinkColorUpdateNeeded=!1,this.isLinkWidthUpdateNeeded=!1,this.isLinkArrowUpdateNeeded=!1,this.isPointClusterUpdateNeeded=!1,this.isForceManyBodyUpdateNeeded=!1,this.isForceLinkUpdateNeeded=!1,this.isForceCenterUpdateNeeded=!1)}flatten(e){return e.flat()}pair(e){const t=new Array(e.length/2);for(let n=0;n<e.length/2;n++)t[n]=[e[n*2],e[n*2+1]];return t}ensureDevice(e){return this.device?!1:(this.deviceInitPromise.then(()=>{this._isDestroyed||e()}).catch(t=>{console.error("Device initialization failed",t)}),!0)}validateDevice(e){const t=e.canvasContext;if(t===null||t.type==="offscreen-canvas")throw new Error("Device must have an HTMLCanvasElement canvas context. OffscreenCanvas and compute-only devices are not supported.");return t}async createDevice(e){return await g4.createDevice({type:"webgl",adapters:[cR],createCanvasContext:{canvas:e,useDevicePixels:this.config.pixelRatio,autoResize:!0,width:void 0,height:void 0}})}update(e=this.store.alpha){const{graph:t}=this;this.store.pointsTextureSize=Math.ceil(Math.sqrt(t.pointsNumber??0)),this.store.linksTextureSize=Math.ceil(Math.sqrt((t.linksNumber??0)*2)),this.create(),this.initPrograms(),this.store.hoveredPoint=void 0,this.store.alpha=e}runSimulationStep(e=!1){var t,n,r,o,s,a,l,c,u,h,d,f,p,b,g,_,T,E,y;const{config:{simulationGravity:C,simulationCenter:I,enableSimulation:F},store:{isSimulationRunning:V}}=this;F&&(this.isRightClickMouse&&this.config.enableRightClickRepulsion&&((t=this.forceMouse)==null||t.run(),(n=this.points)==null||n.updatePosition()),(e||V&&!(this.zoomInstance.isRunning&&!this.config.enableSimulationDuringZoom))&&(C&&((r=this.forceGravity)==null||r.run(),(o=this.points)==null||o.updatePosition()),I&&((s=this.forceCenter)==null||s.run(),(a=this.points)==null||a.updatePosition()),(l=this.forceManyBody)==null||l.run(),(c=this.points)==null||c.updatePosition(),this.store.linksTextureSize&&((u=this.forceLinkIncoming)==null||u.run(),(h=this.points)==null||h.updatePosition(),(d=this.forceLinkOutgoing)==null||d.run(),(f=this.points)==null||f.updatePosition()),(this.graph.pointClusters||this.graph.clusterPositions)&&((p=this.clusters)==null||p.run(),(b=this.points)==null||b.updatePosition()),this.store.alpha+=this.store.addAlpha(this.config.simulationDecay??re.simulation.decay),this.isRightClickMouse&&this.config.enableRightClickRepulsion&&(this.store.alpha=Math.max(this.store.alpha,.1)),this.store.simulationProgress=Math.sqrt(Math.min(1,Fm/this.store.alpha)),(E=(T=this.config).onSimulationTick)==null||E.call(T,this.store.alpha,(g=this.store.hoveredPoint)==null?void 0:g.index,(_=this.store.hoveredPoint)==null?void 0:_.position)),(y=this.points)==null||y.trackPoints())}initPrograms(){var e,t,n,r,o,s;this._isDestroyed||!this.points||!this.lines||!this.clusters||(this.points.initPrograms(),this.lines.initPrograms(),(e=this.forceGravity)==null||e.initPrograms(),(t=this.forceManyBody)==null||t.initPrograms(),(n=this.forceCenter)==null||n.initPrograms(),(r=this.forceLinkIncoming)==null||r.initPrograms(),(o=this.forceLinkOutgoing)==null||o.initPrograms(),(s=this.forceMouse)==null||s.initPrograms(),this.clusters.initPrograms())}frame(){if(this._isDestroyed)return;const{store:{alpha:e,isSimulationRunning:t}}=this;e<Fm&&t&&this.end(),this.requestAnimationFrameId=window.requestAnimationFrame(n=>{this.renderFrame(n),this._isDestroyed||this.frame()})}renderFrame(e){var t,n,r,o,s,a,l;if(!this._isDestroyed&&this.store.pointsTextureSize){if((t=this.fpsMonitor)==null||t.begin(),this.resizeCanvas(),this.dragInstance.isActive||this.findHoveredItem(),this.runSimulationStep(!1),this.device){const c=this.store.backgroundColor??[0,0,0,1],u=this.device.beginRenderPass({clearColor:c,clearDepth:1,clearStencil:0}),{config:{renderLinks:h}}=this;h!==!1&&this.store.linksTextureSize&&this.graph.linksNumber&&this.graph.linksNumber>0&&((n=this.lines)==null||n.draw(u)),(r=this.points)==null||r.draw(u),this.dragInstance.isActive&&((o=this.points)==null||o.drag(),(s=this.points)==null||s.drag(),(a=this.points)==null||a.trackPoints()),u.end(),this.device.submit()}(l=this.fpsMonitor)==null||l.end(e??performance.now()),this.currentEvent=void 0}}stopFrames(){this.requestAnimationFrameId&&(window.cancelAnimationFrame(this.requestAnimationFrameId),this.requestAnimationFrameId=0)}startFrames(){this._isDestroyed||(this.stopFrames(),this.frame())}end(){var e,t;this.store.isSimulationRunning=!1,this.store.simulationProgress=1,(t=(e=this.config).onSimulationEnd)==null||t.call(e)}onClick(e){var t,n,r,o,s,a,l,c,u,h;(o=(r=this.config).onClick)==null||o.call(r,(t=this.store.hoveredPoint)==null?void 0:t.index,(n=this.store.hoveredPoint)==null?void 0:n.position,e),this.store.hoveredPoint?(a=(s=this.config).onPointClick)==null||a.call(s,this.store.hoveredPoint.index,this.store.hoveredPoint.position,e):this.store.hoveredLinkIndex!==void 0?(c=(l=this.config).onLinkClick)==null||c.call(l,this.store.hoveredLinkIndex,e):(h=(u=this.config).onBackgroundClick)==null||h.call(u,e)}updateMousePosition(e){if(!e)return;const t=e.offsetX??e.x,n=e.offsetY??e.y;t===void 0||n===void 0||(this.store.mousePosition=this.zoomInstance.convertScreenToSpacePosition([t,n]),this.store.screenMousePosition=[t,this.store.screenSize[1]-n])}onMouseMove(e){var t,n,r,o;this.currentEvent=e,this.updateMousePosition(e),this.isRightClickMouse=e.which===3,(o=(r=this.config).onMouseMove)==null||o.call(r,(t=this.store.hoveredPoint)==null?void 0:t.index,(n=this.store.hoveredPoint)==null?void 0:n.position,this.currentEvent)}onRightClickMouse(e){e.preventDefault()}resizeCanvas(e=!1){var t,n,r;if(this._isDestroyed)return;const o=this.canvas.clientWidth,s=this.canvas.clientHeight,[a,l]=this.store.screenSize;if(e||a!==o||l!==s){const{k:c}=this.zoomInstance.eventTransform,u=this.zoomInstance.convertScreenToSpacePosition([a/2,l/2]);this.store.updateScreenSize(o,s),(t=this.canvasD3Selection)==null||t.call(this.zoomInstance.behavior.transform,this.zoomInstance.getTransform([u],c)),(n=this.points)==null||n.updateSampledPointsGrid(),this.store.isLinkHoveringEnabled&&((r=this.lines)==null||r.updateLinkIndexFbo())}}setZoomTransformByPointPositions(e,t=250,n,r){var o;this.resizeCanvas();const s=this.zoomInstance.getTransform(this.pair(e),n,r);(o=this.canvasD3Selection)==null||o.transition().ease(LL).duration(t).call(this.zoomInstance.behavior.transform,s)}updateZoomDragBehaviors(){var e,t,n,r;this.config.enableDrag?(e=this.canvasD3Selection)==null||e.call(this.dragInstance.behavior):(t=this.canvasD3Selection)==null||t.call(this.dragInstance.behavior).on(".drag",null),this.config.enableZoom?(n=this.canvasD3Selection)==null||n.call(this.zoomInstance.behavior):(r=this.canvasD3Selection)==null||r.call(this.zoomInstance.behavior).on("wheel.zoom",null)}findHoveredItem(){if(!(this._isDestroyed||!this._isMouseOnCanvas)){if(this._findHoveredItemExecutionCount<LM){this._findHoveredItemExecutionCount+=1;return}if(this._findHoveredItemExecutionCount=0,this.findHoveredPoint(),this.graph.linksNumber&&this.store.isLinkHoveringEnabled)this.findHoveredLine();else if(this.store.hoveredLinkIndex!==void 0){const e=this.store.hoveredLinkIndex!==void 0;this.store.hoveredLinkIndex=void 0,e&&this.config.onLinkMouseOut&&this.config.onLinkMouseOut(this.currentEvent)}this.updateCanvasCursor()}}findHoveredPoint(){var e,t,n,r;if(this._isDestroyed||!this.device||!this.points)return;this.points.findHoveredPoint();let o=!1,s=!1;const a=tn(this.device,this.points.hoveredFbo,0,0,2,2),l=a[0],c=a[1],u=a[2],h=a[3];c>0?((this.store.hoveredPoint===void 0||this.store.hoveredPoint.index!==l)&&(o=!0),this.store.hoveredPoint={index:l,position:[u,h]}):(this.store.hoveredPoint&&(s=!0),this.store.hoveredPoint=void 0),o&&this.store.hoveredPoint&&((t=(e=this.config).onPointMouseOver)==null||t.call(e,this.store.hoveredPoint.index,this.store.hoveredPoint.position,this.currentEvent)),s&&((r=(n=this.config).onPointMouseOut)==null||r.call(n,this.currentEvent))}findHoveredLine(){var e,t,n,r,o,s;if(this._isDestroyed||!this.lines)return;if(this.store.hoveredPoint){this.store.hoveredLinkIndex!==void 0&&(this.store.hoveredLinkIndex=void 0,(t=(e=this.config).onLinkMouseOut)==null||t.call(e,this.currentEvent));return}this.lines.findHoveredLine();let a=!1,l=!1;if(!this.device)return;const c=tn(this.device,this.lines.hoveredLineIndexFbo)[0];c>=0?(this.store.hoveredLinkIndex!==c&&(a=!0),this.store.hoveredLinkIndex=c):(this.store.hoveredLinkIndex!==void 0&&(l=!0),this.store.hoveredLinkIndex=void 0),a&&this.store.hoveredLinkIndex!==void 0&&((r=(n=this.config).onLinkMouseOver)==null||r.call(n,this.store.hoveredLinkIndex)),l&&((s=(o=this.config).onLinkMouseOut)==null||s.call(o,this.currentEvent))}updateCanvasCursor(){const{hoveredPointCursor:e,hoveredLinkCursor:t}=this.config;this.dragInstance.isActive?Yt(this.canvas).style("cursor","grabbing"):this.store.hoveredPoint?!this.config.enableDrag||this.store.isSpaceKeyPressed?Yt(this.canvas).style("cursor",e):Yt(this.canvas).style("cursor","grab"):this.store.isLinkHoveringEnabled&&this.store.hoveredLinkIndex!==void 0?Yt(this.canvas).style("cursor",t):Yt(this.canvas).style("cursor",null)}addAttribution(){var e;this.config.attribution&&(this.attributionDivElement=document.createElement("div"),this.attributionDivElement.style.cssText=`
      user-select: none;
      position: absolute;
      bottom: 0;
      right: 0;
      color: var(--cosmosgl-attribution-color);
      margin: 0 0.6rem 0.6rem 0;
      font-size: 0.7rem;
      font-family: inherit;
    `,this.attributionDivElement.innerHTML=qR(this.config.attribution,{ALLOWED_TAGS:["a","b","i","em","strong","span","div","p","br","img"],ALLOWED_ATTR:["href","target","class","id","style","src","alt","title"]}),(e=this.store.div)==null||e.appendChild(this.attributionDivElement))}}const Gv={};function qM(i,e=!1){let t,n,r=Gv;function o(c){var u;t=((u=i(c))==null?void 0:u.catch(()=>{}).finally(()=>{if(n){const{event:h}=n;n=null,o(h)}else t=null}))||null}function s(c){n={event:c}}function a(c){t?s(c):o(c)}function l(c){r!==c&&requestAnimationFrame(()=>{const u=r;r=Gv,a(u)}),r=c}return e?l:a}class XM{constructor(e){m(this,"_filterBy");m(this,"_requestUpdate");m(this,"_coordinator");m(this,"_pending");m(this,"_enabled");m(this,"_initialized");m(this,"_request");this._filterBy=e,this._requestUpdate=qM(()=>this.requestQuery(),!0),this._coordinator=null,this._pending=Promise.resolve(),this._enabled=!0,this._initialized=!1,this._request=null}get coordinator(){return this._coordinator}set coordinator(e){this._coordinator=e}get enabled(){return this._enabled}set enabled(e){e=!!e,this._enabled!==e&&(this._enabled=e,e&&(this._initialized?this._request&&this.requestQuery(this._request===!0?void 0:this._request):this.initialize(),this._request=null))}get pending(){return this._pending}get filterBy(){return this._filterBy}get filterStable(){return!0}async prepare(){}query(e){return null}queryPending(){return this}queryResult(e){return this}queryError(e){return this}requestQuery(e){var t;if(this._enabled){const n=e||this.query((t=this.filterBy)==null?void 0:t.predicate(this));return this._coordinator.requestQuery(this,n)}else return this._request=e??!0,null}requestUpdate(){this._enabled?this._requestUpdate():this.requestQuery()}initialize(){this._enabled?this._coordinator&&(this._initialized=!0,this._pending=this.prepare().then(()=>this.requestQuery())):this._initialized=!1}destroy(){var e;this._enabled=!1,(e=this.coordinator)==null||e.disconnect(this)}update(){return this}}const fS=Uint8Array.of(65,82,82,79,87,49),cf={V1:0,V4:3,V5:4},Kr={NONE:0,Schema:1,DictionaryBatch:2,RecordBatch:3,Tensor:4,SparseTensor:5},H={Dictionary:-1,NONE:0,Null:1,Int:2,Float:3,Binary:4,Utf8:5,Bool:6,Decimal:7,Date:8,Time:9,Timestamp:10,Interval:11,List:12,Struct:13,Union:14,FixedSizeBinary:15,FixedSizeList:16,Map:17,Duration:18,LargeBinary:19,LargeUtf8:20,LargeList:21,RunEndEncoded:22,BinaryView:23,Utf8View:24,ListView:25,LargeListView:26},pS={HALF:0,SINGLE:1,DOUBLE:2},rd={DAY:0,MILLISECOND:1},Hi={SECOND:0,MILLISECOND:1,MICROSECOND:2,NANOSECOND:3},fa={YEAR_MONTH:0,DAY_TIME:1,MONTH_DAY_NANO:2},p_={Sparse:0,Dense:1},mS={LZ4_FRAME:0,ZSTD:1},gS={BUFFER:0},KM=Uint8Array,_S=Uint16Array,ZM=Uint32Array,yS=BigUint64Array,bS=Int8Array,QM=Int16Array,Xn=Int32Array,Tr=BigInt64Array,JM=Float32Array,uf=Float64Array;function eN(i){return i instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&i instanceof SharedArrayBuffer}function tN(i,e){const t=Math.log2(i)-3;return(e?[bS,QM,Xn,Tr]:[KM,_S,ZM,yS])[t]}function m_(i,e){let t=0,n=i.length;if(n<=2147483648)do{const r=t+n>>>1;i[r]<=e?t=r+1:n=r}while(t<n);else do{const r=Math.trunc((t+n)/2);i[r]<=e?t=r+1:n=r}while(t<n);return t}function g_(i,e,t){if(e(i))return i;throw new Error(t(i))}function Ar(i,e,t){return e=Array.isArray(e)?e:Object.values(e),g_(i,n=>e.includes(n),t??(()=>`${i} must be one of ${e}`))}function __(i,e){for(const[t,n]of Object.entries(i))if(n===e)return t;return"<Unknown>"}const y_=i=>`Unsupported data type: "${__(H,i)}" (id ${i})`,vS=(i,e,t=!0,n=null)=>({name:i,type:e,nullable:t,metadata:n});function xS(i){return Object.hasOwn(i,"name")&&wS(i.type)}function wS(i){return typeof(i==null?void 0:i.typeId)=="number"}function Bo(i,e="",t=!0){return xS(i)?i:vS(e,g_(i,wS,()=>"Data type expected."),t)}const iN=(i,e,t=!1,n=-1)=>({typeId:H.Dictionary,id:n,dictionary:i,indices:e||ES(),ordered:t}),SS=(i=32,e=!0)=>({typeId:H.Int,bitWidth:Ar(i,[8,16,32,64]),signed:e,values:tN(i,e)}),ES=()=>SS(32),nN=(i=2)=>({typeId:H.Float,precision:Ar(i,pS),values:[_S,JM,uf][i]}),rN=()=>({typeId:H.Binary,offsets:Xn}),oN=()=>({typeId:H.Utf8,offsets:Xn}),sN=(i,e,t=128)=>({typeId:H.Decimal,precision:i,scale:e,bitWidth:Ar(t,[32,64,128,256]),values:t===32?Xn:yS}),aN=i=>({typeId:H.Date,unit:Ar(i,rd),values:i===rd.DAY?Xn:Tr}),lN=(i=Hi.MILLISECOND)=>{i=Ar(i,Hi);const e=i===Hi.SECOND||i===Hi.MILLISECOND?32:64;return{typeId:H.Time,unit:i,bitWidth:e,values:e===32?Xn:Tr}},cN=(i=Hi.MILLISECOND,e=null)=>({typeId:H.Timestamp,unit:Ar(i,Hi),timezone:e,values:Tr}),uN=(i=fa.MONTH_DAY_NANO)=>({typeId:H.Interval,unit:Ar(i,fa),values:i===fa.MONTH_DAY_NANO?void 0:Xn}),hN=i=>({typeId:H.List,children:[Bo(i)],offsets:Xn}),dN=i=>({typeId:H.Struct,children:Array.isArray(i)&&i.length>0&&xS(i[0])?i:Object.entries(i).map(([e,t])=>vS(e,t))}),fN=(i,e,t,n)=>(t??(t=e.map((r,o)=>o)),{typeId:H.Union,mode:Ar(i,p_),typeIds:t,typeMap:t.reduce((r,o,s)=>(r[o]=s,r),{}),children:e.map((r,o)=>Bo(r,`_${o}`)),typeIdForValue:n,offsets:Xn}),pN=i=>({typeId:H.FixedSizeBinary,stride:i}),mN=(i,e)=>({typeId:H.FixedSizeList,stride:e,children:[Bo(i)]}),gN=(i,e)=>({typeId:H.Map,keysSorted:i,children:[e],offsets:Xn}),_N=(i=Hi.MILLISECOND)=>({typeId:H.Duration,unit:Ar(i,Hi),values:Tr}),yN=()=>({typeId:H.LargeBinary,offsets:Tr}),bN=()=>({typeId:H.LargeUtf8,offsets:Tr}),vN=i=>({typeId:H.LargeList,children:[Bo(i)],offsets:Tr}),xN=(i,e)=>({typeId:H.RunEndEncoded,children:[g_(Bo(i,"run_ends"),t=>t.type.typeId===H.Int,()=>"Run-ends must have an integer type."),Bo(e,"values")]}),wN=i=>({typeId:H.ListView,children:[Bo(i,"value")],offsets:Xn}),SN=i=>({typeId:H.LargeListView,children:[Bo(i,"value")],offsets:Tr}),EN=new uf(2),CN=EN.buffer;new Tr(CN);function Oo(i){if(i>Number.MAX_SAFE_INTEGER||i<Number.MIN_SAFE_INTEGER)throw Error(`BigInt exceeds integer number representation: ${i}`);return Number(i)}function b_(i,e){return Number(i/e)+Number(i%e)/Number(e)}const sa=i=>BigInt.asUintN(64,i);function TN(i,e){return BigInt.asIntN(64,i[e])}function AN(i,e){const t=e<<1;let n;return BigInt.asIntN(64,i[t+1])<0?(n=sa(~i[t])|sa(~i[t+1])<<64n,n=-(n+1n)):n=i[t]|i[t+1]<<64n,n}function IN(i,e){const t=e<<2;let n;return BigInt.asIntN(64,i[t+3])<0?(n=sa(~i[t])|sa(~i[t+1])<<64n|sa(~i[t+2])<<128n|sa(~i[t+3])<<192n,n=-(n+1n)):n=i[t]|i[t+1]<<64n|i[t+2]<<128n|i[t+3]<<192n,n}const kN=new TextDecoder("utf-8");new TextEncoder;function hf(i){return kN.decode(i)}const vc=4;function CS(i,e){return(i[e>>3]&1<<e%8)!==0}function Ir(i,e){const t=e+Rt(i,e),n=t-Rt(i,t),r=_n(i,n);return(o,s,a=null)=>{if(o<r){const l=_n(i,n+o);if(l)return s(i,t+l)}return a}}function pa(i,e){return e}function xc(i,e){return!!$m(i,e)}function $m(i,e){return v_(i,e)<<24>>24}function v_(i,e){return i[e]}function _n(i,e){return LN(i,e)<<16>>16}function LN(i,e){return i[e]|i[e+1]<<8}function Rt(i,e){return i[e]|i[e+1]<<8|i[e+2]<<16|i[e+3]<<24}function Wv(i,e){return Rt(i,e)>>>0}function rn(i,e){return Oo(BigInt.asIntN(64,BigInt(Wv(i,e))+(BigInt(Wv(i,e+vc))<<32n)))}function od(i,e){let t=e+Rt(i,e);const n=Rt(i,t);return t+=vc,hf(i.subarray(t,t+n))}function Mo(i,e,t,n){if(!e)return[];const r=e+Rt(i,e);return Array.from({length:Rt(i,r)},(o,s)=>n(i,r+vc+s*t))}const fp=Symbol("rowIndex");function Vm(i,e){class t{constructor(o){this[fp]=o}toJSON(){return AS(i,e,this[fp])}}const n=t.prototype;for(let r=0;r<i.length;++r){if(Object.hasOwn(n,i[r]))continue;const o=e[r];Object.defineProperty(n,i[r],{get(){return o.at(this[fp])},enumerable:!0})}return r=>new t(r)}function TS(i,e){return t=>AS(i,e,t)}function AS(i,e,t){const n={};for(let r=0;r<i.length;++r)n[i[r]]=e[r].at(t);return n}function RN(i){return i instanceof jl}class Xc{constructor({length:e,nullCount:t,type:n,validity:r,values:o,offsets:s,sizes:a,children:l}){this.length=e,this.nullCount=t,this.type=n,this.validity=r,this.values=o,this.offsets=s,this.sizes=a,this.children=l,(!t||!this.validity)&&(this.at=c=>this.value(c))}get[Symbol.toStringTag](){return"Batch"}at(e){return this.isValid(e)?this.value(e):null}isValid(e){return CS(this.validity,e)}value(e){return this.values[e]}slice(e,t){const n=t-e,r=Array(n);for(let o=0;o<n;++o)r[o]=this.at(e+o);return r}*[Symbol.iterator](){for(let e=0;e<this.length;++e)yield this.at(e)}}m(Xc,"ArrayType",null);class jl extends Xc{constructor(e){super(e);const{length:t,values:n}=this;this.values=n.subarray(0,t)}slice(e,t){return this.nullCount?super.slice(e,t):this.values.subarray(e,t)}[Symbol.iterator](){return this.nullCount?super[Symbol.iterator]():this.values[Symbol.iterator]()}}class Kc extends Xc{}m(Kc,"ArrayType",uf);class Ot extends Xc{}m(Ot,"ArrayType",Array);class PN extends Ot{value(e){return null}}class ja extends Kc{value(e){return Oo(this.values[e])}}class DN extends Kc{value(e){const t=this.values[e],n=(t&31744)>>10,r=(t&1023)/1024,o=(-1)**((t&32768)>>15);switch(n){case 31:return o*(r?Number.NaN:1/0);case 0:return o*(r?6103515625e-14*r:0)}return o*2**(n-15)*(1+r)}}class MN extends Ot{value(e){return CS(this.values,e)}}class NN extends Kc{constructor(e){super(e);const{scale:t}=this.type;this.scale=10**t}value(e){return this.values[e]/this.scale}}class IS extends Xc{constructor(e){super(e);const{bitWidth:t,scale:n}=this.type;this.decimal=t===64?TN:t===128?AN:IN,this.scale=10n**BigInt(n)}}class kS extends IS{value(e){return b_(this.decimal(this.values,e),this.scale)}}m(kS,"ArrayType",uf);class LS extends IS{value(e){return this.decimal(this.values,e)}}m(LS,"ArrayType",Array);class jv extends Ot{constructor(e){super(e),this.source=e}value(e){return new Date(this.source.value(e))}}class BN extends Kc{value(e){return 864e5*this.values[e]}}const ON=ja;class FN extends ja{value(e){return super.value(e)*1e3}}const zN=ja;class UN extends ja{value(e){return b_(this.values[e],1000n)}}class $N extends ja{value(e){return b_(this.values[e],1000000n)}}class VN extends Ot{value(e){return this.values.subarray(e<<1,e+1<<1)}}class HN extends Ot{value(e){const t=this.values,n=e<<4;return Float64Array.of(Rt(t,n),Rt(t,n+4),rn(t,n+8))}}const RS=({values:i,offsets:e},t)=>i.subarray(e[t],e[t+1]),PS=({values:i,offsets:e},t)=>i.subarray(Oo(e[t]),Oo(e[t+1]));class GN extends Ot{value(e){return RS(this,e)}}class WN extends Ot{value(e){return PS(this,e)}}class jN extends Ot{value(e){return hf(RS(this,e))}}class YN extends Ot{value(e){return hf(PS(this,e))}}class qN extends Ot{value(e){const t=this.offsets;return this.children[0].slice(t[e],t[e+1])}}class XN extends Ot{value(e){const t=this.offsets;return this.children[0].slice(Oo(t[e]),Oo(t[e+1]))}}class KN extends Ot{value(e){const t=this.offsets[e],n=t+this.sizes[e];return this.children[0].slice(t,n)}}class ZN extends Ot{value(e){const t=this.offsets[e],n=t+this.sizes[e];return this.children[0].slice(Oo(t),Oo(n))}}class DS extends Ot{constructor(e){super(e),this.stride=this.type.stride}}class QN extends DS{value(e){const{stride:t,values:n}=this;return n.subarray(e*t,(e+1)*t)}}class JN extends DS{value(e){const{children:t,stride:n}=this;return t[0].slice(e*n,(e+1)*n)}}function MS({children:i,offsets:e},t){const[n,r]=i[0].children,o=e[t],s=e[t+1],a=[];for(let l=o;l<s;++l)a.push([n.at(l),r.at(l)]);return a}class eB extends Ot{value(e){return MS(this,e)}}class tB extends Ot{value(e){return new Map(MS(this,e))}}class NS extends Ot{constructor({typeIds:e,...t}){super(t),this.typeIds=e,this.typeMap=this.type.typeMap}value(e,t=e){const{typeIds:n,children:r,typeMap:o}=this;return r[o[n[e]]].at(t)}}class iB extends NS{value(e){return super.value(e,this.offsets[e])}}class BS extends Ot{constructor(e,t=TS){super(e),this.names=this.type.children.map(n=>n.name),this.factory=t(this.names,this.children)}value(e){return this.factory(e)}}class nB extends BS{constructor(e){super(e,Vm)}}class rB extends Ot{value(e){const[{values:t},n]=this.children;return n.at(m_(t,e))}}let oB=class extends Ot{setDictionary(e){return this.dictionary=e,this.cache=e.cache(),this}value(e){return this.cache[this.key(e)]}key(e){return this.values[e]}};class OS extends Ot{constructor({data:e,...t}){super(t),this.data=e}view(e){const{values:t,data:n}=this,r=e<<4;let o=r+4,s=t;const a=Rt(s,r);return a>12&&(o=Rt(s,r+12),s=n[Rt(s,r+8)]),s.subarray(o,o+a)}}class sB extends OS{value(e){return this.view(e)}}class aB extends OS{value(e){return hf(this.view(e))}}function Yv(i){let e=[];return{add(t){return e.push(t),this},clear:()=>e=[],done:()=>new lB(e,i)}}class lB{constructor(e,t=(n=>(n=e[0])==null?void 0:n.type)()){this.type=t,this.length=e.reduce((s,a)=>s+a.length,0),this.nullCount=e.reduce((s,a)=>s+a.nullCount,0),this.data=e;const r=e.length,o=new Int32Array(r+1);if(r===1){const[s]=e;o[1]=s.length,this.at=a=>s.at(a)}else for(let s=0,a=0;s<r;++s)o[s+1]=a+=e[s].length;this.offsets=o}get[Symbol.toStringTag](){return"Column"}[Symbol.iterator](){const e=this.data;return e.length===1?e[0][Symbol.iterator]():cB(e)}at(e){var o;const{data:t,offsets:n}=this,r=m_(n,e)-1;return(o=t[r])==null?void 0:o.at(e-n[r])}get(e){return this.at(e)}toArray(){const{length:e,nullCount:t,data:n}=this,r=!t&&RN(n[0]),o=n.length;if(r&&o===1)return n[0].values;const s=!o||t>0?Array:n[0].constructor.ArrayType??n[0].values.constructor,a=new s(e);return r?uB(a,n):hB(a,n)}cache(){return this._cache??(this._cache=this.toArray())}}function*cB(i){for(let e=0;e<i.length;++e){const t=i[e][Symbol.iterator]();for(let n=t.next();!n.done;n=t.next())yield n.value}}function uB(i,e){for(let t=0,n=0;t<e.length;++t){const{values:r}=e[t];i.set(r,n),n+=r.length}return i}function hB(i,e){let t=-1;for(let n=0;n<e.length;++n){const r=e[n];for(let o=0;o<r.length;++o)i[++t]=r.at(o)}return i}let dB=class FS{constructor(e,t,n=!1){const r=e.fields.map(s=>s.name);this.schema=e,this.names=r,this.children=t,this.factory=n?Vm:TS;const o=[];this.getFactory=s=>o[s]??(o[s]=this.factory(r,t.map(a=>a.data[s])))}get[Symbol.toStringTag](){return"Table"}get numCols(){return this.names.length}get numRows(){var e;return((e=this.children[0])==null?void 0:e.length)??0}getChildAt(e){return this.children[e]}getChild(e){const t=this.names.findIndex(n=>n===e);return t>-1?this.children[t]:void 0}selectAt(e,t=[]){const{children:n,factory:r,schema:o}=this,{fields:s}=o;return new FS({...o,fields:e.map((a,l)=>fB(s[a],t[l]))},e.map(a=>n[a]),r===Vm)}select(e,t){const n=this.names,r=e.map(o=>n.indexOf(o));return this.selectAt(r,t)}toColumns(){const{children:e,names:t}=this,n={};return t.forEach((r,o)=>{var s;return n[r]=((s=e[o])==null?void 0:s.toArray())??[]}),n}toArray(){var s;const{children:e,getFactory:t,numRows:n}=this,r=((s=e[0])==null?void 0:s.data)??[],o=Array(n);for(let a=0,l=-1;a<r.length;++a){const c=t(a);for(let u=0;u<r[a].length;++u)o[++l]=c(u)}return o}*[Symbol.iterator](){var r;const{children:e,getFactory:t}=this,n=((r=e[0])==null?void 0:r.data)??[];for(let o=0;o<n.length;++o){const s=t(o);for(let a=0;a<n[o].length;++a)yield s(a)}}at(e){const{children:t,getFactory:n,numRows:r}=this;if(e<0||e>=r)return null;const[{offsets:o}]=t,s=m_(o,e)-1;return n(s)(e-o[s])}get(e){return this.at(e)}};function fB(i,e){return e!=null&&e!==i.name?{...i,name:e}:i}function pB(i,e={}){const{typeId:t,bitWidth:n,mode:r,precision:o,unit:s}=i,{useBigInt:a,useDate:l,useDecimalInt:c,useMap:u,useProxy:h}=e;switch(t){case H.Null:return PN;case H.Bool:return MN;case H.Int:case H.Time:case H.Duration:return a||n<64?jl:ja;case H.Float:return o?jl:DN;case H.Date:return qv(s===rd.DAY?BN:ON,l&&jv);case H.Timestamp:return qv(s===Hi.SECOND?FN:s===Hi.MILLISECOND?zN:s===Hi.MICROSECOND?UN:$N,l&&jv);case H.Decimal:return n===32?c?jl:NN:c?LS:kS;case H.Interval:return s===fa.DAY_TIME?VN:s===fa.YEAR_MONTH?jl:HN;case H.FixedSizeBinary:return QN;case H.Utf8:return jN;case H.LargeUtf8:return YN;case H.Binary:return GN;case H.LargeBinary:return WN;case H.BinaryView:return sB;case H.Utf8View:return aB;case H.List:return qN;case H.LargeList:return XN;case H.Map:return u?tB:eB;case H.ListView:return KN;case H.LargeListView:return ZN;case H.FixedSizeList:return JN;case H.Struct:return h?nB:BS;case H.RunEndEncoded:return rB;case H.Dictionary:return oB;case H.Union:return r?iB:NS}throw new Error(y_(t))}function qv(i,e){return e?class extends e{constructor(n){super(new i(n))}}:i}const mB=-1,gB=8;function _B(i){return`Missing compression codec "${__(mS,i)}" (id ${i})`}const yB=new Map;function bB(i){return i!=null&&yB.get(i)||null}function vB(i,{offset:e,length:t},n){if(t===0)return{bytes:new Uint8Array(0),offset:0,length:0};const r=rn(i,e),o=i.subarray(e+gB,e+t),s=r===mB?o:n.decode(o);return{bytes:s,offset:0,length:s.length}}function xB(i,e){return{offset:rn(i,e),metadataLength:Rt(i,e+8),bodyLength:rn(i,e+16)}}function Xv(i,e){return Mo(i,e,24,xB)}function wB(i,e){const t=Ir(i,e);return{codec:t(4,$m,mS.LZ4_FRAME),method:t(6,$m,gS.BUFFER)}}function zS(i,e,t){const n=Ir(i,e),r=t<cf.V4?8:0;return{length:n(4,rn,0),nodes:Mo(i,n(6,pa),16,(o,s)=>({length:rn(o,s),nullCount:rn(o,s+8)})),regions:Mo(i,n(8,pa),16+r,(o,s)=>({offset:rn(o,s+r),length:rn(o,s+r+8)})),compression:n(10,wB),variadic:Mo(i,n(12,pa),8,rn)}}function SB(i,e,t){const n=Ir(i,e);return{id:n(4,rn,0),data:n(6,(r,o)=>zS(r,o,t)),isDelta:n(8,xc,!1)}}function US(i,e,t,n){Ar(t,H,y_);const r=Ir(i,e);switch(t){case H.Binary:return rN();case H.Utf8:return oN();case H.LargeBinary:return yN();case H.LargeUtf8:return bN();case H.List:return hN(n[0]);case H.ListView:return wN(n[0]);case H.LargeList:return vN(n[0]);case H.LargeListView:return SN(n[0]);case H.Struct:return dN(n);case H.RunEndEncoded:return xN(n[0],n[1]);case H.Int:return SS(r(4,Rt,0),r(6,xc,!1));case H.Float:return nN(r(4,_n,pS.HALF));case H.Decimal:return sN(r(4,Rt,0),r(6,Rt,0),r(8,Rt,128));case H.Date:return aN(r(4,_n,rd.MILLISECOND));case H.Time:return lN(r(4,_n,Hi.MILLISECOND));case H.Timestamp:return cN(r(4,_n,Hi.SECOND),r(6,od));case H.Interval:return uN(r(4,_n,fa.YEAR_MONTH));case H.Duration:return _N(r(4,_n,Hi.MILLISECOND));case H.FixedSizeBinary:return pN(r(4,Rt,0));case H.FixedSizeList:return mN(n[0],r(4,Rt,0));case H.Map:return gN(r(4,xc,!1),n[0]);case H.Union:return fN(r(4,_n,p_.Sparse),n,Mo(i,r(6,pa),4,Rt))}return{typeId:t}}function x_(i,e){const t=Mo(i,e,4,(n,r)=>{const o=Ir(n,r);return[o(4,od),o(6,od)]});return t.length?new Map(t):null}function $S(i,e,t){const n=Ir(i,e);return{version:t,endianness:n(4,_n,0),fields:n(6,EB,[]),metadata:n(8,x_)}}function EB(i,e){return Mo(i,e,4,VS)}function VS(i,e){const t=Ir(i,e),n=t(8,v_,H.NONE),r=t(10,pa,0),o=t(12,TB),s=t(14,CB,[]);let a=US(i,r,n,s);return o&&(o.dictionary=a,a=o),{name:t(4,od),type:a,nullable:t(6,xc,!1),metadata:t(16,x_)}}function CB(i,e){return Mo(i,e,4,VS)}function TB(i,e){if(!e)return null;const t=Ir(i,e);return iN(null,t(6,AB,ES()),t(8,xc,!1),t(4,rn,0))}function AB(i,e){return US(i,e,H.Int)}const IB=(i,e)=>`Expected to read ${i} metadata bytes, but only read ${e}.`,kB=(i,e)=>`Expected to read ${i} bytes for message body, but only read ${e}.`,LB=i=>`Unsupported message type: ${i} (${__(Kr,i)})`;function Hm(i,e){let t=Rt(i,e)||0;if(e+=vc,t===-1&&(t=Rt(i,e)||0,e+=vc),t===0)return null;const n=i.subarray(e,e+=t);if(n.byteLength<t)throw new Error(IB(t,n.byteLength));const r=Ir(n,0),o=r(4,_n,cf.V1),s=r(6,v_,Kr.NONE),a=r(8,pa,0),l=r(10,rn,0);let c;if(a){const u=s===Kr.Schema?$S:s===Kr.DictionaryBatch?SB:s===Kr.RecordBatch?zS:null;if(!u)throw new Error(LB(s));if(c=u(n,a,o),l>0){const h=i.subarray(e,e+=l);if(h.byteLength<l)throw new Error(kB(l,h.byteLength));c.body=h}else s!==Kr.Schema&&(c.body=new Uint8Array(0))}return{version:o,type:s,index:e,content:c}}function RB(i){const e=eN(i)?new Uint8Array(i):i;return e instanceof Uint8Array&&PB(e)?MB(e):DB(e)}function PB(i){if(!i||i.length<4)return!1;for(let e=0;e<6;++e)if(fS[e]!==i[e])return!1;return!0}function DB(i){const e=[i].flat();let t;const n=[],r=[];for(const o of e){if(!(o instanceof Uint8Array))throw new Error("IPC data batch was not a Uint8Array.");let s=0;for(;;){const a=Hm(o,s);if(a===null)break;if(s=a.index,!!a.content)switch(a.type){case Kr.Schema:t||(t=a.content);break;case Kr.RecordBatch:n.push(a.content);break;case Kr.DictionaryBatch:r.push(a.content);break}}}return{schema:t,dictionaries:r,records:n,metadata:null}}function MB(i){const e=i.byteLength-(fS.length+4),t=Rt(i,e),n=Ir(i,e-t),r=n(4,_n,cf.V1),o=n(8,Xv,[]),s=n(10,Xv,[]);return{schema:n(6,(a,l)=>$S(a,l,r)),dictionaries:o.map(({offset:a})=>Hm(i,a).content),records:s.map(({offset:a})=>Hm(i,a).content),metadata:n(12,x_)}}function NB(i,e){return BB(RB(i),e)}function BB(i,e={}){const{schema:t={fields:[]},dictionaries:n,records:r}=i,{version:o,fields:s}=t,a=new Map,l=FB(e,o,a),c=new Map;OB(t,d=>{const f=d.type;f.typeId===H.Dictionary&&c.set(f.id,f.dictionary)});const u=new Map;for(const d of n){const{id:f,data:p,isDelta:b,body:g}=d,_=c.get(f),T=Gm(_,l({...p,body:g}));if(u.has(f)){const E=u.get(f);b||E.clear(),E.add(T)}else{if(b)throw new Error("Delta update can not be first dictionary batch.");u.set(f,Yv(_).add(T))}}u.forEach((d,f)=>a.set(f,d.done()));const h=s.map(d=>Yv(d.type));for(const d of r){const f=l(d);s.forEach((p,b)=>h[b].add(Gm(p.type,f)))}return new dB(t,h.map(d=>d.done()),e.useProxy)}function OB(i,e){i.fields.forEach(function t(n){var r,o,s;e(n),(o=(r=n.type.dictionary)==null?void 0:r.children)==null||o.forEach(t),(s=n.type.children)==null||s.forEach(t)})}function FB(i,e,t){const n={version:e,options:i,dictionary:r=>t.get(r)};return r=>{const{length:o,nodes:s,regions:a,compression:l,variadic:c,body:u}=r;let h=-1,d=-1,f=-1;return{...n,length:o,node:()=>s[++h],buffer:p=>{const{bytes:b,length:g,offset:_}=zB(u,a[++d],l);return p?new p(b.buffer,b.byteOffset+_,g/p.BYTES_PER_ELEMENT):b.subarray(_,_+g)},variadic:()=>c[++f],visit(p){return p.map(b=>Gm(b.type,this))}}}}function zB(i,e,t){if(t){if(t.method!==gS.BUFFER)throw new Error(`Unknown compression method (${t.method})`);{const n=t.codec,r=bB(n);if(!r)throw new Error(_B(n));return vB(i,e,r)}}else return{bytes:i,...e}}function Gm(i,e){const{typeId:t}=i,{options:n,node:r,buffer:o,variadic:s,version:a}=e,l=pB(i,n),c={...r(),type:i};if(t===H.Null)return new l({...c,nullCount:c.length});switch(t){case H.Bool:case H.Int:case H.Time:case H.Duration:case H.Float:case H.Decimal:case H.Date:case H.Timestamp:case H.Interval:case H.FixedSizeBinary:return new l({...c,validity:o(),values:o(i.values)});case H.Utf8:case H.LargeUtf8:case H.Binary:case H.LargeBinary:return new l({...c,validity:o(),offsets:o(i.offsets),values:o()});case H.BinaryView:case H.Utf8View:return new l({...c,validity:o(),values:o(),data:Array.from({length:s()},()=>o())});case H.List:case H.LargeList:case H.Map:return new l({...c,validity:o(),offsets:o(i.offsets),children:e.visit(i.children)});case H.ListView:case H.LargeListView:return new l({...c,validity:o(),offsets:o(i.offsets),sizes:o(i.offsets),children:e.visit(i.children)});case H.FixedSizeList:case H.Struct:return new l({...c,validity:o(),children:e.visit(i.children)});case H.RunEndEncoded:return new l({...c,children:e.visit(i.children)});case H.Dictionary:{const{id:u,indices:h}=i;return new l({...c,validity:o(),values:o(h.values)}).setDictionary(e.dictionary(u))}case H.Union:return a<cf.V5&&o(),new l({...c,typeIds:o(bS),offsets:i.mode===p_.Sparse?null:o(i.offsets),children:e.visit(i.children)});default:throw new Error(y_(t))}}new Uint16Array(new Uint8Array([1,0]).buffer)[0];function sd(i,e={useDate:!0}){return NB(i,e)}class UB{constructor({uri:e="ws://localhost:3000/",ipc:t=void 0}={}){m(this,"_uri");m(this,"_queue");m(this,"_connected");m(this,"_request");m(this,"_ws");m(this,"_events");this._uri=e,this._queue=[],this._connected=!1,this._request=null,this._ws=null;const n=this;this._events={open(){n._connected=!0,n.next()},close(){for(n._connected=!1,n._request=null,n._ws=null;n._queue.length;)n._queue.shift().reject("Socket closed")},error(r){if(n._request){const{reject:o}=n._request;n._request=null,n.next(),o(r)}else console.error("WebSocket error: ",r)},message(r){const{data:o}=r;if(n._request){const{query:s,resolve:a,reject:l}=n._request;if(n._request=null,n.next(),typeof o=="string"){const c=JSON.parse(o);c.error?l(c.error):a(c)}else if(s.type==="exec")a();else if(s.type==="arrow")a(sd(o,t));else throw new Error(`Unexpected socket data: ${o}`)}else console.log("WebSocket message: ",o)}}}get connected(){return this._connected}init(){this._ws=new WebSocket(this._uri),this._ws.binaryType="arraybuffer";for(const e in this._events)this._ws.addEventListener(e,this._events[e])}enqueue(e,t,n){this._ws==null&&this.init(),this._queue.push({query:e,resolve:t,reject:n}),this._connected&&!this._request&&this.next()}next(){this._queue.length&&(this._request=this._queue.shift(),this._ws.send(JSON.stringify(this._request.query)))}query(e){return new Promise((t,n)=>this.enqueue(e,t,n))}}function xr(i){return i instanceof ho}let HS;function $B(i){HS=i}class ho{constructor(e){m(this,"type");this.type=e}clone(){const e=new this.constructor(this.type);for(const t in this)t!=="type"&&(e[t]=this[t]);return e}toString(e=HS){if(!e)throw new Error("No visitor provided and no default visitor set.");return e.toString(this)}}class ai extends ho{}function GS(i){return i.split(".")}function Qo(i){return`"${i.replaceAll('"','""')}"`}function pp(i){return i&&VB(i)?i.slice(1,-1):i}function VB(i){return i[0]==='"'&&i[i.length-1]==='"'}const df="COLUMN_REF",ff="COLUMN_PARAM",WS="TABLE_REF",jS="LITERAL",HB="INTERVAL",GB="LIST",YS="UNNEST",qS="ORDER_BY",w_="CAST",XS="CASE",KS="WHEN",ZS="COLLATE",QS="UNARY",S_="UNARY_POSTFIX",E_="BINARY",C_="BETWEEN",JS="NOT_BETWEEN",T_="LOGICAL_OPERATOR",A_="IN",I_="FUNCTION",Zc="AGGREGATE",pf="WINDOW",e2="WINDOW_FUNCTION",k_="WINDOW_DEF",t2="WINDOW_FRAME",L_="WINDOW_EXTENT_EXPR",i2="EXPRESSION",mf="FRAGMENT",R_="VERBATIM",P_="PARAM",D_="WITH_CLAUSE",M_="WINDOW_CLAUSE",N_="SELECT_CLAUSE",B_="FROM_CLAUSE",n2="JOIN_CLAUSE",r2="SAMPLE_CLAUSE",O_="SELECT_QUERY",F_="DESCRIBE_QUERY",z_="SET_OPERATION",o2="SCALAR_SUBQUERY";class s2 extends ai{constructor(t){super(jS);m(this,"value");this.value=t}}function Kv(i){switch(typeof i){case"number":return Number.isFinite(i)?`${i}`:"NULL";case"string":return`'${i.replaceAll("'","''")}'`;case"boolean":return i?"TRUE":"FALSE";default:if(i==null)return"NULL";if(i instanceof Date){const e=+i;if(Number.isNaN(e))return"NULL";const t=i.getUTCFullYear(),n=i.getUTCMonth(),r=i.getUTCDate();return e===Date.UTC(t,n,r)?`DATE '${t}-${n+1}-${r}'`:`epoch_ms(${e})`}else return i instanceof RegExp?`'${i.source}'`:`${i}`}}class WB{toString(e){if(!e)throw new Error("Node is null or undefined");if(typeof e.type!="string")throw new Error(`Node type is not a string: ${typeof e.type}, value: ${e.type}`);if(e.type==="CUSTOM")return e.toString(this);const t=this.getVisitMethod(e.type);if(typeof t=="function")return t.call(this,e);throw new Error(`No visitor method for node type: '${e.type}'`)}getVisitMethod(e){switch(e){case Zc:return this.visitAggregate;case C_:return this.visitBetween;case E_:return this.visitBinary;case XS:return this.visitCase;case w_:return this.visitCast;case ZS:return this.visitCollate;case ff:return this.visitColumnParam;case df:return this.visitColumnRef;case F_:return this.visitDescribeQuery;case i2:return this.visitExpression;case mf:return this.visitFragment;case B_:return this.visitFromClause;case I_:return this.visitFunction;case A_:return this.visitIn;case HB:return this.visitInterval;case n2:return this.visitJoinClause;case GB:return this.visitList;case jS:return this.visitLiteral;case T_:return this.visitLogicalOperator;case JS:return this.visitNotBetween;case qS:return this.visitOrderBy;case P_:return this.visitParam;case r2:return this.visitSampleClause;case o2:return this.visitScalarSubquery;case N_:return this.visitSelectClause;case O_:return this.visitSelectQuery;case z_:return this.visitSetOperation;case WS:return this.visitTableRef;case QS:return this.visitUnary;case S_:return this.visitUnaryPostfix;case YS:return this.visitUnnest;case R_:return this.visitVerbatim;case KS:return this.visitWhen;case pf:return this.visitWindow;case M_:return this.visitWindowClause;case k_:return this.visitWindowDef;case L_:return this.visitWindowExtentExpr;case t2:return this.visitWindowFrame;case e2:return this.visitWindowFunction;case D_:return this.visitWithClause;default:throw new Error(`Unknown node type: '${e}'`)}}mapToString(e){return e.map(t=>this.toString(t))}}function Fo(i){return typeof i=="string"}function Wm(i){return Array.isArray(i)}function U_(i){if(i){const e=i;return typeof(e==null?void 0:e.addEventListener)=="function"&&e.dynamic!==!1&&"value"in e}return!1}class $_ extends ai{constructor(t){super(P_);m(this,"param");this.param=t}get value(){return this.param.value}}const jB="PRECEDING",YB="FOLLOWING",a2="CURRENT ROW",l2="UNBOUNDED";class qB extends WB{visitAggregate(e){const{name:t,args:n,isDistinct:r,filter:o,order:s}=e,a=[r?"DISTINCT":"",n!=null&&n.length?this.mapToString(n).join(", "):t.toLowerCase()==="count"?"*":"",s.length?`ORDER BY ${this.mapToString(s).join(", ")}`:""].filter(c=>c).join(" "),l=o?` FILTER (WHERE ${this.toString(o)})`:"";return`${t}(${a})${l}`}visitBetween(e){return Zv(this,e,"BETWEEN")}visitBinary(e){const{left:t,right:n,op:r}=e;return`(${this.toString(t)} ${r} ${this.toString(n)})`}visitCase(e){const{expr:t,_when:n,_else:r}=e;return"CASE "+(t?`${this.toString(t)} `:"")+this.mapToString(n).join(" ")+(r?` ELSE ${this.toString(r)}`:"")+" END"}visitCast(e){const{expr:t,cast:n}=e;return`(${this.toString(t)})::${n}`}visitCollate(e){const{expr:t,collation:n}=e;return`${this.toString(t)} COLLATE ${n}`}visitColumnParam(e){return this.visitColumnRef(e)}visitColumnRef(e){const{column:t,table:n}=e,r=n?`${this.toString(n)}.`:"",o=t==="*"?"*":Qo(t);return`${r}${o}`}visitDescribeQuery(e){const{query:t}=e;return`DESC ${this.toString(t)}`}visitExpression(e){throw new Error(`Unexpected EXPRESSION node type. Node: ${JSON.stringify(e)}`)}visitFragment(e){const{spans:t}=e;return t.map(n=>typeof n=="string"?n:this.toString(n)).join("")}visitFromClause(e){var a;const{expr:t,alias:n,sample:r}=e,o=y2(t)?`(${this.toString(t)})`:`${this.toString(t)}`;return`${n&&!(ad(t)&&((a=t.table)==null?void 0:a.join("."))===n)?`${o} AS ${Qo(n)}`:`${o}`}${r?` TABLESAMPLE ${this.toString(r)}`:""}`}visitFunction(e){const{name:t,args:n}=e;return`${t}(${this.mapToString(n).join(", ")})`}visitIn(e){const{expr:t,values:n}=e;return`(${this.toString(t)} IN (${this.mapToString(n).join(", ")}))`}visitInterval(e){const{steps:t,name:n}=e;return`INTERVAL ${t} ${n}`}visitJoinClause(e){const{left:t,right:n,joinVariant:r,joinType:o,condition:s,using:a,sample:l}=e,c=r==="REGULAR"?"":`${r} `;let u="",h="";r!=="CROSS"&&(u=o!=="INNER"?`${o} `:"",h=s?` ON ${this.toString(s)}`:a?` USING (${this.mapToString(a).join(", ")})`:"");const d=l?` USING SAMPLE ${this.toString(l)}`:"";return`${this.toString(t)} ${c}${u}JOIN ${this.toString(n)}${h}${d}`}visitList(e){const{values:t}=e;return`[${this.mapToString(t).join(", ")}]`}visitLiteral(e){const{value:t}=e;return Kv(t)}visitLogicalOperator(e){const{clauses:t,op:n}=e,r=this.mapToString(t);return r.length===0?"":r.length===1?`${r[0]}`:`(${r.join(` ${n} `)})`}visitNotBetween(e){return Zv(this,e,"NOT BETWEEN")}visitOrderBy(e){const{expr:t,desc:n,nullsFirst:r}=e,o=n?" DESC":n===!1?" ASC":"",s=r?" NULLS FIRST":r===!1?" NULLS LAST":"";return`${this.toString(t)}${o}${s}`}visitParam(e){const{param:t}=e;return Kv(t.value)}visitSampleClause(e){const{size:t,perc:n,method:r,seed:o}=e,s=r?`${r} `:"",a=o!=null?` REPEATABLE (${o})`:"";return`${s}(${t}${n?"%":" ROWS"})${a}`}visitScalarSubquery(e){return`(${this.toString(e.subquery)})`}visitSelectClause(e){const{expr:t,alias:n}=e;return!n||XB(t,n)?this.toString(t):`${this.toString(t)} AS ${Qo(n)}`}visitSelectQuery(e){const{_with:t,_select:n,_distinct:r,_from:o,_sample:s,_where:a,_groupby:l,_having:c,_window:u,_qualify:h,_orderby:d,_limitPerc:f,_limit:p,_offset:b}=e,g=[];if(t.length&&g.push(`WITH ${this.mapToString(t).join(", ")}`),g.push(`SELECT${r?" DISTINCT":""} ${this.mapToString(n).join(", ")}`),o.length&&g.push(`FROM ${this.mapToString(o).join(", ")}`),s&&g.push(`USING SAMPLE ${this.toString(s)}`),a.length){const _=this.mapToString(a).filter(T=>T).join(" AND ");_&&g.push(`WHERE ${_}`)}if(l.length&&g.push(`GROUP BY ${this.mapToString(l).join(", ")}`),c.length){const _=this.mapToString(c).filter(T=>T).join(" AND ");_&&g.push(`HAVING ${_}`)}if(u.length&&g.push(`WINDOW ${this.mapToString(u).join(", ")}`),h.length){const _=this.mapToString(h).filter(T=>T).join(" AND ");_&&g.push(`QUALIFY ${_}`)}return d.length&&g.push(`ORDER BY ${this.mapToString(d).join(", ")}`),p&&g.push(`LIMIT ${this.toString(p)}${f?"%":""}`),b!=null&&g.push(`OFFSET ${this.toString(b)}`),g.join(" ")}visitSetOperation(e){const{op:t,queries:n,_with:r,_orderby:o,_limitPerc:s,_limit:a,_offset:l}=e,c=[];return r.length&&c.push(`WITH ${this.mapToString(r).join(", ")}`),c.push(n.join(` ${t} `)),o.length&&c.push(`ORDER BY ${this.mapToString(o).join(", ")}`),a&&c.push(`LIMIT ${this.toString(a)}${s?"%":""}`),l&&c.push(`OFFSET ${this.toString(l)}`),c.join(" ")}visitTableRef(e){const{table:t}=e;return t.map(n=>Qo(n)).join(".")}visitUnary(e){const{expr:t,op:n}=e;return`(${n} ${this.toString(t)})`}visitUnaryPostfix(e){const{expr:t,op:n}=e;return`(${this.toString(t)} ${n})`}visitUnnest(e){const{expr:t,recursive:n,maxDepth:r}=e,o=[this.toString(t)];return n&&o.push("recursive := true"),r!=null&&r>0&&o.push(`max_depth := ${r}`),`UNNEST(${o.join(", ")})`}visitVerbatim(e){const{value:t}=e;return t}visitWhen(e){const{when:t,then:n}=e;return`WHEN ${this.toString(t)} THEN ${this.toString(n)}`}visitWindow(e){const{func:t,def:n}=e;return`${this.toString(t)} OVER ${this.toString(n)}`}visitWindowClause(e){const{name:t,def:n}=e;return`${Qo(t)} AS ${this.toString(n)}`}visitWindowDef(e){const{name:t,partition:n,order:r,framedef:o}=e,s=t&&Qo(t),a=[s,(n==null?void 0:n.length)&&`PARTITION BY ${this.mapToString(n).join(", ")}`,(r==null?void 0:r.length)&&`ORDER BY ${this.mapToString(r).join(", ")}`,o&&this.toString(o)].filter(l=>l);return s&&a.length<2?s:`(${a.join(" ")})`}visitWindowExtentExpr(e){const{scope:t,expr:n}=e;return t===a2?t:`${xr(n)?this.toString(n):n??l2} ${t}`}visitWindowFrame(e){const{frameType:t,exclude:n,extent:r}=e,[o,s]=xr(r)?r.value:r,a=Qv(this,o,jB),l=Qv(this,s,YB);return`${t} BETWEEN ${a} AND ${l}${n?` ${n}`:""}`}visitWindowFunction(e){const{name:t,args:n,ignoreNulls:r,order:o}=e,s=[this.mapToString(n).join(", "),o.length?`ORDER BY ${this.mapToString(o).join(", ")}`:"",r?"IGNORE NULLS":""].filter(a=>a).join(" ");return`${t}(${s})`}visitWithClause(e){const{name:t,query:n,materialized:r}=e,o=r===!0?"MATERIALIZED ":r===!1?"NOT MATERIALIZED ":"";return`${Qo(t)} AS ${o}(${this.toString(n)})`}}function XB(i,e){return i instanceof gf&&i.table==null&&i.column===e}function Zv(i,e,t){const{extent:n,expr:r}=e;if(!n)return"";const[o,s]=i.mapToString(n);return`(${i.toString(r)} ${t} ${o} AND ${s})`}function Qv(i,e,t){const n=xr(e)?i.toString(e):e;return xr(e)&&e.type===L_?n:n!=null&&typeof n!="number"?`${n} ${t}`:n===0?a2:n&&Number.isFinite(n)?`${Math.abs(n)} ${t}`:`${l2} ${t}`}const KB=new qB;$B(KB);class ZB extends ai{constructor(t,n=[]){super(I_);m(this,"name");m(this,"args");this.name=t,this.args=n}}function Kn(i,...e){return new ZB(i,c2(e).map(Gt))}function kr(i,...e){return new cc(i,c2(e).map(Gt))}function lc(i,e){return i.flat().filter(t=>t!=null).map(t=>e(t))}function ps(i){return lc(i,Gt)}function c2(i){const e=i.length;let t=e;for(;t>0&&i[t-1]===void 0;--t);return t<e?i.slice(0,t):i}class QB extends ho{constructor(t,n){super(M_);m(this,"name");m(this,"def");this.name=t,this.def=n}}class aa extends ai{constructor(t,n=new u2){super(pf);m(this,"func");m(this,"def");this.func=t,this.def=n}over(t){return new aa(this.func,this.def.over(t))}partitionby(...t){return new aa(this.func,this.def.partitionby(...t))}orderby(...t){return new aa(this.func,this.def.orderby(...t))}frame(t){return new aa(this.func,this.def.frame(t))}}class u2 extends ho{constructor(t,n,r,o){super(k_);m(this,"name");m(this,"partition");m(this,"order");m(this,"framedef");this.name=t,this.partition=n,this.order=r,this.framedef=o}over(t){return Du(this,{name:t})}partitionby(...t){return Du(this,{partition:ps(t)})}orderby(...t){return Du(this,{order:ps(t)})}frame(t){return Du(this,{framedef:t})}}function Du(i,e){return new u2(e.name??i.name,e.partition??i.partition,e.order??i.order,e.framedef??i.framedef)}function V_(i){return i instanceof gf}class gf extends ai{constructor(t,n){super(t);m(this,"table");this.table=n}get column(){return""}}class h2 extends gf{constructor(t,n){super(df,n);m(this,"name");this.name=t}get column(){return this.name}}class JB extends gf{constructor(t,n){super(ff,n);m(this,"param");this.param=t}get column(){return`${this.param.value}`}}function Ci(i,e){const t=tO(e);return U_(i)?new JB(new $_(i),t):new h2(i,t)}class d2 extends ai{constructor(t,n){super(R_);m(this,"value");m(this,"hint");this.value=t,this.hint=n}}function $i(i){return new s2(i)}function eO(i,e){return new d2(i,e)}function ad(i){return i instanceof f2}class f2 extends ai{constructor(t){super(WS);m(this,"table");this.table=[t].flat()}get name(){return this.table[this.table.length-1]}}function H_(...i){const e=lc(i,String);return e!=null&&e.length?new f2(e):void 0}function Gt(i){return Fo(i)?nO(i):p2(i)}function gh(i){return Fo(i)?eO(i):p2(i)}function p2(i){return i instanceof ai?i:U_(i)?new $_(i):$i(i)}function tO(i){return m2(i)}function iO(i){return m2(i)}function m2(i){return Fo(i)?rO(i):Wm(i)?H_(i):i}function nO(i){const e=GS(i);return Ci(e.pop(),H_(e))}function rO(i){return H_(GS(i))}class cc extends ai{constructor(t,n,r=!1,o=null,s=[]){super(Zc);m(this,"name");m(this,"args");m(this,"isDistinct");m(this,"filter");m(this,"order");this.name=t,this.args=n,this.isDistinct=r,this.filter=o,this.order=ps([s])}distinct(t=!0){return new cc(this.name,this.args,t,this.filter,this.order)}where(t){return Fo(t)&&(t=gh(t)),new cc(this.name,this.args,this.isDistinct,t,this.order)}argOrder(t){return new cc(this.name,this.args,this.isDistinct,this.filter,t)}window(){return new aa(this)}partitionby(...t){return this.window().partitionby(...t)}orderby(...t){return this.window().orderby(...t)}frame(t){return this.window().frame(t)}}const oO=["any_value","approx_count_distinct","approx_quantile","arbitrary","arg_max","arg_max_null","arg_min","arg_min_null","array_agg","avg","bit_and","bit_or","bit_xor","bitstring_agg","bool_and","bool_or","corr","count","count_star","covar_pop","covar_samp","entropy","favg","first","fsum","geomean","kurtosis_pop","kurtosis","last","mad","max","max_by","median","min","min_by","mode","product","quantile","quantile_cont","quantile_disc","regr_avgx","regr_avgy","regr_count","regr_intercept","regr_r2","regr_sxx","regr_sxy","regr_syy","regr_slope","reservoir_quantile","skewness","stddev","stddev_pop","stddev_samp","string_agg","sum","variance","var_pop","var_samp"];class sO extends ai{constructor(t,n,r){super(t);m(this,"expr");m(this,"extent");this.expr=n,this.extent=r}toSQL(t){const{extent:n,expr:r}=this;return n?`(${r} ${t} ${n[0]} AND ${n[1]})`:""}}class aO extends sO{constructor(e,t){super(C_,e,t)}}class lO extends ai{constructor(t,n,r){super(E_);m(this,"op");m(this,"left");m(this,"right");this.op=t,this.left=n,this.right=r}}class cO extends ai{constructor(t,n){super(w_);m(this,"expr");m(this,"cast");this.expr=t,this.cast=n}}class uO extends ai{constructor(t){super(mf);m(this,"spans");this.spans=t}}class g2 extends ho{}class wc extends g2{constructor(t,n,r){super(B_);m(this,"expr");m(this,"alias");m(this,"sample");this.expr=t,this.alias=n,this.sample=r}as(t){return new wc(this.expr,t,this.sample)}}class hO extends ai{constructor(t,n){super(A_);m(this,"expr");m(this,"values");this.expr=t,this.values=n}}class _2 extends ai{constructor(t,n){super(T_);m(this,"op");m(this,"clauses");this.op=t,this.clauses=n}}class dO extends _2{constructor(e){super("AND",e)}}class fO extends _2{constructor(e){super("OR",e)}}class pO extends ho{constructor(t,n=!1,r,o){super(r2);m(this,"size");m(this,"perc");m(this,"method");m(this,"seed");this.size=t,this.perc=n,this.method=r,this.seed=o}}class mO extends ho{constructor(t,n){super(N_);m(this,"expr");m(this,"alias");this.expr=t,this.alias=n}}class Jv extends ho{constructor(t,n,r=null){super(D_);m(this,"name");m(this,"query");m(this,"materialized");this.name=t,this.query=n,this.materialized=r}}function y2(i){return i instanceof Qt}function _f(i){return i instanceof La}function gO(i){return i instanceof yf}class Qt extends ai{constructor(t){super(t);m(this,"_with",[]);m(this,"_orderby",[]);m(this,"_limitPerc",!1);m(this,"_limit");m(this,"_offset");m(this,"cteFor",null)}static with(...t){return new _O(...t)}static select(...t){return new La().select(...t)}static from(...t){return new La().from(...t)}static union(...t){return new or("UNION",t.flat())}static unionByName(...t){return new or("UNION BY NAME",t.flat())}static unionAll(...t){return new or("UNION ALL",t.flat())}static unionAllByName(...t){return new or("UNION ALL BY NAME",t.flat())}static intersect(...t){return new or("INTERSECT",t.flat())}static intersectAll(...t){return new or("INTERSECT ALL",t.flat())}static except(...t){return new or("EXCEPT",t.flat())}static exceptAll(...t){return new or("EXCEPT ALL",t.flat())}static describe(t){return new yf(t)}get subqueries(){return[]}clone(){return this}setCteFor(t){this.cteFor=t}with(...t){const n=[],r=(o,s)=>{const a=s.clone();a.setCteFor(this),n.push(new Jv(o,a))};return t.flat().forEach(o=>{if(o instanceof Jv)n.push(o);else if(o!=null)for(const s in o)r(s,o[s])}),this._with=this._with.concat(n),this}orderby(...t){return this._orderby=this._orderby.concat(ps(t)),this}limitPercent(t){return this._limitPerc=!0,this._limit=Gt(t),this}limit(t){return this._limitPerc=!1,this._limit=Gt(t),this}offset(t){return this._offset=Gt(t),this}}class La extends Qt{constructor(){super(O_);m(this,"_select",[]);m(this,"_from",[]);m(this,"_where",[]);m(this,"_sample");m(this,"_groupby",[]);m(this,"_having",[]);m(this,"_window",[]);m(this,"_qualify",[]);m(this,"_distinct",!1)}get subqueries(){const t=this.cteFor||this,r=(t instanceof La?t._with:[]).reduce((s,a)=>(s[a.name]=a.query,s),{}),o=[];return this._from.forEach(s=>{if(s instanceof wc){const{expr:a}=s;if(y2(a))o.push(a);else if(ad(a)){const l=r[a.name];l&&o.push(l)}}}),o}clone(){return Object.assign(new La,this)}select(...t){const n=new Set,r=[],o=(s,a)=>{const l=pp(a);n.add(l),s&&r.push(new mO(Gt(s),l))};return t.flat().forEach(s=>{if(s!=null)if(Fo(s))o(s,s);else if(V_(s))o(s,s.column);else if(Wm(s))o(s[1],s[0]);else if(xr(s))o(s,`${s}`);else for(const a in s)o(s[a],a)}),this._select=this._select.filter(s=>!n.has(s.alias)).concat(r),this}setSelect(...t){return this._select=[],this.select(...t)}distinct(t=!0){return this._distinct=!!t,this}from(...t){const n=[],r=(o,s)=>{n.push(new wc(iO(o),pp(s)))};return t.flat().forEach(o=>{if(o!=null)if(o instanceof g2)n.push(o);else if(Fo(o))r(o,o);else if(ad(o))r(o,o.name);else if(xr(o))r(o);else if(Wm(o))r(o[1],o[0]);else for(const s in o)r(o[s],s)}),this._from=this._from.concat(n),this}setFrom(...t){return this._from=[],this.from(...t)}sample(t,n,r){let o;if(typeof t=="number"){const s=t>0&&t<1,a=s?t*100:Math.floor(t);o=new pO(a,s,n,r)}else o=t;return this._sample=o??void 0,this}where(...t){return this._where=this._where.concat(lc(t,gh)),this}setWhere(...t){return this._where=[],this.where(...t)}groupby(...t){return this._groupby=this._groupby.concat(ps(t)),this}setGroupby(...t){return this._groupby=[],this.groupby(...t)}having(...t){return this._having=this._having.concat(lc(t,gh)),this}window(...t){const n=[];return t.flat().forEach(r=>{if(r!=null)for(const o in r)n.push(new QB(pp(o),r[o]))}),this._window=this._window.concat(n),this}qualify(...t){return this._qualify=this._qualify.concat(lc(t,gh)),this}}class yf extends ho{constructor(t){super(F_);m(this,"query");this.query=t}clone(){return new yf(this.query.clone())}}class or extends Qt{constructor(t,n){super(z_);m(this,"op");m(this,"queries");this.op=t,this.queries=n}setCteFor(t){super.setCteFor(t);const{queries:n,cteFor:r}=this;r&&n.forEach(o=>o.setCteFor(r))}get subqueries(){return this.queries}clone(){const{op:t,queries:n,...r}=this;return Object.assign(new or(t,n),r)}}class _O{constructor(...e){m(this,"_with");this._with=e}select(...e){return Qt.select(...e).with(...this._with)}from(...e){return Qt.from(...e).with(...this._with)}union(...e){return Qt.union(...e).with(...this._with)}unionByName(...e){return Qt.unionByName(...e).with(...this._with)}unionAll(...e){return Qt.unionAll(...e).with(...this._with)}unionAllByName(...e){return Qt.unionAllByName(...e).with(...this._with)}intersect(...e){return Qt.intersect(...e).with(...this._with)}intersectAll(...e){return Qt.intersectAll(...e).with(...this._with)}except(...e){return Qt.except(...e).with(...this._with)}exceptAll(...e){return Qt.exceptAll(...e).with(...this._with)}}class yO extends ai{constructor(t,n,r){super(t);m(this,"op");m(this,"expr");this.op=n,this.expr=r}}class bO extends yO{constructor(e,t){super(S_,e,t)}}function vO(i,e){return kr("arg_max",i,e)}function xO(i,e){return kr("arg_min",i,e)}function b2(i){return kr("avg",i)}function G_(i){return kr("count",i)}function wO(i){return kr("max",i)}function SO(i){return kr("min",i)}function EO(i,e){return kr("regr_avgx",i,e)}function CO(i,e){return kr("regr_avgy",i,e)}function TO(i,e){return kr("regr_count",i,e)}function Ht(i){return kr("sum",i)}function v2(i,e){return new cO(Gt(i),e)}function AO(i){return v2(i,"INTEGER")}function e0(i){return v2(i,"DOUBLE")}function IO(i){return Kn("epoch_ms",i)}function W_(i){return Kn("exp",i)}function kO(i){return Kn("log",i)}function uc(i){return Kn("ln",i)}function Ra(i){return Kn("sign",i)}function Sc(i){return Kn("abs",i)}function ld(i){return Kn("sqrt",i)}function LO(i){return Kn("ceil",i)}function RO(i){return Kn("floor",i)}function PO(i,e){return Kn("round",i,e)}function x2(i,e){return new bO(i,Gt(e))}function Wo(i,e,t){return new lO(i,Gt(e),Gt(t))}function w2(...i){return new dO(ps(i))}function DO(...i){return new fO(ps(i))}function MO(i){return x2("IS NULL",i)}function S2(i){return x2("IS NOT NULL",i)}function NO(i,e){return Wo("+",i,e)}function yi(i,e){return Wo("-",i,e)}function Li(i,e){return Wo("*",i,e)}function oi(i,e){return Wo("/",i,e)}function An(i,e){return Wo("**",i,e)}function BO(i,e){return Wo("=",i,e)}function j_(i,e){return Wo("<=",i,e)}function Y_(i,e){return Wo(">=",i,e)}function jm(i,e){return new aO(Gt(i),e==null?void 0:e.map(Gt))}function Ym(i,e){return new hO(Gt(i),e.map(Gt))}function Qc(i,...e){return new uO(OO(i,e))}function OO(i,e){const t=[i[0]],n=e.length;for(let r=0,o=0;r<n;){const s=e[r];xr(s)?t[++o]=s:U_(s)?t[++o]=new $_(s):t[o]+=Fo(s)?s:`${$i(s)}`;const a=i[++r];xr(t[o])?t[++o]=a:t[o]+=a}return t.filter(r=>r).map(r=>Fo(r)?new d2(r):r)}function E2(...i){return Kn("coalesce",...i)}const C2={[Zc]:["args","order","filter"],[C_]:["expr","extent"],[E_]:["left","right"],[XS]:["expr","_when","_else"],[w_]:["expr"],[ZS]:["expr"],[ff]:["param","table"],[df]:["table"],[F_]:["query"],[i2]:["node"],[mf]:["spans"],[B_]:["expr"],[I_]:["args"],[A_]:["expr","values"],[n2]:["left","right","on","using","sample"],[T_]:["clauses"],[JS]:["expr","extent"],[qS]:["expr"],[P_]:["value"],[o2]:["subquery"],[N_]:["expr"],[O_]:["_with","_select","_from","_where","_sample","_groupby","_having","_window","_qualify","_orderby"],[z_]:["queries","_orderby"],[QS]:["expr"],[S_]:["expr"],[YS]:["expr"],[KS]:["when","then"],[pf]:["func","def"],[M_]:["def"],[k_]:["partition","order","framedef"],[L_]:["expr"],[t2]:["extent"],[e2]:["args"],[D_]:["query"]};function qm(i,e){if(e.has(i))return e.get(i);if(xr(i)){const t=C2[i.type],n=(t==null?void 0:t.length)??0;if(n>0){i=i.clone();for(let r=0;r<n;++r){const o=t[r],s=i[o];if(Array.isArray(s)){const a=i[o]=s.slice(),l=s.length;for(let c=0;c<l;++c)a[c]=qm(s[c],e)}else s&&(i[o]=qm(s,e))}}}return i}function Ec(i,e){if(!xr(i))return;const t=e(i);if(t)return t;const n=C2[i.type],r=(n==null?void 0:n.length)??0;for(let o=0;o<r;++o){const s=i[n[o]];if(Array.isArray(s)){const a=s.length;for(let l=0;l<a;++l)if(s[l]&&Number(Ec(s[l],e))<0)return t}else if(s&&Number(Ec(s,e))<0)return-1}}const FO=new RegExp(`^(${oO.join("|")})$`),zO=/(\\'|\\"|"(?:\\"|[^"])*"|'(?:\\'|[^'])*'|\w+\()/g;function UO(i){return i.split(zO).some(e=>e.endsWith("(")&&FO.test(e.slice(0,-1)))}function q_(i){let e=0;return Ec(i,t=>{switch(t.type){case pf:return-1;case Zc:return e|=1,-1;case mf:case R_:{let n=`${t}`.toLowerCase();const r=n.indexOf("(select ");return r>=0&&(n=n.slice(0,r)),n.includes(") over ")?-1:UO(n)?(e|=2,-1):1}}}),e}function $O(i){const e=new Set;return Ec(i,t=>{t.type===Zc&&e.add(t)}),Array.from(e)}function T2(i){const e={};return Ec(i,t=>{(t.type===df||t.type===ff)&&(e[`${t}`]=t)}),Object.values(e)}function VO(i,e,{replace:t=!1,temp:n=!1,view:r=!1}={}){return"CREATE"+(t?" OR REPLACE ":" ")+(n?"TEMP ":"")+(r?"VIEW":"TABLE")+(t?" ":" IF NOT EXISTS ")+i+" AS "+e}function _h(i){return i}function t0(){return{apply:_h,invert:_h,sqlApply:Gt,sqlInvert:_h}}function HO({base:i=null}={}){if(i==null||i===Math.E)return{apply:Math.log,invert:Math.exp,sqlApply:e=>uc(e),sqlInvert:e=>W_(e)};if(i===10)return{apply:Math.log10,invert:e=>Math.pow(10,e),sqlApply:e=>kO(e),sqlInvert:e=>An(10,e)};{const e=+i;return{apply:t=>Math.log(t)/Math.log(e),invert:t=>Math.pow(e,t),sqlApply:t=>oi(uc(t),uc(e)),sqlInvert:t=>An(e,t)}}}function GO({constant:i=1}={}){const e=+i;return{apply:t=>Math.sign(t)*Math.log1p(Math.abs(t)),invert:t=>Math.sign(t)*Math.exp(Math.abs(t)-e),sqlApply:t=>(t=Gt(t),Li(Ra(t),uc(NO(e,Sc(t))))),sqlInvert:t=>Li(Ra(t),yi(W_(Sc(t)),e))}}function WO(){return{apply:i=>Math.sign(i)*Math.sqrt(Math.abs(i)),invert:i=>Math.sign(i)*i*i,sqlApply:i=>(i=Gt(i),Li(Ra(i),ld(Sc(i)))),sqlInvert:i=>Li(Ra(i),An(i,2))}}function jO({exponent:i=1}={}){const e=+i;return{apply:t=>Math.sign(t)*Math.pow(Math.abs(t),e),invert:t=>Math.sign(t)*Math.pow(Math.abs(t),1/e),sqlApply:t=>(t=Gt(t),Li(Ra(t),An(Sc(t),e))),sqlInvert:t=>Li(Ra(t),An(Sc(t),oi(1,e)))}}function i0(){return{apply:i=>Number(i),invert:i=>new Date(i),sqlApply:i=>i instanceof Date?$i(+i):XO(i)?$i(Number(i.value)):IO(i),sqlInvert:_h}}const YO={identity:t0,linear:t0,log:HO,symlog:GO,sqrt:WO,pow:jO,time:i0,utc:i0};function qO(i){const e=YO[i.type];if(!e)throw new Error(`Unrecognized scale type: ${i.type}`);return{...i,...e(i)}}function XO(i){return i instanceof s2&&i.value instanceof Date}function A2(i){let e=2166136261;for(let t=0,n=i.length;t<n;++t){const r=i.charCodeAt(t),o=r&65280;o&&(e=n0(e^o>>8)),e=n0(e^r&255)}return KO(e)>>>0}function n0(i){return i+(i<<1)+(i<<4)+(i<<7)+(i<<8)+(i<<24)}function KO(i){return i+=i<<13,i^=i>>>7,i+=i<<3,i^=i>>>17,i+=i<<5,i&4294967295}function ZO(i,e,t){switch(i.name){case"count":case"count_star":return QO(e,i);case"sum":return k2(e,i);case"avg":return JO(e,i);case"geomean":return eF(e,i);case"arg_max":return tF(e,i);case"arg_min":return iF(e,i);case"variance":case"var_samp":return Mu(e,i,t);case"var_pop":return Mu(e,i,t,!1);case"stddev":case"stddev_samp":return ld(Mu(e,i,t));case"stddev_pop":return ld(Mu(e,i,t,!1));case"covar_samp":return yh(e,i,t);case"covar_pop":return yh(e,i,t,!1);case"corr":return r0(e,i,t);case"regr_count":return Ya(e,i).expr;case"regr_avgx":return R2(e,i);case"regr_avgy":return P2(e,i);case"regr_syy":return Km(e,0,i,t);case"regr_sxx":return Km(e,1,i,t);case"regr_sxy":return yh(e,i,t,null);case"regr_slope":return D2(e,i,t);case"regr_intercept":return nF(e,i,t);case"regr_r2":return An(r0(e,i,t),2);case"max":case"min":case"bit_and":case"bit_or":case"bit_xor":case"bool_and":case"bool_or":case"product":{const n=I2(i);return e[n]=i,Qc`${i.name}("${n}")`}default:return null}}function I2(i){return"pre_"+A2(`${i}`).toString(16)}function bi(i,e,t){const n=t==null?void 0:t.filter;n&&(e=e.filter?e.where(w2(n,e.filter)):e.where(n));const r=I2(e);return i[r]=e,r}function X_(i,e){const t=bi(i,G_(e.args[0]),e);return{expr:E2(Ht(t),0),name:t}}function QO(i,e){return E2(k2(i,e),0)}function k2(i,e){return Ht(bi(i,e))}function JO(i,e){const t=bi(i,e),{expr:n,name:r}=X_(i,e);return oi(Ht(Li(t,r)),n)}function eF(i,e){const t=e.args[0],n=bi(i,Ht(uc(t)),e),{expr:r}=X_(i,e);return W_(oi(Ht(n),r))}function tF(i,e){const t=bi(i,e),n=bi(i,wO(e.args[1]),e);return vO(t,n)}function iF(i,e){const t=bi(i,e),n=bi(i,SO(e.args[1]),e);return xO(t,n)}function Mu(i,e,t,n=!0){const r=e.args[0],{expr:o}=X_(i,e),s=yi(r,t(r)),a=bi(i,Ht(An(s,2)),e),l=bi(i,Ht(s),e),c=n?yi(o,1):o;return oi(yi(Ht(a),oi(An(Ht(l),2),o)),c)}function yh(i,e,t,n=!0){const{expr:r}=Ya(i,e),o=L2(i,e,t),s=Cc(i,1,e,t),a=Cc(i,0,e,t),l=yi(o,oi(Li(s,a),r));return n===null?l:n?oi(l,yi(r,1)):oi(l,r)}function r0(i,e,t){const{expr:n}=Ya(i,e),r=L2(i,e,t),o=Xm(i,1,e,t),s=Xm(i,0,e,t),a=Cc(i,1,e,t),l=Cc(i,0,e,t),c=yi(o,oi(An(a,2),n)),u=yi(s,oi(An(l,2),n));return oi(yi(r,oi(Li(a,l),n)),ld(Li(c,u)))}function Ya(i,e){const[t,n]=e.args,r=bi(i,TO(t,n),e);return{expr:Ht(r),name:r}}function Cc(i,e,t,n){const r=t.args,o=r[e],s=r[1-e],a=Ht(yi(o,n(o))).where(S2(s));return Ht(bi(i,a,t))}function Xm(i,e,t,n){const r=t.args,o=r[e],s=r[1-e],a=Ht(An(yi(o,n(o)),2)).where(S2(s));return Ht(bi(i,a,t))}function L2(i,e,t){const[n,r]=e.args,o=Ht(Li(yi(r,t(r)),yi(n,t(n))));return Ht(bi(i,o,e))}function R2(i,e){const[t,n]=e.args,{expr:r,name:o}=Ya(i,e),s=bi(i,EO(t,n),e);return oi(Ht(Li(s,o)),r)}function P2(i,e){const[t,n]=e.args,{expr:r,name:o}=Ya(i,e),s=bi(i,CO(t,n),e);return oi(Ht(Li(s,o)),r)}function Km(i,e,t,n){const{expr:r}=Ya(i,t),o=Cc(i,e,t,n),s=Xm(i,e,t,n);return yi(s,oi(An(o,2),r))}function D2(i,e,t){const n=yh(i,e,t,null),r=Km(i,1,e,t);return oi(n,r)}function nF(i,e,t){const n=R2(i,e),r=P2(i,e),o=D2(i,e,t);return yi(r,Li(o,n))}function rF(i){if(!i.filterStable)return null;const e=i.query();if(!_f(e))return null;const t=cd(e,l=>{const c=l._from[0],u=c instanceof wc&&c.expr;return ad(u)?u.name:u});if(typeof t!="string")return null;const n=new Map,r={},o={},s=[],a=l=>{const c=l.column,u=cd(e,h=>{var d;return(d=h._select.find(f=>f.alias===c))==null?void 0:d.expr});return Qc`(SELECT avg(${u??l}) FROM "${t}")`};for(const{alias:l,expr:c}of e._select){if(q_(c)>1)return null;const u=$O(c);if(u.length===0)s.push(l),r[l]=c;else{for(const h of u){if(h.isDistinct)return null;const d=ZO(h,r,a);if(!d)return null;n.set(h,d)}o[l]=qm(c,n)}}return n.size?{group:s,preagg:r,output:o}:null}function cd(i,e){const t=i.subqueries;if(_f(i)&&t.length===0)return e(i);const n=cd(t[0],e);for(let r=1;r<t.length;++r){const o=cd(t[r],e);if(o!==void 0&&o!==n)return NaN}return n}const oF={skip:!0,result:null};class sF{constructor(e,{schema:t="mosaic",enabled:n=!0}={}){m(this,"entries");m(this,"active");m(this,"mc");m(this,"_schema");m(this,"_enabled");this.entries=new Map,this.active=null,this.mc=e,this._schema=t,this._enabled=n}set enabled(e){this._enabled!==e&&(e||this.clear(),this._enabled=e)}get enabled(){return this._enabled}set schema(e){this._schema!==e&&(this.clear(),this._schema=e)}get schema(){return this._schema}dropSchema(){return this.clear(),this.mc.exec(`DROP SCHEMA IF EXISTS "${this.schema}" CASCADE`)}clear(){this.entries.clear(),this.active=null}request(e,t,n){var h;if(!this.enabled||n==null)return null;const{entries:r,mc:o,schema:s}=this,{source:a}=n;if(!a||this.active&&(this.active.source!==a&&this.clear(),((h=this.active)==null?void 0:h.source)===null))return null;let{active:l}=this;if(!l&&(n.predicate==null||(this.active=l=aF(n),l.source===null)))return null;if(r.has(e))return r.get(e);const c=rF(e);let u;if(!c)u=null;else if(t.skip(e,n))u=oF;else{const d=t.remove(a).predicate(e);u=uF(e.query(d),l,c,s),u.result=o.exec([`CREATE SCHEMA IF NOT EXISTS ${s}`,VO(u.table,u.create,{temp:!1})]),u.result.catch(f=>o.logger().error(f))}return r.set(e,u),u}}function aF(i){const{source:e,meta:t}=i,n=i.predicate,r=T2(n).map(a=>a.column);let o,s;if(!t||!r)return{source:null,columns:s,predicate:o};switch(t.type){case"point":o=a=>a,s=Object.fromEntries(r.map(a=>[`${a}`,Gt(a)]));break;case"interval":{const{scales:a,bin:l,pixelSize:c=1}=t;if(!a)break;const u=a.map(h=>cF(h,c,l));u.some(h=>!h)||(u.length===1?(o=h=>{var d;return h?jm("active0",(d=h.extent)==null?void 0:d.map(u[0])):[]},s={active0:u[0](n.expr)}):(o=h=>h?w2(h.clauses.map((d,f)=>{var p;return jm(`active${f}`,(p=d.extent)==null?void 0:p.map(u[f]))})):[],s=Object.fromEntries(n.clauses.map((h,d)=>[`active${d}`,u[d](h.expr)]))))}}return{source:s?e:null,columns:s,predicate:o}}const lF={ceil:LO,round:PO};function cF(i,e,t){const{type:n,domain:r,range:o,apply:s,sqlApply:a}=qO(i);if(!s)return;const l=lF[`${t}`.toLowerCase()]||RO,c=r.map(b=>Number(b)),u=s(Math.min(...c)),h=s(Math.max(...c)),d=(n==="identity"?1:Math.abs(o[1]-o[0])/(h-u))/e,f=d===1?b=>b:b=>Li(e0(d),b),p=u===0?b=>b:b=>yi(b,e0(u));return b=>AO(l(f(p(a(b)))))}function uF(i,e,t,n){const{group:r,output:o,preagg:s}=t,{columns:a}=e,l=i.setSelect({...s,...a}).groupby(Object.keys(a)),[c]=l.subqueries;if(c){const g=Object.values(a).flatMap(_=>T2(_).map(T=>T.column));hF(c,g)}const u=l._having,h=l._orderby;l._having=[],l._orderby=[];const d=l.toString(),f=(A2(d)>>>0).toString(16),p=`${n}.preagg_${f}`,b=Qt.select(r,o).from(p).groupby(r).having(u).orderby(h);return new fF({table:p,create:d,active:e,select:b})}function hF(i,e){const t=new Set,n=r=>{if(!t.has(r)){if(t.add(r),_f(r)&&r._from.length&&(r.select(e),dF(r))){const o=new Set(r._groupby.flatMap(s=>s instanceof h2?[s.name]:[]));r.groupby(e.filter(s=>!o.has(s)))}r.subqueries.forEach(n)}};n(i)}function dF(i){return i._groupby.length>0||i._select.some(e=>q_(e))}class fF{constructor({table:e,create:t,active:n,select:r}){m(this,"table");m(this,"create");m(this,"result");m(this,"active");m(this,"select");m(this,"skip");this.table=e,this.create=t,this.result=null,this.active=n,this.select=r,this.skip=!1}query(e){return this.select.clone().where(this.active.predicate(e))}}function Zm(){return{debug(){},info(){},log(){},warn(){},error(){},group(){},groupCollapsed(){},groupEnd(){}}}const is=Object.freeze({pending:Symbol("pending"),ready:Symbol("ready"),error:Symbol("error"),done:Symbol("done")});class K_ extends Promise{constructor(){let t,n;super((r,o)=>{t=r,n=o});m(this,"_resolve");m(this,"_reject");m(this,"_state");m(this,"_value");this._resolve=t,this._reject=n,this._state=is.pending,this._value=void 0}fulfill(t){if(this._value!==void 0){if(t!==void 0)throw Error("Promise is ready and fulfill has a provided value");this._resolve(this._value)}else{if(t===void 0)throw Error("Promise is neither ready nor has provided value");this._resolve(t)}return this._state=is.done,this}ready(t){return this._state=is.ready,this._value=t,this}reject(t){return this._state=is.error,this._reject(t),this}get state(){return this._state}}K_.prototype.constructor=Promise;function pF(i){return typeof requestAnimationFrame<"u"?requestAnimationFrame(i):typeof setImmediate<"u"?setImmediate(i):setTimeout(i)}function mF(i,e){let t=[],n=0;function r(){const o=gF(t,e);t=[],n=0;for(const s of o)yF(s,i),xF(s,e)}return{add(o,s){o.request.type==="arrow"?(n||(n=pF(()=>r())),t.push({entry:o,priority:s,index:t.length})):i(o,s)}}}function gF(i,e){const t=[],n=new Map;for(const r of i){const{entry:{request:o}}=r,s=_F(o.query,e);if(!n.has(s)){const a=[];t.push(a),n.set(s,a)}n.get(s).push(r)}return t}function _F(i,e){const t=`${i}`;if(_f(i)&&!e.get(t)){if(i._where.length||i._qualify.length||i._having.length||i._orderby.length||i._distinct)return t;const n=i.clone().setSelect("*"),r=i._groupby;if(r.length){const o={};i._select.forEach(({alias:s,expr:a})=>o[s]=a),n.setGroupby(r.map(s=>V_(s)&&o[s.column]||s))}else i._select.some(o=>q_(o.expr))&&n.setGroupby("ALL");return`${n}`}else return t}function yF(i,e){if(bF(i))e({request:{type:"arrow",cache:!1,query:i.query=vF(i)},result:i.result=new K_});else for(const{entry:t,priority:n}of i)e(t,n)}function bF(i){if(i.length>1){const e=`${i[0].entry.request.query}`;for(let t=1;t<i.length;++t)if(e!==`${i[t].entry.request.query}`)return!0}return!1}function vF(i){const e=i.maps=[],t=new Map;for(const o of i){const s=o.entry.request.query,a=[];e.push(a);for(const{alias:l,expr:c}of s._select){const u=`${c}`;t.has(u)||t.set(u,[`col${t.size}`,c]);const[h]=t.get(u);a.push([h,l])}}const n=i[0].entry.request.query.clone(),r=n._groupby;if(r.length){const o={};i.maps[0].forEach(([s,a])=>o[a]=s),n.setGroupby(r.map(s=>V_(s)&&o[s.column]||s))}return n.setSelect(Array.from(t.values()))}async function xF(i,e){const{maps:t,query:n,result:r}=i;if(!t)return;let o;try{o=await r}catch(a){for(const{entry:l}of i)l.result.reject(a);return}const s=gO(n);i.forEach(({entry:a},l)=>{const{request:c,result:u}=a,h=t[l],d=s&&h?SF(o,h):h?wF(o,h):o;c.cache&&e.set(String(c.query),d),u.fulfill(d)})}function wF(i,e){return i.select(e.map(t=>t[0]),e.map(t=>t[1]))}function SF(i,e){const t=new Map(e),n=[];for(const r of i)t.has(r.column_name)&&n.push({...r,column_name:t.get(r.column_name)});return n}const EF=typeof requestIdleCallback<"u"?requestIdleCallback:setTimeout;function CF(){return{get:()=>{},set:(i,e)=>e,clear:()=>{}}}function TF({max:i=1e3,ttl:e=10800*1e3}={}){let t=new Map;function n(){const r=performance.now()-e;let o=null,s=1/0;for(const[a,l]of t){const{last:c}=l;c<s&&(o=a,s=c),r>c&&t.delete(a)}o&&t.delete(o)}return{get(r){const o=t.get(r);if(o)return o.last=performance.now(),o.value},set(r,o){return t.set(r,{last:performance.now(),value:o}),t.size>i&&EF(n),o},clear(){t=new Map}}}class AF{constructor(e){m(this,"queue");this.queue=Array.from({length:e},()=>({head:null,tail:null}))}isEmpty(){return this.queue.every(e=>!e.head)}insert(e,t){const n=this.queue[t];if(!n)throw new Error(`Invalid queue priority rank: ${t}`);const r={item:e,next:null};n.head===null?n.head=n.tail=r:n.tail=n.tail.next=r}remove(e){for(const t of this.queue){let{head:n,tail:r}=t;for(let o=null,s=n;s;o=s,s=s.next)e(s.item)&&(s===n?n=s.next:o.next=s.next,s===r&&(r=o||n));t.head=n,t.tail=r}}next(){for(const e of this.queue){const{head:t}=e;if(t!==null)return e.head=t.next,e.tail===t&&(e.tail=null),t.item}}}const la=Object.freeze({High:0,Normal:1,Low:2});class IF{constructor(e=32){m(this,"queue");m(this,"db");m(this,"clientCache");m(this,"_logger");m(this,"_logQueries");m(this,"_consolidate");m(this,"pendingResults");m(this,"maxConcurrentRequests");m(this,"pendingExec");this.queue=new AF(3),this.db=null,this.clientCache=null,this._logger=Zm(),this._logQueries=!1,this._consolidate=null,this.pendingResults=[],this.maxConcurrentRequests=e,this.pendingExec=!1}next(){if(this.queue.isEmpty()||this.pendingResults.length>this.maxConcurrentRequests||this.pendingExec)return;const e=this.queue.next();if(!e)return;const{request:t,result:n}=e;this.pendingResults.push(n),t.type==="exec"&&(this.pendingExec=!0),this.submit(t,n).finally(()=>{for(;this.pendingResults.length&&this.pendingResults[0].state!==is.pending;){const r=this.pendingResults.shift();r.state===is.ready?r.fulfill():r.state===is.done&&this._logger.warn("Found resolved query in pending results.")}t.type==="exec"&&(this.pendingExec=!1),this.next()})}enqueue(e,t=la.Normal){this.queue.insert(e,t),this.next()}async submit(e,t){try{const{query:n,type:r,cache:o=!1,options:s}=e,a=n?`${n}`:null;if(o){const h=this.clientCache.get(a);if(h){const d=await h;this._logger.debug("Cache"),t.ready(d);return}}const l=performance.now();this._logQueries&&this._logger.debug("Query",{type:r,sql:a,...s});const c=this.db.query({type:r,sql:a,...s});o&&this.clientCache.set(a,c);const u=await c;o&&this.clientCache.set(a,u),this._logger.debug(`Request: ${(performance.now()-l).toFixed(1)}`),t.ready(r==="exec"?null:u)}catch(n){t.reject(n)}}cache(e){return e!==void 0?this.clientCache=e===!0?TF():e||CF():this.clientCache}logger(e){return e?this._logger=e:this._logger}logQueries(e){return e!==void 0?this._logQueries=!!e:this._logQueries}connector(e){return e?this.db=e:this.db}consolidate(e){e&&!this._consolidate?this._consolidate=mF(this.enqueue.bind(this),this.clientCache):!e&&this._consolidate&&(this._consolidate=null)}request(e,t=la.Normal){const n=new K_,r={request:e,result:n};return this._consolidate?this._consolidate.add(r,t):this.enqueue(r,t),n}cancel(e){const t=new Set(e);if(t.size){this.queue.remove(({result:n})=>t.has(n)?(n.reject("Canceled"),!0):!1);for(const n of this.pendingResults)t.has(n)&&n.reject("Canceled")}}clear(){this.queue.remove(({result:e})=>(e.reject("Cleared"),!0));for(const e of this.pendingResults)e.reject("Cleared");this.pendingResults=[]}}let Nu;function Qm(i){return i?Nu=i:Nu==null&&(Nu=new M2),Nu}class M2{constructor(e=new UB,t={}){m(this,"manager");m(this,"preaggregator");m(this,"clients",new Set);m(this,"filterGroups",new Map);m(this,"_logger",Zm());const{logger:n=console,manager:r=new IF,cache:o=!0,consolidate:s=!0,preagg:a={}}=t;this.manager=r,this.manager.cache(o),this.manager.consolidate(s),this.databaseConnector(e),this.logger(n),this.clear(),this.preaggregator=new sF(this,a)}clear(e={}){var r,o;const{clients:t=!0,cache:n=!0}=e;this.manager.clear(),t&&((r=this.filterGroups)==null||r.forEach(s=>s.disconnect()),this.filterGroups=new Map,(o=this.clients)==null||o.forEach(s=>this.disconnect(s)),this.clients=new Set),n&&this.manager.cache().clear()}databaseConnector(e){return e?this.manager.connector(e):this.manager.connector()}logger(e){return arguments.length&&(this._logger=e||Zm(),this.manager.logger(this._logger)),this._logger}cancel(e){this.manager.cancel(e)}exec(e,t={}){const{priority:n=la.Normal}=t;return e=Array.isArray(e)?e.filter(r=>r).join(`;
`):e,this.manager.request({type:"exec",query:e},n)}query(e,t={}){const{type:n="arrow",cache:r=!0,priority:o=la.Normal,...s}=t;return this.manager.request({type:n,query:e,cache:r,options:s},o)}prefetch(e,t={}){return this.query(e,{...t,cache:!0,priority:la.Low})}updateClient(e,t,n=la.Normal){return e.queryPending(),e._pending=this.query(t,{priority:n}).then(r=>e.queryResult(r).update(),r=>{var o;(o=this._logger)==null||o.error(r),e.queryError(r)}).catch(r=>{var o;return(o=this._logger)==null?void 0:o.error(r)})}requestQuery(e,t){return this.preaggregator.clear(),t?this.updateClient(e,t):Promise.resolve(e.update())}connect(e){const{clients:t}=this;if(t!=null&&t.has(e))throw new Error("Client already connected.");t==null||t.add(e),e.coordinator=this,e.initialize(),kF(this,e.filterBy,e)}disconnect(e){const{clients:t,filterGroups:n}=this;if(!(t!=null&&t.has(e)))return;t.delete(e),e.coordinator=null;const r=n==null?void 0:n.get(e.filterBy);r&&r.clients.delete(e)}}function kF(i,e,t){var r,o;if(!e)return;let n=(r=i.filterGroups)==null?void 0:r.get(e);if(!n){const s=l=>LF(i,e,l),a=()=>RF(i,e);e.addEventListener("activate",s),e.addEventListener("value",a),n={selection:e,clients:new Set,disconnect(){e.removeEventListener("activate",s),e.removeEventListener("value",a)}},(o=i.filterGroups)==null||o.set(e,n)}n.clients.add(t)}function LF(i,e,t){const{preaggregator:n,filterGroups:r}=i,{clients:o}=r.get(e);for(const s of o)s.enabled&&n.request(s,e,t)}function RF(i,e){const{preaggregator:t,filterGroups:n}=i,{clients:r}=n.get(e),{active:o}=e;return Promise.allSettled(Array.from(r,s=>{if(!s.enabled)return s.requestQuery();const a=t.request(s,e,o),l=a?null:e.predicate(s);if(a!=null&&a.skip||!a&&!l)return;const c=(a==null?void 0:a.query(o.predicate))??s.query(l);return i.updateClient(s,c)}))}function PF(i){const{coordinator:e=Qm(),...t}=i,n=new DF(t);return e.connect(n),n}class DF extends XM{constructor({selection:t=void 0,enabled:n=!0,filterStable:r=!0,...o}){super(t);m(this,"_methods");m(this,"_filterStable");this.enabled=n,this._methods=o,this._filterStable=r}get filterStable(){return this._filterStable}async prepare(){var t,n;await((n=(t=this._methods).prepare)==null?void 0:n.call(t))}query(t){var n,r;return((r=(n=this._methods).query)==null?void 0:r.call(n,t))??null}queryResult(t){var n,r;return(r=(n=this._methods).queryResult)==null||r.call(n,t),this}queryPending(){var t,n;return(n=(t=this._methods).queryPending)==null||n.call(t),this}queryError(t){var n,r;return(r=(n=this._methods).queryError)==null||r.call(n,t),this}}class MF{constructor(){m(this,"_callbacks");this._callbacks=new Map}addEventListener(e,t){this._callbacks.has(e)||this._callbacks.set(e,{callbacks:new Set,pending:null,queue:new NF}),this._callbacks.get(e).callbacks.add(t)}removeEventListener(e,t){const n=this._callbacks.get(e);n&&n.callbacks.delete(t)}willEmit(e,t){return t}emitQueueFilter(e,t){return null}cancel(e){const t=this._callbacks.get(e);t==null||t.queue.clear()}async pending(e){var t;await((t=this._callbacks.get(e))==null?void 0:t.pending)}emit(e,t){const n=this._callbacks.get(e)||{};if(n.pending)n.queue.enqueue(t,this.emitQueueFilter(e,t));else{const r=this.willEmit(e,t),{callbacks:o,queue:s}=n;if(o!=null&&o.size){const a=Array.from(o,l=>l(r));n.pending=Promise.allSettled(a).then(()=>{n.pending=null,s.isEmpty()||this.emit(e,s.dequeue())})}}}}class NF{constructor(){m(this,"next",null);this.clear()}clear(){this.next=null}isEmpty(){return!this.next}enqueue(e,t){const n={value:e};if(t&&this.next){let r=this;for(;r.next;)t(r.next.value)?r=r.next:r.next=r.next.next;r.next=n}else this.next=n}dequeue(){const{next:e}=this;return this.next=(e==null?void 0:e.next)||null,e==null?void 0:e.value}}function BF(i,e){return i===e?!1:i instanceof Date&&e instanceof Date?+i!=+e:Array.isArray(i)&&Array.isArray(e)?OF(i,e):!0}function OF(i,e){if(i.length!==e.length)return!0;for(let t=0;t<i.length;++t)if(i[t]!==e[t])return!0;return!1}function mp(i){return i instanceof ma}class ma extends MF{constructor(t){super();m(this,"_value");this._value=t}static value(t){return new ma(t)}static array(t){if(t.some(n=>mp(n))){const n=new ma,r=()=>{n.update(t.map(o=>mp(o)?o.value:o))};return r(),t.forEach(o=>mp(o)?o.addEventListener("value",r):0),n}return new ma(t)}get value(){return this._value}update(t,{force:n}={}){return BF(this._value,t)||n?this.emit("value",t):this.cancel("value"),this}willEmit(t,n){return t==="value"&&(this._value=n),n}}function Bu(i,e){return new Jm(new B2(i),e?[e].flat():void 0)}let Jm=class N2 extends ma{constructor(t=new B2,n=[]){super([]);m(this,"_resolved");m(this,"_resolver");m(this,"_relay");if(this._resolved=this._value,this._resolver=t,this._relay=new Set,Array.isArray(n))for(const r of n)r._relay.add(this)}static intersect({cross:t=!1,empty:n=!1,include:r=[]}={}){return Bu({cross:t,empty:n},r)}static union({cross:t=!1,empty:n=!1,include:r=[]}={}){return Bu({cross:t,empty:n,union:!0},r)}static single({cross:t=!1,empty:n=!1,include:r=[]}={}){return Bu({cross:t,empty:n,single:!0},r)}static crossfilter({empty:t=!1,include:n=[]}={}){return Bu({cross:!0,empty:t},n)}clone(){const t=new N2(this._resolver);return t._value=t._resolved=this._value,t}remove(t){const n=this.clone();return n._value=n._resolved=n._resolver.resolve(this._resolved,{source:t}),n._value.active={source:t},n}get resolver(){return this._resolver}get single(){return this._resolver.single}get clauses(){return super.value}get active(){return this.clauses.active}get value(){var t;return(t=this.active)==null?void 0:t.value}valueFor(t){var n;return(n=this.clauses.find(r=>r.source===t))==null?void 0:n.value}activate(t){this.emit("activate",t),this._relay.forEach(n=>n.activate(t))}update(t){return this._resolved=this._resolver.resolve(this._resolved,t,!0),this._resolved.active=t,this._relay.forEach(n=>n.update(t)),super.update(this._resolved)}reset(t){return t??(t=this._resolved),t.forEach(n=>{var r,o;return(o=(r=n.source)==null?void 0:r.reset)==null?void 0:o.call(r)}),this._resolved=this._resolved.filter(n=>!t.includes(n)),this._relay.forEach(n=>n.reset(t)),super.update(this._resolved)}willEmit(t,n){return t==="value"?(this._value=n,this.value):n}emitQueueFilter(t,n){return t==="value"?this._resolver.queueFilter(n):null}skip(t,n){return this._resolver.skip(t,n)}predicate(t=void 0,n=!1){const{clauses:r}=this,o=n?null:r.active;return this._resolver.predicate(r,o,t)}};class B2{constructor({union:e,cross:t,single:n,empty:r}={}){m(this,"union");m(this,"cross");m(this,"single");m(this,"empty");this.union=!!e,this.cross=!!t,this.single=!!n,this.empty=!!r}resolve(e,t,n=!1){const{source:r,predicate:o}=t,s=e.filter(l=>r!==l.source),a=this.single?[]:s;return this.single&&n&&s.forEach(l=>{var c,u;return(u=(c=l.source)==null?void 0:c.reset)==null?void 0:u.call(c)}),o&&a.push(t),a}skip(e,t){var n;return e==null?!1:!!(this.cross&&((n=t==null?void 0:t.clients)!=null&&n.has(e)))}predicate(e,t,n){const{empty:r,union:o}=this;if(r&&!e.length)return[$i(!1)];if(this.skip(n,t))return;const s=e.filter(a=>!this.skip(n,a)).map(a=>a.predicate);return o&&s.length>1?DO(s):s}queueFilter(e){var t;if(this.cross){const n=(t=e.active)==null?void 0:t.source;return r=>{var o;return((o=r.active)==null?void 0:o.source)!==n}}return null}}class FF{constructor({uri:e="http://localhost:3000/",ipc:t=void 0}={}){m(this,"_uri");m(this,"_ipc");this._uri=e,this._ipc=t}async query(e){const t=fetch(this._uri,{method:"POST",mode:"cors",credentials:"omit",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),n=await t;if(!n.ok)throw new Error(`Query failed with HTTP status ${n.status}: ${await n.text()}`);return e.type==="exec"?t:e.type==="arrow"?sd(await n.arrayBuffer(),this._ipc):n.json()}}function ke(i,e,t,n){function r(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(n.next(u))}catch(h){s(h)}}function l(u){try{c(n.throw(u))}catch(h){s(h)}}function c(u){u.done?o(u.value):r(u.value).then(a,l)}c((n=n.apply(i,e||[])).next())})}function o0(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],n=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&n>=i.length&&(i=void 0),{value:i&&i[n++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ne(i){return this instanceof Ne?(this.v=i,this):new Ne(i)}function mr(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(i,e||[]),r,o=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),r[Symbol.asyncIterator]=function(){return this},r;function s(f){return function(p){return Promise.resolve(p).then(f,h)}}function a(f,p){n[f]&&(r[f]=function(b){return new Promise(function(g,_){o.push([f,b,g,_])>1||l(f,b)})},p&&(r[f]=p(r[f])))}function l(f,p){try{c(n[f](p))}catch(b){d(o[0][3],b)}}function c(f){f.value instanceof Ne?Promise.resolve(f.value.v).then(u,h):d(o[0][2],f)}function u(f){l("next",f)}function h(f){l("throw",f)}function d(f,p){f(p),o.shift(),o.length&&l(o[0][0],o[0][1])}}function bh(i){var e,t;return e={},n("next"),n("throw",function(r){throw r}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(r,o){e[r]=i[r]?function(s){return(t=!t)?{value:Ne(i[r](s)),done:!1}:o?o(s):s}:o}}function ss(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],t;return e?e.call(i):(i=typeof o0=="function"?o0(i):i[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=i[o]&&function(s){return new Promise(function(a,l){s=i[o](s),r(a,l,s.done,s.value)})}}function r(o,s,a,l){Promise.resolve(l).then(function(c){o({value:c,done:a})},s)}}const zF=new TextDecoder("utf-8"),eg=i=>zF.decode(i),UF=new TextEncoder,Jc=i=>UF.encode(i),$F=i=>typeof i=="number",O2=i=>typeof i=="boolean",qt=i=>typeof i=="function",Gi=i=>i!=null&&Object(i)===i,zo=i=>Gi(i)&&qt(i.then),eu=i=>Gi(i)&&qt(i[Symbol.iterator]),qa=i=>Gi(i)&&qt(i[Symbol.asyncIterator]),tg=i=>Gi(i)&&Gi(i.schema),F2=i=>Gi(i)&&"done"in i&&"value"in i,z2=i=>Gi(i)&&qt(i.stat)&&$F(i.fd),U2=i=>Gi(i)&&Z_(i.body),bf=i=>"_getDOMStream"in i&&"_getNodeStream"in i,VF=i=>Gi(i)&&qt(i.abort)&&qt(i.getWriter)&&!bf(i),Z_=i=>Gi(i)&&qt(i.cancel)&&qt(i.getReader)&&!bf(i),HF=i=>Gi(i)&&qt(i.end)&&qt(i.write)&&O2(i.writable)&&!bf(i),$2=i=>Gi(i)&&qt(i.read)&&qt(i.pipe)&&O2(i.readable)&&!bf(i),GF=i=>Gi(i)&&qt(i.clear)&&qt(i.bytes)&&qt(i.position)&&qt(i.setPosition)&&qt(i.capacity)&&qt(i.getBufferIdentifier)&&qt(i.createLong),Q_=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:ArrayBuffer;function WF(i){const e=i[0]?[i[0]]:[];let t,n,r,o;for(let s,a,l=0,c=0,u=i.length;++l<u;){if(s=e[c],a=i[l],!s||!a||s.buffer!==a.buffer||a.byteOffset<s.byteOffset){a&&(e[++c]=a);continue}if({byteOffset:t,byteLength:r}=s,{byteOffset:n,byteLength:o}=a,t+r<n||n+o<t){a&&(e[++c]=a);continue}e[c]=new Uint8Array(s.buffer,t,n-t+o)}return e}function ig(i,e,t=0,n=e.byteLength){const r=i.byteLength,o=new Uint8Array(i.buffer,i.byteOffset,r),s=new Uint8Array(e.buffer,e.byteOffset,Math.min(n,r));return o.set(s,t),i}function wr(i,e){const t=WF(i),n=t.reduce((u,h)=>u+h.byteLength,0);let r,o,s,a=0,l=-1;const c=Math.min(e||Number.POSITIVE_INFINITY,n);for(const u=t.length;++l<u;){if(r=t[l],o=r.subarray(0,Math.min(r.length,c-a)),c<=a+o.length){o.length<r.length?t[l]=r.subarray(o.length):o.length===r.length&&l++,s?ig(s,o,a):s=o;break}ig(s||(s=new Uint8Array(c)),o,a),a+=o.length}return[s||new Uint8Array(0),t.slice(l),n-(s?s.byteLength:0)]}function dt(i,e){let t=F2(e)?e.value:e;return t instanceof i?i===Uint8Array?new i(t.buffer,t.byteOffset,t.byteLength):t:t?(typeof t=="string"&&(t=Jc(t)),t instanceof ArrayBuffer?new i(t):t instanceof Q_?new i(t):GF(t)?dt(i,t.bytes()):ArrayBuffer.isView(t)?t.byteLength<=0?new i(0):new i(t.buffer,t.byteOffset,t.byteLength/i.BYTES_PER_ELEMENT):i.from(t)):new i(0)}const xl=i=>dt(Int32Array,i),s0=i=>dt(BigInt64Array,i),ze=i=>dt(Uint8Array,i),ng=i=>(i.next(),i);function*jF(i,e){const t=function*(r){yield r},n=typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof Q_?t(e):eu(e)?e:t(e);return yield*ng((function*(r){let o=null;do o=r.next(yield dt(i,o));while(!o.done)})(n[Symbol.iterator]())),new i}const YF=i=>jF(Uint8Array,i);function V2(i,e){return mr(this,arguments,function*(){if(zo(e))return yield Ne(yield Ne(yield*bh(ss(V2(i,yield Ne(e))))));const n=function(s){return mr(this,arguments,function*(){yield yield Ne(yield Ne(s))})},r=function(s){return mr(this,arguments,function*(){yield Ne(yield*bh(ss(ng((function*(a){let l=null;do l=a.next(yield l==null?void 0:l.value);while(!l.done)})(s[Symbol.iterator]())))))})},o=typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof Q_?n(e):eu(e)?r(e):qa(e)?e:n(e);return yield Ne(yield*bh(ss(ng((function(s){return mr(this,arguments,function*(){let a=null;do a=yield Ne(s.next(yield yield Ne(dt(i,a))));while(!a.done)})})(o[Symbol.asyncIterator]()))))),yield Ne(new i)})}const qF=i=>V2(Uint8Array,i);function H2(i,e,t){if(i!==0){t=t.slice(0,e);for(let n=-1,r=t.length;++n<r;)t[n]+=i}return t.subarray(0,e)}function XF(i,e){let t=0;const n=i.length;if(n!==e.length)return!1;if(n>0)do if(i[t]!==e[t])return!1;while(++t<n);return!0}const yn={fromIterable(i){return Ou(KF(i))},fromAsyncIterable(i){return Ou(ZF(i))},fromDOMStream(i){return Ou(QF(i))},fromNodeStream(i){return Ou(e6(i))},toDOMStream(i,e){throw new Error('"toDOMStream" not available in this environment')},toNodeStream(i,e){throw new Error('"toNodeStream" not available in this environment')}},Ou=i=>(i.next(),i);function*KF(i){let e,t=!1,n=[],r,o,s,a=0;function l(){return o==="peek"?wr(n,s)[0]:([r,n,a]=wr(n,s),r)}({cmd:o,size:s}=(yield null)||{cmd:"read",size:0});const c=YF(i)[Symbol.iterator]();try{do if({done:e,value:r}=Number.isNaN(s-a)?c.next():c.next(s-a),!e&&r.byteLength>0&&(n.push(r),a+=r.byteLength),e||s<=a)do({cmd:o,size:s}=yield l());while(s<a);while(!e)}catch(u){(t=!0)&&typeof c.throw=="function"&&c.throw(u)}finally{t===!1&&typeof c.return=="function"&&c.return(null)}return null}function ZF(i){return mr(this,arguments,function*(){let t,n=!1,r=[],o,s,a,l=0;function c(){return s==="peek"?wr(r,a)[0]:([o,r,l]=wr(r,a),o)}({cmd:s,size:a}=(yield yield Ne(null))||{cmd:"read",size:0});const u=qF(i)[Symbol.asyncIterator]();try{do if({done:t,value:o}=Number.isNaN(a-l)?yield Ne(u.next()):yield Ne(u.next(a-l)),!t&&o.byteLength>0&&(r.push(o),l+=o.byteLength),t||a<=l)do({cmd:s,size:a}=yield yield Ne(c()));while(a<l);while(!t)}catch(h){(n=!0)&&typeof u.throw=="function"&&(yield Ne(u.throw(h)))}finally{n===!1&&typeof u.return=="function"&&(yield Ne(u.return(new Uint8Array(0))))}return yield Ne(null)})}function QF(i){return mr(this,arguments,function*(){let t=!1,n=!1,r=[],o,s,a,l=0;function c(){return s==="peek"?wr(r,a)[0]:([o,r,l]=wr(r,a),o)}({cmd:s,size:a}=(yield yield Ne(null))||{cmd:"read",size:0});const u=new JF(i);try{do if({done:t,value:o}=Number.isNaN(a-l)?yield Ne(u.read()):yield Ne(u.read(a-l)),!t&&o.byteLength>0&&(r.push(ze(o)),l+=o.byteLength),t||a<=l)do({cmd:s,size:a}=yield yield Ne(c()));while(a<l);while(!t)}catch(h){(n=!0)&&(yield Ne(u.cancel(h)))}finally{n===!1?yield Ne(u.cancel()):i.locked&&u.releaseLock()}return yield Ne(null)})}class JF{constructor(e){this.source=e,this.reader=null,this.reader=this.source.getReader(),this.reader.closed.catch(()=>{})}get closed(){return this.reader?this.reader.closed.catch(()=>{}):Promise.resolve()}releaseLock(){this.reader&&this.reader.releaseLock(),this.reader=null}cancel(e){return ke(this,void 0,void 0,function*(){const{reader:t,source:n}=this;t&&(yield t.cancel(e).catch(()=>{})),n&&n.locked&&this.releaseLock()})}read(e){return ke(this,void 0,void 0,function*(){if(e===0)return{done:this.reader==null,value:new Uint8Array(0)};const t=yield this.reader.read();return!t.done&&(t.value=ze(t)),t})}}const gp=(i,e)=>{const t=r=>n([e,r]);let n;return[e,t,new Promise(r=>(n=r)&&i.once(e,t))]};function e6(i){return mr(this,arguments,function*(){const t=[];let n="error",r=!1,o=null,s,a,l=0,c=[],u;function h(){return s==="peek"?wr(c,a)[0]:([u,c,l]=wr(c,a),u)}if({cmd:s,size:a}=(yield yield Ne(null))||{cmd:"read",size:0},i.isTTY)return yield yield Ne(new Uint8Array(0)),yield Ne(null);try{t[0]=gp(i,"end"),t[1]=gp(i,"error");do{if(t[2]=gp(i,"readable"),[n,o]=yield Ne(Promise.race(t.map(f=>f[2]))),n==="error")break;if((r=n==="end")||(Number.isFinite(a-l)?(u=ze(i.read(a-l)),u.byteLength<a-l&&(u=ze(i.read()))):u=ze(i.read()),u.byteLength>0&&(c.push(u),l+=u.byteLength)),r||a<=l)do({cmd:s,size:a}=yield yield Ne(h()));while(a<l)}while(!r)}finally{yield Ne(d(t,n==="error"?o:null))}return yield Ne(null);function d(f,p){return u=c=null,new Promise((b,g)=>{for(const[_,T]of f)i.off(_,T);try{const _=i.destroy;_&&_.call(i,p),p=void 0}catch(_){p=_||p}finally{p!=null?g(p):b()}})}})}var zt;(function(i){i[i.V1=0]="V1",i[i.V2=1]="V2",i[i.V3=2]="V3",i[i.V4=3]="V4",i[i.V5=4]="V5"})(zt||(zt={}));var vi;(function(i){i[i.Sparse=0]="Sparse",i[i.Dense=1]="Dense"})(vi||(vi={}));var Jt;(function(i){i[i.HALF=0]="HALF",i[i.SINGLE=1]="SINGLE",i[i.DOUBLE=2]="DOUBLE"})(Jt||(Jt={}));var In;(function(i){i[i.DAY=0]="DAY",i[i.MILLISECOND=1]="MILLISECOND"})(In||(In={}));var pe;(function(i){i[i.SECOND=0]="SECOND",i[i.MILLISECOND=1]="MILLISECOND",i[i.MICROSECOND=2]="MICROSECOND",i[i.NANOSECOND=3]="NANOSECOND"})(pe||(pe={}));var Sr;(function(i){i[i.YEAR_MONTH=0]="YEAR_MONTH",i[i.DAY_TIME=1]="DAY_TIME",i[i.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"})(Sr||(Sr={}));const _p=2,ur=4,Zr=4,lt=4,Ao=new Int32Array(2),a0=new Float32Array(Ao.buffer),l0=new Float64Array(Ao.buffer),Fu=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var rg;(function(i){i[i.UTF8_BYTES=1]="UTF8_BYTES",i[i.UTF16_STRING=2]="UTF16_STRING"})(rg||(rg={}));let Pa=class G2{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new G2(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return Ao[0]=this.readInt32(e),a0[0]}readFloat64(e){return Ao[Fu?0:1]=this.readInt32(e),Ao[Fu?1:0]=this.readInt32(e+4),l0[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,Number(BigInt.asIntN(32,t))),this.writeInt32(e+4,Number(BigInt.asIntN(32,t>>BigInt(32))))}writeUint64(e,t){this.writeUint32(e,Number(BigInt.asUintN(32,t))),this.writeUint32(e+4,Number(BigInt.asUintN(32,t>>BigInt(32))))}writeFloat32(e,t){a0[0]=t,this.writeInt32(e,Ao[0])}writeFloat64(e,t){l0[0]=t,this.writeInt32(e,Ao[Fu?0:1]),this.writeInt32(e+4,Ao[Fu?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+ur+Zr)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<Zr;t++)e+=String.fromCharCode(this.readInt8(this.position_+ur+t));return e}__offset(e,t){const n=e-this.readInt32(e);return t<this.readInt16(n)?this.readInt16(n+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const n=this.readInt32(e);e+=ur;const r=this.bytes_.subarray(e,e+n);return t===rg.UTF8_BYTES?r:this.text_decoder_.decode(r)}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+ur}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=Zr)throw new Error("FlatBuffers: file identifier must be length "+Zr);for(let t=0;t<Zr;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+ur+t))return!1;return!0}createScalarList(e,t){const n=[];for(let r=0;r<t;++r){const o=e(r);o!==null&&n.push(o)}return n}createObjList(e,t){const n=[];for(let r=0;r<t;++r){const o=e(r);o!==null&&n.push(o.unpack())}return n}},W2=class j2{constructor(e){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder;let t;e?t=e:t=1024,this.bb=Pa.allocate(t),this.space=t}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(e){this.force_defaults=e}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(e,t){e>this.minalign&&(this.minalign=e);const n=~(this.bb.capacity()-this.space+t)+1&e-1;for(;this.space<n+e+t;){const r=this.bb.capacity();this.bb=j2.growByteBuffer(this.bb),this.space+=this.bb.capacity()-r}this.pad(n)}pad(e){for(let t=0;t<e;t++)this.bb.writeInt8(--this.space,0)}writeInt8(e){this.bb.writeInt8(this.space-=1,e)}writeInt16(e){this.bb.writeInt16(this.space-=2,e)}writeInt32(e){this.bb.writeInt32(this.space-=4,e)}writeInt64(e){this.bb.writeInt64(this.space-=8,e)}writeFloat32(e){this.bb.writeFloat32(this.space-=4,e)}writeFloat64(e){this.bb.writeFloat64(this.space-=8,e)}addInt8(e){this.prep(1,0),this.writeInt8(e)}addInt16(e){this.prep(2,0),this.writeInt16(e)}addInt32(e){this.prep(4,0),this.writeInt32(e)}addInt64(e){this.prep(8,0),this.writeInt64(e)}addFloat32(e){this.prep(4,0),this.writeFloat32(e)}addFloat64(e){this.prep(8,0),this.writeFloat64(e)}addFieldInt8(e,t,n){(this.force_defaults||t!=n)&&(this.addInt8(t),this.slot(e))}addFieldInt16(e,t,n){(this.force_defaults||t!=n)&&(this.addInt16(t),this.slot(e))}addFieldInt32(e,t,n){(this.force_defaults||t!=n)&&(this.addInt32(t),this.slot(e))}addFieldInt64(e,t,n){(this.force_defaults||t!==n)&&(this.addInt64(t),this.slot(e))}addFieldFloat32(e,t,n){(this.force_defaults||t!=n)&&(this.addFloat32(t),this.slot(e))}addFieldFloat64(e,t,n){(this.force_defaults||t!=n)&&(this.addFloat64(t),this.slot(e))}addFieldOffset(e,t,n){(this.force_defaults||t!=n)&&(this.addOffset(t),this.slot(e))}addFieldStruct(e,t,n){t!=n&&(this.nested(t),this.slot(e))}nested(e){if(e!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(e){this.vtable!==null&&(this.vtable[e]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(e){const t=e.capacity();if(t&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const n=t<<1,r=Pa.allocate(n);return r.setPosition(n-t),r.bytes().set(e.bytes(),n-t),r}addOffset(e){this.prep(ur,0),this.writeInt32(this.offset()-e+ur)}startObject(e){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=e;for(let t=0;t<e;t++)this.vtable[t]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const e=this.offset();let t=this.vtable_in_use-1;for(;t>=0&&this.vtable[t]==0;t--);const n=t+1;for(;t>=0;t--)this.addInt16(this.vtable[t]!=0?e-this.vtable[t]:0);const r=2;this.addInt16(e-this.object_start);const o=(n+r)*_p;this.addInt16(o);let s=0;const a=this.space;e:for(t=0;t<this.vtables.length;t++){const l=this.bb.capacity()-this.vtables[t];if(o==this.bb.readInt16(l)){for(let c=_p;c<o;c+=_p)if(this.bb.readInt16(a+c)!=this.bb.readInt16(l+c))continue e;s=this.vtables[t];break}}return s?(this.space=this.bb.capacity()-e,this.bb.writeInt32(this.space,s-e)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-e,this.offset()-e)),this.isNested=!1,e}finish(e,t,n){const r=n?lt:0;if(t){const o=t;if(this.prep(this.minalign,ur+Zr+r),o.length!=Zr)throw new TypeError("FlatBuffers: file identifier must be length "+Zr);for(let s=Zr-1;s>=0;s--)this.writeInt8(o.charCodeAt(s))}this.prep(this.minalign,ur+r),this.addOffset(e),r&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(e,t){this.finish(e,t,!0)}requiredField(e,t){const n=this.bb.capacity()-e,r=n-this.bb.readInt32(n);if(!(t<this.bb.readInt16(r)&&this.bb.readInt16(r+t)!=0))throw new TypeError("FlatBuffers: field "+t+" must be set")}startVector(e,t,n){this.notNested(),this.vector_num_elems=t,this.prep(ur,e*t),this.prep(n,e*t)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(e){if(!e)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(e))return this.string_maps.get(e);const t=this.createString(e);return this.string_maps.set(e,t),t}createString(e){if(e==null)return 0;let t;return e instanceof Uint8Array?t=e:t=this.text_encoder.encode(e),this.addInt8(0),this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length),this.bb.bytes().set(t,this.space),this.endVector()}createByteVector(e){return e==null?0:(this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length),this.bb.bytes().set(e,this.space),this.endVector())}createObjectOffset(e){return e===null?0:typeof e=="string"?this.createString(e):e.pack(this)}createObjectOffsetList(e){const t=[];for(let n=0;n<e.length;++n){const r=e[n];if(r!==null)t.push(this.createObjectOffset(r));else throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return t}createStructOffsetList(e,t){return t(this,e.length),this.createObjectOffsetList(e.slice().reverse()),this.endVector()}};var ud;(function(i){i[i.BUFFER=0]="BUFFER"})(ud||(ud={}));var hd;(function(i){i[i.LZ4_FRAME=0]="LZ4_FRAME",i[i.ZSTD=1]="ZSTD"})(hd||(hd={}));class Io{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsBodyCompression(e,t){return(t||new Io).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBodyCompression(e,t){return e.setPosition(e.position()+lt),(t||new Io).__init(e.readInt32(e.position())+e.position(),e)}codec(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt8(this.bb_pos+e):hd.LZ4_FRAME}method(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt8(this.bb_pos+e):ud.BUFFER}static startBodyCompression(e){e.startObject(2)}static addCodec(e,t){e.addFieldInt8(0,t,hd.LZ4_FRAME)}static addMethod(e,t){e.addFieldInt8(1,t,ud.BUFFER)}static endBodyCompression(e){return e.endObject()}static createBodyCompression(e,t,n){return Io.startBodyCompression(e),Io.addCodec(e,t),Io.addMethod(e,n),Io.endBodyCompression(e)}}class Y2{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}offset(){return this.bb.readInt64(this.bb_pos)}length(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createBuffer(e,t,n){return e.prep(8,16),e.writeInt64(BigInt(n??0)),e.writeInt64(BigInt(t??0)),e.offset()}}let q2=class{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}length(){return this.bb.readInt64(this.bb_pos)}nullCount(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createFieldNode(e,t,n){return e.prep(8,16),e.writeInt64(BigInt(n??0)),e.writeInt64(BigInt(t??0)),e.offset()}},Gr=class og{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsRecordBatch(e,t){return(t||new og).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsRecordBatch(e,t){return e.setPosition(e.position()+lt),(t||new og).__init(e.readInt32(e.position())+e.position(),e)}length(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}nodes(e,t){const n=this.bb.__offset(this.bb_pos,6);return n?(t||new q2).__init(this.bb.__vector(this.bb_pos+n)+e*16,this.bb):null}nodesLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}buffers(e,t){const n=this.bb.__offset(this.bb_pos,8);return n?(t||new Y2).__init(this.bb.__vector(this.bb_pos+n)+e*16,this.bb):null}buffersLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}compression(e){const t=this.bb.__offset(this.bb_pos,10);return t?(e||new Io).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}static startRecordBatch(e){e.startObject(4)}static addLength(e,t){e.addFieldInt64(0,t,BigInt("0"))}static addNodes(e,t){e.addFieldOffset(1,t,0)}static startNodesVector(e,t){e.startVector(16,t,8)}static addBuffers(e,t){e.addFieldOffset(2,t,0)}static startBuffersVector(e,t){e.startVector(16,t,8)}static addCompression(e,t){e.addFieldOffset(3,t,0)}static endRecordBatch(e){return e.endObject()}},Ks=class sg{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDictionaryBatch(e,t){return(t||new sg).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDictionaryBatch(e,t){return e.setPosition(e.position()+lt),(t||new sg).__init(e.readInt32(e.position())+e.position(),e)}id(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}data(e){const t=this.bb.__offset(this.bb_pos,6);return t?(e||new Gr).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}isDelta(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startDictionaryBatch(e){e.startObject(3)}static addId(e,t){e.addFieldInt64(0,t,BigInt("0"))}static addData(e,t){e.addFieldOffset(1,t,0)}static addIsDelta(e,t){e.addFieldInt8(2,+t,0)}static endDictionaryBatch(e){return e.endObject()}};var Da;(function(i){i[i.Little=0]="Little",i[i.Big=1]="Big"})(Da||(Da={}));var dd;(function(i){i[i.DenseArray=0]="DenseArray"})(dd||(dd={}));class on{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsInt(e,t){return(t||new on).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsInt(e,t){return e.setPosition(e.position()+lt),(t||new on).__init(e.readInt32(e.position())+e.position(),e)}bitWidth(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}isSigned(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startInt(e){e.startObject(2)}static addBitWidth(e,t){e.addFieldInt32(0,t,0)}static addIsSigned(e,t){e.addFieldInt8(1,+t,0)}static endInt(e){return e.endObject()}static createInt(e,t,n){return on.startInt(e),on.addBitWidth(e,t),on.addIsSigned(e,n),on.endInt(e)}}class Qr{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDictionaryEncoding(e,t){return(t||new Qr).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDictionaryEncoding(e,t){return e.setPosition(e.position()+lt),(t||new Qr).__init(e.readInt32(e.position())+e.position(),e)}id(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}indexType(e){const t=this.bb.__offset(this.bb_pos,6);return t?(e||new on).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}isOrdered(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}dictionaryKind(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt16(this.bb_pos+e):dd.DenseArray}static startDictionaryEncoding(e){e.startObject(4)}static addId(e,t){e.addFieldInt64(0,t,BigInt("0"))}static addIndexType(e,t){e.addFieldOffset(1,t,0)}static addIsOrdered(e,t){e.addFieldInt8(2,+t,0)}static addDictionaryKind(e,t){e.addFieldInt16(3,t,dd.DenseArray)}static endDictionaryEncoding(e){return e.endObject()}}class Xt{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsKeyValue(e,t){return(t||new Xt).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsKeyValue(e,t){return e.setPosition(e.position()+lt),(t||new Xt).__init(e.readInt32(e.position())+e.position(),e)}key(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}value(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}static startKeyValue(e){e.startObject(2)}static addKey(e,t){e.addFieldOffset(0,t,0)}static addValue(e,t){e.addFieldOffset(1,t,0)}static endKeyValue(e){return e.endObject()}static createKeyValue(e,t,n){return Xt.startKeyValue(e),Xt.addKey(e,t),Xt.addValue(e,n),Xt.endKeyValue(e)}}let c0=class Yl{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsBinary(e,t){return(t||new Yl).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBinary(e,t){return e.setPosition(e.position()+lt),(t||new Yl).__init(e.readInt32(e.position())+e.position(),e)}static startBinary(e){e.startObject(0)}static endBinary(e){return e.endObject()}static createBinary(e){return Yl.startBinary(e),Yl.endBinary(e)}},u0=class ql{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsBool(e,t){return(t||new ql).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBool(e,t){return e.setPosition(e.position()+lt),(t||new ql).__init(e.readInt32(e.position())+e.position(),e)}static startBool(e){e.startObject(0)}static endBool(e){return e.endObject()}static createBool(e){return ql.startBool(e),ql.endBool(e)}},vh=class Zs{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDate(e,t){return(t||new Zs).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDate(e,t){return e.setPosition(e.position()+lt),(t||new Zs).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):In.MILLISECOND}static startDate(e){e.startObject(1)}static addUnit(e,t){e.addFieldInt16(0,t,In.MILLISECOND)}static endDate(e){return e.endObject()}static createDate(e,t){return Zs.startDate(e),Zs.addUnit(e,t),Zs.endDate(e)}},Qs=class Co{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDecimal(e,t){return(t||new Co).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDecimal(e,t){return e.setPosition(e.position()+lt),(t||new Co).__init(e.readInt32(e.position())+e.position(),e)}precision(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}scale(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}bitWidth(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readInt32(this.bb_pos+e):128}static startDecimal(e){e.startObject(3)}static addPrecision(e,t){e.addFieldInt32(0,t,0)}static addScale(e,t){e.addFieldInt32(1,t,0)}static addBitWidth(e,t){e.addFieldInt32(2,t,128)}static endDecimal(e){return e.endObject()}static createDecimal(e,t,n,r){return Co.startDecimal(e),Co.addPrecision(e,t),Co.addScale(e,n),Co.addBitWidth(e,r),Co.endDecimal(e)}},xh=class Js{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDuration(e,t){return(t||new Js).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDuration(e,t){return e.setPosition(e.position()+lt),(t||new Js).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):pe.MILLISECOND}static startDuration(e){e.startObject(1)}static addUnit(e,t){e.addFieldInt16(0,t,pe.MILLISECOND)}static endDuration(e){return e.endObject()}static createDuration(e,t){return Js.startDuration(e),Js.addUnit(e,t),Js.endDuration(e)}},wh=class ea{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFixedSizeBinary(e,t){return(t||new ea).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFixedSizeBinary(e,t){return e.setPosition(e.position()+lt),(t||new ea).__init(e.readInt32(e.position())+e.position(),e)}byteWidth(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}static startFixedSizeBinary(e){e.startObject(1)}static addByteWidth(e,t){e.addFieldInt32(0,t,0)}static endFixedSizeBinary(e){return e.endObject()}static createFixedSizeBinary(e,t){return ea.startFixedSizeBinary(e),ea.addByteWidth(e,t),ea.endFixedSizeBinary(e)}},Sh=class ta{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFixedSizeList(e,t){return(t||new ta).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFixedSizeList(e,t){return e.setPosition(e.position()+lt),(t||new ta).__init(e.readInt32(e.position())+e.position(),e)}listSize(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}static startFixedSizeList(e){e.startObject(1)}static addListSize(e,t){e.addFieldInt32(0,t,0)}static endFixedSizeList(e){return e.endObject()}static createFixedSizeList(e,t){return ta.startFixedSizeList(e),ta.addListSize(e,t),ta.endFixedSizeList(e)}};class hr{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFloatingPoint(e,t){return(t||new hr).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFloatingPoint(e,t){return e.setPosition(e.position()+lt),(t||new hr).__init(e.readInt32(e.position())+e.position(),e)}precision(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Jt.HALF}static startFloatingPoint(e){e.startObject(1)}static addPrecision(e,t){e.addFieldInt16(0,t,Jt.HALF)}static endFloatingPoint(e){return e.endObject()}static createFloatingPoint(e,t){return hr.startFloatingPoint(e),hr.addPrecision(e,t),hr.endFloatingPoint(e)}}class dr{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsInterval(e,t){return(t||new dr).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsInterval(e,t){return e.setPosition(e.position()+lt),(t||new dr).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Sr.YEAR_MONTH}static startInterval(e){e.startObject(1)}static addUnit(e,t){e.addFieldInt16(0,t,Sr.YEAR_MONTH)}static endInterval(e){return e.endObject()}static createInterval(e,t){return dr.startInterval(e),dr.addUnit(e,t),dr.endInterval(e)}}let h0=class Xl{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsLargeBinary(e,t){return(t||new Xl).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsLargeBinary(e,t){return e.setPosition(e.position()+lt),(t||new Xl).__init(e.readInt32(e.position())+e.position(),e)}static startLargeBinary(e){e.startObject(0)}static endLargeBinary(e){return e.endObject()}static createLargeBinary(e){return Xl.startLargeBinary(e),Xl.endLargeBinary(e)}},d0=class Kl{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsLargeUtf8(e,t){return(t||new Kl).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsLargeUtf8(e,t){return e.setPosition(e.position()+lt),(t||new Kl).__init(e.readInt32(e.position())+e.position(),e)}static startLargeUtf8(e){e.startObject(0)}static endLargeUtf8(e){return e.endObject()}static createLargeUtf8(e){return Kl.startLargeUtf8(e),Kl.endLargeUtf8(e)}},f0=class Zl{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsList(e,t){return(t||new Zl).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsList(e,t){return e.setPosition(e.position()+lt),(t||new Zl).__init(e.readInt32(e.position())+e.position(),e)}static startList(e){e.startObject(0)}static endList(e){return e.endObject()}static createList(e){return Zl.startList(e),Zl.endList(e)}},Eh=class ia{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsMap(e,t){return(t||new ia).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsMap(e,t){return e.setPosition(e.position()+lt),(t||new ia).__init(e.readInt32(e.position())+e.position(),e)}keysSorted(){const e=this.bb.__offset(this.bb_pos,4);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startMap(e){e.startObject(1)}static addKeysSorted(e,t){e.addFieldInt8(0,+t,0)}static endMap(e){return e.endObject()}static createMap(e,t){return ia.startMap(e),ia.addKeysSorted(e,t),ia.endMap(e)}},p0=class Ql{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsNull(e,t){return(t||new Ql).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsNull(e,t){return e.setPosition(e.position()+lt),(t||new Ql).__init(e.readInt32(e.position())+e.position(),e)}static startNull(e){e.startObject(0)}static endNull(e){return e.endObject()}static createNull(e){return Ql.startNull(e),Ql.endNull(e)}};class ns{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsStruct_(e,t){return(t||new ns).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsStruct_(e,t){return e.setPosition(e.position()+lt),(t||new ns).__init(e.readInt32(e.position())+e.position(),e)}static startStruct_(e){e.startObject(0)}static endStruct_(e){return e.endObject()}static createStruct_(e){return ns.startStruct_(e),ns.endStruct_(e)}}class bn{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsTime(e,t){return(t||new bn).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTime(e,t){return e.setPosition(e.position()+lt),(t||new bn).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):pe.MILLISECOND}bitWidth(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):32}static startTime(e){e.startObject(2)}static addUnit(e,t){e.addFieldInt16(0,t,pe.MILLISECOND)}static addBitWidth(e,t){e.addFieldInt32(1,t,32)}static endTime(e){return e.endObject()}static createTime(e,t,n){return bn.startTime(e),bn.addUnit(e,t),bn.addBitWidth(e,n),bn.endTime(e)}}class vn{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsTimestamp(e,t){return(t||new vn).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTimestamp(e,t){return e.setPosition(e.position()+lt),(t||new vn).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):pe.SECOND}timezone(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}static startTimestamp(e){e.startObject(2)}static addUnit(e,t){e.addFieldInt16(0,t,pe.SECOND)}static addTimezone(e,t){e.addFieldOffset(1,t,0)}static endTimestamp(e){return e.endObject()}static createTimestamp(e,t,n){return vn.startTimestamp(e),vn.addUnit(e,t),vn.addTimezone(e,n),vn.endTimestamp(e)}}class Ui{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsUnion(e,t){return(t||new Ui).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsUnion(e,t){return e.setPosition(e.position()+lt),(t||new Ui).__init(e.readInt32(e.position())+e.position(),e)}mode(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):vi.Sparse}typeIds(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb.__vector(this.bb_pos+t)+e*4):0}typeIdsLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}typeIdsArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}static startUnion(e){e.startObject(2)}static addMode(e,t){e.addFieldInt16(0,t,vi.Sparse)}static addTypeIds(e,t){e.addFieldOffset(1,t,0)}static createTypeIdsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addInt32(t[n]);return e.endVector()}static startTypeIdsVector(e,t){e.startVector(4,t,4)}static endUnion(e){return e.endObject()}static createUnion(e,t,n){return Ui.startUnion(e),Ui.addMode(e,t),Ui.addTypeIds(e,n),Ui.endUnion(e)}}let m0=class Jl{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsUtf8(e,t){return(t||new Jl).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsUtf8(e,t){return e.setPosition(e.position()+lt),(t||new Jl).__init(e.readInt32(e.position())+e.position(),e)}static startUtf8(e){e.startObject(0)}static endUtf8(e){return e.endObject()}static createUtf8(e){return Jl.startUtf8(e),Jl.endUtf8(e)}};var wt;(function(i){i[i.NONE=0]="NONE",i[i.Null=1]="Null",i[i.Int=2]="Int",i[i.FloatingPoint=3]="FloatingPoint",i[i.Binary=4]="Binary",i[i.Utf8=5]="Utf8",i[i.Bool=6]="Bool",i[i.Decimal=7]="Decimal",i[i.Date=8]="Date",i[i.Time=9]="Time",i[i.Timestamp=10]="Timestamp",i[i.Interval=11]="Interval",i[i.List=12]="List",i[i.Struct_=13]="Struct_",i[i.Union=14]="Union",i[i.FixedSizeBinary=15]="FixedSizeBinary",i[i.FixedSizeList=16]="FixedSizeList",i[i.Map=17]="Map",i[i.Duration=18]="Duration",i[i.LargeBinary=19]="LargeBinary",i[i.LargeUtf8=20]="LargeUtf8",i[i.LargeList=21]="LargeList",i[i.RunEndEncoded=22]="RunEndEncoded"})(wt||(wt={}));let gn=class Ch{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsField(e,t){return(t||new Ch).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsField(e,t){return e.setPosition(e.position()+lt),(t||new Ch).__init(e.readInt32(e.position())+e.position(),e)}name(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}nullable(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}typeType(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):wt.NONE}type(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__union(e,this.bb_pos+t):null}dictionary(e){const t=this.bb.__offset(this.bb_pos,12);return t?(e||new Qr).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}children(e,t){const n=this.bb.__offset(this.bb_pos,14);return n?(t||new Ch).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+e*4),this.bb):null}childrenLength(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,t){const n=this.bb.__offset(this.bb_pos,16);return n?(t||new Xt).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.__vector_len(this.bb_pos+e):0}static startField(e){e.startObject(7)}static addName(e,t){e.addFieldOffset(0,t,0)}static addNullable(e,t){e.addFieldInt8(1,+t,0)}static addTypeType(e,t){e.addFieldInt8(2,t,wt.NONE)}static addType(e,t){e.addFieldOffset(3,t,0)}static addDictionary(e,t){e.addFieldOffset(4,t,0)}static addChildren(e,t){e.addFieldOffset(5,t,0)}static createChildrenVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startChildrenVector(e,t){e.startVector(4,t,4)}static addCustomMetadata(e,t){e.addFieldOffset(6,t,0)}static createCustomMetadataVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startCustomMetadataVector(e,t){e.startVector(4,t,4)}static endField(e){return e.endObject()}},sr=class Vr{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSchema(e,t){return(t||new Vr).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSchema(e,t){return e.setPosition(e.position()+lt),(t||new Vr).__init(e.readInt32(e.position())+e.position(),e)}endianness(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Da.Little}fields(e,t){const n=this.bb.__offset(this.bb_pos,6);return n?(t||new gn).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+e*4),this.bb):null}fieldsLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,t){const n=this.bb.__offset(this.bb_pos,8);return n?(t||new Xt).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}features(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt64(this.bb.__vector(this.bb_pos+t)+e*8):BigInt(0)}featuresLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}static startSchema(e){e.startObject(4)}static addEndianness(e,t){e.addFieldInt16(0,t,Da.Little)}static addFields(e,t){e.addFieldOffset(1,t,0)}static createFieldsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startFieldsVector(e,t){e.startVector(4,t,4)}static addCustomMetadata(e,t){e.addFieldOffset(2,t,0)}static createCustomMetadataVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startCustomMetadataVector(e,t){e.startVector(4,t,4)}static addFeatures(e,t){e.addFieldOffset(3,t,0)}static createFeaturesVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addInt64(t[n]);return e.endVector()}static startFeaturesVector(e,t){e.startVector(8,t,8)}static endSchema(e){return e.endObject()}static finishSchemaBuffer(e,t){e.finish(t)}static finishSizePrefixedSchemaBuffer(e,t){e.finish(t,void 0,!0)}static createSchema(e,t,n,r,o){return Vr.startSchema(e),Vr.addEndianness(e,t),Vr.addFields(e,n),Vr.addCustomMetadata(e,r),Vr.addFeatures(e,o),Vr.endSchema(e)}};var et;(function(i){i[i.NONE=0]="NONE",i[i.Schema=1]="Schema",i[i.DictionaryBatch=2]="DictionaryBatch",i[i.RecordBatch=3]="RecordBatch",i[i.Tensor=4]="Tensor",i[i.SparseTensor=5]="SparseTensor"})(et||(et={}));var S;(function(i){i[i.NONE=0]="NONE",i[i.Null=1]="Null",i[i.Int=2]="Int",i[i.Float=3]="Float",i[i.Binary=4]="Binary",i[i.Utf8=5]="Utf8",i[i.Bool=6]="Bool",i[i.Decimal=7]="Decimal",i[i.Date=8]="Date",i[i.Time=9]="Time",i[i.Timestamp=10]="Timestamp",i[i.Interval=11]="Interval",i[i.List=12]="List",i[i.Struct=13]="Struct",i[i.Union=14]="Union",i[i.FixedSizeBinary=15]="FixedSizeBinary",i[i.FixedSizeList=16]="FixedSizeList",i[i.Map=17]="Map",i[i.Duration=18]="Duration",i[i.LargeBinary=19]="LargeBinary",i[i.LargeUtf8=20]="LargeUtf8",i[i.Dictionary=-1]="Dictionary",i[i.Int8=-2]="Int8",i[i.Int16=-3]="Int16",i[i.Int32=-4]="Int32",i[i.Int64=-5]="Int64",i[i.Uint8=-6]="Uint8",i[i.Uint16=-7]="Uint16",i[i.Uint32=-8]="Uint32",i[i.Uint64=-9]="Uint64",i[i.Float16=-10]="Float16",i[i.Float32=-11]="Float32",i[i.Float64=-12]="Float64",i[i.DateDay=-13]="DateDay",i[i.DateMillisecond=-14]="DateMillisecond",i[i.TimestampSecond=-15]="TimestampSecond",i[i.TimestampMillisecond=-16]="TimestampMillisecond",i[i.TimestampMicrosecond=-17]="TimestampMicrosecond",i[i.TimestampNanosecond=-18]="TimestampNanosecond",i[i.TimeSecond=-19]="TimeSecond",i[i.TimeMillisecond=-20]="TimeMillisecond",i[i.TimeMicrosecond=-21]="TimeMicrosecond",i[i.TimeNanosecond=-22]="TimeNanosecond",i[i.DenseUnion=-23]="DenseUnion",i[i.SparseUnion=-24]="SparseUnion",i[i.IntervalDayTime=-25]="IntervalDayTime",i[i.IntervalYearMonth=-26]="IntervalYearMonth",i[i.DurationSecond=-27]="DurationSecond",i[i.DurationMillisecond=-28]="DurationMillisecond",i[i.DurationMicrosecond=-29]="DurationMicrosecond",i[i.DurationNanosecond=-30]="DurationNanosecond"})(S||(S={}));var Wr;(function(i){i[i.OFFSET=0]="OFFSET",i[i.DATA=1]="DATA",i[i.VALIDITY=2]="VALIDITY",i[i.TYPE=3]="TYPE"})(Wr||(Wr={}));const t6=void 0;function ms(i){if(i===null)return"null";if(i===t6)return"undefined";switch(typeof i){case"number":return`${i}`;case"bigint":return`${i}`;case"string":return`"${i}"`}return typeof i[Symbol.toPrimitive]=="function"?i[Symbol.toPrimitive]("string"):ArrayBuffer.isView(i)?i instanceof BigInt64Array||i instanceof BigUint64Array?`[${[...i].map(e=>ms(e))}]`:`[${i}]`:ArrayBuffer.isView(i)?`[${i}]`:JSON.stringify(i,(e,t)=>typeof t=="bigint"?`${t}`:t)}function bt(i){if(typeof i=="bigint"&&(i<Number.MIN_SAFE_INTEGER||i>Number.MAX_SAFE_INTEGER))throw new TypeError(`${i} is not safe to convert to a number.`);return Number(i)}function X2(i,e){return bt(i/e)+bt(i%e)/bt(e)}const i6=Symbol.for("isArrowBigNum");function Zn(i,...e){return e.length===0?Object.setPrototypeOf(dt(this.TypedArray,i),this.constructor.prototype):Object.setPrototypeOf(new this.TypedArray(i,...e),this.constructor.prototype)}Zn.prototype[i6]=!0;Zn.prototype.toJSON=function(){return`"${Ac(this)}"`};Zn.prototype.valueOf=function(i){return K2(this,i)};Zn.prototype.toString=function(){return Ac(this)};Zn.prototype[Symbol.toPrimitive]=function(i="default"){switch(i){case"number":return K2(this);case"string":return Ac(this);case"default":return o6(this)}return Ac(this)};function ga(...i){return Zn.apply(this,i)}function _a(...i){return Zn.apply(this,i)}function Tc(...i){return Zn.apply(this,i)}Object.setPrototypeOf(ga.prototype,Object.create(Int32Array.prototype));Object.setPrototypeOf(_a.prototype,Object.create(Uint32Array.prototype));Object.setPrototypeOf(Tc.prototype,Object.create(Uint32Array.prototype));Object.assign(ga.prototype,Zn.prototype,{constructor:ga,signed:!0,TypedArray:Int32Array,BigIntArray:BigInt64Array});Object.assign(_a.prototype,Zn.prototype,{constructor:_a,signed:!1,TypedArray:Uint32Array,BigIntArray:BigUint64Array});Object.assign(Tc.prototype,Zn.prototype,{constructor:Tc,signed:!0,TypedArray:Uint32Array,BigIntArray:BigUint64Array});const n6=BigInt(4294967296)*BigInt(4294967296),r6=n6-BigInt(1);function K2(i,e){const{buffer:t,byteOffset:n,byteLength:r,signed:o}=i,s=new BigUint64Array(t,n,r/8),a=o&&s.at(-1)&BigInt(1)<<BigInt(63);let l=BigInt(0),c=0;if(a){for(const u of s)l|=(u^r6)*(BigInt(1)<<BigInt(64*c++));l*=BigInt(-1),l-=BigInt(1)}else for(const u of s)l|=u*(BigInt(1)<<BigInt(64*c++));if(typeof e=="number"){const u=BigInt(Math.pow(10,e)),h=l/u,d=l%u;return bt(h)+bt(d)/bt(u)}return bt(l)}function Ac(i){if(i.byteLength===8)return`${new i.BigIntArray(i.buffer,i.byteOffset,1)[0]}`;if(!i.signed)return yp(i);let e=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2);if(new Int16Array([e.at(-1)])[0]>=0)return yp(i);e=e.slice();let n=1;for(let o=0;o<e.length;o++){const s=e[o],a=~s+n;e[o]=a,n&=s===0?1:0}return`-${yp(e)}`}function o6(i){return i.byteLength===8?new i.BigIntArray(i.buffer,i.byteOffset,1)[0]:Ac(i)}function yp(i){let e="";const t=new Uint32Array(2);let n=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2);const r=new Uint32Array((n=new Uint16Array(n).reverse()).buffer);let o=-1;const s=n.length-1;do{for(t[0]=n[o=0];o<s;)n[o++]=t[1]=t[0]/10,t[0]=(t[0]-t[1]*10<<16)+n[o];n[o]=t[1]=t[0]/10,t[0]=t[0]-t[1]*10,e=`${t[0]}${e}`}while(r[0]||r[1]||r[2]||r[3]);return e??"0"}class J_{static new(e,t){switch(t){case!0:return new ga(e);case!1:return new _a(e)}switch(e.constructor){case Int8Array:case Int16Array:case Int32Array:case BigInt64Array:return new ga(e)}return e.byteLength===16?new Tc(e):new _a(e)}static signed(e){return new ga(e)}static unsigned(e){return new _a(e)}static decimal(e){return new Tc(e)}constructor(e,t){return J_.new(e,t)}}var Z2,Q2,J2,eE,tE,iE,nE,rE,oE,sE,aE,lE,cE,uE,hE,dE,fE,pE,mE,gE,_E,yE;class ce{static isNull(e){return(e==null?void 0:e.typeId)===S.Null}static isInt(e){return(e==null?void 0:e.typeId)===S.Int}static isFloat(e){return(e==null?void 0:e.typeId)===S.Float}static isBinary(e){return(e==null?void 0:e.typeId)===S.Binary}static isLargeBinary(e){return(e==null?void 0:e.typeId)===S.LargeBinary}static isUtf8(e){return(e==null?void 0:e.typeId)===S.Utf8}static isLargeUtf8(e){return(e==null?void 0:e.typeId)===S.LargeUtf8}static isBool(e){return(e==null?void 0:e.typeId)===S.Bool}static isDecimal(e){return(e==null?void 0:e.typeId)===S.Decimal}static isDate(e){return(e==null?void 0:e.typeId)===S.Date}static isTime(e){return(e==null?void 0:e.typeId)===S.Time}static isTimestamp(e){return(e==null?void 0:e.typeId)===S.Timestamp}static isInterval(e){return(e==null?void 0:e.typeId)===S.Interval}static isDuration(e){return(e==null?void 0:e.typeId)===S.Duration}static isList(e){return(e==null?void 0:e.typeId)===S.List}static isStruct(e){return(e==null?void 0:e.typeId)===S.Struct}static isUnion(e){return(e==null?void 0:e.typeId)===S.Union}static isFixedSizeBinary(e){return(e==null?void 0:e.typeId)===S.FixedSizeBinary}static isFixedSizeList(e){return(e==null?void 0:e.typeId)===S.FixedSizeList}static isMap(e){return(e==null?void 0:e.typeId)===S.Map}static isDictionary(e){return(e==null?void 0:e.typeId)===S.Dictionary}static isDenseUnion(e){return ce.isUnion(e)&&e.mode===vi.Dense}static isSparseUnion(e){return ce.isUnion(e)&&e.mode===vi.Sparse}constructor(e){this.typeId=e}}Z2=Symbol.toStringTag;ce[Z2]=(i=>(i.children=null,i.ArrayType=Array,i.OffsetArrayType=Int32Array,i[Symbol.toStringTag]="DataType"))(ce.prototype);class oo extends ce{constructor(){super(S.Null)}toString(){return"Null"}}Q2=Symbol.toStringTag;oo[Q2]=(i=>i[Symbol.toStringTag]="Null")(oo.prototype);class Wi extends ce{constructor(e,t){super(S.Int),this.isSigned=e,this.bitWidth=t}get ArrayType(){switch(this.bitWidth){case 8:return this.isSigned?Int8Array:Uint8Array;case 16:return this.isSigned?Int16Array:Uint16Array;case 32:return this.isSigned?Int32Array:Uint32Array;case 64:return this.isSigned?BigInt64Array:BigUint64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}}J2=Symbol.toStringTag;Wi[J2]=(i=>(i.isSigned=null,i.bitWidth=null,i[Symbol.toStringTag]="Int"))(Wi.prototype);class bE extends Wi{constructor(){super(!0,8)}get ArrayType(){return Int8Array}}class vE extends Wi{constructor(){super(!0,16)}get ArrayType(){return Int16Array}}class gs extends Wi{constructor(){super(!0,32)}get ArrayType(){return Int32Array}}let ey=class extends Wi{constructor(){super(!0,64)}get ArrayType(){return BigInt64Array}};class xE extends Wi{constructor(){super(!1,8)}get ArrayType(){return Uint8Array}}class wE extends Wi{constructor(){super(!1,16)}get ArrayType(){return Uint16Array}}class SE extends Wi{constructor(){super(!1,32)}get ArrayType(){return Uint32Array}}let EE=class extends Wi{constructor(){super(!1,64)}get ArrayType(){return BigUint64Array}};Object.defineProperty(bE.prototype,"ArrayType",{value:Int8Array});Object.defineProperty(vE.prototype,"ArrayType",{value:Int16Array});Object.defineProperty(gs.prototype,"ArrayType",{value:Int32Array});Object.defineProperty(ey.prototype,"ArrayType",{value:BigInt64Array});Object.defineProperty(xE.prototype,"ArrayType",{value:Uint8Array});Object.defineProperty(wE.prototype,"ArrayType",{value:Uint16Array});Object.defineProperty(SE.prototype,"ArrayType",{value:Uint32Array});Object.defineProperty(EE.prototype,"ArrayType",{value:BigUint64Array});class Ma extends ce{constructor(e){super(S.Float),this.precision=e}get ArrayType(){switch(this.precision){case Jt.HALF:return Uint16Array;case Jt.SINGLE:return Float32Array;case Jt.DOUBLE:return Float64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`Float${this.precision<<5||16}`}}eE=Symbol.toStringTag;Ma[eE]=(i=>(i.precision=null,i[Symbol.toStringTag]="Float"))(Ma.prototype);class CE extends Ma{constructor(){super(Jt.SINGLE)}}class ty extends Ma{constructor(){super(Jt.DOUBLE)}}Object.defineProperty(CE.prototype,"ArrayType",{value:Float32Array});Object.defineProperty(ty.prototype,"ArrayType",{value:Float64Array});class fd extends ce{constructor(){super(S.Binary)}toString(){return"Binary"}}tE=Symbol.toStringTag;fd[tE]=(i=>(i.ArrayType=Uint8Array,i[Symbol.toStringTag]="Binary"))(fd.prototype);class pd extends ce{constructor(){super(S.LargeBinary)}toString(){return"LargeBinary"}}iE=Symbol.toStringTag;pd[iE]=(i=>(i.ArrayType=Uint8Array,i.OffsetArrayType=BigInt64Array,i[Symbol.toStringTag]="LargeBinary"))(pd.prototype);class Ic extends ce{constructor(){super(S.Utf8)}toString(){return"Utf8"}}nE=Symbol.toStringTag;Ic[nE]=(i=>(i.ArrayType=Uint8Array,i[Symbol.toStringTag]="Utf8"))(Ic.prototype);class md extends ce{constructor(){super(S.LargeUtf8)}toString(){return"LargeUtf8"}}rE=Symbol.toStringTag;md[rE]=(i=>(i.ArrayType=Uint8Array,i.OffsetArrayType=BigInt64Array,i[Symbol.toStringTag]="LargeUtf8"))(md.prototype);class kc extends ce{constructor(){super(S.Bool)}toString(){return"Bool"}}oE=Symbol.toStringTag;kc[oE]=(i=>(i.ArrayType=Uint8Array,i[Symbol.toStringTag]="Bool"))(kc.prototype);class gd extends ce{constructor(e,t,n=128){super(S.Decimal),this.scale=e,this.precision=t,this.bitWidth=n}toString(){return`Decimal[${this.precision}e${this.scale>0?"+":""}${this.scale}]`}}sE=Symbol.toStringTag;gd[sE]=(i=>(i.scale=null,i.precision=null,i.ArrayType=Uint32Array,i[Symbol.toStringTag]="Decimal"))(gd.prototype);class _d extends ce{constructor(e){super(S.Date),this.unit=e}toString(){return`Date${(this.unit+1)*32}<${In[this.unit]}>`}get ArrayType(){return this.unit===In.DAY?Int32Array:BigInt64Array}}aE=Symbol.toStringTag;_d[aE]=(i=>(i.unit=null,i[Symbol.toStringTag]="Date"))(_d.prototype);class yd extends ce{constructor(e,t){super(S.Time),this.unit=e,this.bitWidth=t}toString(){return`Time${this.bitWidth}<${pe[this.unit]}>`}get ArrayType(){switch(this.bitWidth){case 32:return Int32Array;case 64:return BigInt64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}}lE=Symbol.toStringTag;yd[lE]=(i=>(i.unit=null,i.bitWidth=null,i[Symbol.toStringTag]="Time"))(yd.prototype);class Lc extends ce{constructor(e,t){super(S.Timestamp),this.unit=e,this.timezone=t}toString(){return`Timestamp<${pe[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}}cE=Symbol.toStringTag;Lc[cE]=(i=>(i.unit=null,i.timezone=null,i.ArrayType=BigInt64Array,i[Symbol.toStringTag]="Timestamp"))(Lc.prototype);class s6 extends Lc{constructor(e){super(pe.MILLISECOND,e)}}class bd extends ce{constructor(e){super(S.Interval),this.unit=e}toString(){return`Interval<${Sr[this.unit]}>`}}uE=Symbol.toStringTag;bd[uE]=(i=>(i.unit=null,i.ArrayType=Int32Array,i[Symbol.toStringTag]="Interval"))(bd.prototype);class vd extends ce{constructor(e){super(S.Duration),this.unit=e}toString(){return`Duration<${pe[this.unit]}>`}}hE=Symbol.toStringTag;vd[hE]=(i=>(i.unit=null,i.ArrayType=BigInt64Array,i[Symbol.toStringTag]="Duration"))(vd.prototype);class Na extends ce{constructor(e){super(S.List),this.children=[e]}toString(){return`List<${this.valueType}>`}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}}dE=Symbol.toStringTag;Na[dE]=(i=>(i.children=null,i[Symbol.toStringTag]="List"))(Na.prototype);class ri extends ce{constructor(e){super(S.Struct),this.children=e}toString(){return`Struct<{${this.children.map(e=>`${e.name}:${e.type}`).join(", ")}}>`}}fE=Symbol.toStringTag;ri[fE]=(i=>(i.children=null,i[Symbol.toStringTag]="Struct"))(ri.prototype);class Rc extends ce{constructor(e,t,n){super(S.Union),this.mode=e,this.children=n,this.typeIds=t=Int32Array.from(t),this.typeIdToChildIndex=t.reduce((r,o,s)=>(r[o]=s)&&r||r,Object.create(null))}toString(){return`${this[Symbol.toStringTag]}<${this.children.map(e=>`${e.type}`).join(" | ")}>`}}pE=Symbol.toStringTag;Rc[pE]=(i=>(i.mode=null,i.typeIds=null,i.children=null,i.typeIdToChildIndex=null,i.ArrayType=Int8Array,i[Symbol.toStringTag]="Union"))(Rc.prototype);class xd extends ce{constructor(e){super(S.FixedSizeBinary),this.byteWidth=e}toString(){return`FixedSizeBinary[${this.byteWidth}]`}}mE=Symbol.toStringTag;xd[mE]=(i=>(i.byteWidth=null,i.ArrayType=Uint8Array,i[Symbol.toStringTag]="FixedSizeBinary"))(xd.prototype);class Pc extends ce{constructor(e,t){super(S.FixedSizeList),this.listSize=e,this.children=[t]}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}}gE=Symbol.toStringTag;Pc[gE]=(i=>(i.children=null,i.listSize=null,i[Symbol.toStringTag]="FixedSizeList"))(Pc.prototype);class Dc extends ce{constructor(e,t=!1){var n,r,o;if(super(S.Map),this.children=[e],this.keysSorted=t,e&&(e.name="entries",!((n=e==null?void 0:e.type)===null||n===void 0)&&n.children)){const s=(r=e==null?void 0:e.type)===null||r===void 0?void 0:r.children[0];s&&(s.name="key");const a=(o=e==null?void 0:e.type)===null||o===void 0?void 0:o.children[1];a&&(a.name="value")}}get keyType(){return this.children[0].type.children[0].type}get valueType(){return this.children[0].type.children[1].type}get childType(){return this.children[0].type}toString(){return`Map<{${this.children[0].type.children.map(e=>`${e.name}:${e.type}`).join(", ")}}>`}}_E=Symbol.toStringTag;Dc[_E]=(i=>(i.children=null,i.keysSorted=null,i[Symbol.toStringTag]="Map_"))(Dc.prototype);const a6=(i=>()=>++i)(-1);class Uo extends ce{constructor(e,t,n,r){super(S.Dictionary),this.indices=t,this.dictionary=e,this.isOrdered=r||!1,this.id=n==null?a6():bt(n)}get children(){return this.dictionary.children}get valueType(){return this.dictionary}get ArrayType(){return this.dictionary.ArrayType}toString(){return`Dictionary<${this.indices}, ${this.dictionary}>`}}yE=Symbol.toStringTag;Uo[yE]=(i=>(i.id=null,i.indices=null,i.isOrdered=null,i.dictionary=null,i[Symbol.toStringTag]="Dictionary"))(Uo.prototype);function cr(i){const e=i;switch(i.typeId){case S.Decimal:return i.bitWidth/32;case S.Interval:return 1+e.unit;case S.FixedSizeList:return e.listSize;case S.FixedSizeBinary:return e.byteWidth;default:return 1}}class Be{visitMany(e,...t){return e.map((n,r)=>this.visit(n,...t.map(o=>o[r])))}visit(...e){return this.getVisitFn(e[0],!1).apply(this,e)}getVisitFn(e,t=!0){return l6(this,e,t)}getVisitFnByTypeId(e,t=!0){return na(this,e,t)}visitNull(e,...t){return null}visitBool(e,...t){return null}visitInt(e,...t){return null}visitFloat(e,...t){return null}visitUtf8(e,...t){return null}visitLargeUtf8(e,...t){return null}visitBinary(e,...t){return null}visitLargeBinary(e,...t){return null}visitFixedSizeBinary(e,...t){return null}visitDate(e,...t){return null}visitTimestamp(e,...t){return null}visitTime(e,...t){return null}visitDecimal(e,...t){return null}visitList(e,...t){return null}visitStruct(e,...t){return null}visitUnion(e,...t){return null}visitDictionary(e,...t){return null}visitInterval(e,...t){return null}visitDuration(e,...t){return null}visitFixedSizeList(e,...t){return null}visitMap(e,...t){return null}}function l6(i,e,t=!0){return typeof e=="number"?na(i,e,t):typeof e=="string"&&e in S?na(i,S[e],t):e&&e instanceof ce?na(i,g0(e),t):e!=null&&e.type&&e.type instanceof ce?na(i,g0(e.type),t):na(i,S.NONE,t)}function na(i,e,t=!0){let n=null;switch(e){case S.Null:n=i.visitNull;break;case S.Bool:n=i.visitBool;break;case S.Int:n=i.visitInt;break;case S.Int8:n=i.visitInt8||i.visitInt;break;case S.Int16:n=i.visitInt16||i.visitInt;break;case S.Int32:n=i.visitInt32||i.visitInt;break;case S.Int64:n=i.visitInt64||i.visitInt;break;case S.Uint8:n=i.visitUint8||i.visitInt;break;case S.Uint16:n=i.visitUint16||i.visitInt;break;case S.Uint32:n=i.visitUint32||i.visitInt;break;case S.Uint64:n=i.visitUint64||i.visitInt;break;case S.Float:n=i.visitFloat;break;case S.Float16:n=i.visitFloat16||i.visitFloat;break;case S.Float32:n=i.visitFloat32||i.visitFloat;break;case S.Float64:n=i.visitFloat64||i.visitFloat;break;case S.Utf8:n=i.visitUtf8;break;case S.LargeUtf8:n=i.visitLargeUtf8;break;case S.Binary:n=i.visitBinary;break;case S.LargeBinary:n=i.visitLargeBinary;break;case S.FixedSizeBinary:n=i.visitFixedSizeBinary;break;case S.Date:n=i.visitDate;break;case S.DateDay:n=i.visitDateDay||i.visitDate;break;case S.DateMillisecond:n=i.visitDateMillisecond||i.visitDate;break;case S.Timestamp:n=i.visitTimestamp;break;case S.TimestampSecond:n=i.visitTimestampSecond||i.visitTimestamp;break;case S.TimestampMillisecond:n=i.visitTimestampMillisecond||i.visitTimestamp;break;case S.TimestampMicrosecond:n=i.visitTimestampMicrosecond||i.visitTimestamp;break;case S.TimestampNanosecond:n=i.visitTimestampNanosecond||i.visitTimestamp;break;case S.Time:n=i.visitTime;break;case S.TimeSecond:n=i.visitTimeSecond||i.visitTime;break;case S.TimeMillisecond:n=i.visitTimeMillisecond||i.visitTime;break;case S.TimeMicrosecond:n=i.visitTimeMicrosecond||i.visitTime;break;case S.TimeNanosecond:n=i.visitTimeNanosecond||i.visitTime;break;case S.Decimal:n=i.visitDecimal;break;case S.List:n=i.visitList;break;case S.Struct:n=i.visitStruct;break;case S.Union:n=i.visitUnion;break;case S.DenseUnion:n=i.visitDenseUnion||i.visitUnion;break;case S.SparseUnion:n=i.visitSparseUnion||i.visitUnion;break;case S.Dictionary:n=i.visitDictionary;break;case S.Interval:n=i.visitInterval;break;case S.IntervalDayTime:n=i.visitIntervalDayTime||i.visitInterval;break;case S.IntervalYearMonth:n=i.visitIntervalYearMonth||i.visitInterval;break;case S.Duration:n=i.visitDuration;break;case S.DurationSecond:n=i.visitDurationSecond||i.visitDuration;break;case S.DurationMillisecond:n=i.visitDurationMillisecond||i.visitDuration;break;case S.DurationMicrosecond:n=i.visitDurationMicrosecond||i.visitDuration;break;case S.DurationNanosecond:n=i.visitDurationNanosecond||i.visitDuration;break;case S.FixedSizeList:n=i.visitFixedSizeList;break;case S.Map:n=i.visitMap;break}if(typeof n=="function")return n;if(!t)return()=>null;throw new Error(`Unrecognized type '${S[e]}'`)}function g0(i){switch(i.typeId){case S.Null:return S.Null;case S.Int:{const{bitWidth:e,isSigned:t}=i;switch(e){case 8:return t?S.Int8:S.Uint8;case 16:return t?S.Int16:S.Uint16;case 32:return t?S.Int32:S.Uint32;case 64:return t?S.Int64:S.Uint64}return S.Int}case S.Float:switch(i.precision){case Jt.HALF:return S.Float16;case Jt.SINGLE:return S.Float32;case Jt.DOUBLE:return S.Float64}return S.Float;case S.Binary:return S.Binary;case S.LargeBinary:return S.LargeBinary;case S.Utf8:return S.Utf8;case S.LargeUtf8:return S.LargeUtf8;case S.Bool:return S.Bool;case S.Decimal:return S.Decimal;case S.Time:switch(i.unit){case pe.SECOND:return S.TimeSecond;case pe.MILLISECOND:return S.TimeMillisecond;case pe.MICROSECOND:return S.TimeMicrosecond;case pe.NANOSECOND:return S.TimeNanosecond}return S.Time;case S.Timestamp:switch(i.unit){case pe.SECOND:return S.TimestampSecond;case pe.MILLISECOND:return S.TimestampMillisecond;case pe.MICROSECOND:return S.TimestampMicrosecond;case pe.NANOSECOND:return S.TimestampNanosecond}return S.Timestamp;case S.Date:switch(i.unit){case In.DAY:return S.DateDay;case In.MILLISECOND:return S.DateMillisecond}return S.Date;case S.Interval:switch(i.unit){case Sr.DAY_TIME:return S.IntervalDayTime;case Sr.YEAR_MONTH:return S.IntervalYearMonth}return S.Interval;case S.Duration:switch(i.unit){case pe.SECOND:return S.DurationSecond;case pe.MILLISECOND:return S.DurationMillisecond;case pe.MICROSECOND:return S.DurationMicrosecond;case pe.NANOSECOND:return S.DurationNanosecond}return S.Duration;case S.Map:return S.Map;case S.List:return S.List;case S.Struct:return S.Struct;case S.Union:switch(i.mode){case vi.Dense:return S.DenseUnion;case vi.Sparse:return S.SparseUnion}return S.Union;case S.FixedSizeBinary:return S.FixedSizeBinary;case S.FixedSizeList:return S.FixedSizeList;case S.Dictionary:return S.Dictionary}throw new Error(`Unrecognized type '${S[i.typeId]}'`)}Be.prototype.visitInt8=null;Be.prototype.visitInt16=null;Be.prototype.visitInt32=null;Be.prototype.visitInt64=null;Be.prototype.visitUint8=null;Be.prototype.visitUint16=null;Be.prototype.visitUint32=null;Be.prototype.visitUint64=null;Be.prototype.visitFloat16=null;Be.prototype.visitFloat32=null;Be.prototype.visitFloat64=null;Be.prototype.visitDateDay=null;Be.prototype.visitDateMillisecond=null;Be.prototype.visitTimestampSecond=null;Be.prototype.visitTimestampMillisecond=null;Be.prototype.visitTimestampMicrosecond=null;Be.prototype.visitTimestampNanosecond=null;Be.prototype.visitTimeSecond=null;Be.prototype.visitTimeMillisecond=null;Be.prototype.visitTimeMicrosecond=null;Be.prototype.visitTimeNanosecond=null;Be.prototype.visitDenseUnion=null;Be.prototype.visitSparseUnion=null;Be.prototype.visitIntervalDayTime=null;Be.prototype.visitIntervalYearMonth=null;Be.prototype.visitDuration=null;Be.prototype.visitDurationSecond=null;Be.prototype.visitDurationMillisecond=null;Be.prototype.visitDurationMicrosecond=null;Be.prototype.visitDurationNanosecond=null;const TE=new Float64Array(1),Us=new Uint32Array(TE.buffer);function AE(i){const e=(i&31744)>>10,t=(i&1023)/1024,n=Math.pow(-1,(i&32768)>>15);switch(e){case 31:return n*(t?Number.NaN:1/0);case 0:return n*(t?6103515625e-14*t:0)}return n*Math.pow(2,e-15)*(1+t)}function IE(i){if(i!==i)return 32256;TE[0]=i;const e=(Us[1]&2147483648)>>16&65535;let t=Us[1]&2146435072,n=0;return t>=1089470464?Us[0]>0?t=31744:(t=(t&2080374784)>>16,n=(Us[1]&1048575)>>10):t<=1056964608?(n=1048576+(Us[1]&1048575),n=1048576+(n<<(t>>20)-998)>>21,t=0):(t=t-1056964608>>10,n=(Us[1]&1048575)+512>>10),e|t|n&65535}class ve extends Be{}function Ee(i){return(e,t,n)=>{if(e.setValid(t,n!=null))return i(e,t,n)}}const c6=(i,e,t)=>{i[e]=Math.floor(t/864e5)},kE=(i,e,t,n)=>{if(t+1<e.length){const r=bt(e[t]),o=bt(e[t+1]);i.set(n.subarray(0,o-r),r)}},u6=({offset:i,values:e},t,n)=>{const r=i+t;n?e[r>>3]|=1<<r%8:e[r>>3]&=~(1<<r%8)},fo=({values:i},e,t)=>{i[e]=t},iy=({values:i},e,t)=>{i[e]=t},LE=({values:i},e,t)=>{i[e]=IE(t)},h6=(i,e,t)=>{switch(i.type.precision){case Jt.HALF:return LE(i,e,t);case Jt.SINGLE:case Jt.DOUBLE:return iy(i,e,t)}},ny=({values:i},e,t)=>{c6(i,e,t.valueOf())},ry=({values:i},e,t)=>{i[e]=BigInt(t)},RE=({stride:i,values:e},t,n)=>{e.set(n.subarray(0,i),i*t)},PE=({values:i,valueOffsets:e},t,n)=>kE(i,e,t,n),DE=({values:i,valueOffsets:e},t,n)=>kE(i,e,t,Jc(n)),ME=(i,e,t)=>{i.type.unit===In.DAY?ny(i,e,t):ry(i,e,t)},oy=({values:i},e,t)=>{i[e]=BigInt(t/1e3)},sy=({values:i},e,t)=>{i[e]=BigInt(t)},ay=({values:i},e,t)=>{i[e]=BigInt(t*1e3)},ly=({values:i},e,t)=>{i[e]=BigInt(t*1e6)},NE=(i,e,t)=>{switch(i.type.unit){case pe.SECOND:return oy(i,e,t);case pe.MILLISECOND:return sy(i,e,t);case pe.MICROSECOND:return ay(i,e,t);case pe.NANOSECOND:return ly(i,e,t)}},cy=({values:i},e,t)=>{i[e]=t},uy=({values:i},e,t)=>{i[e]=t},hy=({values:i},e,t)=>{i[e]=t},dy=({values:i},e,t)=>{i[e]=t},BE=(i,e,t)=>{switch(i.type.unit){case pe.SECOND:return cy(i,e,t);case pe.MILLISECOND:return uy(i,e,t);case pe.MICROSECOND:return hy(i,e,t);case pe.NANOSECOND:return dy(i,e,t)}},OE=({values:i,stride:e},t,n)=>{i.set(n.subarray(0,e),e*t)},d6=(i,e,t)=>{const n=i.children[0],r=i.valueOffsets,o=kn.getVisitFn(n);if(Array.isArray(t))for(let s=-1,a=r[e],l=r[e+1];a<l;)o(n,a++,t[++s]);else for(let s=-1,a=r[e],l=r[e+1];a<l;)o(n,a++,t.get(++s))},f6=(i,e,t)=>{const n=i.children[0],{valueOffsets:r}=i,o=kn.getVisitFn(n);let{[e]:s,[e+1]:a}=r;const l=t instanceof Map?t.entries():Object.entries(t);for(const c of l)if(o(n,s,c),++s>=a)break},p6=(i,e)=>(t,n,r,o)=>n&&t(n,i,e[o]),m6=(i,e)=>(t,n,r,o)=>n&&t(n,i,e.get(o)),g6=(i,e)=>(t,n,r,o)=>n&&t(n,i,e.get(r.name)),_6=(i,e)=>(t,n,r,o)=>n&&t(n,i,e[r.name]),y6=(i,e,t)=>{const n=i.type.children.map(o=>kn.getVisitFn(o.type)),r=t instanceof Map?g6(e,t):t instanceof Ce?m6(e,t):Array.isArray(t)?p6(e,t):_6(e,t);i.type.children.forEach((o,s)=>r(n[s],i.children[s],o,s))},b6=(i,e,t)=>{i.type.mode===vi.Dense?FE(i,e,t):zE(i,e,t)},FE=(i,e,t)=>{const n=i.type.typeIdToChildIndex[i.typeIds[e]],r=i.children[n];kn.visit(r,i.valueOffsets[e],t)},zE=(i,e,t)=>{const n=i.type.typeIdToChildIndex[i.typeIds[e]],r=i.children[n];kn.visit(r,e,t)},v6=(i,e,t)=>{var n;(n=i.dictionary)===null||n===void 0||n.set(i.values[e],t)},UE=(i,e,t)=>{i.type.unit===Sr.DAY_TIME?fy(i,e,t):py(i,e,t)},fy=({values:i},e,t)=>{i.set(t.subarray(0,2),2*e)},py=({values:i},e,t)=>{i[e]=t[0]*12+t[1]%12},my=({values:i},e,t)=>{i[e]=t},gy=({values:i},e,t)=>{i[e]=t},_y=({values:i},e,t)=>{i[e]=t},yy=({values:i},e,t)=>{i[e]=t},$E=(i,e,t)=>{switch(i.type.unit){case pe.SECOND:return my(i,e,t);case pe.MILLISECOND:return gy(i,e,t);case pe.MICROSECOND:return _y(i,e,t);case pe.NANOSECOND:return yy(i,e,t)}},x6=(i,e,t)=>{const{stride:n}=i,r=i.children[0],o=kn.getVisitFn(r);if(Array.isArray(t))for(let s=-1,a=e*n;++s<n;)o(r,a+s,t[s]);else for(let s=-1,a=e*n;++s<n;)o(r,a+s,t.get(s))};ve.prototype.visitBool=Ee(u6);ve.prototype.visitInt=Ee(fo);ve.prototype.visitInt8=Ee(fo);ve.prototype.visitInt16=Ee(fo);ve.prototype.visitInt32=Ee(fo);ve.prototype.visitInt64=Ee(fo);ve.prototype.visitUint8=Ee(fo);ve.prototype.visitUint16=Ee(fo);ve.prototype.visitUint32=Ee(fo);ve.prototype.visitUint64=Ee(fo);ve.prototype.visitFloat=Ee(h6);ve.prototype.visitFloat16=Ee(LE);ve.prototype.visitFloat32=Ee(iy);ve.prototype.visitFloat64=Ee(iy);ve.prototype.visitUtf8=Ee(DE);ve.prototype.visitLargeUtf8=Ee(DE);ve.prototype.visitBinary=Ee(PE);ve.prototype.visitLargeBinary=Ee(PE);ve.prototype.visitFixedSizeBinary=Ee(RE);ve.prototype.visitDate=Ee(ME);ve.prototype.visitDateDay=Ee(ny);ve.prototype.visitDateMillisecond=Ee(ry);ve.prototype.visitTimestamp=Ee(NE);ve.prototype.visitTimestampSecond=Ee(oy);ve.prototype.visitTimestampMillisecond=Ee(sy);ve.prototype.visitTimestampMicrosecond=Ee(ay);ve.prototype.visitTimestampNanosecond=Ee(ly);ve.prototype.visitTime=Ee(BE);ve.prototype.visitTimeSecond=Ee(cy);ve.prototype.visitTimeMillisecond=Ee(uy);ve.prototype.visitTimeMicrosecond=Ee(hy);ve.prototype.visitTimeNanosecond=Ee(dy);ve.prototype.visitDecimal=Ee(OE);ve.prototype.visitList=Ee(d6);ve.prototype.visitStruct=Ee(y6);ve.prototype.visitUnion=Ee(b6);ve.prototype.visitDenseUnion=Ee(FE);ve.prototype.visitSparseUnion=Ee(zE);ve.prototype.visitDictionary=Ee(v6);ve.prototype.visitInterval=Ee(UE);ve.prototype.visitIntervalDayTime=Ee(fy);ve.prototype.visitIntervalYearMonth=Ee(py);ve.prototype.visitDuration=Ee($E);ve.prototype.visitDurationSecond=Ee(my);ve.prototype.visitDurationMillisecond=Ee(gy);ve.prototype.visitDurationMicrosecond=Ee(_y);ve.prototype.visitDurationNanosecond=Ee(yy);ve.prototype.visitFixedSizeList=Ee(x6);ve.prototype.visitMap=Ee(f6);const kn=new ve,zn=Symbol.for("parent"),ya=Symbol.for("rowIndex");class by{constructor(e,t){return this[zn]=e,this[ya]=t,new Proxy(this,new S6)}toArray(){return Object.values(this.toJSON())}toJSON(){const e=this[ya],t=this[zn],n=t.type.children,r={};for(let o=-1,s=n.length;++o<s;)r[n[o].name]=ji.visit(t.children[o],e);return r}toString(){return`{${[...this].map(([e,t])=>`${ms(e)}: ${ms(t)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}[Symbol.iterator](){return new w6(this[zn],this[ya])}}class w6{constructor(e,t){this.childIndex=0,this.children=e.children,this.rowIndex=t,this.childFields=e.type.children,this.numChildren=this.childFields.length}[Symbol.iterator](){return this}next(){const e=this.childIndex;return e<this.numChildren?(this.childIndex=e+1,{done:!1,value:[this.childFields[e].name,ji.visit(this.children[e],this.rowIndex)]}):{done:!0,value:null}}}Object.defineProperties(by.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[zn]:{writable:!0,enumerable:!1,configurable:!1,value:null},[ya]:{writable:!0,enumerable:!1,configurable:!1,value:-1}});class S6{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(e){return e[zn].type.children.map(t=>t.name)}has(e,t){return e[zn].type.children.findIndex(n=>n.name===t)!==-1}getOwnPropertyDescriptor(e,t){if(e[zn].type.children.findIndex(n=>n.name===t)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(e,t){if(Reflect.has(e,t))return e[t];const n=e[zn].type.children.findIndex(r=>r.name===t);if(n!==-1){const r=ji.visit(e[zn].children[n],e[ya]);return Reflect.set(e,t,r),r}}set(e,t,n){const r=e[zn].type.children.findIndex(o=>o.name===t);return r!==-1?(kn.visit(e[zn].children[r],e[ya],n),Reflect.set(e,t,n)):Reflect.has(e,t)||typeof t=="symbol"?Reflect.set(e,t,n):!1}}class me extends Be{}function xe(i){return(e,t)=>e.getValid(t)?i(e,t):null}const E6=(i,e)=>864e5*i[e],C6=(i,e)=>null,VE=(i,e,t)=>{if(t+1>=e.length)return null;const n=bt(e[t]),r=bt(e[t+1]);return i.subarray(n,r)},T6=({offset:i,values:e},t)=>{const n=i+t;return(e[n>>3]&1<<n%8)!==0},HE=({values:i},e)=>E6(i,e),GE=({values:i},e)=>bt(i[e]),jo=({stride:i,values:e},t)=>e[i*t],A6=({stride:i,values:e},t)=>AE(e[i*t]),WE=({values:i},e)=>i[e],I6=({stride:i,values:e},t)=>e.subarray(i*t,i*(t+1)),jE=({values:i,valueOffsets:e},t)=>VE(i,e,t),YE=({values:i,valueOffsets:e},t)=>{const n=VE(i,e,t);return n!==null?eg(n):null},k6=({values:i},e)=>i[e],L6=({type:i,values:e},t)=>i.precision!==Jt.HALF?e[t]:AE(e[t]),R6=(i,e)=>i.type.unit===In.DAY?HE(i,e):GE(i,e),qE=({values:i},e)=>1e3*bt(i[e]),XE=({values:i},e)=>bt(i[e]),KE=({values:i},e)=>X2(i[e],BigInt(1e3)),ZE=({values:i},e)=>X2(i[e],BigInt(1e6)),P6=(i,e)=>{switch(i.type.unit){case pe.SECOND:return qE(i,e);case pe.MILLISECOND:return XE(i,e);case pe.MICROSECOND:return KE(i,e);case pe.NANOSECOND:return ZE(i,e)}},QE=({values:i},e)=>i[e],JE=({values:i},e)=>i[e],e3=({values:i},e)=>i[e],t3=({values:i},e)=>i[e],D6=(i,e)=>{switch(i.type.unit){case pe.SECOND:return QE(i,e);case pe.MILLISECOND:return JE(i,e);case pe.MICROSECOND:return e3(i,e);case pe.NANOSECOND:return t3(i,e)}},M6=({values:i,stride:e},t)=>J_.decimal(i.subarray(e*t,e*(t+1))),N6=(i,e)=>{const{valueOffsets:t,stride:n,children:r}=i,{[e*n]:o,[e*n+1]:s}=t,l=r[0].slice(o,s-o);return new Ce([l])},B6=(i,e)=>{const{valueOffsets:t,children:n}=i,{[e]:r,[e+1]:o}=t,s=n[0];return new vf(s.slice(r,o-r))},O6=(i,e)=>new by(i,e),F6=(i,e)=>i.type.mode===vi.Dense?i3(i,e):n3(i,e),i3=(i,e)=>{const t=i.type.typeIdToChildIndex[i.typeIds[e]],n=i.children[t];return ji.visit(n,i.valueOffsets[e])},n3=(i,e)=>{const t=i.type.typeIdToChildIndex[i.typeIds[e]],n=i.children[t];return ji.visit(n,e)},z6=(i,e)=>{var t;return(t=i.dictionary)===null||t===void 0?void 0:t.get(i.values[e])},U6=(i,e)=>i.type.unit===Sr.DAY_TIME?r3(i,e):o3(i,e),r3=({values:i},e)=>i.subarray(2*e,2*(e+1)),o3=({values:i},e)=>{const t=i[e],n=new Int32Array(2);return n[0]=Math.trunc(t/12),n[1]=Math.trunc(t%12),n},s3=({values:i},e)=>i[e],a3=({values:i},e)=>i[e],l3=({values:i},e)=>i[e],c3=({values:i},e)=>i[e],$6=(i,e)=>{switch(i.type.unit){case pe.SECOND:return s3(i,e);case pe.MILLISECOND:return a3(i,e);case pe.MICROSECOND:return l3(i,e);case pe.NANOSECOND:return c3(i,e)}},V6=(i,e)=>{const{stride:t,children:n}=i,o=n[0].slice(e*t,t);return new Ce([o])};me.prototype.visitNull=xe(C6);me.prototype.visitBool=xe(T6);me.prototype.visitInt=xe(k6);me.prototype.visitInt8=xe(jo);me.prototype.visitInt16=xe(jo);me.prototype.visitInt32=xe(jo);me.prototype.visitInt64=xe(WE);me.prototype.visitUint8=xe(jo);me.prototype.visitUint16=xe(jo);me.prototype.visitUint32=xe(jo);me.prototype.visitUint64=xe(WE);me.prototype.visitFloat=xe(L6);me.prototype.visitFloat16=xe(A6);me.prototype.visitFloat32=xe(jo);me.prototype.visitFloat64=xe(jo);me.prototype.visitUtf8=xe(YE);me.prototype.visitLargeUtf8=xe(YE);me.prototype.visitBinary=xe(jE);me.prototype.visitLargeBinary=xe(jE);me.prototype.visitFixedSizeBinary=xe(I6);me.prototype.visitDate=xe(R6);me.prototype.visitDateDay=xe(HE);me.prototype.visitDateMillisecond=xe(GE);me.prototype.visitTimestamp=xe(P6);me.prototype.visitTimestampSecond=xe(qE);me.prototype.visitTimestampMillisecond=xe(XE);me.prototype.visitTimestampMicrosecond=xe(KE);me.prototype.visitTimestampNanosecond=xe(ZE);me.prototype.visitTime=xe(D6);me.prototype.visitTimeSecond=xe(QE);me.prototype.visitTimeMillisecond=xe(JE);me.prototype.visitTimeMicrosecond=xe(e3);me.prototype.visitTimeNanosecond=xe(t3);me.prototype.visitDecimal=xe(M6);me.prototype.visitList=xe(N6);me.prototype.visitStruct=xe(O6);me.prototype.visitUnion=xe(F6);me.prototype.visitDenseUnion=xe(i3);me.prototype.visitSparseUnion=xe(n3);me.prototype.visitDictionary=xe(z6);me.prototype.visitInterval=xe(U6);me.prototype.visitIntervalDayTime=xe(r3);me.prototype.visitIntervalYearMonth=xe(o3);me.prototype.visitDuration=xe($6);me.prototype.visitDurationSecond=xe(s3);me.prototype.visitDurationMillisecond=xe(a3);me.prototype.visitDurationMicrosecond=xe(l3);me.prototype.visitDurationNanosecond=xe(c3);me.prototype.visitFixedSizeList=xe(V6);me.prototype.visitMap=xe(B6);const ji=new me,es=Symbol.for("keys"),ba=Symbol.for("vals"),ra=Symbol.for("kKeysAsStrings"),ag=Symbol.for("_kKeysAsStrings");class vf{constructor(e){return this[es]=new Ce([e.children[0]]).memoize(),this[ba]=e.children[1],new Proxy(this,new G6)}get[ra](){return this[ag]||(this[ag]=Array.from(this[es].toArray(),String))}[Symbol.iterator](){return new H6(this[es],this[ba])}get size(){return this[es].length}toArray(){return Object.values(this.toJSON())}toJSON(){const e=this[es],t=this[ba],n={};for(let r=-1,o=e.length;++r<o;)n[e.get(r)]=ji.visit(t,r);return n}toString(){return`{${[...this].map(([e,t])=>`${ms(e)}: ${ms(t)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}}class H6{constructor(e,t){this.keys=e,this.vals=t,this.keyIndex=0,this.numKeys=e.length}[Symbol.iterator](){return this}next(){const e=this.keyIndex;return e===this.numKeys?{done:!0,value:null}:(this.keyIndex++,{done:!1,value:[this.keys.get(e),ji.visit(this.vals,e)]})}}class G6{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(e){return e[ra]}has(e,t){return e[ra].includes(t)}getOwnPropertyDescriptor(e,t){if(e[ra].indexOf(t)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(e,t){if(Reflect.has(e,t))return e[t];const n=e[ra].indexOf(t);if(n!==-1){const r=ji.visit(Reflect.get(e,ba),n);return Reflect.set(e,t,r),r}}set(e,t,n){const r=e[ra].indexOf(t);return r!==-1?(kn.visit(Reflect.get(e,ba),r,n),Reflect.set(e,t,n)):Reflect.has(e,t)?Reflect.set(e,t,n):!1}}Object.defineProperties(vf.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[es]:{writable:!0,enumerable:!1,configurable:!1,value:null},[ba]:{writable:!0,enumerable:!1,configurable:!1,value:null},[ag]:{writable:!0,enumerable:!1,configurable:!1,value:null}});let _0;function u3(i,e,t,n){const{length:r=0}=i;let o=typeof e!="number"?0:e,s=typeof t!="number"?r:t;return o<0&&(o=(o%r+r)%r),s<0&&(s=(s%r+r)%r),s<o&&(_0=o,o=s,s=_0),s>r&&(s=r),n?n(i,o,s):[o,s]}const vy=(i,e)=>i<0?e+i:i,y0=i=>i!==i;function Xa(i){if(typeof i!=="object"||i===null)return y0(i)?y0:t=>t===i;if(i instanceof Date){const t=i.valueOf();return n=>n instanceof Date?n.valueOf()===t:!1}return ArrayBuffer.isView(i)?t=>t?XF(i,t):!1:i instanceof Map?j6(i):Array.isArray(i)?W6(i):i instanceof Ce?Y6(i):q6(i,!0)}function W6(i){const e=[];for(let t=-1,n=i.length;++t<n;)e[t]=Xa(i[t]);return xf(e)}function j6(i){let e=-1;const t=[];for(const n of i.values())t[++e]=Xa(n);return xf(t)}function Y6(i){const e=[];for(let t=-1,n=i.length;++t<n;)e[t]=Xa(i.get(t));return xf(e)}function q6(i,e=!1){const t=Object.keys(i);if(!e&&t.length===0)return()=>!1;const n=[];for(let r=-1,o=t.length;++r<o;)n[r]=Xa(i[t[r]]);return xf(n,t)}function xf(i,e){return t=>{if(!t||typeof t!="object")return!1;switch(t.constructor){case Array:return X6(i,t);case Map:return b0(i,t,t.keys());case vf:case by:case Object:case void 0:return b0(i,t,e||Object.keys(t))}return t instanceof Ce?K6(i,t):!1}}function X6(i,e){const t=i.length;if(e.length!==t)return!1;for(let n=-1;++n<t;)if(!i[n](e[n]))return!1;return!0}function K6(i,e){const t=i.length;if(e.length!==t)return!1;for(let n=-1;++n<t;)if(!i[n](e.get(n)))return!1;return!0}function b0(i,e,t){const n=t[Symbol.iterator](),r=e instanceof Map?e.keys():Object.keys(e)[Symbol.iterator](),o=e instanceof Map?e.values():Object.values(e)[Symbol.iterator]();let s=0;const a=i.length;let l=o.next(),c=n.next(),u=r.next();for(;s<a&&!c.done&&!u.done&&!l.done&&!(c.value!==u.value||!i[s](l.value));++s,c=n.next(),u=r.next(),l=o.next());return s===a&&c.done&&u.done&&l.done?!0:(n.return&&n.return(),r.return&&r.return(),o.return&&o.return(),!1)}function h3(i,e,t,n){return(t&1<<n)!==0}function Z6(i,e,t,n){return(t&1<<n)>>n}function wd(i,e,t){const n=t.byteLength+7&-8;if(i>0||t.byteLength<n){const r=new Uint8Array(n);return r.set(i%8===0?t.subarray(i>>3):Sd(new xy(t,i,e,null,h3)).subarray(0,n)),r}return t}function Sd(i){const e=[];let t=0,n=0,r=0;for(const s of i)s&&(r|=1<<n),++n===8&&(e[t++]=r,r=n=0);(t===0||n>0)&&(e[t++]=r);const o=new Uint8Array(e.length+7&-8);return o.set(e),o}class xy{constructor(e,t,n,r,o){this.bytes=e,this.length=n,this.context=r,this.get=o,this.bit=t%8,this.byteIndex=t>>3,this.byte=e[this.byteIndex++],this.index=0}next(){return this.index<this.length?(this.bit===8&&(this.bit=0,this.byte=this.bytes[this.byteIndex++]),{value:this.get(this.context,this.index++,this.byte,this.bit++)}):{done:!0,value:null}}[Symbol.iterator](){return this}}function lg(i,e,t){if(t-e<=0)return 0;if(t-e<8){let o=0;for(const s of new xy(i,e,t-e,i,Z6))o+=s;return o}const n=t>>3<<3,r=e+(e%8===0?0:8-e%8);return lg(i,e,r)+lg(i,n,t)+Q6(i,r>>3,n-r>>3)}function Q6(i,e,t){let n=0,r=Math.trunc(e);const o=new DataView(i.buffer,i.byteOffset,i.byteLength),s=t===void 0?i.byteLength:r+t;for(;s-r>=4;)n+=bp(o.getUint32(r)),r+=4;for(;s-r>=2;)n+=bp(o.getUint16(r)),r+=2;for(;s-r>=1;)n+=bp(o.getUint8(r)),r+=1;return n}function bp(i){let e=Math.trunc(i);return e=e-(e>>>1&1431655765),e=(e&858993459)+(e>>>2&858993459),(e+(e>>>4)&252645135)*16843009>>>24}const J6=-1;class Je{get typeId(){return this.type.typeId}get ArrayType(){return this.type.ArrayType}get buffers(){return[this.valueOffsets,this.values,this.nullBitmap,this.typeIds]}get nullable(){if(this._nullCount!==0){const{type:e}=this;return ce.isSparseUnion(e)?this.children.some(t=>t.nullable):ce.isDenseUnion(e)?this.children.some(t=>t.nullable):this.nullBitmap&&this.nullBitmap.byteLength>0}return!0}get byteLength(){let e=0;const{valueOffsets:t,values:n,nullBitmap:r,typeIds:o}=this;return t&&(e+=t.byteLength),n&&(e+=n.byteLength),r&&(e+=r.byteLength),o&&(e+=o.byteLength),this.children.reduce((s,a)=>s+a.byteLength,e)}get nullCount(){if(ce.isUnion(this.type))return this.children.reduce((n,r)=>n+r.nullCount,0);let e=this._nullCount,t;return e<=J6&&(t=this.nullBitmap)&&(this._nullCount=e=t.length===0?0:this.length-lg(t,this.offset,this.offset+this.length)),e}constructor(e,t,n,r,o,s=[],a){this.type=e,this.children=s,this.dictionary=a,this.offset=Math.floor(Math.max(t||0,0)),this.length=Math.floor(Math.max(n||0,0)),this._nullCount=Math.floor(Math.max(r||0,-1));let l;o instanceof Je?(this.stride=o.stride,this.values=o.values,this.typeIds=o.typeIds,this.nullBitmap=o.nullBitmap,this.valueOffsets=o.valueOffsets):(this.stride=cr(e),o&&((l=o[0])&&(this.valueOffsets=l),(l=o[1])&&(this.values=l),(l=o[2])&&(this.nullBitmap=l),(l=o[3])&&(this.typeIds=l)))}getValid(e){const{type:t}=this;if(ce.isUnion(t)){const n=t,r=this.children[n.typeIdToChildIndex[this.typeIds[e]]],o=n.mode===vi.Dense?this.valueOffsets[e]:e;return r.getValid(o)}if(this.nullable&&this.nullCount>0){const n=this.offset+e;return(this.nullBitmap[n>>3]&1<<n%8)!==0}return!0}setValid(e,t){let n;const{type:r}=this;if(ce.isUnion(r)){const o=r,s=this.children[o.typeIdToChildIndex[this.typeIds[e]]],a=o.mode===vi.Dense?this.valueOffsets[e]:e;n=s.getValid(a),s.setValid(a,t)}else{let{nullBitmap:o}=this;const{offset:s,length:a}=this,l=s+e,c=1<<l%8,u=l>>3;(!o||o.byteLength<=u)&&(o=new Uint8Array((s+a+63&-64)>>3).fill(255),this.nullCount>0?(o.set(wd(s,a,this.nullBitmap),0),Object.assign(this,{nullBitmap:o})):Object.assign(this,{nullBitmap:o,_nullCount:0}));const h=o[u];n=(h&c)!==0,o[u]=t?h|c:h&~c}return n!==!!t&&(this._nullCount=this.nullCount+(t?-1:1)),t}clone(e=this.type,t=this.offset,n=this.length,r=this._nullCount,o=this,s=this.children){return new Je(e,t,n,r,o,s,this.dictionary)}slice(e,t){const{stride:n,typeId:r,children:o}=this,s=+(this._nullCount===0)-1,a=r===16?n:1,l=this._sliceBuffers(e,t,n,r);return this.clone(this.type,this.offset+e,t,s,l,o.length===0||this.valueOffsets?o:this._sliceChildren(o,a*e,a*t))}_changeLengthAndBackfillNullBitmap(e){if(this.typeId===S.Null)return this.clone(this.type,0,e,0);const{length:t,nullCount:n}=this,r=new Uint8Array((e+63&-64)>>3).fill(255,0,t>>3);r[t>>3]=(1<<t-(t&-8))-1,n>0&&r.set(wd(this.offset,t,this.nullBitmap),0);const o=this.buffers;return o[Wr.VALIDITY]=r,this.clone(this.type,0,e,n+(e-t),o)}_sliceBuffers(e,t,n,r){let o;const{buffers:s}=this;return(o=s[Wr.TYPE])&&(s[Wr.TYPE]=o.subarray(e,e+t)),(o=s[Wr.OFFSET])&&(s[Wr.OFFSET]=o.subarray(e,e+t+1))||(o=s[Wr.DATA])&&(s[Wr.DATA]=r===6?o:o.subarray(n*e,n*(e+t))),s}_sliceChildren(e,t,n){return e.map(r=>r.slice(t,n))}}Je.prototype.children=Object.freeze([]);class hc extends Be{visit(e){return this.getVisitFn(e.type).call(this,e)}visitNull(e){const{["type"]:t,["offset"]:n=0,["length"]:r=0}=e;return new Je(t,n,r,r)}visitBool(e){const{["type"]:t,["offset"]:n=0}=e,r=ze(e.nullBitmap),o=dt(t.ArrayType,e.data),{["length"]:s=o.length>>3,["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Je(t,n,s,a,[void 0,o,r])}visitInt(e){const{["type"]:t,["offset"]:n=0}=e,r=ze(e.nullBitmap),o=dt(t.ArrayType,e.data),{["length"]:s=o.length,["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Je(t,n,s,a,[void 0,o,r])}visitFloat(e){const{["type"]:t,["offset"]:n=0}=e,r=ze(e.nullBitmap),o=dt(t.ArrayType,e.data),{["length"]:s=o.length,["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Je(t,n,s,a,[void 0,o,r])}visitUtf8(e){const{["type"]:t,["offset"]:n=0}=e,r=ze(e.data),o=ze(e.nullBitmap),s=xl(e.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=e.nullBitmap?-1:0}=e;return new Je(t,n,a,l,[s,r,o])}visitLargeUtf8(e){const{["type"]:t,["offset"]:n=0}=e,r=ze(e.data),o=ze(e.nullBitmap),s=s0(e.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=e.nullBitmap?-1:0}=e;return new Je(t,n,a,l,[s,r,o])}visitBinary(e){const{["type"]:t,["offset"]:n=0}=e,r=ze(e.data),o=ze(e.nullBitmap),s=xl(e.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=e.nullBitmap?-1:0}=e;return new Je(t,n,a,l,[s,r,o])}visitLargeBinary(e){const{["type"]:t,["offset"]:n=0}=e,r=ze(e.data),o=ze(e.nullBitmap),s=s0(e.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=e.nullBitmap?-1:0}=e;return new Je(t,n,a,l,[s,r,o])}visitFixedSizeBinary(e){const{["type"]:t,["offset"]:n=0}=e,r=ze(e.nullBitmap),o=dt(t.ArrayType,e.data),{["length"]:s=o.length/cr(t),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Je(t,n,s,a,[void 0,o,r])}visitDate(e){const{["type"]:t,["offset"]:n=0}=e,r=ze(e.nullBitmap),o=dt(t.ArrayType,e.data),{["length"]:s=o.length/cr(t),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Je(t,n,s,a,[void 0,o,r])}visitTimestamp(e){const{["type"]:t,["offset"]:n=0}=e,r=ze(e.nullBitmap),o=dt(t.ArrayType,e.data),{["length"]:s=o.length/cr(t),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Je(t,n,s,a,[void 0,o,r])}visitTime(e){const{["type"]:t,["offset"]:n=0}=e,r=ze(e.nullBitmap),o=dt(t.ArrayType,e.data),{["length"]:s=o.length/cr(t),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Je(t,n,s,a,[void 0,o,r])}visitDecimal(e){const{["type"]:t,["offset"]:n=0}=e,r=ze(e.nullBitmap),o=dt(t.ArrayType,e.data),{["length"]:s=o.length/cr(t),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Je(t,n,s,a,[void 0,o,r])}visitList(e){const{["type"]:t,["offset"]:n=0,["child"]:r}=e,o=ze(e.nullBitmap),s=xl(e.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=e.nullBitmap?-1:0}=e;return new Je(t,n,a,l,[s,void 0,o],[r])}visitStruct(e){const{["type"]:t,["offset"]:n=0,["children"]:r=[]}=e,o=ze(e.nullBitmap),{length:s=r.reduce((l,{length:c})=>Math.max(l,c),0),nullCount:a=e.nullBitmap?-1:0}=e;return new Je(t,n,s,a,[void 0,void 0,o],r)}visitUnion(e){const{["type"]:t,["offset"]:n=0,["children"]:r=[]}=e,o=dt(t.ArrayType,e.typeIds),{["length"]:s=o.length,["nullCount"]:a=-1}=e;if(ce.isSparseUnion(t))return new Je(t,n,s,a,[void 0,void 0,void 0,o],r);const l=xl(e.valueOffsets);return new Je(t,n,s,a,[l,void 0,void 0,o],r)}visitDictionary(e){const{["type"]:t,["offset"]:n=0}=e,r=ze(e.nullBitmap),o=dt(t.indices.ArrayType,e.data),{["dictionary"]:s=new Ce([new hc().visit({type:t.dictionary})])}=e,{["length"]:a=o.length,["nullCount"]:l=e.nullBitmap?-1:0}=e;return new Je(t,n,a,l,[void 0,o,r],[],s)}visitInterval(e){const{["type"]:t,["offset"]:n=0}=e,r=ze(e.nullBitmap),o=dt(t.ArrayType,e.data),{["length"]:s=o.length/cr(t),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Je(t,n,s,a,[void 0,o,r])}visitDuration(e){const{["type"]:t,["offset"]:n=0}=e,r=ze(e.nullBitmap),o=dt(t.ArrayType,e.data),{["length"]:s=o.length,["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Je(t,n,s,a,[void 0,o,r])}visitFixedSizeList(e){const{["type"]:t,["offset"]:n=0,["child"]:r=new hc().visit({type:t.valueType})}=e,o=ze(e.nullBitmap),{["length"]:s=r.length/cr(t),["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Je(t,n,s,a,[void 0,void 0,o],[r])}visitMap(e){const{["type"]:t,["offset"]:n=0,["child"]:r=new hc().visit({type:t.childType})}=e,o=ze(e.nullBitmap),s=xl(e.valueOffsets),{["length"]:a=s.length-1,["nullCount"]:l=e.nullBitmap?-1:0}=e;return new Je(t,n,a,l,[s,void 0,o],[r])}}const e7=new hc;function be(i){return e7.visit(i)}class v0{constructor(e=0,t){this.numChunks=e,this.getChunkIterator=t,this.chunkIndex=0,this.chunkIterator=this.getChunkIterator(0)}next(){for(;this.chunkIndex<this.numChunks;){const e=this.chunkIterator.next();if(!e.done)return e;++this.chunkIndex<this.numChunks&&(this.chunkIterator=this.getChunkIterator(this.chunkIndex))}return{done:!0,value:null}}[Symbol.iterator](){return this}}function t7(i){return i.some(e=>e.nullable)}function d3(i){return i.reduce((e,t)=>e+t.nullCount,0)}function f3(i){return i.reduce((e,t,n)=>(e[n+1]=e[n]+t.length,e),new Uint32Array(i.length+1))}function p3(i,e,t,n){const r=[];for(let o=-1,s=i.length;++o<s;){const a=i[o],l=e[o],{length:c}=a;if(l>=n)break;if(t>=l+c)continue;if(l>=t&&l+c<=n){r.push(a);continue}const u=Math.max(0,t-l),h=Math.min(n-l,c);r.push(a.slice(u,h-u))}return r.length===0&&r.push(i[0].slice(0,0)),r}function wy(i,e,t,n){let r=0,o=0,s=e.length-1;do{if(r>=s-1)return t<e[s]?n(i,r,t-e[r]):null;o=r+Math.trunc((s-r)*.5),t<e[o]?s=o:r=o}while(r<s)}function Sy(i,e){return i.getValid(e)}function Ed(i){function e(t,n,r){return i(t[n],r)}return function(t){const n=this.data;return wy(n,this._offsets,t,e)}}function m3(i){let e;function t(n,r,o){return i(n[r],o,e)}return function(n,r){const o=this.data;e=r;const s=wy(o,this._offsets,n,t);return e=void 0,s}}function g3(i){let e;function t(n,r,o){let s=o,a=0,l=0;for(let c=r-1,u=n.length;++c<u;){const h=n[c];if(~(a=i(h,e,s)))return l+a;s=0,l+=h.length}return-1}return function(n,r){e=n;const o=this.data,s=typeof r!="number"?t(o,0,0):wy(o,this._offsets,r,t);return e=void 0,s}}class ge extends Be{}function i7(i,e){return e===null&&i.length>0?0:-1}function n7(i,e){const{nullBitmap:t}=i;if(!t||i.nullCount<=0)return-1;let n=0;for(const r of new xy(t,i.offset+(e||0),i.length,t,h3)){if(!r)return n;++n}return-1}function Ie(i,e,t){if(e===void 0)return-1;if(e===null)switch(i.typeId){case S.Union:break;case S.Dictionary:break;default:return n7(i,t)}const n=ji.getVisitFn(i),r=Xa(e);for(let o=(t||0)-1,s=i.length;++o<s;)if(r(n(i,o)))return o;return-1}function _3(i,e,t){const n=ji.getVisitFn(i),r=Xa(e);for(let o=(t||0)-1,s=i.length;++o<s;)if(r(n(i,o)))return o;return-1}ge.prototype.visitNull=i7;ge.prototype.visitBool=Ie;ge.prototype.visitInt=Ie;ge.prototype.visitInt8=Ie;ge.prototype.visitInt16=Ie;ge.prototype.visitInt32=Ie;ge.prototype.visitInt64=Ie;ge.prototype.visitUint8=Ie;ge.prototype.visitUint16=Ie;ge.prototype.visitUint32=Ie;ge.prototype.visitUint64=Ie;ge.prototype.visitFloat=Ie;ge.prototype.visitFloat16=Ie;ge.prototype.visitFloat32=Ie;ge.prototype.visitFloat64=Ie;ge.prototype.visitUtf8=Ie;ge.prototype.visitLargeUtf8=Ie;ge.prototype.visitBinary=Ie;ge.prototype.visitLargeBinary=Ie;ge.prototype.visitFixedSizeBinary=Ie;ge.prototype.visitDate=Ie;ge.prototype.visitDateDay=Ie;ge.prototype.visitDateMillisecond=Ie;ge.prototype.visitTimestamp=Ie;ge.prototype.visitTimestampSecond=Ie;ge.prototype.visitTimestampMillisecond=Ie;ge.prototype.visitTimestampMicrosecond=Ie;ge.prototype.visitTimestampNanosecond=Ie;ge.prototype.visitTime=Ie;ge.prototype.visitTimeSecond=Ie;ge.prototype.visitTimeMillisecond=Ie;ge.prototype.visitTimeMicrosecond=Ie;ge.prototype.visitTimeNanosecond=Ie;ge.prototype.visitDecimal=Ie;ge.prototype.visitList=Ie;ge.prototype.visitStruct=Ie;ge.prototype.visitUnion=Ie;ge.prototype.visitDenseUnion=_3;ge.prototype.visitSparseUnion=_3;ge.prototype.visitDictionary=Ie;ge.prototype.visitInterval=Ie;ge.prototype.visitIntervalDayTime=Ie;ge.prototype.visitIntervalYearMonth=Ie;ge.prototype.visitDuration=Ie;ge.prototype.visitDurationSecond=Ie;ge.prototype.visitDurationMillisecond=Ie;ge.prototype.visitDurationMicrosecond=Ie;ge.prototype.visitDurationNanosecond=Ie;ge.prototype.visitFixedSizeList=Ie;ge.prototype.visitMap=Ie;const Cd=new ge;class _e extends Be{}function we(i){const{type:e}=i;if(i.nullCount===0&&i.stride===1&&(ce.isInt(e)&&e.bitWidth!==64||ce.isTime(e)&&e.bitWidth!==64||ce.isFloat(e)&&e.precision!==Jt.HALF))return new v0(i.data.length,n=>{const r=i.data[n];return r.values.subarray(0,r.length)[Symbol.iterator]()});let t=0;return new v0(i.data.length,n=>{const o=i.data[n].length,s=i.slice(t,t+o);return t+=o,new r7(s)})}class r7{constructor(e){this.vector=e,this.index=0}next(){return this.index<this.vector.length?{value:this.vector.get(this.index++)}:{done:!0,value:null}}[Symbol.iterator](){return this}}_e.prototype.visitNull=we;_e.prototype.visitBool=we;_e.prototype.visitInt=we;_e.prototype.visitInt8=we;_e.prototype.visitInt16=we;_e.prototype.visitInt32=we;_e.prototype.visitInt64=we;_e.prototype.visitUint8=we;_e.prototype.visitUint16=we;_e.prototype.visitUint32=we;_e.prototype.visitUint64=we;_e.prototype.visitFloat=we;_e.prototype.visitFloat16=we;_e.prototype.visitFloat32=we;_e.prototype.visitFloat64=we;_e.prototype.visitUtf8=we;_e.prototype.visitLargeUtf8=we;_e.prototype.visitBinary=we;_e.prototype.visitLargeBinary=we;_e.prototype.visitFixedSizeBinary=we;_e.prototype.visitDate=we;_e.prototype.visitDateDay=we;_e.prototype.visitDateMillisecond=we;_e.prototype.visitTimestamp=we;_e.prototype.visitTimestampSecond=we;_e.prototype.visitTimestampMillisecond=we;_e.prototype.visitTimestampMicrosecond=we;_e.prototype.visitTimestampNanosecond=we;_e.prototype.visitTime=we;_e.prototype.visitTimeSecond=we;_e.prototype.visitTimeMillisecond=we;_e.prototype.visitTimeMicrosecond=we;_e.prototype.visitTimeNanosecond=we;_e.prototype.visitDecimal=we;_e.prototype.visitList=we;_e.prototype.visitStruct=we;_e.prototype.visitUnion=we;_e.prototype.visitDenseUnion=we;_e.prototype.visitSparseUnion=we;_e.prototype.visitDictionary=we;_e.prototype.visitInterval=we;_e.prototype.visitIntervalDayTime=we;_e.prototype.visitIntervalYearMonth=we;_e.prototype.visitDuration=we;_e.prototype.visitDurationSecond=we;_e.prototype.visitDurationMillisecond=we;_e.prototype.visitDurationMicrosecond=we;_e.prototype.visitDurationNanosecond=we;_e.prototype.visitFixedSizeList=we;_e.prototype.visitMap=we;const Ey=new _e;var y3;const b3={},v3={};class Ce{constructor(e){var t,n,r;const o=e[0]instanceof Ce?e.flatMap(a=>a.data):e;if(o.length===0||o.some(a=>!(a instanceof Je)))throw new TypeError("Vector constructor expects an Array of Data instances.");const s=(t=o[0])===null||t===void 0?void 0:t.type;switch(o.length){case 0:this._offsets=[0];break;case 1:{const{get:a,set:l,indexOf:c}=b3[s.typeId],u=o[0];this.isValid=h=>Sy(u,h),this.get=h=>a(u,h),this.set=(h,d)=>l(u,h,d),this.indexOf=h=>c(u,h),this._offsets=[0,u.length];break}default:Object.setPrototypeOf(this,v3[s.typeId]),this._offsets=f3(o);break}this.data=o,this.type=s,this.stride=cr(s),this.numChildren=(r=(n=s.children)===null||n===void 0?void 0:n.length)!==null&&r!==void 0?r:0,this.length=this._offsets.at(-1)}get byteLength(){return this.data.reduce((e,t)=>e+t.byteLength,0)}get nullable(){return t7(this.data)}get nullCount(){return d3(this.data)}get ArrayType(){return this.type.ArrayType}get[Symbol.toStringTag](){return`${this.VectorName}<${this.type[Symbol.toStringTag]}>`}get VectorName(){return`${S[this.type.typeId]}Vector`}isValid(e){return!1}get(e){return null}at(e){return this.get(vy(e,this.length))}set(e,t){}indexOf(e,t){return-1}includes(e,t){return this.indexOf(e,t)>-1}[Symbol.iterator](){return Ey.visit(this)}concat(...e){return new Ce(this.data.concat(e.flatMap(t=>t.data).flat(Number.POSITIVE_INFINITY)))}slice(e,t){return new Ce(u3(this,e,t,({data:n,_offsets:r},o,s)=>p3(n,r,o,s)))}toJSON(){return[...this]}toArray(){const{type:e,data:t,length:n,stride:r,ArrayType:o}=this;switch(e.typeId){case S.Int:case S.Float:case S.Decimal:case S.Time:case S.Timestamp:switch(t.length){case 0:return new o;case 1:return t[0].values.subarray(0,n*r);default:return t.reduce((s,{values:a,length:l})=>(s.array.set(a.subarray(0,l*r),s.offset),s.offset+=l*r,s),{array:new o(n*r),offset:0}).array}}return[...this]}toString(){return`[${[...this].join(",")}]`}getChild(e){var t;return this.getChildAt((t=this.type.children)===null||t===void 0?void 0:t.findIndex(n=>n.name===e))}getChildAt(e){return e>-1&&e<this.numChildren?new Ce(this.data.map(({children:t})=>t[e])):null}get isMemoized(){return ce.isDictionary(this.type)?this.data[0].dictionary.isMemoized:!1}memoize(){if(ce.isDictionary(this.type)){const e=new Td(this.data[0].dictionary),t=this.data.map(n=>{const r=n.clone();return r.dictionary=e,r});return new Ce(t)}return new Td(this)}unmemoize(){if(ce.isDictionary(this.type)&&this.isMemoized){const e=this.data[0].dictionary.unmemoize(),t=this.data.map(n=>{const r=n.clone();return r.dictionary=e,r});return new Ce(t)}return this}}y3=Symbol.toStringTag;Ce[y3]=(i=>{i.type=ce.prototype,i.data=[],i.length=0,i.stride=1,i.numChildren=0,i._offsets=new Uint32Array([0]),i[Symbol.isConcatSpreadable]=!0;const e=Object.keys(S).map(t=>S[t]).filter(t=>typeof t=="number"&&t!==S.NONE);for(const t of e){const n=ji.getVisitFnByTypeId(t),r=kn.getVisitFnByTypeId(t),o=Cd.getVisitFnByTypeId(t);b3[t]={get:n,set:r,indexOf:o},v3[t]=Object.create(i,{isValid:{value:Ed(Sy)},get:{value:Ed(ji.getVisitFnByTypeId(t))},set:{value:m3(kn.getVisitFnByTypeId(t))},indexOf:{value:g3(Cd.getVisitFnByTypeId(t))}})}return"Vector"})(Ce.prototype);class Td extends Ce{constructor(e){super(e.data);const t=this.get,n=this.set,r=this.slice,o=new Array(this.length);Object.defineProperty(this,"get",{value(s){const a=o[s];if(a!==void 0)return a;const l=t.call(this,s);return o[s]=l,l}}),Object.defineProperty(this,"set",{value(s,a){n.call(this,s,a),o[s]=a}}),Object.defineProperty(this,"slice",{value:(s,a)=>new Td(r.call(this,s,a))}),Object.defineProperty(this,"isMemoized",{value:!0}),Object.defineProperty(this,"unmemoize",{value:()=>new Ce(this.data)}),Object.defineProperty(this,"memoize",{value:()=>this})}}function x3(i){if(i){if(i instanceof Je)return new Ce([i]);if(i instanceof Ce)return new Ce(i.data);if(i.type instanceof ce)return new Ce([be(i)]);if(Array.isArray(i))return new Ce(i.flatMap(e=>o7(e)));if(ArrayBuffer.isView(i)){i instanceof DataView&&(i=new Uint8Array(i.buffer));const e={offset:0,length:i.length,nullCount:-1,data:i};if(i instanceof Int8Array)return new Ce([be(Object.assign(Object.assign({},e),{type:new bE}))]);if(i instanceof Int16Array)return new Ce([be(Object.assign(Object.assign({},e),{type:new vE}))]);if(i instanceof Int32Array)return new Ce([be(Object.assign(Object.assign({},e),{type:new gs}))]);if(i instanceof BigInt64Array)return new Ce([be(Object.assign(Object.assign({},e),{type:new ey}))]);if(i instanceof Uint8Array||i instanceof Uint8ClampedArray)return new Ce([be(Object.assign(Object.assign({},e),{type:new xE}))]);if(i instanceof Uint16Array)return new Ce([be(Object.assign(Object.assign({},e),{type:new wE}))]);if(i instanceof Uint32Array)return new Ce([be(Object.assign(Object.assign({},e),{type:new SE}))]);if(i instanceof BigUint64Array)return new Ce([be(Object.assign(Object.assign({},e),{type:new EE}))]);if(i instanceof Float32Array)return new Ce([be(Object.assign(Object.assign({},e),{type:new CE}))]);if(i instanceof Float64Array)return new Ce([be(Object.assign(Object.assign({},e),{type:new ty}))]);throw new Error("Unrecognized input")}}throw new Error("Unrecognized input")}function o7(i){return i instanceof Je?[i]:i instanceof Ce?i.data:x3(i).data}function s7(i){if(!i||i.length<=0)return function(r){return!0};let e="";const t=i.filter(n=>n===n);return t.length>0&&(e=`
    switch (x) {${t.map(n=>`
        case ${a7(n)}:`).join("")}
            return false;
    }`),i.length!==t.length&&(e=`if (x !== x) return false;
${e}`),new Function("x",`${e}
return true;`)}function a7(i){return typeof i!="bigint"?ms(i):`${ms(i)}n`}function vp(i,e){const t=Math.ceil(i)*e-1;return(t-t%64+64||64)/e}function x0(i,e=0){return i.length>=e?i.subarray(0,e):ig(new i.constructor(e),i,0)}class tu{constructor(e,t=0,n=1){this.length=Math.ceil(t/n),this.buffer=new e(this.length),this.stride=n,this.BYTES_PER_ELEMENT=e.BYTES_PER_ELEMENT,this.ArrayType=e}get byteLength(){return Math.ceil(this.length*this.stride)*this.BYTES_PER_ELEMENT}get reservedLength(){return this.buffer.length/this.stride}get reservedByteLength(){return this.buffer.byteLength}set(e,t){return this}append(e){return this.set(this.length,e)}reserve(e){if(e>0){this.length+=e;const t=this.stride,n=this.length*t,r=this.buffer.length;n>=r&&this._resize(r===0?vp(n*1,this.BYTES_PER_ELEMENT):vp(n*2,this.BYTES_PER_ELEMENT))}return this}flush(e=this.length){e=vp(e*this.stride,this.BYTES_PER_ELEMENT);const t=x0(this.buffer,e);return this.clear(),t}clear(){return this.length=0,this.buffer=new this.ArrayType,this}_resize(e){return this.buffer=x0(this.buffer,e)}}class iu extends tu{last(){return this.get(this.length-1)}get(e){return this.buffer[e]}set(e,t){return this.reserve(e-this.length+1),this.buffer[e*this.stride]=t,this}}class w3 extends iu{constructor(){super(Uint8Array,0,1/8),this.numValid=0}get numInvalid(){return this.length-this.numValid}get(e){return this.buffer[e>>3]>>e%8&1}set(e,t){const{buffer:n}=this.reserve(e-this.length+1),r=e>>3,o=e%8,s=n[r]>>o&1;return t?s===0&&(n[r]|=1<<o,++this.numValid):s===1&&(n[r]&=~(1<<o),--this.numValid),this}clear(){return this.numValid=0,super.clear()}}class S3 extends iu{constructor(e){super(e.OffsetArrayType,1,1)}append(e){return this.set(this.length-1,e)}set(e,t){const n=this.length-1,r=this.reserve(e-n+1).buffer;return n<e++&&n>=0&&r.fill(r[n],n,e),r[e]=r[e-1]+t,this}flush(e=this.length-1){return e>this.length&&this.set(e-1,this.BYTES_PER_ELEMENT>4?BigInt(0):0),super.flush(e+1)}}let qi=class{static throughNode(e){throw new Error('"throughNode" not available in this environment')}static throughDOM(e){throw new Error('"throughDOM" not available in this environment')}constructor({type:e,nullValues:t}){this.length=0,this.finished=!1,this.type=e,this.children=[],this.nullValues=t,this.stride=cr(e),this._nulls=new w3,t&&t.length>0&&(this._isValid=s7(t))}toVector(){return new Ce([this.flush()])}get ArrayType(){return this.type.ArrayType}get nullCount(){return this._nulls.numInvalid}get numChildren(){return this.children.length}get byteLength(){let e=0;const{_offsets:t,_values:n,_nulls:r,_typeIds:o,children:s}=this;return t&&(e+=t.byteLength),n&&(e+=n.byteLength),r&&(e+=r.byteLength),o&&(e+=o.byteLength),s.reduce((a,l)=>a+l.byteLength,e)}get reservedLength(){return this._nulls.reservedLength}get reservedByteLength(){let e=0;return this._offsets&&(e+=this._offsets.reservedByteLength),this._values&&(e+=this._values.reservedByteLength),this._nulls&&(e+=this._nulls.reservedByteLength),this._typeIds&&(e+=this._typeIds.reservedByteLength),this.children.reduce((t,n)=>t+n.reservedByteLength,e)}get valueOffsets(){return this._offsets?this._offsets.buffer:null}get values(){return this._values?this._values.buffer:null}get nullBitmap(){return this._nulls?this._nulls.buffer:null}get typeIds(){return this._typeIds?this._typeIds.buffer:null}append(e){return this.set(this.length,e)}isValid(e){return this._isValid(e)}set(e,t){return this.setValid(e,this.isValid(t))&&this.setValue(e,t),this}setValue(e,t){this._setValue(this,e,t)}setValid(e,t){return this.length=this._nulls.set(e,+t).length,t}addChild(e,t=`${this.numChildren}`){throw new Error(`Cannot append children to non-nested type "${this.type}"`)}getChildAt(e){return this.children[e]||null}flush(){let e,t,n,r;const{type:o,length:s,nullCount:a,_typeIds:l,_offsets:c,_values:u,_nulls:h}=this;(t=l==null?void 0:l.flush(s))?r=c==null?void 0:c.flush(s):(r=c==null?void 0:c.flush(s))?e=u==null?void 0:u.flush(c.last()):e=u==null?void 0:u.flush(s),a>0&&(n=h==null?void 0:h.flush(s));const d=this.children.map(f=>f.flush());return this.clear(),be({type:o,length:s,nullCount:a,children:d,child:d[0],data:e,typeIds:t,nullBitmap:n,valueOffsets:r})}finish(){this.finished=!0;for(const e of this.children)e.finish();return this}clear(){var e,t,n,r;this.length=0,(e=this._nulls)===null||e===void 0||e.clear(),(t=this._values)===null||t===void 0||t.clear(),(n=this._offsets)===null||n===void 0||n.clear(),(r=this._typeIds)===null||r===void 0||r.clear();for(const o of this.children)o.clear();return this}};qi.prototype.length=1;qi.prototype.stride=1;qi.prototype.children=null;qi.prototype.finished=!1;qi.prototype.nullValues=null;qi.prototype._isValid=()=>!0;class po extends qi{constructor(e){super(e),this._values=new iu(this.ArrayType,0,this.stride)}setValue(e,t){const n=this._values;return n.reserve(e-n.length+1),super.setValue(e,t)}}class Ka extends qi{constructor(e){super(e),this._pendingLength=0,this._offsets=new S3(e.type)}setValue(e,t){const n=this._pending||(this._pending=new Map),r=n.get(e);r&&(this._pendingLength-=r.length),this._pendingLength+=t instanceof vf?t[es].length:t.length,n.set(e,t)}setValid(e,t){return super.setValid(e,t)?!0:((this._pending||(this._pending=new Map)).set(e,void 0),!1)}clear(){return this._pendingLength=0,this._pending=void 0,super.clear()}flush(){return this._flush(),super.flush()}finish(){return this._flush(),super.finish()}_flush(){const e=this._pending,t=this._pendingLength;return this._pendingLength=0,this._pending=void 0,e&&e.size>0&&this._flushPending(e,t),this}}class cg{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}offset(){return this.bb.readInt64(this.bb_pos)}metaDataLength(){return this.bb.readInt32(this.bb_pos+8)}bodyLength(){return this.bb.readInt64(this.bb_pos+16)}static sizeOf(){return 24}static createBlock(e,t,n,r){return e.prep(8,24),e.writeInt64(BigInt(r??0)),e.pad(4),e.writeInt32(n),e.writeInt64(BigInt(t??0)),e.offset()}}class en{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFooter(e,t){return(t||new en).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFooter(e,t){return e.setPosition(e.position()+lt),(t||new en).__init(e.readInt32(e.position())+e.position(),e)}version(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):zt.V1}schema(e){const t=this.bb.__offset(this.bb_pos,6);return t?(e||new sr).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}dictionaries(e,t){const n=this.bb.__offset(this.bb_pos,8);return n?(t||new cg).__init(this.bb.__vector(this.bb_pos+n)+e*24,this.bb):null}dictionariesLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}recordBatches(e,t){const n=this.bb.__offset(this.bb_pos,10);return n?(t||new cg).__init(this.bb.__vector(this.bb_pos+n)+e*24,this.bb):null}recordBatchesLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,t){const n=this.bb.__offset(this.bb_pos,12);return n?(t||new Xt).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFooter(e){e.startObject(5)}static addVersion(e,t){e.addFieldInt16(0,t,zt.V1)}static addSchema(e,t){e.addFieldOffset(1,t,0)}static addDictionaries(e,t){e.addFieldOffset(2,t,0)}static startDictionariesVector(e,t){e.startVector(24,t,8)}static addRecordBatches(e,t){e.addFieldOffset(3,t,0)}static startRecordBatchesVector(e,t){e.startVector(24,t,8)}static addCustomMetadata(e,t){e.addFieldOffset(4,t,0)}static createCustomMetadataVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startCustomMetadataVector(e,t){e.startVector(4,t,4)}static endFooter(e){return e.endObject()}static finishFooterBuffer(e,t){e.finish(t)}static finishSizePrefixedFooterBuffer(e,t){e.finish(t,void 0,!0)}}class st{constructor(e=[],t,n,r=zt.V5){this.fields=e||[],this.metadata=t||new Map,n||(n=ug(this.fields)),this.dictionaries=n,this.metadataVersion=r}get[Symbol.toStringTag](){return"Schema"}get names(){return this.fields.map(e=>e.name)}toString(){return`Schema<{ ${this.fields.map((e,t)=>`${t}: ${e}`).join(", ")} }>`}select(e){const t=new Set(e),n=this.fields.filter(r=>t.has(r.name));return new st(n,this.metadata)}selectAt(e){const t=e.map(n=>this.fields[n]).filter(Boolean);return new st(t,this.metadata)}assign(...e){const t=e[0]instanceof st?e[0]:Array.isArray(e[0])?new st(e[0]):new st(e),n=[...this.fields],r=zu(zu(new Map,this.metadata),t.metadata),o=t.fields.filter(a=>{const l=n.findIndex(c=>c.name===a.name);return~l?(n[l]=a.clone({metadata:zu(zu(new Map,n[l].metadata),a.metadata)}))&&!1:!0}),s=ug(o,new Map);return new st([...n,...o],r,new Map([...this.dictionaries,...s]))}}st.prototype.fields=null;st.prototype.metadata=null;st.prototype.dictionaries=null;class tt{static new(...e){let[t,n,r,o]=e;return e[0]&&typeof e[0]=="object"&&({name:t}=e[0],n===void 0&&(n=e[0].type),r===void 0&&(r=e[0].nullable),o===void 0&&(o=e[0].metadata)),new tt(`${t}`,n,r,o)}constructor(e,t,n=!1,r){this.name=e,this.type=t,this.nullable=n,this.metadata=r||new Map}get typeId(){return this.type.typeId}get[Symbol.toStringTag](){return"Field"}toString(){return`${this.name}: ${this.type}`}clone(...e){let[t,n,r,o]=e;return!e[0]||typeof e[0]!="object"?[t=this.name,n=this.type,r=this.nullable,o=this.metadata]=e:{name:t=this.name,type:n=this.type,nullable:r=this.nullable,metadata:o=this.metadata}=e[0],tt.new(t,n,r,o)}}tt.prototype.type=null;tt.prototype.name=null;tt.prototype.nullable=null;tt.prototype.metadata=null;function zu(i,e){return new Map([...i||new Map,...e||new Map])}function ug(i,e=new Map){for(let t=-1,n=i.length;++t<n;){const o=i[t].type;if(ce.isDictionary(o)){if(!e.has(o.id))e.set(o.id,o.dictionary);else if(e.get(o.id)!==o.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}o.children&&o.children.length>0&&ug(o.children,e)}return e}var l7=W2,c7=Pa;class Mc{static decode(e){e=new c7(ze(e));const t=en.getRootAsFooter(e),n=st.decode(t.schema(),new Map,t.version());return new u7(n,t)}static encode(e){const t=new l7,n=st.encode(t,e.schema);en.startRecordBatchesVector(t,e.numRecordBatches);for(const s of[...e.recordBatches()].slice().reverse())$o.encode(t,s);const r=t.endVector();en.startDictionariesVector(t,e.numDictionaries);for(const s of[...e.dictionaryBatches()].slice().reverse())$o.encode(t,s);const o=t.endVector();return en.startFooter(t),en.addSchema(t,n),en.addVersion(t,zt.V5),en.addRecordBatches(t,r),en.addDictionaries(t,o),en.finishFooterBuffer(t,en.endFooter(t)),t.asUint8Array()}get numRecordBatches(){return this._recordBatches.length}get numDictionaries(){return this._dictionaryBatches.length}constructor(e,t=zt.V5,n,r){this.schema=e,this.version=t,n&&(this._recordBatches=n),r&&(this._dictionaryBatches=r)}*recordBatches(){for(let e,t=-1,n=this.numRecordBatches;++t<n;)(e=this.getRecordBatch(t))&&(yield e)}*dictionaryBatches(){for(let e,t=-1,n=this.numDictionaries;++t<n;)(e=this.getDictionaryBatch(t))&&(yield e)}getRecordBatch(e){return e>=0&&e<this.numRecordBatches&&this._recordBatches[e]||null}getDictionaryBatch(e){return e>=0&&e<this.numDictionaries&&this._dictionaryBatches[e]||null}}class u7 extends Mc{get numRecordBatches(){return this._footer.recordBatchesLength()}get numDictionaries(){return this._footer.dictionariesLength()}constructor(e,t){super(e,t.version()),this._footer=t}getRecordBatch(e){if(e>=0&&e<this.numRecordBatches){const t=this._footer.recordBatches(e);if(t)return $o.decode(t)}return null}getDictionaryBatch(e){if(e>=0&&e<this.numDictionaries){const t=this._footer.dictionaries(e);if(t)return $o.decode(t)}return null}}class $o{static decode(e){return new $o(e.metaDataLength(),e.bodyLength(),e.offset())}static encode(e,t){const{metaDataLength:n}=t,r=BigInt(t.offset),o=BigInt(t.bodyLength);return cg.createBlock(e,r,n,o)}constructor(e,t,n){this.metaDataLength=e,this.offset=bt(n),this.bodyLength=bt(t)}}const Pt=Object.freeze({done:!0,value:void 0});class w0{constructor(e){this._json=e}get schema(){return this._json.schema}get batches(){return this._json.batches||[]}get dictionaries(){return this._json.dictionaries||[]}}class Cy{tee(){return this._getDOMStream().tee()}pipe(e,t){return this._getNodeStream().pipe(e,t)}pipeTo(e,t){return this._getDOMStream().pipeTo(e,t)}pipeThrough(e,t){return this._getDOMStream().pipeThrough(e,t)}_getDOMStream(){return this._DOMStream||(this._DOMStream=this.toDOMStream())}_getNodeStream(){return this._nodeStream||(this._nodeStream=this.toNodeStream())}}class h7 extends Cy{constructor(){super(),this._values=[],this.resolvers=[],this._closedPromise=new Promise(e=>this._closedPromiseResolve=e)}get closed(){return this._closedPromise}cancel(e){return ke(this,void 0,void 0,function*(){yield this.return(e)})}write(e){this._ensureOpen()&&(this.resolvers.length<=0?this._values.push(e):this.resolvers.shift().resolve({done:!1,value:e}))}abort(e){this._closedPromiseResolve&&(this.resolvers.length<=0?this._error={error:e}:this.resolvers.shift().reject({done:!0,value:e}))}close(){if(this._closedPromiseResolve){const{resolvers:e}=this;for(;e.length>0;)e.shift().resolve(Pt);this._closedPromiseResolve(),this._closedPromiseResolve=void 0}}[Symbol.asyncIterator](){return this}toDOMStream(e){return yn.toDOMStream(this._closedPromiseResolve||this._error?this:this._values,e)}toNodeStream(e){return yn.toNodeStream(this._closedPromiseResolve||this._error?this:this._values,e)}throw(e){return ke(this,void 0,void 0,function*(){return yield this.abort(e),Pt})}return(e){return ke(this,void 0,void 0,function*(){return yield this.close(),Pt})}read(e){return ke(this,void 0,void 0,function*(){return(yield this.next(e,"read")).value})}peek(e){return ke(this,void 0,void 0,function*(){return(yield this.next(e,"peek")).value})}next(...e){return this._values.length>0?Promise.resolve({done:!1,value:this._values.shift()}):this._error?Promise.reject({done:!0,value:this._error.error}):this._closedPromiseResolve?new Promise((t,n)=>{this.resolvers.push({resolve:t,reject:n})}):Promise.resolve(Pt)}_ensureOpen(){if(this._closedPromiseResolve)return!0;throw new Error("AsyncQueue is closed")}}class Th extends h7{write(e){if((e=ze(e)).byteLength>0)return super.write(e)}toString(e=!1){return e?eg(this.toUint8Array(!0)):this.toUint8Array(!1).then(eg)}toUint8Array(e=!1){return e?wr(this._values)[0]:ke(this,void 0,void 0,function*(){var t,n,r,o;const s=[];let a=0;try{for(var l=!0,c=ss(this),u;u=yield c.next(),t=u.done,!t;l=!0){o=u.value,l=!1;const h=o;s.push(h),a+=h.byteLength}}catch(h){n={error:h}}finally{try{!l&&!t&&(r=c.return)&&(yield r.call(c))}finally{if(n)throw n.error}}return wr(s,a)[0]})}}class Ad{constructor(e){e&&(this.source=new d7(yn.fromIterable(e)))}[Symbol.iterator](){return this}next(e){return this.source.next(e)}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}peek(e){return this.source.peek(e)}read(e){return this.source.read(e)}}class Ba{constructor(e){e instanceof Ba?this.source=e.source:e instanceof Th?this.source=new Jo(yn.fromAsyncIterable(e)):$2(e)?this.source=new Jo(yn.fromNodeStream(e)):Z_(e)?this.source=new Jo(yn.fromDOMStream(e)):U2(e)?this.source=new Jo(yn.fromDOMStream(e.body)):eu(e)?this.source=new Jo(yn.fromIterable(e)):zo(e)?this.source=new Jo(yn.fromAsyncIterable(e)):qa(e)&&(this.source=new Jo(yn.fromAsyncIterable(e)))}[Symbol.asyncIterator](){return this}next(e){return this.source.next(e)}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}get closed(){return this.source.closed}cancel(e){return this.source.cancel(e)}peek(e){return this.source.peek(e)}read(e){return this.source.read(e)}}class d7{constructor(e){this.source=e}cancel(e){this.return(e)}peek(e){return this.next(e,"peek").value}read(e){return this.next(e,"read").value}next(e,t="read"){return this.source.next({cmd:t,size:e})}throw(e){return Object.create(this.source.throw&&this.source.throw(e)||Pt)}return(e){return Object.create(this.source.return&&this.source.return(e)||Pt)}}class Jo{constructor(e){this.source=e,this._closedPromise=new Promise(t=>this._closedPromiseResolve=t)}cancel(e){return ke(this,void 0,void 0,function*(){yield this.return(e)})}get closed(){return this._closedPromise}read(e){return ke(this,void 0,void 0,function*(){return(yield this.next(e,"read")).value})}peek(e){return ke(this,void 0,void 0,function*(){return(yield this.next(e,"peek")).value})}next(e){return ke(this,arguments,void 0,function*(t,n="read"){return yield this.source.next({cmd:n,size:t})})}throw(e){return ke(this,void 0,void 0,function*(){const t=this.source.throw&&(yield this.source.throw(e))||Pt;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(t)})}return(e){return ke(this,void 0,void 0,function*(){const t=this.source.return&&(yield this.source.return(e))||Pt;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(t)})}}class S0 extends Ad{constructor(e,t){super(),this.position=0,this.buffer=ze(e),this.size=t===void 0?this.buffer.byteLength:t}readInt32(e){const{buffer:t,byteOffset:n}=this.readAt(e,4);return new DataView(t,n).getInt32(0,!0)}seek(e){return this.position=Math.min(e,this.size),e<this.size}read(e){const{buffer:t,size:n,position:r}=this;return t&&r<n?(typeof e!="number"&&(e=Number.POSITIVE_INFINITY),this.position=Math.min(n,r+Math.min(n-r,e)),t.subarray(r,this.position)):null}readAt(e,t){const n=this.buffer,r=Math.min(this.size,e+t);return n?n.subarray(e,r):new Uint8Array(t)}close(){this.buffer&&(this.buffer=null)}throw(e){return this.close(),{done:!0,value:e}}return(e){return this.close(),{done:!0,value:e}}}class Id extends Ba{constructor(e,t){super(),this.position=0,this._handle=e,typeof t=="number"?this.size=t:this._pending=ke(this,void 0,void 0,function*(){this.size=(yield e.stat()).size,delete this._pending})}readInt32(e){return ke(this,void 0,void 0,function*(){const{buffer:t,byteOffset:n}=yield this.readAt(e,4);return new DataView(t,n).getInt32(0,!0)})}seek(e){return ke(this,void 0,void 0,function*(){return this._pending&&(yield this._pending),this.position=Math.min(e,this.size),e<this.size})}read(e){return ke(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:t,size:n,position:r}=this;if(t&&r<n){typeof e!="number"&&(e=Number.POSITIVE_INFINITY);let o=r,s=0,a=0;const l=Math.min(n,o+Math.min(n-o,e)),c=new Uint8Array(Math.max(0,(this.position=l)-o));for(;(o+=a)<l&&(s+=a)<c.byteLength;)({bytesRead:a}=yield t.read(c,s,c.byteLength-s,o));return c}return null})}readAt(e,t){return ke(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:n,size:r}=this;if(n&&e+t<r){const o=Math.min(r,e+t),s=new Uint8Array(o-e);return(yield n.read(s,0,t,e)).buffer}return new Uint8Array(t)})}close(){return ke(this,void 0,void 0,function*(){const e=this._handle;this._handle=null,e&&(yield e.close())})}throw(e){return ke(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:e}})}return(e){return ke(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:e}})}}const f7=65536;function ca(i){return i<0&&(i=4294967295+i+1),`0x${i.toString(16)}`}const Oa=8,Ty=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8];class E3{constructor(e){this.buffer=e}high(){return this.buffer[1]}low(){return this.buffer[0]}_times(e){const t=new Uint32Array([this.buffer[1]>>>16,this.buffer[1]&65535,this.buffer[0]>>>16,this.buffer[0]&65535]),n=new Uint32Array([e.buffer[1]>>>16,e.buffer[1]&65535,e.buffer[0]>>>16,e.buffer[0]&65535]);let r=t[3]*n[3];this.buffer[0]=r&65535;let o=r>>>16;return r=t[2]*n[3],o+=r,r=t[3]*n[2]>>>0,o+=r,this.buffer[0]+=o<<16,this.buffer[1]=o>>>0<r?f7:0,this.buffer[1]+=o>>>16,this.buffer[1]+=t[1]*n[3]+t[2]*n[2]+t[3]*n[1],this.buffer[1]+=t[0]*n[3]+t[1]*n[2]+t[2]*n[1]+t[3]*n[0]<<16,this}_plus(e){const t=this.buffer[0]+e.buffer[0]>>>0;this.buffer[1]+=e.buffer[1],t<this.buffer[0]>>>0&&++this.buffer[1],this.buffer[0]=t}lessThan(e){return this.buffer[1]<e.buffer[1]||this.buffer[1]===e.buffer[1]&&this.buffer[0]<e.buffer[0]}equals(e){return this.buffer[1]===e.buffer[1]&&this.buffer[0]==e.buffer[0]}greaterThan(e){return e.lessThan(this)}hex(){return`${ca(this.buffer[1])} ${ca(this.buffer[0])}`}}class ht extends E3{times(e){return this._times(e),this}plus(e){return this._plus(e),this}static from(e,t=new Uint32Array(2)){return ht.fromString(typeof e=="string"?e:e.toString(),t)}static fromNumber(e,t=new Uint32Array(2)){return ht.fromString(e.toString(),t)}static fromString(e,t=new Uint32Array(2)){const n=e.length,r=new ht(t);for(let o=0;o<n;){const s=Oa<n-o?Oa:n-o,a=new ht(new Uint32Array([Number.parseInt(e.slice(o,o+s),10),0])),l=new ht(new Uint32Array([Ty[s],0]));r.times(l),r.plus(a),o+=s}return r}static convertArray(e){const t=new Uint32Array(e.length*2);for(let n=-1,r=e.length;++n<r;)ht.from(e[n],new Uint32Array(t.buffer,t.byteOffset+2*n*4,2));return t}static multiply(e,t){return new ht(new Uint32Array(e.buffer)).times(t)}static add(e,t){return new ht(new Uint32Array(e.buffer)).plus(t)}}class Fi extends E3{negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[0]==0&&++this.buffer[1],this}times(e){return this._times(e),this}plus(e){return this._plus(e),this}lessThan(e){const t=this.buffer[1]<<0,n=e.buffer[1]<<0;return t<n||t===n&&this.buffer[0]<e.buffer[0]}static from(e,t=new Uint32Array(2)){return Fi.fromString(typeof e=="string"?e:e.toString(),t)}static fromNumber(e,t=new Uint32Array(2)){return Fi.fromString(e.toString(),t)}static fromString(e,t=new Uint32Array(2)){const n=e.startsWith("-"),r=e.length,o=new Fi(t);for(let s=n?1:0;s<r;){const a=Oa<r-s?Oa:r-s,l=new Fi(new Uint32Array([Number.parseInt(e.slice(s,s+a),10),0])),c=new Fi(new Uint32Array([Ty[a],0]));o.times(c),o.plus(l),s+=a}return n?o.negate():o}static convertArray(e){const t=new Uint32Array(e.length*2);for(let n=-1,r=e.length;++n<r;)Fi.from(e[n],new Uint32Array(t.buffer,t.byteOffset+2*n*4,2));return t}static multiply(e,t){return new Fi(new Uint32Array(e.buffer)).times(t)}static add(e,t){return new Fi(new Uint32Array(e.buffer)).plus(t)}}class ar{constructor(e){this.buffer=e}high(){return new Fi(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2))}low(){return new Fi(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset,2))}negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[2]=~this.buffer[2],this.buffer[3]=~this.buffer[3],this.buffer[0]==0&&++this.buffer[1],this.buffer[1]==0&&++this.buffer[2],this.buffer[2]==0&&++this.buffer[3],this}times(e){const t=new ht(new Uint32Array([this.buffer[3],0])),n=new ht(new Uint32Array([this.buffer[2],0])),r=new ht(new Uint32Array([this.buffer[1],0])),o=new ht(new Uint32Array([this.buffer[0],0])),s=new ht(new Uint32Array([e.buffer[3],0])),a=new ht(new Uint32Array([e.buffer[2],0])),l=new ht(new Uint32Array([e.buffer[1],0])),c=new ht(new Uint32Array([e.buffer[0],0]));let u=ht.multiply(o,c);this.buffer[0]=u.low();const h=new ht(new Uint32Array([u.high(),0]));return u=ht.multiply(r,c),h.plus(u),u=ht.multiply(o,l),h.plus(u),this.buffer[1]=h.low(),this.buffer[3]=h.lessThan(u)?1:0,this.buffer[2]=h.high(),new ht(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2)).plus(ht.multiply(n,c)).plus(ht.multiply(r,l)).plus(ht.multiply(o,a)),this.buffer[3]+=ht.multiply(t,c).plus(ht.multiply(n,l)).plus(ht.multiply(r,a)).plus(ht.multiply(o,s)).low(),this}plus(e){const t=new Uint32Array(4);return t[3]=this.buffer[3]+e.buffer[3]>>>0,t[2]=this.buffer[2]+e.buffer[2]>>>0,t[1]=this.buffer[1]+e.buffer[1]>>>0,t[0]=this.buffer[0]+e.buffer[0]>>>0,t[0]<this.buffer[0]>>>0&&++t[1],t[1]<this.buffer[1]>>>0&&++t[2],t[2]<this.buffer[2]>>>0&&++t[3],this.buffer[3]=t[3],this.buffer[2]=t[2],this.buffer[1]=t[1],this.buffer[0]=t[0],this}hex(){return`${ca(this.buffer[3])} ${ca(this.buffer[2])} ${ca(this.buffer[1])} ${ca(this.buffer[0])}`}static multiply(e,t){return new ar(new Uint32Array(e.buffer)).times(t)}static add(e,t){return new ar(new Uint32Array(e.buffer)).plus(t)}static from(e,t=new Uint32Array(4)){return ar.fromString(typeof e=="string"?e:e.toString(),t)}static fromNumber(e,t=new Uint32Array(4)){return ar.fromString(e.toString(),t)}static fromString(e,t=new Uint32Array(4)){const n=e.startsWith("-"),r=e.length,o=new ar(t);for(let s=n?1:0;s<r;){const a=Oa<r-s?Oa:r-s,l=new ar(new Uint32Array([Number.parseInt(e.slice(s,s+a),10),0,0,0])),c=new ar(new Uint32Array([Ty[a],0,0,0]));o.times(c),o.plus(l),s+=a}return n?o.negate():o}static convertArray(e){const t=new Uint32Array(e.length*4);for(let n=-1,r=e.length;++n<r;)ar.from(e[n],new Uint32Array(t.buffer,t.byteOffset+16*n,4));return t}}class C3 extends Be{constructor(e,t,n,r,o=zt.V5){super(),this.nodesIndex=-1,this.buffersIndex=-1,this.bytes=e,this.nodes=t,this.buffers=n,this.dictionaries=r,this.metadataVersion=o}visit(e){return super.visit(e instanceof tt?e.type:e)}visitNull(e,{length:t}=this.nextFieldNode()){return be({type:e,length:t})}visitBool(e,{length:t,nullCount:n}=this.nextFieldNode()){return be({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),data:this.readData(e)})}visitInt(e,{length:t,nullCount:n}=this.nextFieldNode()){return be({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),data:this.readData(e)})}visitFloat(e,{length:t,nullCount:n}=this.nextFieldNode()){return be({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),data:this.readData(e)})}visitUtf8(e,{length:t,nullCount:n}=this.nextFieldNode()){return be({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitLargeUtf8(e,{length:t,nullCount:n}=this.nextFieldNode()){return be({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitBinary(e,{length:t,nullCount:n}=this.nextFieldNode()){return be({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitLargeBinary(e,{length:t,nullCount:n}=this.nextFieldNode()){return be({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitFixedSizeBinary(e,{length:t,nullCount:n}=this.nextFieldNode()){return be({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),data:this.readData(e)})}visitDate(e,{length:t,nullCount:n}=this.nextFieldNode()){return be({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),data:this.readData(e)})}visitTimestamp(e,{length:t,nullCount:n}=this.nextFieldNode()){return be({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),data:this.readData(e)})}visitTime(e,{length:t,nullCount:n}=this.nextFieldNode()){return be({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),data:this.readData(e)})}visitDecimal(e,{length:t,nullCount:n}=this.nextFieldNode()){return be({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),data:this.readData(e)})}visitList(e,{length:t,nullCount:n}=this.nextFieldNode()){return be({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),valueOffsets:this.readOffsets(e),child:this.visit(e.children[0])})}visitStruct(e,{length:t,nullCount:n}=this.nextFieldNode()){return be({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),children:this.visitMany(e.children)})}visitUnion(e,{length:t,nullCount:n}=this.nextFieldNode()){return this.metadataVersion<zt.V5&&this.readNullBitmap(e,n),e.mode===vi.Sparse?this.visitSparseUnion(e,{length:t,nullCount:n}):this.visitDenseUnion(e,{length:t,nullCount:n})}visitDenseUnion(e,{length:t,nullCount:n}=this.nextFieldNode()){return be({type:e,length:t,nullCount:n,typeIds:this.readTypeIds(e),valueOffsets:this.readOffsets(e),children:this.visitMany(e.children)})}visitSparseUnion(e,{length:t,nullCount:n}=this.nextFieldNode()){return be({type:e,length:t,nullCount:n,typeIds:this.readTypeIds(e),children:this.visitMany(e.children)})}visitDictionary(e,{length:t,nullCount:n}=this.nextFieldNode()){return be({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),data:this.readData(e.indices),dictionary:this.readDictionary(e)})}visitInterval(e,{length:t,nullCount:n}=this.nextFieldNode()){return be({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),data:this.readData(e)})}visitDuration(e,{length:t,nullCount:n}=this.nextFieldNode()){return be({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),data:this.readData(e)})}visitFixedSizeList(e,{length:t,nullCount:n}=this.nextFieldNode()){return be({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),child:this.visit(e.children[0])})}visitMap(e,{length:t,nullCount:n}=this.nextFieldNode()){return be({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),valueOffsets:this.readOffsets(e),child:this.visit(e.children[0])})}nextFieldNode(){return this.nodes[++this.nodesIndex]}nextBufferRange(){return this.buffers[++this.buffersIndex]}readNullBitmap(e,t,n=this.nextBufferRange()){return t>0&&this.readData(e,n)||new Uint8Array(0)}readOffsets(e,t){return this.readData(e,t)}readTypeIds(e,t){return this.readData(e,t)}readData(e,{length:t,offset:n}=this.nextBufferRange()){return this.bytes.subarray(n,n+t)}readDictionary(e){return this.dictionaries.get(e.id)}}class p7 extends C3{constructor(e,t,n,r,o){super(new Uint8Array(0),t,n,r,o),this.sources=e}readNullBitmap(e,t,{offset:n}=this.nextBufferRange()){return t<=0?new Uint8Array(0):Sd(this.sources[n])}readOffsets(e,{offset:t}=this.nextBufferRange()){return dt(Uint8Array,dt(e.OffsetArrayType,this.sources[t]))}readTypeIds(e,{offset:t}=this.nextBufferRange()){return dt(Uint8Array,dt(e.ArrayType,this.sources[t]))}readData(e,{offset:t}=this.nextBufferRange()){const{sources:n}=this;return ce.isTimestamp(e)||(ce.isInt(e)||ce.isTime(e))&&e.bitWidth===64||ce.isDuration(e)||ce.isDate(e)&&e.unit===In.MILLISECOND?dt(Uint8Array,Fi.convertArray(n[t])):ce.isDecimal(e)?dt(Uint8Array,ar.convertArray(n[t])):ce.isBinary(e)||ce.isLargeBinary(e)||ce.isFixedSizeBinary(e)?m7(n[t]):ce.isBool(e)?Sd(n[t]):ce.isUtf8(e)||ce.isLargeUtf8(e)?Jc(n[t].join("")):dt(Uint8Array,dt(e.ArrayType,n[t].map(r=>+r)))}}function m7(i){const e=i.join(""),t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2)t[n>>1]=Number.parseInt(e.slice(n,n+2),16);return t}class T3 extends Ka{constructor(e){super(e),this._values=new tu(Uint8Array)}get byteLength(){let e=this._pendingLength+this.length*4;return this._offsets&&(e+=this._offsets.byteLength),this._values&&(e+=this._values.byteLength),this._nulls&&(e+=this._nulls.byteLength),e}setValue(e,t){return super.setValue(e,ze(t))}_flushPending(e,t){const n=this._offsets,r=this._values.reserve(t).buffer;let o=0;for(const[s,a]of e)if(a===void 0)n.set(s,0);else{const l=a.length;r.set(a,o),n.set(s,l),o+=l}}}class A3 extends Ka{constructor(e){super(e),this._values=new tu(Uint8Array)}get byteLength(){let e=this._pendingLength+this.length*4;return this._offsets&&(e+=this._offsets.byteLength),this._values&&(e+=this._values.byteLength),this._nulls&&(e+=this._nulls.byteLength),e}setValue(e,t){return super.setValue(e,ze(t))}_flushPending(e,t){const n=this._offsets,r=this._values.reserve(t).buffer;let o=0;for(const[s,a]of e)if(a===void 0)n.set(s,BigInt(0));else{const l=a.length;r.set(a,o),n.set(s,BigInt(l)),o+=l}}}class g7 extends qi{constructor(e){super(e),this._values=new w3}setValue(e,t){this._values.set(e,+t)}}class wf extends po{}wf.prototype._setValue=ME;class I3 extends wf{}I3.prototype._setValue=ny;class k3 extends wf{}k3.prototype._setValue=ry;class L3 extends po{}L3.prototype._setValue=OE;class _7 extends qi{constructor({type:e,nullValues:t,dictionaryHashFunction:n}){super({type:new Uo(e.dictionary,e.indices,e.id,e.isOrdered)}),this._nulls=null,this._dictionaryOffset=0,this._keysToIndices=Object.create(null),this.indices=kd({type:this.type.indices,nullValues:t}),this.dictionary=kd({type:this.type.dictionary,nullValues:null}),typeof n=="function"&&(this.valueToKey=n)}get values(){return this.indices.values}get nullCount(){return this.indices.nullCount}get nullBitmap(){return this.indices.nullBitmap}get byteLength(){return this.indices.byteLength+this.dictionary.byteLength}get reservedLength(){return this.indices.reservedLength+this.dictionary.reservedLength}get reservedByteLength(){return this.indices.reservedByteLength+this.dictionary.reservedByteLength}isValid(e){return this.indices.isValid(e)}setValid(e,t){const n=this.indices;return t=n.setValid(e,t),this.length=n.length,t}setValue(e,t){const n=this._keysToIndices,r=this.valueToKey(t);let o=n[r];return o===void 0&&(n[r]=o=this._dictionaryOffset+this.dictionary.append(t).length-1),this.indices.setValue(e,o)}flush(){const e=this.type,t=this._dictionary,n=this.dictionary.toVector(),r=this.indices.flush().clone(e);return r.dictionary=t?t.concat(n):n,this.finished||(this._dictionaryOffset+=n.length),this._dictionary=r.dictionary,this.clear(),r}finish(){return this.indices.finish(),this.dictionary.finish(),this._dictionaryOffset=0,this._keysToIndices=Object.create(null),super.finish()}clear(){return this.indices.clear(),this.dictionary.clear(),super.clear()}valueToKey(e){return typeof e=="string"?e:`${e}`}}class R3 extends po{}R3.prototype._setValue=RE;class y7 extends qi{setValue(e,t){const[n]=this.children,r=e*this.stride;for(let o=-1,s=t.length;++o<s;)n.set(r+o,t[o])}addChild(e,t="0"){if(this.numChildren>0)throw new Error("FixedSizeListBuilder can only have one child.");const n=this.children.push(e);return this.type=new Pc(this.type.listSize,new tt(t,e.type,!0)),n}}class Sf extends po{setValue(e,t){this._values.set(e,t)}}class b7 extends Sf{setValue(e,t){super.setValue(e,IE(t))}}class v7 extends Sf{}class x7 extends Sf{}class Ef extends po{}Ef.prototype._setValue=UE;class P3 extends Ef{}P3.prototype._setValue=fy;class D3 extends Ef{}D3.prototype._setValue=py;class Za extends po{}Za.prototype._setValue=$E;class M3 extends Za{}M3.prototype._setValue=my;class N3 extends Za{}N3.prototype._setValue=gy;class B3 extends Za{}B3.prototype._setValue=_y;class O3 extends Za{}O3.prototype._setValue=yy;class mo extends po{setValue(e,t){this._values.set(e,t)}}class w7 extends mo{}class S7 extends mo{}class E7 extends mo{}class C7 extends mo{}class T7 extends mo{}class A7 extends mo{}class I7 extends mo{}class k7 extends mo{}class L7 extends Ka{constructor(e){super(e),this._offsets=new S3(e.type)}addChild(e,t="0"){if(this.numChildren>0)throw new Error("ListBuilder can only have one child.");return this.children[this.numChildren]=e,this.type=new Na(new tt(t,e.type,!0)),this.numChildren-1}_flushPending(e){const t=this._offsets,[n]=this.children;for(const[r,o]of e)if(typeof o>"u")t.set(r,0);else{const s=o,a=s.length,l=t.set(r,a).buffer[r];for(let c=-1;++c<a;)n.set(l+c,s[c])}}}class R7 extends Ka{set(e,t){return super.set(e,t)}setValue(e,t){const n=t instanceof Map?t:new Map(Object.entries(t)),r=this._pending||(this._pending=new Map),o=r.get(e);o&&(this._pendingLength-=o.size),this._pendingLength+=n.size,r.set(e,n)}addChild(e,t=`${this.numChildren}`){if(this.numChildren>0)throw new Error("ListBuilder can only have one child.");return this.children[this.numChildren]=e,this.type=new Dc(new tt(t,e.type,!0),this.type.keysSorted),this.numChildren-1}_flushPending(e){const t=this._offsets,[n]=this.children;for(const[r,o]of e)if(o===void 0)t.set(r,0);else{let{[r]:s,[r+1]:a}=t.set(r,o.size).buffer;for(const l of o.entries())if(n.set(s,l),++s>=a)break}}}class P7 extends qi{setValue(e,t){}setValid(e,t){return this.length=Math.max(e+1,this.length),t}}class D7 extends qi{setValue(e,t){const{children:n,type:r}=this;switch(Array.isArray(t)||t.constructor){case!0:return r.children.forEach((o,s)=>n[s].set(e,t[s]));case Map:return r.children.forEach((o,s)=>n[s].set(e,t.get(o.name)));default:return r.children.forEach((o,s)=>n[s].set(e,t[o.name]))}}setValid(e,t){return super.setValid(e,t)||this.children.forEach(n=>n.setValid(e,t)),t}addChild(e,t=`${this.numChildren}`){const n=this.children.push(e);return this.type=new ri([...this.type.children,new tt(t,e.type,!0)]),n}}class Qa extends po{}Qa.prototype._setValue=NE;class F3 extends Qa{}F3.prototype._setValue=oy;class z3 extends Qa{}z3.prototype._setValue=sy;class U3 extends Qa{}U3.prototype._setValue=ay;class $3 extends Qa{}$3.prototype._setValue=ly;class Ja extends po{}Ja.prototype._setValue=BE;class V3 extends Ja{}V3.prototype._setValue=cy;class H3 extends Ja{}H3.prototype._setValue=uy;class G3 extends Ja{}G3.prototype._setValue=hy;class W3 extends Ja{}W3.prototype._setValue=dy;class Ay extends qi{constructor(e){super(e),this._typeIds=new iu(Int8Array,0,1),typeof e.valueToChildTypeId=="function"&&(this._valueToChildTypeId=e.valueToChildTypeId)}get typeIdToChildIndex(){return this.type.typeIdToChildIndex}append(e,t){return this.set(this.length,e,t)}set(e,t,n){return n===void 0&&(n=this._valueToChildTypeId(this,t,e)),this.setValue(e,t,n),this}setValue(e,t,n){this._typeIds.set(e,n);const r=this.type.typeIdToChildIndex[n],o=this.children[r];o==null||o.set(e,t)}addChild(e,t=`${this.children.length}`){const n=this.children.push(e),{type:{children:r,mode:o,typeIds:s}}=this,a=[...r,new tt(t,e.type)];return this.type=new Rc(o,[...s,n],a),n}_valueToChildTypeId(e,t,n){throw new Error("Cannot map UnionBuilder value to child typeId. Pass the `childTypeId` as the second argument to unionBuilder.append(), or supply a `valueToChildTypeId` function as part of the UnionBuilder constructor options.")}}class M7 extends Ay{}class N7 extends Ay{constructor(e){super(e),this._offsets=new iu(Int32Array)}setValue(e,t,n){const r=this._typeIds.set(e,n).buffer[e],o=this.getChildAt(this.type.typeIdToChildIndex[r]),s=this._offsets.set(e,o.length).buffer[e];o==null||o.set(s,t)}}class j3 extends Ka{constructor(e){super(e),this._values=new tu(Uint8Array)}get byteLength(){let e=this._pendingLength+this.length*4;return this._offsets&&(e+=this._offsets.byteLength),this._values&&(e+=this._values.byteLength),this._nulls&&(e+=this._nulls.byteLength),e}setValue(e,t){return super.setValue(e,Jc(t))}_flushPending(e,t){}}j3.prototype._flushPending=T3.prototype._flushPending;class Y3 extends Ka{constructor(e){super(e),this._values=new tu(Uint8Array)}get byteLength(){let e=this._pendingLength+this.length*4;return this._offsets&&(e+=this._offsets.byteLength),this._values&&(e+=this._values.byteLength),this._nulls&&(e+=this._nulls.byteLength),e}setValue(e,t){return super.setValue(e,Jc(t))}_flushPending(e,t){}}Y3.prototype._flushPending=A3.prototype._flushPending;class B7 extends Be{visitNull(){return P7}visitBool(){return g7}visitInt(){return mo}visitInt8(){return w7}visitInt16(){return S7}visitInt32(){return E7}visitInt64(){return C7}visitUint8(){return T7}visitUint16(){return A7}visitUint32(){return I7}visitUint64(){return k7}visitFloat(){return Sf}visitFloat16(){return b7}visitFloat32(){return v7}visitFloat64(){return x7}visitUtf8(){return j3}visitLargeUtf8(){return Y3}visitBinary(){return T3}visitLargeBinary(){return A3}visitFixedSizeBinary(){return R3}visitDate(){return wf}visitDateDay(){return I3}visitDateMillisecond(){return k3}visitTimestamp(){return Qa}visitTimestampSecond(){return F3}visitTimestampMillisecond(){return z3}visitTimestampMicrosecond(){return U3}visitTimestampNanosecond(){return $3}visitTime(){return Ja}visitTimeSecond(){return V3}visitTimeMillisecond(){return H3}visitTimeMicrosecond(){return G3}visitTimeNanosecond(){return W3}visitDecimal(){return L3}visitList(){return L7}visitStruct(){return D7}visitUnion(){return Ay}visitDenseUnion(){return N7}visitSparseUnion(){return M7}visitDictionary(){return _7}visitInterval(){return Ef}visitIntervalDayTime(){return P3}visitIntervalYearMonth(){return D3}visitDuration(){return Za}visitDurationSecond(){return M3}visitDurationMillisecond(){return N3}visitDurationMicrosecond(){return B3}visitDurationNanosecond(){return O3}visitFixedSizeList(){return y7}visitMap(){return R7}}const O7=new B7;class ye extends Be{compareSchemas(e,t){return e===t||t instanceof e.constructor&&this.compareManyFields(e.fields,t.fields)}compareManyFields(e,t){return e===t||Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every((n,r)=>this.compareFields(n,t[r]))}compareFields(e,t){return e===t||t instanceof e.constructor&&e.name===t.name&&e.nullable===t.nullable&&this.visit(e.type,t.type)}}function Mi(i,e){return e instanceof i.constructor}function ws(i,e){return i===e||Mi(i,e)}function go(i,e){return i===e||Mi(i,e)&&i.bitWidth===e.bitWidth&&i.isSigned===e.isSigned}function Cf(i,e){return i===e||Mi(i,e)&&i.precision===e.precision}function F7(i,e){return i===e||Mi(i,e)&&i.byteWidth===e.byteWidth}function Iy(i,e){return i===e||Mi(i,e)&&i.unit===e.unit}function nu(i,e){return i===e||Mi(i,e)&&i.unit===e.unit&&i.timezone===e.timezone}function ru(i,e){return i===e||Mi(i,e)&&i.unit===e.unit&&i.bitWidth===e.bitWidth}function z7(i,e){return i===e||Mi(i,e)&&i.children.length===e.children.length&&so.compareManyFields(i.children,e.children)}function U7(i,e){return i===e||Mi(i,e)&&i.children.length===e.children.length&&so.compareManyFields(i.children,e.children)}function ky(i,e){return i===e||Mi(i,e)&&i.mode===e.mode&&i.typeIds.every((t,n)=>t===e.typeIds[n])&&so.compareManyFields(i.children,e.children)}function $7(i,e){return i===e||Mi(i,e)&&i.id===e.id&&i.isOrdered===e.isOrdered&&so.visit(i.indices,e.indices)&&so.visit(i.dictionary,e.dictionary)}function Ly(i,e){return i===e||Mi(i,e)&&i.unit===e.unit}function ou(i,e){return i===e||Mi(i,e)&&i.unit===e.unit}function V7(i,e){return i===e||Mi(i,e)&&i.listSize===e.listSize&&i.children.length===e.children.length&&so.compareManyFields(i.children,e.children)}function H7(i,e){return i===e||Mi(i,e)&&i.keysSorted===e.keysSorted&&i.children.length===e.children.length&&so.compareManyFields(i.children,e.children)}ye.prototype.visitNull=ws;ye.prototype.visitBool=ws;ye.prototype.visitInt=go;ye.prototype.visitInt8=go;ye.prototype.visitInt16=go;ye.prototype.visitInt32=go;ye.prototype.visitInt64=go;ye.prototype.visitUint8=go;ye.prototype.visitUint16=go;ye.prototype.visitUint32=go;ye.prototype.visitUint64=go;ye.prototype.visitFloat=Cf;ye.prototype.visitFloat16=Cf;ye.prototype.visitFloat32=Cf;ye.prototype.visitFloat64=Cf;ye.prototype.visitUtf8=ws;ye.prototype.visitLargeUtf8=ws;ye.prototype.visitBinary=ws;ye.prototype.visitLargeBinary=ws;ye.prototype.visitFixedSizeBinary=F7;ye.prototype.visitDate=Iy;ye.prototype.visitDateDay=Iy;ye.prototype.visitDateMillisecond=Iy;ye.prototype.visitTimestamp=nu;ye.prototype.visitTimestampSecond=nu;ye.prototype.visitTimestampMillisecond=nu;ye.prototype.visitTimestampMicrosecond=nu;ye.prototype.visitTimestampNanosecond=nu;ye.prototype.visitTime=ru;ye.prototype.visitTimeSecond=ru;ye.prototype.visitTimeMillisecond=ru;ye.prototype.visitTimeMicrosecond=ru;ye.prototype.visitTimeNanosecond=ru;ye.prototype.visitDecimal=ws;ye.prototype.visitList=z7;ye.prototype.visitStruct=U7;ye.prototype.visitUnion=ky;ye.prototype.visitDenseUnion=ky;ye.prototype.visitSparseUnion=ky;ye.prototype.visitDictionary=$7;ye.prototype.visitInterval=Ly;ye.prototype.visitIntervalDayTime=Ly;ye.prototype.visitIntervalYearMonth=Ly;ye.prototype.visitDuration=ou;ye.prototype.visitDurationSecond=ou;ye.prototype.visitDurationMillisecond=ou;ye.prototype.visitDurationMicrosecond=ou;ye.prototype.visitDurationNanosecond=ou;ye.prototype.visitFixedSizeList=V7;ye.prototype.visitMap=H7;const so=new ye;function hg(i,e){return so.compareSchemas(i,e)}function G7(i,e){return so.visit(i,e)}function kd(i){const e=i.type,t=new(O7.getVisitFn(e)())(i);if(e.children&&e.children.length>0){const n=i.children||[],r={nullValues:i.nullValues},o=Array.isArray(n)?((s,a)=>n[a]||r):(({name:s})=>n[s]||r);for(const[s,a]of e.children.entries()){const{type:l}=a,c=o(a,s);t.children.push(kd(Object.assign(Object.assign({},c),{type:l})))}}return t}function Jr(i,e){if(i instanceof Je||i instanceof Ce||i.type instanceof ce||ArrayBuffer.isView(i))return x3(i);const t={type:Ah(i),nullValues:[null]},n=[...j7(t)(i)],r=n.length===1?n[0]:n.reduce((o,s)=>o.concat(s));return ce.isDictionary(r.type)?r.memoize():r}function W7(i){const e=Jr(i),t=new Ti(new st(e.type.children),e.data[0]);return new mt(t)}function Ah(i){if(i.length===0)return new oo;let e=0,t=0,n=0,r=0,o=0,s=0,a=0,l=0;for(const c of i){if(c==null){++e;continue}switch(typeof c){case"bigint":++s;continue;case"boolean":++a;continue;case"number":++r;continue;case"string":++o;continue;case"object":Array.isArray(c)?++t:Object.prototype.toString.call(c)==="[object Date]"?++l:++n;continue}throw new TypeError("Unable to infer Vector type from input values, explicit type declaration expected.")}if(r+e===i.length)return new ty;if(o+e===i.length)return new Uo(new Ic,new gs);if(s+e===i.length)return new ey;if(a+e===i.length)return new kc;if(l+e===i.length)return new s6;if(t+e===i.length){const c=i,u=Ah(c[c.findIndex(h=>h!=null)]);if(c.every(h=>h==null||G7(u,Ah(h))))return new Na(new tt("",u,!0))}else if(n+e===i.length){const c=new Map;for(const u of i)for(const h of Object.keys(u))!c.has(h)&&u[h]!=null&&c.set(h,new tt(h,Ah([u[h]]),!0));return new ri([...c.values()])}throw new TypeError("Unable to infer Vector type from input values, explicit type declaration expected.")}function j7(i){const{["queueingStrategy"]:e="count"}=i,{["highWaterMark"]:t=e!=="bytes"?Number.POSITIVE_INFINITY:Math.pow(2,14)}=i,n=e!=="bytes"?"length":"byteLength";return function*(r){let o=0;const s=kd(i);for(const a of r)s.append(a)[n]>=t&&++o&&(yield s.toVector());(s.finish().length>0||o===0)&&(yield s.toVector())}}function xp(i,e){return Y7(i,e.map(t=>t.data.concat()))}function Y7(i,e){const t=[...i.fields],n=[],r={numBatches:e.reduce((h,d)=>Math.max(h,d.length),0)};let o=0,s=0,a=-1;const l=e.length;let c,u=[];for(;r.numBatches-- >0;){for(s=Number.POSITIVE_INFINITY,a=-1;++a<l;)u[a]=c=e[a].shift(),s=Math.min(s,c?c.length:s);Number.isFinite(s)&&(u=q7(t,s,u,e,r),s>0&&(n[o++]=be({type:new ri(t),length:s,nullCount:0,children:u.slice()})))}return[i=i.assign(t),n.map(h=>new Ti(i,h))]}function q7(i,e,t,n,r){var o;const s=(e+63&-64)>>3;for(let a=-1,l=n.length;++a<l;){const c=t[a],u=c==null?void 0:c.length;if(u>=e)u===e?t[a]=c:(t[a]=c.slice(0,e),r.numBatches=Math.max(r.numBatches,n[a].unshift(c.slice(e,u-e))));else{const h=i[a];i[a]=h.clone({nullable:!0}),t[a]=(o=c==null?void 0:c._changeLengthAndBackfillNullBitmap(e))!==null&&o!==void 0?o:be({type:h.type,length:e,nullCount:e,nullBitmap:new Uint8Array(s)})}}return t}var q3;class mt{constructor(...e){var t,n;if(e.length===0)return this.batches=[],this.schema=new st([]),this._offsets=[0],this;let r,o;e[0]instanceof st&&(r=e.shift()),e.at(-1)instanceof Uint32Array&&(o=e.pop());const s=l=>{if(l){if(l instanceof Ti)return[l];if(l instanceof mt)return l.batches;if(l instanceof Je){if(l.type instanceof ri)return[new Ti(new st(l.type.children),l)]}else{if(Array.isArray(l))return l.flatMap(c=>s(c));if(typeof l[Symbol.iterator]=="function")return[...l].flatMap(c=>s(c));if(typeof l=="object"){const c=Object.keys(l),u=c.map(f=>new Ce([l[f]])),h=r??new st(c.map((f,p)=>new tt(String(f),u[p].type,u[p].nullable))),[,d]=xp(h,u);return d.length===0?[new Ti(l)]:d}}}return[]},a=e.flatMap(l=>s(l));if(r=(n=r??((t=a[0])===null||t===void 0?void 0:t.schema))!==null&&n!==void 0?n:new st([]),!(r instanceof st))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");for(const l of a){if(!(l instanceof Ti))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");if(!hg(r,l.schema))throw new TypeError("Table and inner RecordBatch schemas must be equivalent.")}this.schema=r,this.batches=a,this._offsets=o??f3(this.data)}get data(){return this.batches.map(({data:e})=>e)}get numCols(){return this.schema.fields.length}get numRows(){return this.data.reduce((e,t)=>e+t.length,0)}get nullCount(){return this._nullCount===-1&&(this._nullCount=d3(this.data)),this._nullCount}isValid(e){return!1}get(e){return null}at(e){return this.get(vy(e,this.numRows))}set(e,t){}indexOf(e,t){return-1}[Symbol.iterator](){return this.batches.length>0?Ey.visit(new Ce(this.data)):new Array(0)[Symbol.iterator]()}toArray(){return[...this]}toString(){return`[
  ${this.toArray().join(`,
  `)}
]`}concat(...e){const t=this.schema,n=this.data.concat(e.flatMap(({data:r})=>r));return new mt(t,n.map(r=>new Ti(t,r)))}slice(e,t){const n=this.schema;[e,t]=u3({length:this.numRows},e,t);const r=p3(this.data,this._offsets,e,t);return new mt(n,r.map(o=>new Ti(n,o)))}getChild(e){return this.getChildAt(this.schema.fields.findIndex(t=>t.name===e))}getChildAt(e){if(e>-1&&e<this.schema.fields.length){const t=this.data.map(n=>n.children[e]);if(t.length===0){const{type:n}=this.schema.fields[e],r=be({type:n,length:0,nullCount:0});t.push(r._changeLengthAndBackfillNullBitmap(this.numRows))}return new Ce(t)}return null}setChild(e,t){var n;return this.setChildAt((n=this.schema.fields)===null||n===void 0?void 0:n.findIndex(r=>r.name===e),t)}setChildAt(e,t){let n=this.schema,r=[...this.batches];if(e>-1&&e<this.numCols){t||(t=new Ce([be({type:new oo,length:this.numRows})]));const o=n.fields.slice(),s=o[e].clone({type:t.type}),a=this.schema.fields.map((l,c)=>this.getChildAt(c));[o[e],a[e]]=[s,t],[n,r]=xp(n,a)}return new mt(n,r)}select(e){const t=this.schema.fields.reduce((n,r,o)=>n.set(r.name,o),new Map);return this.selectAt(e.map(n=>t.get(n)).filter(n=>n>-1))}selectAt(e){const t=this.schema.selectAt(e),n=this.batches.map(r=>r.selectAt(e));return new mt(t,n)}assign(e){const t=this.schema.fields,[n,r]=e.schema.fields.reduce((a,l,c)=>{const[u,h]=a,d=t.findIndex(f=>f.name===l.name);return~d?h[d]=c:u.push(c),a},[[],[]]),o=this.schema.assign(e.schema),s=[...t.map((a,l)=>[l,r[l]]).map(([a,l])=>l===void 0?this.getChildAt(a):e.getChildAt(l)),...n.map(a=>e.getChildAt(a))].filter(Boolean);return new mt(...xp(o,s))}}q3=Symbol.toStringTag;mt[q3]=(i=>(i.schema=null,i.batches=[],i._offsets=new Uint32Array([0]),i._nullCount=-1,i[Symbol.isConcatSpreadable]=!0,i.isValid=Ed(Sy),i.get=Ed(ji.getVisitFn(S.Struct)),i.set=m3(kn.getVisitFn(S.Struct)),i.indexOf=g3(Cd.getVisitFn(S.Struct)),"Table"))(mt.prototype);function X3(i){const e={},t=Object.entries(i);for(const[n,r]of t)e[n]=Jr(r);return new mt(e)}var K3;let Ti=class ec{constructor(...e){switch(e.length){case 2:{if([this.schema]=e,!(this.schema instanceof st))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");if([,this.data=be({nullCount:0,type:new ri(this.schema.fields),children:this.schema.fields.map(t=>be({type:t.type,nullCount:0}))})]=e,!(this.data instanceof Je))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");[this.schema,this.data]=E0(this.schema,this.data.children);break}case 1:{const[t]=e,{fields:n,children:r,length:o}=Object.keys(t).reduce((l,c,u)=>(l.children[u]=t[c],l.length=Math.max(l.length,t[c].length),l.fields[u]=tt.new({name:c,type:t[c].type,nullable:!0}),l),{length:0,fields:new Array,children:new Array}),s=new st(n),a=be({type:new ri(n),length:o,children:r,nullCount:0});[this.schema,this.data]=E0(s,a.children,o);break}default:throw new TypeError("RecordBatch constructor expects an Object mapping names to child Data, or a [Schema, Data] pair.")}}get dictionaries(){return this._dictionaries||(this._dictionaries=Z3(this.schema.fields,this.data.children))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.length}get nullCount(){return this.data.nullCount}isValid(e){return this.data.getValid(e)}get(e){return ji.visit(this.data,e)}at(e){return this.get(vy(e,this.numRows))}set(e,t){return kn.visit(this.data,e,t)}indexOf(e,t){return Cd.visit(this.data,e,t)}[Symbol.iterator](){return Ey.visit(new Ce([this.data]))}toArray(){return[...this]}concat(...e){return new mt(this.schema,[this,...e])}slice(e,t){const[n]=new Ce([this.data]).slice(e,t).data;return new ec(this.schema,n)}getChild(e){var t;return this.getChildAt((t=this.schema.fields)===null||t===void 0?void 0:t.findIndex(n=>n.name===e))}getChildAt(e){return e>-1&&e<this.schema.fields.length?new Ce([this.data.children[e]]):null}setChild(e,t){var n;return this.setChildAt((n=this.schema.fields)===null||n===void 0?void 0:n.findIndex(r=>r.name===e),t)}setChildAt(e,t){let n=this.schema,r=this.data;if(e>-1&&e<this.numCols){t||(t=new Ce([be({type:new oo,length:this.numRows})]));const o=n.fields.slice(),s=r.children.slice(),a=o[e].clone({type:t.type});[o[e],s[e]]=[a,t.data[0]],n=new st(o,new Map(this.schema.metadata)),r=be({type:new ri(o),children:s})}return new ec(n,r)}select(e){const t=this.schema.select(e),n=new ri(t.fields),r=[];for(const o of e){const s=this.schema.fields.findIndex(a=>a.name===o);~s&&(r[s]=this.data.children[s])}return new ec(t,be({type:n,length:this.numRows,children:r}))}selectAt(e){const t=this.schema.selectAt(e),n=e.map(o=>this.data.children[o]).filter(Boolean),r=be({type:new ri(t.fields),length:this.numRows,children:n});return new ec(t,r)}};K3=Symbol.toStringTag;Ti[K3]=(i=>(i._nullCount=-1,i[Symbol.isConcatSpreadable]=!0,"RecordBatch"))(Ti.prototype);function E0(i,e,t=e.reduce((n,r)=>Math.max(n,r.length),0)){var n;const r=[...i.fields],o=[...e],s=(t+63&-64)>>3;for(const[a,l]of i.fields.entries()){const c=e[a];(!c||c.length!==t)&&(r[a]=l.clone({nullable:!0}),o[a]=(n=c==null?void 0:c._changeLengthAndBackfillNullBitmap(t))!==null&&n!==void 0?n:be({type:l.type,length:t,nullCount:t,nullBitmap:new Uint8Array(s)}))}return[i.assign(r),be({type:new ri(r),length:t,children:o})]}function Z3(i,e,t=new Map){var n,r;if(((n=i==null?void 0:i.length)!==null&&n!==void 0?n:0)>0&&(i==null?void 0:i.length)===(e==null?void 0:e.length))for(let o=-1,s=i.length;++o<s;){const{type:a}=i[o],l=e[o];for(const c of[l,...((r=l==null?void 0:l.dictionary)===null||r===void 0?void 0:r.data)||[]])Z3(a.children,c==null?void 0:c.children,t);if(ce.isDictionary(a)){const{id:c}=a;if(!t.has(c))l!=null&&l.dictionary&&t.set(c,l.dictionary);else if(t.get(c)!==l.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}}return t}class Ry extends Ti{constructor(e){const t=e.fields.map(r=>be({type:r.type})),n=be({type:new ri(e.fields),nullCount:0,children:t});super(e,n)}}let bo=class nr{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsMessage(e,t){return(t||new nr).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsMessage(e,t){return e.setPosition(e.position()+lt),(t||new nr).__init(e.readInt32(e.position())+e.position(),e)}version(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):zt.V1}headerType(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):et.NONE}header(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__union(e,this.bb_pos+t):null}bodyLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}customMetadata(e,t){const n=this.bb.__offset(this.bb_pos,12);return n?(t||new Xt).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}static startMessage(e){e.startObject(5)}static addVersion(e,t){e.addFieldInt16(0,t,zt.V1)}static addHeaderType(e,t){e.addFieldInt8(1,t,et.NONE)}static addHeader(e,t){e.addFieldOffset(2,t,0)}static addBodyLength(e,t){e.addFieldInt64(3,t,BigInt("0"))}static addCustomMetadata(e,t){e.addFieldOffset(4,t,0)}static createCustomMetadataVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startCustomMetadataVector(e,t){e.startVector(4,t,4)}static endMessage(e){return e.endObject()}static finishMessageBuffer(e,t){e.finish(t)}static finishSizePrefixedMessageBuffer(e,t){e.finish(t,void 0,!0)}static createMessage(e,t,n,r,o,s){return nr.startMessage(e),nr.addVersion(e,t),nr.addHeaderType(e,n),nr.addHeader(e,r),nr.addBodyLength(e,o),nr.addCustomMetadata(e,s),nr.endMessage(e)}};class X7 extends Be{visit(e,t){return e==null||t==null?void 0:super.visit(e,t)}visitNull(e,t){return p0.startNull(t),p0.endNull(t)}visitInt(e,t){return on.startInt(t),on.addBitWidth(t,e.bitWidth),on.addIsSigned(t,e.isSigned),on.endInt(t)}visitFloat(e,t){return hr.startFloatingPoint(t),hr.addPrecision(t,e.precision),hr.endFloatingPoint(t)}visitBinary(e,t){return c0.startBinary(t),c0.endBinary(t)}visitLargeBinary(e,t){return h0.startLargeBinary(t),h0.endLargeBinary(t)}visitBool(e,t){return u0.startBool(t),u0.endBool(t)}visitUtf8(e,t){return m0.startUtf8(t),m0.endUtf8(t)}visitLargeUtf8(e,t){return d0.startLargeUtf8(t),d0.endLargeUtf8(t)}visitDecimal(e,t){return Qs.startDecimal(t),Qs.addScale(t,e.scale),Qs.addPrecision(t,e.precision),Qs.addBitWidth(t,e.bitWidth),Qs.endDecimal(t)}visitDate(e,t){return vh.startDate(t),vh.addUnit(t,e.unit),vh.endDate(t)}visitTime(e,t){return bn.startTime(t),bn.addUnit(t,e.unit),bn.addBitWidth(t,e.bitWidth),bn.endTime(t)}visitTimestamp(e,t){const n=e.timezone&&t.createString(e.timezone)||void 0;return vn.startTimestamp(t),vn.addUnit(t,e.unit),n!==void 0&&vn.addTimezone(t,n),vn.endTimestamp(t)}visitInterval(e,t){return dr.startInterval(t),dr.addUnit(t,e.unit),dr.endInterval(t)}visitDuration(e,t){return xh.startDuration(t),xh.addUnit(t,e.unit),xh.endDuration(t)}visitList(e,t){return f0.startList(t),f0.endList(t)}visitStruct(e,t){return ns.startStruct_(t),ns.endStruct_(t)}visitUnion(e,t){Ui.startTypeIdsVector(t,e.typeIds.length);const n=Ui.createTypeIdsVector(t,e.typeIds);return Ui.startUnion(t),Ui.addMode(t,e.mode),Ui.addTypeIds(t,n),Ui.endUnion(t)}visitDictionary(e,t){const n=this.visit(e.indices,t);return Qr.startDictionaryEncoding(t),Qr.addId(t,BigInt(e.id)),Qr.addIsOrdered(t,e.isOrdered),n!==void 0&&Qr.addIndexType(t,n),Qr.endDictionaryEncoding(t)}visitFixedSizeBinary(e,t){return wh.startFixedSizeBinary(t),wh.addByteWidth(t,e.byteWidth),wh.endFixedSizeBinary(t)}visitFixedSizeList(e,t){return Sh.startFixedSizeList(t),Sh.addListSize(t,e.listSize),Sh.endFixedSizeList(t)}visitMap(e,t){return Eh.startMap(t),Eh.addKeysSorted(t,e.keysSorted),Eh.endMap(t)}}const wp=new X7;function K7(i,e=new Map){return new st(Q7(i,e),Ih(i.metadata),e)}function Q3(i){return new ln(i.count,J3(i.columns),eC(i.columns))}function Z7(i){return new Er(Q3(i.data),i.id,i.isDelta)}function Q7(i,e){return(i.fields||[]).filter(Boolean).map(t=>tt.fromJSON(t,e))}function C0(i,e){return(i.children||[]).filter(Boolean).map(t=>tt.fromJSON(t,e))}function J3(i){return(i||[]).reduce((e,t)=>[...e,new Vo(t.count,J7(t.VALIDITY)),...J3(t.children)],[])}function eC(i,e=[]){for(let t=-1,n=(i||[]).length;++t<n;){const r=i[t];r.VALIDITY&&e.push(new gr(e.length,r.VALIDITY.length)),r.TYPE_ID&&e.push(new gr(e.length,r.TYPE_ID.length)),r.OFFSET&&e.push(new gr(e.length,r.OFFSET.length)),r.DATA&&e.push(new gr(e.length,r.DATA.length)),e=eC(r.children,e)}return e}function J7(i){return(i||[]).reduce((e,t)=>e+ +(t===0),0)}function ez(i,e){let t,n,r,o,s,a;return!e||!(o=i.dictionary)?(s=A0(i,C0(i,e)),r=new tt(i.name,s,i.nullable,Ih(i.metadata))):e.has(t=o.id)?(n=(n=o.indexType)?T0(n):new gs,a=new Uo(e.get(t),n,t,o.isOrdered),r=new tt(i.name,a,i.nullable,Ih(i.metadata))):(n=(n=o.indexType)?T0(n):new gs,e.set(t,s=A0(i,C0(i,e))),a=new Uo(s,n,t,o.isOrdered),r=new tt(i.name,a,i.nullable,Ih(i.metadata))),r||null}function Ih(i=[]){return new Map(i.map(({key:e,value:t})=>[e,t]))}function T0(i){return new Wi(i.isSigned,i.bitWidth)}function A0(i,e){const t=i.type.name;switch(t){case"NONE":return new oo;case"null":return new oo;case"binary":return new fd;case"largebinary":return new pd;case"utf8":return new Ic;case"largeutf8":return new md;case"bool":return new kc;case"list":return new Na((e||[])[0]);case"struct":return new ri(e||[]);case"struct_":return new ri(e||[])}switch(t){case"int":{const n=i.type;return new Wi(n.isSigned,n.bitWidth)}case"floatingpoint":{const n=i.type;return new Ma(Jt[n.precision])}case"decimal":{const n=i.type;return new gd(n.scale,n.precision,n.bitWidth)}case"date":{const n=i.type;return new _d(In[n.unit])}case"time":{const n=i.type;return new yd(pe[n.unit],n.bitWidth)}case"timestamp":{const n=i.type;return new Lc(pe[n.unit],n.timezone)}case"interval":{const n=i.type;return new bd(Sr[n.unit])}case"duration":{const n=i.type;return new vd(pe[n.unit])}case"union":{const n=i.type,[r,...o]=(n.mode+"").toLowerCase(),s=r.toUpperCase()+o.join("");return new Rc(vi[s],n.typeIds||[],e||[])}case"fixedsizebinary":{const n=i.type;return new xd(n.byteWidth)}case"fixedsizelist":{const n=i.type;return new Pc(n.listSize,(e||[])[0])}case"map":{const n=i.type;return new Dc((e||[])[0],n.keysSorted)}}throw new Error(`Unrecognized type: "${t}"`)}var tz=W2,iz=Pa;class Ai{static fromJSON(e,t){const n=new Ai(0,zt.V5,t);return n._createHeader=nz(e,t),n}static decode(e){e=new iz(ze(e));const t=bo.getRootAsMessage(e),n=t.bodyLength(),r=t.version(),o=t.headerType(),s=new Ai(n,r,o);return s._createHeader=rz(t,o),s}static encode(e){const t=new tz;let n=-1;return e.isSchema()?n=st.encode(t,e.header()):e.isRecordBatch()?n=ln.encode(t,e.header()):e.isDictionaryBatch()&&(n=Er.encode(t,e.header())),bo.startMessage(t),bo.addVersion(t,zt.V5),bo.addHeader(t,n),bo.addHeaderType(t,e.headerType),bo.addBodyLength(t,BigInt(e.bodyLength)),bo.finishMessageBuffer(t,bo.endMessage(t)),t.asUint8Array()}static from(e,t=0){if(e instanceof st)return new Ai(0,zt.V5,et.Schema,e);if(e instanceof ln)return new Ai(t,zt.V5,et.RecordBatch,e);if(e instanceof Er)return new Ai(t,zt.V5,et.DictionaryBatch,e);throw new Error(`Unrecognized Message header: ${e}`)}get type(){return this.headerType}get version(){return this._version}get headerType(){return this._headerType}get bodyLength(){return this._bodyLength}header(){return this._createHeader()}isSchema(){return this.headerType===et.Schema}isRecordBatch(){return this.headerType===et.RecordBatch}isDictionaryBatch(){return this.headerType===et.DictionaryBatch}constructor(e,t,n,r){this._version=t,this._headerType=n,this.body=new Uint8Array(0),r&&(this._createHeader=()=>r),this._bodyLength=bt(e)}}class ln{get nodes(){return this._nodes}get length(){return this._length}get buffers(){return this._buffers}constructor(e,t,n){this._nodes=t,this._buffers=n,this._length=bt(e)}}class Er{get id(){return this._id}get data(){return this._data}get isDelta(){return this._isDelta}get length(){return this.data.length}get nodes(){return this.data.nodes}get buffers(){return this.data.buffers}constructor(e,t,n=!1){this._data=e,this._isDelta=n,this._id=bt(t)}}class gr{constructor(e,t){this.offset=bt(e),this.length=bt(t)}}class Vo{constructor(e,t){this.length=bt(e),this.nullCount=bt(t)}}function nz(i,e){return(()=>{switch(e){case et.Schema:return st.fromJSON(i);case et.RecordBatch:return ln.fromJSON(i);case et.DictionaryBatch:return Er.fromJSON(i)}throw new Error(`Unrecognized Message type: { name: ${et[e]}, type: ${e} }`)})}function rz(i,e){return(()=>{switch(e){case et.Schema:return st.decode(i.header(new sr),new Map,i.version());case et.RecordBatch:return ln.decode(i.header(new Gr),i.version());case et.DictionaryBatch:return Er.decode(i.header(new Ks),i.version())}throw new Error(`Unrecognized Message type: { name: ${et[e]}, type: ${e} }`)})}tt.encode=mz;tt.decode=fz;tt.fromJSON=ez;st.encode=pz;st.decode=oz;st.fromJSON=K7;ln.encode=gz;ln.decode=sz;ln.fromJSON=Q3;Er.encode=_z;Er.decode=az;Er.fromJSON=Z7;Vo.encode=yz;Vo.decode=cz;gr.encode=bz;gr.decode=lz;function oz(i,e=new Map,t=zt.V5){const n=dz(i,e);return new st(n,kh(i),e,t)}function sz(i,e=zt.V5){if(i.compression()!==null)throw new Error("Record batch compression not implemented");return new ln(i.length(),uz(i),hz(i,e))}function az(i,e=zt.V5){return new Er(ln.decode(i.data(),e),i.id(),i.isDelta())}function lz(i){return new gr(i.offset(),i.length())}function cz(i){return new Vo(i.length(),i.nullCount())}function uz(i){const e=[];for(let t,n=-1,r=-1,o=i.nodesLength();++n<o;)(t=i.nodes(n))&&(e[++r]=Vo.decode(t));return e}function hz(i,e){const t=[];for(let n,r=-1,o=-1,s=i.buffersLength();++r<s;)(n=i.buffers(r))&&(e<zt.V4&&(n.bb_pos+=8*(r+1)),t[++o]=gr.decode(n));return t}function dz(i,e){const t=[];for(let n,r=-1,o=-1,s=i.fieldsLength();++r<s;)(n=i.fields(r))&&(t[++o]=tt.decode(n,e));return t}function I0(i,e){const t=[];for(let n,r=-1,o=-1,s=i.childrenLength();++r<s;)(n=i.children(r))&&(t[++o]=tt.decode(n,e));return t}function fz(i,e){let t,n,r,o,s,a;return!e||!(a=i.dictionary())?(r=L0(i,I0(i,e)),n=new tt(i.name(),r,i.nullable(),kh(i))):e.has(t=bt(a.id()))?(o=(o=a.indexType())?k0(o):new gs,s=new Uo(e.get(t),o,t,a.isOrdered()),n=new tt(i.name(),s,i.nullable(),kh(i))):(o=(o=a.indexType())?k0(o):new gs,e.set(t,r=L0(i,I0(i,e))),s=new Uo(r,o,t,a.isOrdered()),n=new tt(i.name(),s,i.nullable(),kh(i))),n||null}function kh(i){const e=new Map;if(i)for(let t,n,r=-1,o=Math.trunc(i.customMetadataLength());++r<o;)(t=i.customMetadata(r))&&(n=t.key())!=null&&e.set(n,t.value());return e}function k0(i){return new Wi(i.isSigned(),i.bitWidth())}function L0(i,e){const t=i.typeType();switch(t){case wt.NONE:return new oo;case wt.Null:return new oo;case wt.Binary:return new fd;case wt.LargeBinary:return new pd;case wt.Utf8:return new Ic;case wt.LargeUtf8:return new md;case wt.Bool:return new kc;case wt.List:return new Na((e||[])[0]);case wt.Struct_:return new ri(e||[])}switch(t){case wt.Int:{const n=i.type(new on);return new Wi(n.isSigned(),n.bitWidth())}case wt.FloatingPoint:{const n=i.type(new hr);return new Ma(n.precision())}case wt.Decimal:{const n=i.type(new Qs);return new gd(n.scale(),n.precision(),n.bitWidth())}case wt.Date:{const n=i.type(new vh);return new _d(n.unit())}case wt.Time:{const n=i.type(new bn);return new yd(n.unit(),n.bitWidth())}case wt.Timestamp:{const n=i.type(new vn);return new Lc(n.unit(),n.timezone())}case wt.Interval:{const n=i.type(new dr);return new bd(n.unit())}case wt.Duration:{const n=i.type(new xh);return new vd(n.unit())}case wt.Union:{const n=i.type(new Ui);return new Rc(n.mode(),n.typeIdsArray()||[],e||[])}case wt.FixedSizeBinary:{const n=i.type(new wh);return new xd(n.byteWidth())}case wt.FixedSizeList:{const n=i.type(new Sh);return new Pc(n.listSize(),(e||[])[0])}case wt.Map:{const n=i.type(new Eh);return new Dc((e||[])[0],n.keysSorted())}}throw new Error(`Unrecognized type: "${wt[t]}" (${t})`)}function pz(i,e){const t=e.fields.map(o=>tt.encode(i,o));sr.startFieldsVector(i,t.length);const n=sr.createFieldsVector(i,t),r=e.metadata&&e.metadata.size>0?sr.createCustomMetadataVector(i,[...e.metadata].map(([o,s])=>{const a=i.createString(`${o}`),l=i.createString(`${s}`);return Xt.startKeyValue(i),Xt.addKey(i,a),Xt.addValue(i,l),Xt.endKeyValue(i)})):-1;return sr.startSchema(i),sr.addFields(i,n),sr.addEndianness(i,vz?Da.Little:Da.Big),r!==-1&&sr.addCustomMetadata(i,r),sr.endSchema(i)}function mz(i,e){let t=-1,n=-1,r=-1;const o=e.type;let s=e.typeId;ce.isDictionary(o)?(s=o.dictionary.typeId,r=wp.visit(o,i),n=wp.visit(o.dictionary,i)):n=wp.visit(o,i);const a=(o.children||[]).map(u=>tt.encode(i,u)),l=gn.createChildrenVector(i,a),c=e.metadata&&e.metadata.size>0?gn.createCustomMetadataVector(i,[...e.metadata].map(([u,h])=>{const d=i.createString(`${u}`),f=i.createString(`${h}`);return Xt.startKeyValue(i),Xt.addKey(i,d),Xt.addValue(i,f),Xt.endKeyValue(i)})):-1;return e.name&&(t=i.createString(e.name)),gn.startField(i),gn.addType(i,n),gn.addTypeType(i,s),gn.addChildren(i,l),gn.addNullable(i,!!e.nullable),t!==-1&&gn.addName(i,t),r!==-1&&gn.addDictionary(i,r),c!==-1&&gn.addCustomMetadata(i,c),gn.endField(i)}function gz(i,e){const t=e.nodes||[],n=e.buffers||[];Gr.startNodesVector(i,t.length);for(const s of t.slice().reverse())Vo.encode(i,s);const r=i.endVector();Gr.startBuffersVector(i,n.length);for(const s of n.slice().reverse())gr.encode(i,s);const o=i.endVector();return Gr.startRecordBatch(i),Gr.addLength(i,BigInt(e.length)),Gr.addNodes(i,r),Gr.addBuffers(i,o),Gr.endRecordBatch(i)}function _z(i,e){const t=ln.encode(i,e.data);return Ks.startDictionaryBatch(i),Ks.addId(i,BigInt(e.id)),Ks.addIsDelta(i,e.isDelta),Ks.addData(i,t),Ks.endDictionaryBatch(i)}function yz(i,e){return q2.createFieldNode(i,BigInt(e.length),BigInt(e.nullCount))}function bz(i,e){return Y2.createBuffer(i,BigInt(e.offset),BigInt(e.length))}const vz=(()=>{const i=new ArrayBuffer(2);return new DataView(i).setInt16(0,256,!0),new Int16Array(i)[0]===256})(),Py=i=>`Expected ${et[i]} Message in stream, but was null or length 0.`,Dy=i=>`Header pointer of flatbuffer-encoded ${et[i]} Message is null or length 0.`,tC=(i,e)=>`Expected to read ${i} metadata bytes, but only read ${e}.`,iC=(i,e)=>`Expected to read ${i} bytes for message body, but only read ${e}.`;class nC{constructor(e){this.source=e instanceof Ad?e:new Ad(e)}[Symbol.iterator](){return this}next(){let e;return(e=this.readMetadataLength()).done||e.value===-1&&(e=this.readMetadataLength()).done||(e=this.readMetadata(e.value)).done?Pt:e}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}readMessage(e){let t;if((t=this.next()).done)return null;if(e!=null&&t.value.headerType!==e)throw new Error(Py(e));return t.value}readMessageBody(e){if(e<=0)return new Uint8Array(0);const t=ze(this.source.read(e));if(t.byteLength<e)throw new Error(iC(e,t.byteLength));return t.byteOffset%8===0&&t.byteOffset+t.byteLength<=t.buffer.byteLength?t:t.slice()}readSchema(e=!1){const t=et.Schema,n=this.readMessage(t),r=n==null?void 0:n.header();if(e&&!r)throw new Error(Dy(t));return r}readMetadataLength(){const e=this.source.read(Tf),t=e&&new Pa(e),n=(t==null?void 0:t.readInt32(0))||0;return{done:n===0,value:n}}readMetadata(e){const t=this.source.read(e);if(!t)return Pt;if(t.byteLength<e)throw new Error(tC(e,t.byteLength));return{done:!1,value:Ai.decode(t)}}}class xz{constructor(e,t){this.source=e instanceof Ba?e:z2(e)?new Id(e,t):new Ba(e)}[Symbol.asyncIterator](){return this}next(){return ke(this,void 0,void 0,function*(){let e;return(e=yield this.readMetadataLength()).done||e.value===-1&&(e=yield this.readMetadataLength()).done||(e=yield this.readMetadata(e.value)).done?Pt:e})}throw(e){return ke(this,void 0,void 0,function*(){return yield this.source.throw(e)})}return(e){return ke(this,void 0,void 0,function*(){return yield this.source.return(e)})}readMessage(e){return ke(this,void 0,void 0,function*(){let t;if((t=yield this.next()).done)return null;if(e!=null&&t.value.headerType!==e)throw new Error(Py(e));return t.value})}readMessageBody(e){return ke(this,void 0,void 0,function*(){if(e<=0)return new Uint8Array(0);const t=ze(yield this.source.read(e));if(t.byteLength<e)throw new Error(iC(e,t.byteLength));return t.byteOffset%8===0&&t.byteOffset+t.byteLength<=t.buffer.byteLength?t:t.slice()})}readSchema(){return ke(this,arguments,void 0,function*(e=!1){const t=et.Schema,n=yield this.readMessage(t),r=n==null?void 0:n.header();if(e&&!r)throw new Error(Dy(t));return r})}readMetadataLength(){return ke(this,void 0,void 0,function*(){const e=yield this.source.read(Tf),t=e&&new Pa(e),n=(t==null?void 0:t.readInt32(0))||0;return{done:n===0,value:n}})}readMetadata(e){return ke(this,void 0,void 0,function*(){const t=yield this.source.read(e);if(!t)return Pt;if(t.byteLength<e)throw new Error(tC(e,t.byteLength));return{done:!1,value:Ai.decode(t)}})}}class wz extends nC{constructor(e){super(new Uint8Array(0)),this._schema=!1,this._body=[],this._batchIndex=0,this._dictionaryIndex=0,this._json=e instanceof w0?e:new w0(e)}next(){const{_json:e}=this;if(!this._schema)return this._schema=!0,{done:!1,value:Ai.fromJSON(e.schema,et.Schema)};if(this._dictionaryIndex<e.dictionaries.length){const t=e.dictionaries[this._dictionaryIndex++];return this._body=t.data.columns,{done:!1,value:Ai.fromJSON(t,et.DictionaryBatch)}}if(this._batchIndex<e.batches.length){const t=e.batches[this._batchIndex++];return this._body=t.columns,{done:!1,value:Ai.fromJSON(t,et.RecordBatch)}}return this._body=[],Pt}readMessageBody(e){return t(this._body);function t(n){return(n||[]).reduce((r,o)=>[...r,...o.VALIDITY&&[o.VALIDITY]||[],...o.TYPE_ID&&[o.TYPE_ID]||[],...o.OFFSET&&[o.OFFSET]||[],...o.DATA&&[o.DATA]||[],...t(o.children)],[])}}readMessage(e){let t;if((t=this.next()).done)return null;if(e!=null&&t.value.headerType!==e)throw new Error(Py(e));return t.value}readSchema(){const e=et.Schema,t=this.readMessage(e),n=t==null?void 0:t.header();if(!t||!n)throw new Error(Dy(e));return n}}const Tf=4,dg="ARROW1",Nc=new Uint8Array(dg.length);for(let i=0;i<dg.length;i+=1)Nc[i]=dg.codePointAt(i);function My(i,e=0){for(let t=-1,n=Nc.length;++t<n;)if(Nc[t]!==i[e+t])return!1;return!0}const su=Nc.length,rC=su+Tf,Sz=su*2+Tf;class si extends Cy{constructor(e){super(),this._impl=e}get closed(){return this._impl.closed}get schema(){return this._impl.schema}get autoDestroy(){return this._impl.autoDestroy}get dictionaries(){return this._impl.dictionaries}get numDictionaries(){return this._impl.numDictionaries}get numRecordBatches(){return this._impl.numRecordBatches}get footer(){return this._impl.isFile()?this._impl.footer:null}isSync(){return this._impl.isSync()}isAsync(){return this._impl.isAsync()}isFile(){return this._impl.isFile()}isStream(){return this._impl.isStream()}next(){return this._impl.next()}throw(e){return this._impl.throw(e)}return(e){return this._impl.return(e)}cancel(){return this._impl.cancel()}reset(e){return this._impl.reset(e),this._DOMStream=void 0,this._nodeStream=void 0,this}open(e){const t=this._impl.open(e);return zo(t)?t.then(()=>this):this}readRecordBatch(e){return this._impl.isFile()?this._impl.readRecordBatch(e):null}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}toDOMStream(){return yn.toDOMStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this})}toNodeStream(){return yn.toNodeStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this},{objectMode:!0})}static throughNode(e){throw new Error('"throughNode" not available in this environment')}static throughDOM(e,t){throw new Error('"throughDOM" not available in this environment')}static from(e){return e instanceof si?e:tg(e)?Az(e):z2(e)?Lz(e):zo(e)?ke(this,void 0,void 0,function*(){return yield si.from(yield e)}):U2(e)||Z_(e)||$2(e)||qa(e)?kz(new Ba(e)):Iz(new Ad(e))}static readAll(e){return e instanceof si?e.isSync()?R0(e):P0(e):tg(e)||ArrayBuffer.isView(e)||eu(e)||F2(e)?R0(e):P0(e)}}class Ld extends si{constructor(e){super(e),this._impl=e}readAll(){return[...this]}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return mr(this,arguments,function*(){yield Ne(yield*bh(ss(this[Symbol.iterator]())))})}}class Rd extends si{constructor(e){super(e),this._impl=e}readAll(){return ke(this,void 0,void 0,function*(){var e,t,n,r;const o=new Array;try{for(var s=!0,a=ss(this),l;l=yield a.next(),e=l.done,!e;s=!0){r=l.value,s=!1;const c=r;o.push(c)}}catch(c){t={error:c}}finally{try{!s&&!e&&(n=a.return)&&(yield n.call(a))}finally{if(t)throw t.error}}return o})}[Symbol.iterator](){throw new Error("AsyncRecordBatchStreamReader is not Iterable")}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}}class oC extends Ld{constructor(e){super(e),this._impl=e}}class Ez extends Rd{constructor(e){super(e),this._impl=e}}class sC{get numDictionaries(){return this._dictionaryIndex}get numRecordBatches(){return this._recordBatchIndex}constructor(e=new Map){this.closed=!1,this.autoDestroy=!0,this._dictionaryIndex=0,this._recordBatchIndex=0,this.dictionaries=e}isSync(){return!1}isAsync(){return!1}isFile(){return!1}isStream(){return!1}reset(e){return this._dictionaryIndex=0,this._recordBatchIndex=0,this.schema=e,this.dictionaries=new Map,this}_loadRecordBatch(e,t){const n=this._loadVectors(e,t,this.schema.fields),r=be({type:new ri(this.schema.fields),length:e.length,children:n});return new Ti(this.schema,r)}_loadDictionaryBatch(e,t){const{id:n,isDelta:r}=e,{dictionaries:o,schema:s}=this,a=o.get(n),l=s.dictionaries.get(n),c=this._loadVectors(e.data,t,[l]);return(a&&r?a.concat(new Ce(c)):new Ce(c)).memoize()}_loadVectors(e,t,n){return new C3(t,e.nodes,e.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(n)}}class Pd extends sC{constructor(e,t){super(t),this._reader=tg(e)?new wz(this._handle=e):new nC(this._handle=e)}isSync(){return!0}isStream(){return!0}[Symbol.iterator](){return this}cancel(){!this.closed&&(this.closed=!0)&&(this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}open(e){return this.closed||(this.autoDestroy=lC(this,e),this.schema||(this.schema=this._reader.readSchema())||this.cancel()),this}throw(e){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.throw(e):Pt}return(e){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.return(e):Pt}next(){if(this.closed)return Pt;let e;const{_reader:t}=this;for(;e=this._readNextMessageAndValidate();)if(e.isSchema())this.reset(e.header());else if(e.isRecordBatch()){this._recordBatchIndex++;const n=e.header(),r=t.readMessageBody(e.bodyLength);return{done:!1,value:this._loadRecordBatch(n,r)}}else if(e.isDictionaryBatch()){this._dictionaryIndex++;const n=e.header(),r=t.readMessageBody(e.bodyLength),o=this._loadDictionaryBatch(n,r);this.dictionaries.set(n.id,o)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new Ry(this.schema)}):this.return()}_readNextMessageAndValidate(e){return this._reader.readMessage(e)}}class Dd extends sC{constructor(e,t){super(t),this._reader=new xz(this._handle=e)}isAsync(){return!0}isStream(){return!0}[Symbol.asyncIterator](){return this}cancel(){return ke(this,void 0,void 0,function*(){!this.closed&&(this.closed=!0)&&(yield this.reset()._reader.return(),this._reader=null,this.dictionaries=null)})}open(e){return ke(this,void 0,void 0,function*(){return this.closed||(this.autoDestroy=lC(this,e),this.schema||(this.schema=yield this._reader.readSchema())||(yield this.cancel())),this})}throw(e){return ke(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.throw(e):Pt})}return(e){return ke(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.return(e):Pt})}next(){return ke(this,void 0,void 0,function*(){if(this.closed)return Pt;let e;const{_reader:t}=this;for(;e=yield this._readNextMessageAndValidate();)if(e.isSchema())yield this.reset(e.header());else if(e.isRecordBatch()){this._recordBatchIndex++;const n=e.header(),r=yield t.readMessageBody(e.bodyLength);return{done:!1,value:this._loadRecordBatch(n,r)}}else if(e.isDictionaryBatch()){this._dictionaryIndex++;const n=e.header(),r=yield t.readMessageBody(e.bodyLength),o=this._loadDictionaryBatch(n,r);this.dictionaries.set(n.id,o)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new Ry(this.schema)}):yield this.return()})}_readNextMessageAndValidate(e){return ke(this,void 0,void 0,function*(){return yield this._reader.readMessage(e)})}}class aC extends Pd{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(e,t){super(e instanceof S0?e:new S0(e),t)}isSync(){return!0}isFile(){return!0}open(e){if(!this.closed&&!this._footer){this.schema=(this._footer=this._readFooter()).schema;for(const t of this._footer.dictionaryBatches())t&&this._readDictionaryBatch(this._dictionaryIndex++)}return super.open(e)}readRecordBatch(e){var t;if(this.closed)return null;this._footer||this.open();const n=(t=this._footer)===null||t===void 0?void 0:t.getRecordBatch(e);if(n&&this._handle.seek(n.offset)){const r=this._reader.readMessage(et.RecordBatch);if(r!=null&&r.isRecordBatch()){const o=r.header(),s=this._reader.readMessageBody(r.bodyLength);return this._loadRecordBatch(o,s)}}return null}_readDictionaryBatch(e){var t;const n=(t=this._footer)===null||t===void 0?void 0:t.getDictionaryBatch(e);if(n&&this._handle.seek(n.offset)){const r=this._reader.readMessage(et.DictionaryBatch);if(r!=null&&r.isDictionaryBatch()){const o=r.header(),s=this._reader.readMessageBody(r.bodyLength),a=this._loadDictionaryBatch(o,s);this.dictionaries.set(o.id,a)}}}_readFooter(){const{_handle:e}=this,t=e.size-rC,n=e.readInt32(t),r=e.readAt(t-n,n);return Mc.decode(r)}_readNextMessageAndValidate(e){var t;if(this._footer||this.open(),this._footer&&this._recordBatchIndex<this.numRecordBatches){const n=(t=this._footer)===null||t===void 0?void 0:t.getRecordBatch(this._recordBatchIndex);if(n&&this._handle.seek(n.offset))return this._reader.readMessage(e)}return null}}class Cz extends Dd{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(e,...t){const n=typeof t[0]!="number"?t.shift():void 0,r=t[0]instanceof Map?t.shift():void 0;super(e instanceof Id?e:new Id(e,n),r)}isFile(){return!0}isAsync(){return!0}open(e){const t=Object.create(null,{open:{get:()=>super.open}});return ke(this,void 0,void 0,function*(){if(!this.closed&&!this._footer){this.schema=(this._footer=yield this._readFooter()).schema;for(const n of this._footer.dictionaryBatches())n&&(yield this._readDictionaryBatch(this._dictionaryIndex++))}return yield t.open.call(this,e)})}readRecordBatch(e){return ke(this,void 0,void 0,function*(){var t;if(this.closed)return null;this._footer||(yield this.open());const n=(t=this._footer)===null||t===void 0?void 0:t.getRecordBatch(e);if(n&&(yield this._handle.seek(n.offset))){const r=yield this._reader.readMessage(et.RecordBatch);if(r!=null&&r.isRecordBatch()){const o=r.header(),s=yield this._reader.readMessageBody(r.bodyLength);return this._loadRecordBatch(o,s)}}return null})}_readDictionaryBatch(e){return ke(this,void 0,void 0,function*(){var t;const n=(t=this._footer)===null||t===void 0?void 0:t.getDictionaryBatch(e);if(n&&(yield this._handle.seek(n.offset))){const r=yield this._reader.readMessage(et.DictionaryBatch);if(r!=null&&r.isDictionaryBatch()){const o=r.header(),s=yield this._reader.readMessageBody(r.bodyLength),a=this._loadDictionaryBatch(o,s);this.dictionaries.set(o.id,a)}}})}_readFooter(){return ke(this,void 0,void 0,function*(){const{_handle:e}=this;e._pending&&(yield e._pending);const t=e.size-rC,n=yield e.readInt32(t),r=yield e.readAt(t-n,n);return Mc.decode(r)})}_readNextMessageAndValidate(e){return ke(this,void 0,void 0,function*(){if(this._footer||(yield this.open()),this._footer&&this._recordBatchIndex<this.numRecordBatches){const t=this._footer.getRecordBatch(this._recordBatchIndex);if(t&&(yield this._handle.seek(t.offset)))return yield this._reader.readMessage(e)}return null})}}class Tz extends Pd{constructor(e,t){super(e,t)}_loadVectors(e,t,n){return new p7(t,e.nodes,e.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(n)}}function lC(i,e){return e&&typeof e.autoDestroy=="boolean"?e.autoDestroy:i.autoDestroy}function*R0(i){const e=si.from(i);try{if(!e.open({autoDestroy:!1}).closed)do yield e;while(!e.reset().open().closed)}finally{e.cancel()}}function P0(i){return mr(this,arguments,function*(){const t=yield Ne(si.from(i));try{if(!(yield Ne(t.open({autoDestroy:!1}))).closed)do yield yield Ne(t);while(!(yield Ne(t.reset().open())).closed)}finally{yield Ne(t.cancel())}})}function Az(i){return new Ld(new Tz(i))}function Iz(i){const e=i.peek(su+7&-8);return e&&e.byteLength>=4?My(e)?new oC(new aC(i.read())):new Ld(new Pd(i)):new Ld(new Pd((function*(){})()))}function kz(i){return ke(this,void 0,void 0,function*(){const e=yield i.peek(su+7&-8);return e&&e.byteLength>=4?My(e)?new oC(new aC(yield i.read())):new Rd(new Dd(i)):new Rd(new Dd((function(){return mr(this,arguments,function*(){})})()))})}function Lz(i){return ke(this,void 0,void 0,function*(){const{size:e}=yield i.stat(),t=new Id(i,e);return e>=Sz&&My(yield t.readAt(0,su+7&-8))?new Ez(new Cz(t)):new Rd(new Dd(t))})}class Dt extends Be{static assemble(...e){const t=r=>r.flatMap(o=>Array.isArray(o)?t(o):o instanceof Ti?o.data.children:o.data),n=new Dt;return n.visitMany(t(e)),n}constructor(){super(),this._byteLength=0,this._nodes=[],this._buffers=[],this._bufferRegions=[]}visit(e){if(e instanceof Ce)return this.visitMany(e.data),this;const{type:t}=e;if(!ce.isDictionary(t)){const{length:n}=e;if(n>2147483647)throw new RangeError("Cannot write arrays larger than 2^31 - 1 in length");if(ce.isUnion(t))this.nodes.push(new Vo(n,0));else{const{nullCount:r}=e;ce.isNull(t)||Gn.call(this,r<=0?new Uint8Array(0):wd(e.offset,n,e.nullBitmap)),this.nodes.push(new Vo(n,r))}}return super.visit(e)}visitNull(e){return this}visitDictionary(e){return this.visit(e.clone(e.type.indices))}get nodes(){return this._nodes}get buffers(){return this._buffers}get byteLength(){return this._byteLength}get bufferRegions(){return this._bufferRegions}}function Gn(i){const e=i.byteLength+7&-8;return this.buffers.push(i),this.bufferRegions.push(new gr(this._byteLength,e)),this._byteLength+=e,this}function Rz(i){var e;const{type:t,length:n,typeIds:r,valueOffsets:o}=i;if(Gn.call(this,r),t.mode===vi.Sparse)return fg.call(this,i);if(t.mode===vi.Dense){if(i.offset<=0)return Gn.call(this,o),fg.call(this,i);{const s=new Int32Array(n),a=Object.create(null),l=Object.create(null);for(let c,u,h=-1;++h<n;)(c=r[h])!==void 0&&((u=a[c])===void 0&&(u=a[c]=o[h]),s[h]=o[h]-u,l[c]=((e=l[c])!==null&&e!==void 0?e:0)+1);Gn.call(this,s),this.visitMany(i.children.map((c,u)=>{const h=t.typeIds[u],d=a[h],f=l[h];return c.slice(d,Math.min(n,f))}))}}return this}function Pz(i){let e;return i.nullCount>=i.length?Gn.call(this,new Uint8Array(0)):(e=i.values)instanceof Uint8Array?Gn.call(this,wd(i.offset,i.length,e)):Gn.call(this,Sd(i.values))}function _o(i){return Gn.call(this,i.values.subarray(0,i.length*i.stride))}function Af(i){const{length:e,values:t,valueOffsets:n}=i,r=bt(n[0]),o=bt(n[e]),s=Math.min(o-r,t.byteLength-r);return Gn.call(this,H2(-r,e+1,n)),Gn.call(this,t.subarray(r,r+s)),this}function Ny(i){const{length:e,valueOffsets:t}=i;if(t){const{[0]:n,[e]:r}=t;return Gn.call(this,H2(-n,e+1,t)),this.visit(i.children[0].slice(n,r-n))}return this.visit(i.children[0])}function fg(i){return this.visitMany(i.type.children.map((e,t)=>i.children[t]).filter(Boolean))[0]}Dt.prototype.visitBool=Pz;Dt.prototype.visitInt=_o;Dt.prototype.visitFloat=_o;Dt.prototype.visitUtf8=Af;Dt.prototype.visitLargeUtf8=Af;Dt.prototype.visitBinary=Af;Dt.prototype.visitLargeBinary=Af;Dt.prototype.visitFixedSizeBinary=_o;Dt.prototype.visitDate=_o;Dt.prototype.visitTimestamp=_o;Dt.prototype.visitTime=_o;Dt.prototype.visitDecimal=_o;Dt.prototype.visitList=Ny;Dt.prototype.visitStruct=fg;Dt.prototype.visitUnion=Rz;Dt.prototype.visitInterval=_o;Dt.prototype.visitDuration=_o;Dt.prototype.visitFixedSizeList=Ny;Dt.prototype.visitMap=Ny;class cC extends Cy{static throughNode(e){throw new Error('"throughNode" not available in this environment')}static throughDOM(e,t){throw new Error('"throughDOM" not available in this environment')}constructor(e){super(),this._position=0,this._started=!1,this._sink=new Th,this._schema=null,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,Gi(e)||(e={autoDestroy:!0,writeLegacyIpcFormat:!1}),this._autoDestroy=typeof e.autoDestroy=="boolean"?e.autoDestroy:!0,this._writeLegacyIpcFormat=typeof e.writeLegacyIpcFormat=="boolean"?e.writeLegacyIpcFormat:!1}toString(e=!1){return this._sink.toString(e)}toUint8Array(e=!1){return this._sink.toUint8Array(e)}writeAll(e){return zo(e)?e.then(t=>this.writeAll(t)):qa(e)?zy(this,e):Fy(this,e)}get closed(){return this._sink.closed}[Symbol.asyncIterator](){return this._sink[Symbol.asyncIterator]()}toDOMStream(e){return this._sink.toDOMStream(e)}toNodeStream(e){return this._sink.toNodeStream(e)}close(){return this.reset()._sink.close()}abort(e){return this.reset()._sink.abort(e)}finish(){return this._autoDestroy?this.close():this.reset(this._sink,this._schema),this}reset(e=this._sink,t=null){return e===this._sink||e instanceof Th?this._sink=e:(this._sink=new Th,e&&VF(e)?this.toDOMStream({type:"bytes"}).pipeTo(e):e&&HF(e)&&this.toNodeStream({objectMode:!1}).pipe(e)),this._started&&this._schema&&this._writeFooter(this._schema),this._started=!1,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,(!t||!hg(t,this._schema))&&(t==null?(this._position=0,this._schema=null):(this._started=!0,this._schema=t,this._writeSchema(t))),this}write(e){let t=null;if(this._sink){if(e==null)return this.finish()&&void 0;if(e instanceof mt&&!(t=e.schema))return this.finish()&&void 0;if(e instanceof Ti&&!(t=e.schema))return this.finish()&&void 0}else throw new Error("RecordBatchWriter is closed");if(t&&!hg(t,this._schema)){if(this._started&&this._autoDestroy)return this.close();this.reset(this._sink,t)}e instanceof Ti?e instanceof Ry||this._writeRecordBatch(e):e instanceof mt?this.writeAll(e.batches):eu(e)&&this.writeAll(e)}_writeMessage(e,t=8){const n=t-1,r=Ai.encode(e),o=r.byteLength,s=this._writeLegacyIpcFormat?4:8,a=o+s+n&~n,l=a-o-s;return e.headerType===et.RecordBatch?this._recordBatchBlocks.push(new $o(a,e.bodyLength,this._position)):e.headerType===et.DictionaryBatch&&this._dictionaryBlocks.push(new $o(a,e.bodyLength,this._position)),this._writeLegacyIpcFormat||this._write(Int32Array.of(-1)),this._write(Int32Array.of(a-s)),o>0&&this._write(r),this._writePadding(l)}_write(e){if(this._started){const t=ze(e);t&&t.byteLength>0&&(this._sink.write(t),this._position+=t.byteLength)}return this}_writeSchema(e){return this._writeMessage(Ai.from(e))}_writeFooter(e){return this._writeLegacyIpcFormat?this._write(Int32Array.of(0)):this._write(Int32Array.of(-1,0))}_writeMagic(){return this._write(Nc)}_writePadding(e){return e>0?this._write(new Uint8Array(e)):this}_writeRecordBatch(e){const{byteLength:t,nodes:n,bufferRegions:r,buffers:o}=Dt.assemble(e),s=new ln(e.numRows,n,r),a=Ai.from(s,t);return this._writeDictionaries(e)._writeMessage(a)._writeBodyBuffers(o)}_writeDictionaryBatch(e,t,n=!1){const{byteLength:r,nodes:o,bufferRegions:s,buffers:a}=Dt.assemble(new Ce([e])),l=new ln(e.length,o,s),c=new Er(l,t,n),u=Ai.from(c,r);return this._writeMessage(u)._writeBodyBuffers(a)}_writeBodyBuffers(e){let t,n,r;for(let o=-1,s=e.length;++o<s;)(t=e[o])&&(n=t.byteLength)>0&&(this._write(t),(r=(n+7&-8)-n)>0&&this._writePadding(r));return this}_writeDictionaries(e){var t,n;for(const[r,o]of e.dictionaries){const s=(t=o==null?void 0:o.data)!==null&&t!==void 0?t:[],a=this._seenDictionaries.get(r),l=(n=this._dictionaryDeltaOffsets.get(r))!==null&&n!==void 0?n:0;if(!a||a.data[0]!==s[0])for(const[c,u]of s.entries())this._writeDictionaryBatch(u,r,c>0);else if(l<s.length)for(const c of s.slice(l))this._writeDictionaryBatch(c,r,!0);this._seenDictionaries.set(r,o),this._dictionaryDeltaOffsets.set(r,s.length)}return this}}class By extends cC{static writeAll(e,t){const n=new By(t);return zo(e)?e.then(r=>n.writeAll(r)):qa(e)?zy(n,e):Fy(n,e)}}class Oy extends cC{static writeAll(e){const t=new Oy;return zo(e)?e.then(n=>t.writeAll(n)):qa(e)?zy(t,e):Fy(t,e)}constructor(){super(),this._autoDestroy=!0}_writeSchema(e){return this._writeMagic()._writePadding(2)}_writeDictionaryBatch(e,t,n=!1){if(!n&&this._seenDictionaries.has(t))throw new Error("The Arrow File format does not support replacement dictionaries. ");return super._writeDictionaryBatch(e,t,n)}_writeFooter(e){const t=Mc.encode(new Mc(e,zt.V5,this._recordBatchBlocks,this._dictionaryBlocks));return super._writeFooter(e)._write(t)._write(Int32Array.of(t.byteLength))._writeMagic()}}function Fy(i,e){let t=e;e instanceof mt&&(t=e.batches,i.reset(void 0,e.schema));for(const n of t)i.write(n);return i.finish()}function zy(i,e){return ke(this,void 0,void 0,function*(){var t,n,r,o,s,a,l;try{for(t=!0,n=ss(e);r=yield n.next(),o=r.done,!o;t=!0){l=r.value,t=!1;const c=l;i.write(c)}}catch(c){s={error:c}}finally{try{!t&&!o&&(a=n.return)&&(yield a.call(n))}finally{if(s)throw s.error}}return i.finish()})}function uC(i){const e=si.from(i);return zo(e)?e.then(t=>uC(t)):e.isAsync()?e.readAll().then(t=>new mt(t)):new mt(e.readAll())}function Uy(i,e="stream"){return(e==="stream"?By:Oy).writeAll(i).toUint8Array(!0)}var Dz=Object.create,hC=Object.defineProperty,Mz=Object.getOwnPropertyDescriptor,Nz=Object.getOwnPropertyNames,Bz=Object.getPrototypeOf,Oz=Object.prototype.hasOwnProperty,Fz=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),zz=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Nz(e))!Oz.call(i,r)&&r!==t&&hC(i,r,{get:()=>e[r],enumerable:!(n=Mz(e,r))||n.enumerable});return i},Uz=(i,e,t)=>(t=i!=null?Dz(Bz(i)):{},zz(!i||!i.__esModule?hC(t,"default",{value:i,enumerable:!0}):t,i)),$z=Fz((i,e)=>{e.exports=Worker}),Vz=(i=>(i[i.UNDEFINED=0]="UNDEFINED",i[i.AUTOMATIC=1]="AUTOMATIC",i[i.READ_ONLY=2]="READ_ONLY",i[i.READ_WRITE=3]="READ_WRITE",i))(Vz||{}),Hz=(i=>(i[i.IDENTIFIER=0]="IDENTIFIER",i[i.NUMERIC_CONSTANT=1]="NUMERIC_CONSTANT",i[i.STRING_CONSTANT=2]="STRING_CONSTANT",i[i.OPERATOR=3]="OPERATOR",i[i.KEYWORD=4]="KEYWORD",i[i.COMMENT=5]="COMMENT",i))(Hz||{}),Gz=(i=>(i[i.NONE=0]="NONE",i[i.DEBUG=1]="DEBUG",i[i.INFO=2]="INFO",i[i.WARNING=3]="WARNING",i[i.ERROR=4]="ERROR",i))(Gz||{}),Wz=(i=>(i[i.NONE=0]="NONE",i[i.CONNECT=1]="CONNECT",i[i.DISCONNECT=2]="DISCONNECT",i[i.OPEN=3]="OPEN",i[i.QUERY=4]="QUERY",i[i.INSTANTIATE=5]="INSTANTIATE",i))(Wz||{}),jz=(i=>(i[i.NONE=0]="NONE",i[i.OK=1]="OK",i[i.ERROR=2]="ERROR",i[i.START=3]="START",i[i.RUN=4]="RUN",i[i.CAPTURE=5]="CAPTURE",i))(jz||{}),Yz=(i=>(i[i.NONE=0]="NONE",i[i.WEB_WORKER=1]="WEB_WORKER",i[i.NODE_WORKER=2]="NODE_WORKER",i[i.BINDINGS=3]="BINDINGS",i[i.ASYNC_DUCKDB=4]="ASYNC_DUCKDB",i))(Yz||{}),qz=class{log(e){}},Xz=class{constructor(i=2){this.level=i}log(i){i.level>=this.level&&console.log(i)}},Kz=(i=>(i[i.SUCCESS=0]="SUCCESS",i[i.MAX_ARROW_ERROR=255]="MAX_ARROW_ERROR",i[i.DUCKDB_WASM_RETRY=256]="DUCKDB_WASM_RETRY",i))(Kz||{}),Zz=class{constructor(e,t){this._bindings=e,this._conn=t}get bindings(){return this._bindings}async close(){return this._bindings.disconnect(this._conn)}useUnsafe(e){return e(this._bindings,this._conn)}async query(e){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:e});let t=await this._bindings.runQuery(this._conn,e),n=si.from(t);return console.assert(n.isSync(),"Reader is not sync"),console.assert(n.isFile(),"Reader is not file"),new mt(n)}async send(e,t=!1){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:e});let n=await this._bindings.startPendingQuery(this._conn,e,t);for(;n==null;)n=await this._bindings.pollPendingQuery(this._conn);let r=new dC(this._bindings,this._conn,n),o=await si.from(r);return console.assert(o.isAsync()),console.assert(o.isStream()),o}async cancelSent(){return await this._bindings.cancelPendingQuery(this._conn)}async getTableNames(e){return await this._bindings.getTableNames(this._conn,e)}async prepare(e){let t=await this._bindings.createPrepared(this._conn,e);return new Qz(this._bindings,this._conn,t)}async insertArrowTable(e,t){let n=Uy(e,"stream");await this.insertArrowFromIPCStream(n,t)}async insertArrowFromIPCStream(e,t){await this._bindings.insertArrowFromIPCStream(this._conn,e,t)}async insertCSVFromPath(e,t){await this._bindings.insertCSVFromPath(this._conn,e,t)}async insertJSONFromPath(e,t){await this._bindings.insertJSONFromPath(this._conn,e,t)}},dC=class{constructor(e,t,n){this.db=e,this.conn=t,this.header=n,this._first=!0,this._depleted=!1,this._inFlight=null}async next(){if(this._first)return this._first=!1,{done:!1,value:this.header};if(this._depleted)return{done:!0,value:null};let e=null;for(this._inFlight!=null&&(e=await this._inFlight,this._inFlight=null);e==null;)e=await this.db.fetchQueryResults(this.conn);return this._depleted=e.length==0,this._depleted||(this._inFlight=this.db.fetchQueryResults(this.conn)),{done:this._depleted,value:e}}[Symbol.asyncIterator](){return this}},Qz=class{constructor(e,t,n){this.bindings=e,this.connectionId=t,this.statementId=n}async close(){await this.bindings.closePrepared(this.connectionId,this.statementId)}async query(...e){let t=await this.bindings.runPrepared(this.connectionId,this.statementId,e),n=si.from(t);return console.assert(n.isSync()),console.assert(n.isFile()),new mt(n)}async send(...e){let t=await this.bindings.sendPrepared(this.connectionId,this.statementId,e),n=new dC(this.bindings,this.connectionId,t),r=await si.from(n);return console.assert(r.isAsync()),console.assert(r.isStream()),r}},Jz=(i=>(i.CANCEL_PENDING_QUERY="CANCEL_PENDING_QUERY",i.CLOSE_PREPARED="CLOSE_PREPARED",i.COLLECT_FILE_STATISTICS="COLLECT_FILE_STATISTICS",i.REGISTER_OPFS_FILE_NAME="REGISTER_OPFS_FILE_NAME",i.CONNECT="CONNECT",i.COPY_FILE_TO_BUFFER="COPY_FILE_TO_BUFFER",i.COPY_FILE_TO_PATH="COPY_FILE_TO_PATH",i.CREATE_PREPARED="CREATE_PREPARED",i.DISCONNECT="DISCONNECT",i.DROP_FILE="DROP_FILE",i.DROP_FILES="DROP_FILES",i.EXPORT_FILE_STATISTICS="EXPORT_FILE_STATISTICS",i.FETCH_QUERY_RESULTS="FETCH_QUERY_RESULTS",i.FLUSH_FILES="FLUSH_FILES",i.GET_FEATURE_FLAGS="GET_FEATURE_FLAGS",i.GET_TABLE_NAMES="GET_TABLE_NAMES",i.GET_VERSION="GET_VERSION",i.GLOB_FILE_INFOS="GLOB_FILE_INFOS",i.INSERT_ARROW_FROM_IPC_STREAM="INSERT_ARROW_FROM_IPC_STREAM",i.INSERT_CSV_FROM_PATH="IMPORT_CSV_FROM_PATH",i.INSERT_JSON_FROM_PATH="IMPORT_JSON_FROM_PATH",i.INSTANTIATE="INSTANTIATE",i.OPEN="OPEN",i.PING="PING",i.POLL_PENDING_QUERY="POLL_PENDING_QUERY",i.REGISTER_FILE_BUFFER="REGISTER_FILE_BUFFER",i.REGISTER_FILE_HANDLE="REGISTER_FILE_HANDLE",i.REGISTER_FILE_URL="REGISTER_FILE_URL",i.RESET="RESET",i.RUN_PREPARED="RUN_PREPARED",i.RUN_QUERY="RUN_QUERY",i.SEND_PREPARED="SEND_PREPARED",i.START_PENDING_QUERY="START_PENDING_QUERY",i.TOKENIZE="TOKENIZE",i))(Jz||{}),e8=(i=>(i.CONNECTION_INFO="CONNECTION_INFO",i.ERROR="ERROR",i.FEATURE_FLAGS="FEATURE_FLAGS",i.FILE_BUFFER="FILE_BUFFER",i.FILE_INFOS="FILE_INFOS",i.FILE_SIZE="FILE_SIZE",i.FILE_STATISTICS="FILE_STATISTICS",i.INSTANTIATE_PROGRESS="INSTANTIATE_PROGRESS",i.LOG="LOG",i.PROGRESS_UPDATE="PROGRESS_UPDATE",i.OK="OK",i.PREPARED_STATEMENT_ID="PREPARED_STATEMENT_ID",i.QUERY_PLAN="QUERY_PLAN",i.QUERY_RESULT="QUERY_RESULT",i.QUERY_RESULT_CHUNK="QUERY_RESULT_CHUNK",i.QUERY_RESULT_HEADER="QUERY_RESULT_HEADER",i.QUERY_RESULT_HEADER_OR_NULL="QUERY_RESULT_HEADER_OR_NULL",i.REGISTERED_FILE="REGISTERED_FILE",i.SCRIPT_TOKENS="SCRIPT_TOKENS",i.SUCCESS="SUCCESS",i.TABLE_NAMES="TABLE_NAMES",i.VERSION_STRING="VERSION_STRING",i))(e8||{}),je=class{constructor(e,t){this.promiseResolver=()=>{},this.promiseRejecter=()=>{},this.type=e,this.data=t,this.promise=new Promise((n,r)=>{this.promiseResolver=n,this.promiseRejecter=r})}};function Lh(i){switch(i.typeId){case S.Binary:return{sqlType:"binary"};case S.Bool:return{sqlType:"bool"};case S.Date:return{sqlType:"date"};case S.DateDay:return{sqlType:"date32[d]"};case S.DateMillisecond:return{sqlType:"date64[ms]"};case S.Decimal:{let e=i;return{sqlType:"decimal",precision:e.precision,scale:e.scale}}case S.Float:return{sqlType:"float"};case S.Float16:return{sqlType:"float16"};case S.Float32:return{sqlType:"float32"};case S.Float64:return{sqlType:"float64"};case S.Int:return{sqlType:"int32"};case S.Int16:return{sqlType:"int16"};case S.Int32:return{sqlType:"int32"};case S.Int64:return{sqlType:"int64"};case S.Uint16:return{sqlType:"uint16"};case S.Uint32:return{sqlType:"uint32"};case S.Uint64:return{sqlType:"uint64"};case S.Uint8:return{sqlType:"uint8"};case S.IntervalDayTime:return{sqlType:"interval[dt]"};case S.IntervalYearMonth:return{sqlType:"interval[m]"};case S.List:return{sqlType:"list",valueType:Lh(i.valueType)};case S.FixedSizeBinary:return{sqlType:"fixedsizebinary",byteWidth:i.byteWidth};case S.Null:return{sqlType:"null"};case S.Utf8:return{sqlType:"utf8"};case S.Struct:return{sqlType:"struct",fields:i.children.map(e=>pg(e.name,e.type))};case S.Map:{let e=i;return{sqlType:"map",keyType:Lh(e.keyType),valueType:Lh(e.valueType)}}case S.Time:return{sqlType:"time[s]"};case S.TimeMicrosecond:return{sqlType:"time[us]"};case S.TimeMillisecond:return{sqlType:"time[ms]"};case S.TimeNanosecond:return{sqlType:"time[ns]"};case S.TimeSecond:return{sqlType:"time[s]"};case S.Timestamp:return{sqlType:"timestamp",timezone:i.timezone||void 0};case S.TimestampSecond:return{sqlType:"timestamp[s]",timezone:i.timezone||void 0};case S.TimestampMicrosecond:return{sqlType:"timestamp[us]",timezone:i.timezone||void 0};case S.TimestampNanosecond:return{sqlType:"timestamp[ns]",timezone:i.timezone||void 0};case S.TimestampMillisecond:return{sqlType:"timestamp[ms]",timezone:i.timezone||void 0}}throw new Error("unsupported arrow type: ".concat(i.toString()))}function pg(i,e){let t=Lh(e);return t.name=i,t}var t8=new TextEncoder,i8=class{constructor(e,t=null){this._onInstantiationProgress=[],this._onExecutionProgress=[],this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{},this._nextMessageId=0,this._pendingRequests=new Map,this._logger=e,this._onMessageHandler=this.onMessage.bind(this),this._onErrorHandler=this.onError.bind(this),this._onCloseHandler=this.onClose.bind(this),t!=null&&this.attach(t)}get logger(){return this._logger}attach(e){this._worker=e,this._worker.addEventListener("message",this._onMessageHandler),this._worker.addEventListener("error",this._onErrorHandler),this._worker.addEventListener("close",this._onCloseHandler),this._workerShutdownPromise=new Promise((t,n)=>{this._workerShutdownResolver=t})}detach(){this._worker&&(this._worker.removeEventListener("message",this._onMessageHandler),this._worker.removeEventListener("error",this._onErrorHandler),this._worker.removeEventListener("close",this._onCloseHandler),this._worker=null,this._workerShutdownResolver(null),this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async terminate(){this._worker&&(this._worker.terminate(),this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async postTask(e,t=[]){if(!this._worker){console.error("cannot send a message since the worker is not set!");return}let n=this._nextMessageId++;return this._pendingRequests.set(n,e),this._worker.postMessage({messageId:n,type:e.type,data:e.data},t),await e.promise}onMessage(e){var t;let n=e.data;switch(n.type){case"PROGRESS_UPDATE":{for(let o of this._onExecutionProgress)o(n.data);return}case"LOG":{this._logger.log(n.data);return}case"INSTANTIATE_PROGRESS":{for(let o of this._onInstantiationProgress)o(n.data);return}}let r=this._pendingRequests.get(n.requestId);if(!r){console.warn("unassociated response: [".concat(n.requestId,", ").concat(n.type.toString(),"]"));return}if(this._pendingRequests.delete(n.requestId),n.type=="ERROR"){let o=new Error(n.data.message);o.name=n.data.name,(t=Object.getOwnPropertyDescriptor(o,"stack"))!=null&&t.writable&&(o.stack=n.data.stack),r.promiseRejecter(o);return}switch(r.type){case"CLOSE_PREPARED":case"COLLECT_FILE_STATISTICS":case"REGISTER_OPFS_FILE_NAME":case"COPY_FILE_TO_PATH":case"DISCONNECT":case"DROP_FILE":case"DROP_FILES":case"FLUSH_FILES":case"INSERT_ARROW_FROM_IPC_STREAM":case"IMPORT_CSV_FROM_PATH":case"IMPORT_JSON_FROM_PATH":case"OPEN":case"PING":case"REGISTER_FILE_BUFFER":case"REGISTER_FILE_HANDLE":case"REGISTER_FILE_URL":case"RESET":if(n.type=="OK"){r.promiseResolver(n.data);return}break;case"INSTANTIATE":if(this._onInstantiationProgress=[],n.type=="OK"){r.promiseResolver(n.data);return}break;case"GLOB_FILE_INFOS":if(n.type=="FILE_INFOS"){r.promiseResolver(n.data);return}break;case"GET_VERSION":if(n.type=="VERSION_STRING"){r.promiseResolver(n.data);return}break;case"GET_FEATURE_FLAGS":if(n.type=="FEATURE_FLAGS"){r.promiseResolver(n.data);return}break;case"GET_TABLE_NAMES":if(n.type=="TABLE_NAMES"){r.promiseResolver(n.data);return}break;case"TOKENIZE":if(n.type=="SCRIPT_TOKENS"){r.promiseResolver(n.data);return}break;case"COPY_FILE_TO_BUFFER":if(n.type=="FILE_BUFFER"){r.promiseResolver(n.data);return}break;case"EXPORT_FILE_STATISTICS":if(n.type=="FILE_STATISTICS"){r.promiseResolver(n.data);return}break;case"CONNECT":if(n.type=="CONNECTION_INFO"){r.promiseResolver(n.data);return}break;case"RUN_PREPARED":case"RUN_QUERY":if(n.type=="QUERY_RESULT"){r.promiseResolver(n.data);return}break;case"SEND_PREPARED":if(n.type=="QUERY_RESULT_HEADER"){r.promiseResolver(n.data);return}break;case"START_PENDING_QUERY":if(n.type=="QUERY_RESULT_HEADER_OR_NULL"){r.promiseResolver(n.data);return}break;case"POLL_PENDING_QUERY":if(n.type=="QUERY_RESULT_HEADER_OR_NULL"){r.promiseResolver(n.data);return}break;case"CANCEL_PENDING_QUERY":if(this._onInstantiationProgress=[],n.type=="SUCCESS"){r.promiseResolver(n.data);return}break;case"FETCH_QUERY_RESULTS":if(n.type=="QUERY_RESULT_CHUNK"){r.promiseResolver(n.data);return}break;case"CREATE_PREPARED":if(n.type=="PREPARED_STATEMENT_ID"){r.promiseResolver(n.data);return}break}r.promiseRejecter(new Error("unexpected response type: ".concat(n.type.toString())))}onError(e){console.error(e),console.error("error in duckdb worker: ".concat(e.message)),this._pendingRequests.clear()}onClose(){if(this._workerShutdownResolver(null),this._pendingRequests.size!=0){console.warn("worker terminated with ".concat(this._pendingRequests.size," pending requests"));return}this._pendingRequests.clear()}async reset(){let e=new je("RESET",null);return await this.postTask(e)}async ping(){let e=new je("PING",null);await this.postTask(e)}async dropFile(e){let t=new je("DROP_FILE",e);return await this.postTask(t)}async dropFiles(){let e=new je("DROP_FILES",null);return await this.postTask(e)}async flushFiles(){let e=new je("FLUSH_FILES",null);return await this.postTask(e)}async instantiate(e,t=null,n=r=>{}){this._onInstantiationProgress.push(n);let r=new je("INSTANTIATE",[e,t]);return await this.postTask(r)}async getVersion(){let e=new je("GET_VERSION",null);return await this.postTask(e)}async getFeatureFlags(){let e=new je("GET_FEATURE_FLAGS",null);return await this.postTask(e)}async open(e){let t=new je("OPEN",e);await this.postTask(t)}async tokenize(e){let t=new je("TOKENIZE",e);return await this.postTask(t)}async connectInternal(){let e=new je("CONNECT",null);return await this.postTask(e)}async connect(){let e=await this.connectInternal();return new Zz(this,e)}async disconnect(e){let t=new je("DISCONNECT",e);await this.postTask(t)}async runQuery(e,t){let n=new je("RUN_QUERY",[e,t]);return await this.postTask(n)}async startPendingQuery(e,t,n=!1){let r=new je("START_PENDING_QUERY",[e,t,n]);return await this.postTask(r)}async pollPendingQuery(e){let t=new je("POLL_PENDING_QUERY",e);return await this.postTask(t)}async cancelPendingQuery(e){let t=new je("CANCEL_PENDING_QUERY",e);return await this.postTask(t)}async fetchQueryResults(e){let t=new je("FETCH_QUERY_RESULTS",e);return await this.postTask(t)}async getTableNames(e,t){let n=new je("GET_TABLE_NAMES",[e,t]);return await this.postTask(n)}async createPrepared(e,t){let n=new je("CREATE_PREPARED",[e,t]);return await this.postTask(n)}async closePrepared(e,t){let n=new je("CLOSE_PREPARED",[e,t]);await this.postTask(n)}async runPrepared(e,t,n){let r=new je("RUN_PREPARED",[e,t,n]);return await this.postTask(r)}async sendPrepared(e,t,n){let r=new je("SEND_PREPARED",[e,t,n]);return await this.postTask(r)}async globFiles(e){let t=new je("GLOB_FILE_INFOS",e);return await this.postTask(t)}async registerFileText(e,t){let n=t8.encode(t);await this.registerFileBuffer(e,n)}async registerFileURL(e,t,n,r){t===void 0&&(t=e);let o=new je("REGISTER_FILE_URL",[e,t,n,r]);await this.postTask(o)}async registerEmptyFileBuffer(e){}async registerFileBuffer(e,t){let n=new je("REGISTER_FILE_BUFFER",[e,t]);await this.postTask(n,[t.buffer])}async registerFileHandle(e,t,n,r){let o=new je("REGISTER_FILE_HANDLE",[e,t,n,r]);await this.postTask(o,[])}async registerOPFSFileName(e){let t=new je("REGISTER_OPFS_FILE_NAME",[e]);await this.postTask(t,[])}async collectFileStatistics(e,t){let n=new je("COLLECT_FILE_STATISTICS",[e,t]);await this.postTask(n,[])}async exportFileStatistics(e){let t=new je("EXPORT_FILE_STATISTICS",e);return await this.postTask(t,[])}async copyFileToBuffer(e){let t=new je("COPY_FILE_TO_BUFFER",e);return await this.postTask(t)}async copyFileToPath(e,t){let n=new je("COPY_FILE_TO_PATH",[e,t]);await this.postTask(n)}async insertArrowFromIPCStream(e,t,n){if(t.length==0)return;let r=new je("INSERT_ARROW_FROM_IPC_STREAM",[e,t,n]);await this.postTask(r,[t.buffer])}async insertCSVFromPath(e,t,n){if(n.columns!==void 0){let o=[];for(let s in n.columns){let a=n.columns[s];o.push(pg(s,a))}n.columnsFlat=o,delete n.columns}let r=new je("IMPORT_CSV_FROM_PATH",[e,t,n]);await this.postTask(r)}async insertJSONFromPath(e,t,n){if(n.columns!==void 0){let o=[];for(let s in n.columns){let a=n.columns[s];o.push(pg(s,a))}n.columnsFlat=o,delete n.columns}let r=new je("IMPORT_JSON_FROM_PATH",[e,t,n]);await this.postTask(r)}};function n8(){let i=new TextDecoder;return e=>(typeof SharedArrayBuffer<"u"&&e.buffer instanceof SharedArrayBuffer&&(e=new Uint8Array(e)),i.decode(e))}n8();var r8=(i=>(i[i.BUFFER=0]="BUFFER",i[i.NODE_FS=1]="NODE_FS",i[i.BROWSER_FILEREADER=2]="BROWSER_FILEREADER",i[i.BROWSER_FSACCESS=3]="BROWSER_FSACCESS",i[i.HTTP=4]="HTTP",i[i.S3=5]="S3",i))(r8||{}),o8=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,3,1,0,1,10,14,1,12,0,65,0,65,0,65,0,252,10,0,0,11])),s8=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,6,64,25,11,11])),a8=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),l8=()=>(async i=>{try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(i)}catch{return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])),$y={name:"@duckdb/duckdb-wasm",version:"1.30.0"},c8=$y.name,u8=$y.version,Vy=$y.version.split(".");Vy[0];Vy[1];Vy[2];var h8=()=>typeof navigator>"u";function d8(){let i="https://cdn.jsdelivr.net/npm/".concat(c8,"@").concat(u8,"/dist/");return{mvp:{mainModule:"".concat(i,"duckdb-mvp.wasm"),mainWorker:"".concat(i,"duckdb-browser-mvp.worker.js")},eh:{mainModule:"".concat(i,"duckdb-eh.wasm"),mainWorker:"".concat(i,"duckdb-browser-eh.worker.js")}}}var Sp=null,Ep=null,Cp=null,Tp=null,Ap=null;async function f8(){return Sp==null&&(Sp=typeof BigInt64Array<"u"),Ep==null&&(Ep=await s8()),Cp==null&&(Cp=await l8()),Tp==null&&(Tp=await a8()),Ap==null&&(Ap=await o8()),{bigInt64Array:Sp,crossOriginIsolated:h8()||globalThis.crossOriginIsolated||!1,wasmExceptions:Ep,wasmSIMD:Tp,wasmThreads:Cp,wasmBulkMemory:Ap}}async function p8(i){let e=await f8();if(e.wasmExceptions){if(e.wasmSIMD&&e.wasmThreads&&e.crossOriginIsolated&&i.coi)return{mainModule:i.coi.mainModule,mainWorker:i.coi.mainWorker,pthreadWorker:i.coi.pthreadWorker};if(i.eh)return{mainModule:i.eh.mainModule,mainWorker:i.eh.mainWorker,pthreadWorker:null}}return{mainModule:i.mvp.mainModule,mainWorker:i.mvp.mainWorker,pthreadWorker:null}}Uz($z());class D0{constructor(e={}){m(this,"_ipc");m(this,"_options");m(this,"_db");m(this,"_con");m(this,"_config");m(this,"_loadPromise");const{ipc:t,duckdb:n,connection:r,config:o,...s}=e;this._ipc=t,this._options=s,this._db=n,this._con=r,this._config=o}async getDuckDB(){return this._db||await M0(this),this._db}async getConnection(){return this._con||await M0(this),this._con}async query(e){const{type:t,sql:n}=e,r=await this.getConnection(),o=await m8(r,n);return t==="exec"?void 0:t==="arrow"?sd(o,this._ipc):sd(o).toArray()}}function m8(i,e){return new Promise((t,n)=>{i.useUnsafe(async(r,o)=>{try{const s=await r.runQuery(o,e);t(s)}catch(s){n(s)}})})}function M0(i){return i._loadPromise||(i._loadPromise=(i._db?Promise.resolve(i._db):g8(i._options).then(e=>i._db=e)).then(e=>i._config!=null?e.open(i._config).then(()=>e):e).then(e=>e.connect()).then(e=>i._con=e)),i._loadPromise}async function g8({log:i=!1}={}){const e=d8(),t=await p8(e),n=URL.createObjectURL(new Blob([`importScripts("${t.mainWorker}");`],{type:"text/javascript"})),r=new Worker(n),o=i?new Xz:new qz,s=new i8(o,r);return await s.instantiate(t.mainModule,t.pthreadWorker),URL.revokeObjectURL(n),s}const ue=(i,e,t="info")=>{if(window.cosmographDisableLogging)return;let n,r;switch(t){case"ok":n="#54AE47",r=" ";break;case"info":n="#4196f8",r=" ";break;case"warn":n="#FFA500",r=" ";break;case"util":n="#666666",r=" ";break;case"error":n="#FF0000",r=" "}console.log(`%c${r}[${e==="data-kit"?"CosmographDataKit":"Cosmograph"}${e?e==="data-kit"?"":` > ${e}`:""}]: ${i}`,`color: ${n}; font-weight: bold;`)};var _8={};const Bc=(i,e,t=new Set)=>{if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;if(t.has(i))return!0;t.add(i);for(let n=0;n<i.length;n++)if(!Bc(i[n],e[n],t))return!1;return!0}if(i instanceof Date&&e instanceof Date)return i.getTime()===e.getTime();if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object")return!1;if(i===e)return!0;if(Object.keys(i).length!==Object.keys(e).length)return!1;if(t.has(i))return!0;t.add(i);for(const n in i)if(!Bc(i[n],e[n],t))return!1;return!0}return i===e},fC=i=>{if(!i)return[];const e=i.numRows,t=i.schema.fields,n=new Array(e);for(let r=0;r<e;r++){const o={};for(let s=0;s<t.length;s++){const a=i.getChildAt(s);a&&(o[t[s].name]=a.get(r))}n[r]=o}return n},Hy=()=>{let i;try{i=!!_8.DEBUG}catch{i=!1}return i},va=(i,e)=>[Math.round(i),Math.round(e)],If=i=>`'${String(i).replace(/'/g,"''")}'`,Ho=i=>(i==null?void 0:i.typeId)===2||(i==null?void 0:i.typeId)===3||(i==null?void 0:i.typeId)===7,Oc=i=>(i==null?void 0:i.typeId)===5,Fc=i=>(i==null?void 0:i.typeId)===6||(i==null?void 0:i.typeId)===20,pC=i=>(i==null?void 0:i.typeId)===12||(i==null?void 0:i.typeId)===13,y8=i=>typeof i=="string"?/(\[\]|list)/i.test(i):pC(i??void 0),Gy=()=>Math.random().toString(36).substring(2,9),b8=(i,e)=>{const{signal:t}=e;return i.reduce((n,r)=>n.then(async()=>{var o;if(!t.aborted)try{await r()}catch(s){(o=s)&&(o.message||String(o)),t.aborted}}),Promise.resolve()).then(()=>{})};var v8=Object.create,mC=Object.defineProperty,x8=Object.getOwnPropertyDescriptor,w8=Object.getOwnPropertyNames,S8=Object.getPrototypeOf,E8=Object.prototype.hasOwnProperty,C8=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),T8=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of w8(e))!E8.call(i,r)&&r!==t&&mC(i,r,{get:()=>e[r],enumerable:!(n=x8(e,r))||n.enumerable});return i},A8=(i,e,t)=>(t=i!=null?v8(S8(i)):{},T8(!i||!i.__esModule?mC(t,"default",{value:i,enumerable:!0}):t,i)),I8=C8((i,e)=>{e.exports=Worker}),k8=(i=>(i[i.UNDEFINED=0]="UNDEFINED",i[i.AUTOMATIC=1]="AUTOMATIC",i[i.READ_ONLY=2]="READ_ONLY",i[i.READ_WRITE=3]="READ_WRITE",i))(k8||{}),L8=(i=>(i[i.IDENTIFIER=0]="IDENTIFIER",i[i.NUMERIC_CONSTANT=1]="NUMERIC_CONSTANT",i[i.STRING_CONSTANT=2]="STRING_CONSTANT",i[i.OPERATOR=3]="OPERATOR",i[i.KEYWORD=4]="KEYWORD",i[i.COMMENT=5]="COMMENT",i))(L8||{}),R8=(i=>(i[i.NONE=0]="NONE",i[i.DEBUG=1]="DEBUG",i[i.INFO=2]="INFO",i[i.WARNING=3]="WARNING",i[i.ERROR=4]="ERROR",i))(R8||{}),P8=(i=>(i[i.NONE=0]="NONE",i[i.CONNECT=1]="CONNECT",i[i.DISCONNECT=2]="DISCONNECT",i[i.OPEN=3]="OPEN",i[i.QUERY=4]="QUERY",i[i.INSTANTIATE=5]="INSTANTIATE",i))(P8||{}),D8=(i=>(i[i.NONE=0]="NONE",i[i.OK=1]="OK",i[i.ERROR=2]="ERROR",i[i.START=3]="START",i[i.RUN=4]="RUN",i[i.CAPTURE=5]="CAPTURE",i))(D8||{}),M8=(i=>(i[i.NONE=0]="NONE",i[i.WEB_WORKER=1]="WEB_WORKER",i[i.NODE_WORKER=2]="NODE_WORKER",i[i.BINDINGS=3]="BINDINGS",i[i.ASYNC_DUCKDB=4]="ASYNC_DUCKDB",i))(M8||{}),N8=class{log(e){}},B8=(i=>(i[i.SUCCESS=0]="SUCCESS",i[i.MAX_ARROW_ERROR=255]="MAX_ARROW_ERROR",i[i.DUCKDB_WASM_RETRY=256]="DUCKDB_WASM_RETRY",i))(B8||{}),O8=class{constructor(e,t){this._bindings=e,this._conn=t}get bindings(){return this._bindings}async close(){return this._bindings.disconnect(this._conn)}useUnsafe(e){return e(this._bindings,this._conn)}async query(e){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:e});let t=await this._bindings.runQuery(this._conn,e),n=si.from(t);return console.assert(n.isSync(),"Reader is not sync"),console.assert(n.isFile(),"Reader is not file"),new mt(n)}async send(e,t=!1){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:e});let n=await this._bindings.startPendingQuery(this._conn,e,t);for(;n==null;)n=await this._bindings.pollPendingQuery(this._conn);let r=new gC(this._bindings,this._conn,n),o=await si.from(r);return console.assert(o.isAsync()),console.assert(o.isStream()),o}async cancelSent(){return await this._bindings.cancelPendingQuery(this._conn)}async getTableNames(e){return await this._bindings.getTableNames(this._conn,e)}async prepare(e){let t=await this._bindings.createPrepared(this._conn,e);return new F8(this._bindings,this._conn,t)}async insertArrowTable(e,t){let n=Uy(e,"stream");await this.insertArrowFromIPCStream(n,t)}async insertArrowFromIPCStream(e,t){await this._bindings.insertArrowFromIPCStream(this._conn,e,t)}async insertCSVFromPath(e,t){await this._bindings.insertCSVFromPath(this._conn,e,t)}async insertJSONFromPath(e,t){await this._bindings.insertJSONFromPath(this._conn,e,t)}},gC=class{constructor(e,t,n){this.db=e,this.conn=t,this.header=n,this._first=!0,this._depleted=!1,this._inFlight=null}async next(){if(this._first)return this._first=!1,{done:!1,value:this.header};if(this._depleted)return{done:!0,value:null};let e=null;for(this._inFlight!=null&&(e=await this._inFlight,this._inFlight=null);e==null;)e=await this.db.fetchQueryResults(this.conn);return this._depleted=e.length==0,this._depleted||(this._inFlight=this.db.fetchQueryResults(this.conn)),{done:this._depleted,value:e}}[Symbol.asyncIterator](){return this}},F8=class{constructor(e,t,n){this.bindings=e,this.connectionId=t,this.statementId=n}async close(){await this.bindings.closePrepared(this.connectionId,this.statementId)}async query(...e){let t=await this.bindings.runPrepared(this.connectionId,this.statementId,e),n=si.from(t);return console.assert(n.isSync()),console.assert(n.isFile()),new mt(n)}async send(...e){let t=await this.bindings.sendPrepared(this.connectionId,this.statementId,e),n=new gC(this.bindings,this.connectionId,t),r=await si.from(n);return console.assert(r.isAsync()),console.assert(r.isStream()),r}},z8=(i=>(i.CANCEL_PENDING_QUERY="CANCEL_PENDING_QUERY",i.CLOSE_PREPARED="CLOSE_PREPARED",i.COLLECT_FILE_STATISTICS="COLLECT_FILE_STATISTICS",i.REGISTER_OPFS_FILE_NAME="REGISTER_OPFS_FILE_NAME",i.CONNECT="CONNECT",i.COPY_FILE_TO_BUFFER="COPY_FILE_TO_BUFFER",i.COPY_FILE_TO_PATH="COPY_FILE_TO_PATH",i.CREATE_PREPARED="CREATE_PREPARED",i.DISCONNECT="DISCONNECT",i.DROP_FILE="DROP_FILE",i.DROP_FILES="DROP_FILES",i.EXPORT_FILE_STATISTICS="EXPORT_FILE_STATISTICS",i.FETCH_QUERY_RESULTS="FETCH_QUERY_RESULTS",i.FLUSH_FILES="FLUSH_FILES",i.GET_FEATURE_FLAGS="GET_FEATURE_FLAGS",i.GET_TABLE_NAMES="GET_TABLE_NAMES",i.GET_VERSION="GET_VERSION",i.GLOB_FILE_INFOS="GLOB_FILE_INFOS",i.INSERT_ARROW_FROM_IPC_STREAM="INSERT_ARROW_FROM_IPC_STREAM",i.INSERT_CSV_FROM_PATH="IMPORT_CSV_FROM_PATH",i.INSERT_JSON_FROM_PATH="IMPORT_JSON_FROM_PATH",i.INSTANTIATE="INSTANTIATE",i.OPEN="OPEN",i.PING="PING",i.POLL_PENDING_QUERY="POLL_PENDING_QUERY",i.REGISTER_FILE_BUFFER="REGISTER_FILE_BUFFER",i.REGISTER_FILE_HANDLE="REGISTER_FILE_HANDLE",i.REGISTER_FILE_URL="REGISTER_FILE_URL",i.RESET="RESET",i.RUN_PREPARED="RUN_PREPARED",i.RUN_QUERY="RUN_QUERY",i.SEND_PREPARED="SEND_PREPARED",i.START_PENDING_QUERY="START_PENDING_QUERY",i.TOKENIZE="TOKENIZE",i))(z8||{}),U8=(i=>(i.CONNECTION_INFO="CONNECTION_INFO",i.ERROR="ERROR",i.FEATURE_FLAGS="FEATURE_FLAGS",i.FILE_BUFFER="FILE_BUFFER",i.FILE_INFOS="FILE_INFOS",i.FILE_SIZE="FILE_SIZE",i.FILE_STATISTICS="FILE_STATISTICS",i.INSTANTIATE_PROGRESS="INSTANTIATE_PROGRESS",i.LOG="LOG",i.PROGRESS_UPDATE="PROGRESS_UPDATE",i.OK="OK",i.PREPARED_STATEMENT_ID="PREPARED_STATEMENT_ID",i.QUERY_PLAN="QUERY_PLAN",i.QUERY_RESULT="QUERY_RESULT",i.QUERY_RESULT_CHUNK="QUERY_RESULT_CHUNK",i.QUERY_RESULT_HEADER="QUERY_RESULT_HEADER",i.QUERY_RESULT_HEADER_OR_NULL="QUERY_RESULT_HEADER_OR_NULL",i.REGISTERED_FILE="REGISTERED_FILE",i.SCRIPT_TOKENS="SCRIPT_TOKENS",i.SUCCESS="SUCCESS",i.TABLE_NAMES="TABLE_NAMES",i.VERSION_STRING="VERSION_STRING",i))(U8||{}),Ye=class{constructor(e,t){this.promiseResolver=()=>{},this.promiseRejecter=()=>{},this.type=e,this.data=t,this.promise=new Promise((n,r)=>{this.promiseResolver=n,this.promiseRejecter=r})}};function Rh(i){switch(i.typeId){case S.Binary:return{sqlType:"binary"};case S.Bool:return{sqlType:"bool"};case S.Date:return{sqlType:"date"};case S.DateDay:return{sqlType:"date32[d]"};case S.DateMillisecond:return{sqlType:"date64[ms]"};case S.Decimal:{let e=i;return{sqlType:"decimal",precision:e.precision,scale:e.scale}}case S.Float:return{sqlType:"float"};case S.Float16:return{sqlType:"float16"};case S.Float32:return{sqlType:"float32"};case S.Float64:return{sqlType:"float64"};case S.Int:return{sqlType:"int32"};case S.Int16:return{sqlType:"int16"};case S.Int32:return{sqlType:"int32"};case S.Int64:return{sqlType:"int64"};case S.Uint16:return{sqlType:"uint16"};case S.Uint32:return{sqlType:"uint32"};case S.Uint64:return{sqlType:"uint64"};case S.Uint8:return{sqlType:"uint8"};case S.IntervalDayTime:return{sqlType:"interval[dt]"};case S.IntervalYearMonth:return{sqlType:"interval[m]"};case S.List:return{sqlType:"list",valueType:Rh(i.valueType)};case S.FixedSizeBinary:return{sqlType:"fixedsizebinary",byteWidth:i.byteWidth};case S.Null:return{sqlType:"null"};case S.Utf8:return{sqlType:"utf8"};case S.Struct:return{sqlType:"struct",fields:i.children.map(e=>mg(e.name,e.type))};case S.Map:{let e=i;return{sqlType:"map",keyType:Rh(e.keyType),valueType:Rh(e.valueType)}}case S.Time:return{sqlType:"time[s]"};case S.TimeMicrosecond:return{sqlType:"time[us]"};case S.TimeMillisecond:return{sqlType:"time[ms]"};case S.TimeNanosecond:return{sqlType:"time[ns]"};case S.TimeSecond:return{sqlType:"time[s]"};case S.Timestamp:return{sqlType:"timestamp",timezone:i.timezone||void 0};case S.TimestampSecond:return{sqlType:"timestamp[s]",timezone:i.timezone||void 0};case S.TimestampMicrosecond:return{sqlType:"timestamp[us]",timezone:i.timezone||void 0};case S.TimestampNanosecond:return{sqlType:"timestamp[ns]",timezone:i.timezone||void 0};case S.TimestampMillisecond:return{sqlType:"timestamp[ms]",timezone:i.timezone||void 0}}throw new Error("unsupported arrow type: ".concat(i.toString()))}function mg(i,e){let t=Rh(e);return t.name=i,t}var $8=new TextEncoder,V8=class{constructor(e,t=null){this._onInstantiationProgress=[],this._onExecutionProgress=[],this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{},this._nextMessageId=0,this._pendingRequests=new Map,this._logger=e,this._onMessageHandler=this.onMessage.bind(this),this._onErrorHandler=this.onError.bind(this),this._onCloseHandler=this.onClose.bind(this),t!=null&&this.attach(t)}get logger(){return this._logger}attach(e){this._worker=e,this._worker.addEventListener("message",this._onMessageHandler),this._worker.addEventListener("error",this._onErrorHandler),this._worker.addEventListener("close",this._onCloseHandler),this._workerShutdownPromise=new Promise((t,n)=>{this._workerShutdownResolver=t})}detach(){this._worker&&(this._worker.removeEventListener("message",this._onMessageHandler),this._worker.removeEventListener("error",this._onErrorHandler),this._worker.removeEventListener("close",this._onCloseHandler),this._worker=null,this._workerShutdownResolver(null),this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async terminate(){this._worker&&(this._worker.terminate(),this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async postTask(e,t=[]){if(!this._worker){console.error("cannot send a message since the worker is not set!");return}let n=this._nextMessageId++;return this._pendingRequests.set(n,e),this._worker.postMessage({messageId:n,type:e.type,data:e.data},t),await e.promise}onMessage(e){var t;let n=e.data;switch(n.type){case"PROGRESS_UPDATE":{for(let o of this._onExecutionProgress)o(n.data);return}case"LOG":{this._logger.log(n.data);return}case"INSTANTIATE_PROGRESS":{for(let o of this._onInstantiationProgress)o(n.data);return}}let r=this._pendingRequests.get(n.requestId);if(!r){console.warn("unassociated response: [".concat(n.requestId,", ").concat(n.type.toString(),"]"));return}if(this._pendingRequests.delete(n.requestId),n.type=="ERROR"){let o=new Error(n.data.message);o.name=n.data.name,(t=Object.getOwnPropertyDescriptor(o,"stack"))!=null&&t.writable&&(o.stack=n.data.stack),r.promiseRejecter(o);return}switch(r.type){case"CLOSE_PREPARED":case"COLLECT_FILE_STATISTICS":case"REGISTER_OPFS_FILE_NAME":case"COPY_FILE_TO_PATH":case"DISCONNECT":case"DROP_FILE":case"DROP_FILES":case"FLUSH_FILES":case"INSERT_ARROW_FROM_IPC_STREAM":case"IMPORT_CSV_FROM_PATH":case"IMPORT_JSON_FROM_PATH":case"OPEN":case"PING":case"REGISTER_FILE_BUFFER":case"REGISTER_FILE_HANDLE":case"REGISTER_FILE_URL":case"RESET":if(n.type=="OK"){r.promiseResolver(n.data);return}break;case"INSTANTIATE":if(this._onInstantiationProgress=[],n.type=="OK"){r.promiseResolver(n.data);return}break;case"GLOB_FILE_INFOS":if(n.type=="FILE_INFOS"){r.promiseResolver(n.data);return}break;case"GET_VERSION":if(n.type=="VERSION_STRING"){r.promiseResolver(n.data);return}break;case"GET_FEATURE_FLAGS":if(n.type=="FEATURE_FLAGS"){r.promiseResolver(n.data);return}break;case"GET_TABLE_NAMES":if(n.type=="TABLE_NAMES"){r.promiseResolver(n.data);return}break;case"TOKENIZE":if(n.type=="SCRIPT_TOKENS"){r.promiseResolver(n.data);return}break;case"COPY_FILE_TO_BUFFER":if(n.type=="FILE_BUFFER"){r.promiseResolver(n.data);return}break;case"EXPORT_FILE_STATISTICS":if(n.type=="FILE_STATISTICS"){r.promiseResolver(n.data);return}break;case"CONNECT":if(n.type=="CONNECTION_INFO"){r.promiseResolver(n.data);return}break;case"RUN_PREPARED":case"RUN_QUERY":if(n.type=="QUERY_RESULT"){r.promiseResolver(n.data);return}break;case"SEND_PREPARED":if(n.type=="QUERY_RESULT_HEADER"){r.promiseResolver(n.data);return}break;case"START_PENDING_QUERY":if(n.type=="QUERY_RESULT_HEADER_OR_NULL"){r.promiseResolver(n.data);return}break;case"POLL_PENDING_QUERY":if(n.type=="QUERY_RESULT_HEADER_OR_NULL"){r.promiseResolver(n.data);return}break;case"CANCEL_PENDING_QUERY":if(this._onInstantiationProgress=[],n.type=="SUCCESS"){r.promiseResolver(n.data);return}break;case"FETCH_QUERY_RESULTS":if(n.type=="QUERY_RESULT_CHUNK"){r.promiseResolver(n.data);return}break;case"CREATE_PREPARED":if(n.type=="PREPARED_STATEMENT_ID"){r.promiseResolver(n.data);return}break}r.promiseRejecter(new Error("unexpected response type: ".concat(n.type.toString())))}onError(e){console.error(e),console.error("error in duckdb worker: ".concat(e.message)),this._pendingRequests.clear()}onClose(){if(this._workerShutdownResolver(null),this._pendingRequests.size!=0){console.warn("worker terminated with ".concat(this._pendingRequests.size," pending requests"));return}this._pendingRequests.clear()}async reset(){let e=new Ye("RESET",null);return await this.postTask(e)}async ping(){let e=new Ye("PING",null);await this.postTask(e)}async dropFile(e){let t=new Ye("DROP_FILE",e);return await this.postTask(t)}async dropFiles(){let e=new Ye("DROP_FILES",null);return await this.postTask(e)}async flushFiles(){let e=new Ye("FLUSH_FILES",null);return await this.postTask(e)}async instantiate(e,t=null,n=r=>{}){this._onInstantiationProgress.push(n);let r=new Ye("INSTANTIATE",[e,t]);return await this.postTask(r)}async getVersion(){let e=new Ye("GET_VERSION",null);return await this.postTask(e)}async getFeatureFlags(){let e=new Ye("GET_FEATURE_FLAGS",null);return await this.postTask(e)}async open(e){let t=new Ye("OPEN",e);await this.postTask(t)}async tokenize(e){let t=new Ye("TOKENIZE",e);return await this.postTask(t)}async connectInternal(){let e=new Ye("CONNECT",null);return await this.postTask(e)}async connect(){let e=await this.connectInternal();return new O8(this,e)}async disconnect(e){let t=new Ye("DISCONNECT",e);await this.postTask(t)}async runQuery(e,t){let n=new Ye("RUN_QUERY",[e,t]);return await this.postTask(n)}async startPendingQuery(e,t,n=!1){let r=new Ye("START_PENDING_QUERY",[e,t,n]);return await this.postTask(r)}async pollPendingQuery(e){let t=new Ye("POLL_PENDING_QUERY",e);return await this.postTask(t)}async cancelPendingQuery(e){let t=new Ye("CANCEL_PENDING_QUERY",e);return await this.postTask(t)}async fetchQueryResults(e){let t=new Ye("FETCH_QUERY_RESULTS",e);return await this.postTask(t)}async getTableNames(e,t){let n=new Ye("GET_TABLE_NAMES",[e,t]);return await this.postTask(n)}async createPrepared(e,t){let n=new Ye("CREATE_PREPARED",[e,t]);return await this.postTask(n)}async closePrepared(e,t){let n=new Ye("CLOSE_PREPARED",[e,t]);await this.postTask(n)}async runPrepared(e,t,n){let r=new Ye("RUN_PREPARED",[e,t,n]);return await this.postTask(r)}async sendPrepared(e,t,n){let r=new Ye("SEND_PREPARED",[e,t,n]);return await this.postTask(r)}async globFiles(e){let t=new Ye("GLOB_FILE_INFOS",e);return await this.postTask(t)}async registerFileText(e,t){let n=$8.encode(t);await this.registerFileBuffer(e,n)}async registerFileURL(e,t,n,r){t===void 0&&(t=e);let o=new Ye("REGISTER_FILE_URL",[e,t,n,r]);await this.postTask(o)}async registerEmptyFileBuffer(e){}async registerFileBuffer(e,t){let n=new Ye("REGISTER_FILE_BUFFER",[e,t]);await this.postTask(n,[t.buffer])}async registerFileHandle(e,t,n,r){let o=new Ye("REGISTER_FILE_HANDLE",[e,t,n,r]);await this.postTask(o,[])}async registerOPFSFileName(e){let t=new Ye("REGISTER_OPFS_FILE_NAME",[e]);await this.postTask(t,[])}async collectFileStatistics(e,t){let n=new Ye("COLLECT_FILE_STATISTICS",[e,t]);await this.postTask(n,[])}async exportFileStatistics(e){let t=new Ye("EXPORT_FILE_STATISTICS",e);return await this.postTask(t,[])}async copyFileToBuffer(e){let t=new Ye("COPY_FILE_TO_BUFFER",e);return await this.postTask(t)}async copyFileToPath(e,t){let n=new Ye("COPY_FILE_TO_PATH",[e,t]);await this.postTask(n)}async insertArrowFromIPCStream(e,t,n){if(t.length==0)return;let r=new Ye("INSERT_ARROW_FROM_IPC_STREAM",[e,t,n]);await this.postTask(r,[t.buffer])}async insertCSVFromPath(e,t,n){if(n.columns!==void 0){let o=[];for(let s in n.columns){let a=n.columns[s];o.push(mg(s,a))}n.columnsFlat=o,delete n.columns}let r=new Ye("IMPORT_CSV_FROM_PATH",[e,t,n]);await this.postTask(r)}async insertJSONFromPath(e,t,n){if(n.columns!==void 0){let o=[];for(let s in n.columns){let a=n.columns[s];o.push(mg(s,a))}n.columnsFlat=o,delete n.columns}let r=new Ye("IMPORT_JSON_FROM_PATH",[e,t,n]);await this.postTask(r)}};function H8(){let i=new TextDecoder;return e=>(typeof SharedArrayBuffer<"u"&&e.buffer instanceof SharedArrayBuffer&&(e=new Uint8Array(e)),i.decode(e))}H8();var _C=(i=>(i[i.BUFFER=0]="BUFFER",i[i.NODE_FS=1]="NODE_FS",i[i.BROWSER_FILEREADER=2]="BROWSER_FILEREADER",i[i.BROWSER_FSACCESS=3]="BROWSER_FSACCESS",i[i.HTTP=4]="HTTP",i[i.S3=5]="S3",i))(_C||{}),G8=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,3,1,0,1,10,14,1,12,0,65,0,65,0,65,0,252,10,0,0,11])),W8=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,6,64,25,11,11])),j8=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),Y8=()=>(async i=>{try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(i)}catch{return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])),Wy={name:"@duckdb/duckdb-wasm",version:"1.29.1-dev260.0"},q8=Wy.name,X8=Wy.version,jy=Wy.version.split(".");jy[0];jy[1];jy[2];var K8=()=>typeof navigator>"u";function Z8(){let i="https://cdn.jsdelivr.net/npm/".concat(q8,"@").concat(X8,"/dist/");return{mvp:{mainModule:"".concat(i,"duckdb-mvp.wasm"),mainWorker:"".concat(i,"duckdb-browser-mvp.worker.js")},eh:{mainModule:"".concat(i,"duckdb-eh.wasm"),mainWorker:"".concat(i,"duckdb-browser-eh.worker.js")}}}var Ip=null,kp=null,Lp=null,Rp=null,Pp=null;async function Q8(){return Ip==null&&(Ip=typeof BigInt64Array<"u"),kp==null&&(kp=await W8()),Lp==null&&(Lp=await Y8()),Rp==null&&(Rp=await j8()),Pp==null&&(Pp=await G8()),{bigInt64Array:Ip,crossOriginIsolated:K8()||globalThis.crossOriginIsolated||!1,wasmExceptions:kp,wasmSIMD:Rp,wasmThreads:Lp,wasmBulkMemory:Pp}}async function J8(i){let e=await Q8();if(e.wasmExceptions){if(e.wasmSIMD&&e.wasmThreads&&e.crossOriginIsolated&&i.coi)return{mainModule:i.coi.mainModule,mainWorker:i.coi.mainWorker,pthreadWorker:i.coi.pthreadWorker};if(i.eh)return{mainModule:i.eh.mainModule,mainWorker:i.eh.mainWorker,pthreadWorker:null}}return{mainModule:i.mvp.mainModule,mainWorker:i.mvp.mainWorker,pthreadWorker:null}}A8(I8());var De,le,mi;(function(i){i.RawPoints="temp_cosmograph_raw_points",i.RawLinks="temp_cosmograph_raw_links",i.PreparedPoints="temp_cosmograph_prepared_points",i.PreparedLinks="temp_cosmograph_prepared_links",i.Points="cosmograph_points",i.Links="cosmograph_links"})(De||(De={})),(function(i){i.Id="id",i.Idx="idx",i.Sequence="points_idx_seq",i.Source="source",i.SourceIdx="sourceidx",i.Target="target",i.TargetIdx="targetidx"})(le||(le={})),(function(i){i.Parquet="parquet",i.Arrow="arrow",i.CSV="csv",i.JSON="json"})(mi||(mi={}));const $s=Hy(),eU=Z8();var zi;let yC=(zi=class{constructor(){m(this,"_db");m(this,"_connection");m(this,"logTable",async(e,t=!1)=>{var c;if(!$s)return;const n=`SELECT COUNT(*) as count FROM ${e}`,r=await this.query(n);if(!r)return;const o=(c=r.getChild("count"))==null?void 0:c.get(0),s=`SELECT * FROM ${e} ${t?"":"LIMIT 10"}`,a=await this.query(s);if(!a)return;const l=fC(a);console.groupCollapsed(`Table: ${e} | ${o} rows ${t?"":"(showing first 10)"}`),console.table(l),console.groupEnd()})}static async getInstance(){return zi._initPromise=(async()=>{const e=new zi;return await e._init(),e})(),zi._instance=await zi._initPromise,zi._instance}async _init(){const e=await J8(eU),t=URL.createObjectURL(new Blob([`importScripts("${e.mainWorker}");`],{type:"text/javascript"})),n=new Worker(t),r=new N8;this._db=new V8(r,n),await this._db.instantiate(e.mainModule,e.pthreadWorker),this._connection=await this._db.connect(),await this._connection.query(`
      SET max_expression_depth TO 20000000;
      SET memory_limit = '10GB';
    `.trim()),URL.revokeObjectURL(t)}get connection(){if(!this._connection)throw new Error("Cosmograph: DuckDB-Wasm connection is not initialized");return this._connection}get db(){if(!this._db)throw new Error("Cosmograph: DuckDB-Wasm is not initialized");return this._db}async destroy(){await this.connection.close(),await this.db.terminate(),zi._instance=void 0,zi._initPromise=void 0}async dropTable(e){await this.query(`DROP TABLE IF EXISTS "${e}"`)}async query(e){let t;$s&&(console.log("%cExecuted query:","color: #a6a6a6;",{sql:e}),t=performance.now());try{return await this.connection.query(e)}catch(n){globalThis.__lastDuckdbError=String(n),console.warn(`Couldn't query internal DuckDB instance: ${n}`)}finally{if($s&&t!==void 0){const n=performance.now()-t;console.log("%cFinished query:","color: #a6a6a6;",{sql:e,duration:+n.toFixed(1)})}}}async exec(e){await this.query(e)}async send(e,t){$s&&console.log(e),$s&&console.time("query");try{const n=await this.connection.send(e);let r;for(;!(r=await n.next()).done;){const o=r.value;for(let s=0;s<o.numRows;s++){const a=o.getChildAt(s);t&&t(a)}}}catch(n){console.warn(`Couldn't query internal DuckDB instance: ${n}`)}$s&&console.timeEnd("query")}async uploadData(e,t,n=!1,r,o){if(Array.isArray(e)&&e.length>0&&e[0]&&typeof e[0]=="object")return await this.uploadObject(e,t,n);if(e instanceof Uint8Array||e instanceof ArrayBuffer||e instanceof mt)return await this._uploadArrow(e,t,n);if(typeof e=="string"||e instanceof File){const s=c=>c.endsWith(".arrow")?mi.Arrow:c.endsWith(".parquet")||c.endsWith(".pq")?mi.Parquet:c.endsWith(".csv")||c.endsWith(".tsv")?mi.CSV:c.endsWith(".json")?mi.JSON:"unknown",a=e instanceof File?e.name:e,l=s(a);l==="unknown"&&console.warn(`Unknown file type: ${a}`);try{switch(l){case mi.Arrow:return await this._uploadArrow(e,t,n);case mi.Parquet:return await this._uploadParquet(e,t,n);case mi.CSV:return await this._uploadCSV(e,t,n,r,o);case mi.JSON:return await this._uploadJSON(e,t,n);default:throw new Error("Unsupported file type")}}catch(c){return console.warn(`uploadData: ${c}`),{error:c}}}return{error:"Could not upload data"}}async uploadArrow(e,t){return await this._uploadArrow(e,t)}async exportTableToArrow(e){try{const t=[],n=await this.connection.send(`SELECT * FROM ${e}`);let r;for(;!(r=await n.next()).done;){const o=r.value;o&&o.numRows&&t.push(o)}return t.length?new mt(t):void 0}catch(t){throw console.warn(`exportTableToArrow: Failed to export table "${e}":`,t),t}}async exportTableToArrowBuffer(e){const t=await this.exportTableToArrow(e);return t?Uy(t):void 0}async exportTableToPq(e){var n,r;const t=`${e}.${mi.Parquet}`;try{return await this.connection.query(`COPY ${e} TO '${t}' (FORMAT PARQUET)`),await((n=this._db)==null?void 0:n.copyFileToBuffer(t))}catch(o){console.error(`Failed to export table "${e}" to file "${t}":`,o)}finally{await((r=this._db)==null?void 0:r.registerEmptyFileBuffer(t))}}async exportTableToCSV(e){var n,r;const t=`${e}.${mi.CSV}`;try{return await this.connection.query(`COPY ${e} TO '${t}' (HEADER, DELIMITER ',')`),await((n=this._db)==null?void 0:n.copyFileToBuffer(t))}catch(o){console.error(`Failed to export table "${e}" to file "${t}":`,o)}finally{await((r=this._db)==null?void 0:r.registerEmptyFileBuffer(t))}}async uploadObject(e,t,n=!1){if(e.length===0)return{};try{const r=`t_${t}`;await this.query(`DROP TABLE IF EXISTS "${r}"`);const o=W7(e);return await this.connection.insertArrowTable(o,{name:r}),await this._handleTableInsertion(r,t,n),await this.logTable(t),{}}catch(r){throw new Error(`Failed to upload Object: ${r}`)}}async _uploadCSV(e,t,n=!1,r,o){const s=`t_${t}`;let a=null;try{let l;if(e instanceof File){const u=await e.text();a=e.name,await this.db.registerFileText(a,u),l=a}else l=e;const c=`
        CREATE TABLE ${s} AS SELECT * FROM read_csv_auto(
          '${l}',
          SAMPLE_SIZE=-1,
          allow_quoted_nulls=true,
          ignore_errors=true
          ${r?`, timestampformat='${r}'`:""}
          ${o?`, types=${JSON.stringify(o)}`:""}
        )`.trim();return await this.query(c),await this._handleTableInsertion(s,t,n),await this.logTable(t),{}}catch(l){throw new Error(`Failed to upload CSV: ${l}`)}finally{a&&await this.db.dropFile(a)}}async _uploadParquet(e,t,n=!1){const r=`t_${t}`;let o=null;try{let s;e instanceof File?(o=e.name,await this.db.registerFileHandle(o,e,_C.BROWSER_FILEREADER,!0),s=o):s=e;const a=`CREATE TABLE ${r} AS SELECT * FROM read_parquet('${s}')`;return await this.query(a),await this._handleTableInsertion(r,t,n),await this.logTable(t),{}}catch(s){const a=s instanceof Error?s.message:String(s);throw new Error(`Failed to upload Parquet: ${a}`)}finally{o&&await this.db.dropFile(o)}}async _uploadArrow(e,t,n=!1){try{let r;const o=`t_${t}`;if(await this.query(`DROP TABLE IF EXISTS "${o}"`),e instanceof File)r=await e.arrayBuffer(),r=new Uint8Array(r);else if(typeof e=="string"){const a=await fetch(e);a.ok||console.warn(`Failed to fetch file: ${a.statusText}`),r=await a.arrayBuffer(),r=new Uint8Array(r)}else r=e;const s=e instanceof mt?e:uC(r);return await this.connection.insertArrowTable(s,{name:o}),await this._handleTableInsertion(o,t,n),await this.logTable(t),{}}catch(r){const o=r instanceof Error?r.message:String(r);throw new Error(`Failed to upload Arrow: ${o}`)}}async _uploadJSON(e,t,n=!1){const r=`t_${t}`;await this.query(`DROP TABLE IF EXISTS "${r}"`);try{if(e instanceof File){const o=await e.text();await this.db.registerFileText("json",o)}else{const o=await fetch(e);o.ok||console.warn(`Failed to fetch file: ${o.statusText}`);const s=await o.text();await this.db.registerFileText("json",s)}return await this.connection.insertJSONFromPath("json",{name:r}),await this._handleTableInsertion(r,t,n),await this.logTable(t),{}}catch(o){const s=o instanceof Error?o.message:String(o);throw new Error(`Failed to upload JSON: ${s}`)}finally{await this.db.dropFile("json")}}async _handleTableInsertion(e,t,n){n?(await this.query(`INSERT INTO "${t}" SELECT * FROM "${e}"`),await this.query(`DROP TABLE IF EXISTS "${e}"`)):(await this.query(`DROP TABLE IF EXISTS "${t}"`),await this.query(`ALTER TABLE "${e}" RENAME TO "${t}"`))}},m(zi,"_instance"),m(zi,"_initPromise"),zi);const tU=Hy();let iU=class bC{constructor(e,t){m(this,"_coordinator");m(this,"_internalDB");if(!e)return;const n=new M2;n.databaseConnector(e),tU?n.manager.logQueries(!0):n.logger(null),this._coordinator=n,this._internalDB=t}static async create(e){let t,n;try{if(e)typeof e=="string"?(t=new FF({uri:e}),ue("Connected to remote DuckDB instance","","ok")):(t=new D0(e),ue("Connected to configured duckdb-wasm instance","","ok"));else{const r=Date.now();n=await yC.getInstance(),t=new D0({duckdb:n.db,connection:n.connection});const o=Date.now();ue(`Initialized local duckdb-wasm instance in ${(o-r).toFixed()}ms`,"","ok")}}catch(r){return void ue(`Couldn't create MosaicDBCoordinator: ${r}`,"","error")}return new bC(t,n)}get internalDB(){return this._internalDB}connect(e){var t,n;(t=this._coordinator)!=null&&t.clients.has(e)||((n=this._coordinator)==null||n.connect(e))}disconnect(e){var t,n;(t=this._coordinator)!=null&&t.clients.has(e)&&((n=this._coordinator)==null||n.disconnect(e))}clearCache(){var e;(e=this._coordinator)==null||e.clear({cache:!0,clients:!1})}async destroy(){var e;(e=this._coordinator)==null||e.clear(),this._coordinator=void 0}query(e,t={}){const{cache:n=!1,...r}=t;return this._coordinator.query(e,{cache:n,...r})}};var gg="http://www.w3.org/1999/xhtml";const N0={svg:"http://www.w3.org/2000/svg",xhtml:gg,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function kf(i){var e=i+="",t=e.indexOf(":");return t>=0&&(e=i.slice(0,t))!=="xmlns"&&(i=i.slice(t+1)),N0.hasOwnProperty(e)?{space:N0[e],local:i}:i}function nU(i){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===gg&&e.documentElement.namespaceURI===gg?e.createElement(i):e.createElementNS(t,i)}}function rU(i){return function(){return this.ownerDocument.createElementNS(i.space,i.local)}}function vC(i){var e=kf(i);return(e.local?rU:nU)(e)}function oU(){}function Yy(i){return i==null?oU:function(){return this.querySelector(i)}}function sU(i){typeof i!="function"&&(i=Yy(i));for(var e=this._groups,t=e.length,n=new Array(t),r=0;r<t;++r)for(var o=e[r],s=o.length,a=n[r]=new Array(s),l,c,u=0;u<s;++u)(l=o[u])&&(c=i.call(l,l.__data__,u,o))&&("__data__"in l&&(c.__data__=l.__data__),a[u]=c);return new cn(n,this._parents)}function aU(i){return i==null?[]:Array.isArray(i)?i:Array.from(i)}function lU(){return[]}function xC(i){return i==null?lU:function(){return this.querySelectorAll(i)}}function cU(i){return function(){return aU(i.apply(this,arguments))}}function uU(i){typeof i=="function"?i=cU(i):i=xC(i);for(var e=this._groups,t=e.length,n=[],r=[],o=0;o<t;++o)for(var s=e[o],a=s.length,l,c=0;c<a;++c)(l=s[c])&&(n.push(i.call(l,l.__data__,c,s)),r.push(l));return new cn(n,r)}function wC(i){return function(){return this.matches(i)}}function SC(i){return function(e){return e.matches(i)}}var hU=Array.prototype.find;function dU(i){return function(){return hU.call(this.children,i)}}function fU(){return this.firstElementChild}function pU(i){return this.select(i==null?fU:dU(typeof i=="function"?i:SC(i)))}var mU=Array.prototype.filter;function gU(){return Array.from(this.children)}function _U(i){return function(){return mU.call(this.children,i)}}function yU(i){return this.selectAll(i==null?gU:_U(typeof i=="function"?i:SC(i)))}function bU(i){typeof i!="function"&&(i=wC(i));for(var e=this._groups,t=e.length,n=new Array(t),r=0;r<t;++r)for(var o=e[r],s=o.length,a=n[r]=[],l,c=0;c<s;++c)(l=o[c])&&i.call(l,l.__data__,c,o)&&a.push(l);return new cn(n,this._parents)}function EC(i){return new Array(i.length)}function vU(){return new cn(this._enter||this._groups.map(EC),this._parents)}function Md(i,e){this.ownerDocument=i.ownerDocument,this.namespaceURI=i.namespaceURI,this._next=null,this._parent=i,this.__data__=e}Md.prototype={constructor:Md,appendChild:function(i){return this._parent.insertBefore(i,this._next)},insertBefore:function(i,e){return this._parent.insertBefore(i,e)},querySelector:function(i){return this._parent.querySelector(i)},querySelectorAll:function(i){return this._parent.querySelectorAll(i)}};function xU(i){return function(){return i}}function wU(i,e,t,n,r,o){for(var s=0,a,l=e.length,c=o.length;s<c;++s)(a=e[s])?(a.__data__=o[s],n[s]=a):t[s]=new Md(i,o[s]);for(;s<l;++s)(a=e[s])&&(r[s]=a)}function SU(i,e,t,n,r,o,s){var a,l,c=new Map,u=e.length,h=o.length,d=new Array(u),f;for(a=0;a<u;++a)(l=e[a])&&(d[a]=f=s.call(l,l.__data__,a,e)+"",c.has(f)?r[a]=l:c.set(f,l));for(a=0;a<h;++a)f=s.call(i,o[a],a,o)+"",(l=c.get(f))?(n[a]=l,l.__data__=o[a],c.delete(f)):t[a]=new Md(i,o[a]);for(a=0;a<u;++a)(l=e[a])&&c.get(d[a])===l&&(r[a]=l)}function EU(i){return i.__data__}function CU(i,e){if(!arguments.length)return Array.from(this,EU);var t=e?SU:wU,n=this._parents,r=this._groups;typeof i!="function"&&(i=xU(i));for(var o=r.length,s=new Array(o),a=new Array(o),l=new Array(o),c=0;c<o;++c){var u=n[c],h=r[c],d=h.length,f=TU(i.call(u,u&&u.__data__,c,n)),p=f.length,b=a[c]=new Array(p),g=s[c]=new Array(p),_=l[c]=new Array(d);t(u,h,b,g,_,f,e);for(var T=0,E=0,y,C;T<p;++T)if(y=b[T]){for(T>=E&&(E=T+1);!(C=g[E])&&++E<p;);y._next=C||null}}return s=new cn(s,n),s._enter=a,s._exit=l,s}function TU(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function AU(){return new cn(this._exit||this._groups.map(EC),this._parents)}function IU(i,e,t){var n=this.enter(),r=this,o=this.exit();return typeof i=="function"?(n=i(n),n&&(n=n.selection())):n=n.append(i+""),e!=null&&(r=e(r),r&&(r=r.selection())),t==null?o.remove():t(o),n&&r?n.merge(r).order():r}function kU(i){for(var e=i.selection?i.selection():i,t=this._groups,n=e._groups,r=t.length,o=n.length,s=Math.min(r,o),a=new Array(r),l=0;l<s;++l)for(var c=t[l],u=n[l],h=c.length,d=a[l]=new Array(h),f,p=0;p<h;++p)(f=c[p]||u[p])&&(d[p]=f);for(;l<r;++l)a[l]=t[l];return new cn(a,this._parents)}function LU(){for(var i=this._groups,e=-1,t=i.length;++e<t;)for(var n=i[e],r=n.length-1,o=n[r],s;--r>=0;)(s=n[r])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function RU(i){i||(i=PU);function e(h,d){return h&&d?i(h.__data__,d.__data__):!h-!d}for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o){for(var s=t[o],a=s.length,l=r[o]=new Array(a),c,u=0;u<a;++u)(c=s[u])&&(l[u]=c);l.sort(e)}return new cn(r,this._parents).order()}function PU(i,e){return i<e?-1:i>e?1:i>=e?0:NaN}function DU(){var i=arguments[0];return arguments[0]=this,i.apply(null,arguments),this}function MU(){return Array.from(this)}function NU(){for(var i=this._groups,e=0,t=i.length;e<t;++e)for(var n=i[e],r=0,o=n.length;r<o;++r){var s=n[r];if(s)return s}return null}function BU(){let i=0;for(const e of this)++i;return i}function OU(){return!this.node()}function FU(i){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],o=0,s=r.length,a;o<s;++o)(a=r[o])&&i.call(a,a.__data__,o,r);return this}function zU(i){return function(){this.removeAttribute(i)}}function UU(i){return function(){this.removeAttributeNS(i.space,i.local)}}function $U(i,e){return function(){this.setAttribute(i,e)}}function VU(i,e){return function(){this.setAttributeNS(i.space,i.local,e)}}function HU(i,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(i):this.setAttribute(i,t)}}function GU(i,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(i.space,i.local):this.setAttributeNS(i.space,i.local,t)}}function WU(i,e){var t=kf(i);if(arguments.length<2){var n=this.node();return t.local?n.getAttributeNS(t.space,t.local):n.getAttribute(t)}return this.each((e==null?t.local?UU:zU:typeof e=="function"?t.local?GU:HU:t.local?VU:$U)(t,e))}function CC(i){return i.ownerDocument&&i.ownerDocument.defaultView||i.document&&i||i.defaultView}function jU(i){return function(){this.style.removeProperty(i)}}function YU(i,e,t){return function(){this.style.setProperty(i,e,t)}}function qU(i,e,t){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(i):this.style.setProperty(i,n,t)}}function XU(i,e,t){return arguments.length>1?this.each((e==null?jU:typeof e=="function"?qU:YU)(i,e,t??"")):Fa(this.node(),i)}function Fa(i,e){return i.style.getPropertyValue(e)||CC(i).getComputedStyle(i,null).getPropertyValue(e)}function KU(i){return function(){delete this[i]}}function ZU(i,e){return function(){this[i]=e}}function QU(i,e){return function(){var t=e.apply(this,arguments);t==null?delete this[i]:this[i]=t}}function JU(i,e){return arguments.length>1?this.each((e==null?KU:typeof e=="function"?QU:ZU)(i,e)):this.node()[i]}function TC(i){return i.trim().split(/^|\s+/)}function qy(i){return i.classList||new AC(i)}function AC(i){this._node=i,this._names=TC(i.getAttribute("class")||"")}AC.prototype={add:function(i){var e=this._names.indexOf(i);e<0&&(this._names.push(i),this._node.setAttribute("class",this._names.join(" ")))},remove:function(i){var e=this._names.indexOf(i);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(i){return this._names.indexOf(i)>=0}};function IC(i,e){for(var t=qy(i),n=-1,r=e.length;++n<r;)t.add(e[n])}function kC(i,e){for(var t=qy(i),n=-1,r=e.length;++n<r;)t.remove(e[n])}function e9(i){return function(){IC(this,i)}}function t9(i){return function(){kC(this,i)}}function i9(i,e){return function(){(e.apply(this,arguments)?IC:kC)(this,i)}}function n9(i,e){var t=TC(i+"");if(arguments.length<2){for(var n=qy(this.node()),r=-1,o=t.length;++r<o;)if(!n.contains(t[r]))return!1;return!0}return this.each((typeof e=="function"?i9:e?e9:t9)(t,e))}function r9(){this.textContent=""}function o9(i){return function(){this.textContent=i}}function s9(i){return function(){var e=i.apply(this,arguments);this.textContent=e??""}}function a9(i){return arguments.length?this.each(i==null?r9:(typeof i=="function"?s9:o9)(i)):this.node().textContent}function l9(){this.innerHTML=""}function c9(i){return function(){this.innerHTML=i}}function u9(i){return function(){var e=i.apply(this,arguments);this.innerHTML=e??""}}function h9(i){return arguments.length?this.each(i==null?l9:(typeof i=="function"?u9:c9)(i)):this.node().innerHTML}function d9(){this.nextSibling&&this.parentNode.appendChild(this)}function f9(){return this.each(d9)}function p9(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function m9(){return this.each(p9)}function g9(i){var e=typeof i=="function"?i:vC(i);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function _9(){return null}function y9(i,e){var t=typeof i=="function"?i:vC(i),n=e==null?_9:typeof e=="function"?e:Yy(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),n.apply(this,arguments)||null)})}function b9(){var i=this.parentNode;i&&i.removeChild(this)}function v9(){return this.each(b9)}function x9(){var i=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(i,this.nextSibling):i}function w9(){var i=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(i,this.nextSibling):i}function S9(i){return this.select(i?w9:x9)}function E9(i){return arguments.length?this.property("__data__",i):this.node().__data__}function C9(i){return function(e){i.call(this,e,this.__data__)}}function T9(i){return i.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}function A9(i){return function(){var e=this.__on;if(e){for(var t=0,n=-1,r=e.length,o;t<r;++t)o=e[t],(!i.type||o.type===i.type)&&o.name===i.name?this.removeEventListener(o.type,o.listener,o.options):e[++n]=o;++n?e.length=n:delete this.__on}}}function I9(i,e,t){return function(){var n=this.__on,r,o=C9(e);if(n){for(var s=0,a=n.length;s<a;++s)if((r=n[s]).type===i.type&&r.name===i.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=t),r.value=e;return}}this.addEventListener(i.type,o,t),r={type:i.type,name:i.name,value:e,listener:o,options:t},n?n.push(r):this.__on=[r]}}function k9(i,e,t){var n=T9(i+""),r,o=n.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,u;l<c;++l)for(r=0,u=a[l];r<o;++r)if((s=n[r]).type===u.type&&s.name===u.name)return u.value}return}for(a=e?I9:A9,r=0;r<o;++r)this.each(a(n[r],e,t));return this}function LC(i,e,t){var n=CC(i),r=n.CustomEvent;typeof r=="function"?r=new r(e,t):(r=n.document.createEvent("Event"),t?(r.initEvent(e,t.bubbles,t.cancelable),r.detail=t.detail):r.initEvent(e,!1,!1)),i.dispatchEvent(r)}function L9(i,e){return function(){return LC(this,i,e)}}function R9(i,e){return function(){return LC(this,i,e.apply(this,arguments))}}function P9(i,e){return this.each((typeof e=="function"?R9:L9)(i,e))}function*D9(){for(var i=this._groups,e=0,t=i.length;e<t;++e)for(var n=i[e],r=0,o=n.length,s;r<o;++r)(s=n[r])&&(yield s)}var RC=[null];function cn(i,e){this._groups=i,this._parents=e}function au(){return new cn([[document.documentElement]],RC)}function M9(){return this}cn.prototype=au.prototype={constructor:cn,select:sU,selectAll:uU,selectChild:pU,selectChildren:yU,filter:bU,data:CU,enter:vU,exit:AU,join:IU,merge:kU,selection:M9,order:LU,sort:RU,call:DU,nodes:MU,node:NU,size:BU,empty:OU,each:FU,attr:WU,style:XU,property:JU,classed:n9,text:a9,html:h9,raise:f9,lower:m9,append:g9,insert:y9,remove:v9,clone:S9,datum:E9,on:k9,dispatch:P9,[Symbol.iterator]:D9};function Et(i){return typeof i=="string"?new cn([[document.querySelector(i)]],[document.documentElement]):new cn([[i]],RC)}function N9(i){let e;for(;e=i.sourceEvent;)i=e;return i}function B0(i,e){if(i=N9(i),e===void 0&&(e=i.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var n=t.createSVGPoint();return n.x=i.clientX,n.y=i.clientY,n=n.matrixTransform(e.getScreenCTM().inverse()),[n.x,n.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[i.clientX-r.left-e.clientLeft,i.clientY-r.top-e.clientTop]}}return[i.pageX,i.pageY]}var B9={value:()=>{}};function Xy(){for(var i=0,e=arguments.length,t={},n;i<e;++i){if(!(n=arguments[i]+"")||n in t||/[\s.]/.test(n))throw new Error("illegal type: "+n);t[n]=[]}return new Ph(t)}function Ph(i){this._=i}function O9(i,e){return i.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}})}Ph.prototype=Xy.prototype={constructor:Ph,on:function(i,e){var t=this._,n=O9(i+"",t),r,o=-1,s=n.length;if(arguments.length<2){for(;++o<s;)if((r=(i=n[o]).type)&&(r=F9(t[r],i.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<s;)if(r=(i=n[o]).type)t[r]=O0(t[r],i.name,e);else if(e==null)for(r in t)t[r]=O0(t[r],i.name,null);return this},copy:function(){var i={},e=this._;for(var t in e)i[t]=e[t].slice();return new Ph(i)},call:function(i,e){if((r=arguments.length-2)>0)for(var t=new Array(r),n=0,r,o;n<r;++n)t[n]=arguments[n+2];if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(o=this._[i],n=0,r=o.length;n<r;++n)o[n].value.apply(e,t)},apply:function(i,e,t){if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(var n=this._[i],r=0,o=n.length;r<o;++r)n[r].value.apply(e,t)}};function F9(i,e){for(var t=0,n=i.length,r;t<n;++t)if((r=i[t]).name===e)return r.value}function O0(i,e,t){for(var n=0,r=i.length;n<r;++n)if(i[n].name===e){i[n]=B9,i=i.slice(0,n).concat(i.slice(n+1));break}return t!=null&&i.push({name:e,value:t}),i}var za=0,tc=0,wl=0,PC=1e3,Nd,ic,Bd=0,_s=0,Lf=0,zc=typeof performance=="object"&&performance.now?performance:Date,DC=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(i){setTimeout(i,17)};function Ky(){return _s||(DC(z9),_s=zc.now()+Lf)}function z9(){_s=0}function Od(){this._call=this._time=this._next=null}Od.prototype=MC.prototype={constructor:Od,restart:function(i,e,t){if(typeof i!="function")throw new TypeError("callback is not a function");t=(t==null?Ky():+t)+(e==null?0:+e),!this._next&&ic!==this&&(ic?ic._next=this:Nd=this,ic=this),this._call=i,this._time=t,_g()},stop:function(){this._call&&(this._call=null,this._time=1/0,_g())}};function MC(i,e,t){var n=new Od;return n.restart(i,e,t),n}function U9(){Ky(),++za;for(var i=Nd,e;i;)(e=_s-i._time)>=0&&i._call.call(void 0,e),i=i._next;--za}function F0(){_s=(Bd=zc.now())+Lf,za=tc=0;try{U9()}finally{za=0,V9(),_s=0}}function $9(){var i=zc.now(),e=i-Bd;e>PC&&(Lf-=e,Bd=i)}function V9(){for(var i,e=Nd,t,n=1/0;e;)e._call?(n>e._time&&(n=e._time),i=e,e=e._next):(t=e._next,e._next=null,e=i?i._next=t:Nd=t);ic=i,_g(n)}function _g(i){if(!za){tc&&(tc=clearTimeout(tc));var e=i-_s;e>24?(i<1/0&&(tc=setTimeout(F0,i-zc.now()-Lf)),wl&&(wl=clearInterval(wl))):(wl||(Bd=zc.now(),wl=setInterval($9,PC)),za=1,DC(F0))}}function z0(i,e,t){var n=new Od;return e=e==null?0:+e,n.restart(r=>{n.stop(),i(r+e)},e,t),n}var H9=Xy("start","end","cancel","interrupt"),G9=[],NC=0,U0=1,yg=2,Dh=3,$0=4,bg=5,Mh=6;function Rf(i,e,t,n,r,o){var s=i.__transition;if(!s)i.__transition={};else if(t in s)return;W9(i,t,{name:e,index:n,group:r,on:H9,tween:G9,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:NC})}function Zy(i,e){var t=Qn(i,e);if(t.state>NC)throw new Error("too late; already scheduled");return t}function Lr(i,e){var t=Qn(i,e);if(t.state>Dh)throw new Error("too late; already running");return t}function Qn(i,e){var t=i.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function W9(i,e,t){var n=i.__transition,r;n[e]=t,t.timer=MC(o,0,t.time);function o(c){t.state=U0,t.timer.restart(s,t.delay,t.time),t.delay<=c&&s(c-t.delay)}function s(c){var u,h,d,f;if(t.state!==U0)return l();for(u in n)if(f=n[u],f.name===t.name){if(f.state===Dh)return z0(s);f.state===$0?(f.state=Mh,f.timer.stop(),f.on.call("interrupt",i,i.__data__,f.index,f.group),delete n[u]):+u<e&&(f.state=Mh,f.timer.stop(),f.on.call("cancel",i,i.__data__,f.index,f.group),delete n[u])}if(z0(function(){t.state===Dh&&(t.state=$0,t.timer.restart(a,t.delay,t.time),a(c))}),t.state=yg,t.on.call("start",i,i.__data__,t.index,t.group),t.state===yg){for(t.state=Dh,r=new Array(d=t.tween.length),u=0,h=-1;u<d;++u)(f=t.tween[u].value.call(i,i.__data__,t.index,t.group))&&(r[++h]=f);r.length=h+1}}function a(c){for(var u=c<t.duration?t.ease.call(null,c/t.duration):(t.timer.restart(l),t.state=bg,1),h=-1,d=r.length;++h<d;)r[h].call(i,u);t.state===bg&&(t.on.call("end",i,i.__data__,t.index,t.group),l())}function l(){t.state=Mh,t.timer.stop(),delete n[e];for(var c in n)return;delete i.__transition}}function vg(i,e){var t=i.__transition,n,r,o=!0,s;if(t){e=e==null?null:e+"";for(s in t){if((n=t[s]).name!==e){o=!1;continue}r=n.state>yg&&n.state<bg,n.state=Mh,n.timer.stop(),n.on.call(r?"interrupt":"cancel",i,i.__data__,n.index,n.group),delete t[s]}o&&delete i.__transition}}function j9(i){return this.each(function(){vg(this,i)})}function Pf(i,e,t){i.prototype=e.prototype=t,t.constructor=i}function Qy(i,e){var t=Object.create(i.prototype);for(var n in e)t[n]=e[n];return t}function el(){}var ys=.7,Ua=1/ys,xa="\\s*([+-]?\\d+)\\s*",Uc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",vr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Y9=/^#([0-9a-f]{3,8})$/,q9=new RegExp(`^rgb\\(${xa},${xa},${xa}\\)$`),X9=new RegExp(`^rgb\\(${vr},${vr},${vr}\\)$`),K9=new RegExp(`^rgba\\(${xa},${xa},${xa},${Uc}\\)$`),Z9=new RegExp(`^rgba\\(${vr},${vr},${vr},${Uc}\\)$`),Q9=new RegExp(`^hsl\\(${Uc},${vr},${vr}\\)$`),J9=new RegExp(`^hsla\\(${Uc},${vr},${vr},${Uc}\\)$`),V0={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Pf(el,ao,{copy(i){return Object.assign(new this.constructor,this,i)},displayable(){return this.rgb().displayable()},hex:H0,formatHex:H0,formatHex8:e$,formatHsl:t$,formatRgb:G0,toString:G0});function H0(){return this.rgb().formatHex()}function e$(){return this.rgb().formatHex8()}function t$(){return OC(this).formatHsl()}function G0(){return this.rgb().formatRgb()}function ao(i){var e,t;return i=(i+"").trim().toLowerCase(),(e=Y9.exec(i))?(t=e[1].length,e=parseInt(e[1],16),t===6?W0(e):t===3?new _i(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?Uu(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?Uu(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=q9.exec(i))?new _i(e[1],e[2],e[3],1):(e=X9.exec(i))?new _i(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=K9.exec(i))?Uu(e[1],e[2],e[3],e[4]):(e=Z9.exec(i))?Uu(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Q9.exec(i))?q0(e[1],e[2]/100,e[3]/100,1):(e=J9.exec(i))?q0(e[1],e[2]/100,e[3]/100,e[4]):V0.hasOwnProperty(i)?W0(V0[i]):i==="transparent"?new _i(NaN,NaN,NaN,0):null}function W0(i){return new _i(i>>16&255,i>>8&255,i&255,1)}function Uu(i,e,t,n){return n<=0&&(i=e=t=NaN),new _i(i,e,t,n)}function BC(i){return i instanceof el||(i=ao(i)),i?(i=i.rgb(),new _i(i.r,i.g,i.b,i.opacity)):new _i}function Fd(i,e,t,n){return arguments.length===1?BC(i):new _i(i,e,t,n??1)}function _i(i,e,t,n){this.r=+i,this.g=+e,this.b=+t,this.opacity=+n}Pf(_i,Fd,Qy(el,{brighter(i){return i=i==null?Ua:Math.pow(Ua,i),new _i(this.r*i,this.g*i,this.b*i,this.opacity)},darker(i){return i=i==null?ys:Math.pow(ys,i),new _i(this.r*i,this.g*i,this.b*i,this.opacity)},rgb(){return this},clamp(){return new _i(as(this.r),as(this.g),as(this.b),zd(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:j0,formatHex:j0,formatHex8:i$,formatRgb:Y0,toString:Y0}));function j0(){return`#${rs(this.r)}${rs(this.g)}${rs(this.b)}`}function i$(){return`#${rs(this.r)}${rs(this.g)}${rs(this.b)}${rs((isNaN(this.opacity)?1:this.opacity)*255)}`}function Y0(){const i=zd(this.opacity);return`${i===1?"rgb(":"rgba("}${as(this.r)}, ${as(this.g)}, ${as(this.b)}${i===1?")":`, ${i})`}`}function zd(i){return isNaN(i)?1:Math.max(0,Math.min(1,i))}function as(i){return Math.max(0,Math.min(255,Math.round(i)||0))}function rs(i){return i=as(i),(i<16?"0":"")+i.toString(16)}function q0(i,e,t,n){return n<=0?i=e=t=NaN:t<=0||t>=1?i=e=NaN:e<=0&&(i=NaN),new Hn(i,e,t,n)}function OC(i){if(i instanceof Hn)return new Hn(i.h,i.s,i.l,i.opacity);if(i instanceof el||(i=ao(i)),!i)return new Hn;if(i instanceof Hn)return i;i=i.rgb();var e=i.r/255,t=i.g/255,n=i.b/255,r=Math.min(e,t,n),o=Math.max(e,t,n),s=NaN,a=o-r,l=(o+r)/2;return a?(e===o?s=(t-n)/a+(t<n)*6:t===o?s=(n-e)/a+2:s=(e-t)/a+4,a/=l<.5?o+r:2-o-r,s*=60):a=l>0&&l<1?0:s,new Hn(s,a,l,i.opacity)}function n$(i,e,t,n){return arguments.length===1?OC(i):new Hn(i,e,t,n??1)}function Hn(i,e,t,n){this.h=+i,this.s=+e,this.l=+t,this.opacity=+n}Pf(Hn,n$,Qy(el,{brighter(i){return i=i==null?Ua:Math.pow(Ua,i),new Hn(this.h,this.s,this.l*i,this.opacity)},darker(i){return i=i==null?ys:Math.pow(ys,i),new Hn(this.h,this.s,this.l*i,this.opacity)},rgb(){var i=this.h%360+(this.h<0)*360,e=isNaN(i)||isNaN(this.s)?0:this.s,t=this.l,n=t+(t<.5?t:1-t)*e,r=2*t-n;return new _i(Dp(i>=240?i-240:i+120,r,n),Dp(i,r,n),Dp(i<120?i+240:i-120,r,n),this.opacity)},clamp(){return new Hn(X0(this.h),$u(this.s),$u(this.l),zd(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const i=zd(this.opacity);return`${i===1?"hsl(":"hsla("}${X0(this.h)}, ${$u(this.s)*100}%, ${$u(this.l)*100}%${i===1?")":`, ${i})`}`}}));function X0(i){return i=(i||0)%360,i<0?i+360:i}function $u(i){return Math.max(0,Math.min(1,i||0))}function Dp(i,e,t){return(i<60?e+(t-e)*i/60:i<180?t:i<240?e+(t-e)*(240-i)/60:e)*255}const r$=Math.PI/180,o$=180/Math.PI;var FC=-.14861,Jy=1.78277,eb=-.29227,Df=-.90649,$c=1.97294,K0=$c*Df,Z0=$c*Jy,Q0=Jy*eb-Df*FC;function s$(i){if(i instanceof ls)return new ls(i.h,i.s,i.l,i.opacity);i instanceof _i||(i=BC(i));var e=i.r/255,t=i.g/255,n=i.b/255,r=(Q0*n+K0*e-Z0*t)/(Q0+K0-Z0),o=n-r,s=($c*(t-r)-eb*o)/Df,a=Math.sqrt(s*s+o*o)/($c*r*(1-r)),l=a?Math.atan2(s,o)*o$-120:NaN;return new ls(l<0?l+360:l,a,r,i.opacity)}function xg(i,e,t,n){return arguments.length===1?s$(i):new ls(i,e,t,n??1)}function ls(i,e,t,n){this.h=+i,this.s=+e,this.l=+t,this.opacity=+n}Pf(ls,xg,Qy(el,{brighter(i){return i=i==null?Ua:Math.pow(Ua,i),new ls(this.h,this.s,this.l*i,this.opacity)},darker(i){return i=i==null?ys:Math.pow(ys,i),new ls(this.h,this.s,this.l*i,this.opacity)},rgb(){var i=isNaN(this.h)?0:(this.h+120)*r$,e=+this.l,t=isNaN(this.s)?0:this.s*e*(1-e),n=Math.cos(i),r=Math.sin(i);return new _i(255*(e+t*(FC*n+Jy*r)),255*(e+t*(eb*n+Df*r)),255*(e+t*($c*n)),this.opacity)}}));const Mf=i=>()=>i;function zC(i,e){return function(t){return i+t*e}}function a$(i,e,t){return i=Math.pow(i,t),e=Math.pow(e,t)-i,t=1/t,function(n){return Math.pow(i+n*e,t)}}function l$(i,e){var t=e-i;return t?zC(i,t>180||t<-180?t-360*Math.round(t/360):t):Mf(isNaN(i)?e:i)}function c$(i){return(i=+i)==1?wa:function(e,t){return t-e?a$(e,t,i):Mf(isNaN(e)?t:e)}}function wa(i,e){var t=e-i;return t?zC(i,t):Mf(isNaN(i)?e:i)}const Ud=(function i(e){var t=c$(e);function n(r,o){var s=t((r=Fd(r)).r,(o=Fd(o)).r),a=t(r.g,o.g),l=t(r.b,o.b),c=wa(r.opacity,o.opacity);return function(u){return r.r=s(u),r.g=a(u),r.b=l(u),r.opacity=c(u),r+""}}return n.gamma=i,n})(1);function u$(i,e){e||(e=[]);var t=i?Math.min(e.length,i.length):0,n=e.slice(),r;return function(o){for(r=0;r<t;++r)n[r]=i[r]*(1-o)+e[r]*o;return n}}function h$(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function d$(i,e){var t=e?e.length:0,n=i?Math.min(t,i.length):0,r=new Array(n),o=new Array(t),s;for(s=0;s<n;++s)r[s]=tl(i[s],e[s]);for(;s<t;++s)o[s]=e[s];return function(a){for(s=0;s<n;++s)o[s]=r[s](a);return o}}function f$(i,e){var t=new Date;return i=+i,e=+e,function(n){return t.setTime(i*(1-n)+e*n),t}}function $n(i,e){return i=+i,e=+e,function(t){return i*(1-t)+e*t}}function p$(i,e){var t={},n={},r;(i===null||typeof i!="object")&&(i={}),(e===null||typeof e!="object")&&(e={});for(r in e)r in i?t[r]=tl(i[r],e[r]):n[r]=e[r];return function(o){for(r in t)n[r]=t[r](o);return n}}var wg=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Mp=new RegExp(wg.source,"g");function m$(i){return function(){return i}}function g$(i){return function(e){return i(e)+""}}function UC(i,e){var t=wg.lastIndex=Mp.lastIndex=0,n,r,o,s=-1,a=[],l=[];for(i=i+"",e=e+"";(n=wg.exec(i))&&(r=Mp.exec(e));)(o=r.index)>t&&(o=e.slice(t,o),a[s]?a[s]+=o:a[++s]=o),(n=n[0])===(r=r[0])?a[s]?a[s]+=r:a[++s]=r:(a[++s]=null,l.push({i:s,x:$n(n,r)})),t=Mp.lastIndex;return t<e.length&&(o=e.slice(t),a[s]?a[s]+=o:a[++s]=o),a.length<2?l[0]?g$(l[0].x):m$(e):(e=l.length,function(c){for(var u=0,h;u<e;++u)a[(h=l[u]).i]=h.x(c);return a.join("")})}function tl(i,e){var t=typeof e,n;return e==null||t==="boolean"?Mf(e):(t==="number"?$n:t==="string"?(n=ao(e))?(e=n,Ud):UC:e instanceof ao?Ud:e instanceof Date?f$:h$(e)?u$:Array.isArray(e)?d$:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?p$:$n)(i,e)}function $C(i,e){return i=+i,e=+e,function(t){return Math.round(i*(1-t)+e*t)}}var J0=180/Math.PI,Sg={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function VC(i,e,t,n,r,o){var s,a,l;return(s=Math.sqrt(i*i+e*e))&&(i/=s,e/=s),(l=i*t+e*n)&&(t-=i*l,n-=e*l),(a=Math.sqrt(t*t+n*n))&&(t/=a,n/=a,l/=a),i*n<e*t&&(i=-i,e=-e,l=-l,s=-s),{translateX:r,translateY:o,rotate:Math.atan2(e,i)*J0,skewX:Math.atan(l)*J0,scaleX:s,scaleY:a}}var Vu;function _$(i){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(i+"");return e.isIdentity?Sg:VC(e.a,e.b,e.c,e.d,e.e,e.f)}function y$(i){return i==null||(Vu||(Vu=document.createElementNS("http://www.w3.org/2000/svg","g")),Vu.setAttribute("transform",i),!(i=Vu.transform.baseVal.consolidate()))?Sg:(i=i.matrix,VC(i.a,i.b,i.c,i.d,i.e,i.f))}function HC(i,e,t,n){function r(c){return c.length?c.pop()+" ":""}function o(c,u,h,d,f,p){if(c!==h||u!==d){var b=f.push("translate(",null,e,null,t);p.push({i:b-4,x:$n(c,h)},{i:b-2,x:$n(u,d)})}else(h||d)&&f.push("translate("+h+e+d+t)}function s(c,u,h,d){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),d.push({i:h.push(r(h)+"rotate(",null,n)-2,x:$n(c,u)})):u&&h.push(r(h)+"rotate("+u+n)}function a(c,u,h,d){c!==u?d.push({i:h.push(r(h)+"skewX(",null,n)-2,x:$n(c,u)}):u&&h.push(r(h)+"skewX("+u+n)}function l(c,u,h,d,f,p){if(c!==h||u!==d){var b=f.push(r(f)+"scale(",null,",",null,")");p.push({i:b-4,x:$n(c,h)},{i:b-2,x:$n(u,d)})}else(h!==1||d!==1)&&f.push(r(f)+"scale("+h+","+d+")")}return function(c,u){var h=[],d=[];return c=i(c),u=i(u),o(c.translateX,c.translateY,u.translateX,u.translateY,h,d),s(c.rotate,u.rotate,h,d),a(c.skewX,u.skewX,h,d),l(c.scaleX,c.scaleY,u.scaleX,u.scaleY,h,d),c=u=null,function(f){for(var p=-1,b=d.length,g;++p<b;)h[(g=d[p]).i]=g.x(f);return h.join("")}}}var b$=HC(_$,"px, ","px)","deg)"),v$=HC(y$,", ",")",")");function GC(i){return(function e(t){t=+t;function n(r,o){var s=i((r=xg(r)).h,(o=xg(o)).h),a=wa(r.s,o.s),l=wa(r.l,o.l),c=wa(r.opacity,o.opacity);return function(u){return r.h=s(u),r.s=a(u),r.l=l(Math.pow(u,t)),r.opacity=c(u),r+""}}return n.gamma=e,n})(1)}const WC=GC(l$);GC(wa);function jC(i,e){e===void 0&&(e=i,i=tl);for(var t=0,n=e.length-1,r=e[0],o=new Array(n<0?0:n);t<n;)o[t]=i(r,r=e[++t]);return function(s){var a=Math.max(0,Math.min(n-1,Math.floor(s*=n)));return o[a](s-a)}}function x$(i,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=i(n/(e-1));return t}function w$(i,e){var t,n;return function(){var r=Lr(this,i),o=r.tween;if(o!==t){n=t=o;for(var s=0,a=n.length;s<a;++s)if(n[s].name===e){n=n.slice(),n.splice(s,1);break}}r.tween=n}}function S$(i,e,t){var n,r;if(typeof t!="function")throw new Error;return function(){var o=Lr(this,i),s=o.tween;if(s!==n){r=(n=s).slice();for(var a={name:e,value:t},l=0,c=r.length;l<c;++l)if(r[l].name===e){r[l]=a;break}l===c&&r.push(a)}o.tween=r}}function E$(i,e){var t=this._id;if(i+="",arguments.length<2){for(var n=Qn(this.node(),t).tween,r=0,o=n.length,s;r<o;++r)if((s=n[r]).name===i)return s.value;return null}return this.each((e==null?w$:S$)(t,i,e))}function tb(i,e,t){var n=i._id;return i.each(function(){var r=Lr(this,n);(r.value||(r.value={}))[e]=t.apply(this,arguments)}),function(r){return Qn(r,n).value[e]}}function YC(i,e){var t;return(typeof e=="number"?$n:e instanceof ao?Ud:(t=ao(e))?(e=t,Ud):UC)(i,e)}function C$(i){return function(){this.removeAttribute(i)}}function T$(i){return function(){this.removeAttributeNS(i.space,i.local)}}function A$(i,e,t){var n,r=t+"",o;return function(){var s=this.getAttribute(i);return s===r?null:s===n?o:o=e(n=s,t)}}function I$(i,e,t){var n,r=t+"",o;return function(){var s=this.getAttributeNS(i.space,i.local);return s===r?null:s===n?o:o=e(n=s,t)}}function k$(i,e,t){var n,r,o;return function(){var s,a=t(this),l;return a==null?void this.removeAttribute(i):(s=this.getAttribute(i),l=a+"",s===l?null:s===n&&l===r?o:(r=l,o=e(n=s,a)))}}function L$(i,e,t){var n,r,o;return function(){var s,a=t(this),l;return a==null?void this.removeAttributeNS(i.space,i.local):(s=this.getAttributeNS(i.space,i.local),l=a+"",s===l?null:s===n&&l===r?o:(r=l,o=e(n=s,a)))}}function R$(i,e){var t=kf(i),n=t==="transform"?v$:YC;return this.attrTween(i,typeof e=="function"?(t.local?L$:k$)(t,n,tb(this,"attr."+i,e)):e==null?(t.local?T$:C$)(t):(t.local?I$:A$)(t,n,e))}function P$(i,e){return function(t){this.setAttribute(i,e.call(this,t))}}function D$(i,e){return function(t){this.setAttributeNS(i.space,i.local,e.call(this,t))}}function M$(i,e){var t,n;function r(){var o=e.apply(this,arguments);return o!==n&&(t=(n=o)&&D$(i,o)),t}return r._value=e,r}function N$(i,e){var t,n;function r(){var o=e.apply(this,arguments);return o!==n&&(t=(n=o)&&P$(i,o)),t}return r._value=e,r}function B$(i,e){var t="attr."+i;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var n=kf(i);return this.tween(t,(n.local?M$:N$)(n,e))}function O$(i,e){return function(){Zy(this,i).delay=+e.apply(this,arguments)}}function F$(i,e){return e=+e,function(){Zy(this,i).delay=e}}function z$(i){var e=this._id;return arguments.length?this.each((typeof i=="function"?O$:F$)(e,i)):Qn(this.node(),e).delay}function U$(i,e){return function(){Lr(this,i).duration=+e.apply(this,arguments)}}function $$(i,e){return e=+e,function(){Lr(this,i).duration=e}}function V$(i){var e=this._id;return arguments.length?this.each((typeof i=="function"?U$:$$)(e,i)):Qn(this.node(),e).duration}function H$(i,e){if(typeof e!="function")throw new Error;return function(){Lr(this,i).ease=e}}function G$(i){var e=this._id;return arguments.length?this.each(H$(e,i)):Qn(this.node(),e).ease}function W$(i,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;Lr(this,i).ease=t}}function j$(i){if(typeof i!="function")throw new Error;return this.each(W$(this._id,i))}function Y$(i){typeof i!="function"&&(i=wC(i));for(var e=this._groups,t=e.length,n=new Array(t),r=0;r<t;++r)for(var o=e[r],s=o.length,a=n[r]=[],l,c=0;c<s;++c)(l=o[c])&&i.call(l,l.__data__,c,o)&&a.push(l);return new lo(n,this._parents,this._name,this._id)}function q$(i){if(i._id!==this._id)throw new Error;for(var e=this._groups,t=i._groups,n=e.length,r=t.length,o=Math.min(n,r),s=new Array(n),a=0;a<o;++a)for(var l=e[a],c=t[a],u=l.length,h=s[a]=new Array(u),d,f=0;f<u;++f)(d=l[f]||c[f])&&(h[f]=d);for(;a<n;++a)s[a]=e[a];return new lo(s,this._parents,this._name,this._id)}function X$(i){return(i+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function K$(i,e,t){var n,r,o=X$(e)?Zy:Lr;return function(){var s=o(this,i),a=s.on;a!==n&&(r=(n=a).copy()).on(e,t),s.on=r}}function Z$(i,e){var t=this._id;return arguments.length<2?Qn(this.node(),t).on.on(i):this.each(K$(t,i,e))}function Q$(i){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==i)return;e&&e.removeChild(this)}}function J$(){return this.on("end.remove",Q$(this._id))}function eV(i){var e=this._name,t=this._id;typeof i!="function"&&(i=Yy(i));for(var n=this._groups,r=n.length,o=new Array(r),s=0;s<r;++s)for(var a=n[s],l=a.length,c=o[s]=new Array(l),u,h,d=0;d<l;++d)(u=a[d])&&(h=i.call(u,u.__data__,d,a))&&("__data__"in u&&(h.__data__=u.__data__),c[d]=h,Rf(c[d],e,t,d,c,Qn(u,t)));return new lo(o,this._parents,e,t)}function tV(i){var e=this._name,t=this._id;typeof i!="function"&&(i=xC(i));for(var n=this._groups,r=n.length,o=[],s=[],a=0;a<r;++a)for(var l=n[a],c=l.length,u,h=0;h<c;++h)if(u=l[h]){for(var d=i.call(u,u.__data__,h,l),f,p=Qn(u,t),b=0,g=d.length;b<g;++b)(f=d[b])&&Rf(f,e,t,b,d,p);o.push(d),s.push(u)}return new lo(o,s,e,t)}var iV=au.prototype.constructor;function nV(){return new iV(this._groups,this._parents)}function rV(i,e){var t,n,r;return function(){var o=Fa(this,i),s=(this.style.removeProperty(i),Fa(this,i));return o===s?null:o===t&&s===n?r:r=e(t=o,n=s)}}function qC(i){return function(){this.style.removeProperty(i)}}function oV(i,e,t){var n,r=t+"",o;return function(){var s=Fa(this,i);return s===r?null:s===n?o:o=e(n=s,t)}}function sV(i,e,t){var n,r,o;return function(){var s=Fa(this,i),a=t(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(i),Fa(this,i))),s===l?null:s===n&&l===r?o:(r=l,o=e(n=s,a))}}function aV(i,e){var t,n,r,o="style."+e,s="end."+o,a;return function(){var l=Lr(this,i),c=l.on,u=l.value[o]==null?a||(a=qC(e)):void 0;(c!==t||r!==u)&&(n=(t=c).copy()).on(s,r=u),l.on=n}}function lV(i,e,t){var n=(i+="")=="transform"?b$:YC;return e==null?this.styleTween(i,rV(i,n)).on("end.style."+i,qC(i)):typeof e=="function"?this.styleTween(i,sV(i,n,tb(this,"style."+i,e))).each(aV(this._id,i)):this.styleTween(i,oV(i,n,e),t).on("end.style."+i,null)}function cV(i,e,t){return function(n){this.style.setProperty(i,e.call(this,n),t)}}function uV(i,e,t){var n,r;function o(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&cV(i,s,t)),n}return o._value=e,o}function hV(i,e,t){var n="style."+(i+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;return this.tween(n,uV(i,e,t??""))}function dV(i){return function(){this.textContent=i}}function fV(i){return function(){var e=i(this);this.textContent=e??""}}function pV(i){return this.tween("text",typeof i=="function"?fV(tb(this,"text",i)):dV(i==null?"":i+""))}function mV(i){return function(e){this.textContent=i.call(this,e)}}function gV(i){var e,t;function n(){var r=i.apply(this,arguments);return r!==t&&(e=(t=r)&&mV(r)),e}return n._value=i,n}function _V(i){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(i==null)return this.tween(e,null);if(typeof i!="function")throw new Error;return this.tween(e,gV(i))}function yV(){for(var i=this._name,e=this._id,t=XC(),n=this._groups,r=n.length,o=0;o<r;++o)for(var s=n[o],a=s.length,l,c=0;c<a;++c)if(l=s[c]){var u=Qn(l,e);Rf(l,i,t,c,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new lo(n,this._parents,i,t)}function bV(){var i,e,t=this,n=t._id,r=t.size();return new Promise(function(o,s){var a={value:s},l={value:function(){--r===0&&o()}};t.each(function(){var c=Lr(this,n),u=c.on;u!==i&&(e=(i=u).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),c.on=e}),r===0&&o()})}var vV=0;function lo(i,e,t,n){this._groups=i,this._parents=e,this._name=t,this._id=n}function XC(){return++vV}var Fr=au.prototype;lo.prototype={constructor:lo,select:eV,selectAll:tV,selectChild:Fr.selectChild,selectChildren:Fr.selectChildren,filter:Y$,merge:q$,selection:nV,transition:yV,call:Fr.call,nodes:Fr.nodes,node:Fr.node,size:Fr.size,empty:Fr.empty,each:Fr.each,on:Z$,attr:R$,attrTween:B$,style:lV,styleTween:hV,text:pV,textTween:_V,remove:J$,tween:E$,delay:z$,duration:V$,ease:G$,easeVarying:j$,end:bV,[Symbol.iterator]:Fr[Symbol.iterator]};function xV(i){return((i*=2)<=1?i*i*i:(i-=2)*i*i+2)/2}var wV={time:null,delay:0,duration:250,ease:xV};function SV(i,e){for(var t;!(t=i.__transition)||!(t=t[e]);)if(!(i=i.parentNode))throw new Error(`transition ${e} not found`);return t}function EV(i){var e,t;i instanceof lo?(e=i._id,i=i._name):(e=XC(),(t=wV).time=Ky(),i=i==null?null:i+"");for(var n=this._groups,r=n.length,o=0;o<r;++o)for(var s=n[o],a=s.length,l,c=0;c<a;++c)(l=s[c])&&Rf(l,i,e,c,s,t||SV(l,e));return new lo(n,this._parents,i,e)}au.prototype.interrupt=j9;au.prototype.transition=EV;var cs=[],CV=function(){return cs.some(function(i){return i.activeTargets.length>0})},TV=function(){return cs.some(function(i){return i.skippedTargets.length>0})},e1="ResizeObserver loop completed with undelivered notifications.",AV=function(){var i;typeof ErrorEvent=="function"?i=new ErrorEvent("error",{message:e1}):(i=document.createEvent("Event"),i.initEvent("error",!1,!1),i.message=e1),window.dispatchEvent(i)},Vc;(function(i){i.BORDER_BOX="border-box",i.CONTENT_BOX="content-box",i.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box"})(Vc||(Vc={}));var us=function(i){return Object.freeze(i)},IV=(function(){function i(e,t){this.inlineSize=e,this.blockSize=t,us(this)}return i})(),KC=(function(){function i(e,t,n,r){return this.x=e,this.y=t,this.width=n,this.height=r,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,us(this)}return i.prototype.toJSON=function(){var e=this,t=e.x,n=e.y,r=e.top,o=e.right,s=e.bottom,a=e.left,l=e.width,c=e.height;return{x:t,y:n,top:r,right:o,bottom:s,left:a,width:l,height:c}},i.fromRect=function(e){return new i(e.x,e.y,e.width,e.height)},i})(),ib=function(i){return i instanceof SVGElement&&"getBBox"in i},ZC=function(i){if(ib(i)){var e=i.getBBox(),t=e.width,n=e.height;return!t&&!n}var r=i,o=r.offsetWidth,s=r.offsetHeight;return!(o||s||i.getClientRects().length)},t1=function(i){var e;if(i instanceof Element)return!0;var t=(e=i==null?void 0:i.ownerDocument)===null||e===void 0?void 0:e.defaultView;return!!(t&&i instanceof t.Element)},kV=function(i){switch(i.tagName){case"INPUT":if(i.type!=="image")break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1},dc=typeof window<"u"?window:{},Hu=new WeakMap,i1=/auto|scroll/,LV=/^tb|vertical/,RV=/msie|trident/i.test(dc.navigator&&dc.navigator.userAgent),ir=function(i){return parseFloat(i||"0")},Sa=function(i,e,t){return i===void 0&&(i=0),e===void 0&&(e=0),t===void 0&&(t=!1),new IV((t?e:i)||0,(t?i:e)||0)},n1=us({devicePixelContentBoxSize:Sa(),borderBoxSize:Sa(),contentBoxSize:Sa(),contentRect:new KC(0,0,0,0)}),QC=function(i,e){if(e===void 0&&(e=!1),Hu.has(i)&&!e)return Hu.get(i);if(ZC(i))return Hu.set(i,n1),n1;var t=getComputedStyle(i),n=ib(i)&&i.ownerSVGElement&&i.getBBox(),r=!RV&&t.boxSizing==="border-box",o=LV.test(t.writingMode||""),s=!n&&i1.test(t.overflowY||""),a=!n&&i1.test(t.overflowX||""),l=n?0:ir(t.paddingTop),c=n?0:ir(t.paddingRight),u=n?0:ir(t.paddingBottom),h=n?0:ir(t.paddingLeft),d=n?0:ir(t.borderTopWidth),f=n?0:ir(t.borderRightWidth),p=n?0:ir(t.borderBottomWidth),b=n?0:ir(t.borderLeftWidth),g=h+c,_=l+u,T=b+f,E=d+p,y=a?i.offsetHeight-E-i.clientHeight:0,C=s?i.offsetWidth-T-i.clientWidth:0,I=r?g+T:0,F=r?_+E:0,V=n?n.width:ir(t.width)-I-C,q=n?n.height:ir(t.height)-F-y,Q=V+g+C+T,M=q+_+y+E,ae=us({devicePixelContentBoxSize:Sa(Math.round(V*devicePixelRatio),Math.round(q*devicePixelRatio),o),borderBoxSize:Sa(Q,M,o),contentBoxSize:Sa(V,q,o),contentRect:new KC(h,l,V,q)});return Hu.set(i,ae),ae},JC=function(i,e,t){var n=QC(i,t),r=n.borderBoxSize,o=n.contentBoxSize,s=n.devicePixelContentBoxSize;switch(e){case Vc.DEVICE_PIXEL_CONTENT_BOX:return s;case Vc.BORDER_BOX:return r;default:return o}},PV=(function(){function i(e){var t=QC(e);this.target=e,this.contentRect=t.contentRect,this.borderBoxSize=us([t.borderBoxSize]),this.contentBoxSize=us([t.contentBoxSize]),this.devicePixelContentBoxSize=us([t.devicePixelContentBoxSize])}return i})(),eT=function(i){if(ZC(i))return 1/0;for(var e=0,t=i.parentNode;t;)e+=1,t=t.parentNode;return e},DV=function(){var i=1/0,e=[];cs.forEach(function(s){if(s.activeTargets.length!==0){var a=[];s.activeTargets.forEach(function(c){var u=new PV(c.target),h=eT(c.target);a.push(u),c.lastReportedSize=JC(c.target,c.observedBox),h<i&&(i=h)}),e.push(function(){s.callback.call(s.observer,a,s.observer)}),s.activeTargets.splice(0,s.activeTargets.length)}});for(var t=0,n=e;t<n.length;t++){var r=n[t];r()}return i},r1=function(i){cs.forEach(function(t){t.activeTargets.splice(0,t.activeTargets.length),t.skippedTargets.splice(0,t.skippedTargets.length),t.observationTargets.forEach(function(r){r.isActive()&&(eT(r.target)>i?t.activeTargets.push(r):t.skippedTargets.push(r))})})},MV=function(){var i=0;for(r1(i);CV();)i=DV(),r1(i);return TV()&&AV(),i>0},Np,tT=[],NV=function(){return tT.splice(0).forEach(function(i){return i()})},BV=function(i){if(!Np){var e=0,t=document.createTextNode(""),n={characterData:!0};new MutationObserver(function(){return NV()}).observe(t,n),Np=function(){t.textContent="".concat(e?e--:e++)}}tT.push(i),Np()},OV=function(i){BV(function(){requestAnimationFrame(i)})},Nh=0,FV=function(){return!!Nh},zV=250,UV={attributes:!0,characterData:!0,childList:!0,subtree:!0},o1=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],s1=function(i){return i===void 0&&(i=0),Date.now()+i},Bp=!1,$V=(function(){function i(){var e=this;this.stopped=!0,this.listener=function(){return e.schedule()}}return i.prototype.run=function(e){var t=this;if(e===void 0&&(e=zV),!Bp){Bp=!0;var n=s1(e);OV(function(){var r=!1;try{r=MV()}finally{if(Bp=!1,e=n-s1(),!FV())return;r?t.run(1e3):e>0?t.run(e):t.start()}})}},i.prototype.schedule=function(){this.stop(),this.run()},i.prototype.observe=function(){var e=this,t=function(){return e.observer&&e.observer.observe(document.body,UV)};document.body?t():dc.addEventListener("DOMContentLoaded",t)},i.prototype.start=function(){var e=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),o1.forEach(function(t){return dc.addEventListener(t,e.listener,!0)}))},i.prototype.stop=function(){var e=this;this.stopped||(this.observer&&this.observer.disconnect(),o1.forEach(function(t){return dc.removeEventListener(t,e.listener,!0)}),this.stopped=!0)},i})(),Eg=new $V,a1=function(i){!Nh&&i>0&&Eg.start(),Nh+=i,!Nh&&Eg.stop()},VV=function(i){return!ib(i)&&!kV(i)&&getComputedStyle(i).display==="inline"},HV=(function(){function i(e,t){this.target=e,this.observedBox=t||Vc.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return i.prototype.isActive=function(){var e=JC(this.target,this.observedBox,!0);return VV(this.target)&&(this.lastReportedSize=e),this.lastReportedSize.inlineSize!==e.inlineSize||this.lastReportedSize.blockSize!==e.blockSize},i})(),GV=(function(){function i(e,t){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=e,this.callback=t}return i})(),Gu=new WeakMap,l1=function(i,e){for(var t=0;t<i.length;t+=1)if(i[t].target===e)return t;return-1},Wu=(function(){function i(){}return i.connect=function(e,t){var n=new GV(e,t);Gu.set(e,n)},i.observe=function(e,t,n){var r=Gu.get(e),o=r.observationTargets.length===0;l1(r.observationTargets,t)<0&&(o&&cs.push(r),r.observationTargets.push(new HV(t,n&&n.box)),a1(1),Eg.schedule())},i.unobserve=function(e,t){var n=Gu.get(e),r=l1(n.observationTargets,t),o=n.observationTargets.length===1;r>=0&&(o&&cs.splice(cs.indexOf(n),1),n.observationTargets.splice(r,1),a1(-1))},i.disconnect=function(e){var t=this,n=Gu.get(e);n.observationTargets.slice().forEach(function(r){return t.unobserve(e,r.target)}),n.activeTargets.splice(0,n.activeTargets.length)},i})(),iT=(function(){function i(e){if(arguments.length===0)throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if(typeof e!="function")throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");Wu.connect(this,e)}return i.prototype.observe=function(e,t){if(arguments.length===0)throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!t1(e))throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");Wu.observe(this,e,t)},i.prototype.unobserve=function(e){if(arguments.length===0)throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!t1(e))throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");Wu.unobserve(this,e)},i.prototype.disconnect=function(){Wu.disconnect(this)},i.toString=function(){return"function ResizeObserver () { [polyfill code] }"},i})();function WV(i){return i}var jV=3,c1=1e-6;function YV(i){return"translate("+i+",0)"}function qV(i){return e=>+i(e)}function XV(i,e){return e=Math.max(0,i.bandwidth()-e*2)/2,i.round()&&(e=Math.round(e)),t=>+i(t)+e}function KV(){return!this.__axis}function ZV(i,e){var t=[],n=null,r=null,o=6,s=6,a=3,l=typeof window<"u"&&window.devicePixelRatio>1?0:.5,c=1,u="y",h=YV;function d(f){var p=n??(e.ticks?e.ticks.apply(e,t):e.domain()),b=r??(e.tickFormat?e.tickFormat.apply(e,t):WV),g=Math.max(o,0)+a,_=e.range(),T=+_[0]+l,E=+_[_.length-1]+l,y=(e.bandwidth?XV:qV)(e.copy(),l),C=f.selection?f.selection():f,I=C.selectAll(".domain").data([null]),F=C.selectAll(".tick").data(p,e).order(),V=F.exit(),q=F.enter().append("g").attr("class","tick"),Q=F.select("line"),M=F.select("text");I=I.merge(I.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),F=F.merge(q),Q=Q.merge(q.append("line").attr("stroke","currentColor").attr(u+"2",c*o)),M=M.merge(q.append("text").attr("fill","currentColor").attr(u,c*g).attr("dy","0.71em")),f!==C&&(I=I.transition(f),F=F.transition(f),Q=Q.transition(f),M=M.transition(f),V=V.transition(f).attr("opacity",c1).attr("transform",function(ae){return isFinite(ae=y(ae))?h(ae+l):this.getAttribute("transform")}),q.attr("opacity",c1).attr("transform",function(ae){var ee=this.parentNode.__axis;return h((ee&&isFinite(ee=ee(ae))?ee:y(ae))+l)})),V.remove(),I.attr("d",s?"M"+T+","+c*s+"V"+l+"H"+E+"V"+c*s:"M"+T+","+l+"H"+E),F.attr("opacity",1).attr("transform",function(ae){return h(y(ae)+l)}),Q.attr(u+"2",c*o),M.attr(u,c*g).text(b),C.filter(KV).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor","middle"),C.each(function(){this.__axis=y})}return d.scale=function(f){return arguments.length?(e=f,d):e},d.ticks=function(){return t=Array.from(arguments),d},d.tickArguments=function(f){return arguments.length?(t=f==null?[]:Array.from(f),d):t.slice()},d.tickValues=function(f){return arguments.length?(n=f==null?null:Array.from(f),d):n&&n.slice()},d.tickFormat=function(f){return arguments.length?(r=f,d):r},d.tickSize=function(f){return arguments.length?(o=s=+f,d):o},d.tickSizeInner=function(f){return arguments.length?(o=+f,d):o},d.tickSizeOuter=function(f){return arguments.length?(s=+f,d):s},d.tickPadding=function(f){return arguments.length?(a=+f,d):a},d.offset=function(f){return arguments.length?(l=+f,d):l},d}function Cg(i){return ZV(jV,i)}const Tg={capture:!0,passive:!1};function Ag(i){i.preventDefault(),i.stopImmediatePropagation()}function QV(i){var e=i.document.documentElement,t=Et(i).on("dragstart.drag",Ag,Tg);"onselectstart"in e?t.on("selectstart.drag",Ag,Tg):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function JV(i,e){var t=i.document.documentElement,n=Et(i).on("dragstart.drag",null);e&&(n.on("click.drag",Ag,Tg),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in t?n.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}const Op=i=>()=>i;function eH(i,{sourceEvent:e,target:t,selection:n,mode:r,dispatch:o}){Object.defineProperties(this,{type:{value:i,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:t,enumerable:!0,configurable:!0},selection:{value:n,enumerable:!0,configurable:!0},mode:{value:r,enumerable:!0,configurable:!0},_:{value:o}})}function tH(i){i.stopImmediatePropagation()}function Fp(i){i.preventDefault(),i.stopImmediatePropagation()}var u1={name:"drag"},zp={name:"space"},Vs={name:"handle"},Hs={name:"center"};const{abs:h1,max:di,min:fi}=Math;function d1(i){return[+i[0],+i[1]]}function Ig(i){return[d1(i[0]),d1(i[1])]}var Bh={name:"x",handles:["w","e"].map($d),input:function(i,e){return i==null?null:[[+i[0],e[0][1]],[+i[1],e[1][1]]]},output:function(i){return i&&[i[0][0],i[1][0]]}},Up={},iH={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map($d),input:function(i){return i==null?null:Ig(i)},output:function(i){return i}},zr={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},f1={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},p1={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},nH={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},rH={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function $d(i){return{type:i}}function oH(i){return!i.ctrlKey&&!i.button}function sH(){var i=this.ownerSVGElement||this;return i.hasAttribute("viewBox")?(i=i.viewBox.baseVal,[[i.x,i.y],[i.x+i.width,i.y+i.height]]):[[0,0],[i.width.baseVal.value,i.height.baseVal.value]]}function aH(){return navigator.maxTouchPoints||"ontouchstart"in this}function $p(i){for(;!i.__brush;)if(!(i=i.parentNode))return;return i.__brush}function lH(i){return i[0][0]===i[1][0]||i[0][1]===i[1][1]}function nT(){return rT(Bh)}function cH(){return rT(iH)}function rT(i){var e=sH,t=oH,n=aH,r=!0,o=Xy("start","brush","end"),s=6,a;function l(g){var _=g.property("__brush",b).selectAll(".overlay").data([$d("overlay")]);_.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",zr.overlay).merge(_).each(function(){var E=$p(this).extent;Et(this).attr("x",E[0][0]).attr("y",E[0][1]).attr("width",E[1][0]-E[0][0]).attr("height",E[1][1]-E[0][1])}),g.selectAll(".selection").data([$d("selection")]).enter().append("rect").attr("class","selection").attr("cursor",zr.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var T=g.selectAll(".handle").data(i.handles,function(E){return E.type});T.exit().remove(),T.enter().append("rect").attr("class",function(E){return"handle handle--"+E.type}).attr("cursor",function(E){return zr[E.type]}),g.each(c).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",d).filter(n).on("touchstart.brush",d).on("touchmove.brush",f).on("touchend.brush touchcancel.brush",p).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}l.move=function(g,_,T){g.tween?g.on("start.brush",function(E){u(this,arguments).beforestart().start(E)}).on("interrupt.brush end.brush",function(E){u(this,arguments).end(E)}).tween("brush",function(){var E=this,y=E.__brush,C=u(E,arguments),I=y.selection,F=i.input(typeof _=="function"?_.apply(this,arguments):_,y.extent),V=tl(I,F);function q(Q){y.selection=Q===1&&F===null?null:V(Q),c.call(E),C.brush()}return I!==null&&F!==null?q:q(1)}):g.each(function(){var E=this,y=arguments,C=E.__brush,I=i.input(typeof _=="function"?_.apply(E,y):_,C.extent),F=u(E,y).beforestart();vg(E),C.selection=I===null?null:I,c.call(E),F.start(T).brush(T).end(T)})},l.clear=function(g,_){l.move(g,null,_)};function c(){var g=Et(this),_=$p(this).selection;_?(g.selectAll(".selection").style("display",null).attr("x",_[0][0]).attr("y",_[0][1]).attr("width",_[1][0]-_[0][0]).attr("height",_[1][1]-_[0][1]),g.selectAll(".handle").style("display",null).attr("x",function(T){return T.type[T.type.length-1]==="e"?_[1][0]-s/2:_[0][0]-s/2}).attr("y",function(T){return T.type[0]==="s"?_[1][1]-s/2:_[0][1]-s/2}).attr("width",function(T){return T.type==="n"||T.type==="s"?_[1][0]-_[0][0]+s:s}).attr("height",function(T){return T.type==="e"||T.type==="w"?_[1][1]-_[0][1]+s:s})):g.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function u(g,_,T){var E=g.__brush.emitter;return E&&(!T||!E.clean)?E:new h(g,_,T)}function h(g,_,T){this.that=g,this.args=_,this.state=g.__brush,this.active=0,this.clean=T}h.prototype={beforestart:function(){return++this.active===1&&(this.state.emitter=this,this.starting=!0),this},start:function(g,_){return this.starting?(this.starting=!1,this.emit("start",g,_)):this.emit("brush",g),this},brush:function(g,_){return this.emit("brush",g,_),this},end:function(g,_){return--this.active===0&&(delete this.state.emitter,this.emit("end",g,_)),this},emit:function(g,_,T){var E=Et(this.that).datum();o.call(g,this.that,new eH(g,{sourceEvent:_,target:l,selection:i.output(this.state.selection),mode:T,dispatch:o}),E)}};function d(g){if(a&&!g.touches||!t.apply(this,arguments))return;var _=this,T=g.target.__data__.type,E=(r&&g.metaKey?T="overlay":T)==="selection"?u1:r&&g.altKey?Hs:Vs,y=i===Up?null:nH[T],C=i===Bh?null:rH[T],I=$p(_),F=I.extent,V=I.selection,q=F[0][0],Q,M,ae=F[0][1],ee,R,X=F[1][0],O,W,ne=F[1][1],Y,ie,j=0,fe=0,de,Ze=y&&C&&r&&g.shiftKey,oe,ft,$e=Array.from(g.touches||[g],he=>{const We=he.identifier;return he=B0(he,_),he.point0=he.slice(),he.identifier=We,he});vg(_);var gt=u(_,arguments,!0).beforestart();if(T==="overlay"){V&&(de=!0);const he=[$e[0],$e[1]||$e[0]];I.selection=V=[[Q=i===Up?q:fi(he[0][0],he[1][0]),ee=i===Bh?ae:fi(he[0][1],he[1][1])],[O=i===Up?X:di(he[0][0],he[1][0]),Y=i===Bh?ne:di(he[0][1],he[1][1])]],$e.length>1&&Ge(g)}else Q=V[0][0],ee=V[0][1],O=V[1][0],Y=V[1][1];M=Q,R=ee,W=O,ie=Y;var te=Et(_).attr("pointer-events","none"),Se=te.selectAll(".overlay").attr("cursor",zr[T]);if(g.touches)gt.moved=G,gt.ended=Pe;else{var Me=Et(g.view).on("mousemove.brush",G,!0).on("mouseup.brush",Pe,!0);r&&Me.on("keydown.brush",_t,!0).on("keyup.brush",It,!0),QV(g.view)}c.call(_),gt.start(g,E.name);function G(he){for(const We of he.changedTouches||[he])for(const xi of $e)xi.identifier===We.identifier&&(xi.cur=B0(We,_));if(Ze&&!oe&&!ft&&$e.length===1){const We=$e[0];h1(We.cur[0]-We[0])>h1(We.cur[1]-We[1])?ft=!0:oe=!0}for(const We of $e)We.cur&&(We[0]=We.cur[0],We[1]=We.cur[1]);de=!0,Fp(he),Ge(he)}function Ge(he){const We=$e[0],xi=We.point0;var li;switch(j=We[0]-xi[0],fe=We[1]-xi[1],E){case zp:case u1:{y&&(j=di(q-Q,fi(X-O,j)),M=Q+j,W=O+j),C&&(fe=di(ae-ee,fi(ne-Y,fe)),R=ee+fe,ie=Y+fe);break}case Vs:{$e[1]?(y&&(M=di(q,fi(X,$e[0][0])),W=di(q,fi(X,$e[1][0])),y=1),C&&(R=di(ae,fi(ne,$e[0][1])),ie=di(ae,fi(ne,$e[1][1])),C=1)):(y<0?(j=di(q-Q,fi(X-Q,j)),M=Q+j,W=O):y>0&&(j=di(q-O,fi(X-O,j)),M=Q,W=O+j),C<0?(fe=di(ae-ee,fi(ne-ee,fe)),R=ee+fe,ie=Y):C>0&&(fe=di(ae-Y,fi(ne-Y,fe)),R=ee,ie=Y+fe));break}case Hs:{y&&(M=di(q,fi(X,Q-j*y)),W=di(q,fi(X,O+j*y))),C&&(R=di(ae,fi(ne,ee-fe*C)),ie=di(ae,fi(ne,Y+fe*C)));break}}W<M&&(y*=-1,li=Q,Q=O,O=li,li=M,M=W,W=li,T in f1&&Se.attr("cursor",zr[T=f1[T]])),ie<R&&(C*=-1,li=ee,ee=Y,Y=li,li=R,R=ie,ie=li,T in p1&&Se.attr("cursor",zr[T=p1[T]])),I.selection&&(V=I.selection),oe&&(M=V[0][0],W=V[1][0]),ft&&(R=V[0][1],ie=V[1][1]),(V[0][0]!==M||V[0][1]!==R||V[1][0]!==W||V[1][1]!==ie)&&(I.selection=[[M,R],[W,ie]],c.call(_),gt.brush(he,E.name))}function Pe(he){if(tH(he),he.touches){if(he.touches.length)return;a&&clearTimeout(a),a=setTimeout(function(){a=null},500)}else JV(he.view,de),Me.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);te.attr("pointer-events","all"),Se.attr("cursor",zr.overlay),I.selection&&(V=I.selection),lH(V)&&(I.selection=null,c.call(_)),gt.end(he,E.name)}function _t(he){switch(he.keyCode){case 16:{Ze=y&&C;break}case 18:{E===Vs&&(y&&(O=W-j*y,Q=M+j*y),C&&(Y=ie-fe*C,ee=R+fe*C),E=Hs,Ge(he));break}case 32:{(E===Vs||E===Hs)&&(y<0?O=W-j:y>0&&(Q=M-j),C<0?Y=ie-fe:C>0&&(ee=R-fe),E=zp,Se.attr("cursor",zr.selection),Ge(he));break}default:return}Fp(he)}function It(he){switch(he.keyCode){case 16:{Ze&&(oe=ft=Ze=!1,Ge(he));break}case 18:{E===Hs&&(y<0?O=W:y>0&&(Q=M),C<0?Y=ie:C>0&&(ee=R),E=Vs,Ge(he));break}case 32:{E===zp&&(he.altKey?(y&&(O=W-j*y,Q=M+j*y),C&&(Y=ie-fe*C,ee=R+fe*C),E=Hs):(y<0?O=W:y>0&&(Q=M),C<0?Y=ie:C>0&&(ee=R),E=Vs),Se.attr("cursor",zr[T]),Ge(he));break}default:return}Fp(he)}}function f(g){u(this,arguments).moved(g)}function p(g){u(this,arguments).ended(g)}function b(){var g=this.__brush||{selection:null};return g.extent=Ig(e.apply(this,arguments)),g.dim=i,g}return l.extent=function(g){return arguments.length?(e=typeof g=="function"?g:Op(Ig(g)),l):e},l.filter=function(g){return arguments.length?(t=typeof g=="function"?g:Op(!!g),l):t},l.touchable=function(g){return arguments.length?(n=typeof g=="function"?g:Op(!!g),l):n},l.handleSize=function(g){return arguments.length?(s=+g,l):s},l.keyModifiers=function(g){return arguments.length?(r=!!g,l):r},l.on=function(){var g=o.on.apply(o,arguments);return g===o?l:g},l}function Ea(i,e){return i==null||e==null?NaN:i<e?-1:i>e?1:i>=e?0:NaN}function uH(i,e){return i==null||e==null?NaN:e<i?-1:e>i?1:e>=i?0:NaN}function nb(i){let e,t,n;i.length!==2?(e=Ea,t=(a,l)=>Ea(i(a),l),n=(a,l)=>i(a)-l):(e=i===Ea||i===uH?i:hH,t=i,n=i);function r(a,l,c=0,u=a.length){if(c<u){if(e(l,l)!==0)return u;do{const h=c+u>>>1;t(a[h],l)<0?c=h+1:u=h}while(c<u)}return c}function o(a,l,c=0,u=a.length){if(c<u){if(e(l,l)!==0)return u;do{const h=c+u>>>1;t(a[h],l)<=0?c=h+1:u=h}while(c<u)}return c}function s(a,l,c=0,u=a.length){const h=r(a,l,c,u-1);return h>c&&n(a[h-1],l)>-n(a[h],l)?h-1:h}return{left:r,center:s,right:o}}function hH(){return 0}function dH(i){return i===null?NaN:+i}function*fH(i,e){for(let t of i)t!=null&&(t=+t)>=t&&(yield t)}const pH=nb(Ea),oT=pH.right;nb(dH).center;const tK=mH(gH);function mH(i){return function(e,t,n=t){if(!((t=+t)>=0))throw new RangeError("invalid rx");if(!((n=+n)>=0))throw new RangeError("invalid ry");let{data:r,width:o,height:s}=e;if(!((o=Math.floor(o))>=0))throw new RangeError("invalid width");if(!((s=Math.floor(s!==void 0?s:r.length/o))>=0))throw new RangeError("invalid height");if(!o||!s||!t&&!n)return e;const a=t&&i(t),l=n&&i(n),c=r.slice();return a&&l?(Gs(a,c,r,o,s),Gs(a,r,c,o,s),Gs(a,c,r,o,s),Ws(l,r,c,o,s),Ws(l,c,r,o,s),Ws(l,r,c,o,s)):a?(Gs(a,r,c,o,s),Gs(a,c,r,o,s),Gs(a,r,c,o,s)):l&&(Ws(l,r,c,o,s),Ws(l,c,r,o,s),Ws(l,r,c,o,s)),e}}function Gs(i,e,t,n,r){for(let o=0,s=n*r;o<s;)i(e,t,o,o+=n,1)}function Ws(i,e,t,n,r){for(let o=0,s=n*r;o<n;++o)i(e,t,o,o+s,n)}function gH(i){const e=Math.floor(i);if(e===i)return _H(i);const t=i-e,n=2*i+1;return(r,o,s,a,l)=>{if(!((a-=l)>=s))return;let c=e*o[s];const u=l*e,h=u+l;for(let d=s,f=s+u;d<f;d+=l)c+=o[Math.min(a,d)];for(let d=s,f=a;d<=f;d+=l)c+=o[Math.min(a,d+u)],r[d]=(c+t*(o[Math.max(s,d-h)]+o[Math.min(a,d+h)]))/n,c-=o[Math.max(s,d-u)]}}function _H(i){const e=2*i+1;return(t,n,r,o,s)=>{if(!((o-=s)>=r))return;let a=i*n[r];const l=s*i;for(let c=r,u=r+l;c<u;c+=s)a+=n[Math.min(o,c)];for(let c=r,u=o;c<=u;c+=s)a+=n[Math.min(o,c+l)],t[c]=a/e,a-=n[Math.max(r,c-l)]}}function yH(i,e){let t=0;for(let n of i)n!=null&&(n=+n)>=n&&++t;return t}function Yi(i,e){let t,n;if(e===void 0)for(const r of i)r!=null&&(t===void 0?r>=r&&(t=n=r):(t>r&&(t=r),n<r&&(n=r)));else{let r=-1;for(let o of i)(o=e(o,++r,i))!=null&&(t===void 0?o>=o&&(t=n=o):(t>o&&(t=o),n<o&&(n=o)))}return[t,n]}class m1 extends Map{constructor(e,t=xH){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),e!=null)for(const[n,r]of e)this.set(n,r)}get(e){return super.get(g1(this,e))}has(e){return super.has(g1(this,e))}set(e,t){return super.set(bH(this,e),t)}delete(e){return super.delete(vH(this,e))}}function g1({_intern:i,_key:e},t){const n=e(t);return i.has(n)?i.get(n):t}function bH({_intern:i,_key:e},t){const n=e(t);return i.has(n)?i.get(n):(i.set(n,t),t)}function vH({_intern:i,_key:e},t){const n=e(t);return i.has(n)&&(t=i.get(n),i.delete(n)),t}function xH(i){return i!==null&&typeof i=="object"?i.valueOf():i}function wH(i=Ea){if(i===Ea)return sT;if(typeof i!="function")throw new TypeError("compare is not a function");return(e,t)=>{const n=i(e,t);return n||n===0?n:(i(t,t)===0)-(i(e,e)===0)}}function sT(i,e){return(i==null||!(i>=i))-(e==null||!(e>=e))||(i<e?-1:i>e?1:0)}const SH=Math.sqrt(50),EH=Math.sqrt(10),CH=Math.sqrt(2);function Vd(i,e,t){const n=(e-i)/Math.max(0,t),r=Math.floor(Math.log10(n)),o=n/Math.pow(10,r),s=o>=SH?10:o>=EH?5:o>=CH?2:1;let a,l,c;return r<0?(c=Math.pow(10,-r)/s,a=Math.round(i*c),l=Math.round(e*c),a/c<i&&++a,l/c>e&&--l,c=-c):(c=Math.pow(10,r)*s,a=Math.round(i/c),l=Math.round(e/c),a*c<i&&++a,l*c>e&&--l),l<a&&.5<=t&&t<2?Vd(i,e,t*2):[a,l,c]}function TH(i,e,t){if(e=+e,i=+i,t=+t,!(t>0))return[];if(i===e)return[i];const n=e<i,[r,o,s]=n?Vd(e,i,t):Vd(i,e,t);if(!(o>=r))return[];const a=o-r+1,l=new Array(a);if(n)if(s<0)for(let c=0;c<a;++c)l[c]=(o-c)/-s;else for(let c=0;c<a;++c)l[c]=(o-c)*s;else if(s<0)for(let c=0;c<a;++c)l[c]=(r+c)/-s;else for(let c=0;c<a;++c)l[c]=(r+c)*s;return l}function Hd(i,e,t){return e=+e,i=+i,t=+t,Vd(i,e,t)[2]}function kg(i,e,t){e=+e,i=+i,t=+t;const n=e<i,r=n?Hd(e,i,t):Hd(i,e,t);return(n?-1:1)*(r<0?1/-r:r)}function iK(i,e,t){let n;for(;;){const r=Hd(i,e,t);if(r===n||r===0||!isFinite(r))return[i,e];r>0?(i=Math.floor(i/r)*r,e=Math.ceil(e/r)*r):r<0&&(i=Math.ceil(i*r)/r,e=Math.floor(e*r)/r),n=r}}function nK(i){return Math.max(1,Math.ceil(Math.log(yH(i))/Math.LN2)+1)}function _1(i,e){let t;for(const n of i)n!=null&&(t<n||t===void 0&&n>=n)&&(t=n);return t}function y1(i,e){let t;for(const n of i)n!=null&&(t>n||t===void 0&&n>=n)&&(t=n);return t}function aT(i,e,t=0,n=1/0,r){if(e=Math.floor(e),t=Math.floor(Math.max(0,t)),n=Math.floor(Math.min(i.length-1,n)),!(t<=e&&e<=n))return i;for(r=r===void 0?sT:wH(r);n>t;){if(n-t>600){const l=n-t+1,c=e-t+1,u=Math.log(l),h=.5*Math.exp(2*u/3),d=.5*Math.sqrt(u*h*(l-h)/l)*(c-l/2<0?-1:1),f=Math.max(t,Math.floor(e-c*h/l+d)),p=Math.min(n,Math.floor(e+(l-c)*h/l+d));aT(i,e,f,p,r)}const o=i[e];let s=t,a=n;for(Sl(i,t,e),r(i[n],o)>0&&Sl(i,t,n);s<a;){for(Sl(i,s,a),++s,--a;r(i[s],o)<0;)++s;for(;r(i[a],o)>0;)--a}r(i[t],o)===0?Sl(i,t,a):(++a,Sl(i,a,n)),a<=e&&(t=a+1),e<=a&&(n=a-1)}return i}function Sl(i,e,t){const n=i[e];i[e]=i[t],i[t]=n}function $a(i,e,t){if(i=Float64Array.from(fH(i)),!(!(n=i.length)||isNaN(e=+e))){if(e<=0||n<2)return y1(i);if(e>=1)return _1(i);var n,r=(n-1)*e,o=Math.floor(r),s=_1(aT(i,o).subarray(0,o+1)),a=y1(i.subarray(o+1));return s+(a-s)*(r-o)}}function lu(i,e){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(e).domain(i);break}return this}function AH(i,e){switch(arguments.length){case 0:break;case 1:{typeof i=="function"?this.interpolator(i):this.range(i);break}default:{this.domain(i),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}const b1=Symbol("implicit");function lT(){var i=new m1,e=[],t=[],n=b1;function r(o){let s=i.get(o);if(s===void 0){if(n!==b1)return n;i.set(o,s=e.push(o)-1)}return t[s%t.length]}return r.domain=function(o){if(!arguments.length)return e.slice();e=[],i=new m1;for(const s of o)i.has(s)||i.set(s,e.push(s)-1);return r},r.range=function(o){return arguments.length?(t=Array.from(o),r):t.slice()},r.unknown=function(o){return arguments.length?(n=o,r):n},r.copy=function(){return lT(e,t).unknown(n)},lu.apply(r,arguments),r}function IH(i){return function(){return i}}function kH(i){return+i}var v1=[0,1];function Po(i){return i}function Lg(i,e){return(e-=i=+i)?function(t){return(t-i)/e}:IH(isNaN(e)?NaN:.5)}function LH(i,e){var t;return i>e&&(t=i,i=e,e=t),function(n){return Math.max(i,Math.min(e,n))}}function RH(i,e,t){var n=i[0],r=i[1],o=e[0],s=e[1];return r<n?(n=Lg(r,n),o=t(s,o)):(n=Lg(n,r),o=t(o,s)),function(a){return o(n(a))}}function PH(i,e,t){var n=Math.min(i.length,e.length)-1,r=new Array(n),o=new Array(n),s=-1;for(i[n]<i[0]&&(i=i.slice().reverse(),e=e.slice().reverse());++s<n;)r[s]=Lg(i[s],i[s+1]),o[s]=t(e[s],e[s+1]);return function(a){var l=oT(i,a,1,n)-1;return o[l](r[l](a))}}function rb(i,e){return e.domain(i.domain()).range(i.range()).interpolate(i.interpolate()).clamp(i.clamp()).unknown(i.unknown())}function cT(){var i=v1,e=v1,t=tl,n,r,o,s=Po,a,l,c;function u(){var d=Math.min(i.length,e.length);return s!==Po&&(s=LH(i[0],i[d-1])),a=d>2?PH:RH,l=c=null,h}function h(d){return d==null||isNaN(d=+d)?o:(l||(l=a(i.map(n),e,t)))(n(s(d)))}return h.invert=function(d){return s(r((c||(c=a(e,i.map(n),$n)))(d)))},h.domain=function(d){return arguments.length?(i=Array.from(d,kH),u()):i.slice()},h.range=function(d){return arguments.length?(e=Array.from(d),u()):e.slice()},h.rangeRound=function(d){return e=Array.from(d),t=$C,u()},h.clamp=function(d){return arguments.length?(s=d?!0:Po,u()):s!==Po},h.interpolate=function(d){return arguments.length?(t=d,u()):t},h.unknown=function(d){return arguments.length?(o=d,h):o},function(d,f){return n=d,r=f,u()}}function uT(){return cT()(Po,Po)}function DH(i){return Math.abs(i=Math.round(i))>=1e21?i.toLocaleString("en").replace(/,/g,""):i.toString(10)}function Gd(i,e){if((t=(i=e?i.toExponential(e-1):i.toExponential()).indexOf("e"))<0)return null;var t,n=i.slice(0,t);return[n.length>1?n[0]+n.slice(2):n,+i.slice(t+1)]}function Va(i){return i=Gd(Math.abs(i)),i?i[1]:NaN}function MH(i,e){return function(t,n){for(var r=t.length,o=[],s=0,a=i[0],l=0;r>0&&a>0&&(l+a+1>n&&(a=Math.max(1,n-l)),o.push(t.substring(r-=a,r+a)),!((l+=a+1)>n));)a=i[s=(s+1)%i.length];return o.reverse().join(e)}}function NH(i){return function(e){return e.replace(/[0-9]/g,function(t){return i[+t]})}}var BH=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Wd(i){if(!(e=BH.exec(i)))throw new Error("invalid format: "+i);var e;return new ob({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Wd.prototype=ob.prototype;function ob(i){this.fill=i.fill===void 0?" ":i.fill+"",this.align=i.align===void 0?">":i.align+"",this.sign=i.sign===void 0?"-":i.sign+"",this.symbol=i.symbol===void 0?"":i.symbol+"",this.zero=!!i.zero,this.width=i.width===void 0?void 0:+i.width,this.comma=!!i.comma,this.precision=i.precision===void 0?void 0:+i.precision,this.trim=!!i.trim,this.type=i.type===void 0?"":i.type+""}ob.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function OH(i){e:for(var e=i.length,t=1,n=-1,r;t<e;++t)switch(i[t]){case".":n=r=t;break;case"0":n===0&&(n=t),r=t;break;default:if(!+i[t])break e;n>0&&(n=0);break}return n>0?i.slice(0,n)+i.slice(r+1):i}var hT;function FH(i,e){var t=Gd(i,e);if(!t)return i+"";var n=t[0],r=t[1],o=r-(hT=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,s=n.length;return o===s?n:o>s?n+new Array(o-s+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+Gd(i,Math.max(0,e+o-1))[0]}function x1(i,e){var t=Gd(i,e);if(!t)return i+"";var n=t[0],r=t[1];return r<0?"0."+new Array(-r).join("0")+n:n.length>r+1?n.slice(0,r+1)+"."+n.slice(r+1):n+new Array(r-n.length+2).join("0")}const w1={"%":(i,e)=>(i*100).toFixed(e),b:i=>Math.round(i).toString(2),c:i=>i+"",d:DH,e:(i,e)=>i.toExponential(e),f:(i,e)=>i.toFixed(e),g:(i,e)=>i.toPrecision(e),o:i=>Math.round(i).toString(8),p:(i,e)=>x1(i*100,e),r:x1,s:FH,X:i=>Math.round(i).toString(16).toUpperCase(),x:i=>Math.round(i).toString(16)};function S1(i){return i}var E1=Array.prototype.map,C1=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function zH(i){var e=i.grouping===void 0||i.thousands===void 0?S1:MH(E1.call(i.grouping,Number),i.thousands+""),t=i.currency===void 0?"":i.currency[0]+"",n=i.currency===void 0?"":i.currency[1]+"",r=i.decimal===void 0?".":i.decimal+"",o=i.numerals===void 0?S1:NH(E1.call(i.numerals,String)),s=i.percent===void 0?"%":i.percent+"",a=i.minus===void 0?"":i.minus+"",l=i.nan===void 0?"NaN":i.nan+"";function c(h){h=Wd(h);var d=h.fill,f=h.align,p=h.sign,b=h.symbol,g=h.zero,_=h.width,T=h.comma,E=h.precision,y=h.trim,C=h.type;C==="n"?(T=!0,C="g"):w1[C]||(E===void 0&&(E=12),y=!0,C="g"),(g||d==="0"&&f==="=")&&(g=!0,d="0",f="=");var I=b==="$"?t:b==="#"&&/[boxX]/.test(C)?"0"+C.toLowerCase():"",F=b==="$"?n:/[%p]/.test(C)?s:"",V=w1[C],q=/[defgprs%]/.test(C);E=E===void 0?6:/[gprs]/.test(C)?Math.max(1,Math.min(21,E)):Math.max(0,Math.min(20,E));function Q(M){var ae=I,ee=F,R,X,O;if(C==="c")ee=V(M)+ee,M="";else{M=+M;var W=M<0||1/M<0;if(M=isNaN(M)?l:V(Math.abs(M),E),y&&(M=OH(M)),W&&+M==0&&p!=="+"&&(W=!1),ae=(W?p==="("?p:a:p==="-"||p==="("?"":p)+ae,ee=(C==="s"?C1[8+hT/3]:"")+ee+(W&&p==="("?")":""),q){for(R=-1,X=M.length;++R<X;)if(O=M.charCodeAt(R),48>O||O>57){ee=(O===46?r+M.slice(R+1):M.slice(R))+ee,M=M.slice(0,R);break}}}T&&!g&&(M=e(M,1/0));var ne=ae.length+M.length+ee.length,Y=ne<_?new Array(_-ne+1).join(d):"";switch(T&&g&&(M=e(Y+M,Y.length?_-ee.length:1/0),Y=""),f){case"<":M=ae+M+ee+Y;break;case"=":M=ae+Y+M+ee;break;case"^":M=Y.slice(0,ne=Y.length>>1)+ae+M+ee+Y.slice(ne);break;default:M=Y+ae+M+ee;break}return o(M)}return Q.toString=function(){return h+""},Q}function u(h,d){var f=c((h=Wd(h),h.type="f",h)),p=Math.max(-8,Math.min(8,Math.floor(Va(d)/3)))*3,b=Math.pow(10,-p),g=C1[8+p/3];return function(_){return f(b*_)+g}}return{format:c,formatPrefix:u}}var ju,sb,dT;UH({thousands:",",grouping:[3],currency:["$",""]});function UH(i){return ju=zH(i),sb=ju.format,dT=ju.formatPrefix,ju}function $H(i){return Math.max(0,-Va(Math.abs(i)))}function VH(i,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Va(e)/3)))*3-Va(Math.abs(i)))}function HH(i,e){return i=Math.abs(i),e=Math.abs(e)-i,Math.max(0,Va(e)-Va(i))+1}function GH(i,e,t,n){var r=kg(i,e,t),o;switch(n=Wd(n??",f"),n.type){case"s":{var s=Math.max(Math.abs(i),Math.abs(e));return n.precision==null&&!isNaN(o=VH(r,s))&&(n.precision=o),dT(n,s)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=HH(r,Math.max(Math.abs(i),Math.abs(e))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=$H(r))&&(n.precision=o-(n.type==="%")*2);break}}return sb(n)}function Nf(i){var e=i.domain;return i.ticks=function(t){var n=e();return TH(n[0],n[n.length-1],t??10)},i.tickFormat=function(t,n){var r=e();return GH(r[0],r[r.length-1],t??10,n)},i.nice=function(t){t==null&&(t=10);var n=e(),r=0,o=n.length-1,s=n[r],a=n[o],l,c,u=10;for(a<s&&(c=s,s=a,a=c,c=r,r=o,o=c);u-- >0;){if(c=Hd(s,a,t),c===l)return n[r]=s,n[o]=a,e(n);if(c>0)s=Math.floor(s/c)*c,a=Math.ceil(a/c)*c;else if(c<0)s=Math.ceil(s*c)/c,a=Math.floor(a*c)/c;else break;l=c}return i},i}function Hc(){var i=uT();return i.copy=function(){return rb(i,Hc())},lu.apply(i,arguments),Nf(i)}function WH(i,e){i=i.slice();var t=0,n=i.length-1,r=i[t],o=i[n],s;return o<r&&(s=t,t=n,n=s,s=r,r=o,o=s),i[t]=e.floor(r),i[n]=e.ceil(o),i}function T1(i){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/i))}}function A1(i){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*i}}function jH(i){var e=1,t=i(T1(e),A1(e));return t.constant=function(n){return arguments.length?i(T1(e=+n),A1(e)):e},Nf(t)}function Bf(){var i=jH(cT());return i.copy=function(){return rb(i,Bf()).constant(i.constant())},lu.apply(i,arguments)}function fT(){var i=0,e=1,t=1,n=[.5],r=[0,1],o;function s(l){return l!=null&&l<=l?r[oT(n,l,0,t)]:o}function a(){var l=-1;for(n=new Array(t);++l<t;)n[l]=((l+1)*e-(l-t)*i)/(t+1);return s}return s.domain=function(l){return arguments.length?([i,e]=l,i=+i,e=+e,a()):[i,e]},s.range=function(l){return arguments.length?(t=(r=Array.from(l)).length-1,a()):r.slice()},s.invertExtent=function(l){var c=r.indexOf(l);return c<0?[NaN,NaN]:c<1?[i,n[0]]:c>=t?[n[t-1],e]:[n[c-1],n[c]]},s.unknown=function(l){return arguments.length&&(o=l),s},s.thresholds=function(){return n.slice()},s.copy=function(){return fT().domain([i,e]).range(r).unknown(o)},lu.apply(Nf(s),arguments)}const Vp=new Date,Hp=new Date;function Kt(i,e,t,n){function r(o){return i(o=arguments.length===0?new Date:new Date(+o)),o}return r.floor=o=>(i(o=new Date(+o)),o),r.ceil=o=>(i(o=new Date(o-1)),e(o,1),i(o),o),r.round=o=>{const s=r(o),a=r.ceil(o);return o-s<a-o?s:a},r.offset=(o,s)=>(e(o=new Date(+o),s==null?1:Math.floor(s)),o),r.range=(o,s,a)=>{const l=[];if(o=r.ceil(o),a=a==null?1:Math.floor(a),!(o<s)||!(a>0))return l;let c;do l.push(c=new Date(+o)),e(o,a),i(o);while(c<o&&o<s);return l},r.filter=o=>Kt(s=>{if(s>=s)for(;i(s),!o(s);)s.setTime(s-1)},(s,a)=>{if(s>=s)if(a<0)for(;++a<=0;)for(;e(s,-1),!o(s););else for(;--a>=0;)for(;e(s,1),!o(s););}),t&&(r.count=(o,s)=>(Vp.setTime(+o),Hp.setTime(+s),i(Vp),i(Hp),Math.floor(t(Vp,Hp))),r.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?r.filter(n?s=>n(s)%o===0:s=>r.count(0,s)%o===0):r)),r}const jd=Kt(()=>{},(i,e)=>{i.setTime(+i+e)},(i,e)=>e-i);jd.every=i=>(i=Math.floor(i),!isFinite(i)||!(i>0)?null:i>1?Kt(e=>{e.setTime(Math.floor(e/i)*i)},(e,t)=>{e.setTime(+e+t*i)},(e,t)=>(t-e)/i):jd);jd.range;const to=1e3,Sn=to*60,io=Sn*60,co=io*24,ab=co*7,I1=co*30,Gp=co*365,ua=Kt(i=>{i.setTime(i-i.getMilliseconds())},(i,e)=>{i.setTime(+i+e*to)},(i,e)=>(e-i)/to,i=>i.getUTCSeconds());ua.range;const lb=Kt(i=>{i.setTime(i-i.getMilliseconds()-i.getSeconds()*to)},(i,e)=>{i.setTime(+i+e*Sn)},(i,e)=>(e-i)/Sn,i=>i.getMinutes());lb.range;const YH=Kt(i=>{i.setUTCSeconds(0,0)},(i,e)=>{i.setTime(+i+e*Sn)},(i,e)=>(e-i)/Sn,i=>i.getUTCMinutes());YH.range;const cb=Kt(i=>{i.setTime(i-i.getMilliseconds()-i.getSeconds()*to-i.getMinutes()*Sn)},(i,e)=>{i.setTime(+i+e*io)},(i,e)=>(e-i)/io,i=>i.getHours());cb.range;const qH=Kt(i=>{i.setUTCMinutes(0,0,0)},(i,e)=>{i.setTime(+i+e*io)},(i,e)=>(e-i)/io,i=>i.getUTCHours());qH.range;const cu=Kt(i=>i.setHours(0,0,0,0),(i,e)=>i.setDate(i.getDate()+e),(i,e)=>(e-i-(e.getTimezoneOffset()-i.getTimezoneOffset())*Sn)/co,i=>i.getDate()-1);cu.range;const ub=Kt(i=>{i.setUTCHours(0,0,0,0)},(i,e)=>{i.setUTCDate(i.getUTCDate()+e)},(i,e)=>(e-i)/co,i=>i.getUTCDate()-1);ub.range;const XH=Kt(i=>{i.setUTCHours(0,0,0,0)},(i,e)=>{i.setUTCDate(i.getUTCDate()+e)},(i,e)=>(e-i)/co,i=>Math.floor(i/co));XH.range;function Ss(i){return Kt(e=>{e.setDate(e.getDate()-(e.getDay()+7-i)%7),e.setHours(0,0,0,0)},(e,t)=>{e.setDate(e.getDate()+t*7)},(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Sn)/ab)}const Of=Ss(0),Yd=Ss(1),KH=Ss(2),ZH=Ss(3),Ha=Ss(4),QH=Ss(5),JH=Ss(6);Of.range;Yd.range;KH.range;ZH.range;Ha.range;QH.range;JH.range;function Es(i){return Kt(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-i)%7),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t*7)},(e,t)=>(t-e)/ab)}const pT=Es(0),qd=Es(1),eG=Es(2),tG=Es(3),Ga=Es(4),iG=Es(5),nG=Es(6);pT.range;qd.range;eG.range;tG.range;Ga.range;iG.range;nG.range;const hb=Kt(i=>{i.setDate(1),i.setHours(0,0,0,0)},(i,e)=>{i.setMonth(i.getMonth()+e)},(i,e)=>e.getMonth()-i.getMonth()+(e.getFullYear()-i.getFullYear())*12,i=>i.getMonth());hb.range;const rG=Kt(i=>{i.setUTCDate(1),i.setUTCHours(0,0,0,0)},(i,e)=>{i.setUTCMonth(i.getUTCMonth()+e)},(i,e)=>e.getUTCMonth()-i.getUTCMonth()+(e.getUTCFullYear()-i.getUTCFullYear())*12,i=>i.getUTCMonth());rG.range;const uo=Kt(i=>{i.setMonth(0,1),i.setHours(0,0,0,0)},(i,e)=>{i.setFullYear(i.getFullYear()+e)},(i,e)=>e.getFullYear()-i.getFullYear(),i=>i.getFullYear());uo.every=i=>!isFinite(i=Math.floor(i))||!(i>0)?null:Kt(e=>{e.setFullYear(Math.floor(e.getFullYear()/i)*i),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t*i)});uo.range;const bs=Kt(i=>{i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},(i,e)=>{i.setUTCFullYear(i.getUTCFullYear()+e)},(i,e)=>e.getUTCFullYear()-i.getUTCFullYear(),i=>i.getUTCFullYear());bs.every=i=>!isFinite(i=Math.floor(i))||!(i>0)?null:Kt(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/i)*i),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t*i)});bs.range;function oG(i,e,t,n,r,o){const s=[[ua,1,to],[ua,5,5*to],[ua,15,15*to],[ua,30,30*to],[o,1,Sn],[o,5,5*Sn],[o,15,15*Sn],[o,30,30*Sn],[r,1,io],[r,3,3*io],[r,6,6*io],[r,12,12*io],[n,1,co],[n,2,2*co],[t,1,ab],[e,1,I1],[e,3,3*I1],[i,1,Gp]];function a(c,u,h){const d=u<c;d&&([c,u]=[u,c]);const f=h&&typeof h.range=="function"?h:l(c,u,h),p=f?f.range(c,+u+1):[];return d?p.reverse():p}function l(c,u,h){const d=Math.abs(u-c)/h,f=nb(([,,g])=>g).right(s,d);if(f===s.length)return i.every(kg(c/Gp,u/Gp,h));if(f===0)return jd.every(Math.max(kg(c,u,h),1));const[p,b]=s[d/s[f-1][2]<s[f][2]/d?f-1:f];return p.every(b)}return[a,l]}const[sG,aG]=oG(uo,hb,Of,cu,cb,lb);function Wp(i){if(0<=i.y&&i.y<100){var e=new Date(-1,i.m,i.d,i.H,i.M,i.S,i.L);return e.setFullYear(i.y),e}return new Date(i.y,i.m,i.d,i.H,i.M,i.S,i.L)}function jp(i){if(0<=i.y&&i.y<100){var e=new Date(Date.UTC(-1,i.m,i.d,i.H,i.M,i.S,i.L));return e.setUTCFullYear(i.y),e}return new Date(Date.UTC(i.y,i.m,i.d,i.H,i.M,i.S,i.L))}function El(i,e,t){return{y:i,m:e,d:t,H:0,M:0,S:0,L:0}}function lG(i){var e=i.dateTime,t=i.date,n=i.time,r=i.periods,o=i.days,s=i.shortDays,a=i.months,l=i.shortMonths,c=Cl(r),u=Tl(r),h=Cl(o),d=Tl(o),f=Cl(s),p=Tl(s),b=Cl(a),g=Tl(a),_=Cl(l),T=Tl(l),E={a:W,A:ne,b:Y,B:ie,c:null,d:M1,e:M1,f:RG,g:$G,G:HG,H:IG,I:kG,j:LG,L:mT,m:PG,M:DG,p:j,q:fe,Q:O1,s:F1,S:MG,u:NG,U:BG,V:OG,w:FG,W:zG,x:null,X:null,y:UG,Y:VG,Z:GG,"%":B1},y={a:de,A:Ze,b:oe,B:ft,c:null,d:N1,e:N1,f:qG,g:rW,G:sW,H:WG,I:jG,j:YG,L:_T,m:XG,M:KG,p:$e,q:gt,Q:O1,s:F1,S:ZG,u:QG,U:JG,V:eW,w:tW,W:iW,x:null,X:null,y:nW,Y:oW,Z:aW,"%":B1},C={a:Q,A:M,b:ae,B:ee,c:R,d:P1,e:P1,f:EG,g:R1,G:L1,H:D1,I:D1,j:vG,L:SG,m:bG,M:xG,p:q,q:yG,Q:TG,s:AG,S:wG,u:fG,U:pG,V:mG,w:dG,W:gG,x:X,X:O,y:R1,Y:L1,Z:_G,"%":CG};E.x=I(t,E),E.X=I(n,E),E.c=I(e,E),y.x=I(t,y),y.X=I(n,y),y.c=I(e,y);function I(te,Se){return function(Me){var G=[],Ge=-1,Pe=0,_t=te.length,It,he,We;for(Me instanceof Date||(Me=new Date(+Me));++Ge<_t;)te.charCodeAt(Ge)===37&&(G.push(te.slice(Pe,Ge)),(he=k1[It=te.charAt(++Ge)])!=null?It=te.charAt(++Ge):he=It==="e"?" ":"0",(We=Se[It])&&(It=We(Me,he)),G.push(It),Pe=Ge+1);return G.push(te.slice(Pe,Ge)),G.join("")}}function F(te,Se){return function(Me){var G=El(1900,void 0,1),Ge=V(G,te,Me+="",0),Pe,_t;if(Ge!=Me.length)return null;if("Q"in G)return new Date(G.Q);if("s"in G)return new Date(G.s*1e3+("L"in G?G.L:0));if(Se&&!("Z"in G)&&(G.Z=0),"p"in G&&(G.H=G.H%12+G.p*12),G.m===void 0&&(G.m="q"in G?G.q:0),"V"in G){if(G.V<1||G.V>53)return null;"w"in G||(G.w=1),"Z"in G?(Pe=jp(El(G.y,0,1)),_t=Pe.getUTCDay(),Pe=_t>4||_t===0?qd.ceil(Pe):qd(Pe),Pe=ub.offset(Pe,(G.V-1)*7),G.y=Pe.getUTCFullYear(),G.m=Pe.getUTCMonth(),G.d=Pe.getUTCDate()+(G.w+6)%7):(Pe=Wp(El(G.y,0,1)),_t=Pe.getDay(),Pe=_t>4||_t===0?Yd.ceil(Pe):Yd(Pe),Pe=cu.offset(Pe,(G.V-1)*7),G.y=Pe.getFullYear(),G.m=Pe.getMonth(),G.d=Pe.getDate()+(G.w+6)%7)}else("W"in G||"U"in G)&&("w"in G||(G.w="u"in G?G.u%7:"W"in G?1:0),_t="Z"in G?jp(El(G.y,0,1)).getUTCDay():Wp(El(G.y,0,1)).getDay(),G.m=0,G.d="W"in G?(G.w+6)%7+G.W*7-(_t+5)%7:G.w+G.U*7-(_t+6)%7);return"Z"in G?(G.H+=G.Z/100|0,G.M+=G.Z%100,jp(G)):Wp(G)}}function V(te,Se,Me,G){for(var Ge=0,Pe=Se.length,_t=Me.length,It,he;Ge<Pe;){if(G>=_t)return-1;if(It=Se.charCodeAt(Ge++),It===37){if(It=Se.charAt(Ge++),he=C[It in k1?Se.charAt(Ge++):It],!he||(G=he(te,Me,G))<0)return-1}else if(It!=Me.charCodeAt(G++))return-1}return G}function q(te,Se,Me){var G=c.exec(Se.slice(Me));return G?(te.p=u.get(G[0].toLowerCase()),Me+G[0].length):-1}function Q(te,Se,Me){var G=f.exec(Se.slice(Me));return G?(te.w=p.get(G[0].toLowerCase()),Me+G[0].length):-1}function M(te,Se,Me){var G=h.exec(Se.slice(Me));return G?(te.w=d.get(G[0].toLowerCase()),Me+G[0].length):-1}function ae(te,Se,Me){var G=_.exec(Se.slice(Me));return G?(te.m=T.get(G[0].toLowerCase()),Me+G[0].length):-1}function ee(te,Se,Me){var G=b.exec(Se.slice(Me));return G?(te.m=g.get(G[0].toLowerCase()),Me+G[0].length):-1}function R(te,Se,Me){return V(te,e,Se,Me)}function X(te,Se,Me){return V(te,t,Se,Me)}function O(te,Se,Me){return V(te,n,Se,Me)}function W(te){return s[te.getDay()]}function ne(te){return o[te.getDay()]}function Y(te){return l[te.getMonth()]}function ie(te){return a[te.getMonth()]}function j(te){return r[+(te.getHours()>=12)]}function fe(te){return 1+~~(te.getMonth()/3)}function de(te){return s[te.getUTCDay()]}function Ze(te){return o[te.getUTCDay()]}function oe(te){return l[te.getUTCMonth()]}function ft(te){return a[te.getUTCMonth()]}function $e(te){return r[+(te.getUTCHours()>=12)]}function gt(te){return 1+~~(te.getUTCMonth()/3)}return{format:function(te){var Se=I(te+="",E);return Se.toString=function(){return te},Se},parse:function(te){var Se=F(te+="",!1);return Se.toString=function(){return te},Se},utcFormat:function(te){var Se=I(te+="",y);return Se.toString=function(){return te},Se},utcParse:function(te){var Se=F(te+="",!0);return Se.toString=function(){return te},Se}}}var k1={"-":"",_:" ",0:"0"},ti=/^\s*\d+/,cG=/^%/,uG=/[\\^$*+?|[\]().{}]/g;function it(i,e,t){var n=i<0?"-":"",r=(n?-i:i)+"",o=r.length;return n+(o<t?new Array(t-o+1).join(e)+r:r)}function hG(i){return i.replace(uG,"\\$&")}function Cl(i){return new RegExp("^(?:"+i.map(hG).join("|")+")","i")}function Tl(i){return new Map(i.map((e,t)=>[e.toLowerCase(),t]))}function dG(i,e,t){var n=ti.exec(e.slice(t,t+1));return n?(i.w=+n[0],t+n[0].length):-1}function fG(i,e,t){var n=ti.exec(e.slice(t,t+1));return n?(i.u=+n[0],t+n[0].length):-1}function pG(i,e,t){var n=ti.exec(e.slice(t,t+2));return n?(i.U=+n[0],t+n[0].length):-1}function mG(i,e,t){var n=ti.exec(e.slice(t,t+2));return n?(i.V=+n[0],t+n[0].length):-1}function gG(i,e,t){var n=ti.exec(e.slice(t,t+2));return n?(i.W=+n[0],t+n[0].length):-1}function L1(i,e,t){var n=ti.exec(e.slice(t,t+4));return n?(i.y=+n[0],t+n[0].length):-1}function R1(i,e,t){var n=ti.exec(e.slice(t,t+2));return n?(i.y=+n[0]+(+n[0]>68?1900:2e3),t+n[0].length):-1}function _G(i,e,t){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(t,t+6));return n?(i.Z=n[1]?0:-(n[2]+(n[3]||"00")),t+n[0].length):-1}function yG(i,e,t){var n=ti.exec(e.slice(t,t+1));return n?(i.q=n[0]*3-3,t+n[0].length):-1}function bG(i,e,t){var n=ti.exec(e.slice(t,t+2));return n?(i.m=n[0]-1,t+n[0].length):-1}function P1(i,e,t){var n=ti.exec(e.slice(t,t+2));return n?(i.d=+n[0],t+n[0].length):-1}function vG(i,e,t){var n=ti.exec(e.slice(t,t+3));return n?(i.m=0,i.d=+n[0],t+n[0].length):-1}function D1(i,e,t){var n=ti.exec(e.slice(t,t+2));return n?(i.H=+n[0],t+n[0].length):-1}function xG(i,e,t){var n=ti.exec(e.slice(t,t+2));return n?(i.M=+n[0],t+n[0].length):-1}function wG(i,e,t){var n=ti.exec(e.slice(t,t+2));return n?(i.S=+n[0],t+n[0].length):-1}function SG(i,e,t){var n=ti.exec(e.slice(t,t+3));return n?(i.L=+n[0],t+n[0].length):-1}function EG(i,e,t){var n=ti.exec(e.slice(t,t+6));return n?(i.L=Math.floor(n[0]/1e3),t+n[0].length):-1}function CG(i,e,t){var n=cG.exec(e.slice(t,t+1));return n?t+n[0].length:-1}function TG(i,e,t){var n=ti.exec(e.slice(t));return n?(i.Q=+n[0],t+n[0].length):-1}function AG(i,e,t){var n=ti.exec(e.slice(t));return n?(i.s=+n[0],t+n[0].length):-1}function M1(i,e){return it(i.getDate(),e,2)}function IG(i,e){return it(i.getHours(),e,2)}function kG(i,e){return it(i.getHours()%12||12,e,2)}function LG(i,e){return it(1+cu.count(uo(i),i),e,3)}function mT(i,e){return it(i.getMilliseconds(),e,3)}function RG(i,e){return mT(i,e)+"000"}function PG(i,e){return it(i.getMonth()+1,e,2)}function DG(i,e){return it(i.getMinutes(),e,2)}function MG(i,e){return it(i.getSeconds(),e,2)}function NG(i){var e=i.getDay();return e===0?7:e}function BG(i,e){return it(Of.count(uo(i)-1,i),e,2)}function gT(i){var e=i.getDay();return e>=4||e===0?Ha(i):Ha.ceil(i)}function OG(i,e){return i=gT(i),it(Ha.count(uo(i),i)+(uo(i).getDay()===4),e,2)}function FG(i){return i.getDay()}function zG(i,e){return it(Yd.count(uo(i)-1,i),e,2)}function UG(i,e){return it(i.getFullYear()%100,e,2)}function $G(i,e){return i=gT(i),it(i.getFullYear()%100,e,2)}function VG(i,e){return it(i.getFullYear()%1e4,e,4)}function HG(i,e){var t=i.getDay();return i=t>=4||t===0?Ha(i):Ha.ceil(i),it(i.getFullYear()%1e4,e,4)}function GG(i){var e=i.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+it(e/60|0,"0",2)+it(e%60,"0",2)}function N1(i,e){return it(i.getUTCDate(),e,2)}function WG(i,e){return it(i.getUTCHours(),e,2)}function jG(i,e){return it(i.getUTCHours()%12||12,e,2)}function YG(i,e){return it(1+ub.count(bs(i),i),e,3)}function _T(i,e){return it(i.getUTCMilliseconds(),e,3)}function qG(i,e){return _T(i,e)+"000"}function XG(i,e){return it(i.getUTCMonth()+1,e,2)}function KG(i,e){return it(i.getUTCMinutes(),e,2)}function ZG(i,e){return it(i.getUTCSeconds(),e,2)}function QG(i){var e=i.getUTCDay();return e===0?7:e}function JG(i,e){return it(pT.count(bs(i)-1,i),e,2)}function yT(i){var e=i.getUTCDay();return e>=4||e===0?Ga(i):Ga.ceil(i)}function eW(i,e){return i=yT(i),it(Ga.count(bs(i),i)+(bs(i).getUTCDay()===4),e,2)}function tW(i){return i.getUTCDay()}function iW(i,e){return it(qd.count(bs(i)-1,i),e,2)}function nW(i,e){return it(i.getUTCFullYear()%100,e,2)}function rW(i,e){return i=yT(i),it(i.getUTCFullYear()%100,e,2)}function oW(i,e){return it(i.getUTCFullYear()%1e4,e,4)}function sW(i,e){var t=i.getUTCDay();return i=t>=4||t===0?Ga(i):Ga.ceil(i),it(i.getUTCFullYear()%1e4,e,4)}function aW(){return"+0000"}function B1(){return"%"}function O1(i){return+i}function F1(i){return Math.floor(+i/1e3)}var js,Rr;lW({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function lW(i){return js=lG(i),Rr=js.format,js.parse,js.utcFormat,js.utcParse,js}function cW(i){return new Date(i)}function uW(i){return i instanceof Date?+i:+new Date(+i)}function bT(i,e,t,n,r,o,s,a,l,c){var u=uT(),h=u.invert,d=u.domain,f=c(".%L"),p=c(":%S"),b=c("%I:%M"),g=c("%I %p"),_=c("%a %d"),T=c("%b %d"),E=c("%B"),y=c("%Y");function C(I){return(l(I)<I?f:a(I)<I?p:s(I)<I?b:o(I)<I?g:n(I)<I?r(I)<I?_:T:t(I)<I?E:y)(I)}return u.invert=function(I){return new Date(h(I))},u.domain=function(I){return arguments.length?d(Array.from(I,uW)):d().map(cW)},u.ticks=function(I){var F=d();return i(F[0],F[F.length-1],I??10)},u.tickFormat=function(I,F){return F==null?C:c(F)},u.nice=function(I){var F=d();return(!I||typeof I.range!="function")&&(I=e(F[0],F[F.length-1],I??10)),I?d(WH(F,I)):u},u.copy=function(){return rb(u,bT(i,e,t,n,r,o,s,a,l,c))},u}function hW(){return lu.apply(bT(sG,aG,uo,hb,Of,cu,cb,lb,ua,Rr).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function dW(){var i=0,e=1,t,n,r,o,s=Po,a=!1,l;function c(h){return h==null||isNaN(h=+h)?l:s(r===0?.5:(h=(o(h)-t)*r,a?Math.max(0,Math.min(1,h)):h))}c.domain=function(h){return arguments.length?([i,e]=h,t=o(i=+i),n=o(e=+e),r=t===n?0:1/(n-t),c):[i,e]},c.clamp=function(h){return arguments.length?(a=!!h,c):a},c.interpolator=function(h){return arguments.length?(s=h,c):s};function u(h){return function(d){var f,p;return arguments.length?([f,p]=d,s=h(f,p),c):[s(0),s(1)]}}return c.range=u(tl),c.rangeRound=u($C),c.unknown=function(h){return arguments.length?(l=h,c):l},function(h){return o=h,t=h(i),n=h(e),r=t===n?0:1/(n-t),c}}function fW(i,e){return e.domain(i.domain()).interpolator(i.interpolator()).clamp(i.clamp()).unknown(i.unknown())}function vT(){var i=Nf(dW()(Po));return i.copy=function(){return fW(i,vT())},AH.apply(i,arguments)}const pW='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M48 64C21.5 64 0 85.5 0 112V400c0 26.5 21.5 48 48 48H80c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48H48zm192 0c-26.5 0-48 21.5-48 48V400c0 26.5 21.5 48 48 48h32c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48H240z"/></svg>',mW='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg>',gW={top:1,left:5,bottom:1,right:5},Yu={allowSelection:!0,showAnimationControls:!1,animationSpeed:50,padding:gW,axisTickHeight:16,selectionRadius:3,selectionPadding:8,barCount:250,barRadius:1,barPadding:.1,barTopMargin:20,minBarHeight:1,dataStep:void 0,tickStep:void 0,stickySelection:!0,formatter:void 0,onBrush:void 0,onBarHover:void 0,onAnimationPlay:void 0,onAnimationPause:void 0,onAnimationTick:void 0,noDataMessage:"No timeline data",loadingMessage:"Data loading..."},_W=i=>typeof i=="function",yW=i=>Array.isArray(i),bW=i=>i instanceof Object,Xd=i=>i.constructor.name!=="Function"&&i.constructor.name!=="Object",z1=i=>bW(i)&&!yW(i)&&!_W(i)&&!Xd(i),Kd=(i,e=new Map)=>{if(typeof i!="object"||i===null)return i;if(i instanceof Date)return new Date(i.getTime());if(i instanceof Array){const t=[];e.set(i,t);for(const n of i)t.push(e.has(n)?e.get(n):Kd(n,e));return i}if(Xd(i))return i;if(i instanceof Object){const t={};e.set(i,t);const n=i;return Object.keys(i).reduce((r,o)=>(r[o]=e.has(n[o])?e.get(n[o]):Kd(n[o],e),r),t),t}return i},Ct=(i,e,t=new Map)=>{const n=Xd(i)?i:Kd(i);return i===e?i:t.has(e)?t.get(e):(t.set(e,n),Object.keys(e).forEach(r=>{z1(i[r])&&z1(e[r])?n[r]=Ct(i[r],e[r],t):Xd(e)?n[r]=e:n[r]=Kd(e[r])}),n)},vW=i=>{const e=getComputedStyle(i);let t=i.clientWidth,n=i.clientHeight;return n-=parseFloat(e.paddingTop)+parseFloat(e.paddingBottom),t-=parseFloat(e.paddingLeft)+parseFloat(e.paddingRight),{height:n,width:t}},Wn=(i,e="",t,n)=>{if(!i)return"0";let r,o;t?(r=i,o=t):Math.abs(i)>=7e11?(r=i/1e12,o="T"):Math.abs(i)>=2e8?(r=i/1e9,o="B"):Math.abs(i)>=1e6?(r=i/1e6,o="M"):Math.abs(i)>=1e3?(r=i/1e3,o="K"):(r=i,o="");const s=Math.abs(r);n===void 0&&(Number.isInteger(s)?n=0:s<.1?n=3:s<1?n=2:s<10?n=1:n=0);let a=s>0&&s<.5/Math.pow(10,n);if(a){let c=n;for(;a&&c<8;)c++,a=s<.5/Math.pow(10,c);if(!a)n=c;else return`~${e??""}0`}let l=i<0?"-":"";return e&&(l+=e),`${l}${sb(`.${n}~f`)(s)}${o}`};function xW(i,e,t=e,n=[]){if(!i.length||!e.length||!t.length)return new Array(e.length).fill(0);const r=new Array(e.length).fill(0),o=new Map;for(const[l,c]of t){o.has(l)||o.set(l,new Map);for(let u=0;u<e.length;u++){const[h,d]=e[u];if(l===h&&c===d){o.get(l).set(c,u);break}}}const s=n.length>0?n[n.length-1]:e[e.length-1][1],a=[...t].sort((l,c)=>l[0]-c[0]);for(const l of i){let c=0,u=a.length-1;for(;c<=u;){const h=Math.floor((c+u)/2),[d,f]=a[h],p=f===s;if(l>=d&&(p?l<=f:l<f)){const b=o.get(d);if(b){const g=b.get(f);g!==void 0&&r[g]++}break}else l<d?u=h-1:c=h+1}}return r}function xT(i,e,t){if(!i)return[];const[n,r]=i,o=Math.abs(+r-+n),s=Number.isFinite(o)&&e>1?o/(e-1):1,a=t??s;if(a===0)return[];const l=Array.from({length:e},(c,u)=>+n+u*a);return l[e-1]=+r,l}function Zd(i,e,t,n=!1,r=!0){const o=Array.from({length:e.length-1},(l,c)=>[e[c],e[c+1]]),s=t&&n?o.filter(([l,c])=>{const[u,h]=t;return l<+u?!1:c>=+h?c>+u&&l<+h:!0}):o,a=xW(i,o,s,e);return o.map(([l,c],u)=>({rangeStart:r?l:new Date(l),rangeEnd:r?c:new Date(c),count:a[u]??0}))}const wW=Rr(".%L"),SW=Rr(":%S"),EW=Rr("%I:%M"),CW=Rr("%I %p"),TW=Rr("%a %d"),AW=Rr("%d %b"),IW=Rr("%b %Y"),kW=Rr("%Y"),LW=1,wT=1e3*LW,ST=60*wT,ET=60*ST,Ff=24*ET,RW=7*Ff,PW=30*Ff,DW=365*Ff,U1=(i,e=null,t=!1)=>{if(t)return Wn(i);const n=new Date(i),r=e!==null?e:Date.now()-n.getTime();return(r<wT?wW:r<ST?SW:r<ET?EW:r<Ff?CW:r<PW?r<RW?TW:AW:r>DW*20?kW:IW)(n)},MW="style_module_displayState__6ae19b84",NW={displayState:MW};(function(){try{if(typeof document<"u"){var i=document.createElement("style");i.appendChild(document.createTextNode('@keyframes style_module_fadeIn__ffac87fd{0%{opacity:0}to{opacity:.2}}.style_module_displayState__6ae19b84{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--cosmograph-ui-text);display:flex;justify-content:center;align-items:center;min-width:100px;opacity:.2;font-size:calc(var(--cosmograph-ui-font-size) + 1px);letter-spacing:-.02em;font-weight:200;user-select:none;-webkit-user-select:none;animation:style_module_fadeIn__ffac87fd .3s ease-in-out}:root{--cosmograph-timeline-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-timeline-selection-opacity: .5;--cosmograph-timeline-bar-color: var(--cosmograph-ui-element-color);--cosmograph-timeline-highlighted-bar-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-timeline-font-family: var(--cosmograph-ui-font-family);--cosmograph-timeline-font-size: var(--cosmograph-ui-tick-font-size);--cosmograph-timeline-background: var(--cosmograph-ui-background);--cosmograph-timeline-text-color: var(--cosmograph-ui-text);--cosmograph-timeline-axis-color: var(--cosmograph-ui-text)}.style_module_timeline__736434f7{position:relative;display:flex;background:var(--cosmograph-timeline-background);width:100%;min-height:25px;overflow:hidden}.style_module_timelineSvg__b916ad04{position:relative;width:100%;height:100%}.style_module_selection__ebee57f8{fill:var(--cosmograph-timeline-selection-color);fill-opacity:var(--cosmograph-timeline-selection-opacity);stroke:none}.style_module_axisTick__5865631d{color:var(--cosmograph-timeline-axis-color);font:var(--cosmograph-timeline-font-family);font-size:var(--cosmograph-timeline-font-size);user-select:none;-webkit-user-select:none;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum";alignment-baseline:text-before-edge}.style_module_axisLine__992b502d{opacity:.2;color:var(--cosmograph-timeline-axis-color)}.style_module_bar__114fa79f{fill:var(--cosmograph-timeline-bar-color);transform:scaleY(-1);opacity:0}.style_module_animationControl__ee52cd66{color:var(--cosmograph-timeline-axis-color);width:6%;max-width:30px;min-width:20px;cursor:pointer;display:none;align-items:center;user-select:none;-webkit-user-select:none;opacity:.5;position:relative;justify-content:center}.style_module_animationControl__ee52cd66>svg{width:50%;max-height:20px;padding-right:2px}.style_module_hidden__a73fe81a{display:none}.style_module_disabled__eb988570{opacity:.2;pointer-events:none}.style_module_highlightedBar__c2fc9bdc{fill:var(--cosmograph-timeline-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-search-font-family: var(--cosmograph-ui-font-family);--cosmograph-search-font-size: 14px;--cosmograph-search-list-font-size: 13.5px;--cosmograph-search-text-color: var(--cosmograph-ui-text);--cosmograph-search-background: transparent;--cosmograph-search-list-background: rgba(0, 0, 0, .2);--cosmograph-search-list-match-background: rgba(255, 255, 255, .2);--cosmograph-search-list-match-color: var(--cosmograph-ui-text)}.style_module_searchInput__d7830601:hover{filter:brightness(1.2) contrast(1)}.style_module_searchInput__d7830601{width:100%;background:transparent;color:var(--cosmograph-search-text-color);border:none;border-bottom:.5px solid var(--cosmograph-search-text-color);padding:4px 20px 5px 2px;font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:opacity .2s ease-out}.style_module_searchInput__d7830601::selection{background:var(--cosmograph-search-list-match-background)}.style_module_searchInput__d7830601:focus{outline:none}.style_module_searchSuggestions__b0d3f71e{color:#fff;width:100%;padding:0;margin:0;background:transparent;overflow-y:auto;flex:1;min-height:0}.style_module_searchSuggestions__b0d3f71e li{padding:5px 10px;cursor:pointer;-webkit-user-select:none;user-select:none;display:block;font-weight:500;font-size:var(--cosmograph-search-list-font-size);max-width:100%;overflow:hidden}.style_module_searchSuggestions__b0d3f71e li>div{white-space:nowrap;font-weight:200;overflow:hidden;text-overflow:ellipsis;width:100%}.style_module_searchSuggestions__b0d3f71e li:hover{background:#ffffff1a}.style_module_searchSuggestions__b0d3f71e mark{background:var(--cosmograph-search-list-match-background);color:var(--cosmograph-search-list-match-color);border-radius:2px}.style_module_clearButton__5ebb41de{position:absolute;right:0;top:0;height:100%;background:none;border:none;color:var(--cosmograph-search-text-color);font-weight:300;cursor:pointer;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d{opacity:.7}.style_module_placeholderWrapper__72d5eb0e{z-index:1;color:var(--cosmograph-search-text-color);font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);position:absolute;top:0;left:0;width:100%;bottom:0;display:flex;line-height:1.25;align-items:center;transition:transform .3s ease-out,opacity .3s ease-out}.style_module_placeholderWrapper__72d5eb0e.style_module_hidden__acfb8431{transform:translate(-30px);pointer-events:none;opacity:0}.style_module_searchInput__d7830601:disabled,.style_module_searchInput__d7830601.style_module_disabled__62c35dc5{opacity:.2;cursor:not-allowed;pointer-events:none}.style_module_disabled__62c35dc5 .style_module_clearButton__5ebb41de{display:none}.style_module_disabled__62c35dc5 .style_module_placeholderWrapper__72d5eb0e{opacity:.3;cursor:not-allowed}.style_module_searchInputWrapper__1edbcb22{position:relative;display:flex;width:100%}.style_module_noResults__363397c3{opacity:.3!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none}.style_module_noResults__363397c3:hover{background:none}.style_module_loading__296e0212{opacity:.7!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none;-webkit-user-select:none;user-select:none}.style_module_dropdownContainer__d98287da{position:absolute;top:100%;left:0;width:100%;background:var(--cosmograph-search-list-background);border-radius:4px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);opacity:0;transform:translateY(-10px);transition:opacity .2s ease-out,transform .2s ease-out;pointer-events:none;overflow:hidden;z-index:10;display:flex;flex-direction:column;padding-bottom:2px}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b{top:auto;bottom:100%;transform:translateY(10px)}.style_module_dropdownContainer__d98287da.style_module_visible__5be7493d{opacity:1;transform:translateY(0);pointer-events:auto}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b.style_module_visible__5be7493d{opacity:1;transform:translateY(-2px);pointer-events:auto}.style_module_footerContainer__73e7a066{flex-shrink:0}:root{--cosmograph-scrollbar-background: rgba(255, 255, 255, .1);--cosmograph-ui-background: rgb(45, 49, 58);--cosmograph-ui-text: #ffffffc7;--cosmograph-ui-tick-font-size: 11px;--cosmograph-ui-font-size: 12px;--cosmograph-ui-font-family: inherit;--cosmograph-ui-element-color: #5C616A;--cosmograph-ui-highlighted-element-color: white;--cosmograph-ui-selection-control-color: #8d949ea8;-webkit-font-smoothing:antialiased!important;text-rendering:optimizeLegibility!important}.style_module_cosmograph-ui__5acb97f1{background:var(--cosmograph-ui-background);color:var(--cosmograph-ui-text)}.style_module_scrollbar__f1516254 *::-webkit-scrollbar{width:5px;height:5px;border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-track{border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-corner{background:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-button{display:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-thumb{background-color:var(--cosmograph-scrollbar-background);transition:background-color .5s;border-radius:20px;border:3px solid var(--cosmograph-scrollbar-background)}@-moz-document url-prefix(){.style_module_scrollbar__f1516254 *{scrollbar-width:thin;scrollbar-color:var(--cosmograph-scrollbar-background) transparent;scrollbar-track-color:transparent;scrollbar-face-color:var(--cosmograph-scrollbar-background)}}:root{--cosmograph-histogram-background: var(--cosmograph-ui-background);--cosmograph-histogram-text-color: var(--cosmograph-ui-text);--cosmograph-histogram-axis-color: var(--cosmograph-ui-text);--cosmograph-histogram-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-histogram-selection-opacity: .5;--cosmograph-histogram-bar-color: var(--cosmograph-ui-element-color);--cosmograph-histogram-highlighted-bar-color: var( --cosmograph-ui-highlighted-element-color);--cosmograph-histogram-font-family: var(--cosmograph-ui-font-family);--cosmograph-histogram-font-size: var(--cosmograph-ui-tick-font-size)}.style_module_histogram__9d8a77ea{position:relative;display:flex;min-height:25px;background:var(--cosmograph-histogram-background);width:100%}.style_module_histogramSvg__ccccb628{position:relative;width:100%;height:100%}.style_module_selection__7db96137{fill:var(--cosmograph-histogram-selection-color);fill-opacity:var(--cosmograph-histogram-selection-opacity);stroke:none}.style_module_axisTick__898e1f39{color:var(--cosmograph-histogram-axis-color);font-family:var(--cosmograph-histogram-font-family);font-size:var(--cosmograph-histogram-font-size);user-select:none;-webkit-user-select:none;alignment-baseline:text-before-edge;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum"}.style_module_bar__3c9ab488{fill:var(--cosmograph-histogram-bar-color);transform:scaleY(-1)}.style_module_highlightedBar__b193a8de{fill:var(--cosmograph-histogram-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-bars-font-color: var(--cosmograph-ui-text);--cosmograph-bars-font-family: var(--cosmograph-ui-font-family);--cosmograph-bars-font-size: var(--cosmograph-ui-font-size);--cosmograph-bars-ui-font-size: 11.5px;--cosmograph-bars-background: var(--cosmograph-ui-element-color);--cosmograph-bars-bar-height: 20px;--cosmograph-bars-bar-bottom-margin: 2px;--cosmograph-bars-highlighted-color: var( --cosmograph-ui-highlighted-element-color)}.style_module_bars__25497ded{position:relative;width:100%;min-height:100px;user-select:none;flex-direction:column;-webkit-user-select:none}.style_module_bars__25497ded .scroll-container{position:relative;width:100%;overflow-y:hidden;overflow-x:hidden}.style_module_bars__25497ded .bars-container{position:relative;width:calc(100% - 1px);font-family:var(--cosmograph-bars-font-family)}.style_module_bars__25497ded .highlighted-bars-container{position:absolute;top:0;left:0;pointer-events:none}.style_module_bars__25497ded .row{height:var(--cosmograph-bars-bar-height);display:flex;align-items:center;margin-bottom:var(--cosmograph-bars-bar-bottom-margin);width:100%;transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row:hover{filter:brightness(1.15) contrast(1.05);transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row.unselected:hover{filter:brightness(.95) contrast(1.15);transition:filter .05s linear}.style_module_bars__25497ded .unselected{opacity:.85;filter:brightness(.8) contrast(1.1)}.style_module_bars__25497ded .selected{filter:brightness(1.05) contrast(1.05)}.style_module_bars__25497ded .selected>.info>.label{font-weight:600;filter:brightness(1.1) contrast(1.05)}.style_module_bars__25497ded .unselected>.info>.label{font-weight:300}.style_module_bars__25497ded .bar{height:100%;background-color:var(--cosmograph-bars-background);opacity:.8;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .bar-highlighted{height:100%;background-color:var(--cosmograph-bars-highlighted-color);opacity:.2;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .info{display:flex;justify-content:space-between;width:100%;padding:0 4px;position:absolute;font-size:var(--cosmograph-bars-font-size);font-feature-settings:"tnum";color:var(--cosmograph-bars-font-color);gap:2px}.style_module_bars__25497ded .label{min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:opacity .05s linear}.style_module_bars__25497ded .count{flex-shrink:0;font-weight:300;opacity:.8;transition:opacity .05s linear}.style_module_bars__25497ded .show-more{cursor:pointer;padding-top:2px;display:flex;font-weight:300;color:var(--cosmograph-bars-font-color);font-size:11px;justify-content:space-between;opacity:.6;font-size:var(--cosmograph-bars-ui-font-size);pointer-events:none;transition:opacity .1s linear}.style_module_bars__25497ded .show-more:hover{opacity:1;text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .show-more>span{pointer-events:all}.style_module_bars__25497ded .show-more-count{padding-right:5px;pointer-events:all;font-feature-settings:"tnum"}.style_module_bars__25497ded .unselected>.info>.label,.style_module_bars__25497ded .unselected>.info>.count{opacity:.5}.style_module_bars__25497ded .unselected:hover>.info>.label,.style_module_bars__25497ded .unselected:hover>.info>.count{opacity:1}.style_module_bars__25497ded .search-input{background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,.3);font-size:13px!important;color:var(--cosmograph-bars-font-color);line-height:1.5;padding:2px;width:100%;position:relative;transition:border-bottom-color .2s}.style_module_bars__25497ded .search-input::placeholder{color:var(--cosmograph-bars-font-color)!important;opacity:.4;font-weight:300;font-family:inherit}.style_module_bars__25497ded .search-container{position:relative;width:100%;margin-bottom:4px;display:none;z-index:1}.style_module_bars__25497ded .clear-button{position:absolute;right:0;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--cosmograph-bars-font-color);font-weight:300;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_bars__25497ded .clear-button.visible:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_bars__25497ded .clear-button.visible{opacity:.7}.style_module_bars__25497ded .clear-button svg{width:10px;height:10px;fill:currentColor}.style_module_bars__25497ded .sorting-block{visibility:hidden;margin-top:1px;display:flex;justify-content:space-between}.style_module_bars__25497ded .buttons-container{margin-top:4px;font-size:var(--cosmograph-bars-ui-font-size);display:flex;gap:4px;line-height:1.25}.style_module_bars__25497ded .buttons-container>div{transition:opacity .05s linear,filter .05s linear;padding:1px 5px;background:var(--cosmograph-bars-background);border-radius:4px;opacity:.9;display:flex;cursor:pointer;align-items:center}.style_module_bars__25497ded .buttons-container>div:hover{filter:brightness(1.2)}.style_module_bars__25497ded .reset-text{transition:opacity .05s linear,filter .05s linear;display:flex;font-size:var(--cosmograph-bars-ui-font-size);align-items:end;padding-right:4px;cursor:pointer;font-weight:300}.style_module_bars__25497ded .reset-text:hover{text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .reset-text.unselected{pointer-events:none;cursor:default;opacity:.7}.style_module_bars__25497ded :scope.reset-text:hover:not(.unselected){filter:brightness(1.5);opacity:1}:root{--cosmograph-size-legend-form-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-family: inherit;--cosmograph-size-legend-font-size: var(--cosmograph-ui-font-size);--cosmograph-size-legend-sublabel-font-size: 10px;--cosmograph-size-legend-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-size-legend-line-radius: 2px;--cosmograph-size-legend-line-width: 30px;--cosmograph-size-legend-hide-transform: translateY(100%);--cosmograph-size-legend-show-transform: translateX(0)}.style_module_container__d2889234{display:flex;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;overflow:hidden;min-height:25px}.style_module_legend__75c167f2{width:auto;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-size-legend-font-size);font-family:var(--cosmograph-size-legend-font-family);user-select:none;-webkit-user-select:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.04em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__91eae57a{opacity:1;transform:var(--cosmograph-size-legend-show-transform)}.style_module_disabled__d51f7a10{opacity:0;transform:var(--cosmograph-size-legend-hide-transform);pointer-events:none;display:none!important;min-height:0}@starting-style{.style_module_container__d2889234.style_module_enabled__91eae57a,.style_module_legend__75c167f2.style_module_enabled__91eae57a{opacity:0;transform:var(--cosmograph-size-legend-hide-transform)}}.style_module_legend__75c167f2 .circle{background-color:var(--cosmograph-size-legend-form-color);border-radius:50%;transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2 .line{background-color:var(--cosmograph-size-legend-form-color);border-radius:var(--cosmograph-size-legend-line-radius);width:var(--cosmograph-size-legend-line-width);transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2.style_module_events__894316a8{pointer-events:auto;cursor:pointer}.style_module_legend__75c167f2 .legend-content{display:flex;align-items:end;justify-content:center;gap:.75rem}.style_module_legend__75c167f2 .legend-content>div{transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__75c167f2 .labels-wrapper{white-space:nowrap}.style_module_legend__75c167f2 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-size-legend-items-margin)}.style_module_legend__75c167f2 .name{align-items:center;text-align:center;justify-content:center;display:flex;color:var(--cosmograph-size-legend-font-color);overflow:hidden;width:100%;margin-top:3px;word-break:break-all;white-space:pre-line;transition:color .15s ease-in-out;letter-spacing:-.02em}.style_module_legend__75c167f2 .label{color:var(--cosmograph-size-legend-font-color);overflow:hidden;transition:color .15s ease-in-out;text-overflow:ellipsis;font-feature-settings:"tnum"}.style_module_legend__75c167f2 .sublabel{padding-top:1px;font-size:var(--cosmograph-size-legend-sublabel-font-size);opacity:.5;line-height:1;min-width:10px;transition:color .15s ease-in-out}.style_module_hovered__1206707f .label,.style_module_hovered__1206707f .sublabel{color:var(--cosmograph-size-legend-hover-color);cursor:pointer}.style_module_hovered__1206707f .circle,.style_module_hovered__1206707f .line{background-color:var(--cosmograph-size-legend-hover-color);cursor:pointer}:root{--cosmograph-color-legend-range-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-range-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-range-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-label-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-sublabel-font-size: 10px;--cosmograph-color-legend-range-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-range-gradient-height: 6px;--cosmograph-color-legend-range-gradient-radius: 8px;--cosmograph-color-legend-range-gradient-top-margin: 6px;--cosmograph-color-legend-hide-transform: translateY(100%);--cosmograph-color-legend-show-transform: translateX(0)}.style_module_container__05cc807d{display:flex;min-width:150px;min-height:25px;width:100%;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_legend__a3e235e4{width:100%;font-weight:300;letter-spacing:-.04em;display:flex;flex-direction:column;font-size:var(--cosmograph-color-legend-range-font-size);font-family:var(--cosmograph-color-legend-range-font-family);user-select:none;-webkit-user-select:none;pointer-events:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__b3120e27{opacity:1;transform:var(--cosmograph-color-legend-show-transform);pointer-events:auto}.style_module_disabled__c2dc158c{opacity:0;transform:var(--cosmograph-color-legend-hide-transform);pointer-events:none;display:none;min-height:0}@starting-style{.style_module_container__05cc807d.style_module_enabled__b3120e27,.style_module_legend__a3e235e4.style_module_enabled__b3120e27{opacity:0;transform:var(--cosmograph-color-legend-hide-transform)}}.style_module_legend__a3e235e4 .legend-content{display:flex;align-items:end;justify-content:space-between}.style_module_hovered__dfd7bb2c .label,.style_module_hovered__dfd7bb2c .sublabel{color:var(--cosmograph-size-legend-hover-color)!important;cursor:pointer}.style_module_legend__a3e235e4 .extent{white-space:nowrap;transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__a3e235e4 .gradient{width:100%;margin-top:var(--cosmograph-color-legend-range-gradient-top-margin);height:var(--cosmograph-color-legend-range-gradient-height);border-radius:var(--cosmograph-color-legend-range-gradient-radius)}.style_module_legend__a3e235e4 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-color-legend-range-items-margin)}.style_module_legend__a3e235e4 .name{align-items:center;text-align:center;justify-content:space-around;display:flex;color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;width:100%;word-break:break-word;text-wrap:balance;white-space:pre-line;transition:color .15s ease-in-out;margin:0 4px;letter-spacing:-.02em;line-height:1.25}.style_module_legend__a3e235e4 .label{color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;max-width:150px;text-overflow:ellipsis;font-size:var(--cosmograph-color-legend-range-label-font-size);transition:color .15s ease-in-out;line-height:1;font-feature-settings:"tnum"}.style_module_legend__a3e235e4 .sublabel{padding-top:1px;color:var(--cosmograph-color-legend-range-font-color);opacity:.55;font-size:var(--cosmograph-color-legend-range-sublabel-font-size);line-height:1;transition:color .15s ease-in-out}:root{--cosmograph-color-legend-type-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-type-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-type-font-size: 11px;--cosmograph-color-legend-type-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-type-others-color: #bab0ab;--cosmograph-color-legend-type-bullet-size: 8px;--cosmograph-color-legend-type-bullet-radius: 1rem;--cosmograph-color-legend-type-items-margin: 4px;--cosmograph-color-legend-type-hide-transform: translateY(125%);--cosmograph-color-legend-type-show-transform: translateX(0)}.style_module_enabled__277b2403{opacity:1;transform:var(--cosmograph-color-legend-type-show-transform)}.style_module_disabled__7a587f96{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform);display:none!important;min-height:0}.style_module_wrapper__ea8ca7f4{position:relative;max-width:100%;width:fit-content;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_typeLegend__15bf4b2f{position:relative;width:fit-content;max-width:100%;min-height:25px;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.015em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_typeLegend__15bf4b2f .reverted{flex-direction:row-reverse}.style_module_typeLegend__15bf4b2f .scroll-container{width:100%;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-color-legend-type-font-size);font-family:var(--cosmograph-color-legend-type-font-family);user-select:none;-webkit-user-select:none;line-height:normal;overflow-x:hidden;overflow-y:auto;will-change:transform}@starting-style{.style_module_typeLegend__15bf4b2f.style_module_enabled__277b2403,.style_module_wrapper__ea8ca7f4.style_module_enabled__277b2403{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform)}}.style_module_typeLegend__15bf4b2f .legend-item{display:flex;align-items:center;position:absolute;margin-bottom:var(--cosmograph-color-legend-type-items-margin);pointer-events:none;width:100%;padding-left:1px;font-weight:300;transition:filter .1s ease-in-out,opacity .1s ease-in-out;min-height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px + var(--cosmograph-color-legend-type-items-margin));height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px);box-sizing:border-box}.style_module_typeLegend__15bf4b2f .unknown{background-color:var(--cosmograph-color-legend-type-unknown-color)}.style_module_typeLegend__15bf4b2f .others{background-color:var(--cosmograph-color-legend-type-others-color)}.style_module_typeLegend__15bf4b2f .bullet{height:var(--cosmograph-color-legend-type-bullet-size);width:var(--cosmograph-color-legend-type-bullet-size);min-height:var(--cosmograph-color-legend-type-bullet-size);min-width:var(--cosmograph-color-legend-type-bullet-size);border-radius:var(--cosmograph-color-legend-type-bullet-radius);pointer-events:all;margin-right:5px}.style_module_typeLegend__15bf4b2f .label{color:var(--cosmograph-color-legend-type-font-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - var(--cosmograph-color-legend-type-bullet-size) - 5px);pointer-events:all;transition:.05s linear color}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.bullet{margin-right:0}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.label{margin-right:5px}.style_module_typeLegend__15bf4b2f .show-more{cursor:pointer;padding-top:4px;display:none;font-weight:300;color:var(--cosmograph-color-legend-type-font-color);font-size:11px;opacity:.6;pointer-events:all;justify-content:space-between;transition:opacity .1s linear;font-feature-settings:"tnum"}.style_module_typeLegend__15bf4b2f .show-more:hover{opacity:1}.style_module_hovered__c0993502 .label,.style_module_hovered__c0993502 .sublabel{color:var(--cosmograph-color-legend-type-hover-color)!important;cursor:pointer}.style_module_selected__36e1dd81{filter:brightness(1)}.style_module_selected__36e1dd81>.style_module_label__afecc7a3{filter:brightness(1.2)}.style_module_unselected__4826cfb7{filter:brightness(.5)}.style_module_typeLegend__15bf4b2f .name{font-size:calc(var(--cosmograph-color-legend-type-font-size) + 1px);font-family:var(--cosmograph-color-legend-type-font-family);color:var(--cosmograph-color-legend-type-font-color);transition:color .15s ease-in-out,opacity .3s ease-in-out,max-height .3s ease-in-out,transform .3s ease-in-out;margin-bottom:4px;margin-top:2px;margin-left:1px;letter-spacing:-.02em;line-height:1.25;overflow:hidden;width:100%;white-space:nowrap;text-overflow:ellipsis;pointer-events:all;-webkit-user-select:none!important;user-select:none!important;max-height:100px;opacity:1;transform:translateY(0)}.style_module_typeLegend__15bf4b2f .name.hidden{opacity:0;max-height:0;margin-bottom:0;margin-top:0;transform:translateY(-10px)}:root{--cosmograph-button-color: var(--cosmograph-ui-text);--cosmograph-button-background: var(--cosmograph-ui-element-color);--cosmograph-button-border-radius: 2px}.style_module_button__e95a1138{background:var(--cosmograph-button-background);color:var(--cosmograph-button-color);border-radius:var(--cosmograph-button-border-radius);display:none;align-items:center;justify-content:center;width:25px;height:25px;margin:3px;padding:5px;cursor:pointer;filter:brightness(.95) contrast(.9);transition:filter .1s}.style_module_button__e95a1138:hover{filter:brightness(1.2) contrast(1)}')),document.head.appendChild(i)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();var BW=Object.defineProperty,OW=(i,e,t)=>e in i?BW(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,qu=(i,e,t)=>OW(i,typeof e!="symbol"?e+"":e,t);const Xu={noDataMessage:"No data",loadingMessage:"Data loading...",disableStateMessages:!1,allowPointerEvents:!1};let ei=class{constructor(e,t){qu(this,"_displayStateDiv"),qu(this,"_displayStateTimeout",null),qu(this,"_displayStateConfig"),qu(this,"_displayStateContainerNode"),this._displayStateContainerNode=e,this._displayStateConfig={...Xu,...t},getComputedStyle(e).position==="static"&&(e.style.position="relative"),this._displayStateDiv=this._createDisplayStateElement(),this._displayStateContainerNode.appendChild(this._displayStateDiv)}static extractConfig(e,t){return{noDataMessage:e.noDataMessage??t.noDataMessage,loadingMessage:e.loadingMessage??t.loadingMessage,disableStateMessages:e.disableStateMessages??t.disableStateMessages,allowPointerEvents:e.allowPointerEvents??t.allowPointerEvents}}_createDisplayStateElement(){const e=document.createElement("div");return e.classList.add(NW.displayState),this._displayStateConfig.allowPointerEvents===!1&&(this._displayStateConfig.noDataMessage===!1?this._displayStateContainerNode.style.pointerEvents="none":this._displayStateContainerNode.style.pointerEvents=""),!this._displayStateConfig.disableStateMessages&&this._displayStateConfig.noDataMessage!==!1&&(e.textContent=typeof this._displayStateConfig.noDataMessage=="string"?this._displayStateConfig.noDataMessage:Xu.noDataMessage),e}setLoadingState(){!this._displayStateConfig.disableStateMessages&&this._displayStateConfig.loadingMessage!==!1?this._displayStateDiv.textContent=typeof this._displayStateConfig.loadingMessage=="string"?this._displayStateConfig.loadingMessage:Xu.loadingMessage:this._displayStateDiv.textContent=""}showState(e){this._resetDisplayStateTimeout(),this._displayStateConfig.disableStateMessages?this._displayStateDiv.textContent="":e?this._displayStateDiv.textContent=e:this._displayStateConfig.noDataMessage!==!1?this._displayStateDiv.textContent=typeof this._displayStateConfig.noDataMessage=="string"?this._displayStateConfig.noDataMessage:Xu.noDataMessage:this._displayStateDiv.textContent="",this._displayStateConfig.allowPointerEvents===!1&&(this._displayStateContainerNode.style.pointerEvents="none"),this._displayStateDiv.style.display!=="flex"&&(this._displayStateTimeout=setTimeout(()=>{this._displayStateDiv.style.display="flex"},150))}hideState(){this._resetDisplayStateTimeout(),this._displayStateDiv.style.display="none",this._displayStateContainerNode.style.pointerEvents=""}setDisplayStateConfig(e){this._displayStateConfig={...this._displayStateConfig,...e}}_resetDisplayStateTimeout(){this._displayStateTimeout&&(clearTimeout(this._displayStateTimeout),this._displayStateTimeout=null)}destroy(){var e,t;this._resetDisplayStateTimeout(),(t=(e=this._displayStateDiv)==null?void 0:e.parentNode)==null||t.removeChild(this._displayStateDiv)}};const FW="style_module_timeline__736434f7",zW="style_module_timelineSvg__b916ad04",UW="style_module_selection__ebee57f8",$W="style_module_axisTick__5865631d",VW="style_module_axisLine__992b502d",HW="style_module_bar__114fa79f",GW="style_module_axis__5ff3086c",WW="style_module_bars__097b45e0",jW="style_module_brush__39277182",YW="style_module_animationControl__ee52cd66",qW="style_module_hidden__a73fe81a",XW="style_module_disabled__eb988570",KW="style_module_highlightedBar__c2fc9bdc",ZW="style_module_playAnimation__c1180703",QW="style_module_pauseAnimation__d6cfd97b",qe={timeline:FW,timelineSvg:zW,selection:UW,axisTick:$W,axisLine:VW,bar:HW,axis:GW,bars:WW,brush:jW,animationControl:YW,hidden:qW,disabled:XW,highlightedBar:KW,playAnimation:ZW,pauseAnimation:QW};(function(){try{if(typeof document<"u"){var i=document.createElement("style");i.appendChild(document.createTextNode('@keyframes style_module_fadeIn__ffac87fd{0%{opacity:0}to{opacity:.2}}.style_module_displayState__6ae19b84{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--cosmograph-ui-text);display:flex;justify-content:center;align-items:center;min-width:100px;opacity:.2;font-size:calc(var(--cosmograph-ui-font-size) + 1px);letter-spacing:-.02em;font-weight:200;user-select:none;-webkit-user-select:none;animation:style_module_fadeIn__ffac87fd .3s ease-in-out}:root{--cosmograph-timeline-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-timeline-selection-opacity: .5;--cosmograph-timeline-bar-color: var(--cosmograph-ui-element-color);--cosmograph-timeline-highlighted-bar-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-timeline-font-family: var(--cosmograph-ui-font-family);--cosmograph-timeline-font-size: var(--cosmograph-ui-tick-font-size);--cosmograph-timeline-background: var(--cosmograph-ui-background);--cosmograph-timeline-text-color: var(--cosmograph-ui-text);--cosmograph-timeline-axis-color: var(--cosmograph-ui-text)}.style_module_timeline__736434f7{position:relative;display:flex;background:var(--cosmograph-timeline-background);width:100%;min-height:25px;overflow:hidden}.style_module_timelineSvg__b916ad04{position:relative;width:100%;height:100%}.style_module_selection__ebee57f8{fill:var(--cosmograph-timeline-selection-color);fill-opacity:var(--cosmograph-timeline-selection-opacity);stroke:none}.style_module_axisTick__5865631d{color:var(--cosmograph-timeline-axis-color);font:var(--cosmograph-timeline-font-family);font-size:var(--cosmograph-timeline-font-size);user-select:none;-webkit-user-select:none;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum";alignment-baseline:text-before-edge}.style_module_axisLine__992b502d{opacity:.2;color:var(--cosmograph-timeline-axis-color)}.style_module_bar__114fa79f{fill:var(--cosmograph-timeline-bar-color);transform:scaleY(-1);opacity:0}.style_module_animationControl__ee52cd66{color:var(--cosmograph-timeline-axis-color);width:6%;max-width:30px;min-width:20px;cursor:pointer;display:none;align-items:center;user-select:none;-webkit-user-select:none;opacity:.5;position:relative;justify-content:center}.style_module_animationControl__ee52cd66>svg{width:50%;max-height:20px;padding-right:2px}.style_module_hidden__a73fe81a{display:none}.style_module_disabled__eb988570{opacity:.2;pointer-events:none}.style_module_highlightedBar__c2fc9bdc{fill:var(--cosmograph-timeline-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-search-font-family: var(--cosmograph-ui-font-family);--cosmograph-search-font-size: 14px;--cosmograph-search-list-font-size: 13.5px;--cosmograph-search-text-color: var(--cosmograph-ui-text);--cosmograph-search-background: transparent;--cosmograph-search-list-background: rgba(0, 0, 0, .2);--cosmograph-search-list-match-background: rgba(255, 255, 255, .2);--cosmograph-search-list-match-color: var(--cosmograph-ui-text)}.style_module_searchInput__d7830601:hover{filter:brightness(1.2) contrast(1)}.style_module_searchInput__d7830601{width:100%;background:transparent;color:var(--cosmograph-search-text-color);border:none;border-bottom:.5px solid var(--cosmograph-search-text-color);padding:4px 20px 5px 2px;font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:opacity .2s ease-out}.style_module_searchInput__d7830601::selection{background:var(--cosmograph-search-list-match-background)}.style_module_searchInput__d7830601:focus{outline:none}.style_module_searchSuggestions__b0d3f71e{color:#fff;width:100%;padding:0;margin:0;background:transparent;overflow-y:auto;flex:1;min-height:0}.style_module_searchSuggestions__b0d3f71e li{padding:5px 10px;cursor:pointer;-webkit-user-select:none;user-select:none;display:block;font-weight:500;font-size:var(--cosmograph-search-list-font-size);max-width:100%;overflow:hidden}.style_module_searchSuggestions__b0d3f71e li>div{white-space:nowrap;font-weight:200;overflow:hidden;text-overflow:ellipsis;width:100%}.style_module_searchSuggestions__b0d3f71e li:hover{background:#ffffff1a}.style_module_searchSuggestions__b0d3f71e mark{background:var(--cosmograph-search-list-match-background);color:var(--cosmograph-search-list-match-color);border-radius:2px}.style_module_clearButton__5ebb41de{position:absolute;right:0;top:0;height:100%;background:none;border:none;color:var(--cosmograph-search-text-color);font-weight:300;cursor:pointer;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d{opacity:.7}.style_module_placeholderWrapper__72d5eb0e{z-index:1;color:var(--cosmograph-search-text-color);font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);position:absolute;top:0;left:0;width:100%;bottom:0;display:flex;line-height:1.25;align-items:center;transition:transform .3s ease-out,opacity .3s ease-out}.style_module_placeholderWrapper__72d5eb0e.style_module_hidden__acfb8431{transform:translate(-30px);pointer-events:none;opacity:0}.style_module_searchInput__d7830601:disabled,.style_module_searchInput__d7830601.style_module_disabled__62c35dc5{opacity:.2;cursor:not-allowed;pointer-events:none}.style_module_disabled__62c35dc5 .style_module_clearButton__5ebb41de{display:none}.style_module_disabled__62c35dc5 .style_module_placeholderWrapper__72d5eb0e{opacity:.3;cursor:not-allowed}.style_module_searchInputWrapper__1edbcb22{position:relative;display:flex;width:100%}.style_module_noResults__363397c3{opacity:.3!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none}.style_module_noResults__363397c3:hover{background:none}.style_module_loading__296e0212{opacity:.7!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none;-webkit-user-select:none;user-select:none}.style_module_dropdownContainer__d98287da{position:absolute;top:100%;left:0;width:100%;background:var(--cosmograph-search-list-background);border-radius:4px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);opacity:0;transform:translateY(-10px);transition:opacity .2s ease-out,transform .2s ease-out;pointer-events:none;overflow:hidden;z-index:10;display:flex;flex-direction:column;padding-bottom:2px}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b{top:auto;bottom:100%;transform:translateY(10px)}.style_module_dropdownContainer__d98287da.style_module_visible__5be7493d{opacity:1;transform:translateY(0);pointer-events:auto}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b.style_module_visible__5be7493d{opacity:1;transform:translateY(-2px);pointer-events:auto}.style_module_footerContainer__73e7a066{flex-shrink:0}:root{--cosmograph-scrollbar-background: rgba(255, 255, 255, .1);--cosmograph-ui-background: rgb(45, 49, 58);--cosmograph-ui-text: #ffffffc7;--cosmograph-ui-tick-font-size: 11px;--cosmograph-ui-font-size: 12px;--cosmograph-ui-font-family: inherit;--cosmograph-ui-element-color: #5C616A;--cosmograph-ui-highlighted-element-color: white;--cosmograph-ui-selection-control-color: #8d949ea8;-webkit-font-smoothing:antialiased!important;text-rendering:optimizeLegibility!important}.style_module_cosmograph-ui__5acb97f1{background:var(--cosmograph-ui-background);color:var(--cosmograph-ui-text)}.style_module_scrollbar__f1516254 *::-webkit-scrollbar{width:5px;height:5px;border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-track{border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-corner{background:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-button{display:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-thumb{background-color:var(--cosmograph-scrollbar-background);transition:background-color .5s;border-radius:20px;border:3px solid var(--cosmograph-scrollbar-background)}@-moz-document url-prefix(){.style_module_scrollbar__f1516254 *{scrollbar-width:thin;scrollbar-color:var(--cosmograph-scrollbar-background) transparent;scrollbar-track-color:transparent;scrollbar-face-color:var(--cosmograph-scrollbar-background)}}:root{--cosmograph-histogram-background: var(--cosmograph-ui-background);--cosmograph-histogram-text-color: var(--cosmograph-ui-text);--cosmograph-histogram-axis-color: var(--cosmograph-ui-text);--cosmograph-histogram-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-histogram-selection-opacity: .5;--cosmograph-histogram-bar-color: var(--cosmograph-ui-element-color);--cosmograph-histogram-highlighted-bar-color: var( --cosmograph-ui-highlighted-element-color);--cosmograph-histogram-font-family: var(--cosmograph-ui-font-family);--cosmograph-histogram-font-size: var(--cosmograph-ui-tick-font-size)}.style_module_histogram__9d8a77ea{position:relative;display:flex;min-height:25px;background:var(--cosmograph-histogram-background);width:100%}.style_module_histogramSvg__ccccb628{position:relative;width:100%;height:100%}.style_module_selection__7db96137{fill:var(--cosmograph-histogram-selection-color);fill-opacity:var(--cosmograph-histogram-selection-opacity);stroke:none}.style_module_axisTick__898e1f39{color:var(--cosmograph-histogram-axis-color);font-family:var(--cosmograph-histogram-font-family);font-size:var(--cosmograph-histogram-font-size);user-select:none;-webkit-user-select:none;alignment-baseline:text-before-edge;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum"}.style_module_bar__3c9ab488{fill:var(--cosmograph-histogram-bar-color);transform:scaleY(-1)}.style_module_highlightedBar__b193a8de{fill:var(--cosmograph-histogram-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-bars-font-color: var(--cosmograph-ui-text);--cosmograph-bars-font-family: var(--cosmograph-ui-font-family);--cosmograph-bars-font-size: var(--cosmograph-ui-font-size);--cosmograph-bars-ui-font-size: 11.5px;--cosmograph-bars-background: var(--cosmograph-ui-element-color);--cosmograph-bars-bar-height: 20px;--cosmograph-bars-bar-bottom-margin: 2px;--cosmograph-bars-highlighted-color: var( --cosmograph-ui-highlighted-element-color)}.style_module_bars__25497ded{position:relative;width:100%;min-height:100px;user-select:none;flex-direction:column;-webkit-user-select:none}.style_module_bars__25497ded .scroll-container{position:relative;width:100%;overflow-y:hidden;overflow-x:hidden}.style_module_bars__25497ded .bars-container{position:relative;width:calc(100% - 1px);font-family:var(--cosmograph-bars-font-family)}.style_module_bars__25497ded .highlighted-bars-container{position:absolute;top:0;left:0;pointer-events:none}.style_module_bars__25497ded .row{height:var(--cosmograph-bars-bar-height);display:flex;align-items:center;margin-bottom:var(--cosmograph-bars-bar-bottom-margin);width:100%;transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row:hover{filter:brightness(1.15) contrast(1.05);transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row.unselected:hover{filter:brightness(.95) contrast(1.15);transition:filter .05s linear}.style_module_bars__25497ded .unselected{opacity:.85;filter:brightness(.8) contrast(1.1)}.style_module_bars__25497ded .selected{filter:brightness(1.05) contrast(1.05)}.style_module_bars__25497ded .selected>.info>.label{font-weight:600;filter:brightness(1.1) contrast(1.05)}.style_module_bars__25497ded .unselected>.info>.label{font-weight:300}.style_module_bars__25497ded .bar{height:100%;background-color:var(--cosmograph-bars-background);opacity:.8;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .bar-highlighted{height:100%;background-color:var(--cosmograph-bars-highlighted-color);opacity:.2;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .info{display:flex;justify-content:space-between;width:100%;padding:0 4px;position:absolute;font-size:var(--cosmograph-bars-font-size);font-feature-settings:"tnum";color:var(--cosmograph-bars-font-color);gap:2px}.style_module_bars__25497ded .label{min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:opacity .05s linear}.style_module_bars__25497ded .count{flex-shrink:0;font-weight:300;opacity:.8;transition:opacity .05s linear}.style_module_bars__25497ded .show-more{cursor:pointer;padding-top:2px;display:flex;font-weight:300;color:var(--cosmograph-bars-font-color);font-size:11px;justify-content:space-between;opacity:.6;font-size:var(--cosmograph-bars-ui-font-size);pointer-events:none;transition:opacity .1s linear}.style_module_bars__25497ded .show-more:hover{opacity:1;text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .show-more>span{pointer-events:all}.style_module_bars__25497ded .show-more-count{padding-right:5px;pointer-events:all;font-feature-settings:"tnum"}.style_module_bars__25497ded .unselected>.info>.label,.style_module_bars__25497ded .unselected>.info>.count{opacity:.5}.style_module_bars__25497ded .unselected:hover>.info>.label,.style_module_bars__25497ded .unselected:hover>.info>.count{opacity:1}.style_module_bars__25497ded .search-input{background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,.3);font-size:13px!important;color:var(--cosmograph-bars-font-color);line-height:1.5;padding:2px;width:100%;position:relative;transition:border-bottom-color .2s}.style_module_bars__25497ded .search-input::placeholder{color:var(--cosmograph-bars-font-color)!important;opacity:.4;font-weight:300;font-family:inherit}.style_module_bars__25497ded .search-container{position:relative;width:100%;margin-bottom:4px;display:none;z-index:1}.style_module_bars__25497ded .clear-button{position:absolute;right:0;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--cosmograph-bars-font-color);font-weight:300;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_bars__25497ded .clear-button.visible:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_bars__25497ded .clear-button.visible{opacity:.7}.style_module_bars__25497ded .clear-button svg{width:10px;height:10px;fill:currentColor}.style_module_bars__25497ded .sorting-block{visibility:hidden;margin-top:1px;display:flex;justify-content:space-between}.style_module_bars__25497ded .buttons-container{margin-top:4px;font-size:var(--cosmograph-bars-ui-font-size);display:flex;gap:4px;line-height:1.25}.style_module_bars__25497ded .buttons-container>div{transition:opacity .05s linear,filter .05s linear;padding:1px 5px;background:var(--cosmograph-bars-background);border-radius:4px;opacity:.9;display:flex;cursor:pointer;align-items:center}.style_module_bars__25497ded .buttons-container>div:hover{filter:brightness(1.2)}.style_module_bars__25497ded .reset-text{transition:opacity .05s linear,filter .05s linear;display:flex;font-size:var(--cosmograph-bars-ui-font-size);align-items:end;padding-right:4px;cursor:pointer;font-weight:300}.style_module_bars__25497ded .reset-text:hover{text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .reset-text.unselected{pointer-events:none;cursor:default;opacity:.7}.style_module_bars__25497ded :scope.reset-text:hover:not(.unselected){filter:brightness(1.5);opacity:1}:root{--cosmograph-size-legend-form-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-family: inherit;--cosmograph-size-legend-font-size: var(--cosmograph-ui-font-size);--cosmograph-size-legend-sublabel-font-size: 10px;--cosmograph-size-legend-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-size-legend-line-radius: 2px;--cosmograph-size-legend-line-width: 30px;--cosmograph-size-legend-hide-transform: translateY(100%);--cosmograph-size-legend-show-transform: translateX(0)}.style_module_container__d2889234{display:flex;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;overflow:hidden;min-height:25px}.style_module_legend__75c167f2{width:auto;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-size-legend-font-size);font-family:var(--cosmograph-size-legend-font-family);user-select:none;-webkit-user-select:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.04em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__91eae57a{opacity:1;transform:var(--cosmograph-size-legend-show-transform)}.style_module_disabled__d51f7a10{opacity:0;transform:var(--cosmograph-size-legend-hide-transform);pointer-events:none;display:none!important;min-height:0}@starting-style{.style_module_container__d2889234.style_module_enabled__91eae57a,.style_module_legend__75c167f2.style_module_enabled__91eae57a{opacity:0;transform:var(--cosmograph-size-legend-hide-transform)}}.style_module_legend__75c167f2 .circle{background-color:var(--cosmograph-size-legend-form-color);border-radius:50%;transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2 .line{background-color:var(--cosmograph-size-legend-form-color);border-radius:var(--cosmograph-size-legend-line-radius);width:var(--cosmograph-size-legend-line-width);transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2.style_module_events__894316a8{pointer-events:auto;cursor:pointer}.style_module_legend__75c167f2 .legend-content{display:flex;align-items:end;justify-content:center;gap:.75rem}.style_module_legend__75c167f2 .legend-content>div{transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__75c167f2 .labels-wrapper{white-space:nowrap}.style_module_legend__75c167f2 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-size-legend-items-margin)}.style_module_legend__75c167f2 .name{align-items:center;text-align:center;justify-content:center;display:flex;color:var(--cosmograph-size-legend-font-color);overflow:hidden;width:100%;margin-top:3px;word-break:break-all;white-space:pre-line;transition:color .15s ease-in-out;letter-spacing:-.02em}.style_module_legend__75c167f2 .label{color:var(--cosmograph-size-legend-font-color);overflow:hidden;transition:color .15s ease-in-out;text-overflow:ellipsis;font-feature-settings:"tnum"}.style_module_legend__75c167f2 .sublabel{padding-top:1px;font-size:var(--cosmograph-size-legend-sublabel-font-size);opacity:.5;line-height:1;min-width:10px;transition:color .15s ease-in-out}.style_module_hovered__1206707f .label,.style_module_hovered__1206707f .sublabel{color:var(--cosmograph-size-legend-hover-color);cursor:pointer}.style_module_hovered__1206707f .circle,.style_module_hovered__1206707f .line{background-color:var(--cosmograph-size-legend-hover-color);cursor:pointer}:root{--cosmograph-color-legend-range-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-range-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-range-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-label-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-sublabel-font-size: 10px;--cosmograph-color-legend-range-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-range-gradient-height: 6px;--cosmograph-color-legend-range-gradient-radius: 8px;--cosmograph-color-legend-range-gradient-top-margin: 6px;--cosmograph-color-legend-hide-transform: translateY(100%);--cosmograph-color-legend-show-transform: translateX(0)}.style_module_container__05cc807d{display:flex;min-width:150px;min-height:25px;width:100%;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_legend__a3e235e4{width:100%;font-weight:300;letter-spacing:-.04em;display:flex;flex-direction:column;font-size:var(--cosmograph-color-legend-range-font-size);font-family:var(--cosmograph-color-legend-range-font-family);user-select:none;-webkit-user-select:none;pointer-events:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__b3120e27{opacity:1;transform:var(--cosmograph-color-legend-show-transform);pointer-events:auto}.style_module_disabled__c2dc158c{opacity:0;transform:var(--cosmograph-color-legend-hide-transform);pointer-events:none;display:none;min-height:0}@starting-style{.style_module_container__05cc807d.style_module_enabled__b3120e27,.style_module_legend__a3e235e4.style_module_enabled__b3120e27{opacity:0;transform:var(--cosmograph-color-legend-hide-transform)}}.style_module_legend__a3e235e4 .legend-content{display:flex;align-items:end;justify-content:space-between}.style_module_hovered__dfd7bb2c .label,.style_module_hovered__dfd7bb2c .sublabel{color:var(--cosmograph-size-legend-hover-color)!important;cursor:pointer}.style_module_legend__a3e235e4 .extent{white-space:nowrap;transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__a3e235e4 .gradient{width:100%;margin-top:var(--cosmograph-color-legend-range-gradient-top-margin);height:var(--cosmograph-color-legend-range-gradient-height);border-radius:var(--cosmograph-color-legend-range-gradient-radius)}.style_module_legend__a3e235e4 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-color-legend-range-items-margin)}.style_module_legend__a3e235e4 .name{align-items:center;text-align:center;justify-content:space-around;display:flex;color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;width:100%;word-break:break-word;text-wrap:balance;white-space:pre-line;transition:color .15s ease-in-out;margin:0 4px;letter-spacing:-.02em;line-height:1.25}.style_module_legend__a3e235e4 .label{color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;max-width:150px;text-overflow:ellipsis;font-size:var(--cosmograph-color-legend-range-label-font-size);transition:color .15s ease-in-out;line-height:1;font-feature-settings:"tnum"}.style_module_legend__a3e235e4 .sublabel{padding-top:1px;color:var(--cosmograph-color-legend-range-font-color);opacity:.55;font-size:var(--cosmograph-color-legend-range-sublabel-font-size);line-height:1;transition:color .15s ease-in-out}:root{--cosmograph-color-legend-type-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-type-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-type-font-size: 11px;--cosmograph-color-legend-type-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-type-others-color: #bab0ab;--cosmograph-color-legend-type-bullet-size: 8px;--cosmograph-color-legend-type-bullet-radius: 1rem;--cosmograph-color-legend-type-items-margin: 4px;--cosmograph-color-legend-type-hide-transform: translateY(125%);--cosmograph-color-legend-type-show-transform: translateX(0)}.style_module_enabled__277b2403{opacity:1;transform:var(--cosmograph-color-legend-type-show-transform)}.style_module_disabled__7a587f96{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform);display:none!important;min-height:0}.style_module_wrapper__ea8ca7f4{position:relative;max-width:100%;width:fit-content;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_typeLegend__15bf4b2f{position:relative;width:fit-content;max-width:100%;min-height:25px;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.015em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_typeLegend__15bf4b2f .reverted{flex-direction:row-reverse}.style_module_typeLegend__15bf4b2f .scroll-container{width:100%;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-color-legend-type-font-size);font-family:var(--cosmograph-color-legend-type-font-family);user-select:none;-webkit-user-select:none;line-height:normal;overflow-x:hidden;overflow-y:auto;will-change:transform}@starting-style{.style_module_typeLegend__15bf4b2f.style_module_enabled__277b2403,.style_module_wrapper__ea8ca7f4.style_module_enabled__277b2403{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform)}}.style_module_typeLegend__15bf4b2f .legend-item{display:flex;align-items:center;position:absolute;margin-bottom:var(--cosmograph-color-legend-type-items-margin);pointer-events:none;width:100%;padding-left:1px;font-weight:300;transition:filter .1s ease-in-out,opacity .1s ease-in-out;min-height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px + var(--cosmograph-color-legend-type-items-margin));height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px);box-sizing:border-box}.style_module_typeLegend__15bf4b2f .unknown{background-color:var(--cosmograph-color-legend-type-unknown-color)}.style_module_typeLegend__15bf4b2f .others{background-color:var(--cosmograph-color-legend-type-others-color)}.style_module_typeLegend__15bf4b2f .bullet{height:var(--cosmograph-color-legend-type-bullet-size);width:var(--cosmograph-color-legend-type-bullet-size);min-height:var(--cosmograph-color-legend-type-bullet-size);min-width:var(--cosmograph-color-legend-type-bullet-size);border-radius:var(--cosmograph-color-legend-type-bullet-radius);pointer-events:all;margin-right:5px}.style_module_typeLegend__15bf4b2f .label{color:var(--cosmograph-color-legend-type-font-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - var(--cosmograph-color-legend-type-bullet-size) - 5px);pointer-events:all;transition:.05s linear color}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.bullet{margin-right:0}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.label{margin-right:5px}.style_module_typeLegend__15bf4b2f .show-more{cursor:pointer;padding-top:4px;display:none;font-weight:300;color:var(--cosmograph-color-legend-type-font-color);font-size:11px;opacity:.6;pointer-events:all;justify-content:space-between;transition:opacity .1s linear;font-feature-settings:"tnum"}.style_module_typeLegend__15bf4b2f .show-more:hover{opacity:1}.style_module_hovered__c0993502 .label,.style_module_hovered__c0993502 .sublabel{color:var(--cosmograph-color-legend-type-hover-color)!important;cursor:pointer}.style_module_selected__36e1dd81{filter:brightness(1)}.style_module_selected__36e1dd81>.style_module_label__afecc7a3{filter:brightness(1.2)}.style_module_unselected__4826cfb7{filter:brightness(.5)}.style_module_typeLegend__15bf4b2f .name{font-size:calc(var(--cosmograph-color-legend-type-font-size) + 1px);font-family:var(--cosmograph-color-legend-type-font-family);color:var(--cosmograph-color-legend-type-font-color);transition:color .15s ease-in-out,opacity .3s ease-in-out,max-height .3s ease-in-out,transform .3s ease-in-out;margin-bottom:4px;margin-top:2px;margin-left:1px;letter-spacing:-.02em;line-height:1.25;overflow:hidden;width:100%;white-space:nowrap;text-overflow:ellipsis;pointer-events:all;-webkit-user-select:none!important;user-select:none!important;max-height:100px;opacity:1;transform:translateY(0)}.style_module_typeLegend__15bf4b2f .name.hidden{opacity:0;max-height:0;margin-bottom:0;margin-top:0;transform:translateY(-10px)}:root{--cosmograph-button-color: var(--cosmograph-ui-text);--cosmograph-button-background: var(--cosmograph-ui-element-color);--cosmograph-button-border-radius: 2px}.style_module_button__e95a1138{background:var(--cosmograph-button-background);color:var(--cosmograph-button-color);border-radius:var(--cosmograph-button-border-radius);display:none;align-items:center;justify-content:center;width:25px;height:25px;margin:3px;padding:5px;cursor:pointer;filter:brightness(.95) contrast(.9);transition:filter .1s}.style_module_button__e95a1138:hover{filter:brightness(1.2) contrast(1)}')),document.head.appendChild(i)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();var JW=Object.defineProperty,ej=(i,e,t)=>e in i?JW(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Le=(i,e,t)=>ej(i,typeof e!="symbol"?e+"":e,t);class tj extends ei{constructor(e,t){const n=Ct(Yu,t??{});super(e,ei.extractConfig(n,Yu)),Le(this,"_config"),Le(this,"_animationInterval"),Le(this,"_isAnimationRunning",!1),Le(this,"_svgParser",new DOMParser),Le(this,"_svg"),Le(this,"_animationControlDiv"),Le(this,"_playButtonSvg"),Le(this,"_pauseButtonSvg"),Le(this,"_containerNode"),Le(this,"_axisGroup"),Le(this,"_barsGroup"),Le(this,"_brushGroup"),Le(this,"_highlightedBarsGroup"),Le(this,"_resizeObserver"),Le(this,"_height",0),Le(this,"_width",0),Le(this,"_timelineWidth",0),Le(this,"_timelineHeight",0),Le(this,"_barWidth",0),Le(this,"_maxCount",0),Le(this,"_barsData",[]),Le(this,"_highlightedBarsData",[]),Le(this,"_highlightedData"),Le(this,"_timeData"),Le(this,"_extent"),Le(this,"_bandIntervals",[]),Le(this,"_currentSelection"),Le(this,"_currentSelectionInPixels"),Le(this,"_isNumericTimeline",!1),Le(this,"_firstRender",!0),Le(this,"_yScale",Bf()),Le(this,"_timeScale",hW()),Le(this,"_numScale",Hc()),Le(this,"_activeAxisScale",this._timeScale),Le(this,"_timeAxis",Cg(this._timeScale)),Le(this,"_numAxis",Cg(this._numScale)),Le(this,"_brushInstance"),Le(this,"_toggleAnimation",r=>{r.preventDefault(),this._isAnimationRunning?this.pauseAnimation():this.playAnimation()}),Le(this,"_disableAnimation",()=>{var r,o;this.pauseAnimation(),(r=this._animationControlDiv)==null||r.removeEventListener("click",this._toggleAnimation),(o=this._animationControlDiv)==null||o.remove()}),Le(this,"playAnimation",()=>{var r,o,s,a;clearInterval(this._animationInterval),this._currentSelectionInPixels&&(this._animationInterval=setInterval(this._animateSelection,this._config.animationSpeed??0),this._isAnimationRunning=!0,(o=(r=this._config).onAnimationPlay)==null||o.call(r,this._isAnimationRunning,this._currentSelection),(s=this._pauseButtonSvg)==null||s.classList.remove(qe.hidden),(a=this._playButtonSvg)==null||a.classList.add(qe.hidden))}),Le(this,"pauseAnimation",()=>{var r,o,s,a;clearInterval(this._animationInterval),this._isAnimationRunning=!1,(o=(r=this._config).onAnimationPause)==null||o.call(r,this._isAnimationRunning,this._currentSelection),(s=this._pauseButtonSvg)==null||s.classList.add(qe.hidden),(a=this._playButtonSvg)==null||a.classList.remove(qe.hidden)}),Le(this,"stopAnimation",()=>{var r,o;this.pauseAnimation(),this.setSelection(void 0),(o=(r=this._config).onBrush)==null||o.call(r,void 0)}),Le(this,"_animateSelection",()=>{var r,o,s,a;const l=this._currentSelectionInPixels;l&&l[0]!==void 0&&l[1]!==void 0&&(this._setSelectionInPixels([l[0]+this._barWidth,l[1]+this._barWidth]),(o=(r=this._config).onAnimationTick)==null||o.call(r,this._currentSelection),(l[1]===((s=this._currentSelectionInPixels)==null?void 0:s[1])||((a=this._currentSelectionInPixels)==null?void 0:a[1])===void 0)&&this.stopAnimation())}),Le(this,"destroy",()=>{super.destroy(),this._resizeObserver.disconnect(),this._containerNode.innerHTML="",clearInterval(this._animationInterval)}),this._config=n,this._containerNode=e,this._containerNode.classList.add(qe.timeline),this._animationControlDiv=document.createElement("div"),this._animationControlDiv.classList.add(qe.animationControl),this._containerNode.appendChild(this._animationControlDiv),this._initializeSVG(),this._initializeGroups(),this._initAnimationControls(),this._resizeObserver=new iT(()=>{this.resize()}),this._resizeObserver.observe(this._containerNode)}_initializeSVG(){this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._svg.classList.add(qe.timelineSvg),this._containerNode.appendChild(this._svg)}async _initAnimationControls(){await(async()=>{var e,t;if(!this._animationControlDiv.firstChild){const n=this._svgParser.parseFromString(mW,"image/svg+xml").firstChild,r=this._svgParser.parseFromString(pW,"image/svg+xml").firstChild;this._pauseButtonSvg=(e=this._animationControlDiv)==null?void 0:e.appendChild(r),this._playButtonSvg=(t=this._animationControlDiv)==null?void 0:t.appendChild(n)}})().then(()=>{var e,t,n,r,o;this._isAnimationRunning?((n=this._playButtonSvg)==null||n.classList.add(qe.playAnimation,qe.hidden),(r=this._pauseButtonSvg)==null||r.classList.add(qe.pauseAnimation)):((e=this._playButtonSvg)==null||e.classList.add(qe.playAnimation),(t=this._pauseButtonSvg)==null||t.classList.add(qe.pauseAnimation,qe.hidden)),this._currentSelection||(o=this._animationControlDiv)==null||o.classList.add(qe.disabled),this._animationControlDiv.addEventListener("click",this._toggleAnimation)})}setLoadingState(){super.setLoadingState()}_initializeGroups(){this._axisGroup=Et(this._svg).append("g").attr("class",qe.axis),this._barsGroup=Et(this._svg).append("g").attr("class",qe.bars),this._highlightedBarsGroup=Et(this._svg).append("g").attr("class",qe.bars),this._brushGroup=Et(this._svg).append("g").attr("class",qe.brush)}get _barPadding(){return this._barWidth*(this._config.barPadding??0)}getCurrentSelection(){return this._currentSelection}getCurrentSelectionInPixels(){return this._currentSelectionInPixels}getBarWidth(){return this._barWidth-this._barPadding}getConfig(){return this._config}getIsAnimationRunning(){return this._isAnimationRunning}setConfig(e){var t,n,r,o;const s=JSON.parse(JSON.stringify(this._config));this._config=Ct(Yu,e??{}),this.setDisplayStateConfig(ei.extractConfig(this._config,Yu)),s.formatter!==this._config.formatter&&this._checkFormatter(),(t=this._config)!=null&&t.showAnimationControls?(n=this._animationControlDiv)!=null&&n.isConnected||this._initAnimationControls():this._animationControlDiv&&this._disableAnimation(),this._config.allowSelection||this._disableBrush(),(((r=this._config)==null?void 0:r.dataStep)!==s.dataStep||((o=this._config)==null?void 0:o.barCount)!==s.barCount)&&(this._updateTimelineData(this._timeData),this._updateTimelineData(this._highlightedData,!0)),this.resize()}_checkFormatter(){this._config.formatter?(this._timeAxis.tickFormat(e=>this._config.formatter(e)),this._numAxis.tickFormat(e=>this._config.formatter(e))):this._extent&&(this._timeAxis.tickFormat(e=>U1(e,+this._extent[1]-+this._extent[0],this._isNumericTimeline)),this._numAxis.tickFormat(e=>U1(e,+this._extent[1]-+this._extent[0],this._isNumericTimeline)))}_parseData(e){if(!(e!=null&&e.length))return[];const t=new Float64Array(e.length);let n=0;for(let r=0;r<e.length;r++){const o=e[r];let s;o instanceof Date?s=o.getTime():s=o,s&&!isNaN(s)&&(t[n++]=this._normalizeTimeToMilliseconds(s))}return Array.from(t.subarray(0,n))}setTimeData(e,t){if(this._highlightedBarsData=[],this._timeData=[],this._currentSelection=void 0,t&&t[1]<=t[0])return;if(this._brushCurrentSelection(),e&&e.length>1){const s=e[0],a=s instanceof Date&&!isNaN(s.getTime()),l=typeof s=="number"&&new Date(s).getFullYear()>1970;this._isNumericTimeline=!a&&!l}const n=this._parseData(e),r=t||Yi(n),o=r[0]<r[1]&&n.length>1;Et(this._animationControlDiv).style("display",o?"flex":"none"),o?(this.hideState(),this._timeData=n,this._extent=r,this._firstRender=!0):(this.showState("Empty or invalid timeline data"),this.render()),this._updateTimelineData(this._timeData),this._updateScales(),this.render()}setHighlightedData(e){this._highlightedBarsData=[],this._timeData&&(this._highlightedData=this._parseData(e),this._updateTimelineData(this._highlightedData,!0),this._updateBars(!0))}_updateTimelineData(e=[],t=!1){const n=t?"_highlightedBarsData":"_barsData";if(!this._extent){this[n]=[];return}if(!e.length){this[n]=Zd([],this._bandIntervals,this._currentSelection,t);return}t||this._generateBandIntervals();const r=Zd(e,this._bandIntervals,this._currentSelection,t);this[n]=r,t||(this._maxCount=Math.max(...r.map(o=>o.count)))}_generateBandIntervals(){if(!this._extent)return;const{barCount:e=30,dataStep:t}=this._config;this._bandIntervals=xT(this._extent,e,t)}setSelection(e,t=!1){var n,r,o,s,a,l,c;const u=this._currentSelection;if(e&&this._extent){const h=[Math.max(+this._extent[0],Math.min(+e[0],+this._extent[1])),Math.min(+this._extent[1],Math.max(+e[1],+this._extent[0]))];if(h[0]<h[1]){if(this._config.stickySelection){const d=h.map(this._activeAxisScale);this._mapSelection(d)}else this._currentSelection=h;(n=this._animationControlDiv)==null||n.classList.remove(qe.disabled)}else this._currentSelection=void 0,(r=this._animationControlDiv)==null||r.classList.add(qe.disabled)}else this._currentSelection=void 0,(o=this._animationControlDiv)==null||o.classList.add(qe.disabled);!t&&((u==null?void 0:u[0])!==((s=this._currentSelection)==null?void 0:s[0])||(u==null?void 0:u[1])!==((a=this._currentSelection)==null?void 0:a[1]))&&((c=(l=this._config).onBrush)==null||c.call(l,this._currentSelection,!0)),this._brushCurrentSelection()}_setSelectionInPixels(e){var t,n,r,o,s;if(e){const a=[Math.max(0,Math.min(e[0],this._timelineWidth)),Math.min(this._timelineWidth,Math.max(e[1],0))];a[0]<a[1]?(this._currentSelection=a.map(l=>this._activeAxisScale.invert(l)),(t=this._animationControlDiv)==null||t.classList.remove(qe.disabled)):(this._currentSelection=void 0,(n=this._animationControlDiv)==null||n.classList.add(qe.disabled))}else this._currentSelection=void 0,(r=this._animationControlDiv)==null||r.classList.add(qe.disabled);(s=(o=this._config).onBrush)==null||s.call(o,this._currentSelection),this._brushCurrentSelection()}updateDimensions(){var e,t,n,r;const{height:o,width:s}=vW(this._containerNode),{offsetWidth:a}=this._animationControlDiv;this._width=s,this._height=o,this._timelineWidth=this._width-(((e=this._config.padding)==null?void 0:e.left)??0)-(((t=this._config.padding)==null?void 0:t.right)??0)-a,this._timelineHeight=this._height-(((n=this._config.padding)==null?void 0:n.top)??0)-(((r=this._config.padding)==null?void 0:r.bottom)??0)}resize(){var e,t;this.updateDimensions();const n=((e=this._config.padding)==null?void 0:e.top)??0,r=((t=this._config.padding)==null?void 0:t.bottom)??0;this._timelineHeight>n+r&&(this._updateScales(),this._checkLastTickPosition(),this._currentSelection&&this.setSelection(this._currentSelection,!0),this.render())}render(){if(this._timelineHeight<=0||this._timelineWidth<=0){this._axisGroup.style("display","none");return}this._firstRender&&(this.updateDimensions(),this._updateScales(),this._checkLastTickPosition()),this._updateBrush(),this._updateBars(),this._updateBars(!0),this._updateAxis(),this._firstRender&&(this._firstRender=!1)}_updateAxis(){if(!this._timeData||!this._timeData.length){this._axisGroup.style("display","none");return}const{padding:e,axisTickHeight:t,selectionPadding:n}=this._config;this._axisGroup.style("transform",`translate(${((e==null?void 0:e.left)??0)+1}px, ${((e==null?void 0:e.top)??0)+(t??0)+1+(n??0)/2}px)`).call(this._isNumericTimeline?this._numAxis:this._timeAxis).call(r=>r.select(".domain").remove()),this._axisGroup.selectAll(".tick").select("text").attr("class",qe.axisTick).attr("y",0).attr("dy",-(t??0)).attr("dx","5px"),this._axisGroup.selectAll("line").attr("class",qe.axisLine).attr("y2",-(t??0))}_updateBrush(){if(!this._config.allowSelection||this._timelineHeight<0||this._timelineWidth<0){this._brushGroup.selectAll("*").remove();return}const{selectionPadding:e,padding:t,selectionRadius:n}=this._config,r=this._timelineHeight-(e??0),o=[[0,(e??0)/2],[this._timelineWidth,r+(e??0)/2]];this._brushInstance=nT().extent(o),this._brushInstance.on("end",({selection:s,sourceEvent:a})=>{var l,c,u,h,d,f;a&&(s?(this._config.stickySelection?this._mapSelection(s):this._currentSelection=s.map(p=>this._activeAxisScale.invert(p)),(l=this._animationControlDiv)==null||l.classList.remove(qe.disabled),(u=(c=this._config).onBrush)==null||u.call(c,this._currentSelection)):(this._currentSelection=void 0,(d=(h=this._config).onBrush)==null||d.call(h,void 0),(f=this._animationControlDiv)==null||f.classList.add(qe.disabled)),this._brushCurrentSelection())}),this._brushGroup.style("transform",`translate(${(t==null?void 0:t.left)??0}px, ${(t==null?void 0:t.top)??0}px)`).call(this._brushInstance).call(this._brushInstance.move,this._currentSelectionInPixels||null),this._brushGroup.select("rect.selection").classed(qe.selection,!0).attr("rx",n??0).attr("ry",n??0)}_updateBars(e=!1){const{padding:t,selectionPadding:n}=this._config,r=e?this._highlightedBarsGroup:this._barsGroup;if(!this._timeData||!this._timeData.length){r.selectAll("rect").remove();return}r.style("transform",`translate(${(t==null?void 0:t.left)??0}px, ${((t==null?void 0:t.top)??0)-(n??0)/2}px)`);const o=e?.5:1,s=this._createBars(r,e);!e&&this._config.onBarHover&&s.on("mouseover",a=>{var l,c;return(c=(l=this._config).onBarHover)==null?void 0:c.call(l,a)}),this._animateBars(s,e,o)}_createBars(e,t){return!this._activeAxisScale||!this._yScale||!this._barsData.length?(e.selectAll("rect").remove(),e.selectAll("rect")):e.selectAll(`.${t?qe.highlightedBar:qe.bar}`).data(t?this._highlightedBarsData:this._barsData).join("rect").attr("class",t?qe.highlightedBar:qe.bar).attr("x",n=>this._activeAxisScale(n.rangeStart)+this._barPadding/2).attr("width",this.getBarWidth()).attr("rx",this._config.barRadius??0).attr("ry",this._config.barRadius??0).attr("y",-this._timelineHeight)}_animateBars(e,t,n){e.transition().duration(this._isAnimationRunning?0:300).attr("height",r=>t?r.count===0?0:this._yScale(r.count):this._yScale(r.count)).style("opacity",r=>this._yScale(r.count)===(this._config.minBarHeight??0)?.4:n)}_updateScales(){if(!this._extent||!this._barsData.length||this._timelineHeight<0||this._timelineWidth<0){this._axisGroup.style("display","none");return}this._checkFormatter(),this._axisGroup.style("display","inherit");const e=this._barsData[this._barsData.length-1],t=Math.floor(this._timelineWidth/100),n=this._barsData.map(f=>f.rangeStart);let r;if(n.length>t){const f=Math.ceil(n.length/t);r=n.filter((p,b)=>b%f===0)}else r=n;(this._isNumericTimeline?this._numAxis:this._timeAxis).tickValues(r);const o=Math.max(0,this._maxCount),s=Math.max(0,this._config.minBarHeight??0),a=Math.max(0,this._timelineHeight-(this._config.barTopMargin??0)-(this._config.selectionPadding??0));this._yScale.range([s,a]).domain([0,o]).clamp(!0);const l=[this._extent[0],e.rangeEnd],c=[0,this._timelineWidth],u=this._isNumericTimeline?this._numScale:this._timeScale;u.domain(l),u.range(c),u.clamp(!0),this._activeAxisScale=u;const h=this._barsData[0],d=this._activeAxisScale(h.rangeEnd)-this._activeAxisScale(h.rangeStart);this._barWidth=d}_disableBrush(){var e,t;(e=this._brushInstance)==null||e.clear(this._brushGroup),this._currentSelectionInPixels=void 0,this._currentSelection=void 0,this.pauseAnimation(),this._brushGroup.selectAll("*").remove(),this._config.showAnimationControls&&((t=this._animationControlDiv)==null||t.classList.add(qe.disabled))}_mapSelection(e){if(!this._barsData.length)return;const t=this._activeAxisScale.invert(e[0]),n=this._activeAxisScale.invert(e[1]),r=this._getClosestRange(+t),o=this._getClosestRange(+n,!0);r&&o&&r.rangeStart<=o.rangeEnd&&e[1]-e[0]>this.getBarWidth()/2?this._currentSelection=[r.rangeStart,o.rangeEnd]:this._currentSelection=void 0}_getClosestRange(e,t){return this._barsData.reduce((n,r)=>{const o=t?n.rangeEnd:n.rangeStart,s=t?r.rangeEnd:r.rangeStart;return Math.abs(+s-+e)<Math.abs(+o-+e)?r:n})}_checkLastTickPosition(){var e;const t=this._axisGroup.selectAll(".tick:last-of-type").nodes();if(t!=null&&t.length){const n=t[0],r=n==null?void 0:n.getBoundingClientRect().right,o=(e=this._svg)==null?void 0:e.getBoundingClientRect().right;n.style.display=r>=o?"none":"inherit"}}_brushCurrentSelection(){var e;this._currentSelection?(this._currentSelectionInPixels=this._currentSelection.map(this._activeAxisScale),this._brushInstance&&!this._firstRender&&this._brushGroup.call(this._brushInstance.move,this._currentSelectionInPixels)):(this._currentSelectionInPixels=void 0,(e=this._brushInstance)==null||e.clear(this._brushGroup))}_normalizeTimeToMilliseconds(e){if(e<1e13)return e;const t=10**(Math.floor(Math.log10(e))-12);return Math.round(e/t*1e3)/1e3}}const $1={debounceTime:300,suggestionsLimit:50,maxVisibleItems:10,minSearchLength:2,highlightMatch:!0,disabled:!1,openListUpwards:!1,placeholderRenderer:"Search...",suggestionRenderer:i=>String(i),selectedSuggestionRenderer:i=>String(i),inputClassName:void 0,suggestionListClassName:void 0,searchFn:async()=>[],onEnter:()=>{},onInput:()=>{},onSelect:()=>{},onClear:()=>{},noResultsText:"No results found",footerComponent:void 0},ij="style_module_searchInput__d7830601",nj="style_module_searchSuggestions__b0d3f71e",rj="style_module_clearButton__5ebb41de",oj="style_module_visible__5be7493d",sj="style_module_placeholderWrapper__72d5eb0e",aj="style_module_hidden__acfb8431",lj="style_module_disabled__62c35dc5",cj="style_module_searchInputWrapper__1edbcb22",uj="style_module_noResults__363397c3",hj="style_module_loading__296e0212",dj="style_module_dropdownContainer__d98287da",fj="style_module_upwards__e0b4831b",pj="style_module_footerContainer__73e7a066",ct={searchInput:ij,searchSuggestions:nj,clearButton:rj,visible:oj,placeholderWrapper:sj,hidden:aj,disabled:lj,searchInputWrapper:cj,noResults:uj,loading:hj,dropdownContainer:dj,upwards:fj,footerContainer:pj};(function(){try{if(typeof document<"u"){var i=document.createElement("style");i.appendChild(document.createTextNode('@keyframes style_module_fadeIn__ffac87fd{0%{opacity:0}to{opacity:.2}}.style_module_displayState__6ae19b84{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--cosmograph-ui-text);display:flex;justify-content:center;align-items:center;min-width:100px;opacity:.2;font-size:calc(var(--cosmograph-ui-font-size) + 1px);letter-spacing:-.02em;font-weight:200;user-select:none;-webkit-user-select:none;animation:style_module_fadeIn__ffac87fd .3s ease-in-out}:root{--cosmograph-timeline-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-timeline-selection-opacity: .5;--cosmograph-timeline-bar-color: var(--cosmograph-ui-element-color);--cosmograph-timeline-highlighted-bar-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-timeline-font-family: var(--cosmograph-ui-font-family);--cosmograph-timeline-font-size: var(--cosmograph-ui-tick-font-size);--cosmograph-timeline-background: var(--cosmograph-ui-background);--cosmograph-timeline-text-color: var(--cosmograph-ui-text);--cosmograph-timeline-axis-color: var(--cosmograph-ui-text)}.style_module_timeline__736434f7{position:relative;display:flex;background:var(--cosmograph-timeline-background);width:100%;min-height:25px;overflow:hidden}.style_module_timelineSvg__b916ad04{position:relative;width:100%;height:100%}.style_module_selection__ebee57f8{fill:var(--cosmograph-timeline-selection-color);fill-opacity:var(--cosmograph-timeline-selection-opacity);stroke:none}.style_module_axisTick__5865631d{color:var(--cosmograph-timeline-axis-color);font:var(--cosmograph-timeline-font-family);font-size:var(--cosmograph-timeline-font-size);user-select:none;-webkit-user-select:none;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum";alignment-baseline:text-before-edge}.style_module_axisLine__992b502d{opacity:.2;color:var(--cosmograph-timeline-axis-color)}.style_module_bar__114fa79f{fill:var(--cosmograph-timeline-bar-color);transform:scaleY(-1);opacity:0}.style_module_animationControl__ee52cd66{color:var(--cosmograph-timeline-axis-color);width:6%;max-width:30px;min-width:20px;cursor:pointer;display:none;align-items:center;user-select:none;-webkit-user-select:none;opacity:.5;position:relative;justify-content:center}.style_module_animationControl__ee52cd66>svg{width:50%;max-height:20px;padding-right:2px}.style_module_hidden__a73fe81a{display:none}.style_module_disabled__eb988570{opacity:.2;pointer-events:none}.style_module_highlightedBar__c2fc9bdc{fill:var(--cosmograph-timeline-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-search-font-family: var(--cosmograph-ui-font-family);--cosmograph-search-font-size: 14px;--cosmograph-search-list-font-size: 13.5px;--cosmograph-search-text-color: var(--cosmograph-ui-text);--cosmograph-search-background: transparent;--cosmograph-search-list-background: rgba(0, 0, 0, .2);--cosmograph-search-list-match-background: rgba(255, 255, 255, .2);--cosmograph-search-list-match-color: var(--cosmograph-ui-text)}.style_module_searchInput__d7830601:hover{filter:brightness(1.2) contrast(1)}.style_module_searchInput__d7830601{width:100%;background:transparent;color:var(--cosmograph-search-text-color);border:none;border-bottom:.5px solid var(--cosmograph-search-text-color);padding:4px 20px 5px 2px;font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:opacity .2s ease-out}.style_module_searchInput__d7830601::selection{background:var(--cosmograph-search-list-match-background)}.style_module_searchInput__d7830601:focus{outline:none}.style_module_searchSuggestions__b0d3f71e{color:#fff;width:100%;padding:0;margin:0;background:transparent;overflow-y:auto;flex:1;min-height:0}.style_module_searchSuggestions__b0d3f71e li{padding:5px 10px;cursor:pointer;-webkit-user-select:none;user-select:none;display:block;font-weight:500;font-size:var(--cosmograph-search-list-font-size);max-width:100%;overflow:hidden}.style_module_searchSuggestions__b0d3f71e li>div{white-space:nowrap;font-weight:200;overflow:hidden;text-overflow:ellipsis;width:100%}.style_module_searchSuggestions__b0d3f71e li:hover{background:#ffffff1a}.style_module_searchSuggestions__b0d3f71e mark{background:var(--cosmograph-search-list-match-background);color:var(--cosmograph-search-list-match-color);border-radius:2px}.style_module_clearButton__5ebb41de{position:absolute;right:0;top:0;height:100%;background:none;border:none;color:var(--cosmograph-search-text-color);font-weight:300;cursor:pointer;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d{opacity:.7}.style_module_placeholderWrapper__72d5eb0e{z-index:1;color:var(--cosmograph-search-text-color);font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);position:absolute;top:0;left:0;width:100%;bottom:0;display:flex;line-height:1.25;align-items:center;transition:transform .3s ease-out,opacity .3s ease-out}.style_module_placeholderWrapper__72d5eb0e.style_module_hidden__acfb8431{transform:translate(-30px);pointer-events:none;opacity:0}.style_module_searchInput__d7830601:disabled,.style_module_searchInput__d7830601.style_module_disabled__62c35dc5{opacity:.2;cursor:not-allowed;pointer-events:none}.style_module_disabled__62c35dc5 .style_module_clearButton__5ebb41de{display:none}.style_module_disabled__62c35dc5 .style_module_placeholderWrapper__72d5eb0e{opacity:.3;cursor:not-allowed}.style_module_searchInputWrapper__1edbcb22{position:relative;display:flex;width:100%}.style_module_noResults__363397c3{opacity:.3!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none}.style_module_noResults__363397c3:hover{background:none}.style_module_loading__296e0212{opacity:.7!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none;-webkit-user-select:none;user-select:none}.style_module_dropdownContainer__d98287da{position:absolute;top:100%;left:0;width:100%;background:var(--cosmograph-search-list-background);border-radius:4px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);opacity:0;transform:translateY(-10px);transition:opacity .2s ease-out,transform .2s ease-out;pointer-events:none;overflow:hidden;z-index:10;display:flex;flex-direction:column;padding-bottom:2px}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b{top:auto;bottom:100%;transform:translateY(10px)}.style_module_dropdownContainer__d98287da.style_module_visible__5be7493d{opacity:1;transform:translateY(0);pointer-events:auto}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b.style_module_visible__5be7493d{opacity:1;transform:translateY(-2px);pointer-events:auto}.style_module_footerContainer__73e7a066{flex-shrink:0}:root{--cosmograph-scrollbar-background: rgba(255, 255, 255, .1);--cosmograph-ui-background: rgb(45, 49, 58);--cosmograph-ui-text: #ffffffc7;--cosmograph-ui-tick-font-size: 11px;--cosmograph-ui-font-size: 12px;--cosmograph-ui-font-family: inherit;--cosmograph-ui-element-color: #5C616A;--cosmograph-ui-highlighted-element-color: white;--cosmograph-ui-selection-control-color: #8d949ea8;-webkit-font-smoothing:antialiased!important;text-rendering:optimizeLegibility!important}.style_module_cosmograph-ui__5acb97f1{background:var(--cosmograph-ui-background);color:var(--cosmograph-ui-text)}.style_module_scrollbar__f1516254 *::-webkit-scrollbar{width:5px;height:5px;border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-track{border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-corner{background:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-button{display:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-thumb{background-color:var(--cosmograph-scrollbar-background);transition:background-color .5s;border-radius:20px;border:3px solid var(--cosmograph-scrollbar-background)}@-moz-document url-prefix(){.style_module_scrollbar__f1516254 *{scrollbar-width:thin;scrollbar-color:var(--cosmograph-scrollbar-background) transparent;scrollbar-track-color:transparent;scrollbar-face-color:var(--cosmograph-scrollbar-background)}}:root{--cosmograph-histogram-background: var(--cosmograph-ui-background);--cosmograph-histogram-text-color: var(--cosmograph-ui-text);--cosmograph-histogram-axis-color: var(--cosmograph-ui-text);--cosmograph-histogram-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-histogram-selection-opacity: .5;--cosmograph-histogram-bar-color: var(--cosmograph-ui-element-color);--cosmograph-histogram-highlighted-bar-color: var( --cosmograph-ui-highlighted-element-color);--cosmograph-histogram-font-family: var(--cosmograph-ui-font-family);--cosmograph-histogram-font-size: var(--cosmograph-ui-tick-font-size)}.style_module_histogram__9d8a77ea{position:relative;display:flex;min-height:25px;background:var(--cosmograph-histogram-background);width:100%}.style_module_histogramSvg__ccccb628{position:relative;width:100%;height:100%}.style_module_selection__7db96137{fill:var(--cosmograph-histogram-selection-color);fill-opacity:var(--cosmograph-histogram-selection-opacity);stroke:none}.style_module_axisTick__898e1f39{color:var(--cosmograph-histogram-axis-color);font-family:var(--cosmograph-histogram-font-family);font-size:var(--cosmograph-histogram-font-size);user-select:none;-webkit-user-select:none;alignment-baseline:text-before-edge;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum"}.style_module_bar__3c9ab488{fill:var(--cosmograph-histogram-bar-color);transform:scaleY(-1)}.style_module_highlightedBar__b193a8de{fill:var(--cosmograph-histogram-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-bars-font-color: var(--cosmograph-ui-text);--cosmograph-bars-font-family: var(--cosmograph-ui-font-family);--cosmograph-bars-font-size: var(--cosmograph-ui-font-size);--cosmograph-bars-ui-font-size: 11.5px;--cosmograph-bars-background: var(--cosmograph-ui-element-color);--cosmograph-bars-bar-height: 20px;--cosmograph-bars-bar-bottom-margin: 2px;--cosmograph-bars-highlighted-color: var( --cosmograph-ui-highlighted-element-color)}.style_module_bars__25497ded{position:relative;width:100%;min-height:100px;user-select:none;flex-direction:column;-webkit-user-select:none}.style_module_bars__25497ded .scroll-container{position:relative;width:100%;overflow-y:hidden;overflow-x:hidden}.style_module_bars__25497ded .bars-container{position:relative;width:calc(100% - 1px);font-family:var(--cosmograph-bars-font-family)}.style_module_bars__25497ded .highlighted-bars-container{position:absolute;top:0;left:0;pointer-events:none}.style_module_bars__25497ded .row{height:var(--cosmograph-bars-bar-height);display:flex;align-items:center;margin-bottom:var(--cosmograph-bars-bar-bottom-margin);width:100%;transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row:hover{filter:brightness(1.15) contrast(1.05);transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row.unselected:hover{filter:brightness(.95) contrast(1.15);transition:filter .05s linear}.style_module_bars__25497ded .unselected{opacity:.85;filter:brightness(.8) contrast(1.1)}.style_module_bars__25497ded .selected{filter:brightness(1.05) contrast(1.05)}.style_module_bars__25497ded .selected>.info>.label{font-weight:600;filter:brightness(1.1) contrast(1.05)}.style_module_bars__25497ded .unselected>.info>.label{font-weight:300}.style_module_bars__25497ded .bar{height:100%;background-color:var(--cosmograph-bars-background);opacity:.8;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .bar-highlighted{height:100%;background-color:var(--cosmograph-bars-highlighted-color);opacity:.2;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .info{display:flex;justify-content:space-between;width:100%;padding:0 4px;position:absolute;font-size:var(--cosmograph-bars-font-size);font-feature-settings:"tnum";color:var(--cosmograph-bars-font-color);gap:2px}.style_module_bars__25497ded .label{min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:opacity .05s linear}.style_module_bars__25497ded .count{flex-shrink:0;font-weight:300;opacity:.8;transition:opacity .05s linear}.style_module_bars__25497ded .show-more{cursor:pointer;padding-top:2px;display:flex;font-weight:300;color:var(--cosmograph-bars-font-color);font-size:11px;justify-content:space-between;opacity:.6;font-size:var(--cosmograph-bars-ui-font-size);pointer-events:none;transition:opacity .1s linear}.style_module_bars__25497ded .show-more:hover{opacity:1;text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .show-more>span{pointer-events:all}.style_module_bars__25497ded .show-more-count{padding-right:5px;pointer-events:all;font-feature-settings:"tnum"}.style_module_bars__25497ded .unselected>.info>.label,.style_module_bars__25497ded .unselected>.info>.count{opacity:.5}.style_module_bars__25497ded .unselected:hover>.info>.label,.style_module_bars__25497ded .unselected:hover>.info>.count{opacity:1}.style_module_bars__25497ded .search-input{background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,.3);font-size:13px!important;color:var(--cosmograph-bars-font-color);line-height:1.5;padding:2px;width:100%;position:relative;transition:border-bottom-color .2s}.style_module_bars__25497ded .search-input::placeholder{color:var(--cosmograph-bars-font-color)!important;opacity:.4;font-weight:300;font-family:inherit}.style_module_bars__25497ded .search-container{position:relative;width:100%;margin-bottom:4px;display:none;z-index:1}.style_module_bars__25497ded .clear-button{position:absolute;right:0;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--cosmograph-bars-font-color);font-weight:300;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_bars__25497ded .clear-button.visible:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_bars__25497ded .clear-button.visible{opacity:.7}.style_module_bars__25497ded .clear-button svg{width:10px;height:10px;fill:currentColor}.style_module_bars__25497ded .sorting-block{visibility:hidden;margin-top:1px;display:flex;justify-content:space-between}.style_module_bars__25497ded .buttons-container{margin-top:4px;font-size:var(--cosmograph-bars-ui-font-size);display:flex;gap:4px;line-height:1.25}.style_module_bars__25497ded .buttons-container>div{transition:opacity .05s linear,filter .05s linear;padding:1px 5px;background:var(--cosmograph-bars-background);border-radius:4px;opacity:.9;display:flex;cursor:pointer;align-items:center}.style_module_bars__25497ded .buttons-container>div:hover{filter:brightness(1.2)}.style_module_bars__25497ded .reset-text{transition:opacity .05s linear,filter .05s linear;display:flex;font-size:var(--cosmograph-bars-ui-font-size);align-items:end;padding-right:4px;cursor:pointer;font-weight:300}.style_module_bars__25497ded .reset-text:hover{text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .reset-text.unselected{pointer-events:none;cursor:default;opacity:.7}.style_module_bars__25497ded :scope.reset-text:hover:not(.unselected){filter:brightness(1.5);opacity:1}:root{--cosmograph-size-legend-form-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-family: inherit;--cosmograph-size-legend-font-size: var(--cosmograph-ui-font-size);--cosmograph-size-legend-sublabel-font-size: 10px;--cosmograph-size-legend-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-size-legend-line-radius: 2px;--cosmograph-size-legend-line-width: 30px;--cosmograph-size-legend-hide-transform: translateY(100%);--cosmograph-size-legend-show-transform: translateX(0)}.style_module_container__d2889234{display:flex;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;overflow:hidden;min-height:25px}.style_module_legend__75c167f2{width:auto;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-size-legend-font-size);font-family:var(--cosmograph-size-legend-font-family);user-select:none;-webkit-user-select:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.04em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__91eae57a{opacity:1;transform:var(--cosmograph-size-legend-show-transform)}.style_module_disabled__d51f7a10{opacity:0;transform:var(--cosmograph-size-legend-hide-transform);pointer-events:none;display:none!important;min-height:0}@starting-style{.style_module_container__d2889234.style_module_enabled__91eae57a,.style_module_legend__75c167f2.style_module_enabled__91eae57a{opacity:0;transform:var(--cosmograph-size-legend-hide-transform)}}.style_module_legend__75c167f2 .circle{background-color:var(--cosmograph-size-legend-form-color);border-radius:50%;transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2 .line{background-color:var(--cosmograph-size-legend-form-color);border-radius:var(--cosmograph-size-legend-line-radius);width:var(--cosmograph-size-legend-line-width);transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2.style_module_events__894316a8{pointer-events:auto;cursor:pointer}.style_module_legend__75c167f2 .legend-content{display:flex;align-items:end;justify-content:center;gap:.75rem}.style_module_legend__75c167f2 .legend-content>div{transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__75c167f2 .labels-wrapper{white-space:nowrap}.style_module_legend__75c167f2 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-size-legend-items-margin)}.style_module_legend__75c167f2 .name{align-items:center;text-align:center;justify-content:center;display:flex;color:var(--cosmograph-size-legend-font-color);overflow:hidden;width:100%;margin-top:3px;word-break:break-all;white-space:pre-line;transition:color .15s ease-in-out;letter-spacing:-.02em}.style_module_legend__75c167f2 .label{color:var(--cosmograph-size-legend-font-color);overflow:hidden;transition:color .15s ease-in-out;text-overflow:ellipsis;font-feature-settings:"tnum"}.style_module_legend__75c167f2 .sublabel{padding-top:1px;font-size:var(--cosmograph-size-legend-sublabel-font-size);opacity:.5;line-height:1;min-width:10px;transition:color .15s ease-in-out}.style_module_hovered__1206707f .label,.style_module_hovered__1206707f .sublabel{color:var(--cosmograph-size-legend-hover-color);cursor:pointer}.style_module_hovered__1206707f .circle,.style_module_hovered__1206707f .line{background-color:var(--cosmograph-size-legend-hover-color);cursor:pointer}:root{--cosmograph-color-legend-range-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-range-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-range-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-label-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-sublabel-font-size: 10px;--cosmograph-color-legend-range-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-range-gradient-height: 6px;--cosmograph-color-legend-range-gradient-radius: 8px;--cosmograph-color-legend-range-gradient-top-margin: 6px;--cosmograph-color-legend-hide-transform: translateY(100%);--cosmograph-color-legend-show-transform: translateX(0)}.style_module_container__05cc807d{display:flex;min-width:150px;min-height:25px;width:100%;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_legend__a3e235e4{width:100%;font-weight:300;letter-spacing:-.04em;display:flex;flex-direction:column;font-size:var(--cosmograph-color-legend-range-font-size);font-family:var(--cosmograph-color-legend-range-font-family);user-select:none;-webkit-user-select:none;pointer-events:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__b3120e27{opacity:1;transform:var(--cosmograph-color-legend-show-transform);pointer-events:auto}.style_module_disabled__c2dc158c{opacity:0;transform:var(--cosmograph-color-legend-hide-transform);pointer-events:none;display:none;min-height:0}@starting-style{.style_module_container__05cc807d.style_module_enabled__b3120e27,.style_module_legend__a3e235e4.style_module_enabled__b3120e27{opacity:0;transform:var(--cosmograph-color-legend-hide-transform)}}.style_module_legend__a3e235e4 .legend-content{display:flex;align-items:end;justify-content:space-between}.style_module_hovered__dfd7bb2c .label,.style_module_hovered__dfd7bb2c .sublabel{color:var(--cosmograph-size-legend-hover-color)!important;cursor:pointer}.style_module_legend__a3e235e4 .extent{white-space:nowrap;transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__a3e235e4 .gradient{width:100%;margin-top:var(--cosmograph-color-legend-range-gradient-top-margin);height:var(--cosmograph-color-legend-range-gradient-height);border-radius:var(--cosmograph-color-legend-range-gradient-radius)}.style_module_legend__a3e235e4 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-color-legend-range-items-margin)}.style_module_legend__a3e235e4 .name{align-items:center;text-align:center;justify-content:space-around;display:flex;color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;width:100%;word-break:break-word;text-wrap:balance;white-space:pre-line;transition:color .15s ease-in-out;margin:0 4px;letter-spacing:-.02em;line-height:1.25}.style_module_legend__a3e235e4 .label{color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;max-width:150px;text-overflow:ellipsis;font-size:var(--cosmograph-color-legend-range-label-font-size);transition:color .15s ease-in-out;line-height:1;font-feature-settings:"tnum"}.style_module_legend__a3e235e4 .sublabel{padding-top:1px;color:var(--cosmograph-color-legend-range-font-color);opacity:.55;font-size:var(--cosmograph-color-legend-range-sublabel-font-size);line-height:1;transition:color .15s ease-in-out}:root{--cosmograph-color-legend-type-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-type-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-type-font-size: 11px;--cosmograph-color-legend-type-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-type-others-color: #bab0ab;--cosmograph-color-legend-type-bullet-size: 8px;--cosmograph-color-legend-type-bullet-radius: 1rem;--cosmograph-color-legend-type-items-margin: 4px;--cosmograph-color-legend-type-hide-transform: translateY(125%);--cosmograph-color-legend-type-show-transform: translateX(0)}.style_module_enabled__277b2403{opacity:1;transform:var(--cosmograph-color-legend-type-show-transform)}.style_module_disabled__7a587f96{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform);display:none!important;min-height:0}.style_module_wrapper__ea8ca7f4{position:relative;max-width:100%;width:fit-content;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_typeLegend__15bf4b2f{position:relative;width:fit-content;max-width:100%;min-height:25px;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.015em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_typeLegend__15bf4b2f .reverted{flex-direction:row-reverse}.style_module_typeLegend__15bf4b2f .scroll-container{width:100%;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-color-legend-type-font-size);font-family:var(--cosmograph-color-legend-type-font-family);user-select:none;-webkit-user-select:none;line-height:normal;overflow-x:hidden;overflow-y:auto;will-change:transform}@starting-style{.style_module_typeLegend__15bf4b2f.style_module_enabled__277b2403,.style_module_wrapper__ea8ca7f4.style_module_enabled__277b2403{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform)}}.style_module_typeLegend__15bf4b2f .legend-item{display:flex;align-items:center;position:absolute;margin-bottom:var(--cosmograph-color-legend-type-items-margin);pointer-events:none;width:100%;padding-left:1px;font-weight:300;transition:filter .1s ease-in-out,opacity .1s ease-in-out;min-height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px + var(--cosmograph-color-legend-type-items-margin));height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px);box-sizing:border-box}.style_module_typeLegend__15bf4b2f .unknown{background-color:var(--cosmograph-color-legend-type-unknown-color)}.style_module_typeLegend__15bf4b2f .others{background-color:var(--cosmograph-color-legend-type-others-color)}.style_module_typeLegend__15bf4b2f .bullet{height:var(--cosmograph-color-legend-type-bullet-size);width:var(--cosmograph-color-legend-type-bullet-size);min-height:var(--cosmograph-color-legend-type-bullet-size);min-width:var(--cosmograph-color-legend-type-bullet-size);border-radius:var(--cosmograph-color-legend-type-bullet-radius);pointer-events:all;margin-right:5px}.style_module_typeLegend__15bf4b2f .label{color:var(--cosmograph-color-legend-type-font-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - var(--cosmograph-color-legend-type-bullet-size) - 5px);pointer-events:all;transition:.05s linear color}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.bullet{margin-right:0}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.label{margin-right:5px}.style_module_typeLegend__15bf4b2f .show-more{cursor:pointer;padding-top:4px;display:none;font-weight:300;color:var(--cosmograph-color-legend-type-font-color);font-size:11px;opacity:.6;pointer-events:all;justify-content:space-between;transition:opacity .1s linear;font-feature-settings:"tnum"}.style_module_typeLegend__15bf4b2f .show-more:hover{opacity:1}.style_module_hovered__c0993502 .label,.style_module_hovered__c0993502 .sublabel{color:var(--cosmograph-color-legend-type-hover-color)!important;cursor:pointer}.style_module_selected__36e1dd81{filter:brightness(1)}.style_module_selected__36e1dd81>.style_module_label__afecc7a3{filter:brightness(1.2)}.style_module_unselected__4826cfb7{filter:brightness(.5)}.style_module_typeLegend__15bf4b2f .name{font-size:calc(var(--cosmograph-color-legend-type-font-size) + 1px);font-family:var(--cosmograph-color-legend-type-font-family);color:var(--cosmograph-color-legend-type-font-color);transition:color .15s ease-in-out,opacity .3s ease-in-out,max-height .3s ease-in-out,transform .3s ease-in-out;margin-bottom:4px;margin-top:2px;margin-left:1px;letter-spacing:-.02em;line-height:1.25;overflow:hidden;width:100%;white-space:nowrap;text-overflow:ellipsis;pointer-events:all;-webkit-user-select:none!important;user-select:none!important;max-height:100px;opacity:1;transform:translateY(0)}.style_module_typeLegend__15bf4b2f .name.hidden{opacity:0;max-height:0;margin-bottom:0;margin-top:0;transform:translateY(-10px)}:root{--cosmograph-button-color: var(--cosmograph-ui-text);--cosmograph-button-background: var(--cosmograph-ui-element-color);--cosmograph-button-border-radius: 2px}.style_module_button__e95a1138{background:var(--cosmograph-button-background);color:var(--cosmograph-button-color);border-radius:var(--cosmograph-button-border-radius);display:none;align-items:center;justify-content:center;width:25px;height:25px;margin:3px;padding:5px;cursor:pointer;filter:brightness(.95) contrast(.9);transition:filter .1s}.style_module_button__e95a1138:hover{filter:brightness(1.2) contrast(1)}')),document.head.appendChild(i)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();const mj="style_module_scrollbar__f1516254",db={scrollbar:mj};(function(){try{if(typeof document<"u"){var i=document.createElement("style");i.appendChild(document.createTextNode('@keyframes style_module_fadeIn__ffac87fd{0%{opacity:0}to{opacity:.2}}.style_module_displayState__6ae19b84{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--cosmograph-ui-text);display:flex;justify-content:center;align-items:center;min-width:100px;opacity:.2;font-size:calc(var(--cosmograph-ui-font-size) + 1px);letter-spacing:-.02em;font-weight:200;user-select:none;-webkit-user-select:none;animation:style_module_fadeIn__ffac87fd .3s ease-in-out}:root{--cosmograph-timeline-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-timeline-selection-opacity: .5;--cosmograph-timeline-bar-color: var(--cosmograph-ui-element-color);--cosmograph-timeline-highlighted-bar-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-timeline-font-family: var(--cosmograph-ui-font-family);--cosmograph-timeline-font-size: var(--cosmograph-ui-tick-font-size);--cosmograph-timeline-background: var(--cosmograph-ui-background);--cosmograph-timeline-text-color: var(--cosmograph-ui-text);--cosmograph-timeline-axis-color: var(--cosmograph-ui-text)}.style_module_timeline__736434f7{position:relative;display:flex;background:var(--cosmograph-timeline-background);width:100%;min-height:25px;overflow:hidden}.style_module_timelineSvg__b916ad04{position:relative;width:100%;height:100%}.style_module_selection__ebee57f8{fill:var(--cosmograph-timeline-selection-color);fill-opacity:var(--cosmograph-timeline-selection-opacity);stroke:none}.style_module_axisTick__5865631d{color:var(--cosmograph-timeline-axis-color);font:var(--cosmograph-timeline-font-family);font-size:var(--cosmograph-timeline-font-size);user-select:none;-webkit-user-select:none;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum";alignment-baseline:text-before-edge}.style_module_axisLine__992b502d{opacity:.2;color:var(--cosmograph-timeline-axis-color)}.style_module_bar__114fa79f{fill:var(--cosmograph-timeline-bar-color);transform:scaleY(-1);opacity:0}.style_module_animationControl__ee52cd66{color:var(--cosmograph-timeline-axis-color);width:6%;max-width:30px;min-width:20px;cursor:pointer;display:none;align-items:center;user-select:none;-webkit-user-select:none;opacity:.5;position:relative;justify-content:center}.style_module_animationControl__ee52cd66>svg{width:50%;max-height:20px;padding-right:2px}.style_module_hidden__a73fe81a{display:none}.style_module_disabled__eb988570{opacity:.2;pointer-events:none}.style_module_highlightedBar__c2fc9bdc{fill:var(--cosmograph-timeline-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-search-font-family: var(--cosmograph-ui-font-family);--cosmograph-search-font-size: 14px;--cosmograph-search-list-font-size: 13.5px;--cosmograph-search-text-color: var(--cosmograph-ui-text);--cosmograph-search-background: transparent;--cosmograph-search-list-background: rgba(0, 0, 0, .2);--cosmograph-search-list-match-background: rgba(255, 255, 255, .2);--cosmograph-search-list-match-color: var(--cosmograph-ui-text)}.style_module_searchInput__d7830601:hover{filter:brightness(1.2) contrast(1)}.style_module_searchInput__d7830601{width:100%;background:transparent;color:var(--cosmograph-search-text-color);border:none;border-bottom:.5px solid var(--cosmograph-search-text-color);padding:4px 20px 5px 2px;font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:opacity .2s ease-out}.style_module_searchInput__d7830601::selection{background:var(--cosmograph-search-list-match-background)}.style_module_searchInput__d7830601:focus{outline:none}.style_module_searchSuggestions__b0d3f71e{color:#fff;width:100%;padding:0;margin:0;background:transparent;overflow-y:auto;flex:1;min-height:0}.style_module_searchSuggestions__b0d3f71e li{padding:5px 10px;cursor:pointer;-webkit-user-select:none;user-select:none;display:block;font-weight:500;font-size:var(--cosmograph-search-list-font-size);max-width:100%;overflow:hidden}.style_module_searchSuggestions__b0d3f71e li>div{white-space:nowrap;font-weight:200;overflow:hidden;text-overflow:ellipsis;width:100%}.style_module_searchSuggestions__b0d3f71e li:hover{background:#ffffff1a}.style_module_searchSuggestions__b0d3f71e mark{background:var(--cosmograph-search-list-match-background);color:var(--cosmograph-search-list-match-color);border-radius:2px}.style_module_clearButton__5ebb41de{position:absolute;right:0;top:0;height:100%;background:none;border:none;color:var(--cosmograph-search-text-color);font-weight:300;cursor:pointer;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d{opacity:.7}.style_module_placeholderWrapper__72d5eb0e{z-index:1;color:var(--cosmograph-search-text-color);font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);position:absolute;top:0;left:0;width:100%;bottom:0;display:flex;line-height:1.25;align-items:center;transition:transform .3s ease-out,opacity .3s ease-out}.style_module_placeholderWrapper__72d5eb0e.style_module_hidden__acfb8431{transform:translate(-30px);pointer-events:none;opacity:0}.style_module_searchInput__d7830601:disabled,.style_module_searchInput__d7830601.style_module_disabled__62c35dc5{opacity:.2;cursor:not-allowed;pointer-events:none}.style_module_disabled__62c35dc5 .style_module_clearButton__5ebb41de{display:none}.style_module_disabled__62c35dc5 .style_module_placeholderWrapper__72d5eb0e{opacity:.3;cursor:not-allowed}.style_module_searchInputWrapper__1edbcb22{position:relative;display:flex;width:100%}.style_module_noResults__363397c3{opacity:.3!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none}.style_module_noResults__363397c3:hover{background:none}.style_module_loading__296e0212{opacity:.7!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none;-webkit-user-select:none;user-select:none}.style_module_dropdownContainer__d98287da{position:absolute;top:100%;left:0;width:100%;background:var(--cosmograph-search-list-background);border-radius:4px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);opacity:0;transform:translateY(-10px);transition:opacity .2s ease-out,transform .2s ease-out;pointer-events:none;overflow:hidden;z-index:10;display:flex;flex-direction:column;padding-bottom:2px}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b{top:auto;bottom:100%;transform:translateY(10px)}.style_module_dropdownContainer__d98287da.style_module_visible__5be7493d{opacity:1;transform:translateY(0);pointer-events:auto}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b.style_module_visible__5be7493d{opacity:1;transform:translateY(-2px);pointer-events:auto}.style_module_footerContainer__73e7a066{flex-shrink:0}:root{--cosmograph-scrollbar-background: rgba(255, 255, 255, .1);--cosmograph-ui-background: rgb(45, 49, 58);--cosmograph-ui-text: #ffffffc7;--cosmograph-ui-tick-font-size: 11px;--cosmograph-ui-font-size: 12px;--cosmograph-ui-font-family: inherit;--cosmograph-ui-element-color: #5C616A;--cosmograph-ui-highlighted-element-color: white;--cosmograph-ui-selection-control-color: #8d949ea8;-webkit-font-smoothing:antialiased!important;text-rendering:optimizeLegibility!important}.style_module_cosmograph-ui__5acb97f1{background:var(--cosmograph-ui-background);color:var(--cosmograph-ui-text)}.style_module_scrollbar__f1516254 *::-webkit-scrollbar{width:5px;height:5px;border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-track{border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-corner{background:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-button{display:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-thumb{background-color:var(--cosmograph-scrollbar-background);transition:background-color .5s;border-radius:20px;border:3px solid var(--cosmograph-scrollbar-background)}@-moz-document url-prefix(){.style_module_scrollbar__f1516254 *{scrollbar-width:thin;scrollbar-color:var(--cosmograph-scrollbar-background) transparent;scrollbar-track-color:transparent;scrollbar-face-color:var(--cosmograph-scrollbar-background)}}:root{--cosmograph-histogram-background: var(--cosmograph-ui-background);--cosmograph-histogram-text-color: var(--cosmograph-ui-text);--cosmograph-histogram-axis-color: var(--cosmograph-ui-text);--cosmograph-histogram-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-histogram-selection-opacity: .5;--cosmograph-histogram-bar-color: var(--cosmograph-ui-element-color);--cosmograph-histogram-highlighted-bar-color: var( --cosmograph-ui-highlighted-element-color);--cosmograph-histogram-font-family: var(--cosmograph-ui-font-family);--cosmograph-histogram-font-size: var(--cosmograph-ui-tick-font-size)}.style_module_histogram__9d8a77ea{position:relative;display:flex;min-height:25px;background:var(--cosmograph-histogram-background);width:100%}.style_module_histogramSvg__ccccb628{position:relative;width:100%;height:100%}.style_module_selection__7db96137{fill:var(--cosmograph-histogram-selection-color);fill-opacity:var(--cosmograph-histogram-selection-opacity);stroke:none}.style_module_axisTick__898e1f39{color:var(--cosmograph-histogram-axis-color);font-family:var(--cosmograph-histogram-font-family);font-size:var(--cosmograph-histogram-font-size);user-select:none;-webkit-user-select:none;alignment-baseline:text-before-edge;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum"}.style_module_bar__3c9ab488{fill:var(--cosmograph-histogram-bar-color);transform:scaleY(-1)}.style_module_highlightedBar__b193a8de{fill:var(--cosmograph-histogram-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-bars-font-color: var(--cosmograph-ui-text);--cosmograph-bars-font-family: var(--cosmograph-ui-font-family);--cosmograph-bars-font-size: var(--cosmograph-ui-font-size);--cosmograph-bars-ui-font-size: 11.5px;--cosmograph-bars-background: var(--cosmograph-ui-element-color);--cosmograph-bars-bar-height: 20px;--cosmograph-bars-bar-bottom-margin: 2px;--cosmograph-bars-highlighted-color: var( --cosmograph-ui-highlighted-element-color)}.style_module_bars__25497ded{position:relative;width:100%;min-height:100px;user-select:none;flex-direction:column;-webkit-user-select:none}.style_module_bars__25497ded .scroll-container{position:relative;width:100%;overflow-y:hidden;overflow-x:hidden}.style_module_bars__25497ded .bars-container{position:relative;width:calc(100% - 1px);font-family:var(--cosmograph-bars-font-family)}.style_module_bars__25497ded .highlighted-bars-container{position:absolute;top:0;left:0;pointer-events:none}.style_module_bars__25497ded .row{height:var(--cosmograph-bars-bar-height);display:flex;align-items:center;margin-bottom:var(--cosmograph-bars-bar-bottom-margin);width:100%;transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row:hover{filter:brightness(1.15) contrast(1.05);transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row.unselected:hover{filter:brightness(.95) contrast(1.15);transition:filter .05s linear}.style_module_bars__25497ded .unselected{opacity:.85;filter:brightness(.8) contrast(1.1)}.style_module_bars__25497ded .selected{filter:brightness(1.05) contrast(1.05)}.style_module_bars__25497ded .selected>.info>.label{font-weight:600;filter:brightness(1.1) contrast(1.05)}.style_module_bars__25497ded .unselected>.info>.label{font-weight:300}.style_module_bars__25497ded .bar{height:100%;background-color:var(--cosmograph-bars-background);opacity:.8;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .bar-highlighted{height:100%;background-color:var(--cosmograph-bars-highlighted-color);opacity:.2;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .info{display:flex;justify-content:space-between;width:100%;padding:0 4px;position:absolute;font-size:var(--cosmograph-bars-font-size);font-feature-settings:"tnum";color:var(--cosmograph-bars-font-color);gap:2px}.style_module_bars__25497ded .label{min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:opacity .05s linear}.style_module_bars__25497ded .count{flex-shrink:0;font-weight:300;opacity:.8;transition:opacity .05s linear}.style_module_bars__25497ded .show-more{cursor:pointer;padding-top:2px;display:flex;font-weight:300;color:var(--cosmograph-bars-font-color);font-size:11px;justify-content:space-between;opacity:.6;font-size:var(--cosmograph-bars-ui-font-size);pointer-events:none;transition:opacity .1s linear}.style_module_bars__25497ded .show-more:hover{opacity:1;text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .show-more>span{pointer-events:all}.style_module_bars__25497ded .show-more-count{padding-right:5px;pointer-events:all;font-feature-settings:"tnum"}.style_module_bars__25497ded .unselected>.info>.label,.style_module_bars__25497ded .unselected>.info>.count{opacity:.5}.style_module_bars__25497ded .unselected:hover>.info>.label,.style_module_bars__25497ded .unselected:hover>.info>.count{opacity:1}.style_module_bars__25497ded .search-input{background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,.3);font-size:13px!important;color:var(--cosmograph-bars-font-color);line-height:1.5;padding:2px;width:100%;position:relative;transition:border-bottom-color .2s}.style_module_bars__25497ded .search-input::placeholder{color:var(--cosmograph-bars-font-color)!important;opacity:.4;font-weight:300;font-family:inherit}.style_module_bars__25497ded .search-container{position:relative;width:100%;margin-bottom:4px;display:none;z-index:1}.style_module_bars__25497ded .clear-button{position:absolute;right:0;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--cosmograph-bars-font-color);font-weight:300;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_bars__25497ded .clear-button.visible:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_bars__25497ded .clear-button.visible{opacity:.7}.style_module_bars__25497ded .clear-button svg{width:10px;height:10px;fill:currentColor}.style_module_bars__25497ded .sorting-block{visibility:hidden;margin-top:1px;display:flex;justify-content:space-between}.style_module_bars__25497ded .buttons-container{margin-top:4px;font-size:var(--cosmograph-bars-ui-font-size);display:flex;gap:4px;line-height:1.25}.style_module_bars__25497ded .buttons-container>div{transition:opacity .05s linear,filter .05s linear;padding:1px 5px;background:var(--cosmograph-bars-background);border-radius:4px;opacity:.9;display:flex;cursor:pointer;align-items:center}.style_module_bars__25497ded .buttons-container>div:hover{filter:brightness(1.2)}.style_module_bars__25497ded .reset-text{transition:opacity .05s linear,filter .05s linear;display:flex;font-size:var(--cosmograph-bars-ui-font-size);align-items:end;padding-right:4px;cursor:pointer;font-weight:300}.style_module_bars__25497ded .reset-text:hover{text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .reset-text.unselected{pointer-events:none;cursor:default;opacity:.7}.style_module_bars__25497ded :scope.reset-text:hover:not(.unselected){filter:brightness(1.5);opacity:1}:root{--cosmograph-size-legend-form-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-family: inherit;--cosmograph-size-legend-font-size: var(--cosmograph-ui-font-size);--cosmograph-size-legend-sublabel-font-size: 10px;--cosmograph-size-legend-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-size-legend-line-radius: 2px;--cosmograph-size-legend-line-width: 30px;--cosmograph-size-legend-hide-transform: translateY(100%);--cosmograph-size-legend-show-transform: translateX(0)}.style_module_container__d2889234{display:flex;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;overflow:hidden;min-height:25px}.style_module_legend__75c167f2{width:auto;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-size-legend-font-size);font-family:var(--cosmograph-size-legend-font-family);user-select:none;-webkit-user-select:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.04em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__91eae57a{opacity:1;transform:var(--cosmograph-size-legend-show-transform)}.style_module_disabled__d51f7a10{opacity:0;transform:var(--cosmograph-size-legend-hide-transform);pointer-events:none;display:none!important;min-height:0}@starting-style{.style_module_container__d2889234.style_module_enabled__91eae57a,.style_module_legend__75c167f2.style_module_enabled__91eae57a{opacity:0;transform:var(--cosmograph-size-legend-hide-transform)}}.style_module_legend__75c167f2 .circle{background-color:var(--cosmograph-size-legend-form-color);border-radius:50%;transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2 .line{background-color:var(--cosmograph-size-legend-form-color);border-radius:var(--cosmograph-size-legend-line-radius);width:var(--cosmograph-size-legend-line-width);transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2.style_module_events__894316a8{pointer-events:auto;cursor:pointer}.style_module_legend__75c167f2 .legend-content{display:flex;align-items:end;justify-content:center;gap:.75rem}.style_module_legend__75c167f2 .legend-content>div{transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__75c167f2 .labels-wrapper{white-space:nowrap}.style_module_legend__75c167f2 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-size-legend-items-margin)}.style_module_legend__75c167f2 .name{align-items:center;text-align:center;justify-content:center;display:flex;color:var(--cosmograph-size-legend-font-color);overflow:hidden;width:100%;margin-top:3px;word-break:break-all;white-space:pre-line;transition:color .15s ease-in-out;letter-spacing:-.02em}.style_module_legend__75c167f2 .label{color:var(--cosmograph-size-legend-font-color);overflow:hidden;transition:color .15s ease-in-out;text-overflow:ellipsis;font-feature-settings:"tnum"}.style_module_legend__75c167f2 .sublabel{padding-top:1px;font-size:var(--cosmograph-size-legend-sublabel-font-size);opacity:.5;line-height:1;min-width:10px;transition:color .15s ease-in-out}.style_module_hovered__1206707f .label,.style_module_hovered__1206707f .sublabel{color:var(--cosmograph-size-legend-hover-color);cursor:pointer}.style_module_hovered__1206707f .circle,.style_module_hovered__1206707f .line{background-color:var(--cosmograph-size-legend-hover-color);cursor:pointer}:root{--cosmograph-color-legend-range-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-range-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-range-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-label-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-sublabel-font-size: 10px;--cosmograph-color-legend-range-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-range-gradient-height: 6px;--cosmograph-color-legend-range-gradient-radius: 8px;--cosmograph-color-legend-range-gradient-top-margin: 6px;--cosmograph-color-legend-hide-transform: translateY(100%);--cosmograph-color-legend-show-transform: translateX(0)}.style_module_container__05cc807d{display:flex;min-width:150px;min-height:25px;width:100%;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_legend__a3e235e4{width:100%;font-weight:300;letter-spacing:-.04em;display:flex;flex-direction:column;font-size:var(--cosmograph-color-legend-range-font-size);font-family:var(--cosmograph-color-legend-range-font-family);user-select:none;-webkit-user-select:none;pointer-events:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__b3120e27{opacity:1;transform:var(--cosmograph-color-legend-show-transform);pointer-events:auto}.style_module_disabled__c2dc158c{opacity:0;transform:var(--cosmograph-color-legend-hide-transform);pointer-events:none;display:none;min-height:0}@starting-style{.style_module_container__05cc807d.style_module_enabled__b3120e27,.style_module_legend__a3e235e4.style_module_enabled__b3120e27{opacity:0;transform:var(--cosmograph-color-legend-hide-transform)}}.style_module_legend__a3e235e4 .legend-content{display:flex;align-items:end;justify-content:space-between}.style_module_hovered__dfd7bb2c .label,.style_module_hovered__dfd7bb2c .sublabel{color:var(--cosmograph-size-legend-hover-color)!important;cursor:pointer}.style_module_legend__a3e235e4 .extent{white-space:nowrap;transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__a3e235e4 .gradient{width:100%;margin-top:var(--cosmograph-color-legend-range-gradient-top-margin);height:var(--cosmograph-color-legend-range-gradient-height);border-radius:var(--cosmograph-color-legend-range-gradient-radius)}.style_module_legend__a3e235e4 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-color-legend-range-items-margin)}.style_module_legend__a3e235e4 .name{align-items:center;text-align:center;justify-content:space-around;display:flex;color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;width:100%;word-break:break-word;text-wrap:balance;white-space:pre-line;transition:color .15s ease-in-out;margin:0 4px;letter-spacing:-.02em;line-height:1.25}.style_module_legend__a3e235e4 .label{color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;max-width:150px;text-overflow:ellipsis;font-size:var(--cosmograph-color-legend-range-label-font-size);transition:color .15s ease-in-out;line-height:1;font-feature-settings:"tnum"}.style_module_legend__a3e235e4 .sublabel{padding-top:1px;color:var(--cosmograph-color-legend-range-font-color);opacity:.55;font-size:var(--cosmograph-color-legend-range-sublabel-font-size);line-height:1;transition:color .15s ease-in-out}:root{--cosmograph-color-legend-type-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-type-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-type-font-size: 11px;--cosmograph-color-legend-type-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-type-others-color: #bab0ab;--cosmograph-color-legend-type-bullet-size: 8px;--cosmograph-color-legend-type-bullet-radius: 1rem;--cosmograph-color-legend-type-items-margin: 4px;--cosmograph-color-legend-type-hide-transform: translateY(125%);--cosmograph-color-legend-type-show-transform: translateX(0)}.style_module_enabled__277b2403{opacity:1;transform:var(--cosmograph-color-legend-type-show-transform)}.style_module_disabled__7a587f96{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform);display:none!important;min-height:0}.style_module_wrapper__ea8ca7f4{position:relative;max-width:100%;width:fit-content;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_typeLegend__15bf4b2f{position:relative;width:fit-content;max-width:100%;min-height:25px;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.015em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_typeLegend__15bf4b2f .reverted{flex-direction:row-reverse}.style_module_typeLegend__15bf4b2f .scroll-container{width:100%;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-color-legend-type-font-size);font-family:var(--cosmograph-color-legend-type-font-family);user-select:none;-webkit-user-select:none;line-height:normal;overflow-x:hidden;overflow-y:auto;will-change:transform}@starting-style{.style_module_typeLegend__15bf4b2f.style_module_enabled__277b2403,.style_module_wrapper__ea8ca7f4.style_module_enabled__277b2403{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform)}}.style_module_typeLegend__15bf4b2f .legend-item{display:flex;align-items:center;position:absolute;margin-bottom:var(--cosmograph-color-legend-type-items-margin);pointer-events:none;width:100%;padding-left:1px;font-weight:300;transition:filter .1s ease-in-out,opacity .1s ease-in-out;min-height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px + var(--cosmograph-color-legend-type-items-margin));height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px);box-sizing:border-box}.style_module_typeLegend__15bf4b2f .unknown{background-color:var(--cosmograph-color-legend-type-unknown-color)}.style_module_typeLegend__15bf4b2f .others{background-color:var(--cosmograph-color-legend-type-others-color)}.style_module_typeLegend__15bf4b2f .bullet{height:var(--cosmograph-color-legend-type-bullet-size);width:var(--cosmograph-color-legend-type-bullet-size);min-height:var(--cosmograph-color-legend-type-bullet-size);min-width:var(--cosmograph-color-legend-type-bullet-size);border-radius:var(--cosmograph-color-legend-type-bullet-radius);pointer-events:all;margin-right:5px}.style_module_typeLegend__15bf4b2f .label{color:var(--cosmograph-color-legend-type-font-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - var(--cosmograph-color-legend-type-bullet-size) - 5px);pointer-events:all;transition:.05s linear color}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.bullet{margin-right:0}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.label{margin-right:5px}.style_module_typeLegend__15bf4b2f .show-more{cursor:pointer;padding-top:4px;display:none;font-weight:300;color:var(--cosmograph-color-legend-type-font-color);font-size:11px;opacity:.6;pointer-events:all;justify-content:space-between;transition:opacity .1s linear;font-feature-settings:"tnum"}.style_module_typeLegend__15bf4b2f .show-more:hover{opacity:1}.style_module_hovered__c0993502 .label,.style_module_hovered__c0993502 .sublabel{color:var(--cosmograph-color-legend-type-hover-color)!important;cursor:pointer}.style_module_selected__36e1dd81{filter:brightness(1)}.style_module_selected__36e1dd81>.style_module_label__afecc7a3{filter:brightness(1.2)}.style_module_unselected__4826cfb7{filter:brightness(.5)}.style_module_typeLegend__15bf4b2f .name{font-size:calc(var(--cosmograph-color-legend-type-font-size) + 1px);font-family:var(--cosmograph-color-legend-type-font-family);color:var(--cosmograph-color-legend-type-font-color);transition:color .15s ease-in-out,opacity .3s ease-in-out,max-height .3s ease-in-out,transform .3s ease-in-out;margin-bottom:4px;margin-top:2px;margin-left:1px;letter-spacing:-.02em;line-height:1.25;overflow:hidden;width:100%;white-space:nowrap;text-overflow:ellipsis;pointer-events:all;-webkit-user-select:none!important;user-select:none!important;max-height:100px;opacity:1;transform:translateY(0)}.style_module_typeLegend__15bf4b2f .name.hidden{opacity:0;max-height:0;margin-bottom:0;margin-top:0;transform:translateY(-10px)}:root{--cosmograph-button-color: var(--cosmograph-ui-text);--cosmograph-button-background: var(--cosmograph-ui-element-color);--cosmograph-button-border-radius: 2px}.style_module_button__e95a1138{background:var(--cosmograph-button-background);color:var(--cosmograph-button-color);border-radius:var(--cosmograph-button-border-radius);display:none;align-items:center;justify-content:center;width:25px;height:25px;margin:3px;padding:5px;cursor:pointer;filter:brightness(.95) contrast(.9);transition:filter .1s}.style_module_button__e95a1138:hover{filter:brightness(1.2) contrast(1)}')),document.head.appendChild(i)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();var gj=Object.defineProperty,_j=(i,e,t)=>e in i?gj(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Qi=(i,e,t)=>_j(i,typeof e!="symbol"?e+"":e,t);let yj=class{constructor(e,t){Qi(this,"_container"),Qi(this,"_inputElement"),Qi(this,"_suggestionList"),Qi(this,"_dropdownContainer"),Qi(this,"_footerContainer",null),Qi(this,"_clearButton"),Qi(this,"_config"),Qi(this,"_debounceTimeout"),Qi(this,"_placeholderElement",null),Qi(this,"_handleFocus"),Qi(this,"_handleBlur"),Qi(this,"_handleClearClick"),Qi(this,"_handleMouseDown"),this._container=e,this._container.classList.add(db.scrollbar),this._config=Ct($1,t??{});const n=document.createElement("div");n.className=ct.searchInputWrapper,this._container.appendChild(n),this._inputElement=document.createElement("input"),this._inputElement.className=this._config.inputClassName??ct.searchInput,n.appendChild(this._inputElement),this._createPlaceholderElement(),this._handleFocus=()=>this._updatePlaceholderVisibility(),this._handleBlur=()=>this._updatePlaceholderVisibility(),this._handleClearClick=()=>this.clearInput(),this._inputElement.addEventListener("focus",this._handleFocus),this._inputElement.addEventListener("blur",this._handleBlur),this._clearButton=document.createElement("button"),this._clearButton.className=ct.clearButton,this._clearButton.innerHTML="",this._clearButton.addEventListener("click",this._handleClearClick),n.appendChild(this._clearButton),this._dropdownContainer=document.createElement("div"),this._dropdownContainer.className=ct.dropdownContainer,this._config.openListUpwards&&this._dropdownContainer.classList.add(ct.upwards),n.appendChild(this._dropdownContainer),this._suggestionList=document.createElement("ul"),this._suggestionList.classList.add(this._config.suggestionListClassName??ct.searchSuggestions),this._dropdownContainer.appendChild(this._suggestionList),this._footerContainer=document.createElement("div"),this._footerContainer.className=ct.footerContainer,this._dropdownContainer.appendChild(this._footerContainer),this._handleKeyDown=this._handleKeyDown.bind(this),this._handleInput=this._handleInput.bind(this),this._inputElement.addEventListener("input",this._handleInput),this._inputElement.addEventListener("keydown",this._handleKeyDown),this._config.disabled&&this.setDisabled(!0)}get suggestionList(){return this._suggestionList}get dropdownContainer(){return this._dropdownContainer}_handleInput(e){if(this._config.disabled)return;const t=this._inputElement.value;t?this._clearButton.classList.add(ct.visible):this._clearButton.classList.remove(ct.visible),this._updatePlaceholderVisibility(),this._debounceTimeout&&window.clearTimeout(this._debounceTimeout),t.length>=(this._config.minSearchLength??0)&&this._renderLoading(),this._debounceTimeout=window.setTimeout(async()=>{const n=await this._performSearch(t);this._config.onInput&&this._config.onInput(t,n,e),this._renderSuggestions(n)},this._config.debounceTime??300)}async _handleKeyDown(e){if(!this._config.disabled&&e.key==="Enter"){const t=this._inputElement.value;this._renderLoading();const n=await this._performSearch(t);this._config.onEnter&&this._config.onEnter(t,n),this._renderSuggestions(n)}}_createPlaceholderElement(){var e;if(this._config.placeholderRenderer){const t=this._config.placeholderRenderer;t instanceof HTMLElement?(this._placeholderElement=document.createElement("div"),this._placeholderElement.className=ct.placeholderWrapper,this._handleMouseDown=n=>{if(this._config.disabled){n.preventDefault();return}let r=n.target;for(;r&&r!==this._placeholderElement;){if(r.dataset.ignoreFocus==="true"){n.preventDefault();return}r=r.parentElement}},this._placeholderElement.addEventListener("mousedown",this._handleMouseDown),this._placeholderElement.appendChild(t),(e=this._inputElement.parentNode)==null||e.insertBefore(this._placeholderElement,this._inputElement)):this._inputElement.placeholder=t}this._updatePlaceholderVisibility()}_updatePlaceholderVisibility(){this._placeholderElement&&(this._inputElement.value||document.activeElement===this._inputElement?this._placeholderElement.classList.add(ct.hidden):this._placeholderElement.classList.remove(ct.hidden))}_createSuggestionElement(e){var t,n;const r=document.createElement("li"),o=document.createElement("div"),s=((n=(t=this._config).suggestionRenderer)==null?void 0:n.call(t,e,this._inputElement.value))??String(e);return typeof s=="string"?(o.title=s,o.innerHTML=this._config.highlightMatch?this.getHighlightedMatch(s):s):o.appendChild(s),r.appendChild(o),r}_renderSuggestions(e){this._suggestionList.innerHTML="";const t=this._config.maxVisibleItems&&e.length>this._config.maxVisibleItems;if(this._suggestionList.style.overflowY=t?"auto":"",e.length>0){const r=this._createSuggestionElement(e[0]);this._suggestionList.appendChild(r);const o=r.offsetHeight;if(this._suggestionList.removeChild(r),this._config.maxVisibleItems&&o>0){const s=o*this._config.maxVisibleItems,a=window.innerHeight*.6;this._suggestionList.style.maxHeight=`${Math.min(s,a)}px`}}const n=this._inputElement.value.length>=(this._config.minSearchLength??0);if(e.forEach(r=>{const o=this._createSuggestionElement(r);o.addEventListener("click",()=>this._handleSuggestionClick(r)),this._suggestionList.appendChild(o)}),e.length===0&&this._config.noResultsText&&n){const r=document.createElement("li");r.className=ct.noResults,r.textContent=this._config.noResultsText,this._suggestionList.appendChild(r)}this._footerContainer&&(this._footerContainer.innerHTML="",this._config.footerComponent&&n&&e.length>0&&this._footerContainer.appendChild(this._config.footerComponent)),e.length>0||this._config.noResultsText&&n?this._dropdownContainer.classList.add(ct.visible):this._dropdownContainer.classList.remove(ct.visible)}_renderLoading(){if(!(this._inputElement.value.length>=(this._config.minSearchLength??0)))return;this._suggestionList.innerHTML="";const e=document.createElement("li");e.className=ct.loading,e.textContent="Searching",this._suggestionList.appendChild(e),this._footerContainer&&(this._footerContainer.innerHTML=""),this._dropdownContainer.classList.add(ct.visible)}_handleSuggestionClick(e){var t,n;this._config.disabled||(this._config.onSelect&&this._config.onSelect(e),this._inputElement.value=((n=(t=this._config).selectedSuggestionRenderer)==null?void 0:n.call(t,e,this._inputElement.value))??String(e),this._updatePlaceholderVisibility(),this._clearButton.classList.add(ct.visible),this._suggestionList.innerHTML="",this._footerContainer&&(this._footerContainer.innerHTML=""),this._dropdownContainer.classList.remove(ct.visible))}async _performSearch(e){let t=[];return this._config.searchFn&&e.length>=(this._config.minSearchLength??0)&&(t=await this._config.searchFn(e,this._config.suggestionsLimit)),t}getHighlightedMatch(e){if(!this._config.highlightMatch||!this._inputElement.value)return e;const t=this._inputElement.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),n=new RegExp(`(${t})`,"gi");return e.replace(n,"<mark>$1</mark>")}setDisabled(e){var t;e?(this._inputElement.disabled=!0,this._inputElement.value="",(t=this._placeholderElement)==null||t.classList.remove(ct.hidden),this._clearButton.classList.remove(ct.visible),this._container.classList.add(ct.disabled),this._dropdownContainer.classList.remove(ct.visible)):(this._inputElement.disabled=!1,this._container.classList.remove(ct.disabled)),this._config.disabled=e}isDisabled(){return!!this._config.disabled}setConfig(e){const t=this._config.openListUpwards;this._config=Ct($1,e??{}),this.setDisabled(!!this._config.disabled),t!==this._config.openListUpwards&&(this._config.openListUpwards?this._dropdownContainer.classList.add(ct.upwards):this._dropdownContainer.classList.remove(ct.upwards))}destroy(){var e;this._inputElement.removeEventListener("input",this._handleInput),this._inputElement.removeEventListener("keydown",this._handleKeyDown),this._inputElement.removeEventListener("focus",this._handleFocus),this._inputElement.removeEventListener("blur",this._handleBlur),this._clearButton.removeEventListener("click",this._handleClearClick),this._placeholderElement&&this._handleMouseDown&&((e=this._placeholderElement)==null||e.removeEventListener("mousedown",this._handleMouseDown)),this._container.innerHTML=""}clearInput(){if(this._config.disabled)return;const e=!!this._inputElement.value;this._inputElement.value="",this._suggestionList.innerHTML="",this._footerContainer&&(this._footerContainer.innerHTML=""),this._dropdownContainer.classList.remove(ct.visible),this._clearButton.classList.remove(ct.visible),this._updatePlaceholderVisibility(),e&&this._config.onClear&&this._config.onClear()}hideSuggestions(){this._suggestionList.innerHTML="",this._footerContainer&&(this._footerContainer.innerHTML=""),this._dropdownContainer.classList.remove(ct.visible)}focus(){this._inputElement.focus()}blur(){this._inputElement.blur()}};const bj={top:5,left:5,bottom:1,right:5},CT=30,Ku={padding:bj,barPadding:.1,minBarHeight:2,selectionRadius:3,selectionPadding:8,barCount:CT,dataStep:void 0,barRadius:1,barTopMargin:7,labelSideMargin:3,formatter:Wn,allowSelection:!0,stickySelection:!0,onBrush:void 0,onBarHover:void 0,noDataMessage:"No histogram data",loadingMessage:"Data loading..."},vj="style_module_histogram__9d8a77ea",xj="style_module_histogramSvg__ccccb628",wj="style_module_selection__7db96137",Sj="style_module_axisTick__898e1f39",Ej="style_module_bar__3c9ab488",Cj="style_module_highlightedBar__b193a8de",Tj="style_module_axis__e37d2f53",Aj="style_module_bars__cf3a511f",Ij="style_module_brush__5a0c1368",pn={histogram:vj,histogramSvg:xj,selection:wj,axisTick:Sj,bar:Ej,highlightedBar:Cj,axis:Tj,bars:Aj,brush:Ij};(function(){try{if(typeof document<"u"){var i=document.createElement("style");i.appendChild(document.createTextNode('@keyframes style_module_fadeIn__ffac87fd{0%{opacity:0}to{opacity:.2}}.style_module_displayState__6ae19b84{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--cosmograph-ui-text);display:flex;justify-content:center;align-items:center;min-width:100px;opacity:.2;font-size:calc(var(--cosmograph-ui-font-size) + 1px);letter-spacing:-.02em;font-weight:200;user-select:none;-webkit-user-select:none;animation:style_module_fadeIn__ffac87fd .3s ease-in-out}:root{--cosmograph-timeline-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-timeline-selection-opacity: .5;--cosmograph-timeline-bar-color: var(--cosmograph-ui-element-color);--cosmograph-timeline-highlighted-bar-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-timeline-font-family: var(--cosmograph-ui-font-family);--cosmograph-timeline-font-size: var(--cosmograph-ui-tick-font-size);--cosmograph-timeline-background: var(--cosmograph-ui-background);--cosmograph-timeline-text-color: var(--cosmograph-ui-text);--cosmograph-timeline-axis-color: var(--cosmograph-ui-text)}.style_module_timeline__736434f7{position:relative;display:flex;background:var(--cosmograph-timeline-background);width:100%;min-height:25px;overflow:hidden}.style_module_timelineSvg__b916ad04{position:relative;width:100%;height:100%}.style_module_selection__ebee57f8{fill:var(--cosmograph-timeline-selection-color);fill-opacity:var(--cosmograph-timeline-selection-opacity);stroke:none}.style_module_axisTick__5865631d{color:var(--cosmograph-timeline-axis-color);font:var(--cosmograph-timeline-font-family);font-size:var(--cosmograph-timeline-font-size);user-select:none;-webkit-user-select:none;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum";alignment-baseline:text-before-edge}.style_module_axisLine__992b502d{opacity:.2;color:var(--cosmograph-timeline-axis-color)}.style_module_bar__114fa79f{fill:var(--cosmograph-timeline-bar-color);transform:scaleY(-1);opacity:0}.style_module_animationControl__ee52cd66{color:var(--cosmograph-timeline-axis-color);width:6%;max-width:30px;min-width:20px;cursor:pointer;display:none;align-items:center;user-select:none;-webkit-user-select:none;opacity:.5;position:relative;justify-content:center}.style_module_animationControl__ee52cd66>svg{width:50%;max-height:20px;padding-right:2px}.style_module_hidden__a73fe81a{display:none}.style_module_disabled__eb988570{opacity:.2;pointer-events:none}.style_module_highlightedBar__c2fc9bdc{fill:var(--cosmograph-timeline-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-search-font-family: var(--cosmograph-ui-font-family);--cosmograph-search-font-size: 14px;--cosmograph-search-list-font-size: 13.5px;--cosmograph-search-text-color: var(--cosmograph-ui-text);--cosmograph-search-background: transparent;--cosmograph-search-list-background: rgba(0, 0, 0, .2);--cosmograph-search-list-match-background: rgba(255, 255, 255, .2);--cosmograph-search-list-match-color: var(--cosmograph-ui-text)}.style_module_searchInput__d7830601:hover{filter:brightness(1.2) contrast(1)}.style_module_searchInput__d7830601{width:100%;background:transparent;color:var(--cosmograph-search-text-color);border:none;border-bottom:.5px solid var(--cosmograph-search-text-color);padding:4px 20px 5px 2px;font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:opacity .2s ease-out}.style_module_searchInput__d7830601::selection{background:var(--cosmograph-search-list-match-background)}.style_module_searchInput__d7830601:focus{outline:none}.style_module_searchSuggestions__b0d3f71e{color:#fff;width:100%;padding:0;margin:0;background:transparent;overflow-y:auto;flex:1;min-height:0}.style_module_searchSuggestions__b0d3f71e li{padding:5px 10px;cursor:pointer;-webkit-user-select:none;user-select:none;display:block;font-weight:500;font-size:var(--cosmograph-search-list-font-size);max-width:100%;overflow:hidden}.style_module_searchSuggestions__b0d3f71e li>div{white-space:nowrap;font-weight:200;overflow:hidden;text-overflow:ellipsis;width:100%}.style_module_searchSuggestions__b0d3f71e li:hover{background:#ffffff1a}.style_module_searchSuggestions__b0d3f71e mark{background:var(--cosmograph-search-list-match-background);color:var(--cosmograph-search-list-match-color);border-radius:2px}.style_module_clearButton__5ebb41de{position:absolute;right:0;top:0;height:100%;background:none;border:none;color:var(--cosmograph-search-text-color);font-weight:300;cursor:pointer;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d{opacity:.7}.style_module_placeholderWrapper__72d5eb0e{z-index:1;color:var(--cosmograph-search-text-color);font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);position:absolute;top:0;left:0;width:100%;bottom:0;display:flex;line-height:1.25;align-items:center;transition:transform .3s ease-out,opacity .3s ease-out}.style_module_placeholderWrapper__72d5eb0e.style_module_hidden__acfb8431{transform:translate(-30px);pointer-events:none;opacity:0}.style_module_searchInput__d7830601:disabled,.style_module_searchInput__d7830601.style_module_disabled__62c35dc5{opacity:.2;cursor:not-allowed;pointer-events:none}.style_module_disabled__62c35dc5 .style_module_clearButton__5ebb41de{display:none}.style_module_disabled__62c35dc5 .style_module_placeholderWrapper__72d5eb0e{opacity:.3;cursor:not-allowed}.style_module_searchInputWrapper__1edbcb22{position:relative;display:flex;width:100%}.style_module_noResults__363397c3{opacity:.3!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none}.style_module_noResults__363397c3:hover{background:none}.style_module_loading__296e0212{opacity:.7!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none;-webkit-user-select:none;user-select:none}.style_module_dropdownContainer__d98287da{position:absolute;top:100%;left:0;width:100%;background:var(--cosmograph-search-list-background);border-radius:4px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);opacity:0;transform:translateY(-10px);transition:opacity .2s ease-out,transform .2s ease-out;pointer-events:none;overflow:hidden;z-index:10;display:flex;flex-direction:column;padding-bottom:2px}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b{top:auto;bottom:100%;transform:translateY(10px)}.style_module_dropdownContainer__d98287da.style_module_visible__5be7493d{opacity:1;transform:translateY(0);pointer-events:auto}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b.style_module_visible__5be7493d{opacity:1;transform:translateY(-2px);pointer-events:auto}.style_module_footerContainer__73e7a066{flex-shrink:0}:root{--cosmograph-scrollbar-background: rgba(255, 255, 255, .1);--cosmograph-ui-background: rgb(45, 49, 58);--cosmograph-ui-text: #ffffffc7;--cosmograph-ui-tick-font-size: 11px;--cosmograph-ui-font-size: 12px;--cosmograph-ui-font-family: inherit;--cosmograph-ui-element-color: #5C616A;--cosmograph-ui-highlighted-element-color: white;--cosmograph-ui-selection-control-color: #8d949ea8;-webkit-font-smoothing:antialiased!important;text-rendering:optimizeLegibility!important}.style_module_cosmograph-ui__5acb97f1{background:var(--cosmograph-ui-background);color:var(--cosmograph-ui-text)}.style_module_scrollbar__f1516254 *::-webkit-scrollbar{width:5px;height:5px;border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-track{border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-corner{background:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-button{display:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-thumb{background-color:var(--cosmograph-scrollbar-background);transition:background-color .5s;border-radius:20px;border:3px solid var(--cosmograph-scrollbar-background)}@-moz-document url-prefix(){.style_module_scrollbar__f1516254 *{scrollbar-width:thin;scrollbar-color:var(--cosmograph-scrollbar-background) transparent;scrollbar-track-color:transparent;scrollbar-face-color:var(--cosmograph-scrollbar-background)}}:root{--cosmograph-histogram-background: var(--cosmograph-ui-background);--cosmograph-histogram-text-color: var(--cosmograph-ui-text);--cosmograph-histogram-axis-color: var(--cosmograph-ui-text);--cosmograph-histogram-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-histogram-selection-opacity: .5;--cosmograph-histogram-bar-color: var(--cosmograph-ui-element-color);--cosmograph-histogram-highlighted-bar-color: var( --cosmograph-ui-highlighted-element-color);--cosmograph-histogram-font-family: var(--cosmograph-ui-font-family);--cosmograph-histogram-font-size: var(--cosmograph-ui-tick-font-size)}.style_module_histogram__9d8a77ea{position:relative;display:flex;min-height:25px;background:var(--cosmograph-histogram-background);width:100%}.style_module_histogramSvg__ccccb628{position:relative;width:100%;height:100%}.style_module_selection__7db96137{fill:var(--cosmograph-histogram-selection-color);fill-opacity:var(--cosmograph-histogram-selection-opacity);stroke:none}.style_module_axisTick__898e1f39{color:var(--cosmograph-histogram-axis-color);font-family:var(--cosmograph-histogram-font-family);font-size:var(--cosmograph-histogram-font-size);user-select:none;-webkit-user-select:none;alignment-baseline:text-before-edge;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum"}.style_module_bar__3c9ab488{fill:var(--cosmograph-histogram-bar-color);transform:scaleY(-1)}.style_module_highlightedBar__b193a8de{fill:var(--cosmograph-histogram-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-bars-font-color: var(--cosmograph-ui-text);--cosmograph-bars-font-family: var(--cosmograph-ui-font-family);--cosmograph-bars-font-size: var(--cosmograph-ui-font-size);--cosmograph-bars-ui-font-size: 11.5px;--cosmograph-bars-background: var(--cosmograph-ui-element-color);--cosmograph-bars-bar-height: 20px;--cosmograph-bars-bar-bottom-margin: 2px;--cosmograph-bars-highlighted-color: var( --cosmograph-ui-highlighted-element-color)}.style_module_bars__25497ded{position:relative;width:100%;min-height:100px;user-select:none;flex-direction:column;-webkit-user-select:none}.style_module_bars__25497ded .scroll-container{position:relative;width:100%;overflow-y:hidden;overflow-x:hidden}.style_module_bars__25497ded .bars-container{position:relative;width:calc(100% - 1px);font-family:var(--cosmograph-bars-font-family)}.style_module_bars__25497ded .highlighted-bars-container{position:absolute;top:0;left:0;pointer-events:none}.style_module_bars__25497ded .row{height:var(--cosmograph-bars-bar-height);display:flex;align-items:center;margin-bottom:var(--cosmograph-bars-bar-bottom-margin);width:100%;transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row:hover{filter:brightness(1.15) contrast(1.05);transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row.unselected:hover{filter:brightness(.95) contrast(1.15);transition:filter .05s linear}.style_module_bars__25497ded .unselected{opacity:.85;filter:brightness(.8) contrast(1.1)}.style_module_bars__25497ded .selected{filter:brightness(1.05) contrast(1.05)}.style_module_bars__25497ded .selected>.info>.label{font-weight:600;filter:brightness(1.1) contrast(1.05)}.style_module_bars__25497ded .unselected>.info>.label{font-weight:300}.style_module_bars__25497ded .bar{height:100%;background-color:var(--cosmograph-bars-background);opacity:.8;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .bar-highlighted{height:100%;background-color:var(--cosmograph-bars-highlighted-color);opacity:.2;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .info{display:flex;justify-content:space-between;width:100%;padding:0 4px;position:absolute;font-size:var(--cosmograph-bars-font-size);font-feature-settings:"tnum";color:var(--cosmograph-bars-font-color);gap:2px}.style_module_bars__25497ded .label{min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:opacity .05s linear}.style_module_bars__25497ded .count{flex-shrink:0;font-weight:300;opacity:.8;transition:opacity .05s linear}.style_module_bars__25497ded .show-more{cursor:pointer;padding-top:2px;display:flex;font-weight:300;color:var(--cosmograph-bars-font-color);font-size:11px;justify-content:space-between;opacity:.6;font-size:var(--cosmograph-bars-ui-font-size);pointer-events:none;transition:opacity .1s linear}.style_module_bars__25497ded .show-more:hover{opacity:1;text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .show-more>span{pointer-events:all}.style_module_bars__25497ded .show-more-count{padding-right:5px;pointer-events:all;font-feature-settings:"tnum"}.style_module_bars__25497ded .unselected>.info>.label,.style_module_bars__25497ded .unselected>.info>.count{opacity:.5}.style_module_bars__25497ded .unselected:hover>.info>.label,.style_module_bars__25497ded .unselected:hover>.info>.count{opacity:1}.style_module_bars__25497ded .search-input{background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,.3);font-size:13px!important;color:var(--cosmograph-bars-font-color);line-height:1.5;padding:2px;width:100%;position:relative;transition:border-bottom-color .2s}.style_module_bars__25497ded .search-input::placeholder{color:var(--cosmograph-bars-font-color)!important;opacity:.4;font-weight:300;font-family:inherit}.style_module_bars__25497ded .search-container{position:relative;width:100%;margin-bottom:4px;display:none;z-index:1}.style_module_bars__25497ded .clear-button{position:absolute;right:0;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--cosmograph-bars-font-color);font-weight:300;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_bars__25497ded .clear-button.visible:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_bars__25497ded .clear-button.visible{opacity:.7}.style_module_bars__25497ded .clear-button svg{width:10px;height:10px;fill:currentColor}.style_module_bars__25497ded .sorting-block{visibility:hidden;margin-top:1px;display:flex;justify-content:space-between}.style_module_bars__25497ded .buttons-container{margin-top:4px;font-size:var(--cosmograph-bars-ui-font-size);display:flex;gap:4px;line-height:1.25}.style_module_bars__25497ded .buttons-container>div{transition:opacity .05s linear,filter .05s linear;padding:1px 5px;background:var(--cosmograph-bars-background);border-radius:4px;opacity:.9;display:flex;cursor:pointer;align-items:center}.style_module_bars__25497ded .buttons-container>div:hover{filter:brightness(1.2)}.style_module_bars__25497ded .reset-text{transition:opacity .05s linear,filter .05s linear;display:flex;font-size:var(--cosmograph-bars-ui-font-size);align-items:end;padding-right:4px;cursor:pointer;font-weight:300}.style_module_bars__25497ded .reset-text:hover{text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .reset-text.unselected{pointer-events:none;cursor:default;opacity:.7}.style_module_bars__25497ded :scope.reset-text:hover:not(.unselected){filter:brightness(1.5);opacity:1}:root{--cosmograph-size-legend-form-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-family: inherit;--cosmograph-size-legend-font-size: var(--cosmograph-ui-font-size);--cosmograph-size-legend-sublabel-font-size: 10px;--cosmograph-size-legend-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-size-legend-line-radius: 2px;--cosmograph-size-legend-line-width: 30px;--cosmograph-size-legend-hide-transform: translateY(100%);--cosmograph-size-legend-show-transform: translateX(0)}.style_module_container__d2889234{display:flex;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;overflow:hidden;min-height:25px}.style_module_legend__75c167f2{width:auto;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-size-legend-font-size);font-family:var(--cosmograph-size-legend-font-family);user-select:none;-webkit-user-select:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.04em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__91eae57a{opacity:1;transform:var(--cosmograph-size-legend-show-transform)}.style_module_disabled__d51f7a10{opacity:0;transform:var(--cosmograph-size-legend-hide-transform);pointer-events:none;display:none!important;min-height:0}@starting-style{.style_module_container__d2889234.style_module_enabled__91eae57a,.style_module_legend__75c167f2.style_module_enabled__91eae57a{opacity:0;transform:var(--cosmograph-size-legend-hide-transform)}}.style_module_legend__75c167f2 .circle{background-color:var(--cosmograph-size-legend-form-color);border-radius:50%;transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2 .line{background-color:var(--cosmograph-size-legend-form-color);border-radius:var(--cosmograph-size-legend-line-radius);width:var(--cosmograph-size-legend-line-width);transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2.style_module_events__894316a8{pointer-events:auto;cursor:pointer}.style_module_legend__75c167f2 .legend-content{display:flex;align-items:end;justify-content:center;gap:.75rem}.style_module_legend__75c167f2 .legend-content>div{transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__75c167f2 .labels-wrapper{white-space:nowrap}.style_module_legend__75c167f2 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-size-legend-items-margin)}.style_module_legend__75c167f2 .name{align-items:center;text-align:center;justify-content:center;display:flex;color:var(--cosmograph-size-legend-font-color);overflow:hidden;width:100%;margin-top:3px;word-break:break-all;white-space:pre-line;transition:color .15s ease-in-out;letter-spacing:-.02em}.style_module_legend__75c167f2 .label{color:var(--cosmograph-size-legend-font-color);overflow:hidden;transition:color .15s ease-in-out;text-overflow:ellipsis;font-feature-settings:"tnum"}.style_module_legend__75c167f2 .sublabel{padding-top:1px;font-size:var(--cosmograph-size-legend-sublabel-font-size);opacity:.5;line-height:1;min-width:10px;transition:color .15s ease-in-out}.style_module_hovered__1206707f .label,.style_module_hovered__1206707f .sublabel{color:var(--cosmograph-size-legend-hover-color);cursor:pointer}.style_module_hovered__1206707f .circle,.style_module_hovered__1206707f .line{background-color:var(--cosmograph-size-legend-hover-color);cursor:pointer}:root{--cosmograph-color-legend-range-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-range-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-range-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-label-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-sublabel-font-size: 10px;--cosmograph-color-legend-range-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-range-gradient-height: 6px;--cosmograph-color-legend-range-gradient-radius: 8px;--cosmograph-color-legend-range-gradient-top-margin: 6px;--cosmograph-color-legend-hide-transform: translateY(100%);--cosmograph-color-legend-show-transform: translateX(0)}.style_module_container__05cc807d{display:flex;min-width:150px;min-height:25px;width:100%;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_legend__a3e235e4{width:100%;font-weight:300;letter-spacing:-.04em;display:flex;flex-direction:column;font-size:var(--cosmograph-color-legend-range-font-size);font-family:var(--cosmograph-color-legend-range-font-family);user-select:none;-webkit-user-select:none;pointer-events:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__b3120e27{opacity:1;transform:var(--cosmograph-color-legend-show-transform);pointer-events:auto}.style_module_disabled__c2dc158c{opacity:0;transform:var(--cosmograph-color-legend-hide-transform);pointer-events:none;display:none;min-height:0}@starting-style{.style_module_container__05cc807d.style_module_enabled__b3120e27,.style_module_legend__a3e235e4.style_module_enabled__b3120e27{opacity:0;transform:var(--cosmograph-color-legend-hide-transform)}}.style_module_legend__a3e235e4 .legend-content{display:flex;align-items:end;justify-content:space-between}.style_module_hovered__dfd7bb2c .label,.style_module_hovered__dfd7bb2c .sublabel{color:var(--cosmograph-size-legend-hover-color)!important;cursor:pointer}.style_module_legend__a3e235e4 .extent{white-space:nowrap;transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__a3e235e4 .gradient{width:100%;margin-top:var(--cosmograph-color-legend-range-gradient-top-margin);height:var(--cosmograph-color-legend-range-gradient-height);border-radius:var(--cosmograph-color-legend-range-gradient-radius)}.style_module_legend__a3e235e4 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-color-legend-range-items-margin)}.style_module_legend__a3e235e4 .name{align-items:center;text-align:center;justify-content:space-around;display:flex;color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;width:100%;word-break:break-word;text-wrap:balance;white-space:pre-line;transition:color .15s ease-in-out;margin:0 4px;letter-spacing:-.02em;line-height:1.25}.style_module_legend__a3e235e4 .label{color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;max-width:150px;text-overflow:ellipsis;font-size:var(--cosmograph-color-legend-range-label-font-size);transition:color .15s ease-in-out;line-height:1;font-feature-settings:"tnum"}.style_module_legend__a3e235e4 .sublabel{padding-top:1px;color:var(--cosmograph-color-legend-range-font-color);opacity:.55;font-size:var(--cosmograph-color-legend-range-sublabel-font-size);line-height:1;transition:color .15s ease-in-out}:root{--cosmograph-color-legend-type-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-type-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-type-font-size: 11px;--cosmograph-color-legend-type-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-type-others-color: #bab0ab;--cosmograph-color-legend-type-bullet-size: 8px;--cosmograph-color-legend-type-bullet-radius: 1rem;--cosmograph-color-legend-type-items-margin: 4px;--cosmograph-color-legend-type-hide-transform: translateY(125%);--cosmograph-color-legend-type-show-transform: translateX(0)}.style_module_enabled__277b2403{opacity:1;transform:var(--cosmograph-color-legend-type-show-transform)}.style_module_disabled__7a587f96{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform);display:none!important;min-height:0}.style_module_wrapper__ea8ca7f4{position:relative;max-width:100%;width:fit-content;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_typeLegend__15bf4b2f{position:relative;width:fit-content;max-width:100%;min-height:25px;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.015em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_typeLegend__15bf4b2f .reverted{flex-direction:row-reverse}.style_module_typeLegend__15bf4b2f .scroll-container{width:100%;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-color-legend-type-font-size);font-family:var(--cosmograph-color-legend-type-font-family);user-select:none;-webkit-user-select:none;line-height:normal;overflow-x:hidden;overflow-y:auto;will-change:transform}@starting-style{.style_module_typeLegend__15bf4b2f.style_module_enabled__277b2403,.style_module_wrapper__ea8ca7f4.style_module_enabled__277b2403{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform)}}.style_module_typeLegend__15bf4b2f .legend-item{display:flex;align-items:center;position:absolute;margin-bottom:var(--cosmograph-color-legend-type-items-margin);pointer-events:none;width:100%;padding-left:1px;font-weight:300;transition:filter .1s ease-in-out,opacity .1s ease-in-out;min-height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px + var(--cosmograph-color-legend-type-items-margin));height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px);box-sizing:border-box}.style_module_typeLegend__15bf4b2f .unknown{background-color:var(--cosmograph-color-legend-type-unknown-color)}.style_module_typeLegend__15bf4b2f .others{background-color:var(--cosmograph-color-legend-type-others-color)}.style_module_typeLegend__15bf4b2f .bullet{height:var(--cosmograph-color-legend-type-bullet-size);width:var(--cosmograph-color-legend-type-bullet-size);min-height:var(--cosmograph-color-legend-type-bullet-size);min-width:var(--cosmograph-color-legend-type-bullet-size);border-radius:var(--cosmograph-color-legend-type-bullet-radius);pointer-events:all;margin-right:5px}.style_module_typeLegend__15bf4b2f .label{color:var(--cosmograph-color-legend-type-font-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - var(--cosmograph-color-legend-type-bullet-size) - 5px);pointer-events:all;transition:.05s linear color}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.bullet{margin-right:0}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.label{margin-right:5px}.style_module_typeLegend__15bf4b2f .show-more{cursor:pointer;padding-top:4px;display:none;font-weight:300;color:var(--cosmograph-color-legend-type-font-color);font-size:11px;opacity:.6;pointer-events:all;justify-content:space-between;transition:opacity .1s linear;font-feature-settings:"tnum"}.style_module_typeLegend__15bf4b2f .show-more:hover{opacity:1}.style_module_hovered__c0993502 .label,.style_module_hovered__c0993502 .sublabel{color:var(--cosmograph-color-legend-type-hover-color)!important;cursor:pointer}.style_module_selected__36e1dd81{filter:brightness(1)}.style_module_selected__36e1dd81>.style_module_label__afecc7a3{filter:brightness(1.2)}.style_module_unselected__4826cfb7{filter:brightness(.5)}.style_module_typeLegend__15bf4b2f .name{font-size:calc(var(--cosmograph-color-legend-type-font-size) + 1px);font-family:var(--cosmograph-color-legend-type-font-family);color:var(--cosmograph-color-legend-type-font-color);transition:color .15s ease-in-out,opacity .3s ease-in-out,max-height .3s ease-in-out,transform .3s ease-in-out;margin-bottom:4px;margin-top:2px;margin-left:1px;letter-spacing:-.02em;line-height:1.25;overflow:hidden;width:100%;white-space:nowrap;text-overflow:ellipsis;pointer-events:all;-webkit-user-select:none!important;user-select:none!important;max-height:100px;opacity:1;transform:translateY(0)}.style_module_typeLegend__15bf4b2f .name.hidden{opacity:0;max-height:0;margin-bottom:0;margin-top:0;transform:translateY(-10px)}:root{--cosmograph-button-color: var(--cosmograph-ui-text);--cosmograph-button-background: var(--cosmograph-ui-element-color);--cosmograph-button-border-radius: 2px}.style_module_button__e95a1138{background:var(--cosmograph-button-background);color:var(--cosmograph-button-color);border-radius:var(--cosmograph-button-border-radius);display:none;align-items:center;justify-content:center;width:25px;height:25px;margin:3px;padding:5px;cursor:pointer;filter:brightness(.95) contrast(.9);transition:filter .1s}.style_module_button__e95a1138:hover{filter:brightness(1.2) contrast(1)}')),document.head.appendChild(i)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();var kj=Object.defineProperty,Lj=(i,e,t)=>e in i?kj(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,yt=(i,e,t)=>Lj(i,typeof e!="symbol"?e+"":e,t);let Rj=class extends ei{constructor(e,t){const n=Ct(Ku,t??{}),r=ei.extractConfig(n,Ku);super(e,r),yt(this,"_config"),yt(this,"_containerNode"),yt(this,"_resizeObserver"),yt(this,"_svg"),yt(this,"_axisGroup"),yt(this,"_barsGroup"),yt(this,"_highlightedBarsGroup"),yt(this,"_brushGroup"),yt(this,"_firstRender",!0),yt(this,"_height"),yt(this,"_width"),yt(this,"_histogramWidth"),yt(this,"_histogramHeight"),yt(this,"_barWidth",0),yt(this,"_maxCount",0),yt(this,"_extent"),yt(this,"_barsData",[]),yt(this,"_highlightedBarsData",[]),yt(this,"_histogramData"),yt(this,"_highlightedData"),yt(this,"_bandIntervals",[]),yt(this,"_currentSelection"),yt(this,"_currentSelectionInPixels"),yt(this,"_yScale",Bf()),yt(this,"_xScale",Hc()),yt(this,"_axis",Cg(this._xScale)),yt(this,"_brushInstance"),this._config=n,this._containerNode=e,this._containerNode.classList.add(pn.histogram),this._width=e.offsetWidth,this._height=e.offsetHeight,this._histogramWidth=this._width-this._config.padding.left-this._config.padding.right,this._histogramHeight=this._height-this._config.padding.top-this._config.padding.bottom,this._initializeSVG(),this._initializeGroups(),this._resizeObserver=new iT(()=>this.resize()),this._resizeObserver.observe(this._containerNode)}_initializeSVG(){this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._svg.classList.add(pn.histogramSvg),this._containerNode.appendChild(this._svg)}setLoadingState(){super.setLoadingState()}_initializeGroups(){this._axisGroup=Et(this._svg).append("g").attr("class",pn.axis),this._barsGroup=Et(this._svg).append("g").attr("class",pn.bars),this._highlightedBarsGroup=Et(this._svg).append("g").attr("class",pn.bars),this._brushGroup=Et(this._svg).append("g").attr("class",pn.brush)}get _barPadding(){return this._barWidth*(this._config.barPadding??0)}get _formatter(){return this._config.formatter??Wn}getCurrentSelection(){return this._currentSelection}getCurrentSelectionInPixels(){return this._currentSelectionInPixels??[]}getBarWidth(){return this._barWidth-this._barPadding}getConfig(){return this._config}setConfig(e){const t=JSON.parse(JSON.stringify(this._config));this._config=Ct(Ku,e??{}),this.setDisplayStateConfig(ei.extractConfig(this._config,Ku)),this._config.allowSelection||this._disableBrush(),(this._config.dataStep!==t.dataStep||this._config.barCount!==t.barCount)&&(this._updateHistogramData(this._histogramData),this._updateHistogramData(this._highlightedData,!0)),this._axis.tickFormat(n=>this._formatter(n)),this.resize()}setSelection(e,t=!1){var n,r,o,s;const a=this._currentSelection;if(e&&this._extent){const l=[Math.max(this._extent[0],Math.min(e[0],this._extent[1])),Math.min(this._extent[1],Math.max(e[1],this._extent[0]))];if(l[0]<l[1])if(this._config.stickySelection){const c=l.map(this._xScale);this._mapSelection(c)}else this._currentSelection=l;else this._currentSelection=void 0}else this._currentSelection=void 0;!t&&((a==null?void 0:a[0])!==((n=this._currentSelection)==null?void 0:n[0])||(a==null?void 0:a[1])!==((r=this._currentSelection)==null?void 0:r[1]))&&((s=(o=this._config).onBrush)==null||s.call(o,this._currentSelection,!0)),this._brushCurrentSelection()}resize(){const{offsetWidth:e,offsetHeight:t}=this._containerNode;this._width=e,this._height=t,this._histogramWidth=this._width-this._config.padding.left-this._config.padding.right,this._histogramHeight=this._height-this._config.padding.top-this._config.padding.bottom,this._histogramHeight>this._config.padding.top+this._config.padding.bottom&&(this._updateScales(),this._currentSelection&&this.setSelection(this._currentSelection,!0),this._firstRender||this.render())}render(){this._updateBrush(),this._updateBars(),this._updateBars(!0),this._updateAxis(),this._firstRender&&(this._firstRender=!1)}destroy(){super.destroy(),this._resizeObserver.disconnect(),this._containerNode.innerHTML=""}_parseData(e){if(!(e!=null&&e.length))return[];const t=new Float64Array(e.length);let n=0;for(let r=0;r<e.length;r++){const o=e[r];typeof o=="number"&&!isNaN(o)&&(t[n++]=o)}return Array.from(t.subarray(0,n))}setHistogramData(e,t){if(t&&t[1]<=t[0])return;this._histogramData=[],this._highlightedBarsData=[],this._currentSelection=void 0,this._brushCurrentSelection();const n=this._parseData(e),r=t||Yi(n),o=r[0]<r[1];o&&n.length>1?(this.hideState(),this._histogramData=n,this._extent=r,this._firstRender=!0):this.showState(o?void 0:"Empty or invalid histogram data"),this._updateHistogramData(this._histogramData),this._updateScales(),this.render()}setHighlightedData(e){this._histogramData&&(this._highlightedData=this._parseData(e),this._highlightedBarsData=[],this._updateHistogramData(this._highlightedData,!0),this._updateBars(!0))}_updateAxis(){if(!this._histogramData||!this._histogramData.length){this._axisGroup.style("display","none");return}this._axisGroup.style("transform",`translate(${this._config.padding.left}px, ${this._config.padding.top-(this._config.selectionPadding??0)/2+1}px)`).call(this._axis).call(e=>e.select(".domain").remove()),this._axisGroup.selectAll(".tick").select("text").attr("class",pn.axisTick).attr("y",0).attr("dy",-2).attr("dx",this._config.labelSideMargin??0),this._axisGroup.selectAll(".tick:last-of-type text").attr("dx",-(this._config.labelSideMargin??0)).style("text-anchor","end"),this._axisGroup.selectAll("line").attr("y2",this._histogramHeight).attr("y1",0).attr("opacity",.1)}_updateBrush(){if(!this._config.allowSelection||this._histogramHeight<0||this._histogramWidth<0){this._brushGroup.selectAll("*").remove();return}const e=this._config.selectionPadding??0,t=this._histogramHeight-e,n=[[0,e/2],[this._histogramWidth,t+e/2]];this._brushInstance=nT().extent(n),this._brushInstance.on("end",({selection:r,sourceEvent:o})=>{var s,a,l,c;o&&(r?(this._config.stickySelection?this._mapSelection(r):this._currentSelection=r.map(u=>this._xScale.invert(u)),(a=(s=this._config).onBrush)==null||a.call(s,this._currentSelection)):(this._currentSelection=void 0,(c=(l=this._config).onBrush)==null||c.call(l,void 0)),this._brushCurrentSelection())}),this._brushGroup.style("transform",`translate(${this._config.padding.left}px, ${this._config.padding.top}px)`).call(this._brushInstance).call(this._brushInstance.move,this._currentSelectionInPixels||null),this._brushGroup.select("rect.selection").classed(pn.selection,!0).attr("rx",this._config.selectionRadius??0).attr("ry",this._config.selectionRadius??0)}_updateBars(e=!1){const t=e?this._highlightedBarsGroup:this._barsGroup;if(!this._histogramData||!this._histogramData.length){t.selectAll("rect").remove();return}t.style("transform",`translate(${this._config.padding.left}px, ${this._config.padding.top-(this._config.selectionPadding??0)/2}px)`);const n=e?.5:1,r=this._createBars(t,e);!e&&this._config.onBarHover&&r.on("mouseover",this._config.onBarHover),this._animateBars(r,e,n)}_createBars(e,t){return e.selectAll(`.${t?pn.highlightedBar:pn.bar}`).data(t?this._highlightedBarsData:this._barsData).join("rect").attr("class",t?pn.highlightedBar:pn.bar).attr("x",n=>this._xScale(n.rangeStart)+this._barPadding/2).attr("width",this.getBarWidth()).attr("rx",this._config.barRadius??0).attr("ry",this._config.barRadius??0).attr("y",-this._histogramHeight)}_animateBars(e,t,n){e.transition().duration(300).attr("height",r=>t?r.count===0?0:this._yScale(r.count):this._yScale(r.count)).style("opacity",r=>this._yScale(r.count)===this._config.minBarHeight?.4:n)}_updateScales(){if(!this._extent||!this._barsData.length||this._histogramHeight<0||this._histogramWidth<0)this._axisGroup.style("display","none");else{this._axisGroup.style("display","inherit");const e=this._barsData[this._barsData.length-1],t=this._config.dataStep?[this._extent[0],e.rangeEnd]:this._extent;this._xScale.domain(t).range([0,this._histogramWidth]).clamp(!0),this._yScale.range([this._config.minBarHeight??0,this._histogramHeight-(this._config.barTopMargin??0)-(this._config.selectionPadding??0)]).domain([0,this._maxCount]).clamp(!0),this._axis.tickValues(t),this._barWidth=this._xScale(e.rangeEnd)-this._xScale(e.rangeStart)}}_updateHistogramData(e,t=!1){const n=t?"_highlightedBarsData":"_barsData";if(!this._extent){this[n]=[];return}if(!(e!=null&&e.length)){this[n]=Zd([],this._bandIntervals,this._currentSelection,t);return}t||this._generateBandIntervals();const r=Zd(e,this._bandIntervals,this._currentSelection,t);this[n]=r,t||(this._maxCount=Math.max(...r.map(o=>o.count)))}_generateBandIntervals(){if(!this._extent)return;const{barCount:e=CT,dataStep:t}=this._config;this._bandIntervals=xT(this._extent,e,t)}_disableBrush(){this._currentSelection=void 0,this._brushCurrentSelection(),this._brushGroup.selectAll("*").remove()}_mapSelection(e){if(!this._barsData.length)return;const t=this._xScale.invert(e[0]),n=this._xScale.invert(e[1]),r=this._getClosestRange(t),o=this._getClosestRange(n,!0);r&&o&&r.rangeStart<=o.rangeEnd&&e[1]-e[0]>this.getBarWidth()/2?this._currentSelection=[r.rangeStart,o.rangeEnd]:this._currentSelection=void 0}_getClosestRange(e,t){return this._barsData.reduce((n,r)=>{const o=t?n.rangeEnd:n.rangeStart,s=t?r.rangeEnd:r.rangeStart;return Math.abs(s-e)<Math.abs(o-e)?r:n})}_brushCurrentSelection(){var e;this._currentSelection?(this._currentSelectionInPixels=this._currentSelection.map(this._xScale),this._brushInstance&&!this._firstRender&&this._brushGroup.call(this._brushInstance.move,this._currentSelectionInPixels)):(this._currentSelectionInPixels=void 0,(e=this._brushInstance)==null||e.clear(this._brushGroup))}};const TT=10,Ys={maxDisplayedItems:TT,showSortingBlock:!0,showSearch:!0,sort:"count",sortAscending:!1,showTotalWhenFiltered:!1,countFormatter:Wn,expanded:!1,onClick:void 0,onBarHover:void 0,noDataMessage:"No bars data",loadingMessage:"Data loading...",allowPointerEvents:!0},Pj="style_module_bars__25497ded",Dj={bars:Pj};(function(){try{if(typeof document<"u"){var i=document.createElement("style");i.appendChild(document.createTextNode('@keyframes style_module_fadeIn__ffac87fd{0%{opacity:0}to{opacity:.2}}.style_module_displayState__6ae19b84{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--cosmograph-ui-text);display:flex;justify-content:center;align-items:center;min-width:100px;opacity:.2;font-size:calc(var(--cosmograph-ui-font-size) + 1px);letter-spacing:-.02em;font-weight:200;user-select:none;-webkit-user-select:none;animation:style_module_fadeIn__ffac87fd .3s ease-in-out}:root{--cosmograph-timeline-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-timeline-selection-opacity: .5;--cosmograph-timeline-bar-color: var(--cosmograph-ui-element-color);--cosmograph-timeline-highlighted-bar-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-timeline-font-family: var(--cosmograph-ui-font-family);--cosmograph-timeline-font-size: var(--cosmograph-ui-tick-font-size);--cosmograph-timeline-background: var(--cosmograph-ui-background);--cosmograph-timeline-text-color: var(--cosmograph-ui-text);--cosmograph-timeline-axis-color: var(--cosmograph-ui-text)}.style_module_timeline__736434f7{position:relative;display:flex;background:var(--cosmograph-timeline-background);width:100%;min-height:25px;overflow:hidden}.style_module_timelineSvg__b916ad04{position:relative;width:100%;height:100%}.style_module_selection__ebee57f8{fill:var(--cosmograph-timeline-selection-color);fill-opacity:var(--cosmograph-timeline-selection-opacity);stroke:none}.style_module_axisTick__5865631d{color:var(--cosmograph-timeline-axis-color);font:var(--cosmograph-timeline-font-family);font-size:var(--cosmograph-timeline-font-size);user-select:none;-webkit-user-select:none;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum";alignment-baseline:text-before-edge}.style_module_axisLine__992b502d{opacity:.2;color:var(--cosmograph-timeline-axis-color)}.style_module_bar__114fa79f{fill:var(--cosmograph-timeline-bar-color);transform:scaleY(-1);opacity:0}.style_module_animationControl__ee52cd66{color:var(--cosmograph-timeline-axis-color);width:6%;max-width:30px;min-width:20px;cursor:pointer;display:none;align-items:center;user-select:none;-webkit-user-select:none;opacity:.5;position:relative;justify-content:center}.style_module_animationControl__ee52cd66>svg{width:50%;max-height:20px;padding-right:2px}.style_module_hidden__a73fe81a{display:none}.style_module_disabled__eb988570{opacity:.2;pointer-events:none}.style_module_highlightedBar__c2fc9bdc{fill:var(--cosmograph-timeline-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-search-font-family: var(--cosmograph-ui-font-family);--cosmograph-search-font-size: 14px;--cosmograph-search-list-font-size: 13.5px;--cosmograph-search-text-color: var(--cosmograph-ui-text);--cosmograph-search-background: transparent;--cosmograph-search-list-background: rgba(0, 0, 0, .2);--cosmograph-search-list-match-background: rgba(255, 255, 255, .2);--cosmograph-search-list-match-color: var(--cosmograph-ui-text)}.style_module_searchInput__d7830601:hover{filter:brightness(1.2) contrast(1)}.style_module_searchInput__d7830601{width:100%;background:transparent;color:var(--cosmograph-search-text-color);border:none;border-bottom:.5px solid var(--cosmograph-search-text-color);padding:4px 20px 5px 2px;font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:opacity .2s ease-out}.style_module_searchInput__d7830601::selection{background:var(--cosmograph-search-list-match-background)}.style_module_searchInput__d7830601:focus{outline:none}.style_module_searchSuggestions__b0d3f71e{color:#fff;width:100%;padding:0;margin:0;background:transparent;overflow-y:auto;flex:1;min-height:0}.style_module_searchSuggestions__b0d3f71e li{padding:5px 10px;cursor:pointer;-webkit-user-select:none;user-select:none;display:block;font-weight:500;font-size:var(--cosmograph-search-list-font-size);max-width:100%;overflow:hidden}.style_module_searchSuggestions__b0d3f71e li>div{white-space:nowrap;font-weight:200;overflow:hidden;text-overflow:ellipsis;width:100%}.style_module_searchSuggestions__b0d3f71e li:hover{background:#ffffff1a}.style_module_searchSuggestions__b0d3f71e mark{background:var(--cosmograph-search-list-match-background);color:var(--cosmograph-search-list-match-color);border-radius:2px}.style_module_clearButton__5ebb41de{position:absolute;right:0;top:0;height:100%;background:none;border:none;color:var(--cosmograph-search-text-color);font-weight:300;cursor:pointer;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d{opacity:.7}.style_module_placeholderWrapper__72d5eb0e{z-index:1;color:var(--cosmograph-search-text-color);font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);position:absolute;top:0;left:0;width:100%;bottom:0;display:flex;line-height:1.25;align-items:center;transition:transform .3s ease-out,opacity .3s ease-out}.style_module_placeholderWrapper__72d5eb0e.style_module_hidden__acfb8431{transform:translate(-30px);pointer-events:none;opacity:0}.style_module_searchInput__d7830601:disabled,.style_module_searchInput__d7830601.style_module_disabled__62c35dc5{opacity:.2;cursor:not-allowed;pointer-events:none}.style_module_disabled__62c35dc5 .style_module_clearButton__5ebb41de{display:none}.style_module_disabled__62c35dc5 .style_module_placeholderWrapper__72d5eb0e{opacity:.3;cursor:not-allowed}.style_module_searchInputWrapper__1edbcb22{position:relative;display:flex;width:100%}.style_module_noResults__363397c3{opacity:.3!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none}.style_module_noResults__363397c3:hover{background:none}.style_module_loading__296e0212{opacity:.7!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none;-webkit-user-select:none;user-select:none}.style_module_dropdownContainer__d98287da{position:absolute;top:100%;left:0;width:100%;background:var(--cosmograph-search-list-background);border-radius:4px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);opacity:0;transform:translateY(-10px);transition:opacity .2s ease-out,transform .2s ease-out;pointer-events:none;overflow:hidden;z-index:10;display:flex;flex-direction:column;padding-bottom:2px}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b{top:auto;bottom:100%;transform:translateY(10px)}.style_module_dropdownContainer__d98287da.style_module_visible__5be7493d{opacity:1;transform:translateY(0);pointer-events:auto}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b.style_module_visible__5be7493d{opacity:1;transform:translateY(-2px);pointer-events:auto}.style_module_footerContainer__73e7a066{flex-shrink:0}:root{--cosmograph-scrollbar-background: rgba(255, 255, 255, .1);--cosmograph-ui-background: rgb(45, 49, 58);--cosmograph-ui-text: #ffffffc7;--cosmograph-ui-tick-font-size: 11px;--cosmograph-ui-font-size: 12px;--cosmograph-ui-font-family: inherit;--cosmograph-ui-element-color: #5C616A;--cosmograph-ui-highlighted-element-color: white;--cosmograph-ui-selection-control-color: #8d949ea8;-webkit-font-smoothing:antialiased!important;text-rendering:optimizeLegibility!important}.style_module_cosmograph-ui__5acb97f1{background:var(--cosmograph-ui-background);color:var(--cosmograph-ui-text)}.style_module_scrollbar__f1516254 *::-webkit-scrollbar{width:5px;height:5px;border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-track{border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-corner{background:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-button{display:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-thumb{background-color:var(--cosmograph-scrollbar-background);transition:background-color .5s;border-radius:20px;border:3px solid var(--cosmograph-scrollbar-background)}@-moz-document url-prefix(){.style_module_scrollbar__f1516254 *{scrollbar-width:thin;scrollbar-color:var(--cosmograph-scrollbar-background) transparent;scrollbar-track-color:transparent;scrollbar-face-color:var(--cosmograph-scrollbar-background)}}:root{--cosmograph-histogram-background: var(--cosmograph-ui-background);--cosmograph-histogram-text-color: var(--cosmograph-ui-text);--cosmograph-histogram-axis-color: var(--cosmograph-ui-text);--cosmograph-histogram-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-histogram-selection-opacity: .5;--cosmograph-histogram-bar-color: var(--cosmograph-ui-element-color);--cosmograph-histogram-highlighted-bar-color: var( --cosmograph-ui-highlighted-element-color);--cosmograph-histogram-font-family: var(--cosmograph-ui-font-family);--cosmograph-histogram-font-size: var(--cosmograph-ui-tick-font-size)}.style_module_histogram__9d8a77ea{position:relative;display:flex;min-height:25px;background:var(--cosmograph-histogram-background);width:100%}.style_module_histogramSvg__ccccb628{position:relative;width:100%;height:100%}.style_module_selection__7db96137{fill:var(--cosmograph-histogram-selection-color);fill-opacity:var(--cosmograph-histogram-selection-opacity);stroke:none}.style_module_axisTick__898e1f39{color:var(--cosmograph-histogram-axis-color);font-family:var(--cosmograph-histogram-font-family);font-size:var(--cosmograph-histogram-font-size);user-select:none;-webkit-user-select:none;alignment-baseline:text-before-edge;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum"}.style_module_bar__3c9ab488{fill:var(--cosmograph-histogram-bar-color);transform:scaleY(-1)}.style_module_highlightedBar__b193a8de{fill:var(--cosmograph-histogram-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-bars-font-color: var(--cosmograph-ui-text);--cosmograph-bars-font-family: var(--cosmograph-ui-font-family);--cosmograph-bars-font-size: var(--cosmograph-ui-font-size);--cosmograph-bars-ui-font-size: 11.5px;--cosmograph-bars-background: var(--cosmograph-ui-element-color);--cosmograph-bars-bar-height: 20px;--cosmograph-bars-bar-bottom-margin: 2px;--cosmograph-bars-highlighted-color: var( --cosmograph-ui-highlighted-element-color)}.style_module_bars__25497ded{position:relative;width:100%;min-height:100px;user-select:none;flex-direction:column;-webkit-user-select:none}.style_module_bars__25497ded .scroll-container{position:relative;width:100%;overflow-y:hidden;overflow-x:hidden}.style_module_bars__25497ded .bars-container{position:relative;width:calc(100% - 1px);font-family:var(--cosmograph-bars-font-family)}.style_module_bars__25497ded .highlighted-bars-container{position:absolute;top:0;left:0;pointer-events:none}.style_module_bars__25497ded .row{height:var(--cosmograph-bars-bar-height);display:flex;align-items:center;margin-bottom:var(--cosmograph-bars-bar-bottom-margin);width:100%;transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row:hover{filter:brightness(1.15) contrast(1.05);transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row.unselected:hover{filter:brightness(.95) contrast(1.15);transition:filter .05s linear}.style_module_bars__25497ded .unselected{opacity:.85;filter:brightness(.8) contrast(1.1)}.style_module_bars__25497ded .selected{filter:brightness(1.05) contrast(1.05)}.style_module_bars__25497ded .selected>.info>.label{font-weight:600;filter:brightness(1.1) contrast(1.05)}.style_module_bars__25497ded .unselected>.info>.label{font-weight:300}.style_module_bars__25497ded .bar{height:100%;background-color:var(--cosmograph-bars-background);opacity:.8;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .bar-highlighted{height:100%;background-color:var(--cosmograph-bars-highlighted-color);opacity:.2;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .info{display:flex;justify-content:space-between;width:100%;padding:0 4px;position:absolute;font-size:var(--cosmograph-bars-font-size);font-feature-settings:"tnum";color:var(--cosmograph-bars-font-color);gap:2px}.style_module_bars__25497ded .label{min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:opacity .05s linear}.style_module_bars__25497ded .count{flex-shrink:0;font-weight:300;opacity:.8;transition:opacity .05s linear}.style_module_bars__25497ded .show-more{cursor:pointer;padding-top:2px;display:flex;font-weight:300;color:var(--cosmograph-bars-font-color);font-size:11px;justify-content:space-between;opacity:.6;font-size:var(--cosmograph-bars-ui-font-size);pointer-events:none;transition:opacity .1s linear}.style_module_bars__25497ded .show-more:hover{opacity:1;text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .show-more>span{pointer-events:all}.style_module_bars__25497ded .show-more-count{padding-right:5px;pointer-events:all;font-feature-settings:"tnum"}.style_module_bars__25497ded .unselected>.info>.label,.style_module_bars__25497ded .unselected>.info>.count{opacity:.5}.style_module_bars__25497ded .unselected:hover>.info>.label,.style_module_bars__25497ded .unselected:hover>.info>.count{opacity:1}.style_module_bars__25497ded .search-input{background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,.3);font-size:13px!important;color:var(--cosmograph-bars-font-color);line-height:1.5;padding:2px;width:100%;position:relative;transition:border-bottom-color .2s}.style_module_bars__25497ded .search-input::placeholder{color:var(--cosmograph-bars-font-color)!important;opacity:.4;font-weight:300;font-family:inherit}.style_module_bars__25497ded .search-container{position:relative;width:100%;margin-bottom:4px;display:none;z-index:1}.style_module_bars__25497ded .clear-button{position:absolute;right:0;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--cosmograph-bars-font-color);font-weight:300;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_bars__25497ded .clear-button.visible:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_bars__25497ded .clear-button.visible{opacity:.7}.style_module_bars__25497ded .clear-button svg{width:10px;height:10px;fill:currentColor}.style_module_bars__25497ded .sorting-block{visibility:hidden;margin-top:1px;display:flex;justify-content:space-between}.style_module_bars__25497ded .buttons-container{margin-top:4px;font-size:var(--cosmograph-bars-ui-font-size);display:flex;gap:4px;line-height:1.25}.style_module_bars__25497ded .buttons-container>div{transition:opacity .05s linear,filter .05s linear;padding:1px 5px;background:var(--cosmograph-bars-background);border-radius:4px;opacity:.9;display:flex;cursor:pointer;align-items:center}.style_module_bars__25497ded .buttons-container>div:hover{filter:brightness(1.2)}.style_module_bars__25497ded .reset-text{transition:opacity .05s linear,filter .05s linear;display:flex;font-size:var(--cosmograph-bars-ui-font-size);align-items:end;padding-right:4px;cursor:pointer;font-weight:300}.style_module_bars__25497ded .reset-text:hover{text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .reset-text.unselected{pointer-events:none;cursor:default;opacity:.7}.style_module_bars__25497ded :scope.reset-text:hover:not(.unselected){filter:brightness(1.5);opacity:1}:root{--cosmograph-size-legend-form-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-family: inherit;--cosmograph-size-legend-font-size: var(--cosmograph-ui-font-size);--cosmograph-size-legend-sublabel-font-size: 10px;--cosmograph-size-legend-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-size-legend-line-radius: 2px;--cosmograph-size-legend-line-width: 30px;--cosmograph-size-legend-hide-transform: translateY(100%);--cosmograph-size-legend-show-transform: translateX(0)}.style_module_container__d2889234{display:flex;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;overflow:hidden;min-height:25px}.style_module_legend__75c167f2{width:auto;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-size-legend-font-size);font-family:var(--cosmograph-size-legend-font-family);user-select:none;-webkit-user-select:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.04em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__91eae57a{opacity:1;transform:var(--cosmograph-size-legend-show-transform)}.style_module_disabled__d51f7a10{opacity:0;transform:var(--cosmograph-size-legend-hide-transform);pointer-events:none;display:none!important;min-height:0}@starting-style{.style_module_container__d2889234.style_module_enabled__91eae57a,.style_module_legend__75c167f2.style_module_enabled__91eae57a{opacity:0;transform:var(--cosmograph-size-legend-hide-transform)}}.style_module_legend__75c167f2 .circle{background-color:var(--cosmograph-size-legend-form-color);border-radius:50%;transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2 .line{background-color:var(--cosmograph-size-legend-form-color);border-radius:var(--cosmograph-size-legend-line-radius);width:var(--cosmograph-size-legend-line-width);transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2.style_module_events__894316a8{pointer-events:auto;cursor:pointer}.style_module_legend__75c167f2 .legend-content{display:flex;align-items:end;justify-content:center;gap:.75rem}.style_module_legend__75c167f2 .legend-content>div{transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__75c167f2 .labels-wrapper{white-space:nowrap}.style_module_legend__75c167f2 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-size-legend-items-margin)}.style_module_legend__75c167f2 .name{align-items:center;text-align:center;justify-content:center;display:flex;color:var(--cosmograph-size-legend-font-color);overflow:hidden;width:100%;margin-top:3px;word-break:break-all;white-space:pre-line;transition:color .15s ease-in-out;letter-spacing:-.02em}.style_module_legend__75c167f2 .label{color:var(--cosmograph-size-legend-font-color);overflow:hidden;transition:color .15s ease-in-out;text-overflow:ellipsis;font-feature-settings:"tnum"}.style_module_legend__75c167f2 .sublabel{padding-top:1px;font-size:var(--cosmograph-size-legend-sublabel-font-size);opacity:.5;line-height:1;min-width:10px;transition:color .15s ease-in-out}.style_module_hovered__1206707f .label,.style_module_hovered__1206707f .sublabel{color:var(--cosmograph-size-legend-hover-color);cursor:pointer}.style_module_hovered__1206707f .circle,.style_module_hovered__1206707f .line{background-color:var(--cosmograph-size-legend-hover-color);cursor:pointer}:root{--cosmograph-color-legend-range-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-range-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-range-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-label-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-sublabel-font-size: 10px;--cosmograph-color-legend-range-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-range-gradient-height: 6px;--cosmograph-color-legend-range-gradient-radius: 8px;--cosmograph-color-legend-range-gradient-top-margin: 6px;--cosmograph-color-legend-hide-transform: translateY(100%);--cosmograph-color-legend-show-transform: translateX(0)}.style_module_container__05cc807d{display:flex;min-width:150px;min-height:25px;width:100%;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_legend__a3e235e4{width:100%;font-weight:300;letter-spacing:-.04em;display:flex;flex-direction:column;font-size:var(--cosmograph-color-legend-range-font-size);font-family:var(--cosmograph-color-legend-range-font-family);user-select:none;-webkit-user-select:none;pointer-events:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__b3120e27{opacity:1;transform:var(--cosmograph-color-legend-show-transform);pointer-events:auto}.style_module_disabled__c2dc158c{opacity:0;transform:var(--cosmograph-color-legend-hide-transform);pointer-events:none;display:none;min-height:0}@starting-style{.style_module_container__05cc807d.style_module_enabled__b3120e27,.style_module_legend__a3e235e4.style_module_enabled__b3120e27{opacity:0;transform:var(--cosmograph-color-legend-hide-transform)}}.style_module_legend__a3e235e4 .legend-content{display:flex;align-items:end;justify-content:space-between}.style_module_hovered__dfd7bb2c .label,.style_module_hovered__dfd7bb2c .sublabel{color:var(--cosmograph-size-legend-hover-color)!important;cursor:pointer}.style_module_legend__a3e235e4 .extent{white-space:nowrap;transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__a3e235e4 .gradient{width:100%;margin-top:var(--cosmograph-color-legend-range-gradient-top-margin);height:var(--cosmograph-color-legend-range-gradient-height);border-radius:var(--cosmograph-color-legend-range-gradient-radius)}.style_module_legend__a3e235e4 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-color-legend-range-items-margin)}.style_module_legend__a3e235e4 .name{align-items:center;text-align:center;justify-content:space-around;display:flex;color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;width:100%;word-break:break-word;text-wrap:balance;white-space:pre-line;transition:color .15s ease-in-out;margin:0 4px;letter-spacing:-.02em;line-height:1.25}.style_module_legend__a3e235e4 .label{color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;max-width:150px;text-overflow:ellipsis;font-size:var(--cosmograph-color-legend-range-label-font-size);transition:color .15s ease-in-out;line-height:1;font-feature-settings:"tnum"}.style_module_legend__a3e235e4 .sublabel{padding-top:1px;color:var(--cosmograph-color-legend-range-font-color);opacity:.55;font-size:var(--cosmograph-color-legend-range-sublabel-font-size);line-height:1;transition:color .15s ease-in-out}:root{--cosmograph-color-legend-type-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-type-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-type-font-size: 11px;--cosmograph-color-legend-type-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-type-others-color: #bab0ab;--cosmograph-color-legend-type-bullet-size: 8px;--cosmograph-color-legend-type-bullet-radius: 1rem;--cosmograph-color-legend-type-items-margin: 4px;--cosmograph-color-legend-type-hide-transform: translateY(125%);--cosmograph-color-legend-type-show-transform: translateX(0)}.style_module_enabled__277b2403{opacity:1;transform:var(--cosmograph-color-legend-type-show-transform)}.style_module_disabled__7a587f96{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform);display:none!important;min-height:0}.style_module_wrapper__ea8ca7f4{position:relative;max-width:100%;width:fit-content;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_typeLegend__15bf4b2f{position:relative;width:fit-content;max-width:100%;min-height:25px;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.015em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_typeLegend__15bf4b2f .reverted{flex-direction:row-reverse}.style_module_typeLegend__15bf4b2f .scroll-container{width:100%;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-color-legend-type-font-size);font-family:var(--cosmograph-color-legend-type-font-family);user-select:none;-webkit-user-select:none;line-height:normal;overflow-x:hidden;overflow-y:auto;will-change:transform}@starting-style{.style_module_typeLegend__15bf4b2f.style_module_enabled__277b2403,.style_module_wrapper__ea8ca7f4.style_module_enabled__277b2403{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform)}}.style_module_typeLegend__15bf4b2f .legend-item{display:flex;align-items:center;position:absolute;margin-bottom:var(--cosmograph-color-legend-type-items-margin);pointer-events:none;width:100%;padding-left:1px;font-weight:300;transition:filter .1s ease-in-out,opacity .1s ease-in-out;min-height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px + var(--cosmograph-color-legend-type-items-margin));height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px);box-sizing:border-box}.style_module_typeLegend__15bf4b2f .unknown{background-color:var(--cosmograph-color-legend-type-unknown-color)}.style_module_typeLegend__15bf4b2f .others{background-color:var(--cosmograph-color-legend-type-others-color)}.style_module_typeLegend__15bf4b2f .bullet{height:var(--cosmograph-color-legend-type-bullet-size);width:var(--cosmograph-color-legend-type-bullet-size);min-height:var(--cosmograph-color-legend-type-bullet-size);min-width:var(--cosmograph-color-legend-type-bullet-size);border-radius:var(--cosmograph-color-legend-type-bullet-radius);pointer-events:all;margin-right:5px}.style_module_typeLegend__15bf4b2f .label{color:var(--cosmograph-color-legend-type-font-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - var(--cosmograph-color-legend-type-bullet-size) - 5px);pointer-events:all;transition:.05s linear color}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.bullet{margin-right:0}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.label{margin-right:5px}.style_module_typeLegend__15bf4b2f .show-more{cursor:pointer;padding-top:4px;display:none;font-weight:300;color:var(--cosmograph-color-legend-type-font-color);font-size:11px;opacity:.6;pointer-events:all;justify-content:space-between;transition:opacity .1s linear;font-feature-settings:"tnum"}.style_module_typeLegend__15bf4b2f .show-more:hover{opacity:1}.style_module_hovered__c0993502 .label,.style_module_hovered__c0993502 .sublabel{color:var(--cosmograph-color-legend-type-hover-color)!important;cursor:pointer}.style_module_selected__36e1dd81{filter:brightness(1)}.style_module_selected__36e1dd81>.style_module_label__afecc7a3{filter:brightness(1.2)}.style_module_unselected__4826cfb7{filter:brightness(.5)}.style_module_typeLegend__15bf4b2f .name{font-size:calc(var(--cosmograph-color-legend-type-font-size) + 1px);font-family:var(--cosmograph-color-legend-type-font-family);color:var(--cosmograph-color-legend-type-font-color);transition:color .15s ease-in-out,opacity .3s ease-in-out,max-height .3s ease-in-out,transform .3s ease-in-out;margin-bottom:4px;margin-top:2px;margin-left:1px;letter-spacing:-.02em;line-height:1.25;overflow:hidden;width:100%;white-space:nowrap;text-overflow:ellipsis;pointer-events:all;-webkit-user-select:none!important;user-select:none!important;max-height:100px;opacity:1;transform:translateY(0)}.style_module_typeLegend__15bf4b2f .name.hidden{opacity:0;max-height:0;margin-bottom:0;margin-top:0;transform:translateY(-10px)}:root{--cosmograph-button-color: var(--cosmograph-ui-text);--cosmograph-button-background: var(--cosmograph-ui-element-color);--cosmograph-button-border-radius: 2px}.style_module_button__e95a1138{background:var(--cosmograph-button-background);color:var(--cosmograph-button-color);border-radius:var(--cosmograph-button-border-radius);display:none;align-items:center;justify-content:center;width:25px;height:25px;margin:3px;padding:5px;cursor:pointer;filter:brightness(.95) contrast(.9);transition:filter .1s}.style_module_button__e95a1138:hover{filter:brightness(1.2) contrast(1)}')),document.head.appendChild(i)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();var Mj=Object.defineProperty,Nj=(i,e,t)=>e in i?Mj(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Xe=(i,e,t)=>Nj(i,typeof e!="symbol"?e+"":e,t);let Bj=class extends ei{constructor(e,t){const n=Ct(Ys,t??{}),r=ei.extractConfig(n,Ys);super(e,r),Xe(this,"_data",[]),Xe(this,"_originalData",[]),Xe(this,"_config"),Xe(this,"_container"),Xe(this,"_searchContainer"),Xe(this,"_searchInput"),Xe(this,"_clearButton"),Xe(this,"_scrollContainer"),Xe(this,"_barsContainer"),Xe(this,"_highlightedBarsContainer"),Xe(this,"_showMoreButton"),Xe(this,"_showMoreCount"),Xe(this,"_sortingBlock"),Xe(this,"_uniqueValues",new Set),Xe(this,"_countMap",new Int32Array(0)),Xe(this,"_visibleItemsCount",0),Xe(this,"_hiddenItemsSum",0),Xe(this,"_itemHeight",0),Xe(this,"_itemMargin",0),Xe(this,"_startIndex",0),Xe(this,"_endIndex",0),Xe(this,"_maxCount",0),Xe(this,"_selectedItem"),Xe(this,"_isExpanded",!1),Xe(this,"_sortingHandlers"),Xe(this,"_highlightedCounts"),Xe(this,"_isFilteringActive",!1),Xe(this,"_updateVisibleItems",()=>{const o=this._itemHeight+this._itemMargin;this._startIndex=Math.floor(this._scrollContainer.scrollTop/o),this._endIndex=Math.min(this._startIndex+this._visibleItemsCount+1,this._data.length),this._renderItems()}),Xe(this,"_handleShowMoreCount",()=>{var o,s,a,l,c,u;const h=this._data.length-this._maxDisplayedItems,d=((s=(o=this._config).countFormatter)==null?void 0:s.call(o,this._hiddenItemsSum))??this._hiddenItemsSum.toString();if(this._isFilteringActive&&this._config.showTotalWhenFiltered){const f=this._data.slice(this._maxDisplayedItems).reduce((b,g)=>b+g.count,0),p=((l=(a=this._config).countFormatter)==null?void 0:l.call(a,f))??f.toString();this._showMoreCount.textContent=`${d} / ${p}`}else this._showMoreCount.textContent=d;this._showMoreButton.firstChild.textContent=`${((u=(c=this._config).countFormatter)==null?void 0:u.call(c,h))??h.toString()} more`}),Xe(this,"_handleScroll",()=>{this._updateVisibleItems()}),Xe(this,"_handleSort",()=>{this._config.sort==="alphabetical"?this.sortAlphabetically(this._config.sortAscending):this.sortByCount(this._config.sortAscending)}),Xe(this,"_handleSearch",()=>{const o=this._searchInput.value.toLowerCase();this._clearButton.classList[o?"add":"remove"]("visible"),this._data=this._originalData.filter(s=>String(s.label).toLowerCase().includes(o)),this._handleSort()}),Xe(this,"_clearSearch",()=>{this._searchInput.value="",this._handleSearch()}),Xe(this,"_handleShowMore",()=>{this._isExpanded=!this._isExpanded,this._isExpanded?(this._scrollContainer.style.overflowY="auto",this._showMoreButton.firstChild.textContent="show less",this._showMoreCount.textContent=""):(this._scrollContainer.style.overflowY="hidden",this._scrollContainer.scrollTop=0,this._handleShowMoreCount())}),this._config=n,this._container=e,this._container.classList.add(Dj.bars),this._container.classList.add(db.scrollbar),this._scrollContainer=document.createElement("div"),this._scrollContainer.classList.add("scroll-container"),this._barsContainer=document.createElement("div"),this._barsContainer.classList.add("bars-container"),this._highlightedBarsContainer=document.createElement("div"),this._highlightedBarsContainer.classList.add("bars-container","highlighted-bars-container"),this._scrollContainer.appendChild(this._barsContainer),this._scrollContainer.appendChild(this._highlightedBarsContainer),this._showMoreButton=this._createShowMoreButton(),this._sortingBlock=this._createSortingBlock(),this._searchContainer=this._createSearch(),this._container.appendChild(this._searchContainer),this._container.appendChild(this._scrollContainer),this._container.appendChild(this._showMoreButton),this._container.appendChild(this._sortingBlock),this._scrollContainer.addEventListener("scroll",this._handleScroll,{passive:!0})}get _maxDisplayedItems(){return this._config.maxDisplayedItems??TT}_createSearch(){const e=document.createElement("div");return e.classList.add("search-container"),this._clearButton=document.createElement("button"),this._clearButton.classList.add("clear-button"),this._clearButton.innerHTML="",this._clearButton.addEventListener("click",this._clearSearch),this._searchInput=document.createElement("input"),this._searchInput.classList.add("search-input"),this._searchInput.placeholder="Search...",this._searchInput.addEventListener("input",this._handleSearch),e.appendChild(this._searchInput),e.appendChild(this._clearButton),e}_updateButtonState(e,t){e.classList.add("selected"),e.classList.remove("unselected"),t.classList.add("unselected"),t.classList.remove("selected")}_updateArrowText(e,t,n){e.textContent=`${t?"":""}${n}`}_createSortingHandlers(e,t,n,r){return{alpha:()=>{this._config.sort==="alphabetical"&&(n=!n,this._updateArrowText(e,n,"ABC")),this._config.sort="alphabetical",this._config.sortAscending=n,this._updateButtonState(e,t),this._handleSort()},numeric:()=>{this._config.sort==="count"&&(r=!r,this._updateArrowText(t,r,"123")),this._config.sort="count",this._config.sortAscending=r,this._updateButtonState(t,e),this._handleSort()},reset:()=>{var o,s;(s=(o=this._config).onClick)==null||s.call(o,void 0),this.setSelectedItem(void 0)}}}_createSortingBlock(){const e=document.createElement("div"),t=document.createElement("div"),[n,r]=[document.createElement("div"),document.createElement("div")],o=document.createElement("div");e.classList.add("sorting-block"),t.classList.add("buttons-container"),o.classList.add("reset-text","unselected");const s=this._config.sort==="alphabetical"?this._config.sortAscending:!0,a=this._config.sort==="count"?this._config.sortAscending:!0;return this._updateArrowText(n,s??!1,"ABC"),this._updateArrowText(r,a??!1,"123"),o.textContent="reset selection",this._config.sort&&this._updateButtonState(this._config.sort==="alphabetical"?n:r,this._config.sort==="alphabetical"?r:n),this._sortingHandlers=this._createSortingHandlers(n,r,s??!1,a??!1),n.addEventListener("click",this._sortingHandlers.alpha),r.addEventListener("click",this._sortingHandlers.numeric),o.addEventListener("click",this._sortingHandlers.reset),t.append(n,r),e.append(t,o),e}_createShowMoreButton(){const e=document.createElement("div");e.classList.add("show-more"),e.addEventListener("click",this._handleShowMore);const t=document.createElement("span");return this._showMoreCount=document.createElement("span"),this._showMoreCount.classList.add("show-more-count"),e.appendChild(t),e.appendChild(this._showMoreCount),e}_calculateVisibleItems(){const e=this._itemHeight+this._itemMargin;this._visibleItemsCount=Math.ceil(this._scrollContainer.clientHeight/e)}_createBarElement(e,t=!1,n){var r,o,s,a,l,c,u;if(t){const _=document.createElement("div");_.classList.add("bar-highlighted"),_.dataset.label=e.label,_.style.position="absolute";const T=n/e.count*(e.count/this._maxCount)*100;return _.style.width=`${T}%`,_}const h=document.createElement("div");if(h.classList.add("row"),h.style.position="absolute",(r=this._config)!=null&&r.onClick&&(h.style.cursor="pointer",h.addEventListener("click",()=>{var _,T;return(T=(_=this._config).onClick)==null?void 0:T.call(_,e)})),this._selectedItem){const _=this._container.querySelector(".reset-text");_==null||_.classList.remove("unselected"),_==null||_.classList.add("selected"),h.classList.add(this._selectedItem.label===e.label?"selected":"unselected")}const d=e.count/this._maxCount*100,f=document.createElement("div");f.classList.add("bar"),f.style.width=`${d}%`;const p=document.createElement("div");p.classList.add("info");const b=document.createElement("div");b.classList.add("label"),b.textContent=e.label,b.title=e.label;const g=document.createElement("div");if(g.classList.add("count"),this._isFilteringActive&&n!==void 0){const _=((s=(o=this._config).countFormatter)==null?void 0:s.call(o,n))??n.toString();if(this._config.showTotalWhenFiltered){const T=((l=(a=this._config).countFormatter)==null?void 0:l.call(a,e.count))??e.count.toString();g.textContent=`${_} / ${T}`}else g.textContent=_}else g.textContent=((u=(c=this._config).countFormatter)==null?void 0:u.call(c,e.count))??e.count.toString();return p.append(b,g),h.append(f,p),h}_renderItems(){this._renderItemsToContainer(this._barsContainer,!1),this._renderItemsToContainer(this._highlightedBarsContainer,!0)}_renderItemsToContainer(e,t){var n;const r=this._itemHeight+this._itemMargin;if(t){if(!this._highlightedCounts){e.replaceChildren();return}const o=new Map;for(const a of Array.from(e.children)){const l=a;l.classList.contains("bar-highlighted")&&l.dataset.label&&o.set(l.dataset.label,l)}const s=new Set;for(let a=this._startIndex;a<this._endIndex;a++){const l=this._data[a];if(!l)continue;const c=this._highlightedCounts.get(l.label)||0;if(c>0){s.add(l.label);const u=o.get(l.label);if(u){const h=c/l.count*(l.count/this._maxCount)*100;u.style.width=`${h}%`,u.style.top=`${a*r}px`}else{const h=this._createBarElement(l,!0,c);h.style.top=`${a*r}px`,h.style.height=`${this._itemHeight}px`,e.appendChild(h)}}}for(const[a,l]of o)s.has(a)||l.remove()}else{const o=document.createDocumentFragment();for(let s=this._startIndex;s<this._endIndex;s++){const a=this._data[s];if(!a)continue;const l=((n=this._highlightedCounts)==null?void 0:n.get(a.label))||0,c=this._createBarElement(a,!1,l);c.style.top=`${s*r}px`,c.style.height=`${this._itemHeight}px`,o.appendChild(c)}e.replaceChildren(o)}}_updateContainerHeights(e){const t=Math.min(this._originalData.length,this._maxDisplayedItems)*e;this._scrollContainer.style.height=`${t}px`;const n=`${this._data.length*e}px`;this._barsContainer.style.height=n,this._highlightedBarsContainer.style.height=n}_updateShowMoreButton(){if(this._originalData.length>this._maxDisplayedItems){const e=this._data.length>this._maxDisplayedItems;this._showMoreButton.style.visibility=e?"visible":"hidden",this._showMoreButton.style.display="flex"}else this._showMoreButton.style.display="none"}_updateUIElements(e=Ys.showSortingBlock,t=Ys.showSearch){this._originalData.length?this._data.length?(this._sortingBlock.style.visibility=e?"visible":"hidden",this._searchContainer.style.display=t?"block":"none",this.hideState(),this._scrollContainer.style.visibility="visible"):(this._sortingBlock.style.visibility=e?"visible":"hidden",this._searchContainer.style.display=t?"block":"none",this._scrollContainer.style.visibility="visible",this.showState(this._searchInput.value.length?"No results found":void 0)):(this._sortingBlock.style.visibility="hidden",this._searchContainer.style.display="none",this._scrollContainer.style.visibility="hidden",this._showMoreButton.style.display="none",this.showState())}_render(){this._maxCount=Math.max(...this._data.map(r=>r.count),1),this._calculateItemDimensions();const{showSortingBlock:e,showSearch:t}=this._config,n=this._itemHeight+this._itemMargin;this._updateContainerHeights(n),this._updateShowMoreButton(),this._updateUIElements(e,t),this._calculateVisibleItems(),this._updateVisibleItems()}_calculateItemDimensions(){if(!this._data.length)return;const e=this._createBarElement(this._data[0]);this._barsContainer.appendChild(e);const t=window.getComputedStyle(e);this._itemHeight=e.offsetHeight,this._itemMargin=parseFloat(t.marginTop)+parseFloat(t.marginBottom),this._barsContainer.removeChild(e)}_calcHiddenSum(){if(this._data.length>this._maxDisplayedItems){const e=this._data.slice(this._maxDisplayedItems);this._isFilteringActive?this._hiddenItemsSum=e.reduce((t,n)=>{var r;const o=((r=this._highlightedCounts)==null?void 0:r.get(n.label))||0;return t+o},0):this._hiddenItemsSum=e.reduce((t,n)=>t+n.count,0)}else this._hiddenItemsSum=0;this._handleShowMoreCount()}getConfig(){return this._config}setConfig(e){this._config=Ct(Ys,e??{}),this.setDisplayStateConfig(ei.extractConfig(this._config,Ys)),this._isExpanded=(e==null?void 0:e.expanded)??!1,this._calcHiddenSum(),this._render()}setData(e=[]){var t,n;this._clearSearch(),this._uniqueValues=new Set(e),this._countMap=new Int32Array(this._uniqueValues.size);const r=new Map([...this._uniqueValues].map((o,s)=>[o,s]));e.forEach(o=>{const s=r.get(o);s!==void 0&&this._countMap[s]++}),this._data=[...this._uniqueValues].map((o,s)=>({label:o,count:this._countMap[s]||0})),this._originalData=[...this._data],!this._originalData.length&&this._selectedItem&&(this.setSelectedItem(void 0),(n=(t=this._config).onClick)==null||n.call(t,void 0)),this._searchContainer.style.display=this._originalData.length?"block":"none",this._handleSort()}sortByCount(e=!1){this._data.sort((t,n)=>e?t.count-n.count:n.count-t.count),this._calcHiddenSum(),this._render()}sortAlphabetically(e=!0){this._data.sort((t,n)=>e?t.label.toString().localeCompare(n.label):n.label.toString().localeCompare(t.label)),this._calcHiddenSum(),this._render()}destroy(){this._scrollContainer.removeEventListener("scroll",this._handleScroll),this._searchInput.removeEventListener("input",this._handleSearch),this._clearButton.removeEventListener("click",this._clearSearch),this._showMoreButton.removeEventListener("click",this._handleShowMore);const e=this._sortingBlock.querySelector("div:first-child"),t=this._sortingBlock.querySelector("div:nth-child(2)"),n=this._sortingBlock.querySelector(".reset-text");e==null||e.removeEventListener("click",this._sortingHandlers.alpha),t==null||t.removeEventListener("click",this._sortingHandlers.numeric),n==null||n.removeEventListener("click",this._sortingHandlers.reset),this._container.innerHTML="",this._data=[],this._originalData=[],this._uniqueValues.clear(),this._countMap=new Int32Array(0),this._hiddenItemsSum=0,this._highlightedCounts=void 0,this._isFilteringActive=!1,super.destroy()}resetList(){this._scrollContainer.scrollTop=0,this._searchInput.value="",this._selectedItem=void 0,this._highlightedCounts=void 0,this._isFilteringActive=!1,this._data=[...this._originalData],this._updateVisibleItems()}getSelectedItem(){return this._selectedItem}setSelectedItem(e){if(!e){const t=this._container.querySelector(".reset-text");t==null||t.classList.remove("selected"),t==null||t.classList.add("unselected")}this._selectedItem=e,this._updateVisibleItems()}setHighlightedData(e){if(e==null)this._highlightedCounts=void 0,this._isFilteringActive=!1;else{this._highlightedCounts=new Map;for(const n of e)this._highlightedCounts.set(n,(this._highlightedCounts.get(n)||0)+1);const t=this._originalData.reduce((n,r)=>n+r.count,0);this._isFilteringActive=e.length<t}this._calcHiddenSum(),this._renderItems()}setLoadingState(){super.setLoadingState()}};const Zu={hidden:!1,label:void 0,labelFormatter:Wn,extent:void 0,extentLabels:void 0,enableEvents:!0,form:"point",showSublabels:!1,minSubLabel:"min",maxSubLabel:"max",sizeMultiplier:void 0,onClick:void 0,onMinClick:void 0,onMaxClick:void 0,onHover:void 0,noDataMessage:"No legend data",loadingMessage:"Data loading..."},Oj="style_module_container__d2889234",Fj="style_module_legend__75c167f2",zj="style_module_enabled__91eae57a",Uj="style_module_disabled__d51f7a10",$j="style_module_hovered__1206707f",Pn={container:Oj,legend:Fj,enabled:zj,disabled:Uj,hovered:$j};(function(){try{if(typeof document<"u"){var i=document.createElement("style");i.appendChild(document.createTextNode('@keyframes style_module_fadeIn__ffac87fd{0%{opacity:0}to{opacity:.2}}.style_module_displayState__6ae19b84{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--cosmograph-ui-text);display:flex;justify-content:center;align-items:center;min-width:100px;opacity:.2;font-size:calc(var(--cosmograph-ui-font-size) + 1px);letter-spacing:-.02em;font-weight:200;user-select:none;-webkit-user-select:none;animation:style_module_fadeIn__ffac87fd .3s ease-in-out}:root{--cosmograph-timeline-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-timeline-selection-opacity: .5;--cosmograph-timeline-bar-color: var(--cosmograph-ui-element-color);--cosmograph-timeline-highlighted-bar-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-timeline-font-family: var(--cosmograph-ui-font-family);--cosmograph-timeline-font-size: var(--cosmograph-ui-tick-font-size);--cosmograph-timeline-background: var(--cosmograph-ui-background);--cosmograph-timeline-text-color: var(--cosmograph-ui-text);--cosmograph-timeline-axis-color: var(--cosmograph-ui-text)}.style_module_timeline__736434f7{position:relative;display:flex;background:var(--cosmograph-timeline-background);width:100%;min-height:25px;overflow:hidden}.style_module_timelineSvg__b916ad04{position:relative;width:100%;height:100%}.style_module_selection__ebee57f8{fill:var(--cosmograph-timeline-selection-color);fill-opacity:var(--cosmograph-timeline-selection-opacity);stroke:none}.style_module_axisTick__5865631d{color:var(--cosmograph-timeline-axis-color);font:var(--cosmograph-timeline-font-family);font-size:var(--cosmograph-timeline-font-size);user-select:none;-webkit-user-select:none;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum";alignment-baseline:text-before-edge}.style_module_axisLine__992b502d{opacity:.2;color:var(--cosmograph-timeline-axis-color)}.style_module_bar__114fa79f{fill:var(--cosmograph-timeline-bar-color);transform:scaleY(-1);opacity:0}.style_module_animationControl__ee52cd66{color:var(--cosmograph-timeline-axis-color);width:6%;max-width:30px;min-width:20px;cursor:pointer;display:none;align-items:center;user-select:none;-webkit-user-select:none;opacity:.5;position:relative;justify-content:center}.style_module_animationControl__ee52cd66>svg{width:50%;max-height:20px;padding-right:2px}.style_module_hidden__a73fe81a{display:none}.style_module_disabled__eb988570{opacity:.2;pointer-events:none}.style_module_highlightedBar__c2fc9bdc{fill:var(--cosmograph-timeline-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-search-font-family: var(--cosmograph-ui-font-family);--cosmograph-search-font-size: 14px;--cosmograph-search-list-font-size: 13.5px;--cosmograph-search-text-color: var(--cosmograph-ui-text);--cosmograph-search-background: transparent;--cosmograph-search-list-background: rgba(0, 0, 0, .2);--cosmograph-search-list-match-background: rgba(255, 255, 255, .2);--cosmograph-search-list-match-color: var(--cosmograph-ui-text)}.style_module_searchInput__d7830601:hover{filter:brightness(1.2) contrast(1)}.style_module_searchInput__d7830601{width:100%;background:transparent;color:var(--cosmograph-search-text-color);border:none;border-bottom:.5px solid var(--cosmograph-search-text-color);padding:4px 20px 5px 2px;font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:opacity .2s ease-out}.style_module_searchInput__d7830601::selection{background:var(--cosmograph-search-list-match-background)}.style_module_searchInput__d7830601:focus{outline:none}.style_module_searchSuggestions__b0d3f71e{color:#fff;width:100%;padding:0;margin:0;background:transparent;overflow-y:auto;flex:1;min-height:0}.style_module_searchSuggestions__b0d3f71e li{padding:5px 10px;cursor:pointer;-webkit-user-select:none;user-select:none;display:block;font-weight:500;font-size:var(--cosmograph-search-list-font-size);max-width:100%;overflow:hidden}.style_module_searchSuggestions__b0d3f71e li>div{white-space:nowrap;font-weight:200;overflow:hidden;text-overflow:ellipsis;width:100%}.style_module_searchSuggestions__b0d3f71e li:hover{background:#ffffff1a}.style_module_searchSuggestions__b0d3f71e mark{background:var(--cosmograph-search-list-match-background);color:var(--cosmograph-search-list-match-color);border-radius:2px}.style_module_clearButton__5ebb41de{position:absolute;right:0;top:0;height:100%;background:none;border:none;color:var(--cosmograph-search-text-color);font-weight:300;cursor:pointer;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d{opacity:.7}.style_module_placeholderWrapper__72d5eb0e{z-index:1;color:var(--cosmograph-search-text-color);font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);position:absolute;top:0;left:0;width:100%;bottom:0;display:flex;line-height:1.25;align-items:center;transition:transform .3s ease-out,opacity .3s ease-out}.style_module_placeholderWrapper__72d5eb0e.style_module_hidden__acfb8431{transform:translate(-30px);pointer-events:none;opacity:0}.style_module_searchInput__d7830601:disabled,.style_module_searchInput__d7830601.style_module_disabled__62c35dc5{opacity:.2;cursor:not-allowed;pointer-events:none}.style_module_disabled__62c35dc5 .style_module_clearButton__5ebb41de{display:none}.style_module_disabled__62c35dc5 .style_module_placeholderWrapper__72d5eb0e{opacity:.3;cursor:not-allowed}.style_module_searchInputWrapper__1edbcb22{position:relative;display:flex;width:100%}.style_module_noResults__363397c3{opacity:.3!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none}.style_module_noResults__363397c3:hover{background:none}.style_module_loading__296e0212{opacity:.7!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none;-webkit-user-select:none;user-select:none}.style_module_dropdownContainer__d98287da{position:absolute;top:100%;left:0;width:100%;background:var(--cosmograph-search-list-background);border-radius:4px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);opacity:0;transform:translateY(-10px);transition:opacity .2s ease-out,transform .2s ease-out;pointer-events:none;overflow:hidden;z-index:10;display:flex;flex-direction:column;padding-bottom:2px}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b{top:auto;bottom:100%;transform:translateY(10px)}.style_module_dropdownContainer__d98287da.style_module_visible__5be7493d{opacity:1;transform:translateY(0);pointer-events:auto}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b.style_module_visible__5be7493d{opacity:1;transform:translateY(-2px);pointer-events:auto}.style_module_footerContainer__73e7a066{flex-shrink:0}:root{--cosmograph-scrollbar-background: rgba(255, 255, 255, .1);--cosmograph-ui-background: rgb(45, 49, 58);--cosmograph-ui-text: #ffffffc7;--cosmograph-ui-tick-font-size: 11px;--cosmograph-ui-font-size: 12px;--cosmograph-ui-font-family: inherit;--cosmograph-ui-element-color: #5C616A;--cosmograph-ui-highlighted-element-color: white;--cosmograph-ui-selection-control-color: #8d949ea8;-webkit-font-smoothing:antialiased!important;text-rendering:optimizeLegibility!important}.style_module_cosmograph-ui__5acb97f1{background:var(--cosmograph-ui-background);color:var(--cosmograph-ui-text)}.style_module_scrollbar__f1516254 *::-webkit-scrollbar{width:5px;height:5px;border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-track{border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-corner{background:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-button{display:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-thumb{background-color:var(--cosmograph-scrollbar-background);transition:background-color .5s;border-radius:20px;border:3px solid var(--cosmograph-scrollbar-background)}@-moz-document url-prefix(){.style_module_scrollbar__f1516254 *{scrollbar-width:thin;scrollbar-color:var(--cosmograph-scrollbar-background) transparent;scrollbar-track-color:transparent;scrollbar-face-color:var(--cosmograph-scrollbar-background)}}:root{--cosmograph-histogram-background: var(--cosmograph-ui-background);--cosmograph-histogram-text-color: var(--cosmograph-ui-text);--cosmograph-histogram-axis-color: var(--cosmograph-ui-text);--cosmograph-histogram-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-histogram-selection-opacity: .5;--cosmograph-histogram-bar-color: var(--cosmograph-ui-element-color);--cosmograph-histogram-highlighted-bar-color: var( --cosmograph-ui-highlighted-element-color);--cosmograph-histogram-font-family: var(--cosmograph-ui-font-family);--cosmograph-histogram-font-size: var(--cosmograph-ui-tick-font-size)}.style_module_histogram__9d8a77ea{position:relative;display:flex;min-height:25px;background:var(--cosmograph-histogram-background);width:100%}.style_module_histogramSvg__ccccb628{position:relative;width:100%;height:100%}.style_module_selection__7db96137{fill:var(--cosmograph-histogram-selection-color);fill-opacity:var(--cosmograph-histogram-selection-opacity);stroke:none}.style_module_axisTick__898e1f39{color:var(--cosmograph-histogram-axis-color);font-family:var(--cosmograph-histogram-font-family);font-size:var(--cosmograph-histogram-font-size);user-select:none;-webkit-user-select:none;alignment-baseline:text-before-edge;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum"}.style_module_bar__3c9ab488{fill:var(--cosmograph-histogram-bar-color);transform:scaleY(-1)}.style_module_highlightedBar__b193a8de{fill:var(--cosmograph-histogram-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-bars-font-color: var(--cosmograph-ui-text);--cosmograph-bars-font-family: var(--cosmograph-ui-font-family);--cosmograph-bars-font-size: var(--cosmograph-ui-font-size);--cosmograph-bars-ui-font-size: 11.5px;--cosmograph-bars-background: var(--cosmograph-ui-element-color);--cosmograph-bars-bar-height: 20px;--cosmograph-bars-bar-bottom-margin: 2px;--cosmograph-bars-highlighted-color: var( --cosmograph-ui-highlighted-element-color)}.style_module_bars__25497ded{position:relative;width:100%;min-height:100px;user-select:none;flex-direction:column;-webkit-user-select:none}.style_module_bars__25497ded .scroll-container{position:relative;width:100%;overflow-y:hidden;overflow-x:hidden}.style_module_bars__25497ded .bars-container{position:relative;width:calc(100% - 1px);font-family:var(--cosmograph-bars-font-family)}.style_module_bars__25497ded .highlighted-bars-container{position:absolute;top:0;left:0;pointer-events:none}.style_module_bars__25497ded .row{height:var(--cosmograph-bars-bar-height);display:flex;align-items:center;margin-bottom:var(--cosmograph-bars-bar-bottom-margin);width:100%;transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row:hover{filter:brightness(1.15) contrast(1.05);transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row.unselected:hover{filter:brightness(.95) contrast(1.15);transition:filter .05s linear}.style_module_bars__25497ded .unselected{opacity:.85;filter:brightness(.8) contrast(1.1)}.style_module_bars__25497ded .selected{filter:brightness(1.05) contrast(1.05)}.style_module_bars__25497ded .selected>.info>.label{font-weight:600;filter:brightness(1.1) contrast(1.05)}.style_module_bars__25497ded .unselected>.info>.label{font-weight:300}.style_module_bars__25497ded .bar{height:100%;background-color:var(--cosmograph-bars-background);opacity:.8;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .bar-highlighted{height:100%;background-color:var(--cosmograph-bars-highlighted-color);opacity:.2;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .info{display:flex;justify-content:space-between;width:100%;padding:0 4px;position:absolute;font-size:var(--cosmograph-bars-font-size);font-feature-settings:"tnum";color:var(--cosmograph-bars-font-color);gap:2px}.style_module_bars__25497ded .label{min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:opacity .05s linear}.style_module_bars__25497ded .count{flex-shrink:0;font-weight:300;opacity:.8;transition:opacity .05s linear}.style_module_bars__25497ded .show-more{cursor:pointer;padding-top:2px;display:flex;font-weight:300;color:var(--cosmograph-bars-font-color);font-size:11px;justify-content:space-between;opacity:.6;font-size:var(--cosmograph-bars-ui-font-size);pointer-events:none;transition:opacity .1s linear}.style_module_bars__25497ded .show-more:hover{opacity:1;text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .show-more>span{pointer-events:all}.style_module_bars__25497ded .show-more-count{padding-right:5px;pointer-events:all;font-feature-settings:"tnum"}.style_module_bars__25497ded .unselected>.info>.label,.style_module_bars__25497ded .unselected>.info>.count{opacity:.5}.style_module_bars__25497ded .unselected:hover>.info>.label,.style_module_bars__25497ded .unselected:hover>.info>.count{opacity:1}.style_module_bars__25497ded .search-input{background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,.3);font-size:13px!important;color:var(--cosmograph-bars-font-color);line-height:1.5;padding:2px;width:100%;position:relative;transition:border-bottom-color .2s}.style_module_bars__25497ded .search-input::placeholder{color:var(--cosmograph-bars-font-color)!important;opacity:.4;font-weight:300;font-family:inherit}.style_module_bars__25497ded .search-container{position:relative;width:100%;margin-bottom:4px;display:none;z-index:1}.style_module_bars__25497ded .clear-button{position:absolute;right:0;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--cosmograph-bars-font-color);font-weight:300;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_bars__25497ded .clear-button.visible:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_bars__25497ded .clear-button.visible{opacity:.7}.style_module_bars__25497ded .clear-button svg{width:10px;height:10px;fill:currentColor}.style_module_bars__25497ded .sorting-block{visibility:hidden;margin-top:1px;display:flex;justify-content:space-between}.style_module_bars__25497ded .buttons-container{margin-top:4px;font-size:var(--cosmograph-bars-ui-font-size);display:flex;gap:4px;line-height:1.25}.style_module_bars__25497ded .buttons-container>div{transition:opacity .05s linear,filter .05s linear;padding:1px 5px;background:var(--cosmograph-bars-background);border-radius:4px;opacity:.9;display:flex;cursor:pointer;align-items:center}.style_module_bars__25497ded .buttons-container>div:hover{filter:brightness(1.2)}.style_module_bars__25497ded .reset-text{transition:opacity .05s linear,filter .05s linear;display:flex;font-size:var(--cosmograph-bars-ui-font-size);align-items:end;padding-right:4px;cursor:pointer;font-weight:300}.style_module_bars__25497ded .reset-text:hover{text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .reset-text.unselected{pointer-events:none;cursor:default;opacity:.7}.style_module_bars__25497ded :scope.reset-text:hover:not(.unselected){filter:brightness(1.5);opacity:1}:root{--cosmograph-size-legend-form-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-family: inherit;--cosmograph-size-legend-font-size: var(--cosmograph-ui-font-size);--cosmograph-size-legend-sublabel-font-size: 10px;--cosmograph-size-legend-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-size-legend-line-radius: 2px;--cosmograph-size-legend-line-width: 30px;--cosmograph-size-legend-hide-transform: translateY(100%);--cosmograph-size-legend-show-transform: translateX(0)}.style_module_container__d2889234{display:flex;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;overflow:hidden;min-height:25px}.style_module_legend__75c167f2{width:auto;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-size-legend-font-size);font-family:var(--cosmograph-size-legend-font-family);user-select:none;-webkit-user-select:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.04em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__91eae57a{opacity:1;transform:var(--cosmograph-size-legend-show-transform)}.style_module_disabled__d51f7a10{opacity:0;transform:var(--cosmograph-size-legend-hide-transform);pointer-events:none;display:none!important;min-height:0}@starting-style{.style_module_container__d2889234.style_module_enabled__91eae57a,.style_module_legend__75c167f2.style_module_enabled__91eae57a{opacity:0;transform:var(--cosmograph-size-legend-hide-transform)}}.style_module_legend__75c167f2 .circle{background-color:var(--cosmograph-size-legend-form-color);border-radius:50%;transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2 .line{background-color:var(--cosmograph-size-legend-form-color);border-radius:var(--cosmograph-size-legend-line-radius);width:var(--cosmograph-size-legend-line-width);transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2.style_module_events__894316a8{pointer-events:auto;cursor:pointer}.style_module_legend__75c167f2 .legend-content{display:flex;align-items:end;justify-content:center;gap:.75rem}.style_module_legend__75c167f2 .legend-content>div{transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__75c167f2 .labels-wrapper{white-space:nowrap}.style_module_legend__75c167f2 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-size-legend-items-margin)}.style_module_legend__75c167f2 .name{align-items:center;text-align:center;justify-content:center;display:flex;color:var(--cosmograph-size-legend-font-color);overflow:hidden;width:100%;margin-top:3px;word-break:break-all;white-space:pre-line;transition:color .15s ease-in-out;letter-spacing:-.02em}.style_module_legend__75c167f2 .label{color:var(--cosmograph-size-legend-font-color);overflow:hidden;transition:color .15s ease-in-out;text-overflow:ellipsis;font-feature-settings:"tnum"}.style_module_legend__75c167f2 .sublabel{padding-top:1px;font-size:var(--cosmograph-size-legend-sublabel-font-size);opacity:.5;line-height:1;min-width:10px;transition:color .15s ease-in-out}.style_module_hovered__1206707f .label,.style_module_hovered__1206707f .sublabel{color:var(--cosmograph-size-legend-hover-color);cursor:pointer}.style_module_hovered__1206707f .circle,.style_module_hovered__1206707f .line{background-color:var(--cosmograph-size-legend-hover-color);cursor:pointer}:root{--cosmograph-color-legend-range-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-range-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-range-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-label-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-sublabel-font-size: 10px;--cosmograph-color-legend-range-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-range-gradient-height: 6px;--cosmograph-color-legend-range-gradient-radius: 8px;--cosmograph-color-legend-range-gradient-top-margin: 6px;--cosmograph-color-legend-hide-transform: translateY(100%);--cosmograph-color-legend-show-transform: translateX(0)}.style_module_container__05cc807d{display:flex;min-width:150px;min-height:25px;width:100%;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_legend__a3e235e4{width:100%;font-weight:300;letter-spacing:-.04em;display:flex;flex-direction:column;font-size:var(--cosmograph-color-legend-range-font-size);font-family:var(--cosmograph-color-legend-range-font-family);user-select:none;-webkit-user-select:none;pointer-events:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__b3120e27{opacity:1;transform:var(--cosmograph-color-legend-show-transform);pointer-events:auto}.style_module_disabled__c2dc158c{opacity:0;transform:var(--cosmograph-color-legend-hide-transform);pointer-events:none;display:none;min-height:0}@starting-style{.style_module_container__05cc807d.style_module_enabled__b3120e27,.style_module_legend__a3e235e4.style_module_enabled__b3120e27{opacity:0;transform:var(--cosmograph-color-legend-hide-transform)}}.style_module_legend__a3e235e4 .legend-content{display:flex;align-items:end;justify-content:space-between}.style_module_hovered__dfd7bb2c .label,.style_module_hovered__dfd7bb2c .sublabel{color:var(--cosmograph-size-legend-hover-color)!important;cursor:pointer}.style_module_legend__a3e235e4 .extent{white-space:nowrap;transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__a3e235e4 .gradient{width:100%;margin-top:var(--cosmograph-color-legend-range-gradient-top-margin);height:var(--cosmograph-color-legend-range-gradient-height);border-radius:var(--cosmograph-color-legend-range-gradient-radius)}.style_module_legend__a3e235e4 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-color-legend-range-items-margin)}.style_module_legend__a3e235e4 .name{align-items:center;text-align:center;justify-content:space-around;display:flex;color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;width:100%;word-break:break-word;text-wrap:balance;white-space:pre-line;transition:color .15s ease-in-out;margin:0 4px;letter-spacing:-.02em;line-height:1.25}.style_module_legend__a3e235e4 .label{color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;max-width:150px;text-overflow:ellipsis;font-size:var(--cosmograph-color-legend-range-label-font-size);transition:color .15s ease-in-out;line-height:1;font-feature-settings:"tnum"}.style_module_legend__a3e235e4 .sublabel{padding-top:1px;color:var(--cosmograph-color-legend-range-font-color);opacity:.55;font-size:var(--cosmograph-color-legend-range-sublabel-font-size);line-height:1;transition:color .15s ease-in-out}:root{--cosmograph-color-legend-type-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-type-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-type-font-size: 11px;--cosmograph-color-legend-type-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-type-others-color: #bab0ab;--cosmograph-color-legend-type-bullet-size: 8px;--cosmograph-color-legend-type-bullet-radius: 1rem;--cosmograph-color-legend-type-items-margin: 4px;--cosmograph-color-legend-type-hide-transform: translateY(125%);--cosmograph-color-legend-type-show-transform: translateX(0)}.style_module_enabled__277b2403{opacity:1;transform:var(--cosmograph-color-legend-type-show-transform)}.style_module_disabled__7a587f96{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform);display:none!important;min-height:0}.style_module_wrapper__ea8ca7f4{position:relative;max-width:100%;width:fit-content;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_typeLegend__15bf4b2f{position:relative;width:fit-content;max-width:100%;min-height:25px;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.015em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_typeLegend__15bf4b2f .reverted{flex-direction:row-reverse}.style_module_typeLegend__15bf4b2f .scroll-container{width:100%;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-color-legend-type-font-size);font-family:var(--cosmograph-color-legend-type-font-family);user-select:none;-webkit-user-select:none;line-height:normal;overflow-x:hidden;overflow-y:auto;will-change:transform}@starting-style{.style_module_typeLegend__15bf4b2f.style_module_enabled__277b2403,.style_module_wrapper__ea8ca7f4.style_module_enabled__277b2403{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform)}}.style_module_typeLegend__15bf4b2f .legend-item{display:flex;align-items:center;position:absolute;margin-bottom:var(--cosmograph-color-legend-type-items-margin);pointer-events:none;width:100%;padding-left:1px;font-weight:300;transition:filter .1s ease-in-out,opacity .1s ease-in-out;min-height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px + var(--cosmograph-color-legend-type-items-margin));height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px);box-sizing:border-box}.style_module_typeLegend__15bf4b2f .unknown{background-color:var(--cosmograph-color-legend-type-unknown-color)}.style_module_typeLegend__15bf4b2f .others{background-color:var(--cosmograph-color-legend-type-others-color)}.style_module_typeLegend__15bf4b2f .bullet{height:var(--cosmograph-color-legend-type-bullet-size);width:var(--cosmograph-color-legend-type-bullet-size);min-height:var(--cosmograph-color-legend-type-bullet-size);min-width:var(--cosmograph-color-legend-type-bullet-size);border-radius:var(--cosmograph-color-legend-type-bullet-radius);pointer-events:all;margin-right:5px}.style_module_typeLegend__15bf4b2f .label{color:var(--cosmograph-color-legend-type-font-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - var(--cosmograph-color-legend-type-bullet-size) - 5px);pointer-events:all;transition:.05s linear color}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.bullet{margin-right:0}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.label{margin-right:5px}.style_module_typeLegend__15bf4b2f .show-more{cursor:pointer;padding-top:4px;display:none;font-weight:300;color:var(--cosmograph-color-legend-type-font-color);font-size:11px;opacity:.6;pointer-events:all;justify-content:space-between;transition:opacity .1s linear;font-feature-settings:"tnum"}.style_module_typeLegend__15bf4b2f .show-more:hover{opacity:1}.style_module_hovered__c0993502 .label,.style_module_hovered__c0993502 .sublabel{color:var(--cosmograph-color-legend-type-hover-color)!important;cursor:pointer}.style_module_selected__36e1dd81{filter:brightness(1)}.style_module_selected__36e1dd81>.style_module_label__afecc7a3{filter:brightness(1.2)}.style_module_unselected__4826cfb7{filter:brightness(.5)}.style_module_typeLegend__15bf4b2f .name{font-size:calc(var(--cosmograph-color-legend-type-font-size) + 1px);font-family:var(--cosmograph-color-legend-type-font-family);color:var(--cosmograph-color-legend-type-font-color);transition:color .15s ease-in-out,opacity .3s ease-in-out,max-height .3s ease-in-out,transform .3s ease-in-out;margin-bottom:4px;margin-top:2px;margin-left:1px;letter-spacing:-.02em;line-height:1.25;overflow:hidden;width:100%;white-space:nowrap;text-overflow:ellipsis;pointer-events:all;-webkit-user-select:none!important;user-select:none!important;max-height:100px;opacity:1;transform:translateY(0)}.style_module_typeLegend__15bf4b2f .name.hidden{opacity:0;max-height:0;margin-bottom:0;margin-top:0;transform:translateY(-10px)}:root{--cosmograph-button-color: var(--cosmograph-ui-text);--cosmograph-button-background: var(--cosmograph-ui-element-color);--cosmograph-button-border-radius: 2px}.style_module_button__e95a1138{background:var(--cosmograph-button-background);color:var(--cosmograph-button-color);border-radius:var(--cosmograph-button-border-radius);display:none;align-items:center;justify-content:center;width:25px;height:25px;margin:3px;padding:5px;cursor:pointer;filter:brightness(.95) contrast(.9);transition:filter .1s}.style_module_button__e95a1138:hover{filter:brightness(1.2) contrast(1)}')),document.head.appendChild(i)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();var Vj=Object.defineProperty,Hj=(i,e,t)=>e in i?Vj(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ur=(i,e,t)=>Hj(i,typeof e!="symbol"?e+"":e,t);let Gj=class extends ei{constructor(e,t){const n=Ct(Zu,t??{});super(e,ei.extractConfig(n,Zu)),Ur(this,"_config"),Ur(this,"_containerNode"),Ur(this,"_legend"),Ur(this,"_sizeElements",null),Ur(this,"_isHidden",!1),Ur(this,"_handleClick",r=>{var o,s;this._config.enableEvents&&((s=(o=this._config).onClick)==null||s.call(o,r))}),Ur(this,"_handleHover",r=>{var o,s;this._config.enableEvents&&((s=(o=this._config).onHover)==null||s.call(o,r))}),Ur(this,"_handleSizeElementHover",r=>{var o,s,a,l;if(!this._config.enableEvents||!this._config.extent||!this._sizeElements)return;const c=r.currentTarget;if(!c)return;const u=c.classList.contains("min")?"min":"max",h=r.type==="mouseenter",d=u==="min"?0:this._config.extent.length-1,f=(o=this._config.extent)==null?void 0:o[d],p=(s=this._config.extentLabels)==null?void 0:s[d];c.classList.toggle(Pn.hovered,h),(l=(a=this._config).onHover)==null||l.call(a,{target:c,type:u,size:f,value:p})}),Ur(this,"_handleSizeElementClick",r=>{var o,s;if(!this._config.enableEvents)return;const a=r.currentTarget.className.includes("min")?"min":"max",l=a==="min"?this._config.onMinClick:this._config.onMaxClick;if(l){const c=((o=this._config.extent)==null?void 0:o[a==="min"?0:1])??void 0,u=((s=this._config.extentLabels)==null?void 0:s[a==="min"?0:1])??c;l(c,u,r)}}),this._config=n,this._containerNode=e,this._containerNode.classList.add(Pn.container),this._createElements()}hide(){this._isHidden||(this._isHidden=!0,this._containerNode.classList.remove(Pn.enabled),this._containerNode.classList.add(Pn.disabled))}show(){this._isHidden&&(this._isHidden=!1,this._containerNode.classList.remove(Pn.disabled),this._containerNode.classList.add(Pn.enabled))}setConfig(e){this._config=Ct(Zu,e??{}),this.setDisplayStateConfig(ei.extractConfig(this._config,Zu)),this._updateLegend()}setLoadingState(){super.setLoadingState()}destroy(){this._legend&&(this._legend.removeEventListener("click",this._handleClick),this._legend.removeEventListener("mouseover",this._handleHover),this._sizeElements&&["min","max"].forEach(e=>{const t=this._sizeElements[e];t.removeEventListener("click",this._handleSizeElementClick),t.removeEventListener("mouseenter",this._handleSizeElementHover),t.removeEventListener("mouseleave",this._handleSizeElementHover)}),this._containerNode.removeChild(this._legend),super.destroy())}get sizeElements(){return this._sizeElements}get config(){return this._config}get isHidden(){return this._isHidden}_createElements(){this._legend=this._createLegendElement(),this._containerNode.appendChild(this._legend),this._isHidden||this.show()}_createLegendElement(){const e=document.createElement("div");e.classList.add(Pn.legend);const t=document.createElement("div");t.className="legend-content",this._sizeElements={min:this._createSizeElement("min"),max:this._createSizeElement("max")},t.appendChild(this._sizeElements.min),t.appendChild(this._sizeElements.max),e.appendChild(t);const n=document.createElement("div");return n.className="name",e.appendChild(n),e}_createSizeElement(e){const t=document.createElement("div");t.classList.add(e);const n=document.createElement("div");t.appendChild(n);const r=document.createElement("div");return r.className="label",t.appendChild(r),t.addEventListener("click",this._handleSizeElementClick),t.addEventListener("mouseenter",this._handleSizeElementHover),t.addEventListener("mouseleave",this._handleSizeElementHover),t}_updateLegend(){const{extent:e,extentLabels:t}=this._config,{noDataMessage:n,loadingMessage:r}=this._displayStateConfig,o=!e&&n===!1&&r===!1;if(this._config.hidden||o?this.hide():this.show(),e!=null&&e.every(Number.isFinite)&&t!=null&&t.every(Number.isFinite)){this.hideState();const s=this._legend.querySelector(".name");s&&(s.textContent=this._config.label??""),this._sizeElements&&(t[0]===t[1]?(this._updateSizeElement("min"),this._sizeElements.min.style.display="block",this._sizeElements.max.style.display="none"):(this._updateSizeElement("min"),this._updateSizeElement("max"),this._sizeElements.min.style.display="block",this._sizeElements.max.style.display="block")),this._legend.classList.remove(Pn.disabled),this._legend.classList.add(Pn.enabled)}else this.showState(),this._legend.classList.remove(Pn.enabled),this._legend.classList.add(Pn.disabled)}_updateSizeElement(e){var t,n;if(!this._sizeElements)return;const r=this._sizeElements[e];r.style.pointerEvents=this._config.enableEvents?"auto":"none";const o=((t=this._config.extent)==null?void 0:t[e==="min"?0:1])??1,s=((n=this._config.extentLabels)==null?void 0:n[e==="min"?0:1])??o,a=r.querySelector("div");this._config.form==="point"?(a.classList.remove("line"),a.classList.add("circle"),a.style.height=a.style.width=`${o*(this._config.sizeMultiplier??1)}px`):(a.style.width="",a.classList.remove("circle"),a.classList.add("line"),a.style.height=`${o*(this._config.sizeMultiplier??1)}px`);const l=r.querySelector(".label");l.textContent=this._formatLabel(s),this._updateSublabel(r,e)}_updateSublabel(e,t){let n=e.querySelector(".sublabel");this._config.showSublabels?(n||(n=document.createElement("div"),n.className="sublabel",e.appendChild(n)),n.textContent=t==="min"?this._config.minSubLabel??"min":this._config.maxSubLabel??"max"):n&&n.remove()}_formatLabel(e){return this._config.labelFormatter?this._config.labelFormatter(e):e.toString()}};const Qu={hidden:!1,label:void 0,labelFormatter:Wn,extent:void 0,extentLabels:void 0,enableEvents:!0,showSublabels:!1,minSubLabel:"min",maxSubLabel:"max",discreteColors:!1,onClick:void 0,onHover:void 0,onMaxClick:void 0,onMinClick:void 0,noDataMessage:"No legend data",loadingMessage:"Data loading..."},Wj="style_module_container__05cc807d",jj="style_module_legend__a3e235e4",Yj="style_module_enabled__b3120e27",qj="style_module_disabled__c2dc158c",Xj="style_module_hovered__dfd7bb2c",Dn={container:Wj,legend:jj,enabled:Yj,disabled:qj,hovered:Xj};(function(){try{if(typeof document<"u"){var i=document.createElement("style");i.appendChild(document.createTextNode('@keyframes style_module_fadeIn__ffac87fd{0%{opacity:0}to{opacity:.2}}.style_module_displayState__6ae19b84{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--cosmograph-ui-text);display:flex;justify-content:center;align-items:center;min-width:100px;opacity:.2;font-size:calc(var(--cosmograph-ui-font-size) + 1px);letter-spacing:-.02em;font-weight:200;user-select:none;-webkit-user-select:none;animation:style_module_fadeIn__ffac87fd .3s ease-in-out}:root{--cosmograph-timeline-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-timeline-selection-opacity: .5;--cosmograph-timeline-bar-color: var(--cosmograph-ui-element-color);--cosmograph-timeline-highlighted-bar-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-timeline-font-family: var(--cosmograph-ui-font-family);--cosmograph-timeline-font-size: var(--cosmograph-ui-tick-font-size);--cosmograph-timeline-background: var(--cosmograph-ui-background);--cosmograph-timeline-text-color: var(--cosmograph-ui-text);--cosmograph-timeline-axis-color: var(--cosmograph-ui-text)}.style_module_timeline__736434f7{position:relative;display:flex;background:var(--cosmograph-timeline-background);width:100%;min-height:25px;overflow:hidden}.style_module_timelineSvg__b916ad04{position:relative;width:100%;height:100%}.style_module_selection__ebee57f8{fill:var(--cosmograph-timeline-selection-color);fill-opacity:var(--cosmograph-timeline-selection-opacity);stroke:none}.style_module_axisTick__5865631d{color:var(--cosmograph-timeline-axis-color);font:var(--cosmograph-timeline-font-family);font-size:var(--cosmograph-timeline-font-size);user-select:none;-webkit-user-select:none;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum";alignment-baseline:text-before-edge}.style_module_axisLine__992b502d{opacity:.2;color:var(--cosmograph-timeline-axis-color)}.style_module_bar__114fa79f{fill:var(--cosmograph-timeline-bar-color);transform:scaleY(-1);opacity:0}.style_module_animationControl__ee52cd66{color:var(--cosmograph-timeline-axis-color);width:6%;max-width:30px;min-width:20px;cursor:pointer;display:none;align-items:center;user-select:none;-webkit-user-select:none;opacity:.5;position:relative;justify-content:center}.style_module_animationControl__ee52cd66>svg{width:50%;max-height:20px;padding-right:2px}.style_module_hidden__a73fe81a{display:none}.style_module_disabled__eb988570{opacity:.2;pointer-events:none}.style_module_highlightedBar__c2fc9bdc{fill:var(--cosmograph-timeline-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-search-font-family: var(--cosmograph-ui-font-family);--cosmograph-search-font-size: 14px;--cosmograph-search-list-font-size: 13.5px;--cosmograph-search-text-color: var(--cosmograph-ui-text);--cosmograph-search-background: transparent;--cosmograph-search-list-background: rgba(0, 0, 0, .2);--cosmograph-search-list-match-background: rgba(255, 255, 255, .2);--cosmograph-search-list-match-color: var(--cosmograph-ui-text)}.style_module_searchInput__d7830601:hover{filter:brightness(1.2) contrast(1)}.style_module_searchInput__d7830601{width:100%;background:transparent;color:var(--cosmograph-search-text-color);border:none;border-bottom:.5px solid var(--cosmograph-search-text-color);padding:4px 20px 5px 2px;font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:opacity .2s ease-out}.style_module_searchInput__d7830601::selection{background:var(--cosmograph-search-list-match-background)}.style_module_searchInput__d7830601:focus{outline:none}.style_module_searchSuggestions__b0d3f71e{color:#fff;width:100%;padding:0;margin:0;background:transparent;overflow-y:auto;flex:1;min-height:0}.style_module_searchSuggestions__b0d3f71e li{padding:5px 10px;cursor:pointer;-webkit-user-select:none;user-select:none;display:block;font-weight:500;font-size:var(--cosmograph-search-list-font-size);max-width:100%;overflow:hidden}.style_module_searchSuggestions__b0d3f71e li>div{white-space:nowrap;font-weight:200;overflow:hidden;text-overflow:ellipsis;width:100%}.style_module_searchSuggestions__b0d3f71e li:hover{background:#ffffff1a}.style_module_searchSuggestions__b0d3f71e mark{background:var(--cosmograph-search-list-match-background);color:var(--cosmograph-search-list-match-color);border-radius:2px}.style_module_clearButton__5ebb41de{position:absolute;right:0;top:0;height:100%;background:none;border:none;color:var(--cosmograph-search-text-color);font-weight:300;cursor:pointer;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d{opacity:.7}.style_module_placeholderWrapper__72d5eb0e{z-index:1;color:var(--cosmograph-search-text-color);font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);position:absolute;top:0;left:0;width:100%;bottom:0;display:flex;line-height:1.25;align-items:center;transition:transform .3s ease-out,opacity .3s ease-out}.style_module_placeholderWrapper__72d5eb0e.style_module_hidden__acfb8431{transform:translate(-30px);pointer-events:none;opacity:0}.style_module_searchInput__d7830601:disabled,.style_module_searchInput__d7830601.style_module_disabled__62c35dc5{opacity:.2;cursor:not-allowed;pointer-events:none}.style_module_disabled__62c35dc5 .style_module_clearButton__5ebb41de{display:none}.style_module_disabled__62c35dc5 .style_module_placeholderWrapper__72d5eb0e{opacity:.3;cursor:not-allowed}.style_module_searchInputWrapper__1edbcb22{position:relative;display:flex;width:100%}.style_module_noResults__363397c3{opacity:.3!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none}.style_module_noResults__363397c3:hover{background:none}.style_module_loading__296e0212{opacity:.7!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none;-webkit-user-select:none;user-select:none}.style_module_dropdownContainer__d98287da{position:absolute;top:100%;left:0;width:100%;background:var(--cosmograph-search-list-background);border-radius:4px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);opacity:0;transform:translateY(-10px);transition:opacity .2s ease-out,transform .2s ease-out;pointer-events:none;overflow:hidden;z-index:10;display:flex;flex-direction:column;padding-bottom:2px}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b{top:auto;bottom:100%;transform:translateY(10px)}.style_module_dropdownContainer__d98287da.style_module_visible__5be7493d{opacity:1;transform:translateY(0);pointer-events:auto}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b.style_module_visible__5be7493d{opacity:1;transform:translateY(-2px);pointer-events:auto}.style_module_footerContainer__73e7a066{flex-shrink:0}:root{--cosmograph-scrollbar-background: rgba(255, 255, 255, .1);--cosmograph-ui-background: rgb(45, 49, 58);--cosmograph-ui-text: #ffffffc7;--cosmograph-ui-tick-font-size: 11px;--cosmograph-ui-font-size: 12px;--cosmograph-ui-font-family: inherit;--cosmograph-ui-element-color: #5C616A;--cosmograph-ui-highlighted-element-color: white;--cosmograph-ui-selection-control-color: #8d949ea8;-webkit-font-smoothing:antialiased!important;text-rendering:optimizeLegibility!important}.style_module_cosmograph-ui__5acb97f1{background:var(--cosmograph-ui-background);color:var(--cosmograph-ui-text)}.style_module_scrollbar__f1516254 *::-webkit-scrollbar{width:5px;height:5px;border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-track{border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-corner{background:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-button{display:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-thumb{background-color:var(--cosmograph-scrollbar-background);transition:background-color .5s;border-radius:20px;border:3px solid var(--cosmograph-scrollbar-background)}@-moz-document url-prefix(){.style_module_scrollbar__f1516254 *{scrollbar-width:thin;scrollbar-color:var(--cosmograph-scrollbar-background) transparent;scrollbar-track-color:transparent;scrollbar-face-color:var(--cosmograph-scrollbar-background)}}:root{--cosmograph-histogram-background: var(--cosmograph-ui-background);--cosmograph-histogram-text-color: var(--cosmograph-ui-text);--cosmograph-histogram-axis-color: var(--cosmograph-ui-text);--cosmograph-histogram-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-histogram-selection-opacity: .5;--cosmograph-histogram-bar-color: var(--cosmograph-ui-element-color);--cosmograph-histogram-highlighted-bar-color: var( --cosmograph-ui-highlighted-element-color);--cosmograph-histogram-font-family: var(--cosmograph-ui-font-family);--cosmograph-histogram-font-size: var(--cosmograph-ui-tick-font-size)}.style_module_histogram__9d8a77ea{position:relative;display:flex;min-height:25px;background:var(--cosmograph-histogram-background);width:100%}.style_module_histogramSvg__ccccb628{position:relative;width:100%;height:100%}.style_module_selection__7db96137{fill:var(--cosmograph-histogram-selection-color);fill-opacity:var(--cosmograph-histogram-selection-opacity);stroke:none}.style_module_axisTick__898e1f39{color:var(--cosmograph-histogram-axis-color);font-family:var(--cosmograph-histogram-font-family);font-size:var(--cosmograph-histogram-font-size);user-select:none;-webkit-user-select:none;alignment-baseline:text-before-edge;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum"}.style_module_bar__3c9ab488{fill:var(--cosmograph-histogram-bar-color);transform:scaleY(-1)}.style_module_highlightedBar__b193a8de{fill:var(--cosmograph-histogram-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-bars-font-color: var(--cosmograph-ui-text);--cosmograph-bars-font-family: var(--cosmograph-ui-font-family);--cosmograph-bars-font-size: var(--cosmograph-ui-font-size);--cosmograph-bars-ui-font-size: 11.5px;--cosmograph-bars-background: var(--cosmograph-ui-element-color);--cosmograph-bars-bar-height: 20px;--cosmograph-bars-bar-bottom-margin: 2px;--cosmograph-bars-highlighted-color: var( --cosmograph-ui-highlighted-element-color)}.style_module_bars__25497ded{position:relative;width:100%;min-height:100px;user-select:none;flex-direction:column;-webkit-user-select:none}.style_module_bars__25497ded .scroll-container{position:relative;width:100%;overflow-y:hidden;overflow-x:hidden}.style_module_bars__25497ded .bars-container{position:relative;width:calc(100% - 1px);font-family:var(--cosmograph-bars-font-family)}.style_module_bars__25497ded .highlighted-bars-container{position:absolute;top:0;left:0;pointer-events:none}.style_module_bars__25497ded .row{height:var(--cosmograph-bars-bar-height);display:flex;align-items:center;margin-bottom:var(--cosmograph-bars-bar-bottom-margin);width:100%;transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row:hover{filter:brightness(1.15) contrast(1.05);transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row.unselected:hover{filter:brightness(.95) contrast(1.15);transition:filter .05s linear}.style_module_bars__25497ded .unselected{opacity:.85;filter:brightness(.8) contrast(1.1)}.style_module_bars__25497ded .selected{filter:brightness(1.05) contrast(1.05)}.style_module_bars__25497ded .selected>.info>.label{font-weight:600;filter:brightness(1.1) contrast(1.05)}.style_module_bars__25497ded .unselected>.info>.label{font-weight:300}.style_module_bars__25497ded .bar{height:100%;background-color:var(--cosmograph-bars-background);opacity:.8;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .bar-highlighted{height:100%;background-color:var(--cosmograph-bars-highlighted-color);opacity:.2;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .info{display:flex;justify-content:space-between;width:100%;padding:0 4px;position:absolute;font-size:var(--cosmograph-bars-font-size);font-feature-settings:"tnum";color:var(--cosmograph-bars-font-color);gap:2px}.style_module_bars__25497ded .label{min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:opacity .05s linear}.style_module_bars__25497ded .count{flex-shrink:0;font-weight:300;opacity:.8;transition:opacity .05s linear}.style_module_bars__25497ded .show-more{cursor:pointer;padding-top:2px;display:flex;font-weight:300;color:var(--cosmograph-bars-font-color);font-size:11px;justify-content:space-between;opacity:.6;font-size:var(--cosmograph-bars-ui-font-size);pointer-events:none;transition:opacity .1s linear}.style_module_bars__25497ded .show-more:hover{opacity:1;text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .show-more>span{pointer-events:all}.style_module_bars__25497ded .show-more-count{padding-right:5px;pointer-events:all;font-feature-settings:"tnum"}.style_module_bars__25497ded .unselected>.info>.label,.style_module_bars__25497ded .unselected>.info>.count{opacity:.5}.style_module_bars__25497ded .unselected:hover>.info>.label,.style_module_bars__25497ded .unselected:hover>.info>.count{opacity:1}.style_module_bars__25497ded .search-input{background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,.3);font-size:13px!important;color:var(--cosmograph-bars-font-color);line-height:1.5;padding:2px;width:100%;position:relative;transition:border-bottom-color .2s}.style_module_bars__25497ded .search-input::placeholder{color:var(--cosmograph-bars-font-color)!important;opacity:.4;font-weight:300;font-family:inherit}.style_module_bars__25497ded .search-container{position:relative;width:100%;margin-bottom:4px;display:none;z-index:1}.style_module_bars__25497ded .clear-button{position:absolute;right:0;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--cosmograph-bars-font-color);font-weight:300;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_bars__25497ded .clear-button.visible:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_bars__25497ded .clear-button.visible{opacity:.7}.style_module_bars__25497ded .clear-button svg{width:10px;height:10px;fill:currentColor}.style_module_bars__25497ded .sorting-block{visibility:hidden;margin-top:1px;display:flex;justify-content:space-between}.style_module_bars__25497ded .buttons-container{margin-top:4px;font-size:var(--cosmograph-bars-ui-font-size);display:flex;gap:4px;line-height:1.25}.style_module_bars__25497ded .buttons-container>div{transition:opacity .05s linear,filter .05s linear;padding:1px 5px;background:var(--cosmograph-bars-background);border-radius:4px;opacity:.9;display:flex;cursor:pointer;align-items:center}.style_module_bars__25497ded .buttons-container>div:hover{filter:brightness(1.2)}.style_module_bars__25497ded .reset-text{transition:opacity .05s linear,filter .05s linear;display:flex;font-size:var(--cosmograph-bars-ui-font-size);align-items:end;padding-right:4px;cursor:pointer;font-weight:300}.style_module_bars__25497ded .reset-text:hover{text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .reset-text.unselected{pointer-events:none;cursor:default;opacity:.7}.style_module_bars__25497ded :scope.reset-text:hover:not(.unselected){filter:brightness(1.5);opacity:1}:root{--cosmograph-size-legend-form-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-family: inherit;--cosmograph-size-legend-font-size: var(--cosmograph-ui-font-size);--cosmograph-size-legend-sublabel-font-size: 10px;--cosmograph-size-legend-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-size-legend-line-radius: 2px;--cosmograph-size-legend-line-width: 30px;--cosmograph-size-legend-hide-transform: translateY(100%);--cosmograph-size-legend-show-transform: translateX(0)}.style_module_container__d2889234{display:flex;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;overflow:hidden;min-height:25px}.style_module_legend__75c167f2{width:auto;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-size-legend-font-size);font-family:var(--cosmograph-size-legend-font-family);user-select:none;-webkit-user-select:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.04em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__91eae57a{opacity:1;transform:var(--cosmograph-size-legend-show-transform)}.style_module_disabled__d51f7a10{opacity:0;transform:var(--cosmograph-size-legend-hide-transform);pointer-events:none;display:none!important;min-height:0}@starting-style{.style_module_container__d2889234.style_module_enabled__91eae57a,.style_module_legend__75c167f2.style_module_enabled__91eae57a{opacity:0;transform:var(--cosmograph-size-legend-hide-transform)}}.style_module_legend__75c167f2 .circle{background-color:var(--cosmograph-size-legend-form-color);border-radius:50%;transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2 .line{background-color:var(--cosmograph-size-legend-form-color);border-radius:var(--cosmograph-size-legend-line-radius);width:var(--cosmograph-size-legend-line-width);transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2.style_module_events__894316a8{pointer-events:auto;cursor:pointer}.style_module_legend__75c167f2 .legend-content{display:flex;align-items:end;justify-content:center;gap:.75rem}.style_module_legend__75c167f2 .legend-content>div{transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__75c167f2 .labels-wrapper{white-space:nowrap}.style_module_legend__75c167f2 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-size-legend-items-margin)}.style_module_legend__75c167f2 .name{align-items:center;text-align:center;justify-content:center;display:flex;color:var(--cosmograph-size-legend-font-color);overflow:hidden;width:100%;margin-top:3px;word-break:break-all;white-space:pre-line;transition:color .15s ease-in-out;letter-spacing:-.02em}.style_module_legend__75c167f2 .label{color:var(--cosmograph-size-legend-font-color);overflow:hidden;transition:color .15s ease-in-out;text-overflow:ellipsis;font-feature-settings:"tnum"}.style_module_legend__75c167f2 .sublabel{padding-top:1px;font-size:var(--cosmograph-size-legend-sublabel-font-size);opacity:.5;line-height:1;min-width:10px;transition:color .15s ease-in-out}.style_module_hovered__1206707f .label,.style_module_hovered__1206707f .sublabel{color:var(--cosmograph-size-legend-hover-color);cursor:pointer}.style_module_hovered__1206707f .circle,.style_module_hovered__1206707f .line{background-color:var(--cosmograph-size-legend-hover-color);cursor:pointer}:root{--cosmograph-color-legend-range-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-range-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-range-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-label-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-sublabel-font-size: 10px;--cosmograph-color-legend-range-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-range-gradient-height: 6px;--cosmograph-color-legend-range-gradient-radius: 8px;--cosmograph-color-legend-range-gradient-top-margin: 6px;--cosmograph-color-legend-hide-transform: translateY(100%);--cosmograph-color-legend-show-transform: translateX(0)}.style_module_container__05cc807d{display:flex;min-width:150px;min-height:25px;width:100%;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_legend__a3e235e4{width:100%;font-weight:300;letter-spacing:-.04em;display:flex;flex-direction:column;font-size:var(--cosmograph-color-legend-range-font-size);font-family:var(--cosmograph-color-legend-range-font-family);user-select:none;-webkit-user-select:none;pointer-events:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__b3120e27{opacity:1;transform:var(--cosmograph-color-legend-show-transform);pointer-events:auto}.style_module_disabled__c2dc158c{opacity:0;transform:var(--cosmograph-color-legend-hide-transform);pointer-events:none;display:none;min-height:0}@starting-style{.style_module_container__05cc807d.style_module_enabled__b3120e27,.style_module_legend__a3e235e4.style_module_enabled__b3120e27{opacity:0;transform:var(--cosmograph-color-legend-hide-transform)}}.style_module_legend__a3e235e4 .legend-content{display:flex;align-items:end;justify-content:space-between}.style_module_hovered__dfd7bb2c .label,.style_module_hovered__dfd7bb2c .sublabel{color:var(--cosmograph-size-legend-hover-color)!important;cursor:pointer}.style_module_legend__a3e235e4 .extent{white-space:nowrap;transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__a3e235e4 .gradient{width:100%;margin-top:var(--cosmograph-color-legend-range-gradient-top-margin);height:var(--cosmograph-color-legend-range-gradient-height);border-radius:var(--cosmograph-color-legend-range-gradient-radius)}.style_module_legend__a3e235e4 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-color-legend-range-items-margin)}.style_module_legend__a3e235e4 .name{align-items:center;text-align:center;justify-content:space-around;display:flex;color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;width:100%;word-break:break-word;text-wrap:balance;white-space:pre-line;transition:color .15s ease-in-out;margin:0 4px;letter-spacing:-.02em;line-height:1.25}.style_module_legend__a3e235e4 .label{color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;max-width:150px;text-overflow:ellipsis;font-size:var(--cosmograph-color-legend-range-label-font-size);transition:color .15s ease-in-out;line-height:1;font-feature-settings:"tnum"}.style_module_legend__a3e235e4 .sublabel{padding-top:1px;color:var(--cosmograph-color-legend-range-font-color);opacity:.55;font-size:var(--cosmograph-color-legend-range-sublabel-font-size);line-height:1;transition:color .15s ease-in-out}:root{--cosmograph-color-legend-type-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-type-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-type-font-size: 11px;--cosmograph-color-legend-type-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-type-others-color: #bab0ab;--cosmograph-color-legend-type-bullet-size: 8px;--cosmograph-color-legend-type-bullet-radius: 1rem;--cosmograph-color-legend-type-items-margin: 4px;--cosmograph-color-legend-type-hide-transform: translateY(125%);--cosmograph-color-legend-type-show-transform: translateX(0)}.style_module_enabled__277b2403{opacity:1;transform:var(--cosmograph-color-legend-type-show-transform)}.style_module_disabled__7a587f96{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform);display:none!important;min-height:0}.style_module_wrapper__ea8ca7f4{position:relative;max-width:100%;width:fit-content;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_typeLegend__15bf4b2f{position:relative;width:fit-content;max-width:100%;min-height:25px;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.015em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_typeLegend__15bf4b2f .reverted{flex-direction:row-reverse}.style_module_typeLegend__15bf4b2f .scroll-container{width:100%;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-color-legend-type-font-size);font-family:var(--cosmograph-color-legend-type-font-family);user-select:none;-webkit-user-select:none;line-height:normal;overflow-x:hidden;overflow-y:auto;will-change:transform}@starting-style{.style_module_typeLegend__15bf4b2f.style_module_enabled__277b2403,.style_module_wrapper__ea8ca7f4.style_module_enabled__277b2403{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform)}}.style_module_typeLegend__15bf4b2f .legend-item{display:flex;align-items:center;position:absolute;margin-bottom:var(--cosmograph-color-legend-type-items-margin);pointer-events:none;width:100%;padding-left:1px;font-weight:300;transition:filter .1s ease-in-out,opacity .1s ease-in-out;min-height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px + var(--cosmograph-color-legend-type-items-margin));height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px);box-sizing:border-box}.style_module_typeLegend__15bf4b2f .unknown{background-color:var(--cosmograph-color-legend-type-unknown-color)}.style_module_typeLegend__15bf4b2f .others{background-color:var(--cosmograph-color-legend-type-others-color)}.style_module_typeLegend__15bf4b2f .bullet{height:var(--cosmograph-color-legend-type-bullet-size);width:var(--cosmograph-color-legend-type-bullet-size);min-height:var(--cosmograph-color-legend-type-bullet-size);min-width:var(--cosmograph-color-legend-type-bullet-size);border-radius:var(--cosmograph-color-legend-type-bullet-radius);pointer-events:all;margin-right:5px}.style_module_typeLegend__15bf4b2f .label{color:var(--cosmograph-color-legend-type-font-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - var(--cosmograph-color-legend-type-bullet-size) - 5px);pointer-events:all;transition:.05s linear color}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.bullet{margin-right:0}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.label{margin-right:5px}.style_module_typeLegend__15bf4b2f .show-more{cursor:pointer;padding-top:4px;display:none;font-weight:300;color:var(--cosmograph-color-legend-type-font-color);font-size:11px;opacity:.6;pointer-events:all;justify-content:space-between;transition:opacity .1s linear;font-feature-settings:"tnum"}.style_module_typeLegend__15bf4b2f .show-more:hover{opacity:1}.style_module_hovered__c0993502 .label,.style_module_hovered__c0993502 .sublabel{color:var(--cosmograph-color-legend-type-hover-color)!important;cursor:pointer}.style_module_selected__36e1dd81{filter:brightness(1)}.style_module_selected__36e1dd81>.style_module_label__afecc7a3{filter:brightness(1.2)}.style_module_unselected__4826cfb7{filter:brightness(.5)}.style_module_typeLegend__15bf4b2f .name{font-size:calc(var(--cosmograph-color-legend-type-font-size) + 1px);font-family:var(--cosmograph-color-legend-type-font-family);color:var(--cosmograph-color-legend-type-font-color);transition:color .15s ease-in-out,opacity .3s ease-in-out,max-height .3s ease-in-out,transform .3s ease-in-out;margin-bottom:4px;margin-top:2px;margin-left:1px;letter-spacing:-.02em;line-height:1.25;overflow:hidden;width:100%;white-space:nowrap;text-overflow:ellipsis;pointer-events:all;-webkit-user-select:none!important;user-select:none!important;max-height:100px;opacity:1;transform:translateY(0)}.style_module_typeLegend__15bf4b2f .name.hidden{opacity:0;max-height:0;margin-bottom:0;margin-top:0;transform:translateY(-10px)}:root{--cosmograph-button-color: var(--cosmograph-ui-text);--cosmograph-button-background: var(--cosmograph-ui-element-color);--cosmograph-button-border-radius: 2px}.style_module_button__e95a1138{background:var(--cosmograph-button-background);color:var(--cosmograph-button-color);border-radius:var(--cosmograph-button-border-radius);display:none;align-items:center;justify-content:center;width:25px;height:25px;margin:3px;padding:5px;cursor:pointer;filter:brightness(.95) contrast(.9);transition:filter .1s}.style_module_button__e95a1138:hover{filter:brightness(1.2) contrast(1)}')),document.head.appendChild(i)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();var Kj=Object.defineProperty,Zj=(i,e,t)=>e in i?Kj(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Mn=(i,e,t)=>Zj(i,typeof e!="symbol"?e+"":e,t);let Qj=class extends ei{constructor(e,t){const n=Ct(Qu,t??{}),r=ei.extractConfig(n,Qu);super(e,r),Mn(this,"_config"),Mn(this,"_containerNode"),Mn(this,"_legend"),Mn(this,"_legendElements"),Mn(this,"_gradientElement"),Mn(this,"_extentElements",null),Mn(this,"_isHidden",!1),Mn(this,"_handleClick",o=>{var s,a;this._config.enableEvents&&((a=(s=this._config).onClick)==null||a.call(s,o))}),Mn(this,"_handleHover",o=>{var s,a;this._config.enableEvents&&((a=(s=this._config).onHover)==null||a.call(s,o))}),Mn(this,"_handleColorElementClick",o=>{var s,a;if(!this._config.enableEvents)return;const l=o.currentTarget.className.includes("min")?"min":"max",c=l==="min"?this._config.onMinClick:this._config.onMaxClick;if(c){const u=l==="min"?0:1,h=(s=this._config.extent)==null?void 0:s[l==="min"?0:this._config.extent.length-1],d=(a=this._config.extentLabels)==null?void 0:a[u];c(h,d,o)}}),Mn(this,"_handleColorElementHover",o=>{var s,a,l,c;if(!this._config.enableEvents||!this._config.extent)return;const u=o.currentTarget;if(!u)return;const h=u.classList.contains("min")?"min":"max",d=o.type==="mouseenter",f=h==="min"?0:this._config.extent.length-1,p=(s=this._config.extent)==null?void 0:s[f],b=(a=this._config.extentLabels)==null?void 0:a[f];u.classList.toggle(Dn.hovered,d),(c=(l=this._config).onHover)==null||c.call(l,{target:u,type:h,color:p,value:b})}),this._config=n,this._containerNode=e,this._containerNode.classList.add(Dn.container),this._createElements()}get extentElements(){return this._extentElements}get config(){return this._config}hide(){this._isHidden||(this._isHidden=!0,this._containerNode.classList.remove(Dn.enabled),this._containerNode.classList.add(Dn.disabled))}show(){this._isHidden&&(this._isHidden=!1,this._containerNode.classList.remove(Dn.disabled),this._containerNode.classList.add(Dn.enabled))}setConfig(e){this._config=Ct(Qu,e??{}),this.setDisplayStateConfig(ei.extractConfig(this._config,Qu)),this._updateLegend()}destroy(){this._legend&&(this._legend.removeEventListener("click",this._handleClick),this._legend.removeEventListener("mouseover",this._handleHover),this._extentElements&&["min","max"].forEach(e=>{const t=this._extentElements[e];t.removeEventListener("click",this._handleColorElementClick),t.removeEventListener("mouseenter",this._handleColorElementHover),t.removeEventListener("mouseleave",this._handleColorElementHover)}),this._containerNode.removeChild(this._legend),super.destroy())}setLoadingState(){super.setLoadingState()}_createElements(){this._legend=document.createElement("div"),this._legend.classList.add(Dn.legend),this._legendElements=this._createLegend(),this._gradientElement=this._createGradientElement(),this._legend.appendChild(this._legendElements),this._legend.appendChild(this._gradientElement),this._containerNode.appendChild(this._legend),this._isHidden||this.show()}_createLegend(){const e=document.createElement("div");e.classList.add("legend-content");const t=document.createElement("div");return t.classList.add("name"),this._extentElements={min:this._createLabelExtent("min"),max:this._createLabelExtent("max")},e.appendChild(this._extentElements.min),e.appendChild(t),e.appendChild(this._extentElements.max),e}_createLabelExtent(e){const t=document.createElement("div");t.classList.add("extent"),t.classList.add(e);const n=document.createElement("div");return n.classList.add("label"),t.appendChild(n),t.addEventListener("click",this._handleColorElementClick),t.addEventListener("mouseenter",this._handleColorElementHover),t.addEventListener("mouseleave",this._handleColorElementHover),t}_createGradientElement(){const e=document.createElement("div");return e.classList.add("gradient"),e}_updateLegend(){var e,t,n;const{noDataMessage:r,loadingMessage:o}=this._displayStateConfig,s=!this._config.extent&&r===!1&&o===!1;if(this._config.hidden||s?this.hide():this.show(),this._config.extent){this.hideState();const a=this._legendElements.querySelector(".name");a&&(a.textContent=this._config.label??"");const l=((e=this._config.extentLabels)==null?void 0:e[0])===((t=this._config.extentLabels)==null?void 0:t[1]);if(this._extentElements)if(l){if(this._extentElements.min.style.display="none",this._extentElements.max.style.display="none",a&&((n=this._config.extentLabels)==null?void 0:n[0])!==void 0){const c=this._formatLabel(this._config.extentLabels[0]),u=a.textContent?`${c}
${a.textContent}`:c;a.textContent=u}}else this._updateLabelWrapper("min"),this._updateLabelWrapper("max"),this._extentElements.min.style.display="block",this._extentElements.max.style.display="block";this._updateGradient(),this._legend.classList.remove(Dn.disabled),this._legend.classList.add(Dn.enabled)}else this.showState(),this._legend.classList.remove(Dn.enabled),this._legend.classList.add(Dn.disabled)}_updateGradient(){if(!this._config.extent)return;const e=this._config.extent.map(t=>this._getColor(t)).filter((t,n,r)=>n===0||t!==r[n-1]);if(e.length===1){this._gradientElement.style.backgroundImage="none",this._gradientElement.style.backgroundColor=e[0];return}if(this._config.discreteColors){const t=100/e.length,n=e.map((r,o)=>`${r} ${o*t}% ${(o+1)*t}%`);this._gradientElement.style.backgroundImage=`linear-gradient(to right, ${n.join(", ")})`}else{const t=this._config.extent.map((n,r)=>`${this._getColor(n)} ${r/(this._config.extent.length-1)*100}%`).join(", ");this._gradientElement.style.backgroundImage=`linear-gradient(to right, ${t})`}}_updateLabelWrapper(e){var t;const n=this._legendElements.querySelector(`.extent:${e==="min"?"first-child":"last-child"}`);if(!n)return;const r=e==="min"?0:1,o=(t=this._config.extentLabels)==null?void 0:t[r],s=n.querySelector(".label");s&&o!==void 0&&(s.textContent=this._formatLabel(o)),this._updateSublabel(n,e)}_updateSublabel(e,t){let n=e.querySelector(".sublabel");this._config.showSublabels?(n||(n=document.createElement("div"),n.classList.add("sublabel"),e.appendChild(n)),n.textContent=t==="min"?this._config.minSubLabel??"min":this._config.maxSubLabel??"max"):n&&n.remove()}_formatLabel(e){return typeof e=="string"?e:this._config.labelFormatter?this._config.labelFormatter(e):e.toString()}_getColor(e){return Array.isArray(e)?`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`:e}};const qs=15,Ju={hidden:!1,label:void 0,items:[],labelFormatter:void 0,enableEvents:!0,expanded:!1,maxDisplayedItems:15,alignRight:!1,onClick:void 0,onHover:void 0,noDataMessage:"No legend data",loadingMessage:"Data loading..."},Jj="style_module_enabled__277b2403",eY="style_module_disabled__7a587f96",tY="style_module_wrapper__ea8ca7f4",iY="style_module_typeLegend__15bf4b2f",nY="style_module_hovered__c0993502",rY="style_module_selected__36e1dd81",oY="style_module_unselected__4826cfb7",Bi={enabled:Jj,disabled:eY,wrapper:tY,typeLegend:iY,hovered:nY,selected:rY,unselected:oY};(function(){try{if(typeof document<"u"){var i=document.createElement("style");i.appendChild(document.createTextNode('@keyframes style_module_fadeIn__ffac87fd{0%{opacity:0}to{opacity:.2}}.style_module_displayState__6ae19b84{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--cosmograph-ui-text);display:flex;justify-content:center;align-items:center;min-width:100px;opacity:.2;font-size:calc(var(--cosmograph-ui-font-size) + 1px);letter-spacing:-.02em;font-weight:200;user-select:none;-webkit-user-select:none;animation:style_module_fadeIn__ffac87fd .3s ease-in-out}:root{--cosmograph-timeline-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-timeline-selection-opacity: .5;--cosmograph-timeline-bar-color: var(--cosmograph-ui-element-color);--cosmograph-timeline-highlighted-bar-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-timeline-font-family: var(--cosmograph-ui-font-family);--cosmograph-timeline-font-size: var(--cosmograph-ui-tick-font-size);--cosmograph-timeline-background: var(--cosmograph-ui-background);--cosmograph-timeline-text-color: var(--cosmograph-ui-text);--cosmograph-timeline-axis-color: var(--cosmograph-ui-text)}.style_module_timeline__736434f7{position:relative;display:flex;background:var(--cosmograph-timeline-background);width:100%;min-height:25px;overflow:hidden}.style_module_timelineSvg__b916ad04{position:relative;width:100%;height:100%}.style_module_selection__ebee57f8{fill:var(--cosmograph-timeline-selection-color);fill-opacity:var(--cosmograph-timeline-selection-opacity);stroke:none}.style_module_axisTick__5865631d{color:var(--cosmograph-timeline-axis-color);font:var(--cosmograph-timeline-font-family);font-size:var(--cosmograph-timeline-font-size);user-select:none;-webkit-user-select:none;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum";alignment-baseline:text-before-edge}.style_module_axisLine__992b502d{opacity:.2;color:var(--cosmograph-timeline-axis-color)}.style_module_bar__114fa79f{fill:var(--cosmograph-timeline-bar-color);transform:scaleY(-1);opacity:0}.style_module_animationControl__ee52cd66{color:var(--cosmograph-timeline-axis-color);width:6%;max-width:30px;min-width:20px;cursor:pointer;display:none;align-items:center;user-select:none;-webkit-user-select:none;opacity:.5;position:relative;justify-content:center}.style_module_animationControl__ee52cd66>svg{width:50%;max-height:20px;padding-right:2px}.style_module_hidden__a73fe81a{display:none}.style_module_disabled__eb988570{opacity:.2;pointer-events:none}.style_module_highlightedBar__c2fc9bdc{fill:var(--cosmograph-timeline-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-search-font-family: var(--cosmograph-ui-font-family);--cosmograph-search-font-size: 14px;--cosmograph-search-list-font-size: 13.5px;--cosmograph-search-text-color: var(--cosmograph-ui-text);--cosmograph-search-background: transparent;--cosmograph-search-list-background: rgba(0, 0, 0, .2);--cosmograph-search-list-match-background: rgba(255, 255, 255, .2);--cosmograph-search-list-match-color: var(--cosmograph-ui-text)}.style_module_searchInput__d7830601:hover{filter:brightness(1.2) contrast(1)}.style_module_searchInput__d7830601{width:100%;background:transparent;color:var(--cosmograph-search-text-color);border:none;border-bottom:.5px solid var(--cosmograph-search-text-color);padding:4px 20px 5px 2px;font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:opacity .2s ease-out}.style_module_searchInput__d7830601::selection{background:var(--cosmograph-search-list-match-background)}.style_module_searchInput__d7830601:focus{outline:none}.style_module_searchSuggestions__b0d3f71e{color:#fff;width:100%;padding:0;margin:0;background:transparent;overflow-y:auto;flex:1;min-height:0}.style_module_searchSuggestions__b0d3f71e li{padding:5px 10px;cursor:pointer;-webkit-user-select:none;user-select:none;display:block;font-weight:500;font-size:var(--cosmograph-search-list-font-size);max-width:100%;overflow:hidden}.style_module_searchSuggestions__b0d3f71e li>div{white-space:nowrap;font-weight:200;overflow:hidden;text-overflow:ellipsis;width:100%}.style_module_searchSuggestions__b0d3f71e li:hover{background:#ffffff1a}.style_module_searchSuggestions__b0d3f71e mark{background:var(--cosmograph-search-list-match-background);color:var(--cosmograph-search-list-match-color);border-radius:2px}.style_module_clearButton__5ebb41de{position:absolute;right:0;top:0;height:100%;background:none;border:none;color:var(--cosmograph-search-text-color);font-weight:300;cursor:pointer;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d{opacity:.7}.style_module_placeholderWrapper__72d5eb0e{z-index:1;color:var(--cosmograph-search-text-color);font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);position:absolute;top:0;left:0;width:100%;bottom:0;display:flex;line-height:1.25;align-items:center;transition:transform .3s ease-out,opacity .3s ease-out}.style_module_placeholderWrapper__72d5eb0e.style_module_hidden__acfb8431{transform:translate(-30px);pointer-events:none;opacity:0}.style_module_searchInput__d7830601:disabled,.style_module_searchInput__d7830601.style_module_disabled__62c35dc5{opacity:.2;cursor:not-allowed;pointer-events:none}.style_module_disabled__62c35dc5 .style_module_clearButton__5ebb41de{display:none}.style_module_disabled__62c35dc5 .style_module_placeholderWrapper__72d5eb0e{opacity:.3;cursor:not-allowed}.style_module_searchInputWrapper__1edbcb22{position:relative;display:flex;width:100%}.style_module_noResults__363397c3{opacity:.3!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none}.style_module_noResults__363397c3:hover{background:none}.style_module_loading__296e0212{opacity:.7!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none;-webkit-user-select:none;user-select:none}.style_module_dropdownContainer__d98287da{position:absolute;top:100%;left:0;width:100%;background:var(--cosmograph-search-list-background);border-radius:4px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);opacity:0;transform:translateY(-10px);transition:opacity .2s ease-out,transform .2s ease-out;pointer-events:none;overflow:hidden;z-index:10;display:flex;flex-direction:column;padding-bottom:2px}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b{top:auto;bottom:100%;transform:translateY(10px)}.style_module_dropdownContainer__d98287da.style_module_visible__5be7493d{opacity:1;transform:translateY(0);pointer-events:auto}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b.style_module_visible__5be7493d{opacity:1;transform:translateY(-2px);pointer-events:auto}.style_module_footerContainer__73e7a066{flex-shrink:0}:root{--cosmograph-scrollbar-background: rgba(255, 255, 255, .1);--cosmograph-ui-background: rgb(45, 49, 58);--cosmograph-ui-text: #ffffffc7;--cosmograph-ui-tick-font-size: 11px;--cosmograph-ui-font-size: 12px;--cosmograph-ui-font-family: inherit;--cosmograph-ui-element-color: #5C616A;--cosmograph-ui-highlighted-element-color: white;--cosmograph-ui-selection-control-color: #8d949ea8;-webkit-font-smoothing:antialiased!important;text-rendering:optimizeLegibility!important}.style_module_cosmograph-ui__5acb97f1{background:var(--cosmograph-ui-background);color:var(--cosmograph-ui-text)}.style_module_scrollbar__f1516254 *::-webkit-scrollbar{width:5px;height:5px;border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-track{border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-corner{background:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-button{display:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-thumb{background-color:var(--cosmograph-scrollbar-background);transition:background-color .5s;border-radius:20px;border:3px solid var(--cosmograph-scrollbar-background)}@-moz-document url-prefix(){.style_module_scrollbar__f1516254 *{scrollbar-width:thin;scrollbar-color:var(--cosmograph-scrollbar-background) transparent;scrollbar-track-color:transparent;scrollbar-face-color:var(--cosmograph-scrollbar-background)}}:root{--cosmograph-histogram-background: var(--cosmograph-ui-background);--cosmograph-histogram-text-color: var(--cosmograph-ui-text);--cosmograph-histogram-axis-color: var(--cosmograph-ui-text);--cosmograph-histogram-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-histogram-selection-opacity: .5;--cosmograph-histogram-bar-color: var(--cosmograph-ui-element-color);--cosmograph-histogram-highlighted-bar-color: var( --cosmograph-ui-highlighted-element-color);--cosmograph-histogram-font-family: var(--cosmograph-ui-font-family);--cosmograph-histogram-font-size: var(--cosmograph-ui-tick-font-size)}.style_module_histogram__9d8a77ea{position:relative;display:flex;min-height:25px;background:var(--cosmograph-histogram-background);width:100%}.style_module_histogramSvg__ccccb628{position:relative;width:100%;height:100%}.style_module_selection__7db96137{fill:var(--cosmograph-histogram-selection-color);fill-opacity:var(--cosmograph-histogram-selection-opacity);stroke:none}.style_module_axisTick__898e1f39{color:var(--cosmograph-histogram-axis-color);font-family:var(--cosmograph-histogram-font-family);font-size:var(--cosmograph-histogram-font-size);user-select:none;-webkit-user-select:none;alignment-baseline:text-before-edge;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum"}.style_module_bar__3c9ab488{fill:var(--cosmograph-histogram-bar-color);transform:scaleY(-1)}.style_module_highlightedBar__b193a8de{fill:var(--cosmograph-histogram-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-bars-font-color: var(--cosmograph-ui-text);--cosmograph-bars-font-family: var(--cosmograph-ui-font-family);--cosmograph-bars-font-size: var(--cosmograph-ui-font-size);--cosmograph-bars-ui-font-size: 11.5px;--cosmograph-bars-background: var(--cosmograph-ui-element-color);--cosmograph-bars-bar-height: 20px;--cosmograph-bars-bar-bottom-margin: 2px;--cosmograph-bars-highlighted-color: var( --cosmograph-ui-highlighted-element-color)}.style_module_bars__25497ded{position:relative;width:100%;min-height:100px;user-select:none;flex-direction:column;-webkit-user-select:none}.style_module_bars__25497ded .scroll-container{position:relative;width:100%;overflow-y:hidden;overflow-x:hidden}.style_module_bars__25497ded .bars-container{position:relative;width:calc(100% - 1px);font-family:var(--cosmograph-bars-font-family)}.style_module_bars__25497ded .highlighted-bars-container{position:absolute;top:0;left:0;pointer-events:none}.style_module_bars__25497ded .row{height:var(--cosmograph-bars-bar-height);display:flex;align-items:center;margin-bottom:var(--cosmograph-bars-bar-bottom-margin);width:100%;transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row:hover{filter:brightness(1.15) contrast(1.05);transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row.unselected:hover{filter:brightness(.95) contrast(1.15);transition:filter .05s linear}.style_module_bars__25497ded .unselected{opacity:.85;filter:brightness(.8) contrast(1.1)}.style_module_bars__25497ded .selected{filter:brightness(1.05) contrast(1.05)}.style_module_bars__25497ded .selected>.info>.label{font-weight:600;filter:brightness(1.1) contrast(1.05)}.style_module_bars__25497ded .unselected>.info>.label{font-weight:300}.style_module_bars__25497ded .bar{height:100%;background-color:var(--cosmograph-bars-background);opacity:.8;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .bar-highlighted{height:100%;background-color:var(--cosmograph-bars-highlighted-color);opacity:.2;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .info{display:flex;justify-content:space-between;width:100%;padding:0 4px;position:absolute;font-size:var(--cosmograph-bars-font-size);font-feature-settings:"tnum";color:var(--cosmograph-bars-font-color);gap:2px}.style_module_bars__25497ded .label{min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:opacity .05s linear}.style_module_bars__25497ded .count{flex-shrink:0;font-weight:300;opacity:.8;transition:opacity .05s linear}.style_module_bars__25497ded .show-more{cursor:pointer;padding-top:2px;display:flex;font-weight:300;color:var(--cosmograph-bars-font-color);font-size:11px;justify-content:space-between;opacity:.6;font-size:var(--cosmograph-bars-ui-font-size);pointer-events:none;transition:opacity .1s linear}.style_module_bars__25497ded .show-more:hover{opacity:1;text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .show-more>span{pointer-events:all}.style_module_bars__25497ded .show-more-count{padding-right:5px;pointer-events:all;font-feature-settings:"tnum"}.style_module_bars__25497ded .unselected>.info>.label,.style_module_bars__25497ded .unselected>.info>.count{opacity:.5}.style_module_bars__25497ded .unselected:hover>.info>.label,.style_module_bars__25497ded .unselected:hover>.info>.count{opacity:1}.style_module_bars__25497ded .search-input{background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,.3);font-size:13px!important;color:var(--cosmograph-bars-font-color);line-height:1.5;padding:2px;width:100%;position:relative;transition:border-bottom-color .2s}.style_module_bars__25497ded .search-input::placeholder{color:var(--cosmograph-bars-font-color)!important;opacity:.4;font-weight:300;font-family:inherit}.style_module_bars__25497ded .search-container{position:relative;width:100%;margin-bottom:4px;display:none;z-index:1}.style_module_bars__25497ded .clear-button{position:absolute;right:0;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--cosmograph-bars-font-color);font-weight:300;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_bars__25497ded .clear-button.visible:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_bars__25497ded .clear-button.visible{opacity:.7}.style_module_bars__25497ded .clear-button svg{width:10px;height:10px;fill:currentColor}.style_module_bars__25497ded .sorting-block{visibility:hidden;margin-top:1px;display:flex;justify-content:space-between}.style_module_bars__25497ded .buttons-container{margin-top:4px;font-size:var(--cosmograph-bars-ui-font-size);display:flex;gap:4px;line-height:1.25}.style_module_bars__25497ded .buttons-container>div{transition:opacity .05s linear,filter .05s linear;padding:1px 5px;background:var(--cosmograph-bars-background);border-radius:4px;opacity:.9;display:flex;cursor:pointer;align-items:center}.style_module_bars__25497ded .buttons-container>div:hover{filter:brightness(1.2)}.style_module_bars__25497ded .reset-text{transition:opacity .05s linear,filter .05s linear;display:flex;font-size:var(--cosmograph-bars-ui-font-size);align-items:end;padding-right:4px;cursor:pointer;font-weight:300}.style_module_bars__25497ded .reset-text:hover{text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .reset-text.unselected{pointer-events:none;cursor:default;opacity:.7}.style_module_bars__25497ded :scope.reset-text:hover:not(.unselected){filter:brightness(1.5);opacity:1}:root{--cosmograph-size-legend-form-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-family: inherit;--cosmograph-size-legend-font-size: var(--cosmograph-ui-font-size);--cosmograph-size-legend-sublabel-font-size: 10px;--cosmograph-size-legend-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-size-legend-line-radius: 2px;--cosmograph-size-legend-line-width: 30px;--cosmograph-size-legend-hide-transform: translateY(100%);--cosmograph-size-legend-show-transform: translateX(0)}.style_module_container__d2889234{display:flex;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;overflow:hidden;min-height:25px}.style_module_legend__75c167f2{width:auto;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-size-legend-font-size);font-family:var(--cosmograph-size-legend-font-family);user-select:none;-webkit-user-select:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.04em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__91eae57a{opacity:1;transform:var(--cosmograph-size-legend-show-transform)}.style_module_disabled__d51f7a10{opacity:0;transform:var(--cosmograph-size-legend-hide-transform);pointer-events:none;display:none!important;min-height:0}@starting-style{.style_module_container__d2889234.style_module_enabled__91eae57a,.style_module_legend__75c167f2.style_module_enabled__91eae57a{opacity:0;transform:var(--cosmograph-size-legend-hide-transform)}}.style_module_legend__75c167f2 .circle{background-color:var(--cosmograph-size-legend-form-color);border-radius:50%;transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2 .line{background-color:var(--cosmograph-size-legend-form-color);border-radius:var(--cosmograph-size-legend-line-radius);width:var(--cosmograph-size-legend-line-width);transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2.style_module_events__894316a8{pointer-events:auto;cursor:pointer}.style_module_legend__75c167f2 .legend-content{display:flex;align-items:end;justify-content:center;gap:.75rem}.style_module_legend__75c167f2 .legend-content>div{transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__75c167f2 .labels-wrapper{white-space:nowrap}.style_module_legend__75c167f2 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-size-legend-items-margin)}.style_module_legend__75c167f2 .name{align-items:center;text-align:center;justify-content:center;display:flex;color:var(--cosmograph-size-legend-font-color);overflow:hidden;width:100%;margin-top:3px;word-break:break-all;white-space:pre-line;transition:color .15s ease-in-out;letter-spacing:-.02em}.style_module_legend__75c167f2 .label{color:var(--cosmograph-size-legend-font-color);overflow:hidden;transition:color .15s ease-in-out;text-overflow:ellipsis;font-feature-settings:"tnum"}.style_module_legend__75c167f2 .sublabel{padding-top:1px;font-size:var(--cosmograph-size-legend-sublabel-font-size);opacity:.5;line-height:1;min-width:10px;transition:color .15s ease-in-out}.style_module_hovered__1206707f .label,.style_module_hovered__1206707f .sublabel{color:var(--cosmograph-size-legend-hover-color);cursor:pointer}.style_module_hovered__1206707f .circle,.style_module_hovered__1206707f .line{background-color:var(--cosmograph-size-legend-hover-color);cursor:pointer}:root{--cosmograph-color-legend-range-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-range-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-range-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-label-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-sublabel-font-size: 10px;--cosmograph-color-legend-range-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-range-gradient-height: 6px;--cosmograph-color-legend-range-gradient-radius: 8px;--cosmograph-color-legend-range-gradient-top-margin: 6px;--cosmograph-color-legend-hide-transform: translateY(100%);--cosmograph-color-legend-show-transform: translateX(0)}.style_module_container__05cc807d{display:flex;min-width:150px;min-height:25px;width:100%;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_legend__a3e235e4{width:100%;font-weight:300;letter-spacing:-.04em;display:flex;flex-direction:column;font-size:var(--cosmograph-color-legend-range-font-size);font-family:var(--cosmograph-color-legend-range-font-family);user-select:none;-webkit-user-select:none;pointer-events:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__b3120e27{opacity:1;transform:var(--cosmograph-color-legend-show-transform);pointer-events:auto}.style_module_disabled__c2dc158c{opacity:0;transform:var(--cosmograph-color-legend-hide-transform);pointer-events:none;display:none;min-height:0}@starting-style{.style_module_container__05cc807d.style_module_enabled__b3120e27,.style_module_legend__a3e235e4.style_module_enabled__b3120e27{opacity:0;transform:var(--cosmograph-color-legend-hide-transform)}}.style_module_legend__a3e235e4 .legend-content{display:flex;align-items:end;justify-content:space-between}.style_module_hovered__dfd7bb2c .label,.style_module_hovered__dfd7bb2c .sublabel{color:var(--cosmograph-size-legend-hover-color)!important;cursor:pointer}.style_module_legend__a3e235e4 .extent{white-space:nowrap;transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__a3e235e4 .gradient{width:100%;margin-top:var(--cosmograph-color-legend-range-gradient-top-margin);height:var(--cosmograph-color-legend-range-gradient-height);border-radius:var(--cosmograph-color-legend-range-gradient-radius)}.style_module_legend__a3e235e4 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-color-legend-range-items-margin)}.style_module_legend__a3e235e4 .name{align-items:center;text-align:center;justify-content:space-around;display:flex;color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;width:100%;word-break:break-word;text-wrap:balance;white-space:pre-line;transition:color .15s ease-in-out;margin:0 4px;letter-spacing:-.02em;line-height:1.25}.style_module_legend__a3e235e4 .label{color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;max-width:150px;text-overflow:ellipsis;font-size:var(--cosmograph-color-legend-range-label-font-size);transition:color .15s ease-in-out;line-height:1;font-feature-settings:"tnum"}.style_module_legend__a3e235e4 .sublabel{padding-top:1px;color:var(--cosmograph-color-legend-range-font-color);opacity:.55;font-size:var(--cosmograph-color-legend-range-sublabel-font-size);line-height:1;transition:color .15s ease-in-out}:root{--cosmograph-color-legend-type-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-type-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-type-font-size: 11px;--cosmograph-color-legend-type-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-type-others-color: #bab0ab;--cosmograph-color-legend-type-bullet-size: 8px;--cosmograph-color-legend-type-bullet-radius: 1rem;--cosmograph-color-legend-type-items-margin: 4px;--cosmograph-color-legend-type-hide-transform: translateY(125%);--cosmograph-color-legend-type-show-transform: translateX(0)}.style_module_enabled__277b2403{opacity:1;transform:var(--cosmograph-color-legend-type-show-transform)}.style_module_disabled__7a587f96{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform);display:none!important;min-height:0}.style_module_wrapper__ea8ca7f4{position:relative;max-width:100%;width:fit-content;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_typeLegend__15bf4b2f{position:relative;width:fit-content;max-width:100%;min-height:25px;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.015em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_typeLegend__15bf4b2f .reverted{flex-direction:row-reverse}.style_module_typeLegend__15bf4b2f .scroll-container{width:100%;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-color-legend-type-font-size);font-family:var(--cosmograph-color-legend-type-font-family);user-select:none;-webkit-user-select:none;line-height:normal;overflow-x:hidden;overflow-y:auto;will-change:transform}@starting-style{.style_module_typeLegend__15bf4b2f.style_module_enabled__277b2403,.style_module_wrapper__ea8ca7f4.style_module_enabled__277b2403{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform)}}.style_module_typeLegend__15bf4b2f .legend-item{display:flex;align-items:center;position:absolute;margin-bottom:var(--cosmograph-color-legend-type-items-margin);pointer-events:none;width:100%;padding-left:1px;font-weight:300;transition:filter .1s ease-in-out,opacity .1s ease-in-out;min-height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px + var(--cosmograph-color-legend-type-items-margin));height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px);box-sizing:border-box}.style_module_typeLegend__15bf4b2f .unknown{background-color:var(--cosmograph-color-legend-type-unknown-color)}.style_module_typeLegend__15bf4b2f .others{background-color:var(--cosmograph-color-legend-type-others-color)}.style_module_typeLegend__15bf4b2f .bullet{height:var(--cosmograph-color-legend-type-bullet-size);width:var(--cosmograph-color-legend-type-bullet-size);min-height:var(--cosmograph-color-legend-type-bullet-size);min-width:var(--cosmograph-color-legend-type-bullet-size);border-radius:var(--cosmograph-color-legend-type-bullet-radius);pointer-events:all;margin-right:5px}.style_module_typeLegend__15bf4b2f .label{color:var(--cosmograph-color-legend-type-font-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - var(--cosmograph-color-legend-type-bullet-size) - 5px);pointer-events:all;transition:.05s linear color}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.bullet{margin-right:0}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.label{margin-right:5px}.style_module_typeLegend__15bf4b2f .show-more{cursor:pointer;padding-top:4px;display:none;font-weight:300;color:var(--cosmograph-color-legend-type-font-color);font-size:11px;opacity:.6;pointer-events:all;justify-content:space-between;transition:opacity .1s linear;font-feature-settings:"tnum"}.style_module_typeLegend__15bf4b2f .show-more:hover{opacity:1}.style_module_hovered__c0993502 .label,.style_module_hovered__c0993502 .sublabel{color:var(--cosmograph-color-legend-type-hover-color)!important;cursor:pointer}.style_module_selected__36e1dd81{filter:brightness(1)}.style_module_selected__36e1dd81>.style_module_label__afecc7a3{filter:brightness(1.2)}.style_module_unselected__4826cfb7{filter:brightness(.5)}.style_module_typeLegend__15bf4b2f .name{font-size:calc(var(--cosmograph-color-legend-type-font-size) + 1px);font-family:var(--cosmograph-color-legend-type-font-family);color:var(--cosmograph-color-legend-type-font-color);transition:color .15s ease-in-out,opacity .3s ease-in-out,max-height .3s ease-in-out,transform .3s ease-in-out;margin-bottom:4px;margin-top:2px;margin-left:1px;letter-spacing:-.02em;line-height:1.25;overflow:hidden;width:100%;white-space:nowrap;text-overflow:ellipsis;pointer-events:all;-webkit-user-select:none!important;user-select:none!important;max-height:100px;opacity:1;transform:translateY(0)}.style_module_typeLegend__15bf4b2f .name.hidden{opacity:0;max-height:0;margin-bottom:0;margin-top:0;transform:translateY(-10px)}:root{--cosmograph-button-color: var(--cosmograph-ui-text);--cosmograph-button-background: var(--cosmograph-ui-element-color);--cosmograph-button-border-radius: 2px}.style_module_button__e95a1138{background:var(--cosmograph-button-background);color:var(--cosmograph-button-color);border-radius:var(--cosmograph-button-border-radius);display:none;align-items:center;justify-content:center;width:25px;height:25px;margin:3px;padding:5px;cursor:pointer;filter:brightness(.95) contrast(.9);transition:filter .1s}.style_module_button__e95a1138:hover{filter:brightness(1.2) contrast(1)}')),document.head.appendChild(i)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();var sY=Object.defineProperty,aY=(i,e,t)=>e in i?sY(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Mt=(i,e,t)=>aY(i,typeof e!="symbol"?e+"":e,t);class lY extends ei{constructor(e,t){const n=Ct(Ju,t??{});super(e,ei.extractConfig(n,Ju)),Mt(this,"_containerNode"),Mt(this,"_config"),Mt(this,"_scrollContainer"),Mt(this,"_legendItems"),Mt(this,"_showMoreButton"),Mt(this,"_wrapper"),Mt(this,"_itemHeight",0),Mt(this,"_itemMargin",0),Mt(this,"_visibleItemsCount",0),Mt(this,"_startIndex",0),Mt(this,"_endIndex",0),Mt(this,"_listItems",[]),Mt(this,"_selectedItem"),Mt(this,"_isExpanded",!1),Mt(this,"_isHidden",!1),Mt(this,"_calculatedWidth",0),Mt(this,"_maxMeasuredWidth",0),Mt(this,"_maxMeasuredCharLength",0),Mt(this,"_label"),Mt(this,"_handleShowMore",()=>{var r,o;this._isExpanded=!this._isExpanded,this._isExpanded?(this._containerNode.style.pointerEvents="all",this._scrollContainer.style.overflowY="auto",this._showMoreButton.firstChild.textContent="show less"):(this._containerNode.style.pointerEvents="none",this._scrollContainer.style.overflowY="hidden",this._scrollContainer.scrollTop=0,this._handleShowMoreCount()),(o=(r=this._config).onShowMoreClick)==null||o.call(r,this._isExpanded),this._calculateOptimalWidth(),this._updateVisibleItems()}),Mt(this,"_handleShowMoreCount",()=>{const{maxDisplayedItems:r=qs}=this._config,o=this._listItems.length-r;this._showMoreButton.firstChild.textContent=`${o} more...`}),Mt(this,"_handleScroll",()=>{requestAnimationFrame(()=>{this._updateVisibleItems()})}),this._config=n,this._containerNode=e,this._containerNode.classList.add(Bi.typeLegend),this._containerNode.classList.add(db.scrollbar),this._createElements()}get config(){return this._config}get legendItems(){return this._legendItems}get isExpanded(){return this._isExpanded}setConfig(e){const t=this._isExpanded;this._config=Ct(Ju,e??{}),this.setDisplayStateConfig(ei.extractConfig(this._config,Ju)),this._isExpanded=(e==null?void 0:e.expanded)??t,this._updateLegend()}setSelectedItem(e){this._selectedItem=e,this._updateVisibleItems()}resetList(){this._scrollContainer.scrollTop=0,this._selectedItem=void 0,this._updateVisibleItems()}getConfig(){return this._config}show(){this._isHidden&&(this._isHidden=!1,this._containerNode.classList.remove(Bi.disabled),this._containerNode.classList.add(Bi.enabled))}hide(){this._isHidden||(this._isHidden=!0,this._containerNode.classList.remove(Bi.enabled),this._containerNode.classList.add(Bi.disabled))}destroy(){this._scrollContainer.removeEventListener("scroll",this._handleScroll),this._containerNode.innerHTML="",super.destroy()}setLoadingState(){super.setLoadingState()}_updateLegend(){const{maxDisplayedItems:e=qs,items:t}=this._config,{noDataMessage:n,loadingMessage:r}=this._displayStateConfig,o=!(t!=null&&t.length)&&n===!1&&r===!1;if(this._config.hidden||o?this.hide():this.show(),t!=null&&t.length){this.hideState(),this._wrapper.classList.remove(Bi.disabled),this._wrapper.classList.add(Bi.enabled);const s=this._config.label;this._label.textContent=s??"",this._label.title=s??"",s?this._label.classList.remove("hidden"):this._label.classList.add("hidden"),this._listItems=t;const a=this._listItems.length;this._calculateItemDimensions(),this._calculateOptimalWidth(),this._visibleItemsCount=e>a?a:e;const l=this._itemHeight+this._itemMargin,c=Math.ceil(this._visibleItemsCount*l-this._itemMargin);this._scrollContainer.style.height=`${c}px`,this._legendItems.style.height=`${Math.ceil(this._listItems.length*l)}px`,this._scrollContainer.style.overflowY=this._isExpanded?"auto":"hidden",this._containerNode.style.pointerEvents=this._isExpanded?"all":"none",this._updateVisibleItems(),this._showMoreButton.style.display=this._listItems.length>e?"block":"none"}else this.showState(),this._wrapper.classList.remove(Bi.enabled),this._wrapper.classList.add(Bi.disabled)}_updateVisibleItems(){const e=this._itemHeight+this._itemMargin,t=3,n=this._scrollContainer.scrollTop;this._startIndex=Math.max(0,Math.floor(n/e)-t);const r=this._isExpanded?Math.ceil(this._scrollContainer.clientHeight/e+t*2):this._visibleItemsCount;this._endIndex=Math.min(this._startIndex+r,this._listItems.length);const o=document.createDocumentFragment();for(let s=this._startIndex;s<this._endIndex;s++){const a=this._listItems[s];if(a){const l=this._createLegendItem(a);l.style.position="absolute",l.style.top=`${s*e}px`,o.appendChild(l)}}this._legendItems.innerHTML="",this._legendItems.appendChild(o),this._updateShowMoreButton()}_createElements(){this._wrapper=document.createElement("div"),this._wrapper.classList.add(Bi.wrapper),this._label=document.createElement("div"),this._label.classList.add("name"),this._wrapper.appendChild(this._label),this._scrollContainer=document.createElement("div"),this._scrollContainer.classList.add("scroll-container"),this._scrollContainer.addEventListener("scroll",this._handleScroll,{passive:!0}),this._legendItems=document.createElement("div"),this._legendItems.className="legend-items",this._scrollContainer.appendChild(this._legendItems),this._showMoreButton=this._createShowMoreButton(),this._wrapper.appendChild(this._scrollContainer),this._wrapper.appendChild(this._showMoreButton),this._containerNode.appendChild(this._wrapper),this._isHidden||this.show()}_createShowMoreButton(){const e=document.createElement("div");e.classList.add("show-more"),e.addEventListener("click",this._handleShowMore);const t=document.createElement("span");return e.appendChild(t),e}_updateShowMoreButton(){this._isExpanded?this._showMoreButton.firstChild.textContent="show less":this._handleShowMoreCount()}_calculateItemDimensions(){const e=this._createLegendItem({label:"Sample",color:"#000000"});e.style.visibility="hidden",e.style.position="absolute",this._legendItems.appendChild(e);const t=window.getComputedStyle(e);this._itemHeight=e.offsetHeight,this._itemMargin=parseFloat(t.marginTop)+parseFloat(t.marginBottom),this._legendItems.removeChild(e)}_createLegendItem(e){const t=document.createElement("div");t.classList.add("legend-item"),t.title=e.label,this._config.alignRight&&t.classList.add("reverted"),this._selectedItem&&t.classList.add(this._selectedItem.label===e.label?Bi.selected:Bi.unselected),this._config.enableEvents&&(this._config.onClick&&(t.style.cursor="pointer",t.addEventListener("click",o=>this._config.onClick(o,e))),this._config.onHover&&(t.addEventListener("mouseenter",o=>{t.classList.add(Bi.hovered),this._config.onHover(o,e)}),t.addEventListener("mouseleave",o=>{t.classList.remove(Bi.hovered),this._config.onHover(o,e)})));const n=document.createElement("div");n.className="bullet",n.style.backgroundColor=e.color;const r=document.createElement("div");return r.className="label",r.style.whiteSpace="nowrap",r.textContent=e.label,t.appendChild(n),t.appendChild(r),t}_calculateOptimalWidth(){var e;if(!this._listItems.length)return;let t=0;for(const h of this._listItems)h.label&&h.label.length>t&&(t=h.label.length);if(this._listItems.length>(this._config.maxDisplayedItems||qs)){const h=this._listItems.length-(this._config.maxDisplayedItems||qs);t=Math.max(t,`${h} more...`.length,9)}if(t<=this._maxMeasuredCharLength){this._maxMeasuredWidth&&this._applyCalculatedWidth(this._maxMeasuredWidth);return}this._maxMeasuredCharLength=t;const n=getComputedStyle(this._containerNode).getPropertyValue("--cosmograph-color-legend-type-font-size")||"11px",r=getComputedStyle(this._containerNode).getPropertyValue("--cosmograph-color-legend-type-font-family")||"inherit",o="300",s=document.createElement("canvas").getContext("2d");s.font=`${o} ${n} ${r}`;let a=0;if(this._listItems.forEach(h=>{const d=s.measureText(h.label).width;d>a&&(a=d)}),this._listItems.length>(this._config.maxDisplayedItems||qs)){const h=this._listItems.length-(this._config.maxDisplayedItems||qs);a=Math.max(a,s.measureText(`${h} more...`).width,s.measureText("show less").width)}const l=13+a+10,c=((e=this._containerNode.parentElement)==null?void 0:e.offsetWidth)||0,u=c>0?Math.min(c-20,l):l;this._calculatedWidth=Math.max(100,u),this._maxMeasuredWidth=this._calculatedWidth,this._applyCalculatedWidth(this._calculatedWidth)}_applyCalculatedWidth(e){this._containerNode.style.minWidth=`${e}px`,this._wrapper.style.minWidth=`${e}px`}}const cY={onClick:void 0,iconSvg:void 0,description:void 0},uY="style_module_button__e95a1138",hY={button:uY};(function(){try{if(typeof document<"u"){var i=document.createElement("style");i.appendChild(document.createTextNode('@keyframes style_module_fadeIn__ffac87fd{0%{opacity:0}to{opacity:.2}}.style_module_displayState__6ae19b84{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--cosmograph-ui-text);display:flex;justify-content:center;align-items:center;min-width:100px;opacity:.2;font-size:calc(var(--cosmograph-ui-font-size) + 1px);letter-spacing:-.02em;font-weight:200;user-select:none;-webkit-user-select:none;animation:style_module_fadeIn__ffac87fd .3s ease-in-out}:root{--cosmograph-timeline-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-timeline-selection-opacity: .5;--cosmograph-timeline-bar-color: var(--cosmograph-ui-element-color);--cosmograph-timeline-highlighted-bar-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-timeline-font-family: var(--cosmograph-ui-font-family);--cosmograph-timeline-font-size: var(--cosmograph-ui-tick-font-size);--cosmograph-timeline-background: var(--cosmograph-ui-background);--cosmograph-timeline-text-color: var(--cosmograph-ui-text);--cosmograph-timeline-axis-color: var(--cosmograph-ui-text)}.style_module_timeline__736434f7{position:relative;display:flex;background:var(--cosmograph-timeline-background);width:100%;min-height:25px;overflow:hidden}.style_module_timelineSvg__b916ad04{position:relative;width:100%;height:100%}.style_module_selection__ebee57f8{fill:var(--cosmograph-timeline-selection-color);fill-opacity:var(--cosmograph-timeline-selection-opacity);stroke:none}.style_module_axisTick__5865631d{color:var(--cosmograph-timeline-axis-color);font:var(--cosmograph-timeline-font-family);font-size:var(--cosmograph-timeline-font-size);user-select:none;-webkit-user-select:none;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum";alignment-baseline:text-before-edge}.style_module_axisLine__992b502d{opacity:.2;color:var(--cosmograph-timeline-axis-color)}.style_module_bar__114fa79f{fill:var(--cosmograph-timeline-bar-color);transform:scaleY(-1);opacity:0}.style_module_animationControl__ee52cd66{color:var(--cosmograph-timeline-axis-color);width:6%;max-width:30px;min-width:20px;cursor:pointer;display:none;align-items:center;user-select:none;-webkit-user-select:none;opacity:.5;position:relative;justify-content:center}.style_module_animationControl__ee52cd66>svg{width:50%;max-height:20px;padding-right:2px}.style_module_hidden__a73fe81a{display:none}.style_module_disabled__eb988570{opacity:.2;pointer-events:none}.style_module_highlightedBar__c2fc9bdc{fill:var(--cosmograph-timeline-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-search-font-family: var(--cosmograph-ui-font-family);--cosmograph-search-font-size: 14px;--cosmograph-search-list-font-size: 13.5px;--cosmograph-search-text-color: var(--cosmograph-ui-text);--cosmograph-search-background: transparent;--cosmograph-search-list-background: rgba(0, 0, 0, .2);--cosmograph-search-list-match-background: rgba(255, 255, 255, .2);--cosmograph-search-list-match-color: var(--cosmograph-ui-text)}.style_module_searchInput__d7830601:hover{filter:brightness(1.2) contrast(1)}.style_module_searchInput__d7830601{width:100%;background:transparent;color:var(--cosmograph-search-text-color);border:none;border-bottom:.5px solid var(--cosmograph-search-text-color);padding:4px 20px 5px 2px;font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:opacity .2s ease-out}.style_module_searchInput__d7830601::selection{background:var(--cosmograph-search-list-match-background)}.style_module_searchInput__d7830601:focus{outline:none}.style_module_searchSuggestions__b0d3f71e{color:#fff;width:100%;padding:0;margin:0;background:transparent;overflow-y:auto;flex:1;min-height:0}.style_module_searchSuggestions__b0d3f71e li{padding:5px 10px;cursor:pointer;-webkit-user-select:none;user-select:none;display:block;font-weight:500;font-size:var(--cosmograph-search-list-font-size);max-width:100%;overflow:hidden}.style_module_searchSuggestions__b0d3f71e li>div{white-space:nowrap;font-weight:200;overflow:hidden;text-overflow:ellipsis;width:100%}.style_module_searchSuggestions__b0d3f71e li:hover{background:#ffffff1a}.style_module_searchSuggestions__b0d3f71e mark{background:var(--cosmograph-search-list-match-background);color:var(--cosmograph-search-list-match-color);border-radius:2px}.style_module_clearButton__5ebb41de{position:absolute;right:0;top:0;height:100%;background:none;border:none;color:var(--cosmograph-search-text-color);font-weight:300;cursor:pointer;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d{opacity:.7}.style_module_placeholderWrapper__72d5eb0e{z-index:1;color:var(--cosmograph-search-text-color);font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);position:absolute;top:0;left:0;width:100%;bottom:0;display:flex;line-height:1.25;align-items:center;transition:transform .3s ease-out,opacity .3s ease-out}.style_module_placeholderWrapper__72d5eb0e.style_module_hidden__acfb8431{transform:translate(-30px);pointer-events:none;opacity:0}.style_module_searchInput__d7830601:disabled,.style_module_searchInput__d7830601.style_module_disabled__62c35dc5{opacity:.2;cursor:not-allowed;pointer-events:none}.style_module_disabled__62c35dc5 .style_module_clearButton__5ebb41de{display:none}.style_module_disabled__62c35dc5 .style_module_placeholderWrapper__72d5eb0e{opacity:.3;cursor:not-allowed}.style_module_searchInputWrapper__1edbcb22{position:relative;display:flex;width:100%}.style_module_noResults__363397c3{opacity:.3!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none}.style_module_noResults__363397c3:hover{background:none}.style_module_loading__296e0212{opacity:.7!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none;-webkit-user-select:none;user-select:none}.style_module_dropdownContainer__d98287da{position:absolute;top:100%;left:0;width:100%;background:var(--cosmograph-search-list-background);border-radius:4px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);opacity:0;transform:translateY(-10px);transition:opacity .2s ease-out,transform .2s ease-out;pointer-events:none;overflow:hidden;z-index:10;display:flex;flex-direction:column;padding-bottom:2px}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b{top:auto;bottom:100%;transform:translateY(10px)}.style_module_dropdownContainer__d98287da.style_module_visible__5be7493d{opacity:1;transform:translateY(0);pointer-events:auto}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b.style_module_visible__5be7493d{opacity:1;transform:translateY(-2px);pointer-events:auto}.style_module_footerContainer__73e7a066{flex-shrink:0}:root{--cosmograph-scrollbar-background: rgba(255, 255, 255, .1);--cosmograph-ui-background: rgb(45, 49, 58);--cosmograph-ui-text: #ffffffc7;--cosmograph-ui-tick-font-size: 11px;--cosmograph-ui-font-size: 12px;--cosmograph-ui-font-family: inherit;--cosmograph-ui-element-color: #5C616A;--cosmograph-ui-highlighted-element-color: white;--cosmograph-ui-selection-control-color: #8d949ea8;-webkit-font-smoothing:antialiased!important;text-rendering:optimizeLegibility!important}.style_module_cosmograph-ui__5acb97f1{background:var(--cosmograph-ui-background);color:var(--cosmograph-ui-text)}.style_module_scrollbar__f1516254 *::-webkit-scrollbar{width:5px;height:5px;border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-track{border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-corner{background:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-button{display:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-thumb{background-color:var(--cosmograph-scrollbar-background);transition:background-color .5s;border-radius:20px;border:3px solid var(--cosmograph-scrollbar-background)}@-moz-document url-prefix(){.style_module_scrollbar__f1516254 *{scrollbar-width:thin;scrollbar-color:var(--cosmograph-scrollbar-background) transparent;scrollbar-track-color:transparent;scrollbar-face-color:var(--cosmograph-scrollbar-background)}}:root{--cosmograph-histogram-background: var(--cosmograph-ui-background);--cosmograph-histogram-text-color: var(--cosmograph-ui-text);--cosmograph-histogram-axis-color: var(--cosmograph-ui-text);--cosmograph-histogram-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-histogram-selection-opacity: .5;--cosmograph-histogram-bar-color: var(--cosmograph-ui-element-color);--cosmograph-histogram-highlighted-bar-color: var( --cosmograph-ui-highlighted-element-color);--cosmograph-histogram-font-family: var(--cosmograph-ui-font-family);--cosmograph-histogram-font-size: var(--cosmograph-ui-tick-font-size)}.style_module_histogram__9d8a77ea{position:relative;display:flex;min-height:25px;background:var(--cosmograph-histogram-background);width:100%}.style_module_histogramSvg__ccccb628{position:relative;width:100%;height:100%}.style_module_selection__7db96137{fill:var(--cosmograph-histogram-selection-color);fill-opacity:var(--cosmograph-histogram-selection-opacity);stroke:none}.style_module_axisTick__898e1f39{color:var(--cosmograph-histogram-axis-color);font-family:var(--cosmograph-histogram-font-family);font-size:var(--cosmograph-histogram-font-size);user-select:none;-webkit-user-select:none;alignment-baseline:text-before-edge;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum"}.style_module_bar__3c9ab488{fill:var(--cosmograph-histogram-bar-color);transform:scaleY(-1)}.style_module_highlightedBar__b193a8de{fill:var(--cosmograph-histogram-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-bars-font-color: var(--cosmograph-ui-text);--cosmograph-bars-font-family: var(--cosmograph-ui-font-family);--cosmograph-bars-font-size: var(--cosmograph-ui-font-size);--cosmograph-bars-ui-font-size: 11.5px;--cosmograph-bars-background: var(--cosmograph-ui-element-color);--cosmograph-bars-bar-height: 20px;--cosmograph-bars-bar-bottom-margin: 2px;--cosmograph-bars-highlighted-color: var( --cosmograph-ui-highlighted-element-color)}.style_module_bars__25497ded{position:relative;width:100%;min-height:100px;user-select:none;flex-direction:column;-webkit-user-select:none}.style_module_bars__25497ded .scroll-container{position:relative;width:100%;overflow-y:hidden;overflow-x:hidden}.style_module_bars__25497ded .bars-container{position:relative;width:calc(100% - 1px);font-family:var(--cosmograph-bars-font-family)}.style_module_bars__25497ded .highlighted-bars-container{position:absolute;top:0;left:0;pointer-events:none}.style_module_bars__25497ded .row{height:var(--cosmograph-bars-bar-height);display:flex;align-items:center;margin-bottom:var(--cosmograph-bars-bar-bottom-margin);width:100%;transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row:hover{filter:brightness(1.15) contrast(1.05);transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row.unselected:hover{filter:brightness(.95) contrast(1.15);transition:filter .05s linear}.style_module_bars__25497ded .unselected{opacity:.85;filter:brightness(.8) contrast(1.1)}.style_module_bars__25497ded .selected{filter:brightness(1.05) contrast(1.05)}.style_module_bars__25497ded .selected>.info>.label{font-weight:600;filter:brightness(1.1) contrast(1.05)}.style_module_bars__25497ded .unselected>.info>.label{font-weight:300}.style_module_bars__25497ded .bar{height:100%;background-color:var(--cosmograph-bars-background);opacity:.8;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .bar-highlighted{height:100%;background-color:var(--cosmograph-bars-highlighted-color);opacity:.2;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .info{display:flex;justify-content:space-between;width:100%;padding:0 4px;position:absolute;font-size:var(--cosmograph-bars-font-size);font-feature-settings:"tnum";color:var(--cosmograph-bars-font-color);gap:2px}.style_module_bars__25497ded .label{min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:opacity .05s linear}.style_module_bars__25497ded .count{flex-shrink:0;font-weight:300;opacity:.8;transition:opacity .05s linear}.style_module_bars__25497ded .show-more{cursor:pointer;padding-top:2px;display:flex;font-weight:300;color:var(--cosmograph-bars-font-color);font-size:11px;justify-content:space-between;opacity:.6;font-size:var(--cosmograph-bars-ui-font-size);pointer-events:none;transition:opacity .1s linear}.style_module_bars__25497ded .show-more:hover{opacity:1;text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .show-more>span{pointer-events:all}.style_module_bars__25497ded .show-more-count{padding-right:5px;pointer-events:all;font-feature-settings:"tnum"}.style_module_bars__25497ded .unselected>.info>.label,.style_module_bars__25497ded .unselected>.info>.count{opacity:.5}.style_module_bars__25497ded .unselected:hover>.info>.label,.style_module_bars__25497ded .unselected:hover>.info>.count{opacity:1}.style_module_bars__25497ded .search-input{background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,.3);font-size:13px!important;color:var(--cosmograph-bars-font-color);line-height:1.5;padding:2px;width:100%;position:relative;transition:border-bottom-color .2s}.style_module_bars__25497ded .search-input::placeholder{color:var(--cosmograph-bars-font-color)!important;opacity:.4;font-weight:300;font-family:inherit}.style_module_bars__25497ded .search-container{position:relative;width:100%;margin-bottom:4px;display:none;z-index:1}.style_module_bars__25497ded .clear-button{position:absolute;right:0;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--cosmograph-bars-font-color);font-weight:300;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_bars__25497ded .clear-button.visible:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_bars__25497ded .clear-button.visible{opacity:.7}.style_module_bars__25497ded .clear-button svg{width:10px;height:10px;fill:currentColor}.style_module_bars__25497ded .sorting-block{visibility:hidden;margin-top:1px;display:flex;justify-content:space-between}.style_module_bars__25497ded .buttons-container{margin-top:4px;font-size:var(--cosmograph-bars-ui-font-size);display:flex;gap:4px;line-height:1.25}.style_module_bars__25497ded .buttons-container>div{transition:opacity .05s linear,filter .05s linear;padding:1px 5px;background:var(--cosmograph-bars-background);border-radius:4px;opacity:.9;display:flex;cursor:pointer;align-items:center}.style_module_bars__25497ded .buttons-container>div:hover{filter:brightness(1.2)}.style_module_bars__25497ded .reset-text{transition:opacity .05s linear,filter .05s linear;display:flex;font-size:var(--cosmograph-bars-ui-font-size);align-items:end;padding-right:4px;cursor:pointer;font-weight:300}.style_module_bars__25497ded .reset-text:hover{text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .reset-text.unselected{pointer-events:none;cursor:default;opacity:.7}.style_module_bars__25497ded :scope.reset-text:hover:not(.unselected){filter:brightness(1.5);opacity:1}:root{--cosmograph-size-legend-form-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-family: inherit;--cosmograph-size-legend-font-size: var(--cosmograph-ui-font-size);--cosmograph-size-legend-sublabel-font-size: 10px;--cosmograph-size-legend-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-size-legend-line-radius: 2px;--cosmograph-size-legend-line-width: 30px;--cosmograph-size-legend-hide-transform: translateY(100%);--cosmograph-size-legend-show-transform: translateX(0)}.style_module_container__d2889234{display:flex;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;overflow:hidden;min-height:25px}.style_module_legend__75c167f2{width:auto;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-size-legend-font-size);font-family:var(--cosmograph-size-legend-font-family);user-select:none;-webkit-user-select:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.04em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__91eae57a{opacity:1;transform:var(--cosmograph-size-legend-show-transform)}.style_module_disabled__d51f7a10{opacity:0;transform:var(--cosmograph-size-legend-hide-transform);pointer-events:none;display:none!important;min-height:0}@starting-style{.style_module_container__d2889234.style_module_enabled__91eae57a,.style_module_legend__75c167f2.style_module_enabled__91eae57a{opacity:0;transform:var(--cosmograph-size-legend-hide-transform)}}.style_module_legend__75c167f2 .circle{background-color:var(--cosmograph-size-legend-form-color);border-radius:50%;transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2 .line{background-color:var(--cosmograph-size-legend-form-color);border-radius:var(--cosmograph-size-legend-line-radius);width:var(--cosmograph-size-legend-line-width);transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2.style_module_events__894316a8{pointer-events:auto;cursor:pointer}.style_module_legend__75c167f2 .legend-content{display:flex;align-items:end;justify-content:center;gap:.75rem}.style_module_legend__75c167f2 .legend-content>div{transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__75c167f2 .labels-wrapper{white-space:nowrap}.style_module_legend__75c167f2 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-size-legend-items-margin)}.style_module_legend__75c167f2 .name{align-items:center;text-align:center;justify-content:center;display:flex;color:var(--cosmograph-size-legend-font-color);overflow:hidden;width:100%;margin-top:3px;word-break:break-all;white-space:pre-line;transition:color .15s ease-in-out;letter-spacing:-.02em}.style_module_legend__75c167f2 .label{color:var(--cosmograph-size-legend-font-color);overflow:hidden;transition:color .15s ease-in-out;text-overflow:ellipsis;font-feature-settings:"tnum"}.style_module_legend__75c167f2 .sublabel{padding-top:1px;font-size:var(--cosmograph-size-legend-sublabel-font-size);opacity:.5;line-height:1;min-width:10px;transition:color .15s ease-in-out}.style_module_hovered__1206707f .label,.style_module_hovered__1206707f .sublabel{color:var(--cosmograph-size-legend-hover-color);cursor:pointer}.style_module_hovered__1206707f .circle,.style_module_hovered__1206707f .line{background-color:var(--cosmograph-size-legend-hover-color);cursor:pointer}:root{--cosmograph-color-legend-range-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-range-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-range-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-label-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-sublabel-font-size: 10px;--cosmograph-color-legend-range-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-range-gradient-height: 6px;--cosmograph-color-legend-range-gradient-radius: 8px;--cosmograph-color-legend-range-gradient-top-margin: 6px;--cosmograph-color-legend-hide-transform: translateY(100%);--cosmograph-color-legend-show-transform: translateX(0)}.style_module_container__05cc807d{display:flex;min-width:150px;min-height:25px;width:100%;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_legend__a3e235e4{width:100%;font-weight:300;letter-spacing:-.04em;display:flex;flex-direction:column;font-size:var(--cosmograph-color-legend-range-font-size);font-family:var(--cosmograph-color-legend-range-font-family);user-select:none;-webkit-user-select:none;pointer-events:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__b3120e27{opacity:1;transform:var(--cosmograph-color-legend-show-transform);pointer-events:auto}.style_module_disabled__c2dc158c{opacity:0;transform:var(--cosmograph-color-legend-hide-transform);pointer-events:none;display:none;min-height:0}@starting-style{.style_module_container__05cc807d.style_module_enabled__b3120e27,.style_module_legend__a3e235e4.style_module_enabled__b3120e27{opacity:0;transform:var(--cosmograph-color-legend-hide-transform)}}.style_module_legend__a3e235e4 .legend-content{display:flex;align-items:end;justify-content:space-between}.style_module_hovered__dfd7bb2c .label,.style_module_hovered__dfd7bb2c .sublabel{color:var(--cosmograph-size-legend-hover-color)!important;cursor:pointer}.style_module_legend__a3e235e4 .extent{white-space:nowrap;transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__a3e235e4 .gradient{width:100%;margin-top:var(--cosmograph-color-legend-range-gradient-top-margin);height:var(--cosmograph-color-legend-range-gradient-height);border-radius:var(--cosmograph-color-legend-range-gradient-radius)}.style_module_legend__a3e235e4 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-color-legend-range-items-margin)}.style_module_legend__a3e235e4 .name{align-items:center;text-align:center;justify-content:space-around;display:flex;color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;width:100%;word-break:break-word;text-wrap:balance;white-space:pre-line;transition:color .15s ease-in-out;margin:0 4px;letter-spacing:-.02em;line-height:1.25}.style_module_legend__a3e235e4 .label{color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;max-width:150px;text-overflow:ellipsis;font-size:var(--cosmograph-color-legend-range-label-font-size);transition:color .15s ease-in-out;line-height:1;font-feature-settings:"tnum"}.style_module_legend__a3e235e4 .sublabel{padding-top:1px;color:var(--cosmograph-color-legend-range-font-color);opacity:.55;font-size:var(--cosmograph-color-legend-range-sublabel-font-size);line-height:1;transition:color .15s ease-in-out}:root{--cosmograph-color-legend-type-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-type-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-type-font-size: 11px;--cosmograph-color-legend-type-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-type-others-color: #bab0ab;--cosmograph-color-legend-type-bullet-size: 8px;--cosmograph-color-legend-type-bullet-radius: 1rem;--cosmograph-color-legend-type-items-margin: 4px;--cosmograph-color-legend-type-hide-transform: translateY(125%);--cosmograph-color-legend-type-show-transform: translateX(0)}.style_module_enabled__277b2403{opacity:1;transform:var(--cosmograph-color-legend-type-show-transform)}.style_module_disabled__7a587f96{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform);display:none!important;min-height:0}.style_module_wrapper__ea8ca7f4{position:relative;max-width:100%;width:fit-content;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_typeLegend__15bf4b2f{position:relative;width:fit-content;max-width:100%;min-height:25px;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.015em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_typeLegend__15bf4b2f .reverted{flex-direction:row-reverse}.style_module_typeLegend__15bf4b2f .scroll-container{width:100%;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-color-legend-type-font-size);font-family:var(--cosmograph-color-legend-type-font-family);user-select:none;-webkit-user-select:none;line-height:normal;overflow-x:hidden;overflow-y:auto;will-change:transform}@starting-style{.style_module_typeLegend__15bf4b2f.style_module_enabled__277b2403,.style_module_wrapper__ea8ca7f4.style_module_enabled__277b2403{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform)}}.style_module_typeLegend__15bf4b2f .legend-item{display:flex;align-items:center;position:absolute;margin-bottom:var(--cosmograph-color-legend-type-items-margin);pointer-events:none;width:100%;padding-left:1px;font-weight:300;transition:filter .1s ease-in-out,opacity .1s ease-in-out;min-height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px + var(--cosmograph-color-legend-type-items-margin));height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px);box-sizing:border-box}.style_module_typeLegend__15bf4b2f .unknown{background-color:var(--cosmograph-color-legend-type-unknown-color)}.style_module_typeLegend__15bf4b2f .others{background-color:var(--cosmograph-color-legend-type-others-color)}.style_module_typeLegend__15bf4b2f .bullet{height:var(--cosmograph-color-legend-type-bullet-size);width:var(--cosmograph-color-legend-type-bullet-size);min-height:var(--cosmograph-color-legend-type-bullet-size);min-width:var(--cosmograph-color-legend-type-bullet-size);border-radius:var(--cosmograph-color-legend-type-bullet-radius);pointer-events:all;margin-right:5px}.style_module_typeLegend__15bf4b2f .label{color:var(--cosmograph-color-legend-type-font-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - var(--cosmograph-color-legend-type-bullet-size) - 5px);pointer-events:all;transition:.05s linear color}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.bullet{margin-right:0}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.label{margin-right:5px}.style_module_typeLegend__15bf4b2f .show-more{cursor:pointer;padding-top:4px;display:none;font-weight:300;color:var(--cosmograph-color-legend-type-font-color);font-size:11px;opacity:.6;pointer-events:all;justify-content:space-between;transition:opacity .1s linear;font-feature-settings:"tnum"}.style_module_typeLegend__15bf4b2f .show-more:hover{opacity:1}.style_module_hovered__c0993502 .label,.style_module_hovered__c0993502 .sublabel{color:var(--cosmograph-color-legend-type-hover-color)!important;cursor:pointer}.style_module_selected__36e1dd81{filter:brightness(1)}.style_module_selected__36e1dd81>.style_module_label__afecc7a3{filter:brightness(1.2)}.style_module_unselected__4826cfb7{filter:brightness(.5)}.style_module_typeLegend__15bf4b2f .name{font-size:calc(var(--cosmograph-color-legend-type-font-size) + 1px);font-family:var(--cosmograph-color-legend-type-font-family);color:var(--cosmograph-color-legend-type-font-color);transition:color .15s ease-in-out,opacity .3s ease-in-out,max-height .3s ease-in-out,transform .3s ease-in-out;margin-bottom:4px;margin-top:2px;margin-left:1px;letter-spacing:-.02em;line-height:1.25;overflow:hidden;width:100%;white-space:nowrap;text-overflow:ellipsis;pointer-events:all;-webkit-user-select:none!important;user-select:none!important;max-height:100px;opacity:1;transform:translateY(0)}.style_module_typeLegend__15bf4b2f .name.hidden{opacity:0;max-height:0;margin-bottom:0;margin-top:0;transform:translateY(-10px)}:root{--cosmograph-button-color: var(--cosmograph-ui-text);--cosmograph-button-background: var(--cosmograph-ui-element-color);--cosmograph-button-border-radius: 2px}.style_module_button__e95a1138{background:var(--cosmograph-button-background);color:var(--cosmograph-button-color);border-radius:var(--cosmograph-button-border-radius);display:none;align-items:center;justify-content:center;width:25px;height:25px;margin:3px;padding:5px;cursor:pointer;filter:brightness(.95) contrast(.9);transition:filter .1s}.style_module_button__e95a1138:hover{filter:brightness(1.2) contrast(1)}')),document.head.appendChild(i)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();var dY=Object.defineProperty,fY=(i,e,t)=>e in i?dY(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Yp=(i,e,t)=>fY(i,typeof e!="symbol"?e+"":e,t);let vs=class{constructor(e,t){Yp(this,"_container"),Yp(this,"config"),Yp(this,"_handleClick",()=>{var n,r;(r=(n=this.config).onClick)==null||r.call(n)}),this._container=e,this._container.classList.add(hY.button),this.setConfig(t??{}),this._container.addEventListener("click",this._handleClick)}get element(){return this._container}setConfig(e){this.config=Ct(cY,e),this._container.title=this.config.description??"",this._container.innerHTML=this.config.iconSvg??""}show(){this._container.style.display="block"}hide(){this._container.style.display="none"}destroy(){this._container.removeEventListener("click",this._handleClick),this._container.innerHTML=""}};const pY={Points:"points",PointId:"pointIdBy",PointIndex:"pointIndexBy"},rt={PointColor:"pointColorBy",PointColorMap:"pointColorByMap",PointColorFn:"pointColorByFn",PointColorPalette:"pointColorPalette",PointColorStrategy:"pointColorStrategy",PointSize:"pointSizeBy",PointSizeStrategy:"pointSizeStrategy",PointSizeRange:"pointSizeRange",PointSizeFn:"pointSizeByFn",PointLabel:"pointLabelBy",PointLabelWeight:"pointLabelWeightBy",PointX:"pointXBy",PointY:"pointYBy",PointCluster:"pointClusterBy",PointClusterFn:"pointClusterByFn",PointClusterStrength:"pointClusterStrengthBy",PointIncludeColumns:"pointIncludeColumns"},mY={Links:"links",LinkSource:"linkSourceBy",LinkSourceIndex:"linkSourceIndexBy",LinkTarget:"linkTargetBy",LinkTargetIndex:"linkTargetIndexBy"},Lt={LinkColor:"linkColorBy",LinkColorFn:"linkColorByFn",LinkColorPalette:"linkColorPalette",LinkColorStrategy:"linkColorStrategy",LinkWidth:"linkWidthBy",LinkWidthRange:"linkWidthRange",LinkWidthFn:"linkWidthByFn",LinkWidthStrategy:"linkWidthStrategy",LinkArrow:"linkArrowBy",LinkArrowFn:"linkArrowByFn",LinkStrength:"linkStrengthBy",LinkStrengthFn:"linkStrengthByFn",LinkStrengthRange:"linkStrengthRange",LinkIncludeColumns:"linkIncludeColumns"},gY={ClusterPositionsMap:"clusterPositionsMap"},_Y=Object.values(rt),yY=Object.values(Lt),bY=Object.values(gY),AT=Object.values(pY),IT=Object.values(mY),vY=[...yY].filter(i=>i!==Lt.LinkIncludeColumns).concat("linkDefaultColor","linkDefaultWidth"),xY=[..._Y].filter(i=>i!==rt.PointLabel&&i!==rt.PointLabelWeight&&i!==rt.PointIncludeColumns).concat("pointDefaultColor","pointDefaultSize"),Rg={ShowLabels:"showLabels",ShowDynamicLabels:"showDynamicLabels",ShowTopLabels:"showTopLabels",ShowTopLabelsLimit:"showTopLabelsLimit",ShowLabelsFor:"showLabelsFor",ShowClusterLabels:"showClusterLabels",PointLabelClassName:"pointLabelClassName",PointLabelFn:"pointLabelFn",PointLabelWeightFn:"pointLabelWeightFn",PointLabelColor:"pointLabelColor",PointLabelFontSize:"pointLabelFontSize",ClusterLabelFontSize:"clusterLabelFontSize",ClusterLabelClassName:"clusterLabelClassName",ScaleClusterLabels:"scaleClusterLabels",UsePointColorStrategyForClusterLabels:"usePointColorStrategyForClusterLabels",StaticLabelWeight:"staticLabelWeight",DynamicLabelWeight:"dynamicLabelWeight",LabelMargin:"labelMargin",LabelPadding:"labelPadding",CustomLabels:"customLabels"},wY=[...Object.values(Rg),rt.PointLabel,rt.PointLabelWeight],uu=.95,hu=.05,fc=[2,9],kT=[1,9],SY=[.2,1],EY=8192,LT=["rgba(43, 85, 168, 0.85)","rgba(153, 82, 213, 0.85)","rgba(240, 105, 180, 0.85)","rgba(255, 149, 131, 0.85)","rgba(254, 224, 139, 0.85)"],RT=["#206176","#38657e","#506987","#686d90","#807098","#9874a1","#af78a9","#c77cb2","#df7fba","#f783c3","#FFB4D3","#f6c0d8"],fb="rgb(45, 49, 58)",il="rgba(205, 207, 213, 0.9)",Pg=il,CY=il,Al=16,TY=!1,AY="color: white; background: #333841;",IY="background: none; font-weight: 300; opacity: 0.9;",qp={showLabels:!0,showTopLabels:!0,showDynamicLabels:!0,showHoveredPointLabel:!1,scaleClusterLabels:!0,usePointColorStrategyForClusterLabels:!1,showTopLabelsLimit:30,staticLabelWeight:.8,dynamicLabelWeight:.7,pointGreyoutOpacity:.3,labelMargin:5,pointSamplingDistance:170,labelPadding:[6.5,4.5,6.5,4.5],preservePointPositionsOnDataUpdate:!1,backgroundColor:fb,hoveredPointLabelClassName:AY,pointLabelFontSize:13,clusterLabelFontSize:16,clusterLabelClassName:IY,pointSizeRange:fc,linkWidthRange:kT,linkStrengthRange:SY,pointColorPalette:LT,linkColorPalette:RT,pointDefaultColor:Pg,linkDefaultColor:CY,unknownColor:il,hoveredLinkWidthIncrease:0,simulationRepulsion:.5,simulationFriction:.5,simulationLinkSpring:.4,simulationLinkDistance:20,resetSelectionOnEmptyCanvasClick:!0},Qd=i=>i===rt.PointLabel?"":i===rt.PointLabelWeight||i===rt.PointX||i===rt.PointY||i===rt.PointCluster?0:i===rt.PointClusterStrength?1:i===Lt.LinkStrength?0:i===Lt.LinkArrow?TY:0,xs=async(i,e)=>{const t=await i.query("SHOW ALL TABLES"),n=t==null?void 0:t.toArray();if(!(n!=null&&n.length))return!1;const[r,o]=e.includes(".")?e.split("."):["main",e];return n.find(s=>s.name===o&&s.schema===r)!==void 0},PT=async(i,e)=>{const t=await i.query(`PRAGMA table_info(${e})`);return t?t.toArray().map(({name:n,type:r})=>({name:n,type:r})):[]},V1=async(i,e)=>await xs(i,e)?(await i.query(`SUMMARIZE ${e}`)).toArray():[],Wa=async(i,e)=>{const t=await PT(i,e);return t?t.map(n=>n.name):[]},zf=async(i,e,t,n)=>{const r=await Wa(i,e);if(!r.length)return n==null||n.push(...t),!1;const o=new Set(r),s=t.filter(a=>!o.has(a));return n==null||n.push(...s),s.length===0},eh=(i,e,t=4)=>{if(i.size>=e.length/t)return new Float32Array(0);const n=new Float32Array(e.length-i.size*t);let r=0;for(let o=0;o<e.length;o+=t)i.has(o/t)||(n.set(e.subarray(o,o+t),r),r+=t);return n},Dg=i=>{const e=new Map;for(const t of i)e.set(t,(e.get(t)||0)+1);return Array.from(e.entries()).sort((t,n)=>n[1]-t[1]).map(t=>t[0])},pb=(i,e,t)=>i.length?i.reduce((n,r,o)=>(t(r,e)&&n.push(o),n),[]):[],Gc=(i,e)=>{const t=$a(i,hu),n=$a(i,uu);if(t===n){const[r,o]=Yi(i);return e?e(r,o):[r,o]}return e?e(t,n):[t,n]},DT=(i,e,t)=>{if(!i.length)return t;const n=e?Gc(i):Yi(i);if(n[0]===void 0||n[1]===void 0)return t;if(!t)return n;if(!e)return t;const[r,o]=t,[s,a]=n,l=Math.max(r,s),c=Math.min(o,a);return!Number.isFinite(l)||!Number.isFinite(c)||l>=c?t:[l,c]},kY=(i,e)=>{if(!(i!=null&&i.length))return[];const t=[],n=e;for(let r=0;r<i.length;r++){const o=i[r];if(Array.isArray(o))for(let s=0;s<o.length;s++){const a=o[s];a!=null&&t.push(n?n(a):a)}else o!=null&&t.push(n?n(o):o)}return t},MT=async(i,e,t)=>await i.query(`SELECT ${(t==null?void 0:t.map(n=>`"${n}"`).join(", "))??"*"} FROM ${e}`),LY=async(i,e,t,n)=>{const r=n.join(", ");return await i.query(`SELECT * FROM ${e} WHERE "${t}" IN (${r})`)},Jd=async(i,e,t,n)=>{var a;const r=n.map(l=>typeof l=="string"?`${If(l)}`:l),o=`SELECT "${t.pointIndexBy}" FROM ${e} WHERE "${t.pointIdBy}" IN (${r})`,s=await i.query(o);return s?((a=s.getChildAt(0))==null?void 0:a.toArray())??[]:void 0},NT=async(i,e,t,n)=>{var a;const r=n.join(", "),o=`SELECT "${t.pointIdBy}" FROM ${e} WHERE "${t.pointIndexBy}" IN (${r})`,s=await i.query(o);return s?((a=s.getChildAt(0))==null?void 0:a.toArray())??[]:void 0},RY=async(i,e,t,n,r)=>{var l;const o=r.map(c=>typeof c=="string"?`${If(c)}`:c),s=`SELECT "${t.pointIndexBy}" FROM ${e} WHERE "${n}" IN (${o.join(", ")})`,a=await i.query(s);return a?((l=a.getChildAt(0))==null?void 0:l.toArray())??[]:void 0},PY=async(i,e,t,n,r,o)=>{var c;const s=o?">=":"<=",a=`SELECT "${t.pointIndexBy}" FROM ${e} WHERE "${n}" ${s} ${r}`,l=await i.query(a);if(l)return((c=l.getChildAt(0))==null?void 0:c.toArray())??[]},DY=async(i,e,t)=>{if(!(t!=null&&t.pointXBy)||!(t!=null&&t.pointYBy))return!1;const n=await Wa(i,e);return n.includes(t.pointXBy)&&n.includes(t.pointYBy)},MY=(i,e)=>{if(!(e!=null&&e.pointXBy)||!(e!=null&&e.pointYBy))return[];const t=i.getChild(e.pointXBy),n=i.getChild(e.pointYBy),r=i.numRows,o=new Array(2*r);for(let s=0;s<r;s++)o[2*s]=t==null?void 0:t.get(s),o[2*s+1]=n==null?void 0:n.get(s);return o},Mg=(i,e=EY,t=e/2,n=e/8)=>Array.from({length:2*i},()=>{const r=t+n*Math.sqrt(-2*Math.log(Math.random()))*Math.cos(2*Math.PI*Math.random());return Math.max(1,Math.min(e-1,r))}),NY=(i,e)=>{const t=i==null?void 0:i.getPointPositions(),n=i.getScaleX(),r=i.getScaleY();if(t!=null&&t.length){const o=e-t.length/2;let s=Mg(o,i.config.spaceSize);return n&&r&&(s=s.map((a,l)=>l%2==0?n(a):r(a))),t.concat(s)}return Mg(e,i.config.spaceSize)},BY=(i,e)=>new Map(Array.from({length:e},(t,n)=>[n,[i[2*n],i[2*n+1]]])),OY=(i,e)=>{const t=i.length/2;for(let n=0;n<t;n++){const r=e.get(n);r&&(i[2*n]=r[0],i[2*n+1]=r[1])}e.clear()},FY=(i,e)=>{if(!e.linkSourceIndexBy||!e.linkTargetIndexBy)return new Float32Array(0);const t=i.getChild(e.linkSourceIndexBy),n=i.getChild(e.linkTargetIndexBy),r=i.numRows,o=new Float32Array(2*r);for(let s=0,a=0;s<r;s++,a+=2)o[a]=(t==null?void 0:t.get(s))??0,o[a+1]=(n==null?void 0:n.get(s))??0;return o},zY=(i,e)=>{if(!e.linkSourceIndexBy||!e.linkTargetIndexBy)return new Set;const t=i.getChild(e.linkSourceIndexBy),n=i.getChild(e.linkTargetIndexBy);if(!t||!n)return new Set;const r=new Set;for(let o=0;o<t.length;o++)r.add(t.get(o)),r.add(n.get(o));return r},BT=async(i,e)=>{var o,s;const t=await i.query(e);if(!t)return;const n=((o=t.getChildAt(0))==null?void 0:o.toArray())??[],r=((s=t.getChildAt(1))==null?void 0:s.toArray())??[];return[...new Set([...n,...r])]},UY=async(i,e,t,n,r)=>{const o=r.map(a=>typeof a=="string"?`${If(a)}`:a),s=`SELECT "${t.linkSourceIndexBy}", "${t.linkTargetIndexBy}" FROM ${e} WHERE "${n}" IN (${o.join(", ")})`;return BT(i,s)},$Y=async(i,e,t,n,r,o)=>{const s=o?">=":"<=",a=`SELECT "${t.linkSourceIndexBy}", "${t.linkTargetIndexBy}" FROM ${e} WHERE "${n}" ${s} ${r}`;return BT(i,a)},VY=async(i,e,t,n)=>{const r=n.map(o=>typeof o=="string"?`${If(o)}`:o);return await i.query(`SELECT * FROM ${e} WHERE "${t.linkSourceBy}" IN (${r}) OR "${t.linkTargetBy}" IN (${r})`)},HY=async(i,e,t,n)=>{const r=n.join(", ");return await i.query(`SELECT * FROM ${e} WHERE "${t.linkSourceIndexBy}" IN (${r}) OR "${t.linkTargetIndexBy}" IN (${r})`)},OT=async(i,e,t)=>await i.query(`SELECT ${(t==null?void 0:t.map(n=>`"${n}"`).join(", "))??"*"} FROM ${e}`),GY=[null,void 0,"null","","undefined","nan"],H1=i=>GY.includes(typeof i=="string"?i.toLowerCase():i),FT=i=>{const e=$a(i,hu),t=$a(i,uu),[n,r]=Yi(i),o=e===t?n:e,s=e===t?r:t;return o===s?[o,s+1e-6]:[o,s]},mb=(i,e,t)=>{const n=new Set(i);for(const o of n)H1(o)&&n.delete(o);const r=lT().domain(Array.from(n)).range(e);return o=>H1(o)?t:r(o)},Ca=(i,e,t,n=!0)=>{const r=n?FT(i):Yi(i);return vT(jC(WC.gamma(1.5),e)).domain(r).unknown(t).clamp(!0)},WY=(i,e,t)=>{const n=Array.from(new Set(i)),r=x$(jC(WC.gamma(2.2),e),n.length);return mb(n,r.reverse(),t)},Ng=(i,e,t,n=!0)=>{const r=n?FT(i):Yi(i);return fT().domain(r).range(e).unknown(t)},jY=(i,e)=>i?[i[4*e]??0,i[4*e+1]??0,i[4*e+2]??0,i[4*e+3]??0]:void 0,YY=i=>{const e=(t=>{const n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return n?{r:parseInt((n[1]||0).toString(),16),g:parseInt((n[2]||0).toString(),16),b:parseInt((n[3]||0).toString(),16)}:{r:0,g:0,b:0}})(i);return(.2126*e.r+.7152*e.g+.0722*e.b)/255},no=(i,e)=>{if(!i)return e;if(typeof i=="string")return i;const[t,n,r]=i.map(o=>Math.round(255*o));return`rgb(${t}, ${n}, ${r})`},qY=i=>{var o,s;if(!i)return;if(typeof i=="string")return(o=ao(i))==null?void 0:o.formatHex();const[e,t,n,r]=i;return(s=ao(`rgba(${e}, ${t}, ${n}, ${r})`))==null?void 0:s.formatHex()},pc=(i,e,t=!1)=>{let n;if(t){const r=$a(i,hu),o=$a(i,uu);n=r===o?Yi(i):[r,o]}else n=Yi(i);return n[0]===n[1]&&(n[1]=n[1]+1e-6),Bf().range(e).domain(n).clamp(!0)},XY=(i,e)=>{const t=[];return e.forEach((n,r)=>{if(i&&n in i){const o=i[n];if(o){const[s,a]=o;t[2*r]=s,t[2*r+1]=a}else t[2*r]=void 0,t[2*r+1]=void 0}else t[2*r]=void 0,t[2*r+1]=void 0}),t};let KY=class{constructor(){m(this,"_colorStore");this._colorStore=new Map}getColor(e){if(this._colorStore.has(e))return this._colorStore.get(e);{const t=Fd(e),n=[t.r/255,t.g/255,t.b/255,t.opacity];return this._colorStore.set(e,n),n}}clearCache(){this._colorStore.clear()}};const Xs=(i,e,t)=>{const n=new Float32Array(i.length);for(let r=0;r<i.length;r++){const o=i.get(r);n[r]=t?t(o,r):o??e}return n},Il=(i,e,t)=>{const n=new Float32Array(4*i.length),r=new KY;for(let o=0;o<i.length;o++){const s=i.get(o),a=t?t(s,o):s??e;let[l,c,u,h]=Array.isArray(a)?a:r.getColor(a);(isNaN(l)||isNaN(c)||isNaN(u)||isNaN(h))&&([l,c,u,h]=Array.isArray(e)?e:r.getColor(e));const d=4*o;n[d]=l,n[d+1]=c,n[d+2]=u,n[d+3]=h}return r.clearCache(),n},ZY=(i,e,t)=>{const n=new Array(i.length);for(let r=0;r<i.length;r++){const o=i.get(r);n[r]=t?t(o,r):o??e}return n};var Re;function QY(i={},e){const{pointColorStrategy:t,pointColorBy:n,pointColorByFn:r,pointColorByMap:o,linkSourceBy:s,linkTargetBy:a}=i;if(t&&Object.values(Re).includes(t))return t;if(r)return Re.Direct;if(n){if(o)return Re.Map;if(Ho(e))return Re.Continuous;if(Oc(e)||Fc(e))return Re.Categorical}return!n&&s&&a?Re.Degree:Re.Single}(function(i){i.Categorical="categorical",i.Continuous="continuous",i.Map="map",i.Degree="degree",i.PreciseDegree="preciseDegree",i.LinkDirection="linkDirection",i.Direct="direct",i.Single="single"})(Re||(Re={}));const Xp=(i,e,t,n)=>{const r=no(e.unknownColor,il),o=e.pointColorPalette??LT;return{[Re.Degree]:()=>Ca(t,o,r),[Re.PreciseDegree]:()=>Ca(t,o,r,!1),[Re.LinkDirection]:()=>Ng(t,o,r,!1),[Re.Map]:()=>s=>e.pointColorByMap?e.pointColorByMap[s]??r:r,[Re.Categorical]:()=>{let s;if(Ho(n)&&(s=Ng(t,o,r)),Oc(n)||Fc(n)){const a=Dg(t);s=mb(a,o,r)}return s},[Re.Continuous]:()=>{let s;if(Ho(n)&&(s=Ca(t,o,r)),Oc(n)||Fc(n)){const a=Dg(t);s=WY(a,o,r)}return s},[Re.Direct]:()=>e.pointColorByFn,[Re.Single]:()=>()=>e.pointDefaultColor}[i]()};var He;function JY(i={},e){const{linkColorStrategy:t,linkColorBy:n,linkColorByFn:r,linkSourceBy:o,linkTargetBy:s}=i;if(t&&Object.values(He).includes(t))return t;if(r)return He.Direct;if(n){if(Ho(e))return He.Sum;if(Oc(e)||Fc(e))return He.Categorical}return!n&&o&&s?He.Count:He.Single}(function(i){i.Sum="sum",i.Average="average",i.Count="count",i.Categorical="categorical",i.Direct="direct",i.Single="single"})(He||(He={}));const G1=(i,e,t,n)=>{const r=no(e.unknownColor,il),o=e.linkColorPalette??RT;return{[He.Sum]:()=>Ca(t,o,r),[He.Average]:()=>Ca(t,o,r),[He.Count]:()=>Ca(t,o,r),[He.Categorical]:()=>{let s;if(Ho(n)&&(s=Ng(t,o,r)),Oc(n)||Fc(n)){const a=Dg(t);s=mb(a,o,r)}return s},[He.Direct]:()=>e.linkColorByFn,[He.Single]:()=>()=>e.linkDefaultColor}[i]()};var Tt;(function(i){i.Degree="degree",i.PreciseDegree="preciseDegree",i.Auto="auto",i.Direct="direct",i.Single="single"})(Tt||(Tt={}));const W1=(i,e,t)=>({[Tt.Degree]:()=>pc(t,e.pointSizeRange??fc,!0),[Tt.PreciseDegree]:()=>pc(t,e.pointSizeRange??fc),[Tt.Auto]:()=>pc(t,e.pointSizeRange??fc,!0),[Tt.Direct]:()=>e.pointSizeByFn,[Tt.Single]:()=>()=>e.pointDefaultSize})[i]();function eq(i,e){const{pointSizeStrategy:t,pointSizeBy:n,pointDefaultSize:r,pointSizeByFn:o,linkSourceBy:s,linkTargetBy:a}=i;return t&&Object.values(Tt).includes(t)?t:o?Tt.Direct:n&&Ho(e)?Tt.Auto:!r&&!n&&s&&a?Tt.Degree:Tt.Single}var ot;(function(i){i.Sum="sum",i.Average="average",i.Count="count",i.Direct="direct",i.Single="single"})(ot||(ot={}));const j1=(i,e,t)=>{const n=()=>pc(t,e.linkWidthRange??kT,!0);return{[ot.Sum]:n,[ot.Average]:n,[ot.Count]:n,[ot.Direct]:()=>e.linkWidthByFn??n(),[ot.Single]:()=>()=>e.linkDefaultWidth}[i]()};function tq(i,e){const{linkWidthStrategy:t,linkWidthBy:n,linkWidthByFn:r,linkSourceBy:o,linkTargetBy:s}=i;return t&&Object.values(ot).includes(t)?t:r?ot.Direct:n&&Ho(e)?ot.Sum:!n&&o&&s?ot.Count:ot.Single}class iq{constructor(e){m(this,"_");m(this,"config",qp);m(this,"_rawConfig",{});m(this,"_cosmosConfig",{});m(this,"_configUpdatePromise",null);m(this,"_cosmosInitPromise",null);m(this,"_cosmosInitResolved",null);m(this,"_currentPointColorStrategy",Re.Direct);m(this,"_currentLinkColorStrategy",He.Direct);m(this,"_currentPointSizeStrategy",Tt.Direct);m(this,"_currentLinkWidthStrategy",ot.Direct);m(this,"_currentPointColorFn");m(this,"_currentPointSizeFn");m(this,"_currentLinkColorFn");m(this,"_currentLinkWidthFn");m(this,"_clusterMapping",new Map);m(this,"_clusterIndexToNameMapping",new Map);m(this,"_preservedPointPositions",new Map);m(this,"resetCosmographConfig",()=>{this.config=qp});m(this,"_checkPointEvents",()=>!(this.config.onClick===void 0&&!this.config.selectPointOnClick&&!this.config.focusPointOnClick));this._=e,this._cosmosInitPromise=new Promise(t=>{this._cosmosInitResolved=t})}get activePointColorStrategy(){return this._currentPointColorStrategy}get activeLinkColorStrategy(){return this._currentLinkColorStrategy}get activePointSizeStrategy(){return this._currentPointSizeStrategy}get activeLinkWidthStrategy(){return this._currentLinkWidthStrategy}get activePointColorFn(){return this._currentPointColorFn}get activePointSizeFn(){return this._currentPointSizeFn}get activeLinkColorFn(){return this._currentLinkColorFn}get activeLinkWidthFn(){return this._currentLinkWidthFn}get clusterMapping(){return this._clusterMapping}get clusterIndexToNameMapping(){return this._clusterIndexToNameMapping}get cosmosConfig(){return this._cosmosConfig}async configUpdated(){await this._configUpdatePromise}async cosmosInitialized(){await this._cosmosInitPromise}setConfig(e){this._configUpdatePromise=(async()=>{var t,n,r;try{await this._.dbReady();const o=this.config;if(o.points&&!(e!=null&&e.points)&&!this._.public.stats.pointsCount)return void this._.public.reset();this.config=Ct(qp,e??{}),this._rawConfig=e??{},this._controlBackgroundColor(o,this.config),this._.rectangularSelection.updateSelectionClassName(),window.cosmographDisableLogging=this.config.disableLogging??!1,this._cosmosConfig=this._createCosmosConfig(),(t=this._.cosmos)==null||t.setConfig(this._cosmosConfig),await this._processConfigUpdate(o),this._handleScaleChangeEvents(o,this.config)}finally{this._configUpdatePromise=null,(r=(n=this.config).onConfigUpdated)==null||r.call(n)}})()}async _processConfigUpdate(e){var l,c;const t=this._detectPointsChanged(e),n=this._detectLinksChanged(e),r=this._detectVisualLinkChanges(e),o=this._detectVisualPointChanges(e),s=this._detectClusterChanges(e),a=this._detectLabelChanges(e);if((t||n)&&await this._.dataManager.updateGraphData(t,n))return await this._rebuildGraph(!t&&n,n),void(this._cosmosInitResolved&&(this._cosmosInitResolved(),this._cosmosInitResolved=null));(r||o||s)&&this._.cosmos&&(await this._updateGraphProperties(e,o,this._.public.stats.linksCount>0&&r),this._.cosmos.render((l=this._.cosmos)!=null&&l.isSimulationRunning?void 0:0)),a&&((c=this._.labels)==null||c.update()),!this.config.preservePointPositionsOnDataUpdate&&this._preservedPointPositions.size&&this._preservedPointPositions.clear()}async _rebuildGraph(e,t){var n,r,o;try{e?await this._updateGraphProperties(void 0,!1):(this._.dispatchEvent(new CustomEvent("reset")),await this._.initializeCosmos(),this._.initializeLabels(),await this._updateGraphProperties(void 0,!0,t)),this._.updateMessage(null);const s=!this._.public.isSimulationAvailable||!this._.pointsHaveLayout;(n=this._.cosmos)==null||n.render(s?void 0:0),this._.updateStats(),this._.dispatchEvent(new CustomEvent("graphRebuilt")),(o=(r=this.config).onGraphRebuilt)==null||o.call(r,this._.public.stats),this.config.points&&ue(`Rendered graph with ${this._.public.stats.pointsCount} points and ${this._.public.stats.linksCount} links.`)}catch(s){ue(s,"_rebuildGraph","error"),this._.updateMessage(` ${s}`)}}async _updateGraphProperties(e,t=!0,n=!0){n&&await this.updateLinkProperties(e),t&&await this.updatePointProperties(e),this._updateClusterProperties(e)}async updatePointProperties(e,t=!1){var d,f,p;const{_:{dbCoordinator:n,config:r,public:{pointsTableName:o}}}=this,s=[r.pointXBy,r.pointYBy,r.pointColorBy,r.pointSizeBy,r.pointClusterBy,r.pointIndexBy,r.pointClusterStrengthBy].filter(Boolean),a=await Wa(n,o),l=new Set(a),c=s.filter(b=>l.has(b)),u=await MT(n,o,c);let h=!1;u!=null&&u.numRows?(h=await this._handlePointPositions(e,u,t),h&&((d=this._.cosmos)==null||d.graph.update()),this._handlePointColors(e,u),this._handlePointSizes(e,u),await this._handlePointClusterProps(e,u),h?(f=this._.labels)==null||f.update():(p=this._.labels)==null||p.render()):await this._.public.reset(!1)}async updateLinkProperties(e){const{dbCoordinator:t,cosmos:n,config:r,public:{linksTableName:o,stats:s}}=this._;if(!s.linksCount&&!await xs(t,o))return;const a=[r.linkColorBy,r.linkWidthBy,r.linkStrengthBy,r.linkArrowBy,r.linkSourceIndexBy,r.linkTargetIndexBy].filter(Boolean),l=await Wa(t,o),c=new Set(l),u=a.filter(d=>c.has(d)),h=await OT(t,o,u);if(h){if(h.numRows!==(n==null?void 0:n.graph.linksNumber)){const d=FY(h,this.config);n==null||n.setLinks(d),this._.linkAggregationManager.buildCountCache(h),this._.linkAggregationManager.clearColorSumCache(),this._.linkAggregationManager.clearWidthSumCache()}this._handleLinkColors(e,h),this._handleLinkWidths(e,h),this._handleLinkStrengths(e,h),this._handleLinkArrows(e,h)}}_updateClusterProperties(e){const{config:t,_:{cosmos:n}}=this;if(!e||(e==null?void 0:e.clusterPositionsMap)!==t.clusterPositionsMap)if(t.clusterPositionsMap&&this._clusterMapping.size>0){const r=XY(t.clusterPositionsMap,Array.from(this._clusterMapping.keys()));n==null||n.setClusterPositions(r)}else n==null||n.setClusterPositions([])}async _handlePointPositions(e,t,n=!1){const{config:r,_:{cosmos:o}}=this;if(o!=null&&o.graph.pointsNumber&&e&&e.pointXBy===r.pointXBy&&e.pointYBy===r.pointYBy)return!1;let s=[];if(r.pointXBy||r.pointYBy){if(!await this._.dataValidator.validatePointPositions())return!1;s=MY(t,r)}else s=n?NY(o,t.numRows):Mg(t.numRows,r.spaceSize);return r.preservePointPositionsOnDataUpdate&&this._preservedPointPositions.size>0&&OY(s,this._preservedPointPositions),o==null||o.setPointPositions(new Float32Array(s),!n&&void 0),!0}_handlePointColors(e,t){const{config:n,_:{cosmos:r}}=this,o=[rt.PointColor,rt.PointColorStrategy,rt.PointColorPalette,rt.PointColorFn,rt.PointColorMap,"pointDefaultColor"];if(e&&!this._hasConfigChanged(e,n,o))return;let s=new Float32Array;const a=n.pointColorBy?t.getChild(n.pointColorBy):void 0;if(this._currentPointColorStrategy=QY(this._rawConfig,a==null?void 0:a.type),this._currentPointColorFn=void 0,this._currentPointColorStrategy===Re.Degree||this._currentPointColorStrategy===Re.PreciseDegree){const l=this._.public.pointDegrees;l&&(this._currentPointColorFn=Xp(this._currentPointColorStrategy,n,l),s=Il(Jr(l),n.unknownColor,this._currentPointColorFn))}else if(this._currentPointColorStrategy===Re.LinkDirection){const l=this._.public.pointDirections;l&&(this._currentPointColorFn=Xp(this._currentPointColorStrategy,n,l),s=Il(Jr(l),n.unknownColor,this._currentPointColorFn))}else a?(this._currentPointColorFn=Xp(this._currentPointColorStrategy,n,a.toArray(),a==null?void 0:a.type),s=Il(a,n.unknownColor,this._currentPointColorFn)):n.pointColorBy&&ue(`Column "${n.pointColorBy}" for \`${rt.PointColor}\` not found`,"_handlePointColors","warn");r==null||r.setPointColors(s),this._.dispatchEvent(new CustomEvent("pointColorUpdated"))}_handlePointSizes(e,t){const{config:n,_:{cosmos:r}}=this,o=[rt.PointSize,rt.PointSizeStrategy,rt.PointSizeRange,rt.PointSizeFn,"pointDefaultSize"];if(e&&!this._hasConfigChanged(e,n,o))return;let s=new Float32Array;const a=n.pointSizeBy?t.getChild(n.pointSizeBy):void 0;if(this._currentPointSizeStrategy=eq(this._rawConfig,a==null?void 0:a.type),this._currentPointSizeFn=void 0,this._currentPointSizeStrategy===Tt.Degree||this._currentPointSizeStrategy===Tt.PreciseDegree){const l=r==null?void 0:r.graph.degree;l&&(this._currentPointSizeFn=W1(this._currentPointSizeStrategy,n,l),s=Xs(Jr(l),n.pointDefaultSize,this._currentPointSizeFn))}else a?(this._currentPointSizeFn=W1(this._currentPointSizeStrategy,n,a.toArray()),s=Xs(a,n.pointDefaultSize,this._currentPointSizeFn)):n.pointSizeBy&&ue(`Column "${n.pointSizeBy}" for \`${rt.PointSize}\` not found`,"_handlePointSizes","warn");r==null||r.setPointSizes(s),this._.dispatchEvent(new CustomEvent("pointSizeUpdated"))}async _handlePointClusterProps(e,t){const{config:n,_:{cosmos:r}}=this;if(!e||e.pointClusterStrengthBy!==n.pointClusterStrengthBy){const a=n.pointClusterStrengthBy?t.getChild(n.pointClusterStrengthBy):void 0;let l=new Float32Array;a&&(l=Xs(a,Qd(rt.PointClusterStrength))),r==null||r.setPointClusterStrength(l)}const o=[rt.PointCluster,rt.PointClusterFn];if(e&&!this._hasConfigChanged(e,n,o))return;const s=n.pointClusterBy?t.getChild(n.pointClusterBy):void 0;if(s){let a=Array.from(s.toArray());n.pointClusterByFn&&(a=a.map(n.pointClusterByFn));const l=new Map;for(const h of a){const d=String(h);l.set(d,(l.get(d)??0)+1)}this._clusterMapping.clear(),this._clusterIndexToNameMapping.clear();let c=0;for(const h of l.keys()){const d=l.get(h);this._clusterMapping.set(h,{index:c,count:d}),this._clusterIndexToNameMapping.set(c,{name:h,count:d}),c++}const u=a.map(h=>{var d;return h===void 0||(d=this._clusterMapping.get(String(h)))==null?void 0:d.index});r==null||r.setPointClusters(u)}else this._clusterMapping.clear(),this._clusterIndexToNameMapping.clear(),r==null||r.setPointClusters([]);this._.dispatchEvent(new CustomEvent("clustersUpdated"))}_handleLinkColors(e,t){const{config:n,_:{cosmos:r}}=this,o=[Lt.LinkColor,Lt.LinkColorStrategy,Lt.LinkColorPalette,Lt.LinkColorFn,"linkDefaultColor"];if(e&&e.linkColorBy!==n.linkColorBy&&this._.linkAggregationManager.clearColorSumCache(),e&&!this._hasConfigChanged(e,n,o))return;let s=new Float32Array;const a=n.linkColorBy?t.getChild(n.linkColorBy)??void 0:void 0;if(this._currentLinkColorStrategy=JY(this._rawConfig,a==null?void 0:a.type),this._currentLinkColorFn=void 0,this._currentLinkColorStrategy!==He.Sum&&this._currentLinkColorStrategy!==He.Average||!a||this._.linkAggregationManager.colorSumCache||this._.linkAggregationManager.buildColorSumCache(t,a),[He.Count,He.Sum,He.Average].includes(this._currentLinkColorStrategy)){const l=this._.linkAggregationManager.aggregateFromCache(t,this._currentLinkColorStrategy,!0);l&&(this._currentLinkColorFn=G1(this._currentLinkColorStrategy,n,l),s=Il(Jr(l),n.unknownColor,this._currentLinkColorFn))}else a?(this._currentLinkColorFn=G1(this._currentLinkColorStrategy,n,a.toArray(),a==null?void 0:a.type),s=Il(a,n.unknownColor,this._currentLinkColorFn)):n.linkColorBy&&ue(`Column "${n.linkColorBy}" for \`${Lt.LinkColor}\` not found`,"_handleLinkColors","warn");r==null||r.setLinkColors(s),this._.dispatchEvent(new CustomEvent("linkColorUpdated"))}_handleLinkWidths(e,t){const{config:n,_:{cosmos:r}}=this,o=[Lt.LinkWidth,Lt.LinkWidthRange,Lt.LinkWidthStrategy,Lt.LinkWidthFn,"linkDefaultWidth"];if(e&&e.linkWidthBy!==n.linkWidthBy&&this._.linkAggregationManager.clearWidthSumCache(),e&&!this._hasConfigChanged(e,n,o))return;let s=new Float32Array;const a=n.linkWidthBy?t.getChild(n.linkWidthBy):void 0;if(this._currentLinkWidthStrategy=tq(this._rawConfig,a==null?void 0:a.type),this._currentLinkWidthFn=void 0,this._currentLinkWidthStrategy!==ot.Sum&&this._currentLinkWidthStrategy!==ot.Average||!a||this._.linkAggregationManager.widthSumCache||this._.linkAggregationManager.buildWidthSumCache(t,a),[ot.Count,ot.Sum,ot.Average].includes(this._currentLinkWidthStrategy)){const l=this._.linkAggregationManager.aggregateFromCache(t,this._currentLinkWidthStrategy,!1);l&&(this._currentLinkWidthFn=j1(this._currentLinkWidthStrategy,this.config,l),s=Xs(Jr(l),this.config.linkDefaultWidth,this._currentLinkWidthFn))}else a?(this._currentLinkWidthFn=j1(this._currentLinkWidthStrategy,this.config,a.toArray()),s=Xs(a,n.linkDefaultWidth,this._currentLinkWidthFn)):n.linkWidthBy&&ue(`Column "${n.linkWidthBy}" for \`${Lt.LinkWidth}\` not found`,"_handleLinkWidths","warn");r==null||r.setLinkWidths(s),this._.dispatchEvent(new CustomEvent("linkWidthUpdated"))}_handleLinkStrengths(e,t){const{config:n,_:{cosmos:r}}=this,o=[Lt.LinkStrength,Lt.LinkStrengthRange,Lt.LinkStrengthFn];if(e&&!this._hasConfigChanged(e,n,o))return;let s=new Float32Array;const a=n.linkStrengthBy?t.getChild(n.linkStrengthBy):void 0;if(a){const l=n.linkStrengthByFn??pc(a.toArray(),n.linkStrengthRange);s=Xs(a,Qd(Lt.LinkStrength),l)}else n.linkStrengthBy&&ue(`Column "${n.linkStrengthBy}" for \`${Lt.LinkStrength}\` not found`,"_handleLinkStrengths","warn");r==null||r.setLinkStrength(s)}_handleLinkArrows(e,t){const{config:n,_:{cosmos:r}}=this,o=[Lt.LinkArrow,Lt.LinkArrowFn,"linkDefaultArrows"];if(e&&!this._hasConfigChanged(e,n,o))return;let s=[];const a=n.linkArrowBy?t.getChild(n.linkArrowBy):void 0;a?s=ZY(a,n.linkDefaultArrows,n.linkArrowByFn):n.linkArrowBy&&ue(`Column "${n.linkArrowBy}" for \`${Lt.LinkArrow}\` not found`,"_handleLinkArrows","warn"),r==null||r.setLinkArrows(s)}_handleScaleChangeEvents(e,t){(e==null?void 0:e.pointSizeScale)===t.pointSizeScale&&(e==null?void 0:e.scalePointsOnZoom)===t.scalePointsOnZoom||this._.dispatchEvent(new CustomEvent("pointSizeScaleUpdated")),(e==null?void 0:e.linkWidthScale)===t.linkWidthScale&&(e==null?void 0:e.scaleLinksOnZoom)===t.scaleLinksOnZoom||this._.dispatchEvent(new CustomEvent("linkWidthScaleUpdated"))}_hasConfigChanged(e,t,n){return n.some(r=>!Bc(e[r],t[r]))}_detectPointsChanged(e){return this._hasConfigChanged(e,this.config,AT)}_detectLinksChanged(e){return this._hasConfigChanged(e,this.config,IT)}_detectLabelChanges(e){return this._hasConfigChanged(e,this.config,wY)}_detectVisualLinkChanges(e){return this._hasConfigChanged(e,this.config,vY)}_detectVisualPointChanges(e){return this._hasConfigChanged(e,this.config,xY)}_detectClusterChanges(e){return this._hasConfigChanged(e,this.config,bY)}_controlBackgroundColor(e,t){var o,s;if((e==null?void 0:e.backgroundColor)===t.backgroundColor)return;const n=qY(t.backgroundColor),r=n&&YY(n)>.65?"#000000":"#ffffff";(o=this._.containerElement)==null||o.style.setProperty("--cosmograph-text-color",r),(s=this._.cosmosElement)==null||s.style.setProperty("backgroundColor",n??fb)}_createCosmosConfig(){var t;const e={...this.config,hoveredPointCursor:this._checkPointEvents()?((t=this.config)==null?void 0:t.hoveredPointCursor)??"pointer":"auto"};return delete e.enableSimulation,delete e.attribution,this._.eventManager.attachCosmosEvents(e),e}updatePreservedPointPositions(e){this._preservedPointPositions=e}clearCosmosBuffers(e){const{_:{cosmos:t}}=this;e||(t==null||t.setPointPositions(new Float32Array),t==null||t.setPointColors(new Float32Array),t==null||t.setPointSizes(new Float32Array),t==null||t.setPointClusters([]),t==null||t.setPointClusterStrength(new Float32Array),t==null||t.setClusterPositions([])),t==null||t.setLinks(new Float32Array),t==null||t.setLinkColors(new Float32Array),t==null||t.setLinkWidths(new Float32Array),t==null||t.setLinkStrength(new Float32Array),t==null||t.setLinkArrows([])}}let nq=class{constructor(e){m(this,"_");m(this,"_linksSelection",Jm.crossfilter());m(this,"_pointsSelection",Jm.crossfilter());m(this,"_onLinksFiltered");m(this,"_onPointsFiltered");m(this,"_crossfilter",{links:new Set,points:new Set,intersection:new Set});this._=e,this._onLinksFiltered=t=>this._handleCrossfiltering(t,"links"),this._onPointsFiltered=t=>this._handleCrossfiltering(t,"points")}get filtered(){return this._crossfilter}get pointsSelection(){return this._pointsSelection}get linksSelection(){return this._linksSelection}get onLinksFiltered(){return this._onLinksFiltered}get onPointsFiltered(){return this._onPointsFiltered}get isFilteringActive(){return this._linksSelection.clauses.length>0||this._pointsSelection.clauses.length>0}_handleCrossfiltering(e,t){var l,c;const{config:n,cosmos:r,labels:o}=this._;this._getSetForCrossfilter(e,t),this._getIntersection(),this.isFilteringActive?r==null||r.selectPointsByIndices(Array.from(this._crossfilter.intersection)):r==null||r.unselectPoints();const s=this._.public.getSelectedLinkIndices(),a=r==null?void 0:r.getSelectedIndices();t==="points"&&((l=n.onPointsFiltered)==null||l.call(n,e,a,s)),t==="links"&&((c=n.onLinksFiltered)==null||c.call(n,e,a,s)),o==null||o.update(),this._.dispatchEvent(new CustomEvent("dataFiltered"))}_getSetForCrossfilter(e,t){var o;const{config:n}=this._;let r;if(t==="links")r=zY(e,n);else{const s=(o=e.getChild(n.pointIndexBy))==null?void 0:o.toArray();r=new Set(s)}this._crossfilter[t]=r}_getIntersection(){const{links:e,points:t}=this._crossfilter,n=t.values();let r=new Set;if(this._linksSelection.clauses.length&&this._pointsSelection.clauses.length)for(const o of n)e.has(o)&&r.add(o);else r=this._linksSelection.clauses.length?e:t;this._crossfilter.intersection=r}},rq=class{constructor(e){m(this,"_");m(this,"_dataUploadPromise",null);this._=e}get dataUploadPromise(){return this._dataUploadPromise}async dataReady(){var e;await this._.dbReady(),(e=this._.dbCoordinator)!=null&&e.internalDB&&this._dataUploadPromise&&await this._dataUploadPromise}async updateGraphData(e,t){let n=!1;return this._dataUploadPromise&&(ue("Data upload is already in progress, waiting for it to complete.","updateGraphData","info"),await this._dataUploadPromise),!!this._.dbCoordinator&&(this._dataUploadPromise=(async()=>{var r,o,s,a,l;(r=this._.cosmos)!=null&&r.isSimulationRunning&&((o=this._.cosmos)==null||o.stop()),(s=this._.dbCoordinator)==null||s.clearCache();try{if(e){const{pointsOk:c}=await this._uploadAndValidateGraphData(t);n=c}else if(t){const{linksOk:c}=await this._uploadAndValidateLinksData();n=e?n&&c:c}}finally{this._dataUploadPromise=null,this._.dispatchEvent(new CustomEvent("dataUploaded")),(l=(a=this._.config)==null?void 0:a.onGraphDataUpdated)==null||l.call(a)}})(),await this._dataUploadPromise,n)}async _addPreparedData(e,t){var l;const{_:{dbCoordinator:n,public:{linksTableName:r,isSimulationRunning:o,activePointColorStrategy:s,activePointSizeStrategy:a}}}=this;if(n&&(n!=null&&n.internalDB)){if(e&&(await this._uploadPoints(e,!0),await this._.configManager.updatePointProperties(void 0,!0)),t){const c=await xs(n,r);await this._uploadLinks(t,c),await this._.configManager.updateLinkProperties(void 0),s!==Re.Degree&&s!==Re.LinkDirection&&a!==Tt.Degree||await this._.configManager.updatePointProperties(void 0,!0)}(l=this._.cosmos)==null||l.render(o?this._.config.simulationImpulse:0),this._triggerGraphUpdated()}}async addPoints(e){const{_:{dbCoordinator:t,public:{stats:n}}}=this,{pointIndexBy:r,pointIdBy:o}=this._.config;if(t&&(t!=null&&t.internalDB)){const s=n.pointsCount,a=await Wa(t,De.Points),l=[];for(const c of e){if(c.id===void 0)continue;const u={};for(const h of a)if(h===r)u[h]=BigInt(s+l.length);else if(h===o)u[h]=c.id;else if(c[h]!==void 0)u[h]=c[h];else{const d=Object.values(rt).find(f=>this._.config[f]===h);u[h]=d?Qd(d):null}l.push(u)}this._preservePointPositionsIfEnabled(),l.length&&await this._addPreparedData(l,void 0)}}async addLinks(e){const{_:{dbCoordinator:t,config:n}}=this;if(!(t!=null&&t.internalDB))return;const{linkSourceBy:r,linkTargetBy:o,linkSourceIndexBy:s,linkTargetIndexBy:a}=n;if(!(r&&o&&s&&a))return;const l=e.filter(p=>p.source!=null&&p.target!=null),c=[...new Set(l.flatMap(p=>[p.source,p.target]).map(String))];if(!c.length)return;const u=await Jd(t,De.Points,n,c);if(!u)return;const h=new Map(c.map((p,b)=>[p,u[b]]));let d=await xs(t,De.Links)?await Wa(t,De.Links):[];d.length||(d=[r,o,s,a,...n.linkColorBy?[n.linkColorBy]:[],...n.linkWidthBy?[n.linkWidthBy]:[],...n.linkArrowBy?[n.linkArrowBy]:[],...n.linkStrengthBy?[n.linkStrengthBy]:[],...Array.isArray(n.linkIncludeColumns)?n.linkIncludeColumns:[]]);const f=[];for(const p of l){const b=String(p.source),g=String(p.target),_=h.get(b),T=h.get(g);if(_===void 0||T===void 0)continue;const E={};for(const y of d)if(y===r)E[y]=p.source;else if(y===o)E[y]=p.target;else if(y===s)E[y]=BigInt(_);else if(y===a)E[y]=BigInt(T);else if(y in p&&p[y]!==void 0)E[y]=p[y];else{const C=Object.values(Lt).find(I=>n[I]===y);E[y]=C?Qd(C):null}f.push(E)}f.length&&await this._addPreparedData(void 0,f)}async removePointsByIndices(e,t=!0){var c;const{_:{dbCoordinator:n,public:{pointsTableName:r,linksTableName:o,stats:s,isSimulationRunning:a}}}=this;if(!n||s.pointsCount<=1)return;const l=[...new Set(e)];if(!(l.length>=s.pointsCount)&&(n!=null&&n.internalDB)){const u=`${l.join(", ")}`;await n.internalDB.query(`DELETE FROM ${r} WHERE "${this._.config.pointIndexBy}" IN (${u})`),this._removePointsInCosmos(l),t&&s.linksCount&&(await n.internalDB.query(`DELETE FROM ${o} WHERE "${this._.config.linkSourceIndexBy}" IN (${u})
          OR "${this._.config.linkTargetIndexBy}" IN (${u})`),await this._.configManager.updateLinkProperties(void 0)),(c=this._.cosmos)==null||c.render(a?this._.config.simulationImpulse:0),this._triggerGraphUpdated()}}async removePointsByIds(e){const t=await Jd(this._.dbCoordinator,this._.public.pointsTableName,this._.config,e);t&&await this.removePointsByIndices(t)}async removeLinksByPointIdPairs(e){await this._removeLinks(e,!1)}async removeLinksByPointIndicesPairs(e){await this._removeLinks(e,!0)}async _uploadData(e,t){let n={pointsError:!1,linksError:!1};if(!this._.dbCoordinator||!this._.dbCoordinator.internalDB)return n;try{n=await this._executeUpload(e,t)}catch(r){ue(`Error during data upload: ${r}`,"_uploadData","error")}return n}async _uploadPoints(e,t=!1){var r,o;const n=await((o=(r=this._.dbCoordinator)==null?void 0:r.internalDB)==null?void 0:o.uploadData(e,De.Points,t));return!!(n!=null&&n.error)}async _uploadLinks(e,t=!1){var r,o;const n=await((o=(r=this._.dbCoordinator)==null?void 0:r.internalDB)==null?void 0:o.uploadData(e,De.Links,t));return!!(n!=null&&n.error)}async _executeUpload(e,t){ue("Data uploading...","uploadData");const n={pointsError:!1,linksError:!1};return await this._.dbReady(),this._.updateMessage(" Loading data..."),e&&(n.pointsError=await this._uploadPoints(e)),t&&(n.linksError=await this._uploadLinks(t)),this._.updateMessage(n.pointsError?" Points data is empty or invalid.":null),n}_preservePointPositionsIfEnabled(){var n;const{config:e,public:{stats:t}}=this._;if(e.pointIdBy&&t.pointsCount&&e.preservePointPositionsOnDataUpdate){const r=(n=this._.cosmos)==null?void 0:n.getPointPositions();if(r&&r.length){const o=BY(r,t.pointsCount);this._.configManager.updatePreservedPointPositions(o)}}}async _uploadAndValidateGraphData(e){const{_:{config:t}}=this;if(!t.points){await this._.public.reset(!1);const o="Points source data is not provided in `points`.";return ue(o,"_uploadAndValidateGraphData","error"),this._.updateMessage(` ${o}`),{pointsOk:!1,linksOk:!1}}this._preservePointPositionsIfEnabled();const{pointsError:n,linksError:r}=await this._uploadData(t.points,t.links);if(await this._.updateSummary(),n){const o="Failed to upload points data: The data is invalid or empty.";return ue(o,"_uploadAndValidateGraphData","error"),this._.updateMessage(` ${o}`),{pointsOk:!1,linksOk:!1}}try{const o=!n&&await this._.dataValidator.validatePoints();if(!o)return{pointsOk:o,linksOk:!1};const s=e&&!r&&await this._.dataValidator.validateLinks();return t.links&&!s&&ue("Provided links data is empty or invalid. Only points will be rendered.","_uploadAndValidateGraphData","warn"),{pointsOk:o,linksOk:s}}catch(o){return ue(`Error during data validation: ${o}`,"_uploadAndValidateGraphData","error"),{pointsOk:!1,linksOk:!1}}}async _uploadAndValidateLinksData(){let e=!1;if(this._.public.stats.pointsCount===0)return{linksOk:e};if(this._.configManager.clearCosmosBuffers(!0),!this._.config.links)return await this._.dropLocalTables(!0),{linksOk:e};const{linksError:t}=await this._uploadData(void 0,this._.config.links);return await this._.updateSummary(),e=!t&&await this._.dataValidator.validateLinks(),e||await this._.dropLocalTables(!0),{linksOk:e}}_removePointsInCosmos(e){var n,r,o,s,a,l,c,u,h,d,f,p,b,g,_,T,E,y,C,I;if(!e.length)return;const t=new Set(e);if((r=(n=this._.cosmos)==null?void 0:n.graph.pointPositions)!=null&&r.length){const F=eh(t,(o=this._.cosmos)==null?void 0:o.graph.pointPositions,2);(s=this._.cosmos)==null||s.setPointPositions(F,!1)}if((l=(a=this._.cosmos)==null?void 0:a.graph.pointColors)!=null&&l.length){const F=eh(t,(c=this._.cosmos)==null?void 0:c.graph.pointColors,4);(u=this._.cosmos)==null||u.setPointColors(F)}if((d=(h=this._.cosmos)==null?void 0:h.graph.pointSizes)!=null&&d.length){const F=eh(t,(f=this._.cosmos)==null?void 0:f.graph.pointSizes,1);(p=this._.cosmos)==null||p.setPointSizes(F)}if((g=(b=this._.cosmos)==null?void 0:b.graph.pointClusters)!=null&&g.length){const F=(_=this._.cosmos)==null?void 0:_.graph.pointClusters.filter((V,q)=>!t.has(q));(T=this._.cosmos)==null||T.setPointClusters(F)}if((y=(E=this._.cosmos)==null?void 0:E.graph.clusterStrength)!=null&&y.length){const F=eh(t,(C=this._.cosmos)==null?void 0:C.graph.clusterStrength,1);(I=this._.cosmos)==null||I.setPointClusterStrength(F)}}async _removeLinks(e,t){var f;const{_:{dbCoordinator:n,public:{linksTableName:r,stats:o,isSimulationRunning:s,activePointColorStrategy:a,activePointSizeStrategy:l}}}=this;if(!(n!=null&&n.internalDB)||!o.linksCount)return;const c=t?this._.config.linkSourceIndexBy:this._.config.linkSourceBy,u=t?this._.config.linkTargetIndexBy:this._.config.linkTargetBy,h=p=>t?p.toString():`'${p}'`,d=`
      DELETE FROM ${r}
      WHERE ${e.map(([p,b])=>`((${c} = ${h(p)} AND ${u} = ${h(b)}) OR
        (${c} = ${h(b)} AND ${u} = ${h(p)}))`).join(" OR ")}
    `;await n.internalDB.query(d),await this._.configManager.updateLinkProperties(void 0),a!==Re.Degree&&a!==Re.LinkDirection&&l!==Tt.Degree||await this._.configManager.updatePointProperties(void 0,!0),(f=this._.cosmos)==null||f.render(s?this._.config.simulationImpulse:0),this._triggerGraphUpdated()}_triggerGraphUpdated(){var e,t;this._.dbCoordinator.clearCache(),this._.updateStats(),(t=(e=this._.config).onGraphRebuilt)==null||t.call(e,this._.public.stats),this._.dispatchEvent(new CustomEvent("dataUploaded")),this._.dispatchEvent(new CustomEvent("graphRebuilt"))}};const Y1=()=>globalThis.__lastDuckdbError;let oq=class{constructor(e){m(this,"_");this._=e}async validatePoints(){const{config:e,dbCoordinator:t,public:{pointsTableName:n}}=this._,r=AT.slice(1),o=u=>{throw ue(u,"validatePoints","error"),this._.updateMessage(` ${u}`),new Error(u)};if(!await xs(t,n)){const u=Y1();return o(u?`Failed to get points data: ${u}`:`Failed to get points data. Table "${n}" does not exist`)}const s=this._getMissingProperties(e,r);if(s.length)return o(`Failed to get points data.

Missing required properties: ${this._formatMissingProps(s)}.`);const{exists:a,missingColumns:l}=await this._validateColumns(e,n,r);if(!a)return o(`Failed to get points data.

Missing provided columns for required properties: ${this._formatMissingColumns(l,r)}.`);const c=(await PT(t,n)).find(u=>u.name===e.pointIndexBy);return(c==null?void 0:c.type)!=="VARCHAR"||o(`The column specified for \`pointIndexBy\` (${e.pointIndexBy}) cannot be of type VARCHAR. Please use an integer-based column.`)}async validateLinks(){const{config:e,dbCoordinator:t,public:{linksTableName:n}}=this._,r=IT.slice(1),o=c=>{throw ue(c,"validateLinks","error"),this._.updateMessage(` ${c}`),new Error(c)};if(!e.links){const c="Found links-related properties but links data is not provided. Rendering points only.";return ue(c,"validateLinks","warn"),this._.updateMessage(` ${c}`),!1}if(!await xs(t,n)){const c=Y1();if(c)return o(`Failed to get links data: ${c}`);const u=`Failed to get links data. Table "${n}" does not exist`;return ue(u,"validateLinks","error"),this._.updateMessage(` ${u}`),!1}const s=this._getMissingProperties(e,r);if(s.length)return o(`Failed to get links data. 

Missing required properties: ${this._formatMissingProps(s)}.`);const{exists:a,missingColumns:l}=await this._validateColumns(e,n,r);return!!a||o(`Failed to get links data. 

Missing provided columns for required properties: ${this._formatMissingColumns(l,r)}.`)}async validatePointPositions(){const{config:e,config:{pointXBy:t,pointYBy:n},public:{pointsTableName:r}}=this._;if(!!t!=!!n){const o=`Couldn't render points: Only one of \`${rt.PointX}\` or \`${rt.PointY}\` provided.`;throw ue(o,"validatePointPositions","error"),this._.updateMessage(` ${o}`),new Error(o)}if(t&&n){const{exists:o,missingColumns:s}=await this._validateColumns(e,r,[rt.PointX,rt.PointY]);if(!o){const a=`Couldn't render points: Failed to get provided point positions, missing columns for positions: ${this._formatMissingProps(s)}.`;throw ue(a,"validatePointPositions","error"),this._.updateMessage(` ${a}`),new Error(a)}}return!0}async _validateColumns(e,t,n){const r=n.map(s=>e[s]),o=[];return{exists:await zf(this._.dbCoordinator,t,r,o),missingColumns:o}}_getMissingProperties(e,t){return t.filter(n=>e[n]===void 0)}_formatMissingProps(e){return e.map(t=>`"${t}"`).join(", ")}_formatMissingColumns(e,t){return e.map(n=>`"${n}" (${t[e.indexOf(n)]})`).join(", ")}},sq=class{constructor(e){m(this,"_");m(this,"_hoveredPointIndex");this._=e}attachCosmosEvents(e={}){e.onSimulationStart=this.onSimulationStart.bind(this),e.onSimulationTick=this.onSimulationTick.bind(this),e.onSimulationEnd=this.onSimulationEnd.bind(this),e.onSimulationPause=this.onSimulationPause.bind(this),e.onSimulationUnpause=this.onSimulationUnpause.bind(this),e.onClick=this.onClick.bind(this),e.onPointMouseOver=this.onPointMouseOver.bind(this),e.onPointMouseOut=this.onPointMouseOut.bind(this),e.onMouseMove=this.onMouseMove.bind(this),e.onZoomStart=this.onZoomStart.bind(this),e.onZoom=this.onZoom.bind(this),e.onZoomEnd=this.onZoomEnd.bind(this),e.onDrag=this.onDrag.bind(this),e.onDragEnd=this.onDragEnd.bind(this),e.onLinkClick=this.onLinkClick.bind(this),e.onLinkMouseOver=this.onLinkMouseOver.bind(this),e.onLinkMouseOut=this.onLinkMouseOut.bind(this)}getLabelEvents(){return{onLabelClick:this.onLabelClick.bind(this),onHoveredLabelClick:this.onHoveredLabelClick.bind(this)}}onClick(...e){var n;const{config:t}=this._;t.selectPointOnClick?this._handlePointClick(e[0],e[2]):e[0]||this._.public.selectPoint(void 0),(n=t.onClick)==null||n.call(t,...e)}async onLabelClick(e,t){var l,c,u;const{public:{pointsTableName:n},config:r,dbCoordinator:o,configManager:s}=this._;if(typeof t.id=="string"&&t.id.startsWith("cluster-")){const h=t.id.slice(8),d=Number(h);if(!Number.isNaN(d)){const f=((l=s.clusterIndexToNameMapping.get(d))==null?void 0:l.name)??t.id;r.selectClusterOnLabelClick&&await this._handleClusterClick(f,e),(c=r.onClusterLabelClick)==null||c.call(r,d,f,e)}return}if(!o)return;const a=await Jd(o,n,r,[t.id]);a&&a[0]!==void 0&&(r.selectPointOnLabelClick&&this._handlePointClick(a[0],e,r.selectPointOnLabelClick,!0),(u=r.onLabelClick)==null||u.call(r,a[0],t.id,e))}async onHoveredLabelClick(e){var s;const{public:{pointsTableName:t},config:n,dbCoordinator:r}=this._;if(this._hoveredPointIndex===void 0||!r)return;const o=await NT(r,t,n,[this._hoveredPointIndex]);o&&o[0]&&(n.selectPointOnLabelClick&&this._handlePointClick(this._hoveredPointIndex,e,n.selectPointOnLabelClick,!0),(s=n.onLabelClick)==null||s.call(n,this._hoveredPointIndex,o[0],e))}onRectSelect(e,t=!1,n=!0){var r,o;n?this._.public.unselectPointsInRect(e):this._.public.selectPointsInRect(e,t),(o=(r=this._.config).onRectSelected)==null||o.call(r,e),this._.dispatchEvent(new CustomEvent("rectSelected"))}onPolygonSelect(e,t=!1,n=!0){var r,o;n?this._.public.unselectPointsInPolygon(e):this._.public.selectPointsInPolygon(e,t),(o=(r=this._.config).onPolygonSelected)==null||o.call(r,e),this._.dispatchEvent(new CustomEvent("polygonSelected"))}onPointMouseOver(...e){var n,r;const[t]=e;(r=(n=this._.config).onPointMouseOver)==null||r.call(n,...e),this._hoveredPointIndex=t,this._renderCurrentHoveredLabel()}onPointMouseOut(...e){var t,n;(n=(t=this._.config).onPointMouseOut)==null||n.call(t,...e),this._hoveredPointIndex=void 0,this._renderCurrentHoveredLabel()}onLinkMouseOver(...e){var t,n;(n=(t=this._.config).onLinkMouseOver)==null||n.call(t,...e)}onLinkMouseOut(...e){var t,n;(n=(t=this._.config).onLinkMouseOut)==null||n.call(t,...e)}onLinkClick(...e){var t,n;(n=(t=this._.config).onLinkClick)==null||n.call(t,...e)}onMouseMove(...e){var t,n;(n=(t=this._.config).onMouseMove)==null||n.call(t,...e)}onZoomStart(...e){var t,n,r;(n=(t=this._.config).onZoomStart)==null||n.call(t,...e),(r=this._.labels)==null||r.render()}onDrag(...e){var t,n,r;(n=(t=this._.config).onDrag)==null||n.call(t,...e),(r=this._.labels)==null||r.updatePositions(),this._renderCurrentHoveredLabel(),this._.dispatchEvent(new CustomEvent("onDrag"))}onDragEnd(...e){var t,n,r;(n=(t=this._.config).onDragEnd)==null||n.call(t,...e),(r=this._.labels)==null||r.update(),this._renderCurrentHoveredLabel()}async onZoom(...e){var t,n,r,o;(n=(t=this._.config).onZoom)==null||n.call(t,...e),(r=this._.labels)==null||r.setZooming(!0,!!e[0].sourceEvent),await((o=this._.labels)==null?void 0:o.render()),this._renderCurrentHoveredLabel(),this._.dispatchEvent(new CustomEvent("onZoom")),this._.dispatchEvent(new CustomEvent("pointSizeScaleUpdated")),this._.dispatchEvent(new CustomEvent("linkWidthScaleUpdated"))}onZoomEnd(...e){var t,n,r;(n=(t=this._.config).onZoomEnd)==null||n.call(t,...e),(r=this._.labels)==null||r.setZooming(!1,!!e[0].sourceEvent),this._.dispatchEvent(new CustomEvent("zoomEnded"))}onSimulationStart(...e){var t,n;(n=(t=this._.config).onSimulationStart)==null||n.call(t,...e)}onSimulationTick(...e){var t,n,r;(n=(t=this._.config).onSimulationTick)==null||n.call(t,...e),(r=this._.labels)==null||r.updatePositions(),this._.dispatchEvent(new CustomEvent("onSimulationTick"))}onSimulationEnd(...e){var t,n;(n=(t=this._.config).onSimulationEnd)==null||n.call(t,...e),this._.dispatchEvent(new CustomEvent("onSimulationEnd"))}onSimulationPause(...e){var t,n,r;(n=(t=this._.config).onSimulationPause)==null||n.call(t,...e),(r=this._.labels)==null||r.render()}onSimulationUnpause(...e){var t,n,r,o;(n=(t=this._.config).onSimulationUnpause)==null||n.call(t,...e),(o=(r=this._.config).onSimulationRestart)==null||o.call(r,...e)}_handlePointClick(e,t,n,r=!1){const{config:o}=this._,{shiftKey:s,altKey:a}=t;if(a)this._.public.unselectPoint(e);else{const l=n===!0||n!=="single"&&void 0;this._.public.selectPoint(e,s,l)}(r?o.focusPointOnLabelClick??o.selectPointOnLabelClick:o.focusPointOnClick??o.selectPointOnClick)&&!a&&this._.public.setFocusedPoint(e)}async _handleClusterClick(e,t){const{config:n}=this._,{pointClusterBy:r}=n;if(!r)return;const o=await this._.public.getPointIndicesByExactValues(r,[e]);if(!o||!o.length)return;const{shiftKey:s,altKey:a}=t;a?this._.public.unselectPointsByIndices(o):this._.public.selectPoints(o,s)}_renderCurrentHoveredLabel(){var t,n,r;if(this._hoveredPointIndex===void 0)return void((t=this._.labels)==null?void 0:t.renderHoveredLabel());const e=this._.public.getPointPositionByIndex(this._hoveredPointIndex);e?(n=this._.labels)==null||n.renderHoveredLabel(this._hoveredPointIndex,e):(r=this._.labels)==null||r.renderHoveredLabel()}};const Kp=(i,e)=>0x100000000n*BigInt(i)+BigInt(e),aq=i=>{const e=Number(i%0x100000000n);return{sourceIdx:Number(i/0x100000000n),targetIdx:e}};let lq=class{constructor(e){m(this,"_");m(this,"_countCache",null);m(this,"_colorSumCache",null);m(this,"_widthSumCache",null);m(this,"_colorSumCacheColumn",null);m(this,"_widthSumCacheColumn",null);this._=e}get countCache(){return this._countCache}get colorSumCache(){return this._colorSumCache}get widthSumCache(){return this._widthSumCache}buildCountCache(e){const t=this._getIndexColumns(e);if(!t)return void(this._countCache=null);const{sourceIdxColumn:n,targetIdxColumn:r,numRows:o}=t,s=new Map;for(let a=0;a<o;a++){const l=n.get(a),c=r.get(a),u=Kp(l,c);s.set(u,(s.get(u)??0)+1)}this._countCache=s}buildColorSumCache(e,t){const{config:n}=this._;this._buildSumCacheForType(e,t,n.linkColorBy,!0)}buildWidthSumCache(e,t){const{config:n}=this._;this._buildSumCacheForType(e,t,n.linkWidthBy,!1)}_buildSumCacheForType(e,t,n,r){const o=n??null;if(!o)return void(r?(this._colorSumCache=null,this._colorSumCacheColumn=null):(this._widthSumCache=null,this._widthSumCacheColumn=null));const s=r?this._widthSumCache:this._colorSumCache;if(o===(r?this._widthSumCacheColumn:this._colorSumCacheColumn)&&s)return void(r?(this._colorSumCache=s,this._colorSumCacheColumn=o):(this._widthSumCache=s,this._widthSumCacheColumn=o));const a=r?this._colorSumCache:this._widthSumCache;if(o===(r?this._colorSumCacheColumn:this._widthSumCacheColumn)&&a)return;const l=this._buildSumCache(e,t);r?(this._colorSumCache=l,this._colorSumCacheColumn=l?o:null):(this._widthSumCache=l,this._widthSumCacheColumn=l?o:null)}_buildSumCache(e,t){if(!t)return null;const n=this._getIndexColumns(e);if(!n)return null;const{sourceIdxColumn:r,targetIdxColumn:o,numRows:s}=n,a=new Map;for(let l=0;l<s;l++){const c=r.get(l),u=o.get(l),h=Kp(c,u),d=t.get(l);a.set(h,(a.get(h)??0)+d)}return a}_getIndexColumns(e){const{config:t}=this._;if(!t.linkSourceIndexBy||!t.linkTargetIndexBy)return null;const n=e.getChild(t.linkSourceIndexBy),r=e.getChild(t.linkTargetIndexBy);return n&&r?{sourceIdxColumn:n,targetIdxColumn:r,numRows:e.numRows}:null}aggregateFromCache(e,t,n=!0){const{config:r}=this._;if(!r.linkSourceIndexBy||!r.linkTargetIndexBy)return;const o=e.getChild(r.linkSourceIndexBy),s=e.getChild(r.linkTargetIndexBy);if(!o||!s||!this._countCache)return;const a=n?this._colorSumCache:this._widthSumCache,l=e.numRows,c=new Array(l);for(let u=0;u<l;u++){const h=o.get(u),d=s.get(u),f=Kp(h,d),p=this._countCache.get(f)??0;if(t==="count")c[u]=p;else if(t==="sum")c[u]=(a==null?void 0:a.get(f))??0;else{const b=(a==null?void 0:a.get(f))??0;c[u]=p>0?b/p:0}}return c}getKeysByValueCondition(e,t){if(!e)return[];const n=[];for(const[r,o]of e)t(o)&&n.push(r);return n}getIndicesSetFromKeys(e){if(!e)return[];const t=new Set;for(const n of e){const{sourceIdx:r,targetIdx:o}=aq(n);t.add(r),t.add(o)}return Array.from(t)}getIndicesByValueCondition(e,t){const n=this.getKeysByValueCondition(e,t);return this.getIndicesSetFromKeys(n)}getIndicesByAverageCondition(e,t,n){if(!e||!t)return[];const r=[];for(const[o,s]of e){const a=t.get(o)??0;n(s>0?a/s:0)&&r.push(o)}return this.getIndicesSetFromKeys(r)}clear(){this._countCache=null,this._colorSumCache=null,this._widthSumCache=null,this._colorSumCacheColumn=null,this._widthSumCacheColumn=null}clearColorSumCache(){this._colorSumCache=null,this._colorSumCacheColumn=null}clearWidthSumCache(){this._widthSumCache=null,this._widthSumCacheColumn=null}};function cq(i,e){const[t,n,r,o]=[i.x,i.y+i.height,i.x+i.width,i.y],[s,a,l,c]=[e.x,e.y+e.height,e.x+e.width,e.y];return!(n<c||a<o||r<s||l<t)}const vo=6,xo=9,kl=14,Oh="css-label--labels-container",zT="css-label--labels-container-hidden",Bg="css-label--label",UT="css-label--hidden",uq=`
  :root {
    --css-label-background-color: #1e2428;
    --css-label-brightness: brightness(150%);
  }

  .${Oh} {
    transition: opacity 100ms;
    position: absolute;
    width: 100%;
    height: 100%;
    overflow: hidden;
    top: 0%;
    pointer-events: none;
    opacity: 1;
  }

  .${zT} {
    opacity: 0;

    div {
      pointer-events: none;
    }
  }
`,hq=`
  .${Bg} {
    position: absolute;
    top: 0;
    left: 0;

    cursor: pointer;
    
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;

    filter: var(--css-label-brightness);
    pointer-events: none;
    background-color: var(--css-label-background-color);
    font-weight: 700;
    border-radius: 6px;
    
    transition: opacity 600ms;
    opacity: 1;
  }

  /* We use "important" here because the users may pass their own label class, overriding the opacity */
  .${UT} {
    opacity: 0 !important;
  }
`,$T=i=>{const e=document.createElement("style");e.innerHTML=i;const t=document.head.getElementsByTagName("style")[0];return t?document.head.insertBefore(e,t):document.head.appendChild(e),e};let q1;class VT{constructor(e,t,n){this.element=document.createElement("div"),this.fontWidthHeightRatio=.6,this._x=0,this._y=0,this._estimatedWidth=0,this._estimatedHeight=0,this._visible=!1,this._prevVisible=!1,this._weight=0,this._needsMeasureUpdate=!0,this._customFontSize=kl,this._customColor=void 0,this._customOpacity=void 0,this._shouldBeShown=!1,this._text="",this._customPadding={left:xo,top:vo,right:xo,bottom:vo},!n&&!q1&&(q1=$T(hq)),this._container=e,this._updateClasses(),t&&this.setText(t),this.resetFontSize(),this.resetPadding()}setText(e){this._text!==e&&(this._text=e,this.element.innerHTML=e,this._needsMeasureUpdate=!0)}setPosition(e,t){this._x=e,this._y=t}setStyle(e){if(this._customStyle!==e&&(this._customStyle=e,this.element.style.cssText=this._customStyle,this._customColor&&(this.element.style.color=this._customColor),this._customOpacity&&(this.element.style.opacity=String(this._customOpacity)),this._customPointerEvents&&(this.element.style.pointerEvents=this._customPointerEvents),this._customFontSize&&(this.element.style.fontSize=`${this._customFontSize}px`),this._customPadding)){const{top:t,right:n,bottom:r,left:o}=this._customPadding;this.element.style.padding=`${t}px ${n}px ${r}px ${o}px`}}setClassName(e){this._customClassName!==e&&(this._customClassName=e,this._updateClasses())}setFontSize(e=kl){this._customFontSize!==e&&(this.element.style.fontSize=`${e}px`,this._customFontSize=e,this._needsMeasureUpdate=!0)}resetFontSize(){this._customFontSize!==kl&&(this.element.style.fontSize=`${kl}px`,this._customFontSize=kl,this._needsMeasureUpdate=!0)}setColor(e){this._customColor!==e&&(this.element.style.color=e,this._customColor=e)}resetColor(){this.element.style.removeProperty("color"),this._customColor=void 0}setOpacity(e){this._customOpacity!==e&&(this.element.style.opacity=String(e),this._customOpacity=e)}resetOpacity(){this.element.style.removeProperty("opacity"),this._customOpacity=void 0}setPointerEvents(e){this._customPointerEvents!==e&&(this.element.style.pointerEvents=`${e}`,this._customPointerEvents=e)}resetPointerEvents(){this.element.style.removeProperty("pointer-events"),this._customPointerEvents=void 0}setPadding(e={left:xo,top:vo,right:xo,bottom:vo}){(this._customPadding.left!==e.left||this._customPadding.top!==e.top||this._customPadding.right!==e.right||this._customPadding.bottom!==e.bottom)&&(this._customPadding=e,this.element.style.padding=`${e.top}px ${e.right}px ${e.bottom}px ${e.left}px`,this._needsMeasureUpdate=!0)}resetPadding(){if(this._customPadding.left===xo&&this._customPadding.top===vo&&this._customPadding.right===xo&&this._customPadding.bottom===vo)return;const e={left:xo,top:vo,right:xo,bottom:vo};this.element.style.padding=`${e.top}px ${e.right}px ${e.bottom}px ${e.left}px`,this._customPadding=e,this._needsMeasureUpdate=!0}setForceShow(e){this._shouldBeShown=e}getForceShow(){return this._shouldBeShown}draw(){const e=this.getVisibility();e!==this._prevVisible&&(this._prevVisible===!1?this._container.appendChild(this.element):this._container.removeChild(this.element),this._updateClasses(),this._prevVisible=e),e&&(this.element.style.transform=`
        translate(-50%, -100%)
        translate3d(${this._x}px, ${this._y}px, 0)
      `)}overlaps(e){return this._measureText(),e._measureText(),cq({height:this._estimatedHeight,width:this._estimatedWidth,x:this._x,y:this._y},{height:e._estimatedHeight,width:e._estimatedWidth,x:e._x,y:e._y})}setVisibility(e=!0){this._visible=e}getVisibility(){return this._visible}isOnScreen(){return this._x>0&&this._y>0&&this._x<this._container.offsetWidth&&this._y<this._container.offsetHeight}setWeight(e){this._weight=e}getWeight(){return this._weight}raise(){this._container.appendChild(this.element)}destroy(){this.element.remove()}_updateClasses(){this.getVisibility()?window.requestAnimationFrame(()=>{this.element.className=`${Bg} ${this._customClassName||""}`}):this.element.className=`${Bg} ${this._customClassName||""} ${UT}`}_measureText(){if(this._needsMeasureUpdate){const{left:e,top:t,right:n,bottom:r}=this._customPadding;this._estimatedWidth=this._customFontSize*this.fontWidthHeightRatio*this.element.innerHTML.length+e+n,this._estimatedHeight=this._customFontSize+t+r,this._needsMeasureUpdate=!1}}}let X1;class dq{constructor(e,t){this._cssLabels=new Map,this._elementToData=new Map,!(t!=null&&t.dontInjectStyles)&&!X1&&(X1=$T(uq)),this._container=e,e.addEventListener("click",this._onClick.bind(this)),this._container.className=Oh,t!=null&&t.onLabelClick&&(this._onClickCallback=t.onLabelClick),t!=null&&t.pointerEvents&&(this._pointerEvents=t.pointerEvents),t!=null&&t.dontInjectStyles&&(this._dontInjectStyles=t.dontInjectStyles),t!=null&&t.padding&&(this._padding=t.padding),t!=null&&t.fontSize&&(this._fontSize=t.fontSize),t!=null&&t.dispatchWheelEventElement&&(this._dispatchWheelEventElement=t.dispatchWheelEventElement,this._container.addEventListener("wheel",this._onWheel.bind(this)))}setLabels(e){const t=new Map(this._cssLabels);e.forEach(n=>{const{x:r,y:o,fontSize:s,color:a,text:l,weight:c,opacity:u,shouldBeShown:h,style:d,className:f,padding:p}=n;if(this._cssLabels.get(n.id))t.delete(n.id);else{const _=new VT(this._container,n.text,this._dontInjectStyles);this._cssLabels.set(n.id,_),this._elementToData.set(_.element,n)}const g=this._cssLabels.get(n.id);g&&(g.setText(l),g.setPosition(r,o),d!==void 0&&g.setStyle(d),c!==void 0&&g.setWeight(c),a!==void 0&&g.setColor(a),s!==void 0?g.setFontSize(s):this._fontSize!==void 0?g.setFontSize(this._fontSize):g.resetFontSize(),p!==void 0?g.setPadding(p):this._padding!==void 0?g.setPadding(this._padding):g.resetPadding(),this._pointerEvents!==void 0&&g.setPointerEvents(this._pointerEvents),u!==void 0&&g.setOpacity(u),h!==void 0&&g.setForceShow(h),f!==void 0&&g.setClassName(f))});for(const[n]of t){const r=this._cssLabels.get(n);r&&(this._elementToData.delete(r.element),r.destroy()),this._cssLabels.delete(n)}}draw(e=!0){e&&this._intersectLabels(),this._cssLabels.forEach(t=>t.draw())}show(){this._container.className=Oh}hide(){this._container.className=`${Oh} ${zT}`}destroy(){this._container.removeEventListener("click",this._onClick.bind(this)),this._container.removeEventListener("wheel",this._onWheel.bind(this)),this._cssLabels.forEach(e=>e.destroy())}_onClick(e){var t;const n=this._elementToData.get(e.target);n&&((t=this._onClickCallback)===null||t===void 0||t.call(this,e,n))}_onWheel(e){var t;e.preventDefault();const n=new WheelEvent("wheel",e);(t=this._dispatchWheelEventElement)===null||t===void 0||t.dispatchEvent(n)}_intersectLabels(){const e=Array.from(this._cssLabels.values());e.forEach(t=>t.setVisibility(t.isOnScreen()));for(let t=0;t<e.length;t+=1){const n=e[t];if(n.getVisibility())for(let r=t+1;r<e.length;r+=1){const o=e[r];if(!o.getVisibility())continue;if(n.overlaps(o)){o.getWeight()>n.getWeight()?n.setVisibility(o.getForceShow()?!1:n.getForceShow()):o.setVisibility(n.getForceShow()?!1:o.getForceShow());continue}}}}}const gb=async(i,e,t,n,r)=>{if(!t.pointIdBy||!t.pointIndexBy||!t.pointLabelBy)return{indices:null,ids:null,labels:null,weights:null};let o=`SELECT ${[...new Set([t.pointLabelBy,t.pointIndexBy,t.pointIdBy,...r?[r]:[]])].map(b=>`"${b}"`).join(", ")} FROM ${e}`;n&&(o+=` ${n}`),r&&(o+=` ORDER BY "${r}" DESC`),o+=` LIMIT ${t.showTopLabelsLimit}`;const s=await i.query(o,{cache:!0});if(!s)return{indices:null,ids:null,labels:null,weights:null};const a=s.getChild(t.pointIdBy),l=s.getChild(t.pointIndexBy);let c=s.getChild(t.pointLabelBy),u=null;r&&(u=s.getChild(r));const h=t.pointLabelFn,d=t.pointLabelWeightFn,f=!!c&&typeof h=="function",p=!!u&&typeof d=="function";if(t.pointLabelFn&&!f&&ue(`Provided \`${[Rg.PointLabelFn]}\` is not a function`,"executeLabelsQuery","warn"),t.pointLabelWeightFn&&!p&&ue(`Provided \`${[Rg.PointLabelWeightFn]}\` is not a function`,"executeLabelsQuery","warn"),f||p){const b=f?c.toArray():null,g=p?u.toArray():null,_=Math.max((b==null?void 0:b.length)??0,(g==null?void 0:g.length)??0);for(let T=0;T<_;T++){const E=l==null?void 0:l.get(T);f&&b&&h&&(b[T]=h(b[T],E)),p&&g&&d&&(g[T]=d(g[T],E))}b&&(c=Jr(b)),g&&(u=Jr(g))}return{indices:l,ids:a,labels:c,weights:u}},Ll=async(i,e,t,n,r)=>gb(i,e,t,`WHERE ${t.pointIndexBy} IN (${n.join(", ")})`,r),fq=async(i,e,t)=>gb(i,e,t),pq=async(i,e,t,n)=>{const r=(t.showLabelsFor??[]).map(o=>`'${o}'`).join(", ");return gb(i,e,t,`WHERE ${t.pointIdBy} IN (${r})`,n)};var K1=[],Rl=[];function Pr(i,e){if(i&&typeof document<"u"){var t,n=e.prepend===!0?"prepend":"append",r=e.singleTag===!0,o=typeof e.container=="string"?document.querySelector(e.container):document.getElementsByTagName("head")[0];if(r){var s=K1.indexOf(o);s===-1&&(s=K1.push(o)-1,Rl[s]={}),t=Rl[s]&&Rl[s][n]?Rl[s][n]:Rl[s][n]=a()}else t=a();i.charCodeAt(0)===65279&&(i=i.substring(1)),t.styleSheet?t.styleSheet.cssText+=i:t.appendChild(document.createTextNode(i))}function a(){var l=document.createElement("style");if(l.setAttribute("type","text/css"),e.attributes)for(var c=Object.keys(e.attributes),u=0;u<c.length;u++)l.setAttribute(c[u],e.attributes[c[u]]);var h=n==="prepend"?"afterbegin":"beforeend";return o.insertAdjacentElement(h,l),l}}var mq=".style_module_cosmographDynamicLabel__2e27a4a3,.style_module_cosmographStaticLabel__2e27a4a3{opacity:1}.style_module_cosmographLabelBase__2e27a4a3{-webkit-font-smoothing:antialiased!important;background-color:#24272fe0;cursor:default;font-weight:400!important;line-height:1!important;max-width:350px;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizeLegibility!important;transition:opacity .25s;white-space:nowrap}.style_module_cosmographLabelHovered__2e27a4a3{z-index:1}.style_module_cosmographLabelInteractive__2e27a4a3{cursor:pointer;pointer-events:all}.style_module_cosmographLabelHidden__2e27a4a3{opacity:.1}.style_module_cosmographClusterLabel__2e27a4a3{background:#3f4562a1;font-weight:500!important;opacity:.9;text-shadow:-1px -1px 0 #3f4562a1,-1px -1px 5px #00000026,1px -1px 0 #3f4562a1,1px -1px 5px #00000026,-1px 1px 0 #3f4562a1,-1px 1px 5px #00000026,1px 1px 0 #3f4562a1,1px 1px 5px #00000026}",mn={cosmographStaticLabel:"style_module_cosmographStaticLabel__2e27a4a3",cosmographDynamicLabel:"style_module_cosmographDynamicLabel__2e27a4a3",cosmographLabel:"style_module_cosmographLabel__2e27a4a3 style_module_cosmographLabelBase__2e27a4a3",cosmographLabelHovered:"style_module_cosmographLabelHovered__2e27a4a3 style_module_cosmographLabelBase__2e27a4a3",cosmographLabelInteractive:"style_module_cosmographLabelInteractive__2e27a4a3",cosmographLabelHidden:"style_module_cosmographLabelHidden__2e27a4a3 style_module_cosmographLabelBase__2e27a4a3",cosmographCustomLabel:"style_module_cosmographCustomLabel__2e27a4a3 style_module_cosmographLabelBase__2e27a4a3",cosmographClusterLabel:"style_module_cosmographClusterLabel__2e27a4a3 style_module_cosmographLabelBase__2e27a4a3"};Pr(mq,{});let gq=class{constructor(e,t){m(this,"_");m(this,"_onHoveredLabelClick");m(this,"_hoveredCssLabel");m(this,"_cssLabelsRenderer");m(this,"_focusedLabel");m(this,"_staticLabelsMap",new Map);m(this,"_dynamicLabelsMap",new Map);m(this,"_validLabelAccessor",!1);m(this,"_validLabelWeightAccessor",!1);m(this,"_labelDataMap",new Map);m(this,"_customLabelsMap",new Map);m(this,"_columnNames","");m(this,"_cachedTrackedPointsPositions");m(this,"_lastTrackedPointsQueryTime",0);m(this,"_isZooming",!1);m(this,"_isManualZooming",!1);m(this,"_clustersFontScale");m(this,"_clustersWeightScale");m(this,"_updateClustersFontScaleHandler");m(this,"_minDegree");m(this,"_maxDegree");m(this,"_degreeRange");m(this,"_degreeSummaryCalculated",!1);m(this,"labelsContainer",document.createElement("div"));m(this,"_checkLabelEvents",()=>this._hasPointLabelEvents()?"all":"none");var r;this._=e;const n=this._.eventManager.getLabelEvents();(r=e.containerElement)==null||r.appendChild(this.labelsContainer),this._cssLabelsRenderer=new dq(this.labelsContainer,{dispatchWheelEventElement:t,onLabelClick:n.onLabelClick}),this._onHoveredLabelClick=n.onHoveredLabelClick,this._hoveredCssLabel=new VT(this.labelsContainer),this._hoveredCssLabel.setPointerEvents(this._checkLabelEvents()),this._hoveredCssLabel.element.addEventListener("click",this._onHoveredLabelClick,{passive:!0}),this._updateClustersFontScaleHandler=()=>this._updateClustersFontScale(),this._.addEventListener("clustersUpdated",this._updateClustersFontScaleHandler)}get _labelWeightAccessor(){const{pointLabelWeightBy:e,pointSizeBy:t}=this._.config;return e||t}async render(){const{customLabels:e,showClusterLabels:t}=this._.config;this._.cosmos&&this._.config&&((this._validLabelAccessor||e||t)&&!this._isZooming?await this._updateLabels():this._isZooming&&this._populateLabelDataMap(this._isManualZooming),this._renderLabels())}async update(){if(this._degreeSummaryCalculated=!1,!this._.cosmos||!this._.dbCoordinator)return;const{config:e,public:{pointsTableName:t}}=this._,{pointLabelBy:n,customLabels:r,showClusterLabels:o}=e;await this._.configManager.configUpdated();const s=this._columnNames;this._columnNames=`${n||""}-${this._labelWeightAccessor||""}`,this.setCustomLabels(r);let a=!1;if(n){if(s!==this._columnNames){const l=[];await zf(this._.dbCoordinator,t,[n,this._labelWeightAccessor].filter(Boolean),l),this._validLabelAccessor=!l.includes(n),this._validLabelWeightAccessor=!!this._labelWeightAccessor&&!l.includes(this._labelWeightAccessor),this._validLabelAccessor&&!this._validLabelWeightAccessor&&(a=!0)}this._validLabelAccessor?(a&&this._calculateDegreeSummary(),await this._updateStaticLabels(),await this.render()):(ue(`Column "${n}" for \`pointLabelBy\` not found`,"Labels > update","warn"),this.clear())}else this._customLabelsMap.size>0||o?await this.render():this.clear()}updatePositions(){var n,r;const e=(n=this._.cosmos)==null?void 0:n.getPointPositions(),t=(r=this._.cosmos)==null?void 0:r.getClusterPositions();e&&this._labelDataMap.forEach(o=>{const s=o.index,a=e[2*s],l=e[2*s+1];a!==void 0&&l!==void 0&&(o.position=[a,l])}),t&&this._labelDataMap.forEach((o,s)=>{var a;if((a=s.startsWith)!=null&&a.call(s,"cluster-")){const l=o.index,c=t[2*l],u=t[2*l+1];c!==void 0&&u!==void 0&&(o.position=[c,u])}}),this._renderLabels()}async _updateLabels(){var c,u,h,d;const{config:e,cosmosInitialized:t,dbCoordinator:n,public:{pointsTableName:r,focusedPointIndex:o}}=this._,{showDynamicLabels:s,pointLabelBy:a,showLabels:l}=e;if(this._dynamicLabelsMap.clear(),this._validLabelAccessor&&a&&l&&n)if(s&&await this._updateDynamicLabels(),o){if(!this._focusedLabel||this._focusedLabel&&this._focusedLabel[0]!==o){const f=await Ll(n,r,e,[o]);if(this._focusedLabel=[(c=f.indices)==null?void 0:c.get(0),(u=f.ids)==null?void 0:u.get(0),(h=f.labels)==null?void 0:h.get(0)],t){const p=Array.from(this._staticLabelsMap.keys()).concat(o);(d=this._.cosmos)==null||d.trackPointPositionsByIndices(p)}}}else this._focusedLabel=void 0;this._populateLabelDataMap()}async _updateDynamicLabels(){const{config:e,dbCoordinator:t,public:{pointsTableName:n}}=this._,r=this._.public.getSampledPointPositionsMap();if(!(r!=null&&r.size))return;const o=Array.from(r.keys()),s=await Ll(t,n,e,o);this._setLabels(this._dynamicLabelsMap,s)}async _updateStaticLabels(){var h;const{config:e,dbCoordinator:t,public:{pointsTableName:n,focusedPointIndex:r}}=this._,{pointLabelBy:o,showTopLabels:s,showLabelsFor:a,showLabels:l}=e;if(this._staticLabelsMap.clear(),!l||!t||!o)return;const c=[];a!=null&&a.length&&c.push(pq(t,n,e,this._validLabelWeightAccessor?this._labelWeightAccessor:void 0).then(d=>this._setLabels(this._staticLabelsMap,d))),s&&c.push(this._getTopLabels().then(d=>this._setLabels(this._staticLabelsMap,d))),c.length&&await Promise.all(c);const u=Array.from(this._staticLabelsMap.keys());r&&u.push(r),u.length&&((h=this._.cosmos)==null||h.trackPointPositionsByIndices(u))}async _getTopLabels(){const{config:e,dbCoordinator:t,public:{pointsTableName:n}}=this._;if(!t)return;const r=this._.public.getSelectedPointIndices();if(r!=null&&r.length)return await Ll(t,n,e,r,this._validLabelWeightAccessor?this._labelWeightAccessor:void 0);if(this._labelWeightAccessor&&this._validLabelWeightAccessor)return await fq(t,n,e);this._labelWeightAccessor&&!this._validLabelWeightAccessor&&ue(`Column "${this._labelWeightAccessor}" for weights not found, getting top labels by degree`,"Labels > _getTopLabels","warn");const o=this._findTopIndicesByDegree();return o.length?await Ll(t,n,e,o,this._validLabelWeightAccessor?this._labelWeightAccessor:void 0):void 0}_setLabels(e,t){var r;if(!(t!=null&&t.indices)||!t.labels||!t.ids)return;const n=t.indices.length;for(let o=0;o<n;o++)e.set(t.indices.get(o),[t.ids.get(o),t.labels.get(o),(r=t.weights)==null?void 0:r.get(o)])}_findTopIndicesByDegree(){const{showTopLabelsLimit:e=100}=this._.config,{pointDegrees:t}=this._.public;if(!t)return[];const n=new Set(this._.public.getSelectedPointIndices()),r=[];if(n.size>0){const o=Array.from(n).sort((s,a)=>(t[a]||0)-(t[s]||0)).slice(0,e);r.push(...o)}if(r.length<e){const o=e-r.length,s=[];for(let a=0;a<t.length;a++)!n.has(a)&&t[a]&&(s.length<o?(s.push({index:a,degree:t[a]??0}),s.length===o&&s.sort((l,c)=>c.degree-l.degree)):t[a]>s[o-1].degree&&(s[o-1]={index:a,degree:t[a]},s.sort((l,c)=>c.degree-l.degree)));r.push(...s.map(a=>a.index))}return r}_populateLabelDataMap(e=!1){const{showLabels:t,staticLabelWeight:n,dynamicLabelWeight:r,showDynamicLabels:o,showTopLabels:s,showLabelsFor:a,pointLabelBy:l}=this._.config;if(e&&t||this._labelDataMap.clear(),!t)return;const c=this._.crossfilter.isFilteringActive;if(!(this._.config.showClusterLabels&&!c)&&this._validLabelAccessor&&l&&t){const u=this._getTrackedPositions(e);if(u&&((s||a!=null&&a.length)&&this._addLabelsToDataMap(this._staticLabelsMap,u,mn.cosmographStaticLabel,n),this._addFocusedLabelToDataMap(u)),!e&&o){const h=this._.public.getSampledPointPositionsMap();h&&this._addLabelsToDataMap(this._dynamicLabelsMap,h,mn.cosmographDynamicLabel,r)}}this._addClusterLabelsToDataMap(),this._addCustomLabelsToDataMap()}_getTrackedPositions(e){var r;const t=Date.now();if(e&&this._cachedTrackedPointsPositions&&t-this._lastTrackedPointsQueryTime<1e3)return this._cachedTrackedPointsPositions;const n=(r=this._.cosmos)==null?void 0:r.getTrackedPointPositionsMap();return this._cachedTrackedPointsPositions=n,this._lastTrackedPointsQueryTime=t,n}_addLabelsToDataMap(e,t,n,r){e.size&&t.forEach((o,s)=>{const a=e.get(s);if(a){const[l,c,u]=a;this._labelDataMap.set(l,{index:s,text:c,position:o,className:n,weight:u??r})}})}_updateClustersFontScale(){const{config:e}=this._;if(!e.pointClusterBy)return;const t=Array.from(this._.configManager.clusterIndexToNameMapping.values()).map(({count:a})=>a),n=Yi(t),r=e.clusterLabelFontSize??Al,o=Math.max(10,Math.floor(.7*r)),s=Math.ceil(1.5*r);this._clustersFontScale=Hc().domain(n).range([o,s]),this._clustersWeightScale=Hc().domain(n).range([1100,1e4])}_addClusterLabelsToDataMap(){var a,l,c,u,h;const{config:{showClusterLabels:e,clusterLabelFontSize:t=Al,scaleClusterLabels:n,usePointColorStrategyForClusterLabels:r,pointDefaultColor:o}}=this._;if(!e||this._.crossfilter.isFilteringActive)return;const s=(a=this._.cosmos)==null?void 0:a.getClusterPositions();if(s)for(let d=0;d<s.length;d+=2){const f=Number(s[d]),p=Number(s[d+1]),b=d/2,g=this._.configManager.clusterIndexToNameMapping.get(b);if(!g)continue;const _=n?(l=this._clustersFontScale)==null?void 0:l.call(this,(g==null?void 0:g.count)??0):t,T=no(o,Pg),E=r?(u=(c=this._.configManager).activePointColorFn)==null?void 0:u.call(c,g==null?void 0:g.name):void 0,y=E?typeof E=="string"?E:no(E,T):void 0,{text:C,maxWidth:I}=this._getClusterLabelText((g==null?void 0:g.name)??`Cluster ${b}`,_);this._labelDataMap.set(`cluster-${b}`,{text:C,position:[f,p],className:mn.cosmographClusterLabel,index:b,fontSize:_,color:r?y:"white",weight:((h=this._clustersWeightScale)==null?void 0:h.call(this,(g==null?void 0:g.count)??0))??5e3,padding:this._getClusterPadding(_),maxWidth:I})}}_addCustomLabelsToDataMap(){const{staticLabelWeight:e,pointLabelColor:t}=this._.config;this._customLabelsMap.forEach((n,r)=>{this._labelDataMap.set(r,{index:0,text:n.text,position:n.position,className:n.className??mn.cosmographCustomLabel,color:t??(n.className?void 0:"white"),weight:e})})}_addFocusedLabelToDataMap(e){if(!this._focusedLabel)return;const[t,n,r]=this._focusedLabel,o=e.get(t);o&&this._labelDataMap.set(n,{index:t,text:r,position:o,className:mn.cosmographStaticLabel,weight:1e4})}_normalizeWeight(e,t,n){var o,s;if(n)return 1e3;if(this._validLabelWeightAccessor&&e!==void 0){const a=(s=(o=this._.summary)==null?void 0:o.pointsSummary)==null?void 0:s.find(l=>l.column_name===this._labelWeightAccessor);if(a){const{min:l,max:c}=a,u=c-l;return u>0?(e-l)/u*100:50}}const r=this._.public.pointDegrees;if(this._degreeSummaryCalculated&&r&&r[t]!==void 0){const a=r[t]??this._minDegree??0;return(this._degreeRange??0)>0?(a-(this._minDegree??0))/this._degreeRange*100:50}return 1}_calculateDegreeSummary(){const e=this._.public.pointDegrees;if(e&&!this._degreeSummaryCalculated){this._minDegree=1/0,this._maxDegree=-1/0;for(let t=0;t<e.length;t++){const n=e[t];n!==void 0&&(this._maxDegree=Math.max(this._maxDegree,n),this._minDegree=Math.min(this._minDegree,n))}this._minDegree===1/0&&(this._minDegree=0),this._maxDegree===-1/0&&(this._maxDegree=this._minDegree),this._degreeRange=this._maxDegree-this._minDegree,this._degreeSummaryCalculated=!0}}_renderLabels(){var f,p;const{public:{crossfilter:e}}=this._,{pointLabelClassName:t,clusterLabelClassName:n,labelMargin:r,pointLabelColor:o,pointLabelFontSize:s,clusterLabelFontSize:a=Al,labelPadding:l}=this._.config,c=e.intersection,u=this._.crossfilter.isFilteringActive,h=mn.cosmographLabelHidden,d=Array.from(this._labelDataMap.entries()).map(([b,g])=>{var Ze;const{index:_,text:T,position:E,className:y,weight:C,color:I,fontSize:F,padding:V,maxWidth:q}=g,Q=b.startsWith("custom-"),M=b.startsWith("cluster-"),ae=M?mn.cosmographClusterLabel:mn.cosmographLabel,[ee,R]=this._.public.spaceToScreenPosition(E),X=this._.public.getPointScreenRadiusByIndex(_),O=((Ze=this._focusedLabel)==null?void 0:Ze[0])===_,W=!!u&&c.has(_),ne=!u||W,Y=M?n:t;let ie;if(ie=typeof Y=="function"?Y(T,_,b)??"":Y??"",M&&q){const oe=`max-width: ${q}px;`;ie=ie.includes(":")?`${ie} ${oe}`:oe}const j=ie.includes(":");let fe=j?`${ne?ae:h} ${y}`:`${ne?ae:h} ${ie} ${y}`,de;return(M?this._hasClusterLabelEvents():this._hasPointLabelEvents())&&(fe+=` ${mn.cosmographLabelInteractive}`),de=Q?R:M?R+a/2+r:R-X/2-r,{id:b,text:T,x:ee,y:de,padding:M?V:this._getPaddingObject(l),weight:M?C:this._normalizeWeight(C,_,W),shouldBeShown:O,fontSize:F??s,color:Q?I:I??(t!==void 0?void 0:o??this._getLabelColorByIndex(_)),style:j?ie:"",className:fe}});(f=this._cssLabelsRenderer)==null||f.setLabels(d),(p=this._cssLabelsRenderer)==null||p.draw(!0)}async renderHoveredLabel(e,t){var C,I;if(!this._.cosmos)return;const{config:n,dbCoordinator:r,public:{pointsTableName:o}}=this._,{pointLabelBy:s,showHoveredPointLabel:a,hoveredPointLabelClassName:l,labelMargin:c,pointLabelFontSize:u,labelPadding:h}=n;if(this._hoveredCssLabel.setPointerEvents(this._checkLabelEvents()),!(r&&a&&s&&e!==void 0&&t&&this._validLabelAccessor))return this._hoveredCssLabel.setVisibility(!1),void this._hoveredCssLabel.draw();const d=await Ll(r,o,n,[e]);if(!d)return;const f=(C=d.ids)==null?void 0:C.get(0),p=((I=d.labels)==null?void 0:I.get(0))??"",[b,g]=this._.public.spaceToScreenPosition(t),_=this._.public.getPointScreenRadiusByIndex(e);let T,E;T=typeof l=="function"?l(p,e,f)??"":l??"";const y=T.includes(":");E=y?mn.cosmographLabelHovered:[mn.cosmographLabelHovered,T].join(" "),this._checkLabelEvents()==="all"&&(E+=` ${mn.cosmographLabelInteractive}`),this._hoveredCssLabel.setText(p),this._hoveredCssLabel.setVisibility(!0),this._hoveredCssLabel.setPosition(b,g-_/2-c),this._hoveredCssLabel.setClassName(E),this._hoveredCssLabel.setStyle(y?T:""),this._hoveredCssLabel.setFontSize(u),this._hoveredCssLabel.setPadding(this._getPaddingObject(h)),l||this._hoveredCssLabel.setColor(this._getLabelColorByIndex(e)),this._hoveredCssLabel.draw()}setCustomLabels(e){const{rescaleXFn:t,rescaleYFn:n}=this._.public;this._customLabelsMap.clear(),e&&e.forEach((r,o)=>{const s={...r};t&&n&&s.position[0]!==void 0&&s.position[1]!==void 0&&(s.position=[t(s.position[0]),n(s.position[1])]),this._customLabelsMap.set(`custom-${o}`,s)})}setZooming(e,t=!0){const n=this._isZooming;this._isZooming=e,this._isManualZooming=t,n&&!e&&this.render().catch(console.error)}destroy(){var e,t,n,r;this.clear(),(e=this._hoveredCssLabel)==null||e.element.removeEventListener("click",this._onHoveredLabelClick,{passive:!0}),(t=this._hoveredCssLabel)==null||t.destroy(),(n=this._cssLabelsRenderer)==null||n.destroy(),(r=this._.containerElement)==null||r.removeChild(this.labelsContainer)}clear(){var e,t,n;this._cachedTrackedPointsPositions=void 0,this._lastTrackedPointsQueryTime=0,this._isZooming=!1,this._degreeSummaryCalculated=!1,this._minDegree=void 0,this._maxDegree=void 0,this._degreeRange=void 0,this._labelDataMap.size&&(this._customLabelsMap.clear(),this._staticLabelsMap.clear(),this._dynamicLabelsMap.clear(),this._labelDataMap.clear(),(e=this._cssLabelsRenderer)==null||e.setLabels([]),(t=this._cssLabelsRenderer)==null||t.draw(),(n=this._hoveredCssLabel)==null||n.destroy())}_getLabelColorByIndex(e){var o;const t=(o=this._.cosmos)==null?void 0:o.graph.pointColors,n=jY(t,e)??this._.config.pointDefaultColor,r=no(this._.config.pointDefaultColor,Pg);return no(n,r)}_hasPointLabelEvents(){const{onLabelClick:e,selectPointOnLabelClick:t,focusPointOnLabelClick:n}=this._.config;return e!==void 0||!!t||!!n}_hasClusterLabelEvents(){const{onClusterLabelClick:e,selectClusterOnLabelClick:t}=this._.config;return e!==void 0||!!t}_getPaddingObject(e){if(e&&!(e.length<4))return{left:e[0]??0,top:e[1]??0,right:e[2]??0,bottom:e[3]??0}}_getClusterPadding(e){const{scaleClusterLabels:t,clusterLabelFontSize:n=Al}=this._.config,r=this._getPaddingObject(this._.config.labelPadding);if(!t||!e)return r;const o=e/n;return{left:r.left*o,top:r.top*o,right:r.right*o,bottom:r.bottom*o}}_getClusterLabelText(e,t){const{scaleClusterLabels:n,clusterLabelFontSize:r=Al}=this._.config;if(!n||!t)return{text:e,maxWidth:350};const o=t/r,s=Math.max(350,Math.min(900,500*o)),a=.6*t,l=Math.floor(s/a);return e.length*a>s?{text:`${e.substring(0,Math.max(3,l-3))}...`,maxWidth:s}:{text:e,maxWidth:s}}};const _q='<svg fill="currentColor" height="11" viewBox="0 0 163 11" width="163" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path d="m2.45674 8-1.925002-5.379h.924002l1.617 4.73h.154l1.617-4.73h.924l-1.925 5.379z"/><path d="m7.02243 8v-5.379h.869v5.379zm.44-6.215c-.19067 0-.352-.06233-.484-.187-.12467-.12467-.187-.28233-.187-.473 0-.198.06233-.359333.187-.484.132-.124667.29333-.187.484-.187.19066 0 .34833.062333.473.187.12466.124667.187.286.187.484 0 .19067-.06234.34833-.187.473-.12467.12467-.28234.187-.473.187z"/><path d="m11.8857 8.154c-.6673 0-1.232-.154-1.694-.462-.45465-.308-.72965-.79567-.82499-1.463l.82499-.187c.0587.352.1687.63067.33.836.1613.198.3593.341.594.429.242.08067.4987.121.77.121.4033 0 .7223-.08067.957-.242s.352-.37767.352-.649c0-.27867-.1137-.473-.341-.583-.22-.11733-.5243-.21267-.913-.286l-.451-.077c-.3447-.05867-.66-.15033-.946-.275s-.5133-.29333-.68199-.506c-.16866-.21267-.25299-.48033-.25299-.803 0-.484.18699-.86167.56098-1.133.374-.27133.869-.407 1.485-.407.6087 0 1.1.13933 1.474.418.3813.27133.627.65633.737 1.155l-.814.209c-.066-.38867-.2237-.66-.473-.814-.2493-.16133-.5573-.242-.924-.242s-.6563.06967-.869.209c-.2127.132-.319.33-.319.594 0 .25667.099.44733.297.572.2053.11733.4767.20533.814.264l.451.077c.3813.066.7223.15767 1.023.275.308.11.55.27133.726.484.1833.21267.275.49133.275.836 0 .528-.198.935-.594 1.221-.3887.286-.913.429-1.573.429z"/><path d="m17.5765 8.099c-.3887 0-.748-.08433-1.078-.253-.3227-.16867-.5793-.418-.77-.748-.1833-.33733-.275-.74433-.275-1.221v-3.256h.869v3.19c0 .53533.132.924.396 1.166.2713.242.6343.363 1.089.363.5133 0 .935-.16867 1.265-.506s.495-.83967.495-1.507v-2.706h.869v5.379h-.847v-.913h-.154c-.1173.25667-.319.49133-.605.704-.286.20533-.704.308-1.254.308z"/><path d="m23.9048 8.154c-.374 0-.715-.066-1.023-.198s-.55-.32267-.726-.572-.264-.55367-.264-.913c0-.36667.088-.66733.264-.902.176-.242.418-.42167.726-.539.308-.12467.6527-.187 1.034-.187h1.815v-.396c0-.38133-.1136-.682-.341-.902-.22-.22-.55-.33-.99-.33-.4326 0-.77.10633-1.012.319-.242.20533-.407.484-.495.836l-.814-.264c.088-.30067.2274-.572.418-.814.1907-.24933.4437-.44733.759-.594.3227-.154.7077-.231 1.155-.231.6894 0 1.2247.17967 1.606.539.3814.352.572.85067.572 1.496v2.431c0 .22.1027.33.308.33h.495v.737h-.759c-.242 0-.4363-.066-.583-.198-.1466-.13933-.22-.32267-.22-.55v-.055h-.132c-.0806.13933-.1906.286-.33.44-.132.14667-.3153.26767-.55.363-.2346.10267-.539.154-.913.154zm.099-.748c.5134 0 .9277-.15033 1.243-.451.3227-.308.484-.737.484-1.287v-.121h-1.782c-.3446 0-.6306.077-.858.231-.22.14667-.33.37033-.33.671s.1137.53533.341.704c.2347.16867.5354.253.902.253z"/><path d="m28.582 8v-7.7h.869v7.7z"/><path d="m31.2783 8v-5.379h.869v5.379zm.44-6.215c-.1907 0-.352-.06233-.484-.187-.1247-.12467-.187-.28233-.187-.473 0-.198.0623-.359333.187-.484.132-.124667.2933-.187.484-.187s.3483.062333.473.187.187.286.187.484c0 .19067-.0623.34833-.187.473s-.2823.187-.473.187z"/><path d="m33.7326 8v-1.122l3.421-3.377v-.121h-3.311v-.759h4.224v1.122l-3.432 3.377v.132h3.52v.748z"/><path d="m41.9601 8.154c-.5427 0-1.0194-.11367-1.43-.341-.4107-.23467-.7297-.561-.957-.979-.2274-.418-.341-.902-.341-1.452v-.132c0-.55733.1136-1.045.341-1.463.2273-.418.5426-.74067.946-.968.4033-.23467.8653-.352 1.386-.352.506 0 .9533.11 1.342.33.3886.21267.693.52067.913.924s.33.87633.33 1.419v.396h-4.389c.022.57933.209 1.034.561 1.364.352.32267.792.484 1.32.484.462 0 .8176-.10633 1.067-.319.2493-.21267.44-.46567.572-.759l.748.363c-.11.22733-.264.45467-.462.682-.1907.22733-.4437.418-.759.572-.308.154-.704.231-1.188.231zm-1.848-3.333h3.498c-.0294-.49867-.2017-.88733-.517-1.166-.308-.27867-.704-.418-1.188-.418-.4914 0-.8947.13933-1.21.418-.3154.27867-.5097.66733-.583 1.166z"/><path d="m48.2828 8.154c-.462 0-.8873-.11-1.276-.33-.3886-.22-.6966-.539-.924-.957-.2273-.418-.341-.913-.341-1.485v-.143c0-.572.1137-1.06333.341-1.474.2274-.418.5317-.737.913-.957.3887-.22733.8177-.341 1.287-.341.374 0 .6894.05133.946.154.264.09533.4767.22.638.374.1614.14667.286.30433.374.473h.154v-3.168h.869v7.7h-.847v-.891h-.154c-.1466.27133-.374.51333-.682.726s-.7406.319-1.298.319zm.231-.77c.5574 0 1.0084-.176 1.353-.528.352-.35933.528-.858.528-1.496v-.099c0-.638-.176-1.133-.528-1.485-.3446-.35933-.7956-.539-1.353-.539-.55 0-1.0046.17967-1.364.539-.352.352-.528.847-.528 1.485v.099c0 .638.176 1.13667.528 1.496.3594.352.814.528 1.364.528z"/><path d="m58.8911 8.154c-.5573 0-.9936-.10633-1.309-.319-.308-.21267-.5316-.45467-.671-.726h-.154v.891h-.847v-7.7h.869v3.168h.154c.088-.16867.2127-.32633.374-.473.1614-.154.3704-.27867.627-.374.264-.10267.583-.154.957-.154.4694 0 .8947.11367 1.276.341.3887.22.6967.539.924.957.2274.41067.341.902.341 1.474v.143c0 .572-.1173 1.067-.352 1.485-.2273.418-.5353.737-.924.957-.3813.22-.803.33-1.265.33zm-.231-.77c.5574 0 1.0084-.176 1.353-.528.352-.35933.528-.858.528-1.496v-.099c0-.638-.176-1.133-.528-1.485-.3446-.35933-.7956-.539-1.353-.539-.55 0-1.0046.17967-1.364.539-.352.352-.528.847-.528 1.485v.099c0 .638.176 1.13667.528 1.496.3594.352.814.528 1.364.528z"/><path d="m63.6382 10.2v-.77h3.08c.2127 0 .319-.11.319-.33v-1.958h-.154c-.0733.154-.187.308-.341.462-.1466.14667-.341.26767-.583.363-.242.088-.5463.132-.913.132-.3886 0-.748-.08433-1.078-.253-.3226-.16867-.5793-.418-.77-.748-.1833-.33-.275-.73333-.275-1.21v-3.267h.869v3.201c0 .528.132.913.396 1.155.2714.242.6344.363 1.089.363.5134 0 .935-.16867 1.265-.506s.495-.83967.495-1.507v-2.706h.869v6.633c0 .29333-.0843.52433-.253.693-.1613.1687-.3996.253-.715.253z"/><path d="m75.2998 8.154c-.9167 0-1.6464-.264-2.189-.792-.5427-.53533-.814-1.31267-.814-2.332v-1.76c0-1.01933.2713-1.793.814-2.321.5426-.535333 1.2723-.803 2.189-.803.9093 0 1.606.253 2.09.759.4913.506.737 1.199.737 2.079v.055h-.913v-.088c0-.57933-.1577-1.05233-.473-1.419-.308-.374-.7884-.561-1.441-.561-.6527 0-1.1624.20167-1.529.605-.3667.396-.55.95333-.55 1.672v1.804c0 .71867.1833 1.27967.55 1.683.3666.396.8763.594 1.529.594.6526 0 1.133-.18333 1.441-.55.3153-.374.473-.85067.473-1.43v-.176h.913v.143c0 .88-.2457 1.573-.737 2.079-.484.506-1.1807.759-2.09.759z"/><path d="m82.0934 8.154c-.5427 0-1.023-.11367-1.441-.341-.4107-.22733-.7333-.54633-.968-.957-.2273-.418-.341-.90933-.341-1.474v-.143c0-.55733.1137-1.045.341-1.463.2347-.418.5573-.74067.968-.968.418-.22733.8983-.341 1.441-.341s1.0193.11367 1.43.341c.418.22733.7407.55.968.968.2347.418.352.90567.352 1.463v.143c0 .56467-.1173 1.056-.352 1.474-.2273.41067-.55.72967-.968.957-.4107.22733-.8873.341-1.43.341zm0-.781c.572 0 1.0267-.17967 1.364-.539.3447-.36667.517-.858.517-1.474v-.099c0-.616-.1723-1.10367-.517-1.463-.3373-.36667-.792-.55-1.364-.55-.5647 0-1.0193.18333-1.364.55-.3447.35933-.517.847-.517 1.463v.099c0 .616.1723 1.10733.517 1.474.3447.35933.7993.539 1.364.539z"/><path d="m88.5742 8.154c-.6673 0-1.232-.154-1.694-.462-.4547-.308-.7297-.79567-.825-1.463l.825-.187c.0587.352.1687.63067.33.836.1613.198.3593.341.594.429.242.08067.4987.121.77.121.4033 0 .7223-.08067.957-.242s.352-.37767.352-.649c0-.27867-.1137-.473-.341-.583-.22-.11733-.5243-.21267-.913-.286l-.451-.077c-.3447-.05867-.66-.15033-.946-.275s-.5133-.29333-.682-.506-.253-.48033-.253-.803c0-.484.187-.86167.561-1.133s.869-.407 1.485-.407c.6087 0 1.1.13933 1.474.418.3813.27133.627.65633.737 1.155l-.814.209c-.066-.38867-.2237-.66-.473-.814-.2493-.16133-.5573-.242-.924-.242s-.6563.06967-.869.209c-.2127.132-.319.33-.319.594 0 .25667.099.44733.297.572.2053.11733.4767.20533.814.264l.451.077c.3813.066.7223.15767 1.023.275.308.11.55.27133.726.484.1833.21267.275.49133.275.836 0 .528-.198.935-.594 1.221-.3887.286-.913.429-1.573.429z"/><path d="m92.208 8v-5.379h.847v.671h.154c.1026-.19067.2713-.36667.506-.528.2346-.16133.5646-.242.99-.242.418 0 .7553.09167 1.012.275.264.18333.4546.407.572.671h.154c.1246-.264.3116-.48767.561-.671.2566-.18333.6123-.275 1.067-.275.3593 0 .6746.07333.946.22.2713.14667.484.35933.638.638.1613.27133.242.59767.242.979v3.641h-.869v-3.564c0-.35933-.1064-.64167-.319-.847-.2054-.21267-.495-.319-.869-.319-.396 0-.7224.12833-.979.385-.2494.25667-.374.627-.374 1.111v3.234h-.869v-3.564c0-.35933-.1064-.64167-.319-.847-.2054-.21267-.495-.319-.869-.319-.396 0-.7224.12833-.979.385-.2494.25667-.374.627-.374 1.111v3.234z"/><path d="m104.158 8.154c-.543 0-1.023-.11367-1.441-.341-.411-.22733-.733-.54633-.968-.957-.227-.418-.341-.90933-.341-1.474v-.143c0-.55733.114-1.045.341-1.463.235-.418.557-.74067.968-.968.418-.22733.898-.341 1.441-.341s1.019.11367 1.43.341c.418.22733.741.55.968.968.235.418.352.90567.352 1.463v.143c0 .56467-.117 1.056-.352 1.474-.227.41067-.55.72967-.968.957-.411.22733-.887.341-1.43.341zm0-.781c.572 0 1.027-.17967 1.364-.539.345-.36667.517-.858.517-1.474v-.099c0-.616-.172-1.10367-.517-1.463-.337-.36667-.792-.55-1.364-.55-.565 0-1.019.18333-1.364.55-.345.35933-.517.847-.517 1.463v.099c0 .616.172 1.10733.517 1.474.345.35933.799.539 1.364.539z"/><path d="m108.208 5.338v-.154c0-.56467.113-1.04867.341-1.452.227-.40333.535-.715.924-.935.388-.22.814-.33 1.276-.33.564 0 .997.11 1.298.33.308.21267.535.451.682.715h.154v-.891h.825v6.633c0 .29333-.081.52433-.242.693-.162.1687-.396.253-.704.253h-3.652v-.77h3.421c.22 0 .33-.11.33-.33v-2.046h-.154c-.088.16133-.213.319-.374.473-.162.154-.371.28233-.627.385-.257.09533-.576.143-.957.143-.462 0-.888-.11-1.276-.33-.389-.22-.697-.53167-.924-.935-.228-.41067-.341-.89467-.341-1.452zm2.772 1.947c.557 0 1.008-.176 1.353-.528.352-.352.528-.836.528-1.452v-.088c0-.62333-.176-1.10733-.528-1.452-.345-.352-.796-.528-1.353-.528-.55 0-1.005.176-1.364.528-.352.34467-.528.82867-.528 1.452v.088c0 .616.176 1.1.528 1.452.359.352.814.528 1.364.528z"/><path d="m115.529 8v-5.379h.847v.66h.154c.096-.23467.242-.407.44-.517s.459-.165.781-.165h.638v.792h-.693c-.388 0-.704.11-.946.33-.234.21267-.352.54633-.352 1.001v3.278z"/><path d="m121.143 8.154c-.374 0-.715-.066-1.023-.198s-.55-.32267-.726-.572-.264-.55367-.264-.913c0-.36667.088-.66733.264-.902.176-.242.418-.42167.726-.539.308-.12467.653-.187 1.034-.187h1.815v-.396c0-.38133-.114-.682-.341-.902-.22-.22-.55-.33-.99-.33-.433 0-.77.10633-1.012.319-.242.20533-.407.484-.495.836l-.814-.264c.088-.30067.227-.572.418-.814.191-.24933.444-.44733.759-.594.323-.154.708-.231 1.155-.231.689 0 1.225.17967 1.606.539.381.352.572.85067.572 1.496v2.431c0 .22.103.33.308.33h.495v.737h-.759c-.242 0-.436-.066-.583-.198-.147-.13933-.22-.32267-.22-.55v-.055h-.132c-.081.13933-.191.286-.33.44-.132.14667-.315.26767-.55.363-.235.10267-.539.154-.913.154zm.099-.748c.513 0 .928-.15033 1.243-.451.323-.308.484-.737.484-1.287v-.121h-1.782c-.345 0-.631.077-.858.231-.22.14667-.33.37033-.33.671s.114.53533.341.704c.235.16867.535.253.902.253z"/><path d="m125.82 10.2v-7.579h.847v.891h.154c.14-.27133.363-.51333.671-.726.316-.21267.752-.319 1.309-.319.462 0 .884.11367 1.265.341.389.22.697.53533.924.946.235.41067.352.90567.352 1.485v.143c0 .572-.113 1.067-.341 1.485-.227.418-.535.737-.924.957-.381.22-.806.33-1.276.33-.374 0-.693-.05133-.957-.154-.256-.09533-.465-.22-.627-.374-.161-.154-.286-.31167-.374-.473h-.154v3.047zm2.75-2.816c.558 0 1.009-.176 1.353-.528.352-.35933.528-.858.528-1.496v-.099c0-.638-.176-1.133-.528-1.485-.344-.35933-.795-.539-1.353-.539-.55 0-1.004.17967-1.364.539-.352.352-.528.847-.528 1.485v.099c0 .638.176 1.13667.528 1.496.36.352.814.528 1.364.528z"/><path d="m132.899 8v-7.7h.869v3.179h.154c.074-.16133.184-.31167.33-.451.154-.14667.349-.26767.583-.363.242-.09533.547-.143.913-.143.404 0 .763.088 1.078.264.323.16867.58.418.77.748.191.32267.286.726.286 1.21v3.256h-.869v-3.19c0-.53533-.135-.924-.407-1.166-.264-.242-.623-.363-1.078-.363-.52 0-.946.16867-1.276.506-.322.33733-.484.83967-.484 1.507v2.706z"/><path d="m140.118 8.154c-.212 0-.392-.06967-.539-.209-.139-.13933-.209-.319-.209-.539s.07-.39967.209-.539c.147-.13933.327-.209.539-.209.22 0 .4.06967.539.209.14.13933.209.319.209.539s-.069.39967-.209.539c-.139.13933-.319.209-.539.209z"/><path d="m144.078 8.154c-.374 0-.715-.066-1.023-.198s-.55-.32267-.726-.572-.264-.55367-.264-.913c0-.36667.088-.66733.264-.902.176-.242.418-.42167.726-.539.308-.12467.652-.187 1.034-.187h1.815v-.396c0-.38133-.114-.682-.341-.902-.22-.22-.55-.33-.99-.33-.433 0-.77.10633-1.012.319-.242.20533-.407.484-.495.836l-.814-.264c.088-.30067.227-.572.418-.814.19-.24933.443-.44733.759-.594.322-.154.707-.231 1.155-.231.689 0 1.224.17967 1.606.539.381.352.572.85067.572 1.496v2.431c0 .22.102.33.308.33h.495v.737h-.759c-.242 0-.437-.066-.583-.198-.147-.13933-.22-.32267-.22-.55v-.055h-.132c-.081.13933-.191.286-.33.44-.132.14667-.316.26767-.55.363-.235.10267-.539.154-.913.154zm.099-.748c.513 0 .927-.15033 1.243-.451.322-.308.484-.737.484-1.287v-.121h-1.782c-.345 0-.631.077-.858.231-.22.14667-.33.37033-.33.671s.113.53533.341.704c.234.16867.535.253.902.253z"/><path d="m148.755 10.2v-7.579h.847v.891h.154c.139-.27133.363-.51333.671-.726.315-.21267.752-.319 1.309-.319.462 0 .884.11367 1.265.341.389.22.697.53533.924.946.235.41067.352.90567.352 1.485v.143c0 .572-.114 1.067-.341 1.485s-.535.737-.924.957c-.381.22-.807.33-1.276.33-.374 0-.693-.05133-.957-.154-.257-.09533-.466-.22-.627-.374s-.286-.31167-.374-.473h-.154v3.047zm2.75-2.816c.557 0 1.008-.176 1.353-.528.352-.35933.528-.858.528-1.496v-.099c0-.638-.176-1.133-.528-1.485-.345-.35933-.796-.539-1.353-.539-.55 0-1.005.17967-1.364.539-.352.352-.528.847-.528 1.485v.099c0 .638.176 1.13667.528 1.496.359.352.814.528 1.364.528z"/><path d="m155.834 10.2v-7.579h.847v.891h.154c.139-.27133.363-.51333.671-.726.315-.21267.752-.319 1.309-.319.462 0 .884.11367 1.265.341.389.22.697.53533.924.946.235.41067.352.90567.352 1.485v.143c0 .572-.114 1.067-.341 1.485s-.535.737-.924.957c-.381.22-.807.33-1.276.33-.374 0-.693-.05133-.957-.154-.257-.09533-.466-.22-.627-.374s-.286-.31167-.374-.473h-.154v3.047zm2.75-2.816c.557 0 1.008-.176 1.353-.528.352-.35933.528-.858.528-1.496v-.099c0-.638-.176-1.133-.528-1.485-.345-.35933-.796-.539-1.353-.539-.55 0-1.005.17967-1.364.539-.352.352-.528.847-.528 1.485v.099c0 .638.176 1.13667.528 1.496.359.352.814.528 1.364.528z"/><path d="m71.6368 9.375h90.3682v.55h-90.3682z"/></g></svg>';var yq=".style_module_rectSelect__6c3b1fe5{height:100%;left:0;position:absolute;top:0;width:100%}",bq={rectSelect:"style_module_rectSelect__6c3b1fe5"};Pr(yq,{});let vq=class{constructor(e){m(this,"_");m(this,"_svg");m(this,"_onSelectCallback");m(this,"_brush",cH().keyModifiers(!1).on("end",e=>{var o;if(!e.sourceEvent)return;const{shiftKey:t,altKey:n}=e.sourceEvent,r=e.selection;(o=this._onSelectCallback)==null||o.call(this,r,t,n)}));var t;this._=e,this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._svg.classList.add(bq.rectSelect),(t=this._.containerElement)==null||t.appendChild(this._svg),this._onSelectCallback=this._.eventManager.onRectSelect,Et(this._svg).select(".brush-group").remove(),this._brush.extent([[0,0],[this._svg.clientWidth,this._svg.clientHeight]]),Et(this._svg).append("g").attr("class","brush-group").call(this._brush),this.updateSelectionClassName(),Et(this._svg).style("display","none")}updateSelectionClassName(){const e=`selection ${this._.config.rectangularSelectorClassName??""}`;Et(this._svg).select(".brush-group").selectAll(".selection").attr("class",e)}enable(){Et(this._svg).style("display",null),this._brush.extent([[0,0],[this._svg.clientWidth,this._svg.clientHeight]]),Et(this._svg).select(".brush-group").call(this._brush)}disable(){Et(this._svg).style("display","none"),Et(this._svg).select(".brush-group").call(this._brush.clear)}destroy(){Et(this._svg).select(".brush-group").remove(),this._svg.remove()}};var xq=".style_module_polygonalSelect__f21ae84d{height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}",wq={polygonalSelect:"style_module_polygonalSelect__f21ae84d"};Pr(xq,{});let Sq=class{constructor(e){m(this,"_");m(this,"_canvas");m(this,"_ctx");m(this,"_isDrawing",!1);m(this,"_points",[]);m(this,"_onSelectCallback");m(this,"_resizeObserver");m(this,"_startDrawing",e=>{this._isDrawing=!0,this._points=[];const t=this._canvas.getBoundingClientRect();this._points.push({x:e.clientX-t.left,y:e.clientY-t.top});const n=window.devicePixelRatio||1;this._ctx.clearRect(0,0,this._canvas.width/n,this._canvas.height/n)});m(this,"_draw",e=>{if(!this._isDrawing)return;const t=this._canvas.getBoundingClientRect();this._points.push({x:e.clientX-t.left,y:e.clientY-t.top});const n=window.devicePixelRatio||1;this._ctx.clearRect(0,0,this._canvas.width/n,this._canvas.height/n),this._ctx.beginPath(),this._points.length>0&&this._points[0]&&this._ctx.moveTo(this._points[0].x,this._points[0].y);for(let r=1;r<this._points.length;r++){const o=this._points[r];o&&this._ctx.lineTo(o.x,o.y)}this._ctx.strokeStyle=this._.config.polygonalSelectorStrokeColor||"#ffffff",this._ctx.lineWidth=this._.config.polygonalSelectorLineWidth||2,this._ctx.stroke()});m(this,"_stopDrawing",e=>{var n;if(!this._isDrawing)return;if(this._isDrawing=!1,this._points.length>2){this._ctx.closePath(),this._ctx.stroke();const r=this._points.map(a=>[a.x,a.y]),o=r[0],s=r[r.length-1];o&&s&&(o[0]!==s[0]||o[1]!==s[1])&&r.push(o),(n=this._onSelectCallback)==null||n.call(this,r,e.shiftKey,e.altKey)}const t=window.devicePixelRatio||1;this._ctx.clearRect(0,0,this._canvas.width/t,this._canvas.height/t)});this._=e,this._onSelectCallback=this._.eventManager.onPolygonSelect,this._initializeCanvas(),this._resizeObserver=new ResizeObserver(()=>this._resizeCanvas()),this._resizeObserver.observe(this._.containerElement)}_initializeCanvas(){const e=this._.containerElement;if(!e)return void console.error("Container element is undefined");this._canvas=document.createElement("canvas"),this._canvas.classList.add(wq.polygonalSelect),e.appendChild(this._canvas);const t=this._canvas.getContext("2d");if(!t)return void console.error("Failed to get canvas context");this._ctx=t;const n=window.devicePixelRatio||1;this._canvas.width=e.clientWidth*n,this._canvas.height=e.clientHeight*n,this._canvas.style.width=`${e.clientWidth}px`,this._canvas.style.height=`${e.clientHeight}px`,this._ctx.scale(n,n)}enable(){this._canvas.style.display="block",this._canvas.style.pointerEvents="auto",this._canvas.style.cursor="crosshair",this._canvas.addEventListener("mousedown",this._startDrawing),this._canvas.addEventListener("mousemove",this._draw),this._canvas.addEventListener("mouseup",this._stopDrawing)}disable(){if(this._canvas.style.display="none",this._canvas.style.pointerEvents="none",this._canvas.style.cursor="default",this._canvas.removeEventListener("mousedown",this._startDrawing),this._canvas.removeEventListener("mousemove",this._draw),this._canvas.removeEventListener("mouseup",this._stopDrawing),this._ctx){const e=window.devicePixelRatio||1;this._ctx.clearRect(0,0,this._canvas.width/e,this._canvas.height/e)}}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect(),this.disable(),this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas)}_resizeCanvas(){const{width:e,height:t}=this._.containerElement.getBoundingClientRect(),n=window.devicePixelRatio||1;this._canvas.width=e*n,this._canvas.height=t*n,this._canvas.style.width=`${e}px`,this._canvas.style.height=`${t}px`,this._ctx.scale(n,n)}};const HT=new WeakMap;function Cs(i){return HT.get(i)}function Eq(i,e){HT.set(i,e)}var _r;let GT=(_r=class{constructor(e){m(this,"_id");m(this,"_isActive",!0);m(this,"_client");m(this,"_selection");m(this,"_config");m(this,"_currentData");m(this,"_isArrayColumn",!1);this._config=e,this._client=this._createClient();const t=`${this.fieldsToQuery.join(",")}-${Gy()}`;this._id=e.id?`${e.id}-${t}`:t}static getOrCreateClient(e){if(e.id){const n=_r._clientRegistry.get(e.id);if(n)return n._config=e,n._isArrayColumn=!1,n._currentData&&n._detectArrayColumn(),n}const t=new _r(e);return e.id&&_r._clientRegistry.set(e.id,t),t}get selection(){return this._selection}get tableName(){return this._config.getTableName()}get accessor(){return this._config.getAccessor()}get id(){return this._id}get active(){return this._client.enabled}get currentData(){return this._currentData}get fieldsToQuery(){const e=this._config.includeFields?this._config.includeFields():[];return this._isActive?[...new Set([...this.accessor?[Ci(this.accessor)]:[],...e].filter(Boolean))]:["*"]}setActive(e){this._isActive=e}async getCurrentData(){const e=await this._config.coordinator.query(Qt.from(this.tableName).select(this.fieldsToQuery));return this._currentData=e,this._detectArrayColumn(),e}_detectArrayColumn(){var e;try{const t=this.accessor,n=t?(e=this._currentData)==null?void 0:e.getChild(t):void 0;this._isArrayColumn=!(!n||!(pC(n.type)||n.length>0&&Array.isArray(n.get(0))))}catch{this._isArrayColumn=!1}}applyFilter(e){var t;(t=this.selection)==null||t.update({source:this,predicate:e??null,value:e??null})}applyRangeFilter(e){this.accessor&&this.applyFilter(e?jm(Ci(this.accessor),e):void 0)}applyExactFilter(e){if(e===void 0)return void this.applyFilter(void 0);if(e==="null")return void this.applyFilter(MO(Ci(this.accessor)));const t=this._isArrayColumn?Qc`list_contains(${Ci(this.accessor)}, ${$i(e)})`:BO(Ci(this.accessor),$i(e));this.applyFilter(t)}applyInFilter(e){if(this.accessor)if(e&&e.length>0){const t=(Array.isArray(e)?e:Array.from(e)).map(n=>$i(n));this.applyFilter(Ym(Ci(this.accessor),t))}else this.applyFilter(void 0)}applyLessOrEqFilter(e){this.accessor&&this.applyFilter(e!==void 0?j_(Ci(this.accessor),$i(e)):void 0)}applyGreaterOrEqFilter(e){this.accessor&&this.applyFilter(e!==void 0?Y_(Ci(this.accessor),$i(e)):void 0)}resetFilter(){var e,t;this.selection&&((t=(e=this.selection)==null?void 0:e.clauses)==null?void 0:t.filter(n=>n.source.id===this.id).length)>0&&this.selection.update({source:this,predicate:null,value:null})}update(){this._client.update()}destroy(){this.resetFilter(),this._client.destroy(),this._config.id&&_r._clientRegistry.delete(this._config.id)}regenerateClient(){this.destroy(),this._client=this._createClient()}_createClient(){return this._selection=this._config.getSelection(),PF({coordinator:this._config.coordinator,selection:this.selection,query:e=>{var t;return this._isActive&&((t=this.selection)!=null&&t.clauses.active)?Qt.from(this.tableName).select(this.fieldsToQuery).where(e??[]):null},queryResult:e=>{var n,r;const t=e;this._currentData=t,(r=(n=this._config).onFiltered)==null||r.call(n,t)}})}reset(){this.resetFilter()}},m(_r,"_clientRegistry",new Map),_r),WT=class{constructor(e,t,n){m(this,"_dataUpdatedHandler");m(this,"_dataFilteredHandler");m(this,"_resetSelectionsHandler");m(this,"_internalApi");m(this,"_isValidAccessor",!1);m(this,"_currentData");m(this,"_client");m(this,"_uiComponent");m(this,"_config");m(this,"_targetElement");m(this,"_abortController",new AbortController);m(this,"_readyPromise");m(this,"_isInitialLoad",!0);this._internalApi=Cs(e),this._targetElement=t,this._config=this._mergeWithDefaultConfig(n),this._dataUpdatedHandler=async()=>await this.fetchData(),this._dataFilteredHandler=()=>this.onDataFiltered(),this._resetSelectionsHandler=()=>this._onResetSelections(),this._internalApi.addEventListener("dataUploaded",this._dataUpdatedHandler),this._internalApi.addEventListener("dataFiltered",this._dataFilteredHandler),this._internalApi.addEventListener("resetSelections",this._resetSelectionsHandler),this._readyPromise=this._initialize()}onInitialize(){}onResetClientSelections(){}getCurrentData(){return null}async shouldUpdateComponentData(){return!1}get useLinksData(){return this._config.useLinksData??!1}get pointAccessors(){const{pointIdBy:e,pointIndexBy:t}=this._internalApi.config;return e&&t?[e,t]:[]}get linkAccessors(){const{linkSourceIndexBy:e,linkTargetIndexBy:t}=this._internalApi.config;return e&&t?[e,t]:[]}get selection(){return this.useLinksData?this._internalApi.crossfilter.linksSelection:this._internalApi.crossfilter.pointsSelection}get tableName(){return this.useLinksData?this._internalApi.public.linksTableName:this._internalApi.public.pointsTableName}async _initialize(){await b8([async()=>{await this._internalApi.dbReady();const e=await this._getGlobalDisplayStateSettings(this._config);this._config={...this._config,...e}},async()=>{this._uiComponent=this.createUIComponent(this._targetElement),await this._internalApi.configManager.cosmosInitialized()},()=>this._createClient(),()=>this.fetchData(),()=>this.setConfig(this._config),()=>this.onConfigUpdate(),()=>Promise.resolve(this.onInitialize())],this._abortController)}async _getGlobalDisplayStateSettings(e){await this._internalApi.dbReady();const{componentsDisplayStateMode:t}=this._internalApi.config;let{disableStateMessages:n,noDataMessage:r}=e;return t===!1?n=!0:t==="loading"&&(r=!1),{disableStateMessages:n,noDataMessage:r,loadingMessage:e.loadingMessage}}async setConfig(e){var o;const t=this._config,n=this.accessor;this._config=this._mergeWithDefaultConfig(e),this._config={...this._config,...await this._getGlobalDisplayStateSettings(this._config)};const r=await this.shouldUpdateComponentData();this._config.useLinksData!==t.useLinksData&&((o=this._client)==null||o.regenerateClient()),(r||this._config.useLinksData!==t.useLinksData||this._config.useQuantiles!==t.useQuantiles||this.accessor!==n)&&(await this.fetchData(),this.onResetClientSelections()),await this.onConfigUpdate(t)}async fetchData(){var r,o,s,a,l;const{dbCoordinator:e,dataManager:t}=this._internalApi;if(!e||!this.accessor)return;await t.dataReady(),(o=(r=this._uiComponent)==null?void 0:r.setLoadingState)==null||o.call(r);const n=!this.accessor||await xs(e,this.tableName);if(this._isValidAccessor=!this.accessor||n&&await zf(e,this.tableName,[this.accessor]),this._isInitialLoad||((s=this._client)==null||s.resetFilter()),(a=this._client)==null||a.setActive(this._isValidAccessor),this._isValidAccessor){const c=await this.getCurrentData();this._currentData=c!==null?c:await((l=this._client)==null?void 0:l.getCurrentData())}else this._currentData=void 0;this._isInitialLoad&&(this._isInitialLoad=!1)}ready(){return this._readyPromise}checkReady(e){return!!this._uiComponent||(this.ready().then(e),!1)}async _createClient(){if(await this._internalApi.dbReady(),!this._internalApi.dbCoordinator)return;const e={coordinator:this._internalApi.dbCoordinator,getTableName:()=>this.tableName,getSelection:()=>this.selection,getAccessor:()=>this.accessor,includeFields:()=>this.useLinksData?this.linkAccessors:this.pointAccessors,onFiltered:this._handleSelectionUpdate.bind(this),id:this._config.id||this.constructor.name+this.accessor+Gy()};this._client=GT.getOrCreateClient(e)}_handleSelectionUpdate(e){var n,r,o,s;if(!this.accessor)return;const t=this._internalApi.crossfilter;if(this.useLinksData){const a=t.linksSelection.active;((n=a==null?void 0:a.source)==null?void 0:n.id)===((r=this._client)==null?void 0:r.id)&&t.onLinksFiltered(e)}else{const a=t.pointsSelection.active;((o=a==null?void 0:a.source)==null?void 0:o.id)===((s=this._client)==null?void 0:s.id)&&t.onPointsFiltered(e)}}_onResetSelections(){var e;(e=this._client)==null||e.resetFilter(),this.onResetClientSelections()}_mergeWithDefaultConfig(e){return Ct(this.defaultConfig,e??{})}remove(){var e,t;this._abortController.abort(),(e=this._uiComponent)==null||e.destroy(),this._config.preserveSelectionOnUnmount||((t=this._client)==null||t.resetFilter()),this._internalApi.removeEventListener("dataUploaded",this._dataUpdatedHandler),this._internalApi.removeEventListener("dataFiltered",this._dataFilteredHandler),this._internalApi.removeEventListener("resetSelections",this._resetSelectionsHandler),this._isInitialLoad=!0}};var xn;let Wc=(xn=class extends WT{static isInclusiveComponent(e){return xn._inclusiveComponentIds.has(e)}static register(e){xn._inclusiveComponentIds.add(e)}static unregister(e){xn._inclusiveComponentIds.delete(e)}onInitialize(){var e;(e=this._client)!=null&&e.id&&xn.register(this._client.id)}onDataFiltered(){var a;const{pointsSelection:e,linksSelection:t}=this._internalApi.crossfilter,n=e.active,r=t.active,o=!(n!=null&&n.predicate||e.clauses.length||r!=null&&r.predicate||t.clauses.length),s=l=>{var c,u,h;return(l==null?void 0:l.predicate)!==void 0&&((c=l==null?void 0:l.source)==null?void 0:c.id)===((u=this._client)==null?void 0:u.id)&&!xn.isInclusiveComponent((h=l==null?void 0:l.source)==null?void 0:h.id)};(s(n)||s(r)||o)&&((a=this._client)==null||a.resetFilter(),this.onResetClientSelections()),this.updateCrossfilteredData()}updateCrossfilteredData(){var n,r;const{crossfilter:e}=this._internalApi;if(!this._currentData||!this._isValidAccessor||!this.accessor)return;const t=e.filtered.intersection;if(e.isFilteringActive){const o=this._filterByIdx(this._currentData,t);this.updateHighlightedData(o)}else{const o=(r=(n=this._currentData)==null?void 0:n.getChild(this.accessor))==null?void 0:r.toArray();this.updateHighlightedData(o)}}_filterByIdx(e,t){var h,d;const{config:n}=this._internalApi;if(!this.accessor||!t.size)return[];const r=e.getChild(this.accessor);if(!r)return[];const o=this.useLinksData?n.linkSourceIndexBy:n.pointIndexBy,s=(h=e.getChild(o))==null?void 0:h.toArray();if(!s)return[];const a=this.useLinksData?(d=e.getChild(n.linkTargetIndexBy))==null?void 0:d.toArray():void 0,l=r.toArray(),c=t,u=[];for(let f=0,p=l.length;f<p;++f){const b=s[f];if(c.has(b)||a!==void 0&&c.has(a[f])){const g=l[f];Array.isArray(g)?u.push(...g):u.push(g)}}return u}remove(){var e;(e=this._client)!=null&&e.id&&xn.unregister(this._client.id),super.remove()}},m(xn,"_inclusiveComponentIds",new Set),xn),Cq=class{constructor(e){m(this,"_internalApi");m(this,"_pointSelectionClient");this._internalApi=e;const t={coordinator:this._internalApi.dbCoordinator,getSelection:()=>this._internalApi.crossfilter.pointsSelection,getTableName:()=>this._internalApi.public.pointsTableName,getAccessor:()=>this._internalApi.config.pointIndexBy,onFiltered:n=>this._onPointsFiltered(n),id:"pointsSelectionClient"};this._pointSelectionClient=new GT(t),this._pointSelectionClient.setActive(!0),Wc.register(this._pointSelectionClient.id)}_onPointsFiltered(e){this._internalApi.crossfilter.onPointsFiltered(e)}selectPoints(e){e===void 0?this._pointSelectionClient.resetFilter():this._pointSelectionClient.applyInFilter(e)}get id(){return this._pointSelectionClient.id}destroy(){Wc.unregister(this._pointSelectionClient.id)}};function nc(i,e,t){this.k=i,this.x=e,this.y=t}nc.prototype={constructor:nc,scale:function(i){return i===1?this:new nc(this.k*i,this.x,this.y)},translate:function(i,e){return i===0&e===0?this:new nc(this.k,this.x+this.k*i,this.y+this.k*e)},apply:function(i){return[i[0]*this.k+this.x,i[1]*this.k+this.y]},applyX:function(i){return i*this.k+this.x},applyY:function(i){return i*this.k+this.y},invert:function(i){return[(i[0]-this.x)/this.k,(i[1]-this.y)/this.k]},invertX:function(i){return(i-this.x)/this.k},invertY:function(i){return(i-this.y)/this.k},rescaleX:function(i){return i.copy().domain(i.range().map(this.invertX,this).map(i.invert,i))},rescaleY:function(i){return i.copy().domain(i.range().map(this.invertY,this).map(i.invert,i))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};nc.prototype;const Tq=YT(i=>{const e=jT(i);return t=>t==null?"":typeof t=="number"?e(t):t instanceof Date?Aq(t):`${t}`}),jT=YT(i=>e=>e===0?"0":e.toLocaleString(i));Tq();jT();function Aq(i){return Iq(i,"Invalid Date")}function YT(i){let e=null,t;return(n="en")=>n===e?t:t=i(e=n)}function Iq(i,e){if(i instanceof Date||(i=new Date(+i)),isNaN(+i))return typeof e=="function"?e(i):e;const t=i.getUTCHours(),n=i.getUTCMinutes(),r=i.getUTCSeconds(),o=i.getUTCMilliseconds();return`${kq(i.getUTCFullYear())}-${qr(i.getUTCMonth()+1,2)}-${qr(i.getUTCDate(),2)}${t||n||r||o?`T${qr(t,2)}:${qr(n,2)}${r||o?`:${qr(r,2)}${o?`.${qr(o,3)}`:""}`:""}Z`:""}`}function kq(i){return i<0?`-${qr(-i,6)}`:i>9999?`+${qr(i,6)}`:qr(i,4)}function qr(i,e){return`${i}`.padStart(e,"0")}let Lq=class{constructor(e){m(this,"_id");m(this,"_component");m(this,"_container");m(this,"_isDestroyed",!1);m(this,"_errorMessage");m(this,"_internalApi");m(this,"_marks",[]);this._id=e.id||`mosaic-component-${Gy()}`,this._internalApi=e.internalApi}get id(){return this._id}get errorMessage(){return this._errorMessage}async mount(e,t){if(this._isDestroyed)return this._errorMessage=`Cannot mount component: component ${this._id} has been destroyed`,void ue(`Cannot mount component: component ${this._id} has been destroyed`,"","warn");this._component&&(ue(`Component ${this._id} is already mounted, unmounting first`,"","warn"),await this._unmount()),this._errorMessage=void 0;try{const n=await this._resolveElement(e);if(!n)return this._errorMessage="Component did not resolve to an HTMLElement",void ue(`Skipped mounting ${this._id}: ${this._errorMessage}`,"","warn");const r=n==null?void 0:n.value;if(r&&!await this._validatePlot(r))return this._abortMount(t,this._errorMessage||"Chart references columns not available in dataset");r&&(this._attachErrorInterceptors(r,t),this._connectPlot(r),this._marks=r.marks?[...r.marks]:[]),this._component=e,this._container=t,t.innerHTML="",t.appendChild(n)}catch(n){this._abortMount(t,n instanceof Error?n.message:String(n))}}_abortMount(e,t){this._errorMessage=t,this._marks=[],this._showError(e),ue(`Skipped mounting ${this._id}: ${t}`,"","warn")}async _resolveElement(e){if(e instanceof HTMLElement)return e}async _validatePlot(e){var t,n;if(!this._internalApi.dbCoordinator||!((t=e==null?void 0:e.marks)!=null&&t.length))return!0;for(const r of e.marks){const o=r.sourceTable(),s=(n=r.channels)==null?void 0:n.map(l=>{var c;return(c=l==null?void 0:l.field)==null?void 0:c.column}).filter(l=>typeof l=="string");if(!o||!(s!=null&&s.length))continue;const a=[];if(!await zf(this._internalApi.dbCoordinator,o,s,a))return this._errorMessage=`Missing columns for table "${o}"${a.length?`: ${[...new Set(a)].join(", ")}`:""}`,!1}return!0}_attachErrorInterceptors(e,t){var n,r;if((n=e==null?void 0:e.marks)!=null&&n.length)for(const o of e.marks){if(!o)continue;const s=(r=o.queryError)==null?void 0:r.bind(o);o.queryError=a=>this._handleQueryError(a,e,t)?o:(s==null?void 0:s(a))??o}}_connectPlot(e){var t,n;if((t=e==null?void 0:e.marks)!=null&&t.length&&this._internalApi.dbCoordinator){for(const r of e.marks)if(r&&r.coordinator!==this._internalApi.dbCoordinator)try{(n=r.coordinator)==null||n.disconnect(r),this._internalApi.dbCoordinator.connect(r),r.queryPending()}catch(o){ue(`Failed to connect mark for ${this._id}: ${o}`,"","warn")}}}_handleQueryError(e,t,n){var o;const r=e instanceof Error?e.message:String(e);return!!/no such column|cannot find column/i.test(r)&&(this._errorMessage="Mosaic query failed because required columns are missing.",this._cleanupSelections(),(o=t==null?void 0:t.marks)==null||o.forEach(s=>{var a,l;s&&(s.enabled=!1,(l=(a=s.coordinator)==null?void 0:a.disconnect)==null||l.call(a,s))}),this._component=void 0,this._marks=[],this._showError(n),ue(`Disabled ${this._id} after query error: ${r}`,"","warn"),!0)}_cleanupSelections(){if(!this._marks.length)return;const e=new Set(this._marks.flatMap(t=>{var n;return((n=t==null?void 0:t.plot)==null?void 0:n.interactors)||[]}).filter(t=>(t==null?void 0:t.mark)&&this._marks.includes(t.mark)));e.size&&[this._internalApi.crossfilter.pointsSelection,this._internalApi.crossfilter.linksSelection].filter(Boolean).forEach(t=>{t.clauses.filter(n=>e.has(n==null?void 0:n.source)).forEach(n=>{t.update({source:n.source,predicate:null,value:null})})})}async _unmount(){this._container&&(this._cleanupSelections(),this._container.innerHTML="",this._component=void 0,this._container=void 0,this._errorMessage=void 0,this._marks=[],ue(`Unmounted ${this._id}`,"","ok"))}async destroy(){this._isDestroyed||(await this._unmount(),this._isDestroyed=!0,ue(`Destroyed ${this._id}`,"","ok"))}_showError(e){e&&(e.innerHTML=`
      <div style="padding: 15px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; color: #856404; font-size: 13px;">
        <strong>Chart Error: ${this._id}</strong>
        <p style="margin: 5px 0 0 0;">This chart cannot be displayed. Check configuration, it may reference columns that don't exist in your data.</p>
      </div>
    `)}};typeof Qm=="function"&&Qm({connect:()=>{},disconnect:()=>{}});let Rq=class{constructor(e){m(this,"_internalApi");m(this,"_components",new Map);this._internalApi=e}get components(){return this._components}async addComponent(e,t,n){const r=new Lq({...n,internalApi:this._internalApi});if(this._components.has(r.id)){const o=this._components.get(r.id);ue(`Component with id ${r.id} already exists, replacing it`,"","warn"),await o.destroy()}return await r.mount(e,t),this._components.set(r.id,r),r.errorMessage?ue(`Error adding vgplot component: ${r.id} - ${r.errorMessage}`,"","warn"):ue(`Added vgplot component: ${r.id}`,"","ok"),r}async removeComponent(e){const t=this._components.get(e);return!!t&&(await t.destroy(),this._components.delete(e),!0)}async destroyAll(){const e=Array.from(this._components.values()).map(t=>t.destroy());await Promise.all(e),this._components.clear()}};var Pq=".style_module_cosmograph__8ee622df{--cosmograph-text-color:#fff;-webkit-font-smoothing:antialiased!important;display:flex;height:100%;overflow:hidden;position:relative;text-rendering:optimizeLegibility!important;width:100%}.style_module_popupContainer__8ee622df{height:100%;pointer-events:none;position:absolute;width:100%;z-index:1}.style_module_attribution__8ee622df{bottom:0;color:var(--cosmograph-text-color);cursor:pointer;line-height:0;margin:0 .6rem .6rem 0;opacity:.7;position:absolute;right:0;user-select:none;-webkit-user-select:none;z-index:1}.style_module_message__8ee622df{color:var(--cosmograph-text-color);font-size:14px;font-weight:300;left:50%;max-width:300px;opacity:.6;position:absolute;text-align:center;top:50%;transform:translate(-50%,-50%);z-index:1000}.style_module_messageError__8ee622df{max-width:min(800px,90vw);text-align:left}.style_module_messagePre__8ee622df{white-space:pre-wrap}.style_module_message__8ee622df>br{display:none}@keyframes style_module_spin__8ee622df{to{transform:rotate(1turn)}}@keyframes style_module_fadeIn__8ee622df{0%{opacity:0}to{opacity:1}}.style_module_spinner__8ee622df{animation:style_module_fadeIn__8ee622df .3s ease forwards,style_module_spin__8ee622df 1s linear infinite;border:4px solid hsla(0,0%,100%,.3);border-radius:50%;border-top:4px solid var(--cosmograph-text-color);display:block;height:30px;margin:0 auto;opacity:0;width:30px}",Nn={cosmograph:"style_module_cosmograph__8ee622df",popupContainer:"style_module_popupContainer__8ee622df",attribution:"style_module_attribution__8ee622df",message:"style_module_message__8ee622df",messageError:"style_module_messageError__8ee622df",messagePre:"style_module_messagePre__8ee622df",spinner:"style_module_spinner__8ee622df"};Pr(Pq,{});class EK{constructor(e,t,n){m(this,"_internalApi");m(this,"_eventTarget",new EventTarget);m(this,"_dbReadinessPromise",null);m(this,"_labels");m(this,"_cosmos");m(this,"_cosmosInitialized",!1);m(this,"_dbCoordinator");m(this,"_dataValidator");m(this,"_configManager");m(this,"_dataManager");m(this,"_eventManager");m(this,"_crossfilter");m(this,"_linkAggregationManager");m(this,"_rectangularSelection");m(this,"_polygonalSelection");m(this,"_pointSelectionClient");m(this,"_mosaicComponentManager");m(this,"_containerElement");m(this,"_popupElement");m(this,"_attributionDivElement");m(this,"_cosmosElement");m(this,"_messageDivElement");m(this,"_focusedPointIndex");m(this,"_enableSimulation",!0);m(this,"_pointsHaveLayout",!1);m(this,"_isDestroyed",!1);m(this,"_summary",{});m(this,"_stats",{pointsCount:0,linksCount:0,pointsSummary:void 0,linksSummary:void 0});m(this,"_initializeLabels",()=>{this._labels&&this._labels.destroy();const e=this._cosmosElement.querySelector("canvas");e&&(this._labels=new gq(this._internalApi,e))});m(this,"_initializeClients",async()=>{this._pointSelectionClient=new Cq(this._internalApi),this._mosaicComponentManager=new Rq(this._internalApi)});m(this,"_dropLocalTables",async e=>{var t,n;this._dbCoordinator&&(e||await((t=this._dbCoordinator.internalDB)==null?void 0:t.dropTable(De.Points)),await((n=this._dbCoordinator.internalDB)==null?void 0:n.dropTable(De.Links)))});window.cosmographDisableLogging=t.disableLogging??!1,this._containerElement=e,this._internalApi=this._initializeInternalApi(this),Eq(this,this._internalApi),ue("Initialization..."),this._initializeDB(n),this._dataValidator=new oq(this._internalApi),this._eventManager=new sq(this._internalApi),this._linkAggregationManager=new lq(this._internalApi),this._configManager=new iq(this._internalApi),this._dataManager=new rq(this._internalApi),this._crossfilter=new nq(this._internalApi),this._rectangularSelection=new vq(this._internalApi),this._polygonalSelection=new Sq(this._internalApi),t.statusIndicatorMode!==void 0&&(this._configManager.config.statusIndicatorMode=t.statusIndicatorMode),this._initializeHTMLElements(),this.setConfig(t)}_initializeInternalApi(e){return{get public(){return e},get labels(){return e._labels},get cosmos(){return e._cosmos},get summary(){return e._summary},get eventManager(){return e._eventManager},get configManager(){return e._configManager},get dataManager(){return e._dataManager},get dataValidator(){return e._dataValidator},get linkAggregationManager(){return e._linkAggregationManager},get rectangularSelection(){return e._rectangularSelection},get polygonalSelection(){return e._polygonalSelection},get crossfilter(){return e._crossfilter},get selectionClient(){return e._pointSelectionClient},get dbCoordinator(){return e._dbCoordinator},get containerElement(){return e._containerElement},get cosmosElement(){return e._cosmosElement},get popupElement(){return e._popupElement},get config(){return e._configManager.config},get cosmosInitialized(){return e._cosmosInitialized},get pointsHaveLayout(){return e._pointsHaveLayout},dropLocalTables:async t=>await e._dropLocalTables(t),updateMessage:t=>e._updateMessage(t),initializeLabels:()=>e._initializeLabels(),initializeCosmos:()=>e._initializeCosmos(),updateStats:()=>e._updateStats(),updateSummary:async()=>e._updateSummary(),dbReady:async()=>e._dbReady(),addEventListener:(t,n)=>{e._eventTarget.addEventListener(t,n,{passive:!0})},removeEventListener:(t,n)=>{e._eventTarget.removeEventListener(t,n,{passive:!0})},dispatchEvent:t=>e._eventTarget.dispatchEvent(t)}}_initializeDB(e){this._dbReadinessPromise=iU.create(e).then(async t=>{if(this._ensureAlive())if(this._dbCoordinator=t,t)this._updateMessage(" Cosmograph is ready, load your data!",!0),await this._initializeClients();else{const n=e?" Couldn't create coordinator for specified DuckDB connection. Please check your external DuckDB instance configuration and try to initialize Cosmograph again.":" Failed to fetch DuckDB-Wasm bundles. Please try to initialize Cosmograph again.";this._updateMessage(n)}else this.destroy()}).catch(t=>{throw this._isDestroyed||ue("Database initialization error",t,"error"),t})}_initializeHTMLElements(){var e,t;this._containerElement.classList.add(Nn.cosmograph),(e=this._containerElement)==null||e.style.setProperty("--cosmograph-text-color","#ffffff"),this._popupElement=document.createElement("div"),this._popupElement.classList.add(Nn.popupContainer),this._cosmosElement=document.createElement("div"),this._cosmosElement.style.width="100%",this._cosmosElement.style.height="100%",(t=this._cosmosElement)==null||t.style.setProperty("backgroundColor",fb),this._containerElement.appendChild(this._cosmosElement),this._containerElement.appendChild(this._popupElement),this._addAttribution(),this._addMessageElement()}_addAttribution(){var t;this._attributionDivElement=document.createElement("div"),this._attributionDivElement.classList.add(Nn.attribution),this._attributionDivElement.onclick=()=>{var n;return(n=window.open("https://cosmograph.app/","_blank"))==null?void 0:n.focus()};const e=new DOMParser().parseFromString(_q,"image/svg+xml").firstChild;(t=this._attributionDivElement)==null||t.appendChild(e),this._containerElement.appendChild(this._attributionDivElement)}_addMessageElement(){this._messageDivElement=document.createElement("div"),this._messageDivElement.classList.add(Nn.message),this._containerElement.appendChild(this._messageDivElement),this._updateMessage(" Initializing Cosmograph...")}async _initializeCosmos(){const{_config:e}=this;this._cosmos&&(this._cosmos.destroy(),this._cosmosInitialized=!1),this._pointsHaveLayout=await DY(this._dbCoordinator,this.pointsTableName,e),this._enableSimulation=e.enableSimulation??(!!e.links||!this._pointsHaveLayout),this._configManager.cosmosConfig.enableSimulation=this._enableSimulation,this._cosmos=new YM(this._cosmosElement,this._configManager.cosmosConfig),this._cosmosInitialized=!0}_ensureAlive(){return!this._isDestroyed&&!!this._containerElement.isConnected}_updateMessage(e,t){if(!this._messageDivElement)return;const n=this._configManager.config.statusIndicatorMode??"spinner";if(n===!1||n==="spinner"&&t||e===null)this._messageDivElement.style.display="none";else if(this._messageDivElement.style.display="block",n==="spinner"){const r=e.startsWith("");if(this._messageDivElement.classList.toggle(Nn.messageError,r),r){if(this._messageDivElement.innerText!==e||this._messageDivElement.querySelector(`.${Nn.spinner}`)){this._messageDivElement.innerHTML="";const o=document.createElement("div");o.classList.add(Nn.messagePre),o.innerText=e,this._messageDivElement.appendChild(o)}}else if(!this._messageDivElement.querySelector(`.${Nn.spinner}`)){this._messageDivElement.innerHTML="";const o=document.createElement("div");o.classList.add(Nn.spinner),this._messageDivElement.appendChild(o)}}else this._messageDivElement.classList.remove(Nn.messageError),(this._messageDivElement.textContent!==e||this._messageDivElement.querySelector(`.${Nn.spinner}`))&&(this._messageDivElement.innerHTML="",this._messageDivElement.innerText=e)}async _updateSummary(){this._dbCoordinator&&(this._summary={pointsSummary:await V1(this._dbCoordinator,this.pointsTableName),linksSummary:this._config.links?await V1(this._dbCoordinator,this.linksTableName):void 0})}_updateStats(){var n,r;const{pointsSummary:e,linksSummary:t}=this._summary;this._stats={pointsCount:((n=this._cosmos)==null?void 0:n.graph.pointsNumber)??0,linksCount:((r=this._cosmos)==null?void 0:r.graph.linksNumber)??0,pointsSummary:e,linksSummary:t}}async _dbReady(){return this._dbReadinessPromise?await this._dbReadinessPromise:new Promise((e,t)=>{const n=setTimeout(()=>{t(new Error("Cosmograph: Database initialization timeout"))},3e4),r=()=>{this._dbReadinessPromise?(clearTimeout(n),this._dbReadinessPromise.then(e).catch(t)):setTimeout(r,10)};r()})}async dataUploaded(){return await this._dataManager.dataReady()}get _config(){return this._configManager.config}get stats(){return this._stats}get crossfilter(){return this._crossfilter.filtered}get maxPointSize(){var e;return((e=this._cosmos)==null?void 0:e.maxPointSize)??0}get progress(){var e;return(e=this._cosmos)==null?void 0:e.progress}get isSimulationRunning(){var e;return(e=this._cosmos)==null?void 0:e.isSimulationRunning}get isSimulationAvailable(){return this._enableSimulation}get pointDegrees(){var e;return(e=this._cosmos)==null?void 0:e.graph.degree}get pointDirections(){var e,t;return(t=(e=this._cosmos)==null?void 0:e.graph.inDegree)==null?void 0:t.map((n,r)=>{var l,c;const o=(c=(l=this._cosmos)==null?void 0:l.graph.outDegree)==null?void 0:c[r],s=n!==null&&n!==0,a=o!==null&&o!==0;return s&&a?1:a?0:s?2:3})}get rescaleXFn(){var e;return(e=this._cosmos)==null?void 0:e.getScaleX()}get rescaleYFn(){var e;return(e=this._cosmos)==null?void 0:e.getScaleY()}get focusedPointIndex(){return this._config.focusedPointIndex??this._focusedPointIndex}get clusterMapping(){return this._configManager.clusterMapping}get activePointColorStrategy(){return this._configManager.activePointColorStrategy}get activePointSizeStrategy(){return this._configManager.activePointSizeStrategy}get activeLinkColorStrategy(){return this._configManager.activeLinkColorStrategy}get activeLinkWidthStrategy(){return this._configManager.activeLinkWidthStrategy}get linksTableName(){var e;return(e=this._dbCoordinator)!=null&&e.internalDB||typeof this._config.links!="string"?De.Links:this._config.links}get pointsTableName(){var e;return(e=this._dbCoordinator)!=null&&e.internalDB||typeof this._config.points!="string"?De.Points:this._config.points}async getConfig(){return await this._configManager.configUpdated(),this._configManager.config}async getActivePointColorFn(){return await this._configManager.configUpdated(),this._configManager.activePointColorFn}async getActivePointSizeFn(){return await this._configManager.configUpdated(),this._configManager.activePointSizeFn}async getActiveLinkColorFn(){return await this._configManager.configUpdated(),this._configManager.activeLinkColorFn}async getActiveLinkWidthFn(){return await this._configManager.configUpdated(),this._configManager.activeLinkWidthFn}setConfig(e){return this._configManager.setConfig(e),this._configManager.configUpdated()}captureScreenshot(e="cosmograph-screenshot.png"){var r;const t=(r=this._cosmosElement)==null?void 0:r.querySelector("canvas");if(!t)return;const n=document.createElement("a");n.download=e,n.href=t.toDataURL("image/png"),n.click()}getPointPositions(){var e;return(e=this._cosmos)==null?void 0:e.getPointPositions()}getClusterPositions(){var e;return(e=this._cosmos)==null?void 0:e.getClusterPositions()}getPointColors(){var e,t;return(t=(e=this._cosmos)==null?void 0:e.getPointColors)==null?void 0:t.call(e)}getPointSizes(){var e,t;return(t=(e=this._cosmos)==null?void 0:e.getPointSizes)==null?void 0:t.call(e)}getLinkColors(){var e,t;return(t=(e=this._cosmos)==null?void 0:e.getLinkColors)==null?void 0:t.call(e)}getLinkWidths(){var e,t;return(t=(e=this._cosmos)==null?void 0:e.getLinkWidths)==null?void 0:t.call(e)}setPointShapes(e){var t;(t=this._cosmos)==null||t.setPointShapes(new Float32Array(e))}setPointImageIndices(e){var t;(t=this._cosmos)==null||t.setPointImageIndices(new Float32Array(e))}setPointImageSizes(e){var t;(t=this._cosmos)==null||t.setPointImageSizes(new Float32Array(e))}setImageData(e){var t;(t=this._cosmos)==null||t.setImageData([e])}getPointPositionByIndex(e){var o;const t=(o=this._cosmos)==null?void 0:o.getPointPositions();if(!t||!t.length)return;const n=t[2*e],r=t[2*e+1];return n==null||r==null?void 0:[n,r]}activateRectSelection(){this._rectangularSelection.enable(),this._polygonalSelection.disable()}deactivateRectSelection(){this._rectangularSelection.disable()}activatePolygonalSelection(){this._polygonalSelection.enable(),this._rectangularSelection.disable()}deactivatePolygonalSelection(){this._polygonalSelection.disable()}getSelectedPointIndices(){var e;return((e=this._cosmos)==null?void 0:e.getSelectedIndices())??void 0}getSelectedLinkIndices(){var o,s;const e=(o=this._cosmos)==null?void 0:o.getSelectedIndices();if(!e||e.length===0)return;const t=(s=this._cosmos)==null?void 0:s.graph.sourceIndexToTargetIndices;if(!t)return;const n=new Set(e),r=new Set;for(let a=0;a<e.length;a++){const l=t[e[a]];if(l)for(let c=0;c<l.length;c++){const[u,h]=l[c];n.has(u)&&r.add(h)}}return r.size?Array.from(r):void 0}selectPointsInRect(e,t=!1){if(!this._cosmos||!e)return;const n=this._cosmos.getPointsInRect(e);this.selectPoints(Array.from(n),t)}selectPointsInPolygon(e,t=!1){if(!this._cosmos||!e.length)return;const n=this._cosmos.getPointsInPolygon(e);this.selectPoints(Array.from(n),t)}unselectPointsInRect(e){if(!this._cosmos||!e)return;const t=this._cosmos.getPointsInRect(e);this.unselectPointsByIndices(Array.from(t))}unselectPointsInPolygon(e){if(!this._cosmos||!e.length)return;const t=this._cosmos.getPointsInPolygon(e);this.unselectPointsByIndices(Array.from(t))}selectPoints(e,t=!1){var n,r;this._cosmos&&(e!=null&&e.length?(t&&(e=[...this._cosmos.getSelectedIndices()||[],...e]),(n=this._pointSelectionClient)==null||n.selectPoints(e)):(r=this._pointSelectionClient)==null||r.selectPoints(void 0))}selectPoint(e,t=!1,n=this._config.selectPointOnClick===!0){var r,o;if(this._cosmos&&(e!==void 0||!t))if(e!==void 0){let s=[e];if(t&&(s=[...this._cosmos.getSelectedIndices()||[],e]),n){const a=this._cosmos.getAdjacentIndices(e);s=[...s,...a]}(r=this._pointSelectionClient)==null||r.selectPoints(s)}else this._config.resetSelectionOnEmptyCanvasClick&&((o=this._pointSelectionClient)==null||o.selectPoints(void 0))}unselectPoint(e,t=this._config.selectPointOnClick===!0){var o;if(!this._cosmos||e===void 0)return;const n=this._cosmos.getSelectedIndices()||[];if(n.length===0||!n.includes(e))return;let r=n.filter(s=>s!==e);if(t){const s=this._cosmos.getAdjacentIndices(e);r=r.filter(a=>!s.includes(a))}this._focusedPointIndex&&!r.includes(this._focusedPointIndex)&&this.setFocusedPoint(void 0),(o=this._pointSelectionClient)==null||o.selectPoints(r.length?r:void 0)}unselectPointsByIndices(e){var r;if(!this._cosmos)return;const t=this._cosmos.getSelectedIndices()||[];if(t.length===0)return;const n=t.filter(o=>!e.includes(o));this._focusedPointIndex&&!n.includes(this._focusedPointIndex)&&this.setFocusedPoint(void 0),(r=this._pointSelectionClient)==null||r.selectPoints(n.length?n:void 0)}unselectAllPoints(){var e;this._cosmos&&(this.focusedPointIndex&&this.setFocusedPoint(void 0),(e=this._pointSelectionClient)==null||e.selectPoints(void 0),this._internalApi.dispatchEvent(new CustomEvent("resetSelections")))}setFocusedPoint(e){var t,n;this._focusedPointIndex=this._config.focusedPointIndex??e,this._cosmos&&!this._config.focusedPointIndex&&((t=this._cosmos)==null||t.setConfig({focusedPointIndex:this._focusedPointIndex}),(n=this._labels)==null||n.render())}setPinnedPoints(e){var t;(t=this._cosmos)==null||t.setPinnedPoints(e)}start(e){var t;this._enableSimulation!==!1&&this._cosmos&&((t=this._cosmos)==null||t.start(e),this._internalApi.dispatchEvent(new CustomEvent("onSimulationStart")))}pause(){var e;this._enableSimulation!==!1&&this._cosmos&&((e=this._cosmos)==null||e.pause(),this._internalApi.dispatchEvent(new CustomEvent("onSimulationPause")))}unpause(){var e;this._enableSimulation!==!1&&this._cosmos&&((e=this._cosmos)==null||e.unpause(),this._internalApi.dispatchEvent(new CustomEvent("onSimulationStart")))}restart(){this.unpause()}stop(){var e;this._enableSimulation!==!1&&this._cosmos&&((e=this._cosmos)==null||e.stop(),this._internalApi.dispatchEvent(new CustomEvent("onSimulationPause")))}step(){var e;(e=this._cosmos)==null||e.step()}setZoomLevel(e,t=0){var n;(n=this._cosmos)==null||n.setZoomLevel(e,t)}getZoomLevel(){var e;return(e=this._cosmos)==null?void 0:e.getZoomLevel()}zoomToPoint(e,t=this._config.fitViewDuration,n,r){var o;(o=this._cosmos)==null||o.zoomToPointByIndex(e,t,n,r)}fitView(e=this._config.fitViewDuration,t=this._config.fitViewPadding){var n;(n=this._cosmos)==null||n.fitView(e,t)}fitViewByIndices(e,t=this._config.fitViewDuration,n=this._config.fitViewPadding){var r;(r=this._cosmos)==null||r.fitViewByPointIndices(e,t,n)}fitViewByCoordinates(e,t=this._config.fitViewDuration,n=this._config.fitViewPadding){var r;(r=this._cosmos)==null||r.fitViewByPointPositions(e,t,n)}getConnectedPointIndices(e){var t;return(t=this._cosmos)==null?void 0:t.getAdjacentIndices(e)}getPointDegrees(e){var t,n;if(this._cosmos)return{inDegree:((t=this._cosmos.graph.inDegree)==null?void 0:t[e])??0,outDegree:((n=this._cosmos.graph.outDegree)==null?void 0:n[e])??0}}spaceToScreenPosition(e){var t;return(t=this._cosmos)==null?void 0:t.spaceToScreenPosition(e)}screenToSpacePosition(e){var t;return(t=this._cosmos)==null?void 0:t.spaceToScreenPosition(e)}spaceToScreenRadius(e){var t;return(t=this._cosmos)==null?void 0:t.spaceToScreenRadius(e)}getPointRadiusByIndex(e){var t;return(t=this._cosmos)==null?void 0:t.getPointRadiusByIndex(e)}getPointScreenRadiusByIndex(e){var l,c;const t=((l=this._cosmos)==null?void 0:l.config.pointSizeScale)??1,n=(c=this._cosmos)==null?void 0:c.getPointRadiusByIndex(e);if(!n)return 0;const r=n*t,{scalePointsOnZoom:o}=this._config,s=this.getZoomLevel(),a=this.maxPointSize;return o?Math.min(r*s,a):r}trackPointPositionsByIndices(e){var t;(t=this._cosmos)==null||t.trackPointPositionsByIndices(e)}getTrackedPointPositionsArray(){var e,t;return(t=(e=this._cosmos)==null?void 0:e.getTrackedPointPositionsArray)==null?void 0:t.call(e)}getTrackedPointPositionsMap(){var e,t;return(t=(e=this._cosmos)==null?void 0:e.getTrackedPointPositionsMap)==null?void 0:t.call(e)}getSampledPoints(){var e,t;return(t=(e=this._cosmos)==null?void 0:e.getSampledPoints)==null?void 0:t.call(e)}getSampledPointPositionsMap(){var e;if(this._cosmosInitialized)return(e=this._cosmos)==null?void 0:e.getSampledPointPositionsMap()}getActiveSelectionSourceId(){const e=this._crossfilter.pointsSelection.active,t=e==null?void 0:e.source;return t==null?void 0:t.id}get pointsSelection(){return this._crossfilter.pointsSelection}get linksSelection(){return this._crossfilter.linksSelection}async getPointIndicesByIds(e){if(this._dbCoordinator&&this.stats.pointsCount&&e.length)return await Jd(this._dbCoordinator,this.pointsTableName,this._config,e)}async getPointIdsByIndices(e){if(this._dbCoordinator&&this.stats.pointsCount&&e.length)return await NT(this._dbCoordinator,this.pointsTableName,this._config,e)}async getPointsByIndices(e){if(this._dbCoordinator&&this.stats.pointsCount&&e.length)return await LY(this._dbCoordinator,this.pointsTableName,this._config.pointIndexBy,e)}async getPointIndicesByExactValues(e,t){if(this._dbCoordinator&&this.stats.pointsCount)return t.length?await RY(this._dbCoordinator,this.pointsTableName,this._config,e,t):[]}async getPointIndicesByNumericValue(e,t,n){if(this._dbCoordinator&&this.stats.pointsCount)return t?await PY(this._dbCoordinator,this.pointsTableName,this._config,e,t,n):[]}async getPointIndicesByLinksExactValues(e,t){if(this._dbCoordinator&&this.stats.linksCount)return t.length?await UY(this._dbCoordinator,this.linksTableName,this._config,e,t):[]}async getPointIndicesByLinksNumericValue(e,t,n){if(this._dbCoordinator&&this.stats.linksCount)return t?await $Y(this._dbCoordinator,this.linksTableName,this._config,e,t,n):[]}async getLinksByPointIds(e){if(this._dbCoordinator&&this.stats.linksCount&&e.length)return await VY(this._dbCoordinator,this.pointsTableName,this._config,e)}async getLinksByPointIndices(e){if(this._dbCoordinator&&this.stats.linksCount&&e.length)return await HY(this._dbCoordinator,this.pointsTableName,this._config,e)}async getLinksData(){if(this._dbCoordinator&&this.stats.linksCount)return await OT(this._dbCoordinator,this.linksTableName)}async getPointsData(){if(this._dbCoordinator&&this.stats.pointsCount)return await MT(this._dbCoordinator,this.pointsTableName)}convertCosmographDataToObject(e){return fC(e)}flattenPositions(e){var t;return(t=this._cosmos)==null?void 0:t.flatten(e)}pair(e){var t;return(t=this._cosmos)==null?void 0:t.pair(e)}async addPoints(e){await this._dataManager.addPoints(e)}async addLinks(e){await this._dataManager.addLinks(e)}async removePointsByIndices(e,t=!0){await this._dataManager.removePointsByIndices(e,t)}async removePointsByIds(e){await this._dataManager.removePointsByIds(e)}async removeLinksByPointIdPairs(e){await this._dataManager.removeLinksByPointIdPairs(e)}async removeLinksByPointIndicesPairs(e){await this._dataManager.removeLinksByPointIndicesPairs(e)}async addMosaicComponent(e,t,n){if(await this._dataManager.dataReady(),this._ensureAlive()){if(this._mosaicComponentManager)return await this._mosaicComponentManager.addComponent(e,t,n);ue("Mosaic component manager not initialized","","error")}}async removeMosaicComponent(e){return this._mosaicComponentManager?await this._mosaicComponentManager.removeComponent(e):(ue("Mosaic component manager not initialized","","error"),!1)}getMosaicComponents(){var e;return(e=this._mosaicComponentManager)==null?void 0:e.components}async reset(e=!0){var t,n,r,o,s;e&&(this._configManager.resetCosmographConfig(),this._messageDivElement.innerText=" Cosmograph is ready, load your data!",this._messageDivElement.style.display="block"),(t=this._labels)==null||t.clear(),this._configManager.clearCosmosBuffers(),(n=this._cosmos)==null||n.render(),await this._dropLocalTables(),(r=this._dbCoordinator)==null||r.clearCache(),this._linkAggregationManager.clear(),this._stats={pointsCount:0,linksCount:0,pointsSummary:void 0,linksSummary:void 0},await((o=this._mosaicComponentManager)==null?void 0:o.destroyAll()),(s=this._pointSelectionClient)==null||s.destroy(),this._pointSelectionClient=void 0,this._internalApi.dispatchEvent(new CustomEvent("reset")),this._internalApi.dispatchEvent(new CustomEvent("dataUploaded"))}async destroy(){var e,t,n,r,o;ue("Destroying Cosmograph instance","","warn"),this._isDestroyed?ue("Instance already destroyed","","warn"):(this._isDestroyed=!0,this._internalApi.dispatchEvent(new CustomEvent("reset")),(e=this._labels)==null||e.destroy(),(t=this._cosmos)==null||t.destroy(),this._cosmos=void 0,await this._dropLocalTables(),await((n=this._dbCoordinator)==null?void 0:n.destroy()),this._dbCoordinator=void 0,this._linkAggregationManager.clear(),this._containerElement.innerHTML="",this._rectangularSelection.destroy(),this._polygonalSelection.destroy(),await((r=this._mosaicComponentManager)==null?void 0:r.destroyAll()),this._mosaicComponentManager=void 0,(o=this._pointSelectionClient)==null||o.destroy(),this._pointSelectionClient=void 0,delete window.cosmographDisableLogging)}}const qT=Hy(),XT=async(i,e)=>{const t=await i.query(`DESCRIBE ${e}`);return new Map((t==null?void 0:t.toArray().map(n=>[n.column_name,n.column_type]))??[])},ef=(i,e)=>({existing:[...new Set(i.filter(t=>e.has(t.name)).map(t=>t.name))],missing:i.filter(t=>!e.has(t.name))}),Dq=async(i,e)=>{var f,p,b,g;const t=await XT(i,De.RawPoints),{missing:n}=ef((_=>{const{pointIdBy:T,linkSourceBy:E,linkTargetsBy:y}=_;return T?[{prop:"pointIdBy",name:T}]:E&&y?[{prop:"linkSourceBy",name:E},...y.map(C=>({prop:"linkTargetBy",name:C}))]:[{prop:"pointIdBy",name:T??"undefined"}]})(e),t);if(n.length>0)return{missingRequiredColumns:n,missingOptionalColumns:[],processedFully:!0,pointsAdded:!1};const{existing:r,missing:o}=ef((_=>{const{pointSizeBy:T,pointColorBy:E,pointClusterBy:y,pointClusterStrengthBy:C,pointLabelBy:I,pointLabelWeightBy:F,pointXBy:V,pointYBy:q,pointIncludeColumns:Q=[]}=_;return[...T?[{prop:"pointSizeBy",name:T}]:[],...E?[{prop:"pointColorBy",name:E}]:[],...y?[{prop:"pointClusterBy",name:y}]:[],...C?[{prop:"pointClusterStrengthBy",name:C}]:[],...I?[{prop:"pointLabelBy",name:I}]:[],...F?[{prop:"pointLabelWeightBy",name:F}]:[],...[...new Set(Q)].map(M=>({prop:"pointIncludeColumns",name:M})),...V&&q?[{prop:"pointXBy",name:V},{prop:"pointYBy",name:q}]:[]]})(e),t),s=r.filter(_=>_!==le.Id);if(await i.exec(`
    BEGIN;
    DROP SEQUENCE IF EXISTS ${le.Sequence} CASCADE;
    CREATE SEQUENCE ${le.Sequence} MINVALUE 0;
    CREATE TABLE ${De.PreparedPoints} (
      ${le.Id} VARCHAR,
      ${le.Idx} INT DEFAULT nextval('${le.Sequence}')
    );
    COMMIT;
  `),s.length>0){const _=s.map(T=>`ALTER TABLE ${De.PreparedPoints} ADD COLUMN IF NOT EXISTS "${T}" ${t.get(T)};`).join(`
`);await i.exec(_)}const{pointIdBy:a,linkSourceBy:l,linkTargetsBy:c}=e,u=l&&c?[l,...c]:[a],h=(p=(f=await i.query(`SELECT COUNT(*) as cnt FROM ${De.RawPoints}`))==null?void 0:f.getChild("cnt"))==null?void 0:p.get(0);let d=!0;if(u.length===1&&h>25e4)try{await(async(T,E,y,C)=>{let F=0;for(;F<C;)await T.exec(`
      CREATE TEMP TABLE chunk_temp AS 
      SELECT "${E}" AS ${le.Id}, ${y.map(V=>`"${V}"`).join(", ")}
      FROM ${De.RawPoints}
      WHERE "${E}" IS NOT NULL
      LIMIT 250000
    `),await T.exec(`INSERT INTO ${De.PreparedPoints} (${[`"${le.Id}"`,...y.map(V=>`"${V}"`)].join(", ")}) SELECT * FROM chunk_temp`),await T.exec(`DELETE FROM ${De.RawPoints} WHERE "${E}" IN (SELECT ${le.Id} FROM chunk_temp)`),await T.exec("DROP TABLE chunk_temp"),F+=25e4})(i,u[0],s,h),((g=(b=await i.query(`SELECT COUNT(*) as cnt FROM ${De.RawPoints}`))==null?void 0:b.getChild("cnt"))==null?void 0:g.get(0))>0&&(d=!1)}catch(_){console.warn("processLargeDatasetInChunks failed:",_),d=!1}else{const _=`
      INSERT INTO ${De.PreparedPoints} (${[le.Id,...s].map(T=>`"${T}"`).join(", ")})
      SELECT DISTINCT ON (${le.Id}) combined_points.*
      FROM (
        ${u.map(T=>`
          SELECT "${T}" AS ${le.Id}${s.length>0?`, ${s.map(E=>`"${E}"`).join(", ")}`:""}
          FROM ${De.RawPoints}
          WHERE "${T}" IS NOT NULL
        `).join(" UNION ALL ")}
      ) AS combined_points
    `;await i.exec(_)}return qT&&await i.logTable(De.PreparedPoints),{missingRequiredColumns:[],missingOptionalColumns:o,processedFully:d,pointsAdded:!1}},Mq=async(i,e)=>{var E;const{linkSourceBy:t=le.Source,linkTargetsBy:n=[le.Target],linkIncludeColumns:r=[],linkColorBy:o,linkWidthBy:s,linkArrowBy:a,linkStrengthBy:l}=e;if(!(n!=null&&n.length))return{missingRequiredColumns:[],missingOptionalColumns:[],processedFully:!0,pointsAdded:!1};const c=await XT(i,De.RawLinks),u=[{prop:"linkSourceBy",name:t},...n.map(y=>({prop:"linkTargetsBy",name:y}))],{missing:h}=ef(u,c);if(h.length>0)return{missingRequiredColumns:h,missingOptionalColumns:[],processedFully:!0,pointsAdded:!1};const d=[...o?[{prop:"linkColorBy",name:o}]:[],...s?[{prop:"linkWidthBy",name:s}]:[],...a?[{prop:"linkArrowBy",name:a}]:[],...l?[{prop:"linkStrengthBy",name:l}]:[],...r.map(y=>({prop:"linkIncludeColumns",name:y}))],{existing:f,missing:p}=ef(d,c),b=[le.SourceIdx,le.TargetIdx,le.Source,le.Target],g=f.filter(y=>!b.includes(y));if(await i.exec(`
    CREATE TABLE IF NOT EXISTS ${De.PreparedLinks} (
      ${le.SourceIdx} INTEGER,
      ${le.TargetIdx} INTEGER,
      ${le.Source} VARCHAR,
      ${le.Target} VARCHAR
    );
  `.trim()),g.length>0){const y=g.map(C=>`ALTER TABLE ${De.PreparedLinks} ADD COLUMN IF NOT EXISTS "${C}" ${c.get(C)||"VARCHAR"};`).join(`
`);await i.exec(y)}await i.exec(`
    CREATE TEMP TABLE temp_points AS
    SELECT ${le.Id}, ${le.Idx}
    FROM ${De.PreparedPoints}
  `.trim());let _=!1;if(e.createMissingPoints){const y=[t,...n].map(F=>`
    SELECT DISTINCT "${F}"::text as ${le.Id}
    FROM ${De.RawLinks}
    WHERE "${F}" IS NOT NULL
  `).join(" UNION "),C=await i.query(`
    SELECT COUNT(*) as cnt
    FROM (${y}) all_ids
    WHERE ${le.Id} NOT IN (SELECT ${le.Id} FROM temp_points)
  `.trim()),I=((E=C==null?void 0:C.getChild("cnt"))==null?void 0:E.get(0))||0;_=I>0,I>0&&(await i.exec(`
      CREATE TEMP TABLE missing_ids AS
      SELECT DISTINCT ${le.Id}
      FROM (${y}) all_ids
      WHERE ${le.Id} NOT IN (SELECT ${le.Id} FROM temp_points)
    `.trim()),await i.exec(`
      CREATE TEMP TABLE missing_ids_with_idx AS
      SELECT ${le.Id},
             ROW_NUMBER() OVER (ORDER BY ${le.Id}) + (SELECT COALESCE(MAX(${le.Idx}), 0) FROM ${De.PreparedPoints}) as ${le.Idx}
      FROM missing_ids
    `.trim()),await i.exec(`
      INSERT INTO ${De.PreparedPoints} (${le.Id}, ${le.Idx})
      SELECT ${le.Id}, ${le.Idx} FROM missing_ids_with_idx
    `.trim()),await i.exec("DROP TABLE temp_points"),await i.exec(`
      CREATE TEMP TABLE temp_points AS
      SELECT ${le.Id}, ${le.Idx}
      FROM ${De.PreparedPoints}
    `.trim()),await i.exec("DROP TABLE missing_ids"),await i.exec("DROP TABLE missing_ids_with_idx"))}const T=[le.SourceIdx,le.TargetIdx,le.Source,le.Target,...g];for(const y of n){const C=`
      INSERT INTO ${De.PreparedLinks} (${T.map(I=>`"${I}"`).join(", ")})
      SELECT DISTINCT
        sp.${le.Idx} AS ${le.SourceIdx},
        tp.${le.Idx} AS ${le.TargetIdx},
        d."${t}" AS ${le.Source},
        d."${y}" AS ${le.Target}
        ${g.length>0?`, ${g.map(I=>`d."${I}"`).join(", ")}`:""}
      FROM ${De.RawLinks} d
      INNER JOIN temp_points sp ON sp.${le.Id} = d."${t}"::text
      INNER JOIN temp_points tp ON tp.${le.Id} = d."${y}"::text
    `;await i.exec(C.trim())}return await i.exec("DROP TABLE temp_points"),qT&&await(i==null?void 0:i.logTable(De.PreparedLinks)),{missingRequiredColumns:[],missingOptionalColumns:p,processedFully:!0,pointsAdded:_}};let gi,th=null;const KT=async(i,e,t=!1)=>{switch(i){case mi.Parquet:return await gi.exportTableToPq(e)??new Uint8Array;case mi.Arrow:return t?await gi.exportTableToArrow(e)??new mt:await gi.exportTableToArrowBuffer(e)??new Uint8Array;case mi.CSV:return await gi.exportTableToCSV(e)??new Uint8Array;default:throw new Error(`Unsupported format: ${i}`)}},Z1=async(i,e,t,n,r,o,s,a=!1)=>{const{ok:l,processedFully:c,pointsAdded:u}=await(async(f,p,b,g)=>{try{let _;if(_=Array.isArray(f)?await gi.uploadObject(f,p):await gi.uploadData(f,p,!1,g.csvParseTimeFormat,g.csvColumnTypesMap),_==null?void 0:_.error)return ue(`Failed to upload data to ${p}: ${_.error}`,"data-kit","error"),{ok:!1,processedFully:!0,pointsAdded:!1};"pointIdBy"in g&&(g.pointIdBy!==void 0||g.linkSourceBy||g.linkTargetsBy||(ue("No `pointIdBy` column or `linkSourceBy` and `linkTargetsBy` columns specified. Automatically generating an indexed `pointIdBy` column","data-kit","warn"),await gi.query(`ALTER TABLE ${p} ADD COLUMN ${le.Id} INTEGER; UPDATE ${p} SET ${le.Id} = rowid;`),await gi.logTable(p),g.pointIdBy=le.Id));const{missingRequiredColumns:T,missingOptionalColumns:E,processedFully:y,pointsAdded:C}=await b(gi,g);return T.length>0?(ue(`Data preparing stopped: Required columns are missing from the data source. Please check your data source and configuration.
Missing columns: ${T.map(I=>`'${I.name}' (\`${I.prop}\`)`).join(", ")}.`,"data-kit","error"),{ok:!1,processedFully:y,pointsAdded:C??!1}):E.length>0?(ue(`Optional columns are missing from the data source. These columns will not be included in the final dataset.
Missing columns: ${E.map(I=>`'${I.name}' (\`${I.prop}\`)`).join(", ")}.`,"data-kit","warn"),{ok:!0,processedFully:y,pointsAdded:C??!1}):{ok:!0,processedFully:y,pointsAdded:C??!1}}catch(_){return console.warn(`loadTable: ${_}`),{ok:!1,processedFully:!0,pointsAdded:!1}}})(i,e,n,r);if(!l)return void ue(`loadTable failed for ${e}`,"data-kit","error");await gi.dropTable(e);const h=await KT(o,t,a),d=await gi.query(`SUMMARIZE ${t}`);return h instanceof Uint8Array&&h.length||h instanceof mt&&h.numRows?{data:s(h),summary:d==null?void 0:d.toArray(),processedFully:c,pointsAdded:u}:void ue(`processData: No ${t} to export found (buffer length: ${h instanceof Uint8Array?h.length:h instanceof mt?h.numRows:"unknown"})`,"data-kit","warn")},Nq=async(i,e,t,n,r,o=!1)=>{let s,a;await(async()=>{gi=await yC.getInstance()})(),await gi.query(`DROP TABLE IF EXISTS ${De.PreparedPoints}`),await gi.query(`DROP TABLE IF EXISTS ${De.PreparedLinks}`);let l=!0,c=!0;try{if(!i.points||i.points.pointIdBy!==void 0&&(i.points.linkSourceBy!==void 0||i.points.linkTargetsBy!==void 0))return void ue("Stopped: points configuration is invalid","data-kit","error");const u=await Z1(e,De.RawPoints,De.PreparedPoints,Dq,i.points,n,r,o);if(!u)return void ue("Failed to process points data source","data-kit","error");let h=u.data;s=u.summary,l=u.processedFully;const d={...i};let f;if(t&&i.links)if(i.links.linkSourceBy&&i.links.linkTargetsBy)try{const b=await Z1(t,De.RawLinks,De.PreparedLinks,Mq,i.links,n,r,o);if(b){if(f=b.data,a=b.summary,c=b.processedFully,b.pointsAdded){const g=await KT(n,De.PreparedPoints,o),_=await gi.query(`SUMMARIZE ${De.PreparedPoints}`);(g instanceof Uint8Array&&g.length||g instanceof mt&&g.numRows)&&(h=r(g),s=_==null?void 0:_.toArray())}}else ue("Failed to process links data - processData returned undefined","data-kit","error")}catch(b){ue(`Failed to process links data: ${b}`,"data-kit","error")}else ue("Links configuration is invalid, only points will be exported.","data-kit","error");!f&&i.links&&(d.links=void 0,ue("Links configuration is invalid, only points will be exported.","data-kit","warn"));const p=(b=>{const g={...Object.fromEntries(Object.entries(b.points).filter(([_,T])=>_!=="outputFilename"&&_!=="linkTargetsBy"&&_!=="linkSourceBy"&&T!==void 0)),pointIdBy:le.Id,pointIndexBy:le.Idx};return b.links?{...g,...Object.fromEntries(Object.entries(b.links).filter(([_,T])=>_!=="linkTargetsBy"&&_!=="outputFilename"&&T!==void 0)),linkSourceBy:le.Source,linkSourceIndexBy:le.SourceIdx,linkTargetBy:le.Target,linkTargetIndexBy:le.TargetIdx}:g})(d);return{points:h,links:f,pointsSummary:s,linksSummary:a,cosmographConfig:p,pointsProcessedFully:l,linksProcessedFully:c}}catch(u){return void console.warn("_prepareCosmographData:",u)}finally{await gi.destroy()}},Bq=async i=>th||(ue("Started data preparing...","data-kit","util"),th=(async()=>{try{const e=await i();return e&&ue("Finished data preparing","data-kit","util"),e}catch(e){return void ue(e,"data-kit","error")}finally{th=null}})(),th),CK=async(i,e,t)=>Bq(()=>Nq(i,e,t,mi.Arrow,n=>n,!0)),Q1={highlightSelectedData:!0,showAnimationControls:!0,useLinksData:!1,useQuantiles:!1};let TK=class extends Wc{constructor(){super(...arguments);m(this,"_dataExtent");m(this,"_visualExtent")}getCurrentSelection(){if(this.checkReady(()=>this.getCurrentSelection()))return this._uiComponent.getCurrentSelection()}getCurrentSelectionInPixels(){if(this.checkReady(()=>this.getCurrentSelectionInPixels()))return this._uiComponent.getCurrentSelectionInPixels()}getBarWidth(){if(this.checkReady(()=>this.getBarWidth()))return this._uiComponent.getBarWidth()}setSelection(t){var n,r,o;this.checkReady(()=>this.setSelection(t))&&(this._uiComponent.setSelection(t,!0),(n=this._client)==null||n.applyRangeFilter(t),(o=(r=this._config).onSelection)==null||o.call(r,t,!0))}getIsAnimationRunning(){return!!this.checkReady(()=>this.getIsAnimationRunning())&&this._uiComponent.getIsAnimationRunning()}playAnimation(){this.checkReady(()=>this.playAnimation())&&this._uiComponent.playAnimation()}pauseAnimation(){this.checkReady(()=>this.pauseAnimation())&&this._uiComponent.pauseAnimation()}stopAnimation(){this.checkReady(()=>this.stopAnimation())&&this._uiComponent.stopAnimation()}get defaultConfig(){return Q1}get accessor(){return this._config.accessor??Q1.accessor}async fetchData(){var t,n;if(await super.fetchData(),this._currentData){const r=(n=(t=this._currentData)==null?void 0:t.getChild(this.accessor))==null?void 0:n.toArray(),o=r==null?void 0:r.map(a=>a instanceof Date?a.getTime():a);this._dataExtent=o!=null&&o.length?Yi(o):void 0;const s=DT(o??[],this._config.useQuantiles,this._config.customExtent);this._visualExtent=s,this._uiComponent.setTimeData(r,s),this.updateCrossfilteredData()}else this._uiComponent.setTimeData(void 0),this.updateHighlightedData(void 0);this._uiComponent.pauseAnimation()}createUIComponent(t){return new tj(t,this.createComponentConfig(this._config))}createComponentConfig(t){return{...t,formatter:n=>{const r=typeof n=="number"?n:n.getTime(),o=((t==null?void 0:t.formatter)??Wn)(r);if(!this._config.useQuantiles||!this._dataExtent||!this._visualExtent)return o;const[s,a]=this._visualExtent,[l,c]=this._dataExtent;return r===s&&s>l?`< ${o}`:r===a&&a<c?`> ${o}`:o},onBrush:(n,r)=>{var l,c,u,h;let o=n;if(n&&this._config.useQuantiles&&this._visualExtent&&this._dataExtent){const d=n.map(C=>C instanceof Date?C.getTime():C),[f,p]=d,[b,g]=this._visualExtent,[_,T]=this._dataExtent,E=f===b?_:f,y=p===g?T:p;o=n[0]instanceof Date?[new Date(E),new Date(y)]:[E,y]}const s=(l=this._currentData)==null?void 0:l.getChild(this.accessor),a=o?Ho(s==null?void 0:s.type)?o==null?void 0:o.map(d=>+d):o.map(d=>new Date(d)):void 0;(c=this._client)==null||c.applyRangeFilter(a),(h=(u=this._config).onSelection)==null||h.call(u,o,r)},onBarHover:n=>{var r,o;(o=(r=this._config).onBarHover)==null||o.call(r,n)},onAnimationPlay:(n,r)=>{var o,s;(s=(o=this._config).onAnimationPlay)==null||s.call(o,n,r)},onAnimationPause:(n,r)=>{var o,s;(s=(o=this._config).onAnimationPause)==null||s.call(o,n,r)},onAnimationTick:n=>{var r,o;(o=(r=this._config).onAnimationTick)==null||o.call(r,n)}}}onResetClientSelections(){this.setSelection()}updateHighlightedData(t){const{highlightSelectedData:n}=this._config;n&&this._uiComponent.setHighlightedData(t)}async onConfigUpdate(){this._uiComponent.setConfig(this.createComponentConfig(this._config))}};const J1={highlightSelectedData:!0,useLinksData:!1,useQuantiles:!1};class IK extends Wc{constructor(){super(...arguments);m(this,"_dataExtent");m(this,"_visualExtent")}getCurrentSelection(){if(this.checkReady(()=>this.getCurrentSelection()))return this._uiComponent.getCurrentSelection()}getCurrentSelectionInPixels(){if(this.checkReady(()=>this.getCurrentSelectionInPixels()))return this._uiComponent.getCurrentSelectionInPixels()}getBarWidth(){if(this.checkReady(()=>this.getBarWidth()))return this._uiComponent.getBarWidth()}setSelection(t){var n,r,o;this.checkReady(()=>this.setSelection(t))&&(this._uiComponent.setSelection(t,!0),(n=this._client)==null||n.applyRangeFilter(t),(o=(r=this._config).onSelection)==null||o.call(r,t,!0))}get defaultConfig(){return J1}get accessor(){return this._config.accessor??J1.accessor}async fetchData(){var t,n;if(await super.fetchData(),this._currentData){const r=(n=(t=this._currentData)==null?void 0:t.getChild(this.accessor))==null?void 0:n.toArray();this._dataExtent=r!=null&&r.length?Yi(r):void 0;const o=DT(r??[],this._config.useQuantiles,this._config.customExtent);this._visualExtent=o,this._uiComponent.setHistogramData(r,o),this.updateCrossfilteredData()}else this._uiComponent.setHistogramData(void 0),this.updateHighlightedData(void 0)}createUIComponent(t){return new Rj(t,this.createComponentConfig(this._config))}createComponentConfig(t){return{...t,formatter:n=>{const r=((t==null?void 0:t.formatter)??Wn)(n);if(!this._config.useQuantiles||!this._dataExtent||!this._visualExtent)return r;const[o,s]=this._visualExtent,[a,l]=this._dataExtent;return n===o&&o>a?`< ${r}`:n===s&&s<l?`> ${r}`:r},onBrush:(n,r)=>{var s,a,l;let o=n;if(n&&this._config.useQuantiles&&this._visualExtent&&this._dataExtent){const[c,u]=n,[h,d]=this._visualExtent,[f,p]=this._dataExtent;o=[c===h?f:c,u===d?p:u]}(s=this._client)==null||s.applyRangeFilter(o),(l=(a=this._config).onSelection)==null||l.call(a,o,r)},onBarHover:n=>{var r,o;(o=(r=this._config).onBarHover)==null||o.call(r,n)}}}updateHighlightedData(t){const{highlightSelectedData:n}=this._config;n&&this._uiComponent.setHighlightedData(t)}onResetClientSelections(){this.setSelection()}async onConfigUpdate(){this._uiComponent.setConfig(this.createComponentConfig(this._config))}}var yr;let Uf=(yr=class extends WT{constructor(){super(...arguments);m(this,"selected")}checkCurrentSelection(){this.selected&&this.setSelectedItem(this.selected)}onSelect(t){var n,r,o;this.compareSelectedItem(t)?((n=this._client)==null||n.resetFilter(),this.onResetClientSelections(),yr._activeComponentId=null):(yr._activeComponentId!==((r=this._client)==null?void 0:r.id)&&(this._internalApi.public.unselectAllPoints(),this._internalApi.dispatchEvent(new CustomEvent("resetSelections"))),yr._activeComponentId=((o=this._client)==null?void 0:o.id)||null,this.selected=t,this.setSelectedItem(t),this.accessor&&this.applyFilter(t))}onResetClientSelections(){this.selected=void 0,this.setSelectedItem(void 0)}onDataFiltered(){var t,n;((t=this._client)==null?void 0:t.id)!==yr._activeComponentId&&(this.selected=void 0,this.setSelectedItem(void 0),(n=this._client)==null||n.resetFilter())}},m(yr,"_activeComponentId",null),yr);const wo={suggestionsLimit:50,placeholderText:"Search...",showAccessorsMenu:!0,suggestionTruncationLength:50,accessor:"id",suggestionFieldsPalette:["#fbb4aebf","#b3cde3bf","#ccebc5bf","#decbe4bf","#fed9a6bf","#ffffccbf","#e5d8bdbf","#fddaecbf"],showFooter:!1};var Oq=".style_module_searchContainer__1bed75df{align-items:center;display:flex;gap:6px;position:relative;width:100%}.style_module_accessorButton__1bed75df{align-items:center;backdrop-filter:blur(8px);background:var(--cosmograph-search-accessors-background);border-radius:4px;cursor:pointer;display:flex;flex-shrink:0;font-size:13px;font-weight:300;line-height:1;max-width:100px;overflow:hidden;padding:2.5px 5px;text-overflow:ellipsis;white-space:nowrap}.style_module_accessorsMenuPlaceholder__1bed75df{font-size:11.5px;font-weight:600;letter-spacing:.07em;line-height:2;opacity:.9;padding-bottom:0;padding-left:10px;padding-top:4px;pointer-events:none;text-transform:uppercase;user-select:none}.style_module_accessorsMenu__1bed75df{backdrop-filter:blur(8px);background:var(--cosmograph-search-list-background);border-radius:4px;color:#fff;left:0;margin:2px 0 0;min-width:100%;opacity:0;overflow:hidden;padding:0 0 2px;pointer-events:none;position:absolute;right:0;top:100%;transform:translateY(-10px);transition:opacity .2s ease-out,transform .2s ease-out;width:100%}.style_module_accessorsMenu__1bed75df.style_module_upwards__1bed75df{bottom:100%;top:auto;transform:translateY(10px)}.style_module_accessorsMenu__1bed75df.style_module_visible__1bed75df{opacity:1;pointer-events:auto;transform:translateY(0)}.style_module_accessorsMenu__1bed75df.style_module_upwards__1bed75df.style_module_visible__1bed75df{opacity:1;pointer-events:auto;transform:translateY(-7px)}.style_module_accessorsMenu__1bed75df li{cursor:pointer;display:block;font-size:var(--cosmograph-search-list-font-size,13.5px);font-weight:500;line-height:normal;max-width:100%;opacity:0;padding:5px 10px;transform:translateY(5px);transition:opacity .2s ease-out,transform .2s ease-out;user-select:none}.style_module_accessorsMenu__1bed75df.style_module_visible__1bed75df li{opacity:1;transform:translateY(0)}.style_module_accessorsMenu__1bed75df li:hover{background:hsla(0,0%,100%,.1)}.style_module_accessorsMenu__1bed75df li>div{font-weight:200;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:100%}.style_module_placeholderInput__1bed75df{align-items:center;cursor:text;display:flex;font-weight:300;min-width:0;opacity:.7;width:100%}.style_module_placeholderInput__1bed75df.style_module_disabled__1bed75df{cursor:not-allowed;opacity:.5;pointer-events:none}.style_module_searchResult__1bed75df{align-items:center;display:flex;flex-wrap:wrap}.style_module_searchResultMultiField__1bed75df{text-wrap:initial;align-items:center;color:hsla(0,0%,100%,.8);display:inline-block;font-size:var(--cosmograph-search-list-font-size,13.5px);font-weight:300;line-height:normal;margin-right:8px;max-width:100%;overflow-wrap:anywhere;word-break:normal}.style_module_searchResultMultiField__1bed75df span{text-wrap:balance;display:inline;font-size:calc(var(--cosmograph-search-list-font-size)*.95);hyphens:auto;line-height:1.25;overflow-wrap:anywhere;white-space:normal;word-break:break-all}.style_module_searchResultMultiField__1bed75df .style_module_separator__1bed75df{display:inline;opacity:.5}.style_module_searchResultMultiField__1bed75df b{font-size:calc(var(--cosmograph-search-list-font-size)*.9);font-weight:600;letter-spacing:.015em;opacity:.7;text-transform:uppercase;white-space:pre}.style_module_selectAllContainer__1bed75df{align-items:center;display:flex;gap:4px;justify-content:start;line-height:1;margin:.25rem .5rem .15rem;padding:.2rem 0;width:100%}.style_module_selectAllButton__1bed75df{align-items:center;backdrop-filter:blur(4px);background:var(--cosmograph-search-select-all-background,hsla(0,0%,100%,.1));border:none;border-radius:4px;color:var(--cosmograph-search-select-all-color,hsla(0,0%,100%,.75));cursor:pointer;font-size:var(--cosmograph-search-list-font-size,13.5px);font-weight:300;margin:0!important;padding:2px 8px;text-align:center;transition:background-color .2s ease,border-color .2s ease}.style_module_selectAllButton__1bed75df:hover{background:var(--cosmograph-search-select-all-hover-background,hsla(0,0%,100%,.15))}.style_module_resultsCounter__1bed75df{color:hsla(0,0%,100%,.4);font-size:12px;font-weight:400;user-select:none;white-space:nowrap}.style_module_selectAllContainer__1bed75df .style_module_separator__1bed75df{color:hsla(0,0%,100%,.4);opacity:.7;user-select:none}",ut={searchContainer:"style_module_searchContainer__1bed75df",accessorButton:"style_module_accessorButton__1bed75df",accessorsMenuPlaceholder:"style_module_accessorsMenuPlaceholder__1bed75df",accessorsMenu:"style_module_accessorsMenu__1bed75df",upwards:"style_module_upwards__1bed75df",visible:"style_module_visible__1bed75df",placeholderInput:"style_module_placeholderInput__1bed75df",disabled:"style_module_disabled__1bed75df",searchResult:"style_module_searchResult__1bed75df",searchResultMultiField:"style_module_searchResultMultiField__1bed75df",separator:"style_module_separator__1bed75df",selectAllContainer:"style_module_selectAllContainer__1bed75df",selectAllButton:"style_module_selectAllButton__1bed75df",resultsCounter:"style_module_resultsCounter__1bed75df"};Pr(Oq,{});var Fq=":root{--cosmograph-search-accessors-background:#8791a159}";Pr(Fq,{});var sn;let kK=(sn=class extends Uf{constructor(){super(...arguments);m(this,"_isDataFetched",!1);m(this,"_accessorsMenu",null);m(this,"_placeholderElement",null);m(this,"_accessorButton",null);m(this,"_clickOutsideHandler",t=>this._handleClickOutside(t));m(this,"_enterFilterActive",!1);m(this,"_currentSearchInput","");m(this,"_currentSearchResults",[]);m(this,"_totalResultsCount",0);m(this,"_resultsCounter",null);m(this,"_arrayColumnsCache",new Set);m(this,"_selectedSearchField",wo.accessor)}get defaultConfig(){return wo}get accessor(){return this._config.accessor??wo.accessor}_isAllFieldsSelected(){return this._selectedSearchField===sn.ALL_FIELDS_TOKEN}_getSelectedFieldLabel(){return this._isAllFieldsSelected()?sn.ALL_FIELDS_LABEL:this.accessor}_syncSelectedSearchFieldWithConfig(){this._isAllFieldsSelected()||(this._selectedSearchField=this.accessor)}_getAutoSuggestionFields(){const{config:t}=this._internalApi,n=this._internalApi.summary.pointsSummary;if(!n||n.length===0)return;const r={};for(const o of n){const s=String(o.column_name);s!==t.pointIndexBy&&(r[s]=s)}if(this._config.suggestionFields)for(const[o,s]of Object.entries(this._config.suggestionFields))r[o]!==void 0&&(r[o]=s);return r}_getEffectiveSuggestionFields(){return this._isAllFieldsSelected()?this._getAutoSuggestionFields():this._config.suggestionFields}_getAllFields(){return Object.keys(this._getAutoSuggestionFields()??{})}_valueAccessor(t,n=this.accessor){const r=t[n];return r==null?"null":String(r)}_indexAccessor(t){const{config:n}=this._internalApi;return Number(t[n.pointIndexBy])}_calculateDisabledState(){return!this._isDataFetched||(typeof this._config.disabled=="boolean"?this._config.disabled:!this._isDataFetched)}async fetchData(){if(!this._internalApi.dbCoordinator)return;await this._internalApi.dataManager.dataReady(),this._isDataFetched=!0,this._syncSelectedSearchFieldWithConfig();const t=this._calculateDisabledState();this._uiComponent.setDisabled(t),this._findPlaceholderElement(),this._updatePlaceholderDisabledState(),this._config.showAccessorsMenu&&(await this._updateAccessorsMenu(),this._updateAccessorButton()),this._detectArrayColumns(),this._client&&this.accessor&&await this._client.getCurrentData()}_detectArrayColumns(){this._arrayColumnsCache.clear();for(const t of this._internalApi.summary.pointsSummary??[])y8(String(t.column_type??""))&&this._arrayColumnsCache.add(String(t.column_name))}_isArrayColumn(t){return this._arrayColumnsCache.has(t)}applyFilter(t){var r,o,s;const{config:n}=this._internalApi;if(t)if(this._getEffectiveSuggestionFields()){const a=this._indexAccessor(t);(r=this._client)==null||r.applyFilter(Ym(Ci(n.pointIndexBy),[a])),this._internalApi.public.zoomToPoint(a),(n.focusPointOnClick??n.selectPointOnClick)&&this._internalApi.public.setFocusedPoint(a)}else(o=this._client)==null||o.applyExactFilter(this._valueAccessor(t));else(s=this._client)==null||s.resetFilter()}setSelectedItem(t){t||this._uiComponent.clearInput()}compareSelectedItem(t){var n;return!(t||!this.selected)||((n=this.selected)==null?void 0:n.id)===(t==null?void 0:t.id)}createUIComponent(t){return new yj(t,this.createComponentConfig({...this._config}))}onResetClientSelections(){this._uiComponent.clearInput()}async onConfigUpdate(){const t=this._config.openListUpwards;this._uiComponent.setConfig(this.createComponentConfig({...this._config})),this._updatePlaceholderDisabledState(),this._syncSelectedSearchFieldWithConfig(),this._config.showAccessorsMenu&&this._accessorsMenu&&t!==this._config.openListUpwards&&(this._config.openListUpwards?this._accessorsMenu.classList.add(ut.upwards):this._accessorsMenu.classList.remove(ut.upwards)),this._config.showAccessorsMenu&&this._updateAccessorButton(),this._uiComponent.clearInput(),this.onResetClientSelections()}async _getSuggestions(t){if(this._internalApi.dbCoordinator)return await this._internalApi.dataManager.dataReady(),this._syncSelectedSearchFieldWithConfig(),this._isAllFieldsSelected()?this._getAllFieldsSuggestions(t):this._getSingleFieldSuggestions(t)}async _executeQuery(t){var n;return await((n=this._internalApi.dbCoordinator)==null?void 0:n.query(t))}_buildOrderByClause(t,n){return this._isNullSearch(n)?`"${this.accessor}"`:`
      CASE WHEN ${t} = LOWER('${n}') THEN 0 ELSE 1 END,
      CASE WHEN ${t} LIKE LOWER('${n}%') THEN 0 ELSE 1 END,
      STRPOS(${t}, LOWER('${n}'))
    `}_isNullSearch(t){return t.toLowerCase().trim()==="null"}_buildFieldUtilities(t){const n=r=>this._isArrayColumn(r)?`LOWER(array_to_string("${r}", ', '))`:`LOWER(CAST("${r}" AS VARCHAR))`;return{fieldCast:n,fieldMatchCondition:r=>this._isNullSearch(t)?`"${r}" IS NULL`:this._isArrayColumn(r)?`EXISTS(
          SELECT 1 FROM UNNEST("${r}") AS element
          WHERE LOWER(CAST(element AS VARCHAR)) LIKE LOWER('%${t}%')
        )`:`${n(r)} LIKE LOWER('%${t}%')`}}_buildSingleFieldWhereCondition(t){const{fieldMatchCondition:n}=this._buildFieldUtilities(t);return n(this.accessor)}_buildAllFieldsWhereCondition(t){const n=this._getAllFields();if(n.length===0)return this._buildSingleFieldWhereCondition(t);const{fieldMatchCondition:r}=this._buildFieldUtilities(t);return n.map(r).join(" OR ")}_truncateAroundMatch(t,n,r){if(r===0||t.length<=r)return t;const o=t.toLowerCase(),s=n.toLowerCase(),a=o.indexOf(s);if(a===-1)return t.length>r?`${t.substring(0,r)}...`:t;const l=a+n.length,c=Math.floor(r/2);let u=Math.max(0,a-c),h=Math.min(t.length,l+c);u===0?h=Math.min(t.length,u+r):h===t.length&&(u=Math.max(0,h-r));let d=t.substring(u,h);return u>0&&(d=`...${d}`),h<t.length&&(d=`${d}...`),d}async _getSingleFieldSuggestions(t){const{fieldCast:n}=this._buildFieldUtilities(t),r=this._config.suggestionsLimit??wo.suggestionsLimit,o=this._buildSingleFieldWhereCondition(t);if(!this._getEffectiveSuggestionFields()){if(this._isNullSearch(t)){const l=`
          SELECT 'null' AS "${this.accessor}",
                 'null' AS id,
                 1 AS total_count
          FROM (SELECT 1) AS dummy
          WHERE EXISTS (
            SELECT 1 FROM ${this.tableName}
            WHERE "${this.accessor}" IS NULL
            LIMIT 1
          )
          LIMIT 1
        `;return this._executeQuery(l)}if(this._isArrayColumn(this.accessor)){const l=`
          WITH values AS (
            SELECT DISTINCT CAST(u.value AS VARCHAR) AS value
            FROM ${this.tableName} t,
                 UNNEST(t."${this.accessor}") AS u(value)
            WHERE LOWER(CAST(u.value AS VARCHAR)) LIKE LOWER('%${t}%')
          ),
          ranked AS (
            SELECT value,
                   LOWER(value) AS lower_value,
                   COUNT(*) OVER() AS total_count
            FROM values
          )
          SELECT value AS "${this.accessor}",
                 value AS id,
                 total_count
          FROM ranked
          ORDER BY ${this._buildOrderByClause("lower_value",t)},
                   value
          LIMIT ${r}
        `;return this._executeQuery(l)}const a=`
        WITH values AS (
          SELECT DISTINCT CAST("${this.accessor}" AS VARCHAR) AS value
          FROM ${this.tableName}
          WHERE ${o}
        ),
        ranked AS (
          SELECT value,
                 LOWER(value) AS lower_value,
                 COUNT(*) OVER() AS total_count
          FROM values
        )
        SELECT value AS "${this.accessor}",
               value AS id,
               total_count
        FROM ranked
        ORDER BY ${this._buildOrderByClause("lower_value",t)},
                 value
        LIMIT ${r}
      `;return this._executeQuery(a)}if(this._isNullSearch(t)){const a=`
        SELECT *,
               COUNT(*) OVER() AS total_count
        FROM ${this.tableName}
        WHERE ${o}
        ORDER BY ${this._buildOrderByClause("",t)}
        LIMIT ${r}
      `;return this._executeQuery(a)}const s=`
      SELECT *,
             COUNT(*) OVER() AS total_count
      FROM (
        SELECT *,
               ${n(this.accessor)} AS lower_value
        FROM ${this.tableName}
        WHERE ${o}
      ) t
      ORDER BY ${this._buildOrderByClause("lower_value",t)}
      LIMIT ${r}
    `;return this._executeQuery(s)}async _getAllFieldsSuggestions(t){const n=this._getAllFields(),r=this._config.suggestionsLimit??wo.suggestionsLimit,o=this._buildAllFieldsWhereCondition(t),{fieldCast:s,fieldMatchCondition:a}=this._buildFieldUtilities(t);if(n.length===0)return this._getSingleFieldSuggestions(t);const l=n.map(u=>`WHEN ${a(u)} THEN '${u}'`).join(" ");if(this._isNullSearch(t)){const u=`
        SELECT *,
               COUNT(*) OVER() AS total_count,
               'null' AS matched_value,
               CASE ${l} END AS matched_field
        FROM ${this.tableName}
        WHERE ${o}
        ORDER BY "${this.accessor}"
        LIMIT ${r}
      `;return this._executeQuery(u)}const c=`
      SELECT *,
             COUNT(*) OVER() AS total_count
      FROM (
        SELECT *,
               CASE ${l} END AS matched_field,
               CASE ${n.map(u=>`WHEN ${a(u)} THEN ${s(u)}`).join(" ")} END AS matched_value
        FROM ${this.tableName}
        WHERE ${o}
      ) t
      ORDER BY ${this._buildOrderByClause("matched_value",t)}
      LIMIT ${r}
    `;return this._executeQuery(c)}async _getSearchItems(t){var s,a;if(!this._isDataFetched||((s=this._internalApi.summary.pointsSummary)==null?void 0:s.length)===0)return this._currentSearchResults=[],this._totalResultsCount=0,this._updateResultsCounter(),[];const n=await this._getSuggestions(t),r=(n==null?void 0:n.toArray())??[];this._currentSearchResults=r;const o=(a=r[0])==null?void 0:a.total_count;return this._totalResultsCount=typeof o=="number"?o:r.length,this._updateResultsCounter(),this._currentSearchResults}_createAccessorButton(){const t=document.createElement("div");return t.classList.add(ut.accessorButton),t.dataset.ignoreFocus="true",t.textContent=this._getSelectedFieldLabel(),t.onclick=()=>{this._accessorsMenu&&(this._accessorsMenu.classList.contains(ut.visible)?this._accessorsMenu.classList.remove(ut.visible):this._accessorsMenu.classList.add(ut.visible))},t}_createFooter(){const t=document.createElement("div");t.classList.add(ut.selectAllContainer);const n=document.createElement("button");n.classList.add(ut.selectAllButton),n.textContent="select found results",n.onclick=async o=>{o.stopPropagation(),await this._handleSelectAllClick()},this._resultsCounter=document.createElement("span"),this._resultsCounter.classList.add(ut.resultsCounter),this._resultsCounter.textContent=this._getResultsCountText(),t.appendChild(n);const r=document.createElement("span");return r.classList.add(ut.separator),r.textContent="  ",t.appendChild(r),t.appendChild(this._resultsCounter),t}_getResultsCountText(){const t=this._totalResultsCount,n=this._currentSearchResults.length,r=(o,s,a=`${s}s`)=>o===1?s:a;return t===n?`${Wn(t)} ${r(t,"result")} found`:`${Wn(n)} of ${Wn(t)} ${r(t,"result")} shown`}_updateResultsCounter(){this._resultsCounter&&(this._resultsCounter.textContent=this._getResultsCountText())}async _handleSelectAllClick(){var t,n,r;if(this._currentSearchResults.length!==0&&this._currentSearchInput)try{const{config:o}=this._internalApi,s=o.pointIndexBy,a=this._isAllFieldsSelected()?this._buildAllFieldsWhereCondition(this._currentSearchInput):this._buildSingleFieldWhereCondition(this._currentSearchInput),l=`
        SELECT DISTINCT "${s}" as point_index
        FROM ${this.tableName}
        WHERE ${a}
      `,c=await this._executeQuery(l),u=((c==null?void 0:c.toArray())??[]).map(h=>h.point_index);(t=this._client)==null||t.applyFilter(Ym(Ci(this._internalApi.config.pointIndexBy),u)),this._enterFilterActive=!0,(r=(n=this._config).onSelectAll)==null||r.call(n,u),this._uiComponent.hideSuggestions()}catch{this._uiComponent.hideSuggestions()}}_createAccessorsMenu(){const t=document.createElement("ul");return t.dataset.ignoreFocus="true",t.classList.add(ut.accessorsMenu),this._config.openListUpwards&&t.classList.add(ut.upwards),t}_handleClickOutside(t){var n;this._accessorsMenu&&this._accessorsMenu.classList.contains(ut.visible)&&!((n=this._accessorButton)!=null&&n.contains(t.target))&&!this._accessorsMenu.contains(t.target)&&this._accessorsMenu.classList.remove(ut.visible)}_createPlaceholderElement(){if(!this._placeholderElement){this._placeholderElement=document.createElement("div"),this._placeholderElement.classList.add(ut.searchContainer),this._config.showAccessorsMenu&&(this._accessorsMenu=this._createAccessorsMenu(),this._accessorButton=this._createAccessorButton(),this._placeholderElement.appendChild(this._accessorButton),this._placeholderElement.appendChild(this._accessorsMenu),document.addEventListener("click",this._clickOutsideHandler));const t=document.createElement("div");t.classList.add(ut.placeholderInput),t.innerHTML=this._config.placeholderText??"Search...",this._calculateDisabledState()&&t.classList.add(ut.disabled),t.onclick=()=>{this._calculateDisabledState()||this._uiComponent.focus()},this._placeholderElement.appendChild(t)}return this._placeholderElement}_updateAccessorButton(){if(this._accessorButton){const t=this._getSelectedFieldLabel();this._accessorButton.textContent=t,this._accessorButton.title=t}}_findPlaceholderElement(){if(!this._placeholderElement){const t=`.${ut.searchContainer}`,n=document.querySelector(t);if(!n)return;this._placeholderElement=n,this._accessorButton=n.querySelector(`.${ut.accessorButton}`),this._config.showAccessorsMenu&&!this._accessorsMenu&&(this._accessorsMenu=this._createAccessorsMenu(),this._placeholderElement.appendChild(this._accessorsMenu))}}_updatePlaceholderDisabledState(){if(!this._placeholderElement)return;const t=this._placeholderElement.querySelector(`.${ut.placeholderInput}`);t&&(this._calculateDisabledState()?t.classList.add(ut.disabled):t.classList.remove(ut.disabled))}async _updateAccessorsMenu(){var o;if(!this._config.showAccessorsMenu||!this._accessorsMenu)return;const{config:t}=this._internalApi;if(!this._internalApi.summary.pointsSummary)return;this._config.openListUpwards?this._accessorsMenu.classList.add(ut.upwards):this._accessorsMenu.classList.remove(ut.upwards);const n=(o=this._internalApi.summary.pointsSummary)==null?void 0:o.map(s=>String(s.column_name)).filter(s=>s!==t.pointIndexBy);this._accessorsMenu.innerHTML="";const r=document.createElement("div");r.classList.add(ut.accessorsMenuPlaceholder),r.textContent="Select field to search",this._accessorsMenu.appendChild(r),this._accessorsMenu.appendChild(this._createAccessorItem(sn.ALL_FIELDS_TOKEN,sn.ALL_FIELDS_LABEL)),n.forEach(s=>{const a=this._createAccessorItem(s);this._accessorsMenu.appendChild(a)})}_createAccessorItem(t,n){const r=document.createElement("li"),o=document.createElement("div"),s=n??t;return o.textContent=s,o.title=s,o.onclick=a=>this._handleAccessorClick(t,a),r.onclick=a=>this._handleAccessorClick(t,a),r.appendChild(o),r}async _handleAccessorClick(t,n){n.stopPropagation(),t===sn.ALL_FIELDS_TOKEN?this._isAllFieldsSelected()||(this._selectedSearchField=sn.ALL_FIELDS_TOKEN,this._updateAccessorButton(),this._uiComponent.clearInput(),await this.onConfigUpdate()):(this._config.accessor!==t||this._isAllFieldsSelected())&&(this._selectedSearchField=t,this._config.accessor=t,this._updateAccessorButton(),this._uiComponent.clearInput(),await this.onConfigUpdate(),this._client&&await this._client.getCurrentData()),this._accessorsMenu&&this._accessorsMenu.classList.remove(ut.visible)}_renderSuggestionField(t,n,r,o,s){const a=n[r]!==void 0&&n[r]!==null,l=(n[r]===null||n[r]===void 0)&&this._isNullSearch(this._currentSearchInput);if(a||l){const c=s[r];let u=this._valueAccessor(n,r);const h=this._config.suggestionTruncationLength??wo.suggestionTruncationLength;if(h>0&&this._currentSearchInput&&u.length>h&&(u=this._truncateAroundMatch(u,this._currentSearchInput,h)),o>0){const g=document.createElement("div");g.classList.add(ut.separator),g.innerHTML="  ",t.appendChild(g)}const d=document.createElement("span"),f=document.createElement("b");f.textContent=`${c}: `,d.appendChild(f);const p=document.createElement("span");let b;if(o>0&&this._config.suggestionFieldsPalette&&this._config.suggestionFieldsPalette.length>0){const g=(o-1)%this._config.suggestionFieldsPalette.length;b=this._config.suggestionFieldsPalette[g],d.style.color=b??"inherit"}if(this._isAllFieldsSelected()?this._currentSearchInput&&(this._isNullSearch(this._currentSearchInput)?u.toLowerCase()==="null":u.toLowerCase().includes(this._currentSearchInput.toLowerCase())):r===this.accessor){const g=this._uiComponent.getHighlightedMatch(u);p.innerHTML=b?g.replace(/<mark[^>]*>/g,`<mark style="color: ${b}">`):g}else p.textContent=u;d.appendChild(p),t.appendChild(d)}}_renderSuggestion(t){const n=this._getEffectiveSuggestionFields();if(!n){let l=this._valueAccessor(t);const c=this._config.suggestionTruncationLength??wo.suggestionTruncationLength;return c>0&&this._currentSearchInput&&l.length>c&&(l=this._truncateAroundMatch(l,this._currentSearchInput,c)),l}const r=document.createElement("div");r.classList.add(ut.searchResult);const o={...n};let s=Object.keys(o);o[this.accessor]?s[0]!==this.accessor&&(s=s.filter(l=>l!==this.accessor),s.unshift(this.accessor)):(o[this.accessor]=this.accessor,s.unshift(this.accessor));const a=document.createElement("span");return a.classList.add(ut.searchResultMultiField),s.forEach((l,c)=>{this._renderSuggestionField(a,t,l,c,o)}),r.appendChild(a),r}createComponentConfig(t){return{...t,onEnter:async(...n)=>{var o,s,a;const[,r]=n;Array.isArray(r)&&r.length>0?await this._handleSelectAllClick():((o=this._client)==null||o.resetFilter(),this._enterFilterActive=!1),this._uiComponent.hideSuggestions(),Array.isArray(r)&&r.splice(0,r.length),(a=(s=this._config).onEnter)==null||a.call(s,...n)},onInput:(...n)=>{var o,s;const[r]=n;this._currentSearchInput=r,(s=(o=this._config).onInput)==null||s.call(o,...n)},onSelect:(...n)=>{var r,o;this._enterFilterActive=!1,this.onSelect(n[0]),(o=(r=this._config).onSelect)==null||o.call(r,n[0])},onClear:()=>{var n,r;this._enterFilterActive=!1,this.onSelect(void 0),(r=(n=this._config).onClear)==null||r.call(n)},disabled:this._calculateDisabledState(),searchFn:async(...n)=>await this._getSearchItems(n[0]),suggestionRenderer:n=>this._renderSuggestion(n),selectedSuggestionRenderer:n=>{let r=this._valueAccessor(n);const o=this._config.suggestionTruncationLength??wo.suggestionTruncationLength;return o>0&&this._currentSearchInput&&r.length>o&&(r=this._truncateAroundMatch(r,this._currentSearchInput,o)),r},placeholderRenderer:this._createPlaceholderElement(),footerComponent:this._config.showFooter?this._createFooter():void 0}}remove(){document.removeEventListener("click",this._clickOutsideHandler),this._accessorButton&&(this._accessorButton.onclick=null),this._uiComponent.destroy(),this._accessorsMenu=null,this._placeholderElement=null,this._accessorButton=null,this._resultsCounter=null,this._currentSearchResults=[],this._totalResultsCount=0,super.remove()}onDataFiltered(){this._enterFilterActive||super.onDataFiltered()}hideSuggestions(){this.checkReady(()=>this.hideSuggestions())&&this._uiComponent.hideSuggestions()}clearInput(){this.checkReady(()=>this.clearInput())&&this._uiComponent.clearInput()}focus(){this.checkReady(()=>this.focus())&&this._uiComponent.focus()}blur(){this.checkReady(()=>this.blur())&&this._uiComponent.blur()}},m(sn,"ALL_FIELDS_TOKEN","__all_fields__"),m(sn,"ALL_FIELDS_LABEL","all fields"),sn);const zq={useLinksData:!1,selectOnClick:!0,highlightSelectedData:!0};let LK=class extends Wc{setSelectedItem(e){var t;this.checkReady(()=>this.setSelectedItem(e))&&(this._uiComponent.setSelectedItem(e),e||((t=this._client)==null||t.resetFilter()))}get defaultConfig(){return zq}get accessor(){return this._config.accessor}onResetClientSelections(){this.setSelectedItem(void 0)}async fetchData(){var e,t;if(await super.fetchData(),this._currentData){this._uiComponent.resetList();const n=this.accessor?kY((t=(e=this._currentData)==null?void 0:e.getChild(this.accessor))==null?void 0:t.toArray(),String):[];this._uiComponent.setData(n),this.updateCrossfilteredData()}else this._uiComponent.setData(void 0),this.updateHighlightedData(void 0)}createUIComponent(e){return new Bj(e,this.createComponentConfig(this._config))}createComponentConfig(e){return{...e,onClick:t=>{var r,o,s,a,l,c,u,h,d;const n=this._uiComponent.getSelectedItem();t&&(n==null?void 0:n.label)===t.label?((r=this._client)==null||r.resetFilter(),this.setSelectedItem(void 0),(s=(o=this._config).onClick)==null||s.call(o,void 0)):t?((a=this._client)==null||a.applyExactFilter(t.label),this.setSelectedItem(t),(c=(l=this._config).onClick)==null||c.call(l,t)):((u=this._client)==null||u.resetFilter(),this.setSelectedItem(void 0),(d=(h=this._config).onClick)==null||d.call(h,void 0))},onBarHover:t=>{var n,r;(r=(n=this._config).onBarHover)==null||r.call(n,t)}}}async onConfigUpdate(){this._uiComponent.setConfig(this.createComponentConfig(this._config))}updateHighlightedData(e){const{highlightSelectedData:t}=this._config;if(t)if(this._internalApi.crossfilter.isFilteringActive)if(e&&e.length>0){const n=e.map(r=>String(r));this._uiComponent.setHighlightedData(n)}else this._uiComponent.setHighlightedData([]);else this._uiComponent.setHighlightedData(void 0)}};/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:ZT,setPrototypeOf:ex,isFrozen:Uq,getPrototypeOf:$q,getOwnPropertyDescriptor:Vq}=Object;let{freeze:Ri,seal:Ln,create:Og}=Object,{apply:Fg,construct:zg}=typeof Reflect<"u"&&Reflect;Ri||(Ri=function(e){return e});Ln||(Ln=function(e){return e});Fg||(Fg=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return e.apply(t,r)});zg||(zg=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new e(...n)});const ih=Pi(Array.prototype.forEach),Hq=Pi(Array.prototype.lastIndexOf),tx=Pi(Array.prototype.pop),Pl=Pi(Array.prototype.push),Gq=Pi(Array.prototype.splice),Fh=Pi(String.prototype.toLowerCase),Zp=Pi(String.prototype.toString),Qp=Pi(String.prototype.match),Dl=Pi(String.prototype.replace),Wq=Pi(String.prototype.indexOf),jq=Pi(String.prototype.trim),Fn=Pi(Object.prototype.hasOwnProperty),Ei=Pi(RegExp.prototype.test),Ml=Yq(TypeError);function Pi(i){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Fg(i,e,n)}}function Yq(i){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return zg(i,t)}}function Oe(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Fh;ex&&ex(i,null);let n=e.length;for(;n--;){let r=e[n];if(typeof r=="string"){const o=t(r);o!==r&&(Uq(e)||(e[n]=o),r=o)}i[r]=!0}return i}function qq(i){for(let e=0;e<i.length;e++)Fn(i,e)||(i[e]=null);return i}function rr(i){const e=Og(null);for(const[t,n]of ZT(i))Fn(i,t)&&(Array.isArray(n)?e[t]=qq(n):n&&typeof n=="object"&&n.constructor===Object?e[t]=rr(n):e[t]=n);return e}function Nl(i,e){for(;i!==null;){const n=Vq(i,e);if(n){if(n.get)return Pi(n.get);if(typeof n.value=="function")return Pi(n.value)}i=$q(i)}function t(){return null}return t}const ix=Ri(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Jp=Ri(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),em=Ri(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Xq=Ri(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),tm=Ri(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Kq=Ri(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),nx=Ri(["#text"]),rx=Ri(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),im=Ri(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),ox=Ri(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),nh=Ri(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Zq=Ln(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Qq=Ln(/<%[\w\W]*|[\w\W]*%>/gm),Jq=Ln(/\$\{[\w\W]*/gm),eX=Ln(/^data-[\-\w.\u00B7-\uFFFF]+$/),tX=Ln(/^aria-[\-\w]+$/),QT=Ln(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),iX=Ln(/^(?:\w+script|data):/i),nX=Ln(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),JT=Ln(/^html$/i),rX=Ln(/^[a-z][.\w]*(-[.\w]+)+$/i);var sx=Object.freeze({__proto__:null,ARIA_ATTR:tX,ATTR_WHITESPACE:nX,CUSTOM_ELEMENT:rX,DATA_ATTR:eX,DOCTYPE_NAME:JT,ERB_EXPR:Qq,IS_ALLOWED_URI:QT,IS_SCRIPT_OR_DATA:iX,MUSTACHE_EXPR:Zq,TMPLIT_EXPR:Jq});const Bl={element:1,text:3,progressingInstruction:7,comment:8,document:9},oX=function(){return typeof window>"u"?null:window},sX=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let n=null;const r="data-tt-policy-suffix";t&&t.hasAttribute(r)&&(n=t.getAttribute(r));const o="dompurify"+(n?"#"+n:"");try{return e.createPolicy(o,{createHTML(s){return s},createScriptURL(s){return s}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},ax=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function eA(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:oX();const e=z=>eA(z);if(e.version="3.3.1",e.removed=[],!i||!i.document||i.document.nodeType!==Bl.document||!i.Element)return e.isSupported=!1,e;let{document:t}=i;const n=t,r=n.currentScript,{DocumentFragment:o,HTMLTemplateElement:s,Node:a,Element:l,NodeFilter:c,NamedNodeMap:u=i.NamedNodeMap||i.MozNamedAttrMap,HTMLFormElement:h,DOMParser:d,trustedTypes:f}=i,p=l.prototype,b=Nl(p,"cloneNode"),g=Nl(p,"remove"),_=Nl(p,"nextSibling"),T=Nl(p,"childNodes"),E=Nl(p,"parentNode");if(typeof s=="function"){const z=t.createElement("template");z.content&&z.content.ownerDocument&&(t=z.content.ownerDocument)}let y,C="";const{implementation:I,createNodeIterator:F,createDocumentFragment:V,getElementsByTagName:q}=t,{importNode:Q}=n;let M=ax();e.isSupported=typeof ZT=="function"&&typeof E=="function"&&I&&I.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:ae,ERB_EXPR:ee,TMPLIT_EXPR:R,DATA_ATTR:X,ARIA_ATTR:O,IS_SCRIPT_OR_DATA:W,ATTR_WHITESPACE:ne,CUSTOM_ELEMENT:Y}=sx;let{IS_ALLOWED_URI:ie}=sx,j=null;const fe=Oe({},[...ix,...Jp,...em,...tm,...nx]);let de=null;const Ze=Oe({},[...rx,...im,...ox,...nh]);let oe=Object.seal(Og(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ft=null,$e=null;const gt=Object.seal(Og(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let te=!0,Se=!0,Me=!1,G=!0,Ge=!1,Pe=!0,_t=!1,It=!1,he=!1,We=!1,xi=!1,li=!1,nl=!0,du=!1;const rl="user-content-";let Dr=!0,un=!1,Xi={},Ki=null;const Ts=Oe({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let ol=null;const As=Oe({},["audio","video","img","source","image","track"]);let Is=null;const Yo=Oe({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Mr="http://www.w3.org/1998/Math/MathML",Ni="http://www.w3.org/2000/svg",ci="http://www.w3.org/1999/xhtml";let Jn=ci,qo=!1,sl=null;const ks=Oe({},[Mr,Ni,ci],Zp);let Nr=Oe({},["mi","mo","mn","ms","mtext"]),Ls=Oe({},["annotation-xml"]);const Xo=Oe({},["title","style","font","a","script"]);let Ko=null;const $f=["application/xhtml+xml","text/html"],Ut="text/html";let vt=null,yo=null;const fu=t.createElement("form"),Rs=function(x){return x instanceof RegExp||x instanceof Function},Ps=function(){let x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(yo&&yo===x)){if((!x||typeof x!="object")&&(x={}),x=rr(x),Ko=$f.indexOf(x.PARSER_MEDIA_TYPE)===-1?Ut:x.PARSER_MEDIA_TYPE,vt=Ko==="application/xhtml+xml"?Zp:Fh,j=Fn(x,"ALLOWED_TAGS")?Oe({},x.ALLOWED_TAGS,vt):fe,de=Fn(x,"ALLOWED_ATTR")?Oe({},x.ALLOWED_ATTR,vt):Ze,sl=Fn(x,"ALLOWED_NAMESPACES")?Oe({},x.ALLOWED_NAMESPACES,Zp):ks,Is=Fn(x,"ADD_URI_SAFE_ATTR")?Oe(rr(Yo),x.ADD_URI_SAFE_ATTR,vt):Yo,ol=Fn(x,"ADD_DATA_URI_TAGS")?Oe(rr(As),x.ADD_DATA_URI_TAGS,vt):As,Ki=Fn(x,"FORBID_CONTENTS")?Oe({},x.FORBID_CONTENTS,vt):Ts,ft=Fn(x,"FORBID_TAGS")?Oe({},x.FORBID_TAGS,vt):rr({}),$e=Fn(x,"FORBID_ATTR")?Oe({},x.FORBID_ATTR,vt):rr({}),Xi=Fn(x,"USE_PROFILES")?x.USE_PROFILES:!1,te=x.ALLOW_ARIA_ATTR!==!1,Se=x.ALLOW_DATA_ATTR!==!1,Me=x.ALLOW_UNKNOWN_PROTOCOLS||!1,G=x.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Ge=x.SAFE_FOR_TEMPLATES||!1,Pe=x.SAFE_FOR_XML!==!1,_t=x.WHOLE_DOCUMENT||!1,We=x.RETURN_DOM||!1,xi=x.RETURN_DOM_FRAGMENT||!1,li=x.RETURN_TRUSTED_TYPE||!1,he=x.FORCE_BODY||!1,nl=x.SANITIZE_DOM!==!1,du=x.SANITIZE_NAMED_PROPS||!1,Dr=x.KEEP_CONTENT!==!1,un=x.IN_PLACE||!1,ie=x.ALLOWED_URI_REGEXP||QT,Jn=x.NAMESPACE||ci,Nr=x.MATHML_TEXT_INTEGRATION_POINTS||Nr,Ls=x.HTML_INTEGRATION_POINTS||Ls,oe=x.CUSTOM_ELEMENT_HANDLING||{},x.CUSTOM_ELEMENT_HANDLING&&Rs(x.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(oe.tagNameCheck=x.CUSTOM_ELEMENT_HANDLING.tagNameCheck),x.CUSTOM_ELEMENT_HANDLING&&Rs(x.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(oe.attributeNameCheck=x.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),x.CUSTOM_ELEMENT_HANDLING&&typeof x.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(oe.allowCustomizedBuiltInElements=x.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Ge&&(Se=!1),xi&&(We=!0),Xi&&(j=Oe({},nx),de=[],Xi.html===!0&&(Oe(j,ix),Oe(de,rx)),Xi.svg===!0&&(Oe(j,Jp),Oe(de,im),Oe(de,nh)),Xi.svgFilters===!0&&(Oe(j,em),Oe(de,im),Oe(de,nh)),Xi.mathMl===!0&&(Oe(j,tm),Oe(de,ox),Oe(de,nh))),x.ADD_TAGS&&(typeof x.ADD_TAGS=="function"?gt.tagCheck=x.ADD_TAGS:(j===fe&&(j=rr(j)),Oe(j,x.ADD_TAGS,vt))),x.ADD_ATTR&&(typeof x.ADD_ATTR=="function"?gt.attributeCheck=x.ADD_ATTR:(de===Ze&&(de=rr(de)),Oe(de,x.ADD_ATTR,vt))),x.ADD_URI_SAFE_ATTR&&Oe(Is,x.ADD_URI_SAFE_ATTR,vt),x.FORBID_CONTENTS&&(Ki===Ts&&(Ki=rr(Ki)),Oe(Ki,x.FORBID_CONTENTS,vt)),x.ADD_FORBID_CONTENTS&&(Ki===Ts&&(Ki=rr(Ki)),Oe(Ki,x.ADD_FORBID_CONTENTS,vt)),Dr&&(j["#text"]=!0),_t&&Oe(j,["html","head","body"]),j.table&&(Oe(j,["tbody"]),delete ft.tbody),x.TRUSTED_TYPES_POLICY){if(typeof x.TRUSTED_TYPES_POLICY.createHTML!="function")throw Ml('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof x.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Ml('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');y=x.TRUSTED_TYPES_POLICY,C=y.createHTML("")}else y===void 0&&(y=sX(f,r)),y!==null&&typeof C=="string"&&(C=y.createHTML(""));Ri&&Ri(x),yo=x}},al=Oe({},[...Jp,...em,...Xq]),pu=Oe({},[...tm,...Kq]),Br=function(x){let U=E(x);(!U||!U.tagName)&&(U={namespaceURI:Jn,tagName:"template"});const K=Fh(x.tagName),Te=Fh(U.tagName);return sl[x.namespaceURI]?x.namespaceURI===Ni?U.namespaceURI===ci?K==="svg":U.namespaceURI===Mr?K==="svg"&&(Te==="annotation-xml"||Nr[Te]):!!al[K]:x.namespaceURI===Mr?U.namespaceURI===ci?K==="math":U.namespaceURI===Ni?K==="math"&&Ls[Te]:!!pu[K]:x.namespaceURI===ci?U.namespaceURI===Ni&&!Ls[Te]||U.namespaceURI===Mr&&!Nr[Te]?!1:!pu[K]&&(Xo[K]||!al[K]):!!(Ko==="application/xhtml+xml"&&sl[x.namespaceURI]):!1},ii=function(x){Pl(e.removed,{element:x});try{E(x).removeChild(x)}catch{g(x)}},er=function(x,U){try{Pl(e.removed,{attribute:U.getAttributeNode(x),from:U})}catch{Pl(e.removed,{attribute:null,from:U})}if(U.removeAttribute(x),x==="is")if(We||xi)try{ii(U)}catch{}else try{U.setAttribute(x,"")}catch{}},ll=function(x){let U=null,K=null;if(he)x="<remove></remove>"+x;else{const Qe=Qp(x,/^[\r\n\t ]+/);K=Qe&&Qe[0]}Ko==="application/xhtml+xml"&&Jn===ci&&(x='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+x+"</body></html>");const Te=y?y.createHTML(x):x;if(Jn===ci)try{U=new d().parseFromString(Te,Ko)}catch{}if(!U||!U.documentElement){U=I.createDocument(Jn,"template",null);try{U.documentElement.innerHTML=qo?C:Te}catch{}}const xt=U.body||U.documentElement;return x&&K&&xt.insertBefore(t.createTextNode(K),xt.childNodes[0]||null),Jn===ci?q.call(U,_t?"html":"body")[0]:_t?U.documentElement:xt},Ds=function(x){return F.call(x.ownerDocument||x,x,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT|c.SHOW_PROCESSING_INSTRUCTION|c.SHOW_CDATA_SECTION,null)},Ms=function(x){return x instanceof h&&(typeof x.nodeName!="string"||typeof x.textContent!="string"||typeof x.removeChild!="function"||!(x.attributes instanceof u)||typeof x.removeAttribute!="function"||typeof x.setAttribute!="function"||typeof x.namespaceURI!="string"||typeof x.insertBefore!="function"||typeof x.hasChildNodes!="function")},hn=function(x){return typeof a=="function"&&x instanceof a};function dn(z,x,U){ih(z,K=>{K.call(e,x,U,yo)})}const cl=function(x){let U=null;if(dn(M.beforeSanitizeElements,x,null),Ms(x))return ii(x),!0;const K=vt(x.nodeName);if(dn(M.uponSanitizeElement,x,{tagName:K,allowedTags:j}),Pe&&x.hasChildNodes()&&!hn(x.firstElementChild)&&Ei(/<[/\w!]/g,x.innerHTML)&&Ei(/<[/\w!]/g,x.textContent)||x.nodeType===Bl.progressingInstruction||Pe&&x.nodeType===Bl.comment&&Ei(/<[/\w]/g,x.data))return ii(x),!0;if(!(gt.tagCheck instanceof Function&&gt.tagCheck(K))&&(!j[K]||ft[K])){if(!ft[K]&&hl(K)&&(oe.tagNameCheck instanceof RegExp&&Ei(oe.tagNameCheck,K)||oe.tagNameCheck instanceof Function&&oe.tagNameCheck(K)))return!1;if(Dr&&!Ki[K]){const Te=E(x)||x.parentNode,xt=T(x)||x.childNodes;if(xt&&Te){const Qe=xt.length;for(let St=Qe-1;St>=0;--St){const Zi=b(xt[St],!0);Zi.__removalCount=(x.__removalCount||0)+1,Te.insertBefore(Zi,_(x))}}}return ii(x),!0}return x instanceof l&&!Br(x)||(K==="noscript"||K==="noembed"||K==="noframes")&&Ei(/<\/no(script|embed|frames)/i,x.innerHTML)?(ii(x),!0):(Ge&&x.nodeType===Bl.text&&(U=x.textContent,ih([ae,ee,R],Te=>{U=Dl(U,Te," ")}),x.textContent!==U&&(Pl(e.removed,{element:x.cloneNode()}),x.textContent=U)),dn(M.afterSanitizeElements,x,null),!1)},ul=function(x,U,K){if(nl&&(U==="id"||U==="name")&&(K in t||K in fu))return!1;if(!(Se&&!$e[U]&&Ei(X,U))){if(!(te&&Ei(O,U))){if(!(gt.attributeCheck instanceof Function&&gt.attributeCheck(U,x))){if(!de[U]||$e[U]){if(!(hl(x)&&(oe.tagNameCheck instanceof RegExp&&Ei(oe.tagNameCheck,x)||oe.tagNameCheck instanceof Function&&oe.tagNameCheck(x))&&(oe.attributeNameCheck instanceof RegExp&&Ei(oe.attributeNameCheck,U)||oe.attributeNameCheck instanceof Function&&oe.attributeNameCheck(U,x))||U==="is"&&oe.allowCustomizedBuiltInElements&&(oe.tagNameCheck instanceof RegExp&&Ei(oe.tagNameCheck,K)||oe.tagNameCheck instanceof Function&&oe.tagNameCheck(K))))return!1}else if(!Is[U]){if(!Ei(ie,Dl(K,ne,""))){if(!((U==="src"||U==="xlink:href"||U==="href")&&x!=="script"&&Wq(K,"data:")===0&&ol[x])){if(!(Me&&!Ei(W,Dl(K,ne,"")))){if(K)return!1}}}}}}}return!0},hl=function(x){return x!=="annotation-xml"&&Qp(x,Y)},mu=function(x){dn(M.beforeSanitizeAttributes,x,null);const{attributes:U}=x;if(!U||Ms(x))return;const K={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:de,forceKeepAttr:void 0};let Te=U.length;for(;Te--;){const xt=U[Te],{name:Qe,namespaceURI:St,value:Zi}=xt,kt=vt(Qe),Ns=Zi;let Wt=Qe==="value"?Ns:jq(Ns);if(K.attrName=kt,K.attrValue=Wt,K.keepAttr=!0,K.forceKeepAttr=void 0,dn(M.uponSanitizeAttribute,x,K),Wt=K.attrValue,du&&(kt==="id"||kt==="name")&&(er(Qe,x),Wt=rl+Wt),Pe&&Ei(/((--!?|])>)|<\/(style|title|textarea)/i,Wt)){er(Qe,x);continue}if(kt==="attributename"&&Qp(Wt,"href")){er(Qe,x);continue}if(K.forceKeepAttr)continue;if(!K.keepAttr){er(Qe,x);continue}if(!G&&Ei(/\/>/i,Wt)){er(Qe,x);continue}Ge&&ih([ae,ee,R],yb=>{Wt=Dl(Wt,yb," ")});const _b=vt(x.nodeName);if(!ul(_b,kt,Wt)){er(Qe,x);continue}if(y&&typeof f=="object"&&typeof f.getAttributeType=="function"&&!St)switch(f.getAttributeType(_b,kt)){case"TrustedHTML":{Wt=y.createHTML(Wt);break}case"TrustedScriptURL":{Wt=y.createScriptURL(Wt);break}}if(Wt!==Ns)try{St?x.setAttributeNS(St,Qe,Wt):x.setAttribute(Qe,Wt),Ms(x)?ii(x):tx(e.removed)}catch{er(Qe,x)}}dn(M.afterSanitizeAttributes,x,null)},A=function z(x){let U=null;const K=Ds(x);for(dn(M.beforeSanitizeShadowDOM,x,null);U=K.nextNode();)dn(M.uponSanitizeShadowNode,U,null),cl(U),mu(U),U.content instanceof o&&z(U.content);dn(M.afterSanitizeShadowDOM,x,null)};return e.sanitize=function(z){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},U=null,K=null,Te=null,xt=null;if(qo=!z,qo&&(z="<!-->"),typeof z!="string"&&!hn(z))if(typeof z.toString=="function"){if(z=z.toString(),typeof z!="string")throw Ml("dirty is not a string, aborting")}else throw Ml("toString is not a function");if(!e.isSupported)return z;if(It||Ps(x),e.removed=[],typeof z=="string"&&(un=!1),un){if(z.nodeName){const Zi=vt(z.nodeName);if(!j[Zi]||ft[Zi])throw Ml("root node is forbidden and cannot be sanitized in-place")}}else if(z instanceof a)U=ll("<!---->"),K=U.ownerDocument.importNode(z,!0),K.nodeType===Bl.element&&K.nodeName==="BODY"||K.nodeName==="HTML"?U=K:U.appendChild(K);else{if(!We&&!Ge&&!_t&&z.indexOf("<")===-1)return y&&li?y.createHTML(z):z;if(U=ll(z),!U)return We?null:li?C:""}U&&he&&ii(U.firstChild);const Qe=Ds(un?z:U);for(;Te=Qe.nextNode();)cl(Te),mu(Te),Te.content instanceof o&&A(Te.content);if(un)return z;if(We){if(xi)for(xt=V.call(U.ownerDocument);U.firstChild;)xt.appendChild(U.firstChild);else xt=U;return(de.shadowroot||de.shadowrootmode)&&(xt=Q.call(n,xt,!0)),xt}let St=_t?U.outerHTML:U.innerHTML;return _t&&j["!doctype"]&&U.ownerDocument&&U.ownerDocument.doctype&&U.ownerDocument.doctype.name&&Ei(JT,U.ownerDocument.doctype.name)&&(St="<!DOCTYPE "+U.ownerDocument.doctype.name+`>
`+St),Ge&&ih([ae,ee,R],Zi=>{St=Dl(St,Zi," ")}),y&&li?y.createHTML(St):St},e.setConfig=function(){let z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ps(z),It=!0},e.clearConfig=function(){yo=null,It=!1},e.isValidAttribute=function(z,x,U){yo||Ps({});const K=vt(z),Te=vt(x);return ul(K,Te,U)},e.addHook=function(z,x){typeof x=="function"&&Pl(M[z],x)},e.removeHook=function(z,x){if(x!==void 0){const U=Hq(M[z],x);return U===-1?void 0:Gq(M[z],U,1)[0]}return tx(M[z])},e.removeHooks=function(z){M[z]=[]},e.removeAllHooks=function(){M=ax()},e}var aX=eA();const lX={content:"",bindTo:void 0,placement:"top",offset:[0,8],hidden:!0};var cX=".style_module_popup__d19738e9{box-shadow:0 2px 8px rgba(0,0,0,.15);opacity:0;pointer-events:auto;position:absolute;transition:opacity .15s ease,visibility .15s ease;visibility:hidden;z-index:1}.style_module_visible__d19738e9{opacity:1;transition:opacity .4s ease,visibility .4s ease;visibility:visible}",nm={popup:"style_module_popup__d19738e9",visible:"style_module_visible__d19738e9"};Pr(cX,{});let PK=class{constructor(e,t){m(this,"_internalApi");m(this,"_config");m(this,"_popupContent");m(this,"_popupElement");m(this,"_isVisible",!1);m(this,"_lastBindId");m(this,"_lastBindIndex");m(this,"_initialize",()=>{this._popupElement=this._internalApi.popupElement,this._initializePopupContent(),requestAnimationFrame(()=>this.setConfig(this._config)),this._internalApi.addEventListener("onSimulationTick",this._render),this._internalApi.addEventListener("onZoom",this._render),this._internalApi.addEventListener("onDrag",this._render),this._internalApi.addEventListener("reset",this._reset),this._internalApi.addEventListener("graphRebuilt",this._reset)});m(this,"_initializePopupContent",()=>{this._popupContent||(this._popupContent=document.createElement("div"),this._popupContent.classList.add(nm.popup),this._popupElement.appendChild(this._popupContent))});m(this,"_updatePosition",()=>{const{bindTo:e}=this._config;this._internalApi.cosmosInitialized&&e!==void 0&&(typeof e=="number"?this._showOnPointIndex(e):typeof e=="string"?this._showOnPointId(e):Array.isArray(e)&&this._showAt(e))});m(this,"_render",()=>{this._isVisible&&this._updatePosition()});m(this,"_removePopupContent",()=>{var e;this._isVisible=!1,(e=this._popupContent)==null||e.remove(),this._popupContent=void 0});m(this,"_reset",()=>{this._lastBindId=void 0,this._lastBindIndex=void 0,this._render()});m(this,"remove",()=>{this._lastBindId=void 0,this._lastBindIndex=void 0,this._internalApi.removeEventListener("onSimulationTick",this._render),this._internalApi.removeEventListener("onZoom",this._render),this._internalApi.removeEventListener("onDrag",this._render),this._internalApi.removeEventListener("reset",this._reset),this._internalApi.removeEventListener("graphRebuilt",this._reset),this.hide(),this._popupContent&&this._popupContent.addEventListener("transitionend",()=>this._removePopupContent(),{once:!0})});this._internalApi=Cs(e),this._config={...lX,...t},this._initialize()}_showAt(e){var d,f;const t=aX.sanitize(this._config.content??"",{USE_PROFILES:{html:!0}});if(!this._popupContent)return;this._popupContent.innerHTML=t,this._popupContent.style.display="block";const{placement:n="bottom",offset:r=[0,8]}=this._config,o=(d=this._popupContent)==null?void 0:d.offsetWidth,s=(f=this._popupContent)==null?void 0:f.offsetHeight,a=this._internalApi.public.spaceToScreenPosition(e);if(!a)return this._removePopupContent();const[l,c]=a,u=l-o/2+r[0],h=n==="bottom"?c+r[1]:c-s-r[1];this._popupContent.style.left=`${u}px`,this._popupContent.style.top=`${h}px`,this._popupContent.style.display="block"}_showOnPointIndex(e){const{placement:t}=this._config;this._internalApi.configManager.configUpdated().then(async()=>{const n=this._internalApi.public.getPointPositionByIndex(e);if(!n)return this._removePopupContent();const[r,o]=n;if(r==null||o==null)return this._removePopupContent();const s=this._internalApi.public.getPointScreenRadiusByIndex(e)/2/this._internalApi.public.getZoomLevel(),a=o+(t==="bottom"?-s:s);this._showAt([r,a])})}_showOnPointId(e){this._lastBindId!==e||this._lastBindIndex===void 0?this._internalApi.configManager.cosmosInitialized().then(async()=>{const t=await this._internalApi.public.getPointIndicesByIds([e]);if(!t||t[0]===void 0)return this._removePopupContent();const n=t[0];this._lastBindId=e,this._lastBindIndex=n,this._showOnPointIndex(n)}):this._showOnPointIndex(this._lastBindIndex)}setConfig(e){this._config={...this._config,...e},this._config.hidden||this._updatePosition(),(e==null?void 0:e.hidden)!==void 0&&(this._config.hidden?this.hide():this._config.hidden||this.show())}hide(){var e;this._isVisible&&(this._isVisible=!1,(e=this._popupContent)==null||e.classList.remove(nm.visible))}show(){var e;this._isVisible||(this._isVisible=!0,(e=this._popupContent)==null||e.classList.add(nm.visible))}};const uX={useLinksData:!1,hideWhenSizeMoreThan:120,selectOnClick:!0,useQuantiles:!0,minSubLabel:"and less",maxSubLabel:"and more"};var hX=".style_module_selected__91af67ac{filter:brightness(1.2)}.style_module_unselected__91af67ac{filter:brightness(.5);opacity:.7}",So={selected:"style_module_selected__91af67ac",unselected:"style_module_unselected__91af67ac"};Pr(hX,{});class MK extends Uf{constructor(){super(...arguments);m(this,"_uiComponentConfig",{});m(this,"_extent");m(this,"_manuallyHidden",!1);m(this,"_originalMaxValue",0);m(this,"_pointSizeScaleUpdateHandler");m(this,"_linkWidthScaleUpdateHandler");m(this,"_pointSizeUpdateHandler");m(this,"_linkWidthUpdateHandler");m(this,"_currentSizeAccessor");m(this,"_currentExtent");m(this,"_remapValues",async t=>{const n=await this._getMappingFunction();return n?t.map(r=>+n(r)):t});m(this,"_getExtentAndRange",async()=>{const t=await this._calculateExtent();return!t||isNaN(t==null?void 0:t[0])||isNaN(t==null?void 0:t[1])?{extent:void 0,range:void 0}:{extent:t,range:await this._calculateRange(t)}});m(this,"_onSizeScaleUpdated",async()=>{await this._updateLegend()});m(this,"_onSizeUpdated",async()=>{var t;await this._internalApi.configManager.configUpdated(),this._currentExtent=this._uiComponentConfig.extentLabels,this._currentSizeAccessor!==this.accessor?await this.fetchData():await this._updateExtents(),await this._updateLegend(),Bc(this._currentExtent,this._uiComponentConfig.extentLabels)||((t=this._client)==null||t.resetFilter(),this.onResetClientSelections())})}get _isLinkAggregateStrategy(){const t=this._internalApi.public.activeLinkWidthStrategy;return!!this._config.useLinksData&&[ot.Count,ot.Sum,ot.Average].includes(t)}get _isPointDegreeStrategy(){const t=this._internalApi.public.activePointSizeStrategy;return!this._config.useLinksData&&[Tt.Degree,Tt.PreciseDegree].includes(t)}get domain(){var n;const t=(n=this._currentData)==null?void 0:n.toArray()[0];return this._currentData?[t.min,t.max]:void 0}get defaultConfig(){return uX}get accessor(){const{linkWidthBy:t,pointSizeBy:n,pointIndexBy:r}=this._internalApi.config,o=this._isPointDegreeStrategy?r:n,s=t;return this._config.useLinksData?s:o}get _hasClickableEvents(){const{onClick:t,onMaxClick:n,onMinClick:r,overrideExtent:o}=this._config;return!o||t!==void 0||n!==void 0||r!==void 0}onInitialize(){this._pointSizeScaleUpdateHandler=async()=>{this._config.useLinksData||await this._onSizeScaleUpdated()},this._linkWidthScaleUpdateHandler=async()=>{this._config.useLinksData&&await this._onSizeScaleUpdated()},this._pointSizeUpdateHandler=async()=>{this._config.useLinksData||await this._onSizeUpdated()},this._linkWidthUpdateHandler=async()=>{this._config.useLinksData&&await this._onSizeUpdated()},this._internalApi.addEventListener("pointSizeScaleUpdated",this._pointSizeScaleUpdateHandler),this._internalApi.addEventListener("linkWidthScaleUpdated",this._linkWidthScaleUpdateHandler),this._internalApi.addEventListener("pointSizeUpdated",this._pointSizeUpdateHandler),this._internalApi.addEventListener("linkWidthUpdated",this._linkWidthUpdateHandler)}createUIComponent(t){return new Gj(t,this.createComponentConfig(this._config))}createComponentConfig(t){return{...t,onClick:n=>{var r,o;(o=(r=this._config).onClick)==null||o.call(r,n)},onHover:n=>{var r,o;(o=(r=this._config).onHover)==null||o.call(r,n)},onMaxClick:(n,r,o)=>{var s,a;(a=(s=this._config).onMaxClick)==null||a.call(s,n,r,o),this._hasClickableEvents&&this.onSelect("max")},onMinClick:(n,r,o)=>{var s,a;(a=(s=this._config).onMinClick)==null||a.call(s,n,r,o),this._hasClickableEvents&&this.onSelect("min")}}}compareSelectedItem(t){return this.selected===t}setSelectedItem(t){var n;if((n=this._uiComponent)!=null&&n.sizeElements)if(t){const r=t,o=t==="min"?"max":"min";this._uiComponent.sizeElements[r].classList.remove(So.unselected),this._uiComponent.sizeElements[r].classList.add(So.selected),this._uiComponent.sizeElements[o].classList.remove(So.selected),this._uiComponent.sizeElements[o].classList.add(So.unselected)}else this._uiComponent.sizeElements.min.classList.remove(So.selected,So.unselected),this._uiComponent.sizeElements.max.classList.remove(So.selected,So.unselected)}_filterPointsByDegree(t,n){if(!this._isPointDegreeStrategy)return;const{public:{pointDegrees:r}}=this._internalApi;return t!==void 0&&(r!=null&&r.length)?pb(r,t,n):void 0}applyFilter(t){var n,r,o,s,a,l,c,u,h,d,f,p;if(t==="min")if(this._isPointDegreeStrategy){const b=this._filterPointsByDegree((n=this._extent)==null?void 0:n[0],(g,_)=>g<=_);(r=this._client)==null||r.applyInFilter(b)}else if(this._isLinkAggregateStrategy){const b=this._createLinkAggregatePredicate((o=this._extent)==null?void 0:o[0],"min");(s=this._client)==null||s.applyFilter(b)}else(l=this._client)==null||l.applyLessOrEqFilter((a=this._extent)==null?void 0:a[0]);else if(this._isPointDegreeStrategy){const b=this._filterPointsByDegree((c=this._extent)==null?void 0:c[1],(g,_)=>g>=_);(u=this._client)==null||u.applyInFilter(b)}else if(this._isLinkAggregateStrategy){const b=this._createLinkAggregatePredicate((h=this._extent)==null?void 0:h[1],"max");(d=this._client)==null||d.applyFilter(b)}else(p=this._client)==null||p.applyGreaterOrEqFilter((f=this._extent)==null?void 0:f[1])}async getCurrentData(){await this._internalApi.configManager.configUpdated();const{summary:{linksSummary:t,pointsSummary:n}}=this._internalApi,r=this._config.useLinksData?t:n,o=r==null?void 0:r.find(s=>s.column_name===this.accessor);if(o)return this._config.useQuantiles?await this._getQuantiledExtentDataForColumn():X3({min:[Number(o.min)],max:[Number(o.max)]})}async fetchData(){var n;this._currentSizeAccessor=this.accessor,this.onResetClientSelections();const{public:{activeLinkWidthStrategy:t}}=this._internalApi;this._config.useLinksData&&t===ot.Count?(this._isValidAccessor=!0,this._currentData=void 0,(n=this._client)==null||n.setActive(!0)):await super.fetchData(),await this._updateExtents(),this._uiComponentConfig.extent===void 0&&this._uiComponent.showState()}async onConfigUpdate(){this._manuallyHidden=!!this._config.hidden,await this._updateLegend()}async shouldUpdateComponentData(){return!this._currentSizeAccessor||(await this._internalApi.configManager.configUpdated(),this._currentSizeAccessor!==this.accessor)}_getPointsDegreeExtent(){const{public:{activePointSizeStrategy:t,pointDegrees:n}}=this._internalApi;if(!(n!=null&&n.length))return[0,0];if(t===Tt.Degree)return Gc(n,va);const[r,o]=Yi(n);return va(r,o)}async _getQuantiledExtentDataForColumn(){const t=`
        SELECT 
          quantile("${this.accessor}", ${hu}) as min,
          quantile("${this.accessor}", ${uu}) as max
        FROM ${this.tableName}
      `;return await this._internalApi.dbCoordinator.query(t)}_calculateExtent(){const{public:{activeLinkWidthStrategy:t}}=this._internalApi,n=t===ot.Count;if(!this._config.useLinksData)return this._isPointDegreeStrategy?this._getPointsDegreeExtent():this.domain;if(this._isLinkAggregateStrategy){if(!n&&!this.accessor)return;const{linkAggregationManager:{countCache:r,widthSumCache:o}}=this._internalApi;if(!r||r.size===0)return this.domain;const s=Array.from(r.entries(),([a,l])=>{if(n)return l;if(t===ot.Sum)return(o==null?void 0:o.get(a))??0;{const c=(o==null?void 0:o.get(a))??0;return l>0?c/l:0}});return Gc(s,n?va:void 0)}return this.domain}async _calculateRange(t){const{config:n,public:{activePointSizeStrategy:r}}=this._internalApi;return this._config.useLinksData||n.pointSizeByFn&&r!==Tt.Auto&&!this._isPointDegreeStrategy?await this._remapValues(t):r===Tt.Direct?t:n.pointSizeRange||fc}async _updateExtents(){const{public:{activePointSizeStrategy:t,activeLinkWidthStrategy:n}}=this._internalApi;if(!this._isValidAccessor||!this.useLinksData&&t===Tt.Single||this.useLinksData&&n===ot.Single)this._uiComponentConfig.extent=void 0;else if(this._config.overrideExtent)this._uiComponentConfig.extent=this._config.overrideExtent,this._uiComponentConfig.extentLabels=this._config.overrideExtent;else{const{extent:r,range:o}=await this._getExtentAndRange();(r||r&&this._isPointDegreeStrategy&&(r[0]!==0||r[1]!==0))&&o?(this._originalMaxValue=r[1],this._extent=r,this._uiComponentConfig.extent=o[0]<0?[0,o[1]]:o,this._uiComponentConfig.extentLabels=this._config.extentLabels??[r[0],r[1]]):this._uiComponentConfig.extent=void 0}}async _updateLegend(){await this._updateSizeMultiplier(),this._updateLegendVisibility(),this._checkEvents(),this._updateLabels(),this._uiComponentConfig.form=this._config.useLinksData?"line":"point",this._uiComponent.setConfig(this.createComponentConfig({...this._config,...this._uiComponentConfig}))}_updateLabels(){const{showSublabels:t,useQuantiles:n}=this._config,{public:{activePointSizeStrategy:r}}=this._internalApi,o=this._getLabelValue();this._uiComponentConfig.label=o,this._uiComponentConfig.showSublabels=t??(this._isPointDegreeStrategy?r===Tt.Degree:n)}_checkEvents(){const{enableEvents:t,overrideExtent:n,onHover:r}=this._config;let o=t??!0;n&&(o=t??(this._hasClickableEvents||r!==void 0)),this._uiComponentConfig.enableEvents=o}_updateLegendVisibility(){const{extent:t,sizeMultiplier:n}=this._uiComponentConfig,{hideWhenSizeMoreThan:r}=this._config;let o=this._manuallyHidden;if(!o&&t){const s=n?n*t[1]:t[1];r&&r<s&&(o=!0)}this._uiComponentConfig.hidden=o}async _updateSizeMultiplier(){const{config:t}=this._internalApi,n=this._internalApi.public.getZoomLevel()??1,r=this._config.useLinksData?t.scaleLinksOnZoom:t.scalePointsOnZoom,o=this._config.useLinksData?t.linkWidthScale??1:t.pointSizeScale??1;this._uiComponentConfig.sizeMultiplier=r?o*n:o,r&&await this._updateMaxLabel()}async _updateMaxLabel(){const{config:t,public:{maxPointSize:n}}=this._internalApi,{extentLabels:r,sizeMultiplier:o}=this._uiComponentConfig;if(t.pointSizeByFn&&r&&!this._uiComponent.isHidden&&o){const s=await this._calcVisibleMaxLabel(n/o,r[0],this._originalMaxValue);this._uiComponentConfig.extentLabels=[r[0],s]}}async _calcVisibleMaxLabel(t,n,r){const o=await this._getMappingFunction();if(o){const s=t/o(1),a=Math.min(Math.abs(r),Math.max(Math.abs(n),Math.abs(s))),l=Math.sign(r)*a;let c=0;const u=Math.abs(l);return u>0&&(c=u<.001?6:u<.01?4:u<.1?3:u<1?2:u<10?1:0),Number(l.toFixed(c))}return 0}_getLabelValue(){const{useLinksData:t,overrideExtent:n}=this._config,{public:{activeLinkWidthStrategy:r}}=this._internalApi;if(this._isLinkAggregateStrategy)return r===ot.Count?"count":r===ot.Sum?`sum by ${this.accessor}`:r===ot.Average?`average by ${this.accessor}`:this.accessor;if(!n&&!t&&this._isPointDegreeStrategy)return"connections count";const o=this._config.labelResolver;return o&&typeof o=="function"?o(this.accessor):o??this.accessor}async _getMappingFunction(){return this._config.useLinksData?await this._internalApi.public.getActiveLinkWidthFn():await this._internalApi.public.getActivePointSizeFn()}_createLinkAggregatePredicate(t,n){if(t===void 0)return;const{public:{activeLinkWidthStrategy:r}}=this._internalApi,{linkSourceIndexBy:o,linkTargetIndexBy:s,linkWidthBy:a}=this._internalApi.config;if(!o||!s)return;let l,c;switch(r){case ot.Count:l=G_();break;case ot.Sum:if(!a)return;l=Ht(a);break;case ot.Average:if(!a)return;l=b2(a);break;default:return}c=n==="min"?j_(l,$i(t)):Y_(l,$i(t));const u=Qt.from(this.tableName).select(o,s).groupby(o,s).having(c);return Qc`(${Ci(o)}, ${Ci(s)}) IN (${u})`}hide(){this._manuallyHidden=!0,this.checkReady(()=>this.hide())&&this._uiComponent.hide()}show(){this._manuallyHidden=!1,this.checkReady(()=>this.show())&&this._uiComponent.show()}remove(){this._internalApi.removeEventListener("pointSizeScaleUpdated",this._pointSizeScaleUpdateHandler),this._internalApi.removeEventListener("linkWidthScaleUpdated",this._linkWidthScaleUpdateHandler),this._internalApi.removeEventListener("pointSizeUpdated",this._pointSizeUpdateHandler),this._internalApi.removeEventListener("linkWidthUpdated",this._linkWidthUpdateHandler),super.remove()}}const dX={useLinksData:!1,selectOnClick:!0,steps:10,overrideColors:void 0,useQuantiles:!0,useDiscreteColors:!1,minSubLabel:"and less",maxSubLabel:"and more"};var fX=".style_module_selected__12a865d0{filter:brightness(1.2)}.style_module_unselected__12a865d0{filter:brightness(.5);opacity:.7}",Eo={selected:"style_module_selected__12a865d0",unselected:"style_module_unselected__12a865d0"};Pr(fX,{});class NK extends Uf{constructor(){super(...arguments);m(this,"_uiComponentConfig",{});m(this,"_linkColorUpdateHandler");m(this,"_pointColorUpdateHandler");m(this,"_extent");m(this,"_currentColorAccessor");m(this,"_currentExtent");m(this,"_remapValues",async t=>{if(!t)return;const[n,r]=t,o=await this._getMappingFunction();return o?Array.from({length:this._config.steps},(s,a)=>{const l=n+a/(this._config.steps-1)*(r-n);return o(l)}):void 0});m(this,"_getExtentAndRange",async()=>{const t=await this._calculateExtent();return!t||isNaN(t==null?void 0:t[0])||isNaN(t==null?void 0:t[1])?{extent:void 0,range:void 0}:{extent:t,range:await this._calculateRange(t)}})}get _isLinkAggregateStrategy(){const t=this._internalApi.public.activeLinkColorStrategy;return!!this._config.useLinksData&&[He.Count,He.Sum,He.Average].includes(t)}get _isPointDegreeStrategy(){const t=this._internalApi.public.activePointColorStrategy;return!this._config.useLinksData&&[Re.Degree,Re.PreciseDegree].includes(t)}get domain(){var n;const t=(n=this._currentData)==null?void 0:n.toArray()[0];return this._currentData?[t.min,t.max]:void 0}get defaultConfig(){return dX}get accessor(){const{linkColorBy:t,pointColorBy:n,pointIndexBy:r}=this._internalApi.config,o=this._isPointDegreeStrategy?r:n,s=t;return this._config.useLinksData?s:o}get _hasClickableEvents(){const{onClick:t,onMaxClick:n,onMinClick:r,overrideColors:o}=this._config;return!o||t!==void 0||n!==void 0||r!==void 0}onInitialize(){this._linkColorUpdateHandler=async()=>{this._config.useLinksData&&await this._onColorUpdated()},this._pointColorUpdateHandler=async()=>{this._config.useLinksData||await this._onColorUpdated()},this._internalApi.addEventListener("pointColorUpdated",this._pointColorUpdateHandler),this._internalApi.addEventListener("linkColorUpdated",this._linkColorUpdateHandler)}createUIComponent(t){return new Qj(t,this.createComponentConfig(this._config))}createComponentConfig(t){return{...t,onClick:n=>{var r,o;(o=(r=this._config).onClick)==null||o.call(r,n)},onHover:n=>{var r,o;(o=(r=this._config).onHover)==null||o.call(r,n)},onMaxClick:(n,r,o)=>{var s,a;(a=(s=this._config).onMaxClick)==null||a.call(s,n,r,o),this._hasClickableEvents&&this.onSelect("max")},onMinClick:(n,r,o)=>{var s,a;(a=(s=this._config).onMinClick)==null||a.call(s,n,r,o),this._hasClickableEvents&&this.onSelect("min")}}}compareSelectedItem(t){return this.selected===t}setSelectedItem(t){var n,r,o,s,a,l;if(t){const c=t,u=t==="min"?"max":"min";(n=this._uiComponent.extentElements)==null||n[c].classList.remove(Eo.unselected),(r=this._uiComponent.extentElements)==null||r[c].classList.add(Eo.selected),(o=this._uiComponent.extentElements)==null||o[u].classList.remove(Eo.selected),(s=this._uiComponent.extentElements)==null||s[u].classList.add(Eo.unselected)}else(a=this._uiComponent.extentElements)==null||a.min.classList.remove(Eo.selected,Eo.unselected),(l=this._uiComponent.extentElements)==null||l.max.classList.remove(Eo.selected,Eo.unselected)}_filterPointsByDegree(t,n){if(!this._isPointDegreeStrategy)return;const{public:{pointDegrees:r}}=this._internalApi;return t!==void 0&&(r!=null&&r.length)?pb(r,t,n):void 0}applyFilter(t){var n,r,o,s,a,l,c,u,h,d,f,p;if(t==="min")if(this._isPointDegreeStrategy){const b=this._filterPointsByDegree((n=this._extent)==null?void 0:n[0],(g,_)=>g<=_);(r=this._client)==null||r.applyInFilter(b)}else if(this._isLinkAggregateStrategy){const b=this._createLinkAggregatePredicate((o=this._extent)==null?void 0:o[0],"min");(s=this._client)==null||s.applyFilter(b)}else(l=this._client)==null||l.applyLessOrEqFilter((a=this._extent)==null?void 0:a[0]);else if(this._isPointDegreeStrategy){const b=this._filterPointsByDegree((c=this._extent)==null?void 0:c[1],(g,_)=>g>=_);(u=this._client)==null||u.applyInFilter(b)}else if(this._isLinkAggregateStrategy){const b=this._createLinkAggregatePredicate((h=this._extent)==null?void 0:h[1],"max");(d=this._client)==null||d.applyFilter(b)}else(p=this._client)==null||p.applyGreaterOrEqFilter((f=this._extent)==null?void 0:f[1])}async getCurrentData(){await this._internalApi.configManager.configUpdated();const{summary:{linksSummary:t,pointsSummary:n}}=this._internalApi,r=this._config.useLinksData?t:n,o=r==null?void 0:r.find(s=>s.column_name===this.accessor);if(o)return this._config.useQuantiles?await this._getQuantiledExtentDataForColumn():X3({min:[Number(o.min)],max:[Number(o.max)]})}async fetchData(){var t;this._currentColorAccessor=(t=this.accessor)==null?void 0:t.toString(),this.onResetClientSelections(),await super.fetchData(),await this._updateExtents(),this._uiComponentConfig.extent===void 0&&this._uiComponent.showState()}async onConfigUpdate(){await this._updateLegend()}async shouldUpdateComponentData(){return!this._currentColorAccessor||(await this._internalApi.configManager.configUpdated(),this._currentColorAccessor!==this.accessor)}_createLinkAggregatePredicate(t,n){if(t===void 0)return;const{public:{activeLinkColorStrategy:r}}=this._internalApi,{linkSourceIndexBy:o,linkTargetIndexBy:s,linkColorBy:a}=this._internalApi.config;if(!o||!s)return;let l,c;switch(r){case He.Count:l=G_();break;case He.Sum:if(!a)return;l=Ht(a);break;case He.Average:if(!a)return;l=b2(a);break;default:return}c=n==="min"?j_(l,$i(t)):Y_(l,$i(t));const u=Qt.from(this.tableName).select(o,s).groupby(o,s).having(c);return Qc`(${Ci(o)}, ${Ci(s)}) IN (${u})`}async _onColorUpdated(){var t;await this._internalApi.configManager.configUpdated(),this._currentExtent=this._uiComponentConfig.extentLabels,this._currentColorAccessor!==this.accessor?await this.fetchData():await this._updateExtents(),await this._updateLegend(),Bc(this._currentExtent,this._uiComponentConfig.extentLabels)||((t=this._client)==null||t.resetFilter(),this.onResetClientSelections())}_getPointsDegreeExtent(){const{public:{activePointColorStrategy:t,pointDegrees:n}}=this._internalApi;if(!(n!=null&&n.length))return[0,0];if(t===Re.Degree)return Gc(n,va);const[r,o]=Yi(n);return va(r,o)}async _getQuantiledExtentDataForColumn(){const t=`
        SELECT 
          quantile("${this.accessor}", ${hu}) as min,
          quantile("${this.accessor}", ${uu}) as max
        FROM ${this.tableName}
      `;return await this._internalApi.dbCoordinator.query(t)}_calculateExtent(){const{public:{activeLinkColorStrategy:t}}=this._internalApi,n=t===He.Count;if(!this._config.useLinksData)return this._isPointDegreeStrategy?this._getPointsDegreeExtent():this.domain;if(this._isLinkAggregateStrategy){if(!this.accessor)return;const{linkAggregationManager:{countCache:r,colorSumCache:o}}=this._internalApi;if(!r||r.size===0)return this.domain;const s=Array.from(r.entries(),([a,l])=>{if(n)return l;if(t===He.Sum)return(o==null?void 0:o.get(a))??0;{const c=(o==null?void 0:o.get(a))??0;return l>0?c/l:0}});return Gc(s,n?va:void 0)}return this.domain}async _calculateRange(t){const{public:{activePointColorStrategy:n}}=this._internalApi;if(this._config.useLinksData||n!==Re.Map&&n!==Re.LinkDirection)return await this._remapValues(t);this._uiComponent.showState()}async _getMappingFunction(){return this._config.useLinksData?await this._internalApi.public.getActiveLinkColorFn():await this._internalApi.public.getActivePointColorFn()}async _updateExtents(){const{public:{activePointColorStrategy:t,activeLinkColorStrategy:n}}=this._internalApi;if(!this._isValidAccessor||!this.useLinksData&&t===Re.Single||this.useLinksData&&n===He.Single)this._uiComponentConfig.extent=void 0;else if(this._config.overrideColors)this._uiComponentConfig.extent=this._config.overrideColors,this._uiComponentConfig.extentLabels=this._config.extentLabels;else{const{extent:r,range:o}=await this._getExtentAndRange();r||r&&this._isPointDegreeStrategy&&(r[0]!==0||r[1]!==0)?(this._extent=r,this._uiComponentConfig.extent=o,this._uiComponentConfig.extentLabels=this._config.extentLabels??[r[0],r[1]]):this._uiComponentConfig.extent=void 0}}_checkEvents(){const{enableEvents:t,overrideColors:n,onHover:r}=this._config;let o=t??!0;n&&(o=t??(this._hasClickableEvents||r!==void 0)),this._uiComponentConfig.enableEvents=o}_updateLabels(){const{showSublabels:t,useQuantiles:n}=this._config,{public:{activePointColorStrategy:r}}=this._internalApi;this._uiComponentConfig.label=this._getLabelValue(),this._uiComponentConfig.showSublabels=t??(this._isPointDegreeStrategy?r===Re.Degree:n)}async _updateLegend(){const{public:{activePointColorStrategy:t,activeLinkColorStrategy:n}}=this._internalApi,{overrideColors:r,useDiscreteColors:o}=this._config,s=this._config.useLinksData?n===He.Categorical:t===Re.Categorical;this._uiComponentConfig.discreteColors=r?o:s,this._checkEvents(),this._updateLabels(),this._uiComponent.setConfig(this.createComponentConfig({...this._config,...this._uiComponentConfig}))}_getLabelValue(){const{useLinksData:t,overrideColors:n}=this._config,{public:{activeLinkColorStrategy:r}}=this._internalApi;if(this._isLinkAggregateStrategy)return r===He.Count?"count":r===He.Sum?`sum by ${this.accessor}`:r===He.Average?`average by ${this.accessor}`:this.accessor;if(!n&&!t&&this._isPointDegreeStrategy)return"connections count";const o=this._config.labelResolver;return o&&typeof o=="function"?o(this.accessor):o??this.accessor}hide(){this.checkReady(()=>this.hide())&&this._uiComponent.hide()}show(){this.checkReady(()=>this.show())&&this._uiComponent.show()}remove(){this._internalApi.removeEventListener("pointColorUpdated",this._pointColorUpdateHandler),this._internalApi.removeEventListener("linkColorUpdated",this._linkColorUpdateHandler),super.remove()}}const tA={0:"source",1:"source+target",2:"target",3:"not linked"},pX=Object.fromEntries(Object.entries(tA).map(([i,e])=>[e,i])),mX={useLinksData:!1,selectOnClick:!0,hideUnknown:!0,resetSelectionOnCollapse:!0,showLabel:!1};class BK extends Uf{constructor(){super(...arguments);m(this,"_uiComponentConfig",{});m(this,"_linkColorUpdateHandler");m(this,"_pointColorUpdateHandler");m(this,"_currentColorAccessor");m(this,"_fetchDataPromise",null);m(this,"_onColorUpdated",async()=>{this._fetchDataPromise&&await this._fetchDataPromise,await this._internalApi.configManager.configUpdated(),this._currentColorAccessor!==this.accessor?await this.fetchData():await this._updateItems(),await this._updateLegend()})}get _summary(){const{summary:{linksSummary:t,pointsSummary:n}}=this._internalApi;return this._config.useLinksData?t:n}get _isLinkDirectionStrategy(){return!this.useLinksData&&this._internalApi.public.activePointColorStrategy===Re.LinkDirection}get defaultConfig(){return mX}get accessor(){const{linkColorBy:t,pointColorBy:n,pointIndexBy:r}=this._internalApi.config;return this._config.useLinksData?t:this._isLinkDirectionStrategy?r:n}get _hasClickableEvents(){const{onClick:t,overrideItems:n}=this._config;return!n||t!==void 0}onInitialize(){this._linkColorUpdateHandler=async()=>{this._config.useLinksData&&await this._onColorUpdated()},this._pointColorUpdateHandler=async()=>{this._config.useLinksData||await this._onColorUpdated()},this._internalApi.addEventListener("pointColorUpdated",this._pointColorUpdateHandler),this._internalApi.addEventListener("linkColorUpdated",this._linkColorUpdateHandler)}createUIComponent(t){return new lY(t,this.createComponentConfig(this._config))}createComponentConfig(t){return{...t,onClick:(n,r)=>{var o,s;(s=(o=this._config).onClick)==null||s.call(o,n,r),this._hasClickableEvents&&this.onSelect(r)},onHover:(n,r)=>{var o,s;(s=(o=this._config).onHover)==null||s.call(o,n,r)},onShowMoreClick:n=>{var r,o;(o=(r=this._config).onShowMoreClick)==null||o.call(r,n),this._config.resetSelectionOnCollapse&&this.selected&&!n&&this.onSelect(void 0)}}}compareSelectedItem(t){var n;return((n=this.selected)==null?void 0:n.label)===(t==null?void 0:t.label)}setSelectedItem(t){this._uiComponent.setSelectedItem(t)}applyFilter(t){var n,r;if(this._isLinkDirectionStrategy){if(!t)return;const o=Number(pX[t.label]),s=this._internalApi.public.pointDirections;if(!s)return;const a=pb(s,o,(l,c)=>l===c);(n=this._client)==null||n.applyInFilter(a)}else(r=this._client)==null||r.applyExactFilter(t==null?void 0:t.label)}async fetchData(){return this._fetchDataPromise&&await this._fetchDataPromise,this._fetchDataPromise=(async()=>{var t;try{this._currentColorAccessor=(t=this.accessor)==null?void 0:t.toString(),await super.fetchData(),await this._updateItems(),this.onResetClientSelections()}finally{this._fetchDataPromise=null}})(),this._fetchDataPromise}async onConfigUpdate(){await this._updateLegend()}async getCurrentData(){var n;if(await this._internalApi.configManager.configUpdated(),((n=this._summary)==null?void 0:n.find(r=>r.column_name===this.accessor))&&this._summary)return await this._getDistinctValues(this._summary)}async shouldUpdateComponentData(){return!this._currentColorAccessor||(await this._internalApi.configManager.configUpdated(),this._currentColorAccessor!==this.accessor)}async _getDistinctValues(t){var a;const{public:{activePointColorStrategy:n}}=this._internalApi;let r="DESC";!this.useLinksData&&[Re.Continuous,Re.Categorical].includes(n)&&(r=this._config.sortOrder??"DESC");const o=`ORDER BY "${this._config.sortBy??"count"}" ${r}`,s=(a=t.find(l=>l.column_name===this.accessor))==null?void 0:a.column_type;return await this._internalApi.dbCoordinator.query((l=>l==="VARCHAR"?`SELECT "${this.accessor}", COUNT(*) as count 
                FROM ${this.tableName}
                GROUP BY "${this.accessor}"
                ${o}`:`SELECT DISTINCT "${this.accessor}"
                FROM ${this.tableName}
                ORDER BY "${this.accessor}" ${this._config.sortOrder||r}`)(s))}_checkEvents(){const{enableEvents:t,overrideItems:n,onHover:r}=this._config;let o=t??!0;n&&(o=t??(this._hasClickableEvents||r!==void 0)),this._uiComponentConfig.enableEvents=o}async _updateLegend(){this._checkEvents();const t=this.accessor;if(this._config.showLabel){const n=this._config.labelResolver,r=typeof n=="function"?n(t):n;this._uiComponentConfig.label=r??t}else this._uiComponentConfig.label=void 0;this._uiComponent.setConfig(this.createComponentConfig({...this._config,...this._uiComponentConfig}))}async _updateItems(){var o,s;const{activePointColorStrategy:t,activeLinkColorStrategy:n}=this._internalApi.public,{overrideItems:r}=this._config;if(r)this._uiComponentConfig.items=r;else{if(!this.useLinksData&&t===Re.LinkDirection){const c=this._internalApi.public.pointDirections;if(c){const u=Array.from(new Set(c)).map(String);this._uiComponentConfig.items=await this._createLegendItems(u)}return}const a=[Re.Degree,Re.PreciseDegree,Re.Single,Re.Direct].includes(t),l=[He.Direct,He.Single].includes(n);if(!this.accessor||!this.useLinksData&&a||this.useLinksData&&l)return this._uiComponentConfig.items=void 0,void this._uiComponent.showState();if((o=this._currentData)!=null&&o.numRows){const c=(s=this._currentData.getChildAt(0))==null?void 0:s.toArray();if(c)return void(this._uiComponentConfig.items=await this._createLegendItems(c))}this._uiComponentConfig.items=void 0}}async _createLegendItems(t){const{public:{activePointColorStrategy:n},config:r}=this._internalApi,o=await this._getMappingFunction();if(o){const s=no(r==null?void 0:r.unknownColor,il),a=l=>({color:no(o(l),s),label:String(l)});if(!this.useLinksData&&n===Re.LinkDirection)return Array.from(t,l=>({color:no(o(l),s),label:tA[l]}));if(this.useLinksData||n!==Re.Map)return Array.from(t,a);{const l=new Set(Object.keys(r.pointColorByMap??{}));return[...Array.from(t.filter(c=>l.has(c)),a),...this._config.hideUnknown?[]:Array.from(t.filter(c=>!l.has(c)),a)]}}return[]}async _getMappingFunction(){return this._config.useLinksData?await this._internalApi.public.getActiveLinkColorFn():await this._internalApi.public.getActivePointColorFn()}show(){this.checkReady(()=>this.show())&&this._uiComponent.show()}hide(){this.checkReady(()=>this.hide())&&this._uiComponent.hide()}remove(){this._internalApi.removeEventListener("pointColorUpdated",this._pointColorUpdateHandler),this._internalApi.removeEventListener("linkColorUpdated",this._linkColorUpdateHandler),super.remove()}}const gX=`
<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <path d="m21 21-6-6m6 6v-4.8m0 4.8h-4.8"/>
  <path d="M3 16.2V21m0 0h4.8M3 21l6-6"/>
  <path d="M21 7.8V3m0 0h-4.8M21 3l-6 6"/>
  <path d="M3 7.8V3m0 0h4.8M3 3l6 6"/>
</svg>
`,_X={onClick:void 0,iconSvg:gX,duration:250,padding:.1,description:"Fit view"};let OK=class{constructor(e,t,n={}){m(this,"_internalApi");m(this,"_config");m(this,"_uiButtonConfig");m(this,"_fitViewButton");m(this,"_handleClick",()=>{var e,t;(t=(e=this._config).onClick)==null||t.call(e),this._internalApi.public.fitView(this._config.duration,this._config.padding)});m(this,"_show",()=>{this._fitViewButton.show()});this._internalApi=Cs(e),this._fitViewButton=new vs(t),this._internalApi.addEventListener("graphRebuilt",this._show),this.setConfig(n)}setConfig(e={}){this._config=Ct(_X,e),this._uiButtonConfig={...this._config,onClick:this._handleClick},this._fitViewButton.setConfig(this._uiButtonConfig)}remove(){this._fitViewButton.destroy(),this._internalApi.removeEventListener("graphRebuilt",this._show)}};const Ug=`
<svg width="100%" height="100%" viewBox="0 0 15 18" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
  <path d="M15 9L-8.15666e-07 17.6603L-5.85621e-08 0.339745L15 9Z"/>
</svg>`,yX=`
<svg width="100%" height="100%" viewBox="0 0 14 18" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M4.91659 0.666656H0.333252V17.3333H4.91659V0.666656ZM13.6666 0.666656H9.08325V17.3333H13.6666V0.666656Z"/>
</svg>
`,lx={onClick:void 0,iconSvg:Ug,description:"Play/Pause"};let zK=class{constructor(e,t,n={}){m(this,"_internalApi");m(this,"_config",lx);m(this,"_playPauseButton");m(this,"_update",()=>{this._internalApi.cosmos&&(this._internalApi.cosmos.config.enableSimulation===!1?this._playPauseButton.hide():this._playPauseButton.show(),this._config.iconSvg=this._internalApi.public.isSimulationRunning?yX:Ug,this._playPauseButton.setConfig(this._config))});this._internalApi=Cs(e),this._playPauseButton=new vs(t,{iconSvg:Ug}),this._internalApi.addEventListener("onSimulationEnd",this._update),this._internalApi.addEventListener("onSimulationStart",this._update),this._internalApi.addEventListener("onSimulationPause",this._update),this._internalApi.addEventListener("graphRebuilt",this._update),this.setConfig(n)}setConfig(e={}){this._config=Ct(lx,e),this._config.onClick=()=>{var t;if((t=e==null?void 0:e.onClick)==null||t.call(e),this._internalApi.public.progress!==0||this._internalApi.public.isSimulationRunning)if(this._internalApi.public.isSimulationRunning)this._internalApi.public.pause();else{if(this._internalApi.public.progress===1)return void this._internalApi.public.start();this._internalApi.public.unpause()}else this._internalApi.public.start()},this._update()}remove(){this._playPauseButton.destroy(),this._internalApi.removeEventListener("onSimulationEnd",this._update),this._internalApi.removeEventListener("onSimulationStart",this._update),this._internalApi.removeEventListener("onSimulationPause",this._update),this._internalApi.removeEventListener("graphRebuilt",this._update)}};const bX=`
<svg width="100%" height="100%" viewBox="0 0 96 96" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-miterlimit:2;">
    <style type="text/css">
        .st0{fill:none;fill-rule:nonzero;stroke:currentColor;stroke-width:8px;}
    </style>
    <g>
        <path d="M92.8,71.003L92.8,83.2L75.058,83.2" class="st0"/>
        <path d="M65.014,83.2L34.968,83.2" class="st0"/>
        <path d="M24.994,83.2L4,83.2L4,71.003" class="st0"/>
        <path d="M4,60.954L4,35.036" class="st0"/>
        <path d="M4,25.06L4,11.8L24.994,11.8" class="st0"/>
        <path d="M34.968,11.8L65.014,11.8" class="st0"/>
        <path d="M75.058,11.8L92.8,11.8L92.8,25.06" class="st0"/>
        <path d="M92.8,35.036L92.8,60.954" class="st0"/>
    </g>
</svg>
`,cx={onClick:void 0,iconSvg:bX,description:"Rectangle selection"};class $K{constructor(e,t,n={}){m(this,"_internalApi");m(this,"_config");m(this,"_selectRectButton");m(this,"_rectSelectedHandler");m(this,"_show",()=>{this._selectRectButton.show()});this._internalApi=Cs(e),this._config=Ct(cx,n),this._config.onClick=()=>{var r;(r=n==null?void 0:n.onClick)==null||r.call(n),this._internalApi.public.activateRectSelection()},this._selectRectButton=new vs(t,this._config),this._rectSelectedHandler=()=>{this._internalApi.public.deactivateRectSelection()},this._internalApi.addEventListener("graphRebuilt",this._show),this._internalApi.addEventListener("rectSelected",this._rectSelectedHandler)}setConfig(e={}){this._config=Ct(cx,e)}remove(){this._selectRectButton.destroy(),this._internalApi.removeEventListener("graphRebuilt",this._show),this._internalApi.removeEventListener("rectSelected",this._rectSelectedHandler)}}const vX=`
<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" transform="scale(1.15)"><path fill="currentColor" fill-rule="evenodd" d="M21.72.226a1 1 0 0 1 .587.936l-.336 13.583a1 1 0 0 1-.685.924l-8.893 2.948a2.6 2.6 0 0 1-.028.692a2.93 2.93 0 0 1 1.429 1.495c.342.792.33 1.645.198 2.267a1 1 0 0 1-1.956-.417c.07-.328.06-.739-.078-1.056c-.098-.226-.27-.444-.655-.565l-.064.05c-.667.512-1.545.8-2.475.8s-1.808-.288-2.476-.8c-.668-.511-1.165-1.289-1.165-2.224s.497-1.712 1.165-2.224q.232-.178.495-.318L1.782 5.237a1 1 0 0 1 1.092-1.394l11.694 2.146L20.63.402a1 1 0 0 1 1.09-.176m-1.73 13.766l-8.53 2.828a3 3 0 0 0-.22-.185c-.668-.511-1.546-.799-2.476-.799H8.76L4.39 6.154l10.308 1.892a1 1 0 0 0 .859-.248l4.692-4.326zm-12.485 4.23c-.288.22-.382.455-.382.637s.094.416.382.637c.288.22.73.386 1.259.386s.97-.165 1.259-.386c.288-.22.382-.455.382-.637s-.094-.416-.382-.637c-.289-.22-.73-.386-1.26-.386s-.97.165-1.258.386" clip-rule="evenodd"/></svg>
`,ux={onClick:void 0,iconSvg:vX,description:"Polygonal selection"};class VK{constructor(e,t,n={}){m(this,"_internalApi");m(this,"_config");m(this,"_selectPolygonButton");m(this,"_polygonSelectedHandler");m(this,"_show",()=>{this._selectPolygonButton.show()});this._internalApi=Cs(e),this._config=Ct(ux,n),this._config.onClick=()=>{var r;(r=n==null?void 0:n.onClick)==null||r.call(n),this._internalApi.public.activatePolygonalSelection()},this._selectPolygonButton=new vs(t,this._config),this._polygonSelectedHandler=()=>{this._internalApi.public.deactivatePolygonalSelection()},this._internalApi.addEventListener("graphRebuilt",this._show),this._internalApi.addEventListener("polygonSelected",this._polygonSelectedHandler)}setConfig(e={}){this._config=Ct(ux,e)}remove(){this._selectPolygonButton.destroy(),this._internalApi.removeEventListener("graphRebuilt",this._show),this._internalApi.removeEventListener("polygonSelected",this._polygonSelectedHandler)}}const xX=`
<svg width="100%" height="100%" viewBox="0 0 24 24" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
  <path d="M4 12H20M12 4V20" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`,wX=`
<svg width="100%" height="100%" viewBox="0 0 24 24" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
  <path d="M4 12H20" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`,rm={onZoomInClick:void 0,onZoomOutClick:void 0,zoomInIconSvg:xX,zoomOutIconSvg:wX,duration:250,zoomIncrement:1.4};var SX=".style_module_zoomButtons__738b35dc{height:50px;margin:3px;width:25px}.style_module_zoomButton__738b35dc{height:50%;margin:0;width:100%}.style_module_zoomInButton__738b35dc{border-radius:2px 2px 0 0}.style_module_zoomOutButton__738b35dc{border-radius:0 0 2px 2px}",Ol={zoomButtons:"style_module_zoomButtons__738b35dc",zoomButton:"style_module_zoomButton__738b35dc",zoomInButton:"style_module_zoomInButton__738b35dc",zoomOutButton:"style_module_zoomOutButton__738b35dc"};Pr(SX,{});class HK{constructor(e,t,n){m(this,"_internalApi");m(this,"_config");m(this,"_zoomInButtonConfig");m(this,"_zoomOutButtonConfig");m(this,"_zoomInButton");m(this,"_zoomOutButton");m(this,"_zoomInButtonDiv");m(this,"_zoomOutButtonDiv");m(this,"_show",()=>{this._zoomInButton.show(),this._zoomOutButton.show()});this._internalApi=Cs(e),t.classList.add(Ol.zoomButtons),this._zoomInButtonDiv=document.createElement("div"),this._zoomInButtonDiv.classList.add(Ol.zoomButton,Ol.zoomInButton),this._zoomOutButtonDiv=document.createElement("div"),this._zoomOutButtonDiv.classList.add(Ol.zoomButton,Ol.zoomOutButton),t.appendChild(this._zoomInButtonDiv),t.appendChild(this._zoomOutButtonDiv),this._zoomInButton=new vs(this._zoomInButtonDiv),this._zoomOutButton=new vs(this._zoomOutButtonDiv),this._internalApi.addEventListener("graphRebuilt",this._show),this.setConfig(n??{})}setConfig(e){this._config=Ct(rm,e??{}),this._zoomInButtonConfig={onClick:()=>{var n,r;const t=this._internalApi.public.getZoomLevel();if(t){const o=this._config.zoomIncrement??rm.zoomIncrement;this._internalApi.public.setZoomLevel(t*o,this._config.duration)}(r=(n=this._config).onZoomInClick)==null||r.call(n)},iconSvg:this._config.zoomInIconSvg},this._zoomOutButtonConfig={onClick:()=>{var n,r;const t=this._internalApi.public.getZoomLevel();if(t){const o=this._config.zoomIncrement??rm.zoomIncrement;this._internalApi.public.setZoomLevel(t/o,this._config.duration)}(r=(n=this._config).onZoomOutClick)==null||r.call(n)},iconSvg:this._config.zoomOutIconSvg},this._zoomInButton.setConfig(this._zoomInButtonConfig),this._zoomOutButton.setConfig(this._zoomOutButtonConfig)}remove(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._internalApi.removeEventListener("graphRebuilt",this._show)}}class GK{constructor(e,t,n={}){m(this,"_button");this._button=new vs(t,n)}setConfig(e={}){this._button.setConfig(e)}remove(){this._button.destroy()}show(){this._button.show()}hide(){this._button.hide()}}export{se as $,Ve as A,Z as B,LX as C,Jg as D,Yh as E,ZL as F,w4 as G,TX as H,QL as I,OL as J,A4 as K,NK as L,Di as M,hm as N,kX as O,L4 as P,Kg as Q,rc as T,qc as U,vb as _,TH as a,tK as b,IK as c,LK as d,Yi as e,BK as f,CX as g,TK as h,GK as i,OK as j,zK as k,$K as l,_1 as m,iK as n,kK as o,VK as p,HK as q,CK as r,PK as s,nK as t,PX as u,DX as v,AX as w,MK as x,IX as y,EK as z};
