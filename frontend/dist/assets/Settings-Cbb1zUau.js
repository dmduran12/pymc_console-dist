import{c as e,a8 as t,a9 as a,aa as l,j as s,z as r,ab as n,R as i,ac as c,X as d,v as o,ad as m,ae as u,a6 as b}from"./index-B6-Tf7Us.js";import{b as p,c as h}from"./recharts-CGff6_7g.js";import{a as x,M as g,H as v}from"./HashBadge-FDCoxkyp.js";import{P as y,a as N,G as f,c as k,C as w,b as C}from"./PageLayout-7JDu0Wyr.js";import{L as M}from"./loader-circle-C2kvqjon.js";import"./maplibre-gl-DsiI67my.js";const z=e("antenna",[["path",{d:"M2 12 7 2",key:"117k30"}],["path",{d:"m7 12 5-10",key:"1tvx22"}],["path",{d:"m12 12 5-10",key:"ev1o1a"}],["path",{d:"m17 12 5-10",key:"1e4ti3"}],["path",{d:"M4.5 7h15",key:"vlsxkz"}],["path",{d:"M12 16v6",key:"c8a4gj"}]]),L=e("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),H=p.memo(function(){var e;const{theme:r,setThemePreset:n,setBrightness:i}=t(),{backgroundImage:c,brightness:d}=r,[o,m]=p.useState(!1),[u,b]=p.useState(!1),x=p.useRef(null),g=p.useRef(null),v=(null==(e=a.find(e=>e.backgroundImage===c))?void 0:e.id)??"default",y=p.useCallback((e,t)=>{if(!g.current)return d;const a=(g.current.y-e)/(t?200:80)*100;return Math.round(Math.max(0,Math.min(100,g.current.brightness+a)))},[d]),N=p.useCallback(e=>{n(e),m(!0)},[n]),f=p.useCallback(e=>{i(e)},[i]),k=p.useCallback(e=>{const t=a.find(t=>t.id===e);t&&l(t.backgroundImage)},[]);return s.jsx("div",{className:"flex gap-2 items-center flex-shrink-0",children:a.map(e=>{const t=v===e.id,a=t&&(o||u);return s.jsxs("div",{ref:t?x:void 0,className:h("relative rounded-md overflow-hidden transition-all duration-300 ease-out","ring-offset-1 ring-offset-bg-body w-10 h-10",t?"ring-2 ring-accent-primary scale-105 cursor-ns-resize":"ring-1 ring-white/20 hover:ring-white/40 opacity-70 hover:opacity-100 cursor-pointer"),onMouseEnter:()=>{t?m(!0):k(e.id)},onMouseLeave:()=>!u&&m(!1),onClick:()=>!t&&N(e.id),onTouchStart:e=>{if(!t)return;e.preventDefault();const a=e.touches[0];g.current={y:a.clientY,brightness:d},b(!0),m(!0);const l=e=>{e.preventDefault();const t=e.touches[0];f(y(t.clientY,!0))},s=()=>{document.removeEventListener("touchmove",l),document.removeEventListener("touchend",s),g.current=null,b(!1),setTimeout(()=>m(!1),1500)};document.addEventListener("touchmove",l,{passive:!1}),document.addEventListener("touchend",s)},onMouseDown:e=>{if(!t)return;e.preventDefault(),g.current={y:e.clientY,brightness:d},b(!0),m(!0);const a=e=>{f(y(e.clientY,!1))},l=()=>{document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",l),g.current=null,b(!1)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",l)},children:[s.jsx("div",{className:"absolute bg-cover bg-center transition-opacity duration-200",style:{inset:0,backgroundImage:`url(${e.backgroundImage})`,opacity:a?.4:1}}),t&&s.jsxs("div",{className:h("absolute inset-0 transition-opacity duration-200",a?"opacity-100":"opacity-0"),children:[s.jsx("div",{className:"absolute inset-x-0 bottom-0 bg-black/70 transition-all duration-100 ease-out",style:{height:100-d+"%"}}),s.jsx("div",{className:"absolute inset-x-1 h-0.5 bg-white rounded-full shadow-lg transition-all duration-100 ease-out",style:{top:100-d+"%"}}),s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsxs("span",{className:"text-[10px] font-mono font-bold text-white drop-shadow-lg",children:[d,"%"]})})]})]},e.id)})})}),S=[{value:7.8,label:"7.8 kHz"},{value:10.4,label:"10.4 kHz"},{value:15.6,label:"15.6 kHz"},{value:20.8,label:"20.8 kHz"},{value:31.25,label:"31.25 kHz"},{value:41.7,label:"41.7 kHz"},{value:62.5,label:"62.5 kHz"},{value:125,label:"125 kHz"},{value:250,label:"250 kHz"},{value:500,label:"500 kHz"}],j=[5,6,7,8,9,10,11,12],F=[{value:5,label:"4/5"},{value:6,label:"4/6"},{value:7,label:"4/7"},{value:8,label:"4/8"}];function T(){var e,t,a,l;const{stats:T,setMode:I,setDutyCycle:P,fetchStats:B}=r(),D=null==(e=null==T?void 0:T.config)?void 0:e.radio,E=null==(t=null==T?void 0:T.config)?void 0:t.repeater,R=null==(a=null==T?void 0:T.config)?void 0:a.duty_cycle,$=(null==T?void 0:T.node_name)||(null==(l=null==T?void 0:T.config)?void 0:l.node_name)||"Unknown Node",q=(null==E?void 0:E.mode)??"forward",X=(null==R?void 0:R.enforcement_enabled)??!1,[A,O]=p.useState(!1),[U,V]=p.useState(""),[G,K]=p.useState(62.5),[J,Q]=p.useState(7),[W,Y]=p.useState(5),[Z,_]=p.useState(""),[ee,te]=p.useState(!1),[ae,le]=p.useState(null),se=p.useRef(null);p.useEffect(()=>{D&&A&&(V((D.frequency/1e6).toFixed(3)),K(D.bandwidth/1e3),Q(D.spreading_factor),Y(D.coding_rate),_(String(D.tx_power)))},[D,A]);const re=p.useMemo(()=>{if(!D||!A)return!1;const e=D.frequency/1e6,t=D.bandwidth/1e3,a=parseFloat(U)||0;return Math.abs(a-e)>1e-4||G!==t||J!==D.spreading_factor||W!==D.coding_rate||parseInt(Z)!==D.tx_power},[D,A,U,G,J,W,Z]),ne=p.useCallback(()=>{O(!1),le(null),D&&(V((D.frequency/1e6).toFixed(3)),K(D.bandwidth/1e3),Q(D.spreading_factor),Y(D.coding_rate),_(String(D.tx_power)))},[D]);return p.useEffect(()=>{if(!A)return;const e=e=>{se.current&&!se.current.contains(e.target)&&ne()};return document.addEventListener("mouseup",e),()=>{document.removeEventListener("mouseup",e)}},[A,ne]),s.jsxs(y,{children:[s.jsx(N,{title:"Settings",icon:s.jsx(n,{}),controls:s.jsx(H,{})}),s.jsxs(f,{children:[s.jsx(k,{md:6,children:s.jsxs(w,{children:[s.jsx(C,{icon:s.jsx(i,{}),title:"Operating Mode",largeTitle:!0}),s.jsx("p",{className:"type-label text-text-muted mb-4",children:"Control how the repeater handles incoming packets."}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("button",{onClick:()=>I("forward"),className:h("w-full p-3 sm:p-4 rounded-lg border text-left transition-all duration-200 min-h-[64px]","forward"===q?"bg-accent-success/20 border-accent-success/50 text-accent-success":"bg-bg-subtle border-border-subtle text-text-secondary hover:bg-bg-elevated"),children:[s.jsx("div",{className:"font-medium text-sm sm:text-base",children:"Forward Mode"}),s.jsx("div",{className:"text-xs sm:text-sm opacity-70 mt-0.5 sm:mt-1",children:"Receive and retransmit to extend coverage"})]}),s.jsxs("button",{onClick:()=>I("monitor"),className:h("w-full p-3 sm:p-4 rounded-lg border text-left transition-all duration-200 min-h-[64px]","monitor"===q?"bg-accent-secondary/20 border-accent-secondary/50 text-accent-secondary":"bg-bg-subtle border-border-subtle text-text-secondary hover:bg-bg-elevated"),children:[s.jsx("div",{className:"font-medium text-sm sm:text-base",children:"Monitor Mode"}),s.jsx("div",{className:"text-xs sm:text-sm opacity-70 mt-0.5 sm:mt-1",children:"Log packets without retransmitting"})]})]})]})}),s.jsx(k,{md:6,children:s.jsxs(w,{children:[s.jsx(C,{icon:s.jsx(c,{}),title:"Duty Cycle Enforcement",largeTitle:!0}),s.jsx("p",{className:"type-label text-text-muted mb-4",children:"Limit airtime to comply with regulations."}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("button",{onClick:()=>P(!0),className:h("w-full p-3 sm:p-4 rounded-lg border text-left transition-all duration-200 min-h-[64px]",X?"bg-accent-success/20 border-accent-success/50 text-accent-success":"bg-bg-subtle border-border-subtle text-text-secondary hover:bg-bg-elevated"),children:[s.jsx("div",{className:"font-medium text-sm sm:text-base",children:"Enabled"}),s.jsx("div",{className:"text-xs sm:text-sm opacity-70 mt-0.5 sm:mt-1",children:"Enforce airtime limits for regulatory compliance"})]}),s.jsxs("button",{onClick:()=>P(!1),className:h("w-full p-3 sm:p-4 rounded-lg border text-left transition-all duration-200 min-h-[64px]",X?"bg-bg-subtle border-border-subtle text-text-secondary hover:bg-bg-elevated":"bg-accent-secondary/20 border-accent-secondary/50 text-accent-secondary"),children:[s.jsx("div",{className:"font-medium text-sm sm:text-base",children:"Disabled"}),s.jsx("div",{className:"text-xs sm:text-sm opacity-70 mt-0.5 sm:mt-1",children:"No airtime limiting (use with caution)"})]})]})]})}),s.jsx(k,{md:6,children:s.jsx(w,{children:s.jsxs("div",{ref:se,children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h2",{className:"type-subheading text-text-primary flex items-center gap-2",children:[s.jsx(z,{className:"icon-md text-accent-primary"}),"Radio Configuration"]}),s.jsx("div",{className:"flex items-center gap-1",children:D&&(A?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:ne,disabled:ee,className:h("p-2 rounded-lg transition-colors",ee?"text-text-muted cursor-not-allowed":"text-text-muted hover:text-accent-danger hover:bg-accent-danger/10"),title:"Cancel",children:s.jsx(d,{className:"w-4 h-4"})}),s.jsx("button",{onClick:async()=>{te(!0),le(null);try{const e={},t=parseFloat(U),a=D?D.frequency/1e6:0;Math.abs(t-a)>1e-4&&(e.frequency_mhz=t);const l=D?D.bandwidth/1e3:0;G!==l&&(e.bandwidth_khz=G),J!==(null==D?void 0:D.spreading_factor)&&(e.spreading_factor=J),W!==(null==D?void 0:D.coding_rate)&&(e.coding_rate=W);const s=parseInt(Z);if(s!==(null==D?void 0:D.tx_power)&&(e.tx_power=s),0===Object.keys(e).length)return le({success:!0,message:"No changes to save"}),void te(!1);const r=await b(e);if(r.success&&r.data){const e=r.data.applied.join(", "),t=r.data.live_update?" (applied live)":" (restart required)";le({success:!0,message:`Updated: ${e}${t}`}),B(),setTimeout(()=>{O(!1),le(null)},1500)}else le({success:!1,message:r.error||"Failed to save"})}catch(e){le({success:!1,message:String(e)})}finally{te(!1)}},disabled:ee||!re,className:h("p-2 rounded-lg transition-colors",ee?"text-accent-primary cursor-wait":re?"text-accent-success hover:bg-accent-success/10":"text-text-muted cursor-not-allowed"),title:re?"Save changes":"No changes to save",children:ee?s.jsx(M,{className:"w-4 h-4 animate-spin"}):s.jsx(x,{className:"w-4 h-4"})})]}):s.jsx("button",{onClick:()=>{D&&(V((D.frequency/1e6).toFixed(3)),K(D.bandwidth/1e3),Q(D.spreading_factor),Y(D.coding_rate),_(String(D.tx_power))),le(null),O(!0)},className:"p-2 rounded-lg transition-colors text-text-muted hover:text-text-primary hover:bg-bg-subtle",title:"Edit radio settings",children:s.jsx(L,{className:"w-4 h-4"})}))})]}),ae&&s.jsx("div",{className:h("text-xs mb-3 px-2 py-1.5 rounded-md",ae.success?"text-accent-success bg-accent-success/10":"text-accent-danger bg-accent-danger/10"),children:ae.message}),D?A?s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Frequency (MHz)"}),s.jsx("input",{type:"number",value:U,onChange:e=>V(e.target.value),step:"0.001",min:"400",max:"930",className:"w-full h-[38px] bg-bg-subtle border border-border-subtle rounded-lg px-3 py-2 text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary/50"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-text-muted block mb-1",children:"TX Power (dBm)"}),s.jsx("input",{type:"number",value:Z,onChange:e=>_(e.target.value),min:"-9",max:"22",className:"w-full h-[38px] bg-bg-subtle border border-border-subtle rounded-lg px-3 py-2 text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary/50"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Bandwidth"}),s.jsxs("div",{className:"relative",children:[s.jsx("select",{value:G,onChange:e=>K(parseFloat(e.target.value)),className:"w-full h-[38px] bg-bg-subtle border border-border-subtle rounded-lg px-3 pr-8 py-2 text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary/50 appearance-none cursor-pointer",children:S.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))}),s.jsx(o,{className:"absolute right-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Spreading Factor"}),s.jsxs("div",{className:"relative",children:[s.jsx("select",{value:J,onChange:e=>Q(parseInt(e.target.value)),className:"w-full h-[38px] bg-bg-subtle border border-border-subtle rounded-lg px-3 pr-8 py-2 text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary/50 appearance-none cursor-pointer",children:j.map(e=>s.jsxs("option",{value:e,children:["SF",e]},e))}),s.jsx(o,{className:"absolute right-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Coding Rate"}),s.jsxs("div",{className:"relative",children:[s.jsx("select",{value:W,onChange:e=>Y(parseInt(e.target.value)),className:"w-full h-[38px] bg-bg-subtle border border-border-subtle rounded-lg px-3 pr-8 py-2 text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary/50 appearance-none cursor-pointer",children:F.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))}),s.jsx(o,{className:"absolute right-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Preamble"}),s.jsxs("p",{className:"type-body text-text-primary font-medium h-[38px] flex items-center",children:[D.preamble_length," symbols"]})]})]}):s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Frequency"}),s.jsx("p",{className:"type-data text-text-primary h-[38px] flex items-center",children:m(D.frequency)})]}),s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-text-muted block mb-1",children:"TX Power"}),s.jsxs("p",{className:"type-data text-text-primary h-[38px] flex items-center",children:[D.tx_power," dBm"]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Bandwidth"}),s.jsx("p",{className:"type-data text-text-primary h-[38px] flex items-center",children:u(D.bandwidth)})]}),s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Spreading Factor"}),s.jsxs("p",{className:"type-data text-text-primary h-[38px] flex items-center",children:["SF",D.spreading_factor]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Coding Rate"}),s.jsxs("p",{className:"type-data text-text-primary h-[38px] flex items-center",children:["4/",D.coding_rate]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Preamble Length"}),s.jsxs("p",{className:"type-data text-text-primary h-[38px] flex items-center",children:[D.preamble_length," symbols"]})]})]}):s.jsx("p",{className:"text-text-muted",children:"Loading radio configuration..."})]})})}),s.jsx(k,{md:6,children:s.jsxs(w,{children:[s.jsx(C,{icon:s.jsx(g,{}),title:"Location",largeTitle:!0}),E?s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-text-muted",children:"Latitude"}),s.jsx("p",{className:"type-data text-text-primary mt-1",children:0!==E.latitude?E.latitude.toFixed(6):"Not set"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-text-muted",children:"Longitude"}),s.jsx("p",{className:"type-data text-text-primary mt-1",children:0!==E.longitude?E.longitude.toFixed(6):"Not set"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-text-muted",children:"Advert Interval"}),s.jsx("p",{className:"type-data text-text-primary mt-1",children:E.send_advert_interval_hours>0?`${E.send_advert_interval_hours}h`:"Disabled"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-text-muted",children:"Score-based TX"}),s.jsx("p",{className:"type-body text-text-primary mt-1",children:E.use_score_for_tx?"Enabled":"Disabled"})]})]}):s.jsx("p",{className:"text-text-muted",children:"Loading location settings..."})]})}),s.jsx(k,{children:s.jsxs(w,{children:[s.jsx(C,{icon:s.jsx(i,{}),title:"Node Information",largeTitle:!0}),T?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx("span",{className:"type-label text-text-muted",children:"Node Name"}),s.jsx("p",{className:"type-body text-text-primary mt-1",children:$})]}),s.jsxs("div",{children:[s.jsx("span",{className:"type-label text-text-muted",children:"Version"}),s.jsxs("p",{className:"type-data text-text-primary mt-1",children:["v",T.version]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"type-label text-text-muted",children:"Core Version"}),s.jsxs("p",{className:"type-data text-text-primary mt-1",children:["v",T.core_version]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"type-label text-text-muted",children:"Local Hash"}),s.jsx("div",{className:"mt-1",children:T.local_hash?s.jsx(v,{hash:T.local_hash,size:"sm"}):s.jsx("span",{className:"type-data-sm text-text-muted",children:"N/A"})})]})]}),T.public_key&&s.jsxs("div",{className:"mt-4 pt-4 border-t border-border-subtle",children:[s.jsx("span",{className:"type-label text-text-muted",children:"Public Key"}),s.jsx("div",{className:"mt-1",children:s.jsx(v,{hash:T.public_key,prefixLength:12,suffixLength:8})})]})]}):s.jsx("p",{className:"text-text-muted",children:"Loading node information..."})]})})]})]})}export{T as default};
