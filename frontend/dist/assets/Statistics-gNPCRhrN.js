import{c as e,j as t,C as s,Z as a,$ as n,I as i,a0 as l,G as r,R as o,f as c,h as d,g as m,a1 as h,o as x,a2 as u,k as p,a3 as f}from"./index-CLi6xczL.js";import{c as g,b as j,d as y,i as b,L as v,C as N,X as w,Y as M,T as k,e as C}from"./recharts-bmHCCfxU.js";import{R as S,T as $}from"./TimeRangeSelector-Hu7vgLzP.js";import{u as P}from"./usePolling-DMtQdE_y.js";import{b as T,u as A,c as R,d as F}from"./useThemeColors-aZ327gx7.js";import{C as L,b as E,P as W,a as z}from"./PageLayout-BXoaut2N.js";import{C as H,E as D,G as O,N as q}from"./CollisionExplorerModal-ChC6YKo5.js";import{I as _}from"./info-D-OJbIcP.js";import{T as U}from"./triangle-alert-CtfeX3hX.js";import{T as B}from"./trending-up-C2PPgLZS.js";import{R as I,C as G}from"./Grid-BpRuWPLK.js";import"./maplibre-gl-CFO9X1Ek.js";import"./leaflet-ClE6qLuu.js";import"./map-pin-BHxLBGAv.js";const X=e("chart-pie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]),Z=e("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),V=e("compass",[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Y=e("expand",[["path",{d:"m15 15 6 6",key:"1s409w"}],["path",{d:"m15 9 6-6",key:"ko1vev"}],["path",{d:"M21 16v5h-5",key:"1ck2sf"}],["path",{d:"M21 8V3h-5",key:"1qoq8a"}],["path",{d:"M3 16v5h5",key:"1t08am"}],["path",{d:"m3 21 6-6",key:"wwnumi"}],["path",{d:"M3 8V3h5",key:"1ln10m"}],["path",{d:"M9 9 3 3",key:"v551iv"}]]),K=e("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),Q=e("radar",[["path",{d:"M19.07 4.93A10 10 0 0 0 6.99 3.34",key:"z3du51"}],["path",{d:"M4 6h.01",key:"oypzma"}],["path",{d:"M2.29 9.62A10 10 0 1 0 21.31 8.35",key:"qzzz0"}],["path",{d:"M16.24 7.76A6 6 0 1 0 8.23 16.67",key:"1yjesh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M17.99 11.66A6 6 0 0 1 15.77 16.67",key:"1u2y91"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"m13.41 10.59 5.66-5.66",key:"mhq4k0"}]]),J=e("shrink",[["path",{d:"m15 15 6 6m-6-6v4.8m0-4.8h4.8",key:"17vawe"}],["path",{d:"M9 19.8V15m0 0H4.2M9 15l-6 6",key:"chjx8e"}],["path",{d:"M15 4.2V9m0 0h4.8M15 9l6-6",key:"lav6yq"}],["path",{d:"M9 4.2V9m0 0H4.2M9 9 3 3",key:"1pxi2q"}]]),ee=e("waves",[["path",{d:"M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"knzxuh"}],["path",{d:"M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"2jd2cc"}],["path",{d:"M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"rd2r6e"}]]);function te({children:e,centered:s,className:a}){return t.jsx("div",{className:g("flex-1 min-h-0",s&&"flex items-center justify-center",a),children:e})}function se(e){const t=e.match(/\(([^)]+)\)\s*$/);return t?t[1]:e.length>10?e.slice(0,10):e}function ae({x:e,y:s,width:a,height:n,name:i,size:l,index:r,colors:o,depth:c,hoveredIndex:d,onHover:m,total:h}){if(1!==c)return null;const x=null!==d&&!(d===r),u=o[r%o.length],p=h>0?l/h*100:0,f=a>36&&n>20,g=a>36&&n>32,j=se(i);return t.jsxs("g",{onMouseEnter:e=>m(r,e),onMouseLeave:()=>m(null),style:{cursor:"default"},children:[t.jsx("rect",{x:e,y:s,width:a,height:n,fill:u,opacity:x?.4:1,stroke:"rgba(0,0,0,0.2)",strokeWidth:1,rx:3,style:{transition:"opacity 150ms ease"}}),f&&t.jsxs(t.Fragment,{children:[g&&t.jsxs("text",{x:e+4,y:s+n-4-11,textAnchor:"start",dominantBaseline:"auto",fill:"rgba(0,0,0,0.6)",fontSize:8,fontFamily:"'JetBrains Mono', monospace",fontWeight:500,style:{pointerEvents:"none"},children:[p.toFixed(1),"%"]}),t.jsx("text",{x:e+4,y:s+n-4,textAnchor:"start",dominantBaseline:"auto",fill:"rgba(0,0,0,0.85)",fontSize:9,fontFamily:"'JetBrains Mono', monospace",fontWeight:600,style:{pointerEvents:"none"},children:j})]})]})}function ne({data:e,total:s,color:a,position:n,containerWidth:i}){if(!e||!n)return null;const l=(e.value/s*100).toFixed(1),r=i-n.x<184?Math.max(8,n.x-160-8):n.x+16;return t.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:r,top:Math.max(8,n.y-60)},children:t.jsxs("div",{className:"bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 shadow-xl min-w-[140px]",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-sm flex-shrink-0",style:{backgroundColor:a}}),t.jsx("span",{className:"type-data-sm font-semibold text-text-primary",children:se(e.name)})]}),t.jsxs("div",{className:"space-y-0.5 type-data-xs text-text-muted",children:[t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("span",{children:"Count"}),t.jsx("span",{className:"text-text-primary tabular-nums font-medium",children:e.value.toLocaleString()})]}),t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("span",{children:"Share"}),t.jsxs("span",{className:"text-text-primary tabular-nums font-medium",children:[l,"%"]})]}),t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("span",{children:"Total"}),t.jsx("span",{className:"text-text-primary tabular-nums font-medium",children:s.toLocaleString()})]})]})]})})}const ie=j.memo(function({data:e}){var s,a;const[n,i]=j.useState(null),[l,r]=j.useState(null),[o,c]=j.useState(0),d=j.useRef(null),m=T(),{treemapData:h,total:x}=j.useMemo(()=>{const t=e.reduce((e,t)=>e+t.value,0);return{treemapData:[...e].sort((e,t)=>t.value-e.value).filter(e=>t>0&&e.value/t*100>=.5).map((e,t)=>({name:e.name,size:e.value,index:t})),total:t}},[e]),u=j.useCallback((e,t)=>{if(i(e),t&&null!==e){const e=d.current;if(e){const s=e.getBoundingClientRect();c(s.width),r({x:t.clientX-s.left,y:t.clientY-s.top})}}else r(null)},[]),p=null!==n?{name:(null==(s=h[n])?void 0:s.name)??"",value:(null==(a=h[n])?void 0:a.size)??0}:null,f=null!==n?m[n%m.length]:"";return 0===e.length||0===x?t.jsx("div",{className:"h-56 flex items-center justify-center text-text-muted",children:"No packet type data available"}):t.jsxs("div",{className:"h-56 relative treemap-container",ref:d,children:[t.jsx(y,{width:"100%",height:"100%",minWidth:1,minHeight:1,children:t.jsx(b,{data:h,dataKey:"size",aspectRatio:4/3,stroke:"none",isAnimationActive:!1,content:t.jsx(ae,{x:0,y:0,width:0,height:0,name:"",value:0,size:0,index:0,colors:m,depth:0,hoveredIndex:n,onHover:u,total:x})})}),t.jsx(ne,{data:p,total:x,color:f,position:l,containerWidth:o})]})}),le="airtimeSpectrumBlur";function re({active:e,payload:s,label:a}){if(!e||!s||0===s.length)return null;const n=s.filter(e=>null!==e.value&&void 0!==e.value);if(0===n.length)return null;const i=a?new Date(1e3*a).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}):"";return t.jsxs("div",{className:"bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 text-sm shadow-xl",children:[t.jsx("div",{className:"font-medium text-text-primary mb-1 font-mono",children:i}),n.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-0.5",style:{backgroundColor:e.color}}),t.jsxs("span",{className:"text-text-muted",children:[e.name,":"]}),t.jsxs("span",{className:"text-text-primary tabular-nums font-mono",children:[Number(e.value).toFixed(2),"%"]})]},s))]})}function oe({payload:e,showDensityScale:s=!1}){return e?t.jsxs("div",{className:"flex items-center gap-4 justify-start text-xs font-mono pl-11",children:[e.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"w-4 h-0.5",style:{backgroundColor:e.color}}),t.jsx("span",{className:"text-text-muted",children:e.value})]},s)),s&&t.jsxs("div",{className:"flex items-center gap-1.5 ml-2",children:[t.jsx("div",{className:"w-16 h-2 rounded-sm",style:{background:"linear-gradient(to right, \n                rgb(1,26,51), \n                rgb(53,82,85), \n                rgb(85,121,74), \n                rgb(150,149,53), \n                rgb(228,168,98), \n                rgb(250,195,165)\n              )"}}),t.jsx("span",{className:"text-text-muted",children:"Density"})]})]}):null}const ce=[[1,26,51],[20,43,67],[38,62,79],[53,82,85],[67,102,83],[85,121,74],[112,137,62],[150,149,53],[192,156,58],[228,168,98],[250,195,165]];function de(e){const t=Math.max(0,Math.min(1,e))*(ce.length-1),s=Math.floor(t),a=Math.min(s+1,ce.length-1),n=t-s;return`rgb(${Math.round(ce[s][0]+n*(ce[a][0]-ce[s][0]))},${Math.round(ce[s][1]+n*(ce[a][1]-ce[s][1]))},${Math.round(ce[s][2]+n*(ce[a][2]-ce[s][2]))})`}const me=j.memo(function({samples:e,startTs:a,endTs:n,yMax:i}){const l=A(),r=R(),o=j.useMemo(()=>void 0!==i?i:function(e){if(0===e.length)return 10;let t=0;for(const n of e){const e=n.rxRolling??n.rxUtilW,s=n.txRolling??n.txUtilW;e>t&&(t=e),s>t&&(t=s)}const s=1.05*t,a=5*Math.ceil(s/5);return Math.max(10,a)}(e),[i,e]),c=r.critical,d=l.neutral,{cells:m,cellWidth:h,cellHeight:x}=j.useMemo(()=>function(e,t,s,a,n=120,i=30){const l=100/n+.5+"%",r=100/i+.5+"%";if(0===e.length||s<=t)return{cells:[],cellWidth:l,cellHeight:r};const o=s-t,c=i*n,d=new Float32Array(c),m=new Float32Array(c),h=(e,t)=>e*n+t;for(let b=0;b<e.length;b++){const l=e[b];if(l.timestamp<t||l.timestamp>s)continue;const r=Math.floor((l.timestamp-t)/o*(n-1)),c=Math.max(0,Math.min(n-1,r));if(l.rxUtilW>0){const e=Math.min(l.rxUtilW/a,1),t=Math.floor((1-e)*(i-1));for(let s=t;s<i;s++){const e=i-1-t,a=e>0?1-(s-t)/e*.7:1;d[h(s,c)]+=a}}if(l.txUtilW>0){const e=Math.min(l.txUtilW/a,1),t=Math.floor((1-e)*(i-1));for(let s=t;s<i;s++){const e=i-1-t,a=e>0?1-(s-t)/e*.7:1;m[h(s,c)]+=a}}}const x=[];for(let b=0;b<c;b++)d[b]>0&&x.push(d[b]),m[b]>0&&x.push(m[b]);x.sort((e,t)=>e-t);const u=x.length>0?x[Math.floor(.95*x.length)]:1,p=new Array(n),f=new Array(i),g=100/n,j=100/i;for(let b=0;b<n;b++)p[b]=b*g+"%";for(let b=0;b<i;b++)f[b]=b*j+"%";const y=[];for(let b=0;b<i;b++)for(let e=0;e<n;e++){const t=h(b,e),s=d[t]+.3*m[t];if(s>0&&u>0){const t=Math.min(s/u,1.5),a=Math.sqrt(t/1.5);y.push({xPct:p[e],yPct:f[b],intensity:a})}}return{cells:y,cellWidth:l,cellHeight:r}}(e,a,n,100,200,20),[e,a,n]),u=j.useMemo(()=>{if(0===e.length)return[];const t=Math.max(1,Math.floor(e.length/400)),s=[];for(let a=0;a<e.length;a+=t){const t=e[a];if(t&&"number"==typeof t.timestamp&&!isNaN(t.timestamp)){const e=t.rxRolling??t.rxUtilW,a=t.txRolling??t.txUtilW;s.push({timestamp:t.timestamp,rx:"number"!=typeof e||isNaN(e)?0:e,tx:"number"!=typeof a||isNaN(a)?0:a})}}return s},[e]),p=j.useMemo(()=>{const e=n-a,t=e/3600;return[0,.25,.5,.75,1].map(s=>{const n=new Date(1e3*(a+e*s)),i=n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),l=n.toLocaleDateString([],{weekday:"short"});return{pct:s,label:t>24?`${l} ${i}`:i}})},[a,n]);return 0===e.length?t.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No traffic data available"}):t.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[t.jsx("div",{className:"flex items-center flex-shrink-0 text-text-muted",style:{height:20,paddingLeft:44,paddingRight:8},children:t.jsx("div",{className:"relative w-full h-full flex items-center",children:p.map((e,a)=>t.jsxs("div",{className:"absolute flex items-center gap-1 type-data-xs",style:{left:100*e.pct+"%",transform:0===e.pct?"translateX(0)":1===e.pct?"translateX(-100%)":"translateX(-50%)"},children:[t.jsx(s,{className:"w-2.5 h-2.5 opacity-60"}),t.jsx("span",{className:"tabular-nums",children:e.label})]},a))})}),t.jsx("div",{className:"relative",style:{height:160},children:t.jsx(y,{width:"100%",height:"100%",minWidth:1,minHeight:1,children:t.jsxs(v,{data:u,margin:{top:4,right:8,bottom:0,left:0},children:[t.jsx(N,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.04)",vertical:!1}),t.jsx(w,{dataKey:"timestamp",type:"number",domain:[a,n],axisLine:!1,tickLine:!1,tick:!1,height:0}),t.jsx(M,{axisLine:!1,tickLine:!1,tick:{fill:"rgba(255,255,255,0.4)",fontSize:10,fontFamily:"'JetBrains Mono', monospace"},dx:-8,width:44,tickFormatter:e=>`${e.toFixed(0)}%`,domain:[0,o]}),t.jsx(k,{content:t.jsx(re,{})}),t.jsx(C,{type:"linear",dataKey:"rx",name:"RX Avg",stroke:c,strokeWidth:2.5,strokeOpacity:.9,dot:!1,connectNulls:!1,isAnimationActive:!1}),t.jsx(C,{type:"linear",dataKey:"tx",name:"TX Avg",stroke:d,strokeWidth:2.5,strokeOpacity:.9,dot:!1,connectNulls:!1,isAnimationActive:!1})]})})}),t.jsx("div",{className:"relative overflow-hidden",style:{height:32,marginLeft:44,marginRight:8},children:t.jsxs("svg",{className:"absolute inset-0 w-full h-full",preserveAspectRatio:"none","aria-hidden":"true",children:[t.jsx("defs",{children:t.jsx("filter",{id:le,x:"-100%",y:"-100%",width:"300%",height:"300%",children:t.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"1 3"})})}),t.jsx("g",{filter:`url(#${le})`,children:m.map((e,s)=>t.jsx("rect",{x:e.xPct,y:e.yPct,width:h,height:x,fill:de(e.intensity),opacity:.9},`cell-${s}`))})]})}),t.jsx("div",{className:"flex-shrink-0",style:{height:24,marginTop:8},children:t.jsx(oe,{payload:[{value:"RX Avg",color:c},{value:"TX Avg",color:d}],showDensityScale:!0})})]})}),he={"1x":1,"2x":.5,"3x":.25},xe=new Set([30,45,60,120,135,150,210,225,240,300,315,330]);function ue(e,t,s,a){const n=Math.PI/180,i=(a-t)*n,l=e*n,r=s*n,o=Math.sin(i)*Math.cos(r),c=Math.cos(l)*Math.sin(r)-Math.sin(l)*Math.cos(r)*Math.cos(i);return(180*Math.atan2(o,c)/Math.PI+360)%360}function pe(e,t,s,a){const n=Math.PI/180,i=(s-e)*n,l=(a-t)*n,r=Math.sin(i/2)**2+Math.cos(e*n)*Math.cos(s*n)*Math.sin(l/2)**2;return 12742*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))}const fe=[{min:10,color:"excellent"},{min:4,color:"good"},{min:-5,color:"fair"},{min:-8,color:"poor"},{min:-1/0,color:"critical"}];function ge(e,t){return t[fe.find(t=>e>=t.min).color]}const je=[{min:10,label:"Excellent"},{min:7,label:"Very Good"},{min:4,label:"Good"},{min:1,label:"Fair+"},{min:-2,label:"Fair"},{min:-5,label:"Fair-"},{min:-8,label:"Poor"},{min:-11,label:"Bad"},{min:-1/0,label:"Critical"}],ye=j.memo(function({neighbors:e,quickNeighbors:s,localLat:a,localLon:n,onStatsChange:i}){const[l,r]=j.useState(null),[o,c]=j.useState(new Set),[d,m]=j.useState(0),[h,x]=j.useState({width:320,height:180}),[u,p]=j.useState("1x"),[f,g]=j.useState(new Map),y=j.useRef(null),b=j.useRef({}),v=j.useRef(null),N=j.useRef(f);N.current=f;const w=R(),M=F();j.useEffect(()=>{const e=v.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e){const{width:e,height:s}=t.contentRect;e>0&&s>0&&x({width:e,height:s})}});t.observe(e);const s=e.getBoundingClientRect();return s.width>0&&s.height>0&&x({width:s.width,height:s.height}),()=>t.disconnect()},[]),j.useEffect(()=>{const e=setTimeout(()=>{m(1)},100),t=setInterval(()=>{m(e=>e+1)},9500);return()=>{clearTimeout(e),clearInterval(t)}},[]);const k=j.useMemo(()=>{const e=new Set;if(s)for(const t of s)e.add(t.hash);return e},[s]),C=j.useMemo(()=>{const e=new Map;if(s)for(const t of s)e.set(t.hash,{snr:t.avgSnr,rssi:t.avgRssi});return e},[s]),{processedNeighbors:S,maxDistance:$,totalNeighbors:P,zeroHopCount:T}=j.useMemo(()=>{const t=[];let s=0;const i=[];for(const[c,d]of Object.entries(e)){if(!d.latitude||!d.longitude||0===d.latitude||0===d.longitude)continue;const e=ue(a,n,d.latitude,d.longitude),l=pe(a,n,d.latitude,d.longitude);i.push(l);const r=k.has(c);r&&s++;const o=C.get(c);t.push({hash:c.slice(0,8),name:d.node_name||d.name||"Unknown",snr:r?(null==o?void 0:o.snr)??d.snr??null:null,rssi:r?(null==o?void 0:o.rssi)??d.rssi??null:null,bearing:e,distance:l,normalizedDistance:0,lastSeen:d.last_seen,isZeroHop:r})}i.sort((e,t)=>e-t);const l=i.length>0?i[i.length-1]:0,r=he[u];let o=1===r?l:function(e,t){if(0===e.length)return 0;const s=Math.ceil(e.length*t)-1;return e[Math.max(0,Math.min(s,e.length-1))]}(i,r);o<=0&&(o=l||1);for(const e of t){const t=Math.min(e.distance/o,1);e.normalizedDistance=.08+.89*t}return t.sort((e,t)=>!e.isZeroHop&&t.isZeroHop?-1:e.isZeroHop&&!t.isZeroHop?1:e.isZeroHop||t.isZeroHop?(e.snr??-1/0)-(t.snr??-1/0):t.distance-e.distance),{processedNeighbors:t,maxDistance:l,totalNeighbors:t.length,zeroHopCount:s}},[e,a,n,k,C,u]);j.useEffect(()=>{i&&i({zeroHopCount:T,totalCount:P,maxDistanceKm:$})},[T,P,$,i]),j.useEffect(()=>{const e=new Map,t=new Map;for(const n of S){const s=N.current.get(n.hash)??n.normalizedDistance;e.set(n.hash,s),t.set(n.hash,n.normalizedDistance)}y.current&&cancelAnimationFrame(y.current);const s=performance.now(),a=n=>{const i=n-s,l=Math.min(i/400,1),r=(o=l)<.5?8*o*o*o*o:1-Math.pow(-2*o+2,4)/2;var o;const c=new Map;for(const s of S){const a=e.get(s.hash)??s.normalizedDistance,n=t.get(s.hash)??s.normalizedDistance;c.set(s.hash,a+(n-a)*r)}g(c),y.current=l<1?requestAnimationFrame(a):null};return y.current=requestAnimationFrame(a),()=>{y.current&&cancelAnimationFrame(y.current)}},[u,S]),j.useEffect(()=>{const e=[];for(const s of S){const t=b.current[s.hash];void 0!==t&&t!==s.lastSeen&&e.push(s.hash),b.current[s.hash]=s.lastSeen}if(0===e.length)return;queueMicrotask(()=>{c(t=>new Set([...t,...e]))});const t=setTimeout(()=>{c(t=>{const s=new Set(t);return e.forEach(e=>s.delete(e)),s})},600);return()=>clearTimeout(t)},[S]);const A=0!==a&&0!==n,L=j.useMemo(()=>{const{width:e,height:t}=h,s=e/2,a=t/2,n=Math.max(10,e/2-12),i=Math.max(10,t/2-12);return{width:e,height:t,centerX:s,centerY:a,maxRadiusX:n,maxRadiusY:i,cornerRadius:.2*Math.min(n,i)}},[h]),{width:E,height:W,centerX:z,centerY:H,maxRadiusX:D,maxRadiusY:O,cornerRadius:q}=L,_=j.useCallback((e,t=1)=>{const s=D*t,a=O*t,n=Math.min(q*t,s,a),i=(e%360+360)%360,l=i*Math.PI/180,r=180*Math.atan2(a-n,s-n)/Math.PI;let o,c;if(i<=45-r||i>315+r){const e=Math.tan(l);o=Math.max(z-s+n,Math.min(z+s-n,z+a*e*(s/a))),c=H-a}else if(i>45-r&&i<=45+r)o=z+s-n+n*Math.sin(l),c=H-a+n-n*Math.cos(l);else if(i>45+r&&i<=135-r){const e=1/Math.tan(l);c=Math.max(H-a+n,Math.min(H+a-n,H+s*e*(a/s))),o=z+s}else if(i>135-r&&i<=135+r)o=z+s-n+n*Math.sin(l),c=H+a-n-n*Math.cos(l);else if(i>135+r&&i<=225-r){const e=Math.tan(l);o=Math.max(z-s+n,Math.min(z+s-n,z+a*e*(s/a))),c=H+a}else if(i>225-r&&i<=225+r)o=z-s+n+n*Math.sin(l),c=H+a-n-n*Math.cos(l);else if(i>225+r&&i<=315-r){const e=1/Math.tan(l);c=Math.max(H-a+n,Math.min(H+a-n,H+s*e*(a/s))),o=z-s}else o=z-s+n+n*Math.sin(l),c=H-a+n-n*Math.cos(l);return{x:o,y:c}},[z,H,D,O,q]),U=j.useCallback((e,t)=>{const s=_(e,1);return{x:z+(s.x-z)*t,y:H+(s.y-H)*t}},[_,z,H]),B=j.useCallback(e=>({N:{x:z,y:H-O},S:{x:z,y:H+O},E:{x:z+D,y:H},W:{x:z-D,y:H}}[e]),[z,H,D,O]),I=j.useCallback(e=>{const t=D*e,s=O*e,a=Math.min(q*e,t,s),n=z-t,i=z+t,l=H-s,r=H+s;return[`M ${n+a} ${l}`,`L ${i-a} ${l}`,`Q ${i} ${l} ${i} ${l+a}`,`L ${i} ${r-a}`,`Q ${i} ${r} ${i-a} ${r}`,`L ${n+a} ${r}`,`Q ${n} ${r} ${n} ${r-a}`,`L ${n} ${l+a}`,`Q ${n} ${l} ${n+a} ${l}`,"Z"].join(" ")},[z,H,D,O,q]),G=j.useCallback(e=>{r(e)},[]),X=j.useCallback(e=>{p(e)},[]),Z=j.useMemo(()=>[.25,.5,.75,1],[]);return A?0===P?t.jsxs("div",{ref:v,className:"flex flex-col items-center justify-center h-full text-text-muted",children:[t.jsx(V,{className:"w-8 h-8 mb-2 opacity-50"}),t.jsx("p",{children:"No nodes with location data"})]}):t.jsxs("div",{ref:v,className:"relative h-full w-full overflow-hidden",children:[t.jsxs("svg",{width:E,height:W,className:"absolute inset-0 z-0",children:[t.jsx("defs",{children:t.jsx("style",{children:`\n                @keyframes radar-ring-pop {\n                  0% {\n                    opacity: 0;\n                    stroke-width: 1;\n                  }\n                  10% {\n                    opacity: 0.33;\n                    stroke-width: 2.5;\n                  }\n                  25% {\n                    opacity: 0.25;\n                    stroke-width: 2;\n                  }\n                  50% {\n                    opacity: 0.15;\n                    stroke-width: 1.5;\n                  }\n                  75% {\n                    opacity: 0.05;\n                  }\n                  100% {\n                    opacity: 0;\n                    stroke-width: 1;\n                  }\n                }\n                @keyframes local-node-ping {\n                  0% {\n                    fill: ${w.excellent};\n                  }\n                  100% {\n                    fill: ${M.chart6};\n                  }\n                }\n                @keyframes neighbor-blink-scale {\n                  0%, 100% {\n                    transform: scale(1);\n                    opacity: 0;\n                  }\n                  50% {\n                    transform: scale(1.3);\n                    opacity: 0.8;\n                  }\n                }\n                .radar-ring-0 {\n                  opacity: 0;\n                  animation: radar-ring-pop 875ms cubic-bezier(0.1, 0, 0.3, 1) both;\n                  animation-delay: 0ms;\n                }\n                .radar-ring-1 {\n                  opacity: 0;\n                  animation: radar-ring-pop 875ms cubic-bezier(0.1, 0, 0.3, 1) both;\n                  animation-delay: 450ms;\n                }\n                .radar-ring-2 {\n                  opacity: 0;\n                  animation: radar-ring-pop 875ms cubic-bezier(0.1, 0, 0.3, 1) both;\n                  animation-delay: 900ms;\n                }\n                .radar-ring-3 {\n                  opacity: 0;\n                  animation: radar-ring-pop 875ms cubic-bezier(0.1, 0, 0.3, 1) both;\n                  animation-delay: 1350ms;\n                }\n                .local-node-ping {\n                  animation: local-node-ping 1250ms ease-out forwards;\n                }\n                .neighbor-blink-ring {\n                  transform-origin: center;\n                  animation: neighbor-blink-scale 600ms ease-out forwards;\n                }\n              `})}),d>0&&Z.map((e,s)=>t.jsx("path",{d:I(e),fill:"none",stroke:w.critical,strokeWidth:1,className:`radar-ring-${s}`},`${e}-${d}`)),["N","E","S","W"].map(e=>{const s="N"===e||"S"===e,a=s?z:"E"===e?z+D:z-D,n=s?"N"===e?H-O:H+O:H;return t.jsx("line",{x1:z,y1:H,x2:a,y2:n,stroke:"rgba(255,255,255,0.08)",strokeWidth:1},e)}),Array.from({length:24},(e,s)=>{const a=15*s;if(a%90==0||xe.has(a))return null;const n=_(a,1),i=_(a,.96);return t.jsx("line",{x1:i.x,y1:i.y,x2:n.x,y2:n.y,stroke:w.critical,strokeWidth:1.5},a)}),["N","E","S","W"].map(e=>{const s=B(e),a="E"===e?"end":"W"===e?"start":"middle",n="N"===e?"hanging":"S"===e?"auto":"middle";return t.jsx("text",{x:s.x,y:s.y,textAnchor:a,dominantBaseline:n,fill:w.critical,fillOpacity:.9,fontSize:16,fontWeight:600,fontFamily:"'JetBrains Mono', monospace","aria-hidden":"true",children:e},e)}),t.jsx("circle",{cx:z,cy:H,r:5,fill:M.chart6,stroke:"rgba(255,255,255,0.3)",strokeWidth:1,className:d>0?"local-node-ping":"",role:"img","aria-label":"Local node"},`local-${d}`),S.map(e=>{const s=f.get(e.hash)??e.normalizedDistance,{x:a,y:n}=U(e.bearing,s),i=e.isZeroHop&&null!==e.snr?ge(e.snr,w):"rgba(107, 114, 128, 0.66)",r=e.isZeroHop?1:.33,c=(null==l?void 0:l.hash)===e.hash,d=o.has(e.hash);return t.jsxs("g",{role:"img","aria-label":`${e.name}: ${e.distance.toFixed(1)}km ${e.bearing.toFixed(0)}°`,children:[d&&t.jsx("circle",{cx:a,cy:n,r:10.5,fill:"none",stroke:"rgba(255,255,255,0.9)",strokeWidth:2,className:"neighbor-blink-ring"}),c&&t.jsx("circle",{cx:a,cy:n,r:10.5,fill:i,opacity:.3}),t.jsx("circle",{cx:a,cy:n,r:c?7:5,fill:i,fillOpacity:c?1:r,stroke:"rgba(0,0,0,0.5)",strokeWidth:1,style:{cursor:"pointer",transition:"r 0.15s, fill-opacity 0.15s"},onMouseEnter:()=>G(e),onMouseLeave:()=>G(null)})]},e.hash)})]}),t.jsx("div",{className:"absolute bottom-2 left-2 flex gap-1 z-10",role:"group","aria-label":"Zoom level",children:["1x","2x","3x"].map(e=>t.jsx("button",{onClick:()=>X(e),"aria-pressed":u===e,className:"px-2 py-0.5 text-xs font-medium rounded-full transition-colors "+(u===e?"bg-accent-primary/20 text-accent-primary":"bg-white/5 text-signal-critical hover:bg-white/10 hover:text-signal-critical/80"),children:e},e))}),l&&t.jsxs("div",{className:"absolute bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 text-sm pointer-events-none z-10 shadow-xl",style:{left:"50%",bottom:8,transform:"translateX(-50%)"},children:[t.jsx("div",{className:"font-medium text-text-primary",children:l.name}),t.jsxs("div",{className:"text-text-muted text-xs font-mono",children:[l.hash,!l.isZeroHop&&t.jsx("span",{className:"ml-2 text-text-muted",children:"(not direct)"})]}),l.isZeroHop&&null!==l.snr?t.jsx("div",{className:"flex gap-3 mt-1 text-xs",children:t.jsxs("span",{children:[t.jsx("span",{className:"text-text-muted",children:"SNR:"})," ",t.jsxs("span",{className:"tabular-nums",style:{color:ge(l.snr,w)},children:[l.snr.toFixed(1)," dB"]}),t.jsxs("span",{className:"text-text-muted ml-1",children:["(",(Y=l.snr,(null==(K=je.find(e=>Y>=e.min))?void 0:K.label)??"Critical"),")"]})]})}):t.jsx("div",{className:"text-xs text-text-muted mt-1",children:"No direct RF data"}),t.jsxs("div",{className:"flex gap-3 text-xs",children:[t.jsxs("span",{children:[t.jsx("span",{className:"text-text-muted",children:"Distance:"})," ",t.jsxs("span",{className:"tabular-nums text-text-secondary",children:[l.distance.toFixed(2)," km"]})]}),t.jsxs("span",{children:[t.jsx("span",{className:"text-text-muted",children:"Bearing:"})," ",t.jsxs("span",{className:"tabular-nums text-text-secondary",children:[l.bearing.toFixed(0),"°"]})]})]})]})]}):t.jsxs("div",{ref:v,className:"flex flex-col items-center justify-center h-full text-text-muted",children:[t.jsx(V,{className:"w-8 h-8 mb-2 opacity-50"}),t.jsx("p",{children:"Local node coordinates not configured"}),t.jsx("p",{className:"text-xs mt-1",children:"Set latitude/longitude in config to enable"})]});var Y,K});function be(e,t){if(0===e.length)return 0;const s=t/100*(e.length-1),a=Math.floor(s),n=Math.ceil(s);return a===n?e[a]:e[a]+(e[n]-e[a])*(s-a)}const ve=j.memo(function({timestamps:e,values:s,onStatsChange:a}){var n,i;const l=R(),[r,o]=j.useState(!0),c=j.useMemo(()=>{if(0===s.length)return null;const e=Math.min(...s),t=Math.max(...s),a=s.reduce((e,t)=>e+t,0)/s.length,n=[...s].sort((e,t)=>e-t);return{min:e,max:t,avg:a,p5:be(n,5),p95:be(n,95)}},[s]);j.useEffect(()=>{null==a||a(c)},[c,a]);const d=j.useCallback(()=>{o(e=>!e)},[]),{cells:m,gridInfo:h,xLabels:x,yLabels:u}=j.useMemo(()=>{if(0===e.length||0===s.length||!c)return{cells:[],gridInfo:null,xLabels:[],yLabels:[]};const t=Math.max(100,e.length),a=200;let n,i;if(r){const e=.1*(c.p95-c.p5||1);n=c.p5-e,i=c.p95+e}else{const e=.1*(c.max-c.min||1);n=c.min-e,i=c.max+e}const l=i-n,o=Math.min(...e),d=Math.max(...e)-o||1,m=Array(a).fill(null).map(()=>Array(t).fill(0));for(let r=0;r<e.length;r++){const a=Math.floor((e[r]-o)/d*(t-1)),c=Math.max(n,Math.min(i,s[r])),h=Math.floor((c-n)/l*199),x=Math.max(0,Math.min(t-1,a)),u=Math.max(0,Math.min(199,199-h));m[u][x]++,u>0&&(m[u-1][x]+=.4),u<199&&(m[u+1][x]+=.4),x>0&&(m[u][x-1]+=.3),x<t-1&&(m[u][x+1]+=.3),u>0&&x>0&&(m[u-1][x-1]+=.2),u>0&&x<t-1&&(m[u-1][x+1]+=.2),u<199&&x>0&&(m[u+1][x-1]+=.2),u<199&&x<t-1&&(m[u+1][x+1]+=.2),u>1&&(m[u-2][x]+=.15),u<198&&(m[u+2][x]+=.15),x>1&&(m[u][x-2]+=.1),x<t-2&&(m[u][x+2]+=.1)}let h=0;for(let e=0;e<a;e++)for(let s=0;s<t;s++)m[e][s]>h&&(h=m[e][s]);const x=[];for(let e=0;e<a;e++)for(let s=0;s<t;s++)m[e][s]>0&&x.push({x:s,y:e,intensity:m[e][s]/h});const u=[];for(let e=0;e<=5;e++){const t=o+d*e/5;u.push({pos:e/5*100,label:new Date(1e3*t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})}const p=[];for(let e=0;e<=4;e++){const t=n+l*e/4;p.push({pos:100*(1-e/4),label:`${Math.round(t)}`})}return{cells:x,gridInfo:{cols:t,rows:a},xLabels:u,yLabels:p}},[e,s,c,r]);if(!h||0===m.length)return t.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No noise floor data available"});const p=100/h.cols,f=100/h.rows,g=l.critical;return t.jsxs("div",{className:"relative w-full h-full",role:"img","aria-label":`RF noise floor heatmap showing values from ${(null==(n=null==c?void 0:c.min)?void 0:n.toFixed(0))??"N/A"} to ${(null==(i=null==c?void 0:c.max)?void 0:i.toFixed(0))??"N/A"} dBm`,children:[t.jsx("div",{className:"absolute top-0 left-0 flex flex-col justify-between",style:{width:32,bottom:20},"aria-hidden":"true",children:u.map((e,s)=>t.jsx("span",{className:"type-data-xs text-text-muted tabular-nums text-right pr-1.5",style:{position:"absolute",top:`${e.pos}%`,transform:"translateY(-50%)",right:0},children:e.label},s))}),t.jsxs("div",{className:"absolute overflow-hidden",style:{left:32,right:0,top:0,bottom:20},children:[t.jsx("svg",{className:"absolute inset-0 w-full h-full",preserveAspectRatio:"none","aria-hidden":"true",children:[0,25,50,75,100].map(e=>t.jsx("line",{x1:"0",y1:`${e}%`,x2:"100%",y2:`${e}%`,stroke:"rgba(255,255,255,0.06)",strokeDasharray:"3 3"},e))}),t.jsx("svg",{className:"absolute inset-0 w-full h-full",preserveAspectRatio:"none","aria-hidden":"true",children:m.map((e,s)=>{const a=.2+.8*e.intensity;return t.jsx("rect",{x:e.x*p+"%",y:e.y*f+"%",width:`${p+.1}%`,height:`${f+.1}%`,fill:g,opacity:a},s)})}),t.jsx("button",{type:"button",onClick:d,className:"absolute bottom-1 right-1 p-1.5 rounded bg-tooltip-bg/80 hover:bg-tooltip-bg active:bg-tooltip-bg transition-colors touch-manipulation",title:r?"Show full range (min/max)":"Show trimmed range (P5-P95)","aria-label":r?"Expand to show full data range":"Shrink to show trimmed percentile range","aria-pressed":!r,children:r?t.jsx(Y,{className:"w-3.5 h-3.5 text-text-muted","aria-hidden":"true"}):t.jsx(J,{className:"w-3.5 h-3.5 text-text-muted","aria-hidden":"true"})})]}),t.jsx("div",{className:"absolute left-0 right-0 bottom-0",style:{left:32,height:20},"aria-hidden":"true",children:x.map((e,s)=>t.jsx("span",{className:"type-data-xs text-text-muted tabular-nums absolute top-1",style:{left:`${e.pos}%`,transform:"translateX(-50%)"},children:e.label},s))})]})}),Ne={repeater:"var(--signal-critical)",companion:"var(--accent-tertiary)",room_server:"var(--accent-secondary)"};function we(e){if(e.contact_type){const t=e.contact_type.toLowerCase();if("repeater"===t||"rep"===t)return"repeater";if("room server"===t||"room_server"===t||"room"===t||"server"===t)return"room_server";if("companion"===t||"client"===t||"cli"===t)return"companion"}return e.is_repeater?"repeater":"companion"}const Me=j.memo(function({neighbors:e}){const s=j.useMemo(()=>{const t={repeater:0,companion:0,room_server:0};for(const a of Object.values(e)){const e=we(a);t[e]=(t[e]||0)+1}const s=Object.values(t).reduce((e,t)=>e+t,0);return{items:[{label:"Repeaters",count:t.repeater,percent:0,color:Ne.repeater},{label:"Companions",count:t.companion,percent:0,color:Ne.companion},{label:"Room Servers",count:t.room_server,percent:0,color:Ne.room_server}].map(e=>({...e,percent:s>0?e.count/s*100:0})).filter(e=>e.count>0).sort((e,t)=>t.count-e.count),total:s}},[e]);return 0===s.total?t.jsx("div",{className:"h-full flex items-center justify-center text-text-muted type-body-sm",children:"No neighbors discovered yet"}):t.jsxs("div",{className:"h-full flex flex-col",children:[t.jsx("div",{className:"flex-1 flex flex-col justify-evenly",children:s.items.map(e=>t.jsxs("div",{className:"flex flex-col gap-1.5",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"type-data-sm text-text-secondary",children:e.label}),t.jsxs("span",{className:"type-data-sm text-text-muted tabular-nums",children:[e.count," ",t.jsxs("span",{className:"text-text-muted/60",children:["(",e.percent.toFixed(0),"%)"]})]})]}),t.jsx("div",{className:"h-2.5 bg-bg-elevated rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full rounded-full transition-all duration-500 ease-out",style:{width:`${e.percent}%`,backgroundColor:e.color,minWidth:e.count>0?"4px":"0"}})})]},e.label))}),t.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border-subtle",children:[t.jsx("span",{className:"type-data-xs text-text-muted",children:"Total Nodes"}),t.jsx("span",{className:"type-data-sm text-text-primary font-medium tabular-nums",children:s.total})]})]})});function ke(e,t,s,a=!0,n=60){const i=new Map(e.map(e=>[e.start,e])),l=new Map(t.map(e=>[e.start,e])),r=Array.from(new Set([...i.keys(),...l.keys()])).sort((e,t)=>e-t).map(e=>{const t=i.get(e),a=l.get(e);return{timestamp:e,rxUtilW:((null==t?void 0:t.airtime_ms)??0)/s*100,txUtilW:((null==a?void 0:a.airtime_ms)??0)/s*100}});return a&&r.length>1?function(e,t=60){if(0===e.length)return[];const s=1-Math.pow(.5,1/t),a=Math.min(e.length,Math.max(10,Math.floor(t/3)));let n=0,i=0;for(let l=0;l<a;l++)n+=e[l].rxUtilW,i+=e[l].txUtilW;return n/=a,i/=a,e.map(e=>(n=s*e.rxUtilW+(1-s)*n,i=s*e.txUtilW+(1-s)*i,{...e,rxRolling:n,txRolling:i}))}(r,n):r}const Ce={excellent:"text-signal-excellent",good:"text-signal-good",fair:"text-signal-fair",poor:"text-signal-poor"},Se={excellent:"bg-signal-excellent/10",good:"bg-signal-good/10",fair:"bg-signal-fair/10",poor:"bg-signal-poor/10"};function $e({value:e,status:s}){const a={excellent:"bg-signal-excellent",good:"bg-signal-good",fair:"bg-signal-fair",poor:"bg-signal-poor"}[s];return t.jsx("div",{className:"w-full h-2 bg-surface-elevated rounded-full overflow-hidden",children:t.jsx("div",{className:`h-full ${a} transition-all duration-300`,style:{width:`${Math.min(100,Math.max(0,e))}%`}})})}function Pe(){const e=a(),s=n(),[i,l]=j.useState(null),r=j.useCallback((e,t)=>{l({prefix:e,candidateHashes:t})},[]),o=j.useCallback(()=>{l(null)},[]);if(!s)return t.jsxs(L,{children:[t.jsx(E,{icon:t.jsx(K,{}),title:"Prefix Conflicts",largeTitle:!0}),t.jsx("div",{className:"flex-1 flex items-center justify-center",children:t.jsxs("div",{className:"text-center text-text-muted",children:[t.jsx(_,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"type-data-xs",children:"No topology data available"}),t.jsx("p",{className:"type-data-xs opacity-70",children:"Run deep analysis to see stats"})]})})]});const c=(d=e.avgConfidence)>=.9?"excellent":d>=.7?"good":d>=.5?"fair":"poor";var d;const m=(h=e.collisionRate)<=10?"excellent":h<=25?"good":"poor";var h;const x="poor"===c||"poor"===m?"poor":"fair"===c||"fair"===m?"fair":"good"===c||"good"===m?"good":"excellent",u="excellent"===x||"good"===x?Z:U;return t.jsxs(L,{className:"flex flex-col overflow-hidden",children:[t.jsx(E,{icon:t.jsx(K,{}),title:"Prefix Conflicts",largeTitle:!0,actions:t.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1 rounded-full ${Se[x]}`,children:[t.jsx(u,{className:`w-3.5 h-3.5 ${Ce[x]}`}),t.jsx("span",{className:`type-data-xs font-medium ${Ce[x]}`,children:"excellent"===x?"Excellent":"good"===x?"Good":"fair"===x?"Fair":"Needs Attention"})]})}),t.jsxs("div",{className:"flex-1 overflow-y-auto min-h-0",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[t.jsxs("div",{className:"cursor-help",title:"Average confidence score across all disambiguated prefixes. Higher = more certain node identification. Based on geographic proximity, co-occurrence patterns, and observation recency.",children:[t.jsxs("div",{className:"flex items-baseline justify-between mb-1",children:[t.jsx("span",{className:"type-data-xs text-text-muted",children:"Avg Confidence"}),t.jsxs("span",{className:`type-data-lg font-semibold ${Ce[c]}`,children:[(100*e.avgConfidence).toFixed(1),"%"]})]}),t.jsx($e,{value:100*e.avgConfidence,status:c})]}),t.jsxs("div",{className:"cursor-help",title:"Percentage of 2-character prefixes that match multiple known nodes. Lower is better. Collisions require disambiguation to determine the correct node.",children:[t.jsxs("div",{className:"flex items-baseline justify-between mb-1",children:[t.jsx("span",{className:"type-data-xs text-text-muted",children:"Collision Rate"}),t.jsxs("span",{className:`type-data-lg font-semibold ${Ce[m]}`,children:[e.collisionRate.toFixed(1),"%"]})]}),t.jsx($e,{value:e.collisionRate,status:m})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4 py-3 border-t border-b border-border-subtle",children:[t.jsxs("div",{className:"text-center cursor-help",title:"Total unique 2-character prefixes observed in packet paths. Each prefix represents the first 2 hex digits of a node's full hash.",children:[t.jsx("div",{className:"type-data-lg font-semibold text-text-primary",children:e.totalPrefixes}),t.jsx("div",{className:"type-data-xs text-text-muted",children:"Prefixes"})]}),t.jsxs("div",{className:"text-center cursor-help",title:"Prefixes that map to exactly one known node. No disambiguation needed—these are definitive identifications.",children:[t.jsx("div",{className:"type-data-lg font-semibold text-signal-good",children:e.unambiguousPrefixes}),t.jsx("div",{className:"type-data-xs text-text-muted",children:"Unique"})]}),t.jsxs("div",{className:"text-center cursor-help",title:"Prefixes matching multiple known nodes. Click a prefix below to explore candidates and see how disambiguation scores them.",children:[t.jsx("div",{className:"type-data-lg font-semibold "+(e.collisionPrefixes>0?"text-signal-poor":"text-text-primary"),children:e.collisionPrefixes}),t.jsx("div",{className:"type-data-xs "+(e.collisionPrefixes>0?"text-signal-poor":"text-text-muted"),children:"Collisions"})]})]}),e.highCollisionPrefixes.length>0&&t.jsxs("div",{className:"mb-3",children:[t.jsx("div",{className:"type-data-xs text-text-muted mb-2",children:"Highest Collisions"}),t.jsx("div",{className:"flex flex-wrap gap-1.5",children:e.highCollisionPrefixes.map(({prefix:e,candidateCount:s,candidateHashes:a})=>t.jsxs("button",{type:"button",onClick:()=>r(e,a),className:"inline-flex items-center gap-1 px-2 py-1 min-h-[28px] rounded bg-surface-elevated text-text-secondary type-data-xs font-mono hover:bg-signal-poor/20 hover:text-signal-poor focus:outline-none focus:ring-2 focus:ring-signal-poor/50 transition-colors cursor-pointer touch-manipulation",title:`Click to explore ${s} candidates matching this prefix`,"aria-label":`Explore prefix ${e} with ${s} colliding candidates`,children:[e,t.jsxs("span",{className:"text-signal-poor",children:["×",s]})]},e))})]}),e.lowConfidencePrefixes.length>0&&t.jsx("div",{className:"mt-auto pt-3 border-t border-border-subtle",children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx(U,{className:"w-3.5 h-3.5 text-signal-poor mt-0.5 flex-shrink-0"}),t.jsxs("div",{children:[t.jsxs("div",{className:"type-data-xs text-signal-poor font-medium",children:[t.jsx("span",{className:"text-signal-poor",children:e.lowConfidencePrefixes.length})," prefix",1!==e.lowConfidencePrefixes.length?"es":""," with low confidence"]}),t.jsxs("div",{className:"type-data-xs text-text-muted mt-0.5 font-mono",children:[e.lowConfidencePrefixes.slice(0,5).join(", "),e.lowConfidencePrefixes.length>5&&t.jsxs("span",{className:"text-signal-poor",children:[" +",e.lowConfidencePrefixes.length-5," more"]})]})]})]})}),0===e.lowConfidencePrefixes.length&&0===e.collisionPrefixes&&t.jsx("div",{className:"mt-auto pt-3 border-t border-border-subtle",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Z,{className:"w-3.5 h-3.5 text-signal-excellent"}),t.jsx("span",{className:"type-data-xs text-signal-excellent",children:"All prefixes uniquely identified"})]})})]}),t.jsx(H,{isOpen:!!i,prefix:(null==i?void 0:i.prefix)||"",candidateHashes:(null==i?void 0:i.candidateHashes)||[],onClose:o})]})}function Te({icon:e,label:s,value:a,sublabel:n,highlight:i,tooltip:l}){return t.jsxs("div",{className:"flex items-center justify-between py-2 "+(l?"cursor-help":""),title:l,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-text-muted",children:e}),t.jsx("span",{className:"text-sm text-text-secondary",children:s})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("span",{className:"text-sm font-medium "+(i?"text-accent-tertiary":"text-text-primary"),children:a}),n&&t.jsx("span",{className:"text-xs text-text-muted ml-1",children:n})]})]})}function Ae(){const e=i(),s=l();if(!e||0===e.totalPaths)return null;const{totalPaths:a,pathsWithGhosts:n,observationOverrideCount:c,avgPathConfidence:d,tracePacketsProcessed:m,pathPacketsProcessed:h,distantEdgesDiscovered:x,duplicateGroupsFound:u,duplicatePathsUnique:p,echolocationEdgesInferred:f}=e,g=a>0?(n/a*100).toFixed(1):"0",j=a>0?(c/a*100).toFixed(1):"0",y=(100*d).toFixed(1),b=m+h,v=b>0||x>0,N=u>0||f>0;return t.jsxs(L,{children:[t.jsx(E,{title:"Viterbi HMM",icon:t.jsx(S,{className:"w-4 h-4"}),badge:s>0?`${s} GHOSTS`:void 0}),t.jsxs(te,{children:[t.jsxs("div",{className:"divide-y divide-white/5",children:[t.jsx(Te,{icon:t.jsx(S,{className:"w-3.5 h-3.5"}),label:"Paths Decoded",value:a.toLocaleString(),tooltip:"Total packet paths analyzed by the Viterbi HMM algorithm. Each path is a sequence of node prefixes extracted from received packets."}),t.jsx(Te,{icon:t.jsx(r,{className:"w-3.5 h-3.5"}),label:"Paths with Ghosts",value:n.toLocaleString(),sublabel:`(${g}%)`,highlight:n>0,tooltip:"Paths containing prefixes that don't match any known node. These 'ghost' prefixes may represent repeaters not yet discovered via direct ADVERT."}),t.jsx(Te,{icon:t.jsx(D,{className:"w-3.5 h-3.5"}),label:"Observation Override",value:`${j}%`,sublabel:"of paths",tooltip:"Percentage of paths where real-world observations (signal strength, co-occurrence patterns) overrode the expected geographic transition model. Higher values indicate the algorithm is learning from actual mesh behavior."}),t.jsx(Te,{icon:t.jsx(B,{className:"w-3.5 h-3.5"}),label:"Avg Confidence",value:`${y}%`,tooltip:"Average confidence score across all decoded paths. Combines transition probability (geographic likelihood) with observation probability (signal/co-occurrence evidence)."})]}),v&&t.jsxs("div",{className:"mt-3 pt-3 border-t border-white/5",children:[t.jsx("p",{className:"text-xs text-text-muted mb-2 font-medium",children:"DISTANT TOPOLOGY"}),t.jsxs("div",{className:"divide-y divide-white/5",children:[t.jsx(Te,{icon:t.jsx(Q,{className:"w-3.5 h-3.5"}),label:"TRACE/PATH Packets",value:b.toLocaleString(),sublabel:m>0?`(${m} TRACE)`:void 0,tooltip:"TRACE and PATH packets contain pre-computed routes between distant nodes. These reveal mesh topology beyond what we can directly observe - edges between nodes that may never communicate with us."}),t.jsx(Te,{icon:t.jsx(O,{className:"w-3.5 h-3.5"}),label:"Distant Edges",value:x.toLocaleString(),highlight:x>0,tooltip:"Edges discovered from TRACE/PATH packet route data. These represent links between distant nodes that we wouldn't see from normal packet forwarding - revealing deeper mesh structure."})]})]}),N&&t.jsxs("div",{className:"mt-3 pt-3 border-t border-white/5",children:[t.jsx("p",{className:"text-xs text-text-muted mb-2 font-medium",children:"ECHOLOCATION"}),t.jsxs("div",{className:"divide-y divide-white/5",children:[t.jsx(Te,{icon:t.jsx(o,{className:"w-3.5 h-3.5"}),label:"Duplicate Groups",value:u.toLocaleString(),sublabel:p>0?`(${p} paths)`:void 0,tooltip:"Packets received multiple times via different paths. Each duplicate is an 'echo' that reveals alternate routing through the mesh - like sonar mapping the network structure."}),t.jsx(Te,{icon:t.jsx(ee,{className:"w-3.5 h-3.5"}),label:"Echo Edges",value:f.toLocaleString(),highlight:f>0,tooltip:"Edges inferred from echolocation analysis. When the same packet arrives via different forwarders, those forwarders are likely within RF range of each other - revealing hidden mesh connectivity."})]})]}),s>0&&t.jsx("div",{className:"mt-3 pt-3 border-t border-white/5 cursor-help",title:"Ghost nodes are unknown repeaters inferred from path analysis. They appear frequently in packet paths but haven't been directly observed via ADVERT. Check the Contacts page to see them on the map.",children:t.jsxs("p",{className:"text-xs text-text-muted",children:[t.jsx("span",{className:"text-accent-tertiary font-medium",children:s})," ","unknown repeater",1!==s?"s":""," discovered via HMM analysis"]})})]})]})}function Re(){var e,s,a,n;const i=c(),l=d(),r=m(),[g,y]=j.useState(null),[b,v]=j.useState(null),[N,w]=j.useState([]),[M,k]=j.useState(null),[C,S]=j.useState(null),[T,A]=j.useState(!0),[R,F]=j.useState(null),[H,D]=j.useState(3),O=function(e){const[t,s]=j.useState(e);return j.useEffect(()=>{const t=setTimeout(()=>s(e),150);return()=>clearTimeout(t)},[e,150]),t}(H),_=h[O].hours,U=60*_,Z=Math.ceil(60*U/10);j.useEffect(()=>{!async function(){var e;F(null);try{const[t,s,a]=await Promise.all([x(U,Z),u(_),p(_)]);t.success&&t.data&&y(t.data),s.success&&s.data&&v(s.data),a.success&&(null==(e=a.data)?void 0:e.history)&&w(a.data.history)}catch(t){F(t instanceof Error?t.message:"Failed to load chart data")}finally{A(!1)}}()},[_,U,Z]);const{utilSamples:Y,startTs:K,endTs:Q}=j.useMemo(()=>{if(!g)return{utilSamples:[],startTs:0,endTs:0};const{received:e,transmitted:t,forwarded:s,bucket_duration_seconds:a,start_time:n,end_time:i}=g,l=1e3*a,r=function(e,t){const s=new Map;for(const a of e)s.set(a.start,{...a});for(const a of t){const e=s.get(a.start);e?(e.airtime_ms+=a.airtime_ms,e.count+=a.count):s.set(a.start,{...a})}return Array.from(s.values()).sort((e,t)=>e.start-t.start)}(t,s);return{utilSamples:ke(e,r,l),startTs:n,endTs:i}},[g]),J=j.useMemo(()=>{switch(_){case 72:return 6e5;case 168:return 18e5;default:return 3e5}},[_]),ee=j.useCallback(async()=>{try{const e=await x(U,Z);e.success&&e.data&&y(e.data)}catch{}},[U,Z]),te=j.useCallback(async()=>{try{const e=await u(_);e.success&&e.data&&v(e.data)}catch{}},[_]),se=j.useCallback(async()=>{var e;try{const t=await p(_);t.success&&(null==(e=t.data)?void 0:e.history)&&w(t.data.history)}catch{}},[_]);P(ee,J,!0,!0),P(te,J,!0,!0),P(se,J,!0,!0);const ae=j.useMemo(()=>b&&b.series?b.series.map(e=>({name:e.name,value:e.data.reduce((e,t)=>e+(t[1]??0),0)})).filter(e=>e.value>0):[],[b]),ne=j.useMemo(()=>0===N.length?{timestamps:[],values:[]}:{timestamps:N.map(e=>e.timestamp),values:N.map(e=>e.noise_floor_dbm)},[N]),le=h[H],re=j.useMemo(()=>{const e=(null==i?void 0:i.neighbors)??{};return Object.fromEntries(Object.entries(e).filter(([e])=>!l.has(e)))},[null==i?void 0:i.neighbors,l]),oe=j.useMemo(()=>{const e=Date.now()/1e3-3600*_;return Object.fromEntries(Object.entries(re).filter(([,t])=>t.last_seen>=e))},[re,_]),ce=j.useMemo(()=>0===Y.length?{peak:0,mean:0}:{peak:Math.max(...Y.map(e=>e.rxUtilW)),mean:Y.reduce((e,t)=>e+t.rxUtilW,0)/Y.length},[Y]);return t.jsxs(W,{children:[t.jsx(z,{title:"Statistics",icon:t.jsx(f,{}),controls:t.jsx($,{ranges:h,selectedIndex:H,onSelect:D})}),R&&t.jsx(L,{className:"border border-accent-red/50 bg-accent-red/10",children:t.jsx("p",{className:"text-accent-red",children:R})}),T?t.jsx(I,{template:"auto",children:t.jsx(L,{className:"text-center py-12",children:t.jsx("div",{className:"animate-pulse text-text-muted",children:"Loading statistics..."})})}):t.jsxs(t.Fragment,{children:[t.jsxs(I,{template:"panel",children:[t.jsx(G,{span:12,md:6,children:t.jsxs(L,{children:[t.jsx(E,{icon:t.jsx(B,{}),title:"Airtime Utilization",badge:le.label,largeTitle:!0,actions:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("span",{className:"type-data-xs text-text-muted",children:["Peak ",t.jsxs("span",{className:"text-text-secondary tabular-nums font-medium",children:[ce.peak.toFixed(2),"%"]})]}),t.jsxs("span",{className:"type-data-xs text-text-muted",children:["Mean ",t.jsxs("span",{className:"text-text-secondary tabular-nums font-medium",children:[ce.mean.toFixed(2),"%"]})]})]})}),t.jsx("div",{className:"flex-1 min-h-0",children:t.jsx(me,{samples:Y,startTs:K,endTs:Q})})]})}),t.jsx(G,{span:12,md:6,children:t.jsxs(L,{children:[t.jsx(E,{icon:t.jsx(V,{}),title:"Link Quality",badge:le.label,largeTitle:!0,actions:C?t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 type-data-xs text-text-muted",children:[t.jsxs("span",{children:[t.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:C.zeroHopCount})," nbr"]}),t.jsxs("span",{children:[t.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:C.totalCount})," obs"]}),t.jsxs("span",{children:[t.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:C.maxDistanceKm.toFixed(0)})," km"]})]}):null}),t.jsx("div",{className:"flex-1 min-h-0",children:t.jsx(ye,{neighbors:oe,quickNeighbors:r,localLat:(null==(s=null==(e=null==i?void 0:i.config)?void 0:e.repeater)?void 0:s.latitude)??0,localLon:(null==(n=null==(a=null==i?void 0:i.config)?void 0:a.repeater)?void 0:n.longitude)??0,onStatsChange:S})})]})})]}),t.jsxs(I,{template:"panel",children:[t.jsx(G,{span:12,md:6,children:t.jsxs(L,{children:[t.jsx(E,{icon:t.jsx(X,{}),title:"Packet Types",largeTitle:!0}),t.jsx("div",{className:"flex-1 min-h-0",children:ae.length>0?t.jsx(ie,{data:ae}):t.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No packet type data available"})})]})}),t.jsx(G,{span:12,md:6,children:t.jsxs(L,{children:[t.jsx(E,{icon:t.jsx(q,{}),title:"Network Composition",badge:le.label,largeTitle:!0}),t.jsx("div",{className:"flex-1 min-h-0",children:t.jsx(Me,{neighbors:oe})})]})})]}),t.jsxs(I,{template:"panel",children:[t.jsx(G,{span:12,md:6,children:t.jsx(Pe,{})}),t.jsx(G,{span:12,md:6,children:t.jsx(Ae,{})})]}),t.jsx(I,{template:"panel",children:t.jsx(G,{span:12,children:t.jsxs(L,{children:[t.jsx(E,{icon:t.jsx(o,{}),title:"RF Noise Floor",largeTitle:!0,actions:M?t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 md:gap-3",children:[t.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["min ",t.jsx("span",{className:"text-text-secondary tabular-nums",children:M.min.toFixed(0)})]}),t.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["avg ",t.jsx("span",{className:"text-text-secondary tabular-nums",children:M.avg.toFixed(0)})]}),t.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["max ",t.jsx("span",{className:"text-text-secondary tabular-nums",children:M.max.toFixed(0)})]}),t.jsx("span",{className:"type-data-xs text-text-muted",children:"dBm"})]}):t.jsx("span",{className:"type-data-xs text-text-muted",children:"dBm"})}),t.jsx("div",{className:"flex-1 min-h-0",children:t.jsx(ve,{timestamps:ne.timestamps,values:ne.values,onStatsChange:k})})]})})})]})]})}export{Re as default};
