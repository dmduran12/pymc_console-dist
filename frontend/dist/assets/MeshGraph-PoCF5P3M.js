import{r as e,j as t,p as s,q as a}from"./vendor-react-54o2BuWt.js";import{c as n,r as l,b0 as i,v as r,b1 as o,b2 as c,f as d,aL as x,b3 as u,aY as m,T as p,b4 as h,b5 as b,A as g,m as f,X as y,R as j,C as v}from"./index-Cx43Rh4p.js";import{D as N,E as w,M as k,a as C}from"./DeepAnalysisModal-DXmEa5Ml.js";import{L}from"./loader-circle-WvVmXfJI.js";import{S,E as M,T as E}from"./target-BbZDhiMe.js";import{F as B}from"./funnel-NC4mN2mG.js";import{G as H}from"./git-branch-B9DkOjIf.js";import{C as R,Z as P}from"./zap-CvEJ0Q3U.js";import{H as D}from"./house-cq-hfLLh.js";import{N as F}from"./network-mTQQgFu6.js";import{A as G}from"./arrow-right-BH_jYkX7.js";import"./deckgl-DTsmDcfs.js";import"./vendor-core-dnrJb0w-.js";import"./check-DRpkrIHd.js";const I=n("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),z=n("focus",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]),T=n("move",[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]]),Z=n("repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]),$={type:"spring",stiffness:500,damping:35},A=Math.PI/180;function O(e,t){if(e<=0)return 0;const s=t-e;if(s>1209600)return 0;if(s<0)return 1;const a=s/3600;return Math.exp(-a/12)}function W(e,t){const s=Math.max(.2,Math.min(1,t)),a=e.replace("#",""),n=parseInt(a.substring(0,2),16),l=parseInt(a.substring(2,4),16),i=parseInt(a.substring(4,6),16),r=e=>Math.round(e*s+128*(1-s));return`#${r(n).toString(16).padStart(2,"0")}${r(l).toString(16).padStart(2,"0")}${r(i).toString(16).padStart(2,"0")}`}const q={simulationRepulsion:1.5,simulationLinkDistance:100,simulationGravity:.003,simulationCenter:.015,simulationFriction:.85},V={local:"#FBBF24",hub:"#6366F1",gateway:"#8B5CF6",backbone:"#10B981",neighbor:"#F59E0B",mobile:"#F97316",ghost:"#6B7280",standard:"#64748B"},_={local:"Local Node",hub:"Hub (≥10% traffic)",gateway:"Gateway (7-10%)",backbone:"Backbone",neighbor:"Direct RF Neighbor",mobile:"Mobile/Volatile",ghost:"Discovered (unconfirmed)",standard:"Standard Node"},K={local:D,hub:P,gateway:H,backbone:H,neighbor:j,mobile:T,ghost:R,standard:I},Y="#FBBF24",Q="#8B5CF6",U="#10B981",X="#F59E0B",J=["#440154","#482878","#3E4A89","#31688E","#26828E","#1F9E89","#35B779","#6DCD59","#B4DE2C","#FDE725"];function ee(e,t,s,a,n={x:0,y:0}){const l=e*A,i=s*A,r=(t-a)*A,o=(e-s)*A,c=637100;return n.x=r*Math.cos(.5*(l+i))*c,n.y=o*c,n}function te(e,t){if(t<=0||e<=0)return J[0];const s=Math.log10(e+1),a=Math.log10(t+1),n=Math.min(1,s/a),l=Math.min(J.length-1,Math.floor(n*J.length));return J[l]}const se=["local","hub","gateway","backbone","neighbor","mobile","ghost","standard"];function ae({nodeCount:s,edgeCount:a,nodeClassCounts:n,hasZeroHopEdges:l,hasLoopEdges:i,hasDirectPathEdges:r}){const[o,c]=e.useState(!0),[d,x]=e.useState(!0);return t.jsxs("div",{className:"absolute bottom-4 left-4 z-10 bg-bg-elevated/95 backdrop-blur-sm rounded-lg border border-border-subtle shadow-lg min-w-[200px] max-w-[240px] type-data-xs",children:[t.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-border-subtle",children:[t.jsx("span",{className:"font-medium text-text-primary",children:"Mesh Topology"}),t.jsxs("span",{className:"text-text-muted tabular-nums",children:[s,"n / ",a,"e"]})]}),t.jsxs("div",{className:"border-b border-border-subtle",children:[t.jsxs("button",{type:"button",onClick:()=>c(!o),className:"w-full flex items-center justify-between px-3 py-1.5 hover:bg-subtle-fill/50 transition-colors",children:[t.jsx("span",{className:"text-text-secondary",children:"Node Types"}),t.jsx(f.span,{animate:{rotate:o?0:-90},transition:{duration:.15},children:t.jsx(v,{className:"w-3 h-3 text-text-muted"})})]}),t.jsx(g,{initial:!1,children:o&&t.jsx(f.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:$,className:"overflow-hidden",children:t.jsx("div",{className:"px-3 pb-2 space-y-1",children:se.map(e=>{const s=n[e];if(0===s)return null;const a=K[e];return t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"shrink-0 rounded-full",style:{width:8,height:8,backgroundColor:V[e]}}),t.jsx(a,{className:"w-3 h-3 text-text-muted shrink-0"}),t.jsx("span",{className:"text-text-secondary flex-1 truncate",children:_[e]}),t.jsx("span",{className:"text-text-muted tabular-nums",children:s})]},e)})})})})]}),t.jsxs("div",{children:[t.jsxs("button",{type:"button",onClick:()=>x(!d),className:"w-full flex items-center justify-between px-3 py-1.5 hover:bg-subtle-fill/50 transition-colors",children:[t.jsx("span",{className:"text-text-secondary",children:"Edge Types"}),t.jsx(f.span,{animate:{rotate:d?0:-90},transition:{duration:.15},children:t.jsx(v,{className:"w-3 h-3 text-text-muted"})})]}),t.jsx(g,{initial:!1,children:d&&t.jsx(f.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:$,className:"overflow-hidden",children:t.jsxs("div",{className:"px-3 pb-2 space-y-1",children:[l&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-4 h-0.5 rounded-full",style:{backgroundColor:Y}}),t.jsx(j,{className:"w-3 h-3 text-text-muted"}),t.jsx("span",{className:"text-text-secondary",children:"Direct RF (zero-hop)"})]}),i&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-4 h-0.5 rounded-full",style:{backgroundColor:Q}}),t.jsx(Z,{className:"w-3 h-3 text-text-muted"}),t.jsx("span",{className:"text-text-secondary",children:"Loop (redundant path)"})]}),r&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-4 h-0.5 rounded-full",style:{backgroundColor:U}}),t.jsx(G,{className:"w-3 h-3 text-text-muted"}),t.jsx("span",{className:"text-text-secondary",children:"Confirmed unicast"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-4 h-0.5 rounded-full",style:{backgroundColor:"#64748B"}}),t.jsx(H,{className:"w-3 h-3 text-text-muted"}),t.jsx("span",{className:"text-text-secondary",children:"Standard edge"})]}),t.jsxs("div",{className:"pt-1 mt-1 border-t border-border-subtle/50",children:[t.jsx("div",{className:"text-text-muted text-[10px] mb-1",children:"Edge thickness = certainty"}),t.jsx("div",{className:"h-2 rounded-sm",style:{background:`linear-gradient(to right, ${J.slice(0,5).join(", ")}, ${X})`}}),t.jsxs("div",{className:"flex justify-between text-[10px] text-text-muted",children:[t.jsx("span",{children:"Low"}),t.jsx("span",{children:"High"})]})]})]})})})]})]})}function ne({node:e,onClose:s,onZoomTo:a}){const n=K[e.nodeClass],l={active:{label:"Active",color:"text-accent-success"},recent:{label:"Recent",color:"text-accent-secondary"},stale:{label:"Stale",color:"text-signal-poor"},inactive:{label:"Inactive",color:"text-text-muted"}}[e.activityLevel]??{label:e.activityLevel,color:"text-text-muted"};return t.jsxs(f.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.15},className:"absolute top-4 right-4 z-20 bg-bg-elevated/95 backdrop-blur-sm rounded-xl border border-border-subtle shadow-2xl w-72",children:[t.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-border-subtle",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"shrink-0 rounded-full ring-2 ring-offset-1 ring-offset-bg-elevated",style:{width:10,height:10,backgroundColor:V[e.nodeClass],boxShadow:`0 0 8px ${V[e.nodeClass]}40`}}),t.jsx(n,{className:"w-3.5 h-3.5 text-text-muted"}),t.jsx("span",{className:"font-medium text-text-primary type-data-sm",children:e.prefix})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[e.isLocal&&t.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-yellow-500/20 text-yellow-300",children:"LOCAL"}),a&&t.jsx(p,{content:"Zoom to node",children:t.jsx("button",{onClick:a,className:"p-1 rounded hover:bg-subtle-fill transition-colors",children:t.jsx(E,{className:"w-3.5 h-3.5 text-text-muted"})})}),t.jsx("button",{onClick:s,className:"p-1 rounded hover:bg-subtle-fill transition-colors",children:t.jsx(y,{className:"w-3.5 h-3.5 text-text-muted"})})]})]}),t.jsxs("div",{className:"px-3 py-2 space-y-1.5 type-data-xs",children:[e.name&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-text-muted",children:"Name"}),t.jsx("span",{className:"text-text-primary font-medium truncate ml-2",children:e.name})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-text-muted",children:"Role"}),t.jsx("span",{className:"text-text-secondary capitalize",children:_[e.nodeClass]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-text-muted",children:"Activity"}),t.jsx("span",{className:l.color,children:l.label})]})]}),t.jsxs("div",{className:"px-3 py-2 space-y-1.5 type-data-xs border-t border-border-subtle",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-text-muted",children:"Packets"}),t.jsx("span",{className:"text-text-secondary tabular-nums",children:e.packetCount.toLocaleString()})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-text-muted",children:"Connections"}),t.jsx("span",{className:"text-text-secondary tabular-nums",children:e.degree})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-text-muted",children:"Betweenness"}),t.jsxs("span",{className:"text-text-secondary tabular-nums",children:[(100*e.betweenness).toFixed(1),"%"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-text-muted",children:"Community"}),t.jsxs("span",{className:"text-text-secondary tabular-nums",children:["#",e.communityId]})]})]}),e.isZeroHop&&(null!==e.avgRssi||null!==e.avgSnr)&&t.jsxs("div",{className:"px-3 py-2 space-y-1.5 type-data-xs border-t border-border-subtle",children:[t.jsx("div",{className:"text-text-muted text-[10px] uppercase tracking-wide",children:"Signal Quality"}),null!==e.avgRssi&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-text-muted",children:"RSSI"}),t.jsxs("span",{className:"text-text-secondary tabular-nums",children:[e.avgRssi.toFixed(0)," dBm"]})]}),null!==e.avgSnr&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-text-muted",children:"SNR"}),t.jsxs("span",{className:"text-text-secondary tabular-nums",children:[e.avgSnr.toFixed(1)," dB"]})]})]}),(e.isHub||e.isGateway||e.isBackbone||e.isMobile||e.isInLoop)&&t.jsx("div",{className:"px-3 py-2 border-t border-border-subtle",children:t.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.isHub&&t.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-indigo-500/20 text-indigo-300",children:"Hub"}),e.isGateway&&t.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-violet-500/20 text-violet-300",children:"Gateway"}),e.isBackbone&&t.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-emerald-500/20 text-emerald-300",children:"Backbone"}),e.isMobile&&t.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-orange-500/20 text-orange-300",children:"Mobile"}),e.isInLoop&&t.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-purple-500/20 text-purple-300",children:"In Loop"})]})}),e.hasCollision&&t.jsx("div",{className:"px-3 py-2 border-t border-border-subtle",children:t.jsxs("div",{className:"flex justify-between type-data-xs",children:[t.jsx("span",{className:"text-signal-poor",children:"Prefix collision"}),t.jsxs("span",{className:"text-text-muted tabular-nums",children:[(100*e.prefixConfidence).toFixed(0),"% conf"]})]})}),t.jsxs("div",{className:"px-3 py-2 border-t border-border-subtle space-y-1.5",children:[t.jsxs("div",{className:"flex justify-between type-data-xs",children:[t.jsx("span",{className:"text-text-muted",children:"Position"}),t.jsx("span",{className:e.hasGeo?"text-accent-success":"text-text-muted",children:e.hasGeo?"GPS":"Simulated"})]}),t.jsx("div",{children:t.jsx("span",{className:"text-text-muted break-all text-[10px] leading-relaxed font-mono",children:e.hash})})]})]})}function le(){return t.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 text-center px-8",children:[t.jsx("div",{className:"p-4 rounded-full bg-subtle-fill",children:t.jsx(F,{className:"w-8 h-8 text-text-muted"})}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h2",{className:"text-lg font-medium text-text-primary",children:"No Topology Data"}),t.jsx("p",{className:"text-sm text-text-muted max-w-sm",children:"The mesh topology will appear here once packets are received and processed. This typically takes a few minutes after starting."})]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-muted mt-2",children:[t.jsx(j,{className:"w-4 h-4 animate-pulse"}),t.jsx("span",{children:"Waiting for mesh traffic..."})]})]})}function ie(){var n;const j=l(),[v,R]=e.useState(!1),P=i(),D=r(),[F,G]=e.useState(!1),[I,T]=e.useState("fetching"),[Z,$]=e.useState(0),A=e.useRef(!1);e.useEffect(()=>{j&&!A.current&&(A.current=!0,(async()=>{G(!0),T("fetching"),$(0),await P(),T("analyzing"),await new Promise(e=>setTimeout(e,200)),T("building");const e=Date.now(),t=Date.now()-e;t<600&&await new Promise(e=>setTimeout(e,600-t)),T("discovering"),await new Promise(e=>setTimeout(e,400)),T("complete"),await new Promise(e=>setTimeout(e,800)),G(!1),R(!0)})())},[j,P]),e.useEffect(()=>{"fetching"===I&&(D.loadProgress?$(D.loadProgress.loaded):D.packetCount>0&&$(D.packetCount))},[I,D.loadProgress,D.packetCount]);const _=o(),J=c(),se=d(),ie=x(),[re,oe]=e.useState(!0),[ce,de]=e.useState(null),[xe,ue]=e.useState("all"),[me,pe]=e.useState(!0),[he,be]=e.useState(!0),[ge,fe]=e.useState(""),[ye,je]=e.useState(!1),ve=e.useRef(null),[Ne,we]=e.useState(null),[ke,Ce]=e.useState({x:0,y:0}),Le=e.useRef(null),[Se,Me]=e.useState(!1),Ee=u();e.useEffect(()=>{const e=e=>{var t;if(!(e.target instanceof HTMLInputElement))switch(e.key.toLowerCase()){case"f":e.metaKey||e.ctrlKey||(e.preventDefault(),null==(t=Ke.current)||t.fitView(300));break;case"escape":ye?(je(!1),fe("")):ce&&de(null);break;case"/":ye||(e.preventDefault(),je(!0),setTimeout(()=>{var e;return null==(e=ve.current)?void 0:e.focus()},50));break;case" ":e.preventDefault();{const e=Ke.current;e&&(re?e.pause():e.start(),oe(e=>!e))}break;case"l":pe(e=>!e);break;case"e":be(e=>!e)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ye,ce,re]);const Be=(null==ie?void 0:ie.latitude)??0,He=(null==ie?void 0:ie.longitude)??0,Re=null!==ie,Pe=e.useMemo(()=>Math.floor(Date.now()/1e3),[]),De=e.useMemo(()=>{var e;if(!J||0===J.size||!v)return[];const t=[],s=(null==se?void 0:se.node_name)??(null==(e=null==se?void 0:se.config)?void 0:e.node_name)??null,a={x:0,y:0};for(const n of J.values()){const e=n.isLocal?1:O(n.lastSeen,Pe);if(0===e&&!n.isLocal)continue;const l=V[n.nodeClass],i=n.isLocal?l:W(l,e),r=6+22*n.betweenness,o=n.isLocal?r:r*(.5+.5*e),c=n.isLocal?s??n.name:n.name;let d,x,u=!1;Re&&(n.isLocal?(d=0,x=0,u=!0):n.latitude&&n.longitude&&(ee(n.latitude,n.longitude,Be,He,a),d=a.x,x=a.y,u=!0)),t.push({id:n.hash,label:c?`${n.prefix} ${c}`:n.prefix,color:i,size:o,x:d,y:x,recencyWeight:e,nodeClass:n.nodeClass,name:c,prefix:n.prefix,packetCount:n.packetCount,betweenness:n.betweenness,communityId:n.communityId,isLocal:n.isLocal,isHub:n.isHub,isGateway:n.isGateway,isBackbone:n.isBackbone,isMobile:n.isMobile,isGhost:n.isGhost,isInLoop:n.isInLoop,isZeroHop:n.isZeroHop,hasGeo:u,avgRssi:n.avgRssi,avgSnr:n.avgSnr,degree:n.degree,activityLevel:n.activityLevel,prefixConfidence:n.prefixConfidence,hasCollision:n.hasCollision,lastSeen:n.lastSeen})}return t},[J,v,Re,Be,He,null==se?void 0:se.node_name,null==(n=null==se?void 0:se.config)?void 0:n.node_name,Pe]),Fe=e.useMemo(()=>{const e=new Set;for(const t of De)e.add(t.id);return e},[De]),{rawLinks:Ge,hasZeroHopEdges:Ie,hasLoopEdges:ze,hasDirectPathEdges:Te}=e.useMemo(()=>{const e=null==_?void 0:_.validatedEdges;if(!e||0===e.length||!v)return{rawLinks:[],maxCertainCount:0,hasZeroHopEdges:!1,hasLoopEdges:!1,hasDirectPathEdges:!1};let t=0,s=!1,a=!1,n=!1;for(const o of e)o.avgRecency<.02||Fe.has(o.fromHash)&&Fe.has(o.toHash)&&(o.certainCount>t&&(t=o.certainCount),s=s||!0===o.isZeroHop,a=a||!0===o.isLoopEdge,n=n||!0===o.isDirectPathEdge);const l=t>0?Math.log10(t+1):1,i=.8*t,r=[];for(const o of e){const e=o.avgRecency;if(e<.02)continue;if(!Fe.has(o.fromHash)||!Fe.has(o.toHash))continue;let s=.5;if(t>0&&o.certainCount>0){const e=Math.log10(o.certainCount+1);s=.5+7.5*Math.min(1,e/l)}const a=s*(.3+.7*e);let n;n=o.isZeroHop?Y:o.isLoopEdge?Q:o.isDirectPathEdge?U:o.certainCount>i?X:te(o.certainCount,t);const c=W(n,e);r.push({source:o.fromHash,target:o.toHash,color:c,width:a,strength:.3+.7*o.strength,recencyWeight:e,packetCount:o.packetCount,certainCount:o.certainCount,isZeroHop:o.isZeroHop??!1,isLoopEdge:o.isLoopEdge??!1,isDirectPath:o.isDirectPathEdge,avgConfidence:o.avgConfidence})}return{rawLinks:r,maxCertainCount:t,hasZeroHopEdges:s,hasLoopEdges:a,hasDirectPathEdges:n}},[null==_?void 0:_.validatedEdges,v,Fe]),Ze=e.useMemo(()=>{const e=new Map;for(const t of Ge)e.set(t.source,(e.get(t.source)??0)+1),e.set(t.target,(e.get(t.target)??0)+1);return e},[Ge]),$e=e.useMemo(()=>{const e=new Map;for(const t of De)e.set(t.id,t);return e},[De]),[Ae,Oe]=e.useState(null),[We,qe]=e.useState(null),[Ve,_e]=e.useState({}),Ke=e.useRef(null),Ye=e.useRef(!1),Qe=e.useRef(null);e.useEffect(()=>{var e,t;if(0===De.length||0===Ge.length)return Oe(null),qe(null),void(Qe.current=null);const s=`${De.length}:${Ge.length}:${null==(e=De[0])?void 0:e.id}:${null==(t=De[De.length-1])?void 0:t.id}`;if(s===Qe.current||Ye.current)return;let n=!1;return Ye.current=!0,(async()=>{try{const e=De.map(e=>({id:e.id,label:e.label,color:e.color})),t=Ge.map(e=>({source:e.source,target:e.target,color:e.color,width:e.width})),l=new Set(t.map(e=>e.width)),i={points:{pointIdBy:"id",pointColorBy:"color",pointLabelBy:"label",pointDefaultColor:"#64748B",pointGreyoutOpacity:.3,pointDefaultSize:12,pointSizeScale:1},links:{linkSourceBy:"source",linkTargetsBy:["target"],linkColorBy:"color",...t.length>=2&&l.size>=2?{linkWidthBy:"width",linkWidthRange:[.5,8]}:{},linkDefaultWidth:1,linkDefaultColor:"#4B5563",linkGreyoutOpacity:.2,linkWidthScale:1}},r=await a(i,e,t);if(n||!r)return;const{points:o,links:c,cosmographConfig:d}=r;Oe(o??null),qe(c??null),_e({...d,...q}),Qe.current=s}finally{Ye.current=!1}})(),()=>{n=!0}},[De,Ge]);const Ue=e.useCallback(e=>{Ke.current=e},[]),Xe=e.useCallback(()=>{var e;null==(e=Ke.current)||e.fitView(300)},[]),Je=e.useCallback(()=>{const e=Ke.current;e&&(re?e.pause():e.start(),oe(!re))},[re]),et=e.useCallback(async e=>{const t=Ke.current;if(t)try{const s=await t.getPointIndicesByIds([e]);s&&s.length>0&&void 0!==s[0]&&t.zoomToPoint(s[0],400,2.5)}catch{}},[]),tt=e.useMemo(()=>{if(!ge.trim())return[];const e=ge.toLowerCase();return De.filter(t=>{var s;return t.prefix.toLowerCase().includes(e)||(null==(s=t.name)?void 0:s.toLowerCase().includes(e))||t.id.toLowerCase().includes(e)}).slice(0,8)},[De,ge]),st=e.useCallback(e=>{et(e.id),je(!1),fe(""),de({hash:e.id,name:e.name,prefix:e.prefix,nodeClass:e.nodeClass,packetCount:e.packetCount,edgeCount:Ze.get(e.id)??0,betweenness:e.betweenness,communityId:e.communityId,degree:e.degree,hasGeo:e.hasGeo,isLocal:e.isLocal,isHub:e.isHub,isGateway:e.isGateway,isBackbone:e.isBackbone,isMobile:e.isMobile,isInLoop:e.isInLoop,isZeroHop:e.isZeroHop,avgRssi:e.avgRssi,avgSnr:e.avgSnr,activityLevel:e.activityLevel,prefixConfidence:e.prefixConfidence,hasCollision:e.hasCollision})},[et,Ze]),at=e.useRef(void 0),nt=e.useRef(0),lt=e.useCallback(async(e,t,s)=>{const a=Date.now();if(s&&a-nt.current>=16&&(nt.current=a,Ce({x:s.clientX,y:s.clientY})),e===at.current)return;at.current=e,Le.current&&(clearTimeout(Le.current),Le.current=null);const n=Ke.current;if(n)if(void 0!==e)try{const t=await n.getPointIdsByIndices([e]);if(!t||0===t.length)return;const s=t[0],a=$e.get(s);if(!a)return;we(a),n.selectPoint(e,!1,!0)}catch{we(null)}else Le.current=setTimeout(()=>{we(null),ce||n.unselectAllPoints()},100)},[$e,ce]),it=e.useCallback(()=>{Me(e=>!e)},[]),rt=e.useCallback(()=>{ue(e=>{const t=["all","hubs","neighbors","active"],s=t.indexOf(e);return t[(s+1)%t.length]})},[]),ot={all:"All nodes",hubs:"Hubs & gateways only",neighbors:"Direct RF neighbors",active:"Recently active"},ct=e.useCallback(async(e,t,s)=>{var a;if(we(null),at.current=void 0,void 0===e)return de(null),void(null==(a=Ke.current)||a.unselectAllPoints());const n=Ke.current;if(n)try{const t=await n.getPointIdsByIndices([e]);if(!t||0===t.length)return;const s=t[0],a=$e.get(s);if(!a)return;n.selectPoint(e,!1),de({hash:s,name:a.name,prefix:a.prefix,nodeClass:a.nodeClass,packetCount:a.packetCount,edgeCount:Ze.get(s)??0,betweenness:a.betweenness,communityId:a.communityId,degree:a.degree,hasGeo:a.hasGeo,isLocal:a.isLocal,isHub:a.isHub,isGateway:a.isGateway,isBackbone:a.isBackbone,isMobile:a.isMobile,isInLoop:a.isInLoop,isZeroHop:a.isZeroHop,avgRssi:a.avgRssi,avgSnr:a.avgSnr,activityLevel:a.activityLevel,prefixConfidence:a.prefixConfidence,hasCollision:a.hasCollision})}catch{}},[$e,Ze]);if(!v)return t.jsxs("div",{className:"-mx-4 sm:-mx-6 lg:-mx-8 -mt-5 -mb-4 sm:-mb-6 lg:-mb-8 h-[calc(100vh-64px)] flex items-center justify-center bg-black",children:[t.jsx(N,{isOpen:F,currentStep:I,packetCount:Z}),!F&&t.jsx(L,{className:"w-8 h-8 text-accent-primary animate-spin"})]});if(0===De.length)return t.jsxs("div",{className:"-mx-4 sm:-mx-6 lg:-mx-8 -mt-5 -mb-4 sm:-mb-6 lg:-mb-8 h-[calc(100vh-64px)] flex flex-col bg-black overflow-hidden",children:[t.jsx("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border-subtle bg-bg-elevated/50",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(m,{className:"w-5 h-5 text-accent-primary"}),t.jsxs("h1",{className:"type-data-sm font-semibold text-text-primary flex items-center gap-2",children:["MeshGraph",t.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-medium uppercase tracking-wider bg-accent-primary/20 text-accent-primary rounded",children:"Beta"})]})]})}),t.jsx("div",{className:"flex-1 flex items-center justify-center",children:t.jsx(le,{})})]});if(!Ae)return t.jsx("div",{className:"-mx-4 sm:-mx-6 lg:-mx-8 -mt-5 -mb-4 sm:-mb-6 lg:-mb-8 h-[calc(100vh-64px)] flex items-center justify-center bg-black",children:t.jsxs("div",{className:"flex flex-col items-center gap-3",children:[t.jsx(L,{className:"w-8 h-8 text-accent-primary animate-spin"}),t.jsx("span",{className:"text-sm text-text-muted",children:"Preparing graph..."})]})});const dt=Se?"fixed inset-0 z-50 bg-black":"-mx-4 sm:-mx-6 lg:-mx-8 -mt-5 -mb-4 sm:-mb-6 lg:-mb-8 h-[calc(100vh-64px)] bg-black";return t.jsxs("div",{className:`${dt} flex flex-col overflow-hidden`,children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-border-subtle/50 bg-black/80 backdrop-blur-sm z-10",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(m,{className:"w-5 h-5 text-accent-primary"}),t.jsxs("h1",{className:"type-data-sm font-semibold text-text-primary flex items-center gap-2",children:["MeshGraph",t.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-medium uppercase tracking-wider bg-accent-primary/20 text-accent-primary rounded",children:"Beta"})]}),t.jsxs("span",{className:"type-data-xs text-text-muted tabular-nums",children:[De.length," nodes • ",Ge.length," edges"]}),"all"!==xe&&t.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-accent-primary/20 text-accent-primary",children:ot[xe]})]}),t.jsxs("div",{className:"flex items-center gap-0.5",children:[t.jsx(p,{content:"Search nodes (/)",children:t.jsx("button",{onClick:()=>{je(!0),setTimeout(()=>{var e;return null==(e=ve.current)?void 0:e.focus()},50)},className:"p-2 rounded-lg transition-colors "+(ye?"bg-accent-primary/20 text-accent-primary":"hover:bg-subtle-fill text-text-muted"),children:t.jsx(S,{className:"w-4 h-4"})})}),t.jsx(p,{content:`Filter: ${ot[xe]}`,children:t.jsx("button",{onClick:rt,className:"p-2 rounded-lg transition-colors "+("all"!==xe?"bg-accent-primary/20 text-accent-primary":"hover:bg-subtle-fill text-text-muted"),children:t.jsx(B,{className:"w-4 h-4"})})}),t.jsx("div",{className:"w-px h-4 bg-border-subtle mx-1"}),t.jsx(p,{content:(me?"Hide":"Show")+" labels (L)",children:t.jsx("button",{onClick:()=>pe(e=>!e),className:"p-2 rounded-lg transition-colors "+(me?"text-text-muted hover:bg-subtle-fill":"text-text-muted/50 hover:bg-subtle-fill"),children:me?t.jsx(M,{className:"w-4 h-4"}):t.jsx(w,{className:"w-4 h-4"})})}),t.jsx(p,{content:(he?"Hide":"Show")+" edges (E)",children:t.jsx("button",{onClick:()=>be(e=>!e),className:"p-2 rounded-lg transition-colors "+(he?"text-text-muted hover:bg-subtle-fill":"text-text-muted/50 hover:bg-subtle-fill"),children:t.jsx(H,{className:"w-4 h-4"})})}),t.jsx("div",{className:"w-px h-4 bg-border-subtle mx-1"}),t.jsx(p,{content:(re?"Pause":"Resume")+" simulation (Space)",children:t.jsx("button",{onClick:Je,className:"p-2 rounded-lg hover:bg-subtle-fill transition-colors",children:re?t.jsx(h,{className:"w-4 h-4 text-accent-success"}):t.jsx(b,{className:"w-4 h-4 text-text-muted"})})}),t.jsx(p,{content:"Fit view (F)",children:t.jsx("button",{onClick:Xe,className:"p-2 rounded-lg hover:bg-subtle-fill transition-colors",children:t.jsx(z,{className:"w-4 h-4 text-text-muted"})})}),t.jsx(p,{content:Se?"Exit fullscreen":"Fullscreen",children:t.jsx("button",{onClick:it,className:"p-2 rounded-lg hover:bg-subtle-fill transition-colors",children:Se?t.jsx(k,{className:"w-4 h-4 text-text-muted"}):t.jsx(C,{className:"w-4 h-4 text-text-muted"})})})]})]}),t.jsxs("div",{className:"flex-1 relative min-h-0",children:[t.jsx(s,{className:"absolute inset-0",points:Ae,links:he?We:void 0,...Ve,backgroundColor:"#000000",fitViewOnInit:!0,showLabels:me,showDynamicLabels:me,showTopLabels:me,showTopLabelsLimit:30,showHoveredPointLabel:!1,pointLabelColor:"#E2E8F0",pointLabelFontSize:11,onClick:ct,onMouseMove:lt,onMount:Ue,renderHoveredPointRing:!0,hoveredPointRingColor:"#FBBF24",hoveredPointCursor:"pointer",pointGreyoutOpacity:.15,linkGreyoutOpacity:.1}),t.jsx(g,{children:Ne&&t.jsx(f.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.1},className:"fixed z-50 pointer-events-none",style:{left:ke.x+16,top:ke.y-8},children:t.jsxs("div",{className:"bg-bg-elevated/95 backdrop-blur-md rounded-lg border border-border-subtle shadow-2xl px-3 py-2 max-w-xs",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-full shrink-0 ring-1 ring-white/20",style:{backgroundColor:V[Ne.nodeClass],boxShadow:`0 0 6px ${V[Ne.nodeClass]}60`}}),t.jsx("span",{className:"font-medium text-text-primary text-sm truncate",children:Ne.name||Ne.prefix}),Ne.isLocal&&t.jsx("span",{className:"text-[9px] px-1 py-0.5 rounded bg-yellow-500/20 text-yellow-300 shrink-0",children:"LOCAL"})]}),t.jsxs("div",{className:"flex items-center gap-3 text-[10px] text-text-muted",children:[t.jsx("span",{className:"capitalize",children:Ne.nodeClass}),t.jsx("span",{children:"•"}),t.jsxs("span",{children:[Ne.packetCount.toLocaleString()," pkts"]}),t.jsx("span",{children:"•"}),t.jsxs("span",{children:[Ne.degree," conn"]})]}),Ne.isZeroHop&&(null!==Ne.avgSnr||null!==Ne.avgRssi)&&t.jsxs("div",{className:"flex items-center gap-2 mt-1 pt-1 border-t border-border-subtle/50 text-[10px]",children:[null!==Ne.avgSnr&&t.jsxs("span",{className:"text-accent-success",children:["SNR: ",Ne.avgSnr.toFixed(1)," dB"]}),null!==Ne.avgRssi&&t.jsxs("span",{className:"text-text-muted",children:["RSSI: ",Ne.avgRssi.toFixed(0)," dBm"]})]}),(Ne.isHub||Ne.isGateway||Ne.isBackbone||Ne.isMobile)&&t.jsxs("div",{className:"flex items-center gap-1 mt-1 pt-1 border-t border-border-subtle/50",children:[Ne.isHub&&t.jsx("span",{className:"text-[9px] px-1 py-0.5 rounded bg-indigo-500/20 text-indigo-300",children:"Hub"}),Ne.isGateway&&t.jsx("span",{className:"text-[9px] px-1 py-0.5 rounded bg-violet-500/20 text-violet-300",children:"Gateway"}),Ne.isBackbone&&t.jsx("span",{className:"text-[9px] px-1 py-0.5 rounded bg-emerald-500/20 text-emerald-300",children:"Backbone"}),Ne.isMobile&&t.jsx("span",{className:"text-[9px] px-1 py-0.5 rounded bg-orange-500/20 text-orange-300",children:"Mobile"})]}),t.jsx("div",{className:"text-[9px] text-text-muted/60 mt-1",children:"Click for details"})]})})}),t.jsx(g,{children:ye&&t.jsx(f.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.15},className:"absolute top-4 left-1/2 -translate-x-1/2 z-30 w-80",children:t.jsxs("div",{className:"bg-bg-elevated/95 backdrop-blur-sm rounded-xl border border-border-subtle shadow-2xl overflow-hidden",children:[t.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 border-b border-border-subtle",children:[t.jsx(S,{className:"w-4 h-4 text-text-muted shrink-0"}),t.jsx("input",{ref:ve,type:"text",value:ge,onChange:e=>fe(e.target.value),placeholder:"Search by name or prefix...",className:"flex-1 bg-transparent text-sm text-text-primary placeholder:text-text-muted focus:outline-none",onKeyDown:e=>{"Escape"===e.key?(je(!1),fe("")):"Enter"===e.key&&tt.length>0&&st(tt[0])}}),ge&&t.jsx("button",{onClick:()=>fe(""),className:"p-0.5 rounded hover:bg-subtle-fill",children:t.jsx(y,{className:"w-3 h-3 text-text-muted"})})]}),tt.length>0&&t.jsx("div",{className:"max-h-64 overflow-y-auto",children:tt.map((e,s)=>{const a=K[e.nodeClass];return t.jsxs("button",{onClick:()=>st(e),className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-subtle-fill transition-colors "+(0===s?"bg-subtle-fill/50":""),children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-full shrink-0",style:{backgroundColor:V[e.nodeClass]}}),t.jsx(a,{className:"w-3.5 h-3.5 text-text-muted shrink-0"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm text-text-primary truncate",children:e.name||e.prefix}),e.name&&t.jsx("div",{className:"text-[10px] text-text-muted",children:e.prefix})]}),t.jsx(E,{className:"w-3 h-3 text-text-muted shrink-0"})]},e.id)})}),ge&&0===tt.length&&t.jsx("div",{className:"px-3 py-4 text-center text-sm text-text-muted",children:"No nodes found"}),!ge&&t.jsx("div",{className:"px-3 py-2 text-[10px] text-text-muted",children:"Type to search • Enter to select • Esc to close"})]})})}),t.jsx(ae,{nodeCount:De.length,edgeCount:Ge.length,nodeClassCounts:Ee,hasZeroHopEdges:Ie,hasLoopEdges:ze,hasDirectPathEdges:Te}),t.jsxs("div",{className:"absolute bottom-4 right-4 z-10 hidden lg:flex items-center gap-3 text-[10px] text-text-muted/60",children:[t.jsxs("span",{children:[t.jsx("kbd",{className:"px-1 py-0.5 rounded bg-subtle-fill/50 font-mono",children:"/"})," Search"]}),t.jsxs("span",{children:[t.jsx("kbd",{className:"px-1 py-0.5 rounded bg-subtle-fill/50 font-mono",children:"F"})," Fit"]}),t.jsxs("span",{children:[t.jsx("kbd",{className:"px-1 py-0.5 rounded bg-subtle-fill/50 font-mono",children:"Space"})," Pause"]}),t.jsxs("span",{children:[t.jsx("kbd",{className:"px-1 py-0.5 rounded bg-subtle-fill/50 font-mono",children:"Esc"})," Clear"]})]}),t.jsx(g,{children:ce&&t.jsx(ne,{node:ce,onClose:()=>de(null),onZoomTo:()=>et(ce.hash)})})]})]})}export{ie as default};
