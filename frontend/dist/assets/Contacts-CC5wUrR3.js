const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ContactsMapMapLibre-Yuwf5lGD.js","assets/vendor-react-x42QsIkh.js","assets/BasemapLayer-7nHerjzi.js","assets/vendor-core-0wDYfnVU.js","assets/link-scoring-BUOk0Kjn.js","assets/index-CqjVu85e.js","assets/ConfirmModal-0QMxKNDr.js","assets/triangle-alert-BrOs1E2a.js","assets/DeepAnalysisModal-Qys-T00i.js","assets/config-CTM8_93T.js","assets/git-branch-Bh6g8Ri4.js","assets/database-BR3kPj_K.js","assets/LightSparkline-CimcVFxJ.js","assets/DelayedAnimateNumber-uQrYCMi2.js","assets/index-Dp8VqV67.js","assets/refresh-cw-BGxNZ4g1.js","assets/target-BKHz00Qy.js","assets/easing-BrfN1U4X.js","assets/SignalIndicator-9GIHVV0_.js","assets/font-loader-GClKF516.js","assets/users-CtEpYPqB.js","assets/DataBox-DmhwIVz9.js","assets/map-pin-Ciaj8ACH.js","assets/ping-BMKYVBNs.js","assets/PageLayout-CeDxQcaV.js","assets/activity-CU786gTn.js","assets/circle-check-0xCuEdgL.js","assets/CollisionExplorerModal-Dx56aKiU.js","assets/network-QtVXdqXq.js","assets/maplibre-gl-B1CfjdFi.css","assets/index-D2-UTW8f.css"])))=>i.map(i=>d[i]);
import{j as e,i as s,c as t,l as a,m as n,n as l,I as i,r,_ as c}from"./vendor-react-x42QsIkh.js";import{c as o,O as d,A as x,m,f as h,au as p,av as u,aw as g,ao as j,ax as b,M as N,ah as v,ay as f,az as y,v as w,e as k,G as C,Q as M,aA as S,p as L,aB as P,aC as F,aD as H,o as R,aE as E,aF as T,aG as _,X as z,aH as O,I as $,a0 as I,R as A}from"./index-CqjVu85e.js";import{p as D}from"./ping-BMKYVBNs.js";import{P as G,b as V,B as U}from"./PageLayout-CeDxQcaV.js";import{t as B}from"./config-CTM8_93T.js";import{G as K}from"./git-branch-Bh6g8Ri4.js";import{T as W}from"./triangle-alert-BrOs1E2a.js";import{a as q,T as Z,M as J,L as Q}from"./LightSparkline-CimcVFxJ.js";import{c as X,Z as Y,a as ee,C as se,d as te,e as ae}from"./SignalIndicator-9GIHVV0_.js";import{E as ne,S as le,T as ie,a as re}from"./target-BKHz00Qy.js";import{A as ce}from"./activity-CU786gTn.js";import{D as oe}from"./DataBox-DmhwIVz9.js";import{F as de,U as xe}from"./users-CtEpYPqB.js";import{P as me,T as he,C as pe}from"./ConfirmModal-0QMxKNDr.js";import{M as ue}from"./map-pin-Ciaj8ACH.js";import{C as ge}from"./circle-check-0xCuEdgL.js";import{C as je,S as be,M as Ne}from"./CollisionExplorerModal-Dx56aKiU.js";import{N as ve}from"./network-QtVXdqXq.js";const fe=o("arrow-left-right",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]),ye=o("arrow-up-down",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]),we=o("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),ke=o("file-digit",[["path",{d:"M4 12V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2",key:"jrl274"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 16h2v6",key:"1bxocy"}],["path",{d:"M10 22h4",key:"ceow96"}],["rect",{x:"2",y:"16",width:"4",height:"6",rx:"2",key:"r45zd0"}]]),Ce=o("list-filter",[["path",{d:"M2 5h20",key:"1fs1ex"}],["path",{d:"M6 12h12",key:"8npq4p"}],["path",{d:"M9 19h6",key:"456am0"}]]),Me=o("ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]),Se=o("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]);function Le({value:i,onChange:r,className:c,placeholder:o,disabled:h,"aria-label":p,children:u}){return e.jsx(s,{value:i,onChange:r,disabled:h,children:({open:s})=>e.jsxs("div",{className:t("relative",c),children:[e.jsxs(a,{"aria-label":p,className:t(["relative flex w-full items-center justify-between gap-2","radius-inner px-3 py-2","text-left text-sm text-text-primary","bg-bg-subtle border-control","ring-focus-inset","hover:border-border-strong","disabled:opacity-40 disabled:pointer-events-none disabled:cursor-not-allowed","transition-colors"]),children:[e.jsx(n,{as:"span",options:u,placeholder:o&&e.jsx("span",{className:"text-text-muted",children:o}),className:"block truncate"}),e.jsx(d,{className:t("w-4 h-4 text-text-muted transition-transform duration-200",s&&"rotate-180")})]}),e.jsx(x,{children:s&&e.jsx(m.div,{initial:{opacity:0,y:-4,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-4,scale:.98},transition:B.dropdown,className:"absolute z-50 mt-1",children:e.jsx(l,{static:!0,anchor:"bottom start",className:t(["w-[var(--button-width)] min-w-[180px]","max-h-60 overflow-y-auto overscroll-contain scroll-py-1","radius-inset p-1","surface-elevated","focus:outline-none"]),children:u})})})]})})}function Pe({value:s,disabled:a,className:n,children:l}){return e.jsx(i,{as:r.Fragment,value:s,disabled:a,children:({selected:s,focus:i})=>e.jsxs("div",{className:t("flex items-center gap-2 px-3 py-2 radius-control cursor-default","text-sm",i&&"bg-accent-primary text-white",!i&&"text-text-primary",s&&!i&&"text-accent-primary",a&&"opacity-50 cursor-not-allowed",n),children:[e.jsx("span",{className:"w-4 flex-shrink-0",children:s&&e.jsx(h,{className:"w-4 h-4"})}),e.jsx("span",{className:"truncate",children:l})]})})}class Fe extends r.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}render(){var s;return this.state.hasError?e.jsx("div",{className:t("map-container-16-9 flex items-center justify-center rounded-2xl",p),role:"alert","aria-live":"assertive",children:e.jsxs("div",{className:"text-center text-text-muted p-4",children:[e.jsx("p",{className:"text-lg mb-2",children:"Map failed to load"}),e.jsx("p",{className:"text-sm text-text-muted",children:(null==(s=this.state.error)?void 0:s.message)||"Unknown error"}),e.jsx("p",{className:"text-xs text-text-muted mt-2",children:"Try refreshing the page or check your browser's WebGL support."})]})}):this.props.children}}const He=r.lazy(()=>c(()=>import("./ContactsMapMapLibre-Yuwf5lGD.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30])));function Re({neighbors:s,localNode:a,localHash:n,onRemoveNode:l,selectedNodeHash:i,onNodeSelected:c,highlightedEdgeKey:o,highlightedGhost:d}){return e.jsx(Fe,{children:e.jsx(r.Suspense,{fallback:e.jsx("div",{className:t("map-container-16-9 flex items-center justify-center rounded-2xl",p),role:"status","aria-live":"polite","aria-label":"Loading map",children:e.jsxs("div",{className:"text-text-muted flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-accent-primary border-t-transparent rounded-full animate-spin","aria-hidden":"true"}),e.jsx("span",{children:"Loading map..."})]})}),children:e.jsx(He,{neighbors:s,localNode:a,localHash:n,onRemoveNode:l,selectedNodeHash:i,onNodeSelected:c,highlightedEdgeKey:o,highlightedGhost:d})})})}function Ee(e){return e>=.7?"text-accent-success":e>=.5?"text-accent-secondary":e>=.3?"text-signal-poor":"text-accent-danger"}function Te(e){return`${Math.round(100*e)}%`}function _e(e,s){return s.has(e.toUpperCase())}const ze=r.memo(function({path:s,isHighlighted:t,onHighlight:a,ghostPrefixes:n}){const l=function(s){return s>.2?{icon:e.jsx(Z,{className:"w-3 h-3"}),color:"text-accent-success"}:s<-.2?{icon:e.jsx(q,{className:"w-3 h-3"}),color:"text-accent-danger"}:{icon:e.jsx(N,{className:"w-3 h-3"}),color:"text-text-muted"}}(s.observationTrend),i=s.weakestLinkKey&&s.weakestLinkConfidence<.5,r=s.hops.some(e=>_e(e,n));return e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-md transition-colors cursor-pointer "+(t?"bg-accent-primary/20 border border-accent-primary/40":"hover:bg-subtle-fill"),onClick:()=>a(t?null:s.weakestLinkKey),children:[e.jsx("div",{className:"flex-shrink-0 w-12 text-center py-1 rounded-md "+(c=s.healthScore,c>=.7?"bg-accent-success/10":c>=.5?"bg-accent-secondary/10":c>=.3?"bg-signal-poor/10":"bg-accent-danger/10"),children:e.jsx("span",{className:`text-xs font-semibold tabular-nums ${Ee(s.healthScore)}`,children:Te(s.healthScore)})}),e.jsx("div",{className:"flex-1 flex items-center gap-0.5 overflow-x-auto min-w-0",children:s.hops.map((t,a)=>{var l;const r=_e(t,n),c=i&&(null==(l=s.weakestLinkKey)?void 0:l.includes(t));return e.jsxs("span",{className:"flex items-center",children:[e.jsxs("span",{className:"text-[10px] font-mono px-1.5 py-0.5 rounded flex items-center gap-0.5 "+(r?"bg-accent-tertiary/20 text-accent-tertiary border border-accent-tertiary/30":c?"bg-accent-danger/20 text-accent-danger":"bg-subtle-fill-strong text-text-secondary"),children:[r&&e.jsx(b,{className:"w-2.5 h-2.5"}),t]}),a<s.hops.length-1&&e.jsx("span",{className:"text-text-muted mx-0.5",children:"→"})]},a)})}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-3",children:[e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded "+("direct"===s.routeType?"bg-accent-success/20 text-accent-success":"flood"===s.routeType?"bg-accent-primary/20 text-accent-primary":"bg-subtle-fill-strong text-text-muted"),children:"direct"===s.routeType?"D":"flood"===s.routeType?"F":"M"}),e.jsxs("div",{className:"flex items-center gap-1 text-text-muted",title:"Estimated latency",children:[e.jsx(Y,{className:"w-3 h-3"}),e.jsxs("span",{className:"text-[10px] tabular-nums",children:[s.estimatedLatencyMs,"ms"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-text-muted",title:"Observations",children:[e.jsx(ce,{className:"w-3 h-3"}),e.jsx("span",{className:"text-[10px] tabular-nums",children:s.observationCount})]}),e.jsx("div",{className:`flex items-center gap-1 ${l.color}`,title:"Usage trend",children:l.icon}),r&&e.jsx("div",{className:"text-accent-tertiary",title:"Path includes ghost (unknown) nodes",children:e.jsx(b,{className:"w-3 h-3"})}),i&&e.jsx("div",{className:"text-accent-danger",title:`Weak link: ${s.weakestLinkConfidence.toFixed(0)}% confidence`,children:e.jsx(W,{className:"w-3 h-3"})})]})]});var c}),Oe=r.memo(function({maxPaths:s=10,onHighlightEdge:t,highlightedEdge:a}){const n=u(),l=g(),i=j(),[c,o]=r.useState(!1),x=r.useMemo(()=>new Set(i.map(e=>e.prefix.toUpperCase())),[i]),m=r.useMemo(()=>n.slice(0,s),[n,s]),h=r.useMemo(()=>0===n.length?null:{avgHealth:n.reduce((e,s)=>e+s.healthScore,0)/n.length,declining:n.filter(e=>e.observationTrend<-.2).length,weakLinks:n.filter(e=>e.weakestLinkConfidence<.5).length,pathsWithGhosts:n.filter(e=>e.hops.some(e=>x.has(e.toUpperCase()))).length},[n,x]),p=e=>{null==t||t(e)};return 0===n.length?null:e.jsxs("div",{className:"chart-container",children:[e.jsxs("button",{onClick:()=>o(!c),className:"w-full chart-header hover:bg-subtle-fill transition-colors rounded-t-lg cursor-pointer",children:[e.jsxs("div",{className:"chart-title",children:[e.jsx(K,{className:"chart-title-icon"}),"Path Health",e.jsxs("span",{className:"ml-2 text-[10px] font-normal text-text-muted",children:["(",n.length," paths)"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[h&&e.jsxs("div",{className:"flex items-center gap-3 text-[10px]",children:[e.jsxs("span",{className:`tabular-nums ${Ee(h.avgHealth)}`,children:["Avg: ",Te(h.avgHealth)]}),h.weakLinks>0&&e.jsxs("span",{className:"text-accent-danger flex items-center gap-1",children:[e.jsx(W,{className:"w-3 h-3"}),h.weakLinks," weak"]}),h.declining>0&&e.jsxs("span",{className:"text-signal-poor flex items-center gap-1",children:[e.jsx(q,{className:"w-3 h-3"}),h.declining," declining"]}),h.pathsWithGhosts>0&&e.jsxs("span",{className:"text-accent-tertiary flex items-center gap-1",children:[e.jsx(b,{className:"w-3 h-3"}),h.pathsWithGhosts," ghost"]})]}),c?e.jsx(X,{className:"w-4 h-4 text-text-muted"}):e.jsx(d,{className:"w-4 h-4 text-text-muted"})]})]}),c&&e.jsxs("div",{className:"p-3 pt-0 space-y-1",children:[l.totalPaths>0&&e.jsxs("div",{className:"flex items-center gap-3 text-[10px] text-text-muted pb-2 border-b border-border-subtle",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:"w-3 h-3 text-accent-primary"}),e.jsx("span",{className:"text-text-secondary",children:l.totalPaths.toLocaleString()})," Viterbi decoded"]}),l.observationOverrideCount>0&&e.jsxs("span",{className:"text-accent-success",children:[Math.round(l.observationOverrideCount/l.totalPaths*100),"% observation override"]}),i.length>0&&e.jsxs("span",{className:"text-accent-tertiary flex items-center gap-1",children:[e.jsx(b,{className:"w-3 h-3"}),i.length," ghost",1!==i.length?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-[10px] text-text-muted pb-2 border-b border-border-subtle",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-accent-success"})," Healthy (≥70%)"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-accent-secondary"})," Fair (50-70%)"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-signal-poor"})," Weak (30-50%)"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-accent-danger"})," Critical (<30%)"]}),i.length>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-3 h-3 text-accent-tertiary"})," Ghost"]})]}),e.jsx("div",{className:"space-y-1 max-h-64 overflow-y-auto",children:m.map(s=>e.jsx(ze,{path:s,isHighlighted:a===s.weakestLinkKey,onHighlight:p,ghostPrefixes:x},s.pathKey))}),n.length>s&&e.jsxs("div",{className:"text-center text-[10px] text-text-muted pt-2",children:["Showing top ",s," of ",n.length," paths"]})]})]})});function $e(e){switch(e){case"rf_intersection":return"RF Circle Intersection";case"weighted_centroid":return"Weighted Centroid";case"single_anchor":return"Single Anchor (less reliable)";default:return e}}const Ie={confirmed:{label:"Confirmed",icon:e.jsx(Se,{className:"w-3.5 h-3.5"}),borderClass:"border-accent-success/40",bgClass:"bg-accent-success/10",textClass:"text-accent-success",badgeClass:"bg-accent-success/20 text-accent-success"},likely:{label:"Likely",icon:e.jsx(h,{className:"w-3.5 h-3.5"}),borderClass:"border-accent-tertiary/30",bgClass:"bg-accent-tertiary/5",textClass:"text-accent-tertiary",badgeClass:"bg-accent-tertiary/20 text-accent-tertiary"},possible:{label:"Possible",icon:e.jsx(ee,{className:"w-3.5 h-3.5"}),borderClass:"border-accent-secondary/20",bgClass:"bg-accent-secondary/5",textClass:"text-accent-secondary",badgeClass:"bg-accent-secondary/20 text-accent-secondary"},noise:{label:"Noise",icon:e.jsx(W,{className:"w-3.5 h-3.5"}),borderClass:"border-border-muted",bgClass:"bg-bg-card/30",textClass:"text-text-muted",badgeClass:"bg-bg-elevated text-text-muted"}};function Ae({ghost:s,neighbors:a,isExpanded:n,onToggle:l,compact:i}){var c,o;const x=(null==(c=s.classification)?void 0:c.tier)??"noise",m=Ie[x],h="clusterId"in(p=s)&&"temporal"in p;var p;const u=r.useMemo(()=>Array.from(s.commonNeighbors).map(e=>{var s;return{hash:e,name:null==(s=a[e])?void 0:s.name}}),[s.commonNeighbors,a]),g=s.estimatedLocation?s.estimatedLocation.uncertaintyM>=1e3?`±${(s.estimatedLocation.uncertaintyM/1e3).toFixed(1)}km`:`±${Math.round(s.estimatedLocation.uncertaintyM)}m`:null,j=h&&s.temporal?(N=s.temporal.consistency)>=.7?{label:"Steady",color:"text-accent-success"}:N>=.4?{label:"Regular",color:"text-accent-tertiary"}:N>=.2?{label:"Sporadic",color:"text-accent-secondary"}:{label:"Bursty",color:"text-signal-poor"}:null;var N;const y=h&&s.collisionCandidates&&s.collisionCandidates.length>0,w=y?s.collisionCandidates[0]:null;return i?e.jsxs("div",{className:"inline-flex items-center gap-1.5 px-2 py-1 rounded bg-bg-elevated/50 text-sm",children:[e.jsx("span",{className:"font-mono font-medium text-text-secondary",children:s.prefix.toUpperCase()}),e.jsx("span",{className:"text-text-muted",children:s.observationCount})]}):e.jsxs("div",{className:t("rounded-lg border transition-all duration-150",m.borderClass,m.bgClass),children:[e.jsxs("button",{onClick:l,className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-subtle-fill rounded-lg",children:[e.jsx(b,{className:t("w-5 h-5 flex-shrink-0",m.textClass)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-sm font-semibold text-text-primary",children:s.prefix.toUpperCase()}),e.jsx("span",{className:t("px-1.5 py-0.5 rounded text-sm font-medium",m.badgeClass),children:m.label})]}),e.jsx("div",{className:t("text-sm mt-0.5",m.textClass),children:(null==(o=s.classification)?void 0:o.reason)??"Unknown"}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-text-muted mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:"w-3 h-3"}),s.observationCount]}),e.jsxs("span",{children:[(100*s.confidence).toFixed(0),"%"]}),s.commonNeighbors.size>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"w-3 h-3"}),s.commonNeighbors.size]}),s.estimatedLocation&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"w-3 h-3"}),g]}),j&&e.jsxs("span",{className:t("flex items-center gap-1",j.color),children:[e.jsx(ce,{className:"w-3 h-3"}),j.label]}),y&&e.jsxs("span",{className:"flex items-center gap-1 text-signal-poor",children:[e.jsx(le,{className:"w-3 h-3"}),"Collision?"]})]})]}),n?e.jsx(X,{className:"w-4 h-4 text-text-muted"}):e.jsx(d,{className:"w-4 h-4 text-text-muted"})]}),n&&e.jsxs("div",{className:"px-3 pb-3 space-y-3 border-t border-border-muted/50 mt-1 pt-3",children:[y&&w&&e.jsx("div",{className:"p-2 rounded bg-signal-poor/10 border border-signal-poor/30",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(le,{className:"w-4 h-4 text-signal-poor flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-signal-poor font-medium",children:"Possible collision with known node"}),e.jsx("div",{className:"text-text-secondary mt-0.5",children:w.knownNodeName?e.jsxs("span",{children:["May match ",e.jsx("span",{className:"font-medium",children:w.knownNodeName})," ","(",(100*w.collisionProbability).toFixed(0),"% probability)"]}):e.jsxs("span",{children:["May match ",e.jsx(oe,{copy:!0,size:"compact",className:"inline",children:w.knownNodeHash})," ","(",(100*w.collisionProbability).toFixed(0),"% probability)"]})}),w.evidence&&e.jsxs("div",{className:"text-text-muted mt-1 text-[10px]",children:[w.evidence.sharedEdgeCount>0&&e.jsxs("span",{className:"mr-2",children:[w.evidence.sharedEdgeCount," shared edges"]}),void 0!==w.evidence.distanceKm&&e.jsxs("span",{className:"mr-2",children:[w.evidence.distanceKm.toFixed(1),"km apart"]}),w.evidence.withinUncertainty&&e.jsx("span",{className:"text-accent-secondary",children:"Within uncertainty radius"})]})]})]})}),s.estimatedLocation?e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ue,{className:"w-4 h-4 text-accent-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"text-text-primary font-medium",children:[s.estimatedLocation.lat.toFixed(5),", ",s.estimatedLocation.lon.toFixed(5)]}),e.jsxs("div",{className:"text-text-muted",children:["Uncertainty: ",g]}),h&&s.location&&e.jsxs("div",{className:"mt-1 text-text-muted",children:[e.jsxs("div",{children:["Method: ",$e(s.location.method)]}),s.location.anchors&&s.location.anchors.length>0&&e.jsxs("div",{children:[s.location.anchors.length," anchor",1!==s.location.anchors.length?"s":""," used"," · ",(100*s.location.locationConfidence).toFixed(0),"% confidence"]})]})]})]}):e.jsxs("div",{className:"flex items-center gap-2 text-sm text-text-muted",children:[e.jsx(W,{className:"w-4 h-4 text-signal-poor"}),"Location unknown (neighbors lack coordinates)"]}),h&&s.temporal&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-text-muted mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"text-text-primary font-medium",children:["Temporal Pattern: ",e.jsx("span",{className:null==j?void 0:j.color,children:null==j?void 0:j.label})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-0.5 mt-1 text-text-muted",children:[e.jsxs("span",{children:["Distinct hours: ",s.temporal.distinctHours]}),e.jsxs("span",{children:["Distinct days: ",s.temporal.distinctDays]}),e.jsxs("span",{children:["Burstiness: ",(100*s.temporal.burstiness).toFixed(0),"%"]}),e.jsxs("span",{children:["Consistency: ",(100*s.temporal.consistency).toFixed(0),"%"]}),e.jsxs("span",{children:["Last 24h: ",s.temporal.last24HourCount," obs"]}),e.jsxs("span",{children:["Active hours: ",s.temporal.activeHoursLast24,"/24"]})]})]})]}),!h&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(v,{className:"w-4 h-4 text-text-muted mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"text-text-primary",children:["First seen: ",f(s.firstSeen)," ago"]}),e.jsxs("div",{className:"text-text-muted",children:["Last seen: ",f(s.lastSeen)," ago"]})]})]}),h&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(we,{className:"w-4 h-4 text-text-muted mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"text-text-primary",children:["Active period: ",f(s.firstSeen)," – ",f(s.lastSeen)," ago"]}),s.temporal&&e.jsxs("div",{className:"text-text-muted",children:["Obs/hour avg: ",s.temporal.observationsPerHour.toFixed(1)]})]})]}),u.length>0&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-text-muted mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"text-text-muted mb-1",children:["Adjacent to ",u.length," known node",1!==u.length?"s":"",":"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[u.slice(0,5).map(({hash:s})=>e.jsx(oe,{copy:!0,size:"compact",children:s},s)),u.length>5&&e.jsxs("span",{className:"text-text-muted",children:["+",u.length-5," more"]})]})]})]}),h&&s.validationStages&&e.jsxs("div",{className:"pt-2 border-t border-border-muted/30",children:[e.jsx("div",{className:"text-[10px] text-text-muted mb-1.5 uppercase tracking-wide",children:"Validation Stages"}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[e.jsx(De,{label:"Candidates",passed:s.validationStages.candidateExhaustion}),e.jsx(De,{label:"Temporal",passed:s.validationStages.temporalConsistency}),e.jsx(De,{label:"Topology",passed:s.validationStages.topologicalFit}),e.jsx(De,{label:"Location",passed:s.validationStages.locationPlausible})]})]}),s.classification&&!h&&e.jsx("div",{className:"pt-2 border-t border-border-muted/30",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.classification.criteria.hasVeryHighObservations&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-accent-success/20 text-accent-success",children:"200+ obs"}),s.classification.criteria.hasHighObservations&&!s.classification.criteria.hasVeryHighObservations&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-accent-tertiary/20 text-accent-tertiary",children:"50+ obs"}),s.classification.criteria.hasHighConfidence&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-accent-success/20 text-accent-success",children:"70%+ conf"}),s.classification.criteria.hasCommonNeighbors&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-accent-primary/20 text-accent-primary",children:"2+ neighbors"}),s.classification.criteria.hasGoodLocation&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-accent-primary/20 text-accent-primary",children:"good loc"}),s.classification.criteria.isRecent&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-text-muted/20 text-text-muted",children:"recent"})]})}),h&&s.upgradeRequirements&&s.upgradeRequirements.length>0&&"confirmed"!==x&&e.jsxs("div",{className:"pt-2 border-t border-border-muted/30",children:[e.jsx("div",{className:"text-[10px] text-text-muted mb-1 uppercase tracking-wide",children:"To upgrade tier:"}),e.jsx("ul",{className:"text-xs text-text-secondary space-y-0.5",children:s.upgradeRequirements.slice(0,3).map((s,t)=>e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-accent-tertiary",children:"•"})," ",s]},t))})]})]})]})}function De({label:s,passed:a}){return e.jsxs("span",{className:t("inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-medium",a?"bg-accent-success/20 text-accent-success":"bg-bg-elevated text-text-muted"),children:[a?e.jsx(ge,{className:"w-2.5 h-2.5"}):e.jsx(se,{className:"w-2.5 h-2.5"}),s]})}function Ge({neighbors:s,className:a,onGhostSelect:n}){const l=j(),i=g(),[c,o]=r.useState(new Set),[x,m]=r.useState("actionable"),[p,u]=r.useState(!1),[v,f]=r.useState(!0),[y,w]=r.useState(Date.now);r.useEffect(()=>{w(Date.now())},[l]);const k=r.useMemo(()=>l.filter(e=>!function(e,s){return s-1e3*e.lastSeen>6048e5}(e,y)),[l,y]),C=r.useMemo(()=>{const e=Array.from(c);return e.length>0?e[0]:null},[c]),M=r.useMemo(()=>C?k.find(e=>e.prefix===C)??null:null,[C,k]);r.useEffect(()=>{n&&n(M&&!v?{prefix:M.prefix,commonNeighbors:Array.from(M.commonNeighbors),estimatedLocation:M.estimatedLocation}:null)},[M,v,n]),r.useEffect(()=>{v&&o(new Set)},[v]);const{confirmed:S,likely:L,possible:P,noise:F,actionableCount:H}=r.useMemo(()=>{var e;const s=[],t=[],a=[],n=[];for(const i of k)switch((null==(e=i.classification)?void 0:e.tier)??"noise"){case"confirmed":s.push(i);break;case"likely":t.push(i);break;case"possible":a.push(i);break;case"noise":n.push(i)}const l=(e,s)=>s.observationCount-e.observationCount;return s.sort(l),t.sort(l),a.sort(l),n.sort(l),{confirmed:s,likely:t,possible:a,noise:n,actionableCount:s.length+t.length}},[k]);if(0===k.length)return null;const R=e=>{o(s=>s.has(e)?new Set:new Set([e]))},E="all"===x,T=S.length+L.length+(E?P.length:0)+(p?F.length:0);return e.jsxs("div",{className:a,children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"chart-title",children:[e.jsx(b,{className:"chart-title-icon"}),"Ghost Buster",H>0&&e.jsxs("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-accent-success/20 text-accent-success",children:[H," actionable"]}),v&&k.length>0&&e.jsxs("span",{className:"text-xs text-text-muted ml-2",children:["(",k.length," total)"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!v&&e.jsxs("button",{onClick:()=>m(e=>"actionable"===e?"all":"actionable"),className:t("flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-colors","all"===x?"bg-accent-primary/20 text-accent-primary":"bg-bg-elevated text-text-muted hover:text-text-secondary"),children:[e.jsx(de,{className:"w-3 h-3"}),"actionable"===x?"Actionable":"All"]}),e.jsx("button",{onClick:()=>f(e=>!e),className:"flex items-center gap-1 px-2 py-1 rounded text-xs bg-bg-elevated text-text-muted hover:text-text-secondary transition-colors",title:v?"Expand panel":"Minimize panel",children:v?e.jsx(me,{className:"w-3 h-3"}):e.jsx(N,{className:"w-3 h-3"})})]})]}),v?e.jsxs("div",{className:"px-5 py-3 flex items-center gap-3 text-xs cursor-pointer hover:bg-subtle-fill transition-colors",onClick:()=>f(!1),children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[S.length>0&&e.jsxs("span",{className:"flex items-center gap-1 text-accent-success",children:[e.jsx(Se,{className:"w-3 h-3"}),S.length," confirmed"]}),L.length>0&&e.jsxs("span",{className:"flex items-center gap-1 text-accent-tertiary",children:[e.jsx(h,{className:"w-3 h-3"}),L.length," likely"]}),P.length>0&&e.jsxs("span",{className:"text-accent-secondary",children:[P.length," possible"]}),F.length>0&&e.jsxs("span",{className:"text-text-muted",children:[F.length," noise"]})]}),e.jsx("span",{className:"text-text-muted ml-auto",children:"Click to expand"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-5 py-2 flex items-center gap-3 text-xs border-b border-border-muted/30",children:[e.jsxs("span",{className:"text-text-muted",children:[i.pathsWithGhosts.toLocaleString()," / ",i.totalPaths.toLocaleString()," paths"]}),e.jsx("span",{className:"text-text-muted",children:"•"}),e.jsxs("div",{className:"flex items-center gap-2",children:[S.length>0&&e.jsxs("span",{className:"text-accent-success",children:[S.length," confirmed"]}),L.length>0&&e.jsxs("span",{className:"text-accent-tertiary",children:[L.length," likely"]}),P.length>0&&e.jsxs("span",{className:"text-accent-secondary",children:[P.length," possible"]}),F.length>0&&e.jsxs("span",{className:"text-text-muted",children:[F.length," noise"]})]})]}),e.jsxs("div",{className:"px-5 py-4 space-y-4",children:[S.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-accent-success",children:[e.jsx(Se,{className:"w-3.5 h-3.5"}),e.jsxs("span",{className:"font-medium",children:["Confirmed Repeaters (",S.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:S.map(t=>e.jsx(Ae,{ghost:t,neighbors:s,isExpanded:c.has(t.prefix),onToggle:()=>R(t.prefix)},t.prefix))})]}),L.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-accent-tertiary",children:[e.jsx(h,{className:"w-3.5 h-3.5"}),e.jsxs("span",{className:"font-medium",children:["Likely Repeaters (",L.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:L.map(t=>e.jsx(Ae,{ghost:t,neighbors:s,isExpanded:c.has(t.prefix),onToggle:()=>R(t.prefix)},t.prefix))})]}),E&&P.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-accent-secondary",children:[e.jsx(ee,{className:"w-3.5 h-3.5"}),e.jsxs("span",{className:"font-medium",children:["Possible (",P.length,")"]})]}),e.jsxs("div",{className:"space-y-2",children:[P.slice(0,10).map(t=>e.jsx(Ae,{ghost:t,neighbors:s,isExpanded:c.has(t.prefix),onToggle:()=>R(t.prefix)},t.prefix)),P.length>10&&e.jsxs("div",{className:"text-xs text-text-muted text-center py-1",children:["+",P.length-10," more possible nodes"]})]})]}),F.length>0&&"all"===x&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>u(!p),className:"flex items-center gap-2 text-xs text-text-muted hover:text-text-secondary transition-colors",children:[p?e.jsx(X,{className:"w-3.5 h-3.5"}):e.jsx(d,{className:"w-3.5 h-3.5"}),e.jsx(W,{className:"w-3.5 h-3.5"}),e.jsxs("span",{children:["Noise (",F.length,")"]})]}),p&&e.jsx("div",{className:"flex flex-wrap gap-1",children:F.map(t=>e.jsx(Ae,{ghost:t,neighbors:s,isExpanded:!1,onToggle:()=>{},compact:!0},t.prefix))})]}),"actionable"===x&&0===H&&e.jsxs("div",{className:"text-center py-6 text-sm text-text-muted",children:[e.jsx(b,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No confirmed or likely repeaters yet."}),e.jsxs("p",{className:"text-xs mt-1",children:[P.length+F.length," prefixes need more evidence."]}),e.jsxs("button",{onClick:()=>m("all"),className:"mt-3 text-accent-primary hover:underline",children:["View all ",k.length," discovered nodes"]})]}),i.observationOverrideCount>0&&T>0&&e.jsxs("div",{className:"pt-2 border-t border-border-muted/30 text-xs text-text-muted",children:[e.jsx("span",{className:"text-accent-primary",children:i.observationOverrideCount})," observation overrides • Avg confidence: ",e.jsxs("span",{className:"text-accent-secondary",children:[(100*i.avgPathConfidence).toFixed(0),"%"]})]})]})]})]})}const Ve=r.memo(function({hash:s,className:t="",size:a="sm",collisionInfo:n,isViterbiResolved:l}){const i=y(),c=g(),[o,d]=r.useState(!1),x=r.useMemo(()=>w(s),[s]),m=r.useMemo(()=>void 0!==n?n:x?i.find(e=>e.prefix===x)??null:null,[x,i,n]),p=l??(c.totalPaths>0&&c.avgPathConfidence>=.7),u=r.useCallback(e=>{e.preventDefault(),e.stopPropagation(),d(!0)},[]),j=r.useCallback(()=>{d(!1)},[]);if(!m)return null;const b="sm"===a?"w-3.5 h-3.5":"w-4 h-4",N=p?"text-accent-tertiary hover:text-accent-tertiary hover:bg-accent-tertiary/10 focus:ring-accent-tertiary/50":"text-signal-fair hover:text-accent-secondary hover:bg-signal-fair/10 focus:ring-signal-fair/50",v=p?`Prefix conflict resolved by Viterbi HMM (${(100*c.avgPathConfidence).toFixed(0)}% confidence)`:`Prefix conflict: ${m.candidateCount} nodes share prefix "${x}"`;return e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:u,className:`inline-flex items-center justify-center p-0.5 rounded focus:outline-none focus:ring-2 transition-colors cursor-pointer touch-manipulation ${N} ${t}`,title:v,"aria-label":`View prefix conflict for ${x}${p?" (Viterbi resolved)":""}`,children:p?e.jsxs("span",{className:"relative",children:[e.jsx(ne,{className:b}),e.jsx(h,{className:"absolute -bottom-0.5 -right-0.5 w-2 h-2 text-accent-success"})]}):e.jsx(ke,{className:b})}),e.jsx(je,{isOpen:o,prefix:m.prefix,candidateHashes:m.candidateHashes,onClose:j})]})}),Ue=r.memo(function({hash:s,contact:t,isHub:a,isNeighbor:n,distance:l,centrality:i,sparklineData:r,isSparklineLoading:c,neighborSignal:o,collisionInfo:d,isViterbiResolved:x,isPinging:m,isPingingThis:p,pingResult:u,pingError:g,onRowClick:j,onPing:b,onRemove:N}){var v;const f=t.latitude&&t.longitude&&0!==t.latitude&&0!==t.longitude,y=t.node_name||t.name||"Unknown",w=n&&o,S=null==(v=t.contact_type)?void 0:v.toLowerCase(),L="room server"===S||"room_server"===S||"room"===S||"server"===S,P="companion"===S,F="client"===S||"cli"===S,H=t.is_repeater||"repeater"===S||"rep"===S,R=n?"direct":"flood",E=n?"Direct RF contact (zero-hop neighbor)":"Flood routing (multi-hop via mesh)";return e.jsxs("div",{className:`contacts-grid-row ${a?"bg-amber-500/5 border-l-2 border-l-amber-400":""} ${f?"cursor-pointer hover:bg-subtle-fill":""}`,onClick:()=>j(s),children:[e.jsxs("div",{className:"contacts-col-node flex items-center gap-2 min-w-0",children:[w&&null!==(null==o?void 0:o.avgSnr)?e.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0 self-center "+(_=o.avgSnr,void 0===_?"bg-[var(--signal-unknown)]":_>=5?"bg-[var(--signal-excellent)]":_>=0?"bg-[var(--signal-good)]":_>=-5?"bg-[var(--signal-fair)]":_>=-10?"bg-[var(--signal-poor)]":"bg-[var(--signal-critical)]")}):e.jsx("div",{className:"w-2 flex-shrink-0"}),e.jsx("div",{className:"roster-icon flex-shrink-0",title:E,children:L&&H?e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx(J,{className:"w-5 h-5 absolute inset-0 text-sys-pink"}),e.jsx(be,{className:"w-2.5 h-2.5 absolute -bottom-0.5 -right-0.5 text-sys-teal"})]}):L?e.jsx(J,{className:"w-5 h-5 text-sys-pink"}):P?e.jsx(Ne,{className:"w-5 h-5 text-text-muted"}):H?"direct"===R?e.jsx(fe,{className:"w-5 h-5 text-sys-green"}):e.jsx(be,{className:"w-5 h-5 text-sys-cyan"}):e.jsx(Ne,{className:"w-5 h-5 text-text-muted"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 overflow-hidden",children:[e.jsx("span",{className:"roster-title truncate",title:y,children:y}),n&&e.jsx(k,{color:te.neighbor,compact:!0,className:"flex-shrink-0",children:"NBR"}),a&&e.jsxs(k,{color:te.hub,compact:!0,className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx(ve,{className:"w-3 h-3"}),"HUB"]}),H&&e.jsx(k,{color:te.repeater,compact:!0,className:"flex-shrink-0",children:"RPT"}),L&&e.jsx(k,{color:te.room,compact:!0,className:"flex-shrink-0",children:"ROOM"}),P&&e.jsx(k,{color:te.companion,compact:!0,className:"flex-shrink-0",children:"COMP"}),F&&e.jsx(k,{color:te.client,compact:!0,className:"flex-shrink-0",children:"CLIENT"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[e.jsx(oe,{copy:!0,size:"compact",truncate:[8,6],children:s}),e.jsx(Ve,{hash:s,collisionInfo:d,isViterbiResolved:x})]})]})]}),e.jsxs("div",{className:"contacts-col-signal flex items-center justify-end gap-2",children:[w&&null!==(null==o?void 0:o.avgRssi)&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{rssi:o.avgRssi,className:"w-3.5 h-3.5"}),e.jsx("span",{className:"type-data-xs tabular-nums text-text-muted",children:Math.round(o.avgRssi)})]}),w&&null!==(null==o?void 0:o.avgSnr)&&e.jsxs("span",{className:"type-data-xs tabular-nums text-text-muted",children:[o.avgSnr.toFixed(1)," dB"]})]}),e.jsx("div",{className:"contacts-col-distance flex items-center justify-end gap-1 text-text-muted",children:null!=l&&e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"w-3 h-3"}),e.jsx("span",{className:"type-data-xs tabular-nums",children:(T=l,T<1e3?`${Math.round(T)}m`:`${(T/1e3).toFixed(1)}km`)})]})}),e.jsx("div",{className:"contacts-col-centrality flex items-center justify-end gap-1",children:i>0&&e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-3 h-3 text-accent-secondary"}),e.jsxs("span",{className:"type-data-xs tabular-nums text-text-muted",children:[(100*i).toFixed(0),"%"]})]})}),e.jsx("div",{className:"contacts-col-activity flex items-center justify-center",children:e.jsx(Q,{data:r,width:48,height:16,isLoading:c})}),e.jsx("div",{className:"contacts-col-seen flex items-center justify-end",children:e.jsx("span",{className:"type-data-xs tabular-nums text-text-primary whitespace-nowrap",children:t.last_seen?C(t.last_seen):"—"})}),e.jsxs("div",{className:"contacts-col-actions flex items-center justify-end gap-1",children:[n&&e.jsx(e.Fragment,{children:u?e.jsxs("div",{className:"flex items-center gap-1 text-accent-success",title:`RTT: ${u.rtt_ms.toFixed(0)}ms`,children:[e.jsx(h,{className:"w-3.5 h-3.5"}),e.jsxs("span",{className:"type-data-xs tabular-nums hidden sm:inline",children:[u.snr_db.toFixed(1),"dB"]})]}):g?e.jsx("span",{className:"text-red-400 text-[10px]",title:g,children:"✗"}):e.jsx("button",{onClick:e=>b(s,e),disabled:m,className:"p-1 sm:p-1.5 radius-inner text-text-muted/50 hover:text-accent-primary hover:bg-accent-primary/10 transition-base disabled:opacity-50 disabled:cursor-not-allowed",title:"Ping neighbor for updated signal info",children:p?e.jsx(M,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 animate-spin"}):e.jsx(ie,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),N(s,y)},className:"p-1 sm:p-1.5 radius-inner text-text-muted/50 hover:text-red-400 hover:bg-red-500/10 transition-base",title:"Remove contact",children:e.jsx(he,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})]})]});var T,_}),Be=[];function Ke(e,s,t,a){const n=(t-e)*Math.PI/180,l=(a-s)*Math.PI/180,i=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(t*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371e3}const We=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const{stats:s}=S(),t=L(),a=P(),n=F(),l=H(),i=R(),c=j(),o=E(),d=y(),x=g(),m=T(),p=_(),u=z(),b=x.totalPaths>0&&x.avgPathConfidence>=.7,N=r.useMemo(()=>{const e=new Map;for(const s of d)e.set(s.prefix,s);return e},[d]),f=!u.backgroundLoadComplete||p,[k,C]=r.useState(null),[B,K]=r.useState("lastHeard"),[W,q]=r.useState("desc"),[Z,J]=r.useState(""),[Q,X]=r.useState(!1),[Y,ee]=r.useState(new Set),[se,te]=r.useState(!1),[ae,ne]=r.useState(null),[le,ie]=r.useState(null),[oe,de]=r.useState(null),[me,he]=r.useState(null),[ge,je]=r.useState(new Map),[be,Ne]=r.useState(new Map),[ve,fe]=r.useState(25),[we,ke]=r.useState(25),Se=r.useRef(null),Fe=r.useMemo(()=>(null==s?void 0:s.neighbors)??{},[null==s?void 0:s.neighbors]),He=r.useMemo(()=>Object.fromEntries(Object.entries(Fe).filter(([e])=>!t.has(e))),[Fe,t]),Ee=O(),Te=null==s?void 0:s.local_hash,_e=r.useMemo(()=>{const e=new Map;if(!(null==Ee?void 0:Ee.latitude)||!(null==Ee?void 0:Ee.longitude))return e;for(const[s,t]of Object.entries(He))t.latitude&&t.longitude&&0!==t.latitude&&0!==t.longitude?e.set(s,Ke(Ee.latitude,Ee.longitude,t.latitude,t.longitude)):e.set(s,null);return e},[He,Ee]),{neighborHashSet:ze,neighborSignalMap:$e}=r.useMemo(()=>{const e=new Set,s=new Map;for(const t of i)e.add(t.hash),s.set(t.hash,{avgRssi:t.avgRssi,avgSnr:t.avgSnr});return{neighborHashSet:e,neighborSignalMap:s}},[i]),Ie=r.useMemo(()=>{const e=Z.toLowerCase().trim(),s="neighbor"===e||"neighbors"===e,t=Q||s,a=Y.size>0;return Object.fromEntries(Object.entries(He).filter(([n,l])=>{if(a){const e=function(e){var s;const t=(null==(s=e.contact_type)?void 0:s.toLowerCase())??"";return"room server"===t||"room_server"===t||"room"===t||"server"===t?"room":"companion"===t||"client"===t||"cli"===t?"companion":"repeater"===t||"rep"===t||!0===e.is_repeater?"repeater":"companion"}(l);if(!Y.has(e))return!1}if(t&&!ze.has(n))return!1;if(s)return!0;if(!e)return!0;const i=(l.node_name||l.name||"").toLowerCase(),r=w(n).toLowerCase();return i.includes(e)||r.includes(e)||n.toLowerCase().includes(e)}))},[He,Z,Q,ze,Y]),Ae=r.useMemo(()=>{const e=Object.entries(Ie),s=Z.toLowerCase().trim(),t=2===s.length&&/^[0-9a-f]{2}$/i.test(s);return e.sort(([e,a],[n,i])=>{if(t){const t=w(e).toLowerCase(),a=w(n).toLowerCase(),l=t===s,i=a===s;if(l&&!i)return-1;if(i&&!l)return 1}let r=0;switch(B){case"lastHeard":r=(a.last_seen||0)-(i.last_seen||0);break;case"distance":{const s=_e.get(e)??null,t=_e.get(n)??null;r=null===s&&null===t?0:null===s?1:null===t?-1:s-t;break}case"centrality":r=(l.get(e)||0)-(l.get(n)||0)}return"desc"===W?-r:r})},[Ie,B,W,_e,l,Z]),De=Ae.filter(([,e])=>e.latitude&&e.longitude&&0!==e.latitude&&0!==e.longitude).length,Ve=r.useMemo(()=>new Set(n),[n]),We=r.useMemo(()=>0===ve?Ae:Ae.slice(0,we),[Ae,we,ve]);r.useEffect(()=>{ke(ve||Ae.length)},[B,W,Z,Q,Y,ve,Ae.length]),r.useEffect(()=>{const e=e=>{e.target.closest("[data-dropdown]")||te(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]),r.useEffect(()=>{if(0===ve)return;const e=new IntersectionObserver(e=>{e[0].isIntersecting&&we<Ae.length&&ke(e=>Math.min(e+ve,Ae.length))},{threshold:.1,rootMargin:"100px"});return Se.current&&e.observe(Se.current),()=>e.disconnect()},[ve,we,Ae.length]);const qe=r.useCallback(e=>{fe(e),ke(e||Ae.length)},[Ae.length]),Ze=r.useCallback(e=>{B===e?q(e=>"desc"===e?"asc":"desc"):(K(e),q("desc"))},[B]),Je=r.useCallback(e=>{const s=He[e];(null==s?void 0:s.latitude)&&(null==s?void 0:s.longitude)&&0!==s.latitude&&0!==s.longitude&&ne(e)},[He]),Qe=r.useCallback(()=>{ne(null)},[]),Xe=r.useCallback((e,s)=>{C({hash:e,name:s})},[]),Ye=r.useCallback(async(e,s)=>{if(s.stopPropagation(),!me){he(e),je(s=>{const t=new Map(s);return t.delete(e),t}),Ne(s=>{const t=new Map(s);return t.delete(e),t});try{const s=e.startsWith("0x")?e.slice(0,4):`0x${e.slice(0,2)}`,t=await D(s,30);t.success&&t.data?(je(s=>new Map(s).set(e,t.data)),setTimeout(()=>{je(s=>{const t=new Map(s);return t.delete(e),t})},1e4)):(Ne(s=>new Map(s).set(e,t.error||"Ping failed")),setTimeout(()=>{Ne(s=>{const t=new Map(s);return t.delete(e),t})},5e3))}catch(t){const s=t instanceof Error?t.message:"Ping failed";Ne(t=>new Map(t).set(e,s)),setTimeout(()=>{Ne(s=>{const t=new Map(s);return t.delete(e),t})},5e3)}finally{he(null)}}},[me]);return e.jsxs(G,{children:[e.jsx(V,{title:"Contacts",icon:e.jsx(xe,{}),controls:e.jsxs("div",{className:"flex items-baseline gap-3 sm:gap-4",children:[e.jsxs("span",{className:"roster-title tabular-nums",children:[Ae.length," node",1!==Ae.length?"s":""]}),De>0&&e.jsxs("span",{className:"roster-title flex items-baseline gap-1.5 tabular-nums",children:[e.jsx(ue,{className:"w-3.5 h-3.5 relative top-[2px]"}),De," with location"]})]})}),e.jsxs(U,{children:[o?e.jsx(Re,{neighbors:He,localNode:Ee??void 0,localHash:Te,onRemoveNode:a,selectedNodeHash:ae,onNodeSelected:Qe,highlightedEdgeKey:le,highlightedGhost:oe}):e.jsx("div",{className:"surface-base radius-card aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-accent-primary border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm text-text-muted",children:"Loading map..."})]})}),e.jsx(Oe,{maxPaths:10,highlightedEdge:le,onHighlightEdge:ie}),c.length>0&&(o?e.jsx("div",{className:"chart-container",children:e.jsx(Ge,{neighbors:He,onGhostSelect:de})}):e.jsxs("div",{className:"surface-base radius-card",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-bg-elevated animate-pulse"}),e.jsx("div",{className:"w-24 h-4 rounded bg-bg-elevated animate-pulse"})]}),e.jsx("div",{className:"w-6 h-6 rounded bg-bg-elevated animate-pulse"})]}),e.jsx("div",{className:"px-5 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-20 h-4 rounded bg-bg-elevated animate-pulse"}),e.jsx("div",{className:"w-16 h-4 rounded bg-bg-elevated animate-pulse"})]})})]})),e.jsx("div",{className:"chart-container",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"chart-title",children:[e.jsx(xe,{className:"chart-title-icon"}),"Discovered Contacts"]}),e.jsx($,{type:"search",size:"sm",value:Z,onChange:e=>J(e.target.value),placeholder:"Search...",leadingIcon:e.jsx(re,{className:"w-3.5 h-3.5"}),trailingIcon:Z?e.jsx("button",{onClick:()=>{J(""),"neighbor"!==Z.toLowerCase().trim()&&"neighbors"!==Z.toLowerCase().trim()||X(!1)},className:"text-text-muted hover:text-text-secondary",children:e.jsx(I,{className:"w-3 h-3"})}):void 0,className:"w-24 sm:w-32","aria-label":"Search contacts"}),e.jsxs("div",{className:"relative","data-dropdown":!0,children:[e.jsxs("button",{onClick:()=>te(!se),className:"flex items-center gap-1 px-1.5 sm:px-2.5 py-1.5 text-sm radius-inner transition-base "+(Y.size>0?"bg-accent-primary/20 text-accent-primary border border-accent-primary/30":"text-text-muted hover:text-text-secondary hover-bg border border-transparent"),title:"Filter by contact type",children:[e.jsx(Ce,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Filter"}),Y.size>0&&e.jsx("span",{className:"tabular-nums text-xs bg-accent-primary/30 px-1 rounded",children:Y.size})]}),se&&e.jsxs("div",{className:"absolute left-0 top-full mt-1 z-50 surface-elevated radius-inner py-1 min-w-[140px]",children:[[{key:"repeater",label:"Repeaters"},{key:"companion",label:"Companions"},{key:"room",label:"Rooms"}].map(({key:s,label:t})=>e.jsxs("button",{onClick:()=>{ee(e=>{const t=new Set(e);return t.has(s)?t.delete(s):t.add(s),t})},className:"w-full px-3 py-1.5 text-sm text-left hover-bg transition-base flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 flex items-center justify-center radius-badge border "+(Y.has(s)?"bg-accent-primary border-accent-primary text-white":"border-border-subtle"),children:Y.has(s)&&e.jsx(h,{className:"w-3 h-3"})}),e.jsx("span",{className:Y.has(s)?"text-text-primary":"text-text-secondary",children:t})]},s)),Y.size>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-border-subtle my-1"}),e.jsx("button",{onClick:()=>ee(new Set),className:"w-full px-3 py-1.5 text-sm text-left text-text-muted hover:text-text-secondary hover-bg transition-base",children:"Clear filters"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[ze.size>0&&e.jsxs("button",{onClick:()=>X(!Q),className:"flex items-center gap-1 px-1.5 sm:px-2.5 py-1.5 text-sm radius-inner transition-base "+(Q?"bg-accent-success/20 text-accent-success border border-accent-success/30":"text-text-muted hover:text-text-secondary hover-bg border border-transparent"),title:Q?"Show all contacts":"Show only MeshCore neighbors (direct RF contact)",children:[e.jsx(A,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Neighbors"}),e.jsx("span",{className:"sm:hidden tabular-nums",children:ze.size})]}),e.jsxs("div",{className:"flex items-center gap-0.5 sm:gap-1",children:[e.jsxs("button",{onClick:()=>Ze("lastHeard"),className:"flex items-center gap-1 p-1.5 sm:px-2 sm:py-1.5 text-sm radius-inner transition-base "+("lastHeard"===B?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-secondary hover-bg"),title:"Sort by last heard",children:[e.jsx(v,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Recent"}),"lastHeard"===B&&e.jsx(ye,{className:"w-3 h-3 "+("asc"===W?"rotate-180":"")})]}),e.jsxs("button",{onClick:()=>Ze("distance"),className:"flex items-center gap-1 p-1.5 sm:px-2 sm:py-1.5 text-sm radius-inner transition-base "+("distance"===B?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-secondary hover-bg"),title:"Sort by distance",children:[e.jsx(Me,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Distance"}),"distance"===B&&e.jsx(ye,{className:"w-3 h-3 "+("asc"===W?"rotate-180":"")})]}),e.jsxs("button",{onClick:()=>Ze("centrality"),className:"flex items-center gap-1 p-1.5 sm:px-2 sm:py-1.5 text-sm radius-inner transition-base "+("centrality"===B?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-secondary hover-bg"),title:"Sort by network centrality",children:[e.jsx(ce,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Centrality"}),"centrality"===B&&e.jsx(ye,{className:"w-3 h-3 "+("asc"===W?"rotate-180":"")})]})]}),e.jsxs(Le,{value:ve,onChange:qe,className:"w-auto min-w-[70px]","aria-label":"Items per page",children:[e.jsx(Pe,{value:25,children:"25"}),e.jsx(Pe,{value:50,children:"50"}),e.jsx(Pe,{value:100,children:"100"}),e.jsx(Pe,{value:0,children:"All"})]})]})]}),Ae.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden sm:grid contacts-grid-header border-b border-border-subtle/50 px-3 py-2 text-[10px] uppercase tracking-wider text-text-muted",children:[e.jsx("div",{className:"contacts-col-node",children:"Node"}),e.jsx("div",{className:"contacts-col-signal text-right",children:"Signal"}),e.jsx("div",{className:"contacts-col-distance text-right",children:"Distance"}),e.jsx("div",{className:"contacts-col-centrality text-right",children:"Centrality"}),e.jsx("div",{className:"contacts-col-activity text-center",children:"Activity"}),e.jsx("div",{className:"contacts-col-seen text-right",children:"Last Seen"}),e.jsx("div",{className:"contacts-col-actions"})]}),e.jsx("div",{className:"divide-y divide-border-subtle/30",children:We.map(([s,t])=>{const a=w(s),n=Ve.has(s),i=ze.has(s),r=_e.get(s)??null,c=l.get(s)||0,o=i?$e.get(s):void 0,d=a?N.get(a)??null:null,x=m.get(s)??Be;return e.jsx(Ue,{hash:s,contact:t,isHub:n,isNeighbor:i,distance:r,centrality:c,sparklineData:x,isSparklineLoading:f,neighborSignal:o,collisionInfo:d,isViterbiResolved:b,isPinging:null!==me,isPingingThis:me===s,pingResult:ge.get(s),pingError:be.get(s),onRowClick:Je,onPing:Ye,onRemove:Xe},s)})}),ve>0&&we<Ae.length&&e.jsxs("div",{ref:Se,className:"flex items-center justify-center py-4 text-text-muted",children:[e.jsx(M,{className:"w-4 h-4 animate-spin mr-2"}),e.jsx("span",{className:"text-xs",children:"Loading more..."})]}),e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-t border-border-subtle/50 text-xs text-text-muted",children:[e.jsxs("span",{className:"tabular-nums",children:["Showing ",We.length," of ",Ae.length]}),ve>0&&we<Ae.length&&e.jsx("button",{onClick:()=>ke(e=>Math.min(e+ve,Ae.length)),className:"text-accent-primary hover:text-accent-primary/80 transition-base",children:"Load more"})]})]}):e.jsxs("div",{className:"roster-empty",children:[e.jsx(xe,{className:"roster-empty-icon"}),e.jsx("div",{className:"type-label text-text-secondary",children:"No Contacts Discovered"}),e.jsx("div",{className:"type-data-xs text-text-muted mt-1",children:"Contacts will appear here as they advertise on the mesh network."})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-bg-elevated animate-pulse"}),e.jsx("div",{className:"w-32 h-4 rounded bg-bg-elevated animate-pulse"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 h-6 rounded bg-bg-elevated animate-pulse"}),e.jsx("div",{className:"w-24 h-6 rounded bg-bg-elevated animate-pulse"}),e.jsx("div",{className:"w-16 h-6 rounded bg-bg-elevated animate-pulse"})]})]}),e.jsx("div",{className:"px-3 py-3 space-y-3",children:[...Array(5)].map((s,t)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded bg-bg-elevated animate-pulse"}),e.jsxs("div",{className:"flex-1 space-y-1.5",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-bg-elevated animate-pulse"}),e.jsx("div",{className:"h-3 w-24 rounded bg-bg-elevated animate-pulse"})]}),e.jsx("div",{className:"w-12 h-4 rounded bg-bg-elevated animate-pulse"}),e.jsx("div",{className:"w-16 h-4 rounded bg-bg-elevated animate-pulse"})]},t))})]})})]}),e.jsx(pe,{isOpen:!!k,title:"Remove Contact",message:`Are you sure you would like to remove ${(null==k?void 0:k.name)||"this contact"}?`,confirmLabel:"Remove",cancelLabel:"Cancel",variant:"danger",onConfirm:()=>{k&&a(k.hash),C(null)},onCancel:()=>C(null)})]})}},Symbol.toStringTag,{value:"Module"}));export{We as C,Ve as P,Me as R};
