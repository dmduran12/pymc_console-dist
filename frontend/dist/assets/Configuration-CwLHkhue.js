const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/latin-400-CvIR-I2l.css","assets/latin-400-CePoWEYT.css","assets/latin-400-dmanHIEB.css","assets/latin-500-DwzRh_fR.css","assets/latin-400-CNx1qH9H.css","assets/latin-400-C7jFTHrn.css","assets/latin-500-CvoqYoKF.css","assets/latin-600-CdtqNIPt.css","assets/latin-400-BcR6IdUc.css","assets/latin-500-DCnAHIrw.css","assets/latin-600-CnkPk-vb.css","assets/latin-700-UC1i-VSI.css"])))=>i.map(i=>d[i]);
import{r as e,j as t,bi as s,aR as a,X as r,ak as l,ac as n,bj as c,b6 as i,l as o,o as d,bk as u,p as m,x,bl as p,aD as b,bm as h,bn as g,bo as y,bp as f,at as j,bq as v,an as N,ah as w,ae as k,av as _,br as C}from"./vendor-react-BXhrzaGn.js";import{c as S}from"./recharts-CnLSZmAf.js";import{av as T,a9 as E,aw as F,ax as P,ay as L,X as R,az as D,aA as A,at as I}from"./index-BnwqqupC.js";import{C as O}from"./ConfirmModal-CJtZGVbU.js";import{_ as M}from"./deckgl-DTsmDcfs.js";import{N as z}from"./NodeInformationCard-QpRzJtBR.js";import{a as K,P as V,b as q}from"./PageLayout-CkP0WgKw.js";import{C as H}from"./Card-BIJYdycY.js";import{R as $,C as Y}from"./Grid-BzkaU71a.js";import"./vendor-core-WoOfkQwm.js";import"./DataBox-DKleVLc9.js";async function B(e){return T("/api/update_web_config",{method:"POST",body:JSON.stringify(e)})}const U=e.memo(function(){const{theme:e}=E(),{colorScheme:s}=e,a=F.find(e=>e.colorScheme===s)??F[0],r=a.displaySize,l=`clamp(${.8*r}rem, ${.6*r}rem + 1.5vw, ${1.4*r}rem)`;return t.jsx("div",{className:"h-10 flex items-center justify-center",children:t.jsxs("span",{className:"font-medium transition-all duration-300 leading-none text-center",style:{fontFamily:a.displayFont,color:a.displayColor,fontSize:l,fontOpticalSizing:"auto",letterSpacing:"-0.03em"},children:["Theme: ",a.displayName]})})}),X=e.memo(function(){const{theme:s,setThemePreset:a,setBrightness:r}=E(),{colorScheme:l,brightness:n}=s,[c,i]=e.useState(!1),[o,d]=e.useState(!1),u=e.useRef(null),m=e.useRef(null),x=(F.find(e=>e.colorScheme===l)??F[0]).id,p=e.useCallback((e,t)=>{if(!m.current)return n;const s=(m.current.y-e)/(t?200:80)*100;return Math.round(Math.max(0,Math.min(100,m.current.brightness+s)))},[n]),b=e.useCallback(e=>{a(e),i(!0)},[a]),h=e.useCallback(e=>{r(e)},[r]),g=e.useCallback(e=>{const t=F.find(t=>t.id===e);t&&P(t.backgroundImage)},[]);return t.jsx("div",{className:"grid grid-cols-4 gap-[3%] w-full",children:F.map(e=>{const s=x===e.id,a=!e.backgroundImage,r=s&&!a&&(c||o);return t.jsxs("div",{ref:s?u:void 0,title:e.displayName,className:S("flex flex-col items-stretch rounded-sm transition-all duration-300 ease-out overflow-hidden",s?"ring-2 ring-accent-primary scale-105 "+(a?"cursor-pointer":"cursor-ns-resize"):"cursor-pointer"),onMouseEnter:()=>{s&&!a?i(!0):s||g(e.id)},onMouseLeave:()=>!o&&i(!1),onClick:()=>!s&&b(e.id),onTouchStart:e=>{if(!s||a)return;e.preventDefault();const t=e.touches[0];m.current={y:t.clientY,brightness:n},d(!0),i(!0);const r=e=>{e.preventDefault();const t=e.touches[0];h(p(t.clientY,!0))},l=()=>{document.removeEventListener("touchmove",r),document.removeEventListener("touchend",l),m.current=null,d(!1),setTimeout(()=>i(!1),1500)};document.addEventListener("touchmove",r,{passive:!1}),document.addEventListener("touchend",l)},onMouseDown:e=>{if(!s||a)return;e.preventDefault(),m.current={y:e.clientY,brightness:n},d(!0),i(!0);const t=e=>{h(p(e.clientY,!1))},r=()=>{document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",r),m.current=null,d(!1)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",r)},children:[t.jsxs("div",{className:"glass-thumbnail w-full aspect-square sm:aspect-[4/3] lg:aspect-video relative !rounded-b-none",children:["kde breeze"===e.id?t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-[#242627]",style:{opacity:r?.4:1},children:t.jsx("span",{className:"text-[#58b99d] text-[1.5em] font-bold font-mono",children:">"})}):"ribbon"===e.id?t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-[#F5F5F5]",style:{opacity:r?.4:1},children:t.jsx("span",{className:"text-[#2D2D2D] text-[1.5em] font-bold font-mono",children:"R"})}):t.jsx("div",{className:"absolute bg-cover bg-center transition-opacity duration-200",style:{inset:0,backgroundImage:`url(${e.backgroundImage})`,opacity:r?.4:1,filter:"brightness(var(--thumbnail-brightness, 1.5))"}}),s&&t.jsxs("div",{className:S("absolute inset-0 transition-opacity duration-200",r?"opacity-100":"opacity-0"),children:[t.jsx("div",{className:"absolute inset-x-0 bottom-0 bg-black/70 transition-all duration-100 ease-out",style:{height:100-n+"%"}}),t.jsx("div",{className:"absolute inset-x-[8%] h-0.5 bg-white rounded-full shadow-lg transition-all duration-100 ease-out",style:{top:100-n+"%"}}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsxs("span",{className:"text-[0.6em] font-mono font-bold text-white drop-shadow-lg",children:[n,"%"]})})]})]}),t.jsx("div",{className:"flex flex-col w-full",children:e.paletteColors.map((e,s)=>t.jsx("div",{className:"flex",children:e.map((e,s)=>t.jsx("div",{className:"flex-1 aspect-[2/1]",style:{backgroundColor:e}},s))},s))})]},e.id)})})});let G=!1,J=null;const W=e.memo(function({layout:s="horizontal"}){return e.useEffect(()=>{!async function(){G||J||(J=(async()=>{try{await Promise.all([M(()=>Promise.resolve({}),__vite__mapDeps([0])),M(()=>Promise.resolve({}),__vite__mapDeps([1])),M(()=>Promise.resolve({}),__vite__mapDeps([2])),M(()=>Promise.resolve({}),__vite__mapDeps([3])),M(()=>Promise.resolve({}),__vite__mapDeps([4])),M(()=>Promise.resolve({}),__vite__mapDeps([5])),M(()=>Promise.resolve({}),__vite__mapDeps([6])),M(()=>Promise.resolve({}),__vite__mapDeps([7])),M(()=>Promise.resolve({}),__vite__mapDeps([8])),M(()=>Promise.resolve({}),__vite__mapDeps([9])),M(()=>Promise.resolve({}),__vite__mapDeps([10])),M(()=>Promise.resolve({}),__vite__mapDeps([11]))]),G=!0}catch(e){}})())}()},[]),"logo-only"===s?t.jsx(U,{}):"thumbnails-only"===s?t.jsx(X,{}):t.jsxs("div",{className:"flex flex-col items-center gap-3",children:[t.jsx(U,{}),t.jsx(X,{})]})});function Q(){const{latitude:o,longitude:d,enabled:u,setLocation:m,enable:x,disable:p,clear:b}=L(),[h,g]=e.useState(!1),[y,f]=e.useState(""),[j,v]=e.useState(""),[N,w]=e.useState("idle"),[k,_]=e.useState(null),C=e.useRef(null),T=e.useRef(null),E=e.useRef(!0);e.useEffect(()=>(E.current=!0,()=>{E.current=!1,T.current&&clearTimeout(T.current)}),[]);const F=()=>{g(!1),_(null)};e.useEffect(()=>{if(!h)return;const e=e=>{"loading"!==N&&C.current&&!C.current.contains(e.target)&&F()};return document.addEventListener("mouseup",e),()=>document.removeEventListener("mouseup",e)},[h,N]);const P=null!==o&&null!==d;return t.jsx(K,{children:t.jsxs("div",{ref:C,children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx(H,{icon:t.jsx(s,{}),title:"Stealth",largeTitle:!0}),t.jsxs("div",{className:"flex items-center gap-1",children:[P&&!h&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>{u?p():x()},className:S("relative inline-flex h-6 w-11 items-center rounded-full transition-colors border-2 mr-2",u?"bg-toggle-on border-toggle-on":"bg-toggle-off border-border-subtle"),title:u?"Disable stealth location":"Enable stealth location",children:t.jsx("span",{className:S("inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-lg",u?"translate-x-5":"translate-x-0.5")})}),t.jsx("button",{onClick:()=>{b(),g(!1)},className:"p-2 rounded-lg transition-colors text-text-muted hover:text-accent-danger hover:bg-accent-danger/10",title:"Clear stealth location",children:t.jsx(a,{className:"w-4 h-4"})})]}),h?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:F,disabled:"loading"===N,className:S("p-2 rounded-lg transition-colors","loading"===N?"text-text-muted cursor-not-allowed":"text-text-muted hover:text-accent-danger hover:bg-accent-danger/10"),title:"Cancel",children:t.jsx(r,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>{if("loading"===N)return;T.current&&clearTimeout(T.current);const e=((e,t)=>{const s=parseFloat(e),a=parseFloat(t);return isNaN(s)||isNaN(a)?"Please enter valid numbers":s<-90||s>90?"Latitude must be between -90 and 90":a<-180||a>180?"Longitude must be between -180 and 180":0===s&&0===a?"Coordinates (0, 0) are invalid":null})(y,j);if(e)return void _(e);w("loading"),_(null);const t=parseFloat(y),s=parseFloat(j);m(t,s),u||x(),w("success"),T.current=setTimeout(()=>{E.current&&(w("idle"),g(!1))},1e3)},disabled:"loading"===N,className:S("p-2 rounded-lg transition-colors","loading"===N?"text-accent-primary cursor-wait":"success"===N?"text-accent-success":"error"===N?"text-accent-danger":"text-accent-success hover:bg-accent-success/10"),title:"Save",children:"loading"===N?t.jsx(l,{className:"w-4 h-4 animate-spin"}):"success"===N?t.jsx(n,{className:"w-4 h-4"}):"error"===N?t.jsx(r,{className:"w-4 h-4"}):t.jsx(n,{className:"w-4 h-4"})})]}):t.jsx("button",{onClick:()=>{f((null==o?void 0:o.toFixed(6))??""),v((null==d?void 0:d.toFixed(6))??""),_(null),g(!0)},className:"p-2 rounded-lg transition-colors text-text-muted hover:text-text-primary hover:bg-bg-subtle",title:P?"Edit stealth location":"Set stealth location",children:t.jsx(c,{className:"w-4 h-4"})})]})]}),t.jsx("div",{className:"bg-accent-tertiary/5 rounded-xl p-3 mb-4",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx(i,{className:"w-4 h-4 text-accent-tertiary flex-shrink-0 mt-0.5"}),t.jsxs("p",{className:"type-body-sm text-text-muted",children:[t.jsx("span",{className:"text-text-secondary",children:"Stealth mode"})," allows you to appear on the map and in topology analysis without broadcasting your location. Coordinates are stored locally in your browser only — ",t.jsx("span",{className:"text-accent-tertiary",children:"never sent to config.yaml or the mesh"}),"."]})]})}),k&&t.jsx("div",{className:"text-xs mb-3 px-2 py-1.5 rounded-md text-accent-danger bg-accent-danger/10",children:k}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:h?"Latitude (°)":"Latitude"}),t.jsx("div",{className:S("h-[38px] rounded-full px-4 flex items-center transition-colors",h?"bg-white/5":"bg-white/[0.02]"),children:h?t.jsx("input",{type:"number",value:y,onChange:e=>f(e.target.value),step:"0.000001",min:"-90",max:"90",placeholder:"e.g. 34.052234",className:"w-full bg-transparent text-text-primary focus:outline-none type-data placeholder:text-text-muted/50"}):t.jsx("span",{className:S("type-data",P&&u?"text-text-primary":"text-text-muted"),children:P?o.toFixed(6):"Not set"})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:h?"Longitude (°)":"Longitude"}),t.jsx("div",{className:S("h-[38px] rounded-full px-4 flex items-center transition-colors",h?"bg-white/5":"bg-white/[0.02]"),children:h?t.jsx("input",{type:"number",value:j,onChange:e=>v(e.target.value),step:"0.000001",min:"-180",max:"180",placeholder:"e.g. -118.243685",className:"w-full bg-transparent text-text-primary focus:outline-none type-data placeholder:text-text-muted/50"}):t.jsx("span",{className:S("type-data",P&&u?"text-text-primary":"text-text-muted"),children:P?d.toFixed(6):"Not set"})})]})]}),P&&!h&&t.jsx("div",{className:"mt-3 pt-3 border-t border-border-subtle",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:S("w-2 h-2 rounded-full",u?"bg-accent-success":"bg-text-muted")}),t.jsx("span",{className:"type-body-sm text-text-muted",children:u?"Stealth location active — you appear on maps with these coordinates":"Stealth location disabled — coordinates saved but not in use"})]})})]})})}const Z=[{value:7.8,label:"7.8 kHz"},{value:10.4,label:"10.4 kHz"},{value:15.6,label:"15.6 kHz"},{value:20.8,label:"20.8 kHz"},{value:31.25,label:"31.25 kHz"},{value:41.7,label:"41.7 kHz"},{value:62.5,label:"62.5 kHz"},{value:125,label:"125 kHz"},{value:250,label:"250 kHz"},{value:500,label:"500 kHz"}],ee=[5,6,7,8,9,10,11,12],te=[{value:5,label:"4/5"},{value:6,label:"4/6"},{value:7,label:"4/7"},{value:8,label:"4/8"}],se="radioConfig",ae="repeaterSettings",re="operatingMode";function le({node:e,level:s,expandedKeys:a,selectedKeyId:r,globalFloodPolicy:l,onSelect:n,onToggle:c}){const i=a.has(e.id),o=r===e.id,d=e.children&&e.children.length>0,u="allow"===l;return t.jsxs("div",{children:[t.jsxs("div",{className:S("flex items-center gap-2 h-[36px] px-3 rounded-full cursor-pointer transition-colors",o?"bg-accent-primary/15":"hover:bg-subtle-fill",u&&"opacity-50 cursor-not-allowed"),style:{marginLeft:16*s+"px"},onClick:()=>!u&&n(e.id),children:[d?t.jsx("button",{onClick:t=>{t.stopPropagation(),c(e.id)},className:"p-1 hover:bg-subtle-fill-hover rounded-full transition-colors",children:t.jsx(_,{className:S("w-3.5 h-3.5 text-text-muted transition-transform",i&&"rotate-90")})}):t.jsx("span",{className:"w-5"}),t.jsx(C,{className:"w-4 h-4 text-accent-primary flex-shrink-0"}),t.jsx("span",{className:"type-data text-text-primary flex-1 truncate",children:e.name}),t.jsx("span",{className:S("type-data-xs px-2 py-0.5 rounded-full","allow"===e.floodPolicy?"bg-accent-success/15 text-accent-success":"bg-accent-danger/15 text-accent-danger"),children:"allow"===e.floodPolicy?"Allow":"Deny"})]}),d&&i&&t.jsx("div",{children:e.children.map(e=>t.jsx(le,{node:e,level:s+1,expandedKeys:a,selectedKeyId:r,globalFloodPolicy:l,onSelect:n,onToggle:c},e.id))})]})}function ne(){var s,_,C,E,F,P;const{stats:L,setMode:M,clearModeMutation:U,setDutyCycleConfig:X,clearDutyCycleMutation:G,fetchStats:J,startMutation:ne,clearMutation:ce}=R(),ie=null==(s=null==L?void 0:L.config)?void 0:s.radio,oe=null==(_=null==L?void 0:L.config)?void 0:_.repeater,de=null==(C=null==L?void 0:L.config)?void 0:C.duty_cycle,ue=(null==L?void 0:L.node_name)||(null==(E=null==L?void 0:L.config)?void 0:E.node_name)||"Unknown Node",me=(null==oe?void 0:oe.mode)??"forward",xe=(null==de?void 0:de.enforcement_enabled)??!1,pe=null==(F=null==L?void 0:L.config)?void 0:F.delays,[be,he]=e.useState(!1),[ge,ye]=e.useState(""),[fe,je]=e.useState(62.5),[ve,Ne]=e.useState(7),[we,ke]=e.useState(5),[_e,Ce]=e.useState(""),[Se,Te]=e.useState("idle"),[Ee,Fe]=e.useState(null),Pe=e.useRef(null),Le=e.useRef(null),[Re,De]=e.useState(!1),[Ae,Ie]=e.useState(""),[Oe,Me]=e.useState(""),[ze,Ke]=e.useState(""),[Ve,qe]=e.useState("idle"),He=e.useRef(null),$e=e.useRef(null),[Ye,Be]=e.useState(!1),[Ue,Xe]=e.useState(""),[Ge,Je]=e.useState(""),[We,Qe]=e.useState(""),[Ze,et]=e.useState(""),[tt,st]=e.useState("idle"),[at,rt]=e.useState(null),lt=e.useRef(null),nt=e.useRef(null),[ct,it]=e.useState("idle"),[ot,dt]=e.useState("idle"),[ut,mt]=e.useState(null),[xt,pt]=e.useState(null),bt=e.useRef(!0),ht=e.useRef(null),gt=e.useRef(null),yt=e.useRef(null),ft=e.useRef(null),jt=e.useRef(!1),vt=e.useRef(!1);e.useEffect(()=>(bt.current=!0,()=>{bt.current=!1,ht.current&&clearTimeout(ht.current),gt.current&&clearTimeout(gt.current),yt.current&&clearTimeout(yt.current),ft.current&&clearTimeout(ft.current),St.current&&clearTimeout(St.current),Tt.current&&clearTimeout(Tt.current),Le.current&&clearTimeout(Le.current),He.current&&clearTimeout(He.current),nt.current&&clearTimeout(nt.current)}),[]),e.useEffect(()=>{const e=e=>{if(be||Ye||Re)return e.preventDefault(),e.returnValue="You have unsaved changes. Are you sure you want to leave?",e.returnValue};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[be,Ye,Re]);const Nt=null==(P=null==L?void 0:L.config)?void 0:P.web,[wt,kt]=e.useState("idle"),[_t,Ct]=e.useState(null),St=e.useRef(null),Tt=e.useRef(null),Et=e.useRef(!1),[Ft,Pt]=e.useState([]),[Lt,Rt]=e.useState(!1),[Dt,At]=e.useState(null),[It,Ot]=e.useState(!1),[Mt,zt]=e.useState(""),[Kt,Vt]=e.useState(null),[qt,Ht]=e.useState(!1),[$t,Yt]=e.useState(null),[Bt,Ut]=e.useState(!1),[Xt,Gt]=e.useState(!1),[Jt,Wt]=e.useState(!1),[Qt,Zt]=e.useState([]),[es,ts]=e.useState(!1),[ss,as]=e.useState(null),[rs,ls]=e.useState("deny"),[ns,cs]=e.useState(!1),[is,os]=e.useState(null),[ds,us]=e.useState(new Set),[ms,xs]=e.useState(!1),[ps,bs]=e.useState(!1),[hs,gs]=e.useState(!1),[ys,fs]=e.useState(null),[js,vs]=e.useState(null),[Ns,ws]=e.useState(""),[ks,_s]=e.useState("deny"),[Cs,Ss]=e.useState(!1),[Ts,Es]=e.useState(!0),[Fs,Ps]=e.useState(!1),[Ls,Rs]=e.useState(!0),[Ds,As]=e.useState("idle"),[Is,Os]=e.useState(!1),[Ms,zs]=e.useState(!1),Ks=e.useRef(!1);e.useEffect(()=>{const e=be&&!Ks.current;Ks.current=be,ie&&e&&(ye((ie.frequency/1e6).toFixed(3)),je(ie.bandwidth/1e3),Ne(ie.spreading_factor),ke(ie.coding_rate),Ce(String(ie.tx_power)))},[ie,be]);const Vs=e.useMemo(()=>{if(!ie||!be)return!1;const e=ie.frequency/1e6,t=ie.bandwidth/1e3,s=parseFloat(ge)||0;return Math.abs(s-e)>1e-4||fe!==t||ve!==ie.spreading_factor||we!==ie.coding_rate||parseInt(_e)!==ie.tx_power},[ie,be,ge,fe,ve,we,_e]),qs=e.useCallback(()=>{he(!1),Fe(null),ie&&(ye((ie.frequency/1e6).toFixed(3)),je(ie.bandwidth/1e3),Ne(ie.spreading_factor),ke(ie.coding_rate),Ce(String(ie.tx_power)))},[ie]);e.useEffect(()=>{if(!be)return;const e=e=>{"loading"!==Se&&Pe.current&&!Pe.current.contains(e.target)&&qs()};return document.addEventListener("mouseup",e),()=>{document.removeEventListener("mouseup",e)}},[be,qs,Se]);const Hs=e.useCallback(()=>{const e=null==pe?void 0:pe.tx_delay_factor;return e&&"object"==typeof e&&"parsedValue"in e?e.parsedValue??1:"number"==typeof e?e:1},[pe]),$s=e.useCallback(()=>{const e=null==pe?void 0:pe.direct_tx_delay_factor;return"number"==typeof e?e:.5},[pe]),Ys=e.useCallback(()=>{const e=null==de?void 0:de.max_airtime_percent;return"number"==typeof e?e:e&&"object"==typeof e&&"parsedValue"in e?e.parsedValue??6:6},[de]),Bs=e.useCallback(()=>{Ie(Hs().toFixed(2)),Me($s().toFixed(2)),Ke(Ys().toFixed(1)),De(!0)},[Hs,$s,Ys]),Us=e.useCallback(()=>{De(!1)},[]);e.useEffect(()=>{if(!Re)return;const e=e=>{"loading"!==Ve&&$e.current&&!$e.current.contains(e.target)&&Us()};return document.addEventListener("mouseup",e),()=>document.removeEventListener("mouseup",e)},[Re,Us,Ve]);const Xs=e.useCallback(()=>{var e,t,s;Xe(ue),Je((null==(e=null==oe?void 0:oe.latitude)?void 0:e.toString())||"0"),Qe((null==(t=null==oe?void 0:oe.longitude)?void 0:t.toString())||"0"),et((null==(s=null==oe?void 0:oe.send_advert_interval_hours)?void 0:s.toString())||"0"),rt(null),Be(!0)},[ue,oe]),Gs=e.useCallback(()=>{Be(!1),rt(null)},[]);e.useEffect(()=>{if(!Ye)return;const e=e=>{"loading"!==tt&&lt.current&&!lt.current.contains(e.target)&&Gs()};return document.addEventListener("mouseup",e),()=>document.removeEventListener("mouseup",e)},[Ye,Gs,tt]);const Js=async()=>{var e;if("loading"===wt)return;const t=(null==Nt?void 0:Nt.cors_enabled)??!1,s=!t,a=t;St.current&&clearTimeout(St.current),Tt.current&&clearTimeout(Tt.current),Et.current=!1,Ct(s),kt("loading"),St.current=setTimeout(()=>{Et.current||bt.current&&(Ct(a),kt("error"),Tt.current=setTimeout(()=>{bt.current&&(kt("idle"),Ct(null))},2e3))},1e4);try{const t=await B({web:{cors_enabled:s}});if(Et.current=!0,St.current&&clearTimeout(St.current),!bt.current)return;t.success||(null==(e=t.data)?void 0:e.persisted)?(await J(),kt("success"),Tt.current=setTimeout(()=>{bt.current&&(kt("idle"),Ct(null))},2e3)):(Ct(a),kt("error"),Tt.current=setTimeout(()=>{bt.current&&(kt("idle"),Ct(null))},2e3))}catch{if(Et.current=!0,St.current&&clearTimeout(St.current),!bt.current)return;Ct(a),kt("error"),Tt.current=setTimeout(()=>{bt.current&&(kt("idle"),Ct(null))},2e3)}};e.useEffect(()=>{(async()=>{Rs(!0);try{const e=await async function(){return T("/api/check_pymc_console")}();e.success&&e.data?Ps(e.data.exists):Ps(!1);const t=null==Nt?void 0:Nt.web_path;Es(!t||""===t)}catch{Ps(!1)}finally{Rs(!1)}})()},[null==Nt?void 0:Nt.web_path]);const Ws=async e=>{var t;if("loading"!==Ds){As("loading");try{const s=await B({web:{web_path:e?null:"/opt/pymc_console/web/html"}});if(!bt.current)return;s.success||(null==(t=s.data)?void 0:t.persisted)?(Es(e),As("success"),Os(!0),setTimeout(()=>{bt.current&&As("idle")},2e3)):(As("error"),setTimeout(()=>{bt.current&&As("idle")},2e3))}catch{if(!bt.current)return;As("error"),setTimeout(()=>{bt.current&&As("idle")},2e3)}}},Qs=e.useCallback(async()=>{Rt(!0),At(null);try{const e=await async function(){return T("/auth/tokens")}();Pt(e.tokens||[])}catch(e){At(e instanceof Error?e.message:"Failed to fetch tokens")}finally{Rt(!1)}},[]);e.useEffect(()=>{Qs()},[Qs]);const Zs=async()=>{if(Mt.trim()){Ut(!0),At(null);try{const e=await async function(e){return T("/auth/tokens",{method:"POST",body:JSON.stringify({name:e})})}(Mt.trim());Vt(e.token||null),Ot(!1),Ht(!0),zt(""),await Qs()}catch(e){At(e instanceof Error?e.message:"Failed to create token")}finally{Ut(!1)}}else At("Token name is required")},ea=e=>e?new Date(1e3*e).toLocaleString():"Never",ta=e.useCallback(e=>{const t=new Map,s=[];return e.forEach(e=>{const s={id:e.id,name:e.name,floodPolicy:e.flood_policy,transport_key:e.transport_key,last_used:e.last_used,parent_id:e.parent_id,children:[]};t.set(e.id,s)}),t.forEach(e=>{e.parent_id&&t.has(e.parent_id)?t.get(e.parent_id).children.push(e):s.push(e)}),s},[]),sa=e.useCallback(async()=>{ts(!0),as(null);try{const e=await async function(){return T("/api/transport_keys")}();e.success&&e.data?Zt(ta(e.data)):as(e.error||"Failed to load transport keys")}catch(e){as(e instanceof Error?e.message:"Unknown error occurred")}finally{ts(!1)}},[ta]);e.useEffect(()=>{sa()},[sa]);const aa=e.useCallback((e,t)=>{for(const s of e){if(s.id===t)return s;if(s.children){const e=aa(s.children,t);if(e)return e}}return null},[]),ra=e.useCallback(()=>{if(!is)return;const e=aa(Qt,is);return null==e?void 0:e.name},[is,Qt,aa]),la=e.useCallback(e=>{us(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[]),na=async e=>{cs(!0),as(null);try{const t=await async function(e){return T("/api/global_flood_policy",{method:"POST",body:JSON.stringify({global_flood_allow:e})})}("allow"===e);t.success?ls(e):as(t.error||"Failed to update global flood policy")}catch(t){as(t instanceof Error?t.message:"Failed to update global flood policy")}finally{cs(!1)}},ca=async()=>{if(Ns.trim()){Ss(!0),as(null);try{const e=await async function(e){return T("/api/transport_keys",{method:"POST",body:JSON.stringify(e)})}({name:Ns.trim(),flood_policy:ks,parent_id:is??void 0});e.success?(await sa(),xs(!1),ws(""),_s("deny")):as(e.error||"Failed to add transport key")}catch(e){as(e instanceof Error?e.message:"Failed to add transport key")}finally{Ss(!1)}}else as("Key name is required")},ia=e.useCallback(()=>{if(!is)return;const e=aa(Qt,is);e&&(fs({...e}),bs(!0))},[is,Qt,aa]);e.useEffect(()=>{const e=e=>{"Escape"===e.key&&(ms&&(xs(!1),ws(""),_s("deny")),ps&&(bs(!1),fs(null)),hs&&(gs(!1),vs(null)),It&&(Ot(!1),zt("")),qt&&(Ht(!1),Vt(null)))};if(ms||ps||hs||It||qt)return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ms,ps,hs,It,qt]);const oa=e.useCallback(()=>{if(!is)return;const e=aa(Qt,is);e&&(vs(e),gs(!0))},[is,Qt,aa]);return t.jsxs(V,{children:[t.jsx(q,{title:"Configuration",icon:t.jsx(o,{})}),t.jsxs($,{template:"standard",children:[t.jsx(Y,{span:12,md:6,children:t.jsx(K,{children:t.jsxs("div",{ref:lt,children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"type-subheading text-text-primary flex items-center gap-2",children:[t.jsx(d,{className:"icon-md text-accent-primary"}),"Repeater Settings"]}),t.jsx("div",{className:"flex items-center gap-1",children:oe&&(Ye?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:Gs,disabled:"loading"===tt,className:S("p-2 rounded-lg transition-colors","loading"===tt?"text-text-muted cursor-not-allowed":"text-text-muted hover:text-accent-danger hover:bg-accent-danger/10"),title:"Cancel",children:t.jsx(r,{className:"w-4 h-4"})}),t.jsx("button",{onClick:async()=>{if("loading"!==tt){nt.current&&clearTimeout(nt.current),ne(ae),st("loading"),rt(null);try{const e={};Ue&&Ue!==ue&&(e.node_name=Ue);const t=parseFloat(Ge);isNaN(t)||t===(null==oe?void 0:oe.latitude)||(e.latitude=t);const s=parseFloat(We);isNaN(s)||s===(null==oe?void 0:oe.longitude)||(e.longitude=s);const a=parseInt(Ze);if(isNaN(a)||a===(null==oe?void 0:oe.send_advert_interval_hours)||(e.flood_advert_interval_hours=a),0===Object.keys(e).length)return rt({success:!0,message:"No changes to save"}),st("idle"),void ce(ae);const r=await I(e);if(!bt.current)return void ce(ae);if(r.success&&r.data){const e=r.data.applied.join(", ");rt({success:!0,message:`Updated: ${e}`}),await J({force:!0}),st("success"),nt.current=setTimeout(()=>{bt.current&&(st("idle"),Be(!1),rt(null),ce(ae))},1500)}else rt({success:!1,message:r.error||"Failed to save"}),st("error"),ce(ae),nt.current=setTimeout(()=>{bt.current&&st("idle")},2e3)}catch(e){if(!bt.current)return void ce(ae);rt({success:!1,message:String(e)}),st("error"),ce(ae),nt.current=setTimeout(()=>{bt.current&&st("idle")},2e3)}}},disabled:"loading"===tt,className:S("p-2 rounded-lg transition-colors","loading"===tt?"text-accent-primary cursor-wait":"success"===tt?"text-accent-success":"error"===tt?"text-accent-danger":"text-accent-success hover:bg-accent-success/10"),title:"Save changes",children:"loading"===tt?t.jsx(l,{className:"w-4 h-4 animate-spin"}):"success"===tt?t.jsx(n,{className:"w-4 h-4"}):"error"===tt?t.jsx(r,{className:"w-4 h-4"}):t.jsx(n,{className:"w-4 h-4"})})]}):t.jsx("button",{onClick:Xs,className:"p-2 rounded-lg transition-colors text-text-muted hover:text-text-primary hover:bg-bg-subtle",title:"Edit repeater settings",children:t.jsx(c,{className:"w-4 h-4"})}))})]}),at&&t.jsx("div",{className:S("text-xs mb-3 px-2 py-1.5 rounded-md",at.success?"text-accent-success bg-accent-success/10":"text-accent-danger bg-accent-danger/10"),children:at.message}),oe?t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"col-span-2",children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Node Name"}),t.jsx("div",{className:S("h-[38px] rounded-full px-4 flex items-center transition-colors",Ye?"bg-subtle-fill-hover":"bg-subtle-fill"),children:Ye?t.jsx("input",{type:"text",value:Ue,onChange:e=>Xe(e.target.value),maxLength:50,className:"w-full bg-transparent text-text-primary focus:outline-none type-data",placeholder:"Enter node name"}):t.jsx("span",{className:"type-data text-text-primary",children:ue})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:Ye?"Latitude (°)":"Latitude"}),t.jsx("div",{className:S("h-[38px] rounded-full px-4 flex items-center transition-colors",Ye?"bg-subtle-fill-hover":"bg-subtle-fill"),children:Ye?t.jsx("input",{type:"number",value:Ge,onChange:e=>Je(e.target.value),step:"0.000001",min:"-90",max:"90",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):t.jsx("span",{className:"type-data text-text-primary",children:0!==oe.latitude?oe.latitude.toFixed(6):"Not set"})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:Ye?"Longitude (°)":"Longitude"}),t.jsx("div",{className:S("h-[38px] rounded-full px-4 flex items-center transition-colors",Ye?"bg-subtle-fill-hover":"bg-subtle-fill"),children:Ye?t.jsx("input",{type:"number",value:We,onChange:e=>Qe(e.target.value),step:"0.000001",min:"-180",max:"180",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):t.jsx("span",{className:"type-data text-text-primary",children:0!==oe.longitude?oe.longitude.toFixed(6):"Not set"})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:Ye?"Advert Interval (hours)":"Advert Interval"}),t.jsx("div",{className:S("h-[38px] rounded-full px-4 flex items-center transition-colors",Ye?"bg-subtle-fill-hover":"bg-subtle-fill"),children:Ye?t.jsx("input",{type:"number",value:Ze,onChange:e=>et(e.target.value),min:"0",max:"48",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):t.jsx("span",{className:"type-data text-text-primary",children:oe.send_advert_interval_hours>0?`${oe.send_advert_interval_hours}h`:"Disabled"})}),Ye&&t.jsx("p",{className:"type-data-xs text-text-muted mt-1 ml-4",children:"0 = disabled, 3-48 hours"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Score-based TX"}),t.jsx("div",{className:"h-[38px] rounded-full px-4 flex items-center bg-subtle-fill",children:t.jsx("span",{className:"type-data text-text-primary",children:oe.use_score_for_tx?"Enabled":"Disabled"})})]})]}):t.jsx("p",{className:"text-text-muted",children:"Loading repeater settings..."})]})})}),t.jsx(Y,{span:12,md:6,children:t.jsx(K,{children:t.jsxs("div",{ref:Pe,children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"type-subheading text-text-primary flex items-center gap-2",children:[t.jsx(u,{className:"icon-md text-accent-primary"}),"Radio Configuration"]}),t.jsx("div",{className:"flex items-center gap-1",children:ie&&(be?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:qs,disabled:"loading"===Se,className:S("p-2 rounded-lg transition-colors","loading"===Se?"text-text-muted cursor-not-allowed":"text-text-muted hover:text-accent-danger hover:bg-accent-danger/10"),title:"Cancel",children:t.jsx(r,{className:"w-4 h-4"})}),t.jsx("button",{onClick:async()=>{if("loading"!==Se){Le.current&&clearTimeout(Le.current),ne(se),Te("loading"),Fe(null);try{const e={},t=parseFloat(ge),s=ie?ie.frequency/1e6:0;Math.abs(t-s)>1e-4&&(e.frequency_mhz=t);const a=ie?ie.bandwidth/1e3:0;fe!==a&&(e.bandwidth_khz=fe),ve!==(null==ie?void 0:ie.spreading_factor)&&(e.spreading_factor=ve),we!==(null==ie?void 0:ie.coding_rate)&&(e.coding_rate=we);const r=parseInt(_e);if(r!==(null==ie?void 0:ie.tx_power)&&(e.tx_power=r),0===Object.keys(e).length)return Fe({success:!0,message:"No changes to save"}),Te("idle"),void ce(se);const l=await I(e);if(!bt.current)return void ce(se);if(l.success&&l.data){const e=l.data.applied.join(", "),t=l.data.live_update?" (applied live)":" (restart required)";Fe({success:!0,message:`Updated: ${e}${t}`}),await J({force:!0}),Te("success"),Le.current=setTimeout(()=>{bt.current&&(Te("idle"),he(!1),Fe(null),ce(se))},1500)}else Fe({success:!1,message:l.error||"Failed to save"}),Te("error"),ce(se),Le.current=setTimeout(()=>{bt.current&&Te("idle")},2e3)}catch(e){if(!bt.current)return void ce(se);Fe({success:!1,message:String(e)}),Te("error"),ce(se),Le.current=setTimeout(()=>{bt.current&&Te("idle")},2e3)}}},disabled:"loading"===Se||!Vs,className:S("p-2 rounded-lg transition-colors","loading"===Se?"text-accent-primary cursor-wait":"success"===Se?"text-accent-success":"error"===Se?"text-accent-danger":Vs?"text-accent-success hover:bg-accent-success/10":"text-text-muted cursor-not-allowed"),title:Vs?"Save changes":"No changes to save",children:"loading"===Se?t.jsx(l,{className:"w-4 h-4 animate-spin"}):"success"===Se?t.jsx(n,{className:"w-4 h-4"}):"error"===Se?t.jsx(r,{className:"w-4 h-4"}):t.jsx(n,{className:"w-4 h-4"})})]}):t.jsx("button",{onClick:()=>{ie&&(ye((ie.frequency/1e6).toFixed(3)),je(ie.bandwidth/1e3),Ne(ie.spreading_factor),ke(ie.coding_rate),Ce(String(ie.tx_power))),Fe(null),he(!0)},className:"p-2 rounded-lg transition-colors text-text-muted hover:text-text-primary hover:bg-bg-subtle",title:"Edit radio settings",children:t.jsx(c,{className:"w-4 h-4"})}))})]}),Ee&&t.jsx("div",{className:S("text-xs mb-3 px-2 py-1.5 rounded-md",Ee.success?"text-accent-success bg-accent-success/10":"text-accent-danger bg-accent-danger/10"),children:Ee.message}),ie?t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:be?"Frequency (MHz)":"Frequency"}),t.jsx("div",{className:S("h-[38px] rounded-full px-4 flex items-center transition-colors",be?"bg-subtle-fill-hover":"bg-subtle-fill"),children:be?t.jsx("input",{type:"number",value:ge,onChange:e=>ye(e.target.value),step:"0.001",min:"400",max:"930",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):t.jsx("span",{className:"type-data text-text-primary",children:D(ie.frequency)})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:be?"TX Power (dBm)":"TX Power"}),t.jsx("div",{className:S("h-[38px] rounded-full px-4 flex items-center transition-colors",be?"bg-subtle-fill-hover":"bg-subtle-fill"),children:be?t.jsx("input",{type:"number",value:_e,onChange:e=>Ce(e.target.value),min:"-9",max:"22",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):t.jsxs("span",{className:"type-data text-text-primary",children:[ie.tx_power," dBm"]})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Bandwidth"}),t.jsx("div",{className:S("h-[38px] rounded-full px-4 flex items-center transition-colors relative",be?"bg-subtle-fill-hover":"bg-subtle-fill"),children:be?t.jsxs(t.Fragment,{children:[t.jsx("select",{value:fe,onChange:e=>je(parseFloat(e.target.value)),className:"w-full bg-transparent text-text-primary focus:outline-none appearance-none cursor-pointer type-data pr-6",children:Z.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))}),t.jsx(m,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]}):t.jsx("span",{className:"type-data text-text-primary",children:A(ie.bandwidth)})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Spreading Factor"}),t.jsx("div",{className:S("h-[38px] rounded-full px-4 flex items-center transition-colors relative",be?"bg-subtle-fill-hover":"bg-subtle-fill"),children:be?t.jsxs(t.Fragment,{children:[t.jsx("select",{value:ve,onChange:e=>Ne(parseInt(e.target.value)),className:"w-full bg-transparent text-text-primary focus:outline-none appearance-none cursor-pointer type-data pr-6",children:ee.map(e=>t.jsxs("option",{value:e,children:["SF",e]},e))}),t.jsx(m,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]}):t.jsxs("span",{className:"type-data text-text-primary",children:["SF",ie.spreading_factor]})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Coding Rate"}),t.jsx("div",{className:S("h-[38px] rounded-full px-4 flex items-center transition-colors relative",be?"bg-subtle-fill-hover":"bg-subtle-fill"),children:be?t.jsxs(t.Fragment,{children:[t.jsx("select",{value:we,onChange:e=>ke(parseInt(e.target.value)),className:"w-full bg-transparent text-text-primary focus:outline-none appearance-none cursor-pointer type-data pr-6",children:te.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))}),t.jsx(m,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]}):t.jsxs("span",{className:"type-data text-text-primary",children:["4/",ie.coding_rate]})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Preamble"}),t.jsx("div",{className:"h-[38px] rounded-full px-4 flex items-center bg-subtle-fill",children:t.jsxs("span",{className:"type-data text-text-primary",children:[ie.preamble_length," symbols"]})})]})]}):t.jsx("p",{className:"text-text-muted",children:"Loading radio configuration..."})]})})})]}),t.jsxs($,{template:"standard",children:[t.jsx(Y,{span:12,md:6,children:t.jsx(K,{children:t.jsxs("div",{ref:$e,children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("h2",{className:"type-subheading text-text-primary flex items-center gap-3",children:[t.jsx(x,{className:"icon-md text-icon-card-title"}),"Operating Mode"]}),t.jsx("div",{className:"flex items-center gap-1",children:Re?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:async()=>{if("loading"!==Ve){He.current&&clearTimeout(He.current),ne(re),qe("loading");try{const e=await I({tx_delay_factor:parseFloat(Ae),direct_tx_delay_factor:parseFloat(Oe)});if(await X({max_airtime_percent:parseFloat(ze),enforcement_enabled:xe}),!bt.current)return void ce(re);e.success&&e.data?(await J({force:!0}),qe("success"),He.current=setTimeout(()=>{bt.current&&(qe("idle"),De(!1),ce(re))},1500)):(qe("error"),ce(re),He.current=setTimeout(()=>{bt.current&&qe("idle")},2e3))}catch{if(!bt.current)return void ce(re);qe("error"),ce(re),He.current=setTimeout(()=>{bt.current&&qe("idle")},2e3)}}},disabled:"loading"===Ve,className:S("p-2 rounded-lg transition-colors","loading"===Ve?"text-accent-primary cursor-wait":"success"===Ve?"text-accent-success":"error"===Ve?"text-accent-danger":"text-accent-success hover:bg-accent-success/10"),title:"Save",children:"loading"===Ve?t.jsx(l,{className:"w-4 h-4 animate-spin"}):"success"===Ve?t.jsx(n,{className:"w-4 h-4"}):"error"===Ve?t.jsx(r,{className:"w-4 h-4"}):t.jsx(n,{className:"w-4 h-4"})}),t.jsx("button",{onClick:Us,className:"p-2 rounded-lg text-text-muted hover:text-accent-danger hover:bg-accent-danger/10",title:"Cancel",children:t.jsx(r,{className:"w-4 h-4"})})]}):t.jsx("button",{onClick:Bs,className:"p-2 rounded-lg transition-colors text-text-muted hover:text-text-primary hover:bg-bg-subtle",title:"Edit settings",children:t.jsx(c,{className:"w-4 h-4"})})})]}),t.jsx("p",{className:"type-label text-text-muted mb-3",children:"Control how the repeater handles packets"}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsxs("div",{className:"flex-1 space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"type-label text-text-muted",children:"Repeat"}),t.jsx("div",{className:"flex items-center gap-2",children:(()=>{const e=null!==ut?ut:"forward"===me;return t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:async()=>{if("loading"===ct)return;const t=!e,s="forward"===me;ht.current&&clearTimeout(ht.current),gt.current&&clearTimeout(gt.current),jt.current=!1,mt(t),it("loading"),ht.current=setTimeout(()=>{jt.current||bt.current&&(mt(s),it("error"),gt.current=setTimeout(()=>{bt.current&&(it("idle"),mt(null))},2e3))},1e4);try{if(await M(t?"forward":"monitor"),jt.current=!0,ht.current&&clearTimeout(ht.current),!bt.current)return;it("success"),gt.current=setTimeout(()=>{bt.current&&(it("idle"),mt(null),U())},2e3)}catch{if(jt.current=!0,ht.current&&clearTimeout(ht.current),!bt.current)return;mt(s),it("error"),gt.current=setTimeout(()=>{bt.current&&(it("idle"),mt(null))},2e3)}},disabled:"loading"===ct,className:S("relative inline-flex h-6 w-11 items-center rounded-full transition-colors border-2",e?"bg-toggle-on border-toggle-on":"bg-toggle-off border-border-subtle","loading"===ct&&"opacity-70"),"aria-label":"Toggle forward mode",children:t.jsx("span",{className:S("inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-lg",e?"translate-x-5":"translate-x-0.5")})}),t.jsx("span",{className:S("type-data text-sm w-7",e?"text-accent-success":"text-text-muted"),children:e?"On":"Off"}),"loading"===ct&&t.jsx(l,{className:"w-4 h-4 text-text-muted animate-spin"}),"success"===ct&&t.jsx(n,{className:"w-4 h-4 text-accent-success"}),"error"===ct&&t.jsx(r,{className:"w-4 h-4 text-accent-danger"})]})})()})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"type-label text-text-muted",children:"Duty Cycle"}),t.jsx("div",{className:"flex items-center gap-2",children:(()=>{const e=null!==xt?xt:xe;return t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:async()=>{if("loading"===ot)return;const t=!e,s=xe;yt.current&&clearTimeout(yt.current),ft.current&&clearTimeout(ft.current),vt.current=!1,pt(t),dt("loading"),yt.current=setTimeout(()=>{vt.current||bt.current&&(pt(s),dt("error"),ft.current=setTimeout(()=>{bt.current&&(dt("idle"),pt(null))},2e3))},1e4);try{if(await X({max_airtime_percent:Ys(),enforcement_enabled:t}),vt.current=!0,yt.current&&clearTimeout(yt.current),!bt.current)return;dt("success"),ft.current=setTimeout(()=>{bt.current&&(dt("idle"),pt(null),G())},2e3)}catch{if(vt.current=!0,yt.current&&clearTimeout(yt.current),!bt.current)return;pt(s),dt("error"),ft.current=setTimeout(()=>{bt.current&&(dt("idle"),pt(null))},2e3)}},disabled:"loading"===ot,className:S("relative inline-flex h-6 w-11 items-center rounded-full transition-colors border-2",e?"bg-toggle-on border-toggle-on":"bg-toggle-off border-border-subtle","loading"===ot&&"opacity-70"),"aria-label":"Toggle duty cycle",children:t.jsx("span",{className:S("inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-lg",e?"translate-x-5":"translate-x-0.5")})}),t.jsx("span",{className:S("type-data text-sm w-7",e?"text-accent-success":"text-text-muted"),children:e?"On":"Off"}),"loading"===ot&&t.jsx(l,{className:"w-4 h-4 text-text-muted animate-spin"}),"success"===ot&&t.jsx(n,{className:"w-4 h-4 text-accent-success"}),"error"===ot&&t.jsx(r,{className:"w-4 h-4 text-accent-danger"})]})})()})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"type-label text-text-muted",children:"Max Airtime"}),t.jsx("div",{className:S("h-[32px] rounded-full px-3 flex items-center justify-end transition-colors min-w-[80px]",Re?"bg-subtle-fill-hover":"bg-subtle-fill"),children:Re?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("input",{type:"number",value:ze,onChange:e=>Ke(e.target.value),step:"0.5",min:"0.1",max:"100",className:"w-12 bg-transparent text-text-primary text-right focus:outline-none type-data"}),t.jsx("span",{className:"text-text-muted type-data",children:"%"})]}):t.jsxs("span",{className:"type-data text-text-primary",children:[Ys().toFixed(1),"%"]})})]})]}),t.jsx("div",{className:"hidden sm:block w-px bg-border-subtle"}),t.jsxs("div",{className:"flex-1 pt-4 sm:pt-0 border-t sm:border-t-0 border-border-subtle",children:[t.jsx("label",{className:"type-label text-text-muted block mb-3",children:"TX Delays"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"type-label text-text-muted",children:"Flood"}),t.jsx("div",{className:S("h-[32px] rounded-full px-3 flex items-center justify-end transition-colors min-w-[80px]",Re?"bg-subtle-fill-hover":"bg-subtle-fill"),children:Re?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("input",{type:"number",value:Ae,onChange:e=>Ie(e.target.value),step:"0.1",min:"0",max:"5",className:"w-12 bg-transparent text-text-primary text-right focus:outline-none type-data"}),t.jsx("span",{className:"text-text-muted type-data",children:"x"})]}):t.jsxs("span",{className:"type-data text-text-primary",children:[Hs().toFixed(2),"x"]})})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"type-label text-text-muted",children:"Direct"}),t.jsx("div",{className:S("h-[32px] rounded-full px-3 flex items-center justify-end transition-colors min-w-[80px]",Re?"bg-subtle-fill-hover":"bg-subtle-fill"),children:Re?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("input",{type:"number",value:Oe,onChange:e=>Me(e.target.value),step:"0.1",min:"0",max:"5",className:"w-12 bg-transparent text-text-primary text-right focus:outline-none type-data"}),t.jsx("span",{className:"text-text-muted type-data",children:"s"})]}):t.jsxs("span",{className:"type-data text-text-primary",children:[$s().toFixed(2),"s"]})})]})]})]})]})]})})}),t.jsx(Y,{span:12,md:6,children:t.jsxs(K,{children:[t.jsx(H,{icon:t.jsx(o,{}),title:"App Settings",largeTitle:!0}),t.jsx("p",{className:"type-body-sm text-text-muted mb-4",children:"Appearance and web server options."}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("span",{className:"type-body text-text-primary font-medium block",children:"Enable CORS"}),t.jsx("span",{className:"type-body-sm text-text-muted",children:"Allow cross-origin API access"})]}),t.jsx("div",{className:"flex items-center gap-2",children:(()=>{const e=null!==_t?_t:(null==Nt?void 0:Nt.cors_enabled)??!1;return t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:Js,disabled:"loading"===wt,className:S("relative inline-flex h-6 w-11 items-center rounded-full transition-colors border-2",e?"bg-toggle-on border-toggle-on":"bg-toggle-off border-border-subtle","loading"===wt&&"opacity-70"),title:e?"Disable CORS":"Enable CORS",children:t.jsx("span",{className:S("inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-lg",e?"translate-x-5":"translate-x-0.5")})}),"loading"===wt&&t.jsx(l,{className:"w-4 h-4 text-text-muted animate-spin"}),"success"===wt&&t.jsx(n,{className:"w-4 h-4 text-accent-success"}),"error"===wt&&t.jsx(r,{className:"w-4 h-4 text-accent-danger"})]})})()})]}),t.jsx("div",{children:t.jsx(W,{})})]})]})})]}),t.jsx($,{template:"auto",children:t.jsxs(K,{children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"type-heading text-text-primary flex items-center gap-2",children:[t.jsx(p,{className:"icon-md text-accent-primary"}),"Regions / Transport Keys"]}),t.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Manage regional key hierarchy for flood control"})]}),t.jsxs("div",{className:"flex gap-2 flex-wrap",children:[t.jsxs("button",{onClick:()=>xs(!0),disabled:"allow"===rs,className:S("flex items-center gap-1.5 h-[32px] px-3 rounded-full transition-colors type-body-sm font-medium","allow"===rs?"bg-subtle-fill text-text-muted cursor-not-allowed":"bg-accent-success/10 hover:bg-accent-success/20 text-accent-success"),children:[t.jsx(b,{className:"w-3.5 h-3.5"}),"Add"]}),t.jsx("button",{onClick:ia,disabled:!is||"allow"===rs,className:S("h-[32px] px-3 rounded-full transition-colors type-body-sm font-medium",is&&"allow"!==rs?"bg-accent-primary/10 hover:bg-accent-primary/20 text-accent-primary":"bg-subtle-fill text-text-muted cursor-not-allowed"),children:"Edit"}),t.jsx("button",{onClick:oa,disabled:!is||"allow"===rs,className:S("h-[32px] px-3 rounded-full transition-colors type-body-sm font-medium",is&&"allow"!==rs?"bg-accent-danger/10 hover:bg-accent-danger/20 text-accent-danger":"bg-subtle-fill text-text-muted cursor-not-allowed"),children:"Delete"})]})]}),t.jsx("div",{className:"bg-subtle-fill rounded-2xl p-4 mb-4",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:S("w-10 h-10 rounded-full flex items-center justify-center","allow"===rs?"bg-accent-success/20":"bg-accent-danger/20"),children:"allow"===rs?t.jsx(h,{className:"w-5 h-5 text-accent-success"}):t.jsx(g,{className:"w-5 h-5 text-accent-danger"})}),t.jsxs("div",{children:[t.jsx("h4",{className:"type-body text-text-primary font-medium",children:"Global Flood Policy"}),t.jsx("p",{className:"type-body-sm text-text-muted",children:"Master control for repeater flooding"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"flex bg-subtle-fill rounded-full p-1",children:[t.jsx("button",{onClick:()=>na("deny"),disabled:ns,className:S("px-4 py-1.5 rounded-full transition-colors type-body-sm font-medium","deny"===rs?"bg-accent-danger/20 text-accent-danger":"text-text-muted hover:text-text-secondary",ns&&"opacity-50"),children:"Deny"}),t.jsx("button",{onClick:()=>na("allow"),disabled:ns,className:S("px-4 py-1.5 rounded-full transition-colors type-body-sm font-medium","allow"===rs?"bg-accent-success/20 text-accent-success":"text-text-muted hover:text-text-secondary",ns&&"opacity-50"),children:"Allow"})]}),ns&&t.jsx(l,{className:"w-4 h-4 animate-spin text-text-muted"})]})]})}),ss&&t.jsx("div",{className:"type-body-sm mb-3 px-3 py-2 rounded-full text-accent-danger bg-accent-danger/10",children:ss}),t.jsx("div",{className:"bg-subtle-fill rounded-2xl p-4 min-h-[120px]",children:es?t.jsxs("div",{className:"flex items-center justify-center py-6",children:[t.jsx(l,{className:"w-5 h-5 animate-spin text-accent-primary mr-2"}),t.jsx("span",{className:"type-body-sm text-text-muted",children:"Loading transport keys..."})]}):0===Qt.length?t.jsxs("div",{className:"text-center py-6",children:[t.jsx("div",{className:"w-12 h-12 rounded-full bg-subtle-fill mx-auto mb-3 flex items-center justify-center",children:t.jsx(p,{className:"w-6 h-6 text-text-muted/50"})}),t.jsx("p",{className:"type-body text-text-muted",children:"No transport keys found"}),t.jsx("p",{className:"type-body-sm text-text-muted/70 mt-1",children:"Add your first transport key to get started"})]}):t.jsx("div",{className:"space-y-1",children:Qt.map(e=>t.jsx(le,{node:e,level:0,expandedKeys:ds,selectedKeyId:is,globalFloodPolicy:rs,onSelect:os,onToggle:la},e.id))})})]})}),t.jsx($,{template:"auto",children:t.jsxs(K,{children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"type-heading text-text-primary flex items-center gap-2",children:[t.jsx(y,{className:"icon-md text-accent-primary"}),"API Tokens"]}),t.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Manage API tokens for machine-to-machine authentication"})]}),t.jsxs("button",{onClick:()=>Ot(!0),className:"flex items-center justify-center gap-2 h-[32px] px-4 bg-accent-primary/10 hover:bg-accent-primary/20 text-accent-primary rounded-full transition-colors type-body-sm font-medium",children:[t.jsx(b,{className:"w-4 h-4"}),"Create Token"]})]}),t.jsx("div",{className:"bg-accent-tertiary/5 rounded-2xl p-4 mb-4",children:t.jsxs("div",{className:"flex gap-3",children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-accent-tertiary/20 flex items-center justify-center flex-shrink-0",children:t.jsx(i,{className:"w-4 h-4 text-accent-tertiary"})}),t.jsxs("div",{className:"type-body-sm text-text-muted",children:[t.jsxs("p",{children:[t.jsx("span",{className:"text-text-secondary",children:"API tokens"})," are used for machine-to-machine authentication. Include the token in the ",t.jsx("code",{className:"type-code bg-accent-tertiary/20 px-1.5 py-0.5 rounded-full text-accent-tertiary",children:"X-API-Key"})," header when making API requests."]}),t.jsx("p",{className:"mt-1 text-text-muted/70",children:"Tokens are only shown once at creation. Store them securely."})]})]})}),Dt&&t.jsx("div",{className:"type-body-sm mb-3 px-3 py-2 rounded-full text-accent-danger bg-accent-danger/10",children:Dt}),Lt&&0===Ft.length?t.jsxs("div",{className:"flex items-center justify-center py-6",children:[t.jsx(l,{className:"w-5 h-5 animate-spin text-accent-primary mr-2"}),t.jsx("span",{className:"type-body-sm text-text-muted",children:"Loading tokens..."})]}):Ft.length>0?t.jsx("div",{className:"space-y-2",children:Ft.map(e=>t.jsx("div",{className:"bg-subtle-fill hover:bg-subtle-fill-strong rounded-2xl p-4 transition-colors",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-accent-primary/10 flex items-center justify-center flex-shrink-0",children:t.jsx(y,{className:"w-5 h-5 text-accent-primary"})}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("h3",{className:"type-body text-text-primary font-medium truncate",children:e.name}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:gap-4 mt-0.5",children:[t.jsxs("span",{className:"type-data-sm text-text-muted truncate",children:["Created: ",ea(e.created_at)]}),t.jsxs("span",{className:"type-data-sm text-text-muted truncate",children:["Last used: ",ea(e.last_used)]})]})]})]}),t.jsxs("button",{onClick:()=>Yt({id:e.id,name:e.name}),disabled:Xt,className:"h-[32px] px-4 bg-accent-danger/10 hover:bg-accent-danger/20 text-accent-danger rounded-full transition-colors disabled:opacity-50 type-body-sm font-medium flex items-center justify-center gap-1.5",children:[t.jsx(a,{className:"w-3.5 h-3.5"}),"Revoke"]})]})},e.id))}):t.jsxs("div",{className:"bg-subtle-fill rounded-2xl p-6 text-center",children:[t.jsx("div",{className:"w-14 h-14 rounded-full bg-subtle-fill mx-auto mb-4 flex items-center justify-center",children:t.jsx(y,{className:"w-7 h-7 text-text-muted/50"})}),t.jsx("h3",{className:"type-body text-text-primary font-medium mb-1",children:"No API Tokens"}),t.jsx("p",{className:"type-body-sm text-text-muted mb-4",children:"Create a token to enable API access"}),t.jsx("button",{onClick:()=>Ot(!0),className:"h-[32px] px-4 bg-accent-primary/10 hover:bg-accent-primary/20 text-accent-primary rounded-full transition-colors type-body-sm font-medium",children:"Create Your First Token"})]})]})}),t.jsx($,{template:"auto",children:t.jsxs(K,{children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:t.jsxs("div",{children:[t.jsxs("h2",{className:"type-heading text-text-primary flex items-center gap-2",children:[t.jsx(f,{className:"icon-md text-accent-primary"}),"Web Frontend"]}),t.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Choose which web interface to use"})]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("label",{className:S("flex items-start gap-3 p-4 bg-subtle-fill rounded-2xl border-2 cursor-pointer transition-all",Ts?"border-accent-primary bg-accent-primary/5":"border-transparent hover:border-accent-primary/30","loading"===Ds&&"opacity-50 pointer-events-none"),children:[t.jsx("input",{type:"radio",name:"frontend",checked:Ts,onChange:()=>Ws(!0),disabled:"loading"===Ds,className:"mt-1 h-4 w-4 text-accent-primary focus:ring-accent-primary focus:ring-offset-bg-elevated"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"type-body text-text-primary font-medium",children:"Default Frontend"}),t.jsx("a",{href:"https://github.com/rightup/pyMC_Repeater",target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"type-data-xs bg-accent-tertiary/15 text-accent-tertiary px-2.5 py-0.5 rounded-full font-medium hover:bg-accent-tertiary/25 transition-colors",children:"@RightUp"})]}),t.jsx("div",{className:"type-body-sm text-text-muted mt-1",children:"Built-in pyMC Repeater web interface"}),t.jsx("div",{className:"type-data-xs text-text-muted/60 mt-1 font-mono",children:"/opt/pymc_repeater/repeater/web/html"})]})]}),t.jsxs("label",{className:S("flex items-start gap-3 p-4 bg-subtle-fill rounded-2xl border-2 cursor-pointer transition-all",Ts?"border-transparent hover:border-accent-primary/30":"border-accent-primary bg-accent-primary/5","loading"===Ds&&"opacity-50 pointer-events-none"),children:[t.jsx("input",{type:"radio",name:"frontend",checked:!Ts,onChange:()=>Ws(!1),disabled:"loading"===Ds,className:"mt-1 h-4 w-4 text-accent-primary focus:ring-accent-primary focus:ring-offset-bg-elevated"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"type-body text-text-primary font-medium",children:"PyMC Console"}),t.jsx("span",{className:"type-data-xs bg-accent-secondary/15 text-accent-secondary px-2.5 py-0.5 rounded-full font-medium",children:"@Treehouse ⚡"})]}),t.jsx("div",{className:"type-body-sm text-text-muted mt-1",children:"Alternative web interface for pyMC Repeater"}),t.jsx("div",{className:"type-data-xs text-text-muted/60 mt-1 font-mono",children:"/opt/pymc_console/web/html"})]})]})]}),!Ls&&t.jsx("div",{className:S("bg-subtle-fill rounded-2xl p-4",Fs?"border border-accent-success/20":"border border-accent-tertiary/20"),children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:S("w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",Fs?"bg-accent-success/20":"bg-accent-tertiary/20"),children:Fs?t.jsx(j,{className:"w-4 h-4 text-accent-success"}):t.jsx(i,{className:"w-4 h-4 text-accent-tertiary"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"type-body text-text-primary font-medium",children:Fs?"PyMC Console has been detected":"PyMC Console Not Installed"}),Fs?t.jsxs("p",{className:"type-body-sm text-text-muted mt-1",children:["PyMC Console is installed at ",t.jsx("code",{className:"type-code bg-accent-success/10 px-1.5 py-0.5 rounded-full text-accent-success",children:"/opt/pymc_console/web/html"})]}):t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"type-body-sm text-text-muted mt-1 mb-3",children:["PyMC Console must be installed at ",t.jsx("code",{className:"type-code bg-accent-tertiary/10 px-1.5 py-0.5 rounded-full text-accent-tertiary",children:"/opt/pymc_console/web/html"})," before selecting this option."]}),t.jsxs("a",{href:"https://github.com/dmduran12/pymc_console-dist",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 h-[32px] px-4 bg-accent-tertiary/10 hover:bg-accent-tertiary/20 text-accent-tertiary rounded-full type-body-sm font-medium transition-colors",children:[t.jsx(v,{className:"w-4 h-4"}),"PyMC Console Install Instructions"]})]})]})]})}),Is&&t.jsx("div",{className:"bg-subtle-fill rounded-2xl p-4 border border-accent-secondary/30",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[t.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-accent-secondary/20 flex items-center justify-center flex-shrink-0",children:t.jsx(N,{className:"w-4 h-4 text-accent-secondary"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"type-body text-text-primary font-medium",children:"Service restart required"}),t.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Web frontend changes will take effect after restarting the pymc-repeater service."})]})]}),t.jsx("button",{onClick:async()=>{if(!Ms){zs(!0);try{await async function(){return T("/api/restart_service",{method:"POST",body:"{}"})}(),Os(!1),setTimeout(()=>{window.location.reload()},2e3)}catch{Os(!1),setTimeout(()=>{window.location.reload()},3e3)}}},disabled:Ms,className:"h-[32px] px-4 bg-accent-secondary/10 hover:bg-accent-secondary/20 text-accent-secondary rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 whitespace-nowrap type-body-sm font-medium",children:Ms?t.jsxs(t.Fragment,{children:[t.jsx(l,{className:"w-4 h-4 animate-spin"}),"Restarting..."]}):t.jsxs(t.Fragment,{children:[t.jsx(w,{className:"w-4 h-4"}),"Restart Now"]})})]})})]})]})}),L&&t.jsx($,{template:"auto",children:t.jsx(z,{nodeName:ue,repeaterVersion:L.version,coreVersion:L.core_version,localHash:L.local_hash,publicKey:L.public_key})}),L&&(0===(null==oe?void 0:oe.latitude)||!(null==oe?void 0:oe.latitude))&&(0===(null==oe?void 0:oe.longitude)||!(null==oe?void 0:oe.longitude))&&t.jsx($,{template:"auto",children:t.jsx(Q,{})}),It&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&Ot(!1),role:"dialog","aria-modal":"true","aria-labelledby":"create-token-modal-title",children:t.jsxs("div",{className:"bg-bg-elevated border border-border-subtle rounded-xl p-6 max-w-md w-full shadow-2xl",children:[t.jsx("h3",{id:"create-token-modal-title",className:"type-subheading text-text-primary mb-4",children:"Create API Token"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Token Name"}),t.jsx("input",{type:"text",value:Mt,onChange:e=>zt(e.target.value),placeholder:"e.g., Production Server, CI/CD Pipeline",className:"w-full px-4 py-2 bg-bg-subtle border border-border-subtle rounded-lg text-text-primary placeholder-text-muted focus:outline-none focus:ring-2 focus:ring-accent-primary/50 transition-colors",onKeyDown:e=>"Enter"===e.key&&Zs(),autoFocus:!0}),t.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Give your token a descriptive name to identify its purpose"})]}),t.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[t.jsx("button",{onClick:()=>{Ot(!1),zt(""),At(null)},disabled:Bt,className:"px-4 py-2 bg-bg-subtle hover:bg-bg-elevated text-text-secondary rounded-lg border border-border-subtle transition-colors disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:Zs,disabled:Bt||!Mt.trim(),className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary rounded-lg border border-accent-primary/50 transition-colors disabled:opacity-50 flex items-center gap-2",children:Bt?t.jsxs(t.Fragment,{children:[t.jsx(l,{className:"w-4 h-4 animate-spin"}),"Creating..."]}):"Create Token"})]})]})]})}),qt&&Kt&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&Ht(!1),role:"dialog","aria-modal":"true","aria-labelledby":"show-token-modal-title",children:t.jsxs("div",{className:"bg-bg-elevated border border-border-subtle rounded-xl p-6 max-w-lg w-full shadow-2xl",children:[t.jsx("h3",{id:"show-token-modal-title",className:"type-subheading text-text-primary mb-4",children:"Token Created Successfully"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"bg-accent-secondary/10 border border-accent-secondary/30 rounded-lg p-3",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx(N,{className:"w-4 h-4 text-accent-secondary flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"text-sm text-text-secondary",children:[t.jsx("strong",{children:"Save this token now!"})," For security reasons, it will not be shown again."]})]})}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Your API Token"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{value:Kt,readOnly:!0,className:"flex-1 px-4 py-2 bg-bg-subtle border border-border-subtle rounded-lg text-text-primary font-mono text-sm"}),t.jsxs("button",{onClick:()=>{Kt&&(navigator.clipboard.writeText(Kt),Wt(!0),setTimeout(()=>Wt(!1),2e3))},className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary rounded-lg border border-accent-primary/50 transition-colors flex items-center gap-2",title:"Copy to clipboard",children:[Jt?t.jsx(n,{className:"w-4 h-4 text-accent-success"}):t.jsx(k,{className:"w-4 h-4"}),Jt?"Copied!":"Copy"]})]})]}),t.jsxs("div",{className:"bg-accent-tertiary/10 border border-accent-tertiary/30 rounded-lg p-3",children:[t.jsx("p",{className:"text-sm text-text-secondary mb-2",children:t.jsx("strong",{children:"Usage Example:"})}),t.jsxs("code",{className:"block bg-accent-tertiary/20 px-3 py-2 rounded text-xs text-accent-tertiary font-mono overflow-x-auto",children:['curl -H "X-API-Key: ',Kt.slice(0,12),'..." ',window.location.origin,"/api/stats"]})]}),t.jsx("div",{className:"flex justify-end mt-6",children:t.jsx("button",{onClick:()=>{Ht(!1),Vt(null)},className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary rounded-lg border border-accent-primary/50 transition-colors",children:"Done"})})]})]})}),t.jsx(O,{isOpen:!!$t,title:"Revoke API Token",message:`Are you sure you want to revoke the token '${null==$t?void 0:$t.name}'? This action cannot be undone.`,confirmLabel:Xt?"Revoking...":"Revoke",cancelLabel:"Cancel",variant:"danger",onConfirm:async()=>{if($t){Gt(!0),At(null);try{await async function(e){return T(`/auth/tokens/${e}`,{method:"DELETE"})}($t.id),await Qs(),Yt(null)}catch(e){At(e instanceof Error?e.message:"Failed to revoke token")}finally{Gt(!1)}}},onCancel:()=>Yt(null)}),ms&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&xs(!1),role:"dialog","aria-modal":"true","aria-labelledby":"add-key-modal-title",children:t.jsxs("div",{className:"bg-bg-elevated border border-border-subtle rounded-xl p-6 max-w-md w-full shadow-2xl",children:[t.jsx("h3",{id:"add-key-modal-title",className:"type-subheading text-text-primary mb-4",children:"Add Transport Key"}),t.jsxs("div",{className:"space-y-4",children:[is&&t.jsxs("div",{className:"bg-accent-tertiary/10 border border-accent-tertiary/30 rounded-lg p-3 text-sm text-text-secondary",children:["Adding as child of: ",t.jsx("strong",{className:"text-text-primary",children:ra()})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Key Name"}),t.jsx("input",{type:"text",value:Ns,onChange:e=>ws(e.target.value),placeholder:"e.g., Region Name, Group Key",className:"w-full px-4 py-2 bg-bg-subtle border border-border-subtle rounded-lg text-text-primary placeholder-text-muted focus:outline-none focus:ring-2 focus:ring-accent-primary/50 transition-colors",onKeyDown:e=>"Enter"===e.key&&ca(),autoFocus:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Flood Policy"}),t.jsxs("div",{className:"flex bg-bg-subtle rounded-lg border border-border-subtle p-1",children:[t.jsx("button",{onClick:()=>_s("deny"),className:S("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","deny"===ks?"bg-accent-danger/20 text-accent-danger border border-accent-danger/50":"text-text-muted hover:text-text-secondary"),children:"DENY"}),t.jsx("button",{onClick:()=>_s("allow"),className:S("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","allow"===ks?"bg-accent-success/20 text-accent-success border border-accent-success/50":"text-text-muted hover:text-text-secondary"),children:"ALLOW"})]})]}),t.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[t.jsx("button",{onClick:()=>{xs(!1),ws(""),_s("deny")},disabled:Cs,className:"px-4 py-2 bg-bg-subtle hover:bg-bg-elevated text-text-secondary rounded-lg border border-border-subtle transition-colors disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:ca,disabled:Cs||!Ns.trim(),className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary rounded-lg border border-accent-primary/50 transition-colors disabled:opacity-50 flex items-center gap-2",children:Cs?t.jsxs(t.Fragment,{children:[t.jsx(l,{className:"w-4 h-4 animate-spin"}),"Adding..."]}):"Add Key"})]})]})]})}),ps&&ys&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&bs(!1),role:"dialog","aria-modal":"true","aria-labelledby":"edit-key-modal-title",children:t.jsxs("div",{className:"bg-bg-elevated border border-border-subtle rounded-xl p-6 max-w-md w-full shadow-2xl",children:[t.jsx("h3",{id:"edit-key-modal-title",className:"type-subheading text-text-primary mb-4",children:"Edit Transport Key"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Key Name"}),t.jsx("input",{type:"text",value:ys.name,onChange:e=>fs({...ys,name:e.target.value}),className:"w-full px-4 py-2 bg-bg-subtle border border-border-subtle rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary/50 transition-colors",autoFocus:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Flood Policy"}),t.jsxs("div",{className:"flex bg-bg-subtle rounded-lg border border-border-subtle p-1",children:[t.jsx("button",{onClick:()=>fs({...ys,floodPolicy:"deny"}),className:S("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","deny"===ys.floodPolicy?"bg-accent-danger/20 text-accent-danger border border-accent-danger/50":"text-text-muted hover:text-text-secondary"),children:"DENY"}),t.jsx("button",{onClick:()=>fs({...ys,floodPolicy:"allow"}),className:S("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","allow"===ys.floodPolicy?"bg-accent-success/20 text-accent-success border border-accent-success/50":"text-text-muted hover:text-text-secondary"),children:"ALLOW"})]})]}),ys.transport_key&&t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Transport Key"}),t.jsx("code",{className:"block bg-bg-subtle px-3 py-2 rounded-lg text-xs text-text-muted font-mono overflow-x-auto",children:ys.transport_key})]}),t.jsxs("div",{className:"flex justify-between gap-3 mt-6",children:[t.jsx("button",{onClick:()=>{bs(!1),vs(ys),gs(!0),fs(null)},disabled:Cs,className:"px-4 py-2 bg-accent-danger/20 hover:bg-accent-danger/30 text-accent-danger rounded-lg border border-accent-danger/50 transition-colors disabled:opacity-50",children:"Delete"}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:()=>{bs(!1),fs(null)},disabled:Cs,className:"px-4 py-2 bg-bg-subtle hover:bg-bg-elevated text-text-secondary rounded-lg border border-border-subtle transition-colors disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(ys){Ss(!0),as(null);try{const e=await async function(e,t){return T(`/api/transport_key/${e}`,{method:"PUT",body:JSON.stringify(t)})}(ys.id,{name:ys.name,flood_policy:ys.floodPolicy});e.success?(await sa(),bs(!1),fs(null)):as(e.error||"Failed to update transport key")}catch(e){as(e instanceof Error?e.message:"Failed to update transport key")}finally{Ss(!1)}}},disabled:Cs||!ys.name.trim(),className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary rounded-lg border border-accent-primary/50 transition-colors disabled:opacity-50 flex items-center gap-2",children:Cs?t.jsxs(t.Fragment,{children:[t.jsx(l,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):"Save"})]})]})]})]})}),hs&&js&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&gs(!1),role:"dialog","aria-modal":"true","aria-labelledby":"delete-key-modal-title",children:t.jsxs("div",{className:"bg-bg-elevated border border-border-subtle rounded-xl p-6 max-w-md w-full shadow-2xl",children:[t.jsx("h3",{id:"delete-key-modal-title",className:"type-subheading text-text-primary mb-4",children:"Delete Transport Key"}),t.jsxs("p",{className:"text-text-secondary mb-4",children:["Are you sure you want to delete ",t.jsxs("strong",{className:"text-text-primary",children:["'",js.name,"'"]}),"?"]}),js.children&&js.children.length>0&&t.jsx("div",{className:"bg-accent-secondary/10 border border-accent-secondary/30 rounded-lg p-3 mb-4",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx(N,{className:"w-4 h-4 text-accent-secondary flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"text-sm text-text-secondary",children:["This key has ",js.children.length," child key(s). Deleting will also remove all children."]})]})}),t.jsxs("div",{className:"flex justify-end gap-3",children:[t.jsx("button",{onClick:()=>{gs(!1),vs(null)},disabled:Cs,className:"px-4 py-2 bg-bg-subtle hover:bg-bg-elevated text-text-secondary rounded-lg border border-border-subtle transition-colors disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(js){Ss(!0),as(null);try{const e=await async function(e){return T(`/api/transport_key/${e}`,{method:"DELETE"})}(js.id);e.success?(await sa(),gs(!1),vs(null),os(null)):as(e.error||"Failed to delete transport key")}catch(e){as(e instanceof Error?e.message:"Failed to delete transport key")}finally{Ss(!1)}}},disabled:Cs,className:"px-4 py-2 bg-accent-danger/20 hover:bg-accent-danger/30 text-accent-danger rounded-lg border border-accent-danger/50 transition-colors disabled:opacity-50 flex items-center gap-2",children:Cs?t.jsxs(t.Fragment,{children:[t.jsx(l,{className:"w-4 h-4 animate-spin"}),"Deleting..."]}):"Delete"})]})]})})]})}export{ne as default};
