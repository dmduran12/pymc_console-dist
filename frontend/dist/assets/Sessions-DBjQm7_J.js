import{r as e,j as s}from"./vendor-react-alRNW2nb.js";import{c as a}from"./vendor-core-FtpmsTnh.js";import{d9 as t,da as l,bD as i,B as n,bV as d,aW as c}from"./index-CkRTgHHA.js";import{C as r}from"./ConfirmModal-B6Rz8ROW.js";import{D as o}from"./DataBox-DpDXI-WX.js";import{P as m,a as x,B as u,C as h}from"./PageLayout-BWMUVZgC.js";import{L as p,a as j,aX as y,U as f,bi as b,bj as g,a2 as N,bk as v,bl as w,bm as _,a3 as k,ae as C,b5 as S,j as A,as as L}from"./vendor-icons-TO0PZKGR.js";import{R,C as M}from"./Grid-m53vqd2Y.js";import"./vendor-virt-BytWoLhu.js";import"./cosmograph-DqYT4sUA.js";import"./vendor-charts-C916_-gs.js";import"./vendor-motion-DNp0Qg4F.js";import"./vendor-fonts-CRZaZSFf.js";const D=[{id:"overview",label:"Overview",icon:v},{id:"clients",label:"Authenticated Clients",icon:w},{id:"identities",label:"By Identity",icon:_}];function I(e){return e?new Date(1e3*e).toLocaleString():"Never"}function P(e){if(!e)return"Never";const s=Date.now()-1e3*e,a=Math.floor(s/6e4),t=Math.floor(s/36e5),l=Math.floor(s/864e5);return a<1?"Just now":a<60?`${a}m ago`:t<24?`${t}h ago`:l<365?`${l}d ago`:`${Math.floor(l/365)}y ago`}function F({label:e,value:a,icon:t}){return s.jsxs(h,{neomorphic:!0,children:[s.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-2 sm:mb-3",children:[t&&s.jsx("span",{className:"icon-sm text-icon-card-title",children:t}),s.jsx("span",{className:"type-micro",children:e})]}),s.jsx(c,{centered:!0,children:s.jsx("span",{className:"type-data-xl text-fg-primary font-mono font-normal tabular-nums",children:a})})]})}function K({identity:e}){const t="repeater"===e.type;return s.jsxs("div",{className:"bg-subtle-fill/80 radius-inner depth-stroke-raised p-4",children:[s.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-3",children:[s.jsx("span",{className:"icon-sm text-icon-card-title",children:t?s.jsx(S,{className:"w-4 h-4"}):s.jsx(A,{className:"w-4 h-4"})}),s.jsx("span",{className:"type-micro",children:e.name}),s.jsx(o,{copy:!0,size:"compact",truncate:[8,6],color:"text-fg-muted",children:e.hash}),s.jsx("span",{className:"data-box data-box-compact data-box-outlined ml-auto",style:{"--data-box-accent":t?"var(--sys-blue)":"var(--sys-pink)"},children:e.type})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"data-box-label",children:"Max Clients"}),s.jsx("div",{className:"data-box data-box-fill data-box-left",children:e.max_clients})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"data-box-label",children:"Authenticated"}),s.jsx("div",{className:"data-box data-box-fill data-box-left",children:e.authenticated_clients})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"data-box-label",children:"Admin Password"}),s.jsx("div",{className:"data-box data-box-fill data-box-left",style:{"--data-box-color":e.has_admin_password?"var(--sys-green)":"var(--sys-red)"},children:e.has_admin_password?"✓ Set":"✗ Not Set"})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"data-box-label",children:"Guest Password"}),s.jsx("div",{className:"data-box data-box-fill data-box-left",style:{"--data-box-color":e.has_guest_password?"var(--sys-green)":"var(--sys-red)"},children:e.has_guest_password?"✓ Set":"✗ Not Set"})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"data-box-label",children:"Read-Only Access"}),s.jsx("div",{className:a("data-box data-box-fill data-box-left",e.allow_read_only?"text-sys-green":"text-sys-red"),children:e.allow_read_only?"Allowed":"Disabled"})]})]})]})}function $({client:e,onRemove:t}){return s.jsx("div",{className:"bg-subtle-fill/80 radius-inner depth-stroke-raised p-4 transition-base hover:bg-subtle-fill-strong",children:s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[s.jsxs("div",{className:"flex-1 min-w-0 grid grid-cols-1 sm:grid-cols-5 gap-2 sm:gap-4 items-center",children:[s.jsxs("div",{className:"sm:col-span-1",children:[s.jsx("span",{className:"type-data-xs text-fg-muted block sm:hidden mb-0.5",children:"Client"}),s.jsx("span",{className:"type-data-sm text-fg-primary font-mono truncate block",children:e.public_key})]}),s.jsxs("div",{className:"sm:col-span-1",children:[s.jsx("span",{className:"type-data-xs text-fg-muted block sm:hidden mb-0.5",children:"Address"}),s.jsx("span",{className:"type-data-xs text-fg-muted font-mono truncate block",children:e.address})]}),s.jsxs("div",{className:"sm:col-span-1",children:[s.jsx("span",{className:"type-data-xs text-fg-muted block sm:hidden mb-0.5",children:"Identity"}),s.jsx("span",{className:"type-data-sm text-fg-primary block truncate",children:e.identity_name}),s.jsx("span",{className:"type-data-xs text-fg-muted block truncate",children:e.identity_hash})]}),s.jsxs("div",{className:"sm:col-span-1",children:[s.jsx("span",{className:"type-data-xs text-fg-muted block sm:hidden mb-0.5",children:"Permissions"}),s.jsx("span",{className:a("type-data-xs px-2 py-0.5 rounded-full font-medium inline-block","admin"===e.permissions?"bg-sys-green/15 text-sys-green":"bg-sys-amber/15 text-sys-amber"),children:e.permissions})]}),s.jsxs("div",{className:"sm:col-span-1",children:[s.jsx("span",{className:"type-data-xs text-fg-muted block sm:hidden mb-0.5",children:"Last Activity"}),s.jsx("span",{className:"type-data-xs text-fg-muted",children:P(e.last_activity)})]})]}),s.jsxs(n,{color:"danger",outline:!0,onClick:t,className:"flex-shrink-0",children:[s.jsx(L,{"data-slot":"icon"}),"Remove"]})]})})}function B({client:e,onRemove:t}){return s.jsx("div",{className:"bg-subtle-fill/80 radius-inner depth-stroke-raised p-4 transition-base hover:bg-subtle-fill-strong",children:s.jsxs("div",{className:"flex items-start justify-between gap-3",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("span",{className:a("type-data-xs px-2 py-0.5 rounded-full font-medium","admin"===e.permissions?"bg-sys-green/15 text-sys-green":"bg-sys-amber/15 text-sys-amber"),children:e.permissions}),s.jsx("span",{className:"type-data-sm text-fg-primary font-mono truncate",children:e.public_key})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-fg-muted",children:"Address: "}),s.jsx("span",{className:"text-fg-primary/90 font-mono",children:e.address})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-fg-muted",children:"Identity: "}),s.jsxs("span",{className:"text-fg-primary/90",children:[e.identity_name," (",e.identity_hash,")"]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-fg-muted",children:"Last Activity: "}),s.jsx("span",{className:"text-fg-primary/90",children:I(e.last_activity)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-fg-muted",children:"Last Login: "}),s.jsx("span",{className:"text-fg-primary/90",children:I(e.last_login_success)})]})]})]}),s.jsx(n,{color:"danger",outline:!0,onClick:t,className:"flex-shrink-0",children:s.jsx(L,{"data-slot":"icon"})})]})})}function G(){const[c,o]=e.useState("overview"),[v,w]=e.useState(!0),[_,S]=e.useState(!1),[A,L]=e.useState("idle"),[I,P]=e.useState(null),[G,E]=e.useState(null),[H,O]=e.useState([]),[T,U]=e.useState(null),[z,J]=e.useState(null),[V,W]=e.useState(null),[X,q]=e.useState(!1),Q=(null==G?void 0:G.acls)??[],Y=e.useMemo(()=>z?H.filter(e=>e.identity_name===z):H,[H,z]),Z=e.useCallback(async()=>{P(null);try{const[e,s,a]=await Promise.all([t(),l(),i()]);e.success&&e.data&&E(e.data),s.success&&s.data&&O(s.data.clients||[]),a.success&&a.data&&U(a.data)}catch(e){P(e instanceof Error?e.message:"Failed to load session data")}},[]);e.useEffect(()=>{Z().finally(()=>w(!1))},[Z]);const ee=async()=>{S(!0),L("loading"),await Z(),S(!1),L("success"),setTimeout(()=>L("idle"),1500)};return s.jsxs(m,{children:[s.jsx(x,{title:"Sessions",icon:s.jsx(f,{}),controls:s.jsxs(n,{color:"success"===A?"success":"primary",outline:!0,onClick:ee,disabled:_,children:["loading"===A?s.jsx(p,{"data-slot":"icon",className:"animate-spin"}):"success"===A?s.jsx(j,{"data-slot":"icon"}):s.jsx(y,{"data-slot":"icon"}),"success"===A?"Done":"Refresh"]}),subtitle:s.jsx("p",{className:"type-body-sm text-fg-muted",children:"Manage authenticated clients and access control lists"})}),s.jsxs(u,{children:[T&&s.jsxs(R,{template:"widget",children:[s.jsx(M,{span:6,md:3,children:s.jsx(F,{label:"Identities",value:T.total_identities,icon:s.jsx(f,{className:"w-4 h-4"})})}),s.jsx(M,{span:6,md:3,children:s.jsx(F,{label:"Authenticated",value:T.total_clients,icon:s.jsx(b,{className:"w-4 h-4"})})}),s.jsx(M,{span:6,md:3,children:s.jsx(F,{label:"Admin",value:T.admin_clients,icon:s.jsx(g,{className:"w-4 h-4"})})}),s.jsx(M,{span:6,md:3,children:s.jsx(F,{label:"Guest",value:T.guest_clients,icon:s.jsx(N,{className:"w-4 h-4"})})})]}),s.jsx(R,{template:"auto",children:s.jsxs(h,{neomorphic:!0,children:[s.jsx("div",{className:"flex flex-wrap gap-1 mb-5",children:s.jsx("div",{className:"toggle-group",children:D.map(e=>{const t=c===e.id;return s.jsxs("button",{onClick:()=>o(e.id),className:a("toggle-group-item flex items-center gap-1.5",t&&"active"),children:[s.jsx(e.icon,{className:"w-3.5 h-3.5"}),e.label]},e.id)})})}),s.jsx("div",{className:"min-h-[300px]",children:v?s.jsxs("div",{className:"flex items-center justify-center py-12",children:[s.jsx(p,{className:"w-6 h-6 animate-spin text-sys-blue mr-3"}),s.jsx("span",{className:"type-body text-fg-muted",children:"Loading session data..."})]}):I?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"w-12 h-12 rounded-full bg-sys-red/10 mx-auto mb-3 flex items-center justify-center",children:s.jsx(k,{className:"w-6 h-6 text-sys-red"})}),s.jsx("p",{className:"type-body text-sys-red mb-2",children:"Failed to load session data"}),s.jsx("p",{className:"type-body-sm text-fg-muted mb-4",children:I}),s.jsx(n,{color:"primary",outline:!0,onClick:ee,children:"Retry"})]}):s.jsxs(s.Fragment,{children:["overview"===c&&s.jsx("div",{className:"space-y-4",children:0===Q.length?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"w-14 h-14 rounded-full bg-subtle-fill mx-auto mb-4 flex items-center justify-center",children:s.jsx(g,{className:"w-7 h-7 text-fg-muted/50"})}),s.jsx("p",{className:"type-body text-fg-muted",children:"No identities configured"})]}):Q.map(e=>s.jsx(K,{identity:e},e.hash))}),"clients"===c&&s.jsxs("div",{className:"space-y-3",children:[H.length>0&&s.jsxs("div",{className:"hidden sm:grid grid-cols-5 gap-4 px-4 pb-2 border-b border-edge-subtle",children:[s.jsx("span",{className:"type-data-xs text-fg-muted font-medium",children:"Client"}),s.jsx("span",{className:"type-data-xs text-fg-muted font-medium",children:"Address"}),s.jsx("span",{className:"type-data-xs text-fg-muted font-medium",children:"Identity"}),s.jsx("span",{className:"type-data-xs text-fg-muted font-medium",children:"Permissions"}),s.jsx("span",{className:"type-data-xs text-fg-muted font-medium",children:"Last Activity"})]}),0===H.length?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"w-14 h-14 rounded-full bg-subtle-fill mx-auto mb-4 flex items-center justify-center",children:s.jsx(f,{className:"w-7 h-7 text-fg-muted/50"})}),s.jsx("p",{className:"type-body text-fg-muted",children:"No authenticated clients"})]}):H.map(e=>s.jsx($,{client:e,onRemove:()=>W({publicKey:e.public_key_full,identityHash:e.identity_hash,displayKey:e.public_key})},e.public_key_full))]}),"identities"===c&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-fg-muted block mb-2",children:"Filter by Identity"}),s.jsxs("select",{value:z??"",onChange:e=>J(e.target.value||null),className:"w-full sm:w-auto bg-subtle-fill border border-edge-subtle radius-inner px-4 py-2 type-data text-fg-primary focus:outline-none focus:border-sys-blue/50 transition-colors",children:[s.jsx("option",{value:"",children:"All Identities"}),Q.map(e=>s.jsxs("option",{value:e.name,children:[e.name," (",e.authenticated_clients," clients)"]},e.name))]})]}),0===Y.length?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"w-14 h-14 rounded-full bg-subtle-fill mx-auto mb-4 flex items-center justify-center",children:s.jsx(C,{className:"w-7 h-7 text-fg-muted/50"})}),s.jsx("p",{className:"type-body text-fg-muted",children:z?"No clients for selected identity":"No clients found"})]}):s.jsx("div",{className:"space-y-3",children:Y.map(e=>s.jsx(B,{client:e,onRemove:()=>W({publicKey:e.public_key_full,identityHash:e.identity_hash,displayKey:e.public_key})},e.public_key_full))})]})]})})]})})]}),s.jsx(r,{isOpen:!!V,title:"Remove Client",message:`Are you sure you want to remove client '${null==V?void 0:V.displayKey}' from the ACL? This will disconnect the client.`,confirmLabel:X?"Removing...":"Remove",cancelLabel:"Cancel",variant:"danger",onConfirm:async()=>{if(V){q(!0);try{const e=await d({public_key:V.publicKey,identity_hash:V.identityHash});e.success?await Z():P(`Failed to remove client: ${e.error}`)}catch(e){P(e instanceof Error?e.message:"Failed to remove client")}finally{q(!1),W(null)}}},onCancel:()=>W(null)})]})}export{G as default};
