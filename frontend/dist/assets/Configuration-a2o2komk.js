import{c as e,ae as t,af as s,ag as a,j as r,I as n,ah as l,ai as c,aj as i,ak as d,X as o,al as u,B as m,am as x,R as p,ac as h,an as b,ao as y,ap as g,aq as f,ar as j,as as v,at as N,au as w,av as k}from"./index-BA-LoFOy.js";import{b as C,c as _}from"./recharts-bmHCCfxU.js";import{H as S}from"./HashBadge-BX0s8Pc9.js";import{T,C as F}from"./ConfirmModal-COfgVhTb.js";import{P as E,a as L,C as M,b as P}from"./PageLayout-BVrxHani.js";import{R,C as z}from"./Grid-BKQGLyxW.js";import{L as A}from"./loader-circle-DJ5Po0GD.js";import{a as I,T as D,C as H}from"./triangle-alert-SBaK73du.js";import{I as O}from"./info-C4_AIqlt.js";import{E as q}from"./external-link-BLo2cySe.js";import{R as K}from"./refresh-cw-Di1wuK5R.js";import{C as V}from"./chevron-right-BHoe2xfV.js";import"./maplibre-gl-CFO9X1Ek.js";const $=e("antenna",[["path",{d:"M2 12 7 2",key:"117k30"}],["path",{d:"m7 12 5-10",key:"1tvx22"}],["path",{d:"m12 12 5-10",key:"ev1o1a"}],["path",{d:"m17 12 5-10",key:"1e4ti3"}],["path",{d:"M4.5 7h15",key:"vlsxkz"}],["path",{d:"M12 16v6",key:"c8a4gj"}]]),B=e("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Y=e("folder-key",[["circle",{cx:"16",cy:"20",r:"2",key:"1vifvg"}],["path",{d:"M10 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v2",key:"3hgo9p"}],["path",{d:"m22 14-4.5 4.5",key:"1ef6z8"}],["path",{d:"m21 15 1 1",key:"1ejcpy"}]]),U=e("folder-lock",[["rect",{width:"8",height:"5",x:"14",y:"17",rx:"1",key:"19aais"}],["path",{d:"M10 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v2.5",key:"1w6v7t"}],["path",{d:"M20 17v-2a2 2 0 1 0-4 0v2",key:"pwaxnr"}]]),X=e("key-round",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]),G=e("monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),W=e("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),J=e("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Q=e("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Z=e("shield-x",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m14.5 9.5-5 5",key:"17q4r4"}],["path",{d:"m9.5 9.5 5 5",key:"18nt4w"}]]),ee=C.memo(function({showLogoOnly:e=!1,showThumbnailsOnly:n=!1}){const{theme:l,setThemePreset:c,setBrightness:i}=t(),{backgroundImage:d,brightness:o}=l,[u,m]=C.useState(!1),[x,p]=C.useState(!1),h=C.useRef(null),b=C.useRef(null),y=s.find(e=>e.backgroundImage===d)??s[0],g=y.id,f=C.useCallback((e,t)=>{if(!b.current)return o;const s=(b.current.y-e)/(t?200:80)*100;return Math.round(Math.max(0,Math.min(100,b.current.brightness+s)))},[o]),j=C.useCallback(e=>{c(e),m(!0)},[c]),v=C.useCallback(e=>{i(e)},[i]),N=C.useCallback(e=>{const t=s.find(t=>t.id===e);t&&a(t.backgroundImage)},[]);if(e){const e=y.displaySize,t=`clamp(${.8*e}rem, ${.6*e}rem + 1.5vw, ${1.4*e}rem)`;return r.jsx("span",{className:"font-medium transition-all duration-300 leading-none",style:{fontFamily:y.displayFont,color:y.displayColor,fontSize:t,fontOpticalSizing:"auto",letterSpacing:"-0.03em"},children:y.displayName})}return r.jsx("div",{className:"flex gap-2 items-start flex-shrink-0",children:s.map(e=>{const t=g===e.id,s=t&&(u||x);return r.jsxs("div",{ref:t?h:void 0,title:e.displayName,className:_("flex flex-col items-center gap-1 p-0.5 rounded-sm transition-all duration-300 ease-out",t?"ring-2 ring-accent-primary scale-105 cursor-ns-resize":"cursor-pointer"),onMouseEnter:()=>{t?m(!0):N(e.id)},onMouseLeave:()=>!x&&m(!1),onClick:()=>!t&&j(e.id),onTouchStart:e=>{if(!t)return;e.preventDefault();const s=e.touches[0];b.current={y:s.clientY,brightness:o},p(!0),m(!0);const a=e=>{e.preventDefault();const t=e.touches[0];v(f(t.clientY,!0))},r=()=>{document.removeEventListener("touchmove",a),document.removeEventListener("touchend",r),b.current=null,p(!1),setTimeout(()=>m(!1),1500)};document.addEventListener("touchmove",a,{passive:!1}),document.addEventListener("touchend",r)},onMouseDown:e=>{if(!t)return;e.preventDefault(),b.current={y:e.clientY,brightness:o},p(!0),m(!0);const s=e=>{v(f(e.clientY,!1))},a=()=>{document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",a),b.current=null,p(!1)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",a)},children:[r.jsxs("div",{className:"glass-thumbnail w-10 h-10",children:[r.jsx("div",{className:"absolute bg-cover bg-center transition-opacity duration-200",style:{inset:0,backgroundImage:`url(${e.backgroundImage})`,opacity:s?.4:1}}),t&&r.jsxs("div",{className:_("absolute inset-0 transition-opacity duration-200",s?"opacity-100":"opacity-0"),children:[r.jsx("div",{className:"absolute inset-x-0 bottom-0 bg-black/70 transition-all duration-100 ease-out",style:{height:100-o+"%"}}),r.jsx("div",{className:"absolute inset-x-1 h-0.5 bg-white rounded-full shadow-lg transition-all duration-100 ease-out",style:{top:100-o+"%"}}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:r.jsxs("span",{className:"text-[10px] font-mono font-bold text-white drop-shadow-lg",children:[o,"%"]})})]})]}),r.jsx("div",{className:"flex flex-col gap-0.5",children:e.paletteColors.map((e,t)=>r.jsx("div",{className:"flex gap-0.5 justify-center",children:e.map((e,t)=>r.jsx("div",{className:"w-1.5 h-1.5 rounded-xs",style:{backgroundColor:e}},t))},t))})]},e.id)})})}),te=[{value:7.8,label:"7.8 kHz"},{value:10.4,label:"10.4 kHz"},{value:15.6,label:"15.6 kHz"},{value:20.8,label:"20.8 kHz"},{value:31.25,label:"31.25 kHz"},{value:41.7,label:"41.7 kHz"},{value:62.5,label:"62.5 kHz"},{value:125,label:"125 kHz"},{value:250,label:"250 kHz"},{value:500,label:"500 kHz"}],se=[5,6,7,8,9,10,11,12],ae=[{value:5,label:"4/5"},{value:6,label:"4/6"},{value:7,label:"4/7"},{value:8,label:"4/8"}];function re(){var e,t,s,a,re,ne;const{stats:le,setMode:ce,clearModeMutation:ie,setDutyCycleConfig:de,clearDutyCycleMutation:oe,fetchStats:ue}=n(),me=null==(e=null==le?void 0:le.config)?void 0:e.radio,xe=null==(t=null==le?void 0:le.config)?void 0:t.repeater,pe=null==(s=null==le?void 0:le.config)?void 0:s.duty_cycle,he=(null==le?void 0:le.node_name)||(null==(a=null==le?void 0:le.config)?void 0:a.node_name)||"Unknown Node",be=(null==xe?void 0:xe.mode)??"forward",ye=(null==pe?void 0:pe.enforcement_enabled)??!1,ge=null==(re=null==le?void 0:le.config)?void 0:re.delays,[fe,je]=C.useState(!1),[ve,Ne]=C.useState(""),[we,ke]=C.useState(62.5),[Ce,_e]=C.useState(7),[Se,Te]=C.useState(5),[Fe,Ee]=C.useState(""),[Le,Me]=C.useState("idle"),[Pe,Re]=C.useState(null),ze=C.useRef(null),Ae=C.useRef(null),Ie=C.useRef(null),[De,He]=C.useState("idle"),[Oe,qe]=C.useState("idle"),[Ke,Ve]=C.useState(null),[$e,Be]=C.useState(null),Ye=C.useRef(!0),Ue=C.useRef(null),Xe=C.useRef(null),Ge=C.useRef(null),We=C.useRef(null),Je=C.useRef(!1),Qe=C.useRef(!1);C.useEffect(()=>(Ye.current=!0,()=>{Ye.current=!1,Ue.current&&clearTimeout(Ue.current),Xe.current&&clearTimeout(Xe.current),Ge.current&&clearTimeout(Ge.current),We.current&&clearTimeout(We.current),Lt.current&&clearTimeout(Lt.current),Mt.current&&clearTimeout(Mt.current),Ae.current&&clearTimeout(Ae.current),dt.current&&clearTimeout(dt.current),Ct.current&&clearTimeout(Ct.current)}),[]);const[Ze,et]=C.useState(!1),[tt,st]=C.useState(""),[at,rt]=C.useState(""),[nt,lt]=C.useState(""),[ct,it]=C.useState("idle"),dt=C.useRef(null),[ot,ut]=C.useState(!1),[mt,xt]=C.useState(""),[pt,ht]=C.useState(""),[bt,yt]=C.useState(""),[gt,ft]=C.useState(""),[jt,vt]=C.useState("idle"),[Nt,wt]=C.useState(null),kt=C.useRef(null),Ct=C.useRef(null),_t=null==(ne=null==le?void 0:le.config)?void 0:ne.web,[St,Tt]=C.useState("idle"),[Ft,Et]=C.useState(null),Lt=C.useRef(null),Mt=C.useRef(null),Pt=C.useRef(!1),[Rt,zt]=C.useState([]),[At,It]=C.useState(!1),[Dt,Ht]=C.useState(null),[Ot,qt]=C.useState(!1),[Kt,Vt]=C.useState(""),[$t,Bt]=C.useState(null),[Yt,Ut]=C.useState(!1),[Xt,Gt]=C.useState(null),[Wt,Jt]=C.useState(!1),[Qt,Zt]=C.useState(!1),[es,ts]=C.useState(!1),[ss,as]=C.useState([]),[rs,ns]=C.useState(!1),[ls,cs]=C.useState(null),[is,ds]=C.useState("deny"),[os,us]=C.useState(!1),[ms,xs]=C.useState(null),[ps,hs]=C.useState(new Set),[bs,ys]=C.useState(!1),[gs,fs]=C.useState(!1),[js,vs]=C.useState(!1),[Ns,ws]=C.useState(null),[ks,Cs]=C.useState(null),[_s,Ss]=C.useState(""),[Ts,Fs]=C.useState("deny"),[Es,Ls]=C.useState(!1),[Ms,Ps]=C.useState(!0),[Rs,zs]=C.useState(!1),[As,Is]=C.useState(!0),[Ds,Hs]=C.useState("idle"),[Os,qs]=C.useState(!1),[Ks,Vs]=C.useState(!1);C.useEffect(()=>{me&&fe&&(Ne((me.frequency/1e6).toFixed(3)),ke(me.bandwidth/1e3),_e(me.spreading_factor),Te(me.coding_rate),Ee(String(me.tx_power)))},[me,fe]);const $s=C.useMemo(()=>{if(!me||!fe)return!1;const e=me.frequency/1e6,t=me.bandwidth/1e3,s=parseFloat(ve)||0;return Math.abs(s-e)>1e-4||we!==t||Ce!==me.spreading_factor||Se!==me.coding_rate||parseInt(Fe)!==me.tx_power},[me,fe,ve,we,Ce,Se,Fe]),Bs=C.useCallback(()=>{je(!1),Re(null),me&&(Ne((me.frequency/1e6).toFixed(3)),ke(me.bandwidth/1e3),_e(me.spreading_factor),Te(me.coding_rate),Ee(String(me.tx_power)))},[me]);C.useEffect(()=>{if(!fe)return;const e=e=>{ze.current&&!ze.current.contains(e.target)&&Bs()};return document.addEventListener("mouseup",e),()=>{document.removeEventListener("mouseup",e)}},[fe,Bs]);const Ys=C.useCallback(()=>{const e=null==ge?void 0:ge.tx_delay_factor;return e&&"object"==typeof e&&"parsedValue"in e?e.parsedValue??1:"number"==typeof e?e:1},[ge]),Us=C.useCallback(()=>{const e=null==ge?void 0:ge.direct_tx_delay_factor;return"number"==typeof e?e:.5},[ge]),Xs=C.useCallback(()=>{const e=null==pe?void 0:pe.max_airtime_percent;return"number"==typeof e?e:e&&"object"==typeof e&&"parsedValue"in e?e.parsedValue??6:6},[pe]),Gs=C.useCallback(()=>{st(Ys().toFixed(2)),rt(Us().toFixed(2)),lt(Xs().toFixed(1)),et(!0)},[Ys,Us,Xs]),Ws=C.useCallback(()=>{et(!1)},[]);C.useEffect(()=>{if(!Ze)return;const e=e=>{Ie.current&&!Ie.current.contains(e.target)&&Ws()};return document.addEventListener("mouseup",e),()=>document.removeEventListener("mouseup",e)},[Ze,Ws]);const Js=C.useCallback(()=>{var e,t,s;xt(he),ht((null==(e=null==xe?void 0:xe.latitude)?void 0:e.toString())||"0"),yt((null==(t=null==xe?void 0:xe.longitude)?void 0:t.toString())||"0"),ft((null==(s=null==xe?void 0:xe.send_advert_interval_hours)?void 0:s.toString())||"0"),wt(null),ut(!0)},[he,xe]),Qs=C.useCallback(()=>{ut(!1),wt(null)},[]);C.useEffect(()=>{if(!ot)return;const e=e=>{kt.current&&!kt.current.contains(e.target)&&Qs()};return document.addEventListener("mouseup",e),()=>document.removeEventListener("mouseup",e)},[ot,Qs]);const Zs=async()=>{var e;if("loading"===St)return;const t=(null==_t?void 0:_t.cors_enabled)??!1,s=!t,a=t;Lt.current&&clearTimeout(Lt.current),Mt.current&&clearTimeout(Mt.current),Pt.current=!1,Et(s),Tt("loading"),Lt.current=setTimeout(()=>{Pt.current||Ye.current&&(Et(a),Tt("error"),Mt.current=setTimeout(()=>{Ye.current&&(Tt("idle"),Et(null))},2e3))},1e4);try{const t=await b({web:{cors_enabled:s}});if(Pt.current=!0,Lt.current&&clearTimeout(Lt.current),!Ye.current)return;t.success||(null==(e=t.data)?void 0:e.persisted)?(await ue(),Tt("success"),Mt.current=setTimeout(()=>{Ye.current&&(Tt("idle"),Et(null))},2e3)):(Et(a),Tt("error"),Mt.current=setTimeout(()=>{Ye.current&&(Tt("idle"),Et(null))},2e3))}catch{if(Pt.current=!0,Lt.current&&clearTimeout(Lt.current),!Ye.current)return;Et(a),Tt("error"),Mt.current=setTimeout(()=>{Ye.current&&(Tt("idle"),Et(null))},2e3)}};C.useEffect(()=>{(async()=>{Is(!0);try{const e=await y();e.success&&e.data?zs(e.data.exists):zs(!1);const t=null==_t?void 0:_t.web_path;Ps(!t||""===t)}catch{zs(!1)}finally{Is(!1)}})()},[null==_t?void 0:_t.web_path]);const ea=async e=>{var t;if("loading"!==Ds){Hs("loading");try{const s=await b({web:{web_path:e?null:"/opt/pymc_console/web/html"}});if(!Ye.current)return;s.success||(null==(t=s.data)?void 0:t.persisted)?(Ps(e),Hs("success"),qs(!0),setTimeout(()=>{Ye.current&&Hs("idle")},2e3)):(Hs("error"),setTimeout(()=>{Ye.current&&Hs("idle")},2e3))}catch{if(!Ye.current)return;Hs("error"),setTimeout(()=>{Ye.current&&Hs("idle")},2e3)}}},ta=C.useCallback(async()=>{It(!0),Ht(null);try{const e=await l();zt(e.tokens||[])}catch(e){Ht(e instanceof Error?e.message:"Failed to fetch tokens")}finally{It(!1)}},[]);C.useEffect(()=>{ta()},[ta]);const sa=async()=>{if(Kt.trim()){Jt(!0),Ht(null);try{const e=await f(Kt.trim());Bt(e.token||null),qt(!1),Ut(!0),Vt(""),await ta()}catch(e){Ht(e instanceof Error?e.message:"Failed to create token")}finally{Jt(!1)}}else Ht("Token name is required")},aa=e=>e?new Date(1e3*e).toLocaleString():"Never",ra=C.useCallback(e=>{const t=new Map,s=[];return e.forEach(e=>{const s={id:e.id,name:e.name,floodPolicy:e.flood_policy,transport_key:e.transport_key,last_used:e.last_used,parent_id:e.parent_id,children:[]};t.set(e.id,s)}),t.forEach(e=>{e.parent_id&&t.has(e.parent_id)?t.get(e.parent_id).children.push(e):s.push(e)}),s},[]),na=C.useCallback(async()=>{ns(!0),cs(null);try{const e=await c();e.success&&e.data?as(ra(e.data)):cs(e.error||"Failed to load transport keys")}catch(e){cs(e instanceof Error?e.message:"Unknown error occurred")}finally{ns(!1)}},[ra]);C.useEffect(()=>{na()},[na]);const la=C.useCallback((e,t)=>{for(const s of e){if(s.id===t)return s;if(s.children){const e=la(s.children,t);if(e)return e}}return null},[]),ca=C.useCallback(()=>{if(!ms)return;const e=la(ss,ms);return null==e?void 0:e.name},[ms,ss,la]),ia=C.useCallback(e=>{hs(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[]),da=async e=>{us(!0),cs(null);try{const t=await v("allow"===e);t.success?ds(e):cs(t.error||"Failed to update global flood policy")}catch(t){cs(t instanceof Error?t.message:"Failed to update global flood policy")}finally{us(!1)}},oa=async()=>{if(_s.trim()){Ls(!0),cs(null);try{const e=await N({name:_s.trim(),flood_policy:Ts,parent_id:ms??void 0});e.success?(await na(),ys(!1),Ss(""),Fs("deny")):cs(e.error||"Failed to add transport key")}catch(e){cs(e instanceof Error?e.message:"Failed to add transport key")}finally{Ls(!1)}}else cs("Key name is required")},ua=C.useCallback(()=>{if(!ms)return;const e=la(ss,ms);e&&(ws({...e}),fs(!0))},[ms,ss,la]);C.useEffect(()=>{const e=e=>{"Escape"===e.key&&(bs&&(ys(!1),Ss(""),Fs("deny")),gs&&(fs(!1),ws(null)),js&&(vs(!1),Cs(null)),Ot&&(qt(!1),Vt("")),Yt&&(Ut(!1),Bt(null)))};if(bs||gs||js||Ot||Yt)return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[bs,gs,js,Ot,Yt]);const ma=C.useCallback(()=>{if(!ms)return;const e=la(ss,ms);e&&(Cs(e),vs(!0))},[ms,ss,la]),xa=({node:e,level:t})=>{const s=ps.has(e.id),a=ms===e.id,n=e.children&&e.children.length>0,l="allow"===is;return r.jsxs("div",{children:[r.jsxs("div",{className:_("flex items-center gap-2 h-[36px] px-3 rounded-full cursor-pointer transition-colors",a?"bg-accent-primary/15":"hover:bg-white/[0.02]",l&&"opacity-50 cursor-not-allowed"),style:{marginLeft:16*t+"px"},onClick:()=>!l&&xs(e.id),children:[n?r.jsx("button",{onClick:t=>{t.stopPropagation(),ia(e.id)},className:"p-1 hover:bg-white/[0.05] rounded-full transition-colors",children:r.jsx(V,{className:_("w-3.5 h-3.5 text-text-muted transition-transform",s&&"rotate-90")})}):r.jsx("span",{className:"w-5"}),r.jsx(Y,{className:"w-4 h-4 text-accent-primary flex-shrink-0"}),r.jsx("span",{className:"type-data text-text-primary flex-1 truncate",children:e.name}),r.jsx("span",{className:_("type-data-xs px-2 py-0.5 rounded-full","allow"===e.floodPolicy?"bg-accent-success/15 text-accent-success":"bg-accent-danger/15 text-accent-danger"),children:"allow"===e.floodPolicy?"Allow":"Deny"})]}),n&&s&&r.jsx("div",{children:e.children.map(e=>r.jsx(xa,{node:e,level:t+1},e.id))})]})};return r.jsxs(E,{children:[r.jsx(L,{title:"Configuration",icon:r.jsx(i,{})}),r.jsxs(R,{template:"standard",children:[r.jsx(z,{span:12,md:6,children:r.jsx(M,{children:r.jsxs("div",{ref:kt,children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("h2",{className:"type-subheading text-text-primary flex items-center gap-2",children:[r.jsx(d,{className:"icon-md text-accent-primary"}),"Repeater Settings"]}),r.jsx("div",{className:"flex items-center gap-1",children:xe&&(ot?r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:Qs,disabled:"loading"===jt,className:_("p-2 rounded-lg transition-colors","loading"===jt?"text-text-muted cursor-not-allowed":"text-text-muted hover:text-accent-danger hover:bg-accent-danger/10"),title:"Cancel",children:r.jsx(o,{className:"w-4 h-4"})}),r.jsx("button",{onClick:async()=>{if("loading"!==jt){Ct.current&&clearTimeout(Ct.current),vt("loading"),wt(null);try{const e={};mt&&mt!==he&&(e.node_name=mt);const t=parseFloat(pt);isNaN(t)||t===(null==xe?void 0:xe.latitude)||(e.latitude=t);const s=parseFloat(bt);isNaN(s)||s===(null==xe?void 0:xe.longitude)||(e.longitude=s);const a=parseInt(gt);if(isNaN(a)||a===(null==xe?void 0:xe.send_advert_interval_hours)||(e.flood_advert_interval_hours=a),0===Object.keys(e).length)return wt({success:!0,message:"No changes to save"}),void vt("idle");const r=await h(e);if(!Ye.current)return;if(r.success&&r.data){const e=r.data.applied.join(", ");wt({success:!0,message:`Updated: ${e}`}),await ue(),vt("success"),Ct.current=setTimeout(()=>{Ye.current&&(vt("idle"),ut(!1),wt(null))},1500)}else wt({success:!1,message:r.error||"Failed to save"}),vt("error"),Ct.current=setTimeout(()=>{Ye.current&&vt("idle")},2e3)}catch(e){if(!Ye.current)return;wt({success:!1,message:String(e)}),vt("error"),Ct.current=setTimeout(()=>{Ye.current&&vt("idle")},2e3)}}},disabled:"loading"===jt,className:_("p-2 rounded-lg transition-colors","loading"===jt?"text-accent-primary cursor-wait":"success"===jt?"text-accent-success":"error"===jt?"text-accent-danger":"text-accent-success hover:bg-accent-success/10"),title:"Save changes",children:"loading"===jt?r.jsx(A,{className:"w-4 h-4 animate-spin"}):"success"===jt?r.jsx(I,{className:"w-4 h-4"}):"error"===jt?r.jsx(o,{className:"w-4 h-4"}):r.jsx(I,{className:"w-4 h-4"})})]}):r.jsx("button",{onClick:Js,className:"p-2 rounded-lg transition-colors text-text-muted hover:text-text-primary hover:bg-bg-subtle",title:"Edit repeater settings",children:r.jsx(W,{className:"w-4 h-4"})}))})]}),Nt&&r.jsx("div",{className:_("text-xs mb-3 px-2 py-1.5 rounded-md",Nt.success?"text-accent-success bg-accent-success/10":"text-accent-danger bg-accent-danger/10"),children:Nt.message}),xe?r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{className:"col-span-2",children:[r.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Node Name"}),r.jsx("div",{className:_("h-[38px] rounded-full px-4 flex items-center transition-colors",ot?"bg-white/5":"bg-white/[0.02]"),children:ot?r.jsx("input",{type:"text",value:mt,onChange:e=>xt(e.target.value),maxLength:50,className:"w-full bg-transparent text-text-primary focus:outline-none type-data",placeholder:"Enter node name"}):r.jsx("span",{className:"type-data text-text-primary",children:he})})]}),r.jsxs("div",{children:[r.jsx("label",{className:"type-label text-text-muted block mb-1",children:ot?"Latitude (°)":"Latitude"}),r.jsx("div",{className:_("h-[38px] rounded-full px-4 flex items-center transition-colors",ot?"bg-white/5":"bg-white/[0.02]"),children:ot?r.jsx("input",{type:"number",value:pt,onChange:e=>ht(e.target.value),step:"0.000001",min:"-90",max:"90",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):r.jsx("span",{className:"type-data text-text-primary",children:0!==xe.latitude?xe.latitude.toFixed(6):"Not set"})})]}),r.jsxs("div",{children:[r.jsx("label",{className:"type-label text-text-muted block mb-1",children:ot?"Longitude (°)":"Longitude"}),r.jsx("div",{className:_("h-[38px] rounded-full px-4 flex items-center transition-colors",ot?"bg-white/5":"bg-white/[0.02]"),children:ot?r.jsx("input",{type:"number",value:bt,onChange:e=>yt(e.target.value),step:"0.000001",min:"-180",max:"180",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):r.jsx("span",{className:"type-data text-text-primary",children:0!==xe.longitude?xe.longitude.toFixed(6):"Not set"})})]}),r.jsxs("div",{children:[r.jsx("label",{className:"type-label text-text-muted block mb-1",children:ot?"Advert Interval (hours)":"Advert Interval"}),r.jsx("div",{className:_("h-[38px] rounded-full px-4 flex items-center transition-colors",ot?"bg-white/5":"bg-white/[0.02]"),children:ot?r.jsx("input",{type:"number",value:gt,onChange:e=>ft(e.target.value),min:"0",max:"48",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):r.jsx("span",{className:"type-data text-text-primary",children:xe.send_advert_interval_hours>0?`${xe.send_advert_interval_hours}h`:"Disabled"})}),ot&&r.jsx("p",{className:"type-data-xs text-text-muted mt-1 ml-4",children:"0 = disabled, 3-48 hours"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Score-based TX"}),r.jsx("div",{className:"h-[38px] rounded-full px-4 flex items-center bg-white/[0.02]",children:r.jsx("span",{className:"type-data text-text-primary",children:xe.use_score_for_tx?"Enabled":"Disabled"})})]})]}):r.jsx("p",{className:"text-text-muted",children:"Loading repeater settings..."})]})})}),r.jsx(z,{span:12,md:6,children:r.jsx(M,{children:r.jsxs("div",{ref:ze,children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("h2",{className:"type-subheading text-text-primary flex items-center gap-2",children:[r.jsx($,{className:"icon-md text-accent-primary"}),"Radio Configuration"]}),r.jsx("div",{className:"flex items-center gap-1",children:me&&(fe?r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:Bs,disabled:"loading"===Le,className:_("p-2 rounded-lg transition-colors","loading"===Le?"text-text-muted cursor-not-allowed":"text-text-muted hover:text-accent-danger hover:bg-accent-danger/10"),title:"Cancel",children:r.jsx(o,{className:"w-4 h-4"})}),r.jsx("button",{onClick:async()=>{if("loading"!==Le){Ae.current&&clearTimeout(Ae.current),Me("loading"),Re(null);try{const e={},t=parseFloat(ve),s=me?me.frequency/1e6:0;Math.abs(t-s)>1e-4&&(e.frequency_mhz=t);const a=me?me.bandwidth/1e3:0;we!==a&&(e.bandwidth_khz=we),Ce!==(null==me?void 0:me.spreading_factor)&&(e.spreading_factor=Ce),Se!==(null==me?void 0:me.coding_rate)&&(e.coding_rate=Se);const r=parseInt(Fe);if(r!==(null==me?void 0:me.tx_power)&&(e.tx_power=r),0===Object.keys(e).length)return Re({success:!0,message:"No changes to save"}),void Me("idle");const n=await h(e);if(!Ye.current)return;if(n.success&&n.data){const e=n.data.applied.join(", "),t=n.data.live_update?" (applied live)":" (restart required)";Re({success:!0,message:`Updated: ${e}${t}`}),await ue(),Me("success"),Ae.current=setTimeout(()=>{Ye.current&&(Me("idle"),je(!1),Re(null))},1500)}else Re({success:!1,message:n.error||"Failed to save"}),Me("error"),Ae.current=setTimeout(()=>{Ye.current&&Me("idle")},2e3)}catch(e){if(!Ye.current)return;Re({success:!1,message:String(e)}),Me("error"),Ae.current=setTimeout(()=>{Ye.current&&Me("idle")},2e3)}}},disabled:"loading"===Le||!$s,className:_("p-2 rounded-lg transition-colors","loading"===Le?"text-accent-primary cursor-wait":"success"===Le?"text-accent-success":"error"===Le?"text-accent-danger":$s?"text-accent-success hover:bg-accent-success/10":"text-text-muted cursor-not-allowed"),title:$s?"Save changes":"No changes to save",children:"loading"===Le?r.jsx(A,{className:"w-4 h-4 animate-spin"}):"success"===Le?r.jsx(I,{className:"w-4 h-4"}):"error"===Le?r.jsx(o,{className:"w-4 h-4"}):r.jsx(I,{className:"w-4 h-4"})})]}):r.jsx("button",{onClick:()=>{me&&(Ne((me.frequency/1e6).toFixed(3)),ke(me.bandwidth/1e3),_e(me.spreading_factor),Te(me.coding_rate),Ee(String(me.tx_power))),Re(null),je(!0)},className:"p-2 rounded-lg transition-colors text-text-muted hover:text-text-primary hover:bg-bg-subtle",title:"Edit radio settings",children:r.jsx(W,{className:"w-4 h-4"})}))})]}),Pe&&r.jsx("div",{className:_("text-xs mb-3 px-2 py-1.5 rounded-md",Pe.success?"text-accent-success bg-accent-success/10":"text-accent-danger bg-accent-danger/10"),children:Pe.message}),me?r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"type-label text-text-muted block mb-1",children:fe?"Frequency (MHz)":"Frequency"}),r.jsx("div",{className:_("h-[38px] rounded-full px-4 flex items-center transition-colors",fe?"bg-white/5":"bg-white/[0.02]"),children:fe?r.jsx("input",{type:"number",value:ve,onChange:e=>Ne(e.target.value),step:"0.001",min:"400",max:"930",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):r.jsx("span",{className:"type-data text-text-primary",children:u(me.frequency)})})]}),r.jsxs("div",{children:[r.jsx("label",{className:"type-label text-text-muted block mb-1",children:fe?"TX Power (dBm)":"TX Power"}),r.jsx("div",{className:_("h-[38px] rounded-full px-4 flex items-center transition-colors",fe?"bg-white/5":"bg-white/[0.02]"),children:fe?r.jsx("input",{type:"number",value:Fe,onChange:e=>Ee(e.target.value),min:"-9",max:"22",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):r.jsxs("span",{className:"type-data text-text-primary",children:[me.tx_power," dBm"]})})]}),r.jsxs("div",{children:[r.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Bandwidth"}),r.jsx("div",{className:_("h-[38px] rounded-full px-4 flex items-center transition-colors relative",fe?"bg-white/5":"bg-white/[0.02]"),children:fe?r.jsxs(r.Fragment,{children:[r.jsx("select",{value:we,onChange:e=>ke(parseFloat(e.target.value)),className:"w-full bg-transparent text-text-primary focus:outline-none appearance-none cursor-pointer type-data pr-6",children:te.map(e=>r.jsx("option",{value:e.value,children:e.label},e.value))}),r.jsx(m,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]}):r.jsx("span",{className:"type-data text-text-primary",children:x(me.bandwidth)})})]}),r.jsxs("div",{children:[r.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Spreading Factor"}),r.jsx("div",{className:_("h-[38px] rounded-full px-4 flex items-center transition-colors relative",fe?"bg-white/5":"bg-white/[0.02]"),children:fe?r.jsxs(r.Fragment,{children:[r.jsx("select",{value:Ce,onChange:e=>_e(parseInt(e.target.value)),className:"w-full bg-transparent text-text-primary focus:outline-none appearance-none cursor-pointer type-data pr-6",children:se.map(e=>r.jsxs("option",{value:e,children:["SF",e]},e))}),r.jsx(m,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]}):r.jsxs("span",{className:"type-data text-text-primary",children:["SF",me.spreading_factor]})})]}),r.jsxs("div",{children:[r.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Coding Rate"}),r.jsx("div",{className:_("h-[38px] rounded-full px-4 flex items-center transition-colors relative",fe?"bg-white/5":"bg-white/[0.02]"),children:fe?r.jsxs(r.Fragment,{children:[r.jsx("select",{value:Se,onChange:e=>Te(parseInt(e.target.value)),className:"w-full bg-transparent text-text-primary focus:outline-none appearance-none cursor-pointer type-data pr-6",children:ae.map(e=>r.jsx("option",{value:e.value,children:e.label},e.value))}),r.jsx(m,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]}):r.jsxs("span",{className:"type-data text-text-primary",children:["4/",me.coding_rate]})})]}),r.jsxs("div",{children:[r.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Preamble"}),r.jsx("div",{className:"h-[38px] rounded-full px-4 flex items-center bg-white/[0.02]",children:r.jsxs("span",{className:"type-data text-text-primary",children:[me.preamble_length," symbols"]})})]})]}):r.jsx("p",{className:"text-text-muted",children:"Loading radio configuration..."})]})})})]}),r.jsxs(R,{template:"standard",children:[r.jsx(z,{span:12,md:6,children:r.jsx(M,{children:r.jsxs("div",{ref:Ie,children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsxs("h2",{className:"type-subheading text-text-primary flex items-center gap-3",children:[r.jsx(p,{className:"icon-md text-text-secondary"}),"Operating Mode"]}),r.jsx("div",{className:"flex items-center gap-1",children:Ze?r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:async()=>{if("loading"!==ct){dt.current&&clearTimeout(dt.current),it("loading");try{const e=await h({tx_delay_factor:parseFloat(tt),direct_tx_delay_factor:parseFloat(at)});if(await de({max_airtime_percent:parseFloat(nt),enforcement_enabled:ye}),!Ye.current)return;e.success&&e.data?(await ue(),it("success"),dt.current=setTimeout(()=>{Ye.current&&(it("idle"),et(!1))},1500)):(it("error"),dt.current=setTimeout(()=>{Ye.current&&it("idle")},2e3))}catch{if(!Ye.current)return;it("error"),dt.current=setTimeout(()=>{Ye.current&&it("idle")},2e3)}}},disabled:"loading"===ct,className:_("p-2 rounded-lg transition-colors","loading"===ct?"text-accent-primary cursor-wait":"success"===ct?"text-accent-success":"error"===ct?"text-accent-danger":"text-accent-success hover:bg-accent-success/10"),title:"Save",children:"loading"===ct?r.jsx(A,{className:"w-4 h-4 animate-spin"}):"success"===ct?r.jsx(I,{className:"w-4 h-4"}):"error"===ct?r.jsx(o,{className:"w-4 h-4"}):r.jsx(I,{className:"w-4 h-4"})}),r.jsx("button",{onClick:Ws,className:"p-2 rounded-lg text-text-muted hover:text-accent-danger hover:bg-accent-danger/10",title:"Cancel",children:r.jsx(o,{className:"w-4 h-4"})})]}):r.jsx("button",{onClick:Gs,className:"p-2 rounded-lg transition-colors text-text-muted hover:text-text-primary hover:bg-bg-subtle",title:"Edit settings",children:r.jsx(W,{className:"w-4 h-4"})})})]}),r.jsx("p",{className:"type-label text-text-muted mb-3",children:"Control how the repeater handles packets"}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[r.jsxs("div",{className:"flex-1 space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("label",{className:"type-label text-text-muted",children:"Repeat"}),r.jsx("div",{className:"flex items-center gap-2",children:(()=>{const e=null!==Ke?Ke:"forward"===be;return r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:async()=>{if("loading"===De)return;const t=!e,s="forward"===be;Ue.current&&clearTimeout(Ue.current),Xe.current&&clearTimeout(Xe.current),Je.current=!1,Ve(t),He("loading"),Ue.current=setTimeout(()=>{Je.current||Ye.current&&(Ve(s),He("error"),Xe.current=setTimeout(()=>{Ye.current&&(He("idle"),Ve(null))},2e3))},1e4);try{if(await ce(t?"forward":"monitor"),Je.current=!0,Ue.current&&clearTimeout(Ue.current),!Ye.current)return;He("success"),Xe.current=setTimeout(()=>{Ye.current&&(He("idle"),Ve(null),ie())},2e3)}catch{if(Je.current=!0,Ue.current&&clearTimeout(Ue.current),!Ye.current)return;Ve(s),He("error"),Xe.current=setTimeout(()=>{Ye.current&&(He("idle"),Ve(null))},2e3)}},disabled:"loading"===De,className:_("relative inline-flex h-6 w-11 items-center rounded-full transition-colors border-2",e?"bg-accent-success border-accent-success":"bg-bg-elevated border-border-subtle","loading"===De&&"opacity-70"),"aria-label":"Toggle forward mode",children:r.jsx("span",{className:_("inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-lg",e?"translate-x-5":"translate-x-0.5")})}),r.jsx("span",{className:_("type-data text-sm w-7",e?"text-accent-success":"text-text-muted"),children:e?"On":"Off"}),"loading"===De&&r.jsx(A,{className:"w-4 h-4 text-text-muted animate-spin"}),"success"===De&&r.jsx(I,{className:"w-4 h-4 text-accent-success"}),"error"===De&&r.jsx(o,{className:"w-4 h-4 text-accent-danger"})]})})()})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("label",{className:"type-label text-text-muted",children:"Duty Cycle"}),r.jsx("div",{className:"flex items-center gap-2",children:(()=>{const e=null!==$e?$e:ye;return r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:async()=>{if("loading"===Oe)return;const t=!e,s=ye;Ge.current&&clearTimeout(Ge.current),We.current&&clearTimeout(We.current),Qe.current=!1,Be(t),qe("loading"),Ge.current=setTimeout(()=>{Qe.current||Ye.current&&(Be(s),qe("error"),We.current=setTimeout(()=>{Ye.current&&(qe("idle"),Be(null))},2e3))},1e4);try{if(await de({max_airtime_percent:Xs(),enforcement_enabled:t}),Qe.current=!0,Ge.current&&clearTimeout(Ge.current),!Ye.current)return;qe("success"),We.current=setTimeout(()=>{Ye.current&&(qe("idle"),Be(null),oe())},2e3)}catch{if(Qe.current=!0,Ge.current&&clearTimeout(Ge.current),!Ye.current)return;Be(s),qe("error"),We.current=setTimeout(()=>{Ye.current&&(qe("idle"),Be(null))},2e3)}},disabled:"loading"===Oe,className:_("relative inline-flex h-6 w-11 items-center rounded-full transition-colors border-2",e?"bg-accent-success border-accent-success":"bg-bg-elevated border-border-subtle","loading"===Oe&&"opacity-70"),"aria-label":"Toggle duty cycle",children:r.jsx("span",{className:_("inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-lg",e?"translate-x-5":"translate-x-0.5")})}),r.jsx("span",{className:_("type-data text-sm w-7",e?"text-accent-success":"text-text-muted"),children:e?"On":"Off"}),"loading"===Oe&&r.jsx(A,{className:"w-4 h-4 text-text-muted animate-spin"}),"success"===Oe&&r.jsx(I,{className:"w-4 h-4 text-accent-success"}),"error"===Oe&&r.jsx(o,{className:"w-4 h-4 text-accent-danger"})]})})()})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("label",{className:"type-label text-text-muted",children:"Max Airtime"}),r.jsx("div",{className:_("h-[32px] rounded-full px-3 flex items-center justify-end transition-colors min-w-[80px]",Ze?"bg-white/5":"bg-white/[0.02]"),children:Ze?r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("input",{type:"number",value:nt,onChange:e=>lt(e.target.value),step:"0.5",min:"0.1",max:"100",className:"w-12 bg-transparent text-text-primary text-right focus:outline-none type-data"}),r.jsx("span",{className:"text-text-muted type-data",children:"%"})]}):r.jsxs("span",{className:"type-data text-text-primary",children:[Xs().toFixed(1),"%"]})})]})]}),r.jsx("div",{className:"hidden sm:block w-px bg-border-subtle"}),r.jsxs("div",{className:"flex-1 pt-4 sm:pt-0 border-t sm:border-t-0 border-border-subtle",children:[r.jsx("label",{className:"type-label text-text-muted block mb-3",children:"TX Delays"}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"type-label text-text-muted",children:"Flood"}),r.jsx("div",{className:_("h-[32px] rounded-full px-3 flex items-center justify-end transition-colors min-w-[80px]",Ze?"bg-white/5":"bg-white/[0.02]"),children:Ze?r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("input",{type:"number",value:tt,onChange:e=>st(e.target.value),step:"0.1",min:"0",max:"5",className:"w-12 bg-transparent text-text-primary text-right focus:outline-none type-data"}),r.jsx("span",{className:"text-text-muted type-data",children:"x"})]}):r.jsxs("span",{className:"type-data text-text-primary",children:[Ys().toFixed(2),"x"]})})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"type-label text-text-muted",children:"Direct"}),r.jsx("div",{className:_("h-[32px] rounded-full px-3 flex items-center justify-end transition-colors min-w-[80px]",Ze?"bg-white/5":"bg-white/[0.02]"),children:Ze?r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("input",{type:"number",value:at,onChange:e=>rt(e.target.value),step:"0.1",min:"0",max:"5",className:"w-12 bg-transparent text-text-primary text-right focus:outline-none type-data"}),r.jsx("span",{className:"text-text-muted type-data",children:"s"})]}):r.jsxs("span",{className:"type-data text-text-primary",children:[Us().toFixed(2),"s"]})})]})]})]})]})]})})}),r.jsx(z,{span:12,md:6,children:r.jsxs(M,{children:[r.jsx(P,{icon:r.jsx(i,{}),title:"App Settings",largeTitle:!0}),r.jsx("p",{className:"type-body-sm text-text-muted mb-4",children:"Appearance and web server options."}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("div",{children:[r.jsx("span",{className:"type-body text-text-primary font-medium block",children:"Enable CORS"}),r.jsx("span",{className:"type-body-sm text-text-muted",children:"Allow cross-origin API access"})]}),r.jsx("div",{className:"flex items-center gap-2",children:(()=>{const e=null!==Ft?Ft:(null==_t?void 0:_t.cors_enabled)??!1;return r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:Zs,disabled:"loading"===St,className:_("relative inline-flex h-6 w-11 items-center rounded-full transition-colors border-2",e?"bg-accent-primary border-accent-primary":"bg-bg-elevated border-border-subtle","loading"===St&&"opacity-70"),title:e?"Disable CORS":"Enable CORS",children:r.jsx("span",{className:_("inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-lg",e?"translate-x-5":"translate-x-0.5")})}),"loading"===St&&r.jsx(A,{className:"w-4 h-4 text-text-muted animate-spin"}),"success"===St&&r.jsx(I,{className:"w-4 h-4 text-accent-success"}),"error"===St&&r.jsx(o,{className:"w-4 h-4 text-accent-danger"})]})})()})]}),r.jsxs("div",{children:[r.jsx("span",{className:"type-body text-text-primary font-medium block mb-2",children:"Theme"}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("div",{className:"flex-1 flex items-center justify-center",children:r.jsx(ee,{showLogoOnly:!0})}),r.jsx("div",{className:"flex-shrink-0",children:r.jsx(ee,{showThumbnailsOnly:!0})})]})]})]})]})})]}),r.jsx(R,{template:"auto",children:r.jsxs(M,{children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[r.jsxs("div",{children:[r.jsxs("h2",{className:"type-heading text-text-primary flex items-center gap-2",children:[r.jsx(U,{className:"icon-md text-accent-primary"}),"Regions / Transport Keys"]}),r.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Manage regional key hierarchy for flood control"})]}),r.jsxs("div",{className:"flex gap-2 flex-wrap",children:[r.jsxs("button",{onClick:()=>ys(!0),disabled:"allow"===is,className:_("flex items-center gap-1.5 h-[32px] px-3 rounded-full transition-colors type-body-sm font-medium","allow"===is?"bg-white/[0.02] text-text-muted cursor-not-allowed":"bg-accent-success/10 hover:bg-accent-success/20 text-accent-success"),children:[r.jsx(J,{className:"w-3.5 h-3.5"}),"Add"]}),r.jsx("button",{onClick:ua,disabled:!ms||"allow"===is,className:_("h-[32px] px-3 rounded-full transition-colors type-body-sm font-medium",ms&&"allow"!==is?"bg-accent-primary/10 hover:bg-accent-primary/20 text-accent-primary":"bg-white/[0.02] text-text-muted cursor-not-allowed"),children:"Edit"}),r.jsx("button",{onClick:ma,disabled:!ms||"allow"===is,className:_("h-[32px] px-3 rounded-full transition-colors type-body-sm font-medium",ms&&"allow"!==is?"bg-accent-danger/10 hover:bg-accent-danger/20 text-accent-danger":"bg-white/[0.02] text-text-muted cursor-not-allowed"),children:"Delete"})]})]}),r.jsx("div",{className:"bg-white/[0.02] rounded-2xl p-4 mb-4",children:r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:_("w-10 h-10 rounded-full flex items-center justify-center","allow"===is?"bg-accent-success/20":"bg-accent-danger/20"),children:"allow"===is?r.jsx(Q,{className:"w-5 h-5 text-accent-success"}):r.jsx(Z,{className:"w-5 h-5 text-accent-danger"})}),r.jsxs("div",{children:[r.jsx("h4",{className:"type-body text-text-primary font-medium",children:"Global Flood Policy"}),r.jsx("p",{className:"type-body-sm text-text-muted",children:"Master control for repeater flooding"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("div",{className:"flex bg-white/[0.02] rounded-full p-1",children:[r.jsx("button",{onClick:()=>da("deny"),disabled:os,className:_("px-4 py-1.5 rounded-full transition-colors type-body-sm font-medium","deny"===is?"bg-accent-danger/20 text-accent-danger":"text-text-muted hover:text-text-secondary",os&&"opacity-50"),children:"Deny"}),r.jsx("button",{onClick:()=>da("allow"),disabled:os,className:_("px-4 py-1.5 rounded-full transition-colors type-body-sm font-medium","allow"===is?"bg-accent-success/20 text-accent-success":"text-text-muted hover:text-text-secondary",os&&"opacity-50"),children:"Allow"})]}),os&&r.jsx(A,{className:"w-4 h-4 animate-spin text-text-muted"})]})]})}),ls&&r.jsx("div",{className:"type-body-sm mb-3 px-3 py-2 rounded-full text-accent-danger bg-accent-danger/10",children:ls}),r.jsx("div",{className:"bg-white/[0.02] rounded-2xl p-4 min-h-[120px]",children:rs?r.jsxs("div",{className:"flex items-center justify-center py-6",children:[r.jsx(A,{className:"w-5 h-5 animate-spin text-accent-primary mr-2"}),r.jsx("span",{className:"type-body-sm text-text-muted",children:"Loading transport keys..."})]}):0===ss.length?r.jsxs("div",{className:"text-center py-6",children:[r.jsx("div",{className:"w-12 h-12 rounded-full bg-white/[0.02] mx-auto mb-3 flex items-center justify-center",children:r.jsx(U,{className:"w-6 h-6 text-text-muted/50"})}),r.jsx("p",{className:"type-body text-text-muted",children:"No transport keys found"}),r.jsx("p",{className:"type-body-sm text-text-muted/70 mt-1",children:"Add your first transport key to get started"})]}):r.jsx("div",{className:"space-y-1",children:ss.map(e=>r.jsx(xa,{node:e,level:0},e.id))})})]})}),r.jsx(R,{template:"auto",children:r.jsxs(M,{children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[r.jsxs("div",{children:[r.jsxs("h2",{className:"type-heading text-text-primary flex items-center gap-2",children:[r.jsx(X,{className:"icon-md text-accent-primary"}),"API Tokens"]}),r.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Manage API tokens for machine-to-machine authentication"})]}),r.jsxs("button",{onClick:()=>qt(!0),className:"flex items-center justify-center gap-2 h-[32px] px-4 bg-accent-primary/10 hover:bg-accent-primary/20 text-accent-primary rounded-full transition-colors type-body-sm font-medium",children:[r.jsx(J,{className:"w-4 h-4"}),"Create Token"]})]}),r.jsx("div",{className:"bg-accent-tertiary/5 rounded-2xl p-4 mb-4",children:r.jsxs("div",{className:"flex gap-3",children:[r.jsx("div",{className:"w-8 h-8 rounded-full bg-accent-tertiary/20 flex items-center justify-center flex-shrink-0",children:r.jsx(O,{className:"w-4 h-4 text-accent-tertiary"})}),r.jsxs("div",{className:"type-body-sm text-text-muted",children:[r.jsxs("p",{children:[r.jsx("span",{className:"text-text-secondary",children:"API tokens"})," are used for machine-to-machine authentication. Include the token in the ",r.jsx("code",{className:"type-code bg-accent-tertiary/20 px-1.5 py-0.5 rounded-full text-accent-tertiary",children:"X-API-Key"})," header when making API requests."]}),r.jsx("p",{className:"mt-1 text-text-muted/70",children:"Tokens are only shown once at creation. Store them securely."})]})]})}),Dt&&r.jsx("div",{className:"type-body-sm mb-3 px-3 py-2 rounded-full text-accent-danger bg-accent-danger/10",children:Dt}),At&&0===Rt.length?r.jsxs("div",{className:"flex items-center justify-center py-6",children:[r.jsx(A,{className:"w-5 h-5 animate-spin text-accent-primary mr-2"}),r.jsx("span",{className:"type-body-sm text-text-muted",children:"Loading tokens..."})]}):Rt.length>0?r.jsx("div",{className:"space-y-2",children:Rt.map(e=>r.jsx("div",{className:"bg-white/[0.02] hover:bg-white/[0.04] rounded-2xl p-4 transition-colors",children:r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[r.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[r.jsx("div",{className:"w-10 h-10 rounded-full bg-accent-primary/10 flex items-center justify-center flex-shrink-0",children:r.jsx(X,{className:"w-5 h-5 text-accent-primary"})}),r.jsxs("div",{className:"min-w-0 flex-1",children:[r.jsx("h3",{className:"type-body text-text-primary font-medium truncate",children:e.name}),r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:gap-4 mt-0.5",children:[r.jsxs("span",{className:"type-data-sm text-text-muted truncate",children:["Created: ",aa(e.created_at)]}),r.jsxs("span",{className:"type-data-sm text-text-muted truncate",children:["Last used: ",aa(e.last_used)]})]})]})]}),r.jsxs("button",{onClick:()=>Gt({id:e.id,name:e.name}),disabled:Qt,className:"h-[32px] px-4 bg-accent-danger/10 hover:bg-accent-danger/20 text-accent-danger rounded-full transition-colors disabled:opacity-50 type-body-sm font-medium flex items-center justify-center gap-1.5",children:[r.jsx(T,{className:"w-3.5 h-3.5"}),"Revoke"]})]})},e.id))}):r.jsxs("div",{className:"bg-white/[0.02] rounded-2xl p-6 text-center",children:[r.jsx("div",{className:"w-14 h-14 rounded-full bg-white/[0.02] mx-auto mb-4 flex items-center justify-center",children:r.jsx(X,{className:"w-7 h-7 text-text-muted/50"})}),r.jsx("h3",{className:"type-body text-text-primary font-medium mb-1",children:"No API Tokens"}),r.jsx("p",{className:"type-body-sm text-text-muted mb-4",children:"Create a token to enable API access"}),r.jsx("button",{onClick:()=>qt(!0),className:"h-[32px] px-4 bg-accent-primary/10 hover:bg-accent-primary/20 text-accent-primary rounded-full transition-colors type-body-sm font-medium",children:"Create Your First Token"})]})]})}),r.jsx(R,{template:"auto",children:r.jsxs(M,{children:[r.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:r.jsxs("div",{children:[r.jsxs("h2",{className:"type-heading text-text-primary flex items-center gap-2",children:[r.jsx(G,{className:"icon-md text-accent-primary"}),"Web Frontend"]}),r.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Choose which web interface to use"})]})}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-3",children:[r.jsxs("label",{className:_("flex items-start gap-3 p-4 bg-white/[0.02] rounded-2xl border-2 cursor-pointer transition-all",Ms?"border-accent-primary bg-accent-primary/5":"border-transparent hover:border-accent-primary/30","loading"===Ds&&"opacity-50 pointer-events-none"),children:[r.jsx("input",{type:"radio",name:"frontend",checked:Ms,onChange:()=>ea(!0),disabled:"loading"===Ds,className:"mt-1 h-4 w-4 text-accent-primary focus:ring-accent-primary focus:ring-offset-bg-elevated"}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("div",{className:"type-body text-text-primary font-medium",children:"Default Frontend"}),r.jsx("a",{href:"https://github.com/rightup/pyMC_Repeater",target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"type-data-xs bg-accent-tertiary/15 text-accent-tertiary px-2.5 py-0.5 rounded-full font-medium hover:bg-accent-tertiary/25 transition-colors",children:"@RightUp"})]}),r.jsx("div",{className:"type-body-sm text-text-muted mt-1",children:"Built-in pyMC Repeater web interface"}),r.jsx("div",{className:"type-data-xs text-text-muted/60 mt-1 font-mono",children:"/opt/pymc_repeater/repeater/web/html"})]})]}),r.jsxs("label",{className:_("flex items-start gap-3 p-4 bg-white/[0.02] rounded-2xl border-2 cursor-pointer transition-all",Ms?"border-transparent hover:border-accent-primary/30":"border-accent-primary bg-accent-primary/5","loading"===Ds&&"opacity-50 pointer-events-none"),children:[r.jsx("input",{type:"radio",name:"frontend",checked:!Ms,onChange:()=>ea(!1),disabled:"loading"===Ds,className:"mt-1 h-4 w-4 text-accent-primary focus:ring-accent-primary focus:ring-offset-bg-elevated"}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("div",{className:"type-body text-text-primary font-medium",children:"PyMC Console"}),r.jsx("span",{className:"type-data-xs bg-accent-secondary/15 text-accent-secondary px-2.5 py-0.5 rounded-full font-medium",children:"@Treehouse ⚡"})]}),r.jsx("div",{className:"type-body-sm text-text-muted mt-1",children:"Alternative web interface for pyMC Repeater"}),r.jsx("div",{className:"type-data-xs text-text-muted/60 mt-1 font-mono",children:"/opt/pymc_console/web/html"})]})]})]}),!As&&r.jsx("div",{className:_("bg-white/[0.02] rounded-2xl p-4",Rs?"border border-accent-success/20":"border border-accent-tertiary/20"),children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:_("w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",Rs?"bg-accent-success/20":"bg-accent-tertiary/20"),children:Rs?r.jsx(B,{className:"w-4 h-4 text-accent-success"}):r.jsx(O,{className:"w-4 h-4 text-accent-tertiary"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"type-body text-text-primary font-medium",children:Rs?"PyMC Console has been detected":"PyMC Console Not Installed"}),Rs?r.jsxs("p",{className:"type-body-sm text-text-muted mt-1",children:["PyMC Console is installed at ",r.jsx("code",{className:"type-code bg-accent-success/10 px-1.5 py-0.5 rounded-full text-accent-success",children:"/opt/pymc_console/web/html"})]}):r.jsxs(r.Fragment,{children:[r.jsxs("p",{className:"type-body-sm text-text-muted mt-1 mb-3",children:["PyMC Console must be installed at ",r.jsx("code",{className:"type-code bg-accent-tertiary/10 px-1.5 py-0.5 rounded-full text-accent-tertiary",children:"/opt/pymc_console/web/html"})," before selecting this option."]}),r.jsxs("a",{href:"https://github.com/dmduran12/pymc_console-dist",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 h-[32px] px-4 bg-accent-tertiary/10 hover:bg-accent-tertiary/20 text-accent-tertiary rounded-full type-body-sm font-medium transition-colors",children:[r.jsx(q,{className:"w-4 h-4"}),"PyMC Console Install Instructions"]})]})]})]})}),Os&&r.jsx("div",{className:"bg-white/[0.02] rounded-2xl p-4 border border-accent-secondary/30",children:r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[r.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[r.jsx("div",{className:"w-8 h-8 rounded-full bg-accent-secondary/20 flex items-center justify-center flex-shrink-0",children:r.jsx(D,{className:"w-4 h-4 text-accent-secondary"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"type-body text-text-primary font-medium",children:"Service restart required"}),r.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Web frontend changes will take effect after restarting the pymc-repeater service."})]})]}),r.jsx("button",{onClick:async()=>{if(!Ks){Vs(!0);try{await g(),qs(!1),setTimeout(()=>{window.location.reload()},2e3)}catch{qs(!1),setTimeout(()=>{window.location.reload()},3e3)}}},disabled:Ks,className:"h-[32px] px-4 bg-accent-secondary/10 hover:bg-accent-secondary/20 text-accent-secondary rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 whitespace-nowrap type-body-sm font-medium",children:Ks?r.jsxs(r.Fragment,{children:[r.jsx(A,{className:"w-4 h-4 animate-spin"}),"Restarting..."]}):r.jsxs(r.Fragment,{children:[r.jsx(K,{className:"w-4 h-4"}),"Restart Now"]})})]})})]})]})}),r.jsx(R,{template:"auto",children:r.jsxs(M,{children:[r.jsx(P,{icon:r.jsx(p,{}),title:"Node Information",largeTitle:!0}),le?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[r.jsxs("div",{children:[r.jsx("span",{className:"type-label text-text-muted",children:"Node Name"}),r.jsx("p",{className:"type-body text-text-primary mt-1",children:he})]}),r.jsxs("div",{children:[r.jsx("span",{className:"type-label text-text-muted",children:"Version"}),r.jsxs("p",{className:"type-data text-text-primary mt-1",children:["v",le.version]})]}),r.jsxs("div",{children:[r.jsx("span",{className:"type-label text-text-muted",children:"Core Version"}),r.jsxs("p",{className:"type-data text-text-primary mt-1",children:["v",le.core_version]})]}),r.jsxs("div",{children:[r.jsx("span",{className:"type-label text-text-muted",children:"Local Hash"}),r.jsx("div",{className:"mt-1",children:le.local_hash?r.jsx(S,{hash:le.local_hash,size:"sm"}):r.jsx("span",{className:"type-data-sm text-text-muted",children:"N/A"})})]})]}),le.public_key&&r.jsxs("div",{className:"mt-4 pt-4 border-t border-border-subtle",children:[r.jsx("span",{className:"type-label text-text-muted",children:"Public Key"}),r.jsx("div",{className:"mt-1",children:r.jsx(S,{hash:le.public_key,prefixLength:12,suffixLength:8})})]})]}):r.jsx("p",{className:"text-text-muted",children:"Loading node information..."})]})}),Ot&&r.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&qt(!1),role:"dialog","aria-modal":"true","aria-labelledby":"create-token-modal-title",children:r.jsxs("div",{className:"bg-bg-elevated border border-border-subtle rounded-xl p-6 max-w-md w-full shadow-2xl",children:[r.jsx("h3",{id:"create-token-modal-title",className:"type-subheading text-text-primary mb-4",children:"Create API Token"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Token Name"}),r.jsx("input",{type:"text",value:Kt,onChange:e=>Vt(e.target.value),placeholder:"e.g., Production Server, CI/CD Pipeline",className:"w-full px-4 py-2 bg-bg-subtle border border-border-subtle rounded-lg text-text-primary placeholder-text-muted focus:outline-none focus:ring-2 focus:ring-accent-primary/50 transition-colors",onKeyDown:e=>"Enter"===e.key&&sa(),autoFocus:!0}),r.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Give your token a descriptive name to identify its purpose"})]}),r.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[r.jsx("button",{onClick:()=>{qt(!1),Vt(""),Ht(null)},disabled:Wt,className:"px-4 py-2 bg-bg-subtle hover:bg-bg-elevated text-text-secondary rounded-lg border border-border-subtle transition-colors disabled:opacity-50",children:"Cancel"}),r.jsx("button",{onClick:sa,disabled:Wt||!Kt.trim(),className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary rounded-lg border border-accent-primary/50 transition-colors disabled:opacity-50 flex items-center gap-2",children:Wt?r.jsxs(r.Fragment,{children:[r.jsx(A,{className:"w-4 h-4 animate-spin"}),"Creating..."]}):"Create Token"})]})]})]})}),Yt&&$t&&r.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&Ut(!1),role:"dialog","aria-modal":"true","aria-labelledby":"show-token-modal-title",children:r.jsxs("div",{className:"bg-bg-elevated border border-border-subtle rounded-xl p-6 max-w-lg w-full shadow-2xl",children:[r.jsx("h3",{id:"show-token-modal-title",className:"type-subheading text-text-primary mb-4",children:"Token Created Successfully"}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"bg-accent-secondary/10 border border-accent-secondary/30 rounded-lg p-3",children:r.jsxs("div",{className:"flex gap-2",children:[r.jsx(D,{className:"w-4 h-4 text-accent-secondary flex-shrink-0 mt-0.5"}),r.jsxs("div",{className:"text-sm text-text-secondary",children:[r.jsx("strong",{children:"Save this token now!"})," For security reasons, it will not be shown again."]})]})}),r.jsxs("div",{children:[r.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Your API Token"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{value:$t,readOnly:!0,className:"flex-1 px-4 py-2 bg-bg-subtle border border-border-subtle rounded-lg text-text-primary font-mono text-sm"}),r.jsxs("button",{onClick:()=>{$t&&(navigator.clipboard.writeText($t),ts(!0),setTimeout(()=>ts(!1),2e3))},className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary rounded-lg border border-accent-primary/50 transition-colors flex items-center gap-2",title:"Copy to clipboard",children:[es?r.jsx(I,{className:"w-4 h-4 text-accent-success"}):r.jsx(H,{className:"w-4 h-4"}),es?"Copied!":"Copy"]})]})]}),r.jsxs("div",{className:"bg-accent-tertiary/10 border border-accent-tertiary/30 rounded-lg p-3",children:[r.jsx("p",{className:"text-sm text-text-secondary mb-2",children:r.jsx("strong",{children:"Usage Example:"})}),r.jsxs("code",{className:"block bg-accent-tertiary/20 px-3 py-2 rounded text-xs text-accent-tertiary font-mono overflow-x-auto",children:['curl -H "X-API-Key: ',$t.slice(0,12),'..." ',window.location.origin,"/api/stats"]})]}),r.jsx("div",{className:"flex justify-end mt-6",children:r.jsx("button",{onClick:()=>{Ut(!1),Bt(null)},className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary rounded-lg border border-accent-primary/50 transition-colors",children:"Done"})})]})]})}),r.jsx(F,{isOpen:!!Xt,title:"Revoke API Token",message:`Are you sure you want to revoke the token '${null==Xt?void 0:Xt.name}'? This action cannot be undone.`,confirmLabel:Qt?"Revoking...":"Revoke",cancelLabel:"Cancel",variant:"danger",onConfirm:async()=>{if(Xt){Zt(!0),Ht(null);try{await j(Xt.id),await ta(),Gt(null)}catch(e){Ht(e instanceof Error?e.message:"Failed to revoke token")}finally{Zt(!1)}}},onCancel:()=>Gt(null)}),bs&&r.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&ys(!1),role:"dialog","aria-modal":"true","aria-labelledby":"add-key-modal-title",children:r.jsxs("div",{className:"bg-bg-elevated border border-border-subtle rounded-xl p-6 max-w-md w-full shadow-2xl",children:[r.jsx("h3",{id:"add-key-modal-title",className:"type-subheading text-text-primary mb-4",children:"Add Transport Key"}),r.jsxs("div",{className:"space-y-4",children:[ms&&r.jsxs("div",{className:"bg-accent-tertiary/10 border border-accent-tertiary/30 rounded-lg p-3 text-sm text-text-secondary",children:["Adding as child of: ",r.jsx("strong",{className:"text-text-primary",children:ca()})]}),r.jsxs("div",{children:[r.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Key Name"}),r.jsx("input",{type:"text",value:_s,onChange:e=>Ss(e.target.value),placeholder:"e.g., Region Name, Group Key",className:"w-full px-4 py-2 bg-bg-subtle border border-border-subtle rounded-lg text-text-primary placeholder-text-muted focus:outline-none focus:ring-2 focus:ring-accent-primary/50 transition-colors",onKeyDown:e=>"Enter"===e.key&&oa(),autoFocus:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Flood Policy"}),r.jsxs("div",{className:"flex bg-bg-subtle rounded-lg border border-border-subtle p-1",children:[r.jsx("button",{onClick:()=>Fs("deny"),className:_("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","deny"===Ts?"bg-accent-danger/20 text-accent-danger border border-accent-danger/50":"text-text-muted hover:text-text-secondary"),children:"DENY"}),r.jsx("button",{onClick:()=>Fs("allow"),className:_("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","allow"===Ts?"bg-accent-success/20 text-accent-success border border-accent-success/50":"text-text-muted hover:text-text-secondary"),children:"ALLOW"})]})]}),r.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[r.jsx("button",{onClick:()=>{ys(!1),Ss(""),Fs("deny")},disabled:Es,className:"px-4 py-2 bg-bg-subtle hover:bg-bg-elevated text-text-secondary rounded-lg border border-border-subtle transition-colors disabled:opacity-50",children:"Cancel"}),r.jsx("button",{onClick:oa,disabled:Es||!_s.trim(),className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary rounded-lg border border-accent-primary/50 transition-colors disabled:opacity-50 flex items-center gap-2",children:Es?r.jsxs(r.Fragment,{children:[r.jsx(A,{className:"w-4 h-4 animate-spin"}),"Adding..."]}):"Add Key"})]})]})]})}),gs&&Ns&&r.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&fs(!1),role:"dialog","aria-modal":"true","aria-labelledby":"edit-key-modal-title",children:r.jsxs("div",{className:"bg-bg-elevated border border-border-subtle rounded-xl p-6 max-w-md w-full shadow-2xl",children:[r.jsx("h3",{id:"edit-key-modal-title",className:"type-subheading text-text-primary mb-4",children:"Edit Transport Key"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Key Name"}),r.jsx("input",{type:"text",value:Ns.name,onChange:e=>ws({...Ns,name:e.target.value}),className:"w-full px-4 py-2 bg-bg-subtle border border-border-subtle rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary/50 transition-colors",autoFocus:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Flood Policy"}),r.jsxs("div",{className:"flex bg-bg-subtle rounded-lg border border-border-subtle p-1",children:[r.jsx("button",{onClick:()=>ws({...Ns,floodPolicy:"deny"}),className:_("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","deny"===Ns.floodPolicy?"bg-accent-danger/20 text-accent-danger border border-accent-danger/50":"text-text-muted hover:text-text-secondary"),children:"DENY"}),r.jsx("button",{onClick:()=>ws({...Ns,floodPolicy:"allow"}),className:_("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","allow"===Ns.floodPolicy?"bg-accent-success/20 text-accent-success border border-accent-success/50":"text-text-muted hover:text-text-secondary"),children:"ALLOW"})]})]}),Ns.transport_key&&r.jsxs("div",{children:[r.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Transport Key"}),r.jsx("code",{className:"block bg-bg-subtle px-3 py-2 rounded-lg text-xs text-text-muted font-mono overflow-x-auto",children:Ns.transport_key})]}),r.jsxs("div",{className:"flex justify-between gap-3 mt-6",children:[r.jsx("button",{onClick:()=>{fs(!1),Cs(Ns),vs(!0),ws(null)},disabled:Es,className:"px-4 py-2 bg-accent-danger/20 hover:bg-accent-danger/30 text-accent-danger rounded-lg border border-accent-danger/50 transition-colors disabled:opacity-50",children:"Delete"}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:()=>{fs(!1),ws(null)},disabled:Es,className:"px-4 py-2 bg-bg-subtle hover:bg-bg-elevated text-text-secondary rounded-lg border border-border-subtle transition-colors disabled:opacity-50",children:"Cancel"}),r.jsx("button",{onClick:async()=>{if(Ns){Ls(!0),cs(null);try{const e=await w(Ns.id,{name:Ns.name,flood_policy:Ns.floodPolicy});e.success?(await na(),fs(!1),ws(null)):cs(e.error||"Failed to update transport key")}catch(e){cs(e instanceof Error?e.message:"Failed to update transport key")}finally{Ls(!1)}}},disabled:Es||!Ns.name.trim(),className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary rounded-lg border border-accent-primary/50 transition-colors disabled:opacity-50 flex items-center gap-2",children:Es?r.jsxs(r.Fragment,{children:[r.jsx(A,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):"Save"})]})]})]})]})}),js&&ks&&r.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&vs(!1),role:"dialog","aria-modal":"true","aria-labelledby":"delete-key-modal-title",children:r.jsxs("div",{className:"bg-bg-elevated border border-border-subtle rounded-xl p-6 max-w-md w-full shadow-2xl",children:[r.jsx("h3",{id:"delete-key-modal-title",className:"type-subheading text-text-primary mb-4",children:"Delete Transport Key"}),r.jsxs("p",{className:"text-text-secondary mb-4",children:["Are you sure you want to delete ",r.jsxs("strong",{className:"text-text-primary",children:["'",ks.name,"'"]}),"?"]}),ks.children&&ks.children.length>0&&r.jsx("div",{className:"bg-accent-secondary/10 border border-accent-secondary/30 rounded-lg p-3 mb-4",children:r.jsxs("div",{className:"flex gap-2",children:[r.jsx(D,{className:"w-4 h-4 text-accent-secondary flex-shrink-0 mt-0.5"}),r.jsxs("div",{className:"text-sm text-text-secondary",children:["This key has ",ks.children.length," child key(s). Deleting will also remove all children."]})]})}),r.jsxs("div",{className:"flex justify-end gap-3",children:[r.jsx("button",{onClick:()=>{vs(!1),Cs(null)},disabled:Es,className:"px-4 py-2 bg-bg-subtle hover:bg-bg-elevated text-text-secondary rounded-lg border border-border-subtle transition-colors disabled:opacity-50",children:"Cancel"}),r.jsx("button",{onClick:async()=>{if(ks){Ls(!0),cs(null);try{const e=await k(ks.id);e.success?(await na(),vs(!1),Cs(null),xs(null)):cs(e.error||"Failed to delete transport key")}catch(e){cs(e instanceof Error?e.message:"Failed to delete transport key")}finally{Ls(!1)}}},disabled:Es,className:"px-4 py-2 bg-accent-danger/20 hover:bg-accent-danger/30 text-accent-danger rounded-lg border border-accent-danger/50 transition-colors disabled:opacity-50 flex items-center gap-2",children:Es?r.jsxs(r.Fragment,{children:[r.jsx(A,{className:"w-4 h-4 animate-spin"}),"Deleting..."]}):"Delete"})]})]})})]})}export{re as default};
