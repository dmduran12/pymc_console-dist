var e=Object.defineProperty,t=(t,s,n)=>((t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n)(t,"symbol"!=typeof s?s+"":s,n);import{r as s,j as n,m as a,W as i,Z as o}from"./vendor-react-alRNW2nb.js";import{r}from"./cosmograph-DqYT4sUA.js";import{b1 as l,b2 as c,aF as d,aB as u,b3 as m,b4 as h,b5 as x,b6 as p,b7 as g,b8 as f,b9 as v,p as b,aR as y,ba as j,bb as N,Z as w,h as C,J as k,bc as S,bd as D,be as L,B as F,av as R}from"./index-D7i6lQrq.js";import{u as M,r as H,f as B,g as P,e as E}from"./consumer-registry-KuOoZhsq.js";import{c as A,D as z,s as $}from"./DeepAnalysisModal-Ca6cBH6E.js";import{D as T}from"./DataBox-DpDXI-WX.js";import{h as I,c as G}from"./geo-utils-DJn8DnxF.js";import{b as O,A as Z,m as W}from"./vendor-motion-DNp0Qg4F.js";import{aK as K,aL as V,b as _,X as U,W as X,ah as Q,aM as q,aN as J,aO as Y,a4 as ee,au as te,m as se,P as ne,aP as ae,R as ie,aQ as oe,aR as re,aB as le,aS as ce,aT as de,C as ue,D as me,ar as he,L as xe,ak as pe,a as ge,o as fe,E as ve,aU as be}from"./vendor-icons-TO0PZKGR.js";import{N as ye,a as je}from"./badge-colors-BxLppqaF.js";import{e as Ne,f as we,g as Ce}from"./meshcore-tx-constants-BDLT5LMb.js";import"./vendor-virt-BytWoLhu.js";import"./vendor-charts-C916_-gs.js";import"./vendor-core-FtpmsTnh.js";import"./vendor-fonts-CRZaZSFf.js";function ke(e){if(null==e)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?`"${t.replace(/"/g,'""')}"`:t}function Se(e,t){const s=[e.join(",")];for(const n of t)s.push(n.map(ke).join(","));return s.join("\n")}function De(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function Le(e){return!e||e<=0?"":new Date(1e3*e).toISOString()}function Fe(e,t){return`${e}-${(new Date).toISOString().replace(/[:.]/g,"-").slice(0,19)}.${t}`}const Re=["hash","prefix","name","nodeClass","communityId","degree","inDegree","outDegree","betweenness","pathDiversity","packetCount","lastSeen","activityLevel","recencyScore","avgRssi","avgSnr","isZeroHop","prefixConfidence","hasCollision","collisionCandidates","isLocal","isHub","isGateway","isBackbone","isMobile","isGhost","isInLoop","latitude","longitude","contactType"];function Me(e){var t,s;return[e.hash,e.prefix,e.name??"",e.nodeClass,e.communityId,e.degree,e.inDegree,e.outDegree,e.betweenness.toFixed(6),e.pathDiversity,e.packetCount,Le(e.lastSeen),e.activityLevel,e.recencyScore.toFixed(4),(null==(t=e.avgRssi)?void 0:t.toFixed(1))??"",(null==(s=e.avgSnr)?void 0:s.toFixed(1))??"",e.isZeroHop,e.prefixConfidence.toFixed(4),e.hasCollision,e.collisionCandidates,e.isLocal,e.isHub,e.isGateway,e.isBackbone,e.isMobile,e.isGhost,e.isInLoop,e.latitude??"",e.longitude??"",e.contactType??""]}function He(e,t){const s=[];for(const n of e.nodeMetrics.values())!t&&n.isGhost||s.push({hash:n.hash,prefix:n.prefix,name:n.name,nodeClass:n.nodeClass,communityId:n.communityId,degree:n.degree,inDegree:n.inDegree,outDegree:n.outDegree,betweenness:n.betweenness,pathDiversity:n.pathDiversity,packetCount:n.packetCount,lastSeen:n.lastSeen,activityLevel:n.activityLevel,recencyScore:n.recencyScore,avgRssi:n.avgRssi,avgSnr:n.avgSnr,isZeroHop:n.isZeroHop,prefixConfidence:n.prefixConfidence,hasCollision:n.hasCollision,isLocal:n.isLocal,isHub:n.isHub,isGateway:n.isGateway,isBackbone:n.isBackbone,isMobile:n.isMobile,isGhost:n.isGhost,isInLoop:n.isInLoop,latitude:n.latitude,longitude:n.longitude,contactType:n.contactType});return s}const Be=["fromHash","toHash","key","packetCount","certainCount","avgConfidence","strength","forwardCount","reverseCount","symmetryRatio","dominantDirection","floodCount","directCount","isDirectPathEdge","isZeroHop","isLoopEdge","isCertain","avgRssi","avgSnr","avgRecency","hopDistanceFromLocal","edgeBetweenness","isBackbone"];function Pe(e,t){const s=t?e.edges:e.validatedEdges,n=new Set(e.backboneEdges);return s.map(t=>({fromHash:t.fromHash,toHash:t.toHash,key:t.key,packetCount:t.packetCount,certainCount:t.certainCount,avgConfidence:t.avgConfidence,strength:t.strength,forwardCount:t.forwardCount,reverseCount:t.reverseCount,symmetryRatio:t.symmetryRatio,dominantDirection:t.dominantDirection,floodCount:t.floodCount,directCount:t.directCount,isDirectPathEdge:t.isDirectPathEdge,isZeroHop:t.isZeroHop??!1,isLoopEdge:t.isLoopEdge??!1,isCertain:t.isCertain,avgRssi:t.avgRssi??null,avgSnr:t.avgSnr??null,avgRecency:t.avgRecency,hopDistanceFromLocal:t.hopDistanceFromLocal,edgeBetweenness:e.edgeBetweenness.get(t.key)??0,isBackbone:n.has(t.key)}))}const Ee=["pathKey","hops","hopCount","healthScore","weakestLinkKey","weakestLinkConfidence","avgEdgeCertainty","observationTrend","alternatePathsCount","estimatedLatencyMs","observationCount","routeType","lastSeen","involvesHub"];function Ae(e){return[e.pathKey,e.hops.join(">"),e.hops.length,e.healthScore.toFixed(4),e.weakestLinkKey??"",e.weakestLinkConfidence.toFixed(4),e.avgEdgeCertainty.toFixed(4),e.observationTrend.toFixed(4),e.alternatePathsCount,e.estimatedLatencyMs.toFixed(0),e.observationCount,e.routeType,Le(e.lastSeen),e.involvesHub]}const ze=["nodeHash","nodePrefix","nodeName","networkRole","floodFactor","directFactor","floodSlots","directSlots","trafficIntensity","directNeighborCount","collisionRisk","confidence","adjustment","dataConfidence","observationSymmetry","rationale"];function $e(e,t,s){const n=s.get(e);return[e,(null==n?void 0:n.prefix)??"",(null==n?void 0:n.name)??"",t.networkRole,t.floodFactor.toFixed(2),t.directFactor.toFixed(2),t.floodSlots,t.directSlots,t.trafficIntensity.toFixed(4),t.directNeighborCount,t.collisionRisk.toFixed(4),t.confidence.toFixed(4),t.adjustment,t.dataConfidence,t.observationSymmetry.toFixed(4),t.rationale]}function Te(e,t){var s,n;const a=new Set(e.backboneEdges),i=['<?xml version="1.0" encoding="UTF-8"?>','<gexf xmlns="http://gexf.net/1.3" version="1.3">',`  <meta lastmodifieddate="${(new Date).toISOString()}">`,`    <creator>pymc_console v${l}</creator>`,"    <description>MeshCore LoRa Mesh Network Topology</description>","  </meta>",'  <graph defaultedgetype="directed" mode="static">',"","    \x3c!-- Node Attributes --\x3e",'    <attributes class="node">','      <attribute id="n0" title="prefix" type="string"/>','      <attribute id="n1" title="name" type="string"/>','      <attribute id="n2" title="nodeClass" type="string"/>','      <attribute id="n3" title="communityId" type="integer"/>','      <attribute id="n4" title="degree" type="integer"/>','      <attribute id="n5" title="betweenness" type="float"/>','      <attribute id="n6" title="packetCount" type="integer"/>','      <attribute id="n7" title="activityLevel" type="string"/>','      <attribute id="n8" title="isHub" type="boolean"/>','      <attribute id="n9" title="isGateway" type="boolean"/>','      <attribute id="n10" title="isBackbone" type="boolean"/>','      <attribute id="n11" title="isMobile" type="boolean"/>','      <attribute id="n12" title="isGhost" type="boolean"/>','      <attribute id="n13" title="isZeroHop" type="boolean"/>','      <attribute id="n14" title="prefixConfidence" type="float"/>','      <attribute id="n15" title="avgRssi" type="float"/>','      <attribute id="n16" title="avgSnr" type="float"/>',"    </attributes>","","    \x3c!-- Edge Attributes --\x3e",'    <attributes class="edge">','      <attribute id="e0" title="packetCount" type="integer"/>','      <attribute id="e1" title="certainCount" type="integer"/>','      <attribute id="e2" title="confidence" type="float"/>','      <attribute id="e3" title="symmetryRatio" type="float"/>','      <attribute id="e4" title="dominantDirection" type="string"/>','      <attribute id="e5" title="isBackbone" type="boolean"/>','      <attribute id="e6" title="isLoopEdge" type="boolean"/>','      <attribute id="e7" title="isDirectPath" type="boolean"/>','      <attribute id="e8" title="isZeroHop" type="boolean"/>','      <attribute id="e9" title="edgeBetweenness" type="float"/>','      <attribute id="e10" title="floodCount" type="integer"/>','      <attribute id="e11" title="directCount" type="integer"/>',"    </attributes>","","    <nodes>"];for(const o of e.nodeMetrics.values()){if(!t&&o.isGhost)continue;const e=De(o.name??o.prefix);i.push(`      <node id="${De(o.hash)}" label="${e}">`),i.push("        <attvalues>"),i.push(`          <attvalue for="n0" value="${De(o.prefix)}"/>`),i.push(`          <attvalue for="n1" value="${De(o.name??"")}"/>`),i.push(`          <attvalue for="n2" value="${o.nodeClass}"/>`),i.push(`          <attvalue for="n3" value="${o.communityId}"/>`),i.push(`          <attvalue for="n4" value="${o.degree}"/>`),i.push(`          <attvalue for="n5" value="${o.betweenness}"/>`),i.push(`          <attvalue for="n6" value="${o.packetCount}"/>`),i.push(`          <attvalue for="n7" value="${o.activityLevel}"/>`),i.push(`          <attvalue for="n8" value="${o.isHub}"/>`),i.push(`          <attvalue for="n9" value="${o.isGateway}"/>`),i.push(`          <attvalue for="n10" value="${o.isBackbone}"/>`),i.push(`          <attvalue for="n11" value="${o.isMobile}"/>`),i.push(`          <attvalue for="n12" value="${o.isGhost}"/>`),i.push(`          <attvalue for="n13" value="${o.isZeroHop}"/>`),i.push(`          <attvalue for="n14" value="${o.prefixConfidence}"/>`),null!=o.avgRssi&&i.push(`          <attvalue for="n15" value="${o.avgRssi}"/>`),null!=o.avgSnr&&i.push(`          <attvalue for="n16" value="${o.avgSnr}"/>`),i.push("        </attvalues>"),null==o.latitude||null==o.longitude||0===o.latitude&&0===o.longitude||i.push(`        <viz:position x="${o.longitude}" y="${o.latitude}" z="0.0"/>`),i.push("      </node>")}i.push("    </nodes>"),i.push(""),i.push("    <edges>");for(const o of e.validatedEdges){const r=e.nodeMetrics;if(!t&&((null==(s=r.get(o.fromHash))?void 0:s.isGhost)||(null==(n=r.get(o.toHash))?void 0:n.isGhost)))continue;const l=e.edgeBetweenness.get(o.key)??0;i.push(`      <edge id="${De(o.key)}" source="${De(o.fromHash)}" target="${De(o.toHash)}" weight="${o.strength}">`),i.push("        <attvalues>"),i.push(`          <attvalue for="e0" value="${o.packetCount}"/>`),i.push(`          <attvalue for="e1" value="${o.certainCount}"/>`),i.push(`          <attvalue for="e2" value="${o.avgConfidence}"/>`),i.push(`          <attvalue for="e3" value="${o.symmetryRatio}"/>`),i.push(`          <attvalue for="e4" value="${o.dominantDirection}"/>`),i.push(`          <attvalue for="e5" value="${a.has(o.key)}"/>`),i.push(`          <attvalue for="e6" value="${o.isLoopEdge??!1}"/>`),i.push(`          <attvalue for="e7" value="${o.isDirectPathEdge}"/>`),i.push(`          <attvalue for="e8" value="${o.isZeroHop??!1}"/>`),i.push(`          <attvalue for="e9" value="${l}"/>`),i.push(`          <attvalue for="e10" value="${o.floodCount}"/>`),i.push(`          <attvalue for="e11" value="${o.directCount}"/>`),i.push("        </attvalues>"),i.push("      </edge>")}return i.push("    </edges>"),i.push("  </graph>"),i.push("</gexf>"),i.join("\n")}function Ie(e,t,s){const n={meta:{exportedAt:(new Date).toISOString(),pymcConsoleVersion:l,nodeCount:e.nodeMetrics.size,edgeCount:e.validatedEdges.length,communityCount:e.communityCount,loopCount:e.loops.length,backboneEdgeCount:e.backboneEdges.length,hubNodes:e.hubNodes.length,gatewayNodes:e.gatewayNodes.length,mobileNodes:e.mobileNodes.length,ghostNodes:e.discoveredNodes.filter(e=>e.isLikelyReal).length},nodes:He(e,t),edges:Pe(e,s),pathHealth:e.pathHealth.map(e=>({pathKey:e.pathKey,hops:e.hops,healthScore:e.healthScore,weakestLinkKey:e.weakestLinkKey,weakestLinkConfidence:e.weakestLinkConfidence,avgEdgeCertainty:e.avgEdgeCertainty,observationTrend:e.observationTrend,alternatePathsCount:e.alternatePathsCount,estimatedLatencyMs:e.estimatedLatencyMs,observationCount:e.observationCount,routeType:e.routeType,lastSeen:e.lastSeen,involvesHub:e.involvesHub})),txDelayRecommendations:Array.from(e.txDelayRecommendations.entries()).map(([t,s])=>{var n,a;return{nodeHash:t,nodePrefix:(null==(n=e.nodeMetrics.get(t))?void 0:n.prefix)??"",nodeName:(null==(a=e.nodeMetrics.get(t))?void 0:a.name)??null,networkRole:s.networkRole,floodFactor:s.floodFactor,directFactor:s.directFactor,floodSlots:s.floodSlots,directSlots:s.directSlots,trafficIntensity:s.trafficIntensity,collisionRisk:s.collisionRisk,confidence:s.confidence,adjustment:s.adjustment,dataConfidence:s.dataConfidence,rationale:s.rationale}}),loops:e.loops.map(e=>({id:e.id,nodes:e.nodes,edgeKeys:e.edgeKeys,size:e.size,avgCertainCount:e.avgCertainCount,minCertainCount:e.minCertainCount,includesLocal:e.includesLocal,strength:e.strength})),disambiguationStats:{totalPrefixes:e.disambiguationStats.totalPrefixes,unambiguousPrefixes:e.disambiguationStats.unambiguousPrefixes,collisionPrefixes:e.disambiguationStats.collisionPrefixes,collisionRate:e.disambiguationStats.collisionRate,avgConfidence:e.disambiguationStats.avgConfidence},viterbiStats:{totalPaths:e.viterbiStats.totalPaths,pathsWithGhosts:e.viterbiStats.pathsWithGhosts,avgPathConfidence:e.viterbiStats.avgPathConfidence,tracePacketsProcessed:e.viterbiStats.tracePacketsProcessed,pathPacketsProcessed:e.viterbiStats.pathPacketsProcessed,distantEdgesDiscovered:e.viterbiStats.distantEdgesDiscovered,duplicateGroupsFound:e.viterbiStats.duplicateGroupsFound,echolocationEdgesInferred:e.viterbiStats.echolocationEdgesInferred}};return JSON.stringify(n,null,2)}function Ge(e,t){const s=t.includeGhosts??!0,n=t.includeWeakEdges??!1;switch(t.format){case"csv":{let a,i;switch(t.dataset){case"nodes":case"full":default:a=function(e,t){const s=[];for(const n of e.nodeMetrics.values())!t&&n.isGhost||s.push(Me(n));return Se(Re,s)}(e,s),i="mesh-nodes";break;case"edges":a=function(e,t){const s=t?e.edges:e.validatedEdges,n=new Set(e.backboneEdges),a=s.map(t=>function(e,t,s){var n,a;return[e.fromHash,e.toHash,e.key,e.packetCount,e.certainCount,e.avgConfidence.toFixed(4),e.strength.toFixed(4),e.forwardCount,e.reverseCount,e.symmetryRatio.toFixed(4),e.dominantDirection,e.floodCount,e.directCount,e.isDirectPathEdge,e.isZeroHop??!1,e.isLoopEdge??!1,e.isCertain,(null==(n=e.avgRssi)?void 0:n.toFixed(1))??"",(null==(a=e.avgSnr)?void 0:a.toFixed(1))??"",e.avgRecency.toFixed(4),e.hopDistanceFromLocal,(t.get(e.key)??0).toFixed(6),s.has(e.key)]}(t,e.edgeBetweenness,n));return Se(Be,a)}(e,n),i="mesh-edges";break;case"pathHealth":a=function(e){const t=e.pathHealth.map(Ae);return Se(Ee,t)}(e),i="mesh-path-health";break;case"txDelay":a=function(e){const t=[];for(const[s,n]of e.txDelayRecommendations)t.push($e(s,n,e.nodeMetrics));return Se(ze,t)}(e),i="mesh-tx-delay"}return{content:a,filename:Fe(i,"csv"),mimeType:"text/csv"}}case"gexf":return{content:Te(e,s),filename:Fe("mesh-topology","gexf"),mimeType:"application/xml"};default:return{content:Ie(e,s,n),filename:Fe("mesh-topology","json"),mimeType:"application/json"}}}function Oe(e,t,s=1){const{n:n,adjList:a,totalWeight:i,degree:o}=e;if(0===i)return!1;const r=2*i,l=new Float64Array(n);for(let u=0;u<n;u++)l[t[u]]+=o[u];let c=!1,d=!0;for(;d;){d=!1;for(let e=0;e<n;e++){const n=t[e],u=o[e];if(0===u)continue;const m=new Map;for(const{j:s,w:i}of a[e]){const e=t[s];m.set(e,(m.get(e)??0)+i)}const h=-(m.get(n)??0)/i+s*(u*(l[n]-u))/(r*i);let x=n,p=0;for(const[e,t]of m){if(e===n)continue;const a=h+(t/i-s*(u*l[e])/(r*i));a>p+1e-7&&(p=a,x=e)}x!==n&&(l[n]-=u,l[x]+=u,t[e]=x,d=!0,c=!0)}}return c}function Ze(e,t){const{n:s,adjList:n}=e,a=new Set;for(let h=0;h<s;h++)a.add(t[h]);const i=Array.from(a).sort((e,t)=>e-t),o=new Map;for(let h=0;h<i.length;h++)o.set(i[h],h);const r=i.length,l=new Int32Array(s);for(let h=0;h<s;h++)l[h]=o.get(t[h]);const c=new Map,d=new Float64Array(r);let u=0;for(let h=0;h<s;h++){const e=l[h];for(const{j:t,w:s}of n[h]){const n=l[t];if(e===n)continue;const a=e<=n?`${e}-${n}`:`${n}-${e}`;c.set(a,(c.get(a)??0)+s)}}const m=Array.from({length:r},()=>[]);for(const[h,x]of c){const[e,t]=h.split("-").map(Number),s=x/2;m[e].push({j:t,w:s}),m[t].push({j:e,w:s}),d[e]+=s,d[t]+=s,u+=s}return{newGraph:{n:r,adjList:m,totalWeight:u,degree:Array.from(d)},mapping:l}}function We(e,t,s){const n=(null==s?void 0:s.resolution)??1,a=(null==s?void 0:s.kWeight)??1,i=t.length;if(0===i)return{communities:new Map,numCommunities:0,modularity:0,passes:0};if(1===i)return{communities:new Map([[t[0],0]]),numCommunities:1,modularity:0,passes:0};const{graph:o}=function(e,t,s=1){const n=t.length,a=new Map;for(let l=0;l<n;l++)a.set(t[l],l);const i=Array.from({length:n},()=>[]),o=new Array(n).fill(0);let r=0;for(const l of e){const e=a.get(l.fromHash),t=a.get(l.toHash);if(void 0===e||void 0===t)continue;if(e===t)continue;const n=Math.max(.01,(l.certainCount+1)*l.avgConfidence*l.strength),c=1===s?n:Math.pow(n,s);i[e].push({j:t,w:c}),i[t].push({j:e,w:c}),o[e]+=c,o[t]+=c,r+=c}return{graph:{n:n,adjList:i,totalWeight:r,degree:o},hashToIdx:a}}(e,t,a);let r=o,l=new Int32Array(i);for(let v=0;v<i;v++)l[v]=v;const c=[];let d=0;for(;d<10&&Oe(r,l,n);){d++;const{newGraph:e,mapping:t}=Ze(r,l);if(c.push(t),e.n>=r.n)break;r=e,l=new Int32Array(e.n);for(let s=0;s<e.n;s++)l[s]=s}const u=new Int32Array(i);for(let v=0;v<i;v++)u[v]=v;for(const v of c)for(let e=0;e<i;e++)u[e]=v[u[e]];for(let v=0;v<i;v++)u[v]=l[u[v]];const m=new Set;for(let v=0;v<i;v++)m.add(u[v]);const h=Array.from(m).sort((e,t)=>e-t),x=new Map;for(let v=0;v<h.length;v++)x.set(h[v],v);const p=new Map;for(let v=0;v<i;v++)p.set(t[v],x.get(u[v]));const g=new Int32Array(i);for(let v=0;v<i;v++)g[v]=x.get(u[v]);const f=function(e,t,s=1){const{n:n,adjList:a,totalWeight:i,degree:o}=e;if(0===i)return 0;const r=2*i;let l=0;for(let c=0;c<n;c++)for(const{j:e,w:n}of a[c])t[c]===t[e]&&(l+=n-s*(o[c]*o[e])/r);return l/r}(o,g,n);return{communities:p,numCommunities:h.length,modularity:f,passes:d}}const Ke={7:-124,8:-127,9:-130,10:-133,11:-135.5,12:-137},Ve={62.5:3,125:0,250:-3,500:-6},_e={5:0,6:-.6,7:-1.1,8:-1.5};function Ue(e,t){if(e<=0)return 0;const s=1e6*t;return 20*Math.log10(e)+20*Math.log10(s)+20*Math.log10(4*Math.PI/299792458)}function Xe(e,t,s=5){return(Ke[e]??Ke[12])+(Ve[t]??0)+(_e[s]??0)}function Qe(e,t=6){return 10*Math.log10(e)-174+t}function qe(e){return e>=20?"excellent":e>=10?"good":e>=3?"fair":e>=0?"marginal":"critical"}function Je(e){return e>=15?"anomalous-good":e>=5?"better":e>=-5?"expected":e>=-20?"worse":"anomalous-bad"}function Ye(e,t,s,n,a){const i=n.tx_power??22,o=n.spreading_factor??12,r=n.coding_rate??5,l=n.frequency??0,c=l>1e5?l/1e6:l||915,d=n.bandwidth??0,u=d>1e3?d/1e3:d||125,m=(null==a?void 0:a.sensitivityOverrideDbm)??Xe(o,u,r);let h=null,x=null;t&&s&&I(t.latitude??void 0,t.longitude??void 0)&&I(s.latitude??void 0,s.longitude??void 0)&&(h=G(t.latitude,t.longitude,s.latitude,s.longitude),x=h/1e3);let p=null,g=null;null!=h&&h>0&&(p=Ue(h,c),g=i+2.15+2.15-p);const f=e.avgRssi??null,v=e.avgSnr??null;let b=null,y=null;null!=f&&null!=g&&(b=f-g,y=Je(b));let j=null,N=null;null!=f&&(j=f-m,N=qe(j));const w=null!=f,C="anomalous-good"===y||"anomalous-bad"===y;return{edgeKey:e.key,fromHash:e.fromHash,toHash:e.toHash,distanceM:h,distanceKm:x,fsplDb:p,theoreticalRxPowerDbm:g,observedRssiDbm:f,observedSnrDb:v,deviationDb:b,deviationClass:y,marginDb:j,marginClass:N,sensitivityDbm:m,txPowerDbm:i,frequencyMhz:c,spreadingFactor:o,bandwidthKhz:u,noiseFloorDbm:null,isZeroHop:e.isZeroHop??!1,isTraceEstimated:!1,hasData:w,isAnomalous:C}}function et(e,t,s,n,a=22,i){var o,r;const l=e.traceQuality;if(!l)return null;let c=null;if(c=null!=l.forward&&null!=l.reverse?Math.min(l.forward.mean,l.reverse.mean):(null==(o=l.forward)?void 0:o.mean)??(null==(r=l.reverse)?void 0:r.mean)??null,null==c)return null;const d=n.spreading_factor??12,u=n.coding_rate??5,m=n.bandwidth??0,h=m>1e3?m/1e3:m||125,x=1e3*h,p=n.frequency??0,g=p>1e5?p/1e6:p||915,f=(null==i?void 0:i.sensitivityOverrideDbm)??Xe(d,h,u),v=(null==i?void 0:i.observedNoiseFloorDbm)??Qe(x),b=v+c;let y=null,j=null;t&&s&&I(t.latitude??void 0,t.longitude??void 0)&&I(s.latitude??void 0,s.longitude??void 0)&&(y=G(t.latitude,t.longitude,s.latitude,s.longitude),j=y/1e3);let N=null,w=null;null!=y&&y>0&&(N=Ue(y,g),w=a+2.15+2.15-N);let C=null,k=null;null!=w&&(C=b-w,k=Je(C));const S=b-f,D=qe(S);return{edgeKey:e.key,fromHash:e.fromHash,toHash:e.toHash,distanceM:y,distanceKm:j,fsplDb:N,theoreticalRxPowerDbm:w,observedRssiDbm:b,observedSnrDb:c,deviationDb:C,deviationClass:k,marginDb:S,marginClass:D,sensitivityDbm:f,noiseFloorDbm:v,txPowerDbm:a,frequencyMhz:g,spreadingFactor:d,bandwidthKhz:h,isZeroHop:!1,isTraceEstimated:!0,hasData:!0,isAnomalous:"anomalous-good"===k||"anomalous-bad"===k}}const tt={"anomalous-good":"#2DD4BF",better:"#34D399",expected:"#9CA3AF",worse:"#FB923C","anomalous-bad":"#EF4444"},st={excellent:"#34D399",good:"#A3E635",fair:"#FBBF24",marginal:"#FB923C",critical:"#EF4444"};function nt(e,t="margin"){return e.hasData?"deviation"===t?e.deviationClass?tt[e.deviationClass]:"#505058":e.marginClass?st[e.marginClass]:"#505058":"#505058"}function at(e,t=.5,s=4){return null==e.marginDb?t:t+Math.max(0,Math.min(1,e.marginDb/40))*(s-t)}let it=0;function ot(){return`ta-${++it}-${Date.now()}`}function rt(e){return{standard:0,ghost:1,mobile:2,neighbor:3,backbone:4,gateway:5,hub:6,local:7}[e]??0}class lt{constructor(e=200){t(this,"prevSnapshot",null),t(this,"log",[]),t(this,"maxLog"),this.maxLog=e}update(e,t){const s=function(e){var t,s;const n=new Set;for(const u of e.edges)n.add(u.key);const a=new Map,i=new Map,o=new Map,r=new Set;for(const[u,m]of e.nodeMetrics)a.set(u,m.betweenness),i.set(u,m.communityId),o.set(u,m.nodeClass),r.add(u);const l=new Set;for(const u of e.discoveredNodes)u.isLikelyReal&&l.add(u.prefix);const c=new Map,d=new Map;for(const u of e.edges)(null==(t=u.traceQuality)?void 0:t.composite)&&c.set(u.key,u.traceQuality.composite.mean),null!=(null==(s=u.traceQuality)?void 0:s.asymmetryDb)&&d.set(u.key,u.traceQuality.asymmetryDb);return{timestamp:Date.now(),edgeKeys:n,betweenness:a,communities:i,nodeClasses:o,ghostPrefixes:l,nodeHashes:r,traceSnr:c,traceAsymmetry:d}}(e);if(!this.prevSnapshot)return this.prevSnapshot=s,{anomalies:[],categoryCounts:{"edge-appeared":0,"edge-disappeared":0,"ghost-appeared":0,"ghost-disappeared":0,"betweenness-shift":0,"community-change":0,"class-change":0,"node-appeared":0,"node-disappeared":0,"snr-degradation":0,"asymmetry-shift":0},severityCounts:{info:0,warning:0,critical:0},totalCount:0,timestamp:Date.now()};const n=function(e,t,s){const n=Date.now(),a=[],i=e=>(null==s?void 0:s.get(e))??null;for(const d of t.edgeKeys)if(!e.edgeKeys.has(d)){const[e,t]=d.split("-"),s=i(e)??(null==e?void 0:e.slice(0,6)),o=i(t)??(null==t?void 0:t.slice(0,6));a.push({id:ot(),detectedAt:n,category:"edge-appeared",severity:"info",description:`New edge: ${s} ↔ ${o}`,edgeKey:d})}for(const d of e.edgeKeys)if(!t.edgeKeys.has(d)){const[e,t]=d.split("-"),s=i(e)??(null==e?void 0:e.slice(0,6)),o=i(t)??(null==t?void 0:t.slice(0,6));a.push({id:ot(),detectedAt:n,category:"edge-disappeared",severity:"warning",description:`Edge lost: ${s} ↔ ${o}`,edgeKey:d})}for(const d of t.nodeHashes)if(!e.nodeHashes.has(d)){const e=i(d);a.push({id:ot(),detectedAt:n,category:"node-appeared",severity:"info",description:`Node appeared: ${e??d.slice(0,8)}`,nodeHash:d,nodeName:e??void 0})}for(const d of e.nodeHashes)if(!t.nodeHashes.has(d)){const e=i(d);a.push({id:ot(),detectedAt:n,category:"node-disappeared",severity:"warning",description:`Node dropped: ${e??d.slice(0,8)}`,nodeHash:d,nodeName:e??void 0})}for(const d of t.ghostPrefixes)e.ghostPrefixes.has(d)||a.push({id:ot(),detectedAt:n,category:"ghost-appeared",severity:"info",description:`Ghost node discovered: ${d.toUpperCase()}`});for(const d of e.ghostPrefixes)t.ghostPrefixes.has(d)||a.push({id:ot(),detectedAt:n,category:"ghost-disappeared",severity:"info",description:`Ghost node resolved: ${d.toUpperCase()}`});for(const[d,u]of t.traceSnr){const t=e.traceSnr.get(d);if(void 0===t)continue;const s=t-u;s>=3&&a.push({id:ot(),detectedAt:n,category:"snr-degradation",severity:s>=6?"critical":"warning",description:`SNR dropped ${s.toFixed(1)} dB on edge ${d.slice(0,13)}`,edgeKey:d,previousValue:t,currentValue:u})}for(const[d,u]of t.traceAsymmetry){const t=e.traceAsymmetry.get(d);if(void 0===t)continue;const s=u-t;s>=4&&a.push({id:ot(),detectedAt:n,category:"asymmetry-shift",severity:s>=8?"critical":"warning",description:`Asymmetry grew ${s.toFixed(1)} dB on edge ${d.slice(0,13)}`,edgeKey:d,previousValue:t,currentValue:u})}for(const[d,u]of t.betweenness){const t=e.betweenness.get(d);if(void 0===t)continue;const s=Math.abs(u-t);if(s>=.15){const e=i(d),o=u>t?"increased":"decreased";a.push({id:ot(),detectedAt:n,category:"betweenness-shift",severity:s>=.3?"critical":"warning",description:`${e??d.slice(0,8)} betweenness ${o}: ${t.toFixed(3)} → ${u.toFixed(3)}`,nodeHash:d,nodeName:e??void 0,previousValue:t,currentValue:u})}}for(const[d,u]of t.communities){const t=e.communities.get(d);if(void 0!==t&&u!==t){const e=i(d);a.push({id:ot(),detectedAt:n,category:"community-change",severity:"info",description:`${e??d.slice(0,8)} moved: community #${t} → #${u}`,nodeHash:d,nodeName:e??void 0,previousValue:t,currentValue:u})}}for(const[d,u]of t.nodeClasses){const t=e.nodeClasses.get(d);if(void 0!==t&&u!==t){const e=i(d),s=rt(u)>rt(t);a.push({id:ot(),detectedAt:n,category:"class-change",severity:s?"warning":"info",description:`${e??d.slice(0,8)} ${s?"promoted":"changed"}: ${t} → ${u}`,nodeHash:d,nodeName:e??void 0,previousValue:t,currentValue:u})}}const o={},r={},l=["edge-appeared","edge-disappeared","ghost-appeared","ghost-disappeared","betweenness-shift","community-change","class-change","node-appeared","node-disappeared","snr-degradation","asymmetry-shift"],c=["info","warning","critical"];for(const d of l)o[d]=0;for(const d of c)r[d]=0;for(const d of a)o[d.category]++,r[d.severity]++;return a.sort((e,t)=>t.detectedAt-e.detectedAt),{anomalies:a,categoryCounts:o,severityCounts:r,totalCount:a.length,timestamp:n}}(this.prevSnapshot,s,t);this.prevSnapshot=s;try{!function(e,t){var s,n,a;const i=t.edgeMap,o=t.nodeMetrics,r=new Set(t.backboneEdges??[]);for(const l of e){if(l.edgeKey&&("edge-appeared"===l.category||"edge-disappeared"===l.category)){const e=null==i?void 0:i.get(l.edgeKey),t=l.edgeKey.split("-"),c=t[0],d=t[1],u=c?null==o?void 0:o.get(c):void 0,m=d?null==o?void 0:o.get(d):void 0;l.edgeDetail=e?{fromName:(null==u?void 0:u.name)??null,toName:(null==m?void 0:m.name)??null,fromClass:(null==u?void 0:u.nodeClass)??null,toClass:(null==m?void 0:m.nodeClass)??null,packetCount:e.packetCount,confidence:e.avgConfidence,symmetryRatio:e.symmetryRatio,isBackbone:r.has(l.edgeKey),isLoop:e.isLoopEdge??!1,isZeroHop:e.isZeroHop??!1,isDirectPath:e.isDirectPathEdge,avgRssi:e.avgRssi??null,avgSnr:e.avgSnr??null,fromBetweenness:(null==u?void 0:u.betweenness)??null,toBetweenness:(null==m?void 0:m.betweenness)??null,traceCompositeSnr:(null==(n=null==(s=e.traceQuality)?void 0:s.composite)?void 0:n.mean)??null,traceAsymmetryDb:(null==(a=e.traceQuality)?void 0:a.asymmetryDb)??null}:{fromName:(null==u?void 0:u.name)??null,toName:(null==m?void 0:m.name)??null,fromClass:(null==u?void 0:u.nodeClass)??null,toClass:(null==m?void 0:m.nodeClass)??null,packetCount:0,confidence:0,symmetryRatio:0,isBackbone:!1,isLoop:!1,isZeroHop:!1,isDirectPath:!1,avgRssi:null,avgSnr:null,fromBetweenness:(null==u?void 0:u.betweenness)??null,toBetweenness:(null==m?void 0:m.betweenness)??null,traceCompositeSnr:null,traceAsymmetryDb:null}}if(l.nodeHash){const e=null==o?void 0:o.get(l.nodeHash);e&&(l.nodeDetail=ct(e))}}}(n.anomalies,e)}catch(a){console.warn("[TopologyAnomalyTracker] Enrichment failed, anomalies logged without detail:",a)}return this.log.unshift(...n.anomalies),this.log.length>this.maxLog&&(this.log.length=this.maxLog),n}getLog(){return this.log}getFiltered(e){const t=Date.now();return this.log.filter(s=>!(e.category&&s.category!==e.category||e.severity&&s.severity!==e.severity||e.nodeHash&&s.nodeHash!==e.nodeHash||e.maxAge&&t-s.detectedAt>e.maxAge))}clear(){this.log=[],this.prevSnapshot=null}}function ct(e){return{nodeClass:e.nodeClass,degree:e.degree,betweenness:e.betweenness,activityLevel:e.activityLevel,isZeroHop:e.isZeroHop,avgRssi:e.avgRssi,avgSnr:e.avgSnr,communityId:e.communityId,packetCount:e.packetCount,connectionCount:e.degree}}function dt(e){if(e.length<2)return 0;const t=e.length;let s=0,n=0,a=0,i=0;for(let r=0;r<t;r++)s+=r,n+=e[r],a+=r*e[r],i+=r*r;const o=t*i-s*s;return 0===o?0:(t*a-s*n)/o}const ut=.15,mt=.15,ht=.15;function xt(e,t,s){if(e.observationCount<5)return null;const n=[];let a=0;e.observationTrend<0&&(a=Math.abs(e.observationTrend),n.push({name:"Declining usage",description:e.observationTrend<-.3?"Traffic rapidly declining":"Traffic gradually declining",score:a,weight:.3}));const i=1-Math.min(1,e.avgEdgeCertainty);i>.3&&n.push({name:"Weak link certainty",description:e.weakestLinkKey?`Weakest: ${e.weakestLinkConfidence<.3?"very low":"low"} confidence`:`Average certainty: ${(100*e.avgEdgeCertainty).toFixed(0)}%`,score:i,weight:.25});let o=0;0===e.alternatePathsCount?(o=1,n.push({name:"No alternate paths",description:"Single route to destination — no failover available",score:o,weight:ut})):1===e.alternatePathsCount&&(o=.5,n.push({name:"Limited redundancy",description:"Only 1 alternate path available",score:o,weight:ut}));let r=0;if(e.weakestLinkKey){const a=t.get(e.weakestLinkKey),i=(null==a?void 0:a.avgRssi)??null,o=e.weakestLinkTraceSnr;if(null!=i){const e=i-s;e<3?(r=1,n.push({name:"Signal near sensitivity",description:`Weakest link: ${e.toFixed(1)} dB margin (< 3 dB)`,score:r,weight:mt})):e<10&&(r=1-(e-3)/7,n.push({name:"Low signal margin",description:`Weakest link: ${e.toFixed(1)} dB margin`,score:r,weight:mt}))}else null!=o&&o<5&&(r=o<-5?1:o<0?.7:.4,n.push({name:"Low trace SNR",description:`Weakest link trace SNR: ${o.toFixed(1)} dB`,score:r,weight:mt}))}let l=0;if(e.weakestLinkKey){const s=t.get(e.weakestLinkKey),a=null==s?void 0:s.traceQuality;(null==a?void 0:a.composite)&&(a.composite.mean<0?(l=.8,n.push({name:"Trace SNR negative",description:`Composite trace SNR: ${a.composite.mean.toFixed(1)} dB (negative)`,score:l,weight:ht})):a.composite.stdDev>4?(l=.6,n.push({name:"Unstable trace SNR",description:`High variance: σ=${a.composite.stdDev.toFixed(1)} dB`,score:l,weight:ht})):null!=a.asymmetryDb&&a.asymmetryDb>8&&(l=.5,n.push({name:"High SNR asymmetry",description:`Bidirectional asymmetry: ${a.asymmetryDb.toFixed(1)} dB`,score:l,weight:ht})))}const c=.3*a+.25*i+o*ut+r*mt+l*ht;if(c<.35)return null;let d,u;return c>=.75?(d="critical",u="imminent"):c>=.55?(d="high",u="near-term"):(d="moderate",u="watch"),{pathKey:e.pathKey,hops:e.hops,riskScore:Math.round(100*c)/100,riskLevel:d,factors:n,weakestEdgeKey:e.weakestLinkKey,healthScore:e.healthScore,observationTrend:e.observationTrend,alternatePathsCount:e.alternatePathsCount,urgency:u}}let pt=100;function gt(){return++pt}const ft="meshgraph-panel-";function vt(e){try{const t=localStorage.getItem(ft+e);return t?JSON.parse(t):null}catch{return null}}function bt({id:e,title:t,icon:a,open:i,onClose:o,defaultPosition:r,defaultSize:l,minSize:c={width:180,height:120},maxSize:d,autoHeight:u=!1,headerActions:m,children:h}){const x=O(),p=s.useRef(null),g=s.useRef(null),f=s.useMemo(()=>{const t=vt(e);return t?{x:t.x,y:t.y,w:t.w,h:u?l.height:t.h,minimized:t.minimized}:{x:r.x,y:r.y,w:l.width,h:l.height,minimized:!1}},[e]),[v,b]=s.useState({w:f.w,h:f.h}),[y,j]=s.useState(f.minimized),[N,w]=s.useState(()=>gt()),[C,k]=s.useState({x:f.x,y:f.y});s.useLayoutEffect(()=>{const t=p.current;if(!i||!t)return;const s=t.getBoundingClientRect();if(s.width<1||s.height<1)return;const n=vt(e),a=(o=(null==n?void 0:n.x)??f.x,r=(null==n?void 0:n.y)??f.y,l=(null==n?void 0:n.w)??v.w,c=s.width,d=s.height,{x:Math.max(8,Math.min(o,Math.max(8,c-l-8))),y:Math.max(8,Math.min(r,Math.max(8,d-36)))});var o,r,l,c,d;k(a)},[i,e]);const[S,D]=s.useState(!1),L=s.useRef({startX:0,startY:0,startW:0,startH:0,edge:""}),F=s.useRef(),R=s.useCallback(()=>{F.current&&clearTimeout(F.current),F.current=setTimeout(()=>{const t=g.current;if(!t)return;const s=window.getComputedStyle(t),n=new DOMMatrix(s.transform);!function(e,t){try{localStorage.setItem(ft+e,JSON.stringify(t))}catch{}}(e,{x:n.m41,y:n.m42,w:v.w,h:v.h,minimized:y})},300)},[e,v.w,v.h,y]);s.useEffect(()=>{R()},[v,y,R]);const M=s.useCallback(()=>{w(gt())},[]),H=s.useCallback(()=>{j(e=>!e)},[]),B=s.useCallback((e,t)=>{e.preventDefault(),e.stopPropagation(),D(!0),L.current={startX:e.clientX,startY:e.clientY,startW:v.w,startH:v.h,edge:t},M();const s=e=>{const{startX:t,startY:s,startW:n,startH:a,edge:i}=L.current,o=e.clientX-t,r=e.clientY-s;let l=n,u=a;"e"!==i&&"se"!==i||(l=Math.max(c.width,n+o),d&&(l=Math.min(d.width,l))),"s"!==i&&"se"!==i||(u=Math.max(c.height,a+r),d&&(u=Math.min(d.height,u))),b({w:l,h:u})},n=()=>{D(!1),window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",n)};window.addEventListener("pointermove",s),window.addEventListener("pointerup",n)},[v,c,d,M]);return n.jsx("div",{ref:p,className:"absolute inset-0 pointer-events-none",style:{zIndex:N},children:n.jsx(Z,{children:i&&n.jsxs(W.div,{ref:g,drag:!S,dragControls:x,dragConstraints:p,dragElastic:.05,dragMomentum:!1,dragListener:!1,initial:{opacity:0,scale:.96,x:C.x,y:C.y},animate:{opacity:1,scale:1,x:C.x,y:C.y},exit:{opacity:0,scale:.96},transition:{duration:.15},onPointerDown:M,className:"absolute top-0 left-0 pointer-events-auto",style:{width:v.w,touchAction:"none"},children:[n.jsxs("div",{className:"surface-elevated radius-inset shadow-xl overflow-hidden flex flex-col",style:{maxHeight:y?void 0:u?"80vh":v.h},children:[n.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1.5 border-b border-edge-subtle cursor-grab active:cursor-grabbing select-none shrink-0",onPointerDown:e=>{M(),x.start(e)},children:[n.jsx(K,{className:"w-3 h-3 text-fg-muted/50 shrink-0"}),a&&n.jsx("span",{className:"text-fg-muted shrink-0 [&>svg]:w-3 [&>svg]:h-3",children:a}),n.jsx("span",{className:"text-[11px] font-medium text-fg-primary flex-1 truncate",children:t}),m,n.jsx("button",{onClick:H,className:"p-0.5 radius-badge hover-bg transition-base",title:y?"Expand":"Minimize",children:y?n.jsx(V,{className:"w-2.5 h-2.5 text-fg-muted"}):n.jsx(_,{className:"w-2.5 h-2.5 text-fg-muted"})}),n.jsx("button",{onClick:o,className:"p-0.5 radius-badge hover-bg transition-base",title:"Close",children:n.jsx(U,{className:"w-2.5 h-2.5 text-fg-muted"})})]}),n.jsx(Z,{initial:!1,children:!y&&n.jsx(W.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.15},className:"overflow-hidden",children:n.jsx("div",{className:"overflow-y-auto",style:{maxHeight:u?"70vh":void 0},children:h})})})]}),!y&&!u&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute top-0 -right-1 w-2 h-full cursor-ew-resize",onPointerDown:e=>B(e,"e")}),n.jsx("div",{className:"absolute -bottom-1 left-0 w-full h-2 cursor-ns-resize",onPointerDown:e=>B(e,"s")}),n.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 cursor-nwse-resize",onPointerDown:e=>B(e,"se"),children:n.jsxs("svg",{className:"w-full h-full text-fg-muted/30",viewBox:"0 0 12 12",children:[n.jsx("path",{d:"M10 2 L10 10 L2 10",fill:"none",stroke:"currentColor",strokeWidth:"1.5"}),n.jsx("path",{d:"M7 5 L7 7 L5 7",fill:"none",stroke:"currentColor",strokeWidth:"1"})]})})]})]})})})}const yt=[{target:"Graph",fn:"topology.edges",minStage:2,when:B},{target:"Graph",fn:"topology.edges",minStage:2,when:P},{target:"Graph",fn:"nodeMetrics",minStage:2},{target:"Graph",fn:"ghostNodes",minStage:2,when:B},{target:"Graph",fn:"_advertNodeType",minStage:1,when:E},{target:"Graph",fn:"pathHealth",minStage:2}];H(yt);const jt=800,Nt={critical:[N.red,N.red],poor:[N.orange,N.orange],fair:[N.amber,N.amber],good:[N.green,N.green],excellent:[N.blue,N.blue]},wt={active:1,recent:.85,stale:.45,inactive:.25},Ct=[N.purple,N.green,N.amber,N.red,N.blue,N.pink,N.teal,N.orange],kt=[N.purple,N.green,N.amber,N.red,N.blue,N.pink,N.teal,N.orange];function St(e,t,s){const n=(e,t)=>parseInt(e.slice(1+2*t,3+2*t),16);return`#${[0,1,2].map(a=>{return(i=a,Math.round(n(e,i)*s+n(t,i)*(1-s))).toString(16).padStart(2,"0");var i}).join("")}`}const Dt={zeroHop:St(N.amber,w[500],.55),directPath:St(N.teal,w[500],.55),loop:St(N.purple,w[500],.55),backbone:w[300],standard:w[500],standardDim:w[600],ghost:w[600]},Lt={zeroHop:St(N.amber,w[700],.5),directPath:St(N.teal,w[700],.5),loop:St(N.purple,w[700],.5),backbone:w[700],standard:w[400],standardDim:w[300],ghost:w[400]},Ft=!1,Rt=!0,Mt=!0,Ht=!0,Bt=!0,Pt=!0,Et={local:N.amber,hub:N.purple,gateway:N.blue,backbone:N.green,neighbor:N.pink,mobile:N.orange,ghost:w[400],standard:w[300]},At={local:N.amber,hub:N.purple,gateway:N.blue,backbone:N.green,neighbor:N.pink,mobile:N.orange,ghost:w[500],standard:w[600]},zt={local:"Your repeater — the home node running this dashboard",hub:"≥10% of last-hop traffic — dominant forwarder for your local node",gateway:"7-10% of last-hop traffic — significant relay node",backbone:"High betweenness centrality — critical path node connecting clusters",neighbor:"Zero-hop direct RF contact — no intermediate forwarders",mobile:"High path volatility — node appears and disappears frequently",ghost:"Unresolved prefix inferred by Viterbi HMM from path patterns",standard:"<7% of traffic — normal mesh participant"};function $t(e){const t=e.replace("#","");return[parseInt(t.slice(0,2),16),parseInt(t.slice(2,4),16),parseInt(t.slice(4,6),16)]}function Tt(e,t,s){const[n,a,i]=$t(e),[o,r,l]=$t(t),c=Math.max(0,Math.min(1,s)),d=Math.round(n*c+o*(1-c)),u=Math.round(a*c+r*(1-c)),m=Math.round(i*c+l*(1-c));return`#${d.toString(16).padStart(2,"0")}${u.toString(16).padStart(2,"0")}${m.toString(16).padStart(2,"0")}`}function It(e,t){return e.isZeroHop?"zero-hop":e.isDirectPathEdge?"direct-path":e.isLoopEdge?"loop":t.has(e.key)?"backbone":"standard"}function Gt(e,t,s){const n=s?Dt:Lt;switch(e){case"zero-hop":return n.zeroHop;case"direct-path":return n.directPath;case"loop":return n.loop;case"backbone":return n.backbone;case"ghost":return n.ghost;default:return t>=.7?n.standard:n.standardDim}}const Ot={"zero-hop":"Zero-Hop (Direct RF)","direct-path":"Direct Path (Unicast)",loop:"Redundant Loop",backbone:"Backbone",standard:"Standard",ghost:"Ghost (Inferred)"},Zt={"zero-hop":"Direct radio contact — no intermediate forwarders in path","direct-path":"Unicast-routed edge — verified via DIRECT route type packets",loop:"Redundant path — alternate route between the same endpoints exists",backbone:"High betweenness centrality — critical traffic flow edge",standard:"Normal mesh edge with moderate-to-high confidence",ghost:"Inferred connection from Viterbi HMM ghost node analysis"},Wt=s.memo(function({timeline:e}){const t=e.buckets;if(t.length<2)return null;const[s,a]=e.rssiRange,i=Math.max(1,a-s),[o,r]=e.snrRange,l=Math.max(1,r-o),c=198/(t.length-1),d=t.map((e,t)=>{const n=1+t*c,a=1+34*(1-(e.avgRssi-s)/i);return`${n.toFixed(1)},${a.toFixed(1)}`}).join(" "),u=t.map((e,t)=>{const s=1+t*c,n=1+34*(1-(e.avgSnr-o)/l);return`${s.toFixed(1)},${n.toFixed(1)}`}).join(" "),m=e.rssiTrend>.1?"↑":e.rssiTrend<-.1?"↓":"→",h=e.snrTrend>.1?"↑":e.snrTrend<-.1?"↓":"→",x=e.rssiTrend>.1?"#34D399":e.rssiTrend<-.1?"#EF4444":"#9CA3AF",p=e.snrTrend>.1?"#34D399":e.snrTrend<-.1?"#EF4444":"#9CA3AF",g=(e.timeSpanMs/36e5).toFixed(1),f=function(e){const t=e.rssiTrend<-.1,s=e.snrTrend<-.1,n=e.rssiTrend>.1,a=e.snrTrend>.1,i=e.rssiRange[1]-e.rssiRange[0],o=e.snrRange[1]-e.snrRange[0];return t&&s?{text:"Both RSSI and SNR declining — possible antenna degradation or increasing distance",color:"#EF4444"}:s&&!t?{text:"SNR declining while RSSI stable — likely RF interference or noise floor increase",color:"#F97316"}:t&&!s?{text:"RSSI declining while SNR stable — possible path obstruction or power change",color:"#F97316"}:n&&a?{text:"Signal improving — conditions favorable or antenna adjustment working",color:"#34D399"}:i>15||o>10?{text:"High signal variance — intermittent obstruction or multipath fading",color:"#FBBF24"}:{text:"Signal stable — no significant degradation detected",color:"#9CA3AF"}}(e);return n.jsxs("div",{className:"mt-2 pt-2 border-t border-edge-subtle/50",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx(k,{content:n.jsxs("div",{className:"max-w-xs space-y-1.5",children:[n.jsx("div",{className:"font-semibold text-fg-primary",children:"Signal Quality Over Time"}),n.jsx("div",{className:"text-fg-secondary text-[11px]",children:"Tracks RSSI (signal power) and SNR (signal-to-noise ratio) for zero-hop packets received directly from this neighbor. Reveals weather effects, interference, and antenna degradation."}),n.jsxs("div",{className:"pt-1 border-t border-edge-subtle/30 space-y-0.5 font-mono text-[10px]",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Samples"}),n.jsx("span",{className:"text-fg-primary tabular-nums",children:e.totalSamples})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Time span"}),n.jsxs("span",{className:"text-fg-primary tabular-nums",children:[g,"h"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Avg RSSI"}),n.jsxs("span",{className:"text-fg-primary tabular-nums",children:[e.avgRssi.toFixed(1)," dBm"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Avg SNR"}),n.jsxs("span",{className:"text-fg-primary tabular-nums",children:[e.avgSnr.toFixed(1)," dB"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"RSSI trend"}),n.jsxs("span",{className:"tabular-nums",style:{color:x},children:[e.rssiTrend>0?"+":"",e.rssiTrend.toFixed(3)," dBm/bucket"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"SNR trend"}),n.jsxs("span",{className:"tabular-nums",style:{color:p},children:[e.snrTrend>0?"+":"",e.snrTrend.toFixed(3)," dB/bucket"]})]})]}),n.jsxs("div",{className:"text-[10px] text-fg-muted italic",children:["Trend is linear regression slope across ",t.length," time buckets. ↑ = improving, ↓ = degrading, → = stable."]})]}),children:n.jsx("span",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Signal Timeline"})}),n.jsxs("span",{className:"text-[9px] text-fg-muted tabular-nums",children:[e.totalSamples," samples · ",g,"h"]})]}),n.jsxs("svg",{viewBox:"0 0 200 36",className:"w-full h-9",preserveAspectRatio:"none",children:[n.jsx("polyline",{points:d,fill:"none",stroke:"#60A5FA",strokeWidth:"1.5",strokeLinejoin:"round",strokeLinecap:"round",opacity:"0.8"}),n.jsx("polyline",{points:u,fill:"none",stroke:"#34D399",strokeWidth:"1",strokeLinejoin:"round",strokeLinecap:"round",opacity:"0.5",strokeDasharray:"3 2"})]}),n.jsxs("div",{className:"flex items-center justify-between text-[9px] mt-0.5",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:"flex items-center gap-0.5",children:[n.jsx("span",{className:"w-2.5 h-[1.5px] bg-[#60A5FA] rounded-full inline-block"}),n.jsx("span",{className:"text-fg-muted",children:"RSSI"}),n.jsx("span",{className:"tabular-nums",style:{color:x},children:m})]}),n.jsxs("span",{className:"flex items-center gap-0.5",children:[n.jsx("span",{className:"w-2.5 h-[1px] bg-[#34D399] rounded-full inline-block opacity-50",style:{borderTop:"1px dashed #34D399"}}),n.jsx("span",{className:"text-fg-muted",children:"SNR"}),n.jsx("span",{className:"tabular-nums",style:{color:p},children:h})]})]}),n.jsxs("div",{className:"flex items-center gap-2 text-fg-muted tabular-nums",children:[n.jsxs("span",{children:[s.toFixed(0),"…",a.toFixed(0)," dBm"]}),n.jsxs("span",{children:[o.toFixed(0),"…",r.toFixed(0)," dB"]})]})]}),n.jsx("div",{className:"mt-1 text-[9px] leading-tight",style:{color:f.color},children:f.text})]})}),Kt=s.memo(function({edge:e,onClose:t}){const[a,i]=s.useState(null);return s.useEffect(()=>{if(!e.isZeroHop&&"zero-hop"!==e.edgeType)return void i(null);const t=R.getState().packets,s=R.getState().cachedLocalHash??void 0,n=function(e,t,s,n,a=24){const i=function(e,t,s,n){var a;const i=[],o=t.replace(/^0x/i,"").slice(0,2).toLowerCase();for(const r of e){if(r.transmitted)continue;if(null==r.rssi||null==r.snr)continue;if(0===r.rssi&&0===r.snr)continue;const e=(null==(a=r.src_hash)?void 0:a.replace(/^0x/i,""))??"";if(e.slice(0,2).toLowerCase()!==o&&e!==t.replace(/^0x/i,""))continue;const s=r.original_path??r.forwarded_path??[],l=c(s,n),u=(null==l?void 0:l.effectiveLength)??0,m=r.route??r.route_type;let h=!1;h=null!=m&&d(m)?u<=1:0===u,h&&i.push({timestamp:1e3*r.timestamp,rssi:r.rssi,snr:r.snr})}if(i.sort((e,t)=>e.timestamp-t.timestamp),i.length>0&&i[0].timestamp<4102444800)for(const r of i)r.timestamp*=1e3;return i}(e,t,0,n);if(i.length<3)return null;const o=function(e,t=24){if(0===e.length)return[];const s=e[0].timestamp,n=e[e.length-1].timestamp-s;if(n<=0)return[{timestamp:s,avgRssi:e.reduce((e,t)=>e+t.rssi,0)/e.length,avgSnr:e.reduce((e,t)=>e+t.snr,0)/e.length,minRssi:Math.min(...e.map(e=>e.rssi)),maxRssi:Math.max(...e.map(e=>e.rssi)),minSnr:Math.min(...e.map(e=>e.snr)),maxSnr:Math.max(...e.map(e=>e.snr)),count:e.length}];const a=n/t,i=[];for(let r=0;r<t;r++)i.push({timestamp:s+(r+.5)*a,avgRssi:0,avgSnr:0,minRssi:1/0,maxRssi:-1/0,minSnr:1/0,maxSnr:-1/0,count:0});for(const r of e){const e=i[Math.min(t-1,Math.floor((r.timestamp-s)/a))];e.avgRssi+=r.rssi,e.avgSnr+=r.snr,e.minRssi=Math.min(e.minRssi,r.rssi),e.maxRssi=Math.max(e.maxRssi,r.rssi),e.minSnr=Math.min(e.minSnr,r.snr),e.maxSnr=Math.max(e.maxSnr,r.snr),e.count++}const o=[];for(const r of i)r.count>0&&(r.avgRssi/=r.count,r.avgSnr/=r.count,o.push(r));return o}(i,a);if(o.length<2)return null;let r=0,l=0,u=1/0,m=-1/0,h=1/0,x=-1/0;for(const c of i)r+=c.rssi,l+=c.snr,u=Math.min(u,c.rssi),m=Math.max(m,c.rssi),h=Math.min(h,c.snr),x=Math.max(x,c.snr);const p=dt(o.map(e=>e.avgRssi)),g=dt(o.map(e=>e.avgSnr)),f=i[0].timestamp,v=i[i.length-1].timestamp;return{buckets:o,totalSamples:i.length,rssiRange:[u,m],snrRange:[h,x],avgRssi:r/i.length,avgSnr:l/i.length,rssiTrend:p,snrTrend:g,timeSpanMs:v-f}}(t,e.source,e.target,s);i(n)},[e.source,e.target,e.isZeroHop,e.edgeType]),n.jsxs(W.div,{variants:$,initial:"hidden",animate:"visible",exit:"exit",className:"absolute inset-x-3 bottom-3 z-20 surface-elevated radius-inset shadow-xl",children:[n.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5 border-b border-edge-subtle/50",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[n.jsx(be,{className:"size-3.5 text-fg-muted shrink-0"}),n.jsxs("span",{className:"text-sm font-semibold text-fg-primary truncate",children:[e.fromName??e.source.slice(0,6)," → ",e.toName??e.target.slice(0,6)]}),n.jsxs("div",{className:"flex gap-1 shrink-0",children:[n.jsx(C,{color:"zinc",compact:!0,children:Ot[e.edgeType]}),e.isBackbone&&n.jsx(C,{color:"emerald",compact:!0,children:"BONE"}),e.isLoopEdge&&n.jsx(C,{color:"indigo",compact:!0,children:"LOOP"}),e.isGhost&&n.jsx(C,{color:"zinc",compact:!0,children:"GHOST"})]})]}),n.jsx(F,{plain:!0,onClick:t,title:"Close",className:"shrink-0",children:n.jsx(U,{className:"size-4"})})]}),n.jsxs("div",{className:"p-3 font-mono text-[11px]",children:[n.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[n.jsxs("div",{children:[n.jsx(k,{content:"Average disambiguation confidence across all observations of this edge",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Confidence"})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[(100*e.confidence).toFixed(0),"%"]})]}),n.jsxs("div",{children:[n.jsx(k,{content:"Observations where both endpoints had high-confidence disambiguation",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Certain"})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:e.certainCount.toLocaleString()})]}),n.jsxs("div",{children:[n.jsx(k,{content:"Total packets observed traversing this edge",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Packets"})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:e.packetCount.toLocaleString()})]}),n.jsxs("div",{children:[n.jsx(k,{content:"Combined certainCount × confidence metric for edge ranking",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Strength"})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:e.strength.toFixed(2)})]})]}),n.jsxs("div",{className:"grid grid-cols-4 gap-3 mt-2",children:[n.jsxs("div",{children:[n.jsx(k,{content:"Bidirectional balance (min/max) — 0 = one-way traffic, 1 = perfectly balanced",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Symmetry"})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:e.symmetryRatio.toFixed(2)})]}),n.jsxs("div",{children:[n.jsx(k,{content:"Dominant traffic flow direction between these nodes",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Direction"})}),n.jsx("div",{className:"text-fg-primary capitalize",children:e.dominantDirection})]}),n.jsxs("div",{children:[n.jsx(k,{content:"Forward (A→B) vs reverse (B→A) observation counts",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Fwd / Rev"})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[e.forwardCount," / ",e.reverseCount]})]}),n.jsxs("div",{children:[n.jsx(k,{content:"Routing method — broadcast flood vs unicast direct routing",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Flood / Direct"})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[e.floodCount," / ",e.directCount]})]})]}),(null!=e.avgRssi||null!=e.avgSnr)&&n.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-2 pt-2 border-t border-edge-subtle/50",children:[null!=e.avgRssi&&n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-fg-muted uppercase",children:"RSSI"}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[e.avgRssi.toFixed(1)," dBm"]})]}),null!=e.avgSnr&&n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-fg-muted uppercase",children:"SNR"}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[e.avgSnr.toFixed(1)," dB"]})]})]}),e.linkBudget&&n.jsxs("div",{className:"grid grid-cols-4 gap-3 mt-2 pt-2 border-t border-edge-subtle/50",children:[null!=e.linkBudget.distanceKm&&n.jsxs("div",{children:[n.jsx(k,{content:"Haversine distance between endpoint locations",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Distance"})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[e.linkBudget.distanceKm.toFixed(2)," km"]})]}),null!=e.linkBudget.fsplDb&&n.jsxs("div",{children:[n.jsx(k,{content:"Free Space Path Loss — theoretical signal attenuation over this distance at configured frequency",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"FSPL"})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[e.linkBudget.fsplDb.toFixed(1)," dB"]})]}),null!=e.linkBudget.marginDb&&n.jsxs("div",{children:[n.jsx(k,{content:"Link margin — observed RSSI minus receiver sensitivity. Positive = signal headroom above minimum.",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Margin"})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",style:{color:e.linkBudget.marginClass?st[e.linkBudget.marginClass]:void 0},children:[e.linkBudget.marginDb>0?"+":"",e.linkBudget.marginDb.toFixed(1)," dB"]})]}),null!=e.linkBudget.deviationDb&&n.jsxs("div",{children:[n.jsx(k,{content:"Deviation from theoretical FSPL — positive means better signal than free-space prediction",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"vs Theory"})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[e.linkBudget.deviationDb>0?"+":"",e.linkBudget.deviationDb.toFixed(1)," dB"]})]})]}),a&&n.jsx(Wt,{timeline:a})]})]})}),Vt=s.memo(function({node:e,onClose:t,egoMetrics:a,onExpandEgo:i,neighbors:o,onSelectNeighbor:r,txDelayRec:l}){const[c,d]=s.useState(!1),[u,m]=s.useState(!1);return n.jsxs(W.div,{variants:$,initial:"hidden",animate:"visible",exit:"exit",className:"absolute inset-x-3 bottom-3 z-20 surface-elevated radius-inset shadow-xl max-h-[60vh] flex flex-col",children:[n.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5 border-b border-edge-subtle/50",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[n.jsx("span",{className:"size-2 shrink-0 rounded-full",style:{backgroundColor:(L()?Et:At)[e.nodeClass]}}),n.jsx("code",{className:"text-sm font-semibold text-fg-primary shrink-0",children:e.prefix}),e.name&&n.jsx("span",{className:"text-sm text-fg-secondary truncate",children:e.name}),n.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.isLocal&&n.jsx(C,{color:"yellow",compact:!0,children:"LOCAL"}),e.isHub&&n.jsx(C,{color:"violet",compact:!0,children:"HUB"}),e.isGateway&&n.jsx(C,{color:"sky",compact:!0,children:"GW"}),e.isBackbone&&n.jsx(C,{color:"emerald",compact:!0,children:"BONE"}),e.isMobile&&n.jsx(C,{color:"orange",compact:!0,children:"MOB"}),e.isZeroHop&&n.jsx(C,{color:"amber",compact:!0,children:"RF"}),e.isGhost&&n.jsx(C,{color:"zinc",compact:!0,children:"GHOST"}),e.isInLoop&&n.jsx(C,{color:"indigo",compact:!0,children:"LOOP"})]})]}),n.jsx(F,{plain:!0,onClick:t,title:"Close",className:"shrink-0",children:n.jsx(U,{className:"size-4"})})]}),n.jsxs("div",{className:"p-3 font-mono text-[11px]",children:[n.jsx(T,{copy:!0,size:"compact",truncate:[10,6],className:"w-full mb-3",children:e.hash}),n.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[n.jsxs("div",{children:[n.jsx(k,{content:"Total connections (edges) to this node",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Degree"})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:e.degree})]}),n.jsxs("div",{children:[n.jsx(k,{content:"Inbound vs outbound edge count — indicates traffic directionality",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"In / Out"})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[e.inDegree," / ",e.outDegree]})]}),n.jsxs("div",{children:[n.jsx(k,{content:"Betweenness centrality (0–1) — how often this node lies on shortest paths. High value = critical relay.",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Between."})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:e.betweenness.toFixed(3)})]}),n.jsxs("div",{children:[n.jsx(k,{content:"Total packets observed involving this node",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Packets"})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:e.packetCount.toLocaleString()})]})]}),n.jsxs("div",{className:"grid grid-cols-4 gap-3 mt-2",children:[n.jsxs("div",{children:[n.jsx(k,{content:"Number of topology edges connected to this node",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Edges"})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:e.edgeCount})]}),n.jsxs("div",{children:[n.jsx(k,{content:"Community cluster assignment from graph partitioning algorithm",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Community"})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:["#",e.communityId]})]}),n.jsxs("div",{children:[n.jsx(k,{content:"Prefix disambiguation confidence — how certain the 2-char prefix→node mapping is (multi-factor scoring)",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Confidence"})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[(100*e.prefixConfidence).toFixed(0),"%"]})]}),n.jsxs("div",{children:[n.jsx(k,{content:"Recency level — active (<1h), recent (<6h), stale (<24h), inactive (>24h)",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Activity"})}),n.jsx("div",{className:"text-fg-primary capitalize",children:e.activityLevel})]})]}),(null!=e.avgRssi||null!=e.avgSnr)&&n.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-2 pt-2 border-t border-edge-subtle/50",children:[null!=e.avgRssi&&n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-fg-muted uppercase",children:"RSSI"}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[e.avgRssi.toFixed(1)," dBm"]})]}),null!=e.avgSnr&&n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-fg-muted uppercase",children:"SNR"}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[e.avgSnr.toFixed(1)," dB"]})]})]}),a&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-2 pt-2 border-t border-edge-subtle/50",children:[n.jsxs("div",{children:[n.jsx(k,{content:"Number of direct 1-hop neighbors in the topology",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Ego Size"})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:a.neighborCount})]}),n.jsxs("div",{children:[n.jsx(k,{content:"Local clustering coefficient — how interconnected this node's neighbors are (0 = none, 1 = fully connected)",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Clustering"})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:a.clusteringCoeff.toFixed(3)})]}),n.jsxs("div",{children:[n.jsx(k,{content:"Average betweenness centrality of this node's direct neighbors",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Avg Nbr Btw."})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:a.avgNeighborBetweenness.toFixed(3)})]})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-2",children:[n.jsxs("div",{children:[n.jsx(k,{content:"Average disambiguation confidence across all connected edges",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Edge Conf."})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[(100*a.avgEdgeConfidence).toFixed(0),"%"]})]}),null!=a.avgRssi&&n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-fg-muted uppercase",children:"Avg RSSI"}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[a.avgRssi.toFixed(1)," dBm"]})]}),null!=a.avgSnr&&n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-fg-muted uppercase",children:"Avg SNR"}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[a.avgSnr.toFixed(1)," dB"]})]})]})]}),l&&!l.insufficientData&&n.jsxs("div",{className:"mt-2 pt-2 border-t border-edge-subtle/50",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[n.jsx(k,{content:"RF-grounded TX delay recommendation from centralized topology engine. Anchored to MeshCore firmware defaults with observer bias correction.",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase tracking-wide cursor-help",children:"TX Delay Recommendation"})}),n.jsxs("div",{className:"flex items-center gap-1",children:[l.networkRole&&n.jsx(C,{color:ye[l.networkRole],compact:!0,children:l.networkRole}),l.dataConfidence&&n.jsx(C,{color:je[l.dataConfidence],compact:!0,children:l.dataConfidence})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs("div",{children:[n.jsx(k,{content:`Flood TX delay factor (firmware default: ×${Ne})`,children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Flood"})}),n.jsx("div",{className:"text-fg-primary tabular-nums text-sys-amber",children:we(l.floodFactor)})]}),n.jsxs("div",{children:[n.jsx(k,{content:`Direct TX delay factor (firmware default: ×${Ce})`,children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Direct"})}),n.jsx("div",{className:"text-fg-primary tabular-nums text-sys-amber",children:we(l.directFactor)})]})]}),l.rationale&&n.jsx("div",{className:"mt-1 text-[9px] text-fg-muted leading-snug",children:l.rationale}),null!=l.observationSymmetry&&l.observationSymmetry<.6&&n.jsxs("div",{className:"mt-1 text-[9px] text-sys-amber/70 leading-snug",children:["⚠ Low observation symmetry (",(100*l.observationSymmetry).toFixed(0),"%) — recommendation damped toward firmware defaults"]}),n.jsxs("button",{onClick:async()=>{const e=`set txdelay ${l.floodFactor.toFixed(1)}\nset direct.txdelay ${l.directFactor.toFixed(1)}`;try{await navigator.clipboard.writeText(e)}catch{}m(!0),setTimeout(()=>m(!1),1500)},className:"mt-1.5 flex items-center gap-1 text-[9px] text-sys-blue hover:text-sys-blue/80 transition-base",children:[u?n.jsx(ge,{className:"w-3 h-3 text-sys-green"}):n.jsx(fe,{className:"w-3 h-3"}),u?"Copied!":"Copy CLI commands"]})]}),i&&n.jsx("div",{className:"mt-2 pt-2 border-t border-edge-subtle/50",children:n.jsxs("button",{onClick:i,className:"flex items-center gap-1.5 text-[10px] text-sys-blue hover:text-sys-blue/80 transition-base",children:[n.jsx(ve,{className:"w-3 h-3"}),"Expand 2-hop neighborhood"]})}),o&&o.length>0&&n.jsxs("div",{className:"mt-2 pt-2 border-t border-edge-subtle/50",children:[n.jsxs("button",{onClick:()=>d(e=>!e),className:"flex items-center justify-between w-full text-[9px] text-fg-muted uppercase tracking-wide cursor-pointer hover:text-fg-secondary transition-base",children:[n.jsxs("span",{children:["Neighbors (",o.length,")"]}),n.jsx(ue,{className:"w-3 h-3 transition-transform "+(c?"rotate-180":"")})]}),c&&n.jsx("div",{className:"mt-1.5 max-h-32 overflow-y-auto space-y-0.5",children:o.map(e=>n.jsxs("button",{onClick:()=>null==r?void 0:r(e.hash),className:"w-full flex items-center gap-2 px-1.5 py-1 radius-badge hover-bg transition-base text-left group",children:[n.jsx("code",{className:"text-[10px] text-sys-blue shrink-0 tabular-nums",children:e.prefix}),n.jsx("span",{className:"text-[10px] text-fg-secondary truncate flex-1",children:e.name||"—"}),null!=e.avgSnr&&n.jsxs("span",{className:"text-[9px] text-fg-muted tabular-nums shrink-0",children:[e.avgSnr.toFixed(0)," dB"]}),null!=e.avgRssi&&n.jsx("span",{className:"text-[9px] text-fg-muted tabular-nums shrink-0",children:e.avgRssi.toFixed(0)}),n.jsxs("span",{className:"text-[9px] text-fg-muted/60 tabular-nums shrink-0",children:[(100*e.edgeConfidence).toFixed(0),"%"]})]},e.hash))})]})]})]})}),_t=s.memo(function({metrics:e,onClose:t}){const s=Object.entries(e.communities).sort(([,e],[,t])=>t-e),a=Object.entries(e.nodeClasses).sort(([,e],[,t])=>t-e);return n.jsxs(W.div,{variants:$,initial:"hidden",animate:"visible",exit:"exit",className:"absolute inset-x-3 bottom-3 z-20 surface-elevated radius-inset shadow-xl",children:[n.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5 border-b border-edge-subtle/50",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[n.jsx(Y,{className:"size-3.5 text-fg-muted shrink-0"}),n.jsx("span",{className:"text-sm font-semibold text-fg-primary",children:"Subgraph Analysis"}),n.jsxs(C,{color:"violet",compact:!0,children:[e.nodeCount," nodes"]})]}),n.jsx(F,{plain:!0,onClick:t,title:"Close",className:"shrink-0",children:n.jsx(U,{className:"size-4"})})]}),n.jsxs("div",{className:"p-3 font-mono text-[11px]",children:[n.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-fg-muted uppercase",children:"Nodes"}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:e.nodeCount})]}),n.jsxs("div",{children:[n.jsx(k,{content:"Edges where both endpoints are within the lasso selection",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Internal Edges"})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:e.edgeCount})]}),n.jsxs("div",{children:[n.jsx(k,{content:"Mean betweenness centrality of selected nodes",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Avg Between."})}),n.jsx("div",{className:"text-fg-primary tabular-nums",children:e.avgBetweenness.toFixed(3)})]}),n.jsxs("div",{children:[n.jsx(k,{content:"Mean edge disambiguation confidence for internal edges",children:n.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Avg Confidence"})}),n.jsxs("div",{className:"text-fg-primary tabular-nums",children:[(100*e.avgConfidence).toFixed(0),"%"]})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-2 pt-2 border-t border-edge-subtle/50",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-fg-muted uppercase mb-1",children:"Communities"}),n.jsx("div",{className:"flex flex-wrap gap-1",children:s.map(([e,t])=>n.jsxs("span",{className:"text-fg-secondary",children:["#",e,"×",t]},e))})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-fg-muted uppercase mb-1",children:"Node Types"}),n.jsx("div",{className:"flex flex-wrap gap-1",children:a.map(([e,t])=>n.jsxs("span",{className:"text-fg-secondary capitalize",children:[e,"×",t]},e))})]})]}),e.nodeCount>1&&n.jsx("div",{className:"mt-2 pt-2 border-t border-edge-subtle/50",children:n.jsxs("div",{className:"text-[9px] text-fg-muted flex items-center gap-1 flex-wrap",children:[n.jsx(k,{content:"Fraction of possible edges that exist — 2E / N(N-1)",children:n.jsxs("span",{className:"cursor-help",children:["Density: ",(2*e.edgeCount/(e.nodeCount*(e.nodeCount-1))*100).toFixed(1),"%"]})}),n.jsx("span",{children:"·"}),n.jsx(k,{content:"Mean connections per node — 2E / N",children:n.jsxs("span",{className:"cursor-help",children:["Avg Degree: ",(2*e.edgeCount/e.nodeCount).toFixed(1)]})}),null!=e.avgPathHealth&&n.jsxs(n.Fragment,{children:[n.jsx("span",{children:"·"}),n.jsx(k,{content:"Average health score of paths within the selection",children:n.jsxs("span",{className:"cursor-help",children:["Path Health: ",(100*e.avgPathHealth).toFixed(0),"%"]})})]})]})})]})]})});function Ut(){return n.jsxs("div",{className:"flex flex-col items-center justify-center gap-6 text-center px-8",children:[n.jsx("div",{className:"p-4 radius-pill bg-subtle-fill",children:n.jsx(pe,{className:"w-8 h-8 text-fg-muted"})}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("h2",{className:"type-subheading text-fg-primary",children:"No Topology Data"}),n.jsx("p",{className:"type-body text-fg-muted max-w-sm",children:"The mesh topology will appear here once packets are received and processed."})]}),n.jsxs("div",{className:"flex items-center gap-2 type-data-xs text-fg-muted",children:[n.jsx(ie,{className:"w-4 h-4 animate-pulse"}),n.jsx("span",{children:"Waiting for mesh traffic..."})]})]})}const Xt=s.memo(function({label:e,value:t,onChange:a,min:i,max:o,step:r}){const[l,c]=s.useState(!1),[d,u]=s.useState(""),m=s.useRef(null),h=s.useCallback(()=>{const e=parseFloat(d);isNaN(e)||a(Math.min(o,Math.max(i,Math.round(e/r)*r))),c(!1)},[d,a,i,o,r]),x=s.useCallback(()=>{u(t.toFixed(2)),c(!0),setTimeout(()=>{var e;return null==(e=m.current)?void 0:e.select()},0)},[t]);return n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-[10px] text-fg-muted",children:e}),l?n.jsx("input",{ref:m,type:"number",value:d,onChange:e=>u(e.target.value),onBlur:h,onKeyDown:e=>{"Enter"===e.key&&h(),"Escape"===e.key&&c(!1)},min:i,max:o,step:r,className:"w-14 text-right text-[10px] text-fg-secondary tabular-nums bg-subtle-fill radius-badge px-1 py-0.5 border border-edge-subtle focus:outline-none focus:border-sys-blue"}):n.jsx("button",{onClick:x,className:"text-[10px] text-fg-secondary tabular-nums hover:text-sys-blue cursor-text transition-colors",title:"Click to type a value",children:t.toFixed(2)})]}),n.jsx("input",{type:"range",min:i,max:o,step:r,value:t,onChange:e=>a(parseFloat(e.target.value)),className:"w-full h-1 bg-subtle-fill rounded appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:bg-sys-blue [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer"})]})}),Qt=s.memo(function({label:e,checked:t,onChange:s}){return n.jsxs(i,{className:"flex items-center justify-between",children:[n.jsx(o,{className:"text-[10px] text-fg-muted cursor-pointer select-none",children:e}),n.jsx(D,{enabled:t,onChange:s,size:"sm"})]})});function qt(){var e,t,i,o,l,c,d,N,D,L,F,R,H,B,P;M(yt);const E=u(),[$,T]=s.useState(!1),[I,G]=s.useState(!1),O=s.useRef(!1);s.useEffect(()=>{E&&!O.current&&(O.current=!0,G(!0))},[E]);const K=s.useCallback(()=>{G(!1),T(!0)},[]),_=m(),pe=function(e,t=1e3){const[n,a]=s.useState(e),i=s.useRef(Date.now()),o=s.useRef(null);return s.useEffect(()=>{const s=Date.now(),n=t-(s-i.current);return n<=0?(a(e),i.current=s):(o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{a(e),i.current=Date.now()},n)),()=>{o.current&&clearTimeout(o.current)}},[e,t]),n}(h(),2e3),ge=x(),fe=p(),ve=g(),be=f(),ye=v(),je=b(),Ne=y(),we=Ne?Et:At,Ce=Ne?Ct:kt,ke=s.useMemo(()=>function(e){if("undefined"==typeof document)return e?w[950]:"#EFF0F1";const t=getComputedStyle(document.documentElement).getPropertyValue("--bg-body").trim();return t.startsWith("#")?t:e?w[950]:"#EFF0F1"}(Ne),[Ne]),Se=s.useMemo(()=>function(e){if("undefined"==typeof document)return e?w[400]:w[500];const t=getComputedStyle(document.documentElement).getPropertyValue("--text-secondary").trim();return t.startsWith("#")?t:e?w[400]:w[500]}(Ne),[Ne]),[De,Le]=s.useState(!0),[Fe,Re]=s.useState(null),[Me,He]=s.useState(null),[Be,Pe]=s.useState(!1),[Ee,Ae]=s.useState(""),[ze,$e]=s.useState(!1),[Te,Ie]=s.useState(!1),[Oe,Ze]=s.useState("simulation"),[Ke,Ve]=s.useState(!0),[_e,Ue]=s.useState(!1),[qe,Je]=s.useState(!0),[tt,it]=s.useState(!1),[ot,rt]=s.useState(!1),[ct,dt]=s.useState(new Set),[ut,mt]=s.useState(!1),[ht,pt]=s.useState("spectral"),[gt,ft]=s.useState(1),[vt,St]=s.useState(1),[$t,Ot]=s.useState(!1),[Wt,qt]=s.useState(null),[Jt,Yt]=s.useState(!1),[es,ts]=s.useState(!1),[ss,ns]=s.useState(null),[as,is]=s.useState(null),[os,rs]=s.useState(null),[ls,cs]=s.useState(null),[ds,us]=s.useState(null),ms=j(),[hs,xs]=s.useState(!1),[ps,gs]=s.useState([]),[fs,vs]=s.useState(0),[bs,ys]=s.useState(null),js=s.useRef(new lt),Ns=s.useRef(null),ws=s.useRef(null),[Cs,ks]=s.useState(null),[Ss,Ds]=s.useState(null),[Ls,Fs]=s.useState({}),[Rs,Ms]=s.useState({simulationDecay:2e4,simulationGravity:.05,simulationCenter:.05,simulationRepulsion:5,simulationRepulsionTheta:.4,simulationLinkSpring:.05,simulationLinkDistance:78,simulationFriction:.72,simulationRepulsionFromMouse:0,pointSizeScale:.4,pointOpacity:1,pointGreyoutOpacity:.1,linkWidthScale:.06,linkOpacity:.95,linkGreyoutOpacity:.1,curvedLinks:Ft,curvedLinkWeight:.8,linkDefaultArrows:Rt,linkArrowsSizeScale:1.7,scalePointsOnZoom:Mt,scaleLinksOnZoom:Ht,renderLinks:Bt,renderHoveredPointRing:Pt,spaceSize:4096}),Hs=s.useCallback((e,t)=>{Ms(s=>({...s,[e]:t}))},[]),Bs=s.useCallback(()=>{Ms({simulationDecay:2e4,simulationGravity:.05,simulationCenter:.05,simulationRepulsion:5,simulationRepulsionTheta:.4,simulationLinkSpring:.05,simulationLinkDistance:78,simulationFriction:.72,simulationRepulsionFromMouse:0,pointSizeScale:.4,pointOpacity:1,pointGreyoutOpacity:.1,linkWidthScale:.06,linkOpacity:.95,linkGreyoutOpacity:.1,curvedLinks:Ft,curvedLinkWeight:.8,linkDefaultArrows:Rt,linkArrowsSizeScale:1.7,scalePointsOnZoom:Mt,scaleLinksOnZoom:Ht,renderLinks:Bt,renderHoveredPointRing:Pt,spaceSize:4096})},[]);s.useEffect(()=>()=>{var e;try{null==(e=ws.current)||e.destroy()}catch{}ws.current=null},[]),s.useEffect(()=>{const e=e=>{var t,s;if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLSelectElement))switch(e.key.toLowerCase()){case"f":e.metaKey||e.ctrlKey||(e.preventDefault(),null==(t=ws.current)||t.fitView(jt));break;case"escape":ze?($e(!1),Ae("")):Fe&&(Re(null),null==(s=ws.current)||s.unselectAllPoints());break;case"/":ze||(e.preventDefault(),$e(!0),setTimeout(()=>{var e;return null==(e=Ns.current)?void 0:e.focus()},50));break;case" ":e.preventDefault(),ws.current&&(De?ws.current.pause():ws.current.start(),Le(e=>!e));break;case"l":Ve(e=>!e)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ze,Fe,De]);const Ps=s.useMemo(()=>new Set((null==_?void 0:_.backboneEdges)??[]),[null==_?void 0:_.backboneEdges]),Es=s.useMemo(()=>({resolution:gt,kWeight:vt}),[gt,vt]),As=s.useMemo(()=>{if("louvain"!==ht)return null;const e=null==_?void 0:_.edges;return!e||0===e.length||!pe||pe.size<3?null:We(e,Array.from(pe.keys()),Es).communities},[ht,null==_?void 0:_.edges,pe,Es]),zs=s.useMemo(()=>{var e;if(!pe||0===pe.size||!$)return[];const t=[],s=(null==je?void 0:je.node_name)??(null==(e=null==je?void 0:je.config)?void 0:e.node_name)??null,n=Ne?"#171717":"#EFF0F1";let a=1;for(const i of pe.values())i.degree>a&&(a=i.degree);for(const i of pe.values()){const e=i,o=e.degree>0?Math.log10(e.degree+1)/Math.log10(a+1):0,r=5+23*Math.min(1,o),l=6*e.betweenness,c=e.isLocal?28:Math.min(34,r+l),d=(null==As?void 0:As.get(e.hash))??e.communityId,u=ut&&d>=0?Ce[d%Ce.length]:we[e.nodeClass],m=wt[e.activityLevel]??1,h=e.isLocal?we.local:m<1?Tt(u,n,m):u,x=e.isLocal?s??e.name:e.name;t.push({id:e.hash,label:x?`${e.prefix} ${x}`:e.prefix,color:h,size:c,nodeClass:e.nodeClass,name:x,prefix:e.prefix,packetCount:e.packetCount,isLocal:e.isLocal,isHub:e.isHub,isGateway:e.isGateway,isBackbone:e.isBackbone,isMobile:e.isMobile,isZeroHop:e.isZeroHop,isGhost:e.isGhost,degree:e.degree,betweenness:e.betweenness,communityId:(null==As?void 0:As.get(e.hash))??e.communityId,activityLevel:e.activityLevel,prefixConfidence:e.prefixConfidence,hasCollision:e.hasCollision,inDegree:e.inDegree,outDegree:e.outDegree,isInLoop:e.isInLoop,avgRssi:e.avgRssi,avgSnr:e.avgSnr})}for(const i of ge){const e=`ghost-${i.prefix}`;if(t.some(t=>t.id===e))continue;const s=Tt(we.ghost,n,.6);t.push({id:e,label:`? ${i.prefix.toUpperCase()}`,color:s,size:6,nodeClass:"ghost",name:null,prefix:i.prefix,packetCount:i.observationCount,isLocal:!1,isHub:!1,isGateway:!1,isBackbone:!1,isMobile:!1,isZeroHop:!1,isGhost:!0,degree:i.commonNeighbors.size,betweenness:0,communityId:-1,activityLevel:"active",prefixConfidence:i.confidence,hasCollision:!1,inDegree:0,outDegree:0,isInLoop:!1,avgRssi:null,avgSnr:null})}return t},[pe,$,null==je?void 0:je.node_name,null==(e=null==je?void 0:je.config)?void 0:e.node_name,we,Ne,ge,Ce,ut,ht,As]),$s=s.useMemo(()=>new Set(zs.map(e=>e.id)),[zs]),Ts=s.useMemo(()=>{const e=new Map;if(!pe)return e;for(const t of pe.values())e.set(t.hash,t.name);return e},[pe]),Is=s.useMemo(()=>{const e=(null==_?void 0:_.edges)??[];if(!e.length||!$)return[];const t=[],s=(null==_?void 0:_.edgeBetweenness)??new Map;for(const a of e){if(!$s.has(a.fromHash)||!$s.has(a.toHash))continue;const e=It(a,Ps),n=Gt(e,a.avgConfidence,Ne),i=s.get(a.key)??0,o=i>0?.5+4*i:.5+2*Math.min(1,a.certainCount/50);t.push({source:a.fromHash,target:a.toHash,color:n,width:o,key:a.key,packetCount:a.packetCount,certainCount:a.certainCount,confidence:a.avgConfidence,symmetryRatio:a.symmetryRatio,dominantDirection:a.dominantDirection,isBackbone:Ps.has(a.key),isLoopEdge:a.isLoopEdge??!1,isDirectPath:a.isDirectPathEdge,isZeroHop:a.isZeroHop??!1,isGhost:!1,forwardCount:a.forwardCount,reverseCount:a.reverseCount,floodCount:a.floodCount,directCount:a.directCount,avgRssi:a.avgRssi??null,avgSnr:a.avgSnr??null,strength:a.strength,fromName:Ts.get(a.fromHash)??null,toName:Ts.get(a.toHash)??null,edgeType:e})}const n=Ne?Dt:Lt;for(const a of ge){const e=`ghost-${a.prefix}`;if($s.has(e))for(const s of a.commonNeighbors)$s.has(s)&&t.push({source:e,target:s,color:n.ghost,width:.4,key:`ghost-${a.prefix}-${s}`,packetCount:a.observationCount,certainCount:0,confidence:a.confidence,symmetryRatio:0,dominantDirection:"balanced",isBackbone:!1,isLoopEdge:!1,isDirectPath:!1,isZeroHop:!1,isGhost:!0,forwardCount:0,reverseCount:0,floodCount:0,directCount:0,avgRssi:null,avgSnr:null,strength:a.confidence,fromName:null,toName:Ts.get(s)??null,edgeType:"ghost"})}return t},[null==_?void 0:_.edges,null==_?void 0:_.edgeBetweenness,$,$s,Ne,Ps,Ts,ge]),Gs=null==(i=null==(t=null==je?void 0:je.config)?void 0:t.radio)?void 0:i.frequency,Os=null==(l=null==(o=null==je?void 0:je.config)?void 0:o.radio)?void 0:l.bandwidth,Zs=null==(d=null==(c=null==je?void 0:je.config)?void 0:c.radio)?void 0:d.spreading_factor,Ws=null==(D=null==(N=null==je?void 0:je.config)?void 0:N.radio)?void 0:D.tx_power,Ks=null==(F=null==(L=null==je?void 0:je.config)?void 0:L.radio)?void 0:F.coding_rate,Vs=s.useMemo(()=>{if(!_||!es)return null;const e={frequency:Gs,bandwidth:null!=os?1e3*os:Os,spreading_factor:as??Zs,tx_power:ss??Ws,coding_rate:ls??Ks},t={};return null!=ds&&(t.sensitivityOverrideDbm=ds),null!=ms&&(t.observedNoiseFloorDbm=ms),function(e,t,s){const n=[],a=e.nodeMetrics,i=new Set,o=t.tx_power??22;for(const r of e.edges){if(!r.isZeroHop)continue;const e=a.get(r.fromHash),o=a.get(r.toHash);n.push(Ye(r,e,o,t,s)),i.add(r.key)}for(const r of e.edges){if(i.has(r.key))continue;if(!r.traceQuality)continue;const e=et(r,a.get(r.fromHash),a.get(r.toHash),t,o,s);e&&(n.push(e),i.add(r.key))}return n}(_,e,t)},[_,es,Gs,Os,Zs,Ws,Ks,ss,as,os,ls,ds,ms]),_s=s.useMemo(()=>{if(!Vs)return null;const e=new Map;for(const t of Vs)e.set(t.edgeKey,t);return e},[Vs]),Us=s.useMemo(()=>Vs&&0!==Vs.length?function(e){const t={"anomalous-good":0,better:0,expected:0,worse:0,"anomalous-bad":0},s={excellent:0,good:0,fair:0,marginal:0,critical:0};let n=0,a=0,i=null,o=null,r=0,l=0;for(const c of e)c.hasData&&(null!=c.marginDb&&(n+=c.marginDb,a++,(!i||c.marginDb<(i.marginDb??1/0))&&(i=c),(!o||c.marginDb>(o.marginDb??-1/0))&&(o=c)),c.marginClass&&s[c.marginClass]++,null!=c.deviationDb&&c.deviationClass?(t[c.deviationClass]++,l++):r++);return{totalEdges:e.length,analyzedEdges:l,rssiOnlyEdges:r,avgMarginDb:a>0?n/a:null,worstMargin:i,bestMargin:o,deviationCounts:t,marginCounts:s,anomalousCount:t["anomalous-good"]+t["anomalous-bad"]}}(Vs):null,[Vs]),Xs=s.useMemo(()=>{if(!es||!_s)return Is;const e=Ne?"#303038":"#D0D0D8";return Is.map(t=>{const s=_s.get(t.key);return s&&s.hasData?{...t,color:nt(s,"margin"),width:at(s),linkBudget:s}:{...t,color:e,width:.3}})},[Is,es,_s,Ne]),Qs=s.useMemo(()=>0===ct.size?zs:zs.filter(e=>!ct.has(e.nodeClass)),[zs,ct]),qs=s.useMemo(()=>{if(0===ct.size)return Xs;const e=new Set(Qs.map(e=>e.id));return Xs.filter(t=>e.has(t.source)&&e.has(t.target))},[Xs,Qs,ct]),Js=s.useRef([]);s.useEffect(()=>{Js.current=qs},[qs]);const Ys=s.useMemo(()=>{const e=new Map;for(const t of Is)e.set(t.source,(e.get(t.source)??0)+1),e.set(t.target,(e.get(t.target)??0)+1);return e},[Is]),en=s.useMemo(()=>{const e=new Map;for(const t of zs)e.set(t.id,t);return e},[zs]);s.useEffect(()=>{if(0===Qs.length)return ks(null),Ds(null),void Fs({});let e=!1;const t=setTimeout(async()=>{try{const t=Qs.map(e=>({id:e.id,label:e.label,color:e.color,size:e.size,communityId:String(e.communityId)})),s=qs.map(e=>({source:e.source,target:e.target,color:e.color,width:e.width})),n={points:{pointIdBy:"id",pointColorBy:"color",pointColorStrategy:"direct",pointDefaultColor:Ne?"#9CA3AF":"#374151",pointLabelBy:"label",pointSizeBy:"size",pointSizeStrategy:"direct",pointDefaultSize:8,pointSizeScale:1,pointGreyoutOpacity:.3,pointIncludeColumns:["communityId"]},links:{linkSourceBy:"source",linkTargetsBy:["target"],linkColorBy:"color",linkColorStrategy:"direct",linkDefaultColor:Ne?"#6B7280":"#9CA3AF",linkWidthBy:"width",linkWidthStrategy:"direct",linkDefaultWidth:1,linkWidthScale:1,linkGreyoutOpacity:.1}},a=await r(n,t,s);if(e||!a)return;a.points,a.links,a.cosmographConfig,ks(a.points??null),Ds(a.links??null),Fs(a.cosmographConfig??{})}catch(t){console.error("[MeshGraph] Data preparation failed:",t)}},100);return()=>{e=!0,clearTimeout(t)}},[Qs,qs,Ne]);const tn=s.useCallback(e=>{e&&(ws.current=e,e.start(),setTimeout(()=>{e.fitView(jt)},1500))},[]),sn=s.useCallback(()=>{var e;null==(e=ws.current)||e.fitView(jt)},[]),nn=s.useCallback(()=>{const e=ws.current;e&&(De?e.pause():e.start(),Le(!De))},[De]),an=s.useCallback(async e=>{const t=ws.current,s=en.get(e);if(s){if(t)try{const s=await t.getPointIndicesByIds([e]);s&&s.length>0&&void 0!==s[0]&&(t.zoomToPoint(s[0],400,2.5),t.selectPoint(s[0],!1,!0))}catch{}He(null),Re({hash:e,name:s.name,prefix:s.prefix,nodeClass:s.nodeClass,packetCount:s.packetCount,edgeCount:Ys.get(e)??0,degree:s.degree,betweenness:s.betweenness,communityId:s.communityId,isLocal:s.isLocal,isHub:s.isHub,isGateway:s.isGateway,isBackbone:s.isBackbone,isMobile:s.isMobile,isZeroHop:s.isZeroHop,isGhost:s.isGhost,isInLoop:s.isInLoop,activityLevel:s.activityLevel,prefixConfidence:s.prefixConfidence,hasCollision:s.hasCollision,inDegree:s.inDegree,outDegree:s.outDegree,avgRssi:s.avgRssi,avgSnr:s.avgSnr})}},[en,Ys]),on=s.useRef(null);s.useEffect(()=>{on.current=_s},[_s]);const rn=s.useCallback(e=>{var t;if(void 0===e)return void He(null);const s=Js.current[e];if(!s)return;const n=null==(t=on.current)?void 0:t.get(s.key);He(n&&!s.linkBudget?{...s,linkBudget:n}:s),Re(null)},[]),ln=s.useCallback(async(e,t,s)=>{var n;if(void 0===e)return Re(null),qt(null),void(null==(n=ws.current)||n.unselectAllPoints());He(null);const a=ws.current;if(a)try{const t=await a.getPointIdsByIndices([e]);if(!t||0===t.length)return;const s=t[0],n=en.get(s);if(!n)return;a.selectPoint(e,!1,!0),Re({hash:s,name:n.name,prefix:n.prefix,nodeClass:n.nodeClass,packetCount:n.packetCount,edgeCount:Ys.get(s)??0,degree:n.degree,betweenness:n.betweenness,communityId:n.communityId,isLocal:n.isLocal,isHub:n.isHub,isGateway:n.isGateway,isBackbone:n.isBackbone,isMobile:n.isMobile,isZeroHop:n.isZeroHop,isGhost:n.isGhost,isInLoop:n.isInLoop,activityLevel:n.activityLevel,prefixConfidence:n.prefixConfidence,hasCollision:n.hasCollision,inDegree:n.inDegree,outDegree:n.outDegree,avgRssi:n.avgRssi,avgSnr:n.avgSnr})}catch{}},[en,Ys]),cn=s.useMemo(()=>{if(!ze||!Ee.trim())return[];const e=Ee.toLowerCase();return zs.filter(t=>{var s;return t.prefix.toLowerCase().includes(e)||(null==(s=t.name)?void 0:s.toLowerCase().includes(e))||t.id.toLowerCase().includes(e)}).slice(0,8)},[zs,Ee,ze]),dn=s.useCallback(e=>{$e(!1),Ae(""),an(e.id)},[an]),un=s.useCallback(()=>{Pe(e=>!e)},[]),mn=s.useCallback(e=>{dt(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[]),hn=s.useCallback(()=>{mt(e=>{const t=!e,s=ws.current;return s&&s.start(.5),t})},[]),xn=s.useCallback(()=>{Ot(e=>{const t=!e,s=ws.current;return s?(t?s.activatePolygonalSelection():(s.deactivatePolygonalSelection(),qt(null),s.unselectAllPoints()),t):t})},[]),pn=s.useCallback(async()=>{const e=ws.current;if(!e)return;await new Promise(e=>setTimeout(e,80));const t=e.getSelectedPointIndices();if(!t||0===t.length)return void qt(null);const s=await e.getPointIdsByIndices(t);if(!s||0===s.length)return void qt(null);const n=new Set(s);let a=0,i=0;for(const m of Js.current)n.has(m.source)&&n.has(m.target)&&(a++,i+=m.confidence);let o=0;const r={},l={};for(const m of s){const e=en.get(m);e&&(o+=e.betweenness,r[e.communityId]=(r[e.communityId]??0)+1,l[e.nodeClass]=(l[e.nodeClass]??0)+1)}const c=new Set;for(const m of s){const e=en.get(m);e&&c.add(e.prefix.toLowerCase())}let d=0,u=0;for(const m of be)if(m.hops.length>=2){const e=m.hops[0].toLowerCase(),t=m.hops[m.hops.length-1].toLowerCase();c.has(e)&&c.has(t)&&(d+=m.healthScore,u++)}qt({nodeCount:s.length,edgeCount:a,avgBetweenness:s.length>0?o/s.length:0,avgConfidence:a>0?i/a:0,avgPathHealth:u>0?d/u:null,communities:r,nodeClasses:l}),Re(null),He(null)},[en,be]),gn=s.useCallback(()=>{var e;qt(null),null==(e=ws.current)||e.unselectAllPoints()},[]),fn=s.useMemo(()=>{var e;if(!Fe)return null;const t=Fe.hash,s=new Set;for(const h of qs)h.source===t?s.add(h.target):h.target===t&&s.add(h.source);if(0===s.size)return{clusteringCoeff:0,avgNeighborBetweenness:0,neighborCount:0,avgEdgeConfidence:0,avgRssi:null,avgSnr:null};let n=0;for(const h of qs)s.has(h.source)&&s.has(h.target)&&n++;const a=s.size,i=a>1?2*n/(a*(a-1)):0;let o=0;for(const h of s)o+=(null==(e=en.get(h))?void 0:e.betweenness)??0;let r=0,l=0,c=0,d=0,u=0,m=0;for(const h of qs)h.source!==t&&h.target!==t||(r+=h.confidence,l++,null!=h.avgRssi&&(c+=h.avgRssi,d++),null!=h.avgSnr&&(u+=h.avgSnr,m++));return{clusteringCoeff:Math.min(1,i),avgNeighborBetweenness:o/a,neighborCount:a,avgEdgeConfidence:l>0?r/l:0,avgRssi:d>0?c/d:null,avgSnr:m>0?u/m:null}},[Fe,qs,en]),vn=s.useMemo(()=>Fe&&ye?ye.get(Fe.hash)??null:null,[Fe,ye]),bn=s.useMemo(()=>{if(!Fe)return[];const e=Fe.hash,t=[],s=new Set;for(const n of qs){let a=null;if(n.source===e?a=n.target:n.target===e&&(a=n.source),!a||s.has(a))continue;s.add(a);const i=en.get(a);t.push({hash:a,prefix:(null==i?void 0:i.prefix)??a.slice(2,4).toUpperCase(),name:(null==i?void 0:i.name)??null,edgeConfidence:n.confidence,edgeType:n.edgeType,avgRssi:n.avgRssi,avgSnr:n.avgSnr})}return t.sort((e,t)=>t.edgeConfidence-e.edgeConfidence),t},[Fe,qs,en]),yn=s.useCallback(async()=>{const e=ws.current;if(!e||!Fe)return;const t=await e.getPointIndicesByIds([Fe.hash]);if(!t||void 0===t[0])return;const s=t[0],n=e.getConnectedPointIndices(s)??[],a=new Set([s,...n]);for(const o of n){const t=e.getConnectedPointIndices(o)??[];for(const e of t)a.add(e)}const i=Array.from(a);e.selectPoints(i),e.fitViewByIndices(i,jt,.15)},[Fe]);s.useEffect(()=>{if(!$t)return;const e=e=>{var t,s;"Escape"===e.key&&(Ot(!1),null==(t=ws.current)||t.deactivatePolygonalSelection(),qt(null),null==(s=ws.current)||s.unselectAllPoints())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[$t]);const jn=s.useCallback((e,t)=>{_&&(function(e,t){!function(e){const t=new Blob([e.content],{type:e.mimeType}),s=URL.createObjectURL(t),n=document.createElement("a");n.href=s,n.download=e.filename,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)}(Ge(e,t))}(_,{format:e,dataset:t}),Yt(!1))},[_]),Nn=s.useMemo(()=>{if(!_||!be.length)return null;const e=_.edges??[];return 0===e.length?null:function(e,t,s=-137){const n=new Map;for(const o of t)n.set(o.key,o);const a=t.filter(e=>null!=e.avgRssi).length,i=[];for(const o of e){const e=xt(o,n,s);e&&i.push(e)}return i.sort((e,t)=>t.riskScore-e.riskScore),{atRiskPaths:i,criticalCount:i.filter(e=>"critical"===e.riskLevel).length,highCount:i.filter(e=>"high"===e.riskLevel).length,moderateCount:i.filter(e=>"moderate"===e.riskLevel).length,edgesAnalyzed:t.length,edgesWithSignal:a}}(be,e)},[_,be]),wn=s.useMemo(()=>{const e=null==_?void 0:_.edges;if(!e||0===e.length||!pe||pe.size<3)return null;const t=Array.from(pe.keys());return A(e,t)},[null==_?void 0:_.edges,pe]),Cn=s.useMemo(()=>{if("louvain"!==ht)return null;const e=null==_?void 0:_.edges;return!e||0===e.length||!pe||pe.size<3?null:We(e,Array.from(pe.keys()),Es)},[ht,null==_?void 0:_.edges,pe,Es]);s.useEffect(()=>{if(!_)return;const e=new Map;for(const[s,n]of _.nodeMetrics)e.set(s,n.name);const t=js.current.update(_,e);t.totalCount>0&&(gs(js.current.getLog()),vs(e=>e+t.totalCount))},[_]);const kn=s.useCallback(()=>{vs(0),xs(e=>!e)},[]),Sn=s.useMemo(()=>function(e,t){if(null==e)return null;const s=Math.max(0,e),n=s>0?(Math.log10(s)+4)/4.5:0,a=Math.round(Math.max(0,Math.min(100,100*n)));let i,o;a<10?(i="critical",o="Partition risk"):a<30?(i="poor",o="Weak connectivity"):a<55?(i="fair",o="Moderate resilience"):a<80?(i="good",o="Well connected"):(i="excellent",o="Highly resilient");const[r,l]=Nt[i];return{score:a,grade:i,label:o,color:t?r:l}}(wn,Ne),[wn,Ne]),Dn=n.jsxs("div",{className:"absolute top-0 left-0 right-0 z-20 px-4 py-3 pointer-events-none flex items-start justify-between",children:[n.jsxs("h1",{className:"type-title text-fg-primary flex items-center gap-2 sm:gap-3 pointer-events-auto",children:[n.jsx(X,{className:"w-5 h-5 sm:w-6 sm:h-6 text-icon-page-title"}),n.jsx("span",{children:"MeshGraph"}),n.jsx(C,{color:"violet",compact:!0,children:"Analytics"})]}),Sn&&n.jsx(k,{content:n.jsxs("div",{className:"max-w-xs space-y-2",children:[n.jsx("div",{className:"font-semibold text-fg-primary",children:"Mesh Resilience Score"}),n.jsx("div",{className:"text-fg-secondary",children:"Derived from the Fiedler eigenvalue (λ₂) — the second-smallest eigenvalue of the graph Laplacian. Measures how well-connected the mesh is and how resistant it is to partitioning."}),n.jsxs("div",{className:"space-y-0.5 font-mono text-[10px]",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Raw λ₂"}),n.jsx("span",{className:"text-fg-primary tabular-nums",children:(null==wn?void 0:wn.toFixed(6))??"—"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Score"}),n.jsxs("span",{className:"tabular-nums",style:{color:Sn.color},children:[Sn.score,"/100"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Grade"}),n.jsx("span",{className:"capitalize",style:{color:Sn.color},children:Sn.grade})]})]}),n.jsxs("div",{className:"pt-1 border-t border-edge-subtle/30 space-y-0.5 text-[10px]",children:[n.jsx("div",{className:"text-fg-muted font-medium",children:"Grade thresholds"}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{style:{color:Nt.excellent[0]},children:"Excellent"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"80-100 (λ₂ > 0.3)"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{style:{color:Nt.good[0]},children:"Good"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"55-79 (λ₂ 0.03-0.3)"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{style:{color:Nt.fair[0]},children:"Fair"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"30-54 (λ₂ 0.003-0.03)"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{style:{color:Nt.poor[0]},children:"Poor"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"10-29 (λ₂ 0.0001-0.003)"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{style:{color:Nt.critical[0]},children:"Critical"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"<10 (λ₂ ≈ 0)"})]})]}),n.jsx("div",{className:"text-[10px] text-fg-muted italic",children:"Near-zero λ₂ = one bridge away from network partition. Log-scale mapping: small λ₂ changes at low values have outsized impact."})]}),children:n.jsxs("div",{className:"pointer-events-auto surface-control radius-inner px-3 py-1.5 flex items-center gap-2 cursor-help",children:[n.jsxs("div",{className:"flex items-baseline gap-1.5",children:[n.jsx("span",{className:"text-[10px] text-fg-muted uppercase tracking-wider",children:"Resilience"}),n.jsx("span",{className:"text-lg font-semibold tabular-nums leading-none",style:{color:Sn.color},children:Sn.score})]}),n.jsx("div",{className:"w-12 h-1.5 rounded-full bg-subtle-fill overflow-hidden",children:n.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${Sn.score}%`,backgroundColor:Sn.color}})})]})})]}),Ln=(e,t=!1)=>{const s="flex flex-col items-center gap-0.5 px-1.5 py-1 radius-inner transition-all duration-100 active:scale-95";return e&&t?`${s} bg-status-warning/15 text-status-warning shadow-inner`:e?`${s} bg-sys-blue/20 text-sys-blue shadow-inner`:`${s} hover:bg-white/5 hover:scale-105 text-fg-secondary`},Fn=n.jsx("div",{className:"w-px h-6 bg-border-subtle/40 mx-0.5 shrink-0"}),Rn=n.jsxs("div",{className:"absolute top-12 right-3 z-10 flex items-center gap-0.5 surface-control radius-inner px-1.5 py-1",children:[n.jsx(k,{content:"Visible nodes / edges in the graph",children:n.jsxs("span",{className:"text-[9px] text-fg-muted tabular-nums mr-1.5 leading-none cursor-help",children:[Qs.length,n.jsx("br",{}),qs.length]})}),Fn,n.jsx(k,{content:Ke?"Hide labels (L)":"Show labels (L)",children:n.jsxs("button",{onClick:()=>Ve(e=>!e),className:Ln(!Ke,!0),children:[Ke?n.jsx(Q,{className:"w-3.5 h-3.5"}):n.jsx(q,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Lbl"})]})}),n.jsx(k,{content:ut?"Disable clustering":"Community clustering",children:n.jsxs("button",{onClick:hn,className:Ln(ut),children:[n.jsx(J,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Grp"})]})}),n.jsx(k,{content:$t?"Exit lasso (Esc)":"Lasso selection",children:n.jsxs("button",{onClick:xn,className:Ln($t,!0),children:[n.jsx(Y,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Sel"})]})}),Fn,n.jsx(k,{content:"Legend",children:n.jsxs("button",{onClick:()=>Ue(e=>!e),className:Ln(_e),children:[n.jsx(ee,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Map"})]})}),n.jsx(k,{content:"Search (/)",children:n.jsxs("button",{onClick:()=>{$e(!0),setTimeout(()=>{var e;return null==(e=Ns.current)?void 0:e.focus()},50)},className:Ln(ze),children:[n.jsx(te,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Fnd"})]})}),Fn,n.jsx(k,{content:De?"Pause (Space)":"Play (Space)",children:n.jsxs("button",{onClick:nn,className:Ln(!De),children:[De?n.jsx(se,{className:"w-3.5 h-3.5 text-sys-green"}):n.jsx(ne,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:De?"Run":"Stop"})]})}),n.jsx(k,{content:"Fit view (F)",children:n.jsxs("button",{onClick:sn,className:Ln(!1),children:[n.jsx(ae,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Fit"})]})}),Fn,n.jsx(k,{content:es?"Disable link budget":"Link budget overlay",children:n.jsxs("button",{onClick:()=>ts(e=>!e),className:Ln(es),children:[n.jsx(ie,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"RF"})]})}),n.jsx(k,{content:"Anomaly log",children:n.jsxs("button",{onClick:kn,className:`relative ${Ln(hs,!0)}`,children:[n.jsx(oe,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Alert"}),fs>0&&n.jsx("span",{className:"absolute -top-1 -right-0.5 w-3 h-3 rounded-full bg-status-danger text-[7px] font-bold text-white flex items-center justify-center",children:fs>9?"9+":fs})]})}),n.jsx(k,{content:"Export topology",children:n.jsxs("button",{onClick:()=>Yt(e=>!e),className:Ln(Jt),children:[n.jsx(re,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Exp"})]})}),n.jsx(k,{content:"Settings",children:n.jsxs("button",{onClick:()=>Ie(e=>!e),className:Ln(Te),children:[n.jsx(le,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Cfg"})]})}),Fn,n.jsx(k,{content:Be?"Exit fullscreen":"Fullscreen",children:n.jsxs("button",{onClick:un,className:Ln(Be),children:[Be?n.jsx(ce,{className:"w-3.5 h-3.5"}):n.jsx(V,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Max"})]})})]}),Mn=n.jsxs(bt,{id:"settings",title:"Graph Settings",icon:n.jsx(le,{}),open:Te,onClose:()=>Ie(!1),defaultPosition:{x:"undefined"!=typeof window?window.innerWidth-308:600,y:60},defaultSize:{width:288,height:420},minSize:{width:260,height:200},maxSize:{width:400,height:600},headerActions:n.jsx(k,{content:"Reset to defaults",children:n.jsx("button",{onClick:Bs,className:"p-0.5 radius-badge hover-bg transition-base",children:n.jsx(de,{className:"w-2.5 h-2.5 text-fg-muted"})})}),children:[n.jsx("div",{className:"flex border-b border-edge-subtle",children:["simulation","points","links","rendering"].map(e=>n.jsx("button",{onClick:()=>Ze(e),className:"flex-1 px-2 py-1.5 text-[10px] font-medium capitalize transition-colors "+(Oe===e?"text-sys-blue border-b-2 border-sys-blue":"text-fg-muted hover:text-fg-secondary"),children:e},e))}),n.jsxs("div",{className:"p-3 space-y-3",children:["simulation"===Oe&&n.jsxs(n.Fragment,{children:[n.jsx(Xt,{label:"Gravity",value:Rs.simulationGravity,onChange:e=>Hs("simulationGravity",e),min:0,max:1,step:.01}),n.jsx(Xt,{label:"Repulsion",value:Rs.simulationRepulsion,onChange:e=>Hs("simulationRepulsion",e),min:0,max:5,step:.1}),n.jsx(Xt,{label:"Link Spring",value:Rs.simulationLinkSpring,onChange:e=>Hs("simulationLinkSpring",e),min:0,max:2,step:.05}),n.jsx(Xt,{label:"Link Distance",value:Rs.simulationLinkDistance,onChange:e=>Hs("simulationLinkDistance",e),min:1,max:100,step:1}),n.jsx(Xt,{label:"Friction",value:Rs.simulationFriction,onChange:e=>Hs("simulationFriction",e),min:0,max:1,step:.01}),n.jsx(Xt,{label:"Center Force",value:Rs.simulationCenter,onChange:e=>Hs("simulationCenter",e),min:0,max:1,step:.01}),n.jsx(Xt,{label:"Decay",value:Rs.simulationDecay,onChange:e=>Hs("simulationDecay",e),min:100,max:2e4,step:100}),n.jsx(Xt,{label:"Repulsion Theta",value:Rs.simulationRepulsionTheta,onChange:e=>Hs("simulationRepulsionTheta",e),min:.1,max:3,step:.05}),n.jsx(Xt,{label:"Mouse Repulsion",value:Rs.simulationRepulsionFromMouse,onChange:e=>Hs("simulationRepulsionFromMouse",e),min:0,max:10,step:.5})]}),"points"===Oe&&n.jsxs(n.Fragment,{children:[n.jsx(Xt,{label:"Size Scale",value:Rs.pointSizeScale,onChange:e=>Hs("pointSizeScale",e),min:.1,max:5,step:.1}),n.jsx(Xt,{label:"Opacity",value:Rs.pointOpacity,onChange:e=>Hs("pointOpacity",e),min:0,max:1,step:.05}),n.jsx(Xt,{label:"Greyout Opacity",value:Rs.pointGreyoutOpacity,onChange:e=>Hs("pointGreyoutOpacity",e),min:0,max:1,step:.05}),n.jsx(Qt,{label:"Scale on Zoom",checked:Rs.scalePointsOnZoom,onChange:e=>Hs("scalePointsOnZoom",e)}),n.jsx(Qt,{label:"Hover Ring",checked:Rs.renderHoveredPointRing,onChange:e=>Hs("renderHoveredPointRing",e)})]}),"links"===Oe&&n.jsxs(n.Fragment,{children:[n.jsx(Qt,{label:"Show Links",checked:Rs.renderLinks,onChange:e=>Hs("renderLinks",e)}),n.jsx(Qt,{label:"Curved Links",checked:Rs.curvedLinks,onChange:e=>Hs("curvedLinks",e)}),n.jsx(Qt,{label:"Show Arrows",checked:Rs.linkDefaultArrows,onChange:e=>Hs("linkDefaultArrows",e)}),n.jsx(Xt,{label:"Width Scale",value:Rs.linkWidthScale,onChange:e=>Hs("linkWidthScale",e),min:.1,max:5,step:.1}),n.jsx(Xt,{label:"Opacity",value:Rs.linkOpacity,onChange:e=>Hs("linkOpacity",e),min:0,max:1,step:.05}),n.jsx(Xt,{label:"Greyout Opacity",value:Rs.linkGreyoutOpacity,onChange:e=>Hs("linkGreyoutOpacity",e),min:0,max:1,step:.05}),Rs.curvedLinks&&n.jsx(Xt,{label:"Curve Weight",value:Rs.curvedLinkWeight,onChange:e=>Hs("curvedLinkWeight",e),min:0,max:1,step:.05}),Rs.linkDefaultArrows&&n.jsx(Xt,{label:"Arrow Size",value:Rs.linkArrowsSizeScale,onChange:e=>Hs("linkArrowsSizeScale",e),min:.1,max:3,step:.1}),n.jsx(Qt,{label:"Scale on Zoom",checked:Rs.scaleLinksOnZoom,onChange:e=>Hs("scaleLinksOnZoom",e)})]}),"rendering"===Oe&&n.jsxs(n.Fragment,{children:[n.jsx(Xt,{label:"Space Size",value:Rs.spaceSize,onChange:e=>Hs("spaceSize",e),min:1024,max:16384,step:512}),n.jsx("div",{className:"pt-2 border-t border-edge-subtle/50",children:n.jsx("p",{className:"text-[9px] text-fg-muted",children:"Space size defines the simulation boundary. Larger values allow more spread."})})]})]})]}),Hn=n.jsxs(bt,{id:"export",title:"Export Topology",icon:n.jsx(re,{}),open:Jt,onClose:()=>Yt(!1),defaultPosition:{x:"undefined"!=typeof window?window.innerWidth-280:600,y:100},defaultSize:{width:256,height:320},minSize:{width:220,height:150},autoHeight:!0,children:[n.jsx("div",{className:"py-1",children:[{label:"Full Topology (JSON)",format:"json",dataset:"full",desc:"All data: nodes, edges, paths, TX delay"},{label:"Gephi Graph (GEXF)",format:"gexf",dataset:"full",desc:"Import into Gephi for advanced analysis"},{label:"Nodes (CSV)",format:"csv",dataset:"nodes",desc:"Node metrics: centrality, class, signal"},{label:"Edges (CSV)",format:"csv",dataset:"edges",desc:"Edge metrics: confidence, symmetry, type"},{label:"Path Health (CSV)",format:"csv",dataset:"pathHealth",desc:"Route health scores and trends"},{label:"TX Delay (CSV)",format:"csv",dataset:"txDelay",desc:"TX delay recommendations per node"}].map(({label:e,format:t,dataset:s,desc:a})=>n.jsxs("button",{onClick:()=>jn(t,s),className:"w-full flex flex-col px-3 py-2 text-left hover-bg transition-base",children:[n.jsx("span",{className:"text-[11px] font-medium text-fg-primary",children:e}),n.jsx("span",{className:"text-[9px] text-fg-muted",children:a})]},`${t}-${s}`))}),n.jsx("div",{className:"px-3 py-1.5 border-t border-edge-subtle",children:n.jsxs("span",{className:"text-[9px] text-fg-muted",children:[(null==(R=null==_?void 0:_.nodeMetrics)?void 0:R.size)??0," nodes · ",(null==(H=null==_?void 0:_.validatedEdges)?void 0:H.length)??0," edges"]})})]}),Bn={info:{dot:"bg-sys-blue",text:"text-fg-secondary"},warning:{dot:"bg-status-warning",text:"text-status-warning"},critical:{dot:"bg-status-danger",text:"text-status-danger"}},Pn={"edge-appeared":"Link Discovered","edge-disappeared":"Link Lost","ghost-appeared":"Ghost Discovered","ghost-disappeared":"Ghost Resolved","betweenness-shift":"Traffic Rerouting","community-change":"Community Change","class-change":"Role Change","node-appeared":"Node Appeared","node-disappeared":"Node Dropped","snr-degradation":"SNR Degradation","asymmetry-shift":"Asymmetry Shift"},En=(e,t,s)=>null==t||""===t?null:n.jsxs("div",{className:"flex justify-between gap-2",children:[n.jsx("span",{className:"text-fg-muted",children:e}),n.jsx("span",{className:`tabular-nums text-right ${s??"text-fg-secondary"}`,children:t})]}),An=e=>{const t=[];return e.isZeroHop&&t.push({label:"Zero-Hop",color:"text-status-warning"}),e.isDirectPath&&t.push({label:"Direct",color:"text-sys-blue"}),e.isBackbone&&t.push({label:"Backbone",color:"text-fg-primary"}),e.isLoop&&t.push({label:"Loop",color:"text-sys-indigo"}),0===t.length?null:n.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.map(e=>n.jsx("span",{className:`text-[8px] font-medium uppercase tracking-wider px-1 py-px radius-badge bg-subtle-fill ${e.color}`,children:e.label},e.label))})},zn=e=>n.jsxs("div",{className:"text-[9px] space-y-0.5",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"capitalize font-medium text-fg-secondary",children:e.nodeClass}),e.isZeroHop&&n.jsx("span",{className:"text-[8px] font-medium uppercase tracking-wider px-1 py-px radius-badge bg-subtle-fill text-status-warning",children:"Neighbor"})]}),En("Degree",e.degree),e.betweenness>.01&&En("Betweenness",e.betweenness.toFixed(3)),En("Packets",e.packetCount),En("Community",`#${e.communityId}`),En("Activity",e.activityLevel),null!=e.avgRssi&&En("RSSI",`${e.avgRssi.toFixed(0)} dBm`),null!=e.avgSnr&&En("SNR",`${e.avgSnr.toFixed(1)} dB`)]}),$n=e=>n.jsxs("div",{className:"text-[9px] space-y-0.5",children:[null!=e.previousValue&&null!=e.currentValue&&n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx("span",{className:"text-fg-muted font-mono",children:"number"==typeof e.previousValue?e.previousValue.toFixed(3):e.previousValue}),n.jsx("span",{className:"text-fg-muted/40",children:"→"}),n.jsx("span",{className:"text-fg-secondary font-mono",children:"number"==typeof e.currentValue?e.currentValue.toFixed(3):e.currentValue}),"number"==typeof e.previousValue&&"number"==typeof e.currentValue&&n.jsxs("span",{className:e.currentValue>e.previousValue?"text-sys-green":"text-signal-poor",children:["(",e.currentValue>e.previousValue?"+":"",(e.currentValue-e.previousValue).toFixed(3),")"]})]}),e.nodeDetail&&n.jsxs(n.Fragment,{children:[En("Class",e.nodeDetail.nodeClass),En("Degree",e.nodeDetail.degree),e.nodeDetail.betweenness>.01&&En("Betweenness",e.nodeDetail.betweenness.toFixed(3))]})]}),Tn=s.useCallback(e=>{ys(t=>t===e?null:e)},[]),In=n.jsxs(bt,{id:"anomaly",title:"Anomaly Log",icon:n.jsx(oe,{}),open:hs,onClose:()=>xs(!1),defaultPosition:{x:"undefined"!=typeof window?window.innerWidth-328:600,y:100},defaultSize:{width:308,height:400},minSize:{width:260,height:180},maxSize:{width:440,height:700},headerActions:ps.length>0?n.jsx("button",{onClick:()=>{js.current.clear(),gs([]),ys(null)},className:"p-0.5 radius-badge hover-bg transition-base",title:"Clear all",children:n.jsx(de,{className:"w-2.5 h-2.5 text-fg-muted"})}):void 0,children:[0===ps.length?n.jsxs("div",{className:"px-3 py-6 text-center",children:[n.jsx(oe,{className:"w-5 h-5 text-fg-muted mx-auto mb-1.5"}),n.jsx("p",{className:"text-[11px] text-fg-muted",children:"No anomalies detected yet"}),n.jsx("p",{className:"text-[9px] text-fg-muted/60 mt-0.5",children:"Changes appear after topology recomputes"})]}):n.jsx("div",{className:"overflow-y-auto",children:ps.slice(0,50).map(e=>{const t=Bn[e.severity],s=S(e.detectedAt/1e3),a=bs===e.id,i=!(!e.edgeDetail&&!e.nodeDetail&&null==e.previousValue);return n.jsxs("div",{className:`border-b border-edge-subtle/50 last:border-0 transition-colors ${i?"cursor-pointer hover-bg":""} ${a?"bg-subtle-fill/50":""}`,onClick:i?()=>Tn(e.id):void 0,children:[n.jsxs("div",{className:"flex items-start gap-2 px-3 py-1.5",children:[n.jsx("span",{className:`w-1.5 h-1.5 rounded-full shrink-0 mt-1.5 ${t.dot}`}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:`text-[10px] leading-tight ${t.text}`,children:e.description}),n.jsxs("p",{className:"text-[9px] text-fg-muted/60 mt-0.5",children:[Pn[e.category]??e.category," · ",s]})]}),i&&n.jsx(ue,{className:"w-3 h-3 text-fg-muted/40 shrink-0 mt-0.5 transition-transform duration-150 "+(a?"rotate-180":"")})]}),a&&n.jsx("div",{className:"px-3 pb-2 pl-6",children:n.jsxs("div",{className:"border-l-2 border-edge-subtle/60 pl-2 py-0.5",children:[e.edgeDetail&&(o=e.edgeDetail,r=e.category,n.jsxs("div",{className:"text-[9px] space-y-0.5",children:[(o.fromClass||o.toClass)&&n.jsxs("div",{className:"flex items-center gap-1 text-fg-muted",children:[n.jsx("span",{className:"capitalize",children:o.fromClass??"?"}),n.jsx("span",{className:"text-fg-muted/40",children:"↔"}),n.jsx("span",{className:"capitalize",children:o.toClass??"?"})]}),"edge-appeared"===r&&o.packetCount>0&&n.jsxs(n.Fragment,{children:[En("Packets",o.packetCount),En("Confidence",`${(100*o.confidence).toFixed(0)}%`,o.confidence>=.8?"text-sys-green":o.confidence>=.5?"text-sys-indigo":"text-signal-poor"),En("Symmetry",`${(100*o.symmetryRatio).toFixed(0)}%`)]}),o.isZeroHop&&null!=o.avgRssi&&En("RSSI",`${o.avgRssi.toFixed(0)} dBm`),o.isZeroHop&&null!=o.avgSnr&&En("SNR",`${o.avgSnr.toFixed(1)} dB`),null!=o.fromBetweenness&&o.fromBetweenness>.01&&En(`${o.fromName??"A"} centrality`,o.fromBetweenness.toFixed(3)),null!=o.toBetweenness&&o.toBetweenness>.01&&En(`${o.toName??"B"} centrality`,o.toBetweenness.toFixed(3)),An(o)]})),e.nodeDetail&&!e.edgeDetail&&("node-appeared"===e.category||"node-disappeared"===e.category)&&zn(e.nodeDetail),("betweenness-shift"===e.category||"community-change"===e.category||"class-change"===e.category)&&$n(e)]})})]},e.id);var o,r})}),ps.length>0&&n.jsx("div",{className:"px-3 py-1.5 border-t border-edge-subtle",children:n.jsxs("span",{className:"text-[9px] text-fg-muted",children:[ps.length," total · showing ",Math.min(ps.length,50)]})})]}),Gn=s.useMemo(()=>{const e={};for(const t of Is)e[t.edgeType]=(e[t.edgeType]??0)+1;return e},[Is]),On=n.jsxs(bt,{id:"legend",title:"Legend",icon:n.jsx(ee,{}),open:_e,onClose:()=>Ue(!1),defaultPosition:{x:12,y:60},defaultSize:{width:224,height:400},minSize:{width:200,height:150},maxSize:{width:360,height:700},autoHeight:!0,children:[n.jsxs("div",{className:"border-b border-edge-subtle",children:[n.jsxs("button",{onClick:()=>Je(e=>!e),className:"w-full flex items-center gap-1.5 px-3 py-1.5 text-[10px] font-medium text-fg-secondary hover-bg transition-base",children:[qe?n.jsx(ue,{className:"w-3 h-3"}):n.jsx(me,{className:"w-3 h-3"}),"Nodes",n.jsx("span",{className:"text-fg-muted ml-auto tabular-nums",children:Qs.length})]}),qe&&n.jsx("div",{className:"px-2 pb-2 space-y-0.5",children:[["local","Local"],["hub","Hub"],["gateway","Gateway"],["backbone","Backbone"],["neighbor","Neighbor"],["mobile","Mobile"],["ghost","Ghost"],["standard","Standard"]].map(([e,t])=>{const s=fe[e]??0;if(0===s&&"local"!==e)return null;const a=ct.has(e);return n.jsx(k,{content:zt[e],children:n.jsxs("button",{onClick:()=>mn(e),className:"w-full flex items-center gap-2 px-2 py-1 radius-badge transition-base text-left "+(a?"opacity-40":"hover-bg"),children:[n.jsx("span",{className:"w-2.5 h-2.5 rounded-full shrink-0",style:{backgroundColor:we[e]}}),n.jsx("span",{className:"text-[10px] text-fg-secondary flex-1",children:t}),n.jsx("span",{className:"text-[10px] text-fg-muted tabular-nums",children:s})]})},e)})})]}),n.jsxs("div",{className:"border-b border-edge-subtle",children:[n.jsxs("button",{onClick:()=>it(e=>!e),className:"w-full flex items-center gap-1.5 px-3 py-1.5 text-[10px] font-medium text-fg-secondary hover-bg transition-base",children:[tt?n.jsx(ue,{className:"w-3 h-3"}):n.jsx(me,{className:"w-3 h-3"}),"Edges",n.jsx("span",{className:"text-fg-muted ml-auto tabular-nums",children:qs.length})]}),tt&&n.jsx("div",{className:"px-2 pb-2 space-y-0.5",children:[{type:"zero-hop",label:"Zero-Hop RF"},{type:"direct-path",label:"Direct Path"},{type:"loop",label:"Loop"},{type:"backbone",label:"Backbone"},{type:"standard",label:"Standard"},{type:"ghost",label:"Ghost"}].map(({type:e,label:t})=>{const s=Gn[e]??0;if(0===s)return null;const a=Gt(e,.8,Ne);return n.jsx(k,{content:Zt[e],children:n.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 cursor-help",children:[n.jsx("span",{className:"w-4 h-0.5 shrink-0 rounded-full",style:{backgroundColor:a}}),n.jsx("span",{className:"text-[10px] text-fg-secondary flex-1",children:t}),n.jsx("span",{className:"text-[10px] text-fg-muted tabular-nums",children:s})]})},e)})})]}),es&&Us&&n.jsxs("div",{className:"border-b border-edge-subtle",children:[n.jsxs("div",{className:"px-3 py-1.5 text-[10px] font-medium text-sys-green flex items-center gap-1.5",children:[n.jsx(ie,{className:"w-3 h-3"}),"Link Budget",n.jsxs("span",{className:"text-fg-muted ml-auto tabular-nums",children:[Us.analyzedEdges+Us.rssiOnlyEdges,"/",Us.totalEdges]})]}),n.jsxs("div",{className:"px-3 pb-2 space-y-0.5",children:[(()=>{const e=Gs&&Gs>1e5?Gs/1e6:Gs||915,t=as??Zs??12,s=os??(Os&&Os>1e3?Os/1e3:Os||125),a=ls??Ks??5,i=ss??Ws??22,o=Xe(t,s,a),r=ds??o,l=Qe(1e3*s),c=ms??l,d=(null==Vs?void 0:Vs.filter(e=>e.isTraceEstimated).length)??0,u=(null==Vs?void 0:Vs.filter(e=>e.isZeroHop).length)??0,m=null!=ss||null!=as||null!=os||null!=ls||null!=ds,h="w-10 px-1 py-0 text-[10px] text-right tabular-nums bg-subtle-fill border border-edge-subtle rounded text-fg-secondary focus:outline-none focus:border-sys-blue";return n.jsxs("div",{className:"pb-1 mb-1 border-b border-edge-subtle space-y-0.5",children:[n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx("span",{className:"text-fg-muted",children:"Frequency"}),n.jsxs("span",{className:"text-fg-secondary tabular-nums",children:[e.toFixed(3)," MHz"]})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px] gap-1",children:[n.jsx("span",{className:"text-fg-muted",children:"SF"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("select",{value:t,onChange:e=>{const t=parseInt(e.target.value,10);is(t===(Zs??12)?null:t)},className:h+" w-12 appearance-none",children:[7,8,9,10,11,12].map(e=>n.jsxs("option",{value:e,children:["SF",e]},e))}),null!=as&&n.jsx("button",{onClick:()=>is(null),className:"text-[8px] text-sys-blue hover:underline",title:"Reset",children:"↺"})]})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px] gap-1",children:[n.jsx("span",{className:"text-fg-muted",children:"BW"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("select",{value:s,onChange:e=>{const t=parseFloat(e.target.value);rs(t===(Os&&Os>1e3?Os/1e3:Os||125)?null:t)},className:h+" w-14 appearance-none",children:[62.5,125,250,500].map(e=>n.jsxs("option",{value:e,children:[e," kHz"]},e))}),null!=os&&n.jsx("button",{onClick:()=>rs(null),className:"text-[8px] text-sys-blue hover:underline",title:"Reset",children:"↺"})]})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px] gap-1",children:[n.jsx("span",{className:"text-fg-muted",children:"CR"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("select",{value:a,onChange:e=>{const t=parseInt(e.target.value,10);cs(t===(Ks??5)?null:t)},className:h+" w-12 appearance-none",children:[5,6,7,8].map(e=>n.jsxs("option",{value:e,children:["4/",e]},e))}),null!=ls&&n.jsx("button",{onClick:()=>cs(null),className:"text-[8px] text-sys-blue hover:underline",title:"Reset",children:"↺"})]})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px] gap-1",children:[n.jsx("span",{className:"text-fg-muted",children:"TX Power"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("input",{type:"number",min:1,max:36,step:1,value:i,onChange:e=>{const t=parseInt(e.target.value,10);isNaN(t)||ns(t)},onBlur:e=>{const t=parseInt(e.target.value,10);isNaN(t)?ns(null):ns(Math.max(1,Math.min(36,t)))},className:h}),n.jsx("span",{className:"text-fg-muted",children:"dBm"}),null!=ss&&n.jsx("button",{onClick:()=>ns(null),className:"text-[8px] text-sys-blue hover:underline",title:"Reset",children:"↺"})]})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px] gap-1",children:[n.jsx("span",{className:"text-fg-muted",children:"Sensitivity"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("input",{type:"number",min:-150,max:-80,step:.5,value:Math.round(10*r)/10,onChange:e=>{const t=parseFloat(e.target.value);isNaN(t)||us(t)},onBlur:e=>{const t=parseFloat(e.target.value);isNaN(t)?us(null):us(Math.max(-150,Math.min(-80,t)))},className:h+" w-12"}),n.jsx("span",{className:"text-fg-muted",children:"dBm"}),null!=ds&&n.jsx("button",{onClick:()=>us(null),className:"text-[8px] text-sys-blue hover:underline",title:"Reset",children:"↺"})]})]}),d>0&&n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx("span",{className:"text-fg-muted",children:"Noise Floor"}),n.jsxs("span",{className:"text-fg-secondary tabular-nums "+(null!=ms?"":"italic text-fg-muted"),children:[c.toFixed(1)," dBm",null!=ms?"":" (est.)"]})]}),m&&n.jsx("button",{onClick:()=>{ns(null),is(null),rs(null),cs(null),us(null)},className:"w-full text-[9px] text-sys-blue hover:underline text-center pt-0.5",children:"Reset all to radio config"}),(u>0||d>0)&&n.jsxs("div",{className:"flex items-center justify-between text-[10px] pt-0.5",children:[n.jsx("span",{className:"text-fg-muted",children:"Sources"}),n.jsxs("span",{className:"text-fg-secondary tabular-nums",children:[u>0&&n.jsxs("span",{children:[u," direct"]}),u>0&&d>0&&n.jsx("span",{className:"text-fg-muted",children:" · "}),d>0&&n.jsxs("span",{className:"text-sys-indigo",children:[d," trace"]})]})]})]})})(),null!=Us.avgMarginDb&&n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx("span",{className:"text-fg-muted",children:"Avg Margin"}),n.jsxs("span",{className:"text-fg-secondary tabular-nums",children:[Us.avgMarginDb>0?"+":"",Us.avgMarginDb.toFixed(1)," dB"]})]}),["excellent","good","fair","marginal","critical"].map(e=>{const t=Us.marginCounts[e];return 0===t?null:n.jsxs("div",{className:"flex items-center gap-2 px-1 py-0.5",children:[n.jsx("span",{className:"w-3 h-0.5 shrink-0 rounded-full",style:{backgroundColor:st[e]}}),n.jsx("span",{className:"text-[10px] text-fg-secondary flex-1 capitalize",children:e}),n.jsx("span",{className:"text-[10px] text-fg-muted tabular-nums",children:t})]},e)}),Us.anomalousCount>0&&n.jsxs("div",{className:"flex items-center justify-between text-[10px] pt-0.5",children:[n.jsx("span",{className:"text-status-warning",children:"Anomalous"}),n.jsx("span",{className:"text-status-warning tabular-nums",children:Us.anomalousCount})]})]})]}),Nn&&Nn.atRiskPaths.length>0&&n.jsxs("div",{className:"border-b border-edge-subtle",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsxs("button",{onClick:()=>rt(e=>!e),className:"flex-1 flex items-center gap-1.5 px-3 py-1.5 text-[10px] font-medium text-status-warning hover-bg transition-base",children:[ot?n.jsx(ue,{className:"w-3 h-3"}):n.jsx(me,{className:"w-3 h-3"}),"At-Risk Paths",n.jsxs("span",{className:"text-fg-muted ml-auto tabular-nums",children:[Nn.criticalCount>0&&n.jsxs("span",{className:"text-status-danger",children:[Nn.criticalCount,"c"]}),Nn.criticalCount>0&&Nn.highCount>0&&" ",Nn.highCount>0&&n.jsxs("span",{className:"text-status-warning",children:[Nn.highCount,"h"]}),(Nn.criticalCount>0||Nn.highCount>0)&&Nn.moderateCount>0&&" ",Nn.moderateCount>0&&n.jsxs("span",{className:"text-fg-muted",children:[Nn.moderateCount,"m"]})]})]}),n.jsx(k,{content:n.jsxs("div",{className:"max-w-xs space-y-1.5",children:[n.jsx("div",{className:"font-semibold text-fg-primary",children:"Predictive Path Failure"}),n.jsx("div",{className:"text-fg-secondary text-[11px]",children:"Identifies paths at risk of failure by combining four weighted factors. Paths below the moderate threshold (35%) are not shown."}),n.jsxs("div",{className:"pt-1 border-t border-edge-subtle/30 space-y-0.5 text-[10px]",children:[n.jsx("div",{className:"text-fg-muted font-medium",children:"Factor weights"}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-secondary",children:"Declining usage"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"35%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-secondary",children:"Weak link certainty"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"30%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-secondary",children:"No alternate paths"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"20%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-secondary",children:"Low signal margin"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"15%"})]})]}),n.jsxs("div",{className:"pt-1 border-t border-edge-subtle/30 space-y-0.5 text-[10px]",children:[n.jsx("div",{className:"text-fg-muted font-medium",children:"Risk thresholds"}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-status-danger",children:"Critical"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"≥75% — failure likely imminent"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-status-warning",children:"High"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"55-74% — significant risk"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Moderate"}),n.jsx("span",{className:"text-fg-muted tabular-nums",children:"35-54% — worth monitoring"})]})]}),n.jsxs("div",{className:"pt-1 border-t border-edge-subtle/30 text-[10px] text-fg-muted font-mono space-y-0.5",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:"Edges analyzed"}),n.jsx("span",{className:"tabular-nums",children:Nn.edgesAnalyzed})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:"With signal data"}),n.jsx("span",{className:"tabular-nums",children:Nn.edgesWithSignal})]})]})]}),children:n.jsx("span",{className:"px-2 py-1.5 text-fg-muted cursor-help",children:n.jsx(oe,{className:"w-3 h-3"})})})]}),ot&&n.jsx("div",{className:"px-2 pb-2 space-y-1",children:Nn.atRiskPaths.slice(0,8).map(e=>{const t="critical"===e.riskLevel?"#EF4444":"high"===e.riskLevel?"#F97316":"#FBBF24",s="imminent"===e.urgency?"IMM":"near-term"===e.urgency?"NEAR":"WATCH";return n.jsx(k,{content:n.jsxs("div",{className:"max-w-xs space-y-1.5",children:[n.jsx("div",{className:"font-semibold text-fg-primary font-mono text-[11px]",children:e.hops.join(" → ")}),n.jsxs("div",{className:"space-y-0.5 text-[10px]",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Risk score"}),n.jsxs("span",{className:"font-semibold tabular-nums",style:{color:t},children:[(100*e.riskScore).toFixed(1),"%"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Health score"}),n.jsxs("span",{className:"text-fg-primary tabular-nums",children:[(100*e.healthScore).toFixed(0),"%"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Obs. trend"}),n.jsxs("span",{className:"tabular-nums "+(e.observationTrend<0?"text-status-danger":"text-fg-secondary"),children:[e.observationTrend>0?"+":"",e.observationTrend.toFixed(3)]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Alt. paths"}),n.jsx("span",{className:"tabular-nums "+(0===e.alternatePathsCount?"text-status-danger":"text-fg-secondary"),children:e.alternatePathsCount})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-muted",children:"Urgency"}),n.jsx("span",{className:"capitalize",style:{color:t},children:e.urgency})]})]}),e.factors.length>0&&n.jsxs("div",{className:"pt-1 border-t border-edge-subtle/30 space-y-0.5 text-[10px]",children:[n.jsx("div",{className:"text-fg-muted font-medium",children:"Contributing factors"}),e.factors.map((e,t)=>n.jsxs("div",{className:"space-y-0.5",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-fg-secondary",children:e.name}),n.jsxs("span",{className:"text-fg-muted tabular-nums",children:[(e.score*e.weight*100).toFixed(1),"% (",(100*e.weight).toFixed(0),"w × ",(100*e.score).toFixed(0),"s)"]})]}),n.jsx("div",{className:"text-fg-muted pl-1",children:e.description})]},t))]})]}),children:n.jsxs("div",{className:"px-2 py-1 radius-badge bg-subtle-fill/30 cursor-help",children:[n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx("span",{className:"w-1.5 h-1.5 rounded-full shrink-0",style:{backgroundColor:t}}),n.jsx("span",{className:"text-[10px] text-fg-secondary font-mono truncate flex-1",children:e.hops.join(" → ")}),n.jsx("span",{className:"text-[8px] uppercase tracking-wide px-1 py-px radius-badge",style:{backgroundColor:`${t}20`,color:t},children:s}),n.jsxs("span",{className:"text-[10px] tabular-nums font-semibold",style:{color:t},children:[(100*e.riskScore).toFixed(0),"%"]})]}),n.jsx("div",{className:"flex flex-wrap gap-1 mt-0.5 pl-3",children:e.factors.map((t,s)=>n.jsxs("span",{className:"text-[8px] text-fg-muted",children:[t.name," (",(t.score*t.weight*100).toFixed(0),"%)",s<e.factors.length-1?" ·":""]},s))})]})},e.pathKey)})})]}),n.jsxs("div",{className:"px-3 py-2 space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(k,{content:"Number of detected community clusters via graph partitioning",children:n.jsx("span",{className:"text-fg-muted cursor-help",children:"Communities"})}),n.jsx("span",{className:"text-fg-secondary tabular-nums",children:"louvain"===ht&&Cn?Cn.numCommunities:ve})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(k,{content:"Spectral uses eigenvector decomposition; Louvain maximizes modularity iteratively. Click to switch.",children:n.jsx("span",{className:"text-fg-muted cursor-help",children:"Algorithm"})}),n.jsx("button",{onClick:()=>pt(e=>"spectral"===e?"louvain":"spectral"),className:"text-sys-blue hover:underline cursor-pointer",children:"spectral"===ht?"Spectral":"Louvain"})]}),"louvain"===ht&&Cn&&n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(k,{content:"Louvain modularity score — quality of community partition (higher = better defined communities)",children:n.jsx("span",{className:"text-fg-muted cursor-help",children:"Modularity Q"})}),n.jsx("span",{className:"text-fg-secondary tabular-nums",children:Cn.modularity.toFixed(4)})]}),"louvain"===ht&&n.jsxs("div",{className:"mt-1.5 pt-1.5 border-t border-edge-subtle space-y-1.5",children:[n.jsx(Xt,{label:"Resolution γ",value:gt,onChange:ft,min:.01,max:5,step:.01}),n.jsx(Xt,{label:"K-weight",value:vt,onChange:St,min:.01,max:5,step:.01}),(1!==gt||1!==vt)&&n.jsx("button",{onClick:()=>{ft(1),St(1)},className:"w-full text-[10px] text-sys-blue hover:underline text-center",children:"Reset defaults"})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(k,{content:"Redundant path cycles in the topology — indicates alternate routing options",children:n.jsx("span",{className:"text-fg-muted cursor-help",children:"Loops"})}),n.jsx("span",{className:"text-fg-secondary tabular-nums",children:(null==(B=null==_?void 0:_.loops)?void 0:B.length)??0})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(k,{content:"High-betweenness edges that carry disproportionate traffic flow",children:n.jsx("span",{className:"text-fg-muted cursor-help",children:"Backbone"})}),n.jsx("span",{className:"text-fg-secondary tabular-nums",children:(null==(P=null==_?void 0:_.backboneEdges)?void 0:P.length)??0})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(k,{content:"Unresolved prefix nodes inferred by Viterbi HMM from repeated path patterns",children:n.jsx("span",{className:"text-fg-muted cursor-help",children:"Ghosts"})}),n.jsx("span",{className:"text-fg-secondary tabular-nums",children:ge.length})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(k,{content:"Community-aware node coloring — groups nodes by cluster assignment",children:n.jsx("span",{className:"text-fg-muted cursor-help",children:"Clustering"})}),n.jsx("span",{className:"tabular-nums "+(ut?"text-sys-blue":"text-fg-muted"),children:ut?"On":"Off"})]}),null!=wn&&n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(k,{content:"Algebraic connectivity — 2nd-smallest eigenvalue of the graph Laplacian. Near-zero = one bridge from network partition.",children:n.jsx("span",{className:"text-fg-muted cursor-help",children:"Fiedler λ₂"})}),n.jsx("span",{className:"tabular-nums "+(wn<.01?"text-status-warning":"text-fg-secondary"),children:wn.toFixed(4)})]}),ct.size>0&&n.jsxs("button",{onClick:()=>dt(new Set),className:"w-full mt-1 text-[10px] text-sys-blue hover:underline text-center",children:["Clear filters (",ct.size,")"]})]})]}),Zn=n.jsx(Z,{children:ze&&n.jsx(W.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.15},className:"absolute top-4 left-1/2 -translate-x-1/2 z-30 w-80",children:n.jsxs("div",{className:"surface-elevated radius-inset shadow-2xl overflow-hidden",children:[n.jsxs("div",{className:"flex items-center gap-2 px-3 py-2.5 border-b border-edge-subtle",children:[n.jsx(te,{className:"w-4 h-4 text-fg-muted shrink-0"}),n.jsx("input",{ref:Ns,type:"text",value:Ee,onChange:e=>Ae(e.target.value),placeholder:"Search by name or prefix...",className:"flex-1 bg-transparent text-sm text-fg-primary placeholder:text-fg-muted focus:outline-none",onKeyDown:e=>{"Escape"===e.key?($e(!1),Ae("")):"Enter"===e.key&&cn.length>0&&dn(cn[0])}}),Ee&&n.jsx("button",{onClick:()=>Ae(""),className:"p-0.5 radius-badge hover-bg transition-base",children:n.jsx(U,{className:"w-3 h-3 text-fg-muted"})})]}),cn.length>0&&n.jsx("div",{className:"max-h-64 overflow-y-auto",children:cn.map((e,t)=>n.jsxs("button",{onClick:()=>dn(e),className:"w-full flex items-center gap-3 px-3 py-2 text-left hover-bg transition-base "+(0===t?"bg-subtle-fill/50":""),children:[n.jsx("span",{className:"w-2.5 h-2.5 rounded-full shrink-0",style:{backgroundColor:we[e.nodeClass]}}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-sm text-fg-primary truncate",children:e.name||e.prefix}),e.name&&n.jsx("div",{className:"text-[10px] text-fg-muted",children:e.prefix})]}),n.jsx(he,{className:"w-3 h-3 text-fg-muted shrink-0"})]},e.id))}),Ee&&0===cn.length&&n.jsx("div",{className:"px-3 py-4 text-center text-sm text-fg-muted",children:"No nodes found"}),!Ee&&n.jsx("div",{className:"px-3 py-2 type-data-xs text-fg-muted",children:"Type to search • Enter to select • Esc to close"})]})})});return $?0===zs.length?n.jsxs("div",{className:"relative h-[calc(100dvh-56px)] lg:h-dvh min-h-[500px] -mx-4 sm:-mx-6 lg:-mx-8 -mt-5 -mb-4 sm:-mb-6 lg:-mb-8 overflow-hidden",children:[Dn,n.jsx("div",{className:"absolute inset-0 bg-body flex items-center justify-center",children:n.jsx(Ut,{})})]}):Cs?Be?n.jsxs("div",{className:"fixed inset-0 z-50 bg-body flex flex-col overflow-hidden",children:[n.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5 surface-header z-10",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(X,{className:"w-5 h-5 text-icon-page-title"}),n.jsxs("h1",{className:"type-title text-fg-primary flex items-center gap-2",children:["MeshGraph",n.jsx(C,{color:"violet",compact:!0,children:"Analytics"})]}),n.jsxs("span",{className:"text-[10px] text-fg-muted tabular-nums",children:[Qs.length," nodes • ",qs.length," edges"]})]}),n.jsx(k,{content:"Exit fullscreen",children:n.jsx("button",{onClick:un,className:"p-1.5 radius-inner hover-bg transition-base",children:n.jsx(ce,{className:"w-4 h-4 text-fg-muted"})})})]}),n.jsxs("div",{className:"flex-1 relative min-h-0 m-2 surface-base radius-inset overflow-hidden border border-edge-subtle",children:[n.jsx(a,{className:"absolute inset-0",points:Cs,links:Ss,...Ls,...Rs,backgroundColor:ke,fitViewOnInit:!0,fitViewPadding:.15,showLabels:Ke,showDynamicLabels:!1,showTopLabels:Ke,showTopLabelsLimit:200,showHoveredPointLabel:!0,pointLabelColor:Se,pointClusterBy:ut?"communityId":void 0,onPolygonSelected:$t?pn:void 0,polygonalSelectorStrokeColor:Ne?"#FBBF24":"#D97706",onClick:ln,onLinkClick:rn,onMount:tn,hoveredPointRingColor:Ne?"#FBBF24":"#D97706",hoveredPointCursor:"pointer",hoveredLinkCursor:"pointer"}),Zn,On,Rn,Mn,Hn,In,n.jsxs(Z,{children:[Fe&&n.jsx(Vt,{node:Fe,egoMetrics:fn,onExpandEgo:yn,neighbors:bn,onSelectNeighbor:an,txDelayRec:vn,onClose:()=>{var e;Re(null),null==(e=ws.current)||e.unselectAllPoints()}}),Me&&!Fe&&n.jsx(Kt,{edge:Me,onClose:()=>He(null)}),Wt&&!Fe&&!Me&&n.jsx(_t,{metrics:Wt,onClose:gn})]})]})]}):n.jsxs("div",{className:"relative h-[calc(100dvh-56px)] lg:h-dvh min-h-[500px] -mx-4 sm:-mx-6 lg:-mx-8 -mt-5 -mb-4 sm:-mb-6 lg:-mb-8 overflow-hidden",children:[Dn,n.jsxs("div",{className:"absolute inset-0",children:[n.jsx(a,{className:"absolute inset-0",points:Cs,links:Ss,...Ls,...Rs,backgroundColor:ke,fitViewOnInit:!0,fitViewPadding:.15,showLabels:Ke,showDynamicLabels:!1,showTopLabels:Ke,showTopLabelsLimit:200,showHoveredPointLabel:!0,pointLabelColor:Se,pointClusterBy:ut?"communityId":void 0,onPolygonSelected:$t?pn:void 0,polygonalSelectorStrokeColor:Ne?"#FBBF24":"#D97706",onClick:ln,onLinkClick:rn,onMount:tn,hoveredPointRingColor:Ne?"#FBBF24":"#D97706",hoveredPointCursor:"pointer",hoveredLinkCursor:"pointer"}),Zn,On,Rn,Mn,Hn,In,n.jsxs("div",{className:"absolute bottom-4 right-4 z-10 hidden lg:flex items-center gap-3 type-data-xs text-fg-muted/60",children:[n.jsxs("span",{children:[n.jsx("kbd",{className:"px-1 py-0.5 radius-badge bg-subtle-fill/50 font-mono",children:"/"})," Search"]}),n.jsxs("span",{children:[n.jsx("kbd",{className:"px-1 py-0.5 radius-badge bg-subtle-fill/50 font-mono",children:"F"})," Fit"]}),n.jsxs("span",{children:[n.jsx("kbd",{className:"px-1 py-0.5 radius-badge bg-subtle-fill/50 font-mono",children:"L"})," Labels"]}),n.jsxs("span",{children:[n.jsx("kbd",{className:"px-1 py-0.5 radius-badge bg-subtle-fill/50 font-mono",children:"Space"})," Pause"]}),n.jsxs("span",{children:[n.jsx("kbd",{className:"px-1 py-0.5 radius-badge bg-subtle-fill/50 font-mono",children:"Esc"})," Clear"]})]}),n.jsxs(Z,{children:[Fe&&n.jsx(Vt,{node:Fe,egoMetrics:fn,onExpandEgo:yn,neighbors:bn,onSelectNeighbor:an,txDelayRec:vn,onClose:()=>{var e;Re(null),null==(e=ws.current)||e.unselectAllPoints()}}),Me&&!Fe&&n.jsx(Kt,{edge:Me,onClose:()=>He(null)}),Wt&&!Fe&&!Me&&n.jsx(_t,{metrics:Wt,onClose:gn})]})]})]}):n.jsxs("div",{className:"relative h-[calc(100dvh-56px)] lg:h-dvh min-h-[500px] -mx-4 sm:-mx-6 lg:-mx-8 -mt-5 -mb-4 sm:-mb-6 lg:-mb-8 overflow-hidden",children:[Dn,n.jsxs("div",{className:"absolute inset-0 bg-body flex flex-col items-center justify-center gap-3",children:[n.jsx(xe,{className:"w-8 h-8 text-sys-blue animate-spin"}),n.jsx("span",{className:"type-body text-fg-muted",children:"Preparing graph..."})]})]}):n.jsxs("div",{className:"relative h-[calc(100dvh-56px)] lg:h-dvh min-h-[500px] -mx-4 sm:-mx-6 lg:-mx-8 -mt-5 -mb-4 sm:-mb-6 lg:-mb-8 overflow-hidden",children:[Dn,n.jsxs("div",{className:"absolute inset-0 bg-body flex items-center justify-center",children:[n.jsx(z,{isOpen:I,onClose:K}),!I&&n.jsx(xe,{className:"w-8 h-8 text-sys-blue animate-spin"})]})]})}export{qt as default};
