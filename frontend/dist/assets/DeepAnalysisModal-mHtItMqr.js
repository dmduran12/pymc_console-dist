import{d as b,bf as G,dx as q,dy as D,cL as L,r as M,bQ as F,fY as P,fZ as W,j as f,ac as $,f_ as B,ad as Y,m as H,w as R,c as w,L as U}from"./index-Dn8tK98n.js";import{D as K}from"./download-Dngi9MS4.js";import{D as X}from"./database-bBLuCWVH.js";/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Ie=b("eye-off",Z);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M9 10h.01",key:"qbtxuw"}],["path",{d:"M15 10h.01",key:"1qmjsl"}],["path",{d:"M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z",key:"uwwb07"}]],J=b("ghost",Q);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]],_=b("git-branch",ee);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],Se=b("grip-vertical",te);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],Ae=b("maximize-2",ne);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],De=b("minimize-2",ie);class se{constructor(){this.componentControls=new Set}subscribe(e){return this.componentControls.add(e),()=>this.componentControls.delete(e)}start(e,t){this.componentControls.forEach(i=>{i.start(e.nativeEvent||e,t)})}cancel(){this.componentControls.forEach(e=>{e.cancel()})}stop(){this.componentControls.forEach(e=>{e.stop()})}}const oe=()=>new se;function Le(){return G(oe)}const ce={hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1,transition:{type:"spring",stiffness:400,damping:15}},exit:{opacity:0,scale:.9,transition:{duration:D.fast}}},Re={hidden:{opacity:0,y:"100%"},visible:{opacity:1,y:0,transition:{type:"spring",stiffness:400,damping:30}},exit:{opacity:0,y:"100%",transition:{duration:D.medium,ease:q.easeIn}}},re=1e-8,ae=100,E=3,le=4,k=5,fe=20,ue=.001,C=.3,me=30,de=.05,he=.7,T=.3;function v(n,e){let t=0;for(let i=0;i<n.length;i++)t+=n[i]*e[i];return t}function ge(n){return Math.sqrt(v(n,n))}function I(n){const e=ge(n);if(e>0)for(let t=0;t<n.length;t++)n[t]/=e}function S(n,e){const t=v(n,e);for(let i=0;i<n.length;i++)n[i]-=t*e[i]}function pe(n,e){const t=n.length,i=new Array(t).fill(0);for(let o=0;o<t;o++)for(let c=0;c<t;c++)i[o]+=n[o][c]*e[c];return i}function ye(n){const e=Math.exp(-n/me);return Math.max(de,e)}function xe(n,e,t,i){const o=e.length,c=new Map(e.map((a,r)=>[a,r])),l=Array(o).fill(null).map(()=>Array(o).fill(0));for(const a of n){const r=c.get(a.fromHash),s=c.get(a.toHash);if(r!==void 0&&s!==void 0&&r!==s){const m=a.strength*a.certainCount;let u=1;if(t){const y=t.get(a.fromHash),x=t.get(a.toHash);if(y&&x){const V=L(y[0],y[1],x[0],x[1])/1e3;u=ye(V)}}let d=1;if(i){const y=[a.fromHash,a.toHash].sort().join("-");d=1-(i.get(y)??0)*he}const h=a.symmetryRatio??0,p=T+(1-T)*h,g=Math.pow(m,1-C)*Math.pow(u,C)*d*p;l[r][s]=g,l[s][r]=g}}return l}function O(n){const e=n.length,t=Array(e).fill(null).map(()=>Array(e).fill(0));for(let i=0;i<e;i++){let o=0;for(let c=0;c<e;c++)o+=n[i][c],t[i][c]=-n[i][c];t[i][i]=o}return t}function z(n){const e=n.length,t=Array(e).fill(1/Math.sqrt(e));let i=0;for(let r=0;r<e;r++){let s=0;for(let m=0;m<e;m++)s+=Math.abs(n[r][m]);i=Math.max(i,s)}const o=Array(e).fill(null).map(()=>Array(e).fill(0));for(let r=0;r<e;r++){for(let s=0;s<e;s++)o[r][s]=-n[r][s];o[r][r]=i+o[r][r]}let c=Array(e).fill(0).map((r,s)=>Math.sin(s*12.9898)*43758.5453%1-.5);S(c,t),I(c);let l=0;for(let r=0;r<ae;r++){const s=pe(o,c);S(s,t);const m=v(s,s)/v(c,s);if(I(s),c=s,Math.abs(m-l)<re){const u=i-m;return{vector:c,eigenvalue:u}}l=m}const a=i-l;return{vector:c,eigenvalue:a}}function be(n,e){if(n.length<2)return 0;const t=[];for(const l of n){const a=e.get(l);a&&t.push(a)}if(t.length<2)return 0;const i=Math.min(t.length,20),o=t.length<=i?t:Me(t,i);let c=0;for(let l=0;l<o.length;l++)for(let a=l+1;a<o.length;a++){const r=L(o[l][0],o[l][1],o[a][0],o[a][1])/1e3;c=Math.max(c,r)}return c}function Me(n,e){if(e>=n.length)return n;const t=[],i=n.length/e;for(let o=0;o<e;o++)t.push(n[Math.floor(o*i)]);return t}function je(n,e,t,i){const o=e.length;if(o<E)return null;const c=new Set(e),l=n.filter(h=>c.has(h.fromHash)&&c.has(h.toHash));if(l.length===0)return null;const a=xe(l,e,t,i),r=O(a),{vector:s,eigenvalue:m}=z(r);if(m<ue)return null;const u=[],d=[];for(let h=0;h<o;h++)s[h]<0?u.push(e[h]):d.push(e[h]);return u.length<k||d.length<k?null:{group0:u,group1:d,fiedlerValue:m}}function Oe(n,e,t,i){const o=e.length;if(o<E)return{communities:new Map([[0,e]]),nodePartitions:e.map(u=>({hash:u,community:0,fiedlerValue:0})),numCommunities:1,fiedlerValue:0,isConnected:o<=1};const c=[];let l=1/0;const a=[[e,0]];for(;a.length>0;){const[u,d]=a.shift();if((t?be(u,t):0)>fe&&d<le&&u.length>=k*2){const g=je(n,u,t,i);if(g){l=Math.min(l,g.fiedlerValue),a.push([g.group0,d+1]),a.push([g.group1,d+1]);continue}}c.push(u)}const r=new Map,s=[],m=new Map;for(let u=0;u<c.length;u++){r.set(u,c[u]);for(const d of c[u])m.set(d,u)}for(const u of e)s.push({hash:u,community:m.get(u)??0,fiedlerValue:0});return{communities:r,nodePartitions:s,numCommunities:c.length,fiedlerValue:l===1/0?0:l,isConnected:!0}}function ze(n){const e=["rgba(139, 92, 246, 0.25)","rgba(16, 185, 129, 0.25)","rgba(245, 158, 11, 0.25)","rgba(239, 68, 68, 0.25)","rgba(59, 130, 246, 0.25)","rgba(236, 72, 153, 0.25)","rgba(20, 184, 166, 0.25)","rgba(249, 115, 22, 0.25)"];return e[n%e.length]}function Ve(n,e){if(e.length<E)return 0;const t=e.length,i=new Map(e.map((a,r)=>[a,r])),o=Array(t).fill(null).map(()=>Array(t).fill(0));for(const a of n){const r=i.get(a.fromHash),s=i.get(a.toHash);r!==void 0&&s!==void 0&&r!==s&&(o[r][s]=1,o[s][r]=1)}const c=O(o),{eigenvalue:l}=z(c);return Math.max(0,l)}function Ge(n){const e=["rgba(139, 92, 246, 0.6)","rgba(16, 185, 129, 0.6)","rgba(245, 158, 11, 0.6)","rgba(239, 68, 68, 0.6)","rgba(59, 130, 246, 0.6)","rgba(236, 72, 153, 0.6)","rgba(20, 184, 166, 0.6)","rgba(249, 115, 22, 0.6)"];return e[n%e.length]}function qe(n,e){let t,i;if(e===void 0)for(const o of n)o!=null&&(t===void 0?o>=o&&(t=i=o):(t>o&&(t=o),i<o&&(i=o)));else{let o=-1;for(let c of n)(c=e(c,++o,n))!=null&&(t===void 0?c>=c&&(t=i=c):(t>c&&(t=c),i<c&&(i=c)))}return[t,i]}const ve=Math.sqrt(50),Ne=Math.sqrt(10),we=Math.sqrt(2);function N(n,e,t){const i=(e-n)/Math.max(0,t),o=Math.floor(Math.log10(i)),c=i/Math.pow(10,o),l=c>=ve?10:c>=Ne?5:c>=we?2:1;let a,r,s;return o<0?(s=Math.pow(10,-o)/l,a=Math.round(n*s),r=Math.round(e*s),a/s<n&&++a,r/s>e&&--r,s=-s):(s=Math.pow(10,o)*l,a=Math.round(n/s),r=Math.round(e/s),a*s<n&&++a,r*s>e&&--r),r<a&&.5<=t&&t<2?N(n,e,t*2):[a,r,s]}function Fe(n,e,t){if(e=+e,n=+n,t=+t,!(t>0))return[];if(n===e)return[n];const i=e<n,[o,c,l]=i?N(e,n,t):N(n,e,t);if(!(c>=o))return[];const a=c-o+1,r=new Array(a);if(i)if(l<0)for(let s=0;s<a;++s)r[s]=(c-s)/-l;else for(let s=0;s<a;++s)r[s]=(c-s)*l;else if(l<0)for(let s=0;s<a;++s)r[s]=(o+s)/-l;else for(let s=0;s<a;++s)r[s]=(o+s)*l;return r}function A(n,e,t){return e=+e,n=+n,t=+t,N(n,e,t)[2]}function Pe(n,e,t){e=+e,n=+n,t=+t;const i=e<n,o=i?A(e,n,t):A(n,e,t);return(i?-1:1)*(o<0?1/-o:o)}function We(n,e){let t;for(const i of n)i!=null&&(t<i||t===void 0&&i>=i)&&(t=i);return t}function j({label:n,icon:e,status:t,detail:i}){return f.jsxs("div",{className:w("flex items-center gap-3 py-3 px-4 radius-inset transition-base",t==="active"&&"bg-sys-blue/10",t==="complete"&&"bg-sys-blue/10 ring-2 ring-inset ring-sys-blue",t==="pending"&&"opacity-40"),children:[f.jsx("div",{className:w("w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 transition-all duration-300",t==="active"&&"bg-sys-blue/20",t==="complete"&&"bg-sys-blue/20",t==="pending"&&"bg-subtle-fill"),children:t==="complete"?f.jsx(R,{className:"w-4 h-4 text-sys-blue"}):t==="active"?f.jsx(U,{className:"w-4 h-4 animate-spin text-sys-blue"}):f.jsx("span",{className:"text-fg-muted",children:e})}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsx("div",{className:w("text-sm font-medium transition-colors",t==="active"&&"text-sys-blue",t==="complete"&&"text-sys-blue",t==="pending"&&"text-fg-muted"),children:n}),i&&t!=="pending"&&f.jsx("div",{className:"text-xs text-fg-muted mt-0.5 truncate",children:i})]})]})}function ke({isOpen:n,onClose:e}){const{packetCacheState:t,triggerDeepAnalysis:i}=F(),o=P(),c=W(),l=t.packetCount,[a,r]=M.useState("fetching");M.useEffect(()=>{n&&i()},[n,i]),M.useEffect(()=>{if(n){if(t.isTopologyLoading)r("fetching");else if(o)r("analyzing"),setTimeout(()=>r("building"),500),setTimeout(()=>r("discovering"),1e3);else if(c>0&&!t.isTopologyLoading){r("complete");const p=setTimeout(()=>{e()},1500);return()=>clearTimeout(p)}}},[n,t.isTopologyLoading,o,c,e]);const s=a==="complete",m=t.loadProgress,u=M.useMemo(()=>{if(m&&m.target>0){const p=(m.loaded/1e3).toFixed(1),g=(m.target/1e3).toFixed(1);return`Loading... ${p}k / ${g}k packets (${m.percent}%)`}return l>0?`${l.toLocaleString()} packets loaded`:"Connecting to database..."},[m,l]),d=p=>{const g=["fetching","analyzing","building","discovering","complete"],y=g.indexOf(a),x=g.indexOf(p);return x<y?"complete":x===y?"active":"pending"},h=s?e:()=>{};return f.jsx($,{open:n,onClose:h,size:"sm",bottomSheet:!1,children:f.jsx(B,{isLoading:!s,borderRadius:16,children:f.jsx(Y,{className:"p-6 radius-card overflow-hidden",children:s?f.jsxs("div",{className:"flex flex-col items-center py-6",children:[f.jsx(H.div,{variants:ce,initial:"hidden",animate:"visible",className:"w-16 h-16 rounded-full flex items-center justify-center mb-4 bg-sys-blue/20",children:f.jsx(R,{className:"w-8 h-8 text-sys-blue"})}),f.jsx("h3",{className:"type-micro text-sys-blue",children:"Ready!"}),f.jsx("button",{onClick:e,className:"mt-3 sm:hidden min-h-[44px] min-w-[44px] px-4 flex items-center justify-center text-[15px] font-medium text-sys-blue active:text-sys-blue/70 transition-base radius-inner active:bg-subtle-fill",children:"Done"})]}):f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[f.jsx("div",{className:"w-10 h-10 radius-inset flex items-center justify-center bg-sys-blue/15",children:f.jsx(_,{className:"w-5 h-5 text-sys-blue"})}),f.jsxs("div",{children:[f.jsx("h3",{className:"type-micro",children:"Deep Analysis"}),f.jsx("p",{className:"text-xs text-fg-muted",children:"Building mesh topology"})]})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx(j,{label:"Fetching Packets",icon:f.jsx(K,{className:"w-4 h-4"}),status:d("fetching"),detail:u}),f.jsx(j,{label:"Analyzing Database",icon:f.jsx(X,{className:"w-4 h-4"}),status:d("analyzing"),detail:"Processing packet paths"}),f.jsx(j,{label:"Building Topology",icon:f.jsx(_,{className:"w-4 h-4"}),status:d("building"),detail:"Computing mesh edges"}),f.jsx(j,{label:"Discovering Nodes",icon:f.jsx(J,{className:"w-4 h-4"}),status:d("discovering"),detail:"Viterbi HMM ghost detection"})]}),f.jsx("p",{className:"text-xs text-fg-muted text-center mt-5",children:"This may take a few seconds..."})]})})})})}const $e=M.memo(ke);export{$e as D,Ie as E,Se as G,Ae as M,Fe as a,A as b,Ve as c,De as d,qe as e,J as f,_ as g,Ge as h,ze as i,Oe as j,We as m,Re as s,Pe as t,Le as u};
