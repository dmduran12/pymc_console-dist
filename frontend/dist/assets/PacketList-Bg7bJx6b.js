const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PathMapMapLibre-CdvACmoL.js","assets/vendor-react-CHg3w57L.js","assets/vendor-core-CgllfypI.js","assets/cosmograph-RBQGoH9-.js","assets/BasemapLayer-VM7R8hCP.js","assets/index-B4woLUMa.js","assets/vendor-charts-DuSK2RSZ.js","assets/vendor-motion-CXybMqb1.js","assets/vendor-icons-rRVc_l7g.js","assets/vendor-fonts-CgDm-k6O.js","assets/maplibre-gl-B1CfjdFi.css","assets/vendor-charts-D1GxaB_c.css","assets/vendor-fonts-hkYiuhFD.css","assets/index-BbN7miMT.css"])))=>i.map(i=>d[i]);
import{c as H,a as st,u as tt}from"./vendor-core-CgllfypI.js";import{j as e,r as m}from"./vendor-react-CHg3w57L.js";import{B as ts,h as P,a5 as Ts,a6 as Ps,a7 as Bs,a8 as Ms,a9 as me,aa as Ke,H as Ge,ab as at,Q as oe,ac as nt,ad as le,ae as ms,af as rt,ag as lt,ah as it,ai as ct,aj as Ye,ak as ot,M as dt,p as Ls,al as xt,am as mt,an as ht,ao as ut,Y as Rs,_ as Fs,ap as pt,aq as ft,ar as as}from"./index-B4woLUMa.js";import{p as gt,d as yt,e as Hs,g as jt,b as bt}from"./primitives-DxP4M5z8.js";import{u as Nt,r as vt,a as wt,b as kt,c as Ct,d as St,i as _t}from"./consumer-registry-CWCmZQuW.js";import{D as Se,R as De,P as _e,g as Tt}from"./badge-colors-BNUqIXCA.js";import{g as Ds,e as ke,a as As}from"./chat-utils-pV5FH_xH.js";import{P as Es,d as Is,a as Pt,b as Bt}from"./payload-decoders-CXnzAzcz.js";import{S as Ae,i as Ee,g as hs}from"./SignalIndicator-C8dAI7pL.js";import{_ as Mt,$ as Lt,o as ns,A as he,V as zs,D as rs,R as fe,a0 as $s,a1 as Ie,a2 as Rt,a3 as Xe,a as Ft,a4 as Ht,H as Us,a5 as ge,a6 as ls,a7 as Dt,a8 as At,a9 as Et,aa as It,ab as zt,ac as $t,l as Ut,K as Ot,ad as Le,ae as Re,af as Os,ag as Vt,C as Gt,q as us,Z as ps,w as fs}from"./vendor-icons-rRVc_l7g.js";import{_ as Qt}from"./cosmograph-RBQGoH9-.js";import{f as Wt,r as qt}from"./usePipelineStore-CW29AYoP.js";import{D as ee}from"./DataBox-CbYpEKKd.js";import{L as Kt,m as de,u as Yt,A as Qe}from"./vendor-motion-CXybMqb1.js";import{D as Ze,u as Xt}from"./useMapViewStore-Dxt0JgN_.js";function Zt({"aria-label":s="Page navigation",className:a,...t}){return e.jsx("nav",{"aria-label":s,...t,className:H("flex gap-x-2",a)})}function Jt({onClick:s,disabled:a=!1,className:t,children:n="Previous"}){return e.jsx("span",{className:H("grow basis-0",t),children:e.jsxs(ts,{plain:!0,onClick:s,disabled:a,"aria-label":"Previous page",className:H("gap-1",a&&"invisible"),children:[e.jsx("svg",{className:"size-4 stroke-current",viewBox:"0 0 16 16",fill:"none","aria-hidden":"true",children:e.jsx("path",{d:"M2.75 8H13.25M2.75 8L5.25 5.5M2.75 8L5.25 10.5",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})}),n]})})}function ea({onClick:s,disabled:a=!1,className:t,children:n="Next"}){return e.jsx("span",{className:H("flex grow basis-0 justify-end",t),children:e.jsxs(ts,{plain:!0,onClick:s,disabled:a,"aria-label":"Next page",className:H("gap-1",a&&"invisible"),children:[n,e.jsx("svg",{className:"size-4 stroke-current",viewBox:"0 0 16 16",fill:"none","aria-hidden":"true",children:e.jsx("path",{d:"M13.25 8L2.75 8M13.25 8L10.75 10.5M13.25 8L10.75 5.5",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})})]})})}function sa({className:s,...a}){return e.jsx("span",{...a,className:H("hidden items-baseline gap-x-2 sm:flex",s)})}function ta({page:s,current:a=!1,onClick:t,className:n,children:r}){return e.jsx(ts,{plain:!a,outline:a,onClick:()=>t==null?void 0:t(s),"aria-label":`Page ${s}`,"aria-current":a?"page":void 0,className:H("min-w-[2.25rem] before:absolute before:-inset-px before:rounded-lg",a&&"before:bg-subtle-fill",n),children:r??s})}function aa({className:s,...a}){return e.jsx("span",{"aria-hidden":"true",...a,className:H("w-[2.25rem] select-none text-center text-sm text-fg-muted",s),children:"…"})}function na(s,a,t=1){if(a<=7)return Array.from({length:a},(o,y)=>y+1);const n=Math.max(s-t,1),r=Math.min(s+t,a),l=n>2,i=r<a-1;if(!l&&i){const o=3+2*t;return[...Array.from({length:o},(x,j)=>j+1),"gap",a]}if(l&&!i){const o=3+2*t;return[1,"gap",...Array.from({length:o},(x,j)=>a-o+j+1)]}return[1,"gap",...Array.from({length:r-n+1},(o,y)=>n+y),"gap",a]}const zn=st(s=>({requestedHash:null,requestChannel:a=>s({requestedHash:a}),clearRequest:()=>s({requestedHash:null})})),ra={rx:{icon:zs,label:"Rx",badgeColor:Se.rx,avatarBg:"bg-sys-green/15",avatarText:"text-sys-green"},forward:{icon:he,label:"Fwd",badgeColor:Se.forward,avatarBg:"bg-sys-cyan/15",avatarText:"text-sys-cyan"},duplicate:{icon:ns,label:"Dupe",badgeColor:Se.duplicate,avatarBg:"bg-fg-muted/15",avatarText:"text-fg-secondary"},tx:{icon:Lt,label:"Tx",badgeColor:Se.tx,avatarBg:"bg-sys-indigo/15",avatarText:"text-sys-indigo"},dropped:{icon:Mt,label:"Drop",badgeColor:Se.dropped,avatarBg:"bg-sys-amber/15",avatarText:"text-sys-amber"}},gs={sm:"w-3.5 h-3.5",md:"w-4 h-4",lg:"w-5 h-5"},la={sm:"w-8 h-8",md:"w-9 h-9",lg:"w-10 h-10"};function ia(s){return s.packet_origin==="tx_local"?"tx":s.packet_origin==="tx_forward"?"forward":s.is_duplicate?"duplicate":s.transmitted?"forward":s.drop_reason?"dropped":"rx"}function ca({packet:s,showLabel:a=!0,variant:t="avatar",size:n="sm"}){const r=ia(s),l=ra[r],i=l.icon;return t==="avatar"?e.jsx("div",{className:H("flex items-center justify-center rounded-full flex-shrink-0",l.avatarBg,la[n]),children:e.jsx(i,{className:H(gs[n],l.avatarText)})}):e.jsxs(P,{color:l.badgeColor,children:[e.jsx(i,{className:gs[n]}),a&&l.label]})}const Vs=m.memo(ca);function oa({path:s,localHash:a,className:t}){if(!s||s.length===0)return e.jsx("span",{className:H("text-fg-muted text-xs",t),children:"—"});const n=a?(a.startsWith("0x")?a.slice(2,4):a.slice(0,2)).toUpperCase():null;return e.jsx("span",{className:H("flex items-center gap-0.5 type-data-xs overflow-hidden",t),children:s.map((r,l)=>{const i=l===s.length-1,c=n&&r.toUpperCase()===n;return e.jsxs("span",{className:"flex items-center flex-shrink-0",children:[c?e.jsx("span",{className:"px-1 py-0.5 rounded bg-sys-amber/20 text-sys-amber text-[9px] font-medium",children:"You"}):e.jsx("span",{className:"px-1 py-0.5 rounded bg-subtle-fill-hover text-fg-secondary",children:r.toUpperCase()}),!i&&e.jsx(rs,{className:"w-2.5 h-2.5 text-fg-muted mx-0.5 flex-shrink-0"})]},`${r}-${l}`)})})}const Gs=m.memo(oa);function Qs({channelName:s,onClick:a,active:t,compact:n,className:r}){const l=s.startsWith("#")?s:`#${s}`,i=H("inline-flex items-center flex-shrink-0","font-medium",n?"px-1.5 h-4 leading-4 rounded text-[10px]":"px-2 h-5 leading-5 rounded text-xs",t?"bg-sys-blue/20 text-sys-blue":"bg-sys-blue/10 text-sys-blue",a&&!t&&"hover:bg-sys-blue/20 cursor-pointer",r);return a?e.jsx("button",{type:"button",onClick:a,className:i,children:l}):e.jsx("span",{className:i,children:l})}function ze(s){return{"--data-box-accent":me[s]}}function Ws(s){const a=s.payload_type_name||Bs(s.payload_type??s.type),t=s.route_type_name||Ms(s.route_type??s.route),n=_e[a]??"zinc",r=De[t]??"zinc";return{payloadType:a,routeType:t,payloadColor:n,routeColor:r}}function $e(s){if(!s)return[];if(Array.isArray(s))return s;try{const a=JSON.parse(s);return Array.isArray(a)?a:[]}catch{return[]}}function qs(s,a){if(a){const t=a(s);return{name:t.name,isCompanion:t.isCompanion,isRepeater:t.isRepeater}}return{name:null,isCompanion:!1,isRepeater:!1}}function da({packet:s,onClick:a,localHash:t,neighbors:n,resolveSource:r,isFlashing:l=!1,isTraceHighlighted:i,onTraceHover:c,traceTag:o,onViewTraceReport:y,dupeGroupPosition:x,isDupeGroupHovered:j=!1,onDupeGroupHover:N,dupeCount:g,getDecodedContent:d,onChannelClick:v}){const u=g?!1:Ts(s.is_duplicate),w=x!==void 0,{payloadType:b,routeType:f,payloadColor:p,routeColor:B}=Ws(s),h=s.packet_origin==="tx_local",I=b==="TRACE",$=$e(s.original_path),O=$e(s.forwarded_path),X=O.length>0?O:$,z=s.src_hash?(s.src_hash.startsWith("0x")?s.src_hash.slice(2,6):s.src_hash.slice(0,4)).toUpperCase():null,{name:Z,isRepeater:E}=qs(s,r);let R=null,D=null,te=null,J=null;if(b==="GRP_TXT"&&d){const U=d(s);U!=null&&U.decrypted&&(D=U.senderName,te=U.channelName,J=U.channelHash,U.text&&(R=U.text))}else if(b==="TXT_MSG"&&s.raw_packet)try{const U=Es.fromHex(s.raw_packet);if(U.success&&U.packet){const ce=Is(U.packet.payload);ce&&!ce.encrypted&&(R=ce.text)}}catch{}const C=D||(E?null:Z),W=!!C,ne=!W&&E&&!!Z,M=!W&&!ne&&b==="GRP_TXT"&&!R,S=s.payload_length??s.length??0;s.lbt_attempts;const se=m.useCallback(()=>{I&&o&&y?y(o):a(s)},[I,o,y,a,s]),G=m.useCallback(()=>{I&&o&&c&&c(o),w&&N&&s.packet_hash&&N(s.packet_hash)},[I,o,c,w,N,s.packet_hash]),q=m.useCallback(()=>{c&&c(null),N&&N(null)},[c,N]),L=me[p]||me.zinc,T=j,ie=()=>{const U={pointerEvents:"none"};return x==="first"?{...U,borderTop:`2px solid ${L}`,borderLeft:`2px solid ${L}`,borderRight:`2px solid ${L}`,borderBottom:"none",borderRadius:"8px 8px 0 0",inset:"-2px -2px 0 -2px"}:x==="middle"?{...U,borderTop:"none",borderLeft:`2px solid ${L}`,borderRight:`2px solid ${L}`,borderBottom:"none",borderRadius:0,inset:"0 -2px"}:x==="last"?{...U,borderTop:"none",borderLeft:`2px solid ${L}`,borderRight:`2px solid ${L}`,borderBottom:`2px solid ${L}`,borderRadius:"0 0 8px 8px",inset:"0 -2px -2px -2px"}:{...U,border:`2px solid ${L}`,borderRadius:"8px",inset:"-2px"}};return e.jsxs("div",{onClick:se,onMouseEnter:G,onMouseLeave:q,className:H("group relative cursor-pointer","hover:bg-subtle-fill",u&&!j&&"opacity-40",l&&"flash-row",h&&"bg-sys-indigo/5",i&&"bg-sys-teal/10"),children:[e.jsx("div",{className:H("absolute pointer-events-none transition-opacity duration-75",w?T?"opacity-100":"opacity-0":"opacity-0 group-hover:opacity-100"),style:ie()}),e.jsxs("div",{className:"relative flex items-center gap-2 min-[600px]:gap-3 px-2 py-2 min-[600px]:px-3 min-[600px]:py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[e.jsx("div",{className:"relative flex-shrink-0",children:W?e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-1 ring-edge-subtle",style:{backgroundColor:Ds(ke(C).cleanName)},children:ke(C).emoji?e.jsx("span",{className:"text-base leading-none",children:ke(C).emoji}):e.jsx("span",{className:"text-white text-[10px] font-bold tracking-tighter",children:As(C)})}):ne?e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-[1.5px] ring-sys-blue",children:e.jsx(fe,{className:"size-5 text-sys-blue"})}):M?e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-zinc-500/20 ring-1 ring-edge-subtle",children:e.jsx($s,{className:"size-4 text-fg-muted"})}):e.jsx(Vs,{packet:s,variant:"avatar",size:"sm"})}),e.jsx("div",{className:"min-w-0",children:W?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-semibold text-[13px] text-fg-primary font-sans truncate max-w-[90px]",children:C}),z&&e.jsx("div",{className:"hidden min-[900px]:block text-[9px] text-fg-muted truncate",children:z})]}):ne?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-semibold text-[13px] text-fg-primary font-sans truncate max-w-[90px]",children:Z}),z&&e.jsx("div",{className:"hidden min-[900px]:block text-[9px] text-fg-muted truncate",children:z})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold text-[13px] text-fg-primary font-sans truncate",children:z||"—"}),Z&&e.jsx("div",{className:"hidden min-[900px]:block text-[9px] text-fg-muted truncate max-w-[70px]",children:Z})]})})]}),e.jsxs("div",{className:"flex-1 flex items-center gap-1 min-[600px]:gap-1.5 min-[900px]:gap-2 min-w-0",children:[e.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:ze(p),children:b}),g&&g>1&&e.jsxs("span",{className:"data-box data-box-compact flex-shrink-0",children:["×",g]}),e.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:ze(B),children:f}),e.jsxs("span",{className:"hidden min-[520px]:inline type-data-xs text-fg-muted flex-shrink-0",children:[S,"B"]}),e.jsx("div",{className:"flex-1 min-w-0 overflow-hidden",children:R||te?e.jsxs("span",{className:"text-[11px] text-fg-secondary truncate block flex items-center gap-1",children:[te&&e.jsx(Qs,{channelName:te,compact:!0,onClick:v&&J?U=>{U.stopPropagation(),v(J)}:void 0}),R&&e.jsx("span",{className:"italic truncate",children:R})]}):e.jsx(Gs,{path:X,localHash:t})})]}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[e.jsx("span",{className:"data-box data-box-compact",children:Ps(s.timestamp)}),e.jsx(Ae,{rssi:s.rssi,snr:s.snr,compact:!0,showValues:!0,validated:Ee(s)})]})]})]})}function xa({packet:s,onClick:a,localHash:t,neighbors:n,resolveSource:r,isFlashing:l=!1,isTraceHighlighted:i,traceTag:c,onViewTraceReport:o,dupeGroupPosition:y,isDupeGroupHovered:x=!1,onDupeGroupHover:j,dupeCount:N,getDecodedContent:g,onChannelClick:d}){const{payloadType:v,routeType:u,payloadColor:w,routeColor:b}=Ws(s),f=s.packet_origin==="tx_local",p=v==="TRACE",B=N?!1:Ts(s.is_duplicate),h=$e(s.original_path),I=$e(s.forwarded_path),$=I.length>0?I:h,O=s._hopCount??$.length,X=s.src_hash?(s.src_hash.startsWith("0x")?s.src_hash.slice(2,6):s.src_hash.slice(0,4)).toUpperCase():null,{name:z,isRepeater:Z}=qs(s,r);let E=null,R=null,D=null,te=null;if(v==="GRP_TXT"&&g){const L=g(s);L!=null&&L.decrypted&&(R=L.senderName,D=L.channelName,te=L.channelHash,L.text&&(E=L.text))}else if(v==="TXT_MSG"&&s.raw_packet)try{const L=Es.fromHex(s.raw_packet);if(L.success&&L.packet){const T=Is(L.packet.payload);T&&!T.encrypted&&(E=T.text)}}catch{}const J=R||(Z?null:z),C=!!J,W=!C&&Z&&!!z,ne=!C&&!W&&v==="GRP_TXT"&&!E,M=s.payload_length??s.length??0,S=s.lbt_attempts??0,se=()=>{p&&c&&o?o(c):a(s)},G=me[w]||me.zinc,q=()=>{if(!y)return{opacity:0};const L=x?1:.4,T=x?"3px":"2px";return y==="first"?{backgroundColor:G,opacity:L,width:T,top:"6px",bottom:0,borderRadius:"0 9999px 0 0"}:y==="middle"?{backgroundColor:G,opacity:L,width:T,top:0,bottom:0,borderRadius:0}:y==="last"?{backgroundColor:G,opacity:L,width:T,top:0,bottom:"6px",borderRadius:"0 0 9999px 0"}:{backgroundColor:G,opacity:L,width:T,top:"6px",bottom:"6px",borderRadius:"9999px"}};return e.jsxs("div",{onClick:se,className:H("relative pl-3 pr-2.5 py-2 cursor-pointer","active:bg-subtle-fill-hover",B&&"opacity-40",l&&"flash-row",f&&"bg-sys-indigo/5",i&&"bg-sys-teal/10"),children:[e.jsx("div",{className:"absolute left-0 transition-all",style:q()}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"relative flex-shrink-0 mt-0.5",children:C?e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-1 ring-edge-subtle",style:{backgroundColor:Ds(ke(J).cleanName)},children:ke(J).emoji?e.jsx("span",{className:"text-base leading-none",children:ke(J).emoji}):e.jsx("span",{className:"text-white text-[10px] font-bold tracking-tighter",children:As(J)})}):W?e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-[1.5px] ring-sys-blue",children:e.jsx(fe,{className:"size-5 text-sys-blue"})}):ne?e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-zinc-500/20 ring-1 ring-edge-subtle",children:e.jsx($s,{className:"size-4 text-fg-muted"})}):e.jsx(Vs,{packet:s,variant:"avatar",size:"sm"})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[C?e.jsx("span",{className:"font-medium text-[14px] text-fg-primary tracking-tight truncate min-w-0",children:J}):W?e.jsx("span",{className:"font-medium text-[14px] text-fg-primary tracking-tight truncate min-w-0",children:z}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold text-[14px] text-fg-primary tracking-tight flex-shrink-0",children:X||"—"}),z&&e.jsx("span",{className:"text-[12px] text-fg-muted truncate min-w-0",children:z})]}),e.jsx("div",{className:"flex-1"}),e.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:ze(w),children:v}),e.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:ze(b),children:u}),N&&N>1&&e.jsxs("span",{className:"data-box data-box-compact flex-shrink-0",children:["×",N]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("span",{className:"type-data-xs text-fg-muted w-[28px] text-right",children:s.rssi}),e.jsx(Ae,{rssi:s.rssi,compact:!0,showValues:!1,validated:Ee(s)})]})]}),e.jsxs("div",{className:"flex items-center gap-1 type-data-xs text-fg-muted",children:[e.jsx("span",{className:"data-box data-box-compact flex-shrink-0",children:Ps(s.timestamp)}),M>0&&e.jsxs("span",{children:[M,"B"]}),S>0&&e.jsxs("span",{className:S>1?"text-sys-amber/60":void 0,children:["LBT:",S]}),s.snr!=null&&e.jsxs("span",{children:[s.snr.toFixed(0),"dB"]}),E||D?e.jsxs("span",{className:"text-[11px] text-fg-secondary truncate flex items-center gap-1 min-w-0",children:[D&&e.jsx(Qs,{channelName:D,compact:!0,onClick:d&&te?L=>{L.stopPropagation(),d(te)}:void 0}),E&&e.jsx("span",{className:"italic truncate",children:E})]}):O>0?e.jsx(Gs,{path:$,localHash:t}):null]})]})]})]})}const ma=m.memo(da),ha=m.memo(xa);function ua(s,a,t,n,r=!1){const l=s.toUpperCase(),i=[],c=t&&Ke(l,t);c&&i.push(t);for(const g of Object.keys(a))Ke(l,g)&&i.push(g);if(r&&c&&t&&i.length===1)return{matches:i,probability:1,bestMatch:t};if(r&&c&&i.length>1){const g=i.filter(d=>d!==t);if(g.length===1)return{matches:i,probability:1,bestMatch:g[0]}}const o=i.length>0?1/i.length:0,y=[...i].sort();let x=null,j=-1;if(y.length===1)x=y[0];else if(y.length>1&&n){for(const g of y){const d=n.get(g),v=d?typeof d=="number"?d:d.combinedScore:0;v>j&&(j=v,x=g)}x||(x=y[0])}else y.length>0&&(x=y[0]);let N=o;if(i.length>1&&n&&j>0){let g=0;for(const d of i){const v=n.get(d);g+=v?typeof v=="number"?v:v.combinedScore:0}g>0&&(N=Math.min(.95,j/g))}return{matches:i,probability:N,bestMatch:x}}function pa(s,a,t,n){const l=(t-s)*Math.PI/180,i=(n-a)*Math.PI/180,c=Math.sin(l/2)*Math.sin(l/2)+Math.cos(s*Math.PI/180)*Math.cos(t*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 6371e3*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))}function fa(s){return s<100?1:s<500?.9:s<1e3?.7:s<5e3?.5:s<1e4?.3:.1}const ga=m.lazy(()=>Qt(()=>import("./PathMapMapLibre-CdvACmoL.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13])));function ya(s,a,t,n,r=!1,l,i,c){const o=Wt(a);let y;i&&(y=qt(i,s,{position:c,isLastHop:r}).confidence);const{matches:x,probability:j}=ua(s,o,n,l,r),N=x.length,g=[],d=s.toUpperCase(),v=t&&t.latitude!==void 0&&t.longitude!==void 0&&(t.latitude!==0||t.longitude!==0);for(const w of x){if(n&&Ke(d,n)&&w===n&&v&&t){g.push({hash:w,name:t.name||"Local Node",latitude:t.latitude,longitude:t.longitude,probability:r?1:j,isLocal:!0});continue}const b=o[w];b!=null&&b.latitude&&(b!=null&&b.longitude)&&!(b.latitude===0&&b.longitude===0)&&g.push({hash:w,name:b.node_name||b.name||"Unknown",latitude:b.latitude,longitude:b.longitude,probability:j,isLocal:!1,isDirectNeighbor:b.zero_hop===!0})}const u=g.length;if(u===1)g[0].probability=y??1;else if(u>1)if(y!==void 0&&y>0){const w=g[0];w.probability=y;const b=1-y,f=u-1;g.slice(1).forEach(p=>{p.probability=b/f})}else{let w=0;const b=g.map(f=>{if(f.isLocal)return{candidate:f,score:1};const p=l==null?void 0:l.get(f.hash);let B=.5;if(v&&t){const I=pa(t.latitude,t.longitude,f.latitude,f.longitude);B=fa(I)}let h;return p?h=B*.3+p.hopConsistencyScore*.3+p.frequencyScore*.4:(h=B,f.isDirectNeighbor&&(h=Math.max(h,.8))),w+=h,{candidate:f,score:h}});if(w>0)b.forEach(({candidate:f,score:p})=>{f.probability=Math.min(.95,p/w)});else{const f=1/u;g.forEach(p=>p.probability=f)}}return{candidates:g,totalMatches:N}}function ja(s,a,t,n,r,l){if(!s||s.length===0)return{hops:[],overallConfidence:0,hasValidPath:!1};const i=s.length-1,c=s.map((x,j)=>{const N=j===i,g=s.length-j,{candidates:d,totalMatches:v}=ya(x,a,t,n,N,r,l,g),u=d.length>0?Math.max(...d.map(w=>w.probability)):0;return{prefix:x,candidates:d,confidence:u,totalMatches:v}}),o=c.reduce((x,j)=>j.confidence===0?0:x*j.confidence,1),y=c.some(x=>x.candidates.length>0);return{hops:c,overallConfidence:o,hasValidPath:y}}function ba(s){return`${(s*100).toFixed(0)}%`}function Na(s){return s>=1?"text-sys-green":s>=.5?"text-sys-indigo":s>=.25?"text-signal-poor":s>0?"text-sys-red":"text-fg-muted"}function va(s,a,t){let n;return a===0?n=t.muted:s>=1?n=t.success:s>=.5?n=t.secondary:s>=.25?n=t.poor:s>0?n=t.danger:n=t.muted,{color:n}}class wa extends m.Component{constructor(a){super(a),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?e.jsxs("div",{className:"h-[200px] flex items-center justify-center text-fg-muted",children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"Map failed to load"]}):this.props.children}}function Ue({path:s,neighbors:a,localNode:t,localHash:n,srcHash:r,dstHash:l,neighborAffinity:i,prefixLookup:c,hubNodes:o,traceSnr:y,advertiserSource:x}){const[j,N]=m.useState(null),g=m.useMemo(()=>{if(!x)return null;const f=x.nodeType==="wardrive";return{prefix:x.prefix||"??",candidates:[{hash:x.publicKey||x.prefix||"source",name:x.name,latitude:x.latitude,longitude:x.longitude,probability:1,isLocal:!1,isWardrive:f}],confidence:1,totalMatches:1,isSource:!0}},[x]),d=m.useMemo(()=>{if(x||!r)return null;const f=Ge(r),p=a[r];if((p==null?void 0:p.latitude)&&(p==null?void 0:p.longitude)&&!(p.latitude===0&&p.longitude===0))return{prefix:f,candidates:[{hash:r,name:p.node_name||p.name||"Source",latitude:p.latitude,longitude:p.longitude,probability:1,isLocal:!1,isDirectNeighbor:p.zero_hop===!0}],confidence:1,totalMatches:1,isSource:!0};const h=(p==null?void 0:p.node_name)||(p==null?void 0:p.name)||r.slice(0,8);return{prefix:f,candidates:[{hash:r,name:h,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isSource:!0}},[x,r,a]),v=m.useMemo(()=>{const f=l!=null&&l.startsWith("0x")?l.slice(2):l;if((!f||f==="00"||f==="0000000000000000")&&t&&n){const O=Ge(n),X=t.latitude!==0||t.longitude!==0;return{prefix:O,candidates:[{hash:n,name:t.name||"Local Node",latitude:X?t.latitude:0,longitude:X?t.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}if(!l)return null;const B=Ge(l);if(n&&l===n&&t){const O=t.latitude!==0||t.longitude!==0;return{prefix:B,candidates:[{hash:l,name:t.name||"Local Node",latitude:O?t.latitude:0,longitude:O?t.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}const h=a[l];if((h==null?void 0:h.latitude)&&(h==null?void 0:h.longitude)&&!(h.latitude===0&&h.longitude===0))return{prefix:B,candidates:[{hash:l,name:h.node_name||h.name||"Destination",latitude:h.latitude,longitude:h.longitude,probability:1,isLocal:!1,isDirectNeighbor:h.zero_hop===!0}],confidence:1,totalMatches:1,isDestination:!0};const $=(h==null?void 0:h.node_name)||(h==null?void 0:h.name)||l.slice(0,8);return{prefix:B,candidates:[{hash:l,name:$,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isDestination:!0}},[l,a,t,n]),u=m.useMemo(()=>ja(s,a,t,n,i,c),[s,a,t,n,i,c]),w=m.useMemo(()=>{const f=[];g?f.push(g):d&&f.push(d),f.push(...u.hops),v&&f.push(v);const p=f.reduce((h,I)=>I.confidence===0?0:h*I.confidence,1),B=f.some(h=>h.candidates.some(I=>I.latitude!==0||I.longitude!==0));return{hops:f,overallConfidence:p,hasValidPath:B}},[g,d,u,v]),b=m.useMemo(()=>{const f=getComputedStyle(document.documentElement);return{success:f.getPropertyValue("--sys-green").trim()||"#39D98A",secondary:f.getPropertyValue("--sys-indigo").trim()||"#F9D26F",poor:f.getPropertyValue("--signal-poor").trim()||"#FF8A5C",danger:f.getPropertyValue("--sys-red").trim()||"#FF5C7A",muted:f.getPropertyValue("--text-muted").trim()||"#767688"}},[]);return w.hasValidPath?e.jsxs("div",{className:"h-full flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-fg-muted",children:"Path Confidence:"}),e.jsx("span",{className:Na(w.overallConfidence),children:ba(w.overallConfidence)}),e.jsx("button",{className:"text-fg-muted hover:text-fg-secondary transition-colors",title:"Confidence is calculated based on how many known nodes match each path prefix. Multiple matches reduce confidence due to collision probability.",children:e.jsx(Rt,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-sys-green"}),e.jsx("span",{className:"text-fg-muted",children:"Exact"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-sys-indigo"}),e.jsx("span",{className:"text-fg-muted",children:"Multi"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-fg-muted"}),e.jsx("span",{className:"text-fg-muted",children:"Unknown"})]})]})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:e.jsx(wa,{children:e.jsx(m.Suspense,{fallback:e.jsx("div",{className:"h-full bg-elevated flex items-center justify-center text-fg-muted text-sm",children:"Loading map..."}),children:e.jsx(ga,{resolvedPath:w,localNode:t,hubNodes:o,hoveredHopIndex:j,onHoverHop:N,traceSnr:y})})})}),e.jsx("div",{className:"flex flex-wrap items-center gap-1.5",children:w.hops.map((f,p)=>{var O,X,z;const B=f.isSource===!0,h=f.isDestination===!0,I=j===p;let $;return B?$=`Source: ${((O=f.candidates[0])==null?void 0:O.name)||"Unknown"}`:h?$=`Destination: ${((X=f.candidates[0])==null?void 0:X.name)||"Unknown"}`:f.totalMatches===0?$="No matching nodes found":f.totalMatches===1?$=`Exact match: ${((z=f.candidates[0])==null?void 0:z.name)||"Unknown"}`:$=`${f.totalMatches} possible matches (${(f.confidence*100).toFixed(0)}% confidence)`,e.jsxs("div",{className:H("flex items-center gap-1 px-1.5 py-0.5 rounded type-data-xs cursor-pointer transition-all",I?"bg-sys-blue/20 ring-1 ring-sys-blue/50":"bg-elevated hover:bg-subtle",B&&"border border-sys-green/30",h&&"border border-sys-blue/30"),title:$,onMouseEnter:()=>N(p),onMouseLeave:()=>N(null),children:[B&&e.jsx("span",{className:"text-sys-green text-[8px] mr-0.5",children:"SRC"}),h&&e.jsx("span",{className:"text-sys-blue text-[8px] mr-0.5",children:"DST"}),e.jsx("span",{style:va(f.confidence,f.totalMatches,b),children:f.prefix}),!B&&!h&&f.totalMatches>1&&e.jsxs("span",{className:"text-fg-muted",children:["×",f.totalMatches]}),!B&&!h&&f.totalMatches===0&&e.jsx("span",{className:"text-fg-muted",children:"?"})]},p)})})]}):e.jsxs("div",{className:"flex items-center justify-center text-fg-muted text-xs py-4",children:[e.jsx(Ie,{className:"w-3.5 h-3.5 mr-1.5 opacity-50"}),"No location data available for path nodes"]})}const We=16;function Oe(s){return s.match(/.{1,2}/g)||[]}function ye(s){return s!==null&&s.startsWith("payload:")}const Ce={hexRestOpacity:15,cardRestBg:"color-mix(in srgb, var(--elevated) 60%, var(--body))",cardRestShadow:`
    inset 0 0 0 1px color-mix(in srgb, var(--fg-primary) 6%, transparent),
    inset 0 1px 0 color-mix(in srgb, white 3%, transparent),
    0 1px 2px color-mix(in srgb, black 5%, transparent)
  `,selectionBorderWidth:2},Je={type:"tween",duration:.25,ease:[.25,.1,.25,1]};function ka(s,a){return s?`inset 0 0 0 ${Ce.selectionBorderWidth}px ${me[a]}`:Ce.cardRestShadow}function Ca(s,a){return s?a:`color-mix(in srgb, ${a} ${Ce.hexRestOpacity}%, transparent)`}function Sa({segments:s,selectedSegment:a,onSegmentClick:t}){const[n,r]=m.useState(null),[l,i]=m.useState(null),c=s.some(x=>x.id!==void 0)&&t,o=[];for(const x of s){const j=Oe(x.hex);for(const N of j)o.push({byte:N.toUpperCase(),color:x.color,id:x.id})}const y=[];for(let x=0;x<o.length;x+=We)y.push(o.slice(x,x+We));return e.jsx("div",{className:"space-y-1",children:y.map((x,j)=>{const N=x.length<We;return e.jsx("div",{className:"flex rounded-md overflow-hidden",children:x.map(({byte:g,color:d,id:v},u)=>{const w=u===x.length-1,b=N&&w,f=me[d],h=(v?n===v:l===d)||!!(v&&a===v);return e.jsx("span",{className:`w-[1.75rem] text-xs text-center py-0.5 font-mono select-text ${c?"cursor-pointer":""}`,style:{backgroundColor:Ca(h,f),color:h?"rgba(255,255,255,0.95)":f,transition:h?"none":"background-color 0.15s ease-out, color 0.15s ease-out",touchAction:"manipulation",...b?{borderRadius:"0 0.375rem 0.375rem 0"}:{}},onMouseEnter:()=>{v?r(v):i(d)},onMouseLeave:()=>{r(null),i(null)},onClick:()=>v&&(t==null?void 0:t(v)),onTouchStart:()=>{v?r(v):i(d)},onTouchEnd:()=>{r(null),i(null)},children:g},u)})},j)})})}function _a({rawHex:s,hexSegments:a,selectedSegment:t,onSegmentClick:n}){const[r,l]=m.useState(!1),i=m.useCallback(async()=>{try{await navigator.clipboard.writeText(s.toUpperCase()),l(!0),setTimeout(()=>l(!1),2e3)}catch(c){console.error("Failed to copy:",c)}},[s]);return e.jsxs("div",{className:"bg-black rounded-2xl p-6 relative",children:[e.jsx(Sa,{segments:a,selectedSegment:t,onSegmentClick:n}),e.jsx("button",{onClick:i,className:"absolute bottom-3 right-3 flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg bg-subtle-fill-hover hover:bg-subtle-fill-strong text-fg-muted hover:text-fg-secondary transition-all text-xs font-sans",title:"Copy raw packet hex",children:r?e.jsxs(e.Fragment,{children:[e.jsx(Ft,{className:"w-3.5 h-3.5 text-sys-green"}),e.jsx("span",{className:"text-sys-green",children:"Copied"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ns,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Copy"})]})})]})}function Ta(s,a){const t=[];let n=0;const r=a.slice(0,64);t.push({id:"payload:publicKey",title:"Public Key",color:"pink",hex:r,startByte:n,endByte:n+31,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:s.publicKey.toUpperCase()}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Ed25519 public key (32 bytes)"})]})}),n+=32;const l=a.slice(64,72);t.push({id:"payload:timestamp",title:"Timestamp",color:"orange",hex:l,startByte:n,endByte:n+3,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",copy:!0,children:l.toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:[s.timestamp," (",le(s.timestamp),")"]})]})}),n+=4;const i=a.slice(72,200);t.push({id:"payload:signature",title:"Signature",color:"teal",hex:i,startByte:n,endByte:n+63,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:s.signature.toUpperCase()}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Ed25519 signature (64 bytes)"})]})}),n+=64;const c=a.slice(200,202);if(t.push({id:"payload:flags",title:"Flags",color:"blue",hex:c,startByte:n,endByte:n,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(ee,{size:"standard",copy:!0,children:["0x",s.flags.toString(16).padStart(2,"0").toUpperCase()]}),e.jsx("p",{className:"text-xs text-fg-primary mt-1",children:s.flagsDescription}),e.jsxs("p",{className:"text-xs text-fg-muted",children:["Node Type: ",s.nodeType]})]})}),n+=1,s.latitude!==void 0){const o=a.slice(n*2,n*2+8);t.push({id:"payload:latitude",title:"Latitude",color:"green",hex:o,startByte:n,endByte:n+3,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",copy:!0,children:o.toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:[s.latitude.toFixed(6),"°"]})]})}),n+=4}if(s.longitude!==void 0){const o=a.slice(n*2,n*2+8);t.push({id:"payload:longitude",title:"Longitude",color:"indigo",hex:o,startByte:n,endByte:n+3,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",copy:!0,children:o.toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:[s.longitude.toFixed(6),"°"]})]})}),n+=4}if(s.name){const o=a.slice(n*2),y=o.length/2;t.push({id:"payload:name",title:"Name",color:"amber",hex:o,startByte:n,endByte:n+y-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",copy:!0,children:o.toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:['"',s.name,'"']})]})})}return t}function Pa(s,a){return[{id:"payload:crc",title:"CRC",color:"green",hex:a.slice(0,8),startByte:0,endByte:3,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(ee,{size:"standard",copy:!0,children:["0x",s.crc]}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"CRC32 of acknowledged packet"})]})}]}function Ba(s,a){const t=[];t.push({id:"payload:channelHash",title:"Channel Hash",color:"blue",hex:a.slice(0,2),startByte:0,endByte:0,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(ee,{size:"standard",copy:!0,children:["0x",s.channelHash]}),s.channelName&&e.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:["Channel: ",s.channelName]})]})}),s.macHex&&t.push({id:"payload:mac",title:"MAC",color:"indigo",hex:a.slice(2,6),startByte:1,endByte:2,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",copy:!0,children:s.macHex.toUpperCase()}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Truncated HMAC-SHA256"})]})});const n=a.slice(6);return n&&t.push({id:"payload:ciphertext",title:s.decrypted?"Message":"Ciphertext",color:s.decrypted?"green":"zinc",hex:n,startByte:3,endByte:3+n.length/2-1,decoded:s.decrypted?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-fg-primary",children:['"',s.text,'"']}),s.senderName&&e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:["From: ",s.senderName]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:n.toUpperCase()}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"AES-128-ECB encrypted"})]})}),t}function Ma(s,a){const t=[];t.push({id:"payload:channelHash",title:"Channel Hash",color:"blue",hex:a.slice(0,2),startByte:0,endByte:0,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(ee,{size:"standard",copy:!0,children:["0x",s.channelHash]}),s.channelName&&e.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:["Channel: ",s.channelName]})]})}),s.macHex&&t.push({id:"payload:mac",title:"MAC",color:"indigo",hex:a.slice(2,6),startByte:1,endByte:2,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",copy:!0,children:s.macHex.toUpperCase()}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Truncated HMAC-SHA256"})]})});const n=a.slice(6);return n&&t.push({id:"payload:ciphertext",title:s.decrypted?"Decrypted Data":"Encrypted Data",color:s.decrypted?"green":"zinc",hex:n,startByte:3,endByte:3+n.length/2-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:(s.decryptedHex||n).toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[s.dataLength," bytes",s.decrypted?"":" (AES-128-ECB encrypted)"]})]})}),t}function La(s,a){const t=[];if(t.push({id:"payload:pathLength",title:"Path Length",color:"blue",hex:a.slice(0,2),startByte:0,endByte:0,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",children:s.pathLength}),e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[s.pathLength," hop",s.pathLength!==1?"s":""]})]})}),s.path.length>0){const n=a.slice(2,2+s.pathLength*2);t.push({id:"payload:path",title:"Path Hops",color:"amber",hex:n,startByte:1,endByte:s.pathLength,decoded:e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex flex-wrap items-center gap-1",children:s.path.map((r,l)=>e.jsxs("span",{className:"flex items-center gap-1",children:[l>0&&e.jsx(he,{className:"w-3 h-3 text-fg-muted"}),e.jsx(P,{color:"amber",className:"font-mono",children:r})]},l))})})})}if(s.extraType!=null){const n=1+s.pathLength;t.push({id:"payload:extraType",title:"Extra Type",color:"indigo",hex:a.slice(n*2,n*2+2),startByte:n,endByte:n,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",children:s.extraTypeName??`0x${s.extraType.toString(16).padStart(2,"0")}`}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Bundled payload type"})]})})}if(s.extraData){const n=1+s.pathLength+1,r=a.slice(n*2);r&&t.push({id:"payload:extraData",title:"Extra Data",color:"indigo",hex:r,startByte:n,endByte:n+r.length/2-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:r.toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[r.length/2," bytes"]})]})})}return t}function Ra(s,a){const t=[];t.push({id:"payload:crc",title:"Trace Tag",color:"blue",hex:a.slice(0,8),startByte:0,endByte:3,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(ee,{size:"standard",copy:!0,children:["0x",s.traceTag]}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Unique trace request identifier"})]})}),t.push({id:"payload:mac",title:"Auth Code",color:"indigo",hex:a.slice(8,16),startByte:4,endByte:7,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",copy:!0,children:s.authCode}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Authentication/verification code"})]})}),t.push({id:"payload:flags",title:"Flags",color:"amber",hex:a.slice(16,18),startByte:8,endByte:8,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(ee,{size:"standard",copy:!0,children:["0x",s.flags.toString(16).toUpperCase().padStart(2,"0")]}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:s.flags===0?"No flags set":`Flags: ${s.flags.toString(2).padStart(8,"0")}b`})]})});const n=a.slice(18);return n&&t.push({id:"payload:path",title:"Target Path",color:"indigo",hex:n,startByte:9,endByte:9+n.length/2-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-wrap items-center gap-1",children:s.pathHashes.map((r,l)=>{const i=s.snrValues[l],c=i!==void 0?Tt(i):"zinc";return e.jsxs("span",{className:"flex items-center gap-1",children:[l>0&&e.jsx(he,{className:"w-3 h-3 text-fg-muted"}),e.jsx(P,{color:"indigo",className:"font-mono",children:r}),i!==void 0&&e.jsxs(P,{color:c,className:"font-mono",children:[i>=0?"+":"",Number.isInteger(i)?i:i.toFixed(1),"dB"]})]},l)})}),e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[s.pathHashes.length," target ",s.pathHashes.length===1?"hop":"hops",s.snrValues.length>0&&` • ${s.snrValues.length} SNR ${s.snrValues.length===1?"value":"values"} collected`,s.isComplete&&" • ✓ Complete"]})]})}),t}function Fa(s,a){const t=[];t.push({id:"payload:msgId",title:"Message ID",color:"blue",hex:a.slice(0,4),startByte:0,endByte:1,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",copy:!0,children:s.messageId.toUpperCase()}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Unique message identifier"})]})}),t.push({id:"payload:partNum",title:"Part Number",color:"amber",hex:a.slice(4,6),startByte:2,endByte:2,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",copy:!0,children:s.partNumber}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"0-indexed part number"})]})}),t.push({id:"payload:totalParts",title:"Total Parts",color:"orange",hex:a.slice(6,8),startByte:3,endByte:3,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",copy:!0,children:s.totalParts}),e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:["Part ",s.partNumber+1," of ",s.totalParts]})]})});const n=a.slice(8);return n&&t.push({id:"payload:partData",title:"Part Data",color:"cyan",hex:n,startByte:4,endByte:4+n.length/2-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:n.toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[n.length/2," bytes"]})]})}),t}function Ha(s,a){switch(s.type){case"advert":return Ta(s,a);case"ack":return Pa(s,a);case"grp_txt":return Ba(s,a);case"grp_data":return Ma(s,a);case"path":return La(s,a);case"trace":return Ra(s,a);case"multipart":return Fa(s,a);default:return[{id:"payload:ciphertext",title:"Raw Data",color:"zinc",hex:a,startByte:0,endByte:a.length/2-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:a.toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[a.length/2," bytes"]})]})}]}}function Da(s){return s.map(a=>({id:a.id,hex:a.hex,color:a.color}))}function Aa({bits:s,field:a,value:t,binary:n}){const r=()=>{if(a==="Payload Type"){const l=_e[t]||"zinc";return e.jsx(P,{color:l,children:t})}if(a==="Route Type"){const l=De[t]||"zinc";return e.jsx(P,{color:l,children:t})}return e.jsx("span",{className:"text-sm text-fg-primary",children:t})};return e.jsxs("tr",{children:[e.jsx("td",{className:"py-1.5 text-xs text-fg-muted tabular-nums",children:s}),e.jsx("td",{className:"py-1.5 text-sm text-fg-secondary",children:a}),e.jsx("td",{className:"py-1.5",children:r()}),e.jsx("td",{className:"py-1.5 type-data-xs text-sys-cyan",children:n})]})}function ys({id:s,title:a,color:t,hexBytes:n,startByte:r,endByte:l,isSelected:i,children:c}){const o=n?Oe(n):[];return e.jsxs(de.div,{layout:"position",layoutId:s,transition:Je,className:"w-full min-w-0 overflow-hidden rounded-xl p-4 sm:p-5 space-y-4",style:{backgroundColor:Ce.cardRestBg,boxShadow:ka(i,t)},children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-0.5 min-w-0",children:[e.jsx(P,{color:t,children:a}),o.length>0&&o.length<=16&&o.map((y,x)=>e.jsx(P,{color:t,className:"font-mono",children:y.toUpperCase()},x))]}),e.jsxs("span",{className:"type-data-xs text-fg-muted flex-shrink-0",children:["Bytes ",r,"-",l]})]}),e.jsx("div",{className:"min-w-0 overflow-hidden",children:c})]})}function Ea({advert:s,timestamp:a}){const t=a?le(a):le(s.timestamp);return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-indigo/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-indigo) 0%, var(--sys-blue) 100%)"},children:e.jsx(fe,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:s.name||"Unknown Node"}),e.jsx("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:s.nodeType})]})]}),e.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),e.jsxs("div",{className:"px-4 py-3 space-y-2",children:[s.latitude!==void 0&&s.longitude!==void 0&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ie,{className:"w-4 h-4 text-sys-indigo flex-shrink-0"}),e.jsxs("span",{className:"text-sm text-fg-secondary font-mono",children:[s.latitude.toFixed(5),"°, ",s.longitude.toFixed(5),"°"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"w-4 h-4 text-sys-indigo flex-shrink-0"}),e.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:t})]})]})]})})}function Ia({decoded:s,timestamp:a}){const t=a?le(a):"Unknown";return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-teal/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-teal) 0%, var(--sys-cyan) 100%)"},children:e.jsx(It,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:s.channelName||"Channel Data"}),e.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:[s.dataLength," bytes • ",s.decrypted?"Decrypted":"Encrypted"]})]})]}),e.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),e.jsxs("div",{className:"px-4 py-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Us,{className:"w-4 h-4 text-sys-teal flex-shrink-0"}),e.jsxs("span",{className:"text-sm text-fg-secondary font-sans",children:["Channel: ",e.jsxs("span",{className:"font-mono",children:["0x",s.channelHash]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"w-4 h-4 text-sys-teal flex-shrink-0"}),e.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:t})]}),s.decrypted&&s.decryptedHex&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-edge-subtle",children:[e.jsx("p",{className:"type-micro text-fg-muted mb-1 font-sans",children:"Decrypted Data"}),e.jsx("div",{className:"max-w-full overflow-x-auto",children:e.jsx(ee,{size:"compact",copy:!0,className:"inline-block",children:e.jsx("span",{className:"break-all text-xs",children:s.decryptedHex.toUpperCase()})})})]})]})]})})}function za({decoded:s,timestamp:a,isLoading:t=!1,onDecrypted:n}){const r=a?le(a):"Unknown",[l,i]=m.useState(""),[c,o]=m.useState(!1),[y,x]=m.useState(null),[j,N]=m.useState(!1),g=m.useCallback(async()=>{if(!(!l.trim()||!s.ciphertextHex||!s.macHex)){o(!0),x(null);try{const d=parseInt(s.channelHash,16),v=ms(s.macHex),u=ms(s.ciphertextHex),w=await rt(l.trim(),d,v,u);if(w.success){const b=w.result.plaintext,f=new TextDecoder("utf-8",{fatal:!1}).decode(b.slice(5)),p=f.indexOf(": "),B={...s,channelName:w.result.channelName,decrypted:!0,timestamp:b[0]|b[1]<<8|b[2]<<16|b[3]<<24,flags:b[4],senderName:p>0?f.slice(0,p):void 0,text:p>0?f.slice(p+2):f};n==null||n(B),i(""),N(!1)}else x(w.error)}catch(d){x(d instanceof Error?d.message:"Unknown error")}finally{o(!1)}}},[l,s,n]);return t?e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-xl p-4 sm:p-5",style:{backgroundColor:"color-mix(in srgb, var(--elevated) 60%, var(--body))",boxShadow:`
              inset 0 0 0 1px color-mix(in srgb, var(--fg-primary) 6%, transparent),
              inset 0 1px 0 color-mix(in srgb, white 3%, transparent),
              0 1px 2px color-mix(in srgb, black 5%, transparent)
            `},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 h-[15px]",children:[e.jsx("div",{className:"h-2.5 w-12 rounded bg-subtle-fill-hover animate-pulse"}),e.jsx("div",{className:"h-2.5 w-16 rounded bg-subtle-fill-hover animate-pulse"})]}),e.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tl-md",style:{background:"color-mix(in srgb, var(--sys-blue) 30%, transparent)"},children:e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("div",{className:"h-3.5 w-48 rounded bg-subtle-fill-strong animate-pulse"}),e.jsx("div",{className:"h-3.5 w-32 rounded bg-subtle-fill-strong animate-pulse"})]})})]})}):s.decrypted?e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-xl p-4 sm:p-5",style:{backgroundColor:"color-mix(in srgb, var(--elevated) 60%, var(--body))",boxShadow:`
              inset 0 0 0 1px color-mix(in srgb, var(--fg-primary) 6%, transparent),
              inset 0 1px 0 color-mix(in srgb, white 3%, transparent),
              0 1px 2px color-mix(in srgb, black 5%, transparent)
            `},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.senderName&&e.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:["From ",e.jsx("span",{className:"text-fg-secondary font-medium",children:s.senderName})]}),s.channelName&&e.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:["in ",e.jsx("span",{className:"text-sys-cyan font-medium",children:s.channelName})]})]}),e.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tl-md",style:{background:"linear-gradient(135deg, var(--sys-blue) 0%, color-mix(in srgb, var(--sys-blue) 85%, var(--sys-cyan)) 100%)"},children:e.jsx("p",{className:"text-sm text-white font-sans leading-relaxed whitespace-pre-wrap break-words",children:s.text})})]})}):e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-zinc-500/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--zinc-500) 0%, color-mix(in srgb, var(--zinc-500) 70%, black) 100%)"},children:e.jsx(ls,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:s.isPublicHashChannel?"Public Hash Channel":"Encrypted Message"}),e.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:["Channel hash: ",e.jsxs("span",{className:"font-mono",children:["0x",s.channelHash]})]})]})]}),e.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"w-4 h-4 text-zinc-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:r})]}),s.ciphertextHex&&s.macHex&&e.jsx("div",{className:"space-y-2",children:j?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:l,onChange:d=>i(d.target.value),placeholder:"Channel name (e.g. south-bay)",className:"flex-1 px-3 py-1.5 text-sm rounded-lg bg-subtle-fill-strong border border-edge-subtle text-fg-primary placeholder:text-fg-muted focus:outline-none focus:border-zinc-500",onKeyDown:d=>d.key==="Enter"&&g(),disabled:c}),e.jsx("button",{onClick:g,disabled:c||!l.trim(),className:"px-3 py-1.5 text-sm font-medium rounded-lg bg-zinc-600 hover:bg-zinc-500 text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:c?"Testing...":"Try"}),e.jsx("button",{onClick:()=>{N(!1),x(null),i("")},className:"px-2 py-1.5 text-sm rounded-lg hover:bg-subtle-fill-strong text-fg-muted transition-colors",children:"×"})]}),y&&e.jsx("p",{className:"text-xs text-sys-red",children:y})]}):e.jsx("button",{onClick:()=>N(!0),className:"text-xs text-zinc-400 hover:text-zinc-300 underline underline-offset-2 transition-colors",children:"Know the channel name? Try to decrypt"})}),!j&&e.jsx("p",{className:"text-xs text-fg-muted",children:s.isPublicHashChannel?"Public hash channel message. Key not in common channel list.":"Unknown hash channel. Channel name required for decryption."})]})]})})}function $a({decoded:s,timestamp:a}){const t=a?le(a):"Unknown";return e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:"linear-gradient(135deg, var(--sys-green) 0%, var(--sys-teal) 100%)"},children:e.jsx(Et,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-fg-primary font-sans",children:"Acknowledgment"}),e.jsxs("p",{className:"text-xs text-fg-muted font-sans mt-0.5",children:["CRC: ",e.jsxs("span",{className:"font-mono text-sys-green",children:["0x",s.crc]})," · ",t]})]})]})}function Ua({decoded:s,timestamp:a}){const t=a?le(a):"Unknown",n=s.path.length;return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-amber/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-amber) 0%, var(--sys-orange) 100%)"},children:e.jsx(At,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:"Path Response"}),e.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:[n," ",n===1?"hop":"hops"]})]})]}),e.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),e.jsxs("div",{className:"px-4 py-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"w-4 h-4 text-sys-amber flex-shrink-0"}),e.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:t})]}),s.path.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-edge-subtle",children:e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:s.path.map((r,l)=>e.jsxs("div",{className:"flex items-center gap-2",children:[l>0&&e.jsx(he,{className:"w-4 h-4 text-sys-amber"}),e.jsx(P,{color:"amber",className:"font-mono",children:r})]},l))})})]})]})})}function Oa({decoded:s,timestamp:a}){const t=a?le(a):"Unknown",n=s.pathHashes.length,r=s.snrValues.length,l=i=>i>=7?"green":i>=0?"yellow":i>=-5?"orange":"red";return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-blue/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-blue) 0%, var(--sys-indigo) 100%)"},children:e.jsx(Dt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:["Trace ",s.isComplete?"Complete":"In Progress"]}),e.jsxs("p",{className:"text-sm text-fg-muted mt-0.5",children:["Tag: 0x",s.traceTag.slice(0,8),s.isComplete&&" • ✓"]})]})]}),e.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"w-4 h-4 text-sys-blue flex-shrink-0"}),e.jsx("span",{className:"text-sm text-fg-secondary",children:t})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-fg-muted",children:[e.jsxs("span",{children:[n," target ",n===1?"hop":"hops"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[r," SNR ",r===1?"sample":"samples"]}),s.authCode!==0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Auth: ",s.authCode]})]})]}),s.pathHashes.length>0&&e.jsx("div",{className:"flex flex-wrap items-center gap-2 pt-1",children:s.pathHashes.map((i,c)=>{const o=s.snrValues[c],y=o!==void 0?l(o):"zinc",x=o!==void 0;return e.jsxs("div",{className:"flex items-center gap-2",children:[c>0&&e.jsx(he,{className:"w-4 h-4 text-sys-blue flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(P,{color:x?"blue":"zinc",className:"font-mono",children:i}),x&&e.jsxs(P,{color:y,className:"font-mono",children:[o>=0?"+":"",Number.isInteger(o)?o:o.toFixed(1),"dB"]})]})]},c)})})]})]})})}function Va({decoded:s,timestamp:a}){const t=a?le(a):"Unknown";return s.encrypted?e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:"linear-gradient(135deg, var(--sys-indigo) 0%, var(--sys-blue) 100%)"},children:e.jsx(ls,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-fg-primary font-sans",children:"Encrypted Message"}),e.jsxs("p",{className:"text-xs text-fg-muted font-sans mt-0.5",children:[s.srcHash," → ",s.destHash," · ",t]})]})]}):e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5 px-1",children:[e.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:[e.jsx("span",{className:"font-mono text-fg-secondary",children:s.srcHash})," → ",e.jsx("span",{className:"font-mono text-fg-secondary",children:s.destHash})]}),e.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:["· ",t]})]}),e.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tr-md ml-auto",style:{background:"linear-gradient(135deg, var(--sys-green) 0%, var(--sys-teal) 100%)"},children:e.jsx("p",{className:"text-sm text-white font-sans leading-relaxed whitespace-pre-wrap break-words",children:s.text})})]})}function Ga({decoded:s,timestamp:a}){const t=a?le(a):"Unknown",n=(s.partNumber+1)/s.totalParts*100;return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-yellow/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-yellow) 0%, var(--sys-amber) 100%)"},children:e.jsx(Ht,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:"Multipart Segment"}),e.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:["Part ",s.partNumber+1," of ",s.totalParts]})]})]}),e.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.jsx("div",{children:e.jsx("div",{className:"h-2 bg-subtle-fill-strong rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${n}%`,background:"linear-gradient(90deg, var(--sys-yellow), var(--sys-amber))"}})})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Us,{className:"w-4 h-4 text-sys-yellow flex-shrink-0"}),e.jsxs("span",{className:"text-sm text-fg-secondary font-sans",children:["Message ID: ",e.jsx("span",{className:"font-mono",children:s.messageId})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"w-4 h-4 text-sys-yellow flex-shrink-0"}),e.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:t})]})]})]})})}function Qa({decoded:s,timestamp:a,payloadType:t}){const n=a?le(a):"Unknown",l=(()=>{switch(t){case oe.REQ:return{icon:Ut,gradient:"var(--sys-orange), var(--sys-red)",bg:"rgba(249, 115, 22, 0.15)",label:"Request"};case oe.RESPONSE:return{icon:$t,gradient:"var(--sys-green), var(--sys-teal)",bg:"rgba(34, 197, 94, 0.15)",label:"Response"};case oe.ANON_REQ:return{icon:ls,gradient:"var(--sys-indigo), var(--sys-pink)",bg:"rgba(91, 91, 214, 0.15)",label:"Anonymous Request"};default:return{icon:zt,gradient:"var(--sys-gray), var(--sys-slate)",bg:"rgba(107, 114, 128, 0.15)",label:s.payloadTypeName}}})(),i=l.icon;return e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:`linear-gradient(135deg, ${l.gradient})`},children:e.jsx(i,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-fg-primary font-sans",children:l.label}),e.jsxs("p",{className:"text-xs text-fg-muted font-sans mt-0.5",children:[s.length," bytes · ",n]})]})]})}function Wa({pathHex:s}){if(!s)return null;const a=Oe(s);return e.jsx("div",{className:"flex flex-wrap items-center gap-2 py-2",children:a.map((t,n)=>e.jsxs("div",{className:"flex items-center gap-2",children:[n>0&&e.jsx(he,{className:"w-4 h-4 text-sys-amber flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ee,{size:"compact",copy:!0,children:t.toUpperCase()}),e.jsx("span",{className:"text-xs text-fg-muted font-sans tabular-nums w-4 text-left",children:n+1})]})]},n))})}function qa({decoded:s,payloadType:a}){const t=nt[a]||`TYPE_${a}`;switch(s.type){case"advert":{const n=s.nodeType==="chat"?"companion":s.nodeType.replace("_"," "),r=s.latitude!==void 0&&s.longitude!==void 0&&!(s.latitude===0&&s.longitude===0);return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Role:"})," ",n]}),s.name&&e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Name:"})," ",s.name]}),r&&e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Location:"})," ",s.latitude.toFixed(4),"°, ",s.longitude.toFixed(4),"°"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Time:"})," ",le(s.timestamp)]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Flags:"})," ",s.flagsDescription]})]})}case"ack":return e.jsx("div",{className:"text-xs text-fg-primary space-y-0.5",children:e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"CRC:"})," 0x",s.crc]})});case"path":return e.jsx("div",{className:"text-xs text-fg-primary space-y-1",children:e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Path:"})," ",s.pathString||"(empty)"]})});case"trace":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Tag:"})," 0x",s.traceTag]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Target Path:"})," ",s.pathString||"(empty)"]}),s.snrValues.length>0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"SNR:"})," ",s.snrValues.map(n=>`${n>=0?"+":""}${Number.isInteger(n)?n:n.toFixed(1)}dB`).join(" → ")]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Status:"})," ",s.isComplete?"✓ Complete":`In progress (${s.snrValues.length}/${s.pathHashes.length})`]})]});case"txt_msg":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Dest:"})," ",s.destHash]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Src:"})," ",s.srcHash]}),s.encrypted?e.jsx("p",{className:"text-fg-muted italic",children:"Encrypted content"}):e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Text:"})," ",s.text]})]});case"grp_txt":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Channel:"})," ",s.channelName?e.jsx("span",{className:"text-sys-green",children:s.channelName}):s.isPublicHashChannel?e.jsx("span",{className:"text-sys-indigo",children:"Public Hash Channel"}):e.jsxs("span",{className:"font-mono",children:["0x",s.channelHash]})]}),s.decrypted?e.jsxs(e.Fragment,{children:[s.senderName&&e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"From:"})," ",s.senderName]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Text:"})," ",s.text]})]}):s.isPublicHashChannel?e.jsx("p",{className:"text-fg-muted italic",children:"Encrypted (public hash channel)"}):e.jsx("p",{className:"text-fg-muted italic",children:"Encrypted (unknown channel)"})]});case"grp_data":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Channel:"})," ",s.channelName?e.jsx("span",{className:"text-sys-teal",children:s.channelName}):e.jsxs("span",{className:"font-mono",children:["0x",s.channelHash]})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Data:"})," ",s.dataLength," bytes ",s.decrypted?"(decrypted)":"(encrypted)"]})]});case"multipart":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Part:"})," ",s.partNumber+1,"/",s.totalParts]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Message ID:"})," ",s.messageId]})]});case"control":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Control:"})," ",s.subtypeName]}),s.dataLength>0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Data:"})," ",s.dataLength," bytes"]})]});case"req":case"response":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Dest:"})," ",s.destHash]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Src:"})," ",s.srcHash]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Ciphertext:"})," ",s.ciphertextLength," bytes"]})]});case"anon_req":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Dest:"})," ",s.destHash]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Pub Key:"})," ",e.jsxs("span",{className:"font-mono break-all",children:[s.senderPublicKey.slice(0,16),"…"]})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Ciphertext:"})," ",s.ciphertextLength," bytes"]})]});default:return e.jsxs("p",{className:"text-xs text-fg-secondary",children:[t," (","length"in s?s.length:0," bytes)"]})}}function Ka({packet:s,decodedGrpTxt:a}){var z,Z;const t=s.raw_packet||"",n=t.length/2,r=at(),[l,i]=m.useState(null),[c,o]=m.useState(null),[y,x]=m.useState(!1),[j,N]=m.useState(null),g=m.useCallback(E=>{N(R=>R===E?null:E)},[]),d=m.useMemo(()=>gt(t),[t]),v=(z=d==null?void 0:d.packet)==null?void 0:z.payloadType,u=(d==null?void 0:d.payloadHex)||"",w=(Z=d==null?void 0:d.packet)==null?void 0:Z.payload,b=v===oe.GRP_TXT,f=v===oe.GRP_DATA,p=b&&!a&&(!r||y);if(m.useEffect(()=>{if(i(null),x(!1),a||!b||!w||w.length<4)return;if(!r){x(!0);return}x(!0);let E=!1;return Pt(w).then(R=>{E||(i(R),x(!1))}),()=>{E=!0}},[u,b,r,a]),m.useEffect(()=>{if(o(null),!f||!w||w.length<4||!r)return;let E=!1;return Bt(w).then(R=>{E||o(R)}),()=>{E=!0}},[u,f,r]),!d||t.length===0)return e.jsx("div",{className:"p-4 text-center text-fg-muted",children:e.jsx("p",{className:"text-sm",children:"No raw packet data available"})});const{packet:B}=d;let h=d.decoded;a&&d.decoded.type==="grp_txt"?h=a:l&&d.decoded.type==="grp_txt"?h=l:c&&d.decoded.type==="grp_data"&&(h=c);const I=()=>{switch(h.type){case"advert":return e.jsx(Ea,{advert:h,timestamp:s.timestamp});case"grp_data":return e.jsx(Ia,{decoded:h,timestamp:s.timestamp});case"grp_txt":return e.jsx(za,{decoded:h,timestamp:s.timestamp,isLoading:p,onDecrypted:i});case"ack":return e.jsx($a,{decoded:h,timestamp:s.timestamp});case"path":return e.jsx(Ua,{decoded:h,timestamp:s.timestamp});case"trace":return e.jsx(Oa,{decoded:h,timestamp:s.timestamp});case"txt_msg":return e.jsx(Va,{decoded:h,timestamp:s.timestamp});case"multipart":return e.jsx(Ga,{decoded:h,timestamp:s.timestamp});case"generic":return B.payloadType===oe.REQ||B.payloadType===oe.RESPONSE||B.payloadType===oe.ANON_REQ?e.jsx(Qa,{decoded:h,timestamp:s.timestamp,payloadType:B.payloadType}):null;default:return null}},$=m.useMemo(()=>Ha(h,d.payloadHex),[h,d.payloadHex]),O=j==="payload"||ye(j),X=m.useMemo(()=>{const E=[{id:"header",hex:d.headerHex,color:"red"},...d.transportCodesHex?[{id:"transportCodes",hex:d.transportCodesHex,color:"indigo"}]:[],{id:"pathLength",hex:d.pathLengthHex,color:"green"},...d.pathDataHex?[{id:"pathData",hex:d.pathDataHex,color:"amber"}]:[]];return O?[...E,...Da($)]:[...E,{id:"payload",hex:d.payloadHex,color:"cyan"}]},[d,O,$]);return e.jsxs("div",{className:"font-mono space-y-2 min-w-0 overflow-hidden",children:[I(),e.jsx(_a,{rawHex:t,hexSegments:X,selectedSegment:j,onSegmentClick:g}),e.jsx(Kt,{children:e.jsx(de.div,{layout:!0,transition:Je,className:"space-y-2 min-w-0",children:(()=>{var C,W,ne,M;const R=[{id:"header",title:"Header",color:"red",startByte:0,endByte:0,hexBytes:`0x${d.headerHex.toUpperCase()}`,condition:!0,content:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"type-micro text-fg-muted border-b border-edge-subtle font-sans",children:[e.jsx("th",{className:"py-1 font-medium",children:"Bits"}),e.jsx("th",{className:"py-1 font-medium",children:"Field"}),e.jsx("th",{className:"py-1 font-medium",children:"Value"}),e.jsx("th",{className:"py-1 font-medium",children:"Binary"})]})}),e.jsx("tbody",{children:d.headerFields.map(S=>e.jsx(Aa,{...S},S.bits))})]})},{id:"transportCodes",title:"Transport Codes",color:"indigo",startByte:1,endByte:4,hexBytes:((C=d.transportCodesHex)==null?void 0:C.toUpperCase())||"",condition:!!d.transportCodesHex,content:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-fg-muted",children:"Two 16-bit transport codes for encrypted routing"}),e.jsxs("div",{className:"mt-1 text-xs text-fg-secondary",children:["Code 1: 0x",(W=d.transportCodesHex)==null?void 0:W.slice(0,4).toUpperCase()," | Code 2: 0x",(ne=d.transportCodesHex)==null?void 0:ne.slice(4,8).toUpperCase()]})]})},{id:"pathLength",title:"Path Length",color:"green",startByte:d.transportCodesHex?5:1,endByte:d.transportCodesHex?5:1,hexBytes:`0x${d.pathLengthHex.toUpperCase()}`,condition:!0,content:e.jsxs("p",{className:"text-xs text-fg-muted pt-1",children:[B.pathLen," bytes showing route taken (increases as packet floods)"]})},{id:"pathData",title:"Path Data",color:"amber",startByte:d.transportCodesHex?6:2,endByte:(d.transportCodesHex?5:1)+B.pathLen,hexBytes:((M=d.pathDataHex)==null?void 0:M.toUpperCase())||"",condition:B.pathLen>0,content:e.jsxs("div",{className:"space-y-3",children:[e.jsx(Wa,{pathHex:d.pathDataHex}),e.jsx("p",{className:"text-xs text-fg-muted",children:"Historical route taken (bytes are added as packet floods through network)"})]})},{id:"payload",title:"Payload",color:"cyan",startByte:d.payloadStartByte,endByte:n-1,hexBytes:d.payloadHex.toUpperCase(),condition:!0,content:e.jsxs(e.Fragment,{children:[!ye(j)&&e.jsxs("div",{className:"p-3 rounded-lg bg-black",children:[e.jsx("p",{className:"type-micro text-fg-muted mb-1.5 font-sans",children:"Decoded"}),e.jsx(qa,{decoded:h,payloadType:B.payloadType})]}),!ye(j)&&$.length>0&&e.jsx("p",{className:"type-micro text-fg-muted mt-3 font-sans",children:"Click a field below to highlight its bytes"}),ye(j)&&e.jsx("p",{className:"type-micro text-fg-muted font-sans",children:"↑ Selected field above • Other fields below ↓"})]})}].filter(S=>S.condition),D=ye(j)?$.find(S=>S.id===j):null,te=ye(j)?[...R].sort((S,se)=>S.id==="payload"?-1:se.id==="payload"?1:0):[...R].sort((S,se)=>S.id===j?-1:se.id===j?1:0),J=ye(j)?$.filter(S=>S.id!==j):[];return e.jsxs(e.Fragment,{children:[D&&e.jsx(ys,{id:`subfield-${D.id}`,title:D.title,color:D.color,startByte:d.payloadStartByte+D.startByte,endByte:d.payloadStartByte+D.endByte,hexBytes:D.hex.toUpperCase(),isSelected:!0,children:D.decoded},D.id),te.map(S=>e.jsx(ys,{id:`section-${S.id}`,title:S.title,color:S.color,startByte:S.startByte,endByte:S.endByte,hexBytes:S.hexBytes,isSelected:S.id===j,children:S.content},S.id)),J.map(S=>e.jsxs(de.div,{layout:"position",layoutId:`subfield-${S.id}`,transition:Je,className:"w-full min-w-0 overflow-hidden rounded-xl p-4 sm:p-5 space-y-4",style:{backgroundColor:Ce.cardRestBg,boxShadow:Ce.cardRestShadow},children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-0.5 min-w-0",children:[e.jsx(P,{color:S.color,children:S.title}),S.hex.length<=32&&Oe(S.hex).map((se,G)=>e.jsx(P,{color:S.color,className:"font-mono",children:se.toUpperCase()},G))]}),e.jsxs("span",{className:"type-data-xs text-fg-muted flex-shrink-0",children:["Bytes ",d.payloadStartByte+S.startByte,"-",d.payloadStartByte+S.endByte]})]}),e.jsx("div",{className:"min-w-0 overflow-hidden p-3 rounded-lg bg-black",children:S.decoded})]},S.id))]})})()})})]})}const js=m.memo(Ka);function bs(s){if(!s)return[];if(Array.isArray(s))return s;try{const a=JSON.parse(s);return Array.isArray(a)?a:[]}catch{return[]}}function es(s){return s?(s.startsWith("0x")?s.slice(2):s).slice(0,2).toUpperCase():""}function Ya(s,a,t){const n=s.toUpperCase();if(t){let r=null,l=0;if(t.forEach((i,c)=>{if(es(c)===n){const o=i.combinedScore??0;o>l&&(l=o,r=c)}}),r&&a[r])return{hash:r,info:a[r],confidence:l}}for(const[r,l]of Object.entries(a))if(es(r)===n)return{hash:r,info:l,confidence:void 0};return null}function ss({hop:s,compact:a=!1,index:t=0,highlightIndex:n=-1,isTrace:r=!1}){var c;const l=t===n,i=Yt();return m.useEffect(()=>{l&&r&&i.start({boxShadow:["0 0 0 0px rgba(113, 156, 223, 0)","0 0 0 2px rgba(113, 156, 223, 0.5)","0 0 0 2px rgba(113, 156, 223, 0.5)","0 0 0 0px rgba(113, 156, 223, 0)"],transition:{duration:.5,times:[0,.2,.7,1],ease:"easeInOut"}})},[l,r,i]),e.jsxs(de.div,{className:H("flex items-center gap-1.5",a?"flex-row":"flex-col"),animate:{scale:l?1.05:1,opacity:l?1:.85},transition:{duration:.3,ease:"easeInOut"},children:[e.jsxs(de.div,{className:H("flex items-center gap-1.5 px-2.5 py-1 rounded-md","font-mono text-xs font-semibold",s.isLocal?"bg-sys-amber/20 text-sys-amber ring-1 ring-sys-amber/30":"bg-elevated/50 text-fg-primary ring-1 ring-edge-strong/50"),animate:i,initial:{boxShadow:"0 0 0 0px rgba(113, 156, 223, 0)"},children:[s.isLocal&&e.jsx(Ot,{className:"w-3 h-3"}),e.jsx("span",{children:s.prefix}),s.confidence!==void 0&&s.confidence<.9&&e.jsxs("span",{className:"text-[9px] opacity-70",children:[(s.confidence*100).toFixed(0),"%"]})]}),!a&&((c=s.neighborInfo)==null?void 0:c.name)&&e.jsx("span",{className:"text-xs text-fg-muted truncate max-w-[80px]",children:s.neighborInfo.name})]})}function Xa({snr:s,sf:a}){const t=ct(s,a),r=it()[t]||"#6b7280",l=Number.isInteger(s)?s.toString():s.toFixed(1);return e.jsxs(P,{customColor:r,compact:!0,className:"font-mono",children:[s>=0?"+":"",l,"dB"]})}function Za({hops:s,compact:a,isTrace:t=!1,sf:n}){const[r,l]=m.useState(-1);return m.useEffect(()=>{if(s.length===0)return;const i=setTimeout(()=>{l(0)},400),c=setInterval(()=>{l(o=>{const y=o+1;return y>=s.length?(clearInterval(c),-1):y})},t?500:600);return()=>{clearTimeout(i),clearInterval(c)}},[s.length,t]),e.jsx("div",{className:"p-6",style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"4px 8px"},children:s.map((i,c)=>{const o=c%2===0,y=c===s.length-1;return e.jsxs("div",{className:"contents",children:[e.jsx("div",{className:H("flex items-center","justify-end"),children:o&&e.jsx(ss,{hop:i,compact:a,index:c,highlightIndex:r,isTrace:t})}),e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[28px]",children:!y&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px flex-1 bg-border-strong/40 min-h-[8px]"}),i.snr!==void 0&&e.jsx(Xa,{snr:i.snr,sf:n}),e.jsx("svg",{className:"w-3 h-3 text-fg-muted flex-shrink-0",viewBox:"0 0 12 12",fill:"none",children:e.jsx("path",{d:"M6 2v8M3 7l3 3 3-3",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]})}),e.jsx("div",{className:H("flex items-center","justify-start"),children:!o&&e.jsx(ss,{hop:i,compact:a,index:c,highlightIndex:r,isTrace:t})})]},`${i.prefix}-${c}`)})})}function Ja({packet:s,neighbors:a,localHash:t,neighborAffinity:n,ghostPrefixes:r,direction:l="horizontal",compact:i=!1,traceSnr:c,overridePath:o}){const y=c!==void 0&&c.length>0,x=lt(),j=bs(s.original_path),N=bs(s.forwarded_path),g=o??(N.length>0?N:j),d=es(t),v=m.useMemo(()=>g.map((w,b)=>{const f=w.toUpperCase(),p=f===d,B=(r==null?void 0:r.has(f))??!1,h=Ya(f,a,n);return{prefix:f,fullHash:h==null?void 0:h.hash,neighborInfo:h==null?void 0:h.info,isLocal:p,isGhost:B,confidence:h==null?void 0:h.confidence,snr:c==null?void 0:c[b]}}),[g,a,n,d,r,c]);if(v.length===0)return e.jsxs("div",{className:"flex items-center gap-2 text-fg-muted text-xs",children:[e.jsx(fe,{className:"w-4 h-4 opacity-50"}),e.jsx("span",{children:"Direct / No path data"})]});if(l==="flowchart")return e.jsx(Za,{hops:v,compact:i,isTrace:y,sf:x});const u=l==="horizontal"?he:zs;return e.jsx("div",{className:H("flex gap-1.5",l==="horizontal"?"flex-row flex-wrap items-center":"flex-col items-start"),children:v.map((w,b)=>e.jsxs("div",{className:H("flex items-center gap-1.5",l==="vertical"&&"flex-col"),children:[e.jsx(ss,{hop:w,compact:i}),b<v.length-1&&e.jsx(u,{className:"w-3 h-3 text-fg-muted flex-shrink-0"})]},`${w.prefix}-${b}`))})}const we=m.memo(Ja);function ae(s,a){if(s!=null)return typeof s=="boolean"?String(s):typeof s=="number"&&a?`${s} ${a}`:String(s)}const V=()=>"blue",en=[{fn:"id",group:"identity",fmt:"int",read:s=>ae(s.id),color:V},{fn:"packet_hash",group:"identity",fmt:"hex<sha256>",read:s=>s.packet_hash||void 0,color:V},{fn:"timestamp",group:"identity",fmt:"epoch<s>",read:s=>s.timestamp?String(s.timestamp):void 0,color:V,annotate:s=>s.timestamp>0?Ye(s.timestamp):void 0},{fn:"type",group:"classification",fmt:"enum<payload_type>",read:s=>ae(s.type??s.payload_type),color:V},{fn:"route",group:"classification",fmt:"enum<route_type>",read:s=>ae(s.route??s.route_type),color:V},{fn:"rssi",group:"signal",fmt:"int<dBm>",read:s=>ae(s.rssi,"dBm"),color:V},{fn:"snr",group:"signal",fmt:"float<dB>",read:s=>ae(s.snr,"dB"),color:V},{fn:"path_length",group:"size",fmt:"int<hops>",read:s=>{if(s.path_length!=null)return s.path_length===0?"zero-hop":`${s.path_length} hops`},color:V},{fn:"payload_length",group:"size",fmt:"int<B>",read:s=>ae(s.payload_length,"B"),color:V},{fn:"airtime",group:"size",fmt:"float<ms>",read:s=>ae(s.airtime_ms,"ms"),color:V},{fn:"src_hash",group:"addressing",fmt:"hex<2>",read:s=>s.src_hash??void 0,color:V},{fn:"dst_hash",group:"addressing",fmt:"hex<2>",read:s=>s.dst_hash??void 0,color:V},{fn:"path_hash",group:"addressing",fmt:"hex[]|hex",read:s=>Array.isArray(s.path_hash)?`[${s.path_hash.join(", ")}]`:ae(s.path_hash),color:V,renderValue:s=>Array.isArray(s.path_hash)?qe(s.path_hash):null},{fn:"score",group:"addressing",fmt:"int",read:s=>ae(s.score),color:V},{fn:"original_path",group:"paths",fmt:"hex[]",read:s=>Array.isArray(s.original_path)?`[${s.original_path.join(", ")}]`:void 0,color:V,renderValue:s=>Array.isArray(s.original_path)&&s.original_path.length>0?qe(s.original_path,s.src_hash||void 0,s.dst_hash||void 0,!0):null},{fn:"forwarded_path",group:"paths",fmt:"hex[]",read:s=>Array.isArray(s.forwarded_path)?`[${s.forwarded_path.join(", ")}]`:void 0,color:V,renderValue:s=>Array.isArray(s.forwarded_path)&&s.forwarded_path.length>0?qe(s.forwarded_path):null},{fn:"transmitted",group:"status",fmt:"bool",read:s=>ae(s.transmitted),color:V},{fn:"is_duplicate",group:"status",fmt:"bool",read:s=>ae(s.is_duplicate),color:V},{fn:"drop_reason",group:"status",fmt:"string|null",read:s=>s.drop_reason??void 0,color:V},{fn:"tx_delay",group:"status",fmt:"int<ms>",read:s=>ae(s.tx_delay_ms,"ms"),color:V},{fn:"origin",group:"status",fmt:"enum<rx|tx_local|tx_forward>",read:s=>s.packet_origin??void 0,color:V},{fn:"duplicates",group:"status",fmt:"PacketDuplicate[]",read:s=>s.duplicates!=null&&s.duplicates.length>0?`${s.duplicates.length}`:ae(s.duplicates),color:V},{fn:"lbt_attempts",group:"lbt",fmt:"int",read:s=>ae(s.lbt_attempts),color:V},{fn:"lbt_backoff",group:"lbt",fmt:"json<float[]>",read:s=>ae(s.lbt_backoff_delays_ms),color:V},{fn:"lbt_busy",group:"lbt",fmt:"bool|int",read:s=>ae(s.lbt_channel_busy),color:V}];function qe(s,a,t,n){const r=s.length>0,l=a||n,i=t||n;return e.jsxs("span",{className:"inline-flex items-center gap-1 flex-wrap",children:[l&&e.jsxs(e.Fragment,{children:[a?e.jsx("span",{className:"inline-block border border-edge-subtle rounded px-1.5 py-0.5 font-mono text-[11px] text-sys-blue",children:a}):e.jsx("span",{className:"inline-block border border-edge-subtle/50 rounded px-1.5 py-0.5 font-mono text-[11px] text-fg-muted/30",children:"XX"}),(r||i)&&e.jsx("span",{className:"text-fg-muted/40 text-[10px]",children:"→"})]}),s.map((c,o)=>e.jsxs(m.Fragment,{children:[o>0&&e.jsx("span",{className:"text-fg-muted/40 text-[10px]",children:"→"}),e.jsx("span",{className:"inline-block border border-edge-subtle rounded px-1.5 py-0.5 font-mono text-[11px] text-sys-blue",children:c})]},o)),i&&e.jsxs(e.Fragment,{children:[r&&e.jsx("span",{className:"text-fg-muted/40 text-[10px]",children:"→"}),t?e.jsx("span",{className:"inline-block border border-edge-subtle rounded px-1.5 py-0.5 font-mono text-[11px] text-sys-blue",children:t}):e.jsx("span",{className:"inline-block border border-edge-subtle/50 rounded px-1.5 py-0.5 font-mono text-[11px] text-fg-muted/30",children:"XX"})]})]})}let Fe=null;function sn(){if(!Fe){Fe=new Map;for(const s of en)Fe.set(s.fn,s)}return Fe}function Ns(s,a){var i;const t=sn().get(a);if(!t)return null;const n=t.read(s);if(n===void 0)return null;const r=t.color(s),l=(i=t.annotate)==null?void 0:i.call(t,s);return l?{text:n,color:r,annotation:l}:{text:n,color:r}}function vs(s){if(!s)return[];if(Array.isArray(s))return s;try{const a=JSON.parse(s);return Array.isArray(a)?a:[]}catch{return[]}}function ws({packets:s,selectedIndex:a,onSelect:t,compact:n=!1}){if(s.length<=1)return null;const r=a>0,l=a<s.length-1;return e.jsxs("div",{className:H("flex items-center gap-1",n?"gap-0.5":"gap-1"),children:[e.jsx("button",{onClick:()=>r&&t(a-1),disabled:!r,className:H("p-0.5 radius-badge transition-base",r?"text-fg-muted hover:text-fg-primary hover-bg":"text-fg-muted cursor-not-allowed"),"aria-label":"Previous observation",children:e.jsx(Os,{className:n?"size-3":"size-4"})}),e.jsx("div",{className:"flex items-center gap-0.5",children:s.map((i,c)=>{const o=c===a,x=new Date(i.timestamp*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});return e.jsx(pt,{color:o?"cyan":"zinc",filled:o,compact:n,onClick:()=>t(c),title:`Observation ${c+1} at ${x}`,className:H("transition-all duration-150",!o&&"opacity-60 hover:opacity-100"),children:n?e.jsx("span",{className:"tabular-nums",children:c+1}):e.jsxs("span",{className:"tabular-nums text-xs",children:["#",c+1,i.rssi!=null&&e.jsx("span",{className:"ml-1 opacity-70",children:i.rssi})]})},`${i.timestamp}_${c}`)})}),e.jsx("button",{onClick:()=>l&&t(a+1),disabled:!l,className:H("p-0.5 radius-badge transition-base",l?"text-fg-muted hover:text-fg-primary hover-bg":"text-fg-muted cursor-not-allowed"),"aria-label":"Next observation",children:e.jsx(rs,{className:n?"size-3":"size-4"})}),e.jsxs("span",{className:H("text-fg-muted ml-1",n?"text-[9px]":"text-xs"),children:[e.jsx(ns,{className:"inline size-3 mr-0.5 opacity-50"}),s.length]})]})}function He({icon:s,label:a,disabled:t=!1}){return e.jsx(de.div,{className:"flex items-center gap-1 text-xs",title:a,animate:{opacity:t?.25:.6},transition:{duration:.15,ease:[.4,0,.2,1]},children:e.jsx("span",{className:H("flex items-center justify-center size-5 radius-badge border-control transition-base",t?"bg-subtle-fill border-edge-subtle":"bg-subtle-fill"),children:s})})}function tn({hasDuplicates:s,hasPrev:a,hasNext:t,canPrevDupe:n,canNextDupe:r}){return e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(He,{icon:e.jsx(Vt,{className:"size-3"}),label:"Previous packet (↑)",disabled:!a}),e.jsx(He,{icon:e.jsx(Gt,{className:"size-3"}),label:"Next packet (↓)",disabled:!t})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-3 bg-subtle-fill-strong"}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(He,{icon:e.jsx(Os,{className:"size-3"}),label:"Previous observation (←)",disabled:!n}),e.jsx(He,{icon:e.jsx(rs,{className:"size-3"}),label:"Next observation (→)",disabled:!r})]})]})]})}function an({packets:s,initialIndex:a=0,onClose:t,onNavigatePrev:n,onNavigateNext:r,hasPrev:l=!1,hasNext:i=!1,resolveSource:c}){var Ne;const[o,y]=m.useState(a),x=s[o]??s[0],j=s.length>1,[N,g]=m.useState(null),[d,v]=m.useState(!1);m.useEffect(()=>{if(!x._stripped){g(null);return}let K=!1;v(!0);const Y=x.packet_hash;if(!Y){v(!1);return}return ot(Y).then(re=>{K||(re.success&&re.data&&(g(re.data),(re.data.type??re.data.payload_type)===oe.GRP_TXT&&re.data.raw_packet&&dt.getState().queueDecryption([re.data])),v(!1))}).catch(()=>{K||v(!1)}),()=>{K=!0}},[x]);const u=N??x,w=o>0,b=o<s.length-1,f=m.useCallback(K=>{y(Math.max(0,Math.min(K,s.length-1)))},[s.length]);m.useEffect(()=>{const K=Y=>{if(!(Y.target instanceof HTMLInputElement||Y.target instanceof HTMLTextAreaElement))switch(Y.key){case"ArrowUp":Y.preventDefault(),n==null||n();break;case"ArrowDown":Y.preventDefault(),r==null||r();break;case"ArrowLeft":Y.preventDefault(),w&&y(re=>re-1);break;case"ArrowRight":Y.preventDefault(),b&&y(re=>re+1);break}};return window.addEventListener("keydown",K),()=>window.removeEventListener("keydown",K)},[n,r,w,b]);const p=Ls(),B=xt(),h=mt(),I=ht(),$=m.useMemo(()=>new Set(I.map(K=>K.prefix.toUpperCase())),[I]),O=u.payload_type_name||Bs(u.payload_type??u.type),X=u.route_type_name||Ms(u.route_type??u.route),z=u.payload_length??u.length??0,Z=vs(u.original_path),E=vs(u.forwarded_path),R=Z.length>0||E.length>0,D=E.length>0?E:Z,te=m.useMemo(()=>{var K;if((K=p==null?void 0:p.config)!=null&&K.repeater)return{latitude:p.config.repeater.latitude,longitude:p.config.repeater.longitude,name:p.config.node_name||"Local Node"}},[p]),J=(p==null?void 0:p.neighbors)??{},C=h.size>0?h:void 0,W=u.raw_packet&&u.raw_packet.length>0,ne=x._stripped&&d,M=m.useMemo(()=>c?c(u):null,[c,u]),S=ut(u.packet_hash),se=m.useMemo(()=>{if((u.payload_type??u.type)!==oe.GRP_TXT||!(S!=null&&S.decoded))return null;const Y=S.decoded;return{type:"grp_txt",channelHash:Y.channelHash,channelName:Y.channelName,text:Y.text??"",decrypted:Y.decrypted,senderName:Y.senderName,timestamp:Y.timestamp,flags:Y.flags,macCorrupted:Y.macCorrupted}},[u,S]),G=m.useMemo(()=>yt(u,se),[u,se]),q=G.kind==="trace"?G.data:null,L=G.kind==="trace"?G.snrValues:void 0,T=G.kind==="advert"?G.data:null,ie=G.kind==="advert"?G.sourceNode:void 0,U=G.kind==="grp_txt"?G.wardriveSourceNode??void 0:void 0,ce=K=>!K||K===0?"Unknown":new Date(K*1e3).toLocaleString(),Te=(u.payload_type??u.type)===oe.ADVERT&&(ie!==void 0||R),Pe=U!==void 0,be=ie??U,Be=_e[O]??"zinc",Ve=me[Be]||me.zinc;return e.jsxs(Rs,{open:!0,onClose:t,size:"5xl",motionPlus:!0,className:"sm:h-[85vh] sm:max-h-[800px] md:h-[80vh] md:max-h-[900px]",children:[e.jsxs("div",{className:"sm:hidden",children:[e.jsx("div",{className:"flex justify-center pt-2 pb-1",children:e.jsx("div",{className:"w-9 h-1 rounded-full bg-fg-muted","aria-hidden":"true"})}),e.jsxs("div",{className:"flex items-center justify-between px-3 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(P,{color:_e[O]??"zinc",className:"!text-[9px] !px-1.5 !py-0",children:O}),e.jsx(P,{color:De[X]??"zinc",className:"!text-[9px] !px-1.5 !py-0",children:X}),e.jsxs(P,{color:"zinc",className:"!text-[9px] !px-1.5 !py-0",children:[z,"B"]})]}),e.jsx("button",{onClick:t,className:"px-3 py-1.5 text-[15px] font-medium text-sys-blue active:text-sys-blue/80 transition-base flex-shrink-0 radius-inner active:bg-subtle-fill",children:"Done"})]}),j&&e.jsx("div",{className:"px-3 pb-2",children:e.jsx(ws,{packets:s,selectedIndex:o,onSelect:f,compact:!0})})]}),e.jsx("div",{className:"hidden sm:block px-6 pt-5 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{color:_e[O]??"zinc",children:O}),e.jsx(P,{color:De[X]??"zinc",children:X}),e.jsxs(P,{color:"zinc",children:[z,"B"]}),j&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-4 bg-subtle-fill-strong"}),e.jsx(ws,{packets:s,selectedIndex:o,onSelect:f})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(tn,{hasDuplicates:j,hasPrev:l,hasNext:i,canPrevDupe:w,canNextDupe:b}),e.jsx("button",{onClick:t,className:"p-1.5 -m-1.5 text-fg-muted hover:text-fg-primary transition-base radius-inner hover:bg-elevated flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})}),e.jsx("div",{className:"sm:hidden h-[2px]",style:{backgroundColor:Ve,opacity:.6}}),e.jsxs(Fs,{className:"p-0 overflow-hidden flex-1 flex flex-col min-h-0",children:[e.jsx("div",{className:"md:hidden flex-1 overflow-y-auto overflow-x-hidden",children:e.jsxs("div",{className:"p-2 space-y-2",children:[(u.rssi!=null||u.snr!=null)&&e.jsxs("div",{className:"relative flex items-center justify-between px-2 py-1.5 radius-inner bg-subtle-fill",children:[e.jsx(Qe,{mode:"popLayout",initial:!1,children:e.jsxs(de.div,{className:"flex items-center gap-3",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[e.jsx(Ae,{rssi:u.rssi,snr:u.snr,compact:!0,showValues:!0,validated:Ee(u)}),e.jsx("span",{className:"text-[11px] text-fg-muted",children:hs(u.rssi)})]},o)}),D.length>0&&e.jsxs("span",{className:"type-data-xs text-fg-muted",children:[D.length," hop",D.length!==1?"s":""]})]}),(R&&D.length>0||Te||Pe)&&e.jsx("div",{className:"overflow-hidden radius-inset",children:e.jsx("div",{className:"aspect-[4/3] w-full",children:e.jsx(Ue,{path:D,neighbors:J,localNode:te,localHash:p==null?void 0:p.local_hash,srcHash:u.src_hash,dstHash:u.dst_hash,neighborAffinity:C,hubNodes:[...B],traceSnr:L,advertiserSource:be})})}),q&&q.pathHashes.length>0&&e.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[e.jsx("div",{className:"px-3 py-2 space-y-1.5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Trace Route"}),e.jsx("div",{className:"flex items-center gap-1.5",children:e.jsx(P,{color:q.isComplete?"green":"amber",compact:!0,children:q.isComplete?"Complete":"In Progress"})})]})}),e.jsx(we,{packet:u,neighbors:J,localHash:p==null?void 0:p.local_hash,neighborAffinity:C,ghostPrefixes:$,direction:"flowchart",compact:!0,overridePath:q.pathHashes,traceSnr:q.snrValues})]}),R&&!q&&e.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Path"}),e.jsxs(P,{color:"zinc",compact:!0,children:[D.length," hop",D.length!==1?"s":""]})]}),e.jsx(we,{packet:u,neighbors:J,localHash:p==null?void 0:p.local_hash,neighborAffinity:C,ghostPrefixes:$,direction:"flowchart",compact:!0,traceSnr:L})]}),M&&(M.name||M.hash)&&!T&&e.jsxs("div",{className:"radius-inset bg-subtle-fill overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-edge-subtle",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Source"}),e.jsx(P,{color:M.isRepeater?"blue":M.isCompanion?"violet":M.type==="room_server"?"lime":"zinc",compact:!0,children:M.type==="room_server"?"room server":M.type})]}),e.jsxs("div",{className:"p-3 space-y-1.5",children:[M.name&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"type-label text-fg-primary truncate",children:M.name}),!M.confident&&e.jsx("span",{className:"text-[9px] text-fg-muted/60 italic",children:"ambiguous"})]}),M.hash&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsxs("span",{className:"type-data-xs text-fg-muted truncate font-mono",children:[M.hash.startsWith("0x")?M.hash.slice(2,10):M.hash.slice(0,8),"…"]})]})]})]}),T&&e.jsxs("div",{className:"radius-inset bg-subtle-fill overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-edge-subtle",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Advertiser Info"}),e.jsx(P,{color:"lime",compact:!0,children:T.nodeType})]}),e.jsxs("div",{className:"p-3 space-y-2",children:[T.name&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"type-label text-fg-primary truncate",children:T.name})]}),T.latitude&&T.longitude&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsxs("span",{className:"type-data-xs text-fg-secondary",children:[T.latitude.toFixed(5),", ",T.longitude.toFixed(5)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsxs("span",{className:"type-data-xs text-fg-muted truncate",children:[T.publicKey.slice(0,16),"...",T.publicKey.slice(-8)]})]}),T.timestamp>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"text-xs text-fg-muted",children:ce(T.timestamp)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"text-xs text-fg-muted",children:T.flagsDescription||`Flags: 0x${T.flags.toString(16).padStart(2,"0")}`})]})]})]}),ne?e.jsx("div",{className:"pt-1 px-3 py-6 text-center",children:e.jsx("span",{className:"text-xs text-fg-muted animate-pulse",children:"Loading packet details…"})}):W?e.jsx("div",{className:"pt-1",children:e.jsx(js,{packet:u,decodedGrpTxt:se})}):null]})}),e.jsxs("div",{className:"hidden md:grid md:grid-cols-2 flex-1 overflow-hidden",children:[e.jsx("div",{className:"overflow-y-auto overflow-x-hidden scrollbar-none p-4 border-r border-edge-subtle",children:ne?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("span",{className:"text-sm text-fg-muted animate-pulse",children:"Loading packet details…"})}):W?e.jsx(js,{packet:u,decodedGrpTxt:se}):null}),e.jsxs("div",{className:"grid overflow-hidden",style:{gridTemplateRows:"minmax(280px, 1fr) auto"},children:[e.jsx("div",{className:"overflow-hidden p-2",children:R&&D.length>0||Te||Pe?e.jsx("div",{className:"h-full w-full",children:e.jsx(Ue,{path:D,neighbors:J,localNode:te,localHash:p==null?void 0:p.local_hash,srcHash:u.src_hash,dstHash:u.dst_hash,neighborAffinity:C,hubNodes:[...B],traceSnr:L,advertiserSource:be})}):e.jsxs("div",{className:"h-full w-full flex flex-col items-center justify-center text-center px-4",children:[e.jsx(fe,{className:"w-8 h-8 text-fg-muted/50 mb-2"}),e.jsx("span",{className:"text-sm text-fg-muted",children:"Direct Reception"}),e.jsx("span",{className:"text-xs text-fg-muted/70 mt-1",children:"Zero-hop packet — received directly from sender"})]})}),e.jsxs("div",{className:"overflow-y-auto max-h-[200px] p-2 space-y-2",children:[!q&&D.length<=1&&(u.rssi!=null||u.snr!=null)&&e.jsx("div",{className:"surface-base radius-inset p-4",children:e.jsxs("dl",{className:"text-xs grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-fg-muted mb-1",children:"Signal"}),e.jsx(Qe,{mode:"popLayout",initial:!1,children:e.jsxs(de.dd,{className:"flex items-center gap-2",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[e.jsx(Ae,{rssi:u.rssi,snr:u.snr,validated:Ee(u)}),e.jsx("span",{className:"font-medium text-fg-primary",children:hs(u.rssi)})]},o)})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-fg-muted mb-1",children:"RF"}),e.jsx(Qe,{mode:"popLayout",initial:!1,children:e.jsxs(de.dd,{className:"type-data text-fg-secondary",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[(Ne=Ns(u,"rssi"))==null?void 0:Ne.text,(()=>{const K=Ns(u,"snr");return K?` · ${K.text}`:null})()]},o)})]})]})}),M&&(M.name||M.hash)&&!T&&e.jsxs("div",{className:"radius-inset bg-subtle-fill overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-edge-subtle",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Source"}),e.jsx(P,{color:M.isRepeater?"blue":M.isCompanion?"violet":M.type==="room_server"?"lime":"zinc",compact:!0,children:M.type==="room_server"?"room server":M.type})]}),e.jsxs("div",{className:"p-4 space-y-2",children:[M.name&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"type-label text-fg-primary truncate",children:M.name}),!M.confident&&e.jsx("span",{className:"text-[10px] text-fg-muted/60 italic",children:"ambiguous"})]}),M.hash&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsxs("span",{className:"text-[11px] font-mono text-fg-muted truncate",children:[M.hash.startsWith("0x")?M.hash.slice(2,10):M.hash.slice(0,8),"…"]})]})]})]}),T&&e.jsxs("div",{className:"radius-inset bg-subtle-fill overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-edge-subtle",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Advertiser"}),e.jsx(P,{color:"lime",compact:!0,children:T.nodeType})]}),e.jsxs("div",{className:"p-4 space-y-2.5",children:[T.name&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"type-label text-fg-primary truncate",children:T.name})]}),T.latitude&&T.longitude&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsxs("span",{className:"type-data-xs text-fg-secondary",children:[T.latitude.toFixed(5),", ",T.longitude.toFixed(5)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsxs("span",{className:"text-[11px] font-mono text-fg-muted truncate",children:[T.publicKey.slice(0,16),"...",T.publicKey.slice(-8)]})]}),T.timestamp>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"text-xs text-fg-muted",children:ce(T.timestamp)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"text-[11px] text-fg-muted",children:T.flagsDescription||`Flags: 0x${T.flags.toString(16).padStart(2,"0")}`})]})]})]}),q&&q.pathHashes.length>0&&e.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Trace Route"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(P,{color:q.isComplete?"green":"amber",compact:!0,children:q.isComplete?"Complete":"In Progress"}),e.jsxs(P,{color:"teal",compact:!0,children:[q.pathHashes.length,"h"]})]})]}),e.jsx(we,{packet:u,neighbors:J,localHash:p==null?void 0:p.local_hash,neighborAffinity:C,ghostPrefixes:$,direction:"flowchart",compact:!0,overridePath:q.pathHashes,traceSnr:q.snrValues})]}),R&&!q&&e.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Path"}),e.jsxs(P,{color:"zinc",compact:!0,children:[D.length,"h"]})]}),e.jsx(we,{packet:u,neighbors:J,localHash:p==null?void 0:p.local_hash,neighborAffinity:C,ghostPrefixes:$,direction:"flowchart",compact:!0,traceSnr:L})]})]})]})]})]})]})}const nn=m.memo(an);function ks({label:s,numericValue:a,unit:t,icon:n,subtext:r,showSign:l=!1}){return e.jsxs("div",{className:"radius-inner p-3 sm:radius-inset sm:p-4 bg-subtle-fill ring-1 ring-inset ring-edge-subtle",children:[e.jsx("div",{className:"mb-1.5 sm:mb-2",children:e.jsx("span",{className:"text-xs sm:type-micro text-fg-muted",children:s})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{value:a,format:{minimumFractionDigits:1,maximumFractionDigits:1,signDisplay:l?"always":"auto"},className:"type-data-hero tracking-tight text-fg-primary"}),e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(n,{className:"w-[14px] h-[14px] text-fg-muted"}),t&&e.jsx("span",{className:"text-xs font-medium leading-tight text-fg-muted",children:t})]})]}),r&&e.jsx("p",{className:"mt-1.5 sm:mt-2 type-data-xs sm:text-[11px] text-fg-muted/80 truncate",children:r})]})}function rn({snr:s}){const a=s>=5?"bg-sys-teal":s>=0?"bg-sys-green":s>=-5?"bg-sys-amber":s>=-10?"bg-sys-orange":"bg-sys-red";return e.jsx("span",{className:H("w-1.5 h-1.5 rounded-full flex-shrink-0",a),title:`SNR: ${s.toFixed(1)} dB`})}function Cs({fromPrefix:s,toPrefix:a,fromName:t,toName:n,snr:r,maxSnr:l,isWeakest:i,isStrongest:c,index:o=0}){const x=Math.max(l+5,15),j=Math.max(0,Math.min(100,(r- -20)/(x- -20)*100)),N="bg-[#0074BE]",g=r>=5?"bg-sys-teal":r>=0?"bg-sys-green":r>=-5?"bg-sys-amber":r>=-10?"bg-sys-orange":"bg-sys-red",d=.3+o*.15;return e.jsxs("div",{className:"relative p-3 pl-5 radius-inner bg-subtle-fill ring-1 ring-inset ring-edge-subtle",children:[e.jsx("span",{className:H("absolute left-0 top-1/2 -translate-y-1/2 h-4 w-0.5 rounded-full",g)}),e.jsx("span",{className:"absolute -top-0.5 -right-0.5",children:e.jsx(rn,{snr:r})}),e.jsxs("div",{className:"sm:hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("span",{className:"text-[13px] font-medium text-fg-secondary truncate",children:t||s}),e.jsx(he,{className:"w-3 h-3 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"text-[13px] font-semibold text-fg-primary truncate",children:n||a})]}),e.jsxs("div",{className:"flex items-center gap-1.5 ml-2 flex-shrink-0",children:[i&&e.jsx(P,{color:"red",compact:!0,children:"Low"}),c&&!i&&e.jsxs(P,{color:"amber",compact:!0,children:[e.jsx(fs,{className:"w-2.5 h-2.5"}),"Best"]}),e.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[12px] font-mono font-bold tabular-nums bg-subtle-fill-hover text-fg-primary ring-1 ring-inset ring-edge-subtle",children:[r>=0?"+":"−",Math.abs(r).toFixed(1)]})]})]}),e.jsx("div",{className:"h-1.5 bg-subtle-fill-strong rounded-full overflow-hidden",children:e.jsx(de.div,{className:H("h-full rounded-full",N),initial:{width:0},animate:{width:`${j}%`},transition:{duration:1.5,delay:d,ease:[.25,.1,.25,1]}})})]}),e.jsxs("div",{className:"hidden sm:block",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx("code",{className:"type-data-xs text-fg-muted",children:s}),t&&e.jsx("span",{className:"text-xs text-fg-secondary truncate max-w-[100px]",children:t})]}),e.jsx(he,{className:"w-3 h-3 text-fg-muted/40 flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx("code",{className:"font-mono text-xs font-semibold text-fg-primary",children:a}),n&&e.jsx("span",{className:"text-xs text-fg-secondary truncate max-w-[100px]",children:n})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[i&&e.jsx(P,{color:"red",compact:!0,children:"Bottleneck"}),c&&!i&&e.jsxs(P,{color:"amber",compact:!0,children:[e.jsx(fs,{className:"w-3 h-3"}),"Strongest"]}),e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-sm font-mono font-semibold tabular-nums bg-subtle-fill-hover text-fg-primary ring-1 ring-inset ring-edge-subtle",children:[r>=0?"+":"−",Math.abs(r).toFixed(1)]})]})]}),e.jsx("div",{className:"h-1.5 bg-elevated rounded-full overflow-hidden",children:e.jsx(de.div,{className:H("h-full rounded-full",N),initial:{width:0},animate:{width:`${j}%`},transition:{duration:1.5,delay:d,ease:[.25,.1,.25,1]}})})]})]})}function pe(s,a){if(s==="You")return"You";const t=s.toUpperCase();for(const[n,r]of Object.entries(a))if((n.startsWith("0x")?n.slice(2,4):n.slice(0,2)).toUpperCase()===t)return r.name||r.node_name||void 0}function ln({report:s,onClose:a}){var y,x;const t=Ls(),n=(t==null?void 0:t.neighbors)??{},r=(y=t==null?void 0:t.config)!=null&&y.repeater?{latitude:t.config.repeater.latitude,longitude:t.config.repeater.longitude,name:t.config.node_name||"Local Node"}:void 0,l=(x=s.bestObservation)==null?void 0:x.decoded.snrValues,i=s.linkQuality?s.linkQuality.avgSnr>=5?"excellent":s.linkQuality.avgSnr>=0?"good":s.linkQuality.avgSnr>=-5?"fair":"poor":"unknown",o={excellent:"var(--signal-excellent)",good:"var(--signal-good)",fair:"var(--signal-fair)",poor:"var(--signal-poor)",unknown:"var(--fg-muted)"}[i];return e.jsxs(Rs,{open:!0,onClose:a,size:"5xl",motionPlus:!0,children:[e.jsxs("div",{className:"sm:hidden",children:[e.jsx("div",{className:"flex justify-center pt-2 pb-1",children:e.jsx("div",{className:"w-9 h-1 rounded-full bg-fg-primary/30","aria-hidden":"true"})}),e.jsxs("div",{className:"flex items-center justify-between px-4 pb-2",children:[e.jsx("h2",{className:"font-semibold text-[17px] text-fg-primary",children:"Trace Report"}),e.jsx("button",{onClick:a,className:"text-[17px] font-medium text-sys-blue active:text-sys-blue/80",children:"Done"})]})]}),e.jsx("div",{className:"sm:hidden h-[2px]",style:{backgroundColor:o,opacity:.6}}),e.jsx("div",{className:"hidden sm:block px-6 pt-5 pb-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[e.jsx("h2",{className:"type-micro",children:"Trace Report"}),e.jsxs(P,{color:i==="excellent"||i==="good"?"green":i==="fair"?"amber":"red",children:[e.jsx(us,{className:"w-3 h-3 mr-1"}),i==="excellent"?"Excellent":i==="good"?"Good":i==="fair"?"Fair":"Poor"]})]}),e.jsx("p",{className:"mt-1 text-xs sm:text-sm font-mono text-fg-muted tabular-nums",children:s.traceTag})]}),e.jsx("button",{onClick:a,className:"p-1.5 -m-1.5 text-fg-muted hover:text-fg-primary transition-base radius-inner hover:bg-elevated flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsxs("div",{className:"hidden sm:flex flex-wrap items-center gap-1.5 sm:gap-2 px-4 sm:px-6 pb-3 sm:pb-4 border-b border-edge-subtle",children:[e.jsxs(P,{color:"teal",children:[e.jsx("span",{className:"font-mono tabular-nums",children:s.targetHopCount}),e.jsxs("span",{className:"ml-1",children:["hop",s.targetHopCount!==1?"s":""]})]}),e.jsxs(P,{color:"zinc",children:[e.jsx("span",{className:"font-mono tabular-nums",children:s.observationCount}),e.jsx("span",{className:"ml-1",children:"obs"})]}),s.linkQuality&&e.jsxs(P,{color:"indigo",children:[e.jsx("span",{className:"font-mono tabular-nums",children:s.linkQuality.avgSnr.toFixed(1)}),e.jsx("span",{className:"ml-1",children:"dB avg"})]}),e.jsx("span",{className:"type-data-xs text-fg-muted",children:ft(s.duration)}),s.linkQuality&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-fg-muted/40",children:"•"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-xs font-medium bg-sys-red/15 text-sys-red ring-1 ring-inset ring-sys-red/25",children:[e.jsx("span",{className:"opacity-70",children:"Min"}),e.jsx("span",{className:"font-mono tabular-nums",children:s.linkQuality.minSnr.toFixed(1)})]}),e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-xs font-medium bg-sys-teal/15 text-sys-teal ring-1 ring-inset ring-sys-teal/25",children:[e.jsx("span",{className:"opacity-70",children:"Max"}),e.jsx("span",{className:"font-mono tabular-nums",children:s.linkQuality.maxSnr.toFixed(1)})]})]})]})]}),e.jsxs(Fs,{className:"p-0 overflow-hidden",children:[e.jsx("div",{className:"md:hidden h-[75vh] max-h-[calc(100vh-80px)] overflow-y-auto overflow-x-hidden",children:e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[s.linkQuality&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"radius-inner bg-subtle-fill ring-1 ring-inset ring-edge-subtle p-2.5 text-center",children:[e.jsx(Ze,{value:Math.abs(s.linkQuality.minSnr),format:{maximumFractionDigits:0,signDisplay:"never"},prefix:s.linkQuality.minSnr<0?"-":"",className:"text-[20px] font-bold font-mono tabular-nums flex items-center justify-center text-fg-primary"}),e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[e.jsx(Xe,{className:"w-2.5 h-2.5 text-fg-muted"}),e.jsx("span",{className:"text-xs text-fg-muted",children:"Min dB"})]})]}),e.jsxs("div",{className:"radius-inner bg-subtle-fill ring-1 ring-inset ring-edge-subtle p-2.5 text-center",children:[e.jsx(Ze,{value:s.linkQuality.maxSnr,format:{maximumFractionDigits:0,signDisplay:"always"},className:"text-[20px] font-bold font-mono text-fg-primary tabular-nums flex items-center justify-center"}),e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[e.jsx(ps,{className:"w-2.5 h-2.5 text-fg-muted"}),e.jsx("span",{className:"text-xs text-fg-muted",children:"Max dB"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(P,{color:i==="excellent"||i==="good"?"green":i==="fair"?"amber":"red",compact:!0,children:[e.jsx(us,{className:"w-2.5 h-2.5 mr-0.5"}),i==="excellent"?"Excellent":i==="good"?"Good":i==="fair"?"Fair":"Poor"]}),e.jsxs(P,{color:"teal",compact:!0,children:[s.targetHopCount," hops"]}),e.jsxs(P,{color:"zinc",compact:!0,children:[s.observationCount," obs"]}),e.jsx("span",{className:"type-data-xs text-fg-muted ml-auto",children:s.traceTag.slice(0,8)})]}),s.targetPath.length>0&&e.jsx("div",{className:"overflow-hidden radius-inset",children:e.jsx("div",{className:"aspect-[4/3] w-full",children:e.jsx(Ue,{path:s.targetPath,neighbors:n,localNode:r,localHash:t==null?void 0:t.local_hash,srcHash:s.srcHash,dstHash:s.dstHash,traceSnr:l})})}),e.jsxs("div",{className:"radius-inset bg-body overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-edge-subtle",children:[e.jsx("span",{className:"text-[11px] font-medium text-fg-secondary",children:"Route Path"}),s.linkQuality&&e.jsxs("span",{className:"type-data-xs text-fg-muted",children:["SNR ",s.linkQuality.minSnr.toFixed(1)," → ",s.linkQuality.maxSnr.toFixed(1)," dB"]})]}),s.bestObservation?e.jsx(we,{packet:s.bestObservation.packet,neighbors:n,localHash:t==null?void 0:t.local_hash,direction:"flowchart",compact:!0,overridePath:s.targetPath,traceSnr:s.bestObservation.decoded.snrValues}):e.jsx("div",{className:"p-6 text-center text-fg-muted text-xs",children:"No path data available"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"type-micro text-fg-muted mb-2",children:["Link Quality · ",s.hopStats.length," hops"]}),e.jsx("div",{className:"space-y-1.5",children:s.hopStats.length>0?s.hopStats.map((j,N)=>{var u,w,b;const g=N<s.targetPath.length-1?s.targetPath[N+1]:"You",d=pe(j.prefix,n),v=pe(g,n);return e.jsx(Cs,{fromPrefix:j.prefix,toPrefix:g,fromName:d,toName:v,snr:j.snr,maxSnr:((u=s.linkQuality)==null?void 0:u.maxSnr)??10,isWeakest:((w=s.linkQuality)==null?void 0:w.weakestLinkPosition)===N,isStrongest:((b=s.linkQuality)==null?void 0:b.strongestLinkPosition)===N,index:N},`${j.prefix}-${N}`)}):e.jsx("div",{className:"text-xs text-fg-muted py-6 text-center",children:"No link data collected"})})]}),e.jsx("div",{className:"pt-1 pb-2 text-center",children:e.jsxs("span",{className:"text-xs text-fg-muted",children:["Traced ",Ye(s.firstSeen)]})})]})}),e.jsxs("div",{className:"hidden md:flex md:flex-row h-[70vh] max-h-[calc(100vh-200px)] overflow-hidden",children:[e.jsx("div",{className:"w-1/2 flex flex-col min-w-0 min-h-0 overflow-hidden border-r border-edge-subtle",children:e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[s.linkQuality&&(()=>{const j=s.targetPath[s.linkQuality.weakestLinkPosition],N=s.targetPath[s.linkQuality.weakestLinkPosition+1]||"You",g=pe(j,n),d=pe(N,n),v=s.targetPath[s.linkQuality.strongestLinkPosition],u=s.targetPath[s.linkQuality.strongestLinkPosition+1]||"You",w=pe(v,n),b=pe(u,n);return e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(ks,{label:"Weakest Link",numericValue:s.linkQuality.minSnr,unit:"dB",icon:Xe,subtext:`${g||j} → ${d||N}`}),e.jsx(ks,{label:"Best Link",numericValue:s.linkQuality.maxSnr,showSign:!0,unit:"dB",icon:ps,subtext:`${w||v} → ${b||u}`})]})})(),e.jsxs("div",{children:[e.jsx("h3",{className:"type-micro text-fg-muted mb-3",children:"Link Details"}),e.jsx("div",{className:"space-y-2",children:s.hopStats.length>0?s.hopStats.map((j,N)=>{var u,w,b;const g=N<s.targetPath.length-1?s.targetPath[N+1]:"You",d=pe(j.prefix,n),v=pe(g,n);return e.jsx(Cs,{fromPrefix:j.prefix,toPrefix:g,fromName:d,toName:v,snr:j.snr,maxSnr:((u=s.linkQuality)==null?void 0:u.maxSnr)??10,isWeakest:((w=s.linkQuality)==null?void 0:w.weakestLinkPosition)===N,isStrongest:((b=s.linkQuality)==null?void 0:b.strongestLinkPosition)===N,index:N},`${j.prefix}-${N}`)}):e.jsx("div",{className:"text-xs text-fg-muted py-8 text-center",children:"No link data collected"})})]}),e.jsxs("div",{className:"pt-2 text-center",children:[e.jsx("span",{className:"text-xs text-fg-muted",children:"Traced "}),e.jsx("span",{className:"type-data-xs text-fg-muted",children:Ye(s.firstSeen)})]})]})}),e.jsxs("div",{className:"w-1/2 min-w-0 overflow-y-auto p-3 space-y-2",children:[s.targetPath.length>0&&e.jsx("div",{className:"overflow-hidden",children:e.jsx("div",{className:"aspect-square w-full",children:e.jsx(Ue,{path:s.targetPath,neighbors:n,localNode:r,localHash:t==null?void 0:t.local_hash,srcHash:s.srcHash,dstHash:s.dstHash,traceSnr:l})})}),e.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Trace Route"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(P,{color:s.isComplete?"green":"amber",compact:!0,children:s.isComplete?"Complete":`${s.maxHopsObserved}/${s.targetHopCount}`}),e.jsxs(P,{color:"teal",compact:!0,children:[s.targetHopCount," hop",s.targetHopCount!==1?"s":""]})]})]}),s.linkQuality&&s.bestObservation&&e.jsxs("div",{className:"flex items-center gap-4 px-4 pb-2 type-data-xs text-fg-muted",children:[e.jsxs("span",{children:[e.jsx("span",{className:"opacity-60",children:"Tag"})," ",e.jsx("code",{className:"text-sys-teal tabular-nums",children:s.traceTag.slice(0,8)})]}),e.jsxs("span",{children:[e.jsx("span",{className:"opacity-60",children:"SNR"})," ",e.jsxs("code",{className:"text-sys-indigo tabular-nums",children:[s.linkQuality.minSnr.toFixed(1),"–",s.linkQuality.maxSnr.toFixed(1)]}),e.jsx("span",{className:"opacity-60",children:" dB"})]})]}),s.bestObservation?e.jsx(we,{packet:s.bestObservation.packet,neighbors:n,localHash:t==null?void 0:t.local_hash,direction:"flowchart",compact:!0,overridePath:s.targetPath,traceSnr:s.bestObservation.decoded.snrValues}):e.jsx("div",{className:"p-8 text-center text-fg-muted text-xs",children:"No path data available"})]})]})]})]})]})}const cn=m.memo(ln),Ks=[{target:"PacketList",fn:"type",minStage:1},{target:"PacketList",fn:"route",minStage:1},{target:"PacketList",fn:"rssi",minStage:1},{target:"PacketList",fn:"snr",minStage:1},{target:"PacketList",fn:"path",minStage:1,when:wt},{target:"PacketList",fn:"src_hash",minStage:1,when:kt},{target:"PacketList",fn:"text",minStage:1,when:Ct},{target:"PacketList",fn:"ack",minStage:1,when:St},{target:"PacketList",fn:"decrypt",minStage:2,when:_t},{target:"PacketList",fn:"duplicates",minStage:1}];vt(Ks);const on=48,dn=72,xn=100,mn=5,hn=600,Ys="(min-width: 640px)";let xe=null;function un(s){return typeof window>"u"?()=>{}:(xe||(xe=window.matchMedia(Ys)),xe.addEventListener("change",s),()=>xe==null?void 0:xe.removeEventListener("change",s))}function pn(){return typeof window>"u"?!0:(xe||(xe=window.matchMedia(Ys)),xe.matches)}function fn(){return m.useSyncExternalStore(un,pn,()=>!0)}function gn(s,a,t){const[n,r]=m.useState(1),l=t?Math.ceil(s/a):1;m.useEffect(()=>{n>l&&l>0&&queueMicrotask(()=>r(1))},[l,n]);const i=m.useCallback(o=>r(Math.max(1,Math.min(o,l))),[l]),c=m.useMemo(()=>na(n,l),[n,l]);return{currentPage:n,totalPages:l,goToPage:i,pageRange:c}}function yn(s,a){const[t,n]=m.useState(null),r=m.useRef(0);return m.useEffect(()=>{var x,j;if(!a||!s.length)return;const l=((x=s[0])==null?void 0:x.timestamp)??0,i=l>r.current&&r.current>0;if(r.current=l,!i)return;const c=(j=s[0])==null?void 0:j.packet_hash;if(!c)return;const o=requestAnimationFrame(()=>n(c)),y=setTimeout(()=>n(null),600);return()=>{cancelAnimationFrame(o),clearTimeout(y)}},[s,a]),t}function jn(s){if(!s||s.length<6)return null;const a=s,t=parseInt(a.slice(0,2),16);if(isNaN(t))return null;const n=t&3;let r=2;if((n===0||n===3)&&(r=10),r+2>a.length)return null;const l=parseInt(a.slice(r,r+2),16);if(isNaN(l)||(r+=2+l*2,r>=a.length))return null;const i=a.slice(r);return i.length>=38?i.slice(0,38):i}function bn(s){if(s.length<=1)return s;const a=new Map,t=new Map,n=new Map;for(let i=0;i<s.length;i++){const{packet:c}=s[i],o=c.payload_type??c.type;if(o!==as.GRP_TXT)continue;const y=c._payloadHexPrefix??jn(c.raw_packet);if(y){const g=a.get(y);if(g!==void 0){n.set(i,g);continue}a.set(y,i)}const x=c.payload_length??c.length??0,j=Math.floor((c.timestamp??0)/60),N=`${o}:${x}:${j}`;if(!y){const g=t.get(N);if(g!==void 0){n.set(i,g);continue}}t.has(N)||t.set(N,i)}if(n.size===0)return s;const r=new Map;for(const[i,c]of n)r.set(c,(r.get(c)??0)+s[i].dupeCount);const l=[];for(let i=0;i<s.length;i++){if(n.has(i))continue;const c=r.get(i)??0;l.push(c>0?{packet:s[i].packet,dupeCount:s[i].dupeCount+c}:s[i])}return l}function Nn(s){const a=new Map;for(const t of s)if((t.payload_type??t.type)===as.TRACE&&t.packet_hash){const r=t._traceTag??(t.payload?Hs(t.payload):null);r&&a.set(t.packet_hash,r)}return a}function vn(s){if(s.length===0)return[];const a=[];let t=0;for(;t<s.length;){const n=s[t],r=n.packet_hash;let l=1;if(r)for(;t+l<s.length&&s[t+l].packet_hash===r;)l++;a.push({packet:n,dupeCount:l}),t+=l}return a}function wn(s){const a=new Map;if(s.length===0)return a;for(let t=0;t<s.length;t++){const n=s[t].packet_hash;if(!n)continue;const r=s[t-1],l=s[t+1],i=(r==null?void 0:r.packet_hash)===n,c=(l==null?void 0:l.packet_hash)===n;(i||c)&&(i&&c?a.set(t,"middle"):i?a.set(t,"last"):c&&a.set(t,"first"))}return a}function Ss({message:s}){return e.jsxs("div",{className:"flex flex-col items-center justify-center py-14 text-center",children:[e.jsx(fe,{className:"size-6 text-fg-muted mb-2"}),e.jsx("p",{className:"text-sm text-fg-primary",children:s}),e.jsx("p",{className:"text-xs text-fg-muted",children:"Packets will appear here"})]})}function _s(){return e.jsx("div",{className:"py-14 text-center text-sm text-fg-muted",children:"Loading packets…"})}function kn({showPagination:s,currentPage:a,perPage:t,displayCount:n,totalCount:r,action:l}){const i=s?(a-1)*t+1:1,c=s?Math.min(a*t,r):n;return e.jsxs("div",{className:"flex items-center justify-between gap-4 border-t border-edge-subtle px-4 py-3 text-xs text-fg-muted sm:px-6",children:[e.jsxs("span",{children:["Showing"," ",e.jsx("span",{className:"font-medium text-fg-secondary",children:s?`${i}–${c}`:n})," ","of"," ",e.jsx("span",{className:"font-medium text-fg-secondary",children:r})," ","packets"]}),l]})}function $n({packets:s,allPackets:a,localHash:t,neighbors:n,loading:r=!1,maxPackets:l,perPage:i=50,showPagination:c=!1,onPacketSelect:o,flashNewest:y=!1,emptyMessage:x="No packets found",className:j,footerAction:N,hideDupes:g=!1,getDecodedContent:d,onChannelClick:v,resolveSource:u,virtualized:w=!0}){Nt(Ks);const[b,f]=m.useState(null),[p,B]=m.useState(null),[h,I]=m.useState({traceTag:null,dupeGroup:null}),$=m.useRef(null),O=Xt(k=>k.setModalMapOpen);m.useEffect(()=>(O(!!b),()=>O(!1)),[b,O]),m.useLayoutEffect(()=>{I({traceTag:null,dupeGroup:null})},[s]);const X=a??s,z=m.useMemo(()=>l&&l>0&&!g?s.slice(0,l):s,[s,l,g]),Z=m.useMemo(()=>{if(!g)return null;const k=vn(z),_=bn(k);return l&&l>0?_.slice(0,l):_},[z,g,l]),E=Z?Z.length:z.length,{currentPage:R,totalPages:D,goToPage:te,pageRange:J}=gn(E,i,c),C=m.useMemo(()=>{if(g||!c)return z;const k=(R-1)*i;return z.slice(k,k+i)},[z,c,R,i,g]),W=m.useMemo(()=>{if(!Z)return null;if(!c)return Z;const k=(R-1)*i;return Z.slice(k,k+i)},[Z,c,R,i]),ne=m.useMemo(()=>Nn(C),[C]),M=m.useMemo(()=>wn(C),[C]),S=yn(s,y),se=fn(),G=m.useMemo(()=>g&&W?W:C,[g,W,C]),q=w&&G.length>xn,L=se?on:dn,T=tt({count:q?G.length:0,getScrollElement:()=>$.current,estimateSize:()=>L,overscan:mn}),ie=m.useCallback((k,_)=>{var ve,Me;const F=k.packet_hash;if(!F)return[k];let A=_;for(;A>0&&((ve=C[A-1])==null?void 0:ve.packet_hash)===F;)A--;let Q=_;for(;Q<C.length-1&&((Me=C[Q+1])==null?void 0:Me.packet_hash)===F;)Q++;return A===Q?[k]:C.slice(A,Q+1)},[C]),U=m.useCallback(k=>{var A,Q;const _=(A=C[k])==null?void 0:A.packet_hash;if(!_)return k;let F=k;for(;F>0&&((Q=C[F-1])==null?void 0:Q.packet_hash)===_;)F--;return F},[C]),ce=m.useCallback(k=>{var A,Q;const _=(A=C[k])==null?void 0:A.packet_hash;if(!_)return k;let F=k;for(;F<C.length-1&&((Q=C[F+1])==null?void 0:Q.packet_hash)===_;)F++;return F},[C]),je=m.useCallback((k,_)=>{if(o){o(k);return}if(_!==void 0){const F=ie(k,_),A=F.indexOf(k);f({packets:F,initialIndex:A>=0?A:0,rowIndex:_})}else f({packets:[k],initialIndex:0,rowIndex:0})},[o,ie]),is=m.useCallback(()=>{if(!b)return;const _=U(b.rowIndex)-1;if(_<0)return;const F=C[_];if(!F)return;const A=ie(F,_);f({packets:A,initialIndex:0,rowIndex:_})},[b,C,U,ie]),Te=m.useCallback(()=>{if(!b)return;const _=ce(b.rowIndex)+1;if(_>=C.length)return;const F=C[_];if(!F)return;const A=ie(F,_);f({packets:A,initialIndex:0,rowIndex:_})},[b,C,ce,ie]),cs=m.useMemo(()=>b?U(b.rowIndex)>0:!1,[b,U]),Pe=m.useMemo(()=>b?ce(b.rowIndex)<C.length-1:!1,[b,ce,C.length]),be=m.useCallback(k=>I(_=>({..._,traceTag:k})),[]),Be=m.useCallback(k=>I(_=>({..._,dupeGroup:k})),[]),Ve=m.useCallback(()=>{I({traceTag:null,dupeGroup:null})},[]),Ne=m.useCallback(k=>{const _=X.filter(Q=>(Q.payload_type??Q.type)===as.TRACE&&Q.payload&&Hs(Q.payload)===k);if(_.length===0)return;const A=jt(_).get(k);A!=null&&A.length&&B(bt(k,A))},[X]),K=m.useCallback(k=>{const _=X.find(F=>F.packet_hash===k);_&&(B(null),je(_))},[X,je]),Y=m.useCallback((k,_,F)=>{const A=se?ma:ha;if(F){const{packet:ue,dupeCount:Zs}=k,xs=ue.packet_hash?ne.get(ue.packet_hash):void 0,Js=h.traceTag!==null&&xs===h.traceTag;return e.jsx(A,{packet:ue,onClick:et=>je(et,_),localHash:t,neighbors:n,resolveSource:u,isFlashing:y&&S===ue.packet_hash,traceTag:xs,isTraceHighlighted:Js,onTraceHover:be,onViewTraceReport:Ne,dupeCount:Zs,getDecodedContent:d,onChannelClick:v},`${ue.packet_hash}_${ue.timestamp}_${_}`)}const Q=k,ve=Q.packet_hash?ne.get(Q.packet_hash):void 0,Me=h.traceTag!==null&&ve===h.traceTag,ds=M.get(_),Xs=ds!==void 0&&h.dupeGroup!==null&&Q.packet_hash===h.dupeGroup;return e.jsx(A,{packet:Q,onClick:ue=>je(ue,_),localHash:t,neighbors:n,resolveSource:u,isFlashing:y&&S===Q.packet_hash,traceTag:ve,isTraceHighlighted:Me,onTraceHover:be,onViewTraceReport:Ne,dupeGroupPosition:ds,isDupeGroupHovered:Xs,onDupeGroupHover:Be,getDecodedContent:d,onChannelClick:v},`${Q.packet_hash}_${Q.timestamp}_${_}`)},[se,ne,h.traceTag,h.dupeGroup,je,t,n,u,y,S,be,Ne,M,Be,d,v]),re=()=>{if(r&&s.length===0)return e.jsx(_s,{});if(C.length===0)return e.jsx(Ss,{message:x});const k=g&&W!==null;return(k?W:C).map((F,A)=>Y(F,A,k))},os=()=>{if(r&&s.length===0)return e.jsx(_s,{});if(G.length===0)return e.jsx(Ss,{message:x});const k=g&&W!==null,_=T.getVirtualItems();return e.jsx("div",{style:{height:`${T.getTotalSize()}px`,width:"100%",position:"relative"},children:_.map(F=>{const A=G[F.index];return e.jsx("div",{"data-index":F.index,ref:T.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${F.start}px)`},children:Y(A,F.index,k)},F.key)})})};return e.jsxs("div",{className:H("flex flex-col",j),onMouseLeave:Ve,children:[q?e.jsx("div",{ref:$,className:"divide-y divide-edge-subtle overflow-auto",style:{maxHeight:hn},children:os()}):e.jsx("div",{className:"divide-y divide-edge-subtle py-1",children:re()}),c&&D>1&&e.jsx("nav",{className:"border-t border-edge-subtle px-4 py-3",children:e.jsxs(Zt,{className:"justify-center",children:[e.jsx(Jt,{onClick:()=>te(R-1),disabled:R===1}),e.jsx(sa,{children:J.map((k,_)=>k==="gap"?e.jsx(aa,{},`gap-${_}`):e.jsx(ta,{page:k,current:k===R,onClick:te},k))}),e.jsx(ea,{onClick:()=>te(R+1),disabled:R===D})]})}),e.jsx(kn,{showPagination:c,currentPage:R,perPage:i,displayCount:W?W.length:C.length,totalCount:c?E:s.length,action:N}),!o&&b&&e.jsx(nn,{packets:b.packets,initialIndex:b.initialIndex,onClose:()=>f(null),onNavigatePrev:is,onNavigateNext:Te,hasPrev:cs,hasNext:Pe,resolveSource:u}),p&&e.jsx(cn,{report:p,onClose:()=>B(null),onViewPacket:K})]})}export{Qs as C,$n as P,ia as g,zn as u};
