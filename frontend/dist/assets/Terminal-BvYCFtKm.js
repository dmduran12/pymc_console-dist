import{a1 as e,e as a,a2 as t,a3 as r,a4 as s,a5 as n,a6 as o,$ as i,j as l,a7 as c}from"./index-CSdhf7Y1.js";import{b as m,c as d}from"./recharts-CGff6_7g.js";import{P as p,a as y,C as u}from"./PageLayout-BRt4BPq0.js";import"./maplibre-gl-DsiI67my.js";const g=e(e=>({entries:[],commandHistory:[],isInitialized:!1,addEntry:a=>{const t="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const a=16*Math.random()|0;return("x"===e?a:3&a|8).toString(16)}),r={...a,id:t,timestamp:Date.now()};return e(e=>({entries:[...e.entries,r]})),t},updateEntry:(a,t)=>{e(e=>({entries:e.entries.map(e=>e.id===a?{...e,...t}:e)}))},addCommand:a=>{e(e=>({commandHistory:[...e.commandHistory,a]}))},clearEntries:()=>{e({entries:[],commandHistory:[]})},setInitialized:a=>{e({isInitialized:a})}})),f=new Set(["start ota","erase","reboot"]),v=["gps","sensor"],h=[{cmd:"help",desc:"Show available commands"},{cmd:"clear",desc:"Clear terminal screen"},{cmd:"status",desc:"Get repeater status summary"},{cmd:"uptime",desc:"Show system uptime"},{cmd:"packets",desc:"Show packet statistics"},{cmd:"board",desc:"Show board/platform info"},...[{name:"get adc.multiplier",category:"get",params:[],description:"Get ADC multiplier for battery",serialOnly:!1,hasParam:!1},{name:"get advert.interval",category:"get",params:[],description:"Get local advert interval (minutes)",serialOnly:!1,hasParam:!1},{name:"get af",category:"get",params:[],description:"Get airtime factor",serialOnly:!1,hasParam:!1},{name:"get agc.reset.interval",category:"get",params:[],description:"Get AGC reset interval (seconds)",serialOnly:!1,hasParam:!1},{name:"get allow.read.only",category:"get",params:[],description:"Get read-only access setting",serialOnly:!1,hasParam:!1},{name:"get bridge.baud",category:"get",params:[],description:"Get bridge baud rate",serialOnly:!1,hasParam:!1},{name:"get bridge.channel",category:"get",params:[],description:"Get bridge channel (ESP-NOW)",serialOnly:!1,hasParam:!1},{name:"get bridge.delay",category:"get",params:[],description:"Get bridge delay (ms)",serialOnly:!1,hasParam:!1},{name:"get bridge.enabled",category:"get",params:[],description:"Get bridge enabled status",serialOnly:!1,hasParam:!1},{name:"get bridge.secret",category:"get",params:[],description:"Get bridge encryption secret",serialOnly:!1,hasParam:!1},{name:"get bridge.source",category:"get",params:[],description:"Get bridge packet source",serialOnly:!1,hasParam:!1},{name:"get bridge.type",category:"get",params:[],description:"Get bridge type (rs232/espnow/none)",serialOnly:!1,hasParam:!1},{name:"get direct.txdelay",category:"get",params:[],description:"Get direct TX delay factor",serialOnly:!1,hasParam:!1},{name:"get flood.advert.interval",category:"get",params:[],description:"Get flood advert interval (hours)",serialOnly:!1,hasParam:!1},{name:"get flood.max",category:"get",params:[],description:"Get max flood hops",serialOnly:!1,hasParam:!1},{name:"get freq",category:"get",params:[],description:"Get frequency (MHz)",serialOnly:!1,hasParam:!1},{name:"get guest.password",category:"get",params:[],description:"Get guest password",serialOnly:!1,hasParam:!1},{name:"get int.thresh",category:"get",params:[],description:"Get interference threshold",serialOnly:!1,hasParam:!1},{name:"get lat",category:"get",params:[],description:"Get latitude",serialOnly:!1,hasParam:!1},{name:"get lon",category:"get",params:[],description:"Get longitude",serialOnly:!1,hasParam:!1},{name:"get multi.acks",category:"get",params:[],description:"Get multi-ack setting",serialOnly:!1,hasParam:!1},{name:"get name",category:"get",params:[],description:"Get node name",serialOnly:!1,hasParam:!1},{name:"get prv.key",category:"get",params:[],description:"Get private key (hex)",serialOnly:!1,hasParam:!1},{name:"get public.key",category:"get",params:[],description:"Get public key (hex)",serialOnly:!1,hasParam:!1},{name:"get radio",category:"get",params:[],description:"Get radio params (freq,bw,sf,cr)",serialOnly:!1,hasParam:!1},{name:"get repeat",category:"get",params:[],description:"Get repeat/forward status (on/off)",serialOnly:!1,hasParam:!1},{name:"get role",category:"get",params:[],description:"Get device role",serialOnly:!1,hasParam:!1},{name:"get rxdelay",category:"get",params:[],description:"Get RX delay base",serialOnly:!1,hasParam:!1},{name:"get tx",category:"get",params:[],description:"Get TX power (dBm)",serialOnly:!1,hasParam:!1},{name:"get txdelay",category:"get",params:[],description:"Get TX delay factor",serialOnly:!1,hasParam:!1},{name:"gps",category:"gps",params:[],description:"Show GPS status",serialOnly:!1,hasParam:!1},{name:"gps advert",category:"gps",params:[],description:"Get/set GPS advert location policy",serialOnly:!1,hasParam:!0},{name:"gps off",category:"gps",params:[],description:"Disable GPS",serialOnly:!1,hasParam:!0},{name:"gps on",category:"gps",params:[],description:"Enable GPS",serialOnly:!1,hasParam:!0},{name:"gps setloc",category:"gps",params:[],description:"Set node location from GPS",serialOnly:!1,hasParam:!0},{name:"gps sync",category:"gps",params:[],description:"Sync time from GPS",serialOnly:!1,hasParam:!0},{name:"log",category:"logging",params:[],description:"Dump log file (serial only)",serialOnly:!0,hasParam:!1},{name:"log erase",category:"logging",params:[],description:"Erase log file",serialOnly:!1,hasParam:!0},{name:"log start",category:"logging",params:[],description:"Start packet logging",serialOnly:!1,hasParam:!0},{name:"log stop",category:"logging",params:[],description:"Stop packet logging",serialOnly:!1,hasParam:!0},{name:"neighbor.remove",category:"neighbor",params:[],description:"Remove neighbor by pubkey",serialOnly:!1,hasParam:!0},{name:"neighbors",category:"neighbor",params:[],description:"List neighbors",serialOnly:!1,hasParam:!1},{name:"get",category:"other",params:[],description:"Execute get command",serialOnly:!1,hasParam:!0},{name:"set",category:"other",params:[{name:"value",type:"float"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Execute set command",serialOnly:!1,hasParam:!0},{name:"tempradio",category:"radio",params:[{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Apply temporary radio params (freq bw sf cr timeout_mins)",serialOnly:!1,hasParam:!0},{name:"sensor get",category:"sensor",params:[],description:"Get sensor/custom variable value",serialOnly:!1,hasParam:!0},{name:"sensor list",category:"sensor",params:[{name:"value",type:"int"}],description:"List all sensor/custom variables",serialOnly:!1,hasParam:!0},{name:"sensor set",category:"sensor",params:[],description:"Set sensor/custom variable value",serialOnly:!1,hasParam:!0},{name:"set adc.multiplier",category:"set",params:[{name:"value",type:"float"}],description:"Set ADC multiplier",serialOnly:!1,hasParam:!0},{name:"set advert.interval",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"string"}],description:"Set local advert interval (1-10080 min, 0=off)",serialOnly:!1,hasParam:!0},{name:"set af",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set airtime factor (0-9)",serialOnly:!1,hasParam:!0},{name:"set agc.reset.interval",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set AGC reset interval (seconds, rounded to 4)",serialOnly:!1,hasParam:!0},{name:"set allow.read.only",category:"set",params:[{name:"value",type:"int"}],description:"Set read-only access (on/off)",serialOnly:!1,hasParam:!0},{name:"set bridge.baud",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set bridge baud (9600-115200)",serialOnly:!1,hasParam:!0},{name:"set bridge.channel",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"string"}],description:"Set bridge channel (1-14)",serialOnly:!1,hasParam:!0},{name:"set bridge.delay",category:"set",params:[{name:"value",type:"int"}],description:"Set bridge delay (0-10000 ms)",serialOnly:!1,hasParam:!0},{name:"set bridge.enabled",category:"set",params:[{name:"value",type:"int"}],description:"Enable/disable bridge",serialOnly:!1,hasParam:!0},{name:"set bridge.secret",category:"set",params:[{name:"value",type:"string"},{name:"value",type:"float"}],description:"Set bridge encryption secret",serialOnly:!1,hasParam:!0},{name:"set bridge.source",category:"set",params:[{name:"value",type:"int"}],description:"Set bridge source (rx/tx)",serialOnly:!1,hasParam:!0},{name:"set direct.txdelay",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"}],description:"Set direct TX delay factor",serialOnly:!1,hasParam:!0},{name:"set flood.advert.interval",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set flood advert interval (3-48 hours, 0=off)",serialOnly:!1,hasParam:!0},{name:"set flood.max",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"float"}],description:"Set max flood hops (0-64)",serialOnly:!1,hasParam:!0},{name:"set freq",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"}],description:"Set frequency MHz (serial only, reboot required)",serialOnly:!0,hasParam:!0},{name:"set guest.password",category:"set",params:[{name:"value",type:"string"}],description:"Set guest password",serialOnly:!1,hasParam:!0},{name:"set int.thresh",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set interference threshold",serialOnly:!1,hasParam:!0},{name:"set lat",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"float"},{name:"value",type:"float"}],description:"Set latitude",serialOnly:!1,hasParam:!0},{name:"set lon",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"float"},{name:"value",type:"float"}],description:"Set longitude",serialOnly:!1,hasParam:!0},{name:"set multi.acks",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set multi-ack (0/1)",serialOnly:!1,hasParam:!0},{name:"set name",category:"set",params:[{name:"value",type:"string"},{name:"value",type:"int"}],description:"Set node name",serialOnly:!1,hasParam:!0},{name:"set prv.key",category:"set",params:[{name:"value",type:"string"}],description:"Set private key (hex, restart required)",serialOnly:!1,hasParam:!0},{name:"set radio",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set radio params (freq bw sf cr)",serialOnly:!1,hasParam:!0},{name:"set repeat",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set repeat/forward (on/off)",serialOnly:!1,hasParam:!0},{name:"set rxdelay",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"float"}],description:"Set RX delay base",serialOnly:!1,hasParam:!0},{name:"set tx",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"float"}],description:"Set TX power (dBm)",serialOnly:!1,hasParam:!0},{name:"set txdelay",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"}],description:"Set TX delay factor",serialOnly:!1,hasParam:!0},{name:"stats-core",category:"stats",params:[],description:"Show core statistics (serial only)",serialOnly:!0,hasParam:!1},{name:"stats-packets",category:"stats",params:[],description:"Show packet statistics (serial only)",serialOnly:!0,hasParam:!1},{name:"stats-radio",category:"stats",params:[],description:"Show radio statistics (serial only)",serialOnly:!0,hasParam:!1},{name:"advert",category:"system",params:[],description:"Send self advertisement",serialOnly:!1,hasParam:!1},{name:"board",category:"system",params:[],description:"Show board/manufacturer name",serialOnly:!1,hasParam:!1},{name:"clear stats",category:"system",params:[],description:"Reset statistics counters",serialOnly:!1,hasParam:!0},{name:"clock",category:"system",params:[{name:"value",type:"int"}],description:"Display current time",serialOnly:!1,hasParam:!0},{name:"clock sync",category:"system",params:[],description:"Sync clock from sender timestamp",serialOnly:!1,hasParam:!0},{name:"password",category:"system",params:[{name:"value",type:"string"}],description:"Change admin password",serialOnly:!1,hasParam:!0},{name:"reboot",category:"system",params:[],description:"Reboot the device",serialOnly:!1,hasParam:!1},{name:"start ota",category:"system",params:[{name:"value",type:"int"}],description:"Start OTA firmware update",serialOnly:!1,hasParam:!0},{name:"time",category:"system",params:[{name:"value",type:"int"}],description:"Set time to epoch seconds",serialOnly:!1,hasParam:!0},{name:"ver",category:"system",params:[],description:"Show firmware version and build date",serialOnly:!1,hasParam:!1}].filter(e=>!e.serialOnly&&!f.has(e.name)&&!v.some(a=>e.name.startsWith(a))).map(e=>({cmd:e.name,desc:e.description,params:e.hasParam?"{value}":void 0,required:e.hasParam}))],b={"set mode":["forward","monitor"],"set duty":["on","off"],"set repeat":["on","off"],"set tx":["10","14","17","20","22"],"set sf":["7","8","9","10","11","12"],"set bw":["125","250","500"],"set af":["0.5","1.0","1.5","2.0"],"set txdelay":["0.5","0.7","1.0","1.5"],"set direct.txdelay":["0.3","0.5","0.7"],"set log":["debug","info","warning"]};function x(e){switch(e){case"success":return"text-accent-success";case"error":return"text-accent-danger";case"warning":return"text-amber-400";case"info":return"text-accent-tertiary";case"value":return"text-accent-primary";case"system":return"text-text-muted";default:return"text-text-secondary"}}const O=m.memo(function({entry:e}){return"command"===e.type?l.jsxs("div",{className:"flex items-center gap-2 py-1",children:[l.jsx("span",{className:"text-text-muted font-medium select-none",children:"$"}),l.jsx("span",{className:"text-text-primary font-semibold",children:e.content})]}):"system"===e.type?l.jsx("div",{className:d("py-0.5",x(e.outputType||"system")),children:e.content}):e.content.includes("██")?l.jsx("pre",{className:d("font-mono text-[10px] sm:text-[11px] leading-none py-2 whitespace-pre overflow-x-auto",x(e.outputType||"value")),children:e.content}):l.jsx("div",{className:"ml-4 font-mono text-[13px] py-1",children:e.content.split("\n").map((a,t)=>{const r=function(e,a){if(e.startsWith("HELP_HEADER:::"))return[{text:e.slice(14),color:"text-text-primary font-bold"}];if(e.startsWith("HELP_NOTE:::"))return[{text:e.slice(12),color:"text-text-muted italic"}];const t=e.match(/^([a-z][a-z0-9.]*(?:\s+[a-z][a-z0-9.]*)?):::(.+)$/);if(t){const[,e,a]=t,r=e.split(" "),s=r[0];let n="text-accent-tertiary";"get"===s?n="text-accent-success":"set"===s&&(n="text-amber-400");const o=[{text:`  ${s}`,color:`${n} font-semibold`}];r.length>1&&o.push({text:` ${r.slice(1).join(" ")}`,color:"text-accent-primary"});const i=" ".repeat(Math.max(1,22-e.length));return o.push({text:`${i}${a}`,color:"text-text-muted"}),o}if("error"===a||"warning"===a)return[{text:e,color:x(a)}];if("value"===a)return[{text:e,color:x("value")}];const r=e.match(/^([\w\s.]+):\s*(.+)$/);if(r){const[,e,a]=r;return[{text:`${e}: `,color:"text-text-muted"},{text:a,color:"text-accent-primary font-semibold"}]}return e.startsWith("OK")?[{text:e,color:x("success")}]:[{text:e,color:x(a)}]}(a,e.outputType||"default");return l.jsx("div",{className:"leading-relaxed",children:r.map((e,a)=>l.jsx("span",{className:e.color,children:e.text},a))},t)})})});function P(){const e=a(),f=g(e=>e.entries),v=g(e=>e.commandHistory),x=g(e=>e.isInitialized),{addEntry:P,updateEntry:w,addCommand:$,clearEntries:S,setInitialized:k}=g(),[N,E]=m.useState(""),[G,T]=m.useState(-1),[C,F]=m.useState(!1),[_,A]=m.useState([]),[K,M]=m.useState(0),[H,R]=m.useState(0),[z,L]=m.useState(!1),X=m.useRef(null),D=m.useRef(null),I=m.useRef(null);m.useEffect(()=>{x||(async()=>{P({type:"output",content:"██████  ██    ██ ███    ███  ██████         ████████ ███████ ██████  ███    ███ ██ ███    ██  █████  ██      \n██   ██  ██  ██  ████  ████ ██                 ██    ██      ██   ██ ████  ████ ██ ████   ██ ██   ██ ██      \n██████    ████   ██ ████ ██ ██                 ██    █████   ██████  ██ ████ ██ ██ ██ ██  ██ ███████ ██      \n██         ██    ██  ██  ██ ██                 ██    ██      ██   ██ ██  ██  ██ ██ ██  ██ ██ ██   ██ ██      \n██         ██    ██      ██  ██████ ███████    ██    ███████ ██   ██ ██      ██ ██ ██   ████ ██   ██ ███████",outputType:"value"}),await new Promise(e=>setTimeout(e,200));const e=P({type:"system",content:"● Initializing terminal...",outputType:"system"});await new Promise(e=>setTimeout(e,400)),w(e,{content:"✓ Initializing terminal...",outputType:"success"});const a=P({type:"system",content:"● Connecting to repeater...",outputType:"system"});await new Promise(e=>setTimeout(e,600)),w(a,{content:"✓ Connected to repeater",outputType:"success"}),P({type:"system",content:"Ready. Type 'help' for commands.",outputType:"system"}),k(!0)})()},[x,P,w,k]),m.useEffect(()=>{D.current&&(D.current.scrollTop=D.current.scrollHeight)},[f]);const q=m.useCallback(()=>{var e;null==(e=X.current)||e.focus()},[]),j=m.useCallback(e=>{const a=e.trim().toLowerCase();if(!a)return F(!1),void A([]);const t=h.filter(e=>e.cmd.toLowerCase().startsWith(a));if(t.length>0)return A(t),M(0),void F(!0);if(a.includes(" ")){const e=a.lastIndexOf(" "),t=a.substring(0,e),r=a.substring(e+1),s=h.find(e=>e.cmd.toLowerCase()===t);if(s&&b[s.cmd]){const e=b[s.cmd].filter(e=>e.toLowerCase().startsWith(r)).map(e=>({cmd:`${s.cmd} ${e}`,desc:`→ ${e}`}));if(e.length>0)return A(e),M(0),void F(!0)}}F(!1),A([])},[]),U=m.useCallback(e=>{var a;const t=_[e];t&&(t.required&&t.params?(E(t.cmd+" "),j(t.cmd+" ")):(E(t.cmd),F(!1)),null==(a=X.current)||a.focus())},[_,j]),B=m.useCallback(async e=>{var a,l,c,m,d,p,y,u;const g=e.trim();if(!g)return;const f=g.toLowerCase();if($(g),P({type:"command",content:g}),"clear"===f)return void S();if("help"===f){const e=h.map(e=>`${e.cmd}:::${e.desc}`).join("\n");return void P({type:"output",content:`HELP_HEADER:::Available commands\n${e}\nHELP_NOTE:::Some MeshCore commands not available via HTTP.`,outputType:"default"})}const v=P({type:"output",content:"processing...",outputType:"system"});try{const e=await t();let h="",b="info";const x=e=>{const a=Math.floor(e/86400),t=Math.floor(e%86400/3600),r=Math.floor(e%3600/60);return a>0?`${a}d ${t}h ${r}m`:t>0?`${t}h ${r}m`:`${r}m`};if("status"===f){h=`Mode: ${(null==(l=null==(a=e.config)?void 0:a.repeater)?void 0:l.mode)||"unknown"} | Neighbors: ${Object.keys(e.neighbors||{}).length} | Uptime: ${x(e.uptime_seconds||0)}`}else if("uptime"===f)h=x(e.uptime_seconds||0),b="value";else if("packets"===f)h=`rx: ${e.rx_count??0}\ntx: ${e.tx_count??0}\nfwd: ${e.forwarded_count??0}\ndrop: ${e.dropped_count??0}`;else if("neighbors"===f){const a=e.neighbors||{},t=Object.entries(a);if(0===t.length)h="No neighbors discovered yet.",b="warning";else{const e=t.map(([e,a])=>{const t=a.name||a.node_name||"Unknown";return`  ${e.slice(0,8)}  ${t}`});h=`Neighbors (${t.length}):\n${e.join("\n")}`}}else if("board"===f)h="pyMC_Repeater (Linux/RPi)",b="value";else if(f.startsWith("get ")){const a=f.slice(4).trim(),t=null==(c=e.config)?void 0:c.delays,r=null==(m=e.config)?void 0:m.radio,s=null==(d=e.config)?void 0:d.repeater,n=null==(p=e.config)?void 0:p.duty_cycle;switch(a){case"name":h=(null==(y=e.config)?void 0:y.node_name)||"Unknown";break;case"role":h="repeater";break;case"lat":h=null!=(null==s?void 0:s.latitude)?String(s.latitude):"not set";break;case"lon":h=null!=(null==s?void 0:s.longitude)?String(s.longitude):"not set";break;case"freq":h=(null==r?void 0:r.frequency)?(r.frequency/1e6).toFixed(3):"?";break;case"tx":h=String((null==r?void 0:r.tx_power)??"?");break;case"bw":h=(null==r?void 0:r.bandwidth)?String(r.bandwidth/1e3):"?";break;case"sf":h=String((null==r?void 0:r.spreading_factor)??"?");break;case"cr":h=String((null==r?void 0:r.coding_rate)??"?");break;case"radio":h=r?`freq: ${(r.frequency/1e6).toFixed(3)} MHz\nbw: ${r.bandwidth/1e3} kHz\nsf: ${r.spreading_factor}\ncr: 4/${r.coding_rate}`:"?";break;case"af":case"txdelay":h=String((null==t?void 0:t.tx_delay_factor)??"1.0");break;case"direct.txdelay":h=String((null==t?void 0:t.direct_tx_delay_factor)??"0.5");break;case"mode":h=(null==s?void 0:s.mode)||"forward";break;case"repeat":h="forward"===(null==s?void 0:s.mode)?"on":"off";break;case"flood.max":h=String((null==s?void 0:s.max_flood_hops)??"3");break;case"flood.advert.interval":h=null!=(null==s?void 0:s.send_advert_interval_hours)?`${s.send_advert_interval_hours}h`:"?";break;case"advert.interval":h=null!=(null==s?void 0:s.advert_interval_minutes)?`${s.advert_interval_minutes}m`:"120m";break;case"rxdelay":h=String((null==t?void 0:t.rx_delay_base)??"0.0");break;case"duty":case"duty.enabled":h=(null==n?void 0:n.enforcement_enabled)?"on":"off";break;case"duty.max":h=null!=(null==n?void 0:n.max_airtime_percent)?`${n.max_airtime_percent}%`:"?";break;case"public.key":h=e.public_key||"not available";break;case"prv.key":h="Private key not available via stats API.\nRun: sudo ./manage.sh upgrade to apply PATCH 6",b="warning";break;case"guest.password":case"allow.read.only":h="Security settings not exposed via stats API.\nCheck /etc/pymc_repeater/config.yaml",b="warning";break;default:h=`Unknown parameter: ${a}\nAvailable: name, role, lat, lon, freq, tx, bw, sf, cr, radio, af, txdelay, direct.txdelay, rxdelay, mode, repeat, flood.max, advert.interval, duty, public.key`,b="error"}"error"!==b&&(b="value")}else if("advert"===f){const e=await r();h=e.success?"OK - Advert sent":`Error: ${e.error||"Failed"}`,b=e.success?"success":"error"}else if(f.startsWith("set mode ")){const e=f.split(" ")[2];if("forward"!==e&&"monitor"!==e)h='Error: Mode must be "forward" or "monitor"',b="error";else{const a=await s(e);h=a.success?`OK - Mode set to ${e}`:"Error: Failed",b=a.success?"success":"error"}}else if(f.startsWith("set duty ")){const e=f.split(" ")[2],a="on"===e||"1"===e,t=await n(a);h=t.success?"OK - Duty cycle "+(a?"enabled":"disabled"):"Error: Failed",b=t.success?"success":"error"}else if(f.startsWith("set tx ")){const e=parseInt(f.split(" ")[2]);if(isNaN(e)||e<2||e>30)h="Error: TX power must be 2-30 dBm",b="error";else{const a=await o({tx_power:e});h=a.success?`OK - TX power set to ${e}dBm`:`Error: ${a.error||"Failed"}`,b=a.success?"success":"error"}}else if(f.startsWith("set af ")||f.startsWith("set txdelay ")){const e=parseFloat(f.split(" ")[2]);if(isNaN(e)||e<0||e>5)h="Error: TX delay factor must be 0.0-5.0",b="error";else{const a=await o({tx_delay_factor:e});h=a.success?`OK - TX delay set to ${e}`:`Error: ${a.error||"Failed"}`,b=a.success?"success":"error"}}else if(f.startsWith("set direct.txdelay ")){const e=parseFloat(f.split(" ")[2]);if(isNaN(e)||e<0||e>5)h="Error: Direct TX delay must be 0.0-5.0",b="error";else{const a=await o({direct_tx_delay_factor:e});h=a.success?`OK - Direct TX delay set to ${e}`:`Error: ${a.error||"Failed"}`,b=a.success?"success":"error"}}else if(f.startsWith("set log ")){const e=null==(u=f.split(" ")[2])?void 0:u.toUpperCase();if(["DEBUG","INFO","WARNING","ERROR"].includes(e)){const a=await i(e);h=a.success?`OK - Log level set to ${e}`:`Error: ${a.error||"Failed"}`,b=a.success?"success":"error"}else h="Error: Level must be debug, info, warning, or error",b="error"}else if(f.startsWith("set rxdelay ")){const e=parseFloat(f.split(" ")[2]);if(isNaN(e)||e<0)h="Error: RX delay must be >= 0",b="error";else{const a=await o({rx_delay_base:e});h=a.success?`OK - RX delay base set to ${e}s`:`Error: ${a.error||"Failed"}`,b=a.success?"success":"error"}}else if(f.startsWith("set name ")){const e=g.substring(9).trim();if(e){const a=await o({node_name:e});h=a.success?`OK - Node name set to "${e}"`:`Error: ${a.error||"Failed"}`,b=a.success?"success":"error"}else h="Error: Node name cannot be empty",b="error"}else if(f.startsWith("set lat ")){const e=parseFloat(f.split(" ")[2]);if(isNaN(e)||e<-90||e>90)h="Error: Latitude must be -90 to 90",b="error";else{const a=await o({latitude:e});h=a.success?`OK - Latitude set to ${e}°`:`Error: ${a.error||"Failed"}`,b=a.success?"success":"error"}}else if(f.startsWith("set lon ")){const e=parseFloat(f.split(" ")[2]);if(isNaN(e)||e<-180||e>180)h="Error: Longitude must be -180 to 180",b="error";else{const a=await o({longitude:e});h=a.success?`OK - Longitude set to ${e}°`:`Error: ${a.error||"Failed"}`,b=a.success?"success":"error"}}else if(f.startsWith("set flood.max ")){const e=parseInt(f.split(" ")[2]);if(isNaN(e)||e<0||e>64)h="Error: Max flood hops must be 0-64",b="error";else{const a=await o({max_flood_hops:e});h=a.success?`OK - Max flood hops set to ${e}`:`Error: ${a.error||"Failed"}`,b=a.success?"success":"error"}}else if(f.startsWith("set flood.advert.interval ")){const e=parseInt(f.split(" ")[2]);if(isNaN(e)||0!==e&&(e<3||e>48))h="Error: Flood advert interval must be 0 (off) or 3-48 hours",b="error";else{const a=await o({flood_advert_interval_hours:e});h=a.success?0===e?"OK - Flood adverts disabled":`OK - Flood advert interval set to ${e}h`:`Error: ${a.error||"Failed"}`,b=a.success?"success":"error"}}else if(f.startsWith("set advert.interval ")){const e=parseInt(f.split(" ")[2]);if(isNaN(e)||0!==e&&(e<1||e>10080))h="Error: Advert interval must be 0 (off) or 1-10080 minutes",b="error";else{const a=await o({advert_interval_minutes:e});h=a.success?0===e?"OK - Local adverts disabled":`OK - Local advert interval set to ${e}m`:`Error: ${a.error||"Failed"}`,b=a.success?"success":"error"}}else h=`Unknown command: ${g}\nType 'help' for available commands.`,b="error";w(v,{content:h,outputType:b})}catch(b){w(v,{content:`Error: ${b instanceof Error?b.message:"Command failed"}`,outputType:"error"})}},[P,$,w,S]),W=m.useCallback(e=>{var a,t,r,s,n,o;if(C&&_.length>0){if("ArrowDown"===e.key){e.preventDefault();const s=Math.min(K+1,_.length-1);return M(s),void(null==(r=null==(t=null==(a=I.current)?void 0:a.children[0])?void 0:t.children[s])||r.scrollIntoView({block:"nearest"}))}if("ArrowUp"===e.key){e.preventDefault();const a=Math.max(K-1,0);return M(a),void(null==(o=null==(n=null==(s=I.current)?void 0:s.children[0])?void 0:n.children[a])||o.scrollIntoView({block:"nearest"}))}if("Tab"===e.key)return e.preventDefault(),void U(K);if("Escape"===e.key)return e.preventDefault(),void F(!1)}if("Enter"===e.key){e.preventDefault();const a=N;return E(""),T(-1),F(!1),void B(a)}if("ArrowUp"!==e.key||C)if("ArrowDown"!==e.key||C);else if(e.preventDefault(),G>0){const e=G-1;T(e),E(v[v.length-1-e]||"")}else 0===G&&(T(-1),E(""));else if(e.preventDefault(),v.length>0&&G<v.length-1){const e=G+1;T(e),E(v[v.length-1-e]||"")}},[C,_,K,U,N,v,G,B]),J=m.useCallback(e=>{E(e.target.value),R(e.target.selectionStart||e.target.value.length),j(e.target.value)},[j]),Q=m.useCallback(e=>{const a=e.target;R(a.selectionStart||0)},[]);return l.jsxs(p,{children:[l.jsx(y,{title:"Terminal",icon:l.jsx(c,{})}),l.jsxs(u,{noPadding:!0,className:"overflow-hidden flex flex-col",style:{height:"calc(100vh - 180px)",minHeight:"400px"},onClick:q,children:[l.jsx("div",{ref:D,className:"flex-1 overflow-y-auto font-mono text-sm bg-black/40 p-4 sm:p-5",children:f.map(e=>l.jsx(O,{entry:e},e.id))}),l.jsxs("div",{className:"relative border-t border-white/10 bg-black/50",children:[C&&_.length>0&&l.jsxs("div",{ref:I,className:"absolute left-0 right-0 bottom-full bg-bg-elevated border-t border-x border-border-subtle rounded-t-lg shadow-2xl overflow-hidden z-10 mx-2",children:[l.jsx("div",{className:"max-h-64 overflow-y-auto",children:_.map((e,a)=>l.jsxs("div",{onClick:()=>U(a),className:d("px-4 py-2 cursor-pointer border-b border-border-subtle/50 last:border-b-0",a===K?"bg-accent-primary/20":"hover:bg-white/5"),children:[l.jsx("span",{className:d("font-mono text-sm",a===K?"text-accent-primary":"text-text-primary"),children:e.cmd}),l.jsx("span",{className:"text-xs text-text-muted ml-4",children:e.desc})]},e.cmd))}),l.jsx("div",{className:"px-3 py-1 bg-bg-subtle border-t border-border-subtle text-[10px] text-text-muted text-right",children:"Tab to select"})]}),l.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[l.jsx("span",{className:"text-text-muted font-mono font-bold select-none",children:"$"}),l.jsxs("div",{className:"flex-1 relative font-mono text-sm",children:[l.jsx("input",{ref:X,type:"text",value:N,onChange:J,onKeyDown:W,onSelect:Q,onFocus:()=>L(!0),onBlur:()=>L(!1),disabled:!x,className:"absolute inset-0 w-full bg-transparent text-transparent outline-none disabled:opacity-50 selection:bg-transparent",style:{caretColor:"transparent"},autoFocus:!0,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1}),l.jsx("div",{className:"relative pointer-events-none select-none","aria-hidden":!0,children:x?l.jsxs(l.Fragment,{children:[l.jsx("span",{className:"text-text-primary",children:N.slice(0,H)}),l.jsx("span",{className:d("inline-block w-[0.6em] h-[1.2em] align-text-bottom",z?"bg-accent-primary":"bg-text-muted/30"),style:{marginBottom:"-0.1em"},children:l.jsx("span",{className:"text-bg-primary",children:N[H]||""})}),l.jsx("span",{className:"text-text-primary",children:N.slice(H+1)})]}):l.jsx("span",{className:"text-text-muted",children:"Connecting..."})})]})]}),l.jsxs("div",{className:"px-4 py-1 border-t border-white/5 bg-black/30 flex justify-between text-[10px] text-text-muted",children:[l.jsx("span",{children:"↑↓ History"}),(null==e?void 0:e.version)&&l.jsxs("span",{children:["pyMC v",e.version]})]})]})]})]})}export{P as default};
