import{r as e,j as t,c as s}from"./vendor-react-BKIq8k5U.js";import{c as a,c6 as r,c7 as n,c8 as l,c9 as c,ca as i,X as o,av as d,cb as u,cc as m,cd as x,I as p,ce as h,R as b,bk as y}from"./index-DUGAIAKU.js";import{T as g,P as f,C as j}from"./ConfirmModal-DrQJ2wZe.js";import{l as v}from"./font-loader-jlbdh9Fw.js";import{N}from"./NodeInformationCard-B3bXjrtL.js";import{a as w,P as k,b as C,B as S}from"./PageLayout-DcfPDfxI.js";import{C as _}from"./Card-fWoRgW47.js";import{L as T}from"./loader-circle-CgFLhctW.js";import{C as F,a as E}from"./DataBox-CYNXf4xM.js";import{I as L}from"./info-beeQ-0OK.js";import{R as M,C as P}from"./Grid-BkE6UU8f.js";import{C as R}from"./circle-check-BjQA9SiP.js";import{T as z}from"./triangle-alert-DZkOV69M.js";import{R as D}from"./refresh-cw-BHGuymtM.js";import{C as I}from"./chevron-right--k7aBfLM.js";import"./deckgl-DTsmDcfs.js";import"./vendor-core-D1aqi_5O.js";const A=a("antenna",[["path",{d:"M2 12 7 2",key:"117k30"}],["path",{d:"m7 12 5-10",key:"1tvx22"}],["path",{d:"m12 12 5-10",key:"ev1o1a"}],["path",{d:"m17 12 5-10",key:"1e4ti3"}],["path",{d:"M4.5 7h15",key:"vlsxkz"}],["path",{d:"M12 16v6",key:"c8a4gj"}]]),O=a("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),q=a("folder-key",[["circle",{cx:"16",cy:"20",r:"2",key:"1vifvg"}],["path",{d:"M10 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v2",key:"3hgo9p"}],["path",{d:"m22 14-4.5 4.5",key:"1ef6z8"}],["path",{d:"m21 15 1 1",key:"1ejcpy"}]]),K=a("folder-lock",[["rect",{width:"8",height:"5",x:"14",y:"17",rx:"1",key:"19aais"}],["path",{d:"M10 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v2.5",key:"1w6v7t"}],["path",{d:"M20 17v-2a2 2 0 1 0-4 0v2",key:"pwaxnr"}]]),H=a("key-round",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]),V=a("monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),$=a("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),Y=a("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),B=a("shield-x",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m14.5 9.5-5 5",key:"17q4r4"}],["path",{d:"m9.5 9.5 5 5",key:"18nt4w"}]]),U=a("triangle-dashed",[["path",{d:"M10.17 4.193a2 2 0 0 1 3.666.013",key:"pltmmw"}],["path",{d:"M14 21h2",key:"v4qezv"}],["path",{d:"m15.874 7.743 1 1.732",key:"10m0iw"}],["path",{d:"m18.849 12.952 1 1.732",key:"zadnam"}],["path",{d:"M21.824 18.18a2 2 0 0 1-1.835 2.824",key:"fvwuk4"}],["path",{d:"M4.024 21a2 2 0 0 1-1.839-2.839",key:"1e1kah"}],["path",{d:"m5.136 12.952-1 1.732",key:"1u4ldi"}],["path",{d:"M8 21h2",key:"i9zjee"}],["path",{d:"m8.102 7.743-1 1.732",key:"1zzo4u"}]]);async function X(e){return r("/api/update_web_config",{method:"POST",body:JSON.stringify(e)})}const J=e.memo(function(){const{theme:e}=n(),{colorScheme:s}=e,a=l.find(e=>e.colorScheme===s)??l[0],r=a.displaySize,c=`clamp(${.8*r}rem, ${.6*r}rem + 1.5vw, ${1.4*r}rem)`;return t.jsx("div",{className:"h-10 flex items-center justify-center",children:t.jsxs("span",{className:"font-medium transition-all duration-300 leading-none text-center",style:{fontFamily:a.displayFont,color:a.displayColor,fontSize:c,fontOpticalSizing:"auto",letterSpacing:"-0.03em"},children:["Theme: ",a.displayName]})})}),G=e.memo(function(){const{theme:a,setThemePreset:r,setBrightness:i}=n(),{colorScheme:o,brightness:d}=a,[u,m]=e.useState(!1),[x,p]=e.useState(!1),h=e.useRef(null),b=e.useRef(null),y=(l.find(e=>e.colorScheme===o)??l[0]).id,g=e.useCallback((e,t)=>{if(!b.current)return d;const s=(b.current.y-e)/(t?200:80)*100;return Math.round(Math.max(0,Math.min(100,b.current.brightness+s)))},[d]),f=e.useCallback(e=>{r(e),m(!0)},[r]),j=e.useCallback(e=>{i(e)},[i]),v=e.useCallback(e=>{const t=l.find(t=>t.id===e);t&&c(t.backgroundImage)},[]);return t.jsx("div",{className:"grid grid-cols-4 gap-[3%] w-full",children:l.map(e=>{const a=y===e.id,r=!e.backgroundImage,n=a&&!r&&(u||x);return t.jsxs("div",{ref:a?h:void 0,title:e.displayName,className:s("flex flex-col items-stretch rounded-sm transition-all duration-300 ease-out overflow-hidden",a?"ring-2 ring-accent-primary scale-105 "+(r?"cursor-pointer":"cursor-ns-resize"):"cursor-pointer"),onMouseEnter:()=>{a&&!r?m(!0):a||v(e.id)},onMouseLeave:()=>!x&&m(!1),onClick:()=>!a&&f(e.id),onTouchStart:e=>{if(!a||r)return;e.preventDefault();const t=e.touches[0];b.current={y:t.clientY,brightness:d},p(!0),m(!0);const s=e=>{e.preventDefault();const t=e.touches[0];j(g(t.clientY,!0))},n=()=>{document.removeEventListener("touchmove",s),document.removeEventListener("touchend",n),b.current=null,p(!1),setTimeout(()=>m(!1),1500)};document.addEventListener("touchmove",s,{passive:!1}),document.addEventListener("touchend",n)},onMouseDown:e=>{if(!a||r)return;e.preventDefault(),b.current={y:e.clientY,brightness:d},p(!0),m(!0);const t=e=>{j(g(e.clientY,!1))},s=()=>{document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",s),b.current=null,p(!1)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",s)},children:[t.jsxs("div",{className:"glass-thumbnail w-full aspect-square sm:aspect-[4/3] lg:aspect-video relative !rounded-b-none",children:["kde breeze"===e.id?t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-[#242627]",style:{opacity:n?.4:1},children:t.jsx("span",{className:"text-[#58b99d] text-[1.5em] font-bold font-mono",children:">"})}):"ribbon"===e.id?t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-[#F5F5F5]",style:{opacity:n?.4:1},children:t.jsx("span",{className:"text-[#2D2D2D] text-[1.5em] font-bold font-mono",children:"R"})}):t.jsx("div",{className:"absolute bg-cover bg-center transition-opacity duration-200",style:{inset:0,backgroundImage:`url(${e.backgroundImage})`,opacity:n?.4:1,filter:"brightness(var(--thumbnail-brightness, 1.5))"}}),a&&t.jsxs("div",{className:s("absolute inset-0 transition-opacity duration-200",n?"opacity-100":"opacity-0"),children:[t.jsx("div",{className:"absolute inset-x-0 bottom-0 bg-black/70 transition-all duration-100 ease-out",style:{height:100-d+"%"}}),t.jsx("div",{className:"absolute inset-x-[8%] h-0.5 bg-white rounded-full shadow-lg transition-all duration-100 ease-out",style:{top:100-d+"%"}}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsxs("span",{className:"text-[0.6em] font-mono font-bold text-white drop-shadow-lg",children:[d,"%"]})})]})]}),t.jsx("div",{className:"flex flex-col w-full",children:e.paletteColors.map((e,s)=>t.jsx("div",{className:"flex",children:e.map((e,s)=>t.jsx("div",{className:"flex-1 aspect-[2/1]",style:{backgroundColor:e}},s))},s))})]},e.id)})})}),W=e.memo(function({layout:s="horizontal"}){return e.useEffect(()=>{v()},[]),"logo-only"===s?t.jsx(J,{}):"thumbnails-only"===s?t.jsx(G,{}):t.jsxs("div",{className:"flex flex-col items-center gap-3",children:[t.jsx(J,{}),t.jsx(G,{})]})});function Q(){const{latitude:a,longitude:r,enabled:n,setLocation:l,enable:c,disable:d,clear:u}=i(),[m,x]=e.useState(!1),[p,h]=e.useState(""),[b,y]=e.useState(""),[f,j]=e.useState("idle"),[v,N]=e.useState(null),k=e.useRef(null),C=e.useRef(null),S=e.useRef(!0);e.useEffect(()=>(S.current=!0,()=>{S.current=!1,C.current&&clearTimeout(C.current)}),[]);const E=()=>{x(!1),N(null)};e.useEffect(()=>{if(!m)return;const e=e=>{"loading"!==f&&k.current&&!k.current.contains(e.target)&&E()};return document.addEventListener("mouseup",e),()=>document.removeEventListener("mouseup",e)},[m,f]);const M=null!==a&&null!==r;return t.jsx(w,{children:t.jsxs("div",{ref:k,children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx(_,{icon:t.jsx(U,{}),title:"Stealth",largeTitle:!0}),t.jsxs("div",{className:"flex items-center gap-1",children:[M&&!m&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>{n?d():c()},className:s("relative inline-flex h-6 w-11 items-center rounded-full transition-colors border-2 mr-2",n?"bg-toggle-on border-toggle-on":"bg-toggle-off border-border-subtle"),title:n?"Disable stealth location":"Enable stealth location",children:t.jsx("span",{className:s("inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-lg",n?"translate-x-5":"translate-x-0.5")})}),t.jsx("button",{onClick:()=>{u(),x(!1)},className:"p-2 rounded-lg transition-colors text-text-muted hover:text-accent-danger hover:bg-accent-danger/10",title:"Clear stealth location",children:t.jsx(g,{className:"w-4 h-4"})})]}),m?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:E,disabled:"loading"===f,className:s("p-2 rounded-lg transition-colors","loading"===f?"text-text-muted cursor-not-allowed":"text-text-muted hover:text-accent-danger hover:bg-accent-danger/10"),title:"Cancel",children:t.jsx(o,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>{if("loading"===f)return;C.current&&clearTimeout(C.current);const e=((e,t)=>{const s=parseFloat(e),a=parseFloat(t);return isNaN(s)||isNaN(a)?"Please enter valid numbers":s<-90||s>90?"Latitude must be between -90 and 90":a<-180||a>180?"Longitude must be between -180 and 180":0===s&&0===a?"Coordinates (0, 0) are invalid":null})(p,b);if(e)return void N(e);j("loading"),N(null);const t=parseFloat(p),s=parseFloat(b);l(t,s),n||c(),j("success"),C.current=setTimeout(()=>{S.current&&(j("idle"),x(!1))},1e3)},disabled:"loading"===f,className:s("p-2 rounded-lg transition-colors","loading"===f?"text-accent-primary cursor-wait":"success"===f?"text-accent-success":"error"===f?"text-accent-danger":"text-accent-success hover:bg-accent-success/10"),title:"Save",children:"loading"===f?t.jsx(T,{className:"w-4 h-4 animate-spin"}):"success"===f?t.jsx(F,{className:"w-4 h-4"}):"error"===f?t.jsx(o,{className:"w-4 h-4"}):t.jsx(F,{className:"w-4 h-4"})})]}):t.jsx("button",{onClick:()=>{h((null==a?void 0:a.toFixed(6))??""),y((null==r?void 0:r.toFixed(6))??""),N(null),x(!0)},className:"p-2 rounded-lg transition-colors text-text-muted hover:text-text-primary hover:bg-bg-subtle",title:M?"Edit stealth location":"Set stealth location",children:t.jsx($,{className:"w-4 h-4"})})]})]}),t.jsx("div",{className:"bg-accent-tertiary/5 rounded-xl p-3 mb-4",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx(L,{className:"w-4 h-4 text-accent-tertiary flex-shrink-0 mt-0.5"}),t.jsxs("p",{className:"type-body-sm text-text-muted",children:[t.jsx("span",{className:"text-text-secondary",children:"Stealth mode"})," allows you to appear on the map and in topology analysis without broadcasting your location. Coordinates are stored locally in your browser only — ",t.jsx("span",{className:"text-accent-tertiary",children:"never sent to config.yaml or the mesh"}),"."]})]})}),v&&t.jsx("div",{className:"text-xs mb-3 px-2 py-1.5 rounded-md text-accent-danger bg-accent-danger/10",children:v}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:m?"Latitude (°)":"Latitude"}),t.jsx("div",{className:s("h-[38px] rounded-full px-4 flex items-center transition-colors",m?"bg-white/5":"bg-white/[0.02]"),children:m?t.jsx("input",{type:"number",value:p,onChange:e=>h(e.target.value),step:"0.000001",min:"-90",max:"90",placeholder:"e.g. 34.052234",className:"w-full bg-transparent text-text-primary focus:outline-none type-data placeholder:text-text-muted/50"}):t.jsx("span",{className:s("type-data",M&&n?"text-text-primary":"text-text-muted"),children:M?a.toFixed(6):"Not set"})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:m?"Longitude (°)":"Longitude"}),t.jsx("div",{className:s("h-[38px] rounded-full px-4 flex items-center transition-colors",m?"bg-white/5":"bg-white/[0.02]"),children:m?t.jsx("input",{type:"number",value:b,onChange:e=>y(e.target.value),step:"0.000001",min:"-180",max:"180",placeholder:"e.g. -118.243685",className:"w-full bg-transparent text-text-primary focus:outline-none type-data placeholder:text-text-muted/50"}):t.jsx("span",{className:s("type-data",M&&n?"text-text-primary":"text-text-muted"),children:M?r.toFixed(6):"Not set"})})]})]}),M&&!m&&t.jsx("div",{className:"mt-3 pt-3 border-t border-border-subtle",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:s("w-2 h-2 rounded-full",n?"bg-accent-success":"bg-text-muted")}),t.jsx("span",{className:"type-body-sm text-text-muted",children:n?"Stealth location active — you appear on maps with these coordinates":"Stealth location disabled — coordinates saved but not in use"})]})})]})})}const Z=[{value:7.8,label:"7.8 kHz"},{value:10.4,label:"10.4 kHz"},{value:15.6,label:"15.6 kHz"},{value:20.8,label:"20.8 kHz"},{value:31.25,label:"31.25 kHz"},{value:41.7,label:"41.7 kHz"},{value:62.5,label:"62.5 kHz"},{value:125,label:"125 kHz"},{value:250,label:"250 kHz"},{value:500,label:"500 kHz"}],ee=[5,6,7,8,9,10,11,12],te=[{value:5,label:"4/5"},{value:6,label:"4/6"},{value:7,label:"4/7"},{value:8,label:"4/8"}],se="radioConfig",ae="repeaterSettings",re="operatingMode";function ne({node:e,level:a,expandedKeys:r,selectedKeyId:n,globalFloodPolicy:l,onSelect:c,onToggle:i}){const o=r.has(e.id),d=n===e.id,u=e.children&&e.children.length>0,m="allow"===l;return t.jsxs("div",{children:[t.jsxs("div",{className:s("flex items-center gap-2 h-[36px] px-3 rounded-full cursor-pointer transition-colors",d?"bg-accent-primary/15":"hover:bg-subtle-fill",m&&"opacity-50 cursor-not-allowed"),style:{marginLeft:16*a+"px"},onClick:()=>!m&&c(e.id),children:[u?t.jsx("button",{onClick:t=>{t.stopPropagation(),i(e.id)},className:"p-1 hover:bg-subtle-fill-hover rounded-full transition-colors",children:t.jsx(I,{className:s("w-3.5 h-3.5 text-text-muted transition-transform",o&&"rotate-90")})}):t.jsx("span",{className:"w-5"}),t.jsx(q,{className:"w-4 h-4 text-accent-primary flex-shrink-0"}),t.jsx("span",{className:"type-data text-text-primary flex-1 truncate",children:e.name}),t.jsx("span",{className:s("type-data-xs px-2 py-0.5 rounded-full","allow"===e.floodPolicy?"bg-accent-success/15 text-accent-success":"bg-accent-danger/15 text-accent-danger"),children:"allow"===e.floodPolicy?"Allow":"Deny"})]}),u&&o&&t.jsx("div",{children:e.children.map(e=>t.jsx(ne,{node:e,level:a+1,expandedKeys:r,selectedKeyId:n,globalFloodPolicy:l,onSelect:c,onToggle:i},e.id))})]})}function le(){var a,n,l,c,i,v;const{stats:I,setMode:q,clearModeMutation:U,setDutyCycleConfig:J,clearDutyCycleMutation:G,fetchStats:le,startMutation:ce,clearMutation:ie}=d(),oe=null==(a=null==I?void 0:I.config)?void 0:a.radio,de=null==(n=null==I?void 0:I.config)?void 0:n.repeater,ue=null==(l=null==I?void 0:I.config)?void 0:l.duty_cycle,me=(null==I?void 0:I.node_name)||(null==(c=null==I?void 0:I.config)?void 0:c.node_name)||"Unknown Node",xe=(null==de?void 0:de.mode)??"forward",pe=(null==ue?void 0:ue.enforcement_enabled)??!1,he=null==(i=null==I?void 0:I.config)?void 0:i.delays,[be,ye]=e.useState(!1),[ge,fe]=e.useState(""),[je,ve]=e.useState(62.5),[Ne,we]=e.useState(7),[ke,Ce]=e.useState(5),[Se,_e]=e.useState(""),[Te,Fe]=e.useState("idle"),[Ee,Le]=e.useState(null),Me=e.useRef(null),Pe=e.useRef(null),[Re,ze]=e.useState(!1),[De,Ie]=e.useState(""),[Ae,Oe]=e.useState(""),[qe,Ke]=e.useState(""),[He,Ve]=e.useState("idle"),$e=e.useRef(null),Ye=e.useRef(null),[Be,Ue]=e.useState(!1),[Xe,Je]=e.useState(""),[Ge,We]=e.useState(""),[Qe,Ze]=e.useState(""),[et,tt]=e.useState(""),[st,at]=e.useState("idle"),[rt,nt]=e.useState(null),lt=e.useRef(null),ct=e.useRef(null),[it,ot]=e.useState("idle"),[dt,ut]=e.useState("idle"),[mt,xt]=e.useState(null),[pt,ht]=e.useState(null),bt=e.useRef(!0),yt=e.useRef(null),gt=e.useRef(null),ft=e.useRef(null),jt=e.useRef(null),vt=e.useRef(!1),Nt=e.useRef(!1);e.useEffect(()=>(bt.current=!0,()=>{bt.current=!1,yt.current&&clearTimeout(yt.current),gt.current&&clearTimeout(gt.current),ft.current&&clearTimeout(ft.current),jt.current&&clearTimeout(jt.current),Tt.current&&clearTimeout(Tt.current),Ft.current&&clearTimeout(Ft.current),Pe.current&&clearTimeout(Pe.current),$e.current&&clearTimeout($e.current),ct.current&&clearTimeout(ct.current)}),[]),e.useEffect(()=>{const e=e=>{if(be||Be||Re)return e.preventDefault(),e.returnValue="You have unsaved changes. Are you sure you want to leave?",e.returnValue};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[be,Be,Re]);const wt=null==(v=null==I?void 0:I.config)?void 0:v.web,[kt,Ct]=e.useState("idle"),[St,_t]=e.useState(null),Tt=e.useRef(null),Ft=e.useRef(null),Et=e.useRef(!1),[Lt,Mt]=e.useState([]),[Pt,Rt]=e.useState(!1),[zt,Dt]=e.useState(null),[It,At]=e.useState(!1),[Ot,qt]=e.useState(""),[Kt,Ht]=e.useState(null),[Vt,$t]=e.useState(!1),[Yt,Bt]=e.useState(null),[Ut,Xt]=e.useState(!1),[Jt,Gt]=e.useState(!1),[Wt,Qt]=e.useState(!1),[Zt,es]=e.useState([]),[ts,ss]=e.useState(!1),[as,rs]=e.useState(null),[ns,ls]=e.useState("deny"),[cs,is]=e.useState(!1),[os,ds]=e.useState(null),[us,ms]=e.useState(new Set),[xs,ps]=e.useState(!1),[hs,bs]=e.useState(!1),[ys,gs]=e.useState(!1),[fs,js]=e.useState(null),[vs,Ns]=e.useState(null),[ws,ks]=e.useState(""),[Cs,Ss]=e.useState("deny"),[_s,Ts]=e.useState(!1),[Fs,Es]=e.useState(!0),[Ls,Ms]=e.useState(!1),[Ps,Rs]=e.useState(!0),[zs,Ds]=e.useState("idle"),[Is,As]=e.useState(!1),[Os,qs]=e.useState(!1),Ks=e.useRef(!1);e.useEffect(()=>{const e=be&&!Ks.current;Ks.current=be,oe&&e&&(fe((oe.frequency/1e6).toFixed(3)),ve(oe.bandwidth/1e3),we(oe.spreading_factor),Ce(oe.coding_rate),_e(String(oe.tx_power)))},[oe,be]);const Hs=e.useMemo(()=>{if(!oe||!be)return!1;const e=oe.frequency/1e6,t=oe.bandwidth/1e3,s=parseFloat(ge)||0;return Math.abs(s-e)>1e-4||je!==t||Ne!==oe.spreading_factor||ke!==oe.coding_rate||parseInt(Se)!==oe.tx_power},[oe,be,ge,je,Ne,ke,Se]),Vs=e.useCallback(()=>{ye(!1),Le(null),oe&&(fe((oe.frequency/1e6).toFixed(3)),ve(oe.bandwidth/1e3),we(oe.spreading_factor),Ce(oe.coding_rate),_e(String(oe.tx_power)))},[oe]);e.useEffect(()=>{if(!be)return;const e=e=>{"loading"!==Te&&Me.current&&!Me.current.contains(e.target)&&Vs()};return document.addEventListener("mouseup",e),()=>{document.removeEventListener("mouseup",e)}},[be,Vs,Te]);const $s=e.useCallback(()=>{const e=null==he?void 0:he.tx_delay_factor;return e&&"object"==typeof e&&"parsedValue"in e?e.parsedValue??1:"number"==typeof e?e:1},[he]),Ys=e.useCallback(()=>{const e=null==he?void 0:he.direct_tx_delay_factor;return"number"==typeof e?e:.5},[he]),Bs=e.useCallback(()=>{const e=null==ue?void 0:ue.max_airtime_percent;return"number"==typeof e?e:e&&"object"==typeof e&&"parsedValue"in e?e.parsedValue??6:6},[ue]),Us=e.useCallback(()=>{Ie($s().toFixed(2)),Oe(Ys().toFixed(2)),Ke(Bs().toFixed(1)),ze(!0)},[$s,Ys,Bs]),Xs=e.useCallback(()=>{ze(!1)},[]);e.useEffect(()=>{if(!Re)return;const e=e=>{"loading"!==He&&Ye.current&&!Ye.current.contains(e.target)&&Xs()};return document.addEventListener("mouseup",e),()=>document.removeEventListener("mouseup",e)},[Re,Xs,He]);const Js=e.useCallback(()=>{var e,t,s;Je(me),We((null==(e=null==de?void 0:de.latitude)?void 0:e.toString())||"0"),Ze((null==(t=null==de?void 0:de.longitude)?void 0:t.toString())||"0"),tt((null==(s=null==de?void 0:de.send_advert_interval_hours)?void 0:s.toString())||"0"),nt(null),Ue(!0)},[me,de]),Gs=e.useCallback(()=>{Ue(!1),nt(null)},[]);e.useEffect(()=>{if(!Be)return;const e=e=>{"loading"!==st&&lt.current&&!lt.current.contains(e.target)&&Gs()};return document.addEventListener("mouseup",e),()=>document.removeEventListener("mouseup",e)},[Be,Gs,st]);const Ws=async()=>{var e;if("loading"===kt)return;const t=(null==wt?void 0:wt.cors_enabled)??!1,s=!t,a=t;Tt.current&&clearTimeout(Tt.current),Ft.current&&clearTimeout(Ft.current),Et.current=!1,_t(s),Ct("loading"),Tt.current=setTimeout(()=>{Et.current||bt.current&&(_t(a),Ct("error"),Ft.current=setTimeout(()=>{bt.current&&(Ct("idle"),_t(null))},2e3))},1e4);try{const t=await X({web:{cors_enabled:s}});if(Et.current=!0,Tt.current&&clearTimeout(Tt.current),!bt.current)return;t.success||(null==(e=t.data)?void 0:e.persisted)?(await le(),Ct("success"),Ft.current=setTimeout(()=>{bt.current&&(Ct("idle"),_t(null))},2e3)):(_t(a),Ct("error"),Ft.current=setTimeout(()=>{bt.current&&(Ct("idle"),_t(null))},2e3))}catch{if(Et.current=!0,Tt.current&&clearTimeout(Tt.current),!bt.current)return;_t(a),Ct("error"),Ft.current=setTimeout(()=>{bt.current&&(Ct("idle"),_t(null))},2e3)}};e.useEffect(()=>{(async()=>{Rs(!0);try{const e=await async function(){return r("/api/check_pymc_console")}();e.success&&e.data?Ms(e.data.exists):Ms(!1);const t=null==wt?void 0:wt.web_path;Es(!t||""===t)}catch{Ms(!1)}finally{Rs(!1)}})()},[null==wt?void 0:wt.web_path]);const Qs=async e=>{var t;if("loading"!==zs){Ds("loading");try{const s=await X({web:{web_path:e?null:"/opt/pymc_console/web/html"}});if(!bt.current)return;s.success||(null==(t=s.data)?void 0:t.persisted)?(Es(e),Ds("success"),As(!0),setTimeout(()=>{bt.current&&Ds("idle")},2e3)):(Ds("error"),setTimeout(()=>{bt.current&&Ds("idle")},2e3))}catch{if(!bt.current)return;Ds("error"),setTimeout(()=>{bt.current&&Ds("idle")},2e3)}}},Zs=e.useCallback(async()=>{Rt(!0),Dt(null);try{const e=await async function(){return r("/auth/tokens")}();Mt(e.tokens||[])}catch(e){Dt(e instanceof Error?e.message:"Failed to fetch tokens")}finally{Rt(!1)}},[]);e.useEffect(()=>{Zs()},[Zs]);const ea=async()=>{if(Ot.trim()){Xt(!0),Dt(null);try{const e=await async function(e){return r("/auth/tokens",{method:"POST",body:JSON.stringify({name:e})})}(Ot.trim());Ht(e.token||null),At(!1),$t(!0),qt(""),await Zs()}catch(e){Dt(e instanceof Error?e.message:"Failed to create token")}finally{Xt(!1)}}else Dt("Token name is required")},ta=e=>e?new Date(1e3*e).toLocaleString():"Never",sa=e.useCallback(e=>{const t=new Map,s=[];return e.forEach(e=>{const s={id:e.id,name:e.name,floodPolicy:e.flood_policy,transport_key:e.transport_key,last_used:e.last_used,parent_id:e.parent_id,children:[]};t.set(e.id,s)}),t.forEach(e=>{e.parent_id&&t.has(e.parent_id)?t.get(e.parent_id).children.push(e):s.push(e)}),s},[]),aa=e.useCallback(async()=>{ss(!0),rs(null);try{const e=await async function(){return r("/api/transport_keys")}();e.success&&e.data?es(sa(e.data)):rs(e.error||"Failed to load transport keys")}catch(e){rs(e instanceof Error?e.message:"Unknown error occurred")}finally{ss(!1)}},[sa]);e.useEffect(()=>{aa()},[aa]);const ra=e.useCallback((e,t)=>{for(const s of e){if(s.id===t)return s;if(s.children){const e=ra(s.children,t);if(e)return e}}return null},[]),na=e.useCallback(()=>{if(!os)return;const e=ra(Zt,os);return null==e?void 0:e.name},[os,Zt,ra]),la=e.useCallback(e=>{ms(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[]),ca=async e=>{is(!0),rs(null);try{const t=await async function(e){return r("/api/global_flood_policy",{method:"POST",body:JSON.stringify({global_flood_allow:e})})}("allow"===e);t.success?ls(e):rs(t.error||"Failed to update global flood policy")}catch(t){rs(t instanceof Error?t.message:"Failed to update global flood policy")}finally{is(!1)}},ia=async()=>{if(ws.trim()){Ts(!0),rs(null);try{const e=await async function(e){return r("/api/transport_keys",{method:"POST",body:JSON.stringify(e)})}({name:ws.trim(),flood_policy:Cs,parent_id:os??void 0});e.success?(await aa(),ps(!1),ks(""),Ss("deny")):rs(e.error||"Failed to add transport key")}catch(e){rs(e instanceof Error?e.message:"Failed to add transport key")}finally{Ts(!1)}}else rs("Key name is required")},oa=e.useCallback(()=>{if(!os)return;const e=ra(Zt,os);e&&(js({...e}),bs(!0))},[os,Zt,ra]);e.useEffect(()=>{const e=e=>{"Escape"===e.key&&(xs&&(ps(!1),ks(""),Ss("deny")),hs&&(bs(!1),js(null)),ys&&(gs(!1),Ns(null)),It&&(At(!1),qt("")),Vt&&($t(!1),Ht(null)))};if(xs||hs||ys||It||Vt)return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[xs,hs,ys,It,Vt]);const da=e.useCallback(()=>{if(!os)return;const e=ra(Zt,os);e&&(Ns(e),gs(!0))},[os,Zt,ra]);return t.jsxs(k,{children:[t.jsx(C,{title:"Configuration",icon:t.jsx(u,{})}),t.jsxs(S,{children:[t.jsxs(M,{template:"standard",children:[t.jsx(P,{span:12,md:6,children:t.jsx(w,{children:t.jsxs("div",{ref:lt,children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"type-subheading text-text-primary flex items-center gap-2",children:[t.jsx(m,{className:"icon-md text-accent-primary"}),"Repeater Settings"]}),t.jsx("div",{className:"flex items-center gap-1",children:de&&(Be?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:Gs,disabled:"loading"===st,className:s("p-2 radius-inner transition-base","loading"===st?"text-text-muted cursor-not-allowed":"text-text-muted hover:text-accent-danger hover:bg-accent-danger/10"),title:"Cancel",children:t.jsx(o,{className:"w-4 h-4"})}),t.jsx("button",{onClick:async()=>{if("loading"!==st){ct.current&&clearTimeout(ct.current),ce(ae),at("loading"),nt(null);try{const e={};Xe&&Xe!==me&&(e.node_name=Xe);const t=parseFloat(Ge);isNaN(t)||t===(null==de?void 0:de.latitude)||(e.latitude=t);const s=parseFloat(Qe);isNaN(s)||s===(null==de?void 0:de.longitude)||(e.longitude=s);const a=parseInt(et);if(isNaN(a)||a===(null==de?void 0:de.send_advert_interval_hours)||(e.flood_advert_interval_hours=a),0===Object.keys(e).length)return nt({success:!0,message:"No changes to save"}),at("idle"),void ie(ae);const r=await y(e);if(!bt.current)return void ie(ae);if(r.success&&r.data){const e=r.data.applied.join(", ");nt({success:!0,message:`Updated: ${e}`}),await le({force:!0}),at("success"),ct.current=setTimeout(()=>{bt.current&&(at("idle"),Ue(!1),nt(null),ie(ae))},1500)}else nt({success:!1,message:r.error||"Failed to save"}),at("error"),ie(ae),ct.current=setTimeout(()=>{bt.current&&at("idle")},2e3)}catch(e){if(!bt.current)return void ie(ae);nt({success:!1,message:String(e)}),at("error"),ie(ae),ct.current=setTimeout(()=>{bt.current&&at("idle")},2e3)}}},disabled:"loading"===st,className:s("p-2 radius-inner transition-base","loading"===st?"text-accent-primary cursor-wait":"success"===st?"text-accent-success":"error"===st?"text-accent-danger":"text-accent-success hover:bg-accent-success/10"),title:"Save changes",children:"loading"===st?t.jsx(T,{className:"w-4 h-4 animate-spin"}):"success"===st?t.jsx(F,{className:"w-4 h-4"}):"error"===st?t.jsx(o,{className:"w-4 h-4"}):t.jsx(F,{className:"w-4 h-4"})})]}):t.jsx("button",{onClick:Js,className:"p-2 radius-inner transition-base text-text-muted hover:text-text-primary hover-bg",title:"Edit repeater settings",children:t.jsx($,{className:"w-4 h-4"})}))})]}),rt&&t.jsx("div",{className:s("text-xs mb-3 px-2 py-1.5 rounded-md",rt.success?"text-accent-success bg-accent-success/10":"text-accent-danger bg-accent-danger/10"),children:rt.message}),de?t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"col-span-2",children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Node Name"}),t.jsx("div",{className:s("h-[38px] rounded-full px-4 flex items-center transition-colors",Be?"bg-subtle-fill-hover":"bg-subtle-fill"),children:Be?t.jsx("input",{type:"text",value:Xe,onChange:e=>Je(e.target.value),maxLength:50,className:"w-full bg-transparent text-text-primary focus:outline-none type-data",placeholder:"Enter node name"}):t.jsx("span",{className:"type-data text-text-primary",children:me})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:Be?"Latitude (°)":"Latitude"}),t.jsx("div",{className:s("h-[38px] rounded-full px-4 flex items-center transition-colors",Be?"bg-subtle-fill-hover":"bg-subtle-fill"),children:Be?t.jsx("input",{type:"number",value:Ge,onChange:e=>We(e.target.value),step:"0.000001",min:"-90",max:"90",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):t.jsx("span",{className:"type-data text-text-primary",children:0!==de.latitude?de.latitude.toFixed(6):"Not set"})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:Be?"Longitude (°)":"Longitude"}),t.jsx("div",{className:s("h-[38px] rounded-full px-4 flex items-center transition-colors",Be?"bg-subtle-fill-hover":"bg-subtle-fill"),children:Be?t.jsx("input",{type:"number",value:Qe,onChange:e=>Ze(e.target.value),step:"0.000001",min:"-180",max:"180",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):t.jsx("span",{className:"type-data text-text-primary",children:0!==de.longitude?de.longitude.toFixed(6):"Not set"})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:Be?"Advert Interval (hours)":"Advert Interval"}),t.jsx("div",{className:s("h-[38px] rounded-full px-4 flex items-center transition-colors",Be?"bg-subtle-fill-hover":"bg-subtle-fill"),children:Be?t.jsx("input",{type:"number",value:et,onChange:e=>tt(e.target.value),min:"0",max:"48",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):t.jsx("span",{className:"type-data text-text-primary",children:de.send_advert_interval_hours>0?`${de.send_advert_interval_hours}h`:"Disabled"})}),Be&&t.jsx("p",{className:"type-data-xs text-text-muted mt-1 ml-4",children:"0 = disabled, 3-48 hours"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Score-based TX"}),t.jsx("div",{className:"h-[38px] rounded-full px-4 flex items-center bg-subtle-fill",children:t.jsx("span",{className:"type-data text-text-primary",children:de.use_score_for_tx?"Enabled":"Disabled"})})]})]}):t.jsx("p",{className:"text-text-muted",children:"Loading repeater settings..."})]})})}),t.jsx(P,{span:12,md:6,children:t.jsx(w,{children:t.jsxs("div",{ref:Me,children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"type-subheading text-text-primary flex items-center gap-2",children:[t.jsx(A,{className:"icon-md text-accent-primary"}),"Radio Configuration"]}),t.jsx("div",{className:"flex items-center gap-1",children:oe&&(be?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:Vs,disabled:"loading"===Te,className:s("p-2 radius-inner transition-base","loading"===Te?"text-text-muted cursor-not-allowed":"text-text-muted hover:text-accent-danger hover:bg-accent-danger/10"),title:"Cancel",children:t.jsx(o,{className:"w-4 h-4"})}),t.jsx("button",{onClick:async()=>{if("loading"!==Te){Pe.current&&clearTimeout(Pe.current),ce(se),Fe("loading"),Le(null);try{const e={},t=parseFloat(ge),s=oe?oe.frequency/1e6:0;Math.abs(t-s)>1e-4&&(e.frequency_mhz=t);const a=oe?oe.bandwidth/1e3:0;je!==a&&(e.bandwidth_khz=je),Ne!==(null==oe?void 0:oe.spreading_factor)&&(e.spreading_factor=Ne),ke!==(null==oe?void 0:oe.coding_rate)&&(e.coding_rate=ke);const r=parseInt(Se);if(r!==(null==oe?void 0:oe.tx_power)&&(e.tx_power=r),0===Object.keys(e).length)return Le({success:!0,message:"No changes to save"}),Fe("idle"),void ie(se);const n=await y(e);if(!bt.current)return void ie(se);if(n.success&&n.data){const e=n.data.applied.join(", "),t=n.data.live_update?" (applied live)":" (restart required)";Le({success:!0,message:`Updated: ${e}${t}`}),await le({force:!0}),Fe("success"),Pe.current=setTimeout(()=>{bt.current&&(Fe("idle"),ye(!1),Le(null),ie(se))},1500)}else Le({success:!1,message:n.error||"Failed to save"}),Fe("error"),ie(se),Pe.current=setTimeout(()=>{bt.current&&Fe("idle")},2e3)}catch(e){if(!bt.current)return void ie(se);Le({success:!1,message:String(e)}),Fe("error"),ie(se),Pe.current=setTimeout(()=>{bt.current&&Fe("idle")},2e3)}}},disabled:"loading"===Te||!Hs,className:s("p-2 radius-inner transition-base","loading"===Te?"text-accent-primary cursor-wait":"success"===Te?"text-accent-success":"error"===Te?"text-accent-danger":Hs?"text-accent-success hover:bg-accent-success/10":"text-text-muted cursor-not-allowed"),title:Hs?"Save changes":"No changes to save",children:"loading"===Te?t.jsx(T,{className:"w-4 h-4 animate-spin"}):"success"===Te?t.jsx(F,{className:"w-4 h-4"}):"error"===Te?t.jsx(o,{className:"w-4 h-4"}):t.jsx(F,{className:"w-4 h-4"})})]}):t.jsx("button",{onClick:()=>{oe&&(fe((oe.frequency/1e6).toFixed(3)),ve(oe.bandwidth/1e3),we(oe.spreading_factor),Ce(oe.coding_rate),_e(String(oe.tx_power))),Le(null),ye(!0)},className:"p-2 radius-inner transition-base text-text-muted hover:text-text-primary hover-bg",title:"Edit radio settings",children:t.jsx($,{className:"w-4 h-4"})}))})]}),Ee&&t.jsx("div",{className:s("text-xs mb-3 px-2 py-1.5 rounded-md",Ee.success?"text-accent-success bg-accent-success/10":"text-accent-danger bg-accent-danger/10"),children:Ee.message}),oe?t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:be?"Frequency (MHz)":"Frequency"}),t.jsx("div",{className:s("h-[38px] rounded-full px-4 flex items-center transition-colors",be?"bg-subtle-fill-hover":"bg-subtle-fill"),children:be?t.jsx("input",{type:"number",value:ge,onChange:e=>fe(e.target.value),step:"0.001",min:"400",max:"930",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):t.jsx("span",{className:"type-data text-text-primary",children:x(oe.frequency)})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:be?"TX Power (dBm)":"TX Power"}),t.jsx("div",{className:s("h-[38px] rounded-full px-4 flex items-center transition-colors",be?"bg-subtle-fill-hover":"bg-subtle-fill"),children:be?t.jsx("input",{type:"number",value:Se,onChange:e=>_e(e.target.value),min:"-9",max:"22",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):t.jsxs("span",{className:"type-data text-text-primary",children:[oe.tx_power," dBm"]})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Bandwidth"}),t.jsx("div",{className:s("h-[38px] rounded-full px-4 flex items-center transition-colors relative",be?"bg-subtle-fill-hover":"bg-subtle-fill"),children:be?t.jsxs(t.Fragment,{children:[t.jsx("select",{value:je,onChange:e=>ve(parseFloat(e.target.value)),className:"w-full bg-transparent text-text-primary focus:outline-none appearance-none cursor-pointer type-data pr-6",children:Z.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))}),t.jsx(p,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]}):t.jsx("span",{className:"type-data text-text-primary",children:h(oe.bandwidth)})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Spreading Factor"}),t.jsx("div",{className:s("h-[38px] rounded-full px-4 flex items-center transition-colors relative",be?"bg-subtle-fill-hover":"bg-subtle-fill"),children:be?t.jsxs(t.Fragment,{children:[t.jsx("select",{value:Ne,onChange:e=>we(parseInt(e.target.value)),className:"w-full bg-transparent text-text-primary focus:outline-none appearance-none cursor-pointer type-data pr-6",children:ee.map(e=>t.jsxs("option",{value:e,children:["SF",e]},e))}),t.jsx(p,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]}):t.jsxs("span",{className:"type-data text-text-primary",children:["SF",oe.spreading_factor]})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Coding Rate"}),t.jsx("div",{className:s("h-[38px] rounded-full px-4 flex items-center transition-colors relative",be?"bg-subtle-fill-hover":"bg-subtle-fill"),children:be?t.jsxs(t.Fragment,{children:[t.jsx("select",{value:ke,onChange:e=>Ce(parseInt(e.target.value)),className:"w-full bg-transparent text-text-primary focus:outline-none appearance-none cursor-pointer type-data pr-6",children:te.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))}),t.jsx(p,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]}):t.jsxs("span",{className:"type-data text-text-primary",children:["4/",oe.coding_rate]})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Preamble"}),t.jsx("div",{className:"h-[38px] rounded-full px-4 flex items-center bg-subtle-fill",children:t.jsxs("span",{className:"type-data text-text-primary",children:[oe.preamble_length," symbols"]})})]})]}):t.jsx("p",{className:"text-text-muted",children:"Loading radio configuration..."})]})})})]}),t.jsxs(M,{template:"standard",children:[t.jsx(P,{span:12,md:6,children:t.jsx(w,{children:t.jsxs("div",{ref:Ye,children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("h2",{className:"type-subheading text-text-primary flex items-center gap-3",children:[t.jsx(b,{className:"icon-md text-icon-card-title"}),"Operating Mode"]}),t.jsx("div",{className:"flex items-center gap-1",children:Re?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:async()=>{if("loading"!==He){$e.current&&clearTimeout($e.current),ce(re),Ve("loading");try{const e=await y({tx_delay_factor:parseFloat(De),direct_tx_delay_factor:parseFloat(Ae)});if(await J({max_airtime_percent:parseFloat(qe),enforcement_enabled:pe}),!bt.current)return void ie(re);e.success&&e.data?(await le({force:!0}),Ve("success"),$e.current=setTimeout(()=>{bt.current&&(Ve("idle"),ze(!1),ie(re))},1500)):(Ve("error"),ie(re),$e.current=setTimeout(()=>{bt.current&&Ve("idle")},2e3))}catch{if(!bt.current)return void ie(re);Ve("error"),ie(re),$e.current=setTimeout(()=>{bt.current&&Ve("idle")},2e3)}}},disabled:"loading"===He,className:s("p-2 radius-inner transition-base","loading"===He?"text-accent-primary cursor-wait":"success"===He?"text-accent-success":"error"===He?"text-accent-danger":"text-accent-success hover:bg-accent-success/10"),title:"Save",children:"loading"===He?t.jsx(T,{className:"w-4 h-4 animate-spin"}):"success"===He?t.jsx(F,{className:"w-4 h-4"}):"error"===He?t.jsx(o,{className:"w-4 h-4"}):t.jsx(F,{className:"w-4 h-4"})}),t.jsx("button",{onClick:Xs,className:"p-2 radius-inner transition-base text-text-muted hover:text-accent-danger hover:bg-accent-danger/10",title:"Cancel",children:t.jsx(o,{className:"w-4 h-4"})})]}):t.jsx("button",{onClick:Us,className:"p-2 radius-inner transition-base text-text-muted hover:text-text-primary hover-bg",title:"Edit settings",children:t.jsx($,{className:"w-4 h-4"})})})]}),t.jsx("p",{className:"type-label text-text-muted mb-3",children:"Control how the repeater handles packets"}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsxs("div",{className:"flex-1 space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"type-label text-text-muted",children:"Repeat"}),t.jsx("div",{className:"flex items-center gap-2",children:(()=>{const e=null!==mt?mt:"forward"===xe;return t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:async()=>{if("loading"===it)return;const t=!e,s="forward"===xe;yt.current&&clearTimeout(yt.current),gt.current&&clearTimeout(gt.current),vt.current=!1,xt(t),ot("loading"),yt.current=setTimeout(()=>{vt.current||bt.current&&(xt(s),ot("error"),gt.current=setTimeout(()=>{bt.current&&(ot("idle"),xt(null))},2e3))},1e4);try{if(await q(t?"forward":"monitor"),vt.current=!0,yt.current&&clearTimeout(yt.current),!bt.current)return;ot("success"),gt.current=setTimeout(()=>{bt.current&&(ot("idle"),xt(null),U())},2e3)}catch{if(vt.current=!0,yt.current&&clearTimeout(yt.current),!bt.current)return;xt(s),ot("error"),gt.current=setTimeout(()=>{bt.current&&(ot("idle"),xt(null))},2e3)}},disabled:"loading"===it,className:s("relative inline-flex h-6 w-11 items-center rounded-full transition-colors border-2",e?"bg-toggle-on border-toggle-on":"bg-toggle-off border-border-subtle","loading"===it&&"opacity-70"),"aria-label":"Toggle forward mode",children:t.jsx("span",{className:s("inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-lg",e?"translate-x-5":"translate-x-0.5")})}),t.jsx("span",{className:s("type-data text-sm w-7",e?"text-accent-success":"text-text-muted"),children:e?"On":"Off"}),"loading"===it&&t.jsx(T,{className:"w-4 h-4 text-text-muted animate-spin"}),"success"===it&&t.jsx(F,{className:"w-4 h-4 text-accent-success"}),"error"===it&&t.jsx(o,{className:"w-4 h-4 text-accent-danger"})]})})()})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"type-label text-text-muted",children:"Duty Cycle"}),t.jsx("div",{className:"flex items-center gap-2",children:(()=>{const e=null!==pt?pt:pe;return t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:async()=>{if("loading"===dt)return;const t=!e,s=pe;ft.current&&clearTimeout(ft.current),jt.current&&clearTimeout(jt.current),Nt.current=!1,ht(t),ut("loading"),ft.current=setTimeout(()=>{Nt.current||bt.current&&(ht(s),ut("error"),jt.current=setTimeout(()=>{bt.current&&(ut("idle"),ht(null))},2e3))},1e4);try{if(await J({max_airtime_percent:Bs(),enforcement_enabled:t}),Nt.current=!0,ft.current&&clearTimeout(ft.current),!bt.current)return;ut("success"),jt.current=setTimeout(()=>{bt.current&&(ut("idle"),ht(null),G())},2e3)}catch{if(Nt.current=!0,ft.current&&clearTimeout(ft.current),!bt.current)return;ht(s),ut("error"),jt.current=setTimeout(()=>{bt.current&&(ut("idle"),ht(null))},2e3)}},disabled:"loading"===dt,className:s("relative inline-flex h-6 w-11 items-center rounded-full transition-colors border-2",e?"bg-toggle-on border-toggle-on":"bg-toggle-off border-border-subtle","loading"===dt&&"opacity-70"),"aria-label":"Toggle duty cycle",children:t.jsx("span",{className:s("inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-lg",e?"translate-x-5":"translate-x-0.5")})}),t.jsx("span",{className:s("type-data text-sm w-7",e?"text-accent-success":"text-text-muted"),children:e?"On":"Off"}),"loading"===dt&&t.jsx(T,{className:"w-4 h-4 text-text-muted animate-spin"}),"success"===dt&&t.jsx(F,{className:"w-4 h-4 text-accent-success"}),"error"===dt&&t.jsx(o,{className:"w-4 h-4 text-accent-danger"})]})})()})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"type-label text-text-muted",children:"Max Airtime"}),t.jsx("div",{className:s("h-[32px] rounded-full px-3 flex items-center justify-end transition-colors min-w-[80px]",Re?"bg-subtle-fill-hover":"bg-subtle-fill"),children:Re?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("input",{type:"number",value:qe,onChange:e=>Ke(e.target.value),step:"0.5",min:"0.1",max:"100",className:"w-12 bg-transparent text-text-primary text-right focus:outline-none type-data"}),t.jsx("span",{className:"text-text-muted type-data",children:"%"})]}):t.jsxs("span",{className:"type-data text-text-primary",children:[Bs().toFixed(1),"%"]})})]})]}),t.jsx("div",{className:"hidden sm:block w-px bg-border-subtle"}),t.jsxs("div",{className:"flex-1 pt-4 sm:pt-0 border-t sm:border-t-0 border-border-subtle",children:[t.jsx("label",{className:"type-label text-text-muted block mb-3",children:"TX Delays"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"type-label text-text-muted",children:"Flood"}),t.jsx("div",{className:s("h-[32px] rounded-full px-3 flex items-center justify-end transition-colors min-w-[80px]",Re?"bg-subtle-fill-hover":"bg-subtle-fill"),children:Re?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("input",{type:"number",value:De,onChange:e=>Ie(e.target.value),step:"0.1",min:"0",max:"5",className:"w-12 bg-transparent text-text-primary text-right focus:outline-none type-data"}),t.jsx("span",{className:"text-text-muted type-data",children:"x"})]}):t.jsxs("span",{className:"type-data text-text-primary",children:[$s().toFixed(2),"x"]})})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"type-label text-text-muted",children:"Direct"}),t.jsx("div",{className:s("h-[32px] rounded-full px-3 flex items-center justify-end transition-colors min-w-[80px]",Re?"bg-subtle-fill-hover":"bg-subtle-fill"),children:Re?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("input",{type:"number",value:Ae,onChange:e=>Oe(e.target.value),step:"0.1",min:"0",max:"5",className:"w-12 bg-transparent text-text-primary text-right focus:outline-none type-data"}),t.jsx("span",{className:"text-text-muted type-data",children:"s"})]}):t.jsxs("span",{className:"type-data text-text-primary",children:[Ys().toFixed(2),"s"]})})]})]})]})]})]})})}),t.jsx(P,{span:12,md:6,children:t.jsxs(w,{children:[t.jsx(_,{icon:t.jsx(u,{}),title:"App Settings",largeTitle:!0}),t.jsx("p",{className:"type-body-sm text-text-muted mb-4",children:"Appearance and web server options."}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("span",{className:"type-body text-text-primary font-medium block",children:"Enable CORS"}),t.jsx("span",{className:"type-body-sm text-text-muted",children:"Allow cross-origin API access"})]}),t.jsx("div",{className:"flex items-center gap-2",children:(()=>{const e=null!==St?St:(null==wt?void 0:wt.cors_enabled)??!1;return t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:Ws,disabled:"loading"===kt,className:s("relative inline-flex h-6 w-11 items-center rounded-full transition-colors border-2",e?"bg-toggle-on border-toggle-on":"bg-toggle-off border-border-subtle","loading"===kt&&"opacity-70"),title:e?"Disable CORS":"Enable CORS",children:t.jsx("span",{className:s("inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-lg",e?"translate-x-5":"translate-x-0.5")})}),"loading"===kt&&t.jsx(T,{className:"w-4 h-4 text-text-muted animate-spin"}),"success"===kt&&t.jsx(F,{className:"w-4 h-4 text-accent-success"}),"error"===kt&&t.jsx(o,{className:"w-4 h-4 text-accent-danger"})]})})()})]}),t.jsx("div",{children:t.jsx(W,{})})]})]})})]}),t.jsx(M,{template:"auto",children:t.jsxs(w,{children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"type-heading text-text-primary flex items-center gap-2",children:[t.jsx(K,{className:"icon-md text-accent-primary"}),"Regions / Transport Keys"]}),t.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Manage regional key hierarchy for flood control"})]}),t.jsxs("div",{className:"flex gap-2 flex-wrap",children:[t.jsxs("button",{onClick:()=>ps(!0),disabled:"allow"===ns,className:s("flex items-center gap-1.5 h-[32px] px-3 rounded-full transition-colors type-body-sm font-medium","allow"===ns?"bg-subtle-fill text-text-muted cursor-not-allowed":"bg-accent-success/10 hover:bg-accent-success/20 text-accent-success"),children:[t.jsx(f,{className:"w-3.5 h-3.5"}),"Add"]}),t.jsx("button",{onClick:oa,disabled:!os||"allow"===ns,className:s("h-[32px] px-3 rounded-full transition-colors type-body-sm font-medium",os&&"allow"!==ns?"bg-accent-primary/10 hover:bg-accent-primary/20 text-accent-primary":"bg-subtle-fill text-text-muted cursor-not-allowed"),children:"Edit"}),t.jsx("button",{onClick:da,disabled:!os||"allow"===ns,className:s("h-[32px] px-3 rounded-full transition-colors type-body-sm font-medium",os&&"allow"!==ns?"bg-accent-danger/10 hover:bg-accent-danger/20 text-accent-danger":"bg-subtle-fill text-text-muted cursor-not-allowed"),children:"Delete"})]})]}),t.jsx("div",{className:"bg-subtle-fill radius-card p-4 mb-4",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:s("w-10 h-10 rounded-full flex items-center justify-center","allow"===ns?"bg-accent-success/20":"bg-accent-danger/20"),children:"allow"===ns?t.jsx(Y,{className:"w-5 h-5 text-accent-success"}):t.jsx(B,{className:"w-5 h-5 text-accent-danger"})}),t.jsxs("div",{children:[t.jsx("h4",{className:"type-body text-text-primary font-medium",children:"Global Flood Policy"}),t.jsx("p",{className:"type-body-sm text-text-muted",children:"Master control for repeater flooding"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"flex bg-subtle-fill rounded-full p-1",children:[t.jsx("button",{onClick:()=>ca("deny"),disabled:cs,className:s("px-4 py-1.5 rounded-full transition-colors type-body-sm font-medium","deny"===ns?"bg-accent-danger/20 text-accent-danger":"text-text-muted hover:text-text-secondary",cs&&"opacity-50"),children:"Deny"}),t.jsx("button",{onClick:()=>ca("allow"),disabled:cs,className:s("px-4 py-1.5 rounded-full transition-colors type-body-sm font-medium","allow"===ns?"bg-accent-success/20 text-accent-success":"text-text-muted hover:text-text-secondary",cs&&"opacity-50"),children:"Allow"})]}),cs&&t.jsx(T,{className:"w-4 h-4 animate-spin text-text-muted"})]})]})}),as&&t.jsx("div",{className:"type-body-sm mb-3 px-3 py-2 rounded-full text-accent-danger bg-accent-danger/10",children:as}),t.jsx("div",{className:"bg-subtle-fill radius-card p-4 min-h-[120px]",children:ts?t.jsxs("div",{className:"flex items-center justify-center py-6",children:[t.jsx(T,{className:"w-5 h-5 animate-spin text-accent-primary mr-2"}),t.jsx("span",{className:"type-body-sm text-text-muted",children:"Loading transport keys..."})]}):0===Zt.length?t.jsxs("div",{className:"text-center py-6",children:[t.jsx("div",{className:"w-12 h-12 rounded-full bg-subtle-fill mx-auto mb-3 flex items-center justify-center",children:t.jsx(K,{className:"w-6 h-6 text-text-muted/50"})}),t.jsx("p",{className:"type-body text-text-muted",children:"No transport keys found"}),t.jsx("p",{className:"type-body-sm text-text-muted/70 mt-1",children:"Add your first transport key to get started"})]}):t.jsx("div",{className:"space-y-1",children:Zt.map(e=>t.jsx(ne,{node:e,level:0,expandedKeys:us,selectedKeyId:os,globalFloodPolicy:ns,onSelect:ds,onToggle:la},e.id))})})]})}),t.jsx(M,{template:"auto",children:t.jsxs(w,{children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"type-heading text-text-primary flex items-center gap-2",children:[t.jsx(H,{className:"icon-md text-accent-primary"}),"API Tokens"]}),t.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Manage API tokens for machine-to-machine authentication"})]}),t.jsxs("button",{onClick:()=>At(!0),className:"flex items-center justify-center gap-2 h-[32px] px-4 bg-accent-primary/10 hover:bg-accent-primary/20 text-accent-primary rounded-full transition-colors type-body-sm font-medium",children:[t.jsx(f,{className:"w-4 h-4"}),"Create Token"]})]}),t.jsx("div",{className:"bg-accent-tertiary/5 radius-card p-4 mb-4",children:t.jsxs("div",{className:"flex gap-3",children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-accent-tertiary/20 flex items-center justify-center flex-shrink-0",children:t.jsx(L,{className:"w-4 h-4 text-accent-tertiary"})}),t.jsxs("div",{className:"type-body-sm text-text-muted",children:[t.jsxs("p",{children:[t.jsx("span",{className:"text-text-secondary",children:"API tokens"})," are used for machine-to-machine authentication. Include the token in the ",t.jsx("code",{className:"type-code bg-accent-tertiary/20 px-1.5 py-0.5 rounded-full text-accent-tertiary",children:"X-API-Key"})," header when making API requests."]}),t.jsx("p",{className:"mt-1 text-text-muted/70",children:"Tokens are only shown once at creation. Store them securely."})]})]})}),zt&&t.jsx("div",{className:"type-body-sm mb-3 px-3 py-2 rounded-full text-accent-danger bg-accent-danger/10",children:zt}),Pt&&0===Lt.length?t.jsxs("div",{className:"flex items-center justify-center py-6",children:[t.jsx(T,{className:"w-5 h-5 animate-spin text-accent-primary mr-2"}),t.jsx("span",{className:"type-body-sm text-text-muted",children:"Loading tokens..."})]}):Lt.length>0?t.jsx("div",{className:"space-y-2",children:Lt.map(e=>t.jsx("div",{className:"bg-subtle-fill hover:bg-subtle-fill-strong radius-card p-4 transition-base",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-accent-primary/10 flex items-center justify-center flex-shrink-0",children:t.jsx(H,{className:"w-5 h-5 text-accent-primary"})}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("h3",{className:"type-body text-text-primary font-medium truncate",children:e.name}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:gap-4 mt-0.5",children:[t.jsxs("span",{className:"type-data-sm text-text-muted truncate",children:["Created: ",ta(e.created_at)]}),t.jsxs("span",{className:"type-data-sm text-text-muted truncate",children:["Last used: ",ta(e.last_used)]})]})]})]}),t.jsxs("button",{onClick:()=>Bt({id:e.id,name:e.name}),disabled:Jt,className:"h-[32px] px-4 bg-accent-danger/10 hover:bg-accent-danger/20 text-accent-danger rounded-full transition-colors disabled:opacity-50 type-body-sm font-medium flex items-center justify-center gap-1.5",children:[t.jsx(g,{className:"w-3.5 h-3.5"}),"Revoke"]})]})},e.id))}):t.jsxs("div",{className:"bg-subtle-fill radius-card p-6 text-center",children:[t.jsx("div",{className:"w-14 h-14 rounded-full bg-subtle-fill mx-auto mb-4 flex items-center justify-center",children:t.jsx(H,{className:"w-7 h-7 text-text-muted/50"})}),t.jsx("h3",{className:"type-body text-text-primary font-medium mb-1",children:"No API Tokens"}),t.jsx("p",{className:"type-body-sm text-text-muted mb-4",children:"Create a token to enable API access"}),t.jsx("button",{onClick:()=>At(!0),className:"h-[32px] px-4 bg-accent-primary/10 hover:bg-accent-primary/20 text-accent-primary rounded-full transition-colors type-body-sm font-medium",children:"Create Your First Token"})]})]})}),t.jsx(M,{template:"auto",children:t.jsxs(w,{children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:t.jsxs("div",{children:[t.jsxs("h2",{className:"type-heading text-text-primary flex items-center gap-2",children:[t.jsx(V,{className:"icon-md text-accent-primary"}),"Web Frontend"]}),t.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Choose which web interface to use"})]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("label",{className:s("flex items-start gap-3 p-4 bg-subtle-fill radius-card border-2 cursor-pointer transition-base",Fs?"border-accent-primary bg-accent-primary/5":"border-transparent hover:border-accent-primary/30","loading"===zs&&"opacity-50 pointer-events-none"),children:[t.jsx("input",{type:"radio",name:"frontend",checked:Fs,onChange:()=>Qs(!0),disabled:"loading"===zs,className:"mt-1 h-4 w-4 text-accent-primary focus:ring-accent-primary focus:ring-offset-bg-elevated"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"type-body text-text-primary font-medium",children:"Default Frontend"}),t.jsx("a",{href:"https://github.com/rightup/pyMC_Repeater",target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"type-data-xs bg-accent-tertiary/15 text-accent-tertiary px-2.5 py-0.5 rounded-full font-medium hover:bg-accent-tertiary/25 transition-colors",children:"@RightUp"})]}),t.jsx("div",{className:"type-body-sm text-text-muted mt-1",children:"Built-in pyMC Repeater web interface"}),t.jsx("div",{className:"type-data-xs text-text-muted/60 mt-1 font-mono",children:"/opt/pymc_repeater/repeater/web/html"})]})]}),t.jsxs("label",{className:s("flex items-start gap-3 p-4 bg-subtle-fill radius-card border-2 cursor-pointer transition-base",Fs?"border-transparent hover:border-accent-primary/30":"border-accent-primary bg-accent-primary/5","loading"===zs&&"opacity-50 pointer-events-none"),children:[t.jsx("input",{type:"radio",name:"frontend",checked:!Fs,onChange:()=>Qs(!1),disabled:"loading"===zs,className:"mt-1 h-4 w-4 text-accent-primary focus:ring-accent-primary focus:ring-offset-bg-elevated"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"type-body text-text-primary font-medium",children:"PyMC Console"}),t.jsx("span",{className:"type-data-xs bg-accent-secondary/15 text-accent-secondary px-2.5 py-0.5 rounded-full font-medium",children:"@Treehouse ⚡"})]}),t.jsx("div",{className:"type-body-sm text-text-muted mt-1",children:"Alternative web interface for pyMC Repeater"}),t.jsx("div",{className:"type-data-xs text-text-muted/60 mt-1 font-mono",children:"/opt/pymc_console/web/html"})]})]})]}),!Ps&&t.jsx("div",{className:s("bg-subtle-fill radius-card p-4",Ls?"border border-accent-success/20":"border border-accent-tertiary/20"),children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:s("w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",Ls?"bg-accent-success/20":"bg-accent-tertiary/20"),children:Ls?t.jsx(R,{className:"w-4 h-4 text-accent-success"}):t.jsx(L,{className:"w-4 h-4 text-accent-tertiary"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"type-body text-text-primary font-medium",children:Ls?"PyMC Console has been detected":"PyMC Console Not Installed"}),Ls?t.jsxs("p",{className:"type-body-sm text-text-muted mt-1",children:["PyMC Console is installed at ",t.jsx("code",{className:"type-code bg-accent-success/10 px-1.5 py-0.5 rounded-full text-accent-success",children:"/opt/pymc_console/web/html"})]}):t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"type-body-sm text-text-muted mt-1 mb-3",children:["PyMC Console must be installed at ",t.jsx("code",{className:"type-code bg-accent-tertiary/10 px-1.5 py-0.5 rounded-full text-accent-tertiary",children:"/opt/pymc_console/web/html"})," before selecting this option."]}),t.jsxs("a",{href:"https://github.com/dmduran12/pymc_console-dist",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 h-[32px] px-4 bg-accent-tertiary/10 hover:bg-accent-tertiary/20 text-accent-tertiary rounded-full type-body-sm font-medium transition-colors",children:[t.jsx(O,{className:"w-4 h-4"}),"PyMC Console Install Instructions"]})]})]})]})}),Is&&t.jsx("div",{className:"bg-subtle-fill radius-card p-4 border border-accent-secondary/30",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[t.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-accent-secondary/20 flex items-center justify-center flex-shrink-0",children:t.jsx(z,{className:"w-4 h-4 text-accent-secondary"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"type-body text-text-primary font-medium",children:"Service restart required"}),t.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Web frontend changes will take effect after restarting the pymc-repeater service."})]})]}),t.jsx("button",{onClick:async()=>{if(!Os){qs(!0);try{await async function(){return r("/api/restart_service",{method:"POST",body:"{}"})}(),As(!1),setTimeout(()=>{window.location.reload()},2e3)}catch{As(!1),setTimeout(()=>{window.location.reload()},3e3)}}},disabled:Os,className:"h-[32px] px-4 bg-accent-secondary/10 hover:bg-accent-secondary/20 text-accent-secondary rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 whitespace-nowrap type-body-sm font-medium",children:Os?t.jsxs(t.Fragment,{children:[t.jsx(T,{className:"w-4 h-4 animate-spin"}),"Restarting..."]}):t.jsxs(t.Fragment,{children:[t.jsx(D,{className:"w-4 h-4"}),"Restart Now"]})})]})})]})]})}),I&&t.jsx(M,{template:"auto",children:t.jsx(N,{nodeName:me,repeaterVersion:I.version,coreVersion:I.core_version,localHash:I.local_hash,publicKey:I.public_key})}),I&&(0===(null==de?void 0:de.latitude)||!(null==de?void 0:de.latitude))&&(0===(null==de?void 0:de.longitude)||!(null==de?void 0:de.longitude))&&t.jsx(M,{template:"auto",children:t.jsx(Q,{})})]}),It&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&At(!1),role:"dialog","aria-modal":"true","aria-labelledby":"create-token-modal-title",children:t.jsxs("div",{className:"surface-modal radius-card p-6 max-w-md w-full",children:[t.jsx("h3",{id:"create-token-modal-title",className:"type-subheading text-text-primary mb-4",children:"Create API Token"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Token Name"}),t.jsx("input",{type:"text",value:Ot,onChange:e=>qt(e.target.value),placeholder:"e.g., Production Server, CI/CD Pipeline",className:"w-full px-4 py-2 bg-bg-subtle border-control radius-inner text-text-primary placeholder-text-muted focus:outline-none ring-focus-inset transition-base",onKeyDown:e=>"Enter"===e.key&&ea(),autoFocus:!0}),t.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Give your token a descriptive name to identify its purpose"})]}),t.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[t.jsx("button",{onClick:()=>{At(!1),qt(""),Dt(null)},disabled:Ut,className:"px-4 py-2 bg-bg-subtle hover-bg text-text-secondary radius-inner border-control transition-base disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:ea,disabled:Ut||!Ot.trim(),className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary radius-inner border border-accent-primary/50 transition-base disabled:opacity-50 flex items-center gap-2",children:Ut?t.jsxs(t.Fragment,{children:[t.jsx(T,{className:"w-4 h-4 animate-spin"}),"Creating..."]}):"Create Token"})]})]})]})}),Vt&&Kt&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&$t(!1),role:"dialog","aria-modal":"true","aria-labelledby":"show-token-modal-title",children:t.jsxs("div",{className:"surface-modal radius-card p-6 max-w-lg w-full",children:[t.jsx("h3",{id:"show-token-modal-title",className:"type-subheading text-text-primary mb-4",children:"Token Created Successfully"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"bg-accent-secondary/10 border border-accent-secondary/30 radius-inner p-3",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx(z,{className:"w-4 h-4 text-accent-secondary flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"text-sm text-text-secondary",children:[t.jsx("strong",{children:"Save this token now!"})," For security reasons, it will not be shown again."]})]})}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Your API Token"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{value:Kt,readOnly:!0,className:"flex-1 px-4 py-2 bg-bg-subtle border-control radius-inner text-text-primary font-mono text-sm"}),t.jsxs("button",{onClick:()=>{Kt&&(navigator.clipboard.writeText(Kt),Qt(!0),setTimeout(()=>Qt(!1),2e3))},className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary radius-inner border border-accent-primary/50 transition-base flex items-center gap-2",title:"Copy to clipboard",children:[Wt?t.jsx(F,{className:"w-4 h-4 text-accent-success"}):t.jsx(E,{className:"w-4 h-4"}),Wt?"Copied!":"Copy"]})]})]}),t.jsxs("div",{className:"bg-accent-tertiary/10 border border-accent-tertiary/30 radius-inner p-3",children:[t.jsx("p",{className:"text-sm text-text-secondary mb-2",children:t.jsx("strong",{children:"Usage Example:"})}),t.jsxs("code",{className:"block bg-accent-tertiary/20 px-3 py-2 rounded text-xs text-accent-tertiary font-mono overflow-x-auto",children:['curl -H "X-API-Key: ',Kt.slice(0,12),'..." ',window.location.origin,"/api/stats"]})]}),t.jsx("div",{className:"flex justify-end mt-6",children:t.jsx("button",{onClick:()=>{$t(!1),Ht(null)},className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary radius-inner border border-accent-primary/50 transition-base",children:"Done"})})]})]})}),t.jsx(j,{isOpen:!!Yt,title:"Revoke API Token",message:`Are you sure you want to revoke the token '${null==Yt?void 0:Yt.name}'? This action cannot be undone.`,confirmLabel:Jt?"Revoking...":"Revoke",cancelLabel:"Cancel",variant:"danger",onConfirm:async()=>{if(Yt){Gt(!0),Dt(null);try{await async function(e){return r(`/auth/tokens/${e}`,{method:"DELETE"})}(Yt.id),await Zs(),Bt(null)}catch(e){Dt(e instanceof Error?e.message:"Failed to revoke token")}finally{Gt(!1)}}},onCancel:()=>Bt(null)}),xs&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&ps(!1),role:"dialog","aria-modal":"true","aria-labelledby":"add-key-modal-title",children:t.jsxs("div",{className:"surface-modal radius-card p-6 max-w-md w-full",children:[t.jsx("h3",{id:"add-key-modal-title",className:"type-subheading text-text-primary mb-4",children:"Add Transport Key"}),t.jsxs("div",{className:"space-y-4",children:[os&&t.jsxs("div",{className:"bg-accent-tertiary/10 border border-accent-tertiary/30 radius-inner p-3 text-sm text-text-secondary",children:["Adding as child of: ",t.jsx("strong",{className:"text-text-primary",children:na()})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Key Name"}),t.jsx("input",{type:"text",value:ws,onChange:e=>ks(e.target.value),placeholder:"e.g., Region Name, Group Key",className:"w-full px-4 py-2 bg-bg-subtle border-control radius-inner text-text-primary placeholder-text-muted focus:outline-none ring-focus-inset transition-base",onKeyDown:e=>"Enter"===e.key&&ia(),autoFocus:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Flood Policy"}),t.jsxs("div",{className:"flex bg-bg-subtle radius-inner border-control p-1",children:[t.jsx("button",{onClick:()=>Ss("deny"),className:s("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","deny"===Cs?"bg-accent-danger/20 text-accent-danger border border-accent-danger/50":"text-text-muted hover:text-text-secondary"),children:"DENY"}),t.jsx("button",{onClick:()=>Ss("allow"),className:s("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","allow"===Cs?"bg-accent-success/20 text-accent-success border border-accent-success/50":"text-text-muted hover:text-text-secondary"),children:"ALLOW"})]})]}),t.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[t.jsx("button",{onClick:()=>{ps(!1),ks(""),Ss("deny")},disabled:_s,className:"px-4 py-2 bg-bg-subtle hover-bg text-text-secondary radius-inner border-control transition-base disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:ia,disabled:_s||!ws.trim(),className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary radius-inner border border-accent-primary/50 transition-base disabled:opacity-50 flex items-center gap-2",children:_s?t.jsxs(t.Fragment,{children:[t.jsx(T,{className:"w-4 h-4 animate-spin"}),"Adding..."]}):"Add Key"})]})]})]})}),hs&&fs&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&bs(!1),role:"dialog","aria-modal":"true","aria-labelledby":"edit-key-modal-title",children:t.jsxs("div",{className:"surface-modal radius-card p-6 max-w-md w-full",children:[t.jsx("h3",{id:"edit-key-modal-title",className:"type-subheading text-text-primary mb-4",children:"Edit Transport Key"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Key Name"}),t.jsx("input",{type:"text",value:fs.name,onChange:e=>js({...fs,name:e.target.value}),className:"w-full px-4 py-2 bg-bg-subtle border-control radius-inner text-text-primary focus:outline-none ring-focus-inset transition-base",autoFocus:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Flood Policy"}),t.jsxs("div",{className:"flex bg-bg-subtle radius-inner border-control p-1",children:[t.jsx("button",{onClick:()=>js({...fs,floodPolicy:"deny"}),className:s("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","deny"===fs.floodPolicy?"bg-accent-danger/20 text-accent-danger border border-accent-danger/50":"text-text-muted hover:text-text-secondary"),children:"DENY"}),t.jsx("button",{onClick:()=>js({...fs,floodPolicy:"allow"}),className:s("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","allow"===fs.floodPolicy?"bg-accent-success/20 text-accent-success border border-accent-success/50":"text-text-muted hover:text-text-secondary"),children:"ALLOW"})]})]}),fs.transport_key&&t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Transport Key"}),t.jsx("code",{className:"block bg-bg-subtle px-3 py-2 radius-inner text-xs text-text-muted font-mono overflow-x-auto",children:fs.transport_key})]}),t.jsxs("div",{className:"flex justify-between gap-3 mt-6",children:[t.jsx("button",{onClick:()=>{bs(!1),Ns(fs),gs(!0),js(null)},disabled:_s,className:"px-4 py-2 bg-accent-danger/20 hover:bg-accent-danger/30 text-accent-danger radius-inner border border-accent-danger/50 transition-base disabled:opacity-50",children:"Delete"}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:()=>{bs(!1),js(null)},disabled:_s,className:"px-4 py-2 bg-bg-subtle hover-bg text-text-secondary radius-inner border-control transition-base disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(fs){Ts(!0),rs(null);try{const e=await async function(e,t){return r(`/api/transport_key/${e}`,{method:"PUT",body:JSON.stringify(t)})}(fs.id,{name:fs.name,flood_policy:fs.floodPolicy});e.success?(await aa(),bs(!1),js(null)):rs(e.error||"Failed to update transport key")}catch(e){rs(e instanceof Error?e.message:"Failed to update transport key")}finally{Ts(!1)}}},disabled:_s||!fs.name.trim(),className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary radius-inner border border-accent-primary/50 transition-base disabled:opacity-50 flex items-center gap-2",children:_s?t.jsxs(t.Fragment,{children:[t.jsx(T,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):"Save"})]})]})]})]})}),ys&&vs&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&gs(!1),role:"dialog","aria-modal":"true","aria-labelledby":"delete-key-modal-title",children:t.jsxs("div",{className:"surface-modal radius-card p-6 max-w-md w-full",children:[t.jsx("h3",{id:"delete-key-modal-title",className:"type-subheading text-text-primary mb-4",children:"Delete Transport Key"}),t.jsxs("p",{className:"text-text-secondary mb-4",children:["Are you sure you want to delete ",t.jsxs("strong",{className:"text-text-primary",children:["'",vs.name,"'"]}),"?"]}),vs.children&&vs.children.length>0&&t.jsx("div",{className:"bg-accent-secondary/10 border border-accent-secondary/30 radius-inner p-3 mb-4",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx(z,{className:"w-4 h-4 text-accent-secondary flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"text-sm text-text-secondary",children:["This key has ",vs.children.length," child key(s). Deleting will also remove all children."]})]})}),t.jsxs("div",{className:"flex justify-end gap-3",children:[t.jsx("button",{onClick:()=>{gs(!1),Ns(null)},disabled:_s,className:"px-4 py-2 bg-bg-subtle hover:bg-bg-elevated text-text-secondary rounded-lg border border-border-subtle transition-colors disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(vs){Ts(!0),rs(null);try{const e=await async function(e){return r(`/api/transport_key/${e}`,{method:"DELETE"})}(vs.id);e.success?(await aa(),gs(!1),Ns(null),ds(null)):rs(e.error||"Failed to delete transport key")}catch(e){rs(e instanceof Error?e.message:"Failed to delete transport key")}finally{Ts(!1)}}},disabled:_s,className:"px-4 py-2 bg-accent-danger/20 hover:bg-accent-danger/30 text-accent-danger radius-inner border border-accent-danger/50 transition-base disabled:opacity-50 flex items-center gap-2",children:_s?t.jsxs(t.Fragment,{children:[t.jsx(T,{className:"w-4 h-4 animate-spin"}),"Deleting..."]}):"Delete"})]})]})})]})}export{le as default};
