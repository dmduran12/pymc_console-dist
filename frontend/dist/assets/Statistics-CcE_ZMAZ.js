var e,t,s=Object.defineProperty,a=(e,t,a)=>((e,t,a)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a)(e,"symbol"!=typeof t?t+"":t,a);import{j as n,r,ay as i,H as l,az as o,aA as c,aB as d,aC as m,aD as u,aE as h,aF as p,aG as x,o as g,aH as f,aI as b,aJ as y,aK as v,aL as j,aM as N,a4 as w,J as k,h as M,aa as C,ag as T,aN as S,a8 as P,p as R,C as A,T as $,aO as F,ap as _}from"./vendor-react-CWPBVwgk.js";import{L as D,M as L,N as E,O as W,U as B,p as H,Q as z,S as O,z as V,T as q,d as G,f as U,e as I,u as X,k as K,V as Y,X as J,Y as Q,h as Z,Z as ee}from"./index-BlYVqXhs.js";import{T as te}from"./TimeRangeSelector-B_qs4oni.js";import{u as se}from"./usePolling-BsbqQ0mQ.js";import{a as ae,b as ne,u as re,c as ie,d as le,e as oe,f as ce,s as de,p as me}from"./useThemeColors-f-o_FvwS.js";import{c as ue,R as he,d as pe,L as xe,C as ge,X as fe,Y as be,T as ye,a as ve}from"./recharts-cqZ_RWsW.js";import{a as je,c as Ne,P as we,b as ke}from"./PageLayout-Kh569_kh.js";import{C as Me}from"./CollisionExplorerModal-DFHbJ8T7.js";import{R as Ce,C as Te}from"./Grid-CguXkLgY.js";import"./vendor-core-XI_xDZ-M.js";import"./deckgl-DTsmDcfs.js";import"./leaflet-D_ckmI2R.js";function Se({children:e,centered:t,className:s}){return n.jsx("div",{className:ue("flex-1 min-h-0",t&&"flex items-center justify-center",s),children:e})}const Pe=new class{constructor(){a(this,"caches",new Map),a(this,"lastRadioConfigHash","")}getBucketedStats(e,t,s,a){const n=this.extractRadioConfig(a),r=this.hashRadioConfig(n);r!==this.lastRadioConfigHash&&(this.caches.clear(),this.lastRadioConfigHash=r);const i=60*e/t,l=Math.floor(Date.now()/1e3),o=Math.floor(l/i)*i,c=o-60*e;let d=this.caches.get(e);return d&&d.bucketCount===t&&d.radioConfigHash===r&&Math.abs(d.endTime-o)<i?d&&(d.endTime!==o&&this.shiftTimeWindow(d,c,o),this.processPackets(d,s,n,!1)):(d=this.createCache(e,t,c,o,i,r),this.caches.set(e,d),this.processPackets(d,s,n,!0)),this.toOutputFormat(d)}clear(){this.caches.clear()}createCache(e,t,s,a,n,r){const i=()=>{const e=new Array(t);for(let s=0;s<t;s++)e[s]={count:0,airtime_ms:0,snr_sum:0,rssi_sum:0,signal_count:0};return e};return{minutes:e,bucketCount:t,startTime:s,endTime:a,bucketDuration:n,radioConfigHash:r,lastProcessedTimestamp:0,received:i(),transmitted:i(),forwarded:i(),dropped:i()}}processPackets(e,t,s,a){const{startTime:n,endTime:r,bucketDuration:i,bucketCount:l}=e;for(const o of t){const t=o.timestamp;if(t<n||t>r)continue;if(!a&&t<=e.lastProcessedTimestamp)continue;const c=Math.floor((t-n)/i);if(c<0||c>=l)continue;const d=D(o),m=L(d,{spreadingFactor:s.sf,bandwidthHz:s.bw,codingRate:s.cr,preambleLength:s.preamble}),u=o.packet_origin;"tx_local"===u?(e.transmitted[c].count++,e.transmitted[c].airtime_ms+=m):"tx_forward"===u||o.transmitted?(e.forwarded[c].count++,e.forwarded[c].airtime_ms+=m):o.drop_reason&&(e.dropped[c].count++,e.dropped[c].airtime_ms+=m),"tx_local"!==u&&(e.received[c].count++,e.received[c].airtime_ms+=m,e.received[c].snr_sum+=o.snr||0,e.received[c].rssi_sum+=o.rssi||0,e.received[c].signal_count++),t>e.lastProcessedTimestamp&&(e.lastProcessedTimestamp=t)}}shiftTimeWindow(e,t,s){const{bucketDuration:a,bucketCount:n}=e,r=Math.round((s-e.endTime)/a);if(0!==r){if(r>0&&r<n){for(let t=0;t<n-r;t++)e.received[t]=e.received[t+r],e.transmitted[t]=e.transmitted[t+r],e.forwarded[t]=e.forwarded[t+r],e.dropped[t]=e.dropped[t+r];for(let t=n-r;t<n;t++)e.received[t]={count:0,airtime_ms:0,snr_sum:0,rssi_sum:0,signal_count:0},e.transmitted[t]={count:0,airtime_ms:0,snr_sum:0,rssi_sum:0,signal_count:0},e.forwarded[t]={count:0,airtime_ms:0,snr_sum:0,rssi_sum:0,signal_count:0},e.dropped[t]={count:0,airtime_ms:0,snr_sum:0,rssi_sum:0,signal_count:0}}else{const a=this.createCache(e.minutes,e.bucketCount,t,s,e.bucketDuration,e.radioConfigHash);e.received=a.received,e.transmitted=a.transmitted,e.forwarded=a.forwarded,e.dropped=a.dropped,e.lastProcessedTimestamp=0}e.startTime=t,e.endTime=s}}toOutputFormat(e){const{startTime:t,bucketDuration:s,bucketCount:a}=e,n=e=>{const n=new Array(a);for(let r=0;r<a;r++){const a=e[r],i=t+r*s;n[r]={bucket:r,start:i,end:i+s,count:a.count,airtime_ms:a.airtime_ms,avg_snr:a.signal_count>0?a.snr_sum/a.signal_count:0,avg_rssi:a.signal_count>0?a.rssi_sum/a.signal_count:0}}return n};return{time_range_minutes:e.minutes,bucket_count:e.bucketCount,bucket_duration_seconds:e.bucketDuration,start_time:e.startTime,end_time:e.endTime,received:n(e.received),transmitted:n(e.transmitted),forwarded:n(e.forwarded),dropped:n(e.dropped)}}extractRadioConfig(e){var t;const s=null==(t=null==e?void 0:e.config)?void 0:t.radio;return{sf:(null==s?void 0:s.spreading_factor)??10,bw:(null==s?void 0:s.bandwidth)??25e4,cr:(null==s?void 0:s.coding_rate)??5,preamble:(null==s?void 0:s.preamble_length)??8}}hashRadioConfig(e){return`${e.sf}-${e.bw}-${e.cr}-${e.preamble}`}},Re=3e5;function Ae(e,t,s,a=!0,n=60){const r=[...e].sort((e,t)=>e.start-t.start),i=[...t].sort((e,t)=>e.start-t.start),l=new Map(e.map(e=>[e.start,e])),o=new Map(t.map(e=>[e.start,e])),c=Array.from(new Set([...l.keys(),...o.keys()])).sort((e,t)=>e-t);if(0===c.length)return[];const d=new Float64Array(r.length+1),m=new Float64Array(i.length+1),u=new Float64Array(r.length),h=new Float64Array(i.length);for(let g=0;g<r.length;g++)d[g+1]=d[g]+r[g].airtime_ms,u[g]=r[g].start;for(let g=0;g<i.length;g++)m[g+1]=m[g]+i[g].airtime_ms,h[g]=i[g].start;const p=(e,t)=>{let s=0,a=e.length;for(;s<a;){const n=s+a>>>1;e[n]<t?s=n+1:a=n}return s},x=c.map(e=>{const t=e-300,s=p(u,t),a=p(u,e+1),n=d[a]-d[s],r=p(h,t),i=p(h,e+1),l=m[i]-m[r];return{timestamp:e,rxUtilW:n/Re*100,txUtilW:l/Re*100}});return a&&x.length>1?function(e,t=60){if(0===e.length)return[];const s=1-Math.pow(.5,1/t),a=Math.min(e.length,Math.max(10,Math.floor(t/3)));let n=0,r=0;for(let i=0;i<a;i++)n+=e[i].rxUtilW,r+=e[i].txUtilW;return n/=a,r/=a,e.map(e=>(n=s*e.rxUtilW+(1-s)*n,r=s*e.txUtilW+(1-s)*r,{...e,rxRolling:n,txRolling:r}))}(x,n):x}r.memo(function({options:e,data:t,className:s="",onCreate:a}){const i=r.useRef(null),l=r.useRef(null);return r.useEffect(()=>{const s=i.current;if(!s)return;const n=s.getBoundingClientRect(),r=Math.floor(n.width)||400,o=Math.floor(n.height)||200,c=new E({...e,width:r,height:o},t,s);return l.current=c,null==a||a(c),()=>{c.destroy(),l.current=null}},[e]),r.useEffect(()=>{l.current&&t&&l.current.setData(t)},[t]),r.useEffect(()=>{const e=i.current;if(!e)return;const t=new ResizeObserver(e=>{const t=e[0];if(!t||!l.current)return;const{width:s,height:a}=t.contentRect;s>0&&a>0&&l.current.setSize({width:Math.floor(s),height:Math.floor(a)})});return t.observe(e),()=>{t.disconnect()}},[]),n.jsx("div",{ref:i,className:`w-full h-full ${s}`,style:{minHeight:100}})});const $e=new Map;function Fe(e){var t;if(!e.startsWith("var("))return e;const s=$e.get(e);if(s)return s;const a=e.match(/var\(([^,)]+)(?:,\s*([^)]+))?\)/);if(!a)return e;const n=a[1].trim(),r=(null==(t=a[2])?void 0:t.trim())||"#888888",i=getComputedStyle(document.documentElement).getPropertyValue(n).trim()||r;return $e.set(e,i),i}function _e(e,t,s=!1){if(t.length<2)return;if(e.beginPath(),e.moveTo(t[0].x,t[0].y),2===t.length)return void e.lineTo(t[1].x,t[1].y);const a=.5;for(let n=0;n<t.length-1;n++){const s=t[Math.max(0,n-1)],r=t[n],i=t[n+1],l=t[Math.min(t.length-1,n+2)],o=r.x+(i.x-s.x)/6*a,c=r.y+(i.y-s.y)/6*a,d=i.x-(l.x-r.x)/6*a,m=i.y-(l.y-r.y)/6*a;e.bezierCurveTo(o,c,d,m,i.x,i.y)}s&&e.closePath()}function De(e,t,s,a){return{hooks:{draw:n=>{const r=e.current,i=t.current,l=s.current;if(0===r.length)return;const o=n.ctx,c=n.bbox,d=c.left,m=c.top,u=c.width,h=c.height;if(u<=0||h<=0)return;const p=n.data[0],x=p.length;if(0===x)return;const g=p[0],f=p[x-1]-g||1,b=e=>d+(e-g)/f*u,y=e=>m+h*(1-e/i),v={min:r.map(e=>({x:b(e.timestamp),y:y(e.min)})),max:r.map(e=>({x:b(e.timestamp),y:y(e.max)})),p5:r.map(e=>({x:b(e.timestamp),y:y(e.p5)})),p95:r.map(e=>({x:b(e.timestamp),y:y(e.p95)})),p25:r.map(e=>({x:b(e.timestamp),y:y(e.p25)})),p75:r.map(e=>({x:b(e.timestamp),y:y(e.p75)})),mean:r.map(e=>({x:b(e.timestamp),y:y(e.mean)})),median:r.map(e=>({x:b(e.timestamp),y:y(e.median)})),average:r.map(e=>({x:b(e.timestamp),y:y(e.average)}))},j=(e,t)=>l?l===e?Math.min(1,1.5*t):"minMax"===l||"p5p95"===l||"p25p75"===l?.3*t:t:t,N=e=>l?l===e?1:"mean"===l||"median"===l||"average"===l?.3:1:1,w={band:Fe(a.band),innerBand:Fe(a.innerBand),mean:Fe(a.mean),median:Fe(a.median),average:Fe(a.average)};o.save(),o.strokeStyle=w.average,o.lineWidth=4,o.globalAlpha=N("average"),_e(o,v.average),o.stroke(),o.globalAlpha=j("minMax",.15),o.fillStyle=w.band,o.beginPath(),_e(o,v.max);const k=[...v.min].reverse();for(const e of k)o.lineTo(e.x,e.y);o.closePath(),o.fill(),o.globalAlpha=j("p5p95",.3),o.fillStyle=w.band,o.beginPath(),_e(o,v.p95);const M=[...v.p5].reverse();for(const e of M)o.lineTo(e.x,e.y);o.closePath(),o.fill(),o.globalAlpha=j("p25p75",.55),o.fillStyle=w.innerBand,o.beginPath(),_e(o,v.p75);const C=[...v.p25].reverse();for(const e of C)o.lineTo(e.x,e.y);o.closePath(),o.fill(),o.strokeStyle=w.median,o.lineWidth=1.5,o.globalAlpha=N("median"),o.setLineDash([4,4]),_e(o,v.median),o.stroke(),o.strokeStyle=w.mean,o.lineWidth=1.5,o.globalAlpha=N("mean"),o.setLineDash([]),_e(o,v.mean),o.stroke(),o.restore()}}}}r.memo(function({data:e,maxValue:t,onHover:s,highlightedItem:a=null,bandColor:i="#E12672",innerBandColor:l="#FF2D7A",meanColor:o="#FF6B9D",medianColor:c="#FF85AD",averageColor:d="#FFE135",cursorColor:m="rgba(255,255,255,0.5)"}){const u=r.useRef(null),h=r.useRef(null),p=r.useRef(e),x=r.useRef(t),g=r.useRef(a),f=r.useRef(s),b=r.useRef(e.length);p.current=e,x.current=t,g.current=a,f.current=s;const y=r.useMemo(()=>({band:i,innerBand:l,mean:o,median:c,average:d,cursor:m}),[i,l,o,c,d,m]),v=r.useMemo(()=>[e.map(e=>e.timestamp),e.map(e=>e.max)],[e]),j=r.useMemo(()=>({width:400,height:200,padding:[4,4,4,4],cursor:{show:!0,x:!0,y:!1,drag:{x:!1,y:!1},points:{show:!1}},scales:{x:{time:!0},y:{range:[0,t]}},axes:[{show:!1},{show:!1}],series:[{},{show:!1}],hooks:{setCursor:[e=>{var t,s;const a=e.cursor.idx;null!=a&&a>=0?null==(t=f.current)||t.call(f,a):null==(s=f.current)||s.call(f,null)}]},plugins:[De(p,x,g,y)]}),[t,y]);r.useEffect(()=>{const t=u.current;if(!t||0===e.length)return;const s=b.current,a=e.length,n=Math.abs(a-s);if(!(!h.current||n>100||s>0&&n/s>.1)&&h.current)return h.current.setData(v),void(b.current=a);h.current&&h.current.destroy();const r=t.getBoundingClientRect(),i=Math.floor(r.width)||400,l=Math.floor(r.height)||200,o=new E({...j,width:i,height:l},v,t);return h.current=o,b.current=a,()=>{o.destroy(),h.current=null}},[j,v,e.length]),r.useEffect(()=>{const e=u.current;if(!e)return;const t=new ResizeObserver(e=>{const t=e[0];if(!t||!h.current)return;const{width:s,height:a}=t.contentRect;s>0&&a>0&&h.current.setSize({width:Math.floor(s),height:Math.floor(a)})});return t.observe(e),()=>{t.disconnect()}},[]),r.useEffect(()=>{h.current&&h.current.redraw()},[a,e]);const N=r.useCallback(()=>{null==s||s(null)},[s]);return 0===e.length?n.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No data available"}):n.jsx("div",{ref:u,className:"w-full h-full rounded-2xl overflow-hidden",onMouseLeave:N})});const Le="undefined"!=typeof window&&(null==(t=null==(e=window.matchMedia)?void 0:e.call(window,"(color-gamut: p3)"))?void 0:t.matches);function Ee(){const e=getComputedStyle(document.documentElement);return{fontFamily:e.getPropertyValue("--font-data").trim()||'"JetBrains Mono", ui-monospace, monospace',axisColor:e.getPropertyValue("--chart-axis-tick").trim()||"rgba(255, 255, 255, 0.4)",gridColor:e.getPropertyValue("--chart-grid").trim()||"rgba(255, 255, 255, 0.06)",textMuted:e.getPropertyValue("--text-muted").trim()||"#727272",textPrimary:e.getPropertyValue("--text-primary").trim()||"#FFFFFF"}}const We=["min","max","p75","p95","p99","mean","median","average","midpoint"];let Be=null,He=0;const ze={0:{r:0,g:144,b:255},7:{r:0,g:102,b:204},1:{r:102,g:204,b:255},3:{r:0,g:230,b:153},4:{r:255,g:242,b:0},2:{r:255,g:179,b:0},5:{r:255,g:128,b:192},6:{r:255,g:102,b:0},10:{r:179,g:179,b:179},15:{r:230,g:102,b:204},8:{r:102,g:179,b:255},9:{r:51,g:255,b:179},255:{r:128,g:128,b:128}};function Oe(e){return ze[e]??ze[255]}function Ve(e){const t=Date.now();(!Be||t-He>1e3)&&(Be={green:{r:34,g:197,b:94,p3:"color(display-p3 0.13 0.77 0.37)"},good:{r:132,g:204,b:22,p3:"color(display-p3 0.52 0.80 0.09)"},fair:{r:250,g:204,b:21,p3:"color(display-p3 0.98 0.80 0.08)"},poor:{r:249,g:115,b:22,p3:"color(display-p3 0.98 0.45 0.09)"},critical:{r:239,g:68,b:68,p3:"color(display-p3 0.94 0.27 0.27)"}},He=t);const s=Be;return e>=1?s.critical:e>=.75?s.poor:e>=.5?s.fair:e>=.25?s.good:s.green}function qe(e,t,s,a,n,r,i,l,o,c=null,d=null,m=1,u=null,h="airtime",p=.5){if(0===t.length)return;const x=e.ctx,{left:g,top:f,width:b,height:y}=e.bbox,v=window.devicePixelRatio||1;if(b<=0||y<=0)return;const j=e.data[0],N=j.length;if(0===N)return;const w=j[0],k=j[N-1],M=s,C="share"===h,T=C?function(e){const t=[10,20,25,50,100,200,250,500,1e3],s=e/4.5;for(const a of t)if(a>=s)return a;return e>5e3?1e3*Math.ceil(s/1e3):100*Math.ceil(s/100)}(M):5,S=getComputedStyle(document.documentElement),P=S.getPropertyValue("--signal-critical").trim()||"#EF4444",R=S.getPropertyValue("--bg-elevated").trim()||"#333233";x.save(),x.fillStyle="rgba(0, 0, 0, 0.4)";const A=8*v;if(x.beginPath(),x.roundRect(g,f,b,y,A),x.fill(),x.restore(),!C&&M>=20){x.save();const e=f+y*(1-20/M);x.fillStyle=R,x.globalAlpha=.5,x.fillRect(g,f,b,e-f),x.restore()}x.save(),x.lineWidth=1*v,x.setLineDash([4*v,4*v]);for(let F=T;F<M;F+=T){const e=F/M,t=Math.round(f+y*(1-e))+.5;C||20!==F?(x.strokeStyle=r.textPrimary,x.globalAlpha=.25):(x.strokeStyle=P,x.globalAlpha=1),x.beginPath(),x.moveTo(Math.round(g),t),x.lineTo(Math.round(g+b),t),x.stroke()}x.restore(),x.save(),x.font=`bold ${10*v}px ${r.fontFamily}`,x.fillStyle=r.textPrimary,x.textBaseline="middle",x.textAlign="left";const $=8*v;for(let F=0;F<=M;F+=T){const e=f+y*(1-F/M),t=Math.max(f+$,Math.min(f+y-$,e)),s=C?`${F}B`:`${F}%`;x.fillText(s,0,t)}if(x.restore(),function(e,t,s,a,n,r,i){if(null===t)return;if(t<s||t>s+n)return;const l=getComputedStyle(document.documentElement).getPropertyValue("--text-primary").trim()||"#FFFFFF";e.save(),e.strokeStyle=l,e.globalAlpha=.5,e.lineWidth=1*i,e.setLineDash([4*i,4*i]),e.beginPath(),e.moveTo(Math.round(t)+.5,a),e.lineTo(Math.round(t)+.5,a+r),e.stroke(),e.restore()}(x,u,g,f,b,y,v),i){!function(e,t,s,a,n,r,i=null,l=null,o=1,c=25){const{points:d,rawValues:m,count:u,packetTypes:h,timestamps:p,maxValue:x}=t,g=1*o*(window.devicePixelRatio||1);e.globalCompositeOperation="source-over";const f=i?parseInt(i.replace("TYPE_",""),10):null;for(let b=0;b<u;b++){const t=d[2*b],i=1-m[b]/c,o=s+t*n,u=a+Math.max(0,Math.min(1,i))*r,x=h[b],y=Oe(x);let v=!0;if(l&&p){const e=p[b];v=e>=l.start&&e<l.end}const j=!v||null!==f&&x!==f?.03:.5;e.fillStyle=`rgba(${y.r}, ${y.g}, ${y.b}, ${j})`,e.beginPath(),e.arc(o,u,g,0,2*Math.PI),e.fill()}e.globalCompositeOperation="source-over"}(x,i,g,f,b,y,c,d,m,M),x.save(),x.font=`bold ${9*v}px ${r.fontFamily}`,x.textBaseline="middle",x.textAlign="left";const e=i.maxValue,t=[{pct:0,label:`${e.toFixed(0)}%`},{pct:.25,label:`${(.75*e).toFixed(0)}%`},{pct:.5,label:`${(.5*e).toFixed(0)}%`},{pct:.75,label:`${(.25*e).toFixed(0)}%`},{pct:1,label:"0%"}];for(const{pct:s,label:a}of t){const e=f+y*s,t=Ve(s);x.fillStyle=`rgb(${t.r}, ${t.g}, ${t.b})`,x.fillText(a,g+b+8*v,e)}x.restore()}o&&l&&l.length>0&&function(e,t,s,a,n,r,i,l,o,c,d=.5){if(0===t.length)return;const m=o-l||1,u=function(e,t=1.3,s=.15){const a=function(e){const t=e.match(/color\(display-p3\s+([\d.]+)\s+([\d.]+)\s+([\d.]+)/);if(t){const e=parseFloat(t[1]),s=parseFloat(t[2]),a=parseFloat(t[3]);return{r:Math.round(255*e),g:Math.round(255*s),b:Math.round(255*a),p3r:e,p3g:s,p3b:a}}if(e.startsWith("#")){const t=e.replace("#",""),s=parseInt(t.slice(0,2),16),a=parseInt(t.slice(2,4),16),n=parseInt(t.slice(4,6),16);return{r:s,g:a,b:n,p3r:s/255,p3g:a/255,p3b:n/255}}const s=e.match(/rgba?\(([\d.]+),?\s*([\d.]+),?\s*([\d.]+)/);if(s){const e=Math.round(parseFloat(s[1])),t=Math.round(parseFloat(s[2])),a=Math.round(parseFloat(s[3]));return{r:e,g:t,b:a,p3r:e/255,p3g:t/255,p3b:a/255}}return{r:255,g:255,b:255,p3r:1,p3g:1,p3b:1}}(e),n=function(e,t,s,a=1.25,n=.15){const r=(Math.max(e,t,s)+Math.min(e,t,s))/2;return{p3r:Math.min(1,r+(e-r)*a+n),p3g:Math.min(1,r+(t-r)*a+n),p3b:Math.min(1,r+(s-r)*a+n)}}(a.p3r,a.p3g,a.p3b,t,s);return{r:Math.round(255*Math.min(1,n.p3r)),g:Math.round(255*Math.min(1,n.p3g)),b:Math.round(255*Math.min(1,n.p3b)),p3r:Math.min(1,n.p3r),p3g:Math.min(1,n.p3g),p3b:Math.min(1,n.p3b)}}(getComputedStyle(document.documentElement).getPropertyValue("--signal-critical").trim()||"#EF4444");e.save(),e.globalAlpha=d,e.fillStyle=Le?`color(display-p3 ${u.p3r} ${u.p3g} ${u.p3b})`:`rgb(${u.r}, ${u.g}, ${u.b})`;for(const h of t){if(h.endTs<l||h.startTs>o)continue;const t=a+(Math.max(h.startTs,l)-l)/m*r,s=a+(Math.min(h.endTs,o)-l)/m*r,d=Math.max(s-t,2*c);e.fillRect(t,n,d,i)}e.restore()}(x,l,0,g,f,b,y,w,k,v,d?Math.max(.03,.03*p):p)}const Ge=r.memo(function({data:e,maxValue:t,visibleLines:s=We,highlightedLine:a=null,onHover:i,scatterData:l=null,noiseFloorAnomalies:o=null,showNoiseFloorOverlay:c=!1,overlayOpacity:d=.5,highlightedType:m=null,hoveredTimeRange:u=null,timeRangeHours:h=24,yAxisMode:p="airtime"}){const x=r.useRef(null),g=r.useRef(null),f=r.useRef(e),b=r.useRef(t),y=r.useRef(s),v=r.useRef(a),j=r.useRef(i),N=r.useRef(l),w=r.useRef(o),k=r.useRef(c),M=r.useRef(m),C=r.useRef(u),T=r.useRef(null),S=r.useRef(null),P=r.useRef(p),R=r.useRef(d),A=h<=12?1.2:1,$=r.useRef(A),F=r.useRef(e.length);f.current=e,b.current=t,y.current=s,v.current=a,j.current=i,N.current=l,w.current=o,k.current=c,M.current=m,C.current=u,$.current=A,P.current=p,R.current=d,r.useEffect(()=>{T.current=Ee()},[]);const _=r.useMemo(()=>[e.map(e=>e.timestamp),new Array(e.length).fill(1)],[e]),D=r.useMemo(()=>({hooks:{draw:e=>{const t=T.current||Ee();qe(e,f.current,b.current,y.current,v.current,t,N.current,w.current,k.current,M.current,C.current,$.current,S.current,P.current,R.current)}}}),[]),L=r.useMemo(()=>({width:400,height:200,padding:[8,0,8,28],cursor:{show:!1,x:!1,y:!1,drag:{x:!1,y:!1},points:{show:!1}},scales:{x:{time:!0},y:{range:[0,1]}},axes:[{show:!1},{show:!1}],series:[{},{show:!1}],plugins:[D]}),[D]);r.useEffect(()=>{const t=x.current;if(!t||0===e.length)return;const s=F.current,a=e.length,n=Math.abs(a-s);if(!(!g.current||n>100||s>0&&n/s>.1)&&g.current)return g.current.setData(_),void(F.current=a);g.current&&g.current.destroy();const r=t.getBoundingClientRect(),i=Math.floor(r.width)||400,l=Math.floor(r.height)||200,o=new E({...L,width:i,height:l},_,t);return g.current=o,F.current=a,()=>{o.destroy(),g.current=null}},[L,_,e.length]),r.useEffect(()=>{const e=x.current;if(!e)return;const t=new ResizeObserver(e=>{const t=e[0];if(!t||!g.current)return;const{width:s,height:a}=t.contentRect;s>0&&a>0&&g.current.setSize({width:Math.floor(s),height:Math.floor(a)})});return t.observe(e),()=>{t.disconnect()}},[]),r.useEffect(()=>{g.current&&g.current.redraw()},[a,s,e,l,o,c,d,m,u,A]);const W=r.useCallback(t=>{var s,a;const n=x.current,r=g.current;if(!n||!r||0===e.length)return;const i=n.getBoundingClientRect(),l=t.clientX-i.left,o=window.devicePixelRatio||1,c=r.bbox,d=c.left/o,m=c.width/o;if(l<d||l>d+m)return S.current=null,r.redraw(),void(null==(s=j.current)||s.call(j,null));S.current=l*o;const u=(l-d)/m,h=e.length,p=Math.floor(u*h),f=Math.max(0,Math.min(h-1,p));r.redraw(),null==(a=j.current)||a.call(j,f)},[e.length]),B=r.useCallback(()=>{var e;S.current=null,g.current&&g.current.redraw(),null==(e=j.current)||e.call(j,null)},[]);return 0===e.length?n.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No data available"}):n.jsx("div",{ref:x,className:"w-full h-full rounded-lg overflow-hidden",onMouseMove:W,onMouseLeave:B})}),Ue={[W.REQ]:"var(--pkt-science-req)",[W.ANON_REQ]:"var(--pkt-science-anon-req)",[W.RESPONSE]:"var(--pkt-science-response)",[W.ACK]:"var(--pkt-science-ack)",[W.ADVERT]:"var(--pkt-science-advert)",[W.TXT_MSG]:"var(--pkt-science-txt-msg)",[W.GRP_TXT]:"var(--pkt-science-grp-txt)",[W.GRP_DATA]:"var(--pkt-science-grp-data)",[W.PATH]:"var(--pkt-science-path)",[W.TRACE]:"var(--pkt-science-trace)",[W.MULTIPART]:"var(--pkt-science-multipart)",[W.RAW_CUSTOM]:"var(--pkt-science-raw-custom)"},Ie="var(--pkt-science-unknown)";function Xe(e){return"number"!=typeof e?Ie:Ue[e]??Ie}const Ke=new class{constructor(){a(this,"buckets",new Map),a(this,"lastProcessedTimestamp",0),a(this,"processedPacketCount",0),a(this,"cacheKey",null),a(this,"bucketDuration",60),a(this,"bucketDurationMs",6e4)}getBuckets(e,t,s,a){const n={startTs:t,endTs:s,radioConfigHash:this.hashRadioConfig(a)};return this.isCacheValid(n)?this.processPackets(e,t,s,a,!1):(this.invalidate(n),this.processPackets(e,t,s,a,!0)),this.toBucketDataArray(t,s)}processPackets(e,t,s,a,n){const r=Math.ceil((s-t)/this.bucketDuration);let i=0;for(const l of e){const e=l.timestamp;if(e<t||e>=s)continue;if(!n&&e<=this.lastProcessedTimestamp)continue;const o=Math.min(Math.floor((e-t)/this.bucketDuration),r-1),c=this.buckets.get(o)??{total:0,totalAirtime:0};c.total+=1;const d=D(l);c.totalAirtime+=L(d,{spreadingFactor:a.sf,bandwidthHz:a.bw,codingRate:a.cr,preambleLength:a.preamble}),this.buckets.set(o,c),e>this.lastProcessedTimestamp&&(this.lastProcessedTimestamp=e),i++}this.processedPacketCount+=i}toBucketDataArray(e,t){const s=t-e,a=Math.ceil(s/this.bucketDuration),n=s/3600,r=[];for(let i=0;i<a;i++){const t=e+i*this.bucketDuration,s=new Date(1e3*t),a=n>24?s.toLocaleDateString([],{weekday:"short",hour:"2-digit",minute:"2-digit",hour12:!1}):s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),l=this.buckets.get(i)??{total:0,totalAirtime:0};r.push({timestamp:t,time:a,total:l.total,totalAirtime:l.totalAirtime,bucketDurationMs:this.bucketDurationMs})}return r}isCacheValid(e){return!!this.cacheKey&&this.cacheKey.startTs===e.startTs&&this.cacheKey.endTs===e.endTs&&this.cacheKey.radioConfigHash===e.radioConfigHash}invalidate(e){this.buckets.clear(),this.lastProcessedTimestamp=0,this.processedPacketCount=0,this.cacheKey=e}hashRadioConfig(e){return`${e.sf}-${e.bw}-${e.cr}-${e.preamble}`}clear(){this.buckets.clear(),this.lastProcessedTimestamp=0,this.processedPacketCount=0,this.cacheKey=null}getStats(){return{bucketCount:this.buckets.size,processedPackets:this.processedPacketCount,lastTimestamp:this.lastProcessedTimestamp,cacheKey:this.cacheKey}}};function Ye(e){return H[e]??`TYPE_${e.toString(16).toUpperCase()}`}const Je={sf:10,bw:25e4,cr:5,preamble:8};function Qe(e,t){if(0===e.length)return[];const s=Math.floor((t-1)/2),a=[];for(let n=0;n<e.length;n++){const t=n>=s?e[n-s]:e[0];a.push(e[n]+(e[n]-t))}return function(e,t){if(0===e.length)return[];const s=2/(t+1),a=[e[0]];for(let n=1;n<e.length;n++)a.push(s*e[n]+(1-s)*a[n-1]);return a}(a,t)}function Ze({sortedTypes:e,highlightedType:t,onTypeHover:s,aggregateShares:a,hoverData:i}){const l=r.useMemo(()=>{if(!i)return null;const e=new Map;for(const t of i.items)e.set(t.key,t.value);return e},[i]),o=null!==l;return n.jsx("div",{className:"flex-shrink-0 pt-3 mt-2",children:n.jsx("div",{className:"grid ml-9 gap-y-0.5",style:{gridTemplateColumns:"repeat(auto-fill, minmax(105px, 1fr))"},onMouseLeave:()=>s(null),children:e.map(e=>{const r=Xe(e.typeNum),i=(null==l?void 0:l.get(e.key))??0,c=a.get(e.key)??0,d=o?i:c,m=d>1e-4,u=t===e.key,h=t&&t!==e.key;let p="legend-item";return u?p+=" legend-item-active":h?p+=" legend-item-dimmed":o&&i>1e-4?p+=" legend-item-chart-active":o&&i<=1e-4&&(p+=" legend-item-dimmed"),n.jsxs("div",{className:p,onMouseEnter:()=>s(e.key),children:[n.jsx("div",{className:"w-2.5 h-2.5 rounded flex-shrink-0",style:{backgroundColor:r}}),n.jsx("span",{className:"legend-label",children:e.label}),m&&n.jsxs("span",{className:"legend-value "+(o?"legend-value-live":""),children:[(100*d).toFixed(1),"%"]})]},e.key)})})})}function et({x:e,y:t,width:s,height:a,name:r,size:i,index:l,depth:o,hoveredIndex:c,onHover:d,total:m,typeNum:u}){if(1!==o)return null;const h=null!==c&&!(c===l),p=Xe(u),x=m>0?i/m*100:0,g=s>36&&a>20,f=s>36&&a>32;return n.jsxs("g",{onMouseEnter:e=>d(l,e),onMouseLeave:()=>d(null),style:{cursor:"default"},children:[n.jsx("rect",{x:e,y:t,width:s,height:a,fill:p,opacity:h?.4:1,stroke:"rgba(0,0,0,0.2)",strokeWidth:1,rx:3,style:{transition:"opacity 150ms ease"}}),g&&n.jsxs(n.Fragment,{children:[f&&n.jsxs("text",{x:e+4,y:t+a-4-11,textAnchor:"start",dominantBaseline:"auto",fill:"rgba(0,0,0,0.6)",fontSize:8,fontFamily:"'JetBrains Mono', monospace",fontWeight:500,style:{pointerEvents:"none"},children:[x.toFixed(1),"%"]}),n.jsx("text",{x:e+4,y:t+a-4,textAnchor:"start",dominantBaseline:"auto",fill:"rgba(0,0,0,0.85)",fontSize:9,fontFamily:"'JetBrains Mono', monospace",fontWeight:600,style:{pointerEvents:"none"},children:r})]})]})}function tt({data:e,total:t,color:s,position:a,containerWidth:r}){if(!e||!a)return null;const i=(e.value/t*100).toFixed(1),l=r-a.x<184?Math.max(8,a.x-160-8):a.x+16;return n.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:l,top:Math.max(8,a.y-60)},children:n.jsxs("div",{className:"bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 shadow-xl min-w-[140px]",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[n.jsx("span",{className:"w-2.5 h-2.5 rounded-sm flex-shrink-0",style:{backgroundColor:s}}),n.jsx("span",{className:"type-data-sm font-semibold text-text-primary",children:e.name})]}),n.jsxs("div",{className:"space-y-0.5 type-data-xs text-text-muted",children:[n.jsxs("div",{className:"flex justify-between gap-4",children:[n.jsx("span",{children:"Count"}),n.jsx("span",{className:"text-text-primary tabular-nums font-medium",children:e.value.toLocaleString()})]}),n.jsxs("div",{className:"flex justify-between gap-4",children:[n.jsx("span",{children:"Share"}),n.jsxs("span",{className:"text-text-primary tabular-nums font-medium",children:[i,"%"]})]}),n.jsxs("div",{className:"flex justify-between gap-4",children:[n.jsx("span",{children:"Total"}),n.jsx("span",{className:"text-text-primary tabular-nums font-medium",children:t.toLocaleString()})]})]})]})})}function st({sortedTypes:e,aggregateShares:t}){var s,a,i;const[l,o]=r.useState(null),[c,d]=r.useState(null),[m,u]=r.useState(0),[h,p]=r.useState(null),g=r.useRef(null),f=r.useMemo(()=>e.reduce((e,t)=>e+t.totalCount,0),[e]),b=r.useMemo(()=>e.map((e,t)=>({name:e.label,size:e.totalCount,index:t,typeNum:e.typeNum,key:e.key})),[e]),y=r.useCallback((e,t)=>{if(o(e),t&&null!==e){const e=g.current;if(e){const s=e.getBoundingClientRect();u(s.width),d({x:t.clientX-s.left,y:t.clientY-s.top})}}else d(null)},[]),v=r.useCallback(e=>{if(p(e),e){const t=b.findIndex(t=>t.key===e);o(t>=0?t:null)}else o(null)},[b]),j=null!==l?{name:(null==(s=b[l])?void 0:s.name)??"",value:(null==(a=b[l])?void 0:a.size)??0}:null,N=null!==l?Xe(null==(i=b[l])?void 0:i.typeNum):"";return 0===e.length||0===f?n.jsxs("div",{className:"h-full flex items-center justify-center text-text-muted",children:[n.jsx(x,{className:"w-6 h-6 mr-2 opacity-50"}),n.jsx("span",{children:"No packet type data available"})]}):n.jsxs("div",{className:"flex flex-col",children:[n.jsxs("div",{className:"analyzer-chart-height relative flex-shrink-0",ref:g,children:[n.jsx(he,{width:"100%",height:"100%",children:n.jsx(pe,{data:b,dataKey:"size",aspectRatio:4/3,stroke:"none",isAnimationActive:!1,content:n.jsx(et,{x:0,y:0,width:0,height:0,name:"",size:0,index:0,depth:0,hoveredIndex:l,onHover:y,total:f,typeNum:0})})}),n.jsx(tt,{data:j,total:f,color:N,position:c,containerWidth:m})]}),n.jsx(Ze,{sortedTypes:e,highlightedType:h,onTypeHover:v,aggregateShares:t})]})}function at(e){const{values:t,sum:s}=e;if(0===t.length)return{min:0,mean:0,median:0,p75:0,p95:0,p99:0,max:0};const a=[...t].sort((e,t)=>e-t),n=a.length,r=s/n,i=a[0],l=a[n-1],o=e=>{const t=Math.min(Math.ceil(e*n)-1,n-1);return a[Math.max(0,t)]};return{min:i,mean:r,median:n%2==0?(a[n/2-1]+a[n/2])/2:a[Math.floor(n/2)],p75:o(.75),p95:o(.95),p99:o(.99),max:l}}function nt({statsBuckets:e,bucketData:t,mode:s,packets:a,startTs:i,endTs:l,radioConfig:o,sortedTypes:c,aggregateShares:d,noiseFloorAnomalies:m,showNoiseFloorOverlay:u,overlayOpacity:h=.5}){const[p,g]=r.useState(null),[f,b]=r.useState(null),y=r.useMemo(()=>(l-i)/3600,[i,l]),v=r.useCallback(e=>{b(e)},[]),j=function(e,t,s,a,n){return r.useMemo(()=>{if(0===e.length||!n)return null;const r=e.filter(e=>e.timestamp>=t&&e.timestamp<=s);if(0===r.length)return null;const i=Re,l=[],o=new Map;for(const e of r){const s=e.type??e.payload_type??-1,r=D(e);let i;if(i="airtime"===a?L(r,{spreadingFactor:n.sf,bandwidthHz:n.bw,codingRate:n.cr,preambleLength:n.preamble}):1,r<=0)continue;const c=Math.floor((e.timestamp-t)/300),d={timestamp:e.timestamp,airtimeMs:i,byteSize:r,packetType:s,bucketIndex:c};l.push(d),o.has(c)||o.set(c,[]),o.get(c).push(d)}if(0===l.length)return null;const c=[],d=[],m=[],u=new Map;if("share"===a)for(const[,e]of o)for(const t of e)u.set(t,t.byteSize);else for(const[,e]of o){const t=e.reduce((e,t)=>e+t.airtimeMs,0)/i*100,s=Math.max(...e.map(e=>e.airtimeMs));for(const a of e){const e=a.airtimeMs/s*t;u.set(a,e)}}for(const e of l){const t=u.get(e);void 0!==t&&(c.push(t),d.push(e.timestamp),m.push(e.packetType))}const h=Math.min(...d),p=Math.max(...d),x=p-h||1,g=[...c].sort((e,t)=>e-t),f=g[0],b=g[g.length-1],y=Math.floor(.05*g.length),v=Math.floor(.5*g.length),j=Math.min(Math.ceil(.95*g.length),g.length-1),N=g[y],w=g[v],k=g[j],M=new Map;for(const e of c){const t=Math.round(100*e)/100;M.set(t,(M.get(t)??0)+1)}const C=M.size,T=[...M.entries()].sort((e,t)=>t[1]-e[1]).slice(0,5).map(([e,t])=>({value:e,count:t,percent:t/c.length*100}));let S;if("share"===a){const e=50,t=Math.ceil(b/e)*e;S=Math.max(t,50)}else{const e=5,t=5,s=Math.ceil(b/e)*e;S=Math.max(s+t,10)}const P=new Float32Array(2*c.length),R=new Float32Array(c.length),A=new Uint8Array(c.length),$=new Float32Array(c.length);for(let e=0;e<c.length;e++){const t=(d[e]-h)/x,s=1-Math.max(0,Math.min(S,c[e]))/S;P[2*e]=t,P[2*e+1]=s,R[e]=c[e],A[e]=m[e]>=0?m[e]:255,$[e]=d[e]}return{points:P,rawValues:R,packetTypes:A,timestamps:$,count:c.length,minTime:h,maxTime:p,minValue:0,maxValue:S,rawMinValue:f,rawMaxValue:b,unit:"%",stats:{p5:N,p50:w,p95:k,uniqueValues:C,topValues:T}}},[e,t,s,a,n])}(a,i,l,"share"===s?"share":"airtime",o),{data:N}=r.useMemo(()=>function(e,t){var s;const a=e.length;if(0===a)return{data:[],windowSize:0,windowDurationMs:0};const n=(null==(s=e[0])?void 0:s.bucketDurationMs)??1e3,r=Math.min(Math.max(5,Math.round(3e5/n)),a),i=Math.floor(r/2),l=[];let o=0,c=0;for(let d=0;d<a;d++){const s=e[d],n=Math.max(0,d-i),r=Math.min(a,d+i+1),m=[];let u,h=0;for(let a=n;a<r;a++){const s=e[a];let n;n="share"===t?s.total/Math.max(1,s.bucketDurationMs/1e3):s.totalAirtime/s.bucketDurationMs*100,m.push(n),h+=n}u="share"===t?s.total/Math.max(1,s.bucketDurationMs/1e3):s.totalAirtime/s.bucketDurationMs*100,o+=u,c++;const p=at({values:m,sum:h}),x=(p.min+p.max)/2;l.push({timestamp:s.timestamp,time:s.time,min:p.min,max:p.max,p75:p.p75,p95:p.p95,p99:p.p99,mean:p.mean,median:p.median,average:o/c,midpoint:x})}return{data:l,windowSize:r,windowDurationMs:r*n}}(e,s),[e,s]),w=r.useMemo(()=>N.map(e=>({timestamp:e.timestamp,min:e.min,max:e.max,p75:e.p75,p95:e.p95,p99:e.p99,mean:e.mean,median:e.median,average:e.average,midpoint:e.midpoint})),[N]),k=r.useMemo(()=>(null==j?void 0:j.maxValue)?j.maxValue:"share"===s?200:10,[j,s]),M=r.useCallback(e=>{g(e)},[]),C=r.useMemo(()=>{if(null===p||!N[p])return null;const e=N[p];let t;t=y>=168?75:y>=72?35:y>=24?15:y>=3?10:5;const s=60*t/2,a=e.timestamp;return{start:a-s,end:a+s}},[p,N,y]),T=r.useMemo(()=>{if(null===p||!N[p]||!C)return null;const e=N[p].time,{start:t,end:n}=C,r=a.filter(e=>e.timestamp>=t&&e.timestamp<n);if(0===r.length)return{timestamp:N[p].timestamp,timeLabel:e,items:c.map(e=>({key:e.key,label:e.label,value:0,color:Xe(e.typeNum)}))};const i=new Map,l=new Map;let d=0,m=0;for(const s of r){const e=`TYPE_${s.type??s.payload_type??-1}`;if(i.set(e,(i.get(e)??0)+1),d++,o){const t=D(s),a=L(t,{spreadingFactor:o.sf,bandwidthHz:o.bw,codingRate:o.cr,preambleLength:o.preamble});l.set(e,(l.get(e)??0)+a),m+=a}}const u=c.map(e=>{let t;return t="airtime"===s?m>0?(l.get(e.key)??0)/m:0:d>0?(i.get(e.key)??0)/d:0,{key:e.key,label:e.label,value:t,color:Xe(e.typeNum)}});return{timestamp:N[p].timestamp,timeLabel:e,items:u}},[p,N,C,a,c,s,o]);if(0===N.length)return n.jsxs("div",{className:"h-full flex items-center justify-center text-text-muted",children:[n.jsx(x,{className:"w-6 h-6 mr-2 opacity-50"}),n.jsx("span",{children:"No packet data available"})]});const S=(null==T?void 0:T.timeLabel)??null;return n.jsxs("div",{className:"flex flex-col",children:[n.jsxs("div",{className:"analyzer-chart-height relative flex-shrink-0",children:[n.jsx("div",{className:"absolute inset-0 rounded-lg overflow-hidden",children:n.jsx(Ge,{data:w,maxValue:k,onHover:M,scatterData:j,noiseFloorAnomalies:m,showNoiseFloorOverlay:u,overlayOpacity:h,highlightedType:f,hoveredTimeRange:C,timeRangeHours:y,yAxisMode:"share"===s?"share":"airtime"})}),S&&n.jsx("div",{className:"absolute top-1 right-1 px-2 py-0.5 bg-bg-elevated/90 rounded text-xs text-accent-secondary font-mono pointer-events-none",children:S})]}),n.jsx(Ze,{sortedTypes:c,highlightedType:f,onTypeHover:v,aggregateShares:d,hoverData:T})]})}function rt({mode:e,onChange:t}){return n.jsxs("div",{className:"toggle-group toggle-group-sm",children:[n.jsx("button",{onClick:()=>t("share"),className:"toggle-group-item "+("share"===e?"active":""),children:"Total"}),n.jsx("button",{onClick:()=>t("airtime"),className:"toggle-group-item "+("airtime"===e?"active":""),children:"Airtime"})]})}function it({enabled:e,onChange:t,anomalyCount:s=0,showTuning:a=!1,onTuningChange:r}){return n.jsxs("div",{className:"relative inline-flex items-center gap-1",children:[e&&r&&n.jsx("button",{onClick:()=>r(!a),className:"toggle-group toggle-group-sm "+(a?"active":""),title:a?"Hide tuning panel":"Show tuning panel",children:n.jsx("span",{className:"toggle-group-item "+(a?"active":""),children:n.jsx(i,{className:"w-3.5 h-3.5"})})}),n.jsx("button",{onClick:()=>t(!e),className:"toggle-group toggle-group-sm "+(e?"active":""),title:e?"Hide noise floor anomalies":"Show noise floor anomalies",children:n.jsx("span",{className:"toggle-group-item "+(e?"active":""),children:n.jsx(l,{className:"w-3.5 h-3.5"})})}),s>0&&n.jsx("span",{className:"absolute -top-2 -right-2 min-w-[18px] h-[18px] px-1 rounded-full bg-accent-danger text-white text-[10px] font-bold flex items-center justify-center pointer-events-none z-10",children:s>99?"99+":s})]})}function lt({smoothing:e,onChange:t}){return n.jsxs("div",{className:"toggle-group toggle-group-sm",children:[n.jsx("button",{onClick:()=>t("stats"),className:"toggle-group-item "+("stats"===e?"active":""),title:"Statistics view (scatter plot)",children:n.jsx(o,{className:"w-3.5 h-3.5"})}),n.jsx("button",{onClick:()=>t("raw"),className:"toggle-group-item "+("raw"===e?"active":""),title:"No smoothing (raw values)",children:n.jsx(c,{className:"w-3.5 h-3.5"})}),n.jsx("button",{onClick:()=>t("zlema"),className:"toggle-group-item "+("zlema"===e?"active":""),title:"6-period Zero-Lag EMA (light smoothing)",children:n.jsx(d,{className:"w-3.5 h-3.5"})}),n.jsx("button",{onClick:()=>t("ema"),className:"toggle-group-item "+("ema"===e?"active":""),title:"12-period Zero-Lag EMA (moderate smoothing)",children:n.jsx(m,{className:"w-3.5 h-3.5"})}),n.jsx("button",{onClick:()=>t("smooth"),className:"toggle-group-item "+("smooth"===e?"active":""),title:"24-period Zero-Lag EMA (heavy smoothing)",children:n.jsx(u,{className:"w-3.5 h-3.5"})}),n.jsx("button",{onClick:()=>t("ultra"),className:"toggle-group-item "+("ultra"===e?"active":""),title:"96-period Zero-Lag EMA (ultra smoothing)",children:n.jsx(h,{className:"w-3.5 h-3.5"})}),n.jsx("button",{onClick:()=>t("mosaic"),className:"toggle-group-item "+("mosaic"===e?"active":""),title:"Mosaic view (treemap chart)",children:n.jsx(p,{className:"w-3.5 h-3.5"})})]})}const ot=r.memo(function({packets:e,startTs:t,endTs:s,bucketCount:a,radioConfig:i=Je,mode:l="share",smoothing:o="raw",noiseFloorAnomalies:c=null,showNoiseFloorOverlay:d=!1,overlayOpacity:m=.5}){const u=ae(),[h,p]=r.useState(null),[g,f]=r.useState([]),b=r.useRef(null),y=r.useRef(0);r.useEffect(()=>{const t=Math.abs(e.length-y.current);if(0===t&&g.length>0)return;b.current&&clearTimeout(b.current);const s=t>100?50:500;return b.current=setTimeout(()=>{y.current=e.length,f(e)},s),()=>{b.current&&clearTimeout(b.current)}},[e,g.length]);const v=r.useMemo(()=>function(e){const t=new Map;for(const a of e){const e=a.type??a.payload_type??-1;t.set(e,(t.get(e)??0)+1)}const s=[];for(const[a,n]of t)s.push({typeNum:a,key:`TYPE_${a}`,label:Ye(a),totalCount:n});return s.sort((e,t)=>t.totalCount-e.totalCount)}(g),[g]),j=r.useMemo(()=>function(e,t,s,a,n,r){const i=s-t,l=i/a,o=1e3*l,c=[];for(let d=0;d<a;d++){const e=t+d*l,s=new Date(1e3*e),a=i/3600>24?s.toLocaleDateString([],{weekday:"short",hour:"2-digit",minute:"2-digit",hour12:!1}):s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1});c.push({timestamp:e,time:a,counts:{},shares:{},airtimes:{},total:0,totalAirtime:0,bucketDurationMs:o});for(const t of r)c[d].counts[t.key]=0,c[d].airtimes[t.key]=0}for(const d of e){const e=d.timestamp;if(e<t||e>=s)continue;const r=Math.min(Math.floor((e-t)/l),a-1),i=`TYPE_${d.type??d.payload_type??-1}`;c[r].counts[i]=(c[r].counts[i]??0)+1,c[r].total++;const o=D(d),m=L(o,{spreadingFactor:n.sf,bandwidthHz:n.bw,codingRate:n.cr,preambleLength:n.preamble});c[r].airtimes[i]=(c[r].airtimes[i]??0)+m,c[r].totalAirtime+=m}for(const d of c)for(const e of r)d.total>0?d.shares[e.key]=d.counts[e.key]/d.total*100:d.shares[e.key]=0;return c}(g,t,s,a,i,v),[g,t,s,a,i,v]),N=r.useMemo(()=>Ke.getBuckets(g,t,s,i),[g,t,s,i]),w=r.useMemo(()=>v.reduce((e,t)=>e+t.totalCount,0),[v]),{sortedTypes:k,aggregateShares:M}=r.useMemo(()=>{const e=new Map;if("share"===l){if(w>0)for(const t of v)e.set(t.key,t.totalCount/w)}else{let t=0;const s=new Map;for(const e of j){t+=e.totalAirtime;for(const t of v){const a=s.get(t.key)??0;s.set(t.key,a+(e.airtimes[t.key]??0))}}if(t>0)for(const a of v)e.set(a.key,(s.get(a.key)??0)/t)}return{sortedTypes:[...v].sort((t,s)=>{const a=e.get(t.key)??0;return(e.get(s.key)??0)-a}),aggregateShares:e}},[v,w,l,j]),C=r.useMemo(()=>function(e,t,s,a="raw"){const n=function(e,t,s){if(e.length<=360)return e;const a=Math.ceil(e.length/360),n=[];for(let r=0;r<e.length;r+=a){const t=e.slice(r,Math.min(r+a,e.length));if(0===t.length)continue;const i={timestamp:t[0].timestamp,time:t[0].time,counts:{},shares:{},airtimes:{},total:0,totalAirtime:0,bucketDurationMs:t[0].bucketDurationMs*t.length};for(const e of t){i.total+=e.total,i.totalAirtime+=e.totalAirtime;for(const t of s)i.counts[t.key]=(i.counts[t.key]??0)+(e.counts[t.key]??0),i.airtimes[t.key]=(i.airtimes[t.key]??0)+(e.airtimes[t.key]??0)}for(const e of s)i.shares[e.key]=i.total>0?i.counts[e.key]/i.total*100:0;n.push(i)}return n}(e,0,s),r=n.length,i=s.length,l=Array.from({length:i},()=>new Array(r).fill(0));for(let u=0;u<r;u++){const e=n[u];if("share"===t)for(let t=0;t<i;t++){const a=s[t].key;l[t][u]=e.total>0?(e.counts[a]??0)/e.total:0}else{let t=0;for(let a=0;a<i;a++)t+=e.airtimes[s[a].key]??0;for(let a=0;a<i;a++){const n=s[a].key,r=e.airtimes[n]??0;l[a][u]=t>0?r/t:0}}}const o=Array.from({length:i},()=>new Array(r).fill(0));for(let u=0;u<i;u++)for(let e=0;e<r;e++){let t=0;for(let s=0;s<=u;s++)t+=l[s][e];o[u][e]=t}const c=o.map(e=>function(e,t){switch(t){case"zlema":return Qe(e,6);case"ema":return Qe(e,12);case"smooth":return Qe(e,24);case"ultra":return Qe(e,96);default:return e}}(e,a)),d=Array.from({length:i},()=>new Array(r).fill(0));for(let u=0;u<i;u++)for(let e=0;e<r;e++){const t=u>0?c[u-1][e]:0;let s=c[u][e]-t;s<0&&(s=0),s>1&&(s=1),d[u][e]=s}for(let u=0;u<r;u++){let e=0;for(let t=0;t<i;t++)e+=d[t][u];if(e>0&&Math.abs(e-1)>1e-6){const t=1/e;for(let e=0;e<i;e++)d[e][u]*=t}}const m=[];for(let u=0;u<r;u++){const e={timestamp:n[u].timestamp,time:n[u].time};for(let t=0;t<i;t++)e[s[t].key]=d[t][u];m.push(e)}return m}(j,l,k,o),[j,l,k,o]),T=r.useCallback(e=>{p(e)},[]),[S,P]=r.useState(null),R=r.useCallback(e=>{P(e)},[]),A=r.useMemo(()=>{if(null===S||!C[S])return null;const e=C[S];return{timestamp:e.timestamp,timeLabel:e.time,items:k.map(t=>({key:t.key,label:t.label,value:e[t.key]??0,color:Xe(t.typeNum)}))}},[S,C,k]),$=r.useMemo(()=>({timestamps:C.map(e=>e.timestamp),series:k.map(e=>({key:e.key,label:e.label,color:Xe(e.typeNum),values:C.map(t=>t[e.key]??0)}))}),[C,k]);return 0===g.length?0===e.length?n.jsxs("div",{className:"h-full flex items-center justify-center text-text-muted",children:[n.jsx(x,{className:"w-6 h-6 mr-2 opacity-50"}),n.jsx("span",{children:"No packet data available"})]}):null:"mosaic"===o?n.jsx(st,{sortedTypes:k,aggregateShares:M}):"stats"===o?n.jsx(nt,{statsBuckets:N,bucketData:j,mode:l,packets:g,startTs:t,endTs:s,radioConfig:i,sortedTypes:k,aggregateShares:M,noiseFloorAnomalies:c,showNoiseFloorOverlay:d,overlayOpacity:m}):n.jsxs("div",{className:"flex flex-col",children:[n.jsx("div",{className:"analyzer-chart-height relative flex-shrink-0",children:n.jsx("div",{className:"absolute inset-0 rounded-lg overflow-hidden",children:n.jsx(B,{timestamps:$.timestamps,series:$.series,highlightedKey:h,cursorColor:u.cursor,onHover:R})})}),n.jsx(Ze,{sortedTypes:k,highlightedType:h,onTypeHover:T,aggregateShares:M,hoverData:A})]})});function ct(e){const t=e.match(/\(([^)]+)\)\s*$/);return t?t[1]:e.length>10?e.slice(0,10):e}function dt({x:e,y:t,width:s,height:a,name:r,size:i,index:l,colors:o,depth:c,hoveredIndex:d,onHover:m,total:u}){if(1!==c)return null;const h=null!==d&&!(d===l),p=o[l%o.length],x=u>0?i/u*100:0,g=s>36&&a>20,f=s>36&&a>32,b=ct(r);return n.jsxs("g",{onMouseEnter:e=>m(l,e),onMouseLeave:()=>m(null),style:{cursor:"default"},children:[n.jsx("rect",{x:e,y:t,width:s,height:a,fill:p,opacity:h?.4:1,stroke:"rgba(0,0,0,0.2)",strokeWidth:1,rx:3,style:{transition:"opacity 150ms ease"}}),g&&n.jsxs(n.Fragment,{children:[f&&n.jsxs("text",{x:e+4,y:t+a-4-11,textAnchor:"start",dominantBaseline:"auto",fill:"rgba(0,0,0,0.6)",fontSize:8,fontFamily:"'JetBrains Mono', monospace",fontWeight:500,style:{pointerEvents:"none"},children:[x.toFixed(1),"%"]}),n.jsx("text",{x:e+4,y:t+a-4,textAnchor:"start",dominantBaseline:"auto",fill:"rgba(0,0,0,0.85)",fontSize:9,fontFamily:"'JetBrains Mono', monospace",fontWeight:600,style:{pointerEvents:"none"},children:b})]})]})}function mt({data:e,total:t,color:s,position:a,containerWidth:r}){if(!e||!a)return null;const i=(e.value/t*100).toFixed(1),l=r-a.x<184?Math.max(8,a.x-160-8):a.x+16;return n.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:l,top:Math.max(8,a.y-60)},children:n.jsxs("div",{className:"bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 shadow-xl min-w-[140px]",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[n.jsx("span",{className:"w-2.5 h-2.5 rounded-sm flex-shrink-0",style:{backgroundColor:s}}),n.jsx("span",{className:"type-data-sm font-semibold text-text-primary",children:ct(e.name)})]}),n.jsxs("div",{className:"space-y-0.5 type-data-xs text-text-muted",children:[n.jsxs("div",{className:"flex justify-between gap-4",children:[n.jsx("span",{children:"Count"}),n.jsx("span",{className:"text-text-primary tabular-nums font-medium",children:e.value.toLocaleString()})]}),n.jsxs("div",{className:"flex justify-between gap-4",children:[n.jsx("span",{children:"Share"}),n.jsxs("span",{className:"text-text-primary tabular-nums font-medium",children:[i,"%"]})]}),n.jsxs("div",{className:"flex justify-between gap-4",children:[n.jsx("span",{children:"Total"}),n.jsx("span",{className:"text-text-primary tabular-nums font-medium",children:t.toLocaleString()})]})]})]})})}const ut=r.memo(function({data:e}){var t,s;const[a,i]=r.useState(null),[l,o]=r.useState(null),[c,d]=r.useState(0),m=r.useRef(null),u=ne(),{treemapData:h,total:p}=r.useMemo(()=>{const t=e.reduce((e,t)=>e+t.value,0);return{treemapData:[...e].sort((e,t)=>t.value-e.value).filter(e=>t>0&&e.value/t*100>=.5).map((e,t)=>({name:e.name,size:e.value,index:t})),total:t}},[e]),x=r.useCallback((e,t)=>{if(i(e),t&&null!==e){const e=m.current;if(e){const s=e.getBoundingClientRect();d(s.width),o({x:t.clientX-s.left,y:t.clientY-s.top})}}else o(null)},[]),g=null!==a?{name:(null==(t=h[a])?void 0:t.name)??"",value:(null==(s=h[a])?void 0:s.size)??0}:null,f=null!==a?u[a%u.length]:"";return 0===e.length||0===p?n.jsx("div",{className:"h-56 flex items-center justify-center text-text-muted",children:"No packet type data available"}):n.jsxs("div",{className:"relative treemap-container",style:{height:224},ref:m,children:[n.jsx(he,{width:"100%",height:224,minWidth:1,minHeight:1,children:n.jsx(pe,{data:h,dataKey:"size",aspectRatio:4/3,stroke:"none",isAnimationActive:!1,content:n.jsx(dt,{x:0,y:0,width:0,height:0,name:"",value:0,size:0,index:0,colors:u,depth:0,hoveredIndex:a,onHover:x,total:p})})}),n.jsx(mt,{data:g,total:p,color:f,position:l,containerWidth:c})]})}),ht="airtimeSpectrumBlur";function pt({active:e,payload:t,label:s}){if(!e||!t||0===t.length)return null;const a=t.filter(e=>null!==e.value&&void 0!==e.value);if(0===a.length)return null;const r=s?new Date(1e3*s).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}):"";return n.jsxs("div",{className:"bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 text-sm shadow-xl",children:[n.jsx("div",{className:"font-medium text-text-primary mb-1 font-mono",children:r}),a.map((e,t)=>n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-3 h-0.5",style:{backgroundColor:e.color}}),n.jsxs("span",{className:"text-text-muted",children:[e.name,":"]}),n.jsxs("span",{className:"text-text-primary tabular-nums font-mono",children:[Number(e.value).toFixed(2),"%"]})]},t))]})}function xt({payload:e,showDensityScale:t=!1}){return e?n.jsxs("div",{className:"flex items-center gap-4 justify-start text-xs font-mono pl-11",children:[e.map((e,t)=>n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx("div",{className:"w-4 h-0.5",style:{backgroundColor:e.color}}),n.jsx("span",{className:"text-text-muted",children:e.value})]},t)),t&&n.jsxs("div",{className:"flex items-center gap-1.5 ml-2",children:[n.jsx("div",{className:"w-16 h-2 rounded-sm",style:{background:"linear-gradient(to right, \n                rgb(1,26,51), \n                rgb(53,82,85), \n                rgb(85,121,74), \n                rgb(150,149,53), \n                rgb(228,168,98), \n                rgb(250,195,165)\n              )"}}),n.jsx("span",{className:"text-text-muted",children:"Density"})]})]}):null}const gt=[[1,26,51],[20,43,67],[38,62,79],[53,82,85],[67,102,83],[85,121,74],[112,137,62],[150,149,53],[192,156,58],[228,168,98],[250,195,165]];function ft(e){const t=Math.max(0,Math.min(1,e))*(gt.length-1),s=Math.floor(t),a=Math.min(s+1,gt.length-1),n=t-s;return`rgb(${Math.round(gt[s][0]+n*(gt[a][0]-gt[s][0]))},${Math.round(gt[s][1]+n*(gt[a][1]-gt[s][1]))},${Math.round(gt[s][2]+n*(gt[a][2]-gt[s][2]))})`}const bt=r.memo(function({samples:e,startTs:t,endTs:s,yMax:a}){const i=re(),l=ie(),o=le(),c=r.useMemo(()=>void 0!==a?a:function(e){if(0===e.length)return 10;let t=0;for(const n of e){const e=n.rxRolling??n.rxUtilW;e>t&&(t=e)}const s=1.05*t,a=Math.ceil(s);return Math.max(1,a)}(e),[a,e]),d=l.critical,m=i.neutral,{cells:u,cellWidth:h,cellHeight:p}=r.useMemo(()=>function(e,t,s,a,n=120,r=30){const i=100/n+.5+"%",l=100/r+.5+"%";if(0===e.length||s<=t)return{cells:[],cellWidth:i,cellHeight:l};const o=s-t,c=r*n,d=new Float32Array(c),m=new Float32Array(c),u=(e,t)=>e*n+t;for(let v=0;v<e.length;v++){const i=e[v];if(i.timestamp<t||i.timestamp>s)continue;const l=Math.floor((i.timestamp-t)/o*(n-1)),c=Math.max(0,Math.min(n-1,l));if(i.rxUtilW>0){const e=Math.min(i.rxUtilW/a,1),t=Math.floor((1-e)*(r-1));for(let s=t;s<r;s++){const e=r-1-t,a=e>0?1-(s-t)/e*.7:1;d[u(s,c)]+=a}}if(i.txUtilW>0){const e=Math.min(i.txUtilW/a,1),t=Math.floor((1-e)*(r-1));for(let s=t;s<r;s++){const e=r-1-t,a=e>0?1-(s-t)/e*.7:1;m[u(s,c)]+=a}}}const h=[];for(let v=0;v<c;v++)d[v]>0&&h.push(d[v]),m[v]>0&&h.push(m[v]);h.sort((e,t)=>e-t);const p=h.length>0?h[Math.floor(.95*h.length)]:1,x=new Array(n),g=new Array(r),f=100/n,b=100/r;for(let v=0;v<n;v++)x[v]=v*f+"%";for(let v=0;v<r;v++)g[v]=v*b+"%";const y=[];for(let v=0;v<r;v++)for(let e=0;e<n;e++){const t=u(v,e),s=d[t]+.3*m[t];if(s>0&&p>0){const t=Math.min(s/p,1.5),a=Math.sqrt(t/1.5);y.push({xPct:x[e],yPct:g[v],intensity:a})}}return{cells:y,cellWidth:i,cellHeight:l}}(e,t,s,100,80,10),[e,t,s]),x=r.useMemo(()=>{if(0===e.length)return[];const t=e.filter(e=>"number"==typeof e.timestamp&&!isNaN(e.timestamp));if(t.length<=500)return t.map(e=>{const t=e.rxRolling??e.rxUtilW,s=e.txRolling??e.txUtilW;return{timestamp:e.timestamp,rx:"number"!=typeof t||isNaN(t)?0:t,tx:"number"!=typeof s||isNaN(s)?0:s}});const s=Math.ceil(t.length/250),a=[];for(let e=0;e<t.length;e+=s){const n=t.slice(e,Math.min(e+s,t.length));if(0===n.length)continue;let r=1/0,i=-1/0,l=n[0],o=n[0];for(const e of n){const t=e.rxRolling??e.rxUtilW;t<r&&(r=t,l=e),t>i&&(i=t,o=e)}const c=l.timestamp<o.timestamp?[l,o]:[o,l];l===o&&(c.length=1);for(const e of c){const t=e.rxRolling??e.rxUtilW,s=e.txRolling??e.txUtilW;a.push({timestamp:e.timestamp,rx:"number"!=typeof t||isNaN(t)?0:t,tx:"number"!=typeof s||isNaN(s)?0:s})}}return a},[e]),f=r.useMemo(()=>{const e=s-t,a=e/3600;return[0,.25,.5,.75,1].map(s=>{const n=new Date(1e3*(t+e*s)),r=n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),i=n.toLocaleDateString([],{weekday:"short"});return{pct:s,label:a>24?`${i} ${r}`:r}})},[t,s]);return 0===e.length?n.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No traffic data available"}):n.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[n.jsx("div",{className:"flex items-center flex-shrink-0 text-text-muted",style:{height:20,paddingLeft:44,paddingRight:8},children:n.jsx("div",{className:"relative w-full h-full flex items-center",children:f.map((e,t)=>n.jsxs("div",{className:"absolute flex items-center gap-1 type-data-xs",style:{left:100*e.pct+"%",transform:0===e.pct?"translateX(0)":1===e.pct?"translateX(-100%)":"translateX(-50%)"},children:[n.jsx(g,{className:"w-2.5 h-2.5 opacity-60"}),n.jsx("span",{className:"tabular-nums",children:e.label})]},t))})}),n.jsx("div",{className:"relative",style:{height:160},children:n.jsx(he,{width:"100%",height:160,minWidth:1,minHeight:1,children:n.jsxs(xe,{data:x,margin:{top:4,right:8,bottom:0,left:0},children:[n.jsx(ge,{strokeDasharray:"3 3",stroke:o.primary,strokeOpacity:.15,vertical:!1}),n.jsx(fe,{dataKey:"timestamp",type:"number",domain:[t,s],axisLine:!1,tickLine:!1,tick:!1,height:0}),n.jsx(be,{axisLine:!1,tickLine:!1,tick:{fill:o.primary,fontSize:10,fontFamily:"'JetBrains Mono', monospace"},dx:-8,width:44,tickFormatter:e=>`${e.toFixed(0)}%`,domain:[0,c]}),n.jsx(ye,{content:n.jsx(pt,{})}),n.jsx(ve,{type:"linear",dataKey:"rx",name:"RX Avg",stroke:d,strokeWidth:2.5,strokeOpacity:.9,dot:!1,connectNulls:!1,isAnimationActive:!1}),n.jsx(ve,{type:"linear",dataKey:"tx",name:"TX Avg",stroke:m,strokeWidth:2.5,strokeOpacity:.9,dot:!1,connectNulls:!1,isAnimationActive:!1})]})})}),n.jsx("div",{className:"relative overflow-hidden",style:{height:32,marginLeft:44,marginRight:8},children:n.jsxs("svg",{className:"absolute inset-0 w-full h-full",preserveAspectRatio:"none","aria-hidden":"true",children:[n.jsx("defs",{children:n.jsx("filter",{id:ht,x:"-100%",y:"-100%",width:"300%",height:"300%",children:n.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"1 3"})})}),n.jsx("g",{filter:`url(#${ht})`,children:u.map((e,t)=>n.jsx("rect",{x:e.xPct,y:e.yPct,width:h,height:p,fill:ft(e.intensity),opacity:.9},`cell-${t}`))})]})}),n.jsx("div",{className:"flex-shrink-0",style:{height:24,marginTop:8},children:n.jsx(xt,{payload:[{value:`RX (${Math.round(5)}m)`,color:d},{value:`TX (${Math.round(5)}m)`,color:m}],showDensityScale:!0})})]})}),yt={"1x":1,"2x":2,"4x":4,"8x":8,"16x":16,"36x":36},vt=[1,5,10,25,50,100,150];function jt(e,t,s,a){const n=Math.PI/180,r=(a-t)*n,i=e*n,l=s*n,o=Math.sin(r)*Math.cos(l),c=Math.cos(i)*Math.sin(l)-Math.sin(i)*Math.cos(l)*Math.cos(r);return(180*Math.atan2(o,c)/Math.PI+360)%360}function Nt(e,t,s,a){const n=Math.PI/180,r=(s-e)*n,i=(a-t)*n,l=Math.sin(r/2)**2+Math.cos(e*n)*Math.cos(s*n)*Math.sin(i/2)**2;return 12742*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}const wt=[{min:10,label:"Excellent"},{min:7,label:"Very Good"},{min:4,label:"Good"},{min:1,label:"Fair+"},{min:-2,label:"Fair"},{min:-5,label:"Fair-"},{min:-8,label:"Poor"},{min:-11,label:"Bad"},{min:-1/0,label:"Critical"}];function kt(e,t){return t[de(e)]||"#808080"}const Mt=r.memo(function({neighbors:e,quickNeighbors:t,localLat:s,localLon:a,onStatsChange:i}){const[l,o]=r.useState(null),[c,d]=r.useState(new Set),[m,u]=r.useState({width:0,height:0}),[h,p]=r.useState("1x"),[x,g]=r.useState(1),b=r.useRef(null),y=r.useRef({}),v=r.useRef(null),j=r.useRef(null),N=r.useRef(x);N.current=x;const w=oe(),k=ie(),M=ce(),C=le();r.useEffect(()=>{const e=j.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e){const{width:e,height:s}=t.contentRect;e>0&&s>0&&u({width:e,height:s})}});t.observe(e);const s=e.getBoundingClientRect();return s.width>0&&s.height>0&&u({width:s.width,height:s.height}),()=>t.disconnect()},[]);const T=r.useMemo(()=>{const e=new Set;if(t)for(const s of t)e.add(s.hash);return e},[t]),S=r.useMemo(()=>{const e=new Map;if(t)for(const s of t)e.set(s.hash,{snr:s.avgSnr,rssi:s.avgRssi});return e},[t]),{processedNeighbors:P,maxDistance:R,totalNeighbors:A,zeroHopCount:$}=r.useMemo(()=>{const t=[];for(const[r,i]of Object.entries(e)){if(!i.latitude||!i.longitude||0===i.latitude||0===i.longitude)continue;if(!T.has(r))continue;const e=jt(s,a,i.latitude,i.longitude),n=Nt(s,a,i.latitude,i.longitude),l=S.get(r);t.push({hash:r.slice(0,8),name:i.node_name||i.name||"Unknown",snr:(null==l?void 0:l.snr)??i.snr??null,rssi:(null==l?void 0:l.rssi)??i.rssi??null,bearing:e,distance:n,normalizedDistance:0,lastSeen:i.last_seen,isZeroHop:!0})}const n=1.08*(t.length>0?Math.max(...t.map(e=>e.distance)):0);return t.sort((e,t)=>(e.snr??-1/0)-(t.snr??-1/0)),{processedNeighbors:t,maxDistance:n,totalNeighbors:t.length,zeroHopCount:t.length}},[e,s,a,T,S]);r.useEffect(()=>{null==i||i({zeroHopCount:$,totalCount:A,maxDistanceKm:R})},[$,A,R]),r.useEffect(()=>{const e=yt[h],t=N.current;b.current&&cancelAnimationFrame(b.current);const s=performance.now(),a=n=>{const r=n-s,i=Math.min(r/400,1),l=(o=i)<.5?8*o*o*o*o:1-Math.pow(-2*o+2,4)/2;var o;g(t+(e-t)*l),b.current=i<1?requestAnimationFrame(a):null};return b.current=requestAnimationFrame(a),()=>{b.current&&cancelAnimationFrame(b.current)}},[h]);const F=R/x,_=r.useMemo(()=>vt.filter(e=>e<=1.1*F),[F]);r.useEffect(()=>{const e=[];for(const s of P){const t=y.current[s.hash];void 0!==t&&t!==s.lastSeen&&e.push(s.hash),y.current[s.hash]=s.lastSeen}if(0===e.length)return;queueMicrotask(()=>{d(t=>new Set([...t,...e]))});const t=setTimeout(()=>{d(t=>{const s=new Set(t);return e.forEach(e=>s.delete(e)),s})},600);return()=>clearTimeout(t)},[P]);const D=0!==s&&0!==a,L=r.useMemo(()=>{const{width:e,height:t}=m,s=e/2,a=t/2,n=Math.max(10,e/2-12),r=Math.max(10,t/2-12),i=Math.max(10,n-16),l=Math.max(10,r-16);return{width:e,height:t,centerX:s,centerY:a,maxRadiusX:i,maxRadiusY:l,labelRadiusX:n,labelRadiusY:r,cornerRadius:.2*Math.min(i,l)}},[m]),{width:E,height:W,centerX:B,centerY:H,maxRadiusX:z,maxRadiusY:O,labelRadiusX:V,labelRadiusY:q,cornerRadius:G}=L,U=r.useCallback((e,t=1)=>{const s=z*t,a=O*t,n=Math.min(G*t,s,a),r=(e%360+360)%360,i=r*Math.PI/180,l=180*Math.atan2(a-n,s-n)/Math.PI;let o,c;if(r<=45-l||r>315+l){const e=Math.tan(i);o=Math.max(B-s+n,Math.min(B+s-n,B+a*e*(s/a))),c=H-a}else if(r>45-l&&r<=45+l)o=B+s-n+n*Math.sin(i),c=H-a+n-n*Math.cos(i);else if(r>45+l&&r<=135-l){const e=1/Math.tan(i);c=Math.max(H-a+n,Math.min(H+a-n,H-s*e*(a/s))),o=B+s}else if(r>135-l&&r<=135+l)o=B+s-n+n*Math.sin(i),c=H+a-n-n*Math.cos(i);else if(r>135+l&&r<=225-l){const e=Math.tan(i);o=Math.max(B-s+n,Math.min(B+s-n,B-a*e*(s/a))),c=H+a}else if(r>225-l&&r<=225+l)o=B-s+n+n*Math.sin(i),c=H+a-n-n*Math.cos(i);else if(r>225+l&&r<=315-l){const e=1/Math.tan(i);c=Math.max(H-a+n,Math.min(H+a-n,H-s*e*(a/s))),o=B-s}else o=B-s+n+n*Math.sin(i),c=H-a+n-n*Math.cos(i);return{x:o,y:c}},[B,H,z,O,G]),I=r.useCallback((e,t)=>{const s=U(e,1);return{x:B+(s.x-B)*t,y:H+(s.y-H)*t}},[U,B,H]),X=r.useCallback(e=>({N:{x:B,y:H-q},S:{x:B,y:H+q},E:{x:B+V,y:H},W:{x:B-V,y:H},NE:{x:B+V,y:H-q},SE:{x:B+V,y:H+q},SW:{x:B-V,y:H+q},NW:{x:B-V,y:H-q}}[e]),[B,H,V,q]),K=r.useCallback(e=>{const t=z*e,s=O*e,a=Math.min(G*e,t,s),n=B-t,r=B+t,i=H-s,l=H+s;return[`M ${n+a} ${i}`,`L ${r-a} ${i}`,`Q ${r} ${i} ${r} ${i+a}`,`L ${r} ${l-a}`,`Q ${r} ${l} ${r-a} ${l}`,`L ${n+a} ${l}`,`Q ${n} ${l} ${n} ${l-a}`,`L ${n} ${i+a}`,`Q ${n} ${i} ${n+a} ${i}`,"Z"].join(" ")},[B,H,z,O,G]),Y=r.useCallback(e=>{o(e)},[]),J=r.useCallback(e=>{p(e)},[]),Q=r.useCallback(e=>R<=0?0:e/R*x,[R,x]),Z=e=>`${e}km`,ee=r.useMemo(()=>{const e=_.map(e=>{const t=e/R*x;return{km:e,scale:t,labelY:H-O*t*.71}}).filter(e=>e.scale<=1.05&&e.scale>=.02).sort((e,t)=>t.km-e.km),t=[];for(const s of e)t.some(e=>Math.abs(e.labelY-s.labelY)<28)||t.push(s);return t},[_,R,x,H,O]),te=m.width>0&&m.height>0;return D?0===A?n.jsxs("div",{ref:v,className:"flex flex-col items-center justify-center h-full text-text-muted",children:[n.jsx(f,{className:"w-8 h-8 mb-2 opacity-50"}),n.jsx("p",{children:"No nodes with location data"})]}):n.jsxs("div",{ref:v,className:"relative h-full w-full flex overflow-hidden",children:[n.jsx("div",{ref:j,className:"relative flex-1 min-w-0 h-full",children:te&&n.jsxs("svg",{width:E,height:W,className:"absolute inset-0 z-0",children:[n.jsxs("defs",{children:[n.jsx("style",{children:"\n                @keyframes neighbor-blink-scale {\n                  0%, 100% {\n                    transform: scale(1);\n                    opacity: 0;\n                  }\n                  50% {\n                    transform: scale(1.3);\n                    opacity: 0.8;\n                  }\n                }\n                .neighbor-blink-ring {\n                  transform-origin: center;\n                  animation: neighbor-blink-scale 600ms ease-out forwards;\n                }\n              "}),n.jsx("clipPath",{id:"radar-clip",children:n.jsx("path",{d:K(1)})})]}),_.map(e=>{const t=Q(e);if(t>1.05||t<.02)return null;const s=ee.some(t=>t.km===e),a=B+z*t*.71,r=H-O*t*.71;return n.jsxs("g",{children:[n.jsx("path",{d:K(t),fill:"none",stroke:C.primary,strokeOpacity:.15,strokeWidth:1}),s&&n.jsx("text",{x:a+4,y:r-2,textAnchor:"start",dominantBaseline:"auto",className:"fill-text-secondary",fontSize:10,fontFamily:"'JetBrains Mono', monospace",children:Z(e)})]},`ring-${e}`)}),["N","E","S","W"].map(e=>{const t="N"===e||"S"===e,s=t?B:"E"===e?B+z:B-z,a=t?"N"===e?H-O:H+O:H;return n.jsx("line",{x1:B,y1:H,x2:s,y2:a,stroke:C.primary,strokeOpacity:.15,strokeWidth:1,strokeDasharray:"4 4"},e)}),["NE","SE","SW","NW"].map(e=>{const t=X(e);return n.jsx("line",{x1:B,y1:H,x2:t.x,y2:t.y,stroke:C.primary,strokeOpacity:.08,strokeWidth:1,strokeDasharray:"4 4"},`diag-${e}`)}),["N","E","S","W"].map(e=>{const t=X(e),s="E"===e?"end":"W"===e?"start":"middle",a="N"===e?"hanging":"S"===e?"auto":"middle";return n.jsx("text",{x:t.x,y:t.y,textAnchor:s,dominantBaseline:a,fill:k.critical,fontSize:16,fontWeight:600,fontFamily:"'JetBrains Mono', monospace","aria-hidden":"true",children:e},e)}),["NE","SE","SW","NW"].map(e=>{const t=X(e),s="NE"===e||"SE"===e?"end":"start",a="NE"===e||"NW"===e?"hanging":"auto";return n.jsx("text",{x:t.x,y:t.y,textAnchor:s,dominantBaseline:a,fill:k.critical,fontSize:16,fontWeight:600,fontFamily:"'JetBrains Mono', monospace","aria-hidden":"true",children:e},e)}),n.jsx("circle",{cx:B,cy:H,r:5,fill:M.chart6,stroke:"rgba(255,255,255,0.3)",strokeWidth:1,role:"img","aria-label":"Local node"}),n.jsx("g",{clipPath:"url(#radar-clip)",children:P.map(e=>{const t=R>0?e.distance/R*x:0;if(t>1)return null;const{x:s,y:a}=I(e.bearing,t),r=null!==e.snr?kt(e.snr,w):"#808080",i=(null==l?void 0:l.hash)===e.hash,o=c.has(e.hash);return n.jsxs("g",{role:"img","aria-label":`${e.name}: ${e.distance.toFixed(1)}km ${e.bearing.toFixed(0)}`,children:[o&&n.jsx("circle",{cx:s,cy:a,r:10.5,fill:"none",stroke:"rgba(255,255,255,0.9)",strokeWidth:2,className:"neighbor-blink-ring"}),i&&n.jsx("circle",{cx:s,cy:a,r:10.5,fill:r,opacity:.3}),n.jsx("circle",{cx:s,cy:a,r:i?7:5,fill:r,stroke:"rgba(0,0,0,0.5)",strokeWidth:1,style:{cursor:"pointer",transition:"r 0.15s"},onMouseEnter:()=>Y(e),onMouseLeave:()=>Y(null)})]},e.hash)})})]})}),n.jsx("div",{className:"flex flex-col h-full items-stretch gap-1 py-2 pl-2 flex-shrink-0",role:"group","aria-label":"Zoom level",children:["1x","2x","4x","8x","16x","36x"].map(e=>n.jsx("button",{onClick:()=>J(e),"aria-pressed":h===e,className:"flex flex-1 items-center justify-center px-1.5 text-xs font-medium rounded transition-colors "+(h===e?"bg-accent-primary/20 text-accent-primary":"bg-white/5 text-text-muted hover:bg-white/10 hover:text-text-secondary"),children:e},e))}),l&&n.jsxs("div",{className:"absolute bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 text-sm pointer-events-none z-10 shadow-xl",style:{left:"50%",bottom:8,transform:"translateX(-50%)"},children:[n.jsx("div",{className:"font-medium text-text-primary",children:l.name}),n.jsx("div",{className:"text-text-muted text-xs font-mono",children:l.hash}),null!==l.snr?n.jsx("div",{className:"flex gap-3 mt-1 text-xs",children:n.jsxs("span",{children:[n.jsx("span",{className:"text-text-muted",children:"SNR:"})," ",n.jsxs("span",{className:"tabular-nums",style:{color:kt(l.snr,w)},children:[l.snr.toFixed(1)," dB"]}),n.jsxs("span",{className:"text-text-muted ml-1",children:["(",(se=l.snr,(null==(ae=wt.find(e=>se>=e.min))?void 0:ae.label)??"Critical"),")"]})]})}):n.jsx("div",{className:"text-xs text-text-muted mt-1",children:"No SNR data"}),n.jsxs("div",{className:"flex gap-3 text-xs",children:[n.jsxs("span",{children:[n.jsx("span",{className:"text-text-muted",children:"Distance:"})," ",n.jsxs("span",{className:"tabular-nums text-text-secondary",children:[l.distance.toFixed(2)," km"]})]}),n.jsxs("span",{children:[n.jsx("span",{className:"text-text-muted",children:"Bearing:"})," ",n.jsxs("span",{className:"tabular-nums text-text-secondary",children:[l.bearing.toFixed(0),""]})]})]})]})]}):n.jsxs("div",{ref:v,className:"flex flex-col items-center justify-center h-full text-text-muted",children:[n.jsx(f,{className:"w-8 h-8 mb-2 opacity-50"}),n.jsx("p",{children:"Local node coordinates not configured"}),n.jsx("p",{className:"text-xs mt-1",children:"Set latitude/longitude in config to enable"})]});var se,ae});function Ct(e,t){if(0===e.length)return 0;const s=t/100*(e.length-1),a=Math.floor(s),n=Math.ceil(s);return a===n?e[a]:e[a]+(e[n]-e[a])*(s-a)}const Tt=r.memo(function({timestamps:e,values:t,onStatsChange:s}){var a,i;const l=ie(),[o,c]=r.useState(!0),d=r.useMemo(()=>{if(0===t.length)return null;const e=Math.min(...t),s=Math.max(...t),a=t.reduce((e,t)=>e+t,0)/t.length,n=[...t].sort((e,t)=>e-t);return{min:e,max:s,avg:a,p5:Ct(n,5),p95:Ct(n,95)}},[t]);r.useEffect(()=>{null==s||s(d)},[d]);const m=r.useCallback(()=>{c(e=>!e)},[]),{heatmapData:u,xLabels:h,yLabels:p}=r.useMemo(()=>{if(0===e.length||0===t.length||!d)return{heatmapData:null,xLabels:[],yLabels:[]};let s,a;if(o){const e=.1*(d.p95-d.p5||1);s=d.p5-e,a=d.p95+e}else{const e=.1*(d.max-d.min||1);s=d.min-e,a=d.max+e}const n=a-s,r=e[0],i=e[e.length-1]-r||1,l=new Float32Array(2*e.length);for(let o=0;o<e.length;o++){const c=(e[o]-r)/i,d=1-(Math.max(s,Math.min(a,t[o]))-s)/n;l[2*o]=c,l[2*o+1]=d}const c=[];for(let e=0;e<=5;e++){const t=r+i*e/5;c.push({pos:e/5*100,label:new Date(1e3*t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})}const m=[];for(let e=0;e<=4;e++){const t=s+n*e/4;m.push({pos:100*(1-e/4),label:`${Math.round(t)}`})}return{heatmapData:{points:l,count:e.length},xLabels:c,yLabels:m}},[e,t,d,o]),x=r.useRef(null),g=r.useRef(null),[f,v]=r.useState({width:0,height:0}),j=l.critical,N=r.useMemo(()=>me(j)??{r:225,g:38,b:114},[j]);return r.useEffect(()=>{const e=g.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e){const{width:e,height:s}=t.contentRect;e>0&&s>0&&v({width:e,height:s})}});t.observe(e);const s=e.getBoundingClientRect();return s.width>0&&s.height>0&&v({width:s.width,height:s.height}),()=>t.disconnect()},[]),r.useEffect(()=>{const e=x.current;if(!e||!u||0===f.width)return;const t=e.getContext("2d");if(!t)return;const{width:s,height:a}=f,n=window.devicePixelRatio||1;e.width=s*n,e.height=a*n,e.style.width=`${s}px`,e.style.height=`${a}px`,t.scale(n,n),t.clearRect(0,0,s,a);const{points:r,count:i}=u,{r:l,g:o,b:c}=N,d=Math.max(3,Math.min(8,s/i*4));t.globalCompositeOperation="source-over";for(let m=0;m<i;m++){const e=r[2*m]*s,n=r[2*m+1]*a,i=t.createRadialGradient(e,n,0,e,n,d);i.addColorStop(0,`rgba(${l}, ${o}, ${c}, 0.8)`),i.addColorStop(.19,`rgba(${l}, ${o}, ${c}, 0.8)`),i.addColorStop(.2,`rgba(${l}, ${o}, ${c}, 0.1)`),i.addColorStop(1,`rgba(${l}, ${o}, ${c}, 0)`),t.fillStyle=i,t.beginPath(),t.arc(e,n,d,0,2*Math.PI),t.fill()}},[u,f,N]),u?n.jsxs("div",{className:"relative w-full h-full",role:"img","aria-label":`RF noise floor heatmap showing values from ${(null==(a=null==d?void 0:d.min)?void 0:a.toFixed(0))??"N/A"} to ${(null==(i=null==d?void 0:d.max)?void 0:i.toFixed(0))??"N/A"} dBm`,children:[n.jsx("div",{className:"absolute top-0 left-0 flex flex-col justify-between",style:{width:32,bottom:20},"aria-hidden":"true",children:p.map((e,t)=>n.jsx("span",{className:"type-data-xs text-text-muted tabular-nums text-right pr-1.5",style:{position:"absolute",top:`${e.pos}%`,transform:"translateY(-50%)",right:0},children:e.label},t))}),n.jsxs("div",{ref:g,className:"absolute overflow-hidden",style:{left:32,right:0,top:0,bottom:20},children:[n.jsx("svg",{className:"absolute inset-0 w-full h-full",preserveAspectRatio:"none","aria-hidden":"true",children:[0,25,50,75,100].map(e=>n.jsx("line",{x1:"0",y1:`${e}%`,x2:"100%",y2:`${e}%`,stroke:"rgba(255,255,255,0.06)",strokeDasharray:"3 3"},e))}),n.jsx("canvas",{ref:x,className:"absolute inset-0 w-full h-full","aria-hidden":"true"}),n.jsx("button",{type:"button",onClick:m,className:"absolute bottom-1 right-1 p-1.5 rounded bg-tooltip-bg/80 hover:bg-tooltip-bg active:bg-tooltip-bg transition-colors touch-manipulation",title:o?"Show full range (min/max)":"Show trimmed range (P5-P95)","aria-label":o?"Expand to show full data range":"Shrink to show trimmed percentile range","aria-pressed":!o,children:o?n.jsx(b,{className:"w-3.5 h-3.5 text-text-muted","aria-hidden":"true"}):n.jsx(y,{className:"w-3.5 h-3.5 text-text-muted","aria-hidden":"true"})})]}),n.jsx("div",{className:"absolute left-0 right-0 bottom-0",style:{left:32,height:20},"aria-hidden":"true",children:h.map((e,t)=>n.jsx("span",{className:"type-data-xs text-text-muted tabular-nums absolute top-1",style:{left:`${e.pos}%`,transform:"translateX(-50%)"},children:e.label},t))})]}):n.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No noise floor data available"})}),St={repeater:"var(--signal-critical)",companion:"var(--accent-tertiary)",room_server:"var(--accent-secondary)"};function Pt(e){if(e.contact_type){const t=e.contact_type.toLowerCase();if("repeater"===t||"rep"===t)return"repeater";if("room server"===t||"room_server"===t||"room"===t||"server"===t)return"room_server";if("companion"===t||"client"===t||"cli"===t)return"companion"}return e.is_repeater?"repeater":"companion"}const Rt=r.memo(function({neighbors:e}){const t=r.useMemo(()=>{const t={repeater:0,companion:0,room_server:0};for(const a of Object.values(e)){const e=Pt(a);t[e]=(t[e]||0)+1}const s=Object.values(t).reduce((e,t)=>e+t,0);return{items:[{label:"Repeaters",count:t.repeater,percent:0,color:St.repeater},{label:"Companions",count:t.companion,percent:0,color:St.companion},{label:"Room Servers",count:t.room_server,percent:0,color:St.room_server}].map(e=>({...e,percent:s>0?e.count/s*100:0})).filter(e=>e.count>0).sort((e,t)=>t.count-e.count),total:s}},[e]);return 0===t.total?n.jsx("div",{className:"h-full flex items-center justify-center text-text-muted type-body-sm",children:"No neighbors discovered yet"}):n.jsxs("div",{className:"h-full flex flex-col",children:[n.jsx("div",{className:"flex-1 flex flex-col justify-evenly",children:t.items.map(e=>n.jsxs("div",{className:"flex flex-col gap-1.5",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"type-data-sm text-text-secondary",children:e.label}),n.jsxs("span",{className:"type-data-sm text-text-muted tabular-nums",children:[e.count," ",n.jsxs("span",{className:"text-text-muted/60",children:["(",e.percent.toFixed(0),"%)"]})]})]}),n.jsx("div",{className:"h-2.5 bg-bg-elevated rounded-full overflow-hidden",children:n.jsx("div",{className:"h-full rounded-full transition-all duration-500 ease-out",style:{width:`${e.percent}%`,backgroundColor:e.color,minWidth:e.count>0?"4px":"0"}})})]},e.label))}),n.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border-subtle",children:[n.jsx("span",{className:"type-data-xs text-text-muted",children:"Total Nodes"}),n.jsx("span",{className:"type-data-sm text-text-primary font-medium tabular-nums",children:t.total})]})]})});function At({children:e,minHeight:t="100%",rootMargin:s="200px 0px",keepMounted:a=!0,className:i=""}){const l=r.useRef(null),[o,c]=r.useState(!1),[d,m]=r.useState(!1);r.useEffect(()=>{const e=l.current;if(!e)return;const t=new IntersectionObserver(([e])=>{const t=e.isIntersecting;m(t),t&&c(!0)},{rootMargin:s,threshold:0});return t.observe(e),()=>{t.disconnect()}},[s]);const u=d||a&&o;return n.jsx("div",{ref:l,className:`h-full w-full ${i}`,style:{minHeight:t},children:u?e:n.jsx("div",{className:"h-full w-full flex items-center justify-center text-text-muted/50",children:n.jsx("div",{className:"animate-pulse text-xs",children:"Loading chart..."})})})}const $t={excellent:"text-signal-excellent",good:"text-signal-good",fair:"text-signal-fair",poor:"text-signal-critical"},Ft={excellent:"bg-signal-excellent/10",good:"bg-signal-good/10",fair:"bg-signal-fair/10",poor:"bg-signal-critical/10"};function _t({value:e,status:t}){const s={excellent:"bg-signal-excellent",good:"bg-signal-good",fair:"bg-signal-fair",poor:"bg-signal-critical"}[t];return n.jsx("div",{className:"w-full h-2 bg-surface-elevated rounded-full overflow-hidden",children:n.jsx("div",{className:`h-full ${s} transition-all duration-300`,style:{width:`${Math.min(100,Math.max(0,e))}%`}})})}function Dt(){const e=z(),t=O(),[s,a]=r.useState(null),i=r.useCallback((e,t)=>{a({prefix:e,candidateHashes:t})},[]),l=r.useCallback(()=>{a(null)},[]);if(!t)return n.jsxs(je,{children:[n.jsx(Ne,{icon:n.jsx(v,{}),title:"Prefix Conflicts",largeTitle:!0}),n.jsx("div",{className:"flex-1 flex items-center justify-center",children:n.jsxs("div",{className:"text-center text-text-muted",children:[n.jsx(j,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),n.jsx("p",{className:"type-data-xs",children:"No topology data available"}),n.jsx("p",{className:"type-data-xs opacity-70",children:"Run deep analysis to see stats"})]})})]});const o=(c=e.avgConfidence)>=.9?"excellent":c>=.7?"good":c>=.5?"fair":"poor";var c;const d=(m=e.collisionRate)<=10?"excellent":m<=25?"good":"poor";var m;const u="poor"===o||"poor"===d?"poor":"fair"===o||"fair"===d?"fair":"good"===o||"good"===d?"good":"excellent",h="excellent"===u||"good"===u?N:w;return n.jsxs(je,{className:"flex flex-col overflow-hidden",children:[n.jsx(Ne,{icon:n.jsx(v,{}),title:"Prefix Conflicts",largeTitle:!0,actions:n.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1 rounded-full ${Ft[u]}`,children:[n.jsx(h,{className:`w-3.5 h-3.5 ${$t[u]}`}),n.jsx("span",{className:`type-data-xs font-medium ${$t[u]}`,children:"excellent"===u?"Excellent":"good"===u?"Good":"fair"===u?"Fair":"Needs Attention"})]})}),n.jsxs("div",{className:"flex-1 overflow-y-auto min-h-0",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[n.jsxs("div",{className:"cursor-help",title:"Average confidence score across all disambiguated prefixes. Higher = more certain node identification. Based on geographic proximity, co-occurrence patterns, and observation recency.",children:[n.jsxs("div",{className:"flex items-baseline justify-between mb-1",children:[n.jsx("span",{className:"type-data-xs text-text-muted",children:"Avg Confidence"}),n.jsxs("span",{className:`type-data-lg font-semibold ${$t[o]}`,children:[(100*e.avgConfidence).toFixed(1),"%"]})]}),n.jsx(_t,{value:100*e.avgConfidence,status:o})]}),n.jsxs("div",{className:"cursor-help",title:"Percentage of 2-character prefixes that match multiple known nodes. Lower is better. Collisions require disambiguation to determine the correct node.",children:[n.jsxs("div",{className:"flex items-baseline justify-between mb-1",children:[n.jsx("span",{className:"type-data-xs text-text-muted",children:"Collision Rate"}),n.jsxs("span",{className:`type-data-lg font-semibold ${$t[d]}`,children:[e.collisionRate.toFixed(1),"%"]})]}),n.jsx(_t,{value:e.collisionRate,status:d})]})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[n.jsxs("div",{className:"text-center cursor-help px-2 py-1.5 rounded",style:{backgroundColor:"var(--hover-tint)"},title:"Total unique 2-character prefixes observed in packet paths. Each prefix represents the first 2 hex digits of a node's full hash.",children:[n.jsx("div",{className:"type-data-lg font-semibold text-text-primary",children:e.totalPrefixes}),n.jsx("div",{className:"type-data-xs text-text-muted",children:"Prefixes"})]}),n.jsxs("div",{className:"text-center cursor-help px-2 py-1.5 rounded",style:{backgroundColor:"var(--hover-tint)"},title:"Prefixes that map to exactly one known node. No disambiguation neededthese are definitive identifications.",children:[n.jsx("div",{className:"type-data-lg font-semibold text-signal-good",children:e.unambiguousPrefixes}),n.jsx("div",{className:"type-data-xs text-text-muted",children:"Unique"})]}),n.jsxs("div",{className:"text-center cursor-help px-2 py-1.5 rounded",style:{backgroundColor:"var(--hover-tint)"},title:"Prefixes matching multiple known nodes. Click a prefix below to explore candidates and see how disambiguation scores them.",children:[n.jsx("div",{className:"type-data-lg font-semibold "+(e.collisionPrefixes>0?"text-signal-critical":"text-text-primary"),children:e.collisionPrefixes}),n.jsx("div",{className:"type-data-xs "+(e.collisionPrefixes>0?"text-signal-critical":"text-text-muted"),children:"Collisions"})]})]}),e.highCollisionPrefixes.length>0&&n.jsxs("div",{className:"mb-2",children:[n.jsx("div",{className:"type-data-xs text-text-muted mb-1.5",children:"Highest Collisions"}),n.jsx("div",{className:"flex flex-wrap gap-1",children:e.highCollisionPrefixes.map(({prefix:e,candidateCount:t,candidateHashes:s})=>n.jsxs("button",{type:"button",onClick:()=>i(e,s),className:"inline-flex items-center gap-1 px-1.5 py-0.5 min-h-[24px] rounded bg-surface-elevated text-text-secondary type-data-xs font-mono hover:bg-signal-critical/20 hover:text-signal-critical focus:outline-none focus:ring-2 focus:ring-signal-critical/50 transition-colors cursor-pointer touch-manipulation",title:`Click to explore ${t} candidates matching this prefix`,"aria-label":`Explore prefix ${e} with ${t} colliding candidates`,children:[e,n.jsxs("span",{className:"text-signal-critical",children:["",t]})]},e))})]}),e.lowConfidencePrefixes.length>0&&n.jsx("div",{className:"mt-auto pt-2",children:n.jsxs("div",{className:"flex items-start gap-1.5",children:[n.jsx(w,{className:"w-3.5 h-3.5 text-signal-critical mt-0.5 flex-shrink-0"}),n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"type-data-xs text-signal-critical font-medium",children:[n.jsx("span",{className:"text-signal-critical",children:e.lowConfidencePrefixes.length})," prefix",1!==e.lowConfidencePrefixes.length?"es":""," with low confidence"]}),n.jsxs("div",{className:"type-data-xs text-text-muted font-mono truncate",children:[e.lowConfidencePrefixes.slice(0,5).join(", "),e.lowConfidencePrefixes.length>5&&n.jsxs("span",{className:"text-signal-critical",children:[" +",e.lowConfidencePrefixes.length-5," more"]})]})]})]})}),0===e.lowConfidencePrefixes.length&&0===e.collisionPrefixes&&n.jsx("div",{className:"mt-auto pt-2",children:n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx(N,{className:"w-3.5 h-3.5 text-signal-excellent"}),n.jsx("span",{className:"type-data-xs text-signal-excellent",children:"All prefixes uniquely identified"})]})})]}),n.jsx(Me,{isOpen:!!s,prefix:(null==s?void 0:s.prefix)||"",candidateHashes:(null==s?void 0:s.candidateHashes)||[],onClose:l})]})}function Lt({icon:e,label:t,value:s,sublabel:a,highlight:r,tooltip:i}){return n.jsxs("div",{className:"flex items-center justify-between py-2 "+(i?"cursor-help":""),title:i,children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"icon-xs text-icon-widget",children:e}),n.jsx("span",{className:"type-label text-text-secondary",children:t})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("span",{className:"type-data-sm "+(r?"text-accent-tertiary":"text-text-primary"),children:s}),a&&n.jsx("span",{className:"type-data-xs text-text-muted ml-1",children:a})]})]})}function Et(){const e=V(),t=q().length;if(!e||0===e.totalPaths)return null;const{totalPaths:s,pathsWithGhosts:a,observationOverrideCount:r,tracePacketsProcessed:i,pathPacketsProcessed:l,distantEdgesDiscovered:o,duplicateGroupsFound:c,duplicatePathsUnique:d,echolocationEdgesInferred:m}=e,u=s-a,p=s>0?(u/s*100).toFixed(1):"0",x=s>0?(a/s*100).toFixed(1):"0",g=s>0?(r/s*100).toFixed(1):"0",f=i+l,b=f>0||o>0,y=c>0||m>0;return n.jsxs(je,{children:[n.jsx(Ne,{title:"Viterbi HMM",icon:n.jsx(k,{}),largeTitle:!0,badge:t>0?`${t} GHOSTS`:void 0}),n.jsxs(Se,{children:[n.jsxs("div",{className:"divide-y divide-white/5",children:[n.jsx(Lt,{icon:n.jsx(k,{className:"w-3.5 h-3.5"}),label:"Paths Decoded",value:s.toLocaleString(),tooltip:"Total packet paths analyzed by the Viterbi HMM algorithm. Each path is a sequence of node prefixes extracted from received packets."}),n.jsx(Lt,{icon:n.jsx(M,{className:"w-3.5 h-3.5"}),label:"Paths with Ghosts",value:a.toLocaleString(),sublabel:`(${x}%)`,highlight:a>0,tooltip:"Paths containing prefixes that don't match any known node. These 'ghost' prefixes may represent repeaters not yet discovered via direct ADVERT."}),n.jsx(Lt,{icon:n.jsx(C,{className:"w-3.5 h-3.5"}),label:"Observation Override",value:`${g}%`,sublabel:"of paths",tooltip:"Percentage of paths where real-world observations (signal strength, co-occurrence patterns) overrode the expected geographic transition model. Higher values indicate the algorithm is learning from actual mesh behavior."}),n.jsx(Lt,{icon:n.jsx(T,{className:"w-3.5 h-3.5"}),label:"Fully Resolved",value:`${p}%`,sublabel:`(${u.toLocaleString()} paths)`,highlight:parseFloat(p)>=90,tooltip:"Percentage of paths where all node prefixes were successfully matched to known nodes. Higher values indicate better mesh visibility - the algorithm can identify every hop in the packet's journey."})]}),b&&n.jsxs("div",{className:"mt-3 pt-3 border-t border-border-subtle",children:[n.jsx("p",{className:"type-micro mb-2",children:"Distant Topology"}),n.jsxs("div",{className:"divide-y divide-white/5",children:[n.jsx(Lt,{icon:n.jsx(S,{className:"w-3.5 h-3.5"}),label:"TRACE/PATH Packets",value:f.toLocaleString(),sublabel:i>0?`(${i} TRACE)`:void 0,tooltip:"TRACE and PATH packets contain pre-computed routes between distant nodes. These reveal mesh topology beyond what we can directly observe - edges between nodes that may never communicate with us."}),n.jsx(Lt,{icon:n.jsx(P,{className:"w-3.5 h-3.5"}),label:"Distant Edges",value:o.toLocaleString(),highlight:o>0,tooltip:"Edges discovered from TRACE/PATH packet route data. These represent links between distant nodes that we wouldn't see from normal packet forwarding - revealing deeper mesh structure."})]})]}),y&&n.jsxs("div",{className:"mt-3 pt-3 border-t border-border-subtle",children:[n.jsx("p",{className:"type-micro mb-2",children:"Echolocation"}),n.jsxs("div",{className:"divide-y divide-white/5",children:[n.jsx(Lt,{icon:n.jsx(R,{className:"w-3.5 h-3.5"}),label:"Duplicate Groups",value:c.toLocaleString(),sublabel:d>0?`(${d} paths)`:void 0,tooltip:"Packets received multiple times via different paths. Each duplicate is an 'echo' that reveals alternate routing through the mesh - like sonar mapping the network structure."}),n.jsx(Lt,{icon:n.jsx(h,{className:"w-3.5 h-3.5"}),label:"Echo Edges",value:m.toLocaleString(),highlight:m>0,tooltip:"Edges inferred from echolocation analysis. When the same packet arrives via different forwarders, those forwarders are likely within RF range of each other - revealing hidden mesh connectivity."})]})]}),n.jsx("div",{className:"mt-3 pt-3 border-t border-border-subtle cursor-help",title:"Ghost nodes are high-confidence unknown repeaters inferred from path analysis. They appear frequently in packet paths (10+ observations), have consistent neighbor relationships (2+ common neighbors), confidence score 30%, and have reasonable location estimates. Check the Contacts page to see them on the map.",children:n.jsxs("p",{className:"type-label text-text-muted",children:[n.jsx("span",{className:"text-accent-tertiary type-data-sm",children:t})," ","unknown repeater",1!==t?"s":""," discovered via HMM analysis"]})})]})]})}const Wt={useAbsoluteThresholds:!0,baselinePercentile:6,spikePercentile:50,baselineDbm:-107,spikeDbm:-100,mergeGapSeconds:45,minSequenceLength:16,similarityToleranceDbm:5};function Bt(e,t){if(0===e.length)return 0;const s=t/100*(e.length-1),a=Math.floor(s),n=Math.ceil(s);return a===n?e[a]:e[a]+(e[n]-e[a])*(s-a)}function Ht(e){if(0===e.length)return{median:0,p90:0,p95:0,p99:0,max:0,min:0};const t=[...e].sort((e,t)=>e-t);return{median:Bt(t,50),p90:Bt(t,90),p95:Bt(t,95),p99:Bt(t,99),max:t[t.length-1],min:t[0]}}function zt(e,t,s){const a=s-t;if(0===a)return"moderate";const n=(e-t)/a;return n>.66?"critical":n>.33?"severe":"moderate"}function Ot(){var e,t,s,a,i,l,o,c,d,m,u,h,p,g,b,y,v;const j=G(),N=U(),w=I(),k=X(),M=K(),[C,T]=r.useState(null),[S,P]=r.useState([]),[D,L]=r.useState(null),[E,W]=r.useState(null),[B,H]=r.useState(!0),[z,O]=r.useState(null),[V,q]=r.useState(3),[ae,ne]=r.useState("airtime"),[re,ie]=r.useState("smooth"),[le,oe]=r.useState(!1),[ce,de]=r.useState(!1),[me,ue]=r.useState(Wt),[he,pe]=r.useState(.5),xe=k.length,ge=r.useCallback(e=>{r.startTransition(()=>{q(e)})},[]),fe=Y[V].hours,be=60*fe,ye=J(fe),ve=r.useMemo(()=>{var e;if(!(null==(e=null==j?void 0:j.config)?void 0:e.radio))return null;const t=j.config.radio;return{sf:t.spreading_factor??10,bw:t.bandwidth??25e4,cr:t.coding_rate??5,preamble:t.preamble_length??8}},[null==(t=null==(e=null==j?void 0:j.config)?void 0:e.radio)?void 0:t.spreading_factor,null==(a=null==(s=null==j?void 0:j.config)?void 0:s.radio)?void 0:a.bandwidth,null==(l=null==(i=null==j?void 0:j.config)?void 0:i.radio)?void 0:l.coding_rate,null==(c=null==(o=null==j?void 0:j.config)?void 0:o.radio)?void 0:c.preamble_length]),Me=r.useMemo(()=>0===xe?null:Pe.getBucketedStats(be,ye,k,j),[xe,be,ye,ve]),{utilSamples:Se,startTs:Re,endTs:$e}=r.useMemo(()=>{if(!Me)return{utilSamples:[],startTs:0,endTs:0};const{received:e,transmitted:t,forwarded:s,bucket_duration_seconds:a,start_time:n,end_time:r}=Me,i=function(e,t){const s=new Map;for(const a of e)s.set(a.start,{...a});for(const a of t){const e=s.get(a.start);e?(e.airtime_ms+=a.airtime_ms,e.count+=a.count):s.set(a.start,{...a})}return Array.from(s.values()).sort((e,t)=>e.start-t.start)}(t,s);return{utilSamples:Ae(e,i),startTs:n,endTs:r}},[Me]),Fe=r.useMemo(()=>0===Se.length?{peak:0,mean:0}:{peak:Math.max(...Se.map(e=>e.rxUtilW)),mean:Se.reduce((e,t)=>e+t.rxUtilW,0)/Se.length},[Se]);r.useEffect(()=>{!async function(){var e;O(null);try{const[t,s]=await Promise.all([Q(fe),Z(fe)]);t.success&&t.data&&T(t.data),s.success&&(null==(e=s.data)?void 0:e.history)&&P(s.data.history)}catch(t){O(t instanceof Error?t.message:"Failed to load chart data")}finally{H(!1)}}()},[fe]);const _e=r.useMemo(()=>{switch(fe){case 72:return 6e5;case 168:return 18e5;default:return 3e5}},[fe]),De=r.useCallback(async()=>{try{const e=await Q(fe);e.success&&e.data&&T(e.data)}catch{}},[fe]),Le=r.useCallback(async()=>{var e;try{const t=await Z(fe);t.success&&(null==(e=t.data)?void 0:e.history)&&P(t.data.history)}catch{}},[fe]);se(De,_e,!0,!0),se(Le,_e,!0,!0);const Ee=r.useMemo(()=>C&&C.series?C.series.map(e=>({name:e.name,value:e.data.reduce((e,t)=>e+(t[1]??0),0)})).filter(e=>e.value>0):[],[C]),We=r.useMemo(()=>0===S.length?{timestamps:[],values:[]}:{timestamps:S.map(e=>e.timestamp),values:S.map(e=>e.noise_floor_dbm)},[S]),Be=r.useMemo(()=>{if(S.length<10)return{anomalies:[],debug:void 0};const e=function(e,t={}){const s={...Wt,...t};if(e.length<10)return{anomalies:[],thresholds:Ht([]),totalSamples:e.length,anomalySamples:0};const a=e.map(e=>e.noise_floor_dbm),n=Ht(a),r=[...a].sort((e,t)=>e-t);let i,l;s.useAbsoluteThresholds?(i=s.baselineDbm,l=s.spikeDbm):(i=Bt(r,s.baselinePercentile),l=Bt(r,s.spikePercentile));const o=[...e].sort((e,t)=>e.timestamp-t.timestamp),c=[];let d=null,m=0;for(const u of o)if(u.noise_floor_dbm>i&&u.noise_floor_dbm<l)if(m++,d){const e=Math.abs(u.noise_floor_dbm-d.rollingAvg)<=s.similarityToleranceDbm,t=u.timestamp-d.endTs<=s.mergeGapSeconds;e&&t?(d.endTs=u.timestamp,d.values.push(u.noise_floor_dbm),d.timestamps.push(u.timestamp),d.rollingAvg=d.values.reduce((e,t)=>e+t,0)/d.values.length):(d.values.length>=s.minSequenceLength&&c.push(d),d={startTs:u.timestamp,endTs:u.timestamp,values:[u.noise_floor_dbm],timestamps:[u.timestamp],rollingAvg:u.noise_floor_dbm})}else d={startTs:u.timestamp,endTs:u.timestamp,values:[u.noise_floor_dbm],timestamps:[u.timestamp],rollingAvg:u.noise_floor_dbm};else d&&d.values.length>=s.minSequenceLength&&c.push(d),d=null;return d&&d.values.length>=s.minSequenceLength&&c.push(d),0===c.length?{anomalies:[],thresholds:n,totalSamples:e.length,anomalySamples:m,debug:{baselineCutoff:i,spikeCutoff:l,midBandSamples:m}}:{anomalies:c.map(e=>{const t=Math.max(...e.values),s=e.values.reduce((e,t)=>e+t,0)/e.values.length;return{startTs:e.startTs,endTs:e.endTs,peakValue:t,avgValue:s,severity:zt(s,i,l),sampleCount:e.values.length}}),thresholds:n,totalSamples:e.length,anomalySamples:m,debug:{baselineCutoff:i,spikeCutoff:l,midBandSamples:m}}}(S,me);return{anomalies:e.anomalies,debug:e.debug}},[S,me]),He=Be.anomalies,ze=Y[V],Oe=r.useMemo(()=>{const e=(null==j?void 0:j.neighbors)??{};return Object.fromEntries(Object.entries(e).filter(([e])=>!N.has(e)))},[null==j?void 0:j.neighbors,N]),Ve=r.useMemo(()=>{const e=Date.now()/1e3-3600*fe;return Object.fromEntries(Object.entries(Oe).filter(([,t])=>t.last_seen>=e))},[Oe,fe]),qe=ee(fe),Ge=r.useMemo(()=>{const e=60*be/qe,t=Math.floor(Date.now()/1e3),s=Math.floor(t/e)*e;return{start:s-60*be,end:s}},[be,qe]);return n.jsxs(we,{children:[n.jsx(ke,{title:"Statistics",icon:n.jsx(A,{}),controls:n.jsx(te,{ranges:Y,selectedIndex:V,onSelect:ge})}),z&&n.jsx(je,{className:"border border-accent-red/50 bg-accent-red/10",children:n.jsx("p",{className:"text-accent-red",children:z})}),le&&ce&&n.jsxs(je,{className:"border border-accent-purple/30 bg-glass-surface/50",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"type-label",children:"Anomaly Detection Tuning"}),n.jsxs("span",{className:"type-data-xs text-text-muted",children:["(",ze.label,")"]})]}),n.jsx("button",{onClick:()=>ue(e=>({...e,useAbsoluteThresholds:!e.useAbsoluteThresholds})),className:"type-data-xs px-2 py-1 rounded transition-colors "+(me.useAbsoluteThresholds?"bg-accent-purple/30 text-accent-purple":"bg-glass-elevated text-text-muted hover:text-text-secondary"),children:me.useAbsoluteThresholds?"Absolute dBm":"Percentile"})]}),n.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[n.jsxs("div",{children:[n.jsx("span",{className:"type-micro",children:"Baseline"}),n.jsxs("span",{className:"ml-2 type-data-sm text-status-warning",children:[(null==(m=null==(d=Be.debug)?void 0:d.baselineCutoff)?void 0:m.toFixed(1))??""," dBm"]})]}),n.jsxs("div",{children:[n.jsx("span",{className:"type-micro",children:"Spike"}),n.jsxs("span",{className:"ml-2 type-data-sm text-status-warning",children:[(null==(h=null==(u=Be.debug)?void 0:u.spikeCutoff)?void 0:h.toFixed(1))??""," dBm"]})]}),n.jsxs("div",{children:[n.jsx("span",{className:"type-micro",children:"Mid-band"}),n.jsx("span",{className:"ml-2 type-data-sm text-accent-purple",children:(null==(p=Be.debug)?void 0:p.midBandSamples)??0})]}),n.jsxs("div",{children:[n.jsx("span",{className:"type-micro",children:"Anomalies"}),n.jsx("span",{className:"ml-2 type-data-sm text-status-danger",children:He.length})]})]}),n.jsxs("div",{className:"mt-4 pt-4 border-t border-border-subtle space-y-4",children:[me.useAbsoluteThresholds?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Baseline (",me.baselineDbm," dBm)"]}),n.jsx("input",{type:"range",min:"-120",max:"-60",value:me.baselineDbm,onChange:e=>ue(t=>({...t,baselineDbm:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Spike (",me.spikeDbm," dBm)"]}),n.jsx("input",{type:"range",min:"-100",max:"-20",value:me.spikeDbm,onChange:e=>ue(t=>({...t,spikeDbm:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Merge Gap (",me.mergeGapSeconds,"s)"]}),n.jsx("input",{type:"range",min:"5",max:"120",step:"5",value:me.mergeGapSeconds,onChange:e=>ue(t=>({...t,mergeGapSeconds:Number(e.target.value)})),className:"w-full accent-accent-purple"})]})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Min Sequence (",me.minSequenceLength,")"]}),n.jsx("input",{type:"range",min:"2",max:"20",value:me.minSequenceLength,onChange:e=>ue(t=>({...t,minSequenceLength:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Similarity (",me.similarityToleranceDbm," dBm)"]}),n.jsx("input",{type:"range",min:"1",max:"15",value:me.similarityToleranceDbm,onChange:e=>ue(t=>({...t,similarityToleranceDbm:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Opacity (",Math.round(100*he),"%)"]}),n.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.05",value:he,onChange:e=>pe(Number(e.target.value)),className:"w-full accent-accent-purple"})]})]})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Baseline (P",me.baselinePercentile,")"]}),n.jsx("input",{type:"range",min:"1",max:"50",value:me.baselinePercentile,onChange:e=>ue(t=>({...t,baselinePercentile:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Spike (P",me.spikePercentile,")"]}),n.jsx("input",{type:"range",min:"50",max:"99",value:me.spikePercentile,onChange:e=>ue(t=>({...t,spikePercentile:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Merge Gap (",me.mergeGapSeconds,"s)"]}),n.jsx("input",{type:"range",min:"5",max:"120",step:"5",value:me.mergeGapSeconds,onChange:e=>ue(t=>({...t,mergeGapSeconds:Number(e.target.value)})),className:"w-full accent-accent-purple"})]})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Min Sequence (",me.minSequenceLength,")"]}),n.jsx("input",{type:"range",min:"2",max:"20",value:me.minSequenceLength,onChange:e=>ue(t=>({...t,minSequenceLength:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Similarity (",me.similarityToleranceDbm," dBm)"]}),n.jsx("input",{type:"range",min:"1",max:"15",value:me.similarityToleranceDbm,onChange:e=>ue(t=>({...t,similarityToleranceDbm:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Opacity (",Math.round(100*he),"%)"]}),n.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.05",value:he,onChange:e=>pe(Number(e.target.value)),className:"w-full accent-accent-purple"})]})]})]}),n.jsxs("div",{className:"mt-4 p-3 bg-glass-elevated rounded-lg",children:[n.jsx("div",{className:"type-micro mb-1",children:"Config output"}),n.jsxs("div",{className:"type-data-sm text-status-success",children:[me.useAbsoluteThresholds?`useAbsoluteThresholds: true, baselineDbm: ${me.baselineDbm}, spikeDbm: ${me.spikeDbm}`:`useAbsoluteThresholds: false, baselinePercentile: ${me.baselinePercentile}, spikePercentile: ${me.spikePercentile}`,", mergeGapSeconds: ",me.mergeGapSeconds,", minSequenceLength: ",me.minSequenceLength,", similarityToleranceDbm: ",me.similarityToleranceDbm]})]})]})]}),B?n.jsx(Ce,{template:"auto",children:n.jsx(je,{className:"text-center py-12",children:n.jsx("div",{className:"animate-pulse text-text-muted",children:"Loading statistics..."})})}):n.jsxs(n.Fragment,{children:[n.jsx(Ce,{template:"hero-auto",children:n.jsxs(je,{isLoaded:M,skeletonType:"chart",children:[n.jsx(Ne,{icon:n.jsx(x,{}),title:"Packet Analyzer",badge:ze.label,largeTitle:!0,actions:n.jsxs("div",{className:"flex flex-wrap items-center gap-2 justify-end",children:["stats"===re&&n.jsx(it,{enabled:le,onChange:oe,anomalyCount:He.length,showTuning:ce,onTuningChange:de}),n.jsx(lt,{smoothing:re,onChange:ie}),n.jsx(rt,{mode:ae,onChange:ne})]})}),n.jsx("div",{className:"flex-1 min-h-0",children:n.jsx(ot,{packets:k,startTs:Ge.start,endTs:Ge.end,bucketCount:qe,radioConfig:ve??void 0,mode:ae,smoothing:re,noiseFloorAnomalies:He,showNoiseFloorOverlay:le,overlayOpacity:he})})]})}),n.jsxs(Ce,{template:"panel",children:[n.jsx(Te,{span:12,md:6,children:n.jsxs(je,{isLoaded:M,skeletonType:"chart",children:[n.jsx(Ne,{icon:n.jsx($,{}),title:"Airtime Utilization",badge:`${Math.round(5)}m window`,largeTitle:!0,actions:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("span",{className:"type-data-xs text-text-muted",children:["Peak ",n.jsxs("span",{className:"text-text-secondary tabular-nums font-medium",children:[Fe.peak.toFixed(2),"%"]})]}),n.jsxs("span",{className:"type-data-xs text-text-muted",children:["Mean ",n.jsxs("span",{className:"text-text-secondary tabular-nums font-medium",children:[Fe.mean.toFixed(2),"%"]})]})]})}),n.jsx("div",{className:"flex-1 min-h-0",children:n.jsx(At,{children:n.jsx(bt,{samples:Se,startTs:Re,endTs:$e})})})]})}),n.jsx(Te,{span:12,md:6,children:n.jsxs(je,{isLoaded:M,skeletonType:"chart",children:[n.jsx(Ne,{icon:n.jsx(f,{}),title:"Link Quality",badge:ze.label,largeTitle:!0,actions:E?n.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 type-data-xs text-text-muted",children:[n.jsxs("span",{children:[n.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:E.zeroHopCount})," nbr"]}),n.jsxs("span",{children:[n.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:E.totalCount})," obs"]}),n.jsxs("span",{children:[n.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:E.maxDistanceKm.toFixed(0)})," km"]})]}):null}),n.jsx("div",{className:"flex-1 min-h-0",children:n.jsx(At,{children:n.jsx(Mt,{neighbors:Ve,quickNeighbors:w,localLat:(null==(b=null==(g=null==j?void 0:j.config)?void 0:g.repeater)?void 0:b.latitude)??0,localLon:(null==(v=null==(y=null==j?void 0:j.config)?void 0:y.repeater)?void 0:v.longitude)??0,onStatsChange:W})})})]})})]}),n.jsxs(Ce,{template:"panel",children:[n.jsx(Te,{span:12,md:6,children:n.jsxs(je,{isLoaded:M,skeletonType:"chart",children:[n.jsx(Ne,{icon:n.jsx(F,{}),title:"Packet Types",largeTitle:!0}),n.jsx("div",{className:"flex-1 min-h-0",children:n.jsx(At,{children:Ee.length>0?n.jsx(ut,{data:Ee}):n.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No packet type data available"})})})]})}),n.jsx(Te,{span:12,md:6,children:n.jsxs(je,{isLoaded:M,skeletonType:"chart",children:[n.jsx(Ne,{icon:n.jsx(_,{}),title:"Network Composition",badge:ze.label,largeTitle:!0}),n.jsx("div",{className:"flex-1 min-h-0",children:n.jsx(At,{children:n.jsx(Rt,{neighbors:Ve})})})]})})]}),n.jsxs(Ce,{template:"panel",children:[n.jsx(Te,{span:12,md:6,children:n.jsx(Dt,{})}),n.jsx(Te,{span:12,md:6,children:n.jsx(Et,{})})]}),n.jsx(Ce,{template:"panel",children:n.jsx(Te,{span:12,children:n.jsxs(je,{isLoaded:M,skeletonType:"chart",children:[n.jsx(Ne,{icon:n.jsx(R,{}),title:"RF Noise Floor",largeTitle:!0,actions:D?n.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 md:gap-3",children:[n.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["min ",n.jsx("span",{className:"text-text-secondary tabular-nums",children:D.min.toFixed(0)})]}),n.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["avg ",n.jsx("span",{className:"text-text-secondary tabular-nums",children:D.avg.toFixed(0)})]}),n.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["max ",n.jsx("span",{className:"text-text-secondary tabular-nums",children:D.max.toFixed(0)})]}),n.jsx("span",{className:"type-data-xs text-text-muted",children:"dBm"})]}):n.jsx("span",{className:"type-data-xs text-text-muted",children:"dBm"})}),n.jsx("div",{className:"flex-1 min-h-0",children:n.jsx(At,{children:n.jsx(Tt,{timestamps:We.timestamps,values:We.values,onStatsChange:L})})})]})})})]})]})}export{Ot as default};
