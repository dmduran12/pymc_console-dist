var e,t,s=Object.defineProperty,a=(e,t,a)=>((e,t,a)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a)(e,"symbol"!=typeof t?t+"":t,a);import{j as n,r,aB as l,H as i,aC as o,aD as c,aE as d,aF as m,aG as u,aH as h,aI as x,aJ as p,aK as g,o as f,aL as b,aM as y,aN as v,aO as j,aP as N,aQ as w,a8 as k,aR as M,ak as C,h as S,ae as T,aS as F,ac as $,p as P,C as R,at as A}from"./vendor-react-CVaYKp51.js";import{W as L,X as D,Y as E,Z as B,F as H,t as _,_ as z,$ as O,a0 as W,H as V,a1 as I,c as q,f as X,e as G,u as K,n as Y,p as Z,h as Q,o as U,a2 as J,j as ee,a3 as te}from"./index-D7mmFuyN.js";import{u as se}from"./usePolling-DLOfTPFW.js";import{a as ae,b as ne,h as re,g as le}from"./useScientificColormap-DWXyqERV.js";import{a as ie,b as oe,c as ce,d as de,e as me,s as ue}from"./useThemeColors-CYhdedUg.js";import{c as he,R as xe,d as pe,L as ge,C as fe,X as be,Y as ye,T as ve,a as je}from"./recharts-ccH8-7Db.js";import{T as Ne}from"./TimeRangeSelector-BXBTLGRq.js";import{a as we,c as ke,P as Me,b as Ce}from"./PageLayout-C47bL7PI.js";import{C as Se}from"./CollisionExplorerModal-BZZDdg90.js";import{R as Te,C as Fe}from"./Grid-CoebUagJ.js";import"./vendor-core-WoOfkQwm.js";import"./deckgl-DTsmDcfs.js";import"./leaflet-D_ckmI2R.js";function $e({children:e,centered:t,className:s}){return n.jsx("div",{className:he("flex-1 min-h-0",t&&"flex items-center justify-center",s),children:e})}const Pe={useAbsoluteThresholds:!0,baselinePercentile:6,spikePercentile:50,baselineDbm:-107,spikeDbm:-100,mergeGapSeconds:45,minSequenceLength:16,similarityToleranceDbm:5};function Re(e,t){if(0===e.length)return 0;const s=t/100*(e.length-1),a=Math.floor(s),n=Math.ceil(s);return a===n?e[a]:e[a]+(e[n]-e[a])*(s-a)}function Ae(e){if(0===e.length)return{median:0,p90:0,p95:0,p99:0,max:0,min:0};const t=[...e].sort((e,t)=>e-t);return{median:Re(t,50),p90:Re(t,90),p95:Re(t,95),p99:Re(t,99),max:t[t.length-1],min:t[0]}}function Le(e,t,s){const a=s-t;if(0===a)return"moderate";const n=(e-t)/a;return n>.66?"critical":n>.33?"severe":"moderate"}r.memo(function({options:e,data:t,className:s="",onCreate:a}){const l=r.useRef(null),i=r.useRef(null);return r.useEffect(()=>{const s=l.current;if(!s)return;const n=s.getBoundingClientRect(),r=Math.floor(n.width)||400,o=Math.floor(n.height)||200,c=new E({...e,width:r,height:o},t,s);return i.current=c,null==a||a(c),()=>{c.destroy(),i.current=null}},[e]),r.useEffect(()=>{i.current&&t&&i.current.setData(t)},[t]),r.useEffect(()=>{const e=l.current;if(!e)return;const t=new ResizeObserver(e=>{const t=e[0];if(!t||!i.current)return;const{width:s,height:a}=t.contentRect;s>0&&a>0&&i.current.setSize({width:Math.floor(s),height:Math.floor(a)})});return t.observe(e),()=>{t.disconnect()}},[]),n.jsx("div",{ref:l,className:`w-full h-full ${s}`,style:{minHeight:100}})});const De=new Map;function Ee(e){var t;if(!e.startsWith("var("))return e;const s=De.get(e);if(s)return s;const a=e.match(/var\(([^,)]+)(?:,\s*([^)]+))?\)/);if(!a)return e;const n=a[1].trim(),r=(null==(t=a[2])?void 0:t.trim())||"#888888",l=getComputedStyle(document.documentElement).getPropertyValue(n).trim()||r;return De.set(e,l),l}function Be(e,t,s=!1){if(t.length<2)return;if(e.beginPath(),e.moveTo(t[0].x,t[0].y),2===t.length)return void e.lineTo(t[1].x,t[1].y);const a=.5;for(let n=0;n<t.length-1;n++){const s=t[Math.max(0,n-1)],r=t[n],l=t[n+1],i=t[Math.min(t.length-1,n+2)],o=r.x+(l.x-s.x)/6*a,c=r.y+(l.y-s.y)/6*a,d=l.x-(i.x-r.x)/6*a,m=l.y-(i.y-r.y)/6*a;e.bezierCurveTo(o,c,d,m,l.x,l.y)}s&&e.closePath()}r.memo(function({data:e,maxValue:t,onHover:s,highlightedItem:a=null,bandColor:l="#E12672",innerBandColor:i="#FF2D7A",meanColor:o="#FF6B9D",medianColor:c="#FF85AD",averageColor:d="#FFE135",cursorColor:m="rgba(255,255,255,0.5)"}){const u=r.useRef(null),h=r.useRef(null),x=r.useRef(e),p=r.useRef(t),g=r.useRef(a),f=r.useRef(s),b=r.useRef(e.length);r.useLayoutEffect(()=>{x.current=e,p.current=t,g.current=a,f.current=s});const y=r.useRef({band:l,innerBand:i,mean:o,median:c,average:d,cursor:m});r.useLayoutEffect(()=>{y.current={band:l,innerBand:i,mean:o,median:c,average:d,cursor:m}});const v=r.useMemo(()=>[e.map(e=>e.timestamp),e.map(e=>e.max)],[e]),j=r.useMemo(()=>{const e=function(e,t,s,a){return{hooks:{draw:n=>{const r=e.current,l=t.current,i=s.current,o=a.current;if(0===r.length)return;const c=n.ctx,d=n.bbox,m=d.left,u=d.top,h=d.width,x=d.height;if(h<=0||x<=0)return;const p=n.data[0],g=p.length;if(0===g)return;const f=p[0],b=p[g-1]-f||1,y=e=>m+(e-f)/b*h,v=e=>u+x*(1-e/l),j={min:r.map(e=>({x:y(e.timestamp),y:v(e.min)})),max:r.map(e=>({x:y(e.timestamp),y:v(e.max)})),p5:r.map(e=>({x:y(e.timestamp),y:v(e.p5)})),p95:r.map(e=>({x:y(e.timestamp),y:v(e.p95)})),p25:r.map(e=>({x:y(e.timestamp),y:v(e.p25)})),p75:r.map(e=>({x:y(e.timestamp),y:v(e.p75)})),mean:r.map(e=>({x:y(e.timestamp),y:v(e.mean)})),median:r.map(e=>({x:y(e.timestamp),y:v(e.median)})),average:r.map(e=>({x:y(e.timestamp),y:v(e.average)}))},N=(e,t)=>i?i===e?Math.min(1,1.5*t):"minMax"===i||"p5p95"===i||"p25p75"===i?.3*t:t:t,w=e=>i?i===e?1:"mean"===i||"median"===i||"average"===i?.3:1:1,k={band:Ee(o.band),innerBand:Ee(o.innerBand),mean:Ee(o.mean),median:Ee(o.median),average:Ee(o.average)};c.save(),c.strokeStyle=k.average,c.lineWidth=4,c.globalAlpha=w("average"),Be(c,j.average),c.stroke(),c.globalAlpha=N("minMax",.15),c.fillStyle=k.band,c.beginPath(),Be(c,j.max);const M=[...j.min].reverse();for(const e of M)c.lineTo(e.x,e.y);c.closePath(),c.fill(),c.globalAlpha=N("p5p95",.3),c.fillStyle=k.band,c.beginPath(),Be(c,j.p95);const C=[...j.p5].reverse();for(const e of C)c.lineTo(e.x,e.y);c.closePath(),c.fill(),c.globalAlpha=N("p25p75",.55),c.fillStyle=k.innerBand,c.beginPath(),Be(c,j.p75);const S=[...j.p25].reverse();for(const e of S)c.lineTo(e.x,e.y);c.closePath(),c.fill(),c.strokeStyle=k.median,c.lineWidth=1.5,c.globalAlpha=w("median"),c.setLineDash([4,4]),Be(c,j.median),c.stroke(),c.strokeStyle=k.mean,c.lineWidth=1.5,c.globalAlpha=w("mean"),c.setLineDash([]),Be(c,j.mean),c.stroke(),c.restore()}}}}(x,p,g,y);return{width:400,height:200,padding:[4,4,4,4],cursor:{show:!0,x:!0,y:!1,drag:{x:!1,y:!1},points:{show:!1}},scales:{x:{time:!0},y:{range:[0,t]}},axes:[{show:!1},{show:!1}],series:[{},{show:!1}],hooks:{setCursor:[e=>{var t,s;const a=e.cursor.idx;null!=a&&a>=0?null==(t=f.current)||t.call(f,a):null==(s=f.current)||s.call(f,null)}]},plugins:[e]}},[t]);r.useEffect(()=>{const t=u.current;if(!t||0===e.length)return;const s=b.current,a=e.length,n=Math.abs(a-s);if(!(!h.current||n>100||s>0&&n/s>.1)&&h.current)return h.current.setData(v),void(b.current=a);h.current&&h.current.destroy();const r=t.getBoundingClientRect(),l=Math.floor(r.width)||400,i=Math.floor(r.height)||200,o=new E({...j,width:l,height:i},v,t);return h.current=o,b.current=a,()=>{o.destroy(),h.current=null}},[j,v,e.length]),r.useEffect(()=>{const e=u.current;if(!e)return;const t=new ResizeObserver(e=>{const t=e[0];if(!t||!h.current)return;const{width:s,height:a}=t.contentRect;s>0&&a>0&&h.current.setSize({width:Math.floor(s),height:Math.floor(a)})});return t.observe(e),()=>{t.disconnect()}},[]),r.useEffect(()=>{h.current&&h.current.redraw()},[a,e]);const N=r.useCallback(()=>{null==s||s(null)},[s]);return 0===e.length?n.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No data available"}):n.jsx("div",{ref:u,className:"w-full h-full rounded-2xl overflow-hidden",onMouseLeave:N})});const He="undefined"!=typeof window&&(null==(t=null==(e=window.matchMedia)?void 0:e.call(window,"(color-gamut: p3)"))?void 0:t.matches);function _e(){const e=getComputedStyle(document.documentElement);return{fontFamily:e.getPropertyValue("--font-data").trim()||'"JetBrains Mono", ui-monospace, monospace',axisColor:e.getPropertyValue("--chart-axis-tick").trim()||"rgba(255, 255, 255, 0.4)",gridColor:e.getPropertyValue("--chart-grid").trim()||"rgba(255, 255, 255, 0.06)",textMuted:e.getPropertyValue("--text-muted").trim()||"#727272",textPrimary:e.getPropertyValue("--text-primary").trim()||"#FFFFFF"}}const ze=["min","max","p75","p95","p99","mean","median","average","midpoint"];function Oe(e){const t=ne(e),s=re(t),a=`color(display-p3 ${(s.r/255).toFixed(3)} ${(s.g/255).toFixed(3)} ${(s.b/255).toFixed(3)})`;return{...s,p3:a}}function We(e,t,s,a,n,r,l,i,o,c=null,d=null,m=1,u=null,h="airtime",x=.5){if(0===t.length)return;const p=e.ctx,{left:g,top:f,width:b,height:y}=e.bbox,v=window.devicePixelRatio||1;if(b<=0||y<=0)return;const j=e.data[0],N=j.length;if(0===N)return;const w=j[0],k=j[N-1],M=s,C="share"===h,S=C?function(e){const t=[10,20,25,50,100,200,250,500,1e3],s=e/4.5;for(const a of t)if(a>=s)return a;return e>5e3?1e3*Math.ceil(s/1e3):100*Math.ceil(s/100)}(M):5,T=getComputedStyle(document.documentElement),F=T.getPropertyValue("--signal-critical").trim()||"#EF4444",$=T.getPropertyValue("--bg-body").trim()||"#171717";p.save(),p.fillStyle="#000000";const P=8*v;p.beginPath(),p.roundRect(g,f,b,y,P),p.fill(),p.restore();const R=parseInt($.slice(1,3),16)||23,A=parseInt($.slice(3,5),16)||23,L=parseInt($.slice(5,7),16)||23;if(!C&&M>=20){p.save();const e=f+y*(1-20/M);p.fillStyle=`rgba(${R}, ${A}, ${L}, 0.5)`,p.fillRect(g,f,b,e-f),p.restore()}p.save(),p.lineWidth=1*v,p.setLineDash([4*v,4*v]);for(let E=S;E<M;E+=S){const e=E/M,t=Math.round(f+y*(1-e))+.5;C||20!==E?(p.strokeStyle=r.textPrimary,p.globalAlpha=.25):(p.strokeStyle=F,p.globalAlpha=1),p.beginPath(),p.moveTo(Math.round(g),t),p.lineTo(Math.round(g+b),t),p.stroke()}p.restore(),p.save(),p.font=`bold ${10*v}px ${r.fontFamily}`,p.fillStyle=r.textPrimary,p.textBaseline="middle",p.textAlign="left";const D=8*v;for(let E=0;E<=M;E+=S){const e=f+y*(1-E/M),t=Math.max(f+D,Math.min(f+y-D,e)),s=C?`${E}B`:`${E}%`;p.fillText(s,0,t)}if(p.restore(),function(e,t,s,a,n,r,l){if(null===t)return;if(t<s||t>s+n)return;const i=getComputedStyle(document.documentElement).getPropertyValue("--text-primary").trim()||"#FFFFFF";e.save(),e.strokeStyle=i,e.globalAlpha=.5,e.lineWidth=1*l,e.setLineDash([4*l,4*l]),e.beginPath(),e.moveTo(Math.round(t)+.5,a),e.lineTo(Math.round(t)+.5,a+r),e.stroke(),e.restore()}(p,u,g,f,b,y,v),l){!function(e,t,s,a,n,r,l=null,i=null,o=1,c=25){const{points:d,rawValues:m,count:u,packetTypes:h,timestamps:x}=t,p=1*o*(window.devicePixelRatio||1);e.globalCompositeOperation="source-over";const g=l?parseInt(l.replace("TYPE_",""),10):null;for(let f=0;f<u;f++){const t=d[2*f],l=m[f],o=s+t*n,u=a+(1-Math.min(1,Math.max(0,l/c)))*r,b=h[f],y=ae(b);let v=!0;if(i&&x){const e=x[f];v=e>=i.start&&e<i.end}const j=!v||null!==g&&b!==g?.03:.5;e.fillStyle=`rgba(${y.r}, ${y.g}, ${y.b}, ${j})`,e.beginPath(),e.arc(o,u,p,0,2*Math.PI),e.fill()}e.globalCompositeOperation="source-over"}(p,l,g,f,b,y,c,d,m,M),p.save(),p.font=`bold ${9*v}px ${r.fontFamily}`,p.textBaseline="middle",p.textAlign="left";const e=l.maxValue,t=[{pct:0,label:`${e.toFixed(0)}%`},{pct:.25,label:`${(.75*e).toFixed(0)}%`},{pct:.5,label:`${(.5*e).toFixed(0)}%`},{pct:.75,label:`${(.25*e).toFixed(0)}%`},{pct:1,label:"0%"}];for(const{pct:s,label:a}of t){const e=f+y*s,t=Oe(1-s);p.fillStyle=`rgb(${t.r}, ${t.g}, ${t.b})`,p.fillText(a,g+b+8*v,e)}p.restore()}o&&i&&i.length>0&&function(e,t,s,a,n,r,l,i,o,c,d=.5){if(0===t.length)return;const m=o-i||1,u=function(e,t=1.3,s=.15){const a=function(e){const t=e.match(/color\(display-p3\s+([\d.]+)\s+([\d.]+)\s+([\d.]+)/);if(t){const e=parseFloat(t[1]),s=parseFloat(t[2]),a=parseFloat(t[3]);return{r:Math.round(255*e),g:Math.round(255*s),b:Math.round(255*a),p3r:e,p3g:s,p3b:a}}if(e.startsWith("#")){const t=e.replace("#",""),s=parseInt(t.slice(0,2),16),a=parseInt(t.slice(2,4),16),n=parseInt(t.slice(4,6),16);return{r:s,g:a,b:n,p3r:s/255,p3g:a/255,p3b:n/255}}const s=e.match(/rgba?\(([\d.]+),?\s*([\d.]+),?\s*([\d.]+)/);if(s){const e=Math.round(parseFloat(s[1])),t=Math.round(parseFloat(s[2])),a=Math.round(parseFloat(s[3]));return{r:e,g:t,b:a,p3r:e/255,p3g:t/255,p3b:a/255}}return{r:255,g:255,b:255,p3r:1,p3g:1,p3b:1}}(e),n=function(e,t,s,a=1.25,n=.15){const r=(Math.max(e,t,s)+Math.min(e,t,s))/2;return{p3r:Math.min(1,r+(e-r)*a+n),p3g:Math.min(1,r+(t-r)*a+n),p3b:Math.min(1,r+(s-r)*a+n)}}(a.p3r,a.p3g,a.p3b,t,s);return{r:Math.round(255*Math.min(1,n.p3r)),g:Math.round(255*Math.min(1,n.p3g)),b:Math.round(255*Math.min(1,n.p3b)),p3r:Math.min(1,n.p3r),p3g:Math.min(1,n.p3g),p3b:Math.min(1,n.p3b)}}(getComputedStyle(document.documentElement).getPropertyValue("--signal-critical").trim()||"#EF4444");e.save(),e.globalAlpha=d,e.fillStyle=He?`color(display-p3 ${u.p3r} ${u.p3g} ${u.p3b})`:`rgb(${u.r}, ${u.g}, ${u.b})`;for(const h of t){if(h.endTs<i||h.startTs>o)continue;const t=a+(Math.max(h.startTs,i)-i)/m*r,s=a+(Math.min(h.endTs,o)-i)/m*r,d=Math.max(s-t,2*c);e.fillRect(t,n,d,l)}e.restore()}(p,i,0,g,f,b,y,w,k,v,d?Math.max(.03,.03*x):x)}const Ve=r.memo(function({data:e,maxValue:t,visibleLines:s=ze,highlightedLine:a=null,onHover:l,scatterData:i=null,noiseFloorAnomalies:o=null,showNoiseFloorOverlay:c=!1,overlayOpacity:d=.5,highlightedType:m=null,hoveredTimeRange:u=null,timeRangeHours:h=24,yAxisMode:x="airtime"}){const p=r.useRef(null),g=r.useRef(null),f=r.useRef(e),b=r.useRef(t),y=r.useRef(s),v=r.useRef(a),j=r.useRef(l),N=r.useRef(i),w=r.useRef(o),k=r.useRef(c),M=r.useRef(m),C=r.useRef(u),S=r.useRef(null),T=r.useRef(null),F=r.useRef(x),$=r.useRef(d),P=h<=12?1.2:1,R=r.useRef(P),A=r.useRef(e.length);r.useLayoutEffect(()=>{f.current=e,b.current=t,y.current=s,v.current=a,j.current=l,N.current=i,w.current=o,k.current=c,M.current=m,C.current=u,R.current=P,F.current=x,$.current=d}),r.useEffect(()=>{S.current=_e()},[]);const L=r.useMemo(()=>[e.map(e=>e.timestamp),new Array(e.length).fill(1)],[e]),D=r.useMemo(()=>({hooks:{draw:e=>{const t=S.current||_e();We(e,f.current,b.current,y.current,v.current,t,N.current,w.current,k.current,M.current,C.current,R.current,T.current,F.current,$.current)}}}),[]),B=r.useMemo(()=>({width:400,height:200,padding:[8,0,8,28],cursor:{show:!1,x:!1,y:!1,drag:{x:!1,y:!1},points:{show:!1}},scales:{x:{time:!0},y:{range:[0,1]}},axes:[{show:!1},{show:!1}],series:[{},{show:!1}],plugins:[D]}),[D]);r.useEffect(()=>{const t=p.current;if(!t||0===e.length)return;const s=A.current,a=e.length,n=Math.abs(a-s);if(!(!g.current||n>100||s>0&&n/s>.1)&&g.current)return g.current.setData(L),void(A.current=a);g.current&&g.current.destroy();const r=t.getBoundingClientRect(),l=Math.floor(r.width)||400,i=Math.floor(r.height)||200,o=new E({...B,width:l,height:i},L,t);return g.current=o,A.current=a,()=>{o.destroy(),g.current=null}},[B,L,e.length]),r.useEffect(()=>{const e=p.current;if(!e)return;const t=new ResizeObserver(e=>{const t=e[0];if(!t||!g.current)return;const{width:s,height:a}=t.contentRect;s>0&&a>0&&g.current.setSize({width:Math.floor(s),height:Math.floor(a)})});return t.observe(e),()=>{t.disconnect()}},[]),r.useEffect(()=>{g.current&&g.current.redraw()},[a,s,e,i,o,c,d,m,u,P]);const H=r.useCallback(t=>{var s,a;const n=p.current,r=g.current;if(!n||!r||0===e.length)return;const l=n.getBoundingClientRect(),i=t.clientX-l.left,o=window.devicePixelRatio||1,c=r.bbox,d=c.left/o,m=c.width/o;if(i<d||i>d+m)return T.current=null,r.redraw(),void(null==(s=j.current)||s.call(j,null));T.current=i*o;const u=(i-d)/m,h=e.length,x=Math.floor(u*h),f=Math.max(0,Math.min(h-1,x));r.redraw(),null==(a=j.current)||a.call(j,f)},[e.length]),_=r.useCallback(()=>{var e;T.current=null,g.current&&g.current.redraw(),null==(e=j.current)||e.call(j,null)},[]);return 0===e.length?n.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No data available"}):n.jsx("div",{ref:p,className:"w-full h-full rounded-lg overflow-hidden",onMouseMove:H,onMouseLeave:_})}),Ie=le,qe=new class{constructor(){a(this,"buckets",new Map),a(this,"lastProcessedTimestamp",0),a(this,"processedPacketCount",0),a(this,"cacheKey",null),a(this,"bucketDuration",60),a(this,"bucketDurationMs",6e4)}getBuckets(e,t,s,a){const n={startTs:t,endTs:s,radioConfigHash:this.hashRadioConfig(a)};return this.isCacheValid(n)?this.processPackets(e,t,s,a,!1):(this.invalidate(n),this.processPackets(e,t,s,a,!0)),this.toBucketDataArray(t,s)}processPackets(e,t,s,a,n){const r=Math.ceil((s-t)/this.bucketDuration);let l=0;for(const i of e){const e=i.timestamp;if(e<t||e>=s)continue;if(!n&&e<=this.lastProcessedTimestamp)continue;const o=Math.min(Math.floor((e-t)/this.bucketDuration),r-1),c=this.buckets.get(o)??{total:0,totalAirtime:0};c.total+=1,c.totalAirtime+=D(i,{spreadingFactor:a.sf,bandwidthHz:a.bw,codingRate:a.cr,preambleLength:a.preamble}),this.buckets.set(o,c),e>this.lastProcessedTimestamp&&(this.lastProcessedTimestamp=e),l++}this.processedPacketCount+=l}toBucketDataArray(e,t){const s=t-e,a=Math.ceil(s/this.bucketDuration),n=s/3600,r=[];for(let l=0;l<a;l++){const t=e+l*this.bucketDuration,s=new Date(1e3*t),a=n>24?s.toLocaleDateString([],{weekday:"short",hour:"2-digit",minute:"2-digit",hour12:!1}):s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),i=this.buckets.get(l)??{total:0,totalAirtime:0};r.push({timestamp:t,time:a,total:i.total,totalAirtime:i.totalAirtime,bucketDurationMs:this.bucketDurationMs})}return r}isCacheValid(e){return!!this.cacheKey&&this.cacheKey.startTs===e.startTs&&this.cacheKey.endTs===e.endTs&&this.cacheKey.radioConfigHash===e.radioConfigHash}invalidate(e){this.buckets.clear(),this.lastProcessedTimestamp=0,this.processedPacketCount=0,this.cacheKey=e}hashRadioConfig(e){return`${e.sf}-${e.bw}-${e.cr}-${e.preamble}`}clear(){this.buckets.clear(),this.lastProcessedTimestamp=0,this.processedPacketCount=0,this.cacheKey=null}getStats(){return{bucketCount:this.buckets.size,processedPackets:this.processedPacketCount,lastTimestamp:this.lastProcessedTimestamp,cacheKey:this.cacheKey}}};function Xe(e){return _[e]??`TYPE_${e.toString(16).toUpperCase()}`}const Ge={sf:10,bw:25e4,cr:5,preamble:8};function Ke(e,t){if(0===e.length)return[];const s=Math.floor((t-1)/2),a=[];for(let n=0;n<e.length;n++){const t=n>=s?e[n-s]:e[0];a.push(e[n]+(e[n]-t))}return function(e,t){if(0===e.length)return[];const s=2/(t+1),a=[e[0]];for(let n=1;n<e.length;n++)a.push(s*e[n]+(1-s)*a[n-1]);return a}(a,t)}function Ye({sortedTypes:e,highlightedType:t,onTypeHover:s,aggregateShares:a,hoverData:l}){const i=r.useMemo(()=>{if(!l)return null;const e=new Map;for(const t of l.items)e.set(t.key,t.value);return e},[l]),o=null!==i;return n.jsx("div",{className:"flex-shrink-0 pt-3 mt-2",children:n.jsx("div",{className:"grid ml-9 gap-y-0.5",style:{gridTemplateColumns:"repeat(auto-fill, minmax(105px, 1fr))"},onMouseLeave:()=>s(null),children:e.map(e=>{const r=Ie(e.typeNum),l=(null==i?void 0:i.get(e.key))??0,c=a.get(e.key)??0,d=o?l:c,m=d>1e-4,u=t===e.key,h=t&&t!==e.key;let x="legend-item";return u?x+=" legend-item-active":h?x+=" legend-item-dimmed":o&&l>1e-4?x+=" legend-item-chart-active":o&&l<=1e-4&&(x+=" legend-item-dimmed"),n.jsxs("div",{className:x,onMouseEnter:()=>s(e.key),children:[n.jsx("div",{className:"flex-shrink-0",style:{backgroundColor:r,width:9,height:16,borderRadius:1}}),n.jsx("span",{className:"legend-label",children:e.label}),m&&n.jsxs("span",{className:"legend-value "+(o?"legend-value-live":""),children:[(100*d).toFixed(1),"%"]})]},e.key)})})})}function Ze({x:e,y:t,width:s,height:a,name:r,size:l,index:i,depth:o,hoveredIndex:c,onHover:d,total:m,typeNum:u}){if(1!==o)return null;const h=null!==c&&!(c===i),x=Ie(u),p=m>0?l/m*100:0,g=s>36&&a>20,f=s>36&&a>32;return n.jsxs("g",{onMouseEnter:e=>d(i,e),onMouseLeave:()=>d(null),style:{cursor:"default"},children:[n.jsx("rect",{x:e,y:t,width:s,height:a,fill:x,opacity:h?.4:1,stroke:"rgba(0,0,0,0.2)",strokeWidth:1,rx:3,style:{transition:"opacity 150ms ease"}}),g&&n.jsxs(n.Fragment,{children:[f&&n.jsxs("text",{x:e+4,y:t+a-4-11,textAnchor:"start",dominantBaseline:"auto",fill:"rgba(0,0,0,0.6)",fontSize:8,fontFamily:H,fontWeight:500,style:{pointerEvents:"none"},children:[p.toFixed(1),"%"]}),n.jsx("text",{x:e+4,y:t+a-4,textAnchor:"start",dominantBaseline:"auto",fill:"rgba(0,0,0,0.85)",fontSize:9,fontFamily:H,fontWeight:600,style:{pointerEvents:"none"},children:r})]})]})}function Qe({data:e,total:t,color:s,position:a,containerWidth:r}){if(!e||!a)return null;const l=(e.value/t*100).toFixed(1),i=r-a.x<184?Math.max(8,a.x-160-8):a.x+16;return n.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:i,top:Math.max(8,a.y-60)},children:n.jsxs("div",{className:"bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 shadow-xl min-w-[140px]",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[n.jsx("span",{className:"w-2.5 h-2.5 rounded-sm flex-shrink-0",style:{backgroundColor:s}}),n.jsx("span",{className:"type-data-sm font-semibold text-text-primary",children:e.name})]}),n.jsxs("div",{className:"space-y-0.5 type-data-xs text-text-muted",children:[n.jsxs("div",{className:"flex justify-between gap-4",children:[n.jsx("span",{children:"Count"}),n.jsx("span",{className:"text-text-primary tabular-nums font-medium",children:e.value.toLocaleString()})]}),n.jsxs("div",{className:"flex justify-between gap-4",children:[n.jsx("span",{children:"Share"}),n.jsxs("span",{className:"text-text-primary tabular-nums font-medium",children:[l,"%"]})]}),n.jsxs("div",{className:"flex justify-between gap-4",children:[n.jsx("span",{children:"Total"}),n.jsx("span",{className:"text-text-primary tabular-nums font-medium",children:t.toLocaleString()})]})]})]})})}function Ue({sortedTypes:e,aggregateShares:t}){var s,a,l;const[i,o]=r.useState(null),[c,d]=r.useState(null),[m,u]=r.useState(0),[h,x]=r.useState(null),p=r.useRef(null),f=r.useMemo(()=>e.reduce((e,t)=>e+t.totalCount,0),[e]),b=r.useMemo(()=>e.map((e,t)=>({name:e.label,size:e.totalCount,index:t,typeNum:e.typeNum,key:e.key})),[e]),y=r.useCallback((e,t)=>{if(o(e),t&&null!==e){const e=p.current;if(e){const s=e.getBoundingClientRect();u(s.width),d({x:t.clientX-s.left,y:t.clientY-s.top})}}else d(null)},[]),v=r.useCallback(e=>{if(x(e),e){const t=b.findIndex(t=>t.key===e);o(t>=0?t:null)}else o(null)},[b]),j=null!==i?{name:(null==(s=b[i])?void 0:s.name)??"",value:(null==(a=b[i])?void 0:a.size)??0}:null,N=null!==i?Ie(null==(l=b[i])?void 0:l.typeNum):"";return 0===e.length||0===f?n.jsxs("div",{className:"h-full flex items-center justify-center text-text-muted",children:[n.jsx(g,{className:"w-6 h-6 mr-2 opacity-50"}),n.jsx("span",{children:"No packet type data available"})]}):n.jsxs("div",{className:"flex flex-col",children:[n.jsxs("div",{className:"analyzer-chart-height relative flex-shrink-0",ref:p,children:[n.jsx(xe,{width:"100%",height:"100%",children:n.jsx(pe,{data:b,dataKey:"size",aspectRatio:4/3,stroke:"none",isAnimationActive:!1,content:n.jsx(Ze,{x:0,y:0,width:0,height:0,name:"",size:0,index:0,depth:0,hoveredIndex:i,onHover:y,total:f,typeNum:0})})}),n.jsx(Qe,{data:j,total:f,color:N,position:c,containerWidth:m})]}),n.jsx(Ye,{sortedTypes:e,highlightedType:h,onTypeHover:v,aggregateShares:t})]})}function Je(e){const{values:t,sum:s}=e;if(0===t.length)return{min:0,mean:0,median:0,p75:0,p95:0,p99:0,max:0};const a=[...t].sort((e,t)=>e-t),n=a.length,r=s/n,l=a[0],i=a[n-1],o=e=>{const t=Math.min(Math.ceil(e*n)-1,n-1);return a[Math.max(0,t)]};return{min:l,mean:r,median:n%2==0?(a[n/2-1]+a[n/2])/2:a[Math.floor(n/2)],p75:o(.75),p95:o(.95),p99:o(.99),max:i}}function et({statsBuckets:e,mode:t,packets:s,startTs:a,endTs:l,radioConfig:i,sortedTypes:o,aggregateShares:c,noiseFloorAnomalies:d,showNoiseFloorOverlay:m,overlayOpacity:u=.5}){const[h,x]=r.useState(null),[p,f]=r.useState(null),b=r.useMemo(()=>(l-a)/3600,[a,l]),y=r.useCallback(e=>{f(e)},[]),v=function(e,t,s,a,n){return r.useMemo(()=>{if(0===e.length||!n)return null;const r=e.filter(e=>e.timestamp>=t&&e.timestamp<=s);if(0===r.length)return null;const l=[],i=new Map;for(const e of r){const s=e.type??e.payload_type??-1,r=L(e);let o;if(o="airtime"===a?D(e,{spreadingFactor:n.sf,bandwidthHz:n.bw,codingRate:n.cr,preambleLength:n.preamble}):1,r<=0)continue;const c=Math.floor((e.timestamp-t)/300),d={timestamp:e.timestamp,airtimeMs:o,byteSize:r,packetType:s,bucketIndex:c};l.push(d),i.has(c)||i.set(c,[]),i.get(c).push(d)}if(0===l.length)return null;const o=[],c=[],d=[],m=new Map;if("share"===a)for(const[,e]of i)for(const t of e)m.set(t,t.byteSize);else for(const[,e]of i){const t=e.reduce((e,t)=>e+t.airtimeMs,0)/3e5*100;let s=0;for(const a of e)a.airtimeMs>s&&(s=a.airtimeMs);for(const a of e){const e=a.airtimeMs/s*t;m.set(a,e)}}for(const e of l){const t=m.get(e);void 0!==t&&(o.push(t),c.push(e.timestamp),d.push(e.packetType))}let u=c[0],h=c[0];for(let e=1;e<c.length;e++)c[e]<u&&(u=c[e]),c[e]>h&&(h=c[e]);const x=h-u||1,p=[...o].sort((e,t)=>e-t),g=p[0],f=p[p.length-1],b=Math.floor(.05*p.length),y=Math.floor(.5*p.length),v=Math.min(Math.ceil(.95*p.length),p.length-1),j=p[b],N=p[y],w=p[v],k=new Map;for(const e of o){const t=Math.round(100*e)/100;k.set(t,(k.get(t)??0)+1)}const M=k.size,C=[...k.entries()].sort((e,t)=>t[1]-e[1]).slice(0,5).map(([e,t])=>({value:e,count:t,percent:t/o.length*100}));let S;if("share"===a)S=200;else{const e=5,t=Math.ceil(f/e)*e;S=t<=10?10:t+e}const T=new Float32Array(2*o.length),F=new Float32Array(o.length),$=new Uint8Array(o.length),P=new Float32Array(o.length);for(let e=0;e<o.length;e++){const t=(c[e]-u)/x,s=1-Math.max(0,Math.min(S,o[e]))/S;T[2*e]=t,T[2*e+1]=s,F[e]=o[e],$[e]=d[e]>=0?d[e]:255,P[e]=c[e]}return{points:T,rawValues:F,packetTypes:$,timestamps:P,count:o.length,minTime:u,maxTime:h,minValue:0,maxValue:S,rawMinValue:g,rawMaxValue:f,unit:"%",stats:{p5:j,p50:N,p95:w,uniqueValues:M,topValues:C}}},[e,t,s,a,n])}(s,a,l,"share"===t?"share":"airtime",i),{data:j}=r.useMemo(()=>function(e,t){var s;const a=e.length;if(0===a)return{data:[],windowSize:0,windowDurationMs:0};const n=(null==(s=e[0])?void 0:s.bucketDurationMs)??1e3,r=Math.min(Math.max(5,Math.round(3e5/n)),a),l=Math.floor(r/2),i=[];let o=0,c=0;for(let d=0;d<a;d++){const s=e[d],n=Math.max(0,d-l),r=Math.min(a,d+l+1),m=[];let u,h=0;for(let a=n;a<r;a++){const s=e[a];let n;n="share"===t?s.total/Math.max(1,s.bucketDurationMs/1e3):s.totalAirtime/s.bucketDurationMs*100,m.push(n),h+=n}u="share"===t?s.total/Math.max(1,s.bucketDurationMs/1e3):s.totalAirtime/s.bucketDurationMs*100,o+=u,c++;const x=Je({values:m,sum:h}),p=(x.min+x.max)/2;i.push({timestamp:s.timestamp,time:s.time,min:x.min,max:x.max,p75:x.p75,p95:x.p95,p99:x.p99,mean:x.mean,median:x.median,average:o/c,midpoint:p})}return{data:i,windowSize:r,windowDurationMs:r*n}}(e,t),[e,t]),N=r.useMemo(()=>j.map(e=>({timestamp:e.timestamp,min:e.min,max:e.max,p75:e.p75,p95:e.p95,p99:e.p99,mean:e.mean,median:e.median,average:e.average,midpoint:e.midpoint})),[j]),w=r.useMemo(()=>(null==v?void 0:v.maxValue)?v.maxValue:"share"===t?200:10,[v,t]),k=r.useCallback(e=>{x(e)},[]),M=r.useMemo(()=>{if(null===h||!j[h])return null;const e=j[h];let t;t=b>=168?75:b>=72?35:b>=24?15:b>=3?10:5;const s=60*t/2,a=e.timestamp;return{start:a-s,end:a+s}},[h,j,b]),C=r.useMemo(()=>{if(null===h||!j[h]||!M)return null;const e=j[h].time,{start:a,end:n}=M,r=s.filter(e=>e.timestamp>=a&&e.timestamp<n);if(0===r.length)return{timestamp:j[h].timestamp,timeLabel:e,items:o.map(e=>({key:e.key,label:e.label,value:0,color:Ie(e.typeNum)}))};const l=new Map,c=new Map;let d=0,m=0;for(const t of r){const e=`TYPE_${t.type??t.payload_type??-1}`;if(l.set(e,(l.get(e)??0)+1),d++,i){const s=D(t,{spreadingFactor:i.sf,bandwidthHz:i.bw,codingRate:i.cr,preambleLength:i.preamble});c.set(e,(c.get(e)??0)+s),m+=s}}const u=o.map(e=>{let s;return s="airtime"===t?m>0?(c.get(e.key)??0)/m:0:d>0?(l.get(e.key)??0)/d:0,{key:e.key,label:e.label,value:s,color:Ie(e.typeNum)}});return{timestamp:j[h].timestamp,timeLabel:e,items:u}},[h,j,M,s,o,t,i]);if(0===j.length)return n.jsxs("div",{className:"h-full flex items-center justify-center text-text-muted",children:[n.jsx(g,{className:"w-6 h-6 mr-2 opacity-50"}),n.jsx("span",{children:"No packet data available"})]});const S=(null==C?void 0:C.timeLabel)??null;return n.jsxs("div",{className:"flex flex-col",children:[n.jsxs("div",{className:"analyzer-chart-height relative flex-shrink-0",children:[n.jsx("div",{className:"absolute inset-0 rounded-lg overflow-hidden",children:n.jsx(Ve,{data:N,maxValue:w,onHover:k,scatterData:v,noiseFloorAnomalies:d,showNoiseFloorOverlay:m,overlayOpacity:u,highlightedType:p,hoveredTimeRange:M,timeRangeHours:b,yAxisMode:"share"===t?"share":"airtime"})}),S&&n.jsx("div",{className:"absolute top-1 right-1 px-2 py-0.5 bg-bg-elevated/90 rounded text-xs text-accent-secondary font-mono pointer-events-none",children:S})]}),n.jsx(Ye,{sortedTypes:o,highlightedType:p,onTypeHover:y,aggregateShares:c,hoverData:C})]})}function tt({active:e,payload:t,label:s,mode:a}){if(!e||!t||0===t.length)return null;const r=t.filter(e=>null!==e.value&&void 0!==e.value);if(0===r.length)return null;const l=s?new Date(1e3*s).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}):"";return n.jsxs("div",{className:"bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 text-sm shadow-xl",children:[n.jsx("div",{className:"font-medium text-text-primary mb-1 font-mono",children:l}),r.map((e,t)=>n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-3 h-0.5",style:{backgroundColor:e.color}}),n.jsxs("span",{className:"text-text-muted",children:[e.name,":"]}),n.jsx("span",{className:"text-text-primary tabular-nums font-mono",children:"share"===a?`${Number(e.value).toLocaleString()} B`:`${Number(e.value).toFixed(2)}%`})]},t))]})}function st(e){return e>=1e9?`${(e/1e9).toFixed(1)}G`:e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:e.toFixed(0)}function at({packets:e,mode:t,startTs:s,endTs:a,radioConfig:l,bucketCount:i}){const o=oe(),c=ce(),d=o.primary,m=o.tertiary,u=o.secondary,[h,x]=r.useState(null),{trendData:p,totals:b}=r.useMemo(()=>{if(0===e.length)return{trendData:[],totals:{rxBytes:0,txBytes:0,rxAirtime:0,txAirtime:0}};const n=a-s,r=Math.min(Math.ceil(n/300),i),o=n/r,c=[];let d=0,m=0,u=0,h=0;for(const t of e){const e=t.timestamp;if(e<s||e>=a)continue;const n=L(t),r=D(t,{spreadingFactor:l.sf,bandwidthHz:l.bw,codingRate:l.cr,preambleLength:l.preamble}),i={timestamp:e,rxAirtime:0,txAirtime:0,rxBytes:0,txBytes:0};t.transmitted?(i.txAirtime=r,i.txBytes=n,m+=n,h+=r):(i.rxAirtime=r,i.rxBytes=n,d+=n,u+=r),c.push(i)}c.sort((e,t)=>e.timestamp-t.timestamp);const x=new Float64Array(c.length+1),p=new Float64Array(c.length+1),g=new Float64Array(c.length+1),f=new Float64Array(c.length+1),b=new Float64Array(c.length);for(let e=0;e<c.length;e++)x[e+1]=x[e]+c[e].rxAirtime,p[e+1]=p[e]+c[e].txAirtime,g[e+1]=g[e]+c[e].rxBytes,f[e+1]=f[e]+c[e].txBytes,b[e]=c[e].timestamp;const y=e=>{let t=0,s=b.length;for(;t<s;){const a=t+s>>>1;b[a]<e?t=a+1:s=a}return t},v=[],j=3e5;for(let e=0;e<r;e++){const a=s+e*o,n=a+o,r=y(a),l=y(n);if("share"===t){const e=g[l]-g[r],t=f[l]-f[r];v.push({timestamp:a,rx:e>0?e:null,tx:t>0?t:null})}else{const e=(x[l]-x[r])/j*100,t=(p[l]-p[r])/j*100;v.push({timestamp:a,rx:e>0?e:null,tx:t>0?t:null})}}const N=2/31;let w=null;return{trendData:v.map(e=>{const t=e.rx;return null!==t&&t>0&&(w=null===w?t:N*t+(1-N)*w),{...e,rxSmooth:null!==w&&w>0?w:null}}),totals:{rxBytes:d,txBytes:m,rxAirtime:u,txAirtime:h}}},[e,s,a,i,t,l,300]),y=r.useMemo(()=>{if(0===p.length)return"share"===t?100:10;let e=0;for(const t of p){const s=t.rx??0,a=t.tx??0;s>e&&(e=s),a>e&&(e=a)}const s=1.1*e;return"share"===t?s<=100?100:s<=500?100*Math.ceil(s/100):s<=1e3?200*Math.ceil(s/200):s<=5e3?500*Math.ceil(s/500):s<=1e4?1e3*Math.ceil(s/1e3):5e3*Math.ceil(s/5e3):Math.max(1,Math.ceil(s))},[p,t]),v=r.useMemo(()=>{if(null!==h&&p[h]){const e=p[h],s=e.rx??0,a=e.tx??0;return"share"===t?{rx:st(s),tx:st(a),total:st(s+a),isHovered:!0}:{rx:`${s.toFixed(2)}%`,tx:`${a.toFixed(2)}%`,total:`${(s+a).toFixed(2)}%`,isHovered:!0}}if("share"===t)return{rx:st(b.rxBytes),tx:st(b.txBytes),total:st(b.rxBytes+b.txBytes),isHovered:!1};{let e=0,t=0,s=0;for(const r of p)null===r.rx&&null===r.tx||(e+=r.rx??0,t+=r.tx??0,s++);const a=s>0?e/s:0,n=s>0?t/s:0;return{rx:`${a.toFixed(2)}%`,tx:`${n.toFixed(2)}%`,total:`${(a+n).toFixed(2)}%`,isHovered:!1}}},[h,p,b,t]),j=r.useMemo(()=>{const e=a-s,t=e/3600;return[0,.25,.5,.75,1].map(a=>{const n=new Date(1e3*(s+e*a)),r=n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),l=n.toLocaleDateString([],{weekday:"short"});return{pct:a,label:t>24?`${l} ${r}`:r}})},[s,a]),N=r.useCallback(e=>{const t=null==e?void 0:e.activeTooltipIndex;x("number"==typeof t?t:null)},[]),w=r.useCallback(e=>"share"===t?e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(0)}K`:e.toFixed(0):`${e.toFixed(0)}%`,[t]);return 0===p.length?n.jsxs("div",{className:"h-full flex items-center justify-center text-text-muted",children:[n.jsx(g,{className:"w-6 h-6 mr-2 opacity-50"}),n.jsx("span",{children:"No packet data available"})]}):n.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[n.jsx("div",{className:"flex items-center flex-shrink-0 text-text-secondary",style:{height:20,paddingLeft:44,paddingRight:8},children:n.jsx("div",{className:"relative w-full h-full flex items-center",children:j.map((e,t)=>n.jsxs("div",{className:"absolute flex items-center gap-1 type-data-xs",style:{left:100*e.pct+"%",transform:0===e.pct?"translateX(0)":1===e.pct?"translateX(-100%)":"translateX(-50%)"},children:[n.jsx(f,{className:"w-2.5 h-2.5 opacity-60"}),n.jsx("span",{className:"tabular-nums",children:e.label})]},t))})}),n.jsx("div",{className:"flex-1 min-h-0 relative",children:n.jsx(xe,{width:"100%",height:"100%",minWidth:1,minHeight:1,children:n.jsxs(ge,{data:p,margin:{top:4,right:8,bottom:4,left:0},onMouseMove:N,onMouseLeave:()=>x(null),children:[n.jsx(fe,{strokeDasharray:"3 3",stroke:c.secondary,strokeOpacity:.3,vertical:!1}),n.jsx(be,{dataKey:"timestamp",type:"number",domain:[s,a],axisLine:!1,tickLine:!1,tick:!1,height:0}),n.jsx(ye,{axisLine:!1,tickLine:!1,tick:{fill:c.secondary,fontSize:10,fontFamily:H},dx:-8,width:44,tickFormatter:w,domain:[0,y]}),n.jsx(ve,{content:n.jsx(tt,{mode:t})}),n.jsx(je,{type:"linear",dataKey:"rx",name:"RX",stroke:d,strokeWidth:2.5,strokeOpacity:.9,dot:!1,connectNulls:!1,isAnimationActive:!1}),n.jsx(je,{type:"linear",dataKey:"tx",name:"TX",stroke:m,strokeWidth:2.5,strokeOpacity:.9,dot:!1,connectNulls:!1,isAnimationActive:!1}),n.jsx(je,{type:"monotone",dataKey:"rxSmooth",name:"RX Avg",stroke:u,strokeWidth:2,strokeOpacity:.7,strokeDasharray:"4 2",dot:!1,connectNulls:!0,isAnimationActive:!1})]})})}),n.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between mt-2",children:[n.jsxs("div",{className:"flex items-center gap-4 text-xs font-mono pl-11",children:[n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx("div",{className:"w-4 h-0.5",style:{backgroundColor:d}}),n.jsx("span",{className:"text-text-secondary",children:"RX"})]}),n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx("div",{className:"w-4 h-0.5",style:{backgroundColor:m}}),n.jsx("span",{className:"text-text-secondary",children:"TX"})]}),n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx("div",{className:"w-4 h-0.5 border-t border-dashed",style:{borderColor:u}}),n.jsx("span",{className:"text-text-secondary",children:"RX Avg"})]})]}),n.jsxs("div",{className:"flex items-center gap-4 text-right pr-2 font-mono",children:[n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx("span",{className:"text-xs font-medium",style:{color:d},children:"RX"}),n.jsx("span",{className:"font-bold text-xl text-text-primary",children:v.rx})]}),n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx("span",{className:"text-xs font-medium",style:{color:m},children:"TX"}),n.jsx("span",{className:"font-bold text-xl text-text-primary",children:v.tx})]}),v.isHovered&&n.jsx("span",{className:"text-xs text-text-muted",children:"bucket"})]})]})]})}function nt({mode:e,onChange:t}){return n.jsxs("div",{className:"toggle-group toggle-group-sm",children:[n.jsx("button",{onClick:()=>t("share"),className:"toggle-group-item "+("share"===e?"active":""),children:"Total"}),n.jsx("button",{onClick:()=>t("airtime"),className:"toggle-group-item "+("airtime"===e?"active":""),children:"Airtime"})]})}function rt({enabled:e,onChange:t,anomalyCount:s=0,showTuning:a=!1,onTuningChange:r}){return n.jsxs("div",{className:"relative inline-flex items-center gap-1",children:[e&&r&&n.jsx("button",{onClick:()=>r(!a),className:"toggle-group toggle-group-sm "+(a?"active":""),title:a?"Hide tuning panel":"Show tuning panel",children:n.jsx("span",{className:"toggle-group-item "+(a?"active":""),children:n.jsx(l,{className:"w-3.5 h-3.5"})})}),n.jsx("button",{onClick:()=>t(!e),className:"toggle-group toggle-group-sm "+(e?"active":""),title:e?"Hide noise floor anomalies":"Show noise floor anomalies",children:n.jsx("span",{className:"toggle-group-item "+(e?"active":""),children:n.jsx(i,{className:"w-3.5 h-3.5"})})}),s>0&&n.jsx("span",{className:"absolute -top-2 -right-2 min-w-[18px] h-[18px] px-1 rounded-full bg-accent-danger text-white text-[10px] font-bold flex items-center justify-center pointer-events-none z-10",children:s>99?"99+":s})]})}function lt({smoothing:e,onChange:t}){return n.jsxs("div",{className:"toggle-group toggle-group-sm",children:[n.jsx("button",{onClick:()=>t("stats"),className:"toggle-group-item "+("stats"===e?"active":""),title:"Statistics view (scatter plot)",children:n.jsx(o,{className:"w-3.5 h-3.5"})}),n.jsx("button",{onClick:()=>t("trend"),className:"toggle-group-item "+("trend"===e?"active":""),title:"Trend line chart",children:n.jsx(c,{className:"w-3.5 h-3.5"})}),n.jsx("button",{onClick:()=>t("raw"),className:"toggle-group-item "+("raw"===e?"active":""),title:"No smoothing (raw values)",children:n.jsx(d,{className:"w-3.5 h-3.5"})}),n.jsx("button",{onClick:()=>t("zlema"),className:"toggle-group-item "+("zlema"===e?"active":""),title:"6-period Zero-Lag EMA (light smoothing)",children:n.jsx(m,{className:"w-3.5 h-3.5"})}),n.jsx("button",{onClick:()=>t("ema"),className:"toggle-group-item "+("ema"===e?"active":""),title:"12-period Zero-Lag EMA (moderate smoothing)",children:n.jsx(u,{className:"w-3.5 h-3.5"})}),n.jsx("button",{onClick:()=>t("smooth"),className:"toggle-group-item "+("smooth"===e?"active":""),title:"24-period Zero-Lag EMA (heavy smoothing)",children:n.jsx(h,{className:"w-3.5 h-3.5"})}),n.jsx("button",{onClick:()=>t("ultra"),className:"toggle-group-item "+("ultra"===e?"active":""),title:"96-period Zero-Lag EMA (ultra smoothing)",children:n.jsx(x,{className:"w-3.5 h-3.5"})}),n.jsx("button",{onClick:()=>t("mosaic"),className:"toggle-group-item "+("mosaic"===e?"active":""),title:"Mosaic view (treemap chart)",children:n.jsx(p,{className:"w-3.5 h-3.5"})})]})}const it=r.memo(function({packets:e,startTs:t,endTs:s,bucketCount:a,radioConfig:l=Ge,mode:i="share",smoothing:o="raw",noiseFloorAnomalies:c=null,showNoiseFloorOverlay:d=!1,overlayOpacity:m=.5}){const u=ie(),[h,x]=r.useState(null),[p,f]=r.useState([]),b=r.useRef(null),y=r.useRef(0);r.useEffect(()=>{const t=Math.abs(e.length-y.current);if(0===t&&p.length>0)return;b.current&&clearTimeout(b.current);const s=t>100?50:500;return b.current=setTimeout(()=>{y.current=e.length,f(e)},s),()=>{b.current&&clearTimeout(b.current)}},[e,p.length]);const v=r.useMemo(()=>function(e){const t=new Map;for(const a of e){const e=a.type??a.payload_type??-1;t.set(e,(t.get(e)??0)+1)}const s=[];for(const[a,n]of t)s.push({typeNum:a,key:`TYPE_${a}`,label:Xe(a),totalCount:n});return s.sort((e,t)=>t.totalCount-e.totalCount)}(p),[p]),j=r.useMemo(()=>function(e,t,s,a,n,r){const l=s-t,i=l/a,o=1e3*i,c=[];for(let d=0;d<a;d++){const e=t+d*i,s=new Date(1e3*e),a=l/3600>24?s.toLocaleDateString([],{weekday:"short",hour:"2-digit",minute:"2-digit",hour12:!1}):s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1});c.push({timestamp:e,time:a,counts:{},shares:{},airtimes:{},total:0,totalAirtime:0,bucketDurationMs:o});for(const t of r)c[d].counts[t.key]=0,c[d].airtimes[t.key]=0}for(const d of e){const e=d.timestamp;if(e<t||e>=s)continue;const r=Math.min(Math.floor((e-t)/i),a-1),l=`TYPE_${d.type??d.payload_type??-1}`;c[r].counts[l]=(c[r].counts[l]??0)+1,c[r].total++;const o=D(d,{spreadingFactor:n.sf,bandwidthHz:n.bw,codingRate:n.cr,preambleLength:n.preamble});c[r].airtimes[l]=(c[r].airtimes[l]??0)+o,c[r].totalAirtime+=o}for(const d of c)for(const e of r)d.total>0?d.shares[e.key]=d.counts[e.key]/d.total*100:d.shares[e.key]=0;return c}(p,t,s,a,l,v),[p,t,s,a,l,v]),N=r.useMemo(()=>qe.getBuckets(p,t,s,l),[p,t,s,l]),w=r.useMemo(()=>v.reduce((e,t)=>e+t.totalCount,0),[v]),{sortedTypes:k,aggregateShares:M}=r.useMemo(()=>{const e=new Map;if("share"===i){if(w>0)for(const t of v)e.set(t.key,t.totalCount/w)}else{let t=0;const s=new Map;for(const e of j){t+=e.totalAirtime;for(const t of v){const a=s.get(t.key)??0;s.set(t.key,a+(e.airtimes[t.key]??0))}}if(t>0)for(const a of v)e.set(a.key,(s.get(a.key)??0)/t)}return{sortedTypes:[...v].sort((t,s)=>{const a=e.get(t.key)??0;return(e.get(s.key)??0)-a}),aggregateShares:e}},[v,w,i,j]),C=r.useMemo(()=>function(e,t,s,a="raw"){const n=function(e,t,s){if(e.length<=360)return e;const a=Math.ceil(e.length/360),n=[];for(let r=0;r<e.length;r+=a){const t=e.slice(r,Math.min(r+a,e.length));if(0===t.length)continue;const l={timestamp:t[0].timestamp,time:t[0].time,counts:{},shares:{},airtimes:{},total:0,totalAirtime:0,bucketDurationMs:t[0].bucketDurationMs*t.length};for(const e of t){l.total+=e.total,l.totalAirtime+=e.totalAirtime;for(const t of s)l.counts[t.key]=(l.counts[t.key]??0)+(e.counts[t.key]??0),l.airtimes[t.key]=(l.airtimes[t.key]??0)+(e.airtimes[t.key]??0)}for(const e of s)l.shares[e.key]=l.total>0?l.counts[e.key]/l.total*100:0;n.push(l)}return n}(e,0,s),r=n.length,l=s.length,i=Array.from({length:l},()=>new Array(r).fill(0));for(let u=0;u<r;u++){const e=n[u];if("share"===t)for(let t=0;t<l;t++){const a=s[t].key;i[t][u]=e.total>0?(e.counts[a]??0)/e.total:0}else{let t=0;for(let a=0;a<l;a++)t+=e.airtimes[s[a].key]??0;for(let a=0;a<l;a++){const n=s[a].key,r=e.airtimes[n]??0;i[a][u]=t>0?r/t:0}}}const o=Array.from({length:l},()=>new Array(r).fill(0));for(let u=0;u<l;u++)for(let e=0;e<r;e++){let t=0;for(let s=0;s<=u;s++)t+=i[s][e];o[u][e]=t}const c=o.map(e=>function(e,t){switch(t){case"zlema":return Ke(e,6);case"ema":return Ke(e,12);case"smooth":return Ke(e,24);case"ultra":return Ke(e,96);default:return e}}(e,a)),d=Array.from({length:l},()=>new Array(r).fill(0));for(let u=0;u<l;u++)for(let e=0;e<r;e++){const t=u>0?c[u-1][e]:0;let s=c[u][e]-t;s<0&&(s=0),s>1&&(s=1),d[u][e]=s}for(let u=0;u<r;u++){let e=0;for(let t=0;t<l;t++)e+=d[t][u];if(e>0&&Math.abs(e-1)>1e-6){const t=1/e;for(let e=0;e<l;e++)d[e][u]*=t}}const m=[];for(let u=0;u<r;u++){const e={timestamp:n[u].timestamp,time:n[u].time};for(let t=0;t<l;t++)e[s[t].key]=d[t][u];m.push(e)}return m}(j,i,k,o),[j,i,k,o]),S=r.useCallback(e=>{x(e)},[]),[T,F]=r.useState(null),$=r.useCallback(e=>{F(e)},[]),P=r.useMemo(()=>{if(null===T||!C[T])return null;const e=C[T];return{timestamp:e.timestamp,timeLabel:e.time,items:k.map(t=>({key:t.key,label:t.label,value:e[t.key]??0,color:Ie(t.typeNum)}))}},[T,C,k]),R=r.useMemo(()=>({timestamps:C.map(e=>e.timestamp),series:k.map(e=>({key:e.key,label:e.label,color:Ie(e.typeNum),values:C.map(t=>t[e.key]??0)}))}),[C,k]);return 0===p.length?0===e.length?n.jsxs("div",{className:"h-full flex items-center justify-center text-text-muted",children:[n.jsx(g,{className:"w-6 h-6 mr-2 opacity-50"}),n.jsx("span",{children:"No packet data available"})]}):null:"mosaic"===o?n.jsx(Ue,{sortedTypes:k,aggregateShares:M}):"stats"===o?n.jsx(et,{statsBuckets:N,mode:i,packets:p,startTs:t,endTs:s,radioConfig:l,sortedTypes:k,aggregateShares:M,noiseFloorAnomalies:c,showNoiseFloorOverlay:d,overlayOpacity:m}):"trend"===o?n.jsx(at,{packets:p,mode:i,startTs:t,endTs:s,radioConfig:l,bucketCount:a}):n.jsxs("div",{className:"flex flex-col",children:[n.jsx("div",{className:"analyzer-chart-height relative flex-shrink-0",children:n.jsx("div",{className:"absolute inset-0 rounded-lg overflow-hidden",children:n.jsx(B,{timestamps:R.timestamps,series:R.series,highlightedKey:h,cursorColor:u.cursor,onHover:$})})}),n.jsx(Ye,{sortedTypes:k,highlightedType:h,onTypeHover:S,aggregateShares:M,hoverData:P})]})}),ot={"1x":1,"2x":2,"4x":4,"8x":8,"16x":16,"36x":36},ct=[1,5,10,25,50,100,150];function dt(e,t,s,a){const n=Math.PI/180,r=(a-t)*n,l=e*n,i=s*n,o=Math.sin(r)*Math.cos(i),c=Math.cos(l)*Math.sin(i)-Math.sin(l)*Math.cos(i)*Math.cos(r);return(180*Math.atan2(o,c)/Math.PI+360)%360}function mt(e,t,s,a){const n=Math.PI/180,r=(s-e)*n,l=(a-t)*n,i=Math.sin(r/2)**2+Math.cos(e*n)*Math.cos(s*n)*Math.sin(l/2)**2;return 12742*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}const ut=[{min:10,label:"Excellent"},{min:7,label:"Very Good"},{min:4,label:"Good"},{min:1,label:"Fair+"},{min:-2,label:"Fair"},{min:-5,label:"Fair-"},{min:-8,label:"Poor"},{min:-11,label:"Bad"},{min:-1/0,label:"Critical"}];function ht(e,t){return t[ue(e)]||"#808080"}const xt=r.memo(function({neighbors:e,quickNeighbors:t,localLat:s,localLon:a,onStatsChange:l}){const[i,o]=r.useState(null),[c,d]=r.useState(new Set),[m,u]=r.useState({width:0,height:0}),[h,x]=r.useState("1x"),[p,g]=r.useState(1),f=r.useRef(null),y=r.useRef({}),v=r.useRef(null),j=r.useRef(null),N=r.useRef(p);N.current=p;const w=de(),k=oe(),M=me(),C=ce();r.useEffect(()=>{const e=j.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e){const{width:e,height:s}=t.contentRect;e>0&&s>0&&u({width:e,height:s})}});t.observe(e);const s=e.getBoundingClientRect();return s.width>0&&s.height>0&&u({width:s.width,height:s.height}),()=>t.disconnect()},[]);const S=r.useMemo(()=>{const e=new Set;if(t)for(const s of t)e.add(s.hash);return e},[t]),T=r.useMemo(()=>{const e=new Map;if(t)for(const s of t)e.set(s.hash,{snr:s.avgSnr,rssi:s.avgRssi});return e},[t]),{processedNeighbors:F,maxDistance:$,totalNeighbors:P,zeroHopCount:R}=r.useMemo(()=>{const t=[];for(const[r,l]of Object.entries(e)){if(!l.latitude||!l.longitude||0===l.latitude||0===l.longitude)continue;if(!S.has(r))continue;const e=dt(s,a,l.latitude,l.longitude),n=mt(s,a,l.latitude,l.longitude),i=T.get(r);t.push({hash:r.slice(0,8),name:l.node_name||l.name||"Unknown",snr:(null==i?void 0:i.snr)??l.snr??null,rssi:(null==i?void 0:i.rssi)??l.rssi??null,bearing:e,distance:n,normalizedDistance:0,lastSeen:l.last_seen,isZeroHop:!0})}const n=1.08*(t.length>0?Math.max(...t.map(e=>e.distance)):0);return t.sort((e,t)=>(e.snr??-1/0)-(t.snr??-1/0)),{processedNeighbors:t,maxDistance:n,totalNeighbors:t.length,zeroHopCount:t.length}},[e,s,a,S,T]);r.useEffect(()=>{null==l||l({zeroHopCount:R,totalCount:P,maxDistanceKm:$})},[R,P,$]),r.useEffect(()=>{const e=ot[h],t=N.current;f.current&&cancelAnimationFrame(f.current);const s=performance.now(),a=n=>{const r=n-s,l=Math.min(r/400,1),i=(o=l)<.5?8*o*o*o*o:1-Math.pow(-2*o+2,4)/2;var o;g(t+(e-t)*i),f.current=l<1?requestAnimationFrame(a):null};return f.current=requestAnimationFrame(a),()=>{f.current&&cancelAnimationFrame(f.current)}},[h]);const A=$/p,L=r.useMemo(()=>ct.filter(e=>e<=1.1*A),[A]);r.useEffect(()=>{const e=[];for(const s of F){const t=y.current[s.hash];void 0!==t&&t!==s.lastSeen&&e.push(s.hash),y.current[s.hash]=s.lastSeen}if(0===e.length)return;queueMicrotask(()=>{d(t=>new Set([...t,...e]))});const t=setTimeout(()=>{d(t=>{const s=new Set(t);return e.forEach(e=>s.delete(e)),s})},600);return()=>clearTimeout(t)},[F]);const D=0!==s&&0!==a,E=r.useMemo(()=>{const{width:e,height:t}=m,s=e/2,a=t/2,n=Math.max(10,e/2-12),r=Math.max(10,t/2-12),l=Math.max(10,n-16),i=Math.max(10,r-16);return{width:e,height:t,centerX:s,centerY:a,maxRadiusX:l,maxRadiusY:i,labelRadiusX:n,labelRadiusY:r,cornerRadius:.2*Math.min(l,i)}},[m]),{width:B,height:_,centerX:z,centerY:O,maxRadiusX:W,maxRadiusY:V,labelRadiusX:I,labelRadiusY:q,cornerRadius:X}=E,G=r.useCallback((e,t=1)=>{const s=W*t,a=V*t,n=Math.min(X*t,s,a),r=(e%360+360)%360,l=r*Math.PI/180,i=180*Math.atan2(a-n,s-n)/Math.PI;let o,c;if(r<=45-i||r>315+i){const e=Math.tan(l);o=Math.max(z-s+n,Math.min(z+s-n,z+a*e*(s/a))),c=O-a}else if(r>45-i&&r<=45+i)o=z+s-n+n*Math.sin(l),c=O-a+n-n*Math.cos(l);else if(r>45+i&&r<=135-i){const e=1/Math.tan(l);c=Math.max(O-a+n,Math.min(O+a-n,O-s*e*(a/s))),o=z+s}else if(r>135-i&&r<=135+i)o=z+s-n+n*Math.sin(l),c=O+a-n-n*Math.cos(l);else if(r>135+i&&r<=225-i){const e=Math.tan(l);o=Math.max(z-s+n,Math.min(z+s-n,z-a*e*(s/a))),c=O+a}else if(r>225-i&&r<=225+i)o=z-s+n+n*Math.sin(l),c=O+a-n-n*Math.cos(l);else if(r>225+i&&r<=315-i){const e=1/Math.tan(l);c=Math.max(O-a+n,Math.min(O+a-n,O-s*e*(a/s))),o=z-s}else o=z-s+n+n*Math.sin(l),c=O-a+n-n*Math.cos(l);return{x:o,y:c}},[z,O,W,V,X]),K=r.useCallback((e,t)=>{const s=G(e,1);return{x:z+(s.x-z)*t,y:O+(s.y-O)*t}},[G,z,O]),Y=r.useCallback(e=>({N:{x:z,y:O-q},S:{x:z,y:O+q},E:{x:z+I,y:O},W:{x:z-I,y:O},NE:{x:z+I,y:O-q},SE:{x:z+I,y:O+q},SW:{x:z-I,y:O+q},NW:{x:z-I,y:O-q}}[e]),[z,O,I,q]),Z=r.useCallback(e=>{const t=W*e,s=V*e,a=Math.min(X*e,t,s),n=z-t,r=z+t,l=O-s,i=O+s;return[`M ${n+a} ${l}`,`L ${r-a} ${l}`,`Q ${r} ${l} ${r} ${l+a}`,`L ${r} ${i-a}`,`Q ${r} ${i} ${r-a} ${i}`,`L ${n+a} ${i}`,`Q ${n} ${i} ${n} ${i-a}`,`L ${n} ${l+a}`,`Q ${n} ${l} ${n+a} ${l}`,"Z"].join(" ")},[z,O,W,V,X]),Q=r.useCallback(e=>{o(e)},[]),U=r.useCallback(e=>{x(e)},[]),J=r.useCallback(e=>$<=0?0:e/$*p,[$,p]),ee=e=>`${e}km`,te=r.useMemo(()=>{const e=L.map(e=>{const t=e/$*p;return{km:e,scale:t,labelY:O-V*t*.71}}).filter(e=>e.scale<=1.05&&e.scale>=.02).sort((e,t)=>t.km-e.km),t=[];for(const s of e)t.some(e=>Math.abs(e.labelY-s.labelY)<28)||t.push(s);return t},[L,$,p,O,V]),se=m.width>0&&m.height>0;return D?0===P?n.jsxs("div",{ref:v,className:"flex flex-col items-center justify-center h-full text-text-secondary",children:[n.jsx(b,{className:"w-8 h-8 mb-2 opacity-50"}),n.jsx("p",{children:"No nodes with location data"})]}):n.jsxs("div",{ref:v,className:"relative h-full w-full flex overflow-hidden",children:[n.jsx("div",{ref:j,className:"relative flex-1 min-w-0 h-full",children:se&&n.jsxs("svg",{width:B,height:_,className:"absolute inset-0 z-0",children:[n.jsxs("defs",{children:[n.jsx("style",{children:"\n                @keyframes neighbor-blink-scale {\n                  0%, 100% {\n                    transform: scale(1);\n                    opacity: 0;\n                  }\n                  50% {\n                    transform: scale(1.3);\n                    opacity: 0.8;\n                  }\n                }\n                .neighbor-blink-ring {\n                  transform-origin: center;\n                  animation: neighbor-blink-scale 600ms ease-out forwards;\n                }\n              "}),n.jsx("clipPath",{id:"radar-clip",children:n.jsx("path",{d:Z(1)})})]}),L.map(e=>{const t=J(e);if(t>1.05||t<.02)return null;const s=te.some(t=>t.km===e),a=z+W*t*.71,r=O-V*t*.71;return n.jsxs("g",{children:[n.jsx("path",{d:Z(t),fill:"none",stroke:C.primary,strokeOpacity:.15,strokeWidth:1}),s&&n.jsx("text",{x:a+4,y:r-2,textAnchor:"start",dominantBaseline:"auto",className:"fill-text-secondary",fontSize:10,fontFamily:H,children:ee(e)})]},`ring-${e}`)}),["N","E","S","W"].map(e=>{const t="N"===e||"S"===e,s=t?z:"E"===e?z+W:z-W,a=t?"N"===e?O-V:O+V:O;return n.jsx("line",{x1:z,y1:O,x2:s,y2:a,stroke:C.primary,strokeOpacity:.15,strokeWidth:1,strokeDasharray:"4 4"},e)}),["NE","SE","SW","NW"].map(e=>{const t=Y(e);return n.jsx("line",{x1:z,y1:O,x2:t.x,y2:t.y,stroke:C.primary,strokeOpacity:.08,strokeWidth:1,strokeDasharray:"4 4"},`diag-${e}`)}),["N","E","S","W"].map(e=>{const t=Y(e),s="E"===e?"end":"W"===e?"start":"middle",a="N"===e?"hanging":"S"===e?"auto":"middle";return n.jsx("text",{x:t.x,y:t.y,textAnchor:s,dominantBaseline:a,fill:k.primary,fontSize:16,fontWeight:600,fontFamily:H,"aria-hidden":"true",children:e},e)}),["NE","SE","SW","NW"].map(e=>{const t=Y(e),s="NE"===e||"SE"===e?"end":"start",a="NE"===e||"NW"===e?"hanging":"auto";return n.jsx("text",{x:t.x,y:t.y,textAnchor:s,dominantBaseline:a,fill:k.primary,fontSize:16,fontWeight:600,fontFamily:H,"aria-hidden":"true",children:e},e)}),n.jsx("circle",{cx:z,cy:O,r:5,fill:M.chart6,stroke:"rgba(255,255,255,0.3)",strokeWidth:1,role:"img","aria-label":"Local node"}),n.jsx("g",{clipPath:"url(#radar-clip)",children:F.map(e=>{const t=$>0?e.distance/$*p:0;if(t>1)return null;const{x:s,y:a}=K(e.bearing,t),r=null!==e.snr?ht(e.snr,w):"#808080",l=(null==i?void 0:i.hash)===e.hash,o=c.has(e.hash);return n.jsxs("g",{role:"img","aria-label":`${e.name}: ${e.distance.toFixed(1)}km ${e.bearing.toFixed(0)}`,children:[o&&n.jsx("circle",{cx:s,cy:a,r:10.5,fill:"none",stroke:"rgba(255,255,255,0.9)",strokeWidth:2,className:"neighbor-blink-ring"}),l&&n.jsx("circle",{cx:s,cy:a,r:10.5,fill:r,opacity:.3}),n.jsx("circle",{cx:s,cy:a,r:l?7:5,fill:r,stroke:"rgba(0,0,0,0.5)",strokeWidth:1,style:{cursor:"pointer",transition:"r 0.15s"},onMouseEnter:()=>Q(e),onMouseLeave:()=>Q(null)})]},e.hash)})})]})}),n.jsx("div",{className:"flex flex-col h-full items-stretch gap-1 py-2 pl-2 flex-shrink-0",role:"group","aria-label":"Zoom level",children:["1x","2x","4x","8x","16x","36x"].map(e=>n.jsx("button",{onClick:()=>U(e),"aria-pressed":h===e,className:"flex flex-1 items-center justify-center px-1.5 text-xs font-medium rounded transition-colors "+(h===e?"bg-accent-primary/20 text-accent-primary":"bg-white/5 text-text-secondary hover:bg-white/10 hover:text-text-primary"),children:e},e))}),i&&n.jsxs("div",{className:"absolute bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 text-sm pointer-events-none z-10 shadow-xl",style:{left:"50%",bottom:8,transform:"translateX(-50%)"},children:[n.jsx("div",{className:"font-medium text-text-primary",children:i.name}),n.jsx("div",{className:"text-text-secondary text-xs font-mono",children:i.hash}),null!==i.snr?n.jsx("div",{className:"flex gap-3 mt-1 text-xs",children:n.jsxs("span",{children:[n.jsx("span",{className:"text-text-secondary",children:"SNR:"})," ",n.jsxs("span",{className:"tabular-nums",style:{color:ht(i.snr,w)},children:[i.snr.toFixed(1)," dB"]}),n.jsxs("span",{className:"text-text-secondary ml-1",children:["(",(ae=i.snr,(null==(ne=ut.find(e=>ae>=e.min))?void 0:ne.label)??"Critical"),")"]})]})}):n.jsx("div",{className:"text-xs text-text-secondary mt-1",children:"No SNR data"}),n.jsxs("div",{className:"flex gap-3 text-xs",children:[n.jsxs("span",{children:[n.jsx("span",{className:"text-text-secondary",children:"Distance:"})," ",n.jsxs("span",{className:"tabular-nums text-text-primary",children:[i.distance.toFixed(2)," km"]})]}),n.jsxs("span",{children:[n.jsx("span",{className:"text-text-secondary",children:"Bearing:"})," ",n.jsxs("span",{className:"tabular-nums text-text-primary",children:[i.bearing.toFixed(0),""]})]})]})]})]}):n.jsxs("div",{ref:v,className:"flex flex-col items-center justify-center h-full text-text-secondary",children:[n.jsx(b,{className:"w-8 h-8 mb-2 opacity-50"}),n.jsx("p",{children:"Local node coordinates not configured"}),n.jsx("p",{className:"text-xs mt-1",children:"Set latitude/longitude in config to enable"})]});var ae,ne});function pt(e,t){if(0===e.length)return 0;const s=t/100*(e.length-1),a=Math.floor(s),n=Math.ceil(s);return a===n?e[a]:e[a]+(e[n]-e[a])*(s-a)}const gt=r.memo(function({timestamps:e,values:t,onStatsChange:s}){var a,l;const{theme:i}=z(),[o,c]=r.useState(!0),d=r.useMemo(()=>{if(0===t.length)return null;const e=Math.min(...t),s=Math.max(...t),a=t.reduce((e,t)=>e+t,0)/t.length,n=[...t].sort((e,t)=>e-t);return{min:e,max:s,avg:a,p5:pt(n,5),p95:pt(n,95)}},[t]);r.useEffect(()=>{null==s||s(d)},[d]);const m=r.useCallback(()=>{c(e=>!e)},[]),{heatmapData:u,xLabels:h,yLabels:x}=r.useMemo(()=>{if(0===e.length||0===t.length||!d)return{heatmapData:null,xLabels:[],yLabels:[]};let s,a;if(o){const e=.1*(d.p95-d.p5||1);s=d.p5-e,a=d.p95+e}else{const e=.1*(d.max-d.min||1);s=d.min-e,a=d.max+e}const n=a-s,r=e[0],l=e[e.length-1]-r||1,i=new Float32Array(2*e.length);for(let o=0;o<e.length;o++){const c=(e[o]-r)/l,d=1-(Math.max(s,Math.min(a,t[o]))-s)/n;i[2*o]=c,i[2*o+1]=d}const c=[];for(let e=0;e<=5;e++){const t=r+l*e/5;c.push({pos:e/5*100,label:new Date(1e3*t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})}const m=[];for(let e=0;e<=4;e++){const t=s+n*e/4;m.push({pos:100*(1-e/4),label:`${Math.round(t)}`})}return{heatmapData:{points:i,count:e.length},xLabels:c,yLabels:m}},[e,t,d,o]),p=r.useRef(null),g=r.useRef(null),[f,b]=r.useState({width:0,height:0});return r.useEffect(()=>{const e=g.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e){const{width:e,height:s}=t.contentRect;e>0&&s>0&&b({width:e,height:s})}});t.observe(e);const s=e.getBoundingClientRect();return s.width>0&&s.height>0&&b({width:s.width,height:s.height}),()=>t.disconnect()},[]),r.useEffect(()=>{const e=p.current;if(!e||!u||0===f.width)return;const t=e.getContext("2d");if(!t)return;const{width:s,height:a}=f,n=window.devicePixelRatio||1;e.width=s*n,e.height=a*n,e.style.width=`${s}px`,e.style.height=`${a}px`,t.scale(n,n),t.clearRect(0,0,s,a);const r=getComputedStyle(document.documentElement).getPropertyValue("--accent-primary").trim(),{r:l,g:i,b:o}=(e=>{const t=e.match(/color\(display-p3\s+([\d.]+)\s+([\d.]+)\s+([\d.]+)\)/);if(t)return{r:Math.round(255*parseFloat(t[1])),g:Math.round(255*parseFloat(t[2])),b:Math.round(255*parseFloat(t[3]))};const s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return s?{r:parseInt(s[1],16),g:parseInt(s[2],16),b:parseInt(s[3],16)}:{r:250,g:189,b:47}})(r),{points:c,count:d}=u,m=Math.max(3,Math.min(8,s/d*4));t.globalCompositeOperation="source-over";for(let u=0;u<d;u++){const e=c[2*u]*s,n=c[2*u+1]*a,r=t.createRadialGradient(e,n,0,e,n,m);r.addColorStop(0,`rgba(${l}, ${i}, ${o}, 0.85)`),r.addColorStop(.25,`rgba(${l}, ${i}, ${o}, 0.85)`),r.addColorStop(.35,`rgba(${l}, ${i}, ${o}, 0.15)`),r.addColorStop(1,`rgba(${l}, ${i}, ${o}, 0)`),t.fillStyle=r,t.beginPath(),t.arc(e,n,m,0,2*Math.PI),t.fill()}},[u,f,i.colorScheme]),u?n.jsxs("div",{className:"relative w-full h-full",role:"img","aria-label":`RF noise floor heatmap showing values from ${(null==(a=null==d?void 0:d.min)?void 0:a.toFixed(0))??"N/A"} to ${(null==(l=null==d?void 0:d.max)?void 0:l.toFixed(0))??"N/A"} dBm`,children:[n.jsx("div",{className:"absolute top-0 left-0 flex flex-col justify-between",style:{width:32,bottom:20},"aria-hidden":"true",children:x.map((e,t)=>n.jsx("span",{className:"type-data-xs text-text-secondary tabular-nums text-right pr-1.5",style:{position:"absolute",top:`${e.pos}%`,transform:"translateY(-50%)",right:0},children:e.label},t))}),n.jsxs("div",{ref:g,className:"absolute overflow-hidden",style:{left:32,right:0,top:0,bottom:20},children:[n.jsx("svg",{className:"absolute inset-0 w-full h-full",preserveAspectRatio:"none","aria-hidden":"true",children:[0,25,50,75,100].map(e=>n.jsx("line",{x1:"0",y1:`${e}%`,x2:"100%",y2:`${e}%`,stroke:"rgba(255,255,255,0.06)",strokeDasharray:"3 3"},e))}),n.jsx("canvas",{ref:p,className:"absolute inset-0 w-full h-full","aria-hidden":"true"}),n.jsx("button",{type:"button",onClick:m,className:"absolute bottom-1 right-1 p-1.5 rounded bg-tooltip-bg/80 hover:bg-tooltip-bg active:bg-tooltip-bg transition-colors touch-manipulation",title:o?"Show full range (min/max)":"Show trimmed range (P5-P95)","aria-label":o?"Expand to show full data range":"Shrink to show trimmed percentile range","aria-pressed":!o,children:o?n.jsx(y,{className:"w-3.5 h-3.5 text-text-muted","aria-hidden":"true"}):n.jsx(v,{className:"w-3.5 h-3.5 text-text-muted","aria-hidden":"true"})})]}),n.jsx("div",{className:"absolute left-0 right-0 bottom-0",style:{left:32,height:20},"aria-hidden":"true",children:h.map((e,t)=>n.jsx("span",{className:"type-data-xs text-text-secondary tabular-nums absolute top-1",style:{left:`${e.pos}%`,transform:"translateX(-50%)"},children:e.label},t))})]}):n.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No noise floor data available"})}),ft={repeater:"var(--accent-primary)",companion:"var(--accent-tertiary)",room_server:"var(--accent-secondary)"};function bt(e){if(e.contact_type){const t=e.contact_type.toLowerCase();if("repeater"===t||"rep"===t)return"repeater";if("room server"===t||"room_server"===t||"room"===t||"server"===t)return"room_server";if("companion"===t||"client"===t||"cli"===t)return"companion"}return e.is_repeater?"repeater":"companion"}const yt=r.memo(function({neighbors:e}){const t=r.useMemo(()=>{const t={repeater:0,companion:0,room_server:0};for(const a of Object.values(e)){const e=bt(a);t[e]=(t[e]||0)+1}const s=Object.values(t).reduce((e,t)=>e+t,0);return{items:[{label:"Repeaters",count:t.repeater,percent:0,color:ft.repeater},{label:"Companions",count:t.companion,percent:0,color:ft.companion},{label:"Room Servers",count:t.room_server,percent:0,color:ft.room_server}].map(e=>({...e,percent:s>0?e.count/s*100:0})).filter(e=>e.count>0).sort((e,t)=>t.count-e.count),total:s}},[e]);return 0===t.total?n.jsx("div",{className:"h-full flex items-center justify-center text-text-muted type-body-sm",children:"No neighbors discovered yet"}):n.jsxs("div",{className:"h-full flex flex-col",children:[n.jsx("div",{className:"flex-1 flex flex-col justify-evenly",children:t.items.map(e=>n.jsxs("div",{className:"flex flex-col gap-1.5",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"type-data-sm text-text-secondary",children:e.label}),n.jsxs("span",{className:"type-data-sm text-text-secondary tabular-nums",children:[e.count," ",n.jsxs("span",{className:"text-text-secondary/60",children:["(",e.percent.toFixed(0),"%)"]})]})]}),n.jsx("div",{className:"h-2.5 bg-bg-elevated rounded-full overflow-hidden",children:n.jsx("div",{className:"h-full rounded-full transition-all duration-500 ease-out",style:{width:`${e.percent}%`,backgroundColor:e.color,minWidth:e.count>0?"4px":"0"}})})]},e.label))}),n.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border-subtle",children:[n.jsx("span",{className:"type-data-xs text-text-secondary",children:"Total Nodes"}),n.jsx("span",{className:"type-data-sm text-text-primary font-medium tabular-nums",children:t.total})]})]})});function vt({children:e,minHeight:t="100%",rootMargin:s="200px 0px",keepMounted:a=!0,className:l=""}){const i=r.useRef(null),[o,c]=r.useState(!1),[d,m]=r.useState(!1);r.useEffect(()=>{const e=i.current;if(!e)return;const t=new IntersectionObserver(([e])=>{const t=e.isIntersecting;m(t),t&&c(!0)},{rootMargin:s,threshold:0});return t.observe(e),()=>{t.disconnect()}},[s]);const u=d||a&&o;return n.jsx("div",{ref:i,className:`h-full w-full ${l}`,style:{minHeight:t},children:u?e:n.jsx("div",{className:"h-full w-full flex items-center justify-center text-text-muted/50",children:n.jsx("div",{className:"animate-pulse text-xs",children:"Loading chart..."})})})}const jt={excellent:"text-signal-excellent",good:"text-signal-good",fair:"text-signal-fair",poor:"text-accent-primary"},Nt={excellent:"bg-signal-excellent/10",good:"bg-signal-good/10",fair:"bg-signal-fair/10",poor:"bg-accent-primary/10"},wt={excellent:"bg-signal-excellent",good:"bg-signal-good",fair:"bg-signal-fair",poor:"bg-accent-primary"};function kt({value:e,status:t}){return n.jsx("div",{className:"w-full h-2 bg-surface-elevated rounded-full overflow-hidden",children:n.jsx("div",{className:`h-full ${wt[t]} transition-all duration-300`,style:{width:`${Math.min(100,Math.max(0,e))}%`}})})}function Mt(){const e=O(),t=W(),[s,a]=r.useState(null),l=r.useCallback((e,t)=>{a({prefix:e,candidateHashes:t})},[]),i=r.useCallback(()=>{a(null)},[]);if(!t)return n.jsxs(we,{children:[n.jsx(ke,{icon:n.jsx(j,{}),title:"Prefix Conflicts",largeTitle:!0}),n.jsx("div",{className:"flex-1 flex items-center justify-center",children:n.jsxs("div",{className:"text-center text-text-secondary",children:[n.jsx(N,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),n.jsx("p",{className:"type-data-xs",children:"No topology data available"}),n.jsx("p",{className:"type-data-xs opacity-70",children:"Run deep analysis to see stats"})]})})]});const o=(c=e.avgConfidence)>=.9?"excellent":c>=.7?"good":c>=.5?"fair":"poor";var c;const d=(m=e.collisionRate)<=10?"excellent":m<=25?"good":"poor";var m;const u="poor"===o||"poor"===d?"poor":"fair"===o||"fair"===d?"fair":"good"===o||"good"===d?"good":"excellent",h="excellent"===u||"good"===u?w:k;return n.jsxs(we,{className:"flex flex-col overflow-hidden",children:[n.jsx(ke,{icon:n.jsx(j,{}),title:"Prefix Conflicts",largeTitle:!0,actions:n.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1 rounded-full ${Nt[u]}`,children:[n.jsx(h,{className:`w-3.5 h-3.5 ${jt[u]}`}),n.jsx("span",{className:`type-data-xs font-medium ${jt[u]}`,children:"excellent"===u?"Excellent":"good"===u?"Good":"fair"===u?"Fair":"Needs Attention"})]})}),n.jsxs("div",{className:"flex-1 overflow-y-auto min-h-0",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[n.jsxs("div",{className:"cursor-help",title:"Average confidence score across all disambiguated prefixes. Higher = more certain node identification. Based on geographic proximity, co-occurrence patterns, and observation recency.",children:[n.jsxs("div",{className:"flex items-baseline justify-between mb-1",children:[n.jsx("span",{className:"type-data-xs text-text-secondary",children:"Avg Confidence"}),n.jsxs("span",{className:`type-data-lg font-semibold ${jt[o]}`,children:[(100*e.avgConfidence).toFixed(1),"%"]})]}),n.jsx(kt,{value:100*e.avgConfidence,status:o})]}),n.jsxs("div",{className:"cursor-help",title:"Percentage of 2-character prefixes that match multiple known nodes. Lower is better. Collisions require disambiguation to determine the correct node.",children:[n.jsxs("div",{className:"flex items-baseline justify-between mb-1",children:[n.jsx("span",{className:"type-data-xs text-text-secondary",children:"Collision Rate"}),n.jsxs("span",{className:`type-data-lg font-semibold ${jt[d]}`,children:[e.collisionRate.toFixed(1),"%"]})]}),n.jsx(kt,{value:e.collisionRate,status:d})]})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[n.jsxs("div",{className:"text-center cursor-help px-2 py-1.5 rounded",style:{backgroundColor:"var(--hover-tint)"},title:"Total unique 2-character prefixes observed in packet paths. Each prefix represents the first 2 hex digits of a node's full hash.",children:[n.jsx("div",{className:"type-data-lg font-semibold text-text-primary",children:e.totalPrefixes}),n.jsx("div",{className:"type-data-xs text-text-secondary",children:"Prefixes"})]}),n.jsxs("div",{className:"text-center cursor-help px-2 py-1.5 rounded",style:{backgroundColor:"var(--hover-tint)"},title:"Prefixes that map to exactly one known node. No disambiguation neededthese are definitive identifications.",children:[n.jsx("div",{className:"type-data-lg font-semibold text-signal-good",children:e.unambiguousPrefixes}),n.jsx("div",{className:"type-data-xs text-text-secondary",children:"Unique"})]}),n.jsxs("div",{className:"text-center cursor-help px-2 py-1.5 rounded",style:{backgroundColor:"var(--hover-tint)"},title:"Prefixes matching multiple known nodes. Click a prefix below to explore candidates and see how disambiguation scores them.",children:[n.jsx("div",{className:"type-data-lg font-semibold "+(e.collisionPrefixes>0?"text-accent-primary":"text-text-primary"),children:e.collisionPrefixes}),n.jsx("div",{className:"type-data-xs "+(e.collisionPrefixes>0?"text-accent-primary":"text-text-secondary"),children:"Collisions"})]})]}),e.highCollisionPrefixes.length>0&&n.jsxs("div",{className:"mb-2",children:[n.jsx("div",{className:"type-data-xs text-text-secondary mb-1.5",children:"Highest Collisions"}),n.jsx("div",{className:"flex flex-wrap gap-1",children:e.highCollisionPrefixes.map(({prefix:e,candidateCount:t,candidateHashes:s})=>n.jsxs("button",{type:"button",onClick:()=>l(e,s),className:"inline-flex items-center gap-1 px-1.5 py-0.5 min-h-[24px] rounded bg-surface-elevated text-text-secondary type-data-xs font-mono hover:bg-accent-primary/20 hover:text-accent-primary focus:outline-none focus:ring-2 focus:ring-accent-primary/50 transition-colors cursor-pointer touch-manipulation",title:`Click to explore ${t} candidates matching this prefix`,"aria-label":`Explore prefix ${e} with ${t} colliding candidates`,children:[e,n.jsxs("span",{className:"text-accent-primary",children:["",t]})]},e))})]}),e.lowConfidencePrefixes.length>0&&n.jsx("div",{className:"mt-auto pt-2",children:n.jsxs("div",{className:"flex items-start gap-1.5",children:[n.jsx(k,{className:"w-3.5 h-3.5 text-accent-primary mt-0.5 flex-shrink-0"}),n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"type-data-xs text-accent-primary font-medium",children:[n.jsx("span",{className:"text-accent-primary",children:e.lowConfidencePrefixes.length})," prefix",1!==e.lowConfidencePrefixes.length?"es":""," with low confidence"]}),n.jsxs("div",{className:"type-data-xs text-text-secondary font-mono truncate",children:[e.lowConfidencePrefixes.slice(0,5).join(", "),e.lowConfidencePrefixes.length>5&&n.jsxs("span",{className:"text-accent-primary",children:[" +",e.lowConfidencePrefixes.length-5," more"]})]})]})]})}),0===e.lowConfidencePrefixes.length&&0===e.collisionPrefixes&&n.jsx("div",{className:"mt-auto pt-2",children:n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx(w,{className:"w-3.5 h-3.5 text-signal-excellent"}),n.jsx("span",{className:"type-data-xs text-signal-excellent",children:"All prefixes uniquely identified"})]})})]}),n.jsx(Se,{isOpen:!!s,prefix:(null==s?void 0:s.prefix)||"",candidateHashes:(null==s?void 0:s.candidateHashes)||[],onClose:i})]})}function Ct({icon:e,label:t,value:s,sublabel:a,highlight:r,tooltip:l}){return n.jsxs("div",{className:"flex items-center justify-between py-2 "+(l?"cursor-help":""),title:l,children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"icon-xs text-icon-widget",children:e}),n.jsx("span",{className:"type-label text-text-secondary",children:t})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("span",{className:"type-data-sm "+(r?"text-accent-primary":"text-text-primary"),children:s}),a&&n.jsx("span",{className:"type-data-xs text-text-secondary ml-1",children:a})]})]})}function St(){const e=V(),t=I().length;if(!e||0===e.totalPaths)return null;const{totalPaths:s,pathsWithGhosts:a,observationOverrideCount:r,tracePacketsProcessed:l,pathPacketsProcessed:i,distantEdgesDiscovered:o,duplicateGroupsFound:c,duplicatePathsUnique:d,echolocationEdgesInferred:m}=e,u=s>0?((s-a)/s*100).toFixed(1):"0",h=s>0?(a/s*100).toFixed(1):"0",p=s>0?(r/s*100).toFixed(1):"0",g=l+i,f=g>0||o>0,b=c>0||m>0;return n.jsxs(we,{children:[n.jsx(ke,{title:"Path Decoder",icon:n.jsx(M,{}),largeTitle:!0,badge:t>0?`${t} hidden`:void 0}),n.jsxs($e,{children:[n.jsx("p",{className:"type-data-xs text-text-secondary mb-3",children:"Decodes packet routes to map your mesh topology and discover hidden repeaters."}),n.jsxs("div",{className:"divide-y divide-white/5",children:[n.jsx(Ct,{icon:n.jsx(C,{className:"w-3.5 h-3.5"}),label:"Traceable",value:`${u}%`,sublabel:`of ${s.toLocaleString()} paths`,highlight:parseFloat(u)>=90,tooltip:"Percentage of packet journeys where every hop was identified. Higher = better visibility into how traffic flows through your mesh."}),n.jsx(Ct,{icon:n.jsx(S,{className:"w-3.5 h-3.5"}),label:"Hidden Nodes",value:a.toLocaleString(),sublabel:`paths (${h}%)`,highlight:a>0,tooltip:"Paths containing unidentified repeaters. These 'ghost' nodes forward traffic but haven't announced themselves via ADVERT  possibly distant or newly added nodes."}),n.jsx(Ct,{icon:n.jsx(T,{className:"w-3.5 h-3.5"}),label:"Learning Rate",value:`${p}%`,sublabel:"adapted",tooltip:"How often real traffic patterns improved our predictions over geography alone. Higher values mean the decoder is learning your mesh's actual behavior  which routes are preferred, which nodes are most active."})]}),f&&n.jsxs("div",{className:"mt-3 pt-3 border-t border-border-subtle",children:[n.jsx("p",{className:"type-micro mb-2",children:"Beyond Line-of-Sight"}),n.jsxs("div",{className:"divide-y divide-white/5",children:[n.jsx(Ct,{icon:n.jsx(F,{className:"w-3.5 h-3.5"}),label:"Route Reports",value:g.toLocaleString(),sublabel:l>0?`(${l} TRACE)`:void 0,tooltip:"TRACE/PATH packets from distant nodes share their routing tables. This reveals connections we can't directly observe  mapping parts of the mesh we don't touch."}),n.jsx(Ct,{icon:n.jsx($,{className:"w-3.5 h-3.5"}),label:"Remote Links",value:o.toLocaleString(),highlight:o>0,tooltip:"Node-to-node connections discovered from route reports. These links exist outside our RF range but help complete the topology picture."})]})]}),b&&n.jsxs("div",{className:"mt-3 pt-3 border-t border-border-subtle",children:[n.jsx("p",{className:"type-micro mb-2",children:"Echo Analysis"}),n.jsxs("div",{className:"divide-y divide-white/5",children:[n.jsx(Ct,{icon:n.jsx(P,{className:"w-3.5 h-3.5"}),label:"Multi-Path Packets",value:c.toLocaleString(),sublabel:d>0?`(${d} routes)`:void 0,tooltip:"Packets received via multiple paths simultaneously. Like sonar, these 'echoes' reveal redundant routes  important for understanding mesh resilience."}),n.jsx(Ct,{icon:n.jsx(x,{className:"w-3.5 h-3.5"}),label:"Inferred Links",value:m.toLocaleString(),highlight:m>0,tooltip:"Connections discovered from echo patterns. When the same packet arrives via different forwarders nearly simultaneously, those forwarders likely hear each other."})]})]}),t>0&&n.jsx("div",{className:"mt-3 pt-3 border-t border-border-subtle cursor-help",title:"High-confidence hidden repeaters: appear in 10+ paths, have 2+ known neighbors, 30% confidence, and plausible location. View them on the Contacts map.",children:n.jsxs("p",{className:"type-label text-text-secondary",children:[n.jsx("span",{className:"text-accent-primary type-data-sm",children:t})," ","likely repeater",1!==t?"s":""," discovered from traffic patterns"]})})]})]})}function Tt(){var e,t,s,a,l,i,o,c,d,m,u,h,x,p,f,y,v;const j=q(),N=X(),w=G(),k=K(),M=Y(),C=Z(),S=Q(),T=U(),[F,$]=r.useState([]),[L,D]=r.useState(null),[E,B]=r.useState(null),[H,_]=r.useState(!0),[z,O]=r.useState(null),[W,V]=r.useState("share"),[I,ae]=r.useState("stats"),[ne,re]=r.useState(!1),[le,ie]=r.useState(!1),[oe,ce]=r.useState(Pe),[de,me]=r.useState(.5),ue=r.useMemo(()=>({0:0,1:0,2:1,3:2,4:3,5:4,6:5,7:6}[S]??3),[S]),he=J[ue].hours,xe=60*he,pe=J[ue],ge=te(he),fe=C.isBackgroundLoading,be=r.useCallback(e=>{T({0:1,1:2,2:3,3:4,4:5,5:6,6:7}[e]??4)},[T]),ye=r.useMemo(()=>{var e;if(!(null==(e=null==j?void 0:j.config)?void 0:e.radio))return null;const t=j.config.radio;return{sf:t.spreading_factor??10,bw:t.bandwidth??25e4,cr:t.coding_rate??5,preamble:t.preamble_length??8}},[null==(t=null==(e=null==j?void 0:j.config)?void 0:e.radio)?void 0:t.spreading_factor,null==(a=null==(s=null==j?void 0:j.config)?void 0:s.radio)?void 0:a.bandwidth,null==(i=null==(l=null==j?void 0:j.config)?void 0:l.radio)?void 0:i.coding_rate,null==(c=null==(o=null==j?void 0:j.config)?void 0:o.radio)?void 0:c.preamble_length]);r.useEffect(()=>{!async function(){var e;O(null);try{const t=await ee(he);t.success&&(null==(e=t.data)?void 0:e.history)&&$(t.data.history)}catch(t){O(t instanceof Error?t.message:"Failed to load chart data")}finally{_(!1)}}()},[he]);const ve=r.useMemo(()=>72===he?6e5:168===he?18e5:336===he?36e5:3e5,[he]),je=r.useCallback(async()=>{var e;try{const t=await ee(he);t.success&&(null==(e=t.data)?void 0:e.history)&&$(t.data.history)}catch{}},[he]);se(je,ve,!0,!0);const Se=r.useMemo(()=>0===F.length?{timestamps:[],values:[]}:{timestamps:F.map(e=>e.timestamp),values:F.map(e=>e.noise_floor_dbm)},[F]),$e=r.useMemo(()=>{if(F.length<10)return{anomalies:[],debug:void 0};const e=function(e,t={}){const s={...Pe,...t};if(e.length<10)return{anomalies:[],thresholds:Ae([]),totalSamples:e.length,anomalySamples:0};const a=e.map(e=>e.noise_floor_dbm),n=Ae(a),r=[...a].sort((e,t)=>e-t);let l,i;s.useAbsoluteThresholds?(l=s.baselineDbm,i=s.spikeDbm):(l=Re(r,s.baselinePercentile),i=Re(r,s.spikePercentile));const o=[...e].sort((e,t)=>e.timestamp-t.timestamp),c=[];let d=null,m=0;for(const u of o)if(u.noise_floor_dbm>l&&u.noise_floor_dbm<i)if(m++,d){const e=Math.abs(u.noise_floor_dbm-d.rollingAvg)<=s.similarityToleranceDbm,t=u.timestamp-d.endTs<=s.mergeGapSeconds;e&&t?(d.endTs=u.timestamp,d.values.push(u.noise_floor_dbm),d.timestamps.push(u.timestamp),d.rollingAvg=d.values.reduce((e,t)=>e+t,0)/d.values.length):(d.values.length>=s.minSequenceLength&&c.push(d),d={startTs:u.timestamp,endTs:u.timestamp,values:[u.noise_floor_dbm],timestamps:[u.timestamp],rollingAvg:u.noise_floor_dbm})}else d={startTs:u.timestamp,endTs:u.timestamp,values:[u.noise_floor_dbm],timestamps:[u.timestamp],rollingAvg:u.noise_floor_dbm};else d&&d.values.length>=s.minSequenceLength&&c.push(d),d=null;return d&&d.values.length>=s.minSequenceLength&&c.push(d),0===c.length?{anomalies:[],thresholds:n,totalSamples:e.length,anomalySamples:m,debug:{baselineCutoff:l,spikeCutoff:i,midBandSamples:m}}:{anomalies:c.map(e=>{const t=Math.max(...e.values),s=e.values.reduce((e,t)=>e+t,0)/e.values.length;return{startTs:e.startTs,endTs:e.endTs,peakValue:t,avgValue:s,severity:Le(s,l,i),sampleCount:e.values.length}}),thresholds:n,totalSamples:e.length,anomalySamples:m,debug:{baselineCutoff:l,spikeCutoff:i,midBandSamples:m}}}(F,oe);return{anomalies:e.anomalies,debug:e.debug}},[F,oe]),De=$e.anomalies,Ee=r.useMemo(()=>{const e=(null==j?void 0:j.neighbors)??{};return Object.fromEntries(Object.entries(e).filter(([e])=>!N.has(e)))},[null==j?void 0:j.neighbors,N]),Be=r.useMemo(()=>{const e=Date.now()/1e3-3600*he;return Object.fromEntries(Object.entries(Ee).filter(([,t])=>t.last_seen>=e))},[Ee,he]),He=r.useMemo(()=>{const e=60*xe/ge,t=Math.floor(Date.now()/1e3),s=Math.floor(t/e)*e;return{start:s-60*xe,end:s}},[xe,ge]);return n.jsxs(Me,{children:[n.jsx(Ce,{title:"Statistics",icon:n.jsx(R,{}),controls:n.jsx(Ne,{ranges:J,selectedIndex:ue,onSelect:be,isPending:fe})}),z&&n.jsx(we,{className:"border border-accent-red/50 bg-accent-red/10",children:n.jsx("p",{className:"text-accent-red",children:z})}),ne&&le&&n.jsxs(we,{className:"border border-accent-purple/30 bg-glass-surface/50",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"type-label",children:"Anomaly Detection Tuning"}),n.jsxs("span",{className:"type-data-xs text-text-muted",children:["(",pe.label,")"]})]}),n.jsx("button",{onClick:()=>ce(e=>({...e,useAbsoluteThresholds:!e.useAbsoluteThresholds})),className:"type-data-xs px-2 py-1 rounded transition-colors "+(oe.useAbsoluteThresholds?"bg-accent-purple/30 text-accent-purple":"bg-glass-elevated text-text-muted hover:text-text-secondary"),children:oe.useAbsoluteThresholds?"Absolute dBm":"Percentile"})]}),n.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[n.jsxs("div",{children:[n.jsx("span",{className:"type-micro",children:"Baseline"}),n.jsxs("span",{className:"ml-2 type-data-sm text-status-warning",children:[(null==(m=null==(d=$e.debug)?void 0:d.baselineCutoff)?void 0:m.toFixed(1))??""," dBm"]})]}),n.jsxs("div",{children:[n.jsx("span",{className:"type-micro",children:"Spike"}),n.jsxs("span",{className:"ml-2 type-data-sm text-status-warning",children:[(null==(h=null==(u=$e.debug)?void 0:u.spikeCutoff)?void 0:h.toFixed(1))??""," dBm"]})]}),n.jsxs("div",{children:[n.jsx("span",{className:"type-micro",children:"Mid-band"}),n.jsx("span",{className:"ml-2 type-data-sm text-accent-purple",children:(null==(x=$e.debug)?void 0:x.midBandSamples)??0})]}),n.jsxs("div",{children:[n.jsx("span",{className:"type-micro",children:"Anomalies"}),n.jsx("span",{className:"ml-2 type-data-sm text-status-danger",children:De.length})]})]}),n.jsxs("div",{className:"mt-4 pt-4 border-t border-border-subtle space-y-4",children:[oe.useAbsoluteThresholds?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Baseline (",oe.baselineDbm," dBm)"]}),n.jsx("input",{type:"range",min:"-120",max:"-60",value:oe.baselineDbm,onChange:e=>ce(t=>({...t,baselineDbm:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Spike (",oe.spikeDbm," dBm)"]}),n.jsx("input",{type:"range",min:"-100",max:"-20",value:oe.spikeDbm,onChange:e=>ce(t=>({...t,spikeDbm:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Merge Gap (",oe.mergeGapSeconds,"s)"]}),n.jsx("input",{type:"range",min:"5",max:"120",step:"5",value:oe.mergeGapSeconds,onChange:e=>ce(t=>({...t,mergeGapSeconds:Number(e.target.value)})),className:"w-full accent-accent-purple"})]})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Min Sequence (",oe.minSequenceLength,")"]}),n.jsx("input",{type:"range",min:"2",max:"20",value:oe.minSequenceLength,onChange:e=>ce(t=>({...t,minSequenceLength:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Similarity (",oe.similarityToleranceDbm," dBm)"]}),n.jsx("input",{type:"range",min:"1",max:"15",value:oe.similarityToleranceDbm,onChange:e=>ce(t=>({...t,similarityToleranceDbm:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Opacity (",Math.round(100*de),"%)"]}),n.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.05",value:de,onChange:e=>me(Number(e.target.value)),className:"w-full accent-accent-purple"})]})]})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Baseline (P",oe.baselinePercentile,")"]}),n.jsx("input",{type:"range",min:"1",max:"50",value:oe.baselinePercentile,onChange:e=>ce(t=>({...t,baselinePercentile:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Spike (P",oe.spikePercentile,")"]}),n.jsx("input",{type:"range",min:"50",max:"99",value:oe.spikePercentile,onChange:e=>ce(t=>({...t,spikePercentile:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Merge Gap (",oe.mergeGapSeconds,"s)"]}),n.jsx("input",{type:"range",min:"5",max:"120",step:"5",value:oe.mergeGapSeconds,onChange:e=>ce(t=>({...t,mergeGapSeconds:Number(e.target.value)})),className:"w-full accent-accent-purple"})]})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Min Sequence (",oe.minSequenceLength,")"]}),n.jsx("input",{type:"range",min:"2",max:"20",value:oe.minSequenceLength,onChange:e=>ce(t=>({...t,minSequenceLength:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Similarity (",oe.similarityToleranceDbm," dBm)"]}),n.jsx("input",{type:"range",min:"1",max:"15",value:oe.similarityToleranceDbm,onChange:e=>ce(t=>({...t,similarityToleranceDbm:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"type-micro block mb-1",children:["Opacity (",Math.round(100*de),"%)"]}),n.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.05",value:de,onChange:e=>me(Number(e.target.value)),className:"w-full accent-accent-purple"})]})]})]}),n.jsxs("div",{className:"mt-4 p-3 bg-glass-elevated rounded-lg",children:[n.jsx("div",{className:"type-micro mb-1",children:"Config output"}),n.jsxs("div",{className:"type-data-sm text-status-success",children:[oe.useAbsoluteThresholds?`useAbsoluteThresholds: true, baselineDbm: ${oe.baselineDbm}, spikeDbm: ${oe.spikeDbm}`:`useAbsoluteThresholds: false, baselinePercentile: ${oe.baselinePercentile}, spikePercentile: ${oe.spikePercentile}`,", mergeGapSeconds: ",oe.mergeGapSeconds,", minSequenceLength: ",oe.minSequenceLength,", similarityToleranceDbm: ",oe.similarityToleranceDbm]})]})]})]}),fe&&n.jsx(Te,{template:"auto",children:n.jsx(we,{className:"border border-accent-primary/30 bg-accent-primary/5",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("div",{className:"relative flex h-3 w-3",children:[n.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-accent-primary opacity-75"}),n.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-accent-primary"})]}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("p",{className:"type-body-sm text-text-primary",children:["Loading ",pe.label," data..."]}),C.loadProgress&&n.jsxs("p",{className:"type-data-xs text-text-muted mt-0.5",children:[C.loadProgress.loaded.toLocaleString()," packets (",C.loadProgress.percent,"%)"]})]})]})})}),H?n.jsx(Te,{template:"auto",children:n.jsx(we,{className:"text-center py-12",children:n.jsx("div",{className:"animate-pulse text-text-muted",children:"Loading statistics..."})})}):n.jsxs(n.Fragment,{children:[n.jsx(Te,{template:"hero-auto",children:n.jsx(we,{isLoaded:M,skeletonType:"chart",children:M&&n.jsxs(n.Fragment,{children:[n.jsx(ke,{icon:n.jsx(g,{}),title:"Packet Analyzer",badge:pe.label,largeTitle:!0,actions:n.jsxs("div",{className:"flex flex-wrap items-center gap-2 justify-end",children:["stats"===I&&n.jsx(rt,{enabled:ne,onChange:re,anomalyCount:De.length,showTuning:le,onTuningChange:ie}),n.jsx(lt,{smoothing:I,onChange:ae}),n.jsx(nt,{mode:W,onChange:V})]})}),n.jsx("div",{className:"flex-1 min-h-0",children:n.jsx(it,{packets:k,startTs:He.start,endTs:He.end,bucketCount:ge,radioConfig:ye??void 0,mode:W,smoothing:I,noiseFloorAnomalies:De,showNoiseFloorOverlay:ne,overlayOpacity:de})})]})})}),n.jsxs(Te,{template:"panel",children:[n.jsx(Fe,{span:12,md:6,children:n.jsx(we,{isLoaded:M,skeletonType:"chart",children:M&&n.jsxs(n.Fragment,{children:[n.jsx(ke,{icon:n.jsx(b,{}),title:"Link Quality",badge:pe.label,largeTitle:!0,actions:E?n.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 type-data-xs text-text-muted",children:[n.jsxs("span",{children:[n.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:E.zeroHopCount})," nbr"]}),n.jsxs("span",{children:[n.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:E.totalCount})," obs"]}),n.jsxs("span",{children:[n.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:E.maxDistanceKm.toFixed(0)})," km"]})]}):null}),n.jsx("div",{className:"flex-1 min-h-0",children:n.jsx(vt,{children:n.jsx(xt,{neighbors:Be,quickNeighbors:w,localLat:(null==(f=null==(p=null==j?void 0:j.config)?void 0:p.repeater)?void 0:f.latitude)??0,localLon:(null==(v=null==(y=null==j?void 0:j.config)?void 0:y.repeater)?void 0:v.longitude)??0,onStatsChange:B})})})]})})}),n.jsx(Fe,{span:12,md:6,children:n.jsx(we,{isLoaded:M,skeletonType:"chart",children:M&&n.jsxs(n.Fragment,{children:[n.jsx(ke,{icon:n.jsx(A,{}),title:"Network Composition",badge:pe.label,largeTitle:!0}),n.jsx("div",{className:"flex-1 min-h-0",children:n.jsx(vt,{children:n.jsx(yt,{neighbors:Be})})})]})})})]}),n.jsxs(Te,{template:"panel",children:[n.jsx(Fe,{span:12,md:6,children:n.jsx(Mt,{})}),n.jsx(Fe,{span:12,md:6,children:n.jsx(St,{})})]}),n.jsx(Te,{template:"panel",children:n.jsx(Fe,{span:12,children:n.jsx(we,{isLoaded:M,skeletonType:"chart",children:M&&n.jsxs(n.Fragment,{children:[n.jsx(ke,{icon:n.jsx(P,{}),title:"RF Noise Floor",largeTitle:!0,actions:L?n.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 md:gap-3",children:[n.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["min ",n.jsx("span",{className:"text-text-secondary tabular-nums",children:L.min.toFixed(0)})]}),n.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["avg ",n.jsx("span",{className:"text-text-secondary tabular-nums",children:L.avg.toFixed(0)})]}),n.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["max ",n.jsx("span",{className:"text-text-secondary tabular-nums",children:L.max.toFixed(0)})]}),n.jsx("span",{className:"type-data-xs text-text-muted",children:"dBm"})]}):n.jsx("span",{className:"type-data-xs text-text-muted",children:"dBm"})}),n.jsx("div",{className:"flex-1 min-h-0",children:n.jsx(vt,{children:n.jsx(gt,{timestamps:Se.timestamps,values:Se.values,onStatsChange:D})})})]})})})})]})]})}export{Tt as default};
