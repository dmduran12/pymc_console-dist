import{r as e,j as s,at as t,ar as a,bj as o,bk as i,bl as l,bm as n,aU as r,$ as d,a0 as c,bn as u,aV as h}from"./vendor-react-C341c8YC.js";import"./maplibre-gl-Bk5DsYkB.js";import{n as m}from"./recharts-6XUQYgRA.js";import{e as x,J as p,f as v,N as b,O as g,H as f,B as j}from"./index-CPdqYR4z.js";import{u as N,B as y}from"./BasemapLayer-S9Ush6Hh.js";const w={version:8,sources:{},layers:[],glyphs:"https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf"};function H({node:t,isHovered:a,onHover:o}){const[i,l]=e.useState(!1),n=e.useCallback(e=>{var s,a;e.stopPropagation(),s=t.hash,(null==(a=navigator.clipboard)?void 0:a.writeText)&&navigator.clipboard.writeText(s).catch(()=>{}),l(!0),setTimeout(()=>l(!1),2e3)},[t.hash]),x=t.contactType.toLowerCase(),p=x.includes("room")||x.includes("server");let v=r,b="text-accent-primary";return p?(v=u,b="text-signal-fair"):"companion"===x||"client"===x?(v=h,b="text-text-muted"):t.isNeighbor&&(b="text-accent-success"),s.jsxs("div",{className:m("flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors cursor-pointer",a?"bg-accent-primary/10":"hover:bg-white/[0.03]"),onMouseEnter:()=>o(t.hash),onMouseLeave:()=>o(null),children:[s.jsx(v,{className:m("w-4 h-4 flex-shrink-0",b)}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsx("span",{className:"text-sm font-medium text-text-primary truncate",children:t.name}),t.isNeighbor&&s.jsx(j,{color:"green",compact:!0,children:"NBR"}),t.isRepeater&&s.jsx(j,{color:"zinc",compact:!0,children:"RPT"}),t.isHub&&s.jsx(j,{color:"purple",compact:!0,children:"HUB"})]}),s.jsxs("button",{onClick:n,className:m("mt-1 inline-flex items-center gap-1 text-[10px] font-mono px-1.5 py-0.5 rounded","border transition-all cursor-pointer",i?"border-accent-success/50 bg-accent-success/10 text-accent-success":"border-border-subtle bg-bg-subtle/50 text-text-muted hover:border-border-strong"),title:`Copy: ${t.hash}`,children:[t.hash.slice(0,12),"…",i?s.jsx(d,{className:"w-2.5 h-2.5"}):s.jsx(c,{className:"w-2.5 h-2.5 opacity-50"})]})]})]})}function C({nodes:t,hoveredHash:r,onHover:d}){const c=N(),u=e.useRef(null),h=f(),[x,p]=e.useState(!1),v=e.useMemo(()=>t.filter(e=>null!=e.latitude&&null!=e.longitude&&(0!==e.latitude||0!==e.longitude)),[t]),b=e.useMemo(()=>{if(0===v.length)return null;let e=1/0,s=-1/0,t=1/0,a=-1/0;for(const o of v)e=Math.min(e,o.longitude),s=Math.max(s,o.longitude),t=Math.min(t,o.latitude),a=Math.max(a,o.latitude);if(a-t<.01){const e=(a+t)/2;t=e-.005,a=e+.005}if(s-e<.01){const t=(s+e)/2;e=t-.005,s=t+.005}return[[e,t],[s,a]]},[v]),g=e.useMemo(()=>b?{longitude:(b[0][0]+b[1][0])/2,latitude:(b[0][1]+b[1][1])/2}:{longitude:0,latitude:0},[b]),H=e.useMemo(()=>{if(v.length<2)return null;const e=[];for(let s=0;s<v.length;s++)for(let t=s+1;t<v.length;t++){const a=v[s],o=v[t];e.push({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[[a.longitude,a.latitude],[o.longitude,o.latitude]]}})}return{type:"FeatureCollection",features:e}},[v]),C=e.useCallback(()=>{var e;const s=null==(e=u.current)?void 0:e.getMap();s&&b?(s.fitBounds(b,{padding:{top:50,bottom:50,left:50,right:50},maxZoom:13,duration:0}),setTimeout(()=>p(!0),50)):p(!0)},[b]),M=h&&x;return 0===v.length?s.jsx("div",{className:"h-full flex items-center justify-center bg-bg-subtle/30 rounded-lg",children:s.jsxs("div",{className:"text-center text-text-secondary p-4",children:[s.jsx(a,{className:"w-8 h-8 mx-auto mb-2 opacity-40"}),s.jsx("p",{className:"text-sm",children:"No location data available"})]})}):s.jsxs("div",{className:"h-full w-full relative rounded-lg overflow-hidden bg-bg-elevated",children:[s.jsx("div",{className:m("absolute inset-0 flex items-center justify-center z-10","transition-opacity duration-200 pointer-events-none",M?"opacity-0":"opacity-100 bg-bg-elevated"),children:s.jsx("div",{className:"w-5 h-5 border-2 border-text-muted/30 border-t-text-muted rounded-full animate-spin"})}),s.jsx("div",{className:m("h-full w-full transition-opacity duration-200",M?"opacity-100":"opacity-0"),children:s.jsxs(o,{ref:u,initialViewState:{longitude:g.longitude,latitude:g.latitude,zoom:10},style:{height:"100%",width:"100%"},mapStyle:w,attributionControl:!1,onLoad:C,children:[s.jsx(y,{mode:c}),H&&s.jsx(i,{id:"collision-edges",type:"geojson",data:H,children:s.jsx(l,{id:"collision-edges-line",type:"line",paint:{"line-color":"#3B3F4A","line-width":2,"line-opacity":.8},layout:{"line-cap":"round","line-join":"round"}})}),v.map(e=>{const t=e.hash===r,a=e.hash.startsWith("0x")?e.hash.slice(2,4).toUpperCase():e.hash.slice(0,2).toUpperCase();return s.jsx(n,{longitude:e.longitude,latitude:e.latitude,anchor:"center",children:s.jsx("div",{className:"cursor-pointer transition-all duration-150",onMouseEnter:()=>d(e.hash),onMouseLeave:()=>d(null),style:{pointerEvents:"auto"},children:s.jsxs(j,{color:"amber",filled:!0,className:"font-mono text-[10px] shadow-lg",children:[a,t&&s.jsx("span",{className:"ml-1 opacity-75 font-sans",children:e.name})]})})},e.hash)})]})})]})}const M=e.memo(function({isOpen:a,prefix:o,candidateHashes:i,onClose:l}){const n=x(),r=p(),d=v(),[c,u]=e.useState(null),h=e.useMemo(()=>new Set(d.map(e=>e.hash)),[d]),m=(null==n?void 0:n.neighbors)??{},f=e.useMemo(()=>i.map(e=>{var s;const t=(e=>m[e]?m[e]:!e.startsWith("0x")&&m["0x"+e]?m["0x"+e]:e.startsWith("0x")&&m[e.slice(2)]?m[e.slice(2)]:void 0)(e);return{hash:e,name:(null==t?void 0:t.node_name)||(null==t?void 0:t.name)||`Unknown (${e.slice(0,8)}…)`,contactType:(null==t?void 0:t.contact_type)||"",isRepeater:(null==t?void 0:t.is_repeater)||"repeater"===(null==(s=null==t?void 0:t.contact_type)?void 0:s.toLowerCase())||!1,isNeighbor:h.has(e)||h.has("0x"+e)||h.has(e.replace(/^0x/,"")),isHub:r.has(e),latitude:null==t?void 0:t.latitude,longitude:null==t?void 0:t.longitude}}).sort((e,s)=>e.isNeighbor!==s.isNeighbor?e.isNeighbor?-1:1:e.isHub!==s.isHub?e.isHub?-1:1:e.name.localeCompare(s.name)),[i,m,h,r]),j=e.useMemo(()=>f.some(e=>null!=e.latitude&&null!=e.longitude&&(0!==e.latitude||0!==e.longitude)),[f]),N=e.useCallback(e=>{u(e)},[]),y=j?"4xl":"lg";return a?s.jsxs(b,{open:a,onClose:l,size:y,motionPlus:!0,className:j?"sm:h-[500px] sm:max-h-[600px]":"",children:[s.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border-subtle",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg bg-signal-fair/10",children:s.jsx(t,{className:"w-5 h-5 text-signal-fair"})}),s.jsxs("div",{children:[s.jsxs("div",{className:"text-base font-semibold text-text-primary",children:["Prefix Collision: ",s.jsx("span",{className:"font-mono text-accent-primary",children:o})]}),s.jsxs("p",{className:"text-xs text-text-secondary",children:[f.length," nodes share this prefix"]})]})]}),s.jsx("button",{onClick:l,className:"p-2 text-text-muted hover:text-text-primary transition-colors rounded-lg hover:bg-bg-subtle",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsxs(g,{className:"p-0 overflow-hidden flex-1 flex flex-col min-h-0",children:[s.jsxs("div",{className:"sm:hidden flex-1 overflow-y-auto",children:[j&&s.jsx("div",{className:"h-64 p-2 border-b border-border-subtle",children:s.jsx(C,{nodes:f,hoveredHash:c,onHover:N})}),s.jsx("div",{className:"p-2",children:f.map(e=>s.jsx(H,{node:e,isHovered:c===e.hash,onHover:N},e.hash))})]}),j?s.jsxs("div",{className:"hidden sm:grid sm:grid-cols-[280px_minmax(400px,1fr)] flex-1 overflow-hidden sm:min-w-[700px]",children:[s.jsx("div",{className:"overflow-y-auto border-r border-border-subtle",children:s.jsx("div",{className:"p-2",children:f.map(e=>s.jsx(H,{node:e,isHovered:c===e.hash,onHover:N},e.hash))})}),s.jsx("div",{className:"overflow-hidden p-2",children:s.jsx(C,{nodes:f,hoveredHash:c,onHover:N})})]}):s.jsx("div",{className:"hidden sm:block flex-1 overflow-y-auto",children:s.jsx("div",{className:"p-2",children:f.map(e=>s.jsx(H,{node:e,isHovered:c===e.hash,onHover:N},e.hash))})})]})]}):null});export{M as C};
