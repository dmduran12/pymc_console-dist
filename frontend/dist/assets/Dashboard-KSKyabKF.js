import{r as e,j as t,R as s,g as n,Y as a,i,c as l,A as r,C as o,k as c,T as d,l as m}from"./vendor-react-54o2BuWt.js";import{c as u,d as h,f as x,e as p,J as f,u as g,h as v,j,k as b,M as N,B as y,S as w,n as k,o as M,p as C,q as S,w as L,R as _,L as D,r as F,t as R,v as T,D as A,x as B,y as H,z as $,T as P,C as E,E as I,F as z,G as q,H as W,I as O,K as V,N as G,m as K,A as U,O as J,Q as Y,U as Q,V as X,W as Z}from"./index-C00I5uLb.js";import{u as ee,a as te}from"./useThemeColors-BvPNffvW.js";import{C as se,S as ne,a as ae,P as ie,b as le,B as re}from"./PageLayout-CvssNufZ.js";import{S as oe,A as ce,P as de,T as me}from"./PacketList-BzK1rQvB.js";import{T as ue,a as he,M as xe,b as pe}from"./trending-up-DVEWJAvY.js";import{C as fe,a as ge}from"./DataBox-xzsNqHsO.js";import{L as ve,b as je}from"./vendor-core-dnrJb0w-.js";import{E as be,T as Ne}from"./TimeRangeSelector-D5nE7Zf9.js";import{s as ye,C as we}from"./SignalIndicator-BMbjmtYI.js";import{Z as ke}from"./zap-CEBjZ69G.js";import{c as Me}from"./link-scoring-DcOxNZIR.js";import{N as Ce}from"./NodeInformationCard-2YdyCt6G.js";import{C as Se}from"./chevron-right-Fyy5vf6_.js";import{H as Le}from"./route-DQRmfnnl.js";import{L as _e}from"./loader-circle-OPDY_oz3.js";import{u as De}from"./index-YwnG2s2Y.js";import{H as Fe}from"./house-BuxWjthy.js";import{R as Re,C as Te}from"./Grid-CORrqWoE.js";import{C as Ae}from"./Card-CK7JSx8A.js";import"./deckgl-DTsmDcfs.js";import"./arrow-up-DS3jKly6.js";import"./map-pin-O-uY2okE.js";import"./triangle-alert-styIKQkp.js";import"./packet-D8tuCHg2.js";import"./chevron-up-CUEVfOPy.js";import"./circle-check-Rdc4h_Bp.js";const Be=u("arrow-up-right",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]),He=u("audio-waveform",[["path",{d:"M2 13a2 2 0 0 0 2-2V7a2 2 0 0 1 4 0v13a2 2 0 0 0 4 0V4a2 2 0 0 1 4 0v13a2 2 0 0 0 4 0v-4a2 2 0 0 1 2-2",key:"57tc96"}]]),$e=u("ear",[["path",{d:"M6 8.5a6.5 6.5 0 1 1 13 0c0 6-6 6-6 10a3.5 3.5 0 1 1-7 0",key:"1dfaln"}],["path",{d:"M15 8.5a2.5 2.5 0 0 0-5 0v1a2 2 0 1 1 0 4",key:"1qnva7"}]]),Pe=u("megaphone",[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]]),Ee=u("message-square-text",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}],["path",{d:"M7 11h10",key:"1twpyw"}],["path",{d:"M7 15h6",key:"d9of3u"}],["path",{d:"M7 7h8",key:"af5zfr"}]]),Ie=u("satellite-dish",[["path",{d:"M4 10a7.31 7.31 0 0 0 10 10Z",key:"1fzpp3"}],["path",{d:"m9 15 3-3",key:"88sc13"}],["path",{d:"M17 13a6 6 0 0 0-6-6",key:"15cc6u"}],["path",{d:"M21 13A10 10 0 0 0 11 3",key:"11nf8s"}]]),ze=u("square-activity",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M17 12h-2l-2 5-2-10-2 5H7",key:"15hlnc"}]]),qe=u("timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);function We(e,t){return t?e+t:e}function Oe(e){return"number"==typeof e?e:parseFloat(e)}function Ve(e,t){const s=De(t()),n=()=>s.set(t());return n(),g(()=>{const t=()=>x.preRender(n,!1,!0),s=e.map(e=>e.on("change",t));return()=>{s.forEach(e=>e()),v(n)}}),s}function Ge(e,t){const s=b(()=>[]);return Ve(e,()=>{s.length=0;const n=e.length;for(let t=0;t<n;t++)s[t]=e[t].get();return t(s)})}function Ke(t,s={}){return function(t,s={}){const{isStatic:n}=e.useContext(N),a=()=>p(t)?t.get():t;if(n)return function(e,t,s,n){if("function"==typeof e)return function(e){j.current=[],e();const t=Ve(j.current,e);return j.current=void 0,t}(e);const a=function(...e){const t=!Array.isArray(e[0]),s=t?0:-1,n=e[0+s],a=e[1+s],i=e[2+s],l=e[3+s],r=h(a,i,l);return t?r(n):r}(t,s,n);return Array.isArray(e)?Ge(e,a):Ge([e],([e])=>a(e))}(a);const i=De(a());return e.useInsertionEffect(()=>function(e,t,s={}){const n=e.get();let a,i=null,l=n;const r="string"==typeof n?n.replace(/[\d.-]/g,""):void 0,o=()=>{i&&(i.stop(),i=null)};if(e.attach((t,n)=>{l=t,a=e=>n(We(e,r)),x.postRender(()=>{var t;(()=>{o();const t=Oe(e.get()),n=Oe(l);t!==n&&(i=new f({keyframes:[t,n],velocity:e.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...s,onUpdate:a}))})(),null==(t=e.events.animationStart)||t.notify(),null==i||i.then(()=>{var t;null==(t=e.events.animationComplete)||t.notify()})})},o),p(t)){const s=t.on("change",t=>e.set(We(t,r))),n=e.on("destroy",s);return()=>{s(),n()}}return o}(i,t,s),[i,JSON.stringify(s)]),i}(t,{type:"spring",...s})}const Ue={",":"punc",".":"punc-period",":":"punc-colon","/":"punc-slash"},Je=/([,\.:\/])/g,Ye=e.memo(function({children:s,className:n="",as:a="span"}){const i=e.useMemo(()=>{let e;return e="number"==typeof s?s.toLocaleString():Array.isArray(s)?s.join(""):String(s??""),Je.test(e)?(Je.lastIndex=0,e.split(Je).map((e,s)=>{const n=Ue[e];return n?t.jsx("span",{className:n,children:e},s):e})):e},[s]);return t.jsx(a,{className:`data-tight ${n}`.trim(),children:i})}),Qe={received:{barBase:"var(--metric-received)"},forwarded:{barBase:"var(--metric-forwarded)"},transmitted:{barBase:"var(--metric-transmitted)"},dropped:{barBase:"var(--metric-dropped)"},neutral:{barBase:"var(--metric-neutral)"}},Xe={sm:"card-sm",md:"card-md",lg:"card-lg",hero:"card-hero",auto:""};function Ze({buckets:s,colorType:n}){const a=Qe[n].barBase,i=e.useMemo(()=>{if(!(null==s?void 0:s.length))return[];const e=w.statsCard,t=s.length/e,n=t<=1?s:Array.from({length:e},(e,n)=>{var a,i;const l=s.slice(Math.floor(n*t),Math.floor((n+1)*t)),r=l.reduce((e,t)=>e+t.count,0),o=l.length?l.reduce((e,t)=>e+t.avg_snr,0)/l.length:0;return{bucket:n,start:(null==(a=l[0])?void 0:a.start)??0,end:(null==(i=l.at(-1))?void 0:i.end)??0,count:r,airtime_ms:l.reduce((e,t)=>e+t.airtime_ms,0),avg_snr:o,avg_rssi:0}}),i=n.map(e=>e.count).filter(e=>e>0);if(0===i.length)return n.map(()=>({height:0,bottom:0,color:"transparent",count:0,snr:0}));const l=Math.max(...i),r=Math.min(...i),o=l-r;return 0===o?n.map(e=>({height:e.count>0?40:0,bottom:e.count>0?30:0,color:e.count>0?a:"transparent",count:e.count,snr:e.avg_snr})):n.map(e=>{if(0===e.count)return{height:0,bottom:0,color:"transparent",count:0,snr:e.avg_snr};const t=(e.count-r)/o,s=15*t;return{height:Math.max(30,30+50*t),bottom:s,color:a,count:e.count,snr:e.avg_snr}})},[s,a]);return(null==s?void 0:s.length)?t.jsx("div",{className:"w-full h-full flex items-end pt-1",children:i.map((e,s)=>{var n;return t.jsx("div",{className:"flex-1 relative min-w-0",style:{height:"100%"},children:t.jsx("div",{className:"absolute inset-x-0",style:{height:`${e.height}%`,bottom:`${e.bottom}%`,backgroundColor:e.color,opacity:e.count>0?.8:.1},title:e.count>0?`${e.count} packets, SNR: ${null==(n=e.snr)?void 0:n.toFixed(1)}dB`:"No packets"})},s)})}):t.jsx("div",{className:"w-full h-full flex items-end justify-center gap-[2px] opacity-20",children:t.jsx("span",{className:"type-data-xs text-text-secondary",children:"No data"})})}function et({title:s,value:n,color:a="neutral",subtitle:i,buckets:l,receivedCount:r,timeRangeLabel:o,icon:c,size:d="md",isLoaded:m=!0}){const u="string"==typeof n?n:n.toLocaleString(),h=e.useMemo(()=>function(e){if(!(null==e?void 0:e.length))return null;const t=e.reduce((e,t)=>e+t.count,0),s=e[0].start,n=e[e.length-1].end,a=Math.max((n-s)/3600,1),i=Math.round(t/a);let l=0,r=0;for(let d=0;d<e.length;d++)e[d].count>r&&(r=e[d].count,l=d);const o=new Date(1e3*e[l].start).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),c=e.filter(e=>e.count>0&&0!==e.avg_snr);return{total:t,ratePerHour:i,peakCount:r,peakHour:o,avgSnr:c.length>0?c.reduce((e,t)=>e+t.avg_snr,0)/c.length:null}}(l),[l]),x="number"==typeof n?n:(null==h?void 0:h.total)??0,p=r&&r>0?(x/r*100).toFixed(1):null;return m?t.jsxs("div",{className:`data-card flex flex-col relative ${Xe[d]}`,children:[t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-2 sm:mb-3",children:[c&&t.jsx("span",{className:"icon-sm text-icon-card-title",children:c}),t.jsx("span",{className:"type-micro",children:s}),o&&t.jsx(y,{color:"teal",className:"hidden sm:inline-flex",children:o})]}),t.jsx("div",{className:"type-data-hero text-text-primary",children:t.jsx(Ye,{children:u})}),t.jsx("div",{className:"flex-1 mt-1 overflow-hidden min-h-[40px] sm:min-h-[60px]",children:l?t.jsx(Ze,{buckets:l,colorType:a}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx("div",{className:"w-full h-0.5 rounded-full bg-text-muted/15"})})}),t.jsx("div",{className:"pt-1.5 sm:pt-2 mt-1",children:t.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"data-box-label",children:"Rate"}),t.jsxs("div",{className:"data-box data-box-fill data-box-left",children:[(null==h?void 0:h.ratePerHour)??i??"â€”","/hr"]})]}),null!==p?t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"data-box-label",children:"dropped"===a?"Drop %":"Ratio"}),t.jsxs("div",{className:"data-box data-box-fill data-box-left",children:[p,"%"]})]}):(null==h?void 0:h.peakHour)?t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"data-box-label",children:"Peak"}),t.jsx("div",{className:"data-box data-box-fill data-box-left",children:h.peakHour})]}):null]})})]}):t.jsx("div",{className:`data-card flex flex-col relative ${Xe[d]}`,children:t.jsx(se,{})})}const tt=.2;function st(e,t=1){return Math.floor(5*t*e)}function nt(e){const t=Math.round(e/tt)*tt;return Math.max(0,Math.min(5,t))}function at({stats:s,receivedBuckets:n,droppedBuckets:a,forwardedBuckets:i,bucketDurationSeconds:l,timeRangeLabel:r,isLoaded:o=!0}){var c,d,m,u;const[h,x]=e.useState(!1);if(!o)return t.jsx("div",{className:"data-card flex flex-col relative",children:t.jsx(se,{})});const p=function(e,t,s,n,a){var i,l;const r=e=>(null==e?void 0:e.reduce((e,t)=>e+t.count,0))??0,o=r(t),c=r(s),d=r(n),m=o||(null==e?void 0:e.rx_count)||1,u=c||(null==e?void 0:e.dropped_count)||0,h=m>0?u/(m+u)*100:0;let x=0;if((null==n?void 0:n.length)&&a)x=100*d/(n.length*a*1e3)*100;else if(e){const t=1e3*(e.uptime_seconds||1);x=(e.total_airtime_ms||e.airtime_used_ms||0)/t*100}const p=(null==e?void 0:e.neighbors)??{},f=Object.values(p).filter(e=>e.zero_hop).length;let g=1;h<3?g-=tt:h>15?g+=.4:h>10&&(g+=tt),x>5&&(g+=tt),f>10&&(g+=tt);const v=nt(g),j=nt(.28*v),b=st(v),N=st(j),y=st((null==(l=null==(i=null==e?void 0:e.config)?void 0:i.delays)?void 0:l.tx_delay_factor)??1);return{floodFactor:v,directFactor:j,floodSlots:b,directSlots:N,adjustment:b>y?"increase":b<y?"decrease":"stable",duplicateRate:Math.round(100*h)/100,txUtilization:Math.round(1e3*x)/1e3,zeroHopCount:f,totalReceived:o,totalDropped:c}}(s,n,a,i,l),f=(null==(d=null==(c=null==s?void 0:s.config)?void 0:c.delays)?void 0:d.tx_delay_factor)??null,g=(null==(u=null==(m=null==s?void 0:s.config)?void 0:m.delays)?void 0:u.direct_tx_delay_factor)??null,v=null!==f?st(f):null,j=null!==v&&p.floodSlots!==v,b="increase"===p.adjustment?ue:"decrease"===p.adjustment?he:xe;return t.jsxs("div",{className:"data-card flex flex-col relative",children:[t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-2 sm:mb-3 flex-wrap",children:[t.jsx(oe,{className:"w-4 h-4 text-icon-card-title flex-shrink-0"}),t.jsx("span",{className:"type-micro",children:"DELAY DOCTOR"}),r&&t.jsx(y,{color:"teal",className:"hidden sm:inline-flex",children:r}),j&&t.jsxs(y,{color:"increase"===p.adjustment?"amber":"emerald",className:"flex items-center gap-1",children:[t.jsx(b,{className:"w-3 h-3"}),"increase"===p.adjustment?"+":"-",Math.abs(p.floodSlots-(v??0))]})]}),t.jsxs("button",{onClick:async()=>{const e=`set txdelay ${p.floodFactor.toFixed(1)}\nset direct.txdelay ${p.directFactor.toFixed(1)}`;try{await navigator.clipboard.writeText(e),x(!0),setTimeout(()=>x(!1),1500)}catch(t){const s=document.createElement("textarea");s.value=e,s.style.position="fixed",s.style.opacity="0",document.body.appendChild(s),s.select();try{document.execCommand("copy"),x(!0),setTimeout(()=>x(!1),1500)}catch{}document.body.removeChild(s)}},className:"flex gap-3 mb-2 sm:mb-3 w-full text-left hover:bg-white/[0.02] radius-inner transition-base p-1 -m-1 group",title:"Click to copy CLI commands",children:[t.jsxs("div",{className:"flex-1 flex flex-col",children:[t.jsx("span",{className:"type-data-hero text-text-primary",children:t.jsxs(Ye,{children:["Ã—",p.floodFactor.toFixed(1)]})}),t.jsx("span",{className:"text-xs font-medium text-text-muted uppercase tracking-wide mt-0.5 sm:mt-1",children:"Flood"})]}),t.jsxs("div",{className:"flex-1 flex flex-col",children:[t.jsx("span",{className:"type-data-hero text-accent-tertiary",children:t.jsxs(Ye,{children:["Ã—",p.directFactor.toFixed(1)]})}),t.jsx("span",{className:"text-xs font-medium text-text-muted uppercase tracking-wide mt-0.5 sm:mt-1",children:"Direct"})]}),t.jsx("div",{className:"flex items-center self-center opacity-0 group-hover:opacity-100 transition-opacity",children:h?t.jsx(fe,{className:"w-4 h-4 text-green-400"}):t.jsx(ge,{className:"w-4 h-4 text-text-muted"})})]}),t.jsx("div",{className:"flex-1 py-2",children:t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"data-box-label",children:"Dupe"}),t.jsxs("div",{className:"data-box data-box-fill data-box-left "+(p.duplicateRate>10?"text-accent-warning":""),children:[p.duplicateRate.toFixed(1),"%"]})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"data-box-label",children:"TX Util"}),t.jsxs("div",{className:"data-box data-box-fill data-box-left",children:[p.txUtilization.toFixed(2),"%"]})]})]})}),t.jsxs("div",{className:"pt-2 mt-2",children:[t.jsx("div",{className:"data-box-label",children:"Current"}),t.jsx("div",{className:"flex gap-2",children:null!==f?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"data-box",children:["Ã—",f.toFixed(2)]}),t.jsxs("div",{className:"data-box",style:{color:"var(--accent-tertiary)"},children:["Ã—",(null==g?void 0:g.toFixed(2))??"â€”"]})]}):t.jsx("span",{className:"text-sm text-text-muted",children:"No config"})})]})]})}function it(){const s=k(),n=M(),a=C(),i=S(),[l,r]=e.useState([]);e.useEffect(()=>{const e=L.subscribe(e=>{r(e)});return r(L.getPendingPackets()),e},[]);const o=e.useMemo(()=>{const e=s.length<=100?s:s.slice(-100),t=new Set(e.map(e=>e.packet_hash));return[...l.filter(e=>!t.has(e.packet.packet_hash)).map(e=>({...e.packet,isPending:!0})),...e].sort((e,t)=>(t.timestamp??0)-(e.timestamp??0))},[s,l]),c=null==i?void 0:i.local_hash,d=null==i?void 0:i.neighbors;return t.jsxs("div",{className:"chart-container h-full flex flex-col !overflow-visible",children:[t.jsxs("div",{className:"chart-header",children:[t.jsxs("div",{className:"chart-title",children:[t.jsx(_,{className:"chart-title-icon"}),"Recent Packets"]}),t.jsxs("div",{className:"flex items-center gap-3",children:[a&&t.jsx(D,{showLabel:!0}),t.jsxs(ve,{to:"/packets",className:"pill-subtle",children:["View all ",t.jsx(ce,{className:"w-3 h-3"})]})]})]}),t.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto px-1",children:t.jsx(de,{packets:o,allPackets:s,localHash:c,neighbors:d,loading:n,maxPackets:50,showPagination:!1,flashNewest:!0,emptyMessage:"No packets received",footerAction:t.jsxs(ve,{to:"/packets",className:"pill-subtle",children:["View all ",t.jsx(ce,{className:"w-3 h-3"})]})})})]})}const lt=e.memo(function({active:e,payload:s,label:n,formatValue:a,labelKey:i}){var l;if(!e||!(null==s?void 0:s.length))return null;const r=i&&(null==(l=s[0])?void 0:l.payload)?s[0].payload[i]:n;return t.jsxs("div",{className:"bg-tooltip-bg border-card radius-inner px-4 py-3 shadow-xl",children:[r&&t.jsx("p",{className:"type-data-xs text-white/50 mb-2",children:r}),t.jsx("div",{className:"space-y-1.5",children:s.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("span",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:e.color}}),t.jsx("span",{className:"type-body-sm text-white/70 capitalize min-w-[60px]",children:e.name}),t.jsx("span",{className:"type-data-sm text-white tabular-nums",children:a?a(e.value,e.name):e.value.toLocaleString()})]},s))})]})});e.memo(function({active:e,payload:s,color:n,labelKey:a,unit:i=""}){var l,r;if(!e||!(null==s?void 0:s.length))return null;const o=s[0],c=null==(l=null==o?void 0:o.payload)?void 0:l[a];return t.jsxs("div",{className:"bg-tooltip-bg border-card radius-inner px-3 py-2 shadow-xl",children:[t.jsx("p",{className:"type-data-xs text-white/50 mb-1",children:c}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:n}}),t.jsxs("span",{className:"type-data-sm text-white tabular-nums",children:[null==(r=null==o?void 0:o.value)?void 0:r.toLocaleString(),i]})]})]})}),e.memo(function({payload:e}){return(null==e?void 0:e.length)?t.jsx("div",{className:"flex items-center justify-center gap-6 mt-4 pt-4 border-t border-white/5",children:e.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color}}),t.jsx("span",{className:"type-body-sm text-white/60 capitalize",children:e.value})]},s))}):null});const rt={stable:"M5 12h14",up:"M5 15l7-7 7 7",down:"M19 9l-7 7-7-7"};function ot({trend:e}){return t.jsx("span",{className:`mini-widget-trend ${e}`,children:t.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:rt[e]})})})}function ct(){return t.jsx("div",{className:"mini-widget-loading",children:t.jsx("div",{className:"mini-widget-loading-spinner"})})}function dt({message:e}){return t.jsx("div",{className:"mini-widget-error",children:t.jsx("span",{title:e,children:"No data"})})}function mt({title:e,icon:s,value:n,unit:a,valueSize:i="md",status:l,subtitle:r,trend:o,children:c,isLoading:d=!1,error:m,className:u="",onClick:h}){const x=["mini-widget-value","lg"===i&&"mini-widget-value-lg","sm"===i&&"mini-widget-value-sm"].filter(Boolean).join(" "),p=["mini-widget",h&&"cursor-pointer",u].filter(Boolean).join(" ");return t.jsxs("div",{className:p,onClick:h,role:h?"button":void 0,children:[t.jsxs("div",{className:"mini-widget-header",children:[s,t.jsx("span",{className:"mini-widget-title",children:e}),l&&"unknown"!==l&&t.jsx("div",{className:`mini-widget-status-dot ${l}`}),o&&t.jsx(ot,{trend:o})]}),d?t.jsx(ct,{}):m?t.jsx(dt,{message:m}):t.jsxs(t.Fragment,{children:[void 0!==n&&t.jsxs("div",{className:x,children:[t.jsx(Ye,{children:n}),a&&t.jsx("span",{className:"mini-widget-unit",children:a})]}),r&&t.jsx("div",{className:"mini-widget-subtitle",children:r}),c]})]})}const ut={DELTA_CRITICAL:10,SLOPE_CRITICAL:4,JITTER_CRITICAL:6,DELTA_WARNING:5,SLOPE_WARNING:2,JITTER_WARNING:4},ht={baselineMedian:null,baselineP10:null,baselineP90:null,currentMedian:null,currentSampleCount:0,delta:0,slope:0,jitter:0,penalty:0,penaltyReason:null,computedAt:0,isReliable:!1};function xt(e,t){if(0===e.length)return null;const s=[...e].sort((e,t)=>e-t),n=t/100*(s.length-1),a=Math.floor(n),i=Math.ceil(n);return a===i?s[a]:s[a]+(s[i]-s[a])*(n-a)}function pt(e){return xt(e,50)}function ft(e){if(!e)return[];try{const t=JSON.parse(e);if(Array.isArray(t))return t.map(Number).filter(e=>!isNaN(e))}catch{}return[]}function gt(e){return null!=e&&0!==e&&!Object.is(e,-0)&&!(e>-50||e<-130)}function vt(e,t,s=2,n=!1){if(null===t)return"stable";const a=e-t;return(0!==t?100*Math.abs(a/t):Math.abs(a))<s?"stable":n?a>0?"up":"down":a>0?"down":"up"}const jt={lbtStats:null,noiseFloor:null,sparklineNoiseFloor:[],linkQuality:null,channelHealth:null,nfTrend:ht,radioConfig:null,trends:null,stats:null,recentPackets:[],quickNeighbors:[],isLoading:!0,error:null,refresh:async()=>{}},bt=e.createContext(jt);function Nt({children:s}){var n;const a=S(),i=k(),l=F(),r=R(),o=T(),c=A[o],d=Math.max(1,c.minutes/60),m=null===a,u=e.useMemo(()=>function(e,t){const s=3600*t,n=Math.floor(Date.now()/1e3)-s,a=e.filter(e=>e.timestamp>=n&&void 0!==e.lbt_attempts&&e.lbt_attempts>0),i=a.length,l=a.filter(e=>(e.lbt_attempts??0)>1).length,r=i>0?l/i*100:0,o=a.filter(e=>(e.lbt_attempts??0)>1),c=o.length>0?o.reduce((e,t)=>e+(t.lbt_attempts??0),0)/o.length:0,d=a.filter(e=>(e.lbt_attempts??0)>=5).length,m=i>0?d/i*100:0,u=[];for(const b of a){const e=ft(b.lbt_backoff_delays_ms);u.push(...e)}const h=u.reduce((e,t)=>e+t,0),x=u.length>0?h/u.length:0,p=u.length>0?Math.min(...u):0,f=u.length>0?Math.max(...u):0,g=s/24,v=[],j=[];for(let b=0;b<24;b++){const e=n+b*g,t=e+g,s=a.filter(s=>s.timestamp>=e&&s.timestamp<t),i=s.filter(e=>(e.lbt_attempts??0)>1).length,l=s.length>0?i/s.length*100:0,r=[];for(const n of s){const e=ft(n.lbt_backoff_delays_ms);r.push(...e)}const o=r.length>0?r.reduce((e,t)=>e+t,0)/r.length:0;if(v.push(o),0===s.length)j.push(0);else{const e=s.filter(e=>(e.lbt_attempts??0)>=5).length,t=r.length>0?Math.max(...r):0,n=Math.min(s.length/5,1),a=.15,i=Math.log(1+l*a)/Math.log(1+100*a)*40,c=e/s.length*100,d=Math.min(.5*c,25);let m=0;o>100&&(m=Math.min(8*Math.log10(o/100),15));let u=0;t>500&&o>0&&t>2*o&&(u=Math.min((t-500)/200,5));const h=i+d+m+u;j.push(Math.min(h*n,85))}}return{totalPacketsWithLBT:i,packetsWithRetries:l,retryRate:r,avgRetries:c,channelBusyCount:d,channelBusyRate:m,avgBackoffMs:x,minBackoffMs:p,maxBackoffMs:f,totalBackoffMs:h,sparklineBackoff:v,sparklineCollisionRisk:j,windowHours:t,packetCount:e.length}}(i,d),[i,d]),h=(null==a?void 0:a.noise_floor_dbm)??null,x=e.useMemo(()=>gt(h)?h:null,[h]),p=e.useMemo(()=>{var e;const t=null==(e=null==a?void 0:a.config)?void 0:e.radio;return t?{sf:t.spreading_factor??7,bwHz:t.bandwidth??125e3}:null},[null==(n=null==a?void 0:a.config)?void 0:n.radio]),[f,g]=e.useState([]),v=e.useRef({time:0,hours:0});e.useEffect(()=>{const e=async()=>{var e;const t=Date.now(),s=Math.ceil(d);if(0===v.current.time||v.current.hours!==s||t-v.current.time>=6e4){v.current={time:t,hours:s};try{const t=await B(Math.max(s,24));t.success&&(null==(e=t.data)?void 0:e.history)&&g(t.data.history)}catch{}}};e();const t=setInterval(e,6e4);return()=>clearInterval(t)},[d]);const j=e.useMemo(()=>function(e,t){if(0===e.length)return[];const s=e.reduce((e,t)=>Math.max(e,t.timestamp),0);if(0===s)return[];const n=3600*t,a=s-n,i=n/24,l=[];for(let r=0;r<24;r++){const t=a+r*i,s=t+i,n=e.filter(e=>e.timestamp>=t&&e.timestamp<s&&gt(e.noise_floor_dbm));if(n.length>0){const e=n.reduce((e,t)=>e+t.noise_floor_dbm,0)/n.length;l.push(e)}else l.push(l.length>0?l[l.length-1]:-100)}return l}(f,d),[f,d]),b=null==a?void 0:a.neighbors,N=e.useMemo(()=>{const e=b??{};return Object.fromEntries(Object.entries(e).filter(([e])=>!r.has(e)))},[b,r]),y=e.useMemo(()=>l.filter(e=>!r.has(e.hash)),[l,r]),w=e.useMemo(()=>function(e){if(0===e.length)return{...ht,computedAt:Math.floor(Date.now()/1e3)};const t=Math.floor(Date.now()/1e3),s=e.filter(e=>Number.isFinite(e)),n=e.length>0?[e[e.length-1]]:[],a=e.slice(-4).filter(e=>Number.isFinite(e)),i=pt(s),l=xt(s,10),r=xt(s,90),o=pt(n),c=null!==o&&null!==l?o-l:0,d=function(e){if(e.length<2)return 0;const t=e.length;let s=0,n=0,a=0,i=0;const l=e[0].timestamp;for(const o of e){const e=(o.timestamp-l)/3600,t=o.value;s+=e,n+=t,a+=e*t,i+=e*e}const r=t*i-s*s;return Math.abs(r)<1e-4?0:(t*a-s*n)/r}(a.map((e,s)=>({timestamp:t-3600*(a.length-1-s),value:e}))),m=function(e){if(e.length<2)return 0;const t=e.reduce((e,t)=>e+t,0)/e.length,s=e.map(e=>Math.pow(e-t,2)).reduce((e,t)=>e+t,0)/e.length;return Math.sqrt(s)}(a),u=s.length>=12,[h,x]=u?function(e,t,s){const n=ut;return e>=n.DELTA_CRITICAL?[2,`Noise floor ${e.toFixed(1)} dB above baseline`]:t>=n.SLOPE_CRITICAL?[2,`Noise floor rising ${t.toFixed(1)} dB/hour`]:s>=n.JITTER_CRITICAL?[2,`Noise floor unstable (Â±${s.toFixed(1)} dB)`]:e>=n.DELTA_WARNING?[1,`Noise floor ${e.toFixed(1)} dB above baseline`]:t>=n.SLOPE_WARNING?[1,`Noise floor rising ${t.toFixed(1)} dB/hour`]:s>=n.JITTER_WARNING?[1,`Noise floor variable (Â±${s.toFixed(1)} dB)`]:[0,null]}(c,d,m):[0,null];return{baselineMedian:i,baselineP10:l,baselineP90:r,currentMedian:o,currentSampleCount:n.length,delta:c,slope:d,jitter:m,penalty:h,penaltyReason:x,computedAt:t,isReliable:u}}(j),[j]),M=e.useMemo(()=>function(e,t,s){if(0===e.length)return{neighbors:[],networkScore:0,neighborCount:0,bestLink:null,worstLink:null};const n=e.map(e=>{const n=function(e,t,s){const n=ye(e,t,s,0);if(n)switch(n.finalGrade){case"excellent":return 100;case"good":return 80;case"fair":return 60;case"poor":return 40;case"critical":return 20}const a=void 0===e?50:e>=10?100:e>=5?80:e>=0?60:e>=-5?40:20,i=void 0===t?50:t>=-70?100:t>=-80?80:t>=-90?60:t>=-100?40:20;return Math.round(.6*a+.4*i)}(e.avgSnr??void 0,e.avgRssi??void 0,s),a=t[e.hash];return{name:(null==a?void 0:a.name)||(null==a?void 0:a.node_name)||e.prefix,hash:e.hash,rssi:e.avgRssi??-100,snr:e.avgSnr??-10,score:n,advertCount:e.count}});n.sort((e,t)=>t.score-e.score);const a=n.length>0?n.reduce((e,t)=>e+t.score,0)/n.length:0;return{neighbors:n,networkScore:Math.round(a),neighborCount:n.length,bestLink:n.length>0?{name:n[0].name,score:n[0].score}:null,worstLink:n.length>0?{name:n[n.length-1].name,score:n[n.length-1].score}:null}}(y,N,p),[y,N,p]),C=e.useMemo(()=>function(e,t,s){const n=e?Math.max(0,Math.min(100,100-5*e.retryRate)):50;let a=50;null!==t&&(a=Math.max(0,Math.min(100,(t+120)/30*100)));const i=(null==s?void 0:s.networkScore)??50,l=Math.round(.35*n+.25*a+.4*i);let r;return r=l>=85?"excellent":l>=70?"good":l>=50?"fair":l>=30?"congested":"critical",{score:l,status:r,components:{lbtHealth:Math.round(n),noiseHealth:Math.round(a),linkHealth:Math.round(i)}}}(u,x,M),[u,x,M]),[L,_]=e.useState({noiseFloor:null,networkScore:null,channelHealth:null}),D=e.useRef(0);e.useEffect(()=>{const e=()=>{const e=Date.now();e-D.current>3e4&&(D.current=e,_({noiseFloor:x,networkScore:(null==M?void 0:M.networkScore)??null,channelHealth:(null==C?void 0:C.score)??null}))};e();const t=setInterval(e,5e3);return()=>clearInterval(t)},[x,null==M?void 0:M.networkScore,null==C?void 0:C.score]);const H=e.useMemo(()=>({noiseFloor:{current:x,previous:L.noiseFloor,trend:null!==x?vt(x,L.noiseFloor,2,!0):"stable"},networkScore:{current:(null==M?void 0:M.networkScore)??0,previous:L.networkScore,trend:vt((null==M?void 0:M.networkScore)??0,L.networkScore,3,!1)},channelHealth:{current:(null==C?void 0:C.score)??0,previous:L.channelHealth,trend:vt((null==C?void 0:C.score)??0,L.channelHealth,3,!1)}}),[x,null==M?void 0:M.networkScore,null==C?void 0:C.score,L]),$={lbtStats:u,noiseFloor:x,sparklineNoiseFloor:j,linkQuality:M,channelHealth:C,nfTrend:w,radioConfig:p,trends:H,stats:a,recentPackets:i,quickNeighbors:l,isLoading:m,error:null,refresh:async()=>{}};return t.jsx(bt.Provider,{value:$,children:s})}function yt(){const t=e.useContext(bt);if(void 0===t)throw new Error("useLBTData must be used within an LBTDataProvider");return t}function wt(e,t){return 0===e?"No backoffs":`${t.toFixed(0)}% retry rate`}function kt(){const{lbtStats:l,isLoading:r,error:o}=yt(),c=je(),d=(null==l?void 0:l.avgBackoffMs)??0,m=(null==l?void 0:l.retryRate)??0,u=l?(h=d)<100?"excellent":h<250?"good":h<500?"fair":h<1e3?"congested":"critical":"unknown";var h;const x=null==l?void 0:l.sparklineBackoff,{chartData:p,yDomain:f}=e.useMemo(()=>{if(!x||x.length<2)return{chartData:[],yDomain:[0,100]};const e=x.map(e=>({value:e})),t=x.filter(e=>e>0);if(0===t.length)return{chartData:e,yDomain:[0,100]};const s=Math.min(...t),n=Math.max(...t),a=n-s,i=Math.max(.2*a,.1*n,10);return{chartData:e,yDomain:[Math.max(0,s-i),n+i]}},[x]);return t.jsx(mt,{title:"LBT Backoff",icon:t.jsx(qe,{className:"mini-widget-icon"}),value:Math.round(d),unit:"ms",status:u,subtitle:l?wt(d,m):void 0,isLoading:r,error:o,onClick:()=>c("/packets"),children:t.jsx("div",{className:"mini-widget-sparkline",children:p.length>0?t.jsx(s,{width:"100%",height:24,children:t.jsxs(n,{data:p,margin:{top:2,right:2,bottom:2,left:2},children:[t.jsx(a,{domain:f,hide:!0}),t.jsx(i,{type:"monotone",dataKey:"value",stroke:"var(--accent-primary)",strokeWidth:2,dot:!1,isAnimationActive:!1})]})}):t.jsx("div",{className:"h-full"})})})}function Mt(e){return 0===e?"â€”":e<1?"<1":Math.round(e).toString()}function Ct(){const{lbtStats:e,isLoading:s,error:n}=yt(),a=je(),i=(null==e?void 0:e.channelBusyCount)??0,l=(null==e?void 0:e.totalPacketsWithLBT)??0,r=(null==e?void 0:e.channelBusyRate)??0,o=(null==e?void 0:e.retryRate)??0,c=(null==e?void 0:e.avgBackoffMs)??0,d=(null==e?void 0:e.minBackoffMs)??0,m=(null==e?void 0:e.maxBackoffMs)??0,u=o>0?Math.max(0,(o-r)/o*100):100;return t.jsx(mt,{title:"Ch. Busy",icon:t.jsx(be,{className:"mini-widget-icon"}),isLoading:s,error:n,onClick:()=>a("/packets"),children:t.jsx("div",{className:"flex-1 flex items-end",children:t.jsxs("div",{className:"grid grid-cols-[auto_minmax(0,1fr)_auto_minmax(0,1fr)] gap-x-2 gap-y-2 w-full items-baseline",children:[t.jsx("span",{className:"data-box-label mb-0",title:`${i} packets exceeded max CAD attempts (5) out of ${l} total transmissions.`,children:"Failed:"}),t.jsxs("div",{className:"data-box justify-self-start",title:`${i} packets exceeded max CAD attempts (5) out of ${l} total transmissions.`,children:[t.jsx(Ye,{children:i}),t.jsx("span",{className:"text-text-muted punc-slash",children:"/"}),t.jsx(Ye,{children:l})]}),t.jsx("span",{className:"data-box-label mb-0",title:`${u.toFixed(1)}% of packets that needed LBT retries were sent successfully.`,children:"Sent:"}),t.jsx("div",{className:"data-box justify-self-start",title:`${u.toFixed(1)}% of packets that needed LBT retries were sent successfully.`,children:t.jsxs(Ye,{children:[u.toFixed(0),"%"]})}),t.jsx("span",{className:"data-box-label mb-0",title:`Average LBT backoff delay: ${c.toFixed(0)}ms.`,children:"Mean:"}),t.jsxs("div",{className:"data-box justify-self-start",title:`Average LBT backoff delay: ${c.toFixed(0)}ms.`,children:[t.jsx(Ye,{children:Mt(c)}),t.jsx("span",{className:"text-text-muted text-xs",children:"ms"})]}),t.jsx("span",{className:"data-box-label mb-0",title:`Backoff range: ${d.toFixed(0)}ms min, ${m.toFixed(0)}ms max.`,children:"Range:"}),t.jsxs("div",{className:"data-box justify-self-start",title:`Backoff range: ${d.toFixed(0)}ms min, ${m.toFixed(0)}ms max.`,children:[t.jsx(Ye,{children:Mt(d)}),t.jsx("span",{className:"text-text-muted punc-slash",children:"/"}),t.jsx(Ye,{children:Mt(m)})]})]})})})}function St(e){return null===e?"No reading":e<-115?"Very quiet":e<-105?"Quiet":e<-95?"Moderate":e<-85?"Elevated":"High interference"}function Lt(){const{noiseFloor:l,sparklineNoiseFloor:r,trends:o,isLoading:c,error:d}=yt(),m=null===(u=l)||u<-110?"excellent":u<-100?"good":u<-90?"fair":u<-80?"congested":"critical";var u;const h=null==o?void 0:o.noiseFloor.trend,{chartData:x,yDomain:p}=e.useMemo(()=>{if(!r||r.length<2)return{chartData:[],yDomain:[-120,-90]};const e=r.map(e=>({value:e})),t=r.filter(e=>-100!==e&&e<-50);if(0===t.length)return{chartData:e,yDomain:[-120,-90]};const s=Math.min(...t),n=Math.max(...t),a=n-s,i=Math.max(.2*a,3);return{chartData:e,yDomain:[s-i,n+i]}},[r]);return t.jsx(mt,{title:"Noise Floor",icon:t.jsx(He,{className:"mini-widget-icon"}),value:null!==l?Math.round(l):"â€”",unit:null!==l?"dBm":void 0,status:m,trend:h,subtitle:St(l),isLoading:c,error:d,children:t.jsx("div",{className:"mini-widget-sparkline",children:x.length>0?t.jsx(s,{width:"100%",height:24,children:t.jsxs(n,{data:x,margin:{top:2,right:2,bottom:2,left:2},children:[t.jsx(a,{domain:p,hide:!0}),t.jsx(i,{type:"monotone",dataKey:"value",stroke:"var(--accent-primary)",strokeWidth:2,dot:!1,isAnimationActive:!1})]})}):t.jsx("div",{className:"h-full"})})})}function _t(){const s=je(),n=F(),a=k(),i=S(),l=T(),r=60*A[l].minutes,o=H(),c=e.useMemo(()=>{if(0===o)return a;const e=o-r;return a.filter(t=>t.timestamp>=e)},[a,r,o]),d=null===i,m=(null==i?void 0:i.local_hash)?$(i.local_hash):"",u=(null==i?void 0:i.neighbors)??{},{neighborHashes:h,neighborNames:x}=e.useMemo(()=>{const e=new Set,t=new Map;for(const s of n){e.add(s.hash);const n=u[s.hash],a=(null==n?void 0:n.name)||(null==n?void 0:n.node_name)||s.prefix;t.set(s.hash,a)}return{neighborHashes:e,neighborNames:t}},[n,u]),p=e.useMemo(()=>{if(0===h.size||0===c.length||!m)return{champion:null,listener:null,loudest:null};const{scores:e}=Me(c,h,m),t=[];for(const[i,l]of e)0!==l.blendedScore&&t.push({...l,name:x.get(i)??$(i)});let s=null,n=null,a=null;for(const i of t)(!s||i.blendedScore>s.blendedScore)&&(s=i),(!n||i.listenerScore>n.listenerScore)&&(n=i),(!a||i.loudScore>a.loudScore)&&(a=i);return{champion:s,listener:n,loudest:a}},[c,h,m,x]),{champion:f,listener:g,loudest:v}=p,j=f||g||v?t.jsxs("div",{className:"flex flex-col gap-0.5 mt-auto",children:[f&&t.jsx(P,{content:(b=f,t.jsxs("div",{className:"max-w-[220px]",children:[t.jsxs("div",{className:"font-semibold mb-1",children:["ðŸ† Champion: ",b.name]}),t.jsxs("div",{className:"text-text-muted mb-1",children:["Blended Score: ",b.blendedScore,t.jsx("span",{className:"text-text-muted/60 ml-1",children:"(Listener + Loud)"})]}),t.jsxs("div",{className:"border-t border-border-subtle pt-1 mt-1 space-y-0.5",children:[t.jsxs("div",{children:["Listener: ",b.listenerScore,"/100 (",b.listenerCount," shared paths)"]}),t.jsxs("div",{children:["Loud: ",b.loudScore,"/100 (",b.loudCount," packets relayed)"]})]})]})),children:t.jsxs("div",{className:"flex items-center gap-1 text-sm radius-badge px-1 -mx-1 hover-bg transition-base cursor-default",children:[t.jsx(me,{className:"w-3 h-3 text-map-neighbor-color flex-shrink-0"}),t.jsx("span",{className:"font-semibold text-map-neighbor-color font-mono truncate flex-1 min-w-0",children:f.name}),t.jsx("span",{className:"text-map-neighbor-color pl-2 tabular-nums flex-shrink-0 w-9 text-right",children:f.blendedScore})]})}),g&&t.jsx(P,{content:(e=>t.jsxs("div",{className:"max-w-[220px]",children:[t.jsxs("div",{className:"font-semibold mb-1",children:["ðŸ‘‚ Best Listener: ",e.name]}),t.jsxs("div",{className:"text-text-muted mb-1",children:["Score: ",e.listenerScore,"/100"]}),t.jsx("div",{className:"border-t border-border-subtle pt-1 mt-1",children:t.jsxs("div",{children:[e.listenerCount," packets where they heard your transmissions"]})})]}))(g),children:t.jsxs("div",{className:"flex items-center gap-1 text-sm radius-badge px-1 -mx-1 hover-bg transition-base cursor-default",children:[t.jsx($e,{className:"w-3 h-3 text-text-muted flex-shrink-0"}),t.jsx("span",{className:"text-text-muted font-mono truncate flex-1 min-w-0",children:g.name}),t.jsx("span",{className:"text-text-muted pl-2 tabular-nums flex-shrink-0 w-9 text-right",children:g.listenerScore})]})}),v&&t.jsx(P,{content:(e=>t.jsxs("div",{className:"max-w-[220px]",children:[t.jsxs("div",{className:"font-semibold mb-1",children:["ðŸ“¢ Loudest: ",e.name]}),t.jsxs("div",{className:"text-text-muted mb-1",children:["Score: ",e.loudScore,"/100"]}),t.jsx("div",{className:"border-t border-border-subtle pt-1 mt-1",children:t.jsxs("div",{children:[e.loudCount," packets they relayed directly to you"]})})]}))(v),children:t.jsxs("div",{className:"flex items-center gap-1 text-sm radius-badge px-1 -mx-1 hover-bg transition-base cursor-default",children:[t.jsx(Pe,{className:"w-3 h-3 text-text-muted flex-shrink-0"}),t.jsx("span",{className:"text-text-muted font-mono truncate flex-1 min-w-0",children:v.name}),t.jsx("span",{className:"text-text-muted pl-2 tabular-nums flex-shrink-0 w-9 text-right",children:v.loudScore})]})})]}):0===n.length?t.jsx("div",{className:"flex items-center justify-center text-sm text-text-muted mt-auto",children:"No direct neighbors"}):t.jsx("div",{className:"flex items-center justify-center text-sm text-text-muted mt-auto",children:"No routing data yet"});var b;return t.jsx(mt,{title:"Link Leaders",icon:t.jsx(Ie,{className:"mini-widget-icon"}),isLoading:d,onClick:()=>s("/contacts"),children:j})}function Dt(){const{lbtStats:l,isLoading:r,error:o}=yt(),c=l?function(e){const{retryRate:t,channelBusyCount:s,totalPacketsWithLBT:n,avgBackoffMs:a,maxBackoffMs:i}=e;if(0===n)return 0;const l=Math.min(n/10,1),r=Math.log(1+.15*t)/Math.log(16)*40,o=s/n*100,c=Math.min(.5*o,25);let d=0;a>100&&(d=Math.min(8*Math.log10(a/100),15));let m=0;i>500&&a>0&&i>2*a&&(m=Math.min((i-500)/200,5));const u=(r+c+d+m)*l;return Math.min(u,85)}(l):0,d=l?(m=c)<15?"excellent":m<30?"good":m<45?"fair":m<60?"congested":"critical":"unknown";var m;const u=(null==l?void 0:l.maxBackoffMs)??0,h=l?u>200?`Max backoff: ${Math.round(u)}ms`:function(e){return e<15?"Clear channel":e<30?"Light traffic":e<45?"Moderate traffic":e<60?"Heavy traffic":e<75?"Congested":"Severe congestion"}(c):void 0,x=null==l?void 0:l.sparklineCollisionRisk,{chartData:p,yDomain:f}=e.useMemo(()=>{if(!x||x.length<2)return{chartData:[],yDomain:[0,85]};const e=x.map(e=>({value:e})),t=x.filter(e=>e>0);if(0===t.length)return{chartData:e,yDomain:[0,85]};const s=Math.min(...t),n=Math.max(...t),a=n-s,i=Math.max(.2*a,5);return{chartData:e,yDomain:[Math.max(0,s-i),Math.min(85,n+i)]}},[x]);return t.jsx(mt,{title:"Collision Risk",icon:t.jsx(ke,{className:"mini-widget-icon"}),value:c.toFixed(1),unit:"%",status:d,subtitle:h,isLoading:r,error:o,children:t.jsx("div",{className:"mini-widget-sparkline",children:p.length>0?t.jsx(s,{width:"100%",height:24,children:t.jsxs(n,{data:p,margin:{top:2,right:2,bottom:2,left:2},children:[t.jsx(a,{domain:f,hide:!0}),t.jsx(i,{type:"monotone",dataKey:"value",stroke:"var(--accent-primary)",strokeWidth:2,dot:!1,isAnimationActive:!1})]})}):t.jsx("div",{className:"h-full"})})})}function Ft(){const[s,n]=e.useState(!1),[a]=e.useState(0),{stats:i,lbtStats:l,isLoading:r}=yt(),o=e.useMemo(()=>{if(!i)return null;const e=i.airtime_used_ms??0,t=i.max_airtime_ms??1;return{usedMs:e,maxMs:t,remainingMs:i.airtime_remaining_ms??0,utilizationPercent:i.utilization_percent??(t>0?e/t*100:0)}},[i]),c=e.useMemo(()=>l&&0!==l.totalPacketsWithLBT?(l.totalPacketsWithLBT-l.packetsWithRetries)/l.totalPacketsWithLBT*100:100,[l]),d=(null==o?void 0:o.utilizationPercent)??0,m=(u=d)<30?"excellent":u<50?"good":u<70?"fair":u<90?"congested":"critical";var u;const h=(null==o?void 0:o.remainingMs)??0,x=c<95?`${c.toFixed(0)}% clean TX`:((p=h)<1e3?`${Math.round(p)}ms`:p<6e4?`${(p/1e3).toFixed(1)}s`:`${(p/6e4).toFixed(1)}m`)+" remaining";var p;const f=o?t.jsx("div",{className:"mini-widget-progress mt-auto",children:t.jsx("div",{className:`mini-widget-progress-bar ${m}`,style:{width:`${Math.min(d,100)}%`}})}):null;return t.jsx(mt,{title:"Duty Cycle",icon:t.jsx(_,{className:"mini-widget-icon"}),value:d.toFixed(1),unit:"%",status:m,subtitle:x,isLoading:r,children:f})}function Rt(){return t.jsxs("div",{className:"mini-widget",children:[t.jsxs("div",{className:"mini-widget-header",children:[t.jsx(ne,{className:"w-4 h-4"}),t.jsx(ne,{className:"h-3 w-16"})]}),t.jsx(ne,{className:"h-7 w-12 mt-2"}),t.jsx(ne,{className:"h-3 w-20 mt-2"})]})}function Tt(){return t.jsx("div",{className:"widget-row",children:Array.from({length:6}).map((e,s)=>t.jsx(Rt,{},s))})}function At({className:e="",isLoaded:s=!0}){return t.jsxs("div",{className:`mesh-health-container relative ${e}`,children:[t.jsxs("div",{className:"mesh-health-header",children:[t.jsx(ze,{className:"w-4 h-4 text-accent-primary"}),t.jsx("span",{className:"type-label text-text-muted",children:"MESH HEALTH"})]}),s?t.jsx(Nt,{children:t.jsxs("div",{className:"widget-row",children:[t.jsx(kt,{}),t.jsx(Dt,{}),t.jsx(Lt,{}),t.jsx(Ft,{}),t.jsx(Ct,{}),t.jsx(_t,{})]})}):t.jsx(Tt,{})]})}const Bt={sm:{button:"w-3 h-3",icon:"w-1.5 h-1.5",stroke:"ring-1"},md:{button:"w-3.5 h-3.5",icon:"w-2 h-2",stroke:"ring-1"},lg:{button:"w-4 h-4",icon:"w-2.5 h-2.5",stroke:"ring-[1.5px]"}},Ht=e.forwardRef(function({size:e="md",showIconOnHover:s=!0,className:n,...a},i){const r=Bt[e];return t.jsx("button",{ref:i,type:"button","aria-label":"Close",className:l("group relative inline-flex items-center justify-center rounded-full","transition-all duration-150 ease-out",r.button,"bg-[#FF5F57]",r.stroke,"ring-inset ring-[#E0443E]","hover:bg-[#FF6961]","active:bg-[#E04840] active:scale-95","focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2","focus-visible:ring-[#FF5F57] focus-visible:ring-offset-bg-base",n),...a,children:s&&t.jsx("svg",{className:l(r.icon,"opacity-0 group-hover:opacity-100 transition-opacity duration-100","text-[#4A0000]"),fill:"none",viewBox:"0 0 10 10",stroke:"currentColor",strokeWidth:2.5,strokeLinecap:"round",children:t.jsx("path",{d:"M2.5 2.5L7.5 7.5M7.5 2.5L2.5 7.5"})})})});let $t="",Pt="",Et="";function It(e){!function(){const e=new Date,t=e.toDateString();if(t!==Et){Et=t,$t=t;const s=new Date(e);s.setDate(s.getDate()-1),Pt=s.toDateString()}}();const t=new Date(1e3*e).toDateString();return t===$t?"Today":t===Pt?"Yesterday":new Date(1e3*e).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"})}const zt=new RegExp("(?:\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu");function qt(e){const t=e.match(zt);return t&&t.length>0?{emoji:t[0],cleanName:e.replace(zt,"").trim()||e}:{emoji:null,cleanName:e}}function Wt(e,t,s){return`${e||""}|${t}|${s}`}const Ot={stiffness:600,damping:50,mass:.3},Vt={duration:.15,ease:[.4,0,.2,1]};function Gt(e){const s=/@\[([^\]]+)\]/g,n=[];let a,i=0;for(;null!==(a=s.exec(e));)a.index>i&&n.push(e.slice(i,a.index)),n.push(t.jsx("span",{className:"font-extrabold text-white",children:a[1]},a.index)),i=a.index+a[0].length;return i<e.length&&n.push(e.slice(i)),n.length>0?n:e}const Kt=e.memo(function({message:e,onChannelClick:s,isChannelSelected:n}){const a=e.senderName||"Unknown",{emoji:i,cleanName:r}=qt(a),o=function(e){const t=["#22c55e","#3b82f6","#f59e0b","#ec4899","#8b5cf6","#06b6d4","#f97316","#84cc16"];let s=0;for(let n=0;n<e.length;n++)s=e.charCodeAt(n)+((s<<5)-s);return t[Math.abs(s)%t.length]}(r),c=function(e){const{cleanName:t}=qt(e),s=t.split(/[\s-_]+/).filter(Boolean);return s.length>=2?(s[0][0]+s[1][0]).toUpperCase():t.slice(0,2).toUpperCase()}(a),d=e.channelName||e.channelHash.slice(0,6);return t.jsxs("div",{className:"flex items-stretch gap-3 w-full",children:[t.jsxs("div",{className:"flex-shrink-0 flex flex-col items-center justify-between py-0.5",children:[t.jsx("div",{className:l("w-9 h-9 rounded-full flex items-center justify-center","shadow-md ring-1 ring-white/10",i?"text-lg p-1":"text-white text-[13px] font-bold tracking-tight"),style:{backgroundColor:o},children:i||c}),t.jsx("span",{className:"text-[10px] text-text-muted tabular-nums",children:(m=e.timestamp,new Date(1e3*m).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("span",{className:"text-[13px] font-medium",style:{color:o},children:r}),t.jsx("button",{onClick:()=>null==s?void 0:s(e.channelHash),className:l("px-2 py-0.5 rounded text-[10px] font-medium transition-all","ring-1 ring-inset",n?"bg-accent-primary/20 text-accent-primary ring-accent-primary/30":"bg-white/5 text-text-secondary ring-white/10 hover:bg-white/10"),children:d})]}),t.jsx("div",{className:l("inline-block px-3.5 py-2.5","rounded-2xl rounded-tl-md","bg-[#007AFF]"),children:t.jsx("p",{className:"text-[14px] text-white leading-relaxed tracking-wide whitespace-pre-wrap break-words",children:Gt(e.text)})})]})]});var m},function(e,t){const s=e.message,n=t.message;return s.timestamp===n.timestamp&&s.text===n.text&&s.senderName===n.senderName&&s.channelHash===n.channelHash&&s.channelName===n.channelName&&e.isChannelSelected===t.isChannelSelected&&e.onChannelClick===t.onChannelClick});function Ut({open:s,onClose:n,messages:a,onDecodeMore:i,hasMoreToLoad:r,isDecoding:o}){const c=e.useRef(null),d=e.useRef(!1),m=e.useRef(0),u=e.useRef(!1),h=De(0),x=Ke(h,Ot),p=e.useRef(0),f=e.useRef(null),g=e.useCallback(()=>{p.current=0,h.set(0)},[h]);e.useEffect(()=>()=>{f.current&&clearTimeout(f.current)},[]);const v=e.useCallback(e=>{const t=e.currentTarget,{scrollTop:s,scrollHeight:n,clientHeight:a}=t,i=s<=0,l=s>=n-a-1,r=e.deltaY<0,o=e.deltaY>0;if(i&&r||l&&o){e.preventDefault();const t=i?1:-1,s=.4,n=80;p.current+=e.deltaY*s*-t,p.current=Math.max(-n,Math.min(n,p.current));const a=p.current/n,l=Math.sign(a)*Math.pow(Math.abs(a),.7)*n;h.set(l*t),f.current&&clearTimeout(f.current),f.current=setTimeout(g,16)}else 0!==p.current&&g()},[h,g]),j=T(),b=W(),N=e.useMemo(()=>{const e=Date.now()/1e3-60*A[j].minutes;return[...a].filter(t=>t.timestamp>=e).sort((e,t)=>e.timestamp-t.timestamp)},[a,j]);e.useEffect(()=>{s||(d.current=!1,m.current=0,u.current=!1)},[s]);const y=e.useCallback(()=>{const e=c.current;if(!e)return;const{scrollTop:t,scrollHeight:s,clientHeight:n}=e,a=t+n>=s-50;!a&&s>n&&(d.current=!0),a&&(d.current=!1)},[]);e.useEffect(()=>{if(!s)return;const e=c.current;if(!e)return;const t=setTimeout(()=>{e.scrollTo({top:e.scrollHeight,behavior:"instant"})},50);return()=>clearTimeout(t)},[s]),e.useEffect(()=>{const e=c.current;if(!e||!s||0===N.length)return;const t=N.length,n=t>m.current,a=u.current&&!o;(a||n&&!o&&!d.current)&&requestAnimationFrame(()=>{const t=a?"instant":"smooth";e.scrollTo({top:e.scrollHeight,behavior:t})}),m.current=t,u.current=o},[N.length,s,o]);const w=e.useMemo(()=>{const e=new Map;for(const t of N){const s=t.channelHash,n=e.get(s);n?n.count++:e.set(s,{name:t.channelName||t.channelHash.slice(0,6),hash:t.channelHash,count:1})}return Array.from(e.values()).sort((e,t)=>t.count-e.count)},[N]),k=w.length,[M,C]=e.useState(null),[S,L]=e.useState(!1),_=e.useMemo(()=>M?N.filter(e=>e.channelHash===M):N,[N,M]),D=e.useMemo(()=>{const e=[];let t="";for(const s of _){const n=It(s.timestamp);n!==t&&(e.push({type:"date",date:n}),t=n),e.push({type:"message",message:s})}return e},[_]),F=w.slice(0,11),R=w.slice(11),B=R.length>0;return t.jsxs(O,{open:s,onClose:n,size:"lg",motionPlus:!0,solid:!0,children:[t.jsx(Ht,{onClick:n,size:"md",style:{position:"absolute",top:12,right:12,zIndex:10}}),t.jsxs(V,{className:"p-0 flex flex-col h-[80vh] max-h-[700px] rounded-2xl overflow-hidden",children:[t.jsx("div",{className:"flex-shrink-0 px-5 py-4 pr-12",children:t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Ee,{className:"size-5 text-icon-card-title flex-shrink-0"}),t.jsx("h2",{className:"text-base font-semibold text-text-primary",children:"Public Channels"})]}),t.jsx(Ne,{ranges:A,selectedIndex:j,onSelect:b,size:"micro"})]})}),k>0&&t.jsx("div",{className:"flex-shrink-0 px-3 pb-2",children:t.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.jsx("button",{onClick:()=>C(null),className:l("px-2 py-0.5 rounded text-[10px] font-medium transition-all","ring-1 ring-inset",null===M?"bg-accent-primary/20 text-accent-primary ring-accent-primary/30":"bg-white/5 text-text-secondary ring-white/10 hover:bg-white/10"),children:"All"}),F.map(e=>t.jsx("button",{onClick:()=>C(e.hash),className:l("flex items-center gap-1 px-2 py-0.5 rounded text-[10px] font-medium transition-all","ring-1 ring-inset",M===e.hash?"bg-accent-primary/20 text-accent-primary ring-accent-primary/30":"bg-white/5 text-text-secondary ring-white/10 hover:bg-white/10"),children:t.jsx("span",{className:"truncate max-w-[80px]",children:e.name})},e.hash)),B&&t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>L(!S),className:l("flex items-center gap-0.5 px-2 py-0.5 rounded text-[10px] font-medium transition-all","ring-1 ring-inset",S||R.some(e=>e.hash===M)?"bg-accent-primary/20 text-accent-primary ring-accent-primary/30":"bg-white/5 text-text-secondary ring-white/10 hover:bg-white/10"),children:["+",R.length,t.jsx(G,{className:l("size-3 transition-transform",S&&"rotate-180")})]}),S&&t.jsx("div",{className:l("absolute top-full left-0 mt-1 z-20","min-w-[140px] max-h-[200px] overflow-y-auto","p-1 rounded-lg","bg-bg-elevated/95 backdrop-blur-md","ring-1 ring-border-subtle shadow-lg"),children:R.map(e=>t.jsxs("button",{onClick:()=>{C(e.hash),L(!1)},className:l("w-full flex items-center gap-1.5 px-2 py-1 rounded text-[10px] font-medium transition-all text-left",M===e.hash?"bg-accent-primary/20 text-accent-primary":"text-text-secondary hover:bg-white/10"),children:[t.jsx(Le,{className:"size-2.5 opacity-60 flex-shrink-0"}),t.jsx("span",{className:"truncate",children:e.name}),t.jsxs("span",{className:"opacity-60 ml-auto",children:["(",e.count,")"]})]},e.hash))})]})]})}),t.jsx("div",{ref:c,className:l("flex-1 overflow-y-auto overflow-x-hidden","mx-3 mb-3 rounded-md","bg-bg-0","ring-1 ring-inset ring-white/10"),style:{minHeight:0},onWheel:v,onScroll:y,children:t.jsx(K.div,{className:"px-4 py-4 space-y-3",style:{y:x},children:o&&0===_.length?t.jsxs("div",{className:"flex flex-col items-center justify-center h-full min-h-[300px] text-text-muted",children:[t.jsx(_e,{className:"size-12 mb-4 text-accent-purple animate-spin"}),t.jsx("p",{className:"text-lg font-medium",children:"Loading messages..."})]}):0===_.length?t.jsxs("div",{className:"flex flex-col items-center justify-center h-full min-h-[300px] text-text-muted",children:[t.jsx(pe,{className:"size-16 mb-4 opacity-20"}),t.jsx("p",{className:"text-lg font-medium",children:"No messages yet"}),t.jsx("p",{className:"text-sm mt-1 opacity-70",children:M?"No messages in this channel":"Public channel messages will appear here"})]}):t.jsxs(t.Fragment,{children:[o?t.jsx("div",{className:"space-y-3",children:D.map((e,s)=>{if("date"===e.type)return t.jsx("div",{className:"flex justify-center my-5",children:t.jsx("span",{className:l("px-3.5 py-1.5 rounded-full","bg-white/5 backdrop-blur-sm","text-[11px] text-text-muted/80 font-medium","ring-1 ring-white/5"),children:e.date})},`date-${e.date}-${s}`);const n=`msg-${e.message.timestamp}-${e.message.senderName||"anon"}-${e.message.channelHash}`;return t.jsx("div",{children:t.jsx(Kt,{message:e.message,onChannelClick:C,isChannelSelected:M===e.message.channelHash})},n)})}):t.jsx(U,{initial:!1,mode:"sync",children:D.map((e,s)=>{if("date"===e.type)return t.jsx(K.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:Vt,className:"flex justify-center my-5",children:t.jsx("span",{className:l("px-3.5 py-1.5 rounded-full","bg-white/5 backdrop-blur-sm","text-[11px] text-text-muted/80 font-medium","ring-1 ring-white/5"),children:e.date})},`date-${e.date}-${s}`);const n=`msg-${e.message.timestamp}-${e.message.senderName||"anon"}-${e.message.channelHash}`;return t.jsx(K.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:Vt,children:t.jsx(Kt,{message:e.message,onChannelClick:C,isChannelSelected:M===e.message.channelHash})},n)})}),t.jsx("div",{className:"h-2"})]})})}),t.jsx("div",{className:"flex-shrink-0 px-5 py-2 text-center",children:t.jsxs("p",{className:"text-[11px] text-text-muted",children:[_.length," messages Â· ",k," ",1===k?"channel":"channels",o&&t.jsxs("span",{className:"ml-2 text-accent-purple",children:[t.jsx(_e,{className:"inline size-3 animate-spin mr-1"}),"Decrypting..."]})]})})]})]})}function Jt({isLoaded:s=!0}){const n=k(),[a,i]=e.useState(!1),r=E(),o=I(),c=e.useMemo(()=>function(e){const t=[],s=new Set;for(const n of e.values()){const e=n.decoded;if(!e||!e.decrypted||e.macCorrupted||!e.text)continue;const a=Wt(e.senderName,e.channelHash,e.text);s.has(a)||(s.add(a),t.push({timestamp:n.timestamp,channelName:e.channelName,channelHash:e.channelHash,senderName:e.senderName,text:e.text,rssi:n.rssi,snr:n.snr}))}return t}(r),[r]),d=e.useMemo(()=>0===c.length?null:c.reduce((e,t)=>t.timestamp>e.timestamp?t:e),[c]),m=e.useMemo(()=>n.filter(e=>(e.type??e.payload_type)===z.GRP_TXT&&e.raw_packet).length,[n]),u=o.isDecoding,h=o.processed<o.total,x=e.useCallback(async()=>{},[]);return s?t.jsxs(t.Fragment,{children:[t.jsx("div",{onClick:()=>i(!0),className:l("group cursor-pointer rounded-xl transition-all duration-150","ring-1 ring-inset ring-white/10 hover:ring-accent-primary/50","hover:bg-white/[0.02]","px-3 py-2.5 sm:px-4 sm:py-3"),children:t.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-shrink-0",children:[t.jsx(Ee,{className:"size-4 text-icon-card-title flex-shrink-0"}),t.jsx("span",{className:"type-micro",children:"CHAT ACTIVITY"}),m>0&&t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-white/5 ring-1 ring-inset ring-white/10 text-sm tabular-nums text-text-secondary",children:m}),t.jsx(Se,{className:"size-4 text-text-muted group-hover:text-accent-purple transition-colors ml-auto sm:hidden"})]}),t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0",children:[d?t.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1 sm:flex-initial sm:max-w-lg",children:[d.channelName&&t.jsxs("span",{className:"hidden sm:inline-flex items-center px-2 py-1 rounded-md bg-white/5 ring-1 ring-inset ring-white/10 text-sm text-text-secondary flex-shrink-0",children:["#",d.channelName.replace(/^#/,"")]}),t.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-2xl rounded-tr-md bg-[#007AFF] shadow-sm min-w-0 flex-1 sm:flex-initial sm:max-w-xs",children:t.jsxs("span",{className:"text-sm text-white truncate tracking-wide",children:[d.senderName?`${d.senderName}: `:"",d.text]})}),t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-white/5 ring-1 ring-inset ring-white/10 text-sm tabular-nums text-text-secondary flex-shrink-0",children:q(d.timestamp)})]}):t.jsx("span",{className:"text-sm text-text-muted italic",children:"No messages yet"}),t.jsx(Se,{className:"size-4 text-text-muted group-hover:text-accent-purple transition-colors flex-shrink-0 hidden sm:block"})]})]})}),t.jsx(Ut,{open:a,onClose:()=>i(!1),messages:c,onDecodeMore:x,hasMoreToLoad:h,isDecoding:u})]}):t.jsx("div",{className:"h-14 rounded-xl bg-bg-elevated/50 animate-pulse"})}function Yt(){var n,i;const l=S(),u=J(),h=k(),x=Y(),p=T(),f=W(),g=Q(),v=A[p],j=5===p&&!g.threeDayLoadComplete,b=6===p&&!g.sevenDayLoadComplete,N=7===p&&!g.fourteenDayLoadComplete,w=g.isBackgroundLoading&&(j||b||N),M=ee(),C=te(),L=null==(n=null==l?void 0:l.config)?void 0:n.radio,_=e.useMemo(()=>L?{sf:L.spreading_factor??10,bw:L.bandwidth??25e4,cr:L.coding_rate??5,preamble:L.preamble_length??8}:null,[L]),D=h.length,F=e.useMemo(()=>D?X(v.minutes,v.buckets,h,l):null,[D,v.minutes,v.buckets,_]),R=e.useMemo(()=>function(e,t,s){if(!(null==e?void 0:e.length))return[];const n=s<=1440?{hour:"2-digit",minute:"2-digit",hour12:!1}:s<=4320?{weekday:"short",hour:"2-digit",minute:"2-digit",hour12:!1}:{weekday:"short",hour:"numeric",hour12:!1};return e.map((e,a)=>{var i;let l=new Date(1e3*e.start).toLocaleString([],n);return s>4320&&(l=l.replace(/(\d+)$/,"$1h")),{time:l,received:e.count,unique:(null==(i=null==t?void 0:t[a])?void 0:i.count)??0}})}(null==F?void 0:F.received,null==F?void 0:F.unique_received,v.minutes),[null==F?void 0:F.received,null==F?void 0:F.unique_received,v.minutes]),B=e.useMemo(()=>function(e){if(!e.length)return[0,"auto"];let t=0;for(const s of e)s.received>t&&(t=s.received),s.unique>t&&(t=s.unique);return[0,t||1]}(R),[R]),H=e.useMemo(()=>{const e=e=>(null==e?void 0:e.reduce((e,t)=>e+t.count,0))??0,t=e(null==F?void 0:F.received),s=e(null==F?void 0:F.unique_received),n=e(null==F?void 0:F.forwarded),a=e(null==F?void 0:F.dropped),i=e(null==F?void 0:F.transmitted),l=((null==F?void 0:F.time_range_minutes)??v.minutes)/60;return{received:t,uniqueReceived:s,forwarded:n,dropped:a,transmitted:i,rxPerHour:l>0?Math.round(t/l):0,fwdPerHour:l>0?Math.round(n/l):0}},[F,v.minutes]),$=(null==l?void 0:l.node_name)??(null==(i=null==l?void 0:l.config)?void 0:i.node_name)??"Unknown Node";return u?t.jsxs(ae,{className:"p-8 text-center",children:[t.jsx("p",{className:"type-subheading text-accent-red mb-2",children:"Failed to connect to backend"}),t.jsx("p",{className:"type-body text-white/50",children:u}),t.jsx("p",{className:"type-data-sm text-white/40 mt-4",children:"Make sure the backend is running on port 8000"})]}):t.jsxs(ie,{children:[t.jsx(le,{title:$,icon:t.jsx(Fe,{}),controls:t.jsx(Ne,{ranges:A,selectedIndex:p,onSelect:f,isPending:w})}),t.jsxs(re,{children:[t.jsx(Jt,{isLoaded:x}),t.jsx(Re,{template:"hero",children:t.jsxs(ae,{compact:!0,children:[t.jsx(Ae,{icon:t.jsx(ue,{}),title:"RECEIVED",badge:v.label,actions:x?t.jsxs("div",{className:"data-box",children:[H.rxPerHour,"/hr"]}):t.jsx("div",{className:"data-box opacity-0",children:"0/hr"})}),t.jsxs("div",{className:"flex flex-wrap gap-4 sm:gap-8",children:[t.jsxs("div",{className:"flex items-end gap-2",children:[t.jsx("div",{className:"type-data-hero text-text-primary",children:x?t.jsx(Ye,{children:H.received}):t.jsx("span",{className:"opacity-30",children:"â€”"})}),t.jsx(y,{color:"green",className:"mb-0.5 sm:mb-1",children:"Total RF"})]}),t.jsxs("div",{className:"flex items-end gap-2",children:[t.jsx("div",{className:"type-data-hero text-text-primary",children:x?t.jsx(Ye,{children:H.uniqueReceived}):t.jsx("span",{className:"opacity-30",children:"â€”"})}),t.jsx(y,{color:"blue",className:"mb-0.5 sm:mb-1",children:"Unique"})]})]}),t.jsx("div",{className:"mt-4 sm:mt-6 lg:mt-8 dashboard-chart-height",children:x?R.length>0?t.jsx(s,{width:"100%",height:"100%",children:t.jsxs(r,{data:R,margin:{left:0,right:8,top:0,bottom:0},children:[t.jsx(o,{strokeDasharray:"3 3",stroke:C.grid,vertical:!1}),t.jsx(c,{dataKey:"time",axisLine:!1,tickLine:!1,tick:{fill:C.axisTick,fontSize:10,fontFamily:Z},dy:8,interval:"preserveStartEnd",minTickGap:60}),t.jsx(a,{domain:B,axisLine:!1,tickLine:!1,tick:{fill:C.axisTick,fontSize:10,fontFamily:Z},dx:-4,width:28}),t.jsx(d,{content:t.jsx(lt,{labelKey:"time"}),cursor:{stroke:C.cursor,strokeWidth:1}}),t.jsx(m,{type:"stepAfter",dataKey:"received",name:"Total RF",stroke:"none",fill:M.received,fillOpacity:1,dot:!1,activeDot:{r:4,strokeWidth:0,fill:M.received},isAnimationActive:!1}),t.jsx(m,{type:"stepAfter",dataKey:"unique",name:"Unique",stroke:"none",fill:M.forwarded,fillOpacity:1,dot:!1,activeDot:{r:4,strokeWidth:0,fill:M.forwarded},isAnimationActive:!1})]})}):t.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No data available for this time range"}):t.jsx("div",{className:"h-full flex items-end gap-1 animate-pulse","aria-hidden":"true",children:[45,72,33,58,80,42,65,28,55,75,38,62].map((e,s)=>t.jsx("div",{className:"flex-1 bg-subtle-fill rounded-sm",style:{height:`${e}%`}},s))})})]})}),t.jsxs(Re,{template:"compact",children:[t.jsx(Te,{span:6,lg:4,children:t.jsx(et,{title:"FORWARDED",value:H.forwarded,color:"forwarded",buckets:null==F?void 0:F.forwarded,receivedCount:H.received,timeRangeLabel:v.label,icon:t.jsx(Be,{className:"w-4 h-4"}),isLoaded:x})}),t.jsx(Te,{span:6,lg:4,children:t.jsx(et,{title:"DROPPED",value:H.dropped,color:"dropped",buckets:null==F?void 0:F.dropped,receivedCount:H.received,timeRangeLabel:v.label,icon:t.jsx(we,{className:"w-4 h-4"}),isLoaded:x})}),t.jsx(Te,{span:12,lg:4,children:t.jsx(at,{stats:l,receivedBuckets:null==F?void 0:F.received,droppedBuckets:null==F?void 0:F.dropped,forwardedBuckets:null==F?void 0:F.forwarded,bucketDurationSeconds:null==F?void 0:F.bucket_duration_seconds,timeRangeLabel:v.label,isLoaded:x})})]}),t.jsx(At,{isLoaded:x}),t.jsx(it,{}),l&&t.jsx(Re,{template:"auto",children:t.jsx(Ce,{nodeName:$,repeaterVersion:l.version,coreVersion:l.core_version,localHash:l.local_hash,publicKey:l.public_key})})]})]})}export{Yt as default};
