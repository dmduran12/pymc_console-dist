var Mt=Object.defineProperty;var Ct=(t,n,s)=>n in t?Mt(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s;var xe=(t,n,s)=>Ct(t,typeof n!="symbol"?n+"":n,s);import{d as Ae,r as c,j as e,k as Ce,c as nt,b9 as yt,c0 as bt,c1 as Je,c2 as ve,c3 as At,q as Fe,c4 as _t,c5 as Rt,e as Lt,c6 as Dt,c7 as Et,c8 as Tt,c9 as It,ca as Pt,by as Ot,cb as Be,bB as Ft,cc as Ht,cd as Bt,F as Ne,ce as $t,cf as zt,cg as Wt,E as Ut,J as Gt,H as qt,y as Vt,ag as Kt,ah as Yt,K as Xt,aa as Zt,ch as Qt,ci as $e,cj as at,a2 as Jt,R as es,ck as ts}from"./index-BTKkXbas.js";import{L as Se}from"./layers-B84eIAc1.js";import{u as et,h as ss,r as tt}from"./consumer-registry-AyjZ2z5n.js";import{C as ze,e as ns}from"./easing-DpQbtfXz.js";import{T as as}from"./TimeRangeStepper-DYkXXSon.js";import{C as le,P as rs,a as is,B as os}from"./PageLayout-CJ2__g8C.js";import{D as ls}from"./DataBox-5Vz4nUlS.js";import{E as cs,A as Oe}from"./AnimatedNumber-DZsYGh4d.js";import{C as ms}from"./CollisionExplorerModal-sQq9CLR3.js";import{H as rt}from"./hash-CeoAL1iZ.js";import{T as Ze}from"./triangle-alert-B-i8APA2.js";import{L as ds}from"./LightSparkline-DFCjAhbm.js";import{A as us}from"./activity-Cds4ROQf.js";import{c as hs,a as xs,A as ps}from"./AnalyzerFilterPanel-bme2l0gw.js";import{useResolveSource as fs}from"./usePipelineStore-Ckdvp297.js";import{R as ge,C as we}from"./Grid-CJTfc9PD.js";import{S as gs}from"./settings-2-DShZKfXZ.js";import{N as ys}from"./network-D4R6N7ye.js";import"./chevron-right-D1csxl2X.js";import"./map-pin-BIufIjlc.js";import"./index-Bv6BFxCs.js";import"./BasemapLayer-BZ8lJnOp.js";import"./monitor-smartphone-tD_FoSwi.js";import"./node-types-DCFFsZpK.js";import"./funnel-fH_ftC2W.js";import"./circle-question-mark-g6eBr9sv.js";import"./search-BcKhvd6M.js";/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]],js=Ae("chart-line",bs);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],it=Ae("circle-check-big",Ns);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],Ss=Ae("grid-3x3",vs);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=[["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"19",cy:"5",r:"1",key:"w8mnmm"}],["circle",{cx:"5",cy:"5",r:"1",key:"lttvr7"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}],["circle",{cx:"19",cy:"19",r:"1",key:"shf9b7"}],["circle",{cx:"5",cy:"19",r:"1",key:"bfqh0e"}]],ws=Ae("grip",ks);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=[["path",{d:"M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"knzxuh"}],["path",{d:"M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"2jd2cc"}],["path",{d:"M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"rd2r6e"}]],Cs=Ae("waves",Ms),jt={useAbsoluteThresholds:!0,baselinePercentile:6,spikePercentile:50,baselineDbm:-107,spikeDbm:-100,mergeGapSeconds:45,minSequenceLength:16,similarityToleranceDbm:5};function je(t,n){if(t.length===0)return 0;const s=n/100*(t.length-1),a=Math.floor(s),i=Math.ceil(s);return a===i?t[a]:t[a]+(t[i]-t[a])*(s-a)}function ot(t){if(t.length===0)return{median:0,p90:0,p95:0,p99:0,max:0,min:0};const n=[...t].sort((s,a)=>s-a);return{median:je(n,50),p90:je(n,90),p95:je(n,95),p99:je(n,99),max:n[n.length-1],min:n[0]}}function As(t,n={}){const s={...jt,...n};if(t.length<10)return{anomalies:[],thresholds:ot([]),totalSamples:t.length,anomalySamples:0};const a=t.map(g=>g.noise_floor_dbm),i=ot(a),r=[...a].sort((g,j)=>g-j);let l,x;s.useAbsoluteThresholds?(l=s.baselineDbm,x=s.spikeDbm):(l=je(r,s.baselinePercentile),x=je(r,s.spikePercentile));const o=[...t].sort((g,j)=>g.timestamp-j.timestamp),p=[];let d=null,h=0;for(const g of o)if(g.noise_floor_dbm>l&&g.noise_floor_dbm<x)if(h++,!d)d={startTs:g.timestamp,endTs:g.timestamp,values:[g.noise_floor_dbm],timestamps:[g.timestamp],rollingAvg:g.noise_floor_dbm};else{const k=Math.abs(g.noise_floor_dbm-d.rollingAvg)<=s.similarityToleranceDbm,L=g.timestamp-d.endTs<=s.mergeGapSeconds;k&&L?(d.endTs=g.timestamp,d.values.push(g.noise_floor_dbm),d.timestamps.push(g.timestamp),d.rollingAvg=d.values.reduce((P,z)=>P+z,0)/d.values.length):(d.values.length>=s.minSequenceLength&&p.push(d),d={startTs:g.timestamp,endTs:g.timestamp,values:[g.noise_floor_dbm],timestamps:[g.timestamp],rollingAvg:g.noise_floor_dbm})}else d&&d.values.length>=s.minSequenceLength&&p.push(d),d=null;return d&&d.values.length>=s.minSequenceLength&&p.push(d),p.length===0?{anomalies:[],thresholds:i,totalSamples:t.length,anomalySamples:h,debug:{baselineCutoff:l,spikeCutoff:x,midBandSamples:h}}:{anomalies:p.map(g=>{const j=Math.max(...g.values),b=g.values.reduce((k,L)=>k+L,0)/g.values.length;return{startTs:g.startTs,endTs:g.endTs,peakValue:j,avgValue:b,severity:_s(b,l,x),sampleCount:g.values.length}}),thresholds:i,totalSamples:t.length,anomalySamples:h,debug:{baselineCutoff:l,spikeCutoff:x,midBandSamples:h}}}function _s(t,n,s){const a=s-n;if(a===0)return"moderate";const i=(t-n)/a;return i>.66?"critical":i>.33?"severe":"moderate"}const Rs=Object.entries(yt).map(([t,n])=>{const s=parseInt(t,10);return{typeNum:s,key:`TYPE_${s}`,label:n}});function st({sortedTypes:t,highlightedType:n,onTypeHover:s,aggregateShares:a,hoverData:i}){const r=c.useMemo(()=>{if(!i)return null;const o=new Map;for(const p of i.items)o.set(p.key,p.value);return o},[i]),l=r!==null,x=c.useMemo(()=>{const o=new Set(t.map(h=>h.key)),p=t.map(h=>({typeNum:h.typeNum,key:h.key,label:h.label})),d=Rs.filter(h=>!o.has(h.key));return[...p,...d]},[t]);return e.jsxs("div",{className:"flex-shrink-0 pt-2 sm:pt-3 mt-1 sm:mt-2 px-0 sm:pr-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mx-0 sm:ml-9 sm:mr-0 mb-1 sm:mb-1.5 type-data-xs",children:[e.jsx("span",{className:"text-fg-muted",children:"Packet Types"}),l&&(i==null?void 0:i.timeLabel)&&e.jsx("span",{className:"text-sys-indigo tabular-nums",children:i.timeLabel})]}),e.jsx("div",{className:"flex flex-wrap gap-x-3 sm:gap-x-4 gap-y-1 type-data-xs mx-0 sm:ml-9 sm:mr-0",onMouseLeave:()=>s(null),children:x.map(o=>{const p=Ce(o.typeNum),d=(r==null?void 0:r.get(o.key))??0,h=a.get(o.key)??0,w=l?d:h,g=w>1e-4,j=a.has(o.key),b=n===o.key,k=n&&!b||l&&d<=1e-4||!l&&!n&&!j;return e.jsxs("div",{className:nt("flex items-center gap-1.5 transition-opacity cursor-pointer hover:opacity-80",k&&"opacity-30"),onMouseEnter:()=>s(o.key),children:[e.jsx("div",{className:"shrink-0 w-3 h-3 rounded-xs",style:{backgroundColor:p}}),e.jsx("span",{className:"text-fg-secondary whitespace-nowrap",children:o.label}),g&&e.jsxs("span",{className:nt("tabular-nums",l?"text-fg-primary":"text-fg-muted"),children:[(w*100).toFixed(1),"%"]})]},o.key)})})]})}const lt='ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace',Ls=2,Ds=3,Es=32,Ts=20,Is=80;function ct(t,n,s,a,i){const r=t.reduce((p,d)=>p+d,0);if(r<=0||t.length===0)return[];const l=t.map((p,d)=>d).sort((p,d)=>t[d]-t[p]),x=l.map(p=>t[p]),o=new Array(t.length);return Qe(x,l,r,n,s,a,i,o),o}function Qe(t,n,s,a,i,r,l,x){if(t.length===0)return;if(t.length===1){x[n[0]]={x:a,y:i,w:r,h:l,index:n[0]};return}const o=r*l/s,p=r>=l,d=p?l:r;let h=0,w=1/0,g=0;for(let z=0;z<t.length;z++){const H=h+t[z],V=H*o/d;if(V<=0){g=z+1,h=H;continue}const O=t[0]*o/V,N=t[z]*o/V,m=Math.max(O>V?O/V:V/O,N>V?N/V:V/N);if(m<=w)w=m,g=z+1,h=H;else break}const j=d>0?h*o/d:0;let b=0;for(let z=0;z<g;z++){const V=(h>0?t[z]/h:0)*d;p?x[n[z]]={x:a,y:i+b,w:j,h:V,index:n[z]}:x[n[z]]={x:a+b,y:i,w:V,h:j,index:n[z]},b+=V}const k=t.slice(g),L=n.slice(g),P=s-h;p?Qe(k,L,P,a+j,i,r-j,l,x):Qe(k,L,P,a,i+j,r,l-j,x)}function mt(t,n,s,a,i,r){for(const l of n){const x=s[l.index];if(!x)continue;const o=Ls*r,p=l.x*r+o/2,d=l.y*r+o/2,h=l.w*r-o,w=l.h*r-o;if(h<=0||w<=0)continue;const g=Ce(x.typeNum),j=i!==null&&i!==l.index;t.save(),t.globalAlpha=j?.4:1;const b=Ds*r;t.beginPath(),t.moveTo(p+b,d),t.lineTo(p+h-b,d),t.quadraticCurveTo(p+h,d,p+h,d+b),t.lineTo(p+h,d+w-b),t.quadraticCurveTo(p+h,d+w,p+h-b,d+w),t.lineTo(p+b,d+w),t.quadraticCurveTo(p,d+w,p,d+w-b),t.lineTo(p,d+b),t.quadraticCurveTo(p,d,p+b,d),t.closePath(),t.fillStyle=g,t.fill(),t.strokeStyle="rgba(0,0,0,0.2)",t.lineWidth=1*r,t.stroke();const k=4*r,L=l.w>36&&l.h>20,P=l.w>36&&l.h>32;if(L){const z=11*r;if(P){const H=a>0?x.size/a*100:0;t.font=`500 ${8*r}px ${lt}`,t.fillStyle="rgba(0,0,0,0.6)",t.textBaseline="alphabetic",t.textAlign="left",t.fillText(`${H.toFixed(1)}%`,p+k,d+w-k-z)}t.font=`600 ${9*r}px ${lt}`,t.fillStyle="rgba(0,0,0,0.85)",t.textBaseline="alphabetic",t.textAlign="left",t.fillText(x.name,p+k,d+w-k)}t.restore()}}function Ps(t,n,s){for(const a of t)if(n>=a.x&&n<=a.x+a.w&&s>=a.y&&s<=a.y+a.h)return a.index;return null}function Os({data:t,total:n,color:s,position:a,containerWidth:i,isAirtime:r}){if(!t||!a)return null;const l=(t.value/n*100).toFixed(1),x=160,d=i-a.x<x+24?Math.max(8,a.x-x-8):a.x+16;return e.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:d,top:Math.max(8,a.y-60)},children:e.jsxs("div",{className:"bg-tooltip-bg border border-edge-subtle rounded-lg px-3 py-2 shadow-xl min-w-[140px]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-sm flex-shrink-0",style:{backgroundColor:s}}),e.jsx("span",{className:"type-data-sm font-semibold text-fg-primary",children:t.name})]}),e.jsxs("div",{className:"space-y-0.5 type-data-xs text-fg-muted",children:[e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{children:r?"Airtime":"Count"}),e.jsx("span",{className:"text-fg-primary tabular-nums font-medium",children:r?dt(t.value):t.value.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{children:"Share"}),e.jsxs("span",{className:"text-fg-primary tabular-nums font-medium",children:[l,"%"]})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-fg-primary tabular-nums font-medium",children:r?dt(n):n.toLocaleString()})]})]})]})})}function dt(t){return t>=6e4?`${(t/6e4).toFixed(1)}m`:t>=1e3?`${(t/1e3).toFixed(1)}s`:`${Math.round(t)}ms`}function Fs({sortedTypes:t,aggregateShares:n,mode:s="share"}){var O,N,m;const[a,i]=c.useState(null),[r,l]=c.useState(null),[x,o]=c.useState(0),[p,d]=c.useState(null),h=c.useRef(null),w=c.useRef(null),g=c.useRef([]),j=s==="airtime",b=c.useMemo(()=>t.reduce((f,v)=>f+(j?v.totalAirtime:v.totalCount),0),[t,j]),k=c.useMemo(()=>t.map((f,v)=>({name:f.label,size:j?f.totalAirtime:f.totalCount,index:v,typeNum:f.typeNum,key:f.key})),[t,j]);c.useEffect(()=>{const f=w.current;if(!f)return;const v=f.parentElement;if(!v)return;const T=v.getBoundingClientRect(),B=T.width,R=T.height;if(B<=0||R<=0)return;const W=window.devicePixelRatio||1;f.width=Math.floor(B*W),f.height=Math.floor(R*W),f.style.width=`${B}px`,f.style.height=`${R}px`;const q=k.map(U=>U.size),te=ct(q,0,0,B,R);g.current=te;const J=f.getContext("2d");J&&(J.clearRect(0,0,f.width,f.height),mt(J,te,k,b,a,W))},[k,b,a]),c.useEffect(()=>{const f=h.current;if(!f)return;const v=new ResizeObserver(()=>{const T=w.current;if(!T)return;const B=f.getBoundingClientRect(),R=B.width,W=B.height;if(R<=0||W<=0)return;const q=window.devicePixelRatio||1;T.width=Math.floor(R*q),T.height=Math.floor(W*q),T.style.width=`${R}px`,T.style.height=`${W}px`;const te=k.map(D=>D.size),J=ct(te,0,0,R,W);g.current=J;const U=T.getContext("2d");U&&(U.clearRect(0,0,T.width,T.height),mt(U,J,k,b,a,q))});return v.observe(f),()=>v.disconnect()},[k,b]);const L=c.useCallback(f=>{const v=h.current;if(!v)return;const T=v.getBoundingClientRect(),B=f.clientX-T.left,R=f.clientY-T.top,W=Ps(g.current,B,R);i(W),W!==null?(o(T.width),l({x:B,y:R})):l(null)},[]),P=c.useCallback(()=>{i(null),l(null)},[]),z=c.useCallback(f=>{if(d(f),f){const v=k.findIndex(T=>T.key===f);i(v>=0?v:null)}else i(null)},[k]),H=a!==null?{name:((O=k[a])==null?void 0:O.name)??"",value:((N=k[a])==null?void 0:N.size)??0}:null,V=a!==null?Ce((m=k[a])==null?void 0:m.typeNum):"";return t.length===0||b===0?e.jsxs("div",{className:"h-full flex items-center justify-center text-fg-muted",children:[e.jsx(Se,{className:"w-6 h-6 mr-2 opacity-50"}),e.jsx("span",{children:"No packet type data available"})]}):e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"flex-1 min-h-0 relative",children:e.jsxs("div",{className:"absolute overflow-hidden radius-inner ring-1 ring-inset ring-edge-subtle bg-chart-inner",style:{left:Es,right:0,top:0,bottom:Ts},ref:h,onMouseMove:L,onMouseLeave:P,children:[e.jsx("canvas",{ref:w,className:"absolute inset-0",style:{cursor:"default"}}),e.jsx(Os,{data:H,total:b,color:V,position:r,containerWidth:x,isAirtime:j})]})}),e.jsx("div",{style:{minHeight:Is},children:e.jsx(st,{sortedTypes:t,highlightedType:p,onTypeHover:z,aggregateShares:n})})]})}const We=32,Ue=20,Hs=300;function be(t){return t>=1e9?`${(t/1e9).toFixed(1)} Gb`:t>=1e6?`${(t/1e6).toFixed(1)} Mb`:t>=1e3?`${(t/1e3).toFixed(1)} Kb`:`${t.toFixed(0)} B`}function Bs({packets:t,mode:n,startTs:s,endTs:a,radioConfig:i,bucketCount:r,lockedYMax:l,legendMinH:x}){const o=c.useMemo(()=>bt(),[]),p=o.blue,d=o.red,h=o.yellow,[w,g]=c.useState(null),{trendData:j,totals:b}=c.useMemo(()=>{if(t.length===0)return{trendData:[],totals:{rxBytes:0,txBytes:0,rxAirtime:0,txAirtime:0}};const N=a-s,m=Math.min(Math.ceil(N/Hs),r),f=N/m,v=[];let T=0,B=0,R=0,W=0;for(const $ of t){const y=$.timestamp;if(y<s||y>=a)continue;const S=Je($),A=ve($,{spreadingFactor:i.sf,bandwidthHz:i.bw,codingRate:i.cr,preambleLength:i.preamble}),I={timestamp:y,rxAirtime:0,txAirtime:0,rxBytes:0,txBytes:0};$.transmitted?(I.txAirtime=A,I.txBytes=S,B+=S,W+=A):(I.rxAirtime=A,I.rxBytes=S,T+=S,R+=A),v.push(I)}v.sort(($,y)=>$.timestamp-y.timestamp);const q=new Float64Array(v.length+1),te=new Float64Array(v.length+1),J=new Float64Array(v.length+1),U=new Float64Array(v.length+1),D=new Float64Array(v.length);for(let $=0;$<v.length;$++)q[$+1]=q[$]+v[$].rxAirtime,te[$+1]=te[$]+v[$].txAirtime,J[$+1]=J[$]+v[$].rxBytes,U[$+1]=U[$]+v[$].txBytes,D[$]=v[$].timestamp;const Y=$=>{let y=0,S=D.length;for(;y<S;){const A=y+S>>>1;D[A]<$?y=A+1:S=A}return y},se=[],re=f*1e3;for(let $=0;$<m;$++){const y=s+$*f,S=y+f,A=Y(y),I=Y(S);if(n==="share"){const Q=J[I]-J[A],ue=U[I]-U[A];se.push({timestamp:y,rx:Q>0?Q:null,tx:ue>0?ue:null})}else{const Q=q[I]-q[A],ue=te[I]-te[A],pe=Q/re*100,fe=ue/re*100;se.push({timestamp:y,rx:pe>0?pe:null,tx:fe>0?fe:null})}}const ae=2/31;let ne=null;return{trendData:se.map($=>{const y=$.rx;return y!==null&&y>0&&(ne===null?ne=y:ne=ae*y+(1-ae)*ne),{...$,rxSmooth:ne!==null&&ne>0?ne:null}}),totals:{rxBytes:T,txBytes:B,rxAirtime:R,txAirtime:W}}},[t,s,a,r,n,i]),k=c.useMemo(()=>{if(j.length===0)return n==="share"?100:10;let N=0;for(const f of j){const v=f.rx??0,T=f.tx??0;v>N&&(N=v),T>N&&(N=T)}const m=N*1.1;return n==="share"?m<=100?100:m<=500?Math.ceil(m/100)*100:m<=1e3?Math.ceil(m/200)*200:m<=5e3?Math.ceil(m/500)*500:m<=1e4?Math.ceil(m/1e3)*1e3:Math.ceil(m/5e3)*5e3:Math.max(1,Math.ceil(m))},[j,n]),L=l??k,P=c.useMemo(()=>{if(w!==null&&j[w]){const N=j[w],m=N.rx??0,f=N.tx??0;return n==="share"?{rx:be(m),tx:be(f),total:be(m+f),isHovered:!0}:{rx:`${m.toFixed(2)}%`,tx:`${f.toFixed(2)}%`,total:`${(m+f).toFixed(2)}%`,isHovered:!0}}if(n==="share")return{rx:be(b.rxBytes),tx:be(b.txBytes),total:be(b.rxBytes+b.txBytes),isHovered:!1};{let N=0,m=0,f=0;for(const B of j)(B.rx!==null||B.tx!==null)&&(N+=B.rx??0,m+=B.tx??0,f++);const v=f>0?N/f:0,T=f>0?m/f:0;return{rx:`${v.toFixed(2)}%`,tx:`${T.toFixed(2)}%`,total:`${(v+T).toFixed(2)}%`,isHovered:!1}}},[w,j,b,n]),z=c.useMemo(()=>{const N=a-s,m=N/3600;return[0,.25,.5,.75,1].map(v=>{const T=s+N*v,B=new Date(T*1e3),R=B.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),W=B.toLocaleDateString([],{weekday:"short"}),q=v===.25||v===.75;return{pct:v,label:m>=24?`${W} ${R}`:R,mobileHidden:q}})},[s,a]),H=c.useCallback(N=>{g(N)},[]);if(j.length===0)return e.jsxs("div",{className:"h-full flex items-center justify-center text-fg-muted",children:[e.jsx(Se,{className:"w-6 h-6 mr-2 opacity-50"}),e.jsx("span",{children:"No packet data available"})]});const V=c.useMemo(()=>n==="airtime"?L<=5?1:L<=10?2:L<=20?5:Math.ceil(L/5):L<=100?25:L<=500?100:L<=1e3?200:L<=5e3?1e3:L<=1e4?2e3:Math.ceil(L/5e3)*1e3,[L,n]),O=c.useMemo(()=>{const N=[];for(let m=0;m<=L;m+=V){const f=(1-m/L)*100;let v;n==="airtime"?v=`${m}%`:m>=1e6?v=`${(m/1e6).toFixed(1)}M`:m>=1e3?v=`${(m/1e3).toFixed(0)}K`:v=`${m}`,N.push({pos:f,label:v})}return N},[L,V,n]);return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex-1 min-h-0 relative",children:[e.jsx("div",{className:"absolute top-0 left-0 flex flex-col justify-between",style:{width:We,bottom:Ue},children:O.map((N,m)=>e.jsx("span",{className:"type-data-xs text-fg-secondary text-right pr-1.5",style:{position:"absolute",top:`${N.pos}%`,transform:m===0?"translateY(-100%)":m===O.length-1?"none":"translateY(-50%)",right:0},children:N.label},m))}),e.jsx("div",{className:"absolute overflow-hidden radius-inner ring-1 ring-inset ring-edge-subtle bg-chart-inner",style:{left:We,right:0,top:0,bottom:Ue},children:e.jsx(At,{data:j,yAxisMode:n==="share"?"share":"airtime",yMax:L,onHover:H,startTs:s,endTs:a,externalAxes:!0})}),e.jsx("div",{className:"absolute left-0 right-0 bottom-0 flex items-center pointer-events-none",style:{left:We,height:Ue,paddingTop:4},children:z.map((N,m)=>e.jsx("span",{className:`absolute type-data-xs text-fg-muted/60 tabular-nums ${N.mobileHidden?"hidden sm:inline":""}`,style:{left:`${N.pct*100}%`,transform:N.pct===0?"translateX(0)":N.pct===1?"translateX(-100%)":"translateX(-50%)"},children:N.label},m))})]}),e.jsxs("div",{className:"flex items-end justify-between pb-1",style:{minHeight:x},children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-5 type-data-sm pl-2 sm:pl-11",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-4 sm:w-5 h-[2px] rounded-full",style:{backgroundColor:p}}),e.jsx("span",{className:"text-fg-secondary",children:"RX"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-4 sm:w-5 h-[2px] rounded-full",style:{backgroundColor:d}}),e.jsx("span",{className:"text-fg-secondary",children:"TX"})]}),e.jsxs("div",{className:"hidden sm:flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-[2px] rounded-full",style:{backgroundColor:h}}),e.jsx("span",{className:"text-fg-secondary",children:"Avg"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 sm:gap-8",children:[e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("div",{className:"type-data-xl text-fg-primary",children:P.rx}),e.jsx(Fe,{color:"zinc",className:"mb-0.5 sm:mb-1",children:"RX"})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("div",{className:"type-data-xl text-fg-primary",children:P.tx}),e.jsx(Fe,{color:"zinc",className:"mb-0.5 sm:mb-1",children:"TX"})]})]})]})]})}const ut=_t;class $s{constructor(){xe(this,"worker",null);xe(this,"listeners",new Set);xe(this,"currentResult",null);xe(this,"isComputing",!1);xe(this,"debounceTimer",null);xe(this,"debounceMs",250);xe(this,"lastCacheKey",null)}ensureWorker(){if(this.worker)return this.worker;if(typeof window>"u")return null;try{this.worker=new Worker(new URL("/assets/bucketing.worker-D2Fn452R.js",import.meta.url),{type:"module"}),this.worker.onmessage=n=>{this.handleWorkerMessage(n.data)},this.worker.onerror=n=>{console.error("[BucketingService] Worker error:",n),this.isComputing=!1,this.notifyListeners()}}catch(n){console.error("[BucketingService] Failed to initialize worker:",n)}return this.worker}handleWorkerMessage(n){if(this.isComputing=!1,n.type==="error"){this.currentResult=null,this.notifyListeners();return}const s=n.payload;this.currentResult={points:s.points,rawValues:s.rawValues,packetTypes:s.packetTypes,timestamps:s.timestamps,count:s.count,minTime:s.minTime,maxTime:s.maxTime,minValue:s.minValue,maxValue:s.maxValue,rawMinValue:s.rawMinValue,rawMaxValue:s.rawMaxValue,unit:"%",stats:{p5:s.p5,p50:s.p50,p95:s.p95,uniqueValues:s.uniqueValues,topValues:s.topValues}},this.notifyListeners()}notifyListeners(){for(const n of this.listeners)try{n(this.currentResult,this.isComputing)}catch(s){console.error("[BucketingService] Listener error:",s)}}isCacheHit(n){return!this.lastCacheKey||!this.currentResult?!1:this.lastCacheKey.startTs===n.startTs&&this.lastCacheKey.endTs===n.endTs&&this.lastCacheKey.mode===n.mode&&this.lastCacheKey.packetCount===n.packetCount}compute(n,s,a,i,r){if(n.length===0||!r){this.currentResult=null,this.notifyListeners();return}const l={startTs:s,endTs:a,mode:i,packetCount:n.length};this.isCacheHit(l)||(this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.debounceTimer=null,this.computeInternal(n,s,a,i,r,l)},this.debounceMs))}computeInternal(n,s,a,i,r,l){const x=this.ensureWorker();if(!x)return;const o=n.length,p=new Float64Array(o),d=new Float64Array(o),h=new Uint16Array(o),w=new Uint8Array(o),g={spreadingFactor:r.sf,bandwidthHz:r.bw,codingRate:r.cr,preambleLength:r.preamble};for(let b=0;b<o;b++){const k=n[b];p[b]=k.timestamp??0,w[b]=(k.type??k.payload_type??255)&255,h[b]=Math.min(Je(k),65535),i==="airtime"?d[b]=ve(k,g):d[b]=1}this.isComputing=!0,this.lastCacheKey=l,this.notifyListeners();const j={type:"compute",payload:{timestamps:p,airtimeMs:d,byteSizes:h,packetTypes:w,startTs:s,endTs:a,mode:i}};x.postMessage(j,[p.buffer,d.buffer,h.buffer,w.buffer])}getResult(){return this.currentResult}isWorking(){return this.isComputing}subscribe(n){return this.listeners.add(n),n(this.currentResult,this.isComputing),()=>{this.listeners.delete(n)}}clear(){this.currentResult=null,this.lastCacheKey=null,this.notifyListeners()}terminate(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.worker&&(this.worker.terminate(),this.worker=null),this.listeners.clear()}}const Ge=new $s;function zs(t,n,s,a,i){const[r,l]=c.useState(()=>Ge.getResult());return c.useEffect(()=>Ge.subscribe(x=>{l(x)}),[]),c.useEffect(()=>{Ge.compute(t,n,s,a,i)},[t,n,s,a,i]),r}function Ws({mode:t,packets:n,startTs:s,endTs:a,radioConfig:i,sortedTypes:r,aggregateShares:l,noiseFloorAnomalies:x,showNoiseFloorOverlay:o,overlayOpacity:p=.5,startLabel:d,endLabel:h,lockedYMax:w,legendMinH:g,dotSize:j,dotOpacity:b}){const[k,L]=c.useState(null),[P,z]=c.useState(null),H=c.useMemo(()=>(a-s)/3600,[s,a]),V=c.useCallback(U=>{z(U)},[]),N=zs(n,s,a,t==="share"?"share":"airtime",i),[m,f]=c.useState(null),v=c.useCallback((U,D)=>{L(U),f(D??null)},[]),T=c.useMemo(()=>{if(m===null||!N||N.count===0)return null;const U=s+m*(a-s);let D;H>=168?D=75:H>=72?D=35:H>=24?D=15:H>=3?D=10:D=5;const Y=D*60/2;return{start:U-Y,end:U+Y}},[m,N,s,a,H]),B=c.useMemo(()=>T?new Date((T.start+T.end)/2*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}):null,[T]),R=c.useMemo(()=>{if(k===null||!T)return null;const U=B??"",{start:D,end:Y}=T,se=n.filter(y=>y.timestamp>=D&&y.timestamp<Y);if(se.length===0)return{timestamp:(D+Y)/2,timeLabel:U,items:r.map(y=>({key:y.key,label:y.label,value:0,color:ut(y.typeNum)}))};const re=new Map,ae=new Map;let ne=0,ce=0;for(const y of se){const A=`TYPE_${y.type??y.payload_type??-1}`;if(re.set(A,(re.get(A)??0)+1),ne++,i){const I=ve(y,{spreadingFactor:i.sf,bandwidthHz:i.bw,codingRate:i.cr,preambleLength:i.preamble});ae.set(A,(ae.get(A)??0)+I),ce+=I}}const $=r.map(y=>{let S;return t==="airtime"?S=ce>0?(ae.get(y.key)??0)/ce:0:S=ne>0?(re.get(y.key)??0)/ne:0,{key:y.key,label:y.label,value:S,color:ut(y.typeNum)}});return{timestamp:(D+Y)/2,timeLabel:U,items:$}},[k,T,B,n,r,t,i]),W=t==="share",q=w??(N==null?void 0:N.maxValue)??(W?200:10),te=c.useMemo(()=>{if(!W)return 5;const U=[10,20,25,50,100,200,250,500,1e3],D=q/4.5;for(const Y of U)if(Y>=D)return Y;return q>5e3?Math.ceil(D/1e3)*1e3:Math.ceil(D/100)*100},[q,W]),J=c.useMemo(()=>{const U=[];for(let D=0;D<=q;D+=te){const Y=(1-D/q)*100;U.push({pos:Y,label:W?`${D}B`:`${D}%`})}return U},[q,te,W]);return!N||N.count===0?e.jsxs("div",{className:"h-full flex items-center justify-center text-fg-muted",children:[e.jsx(Se,{className:"w-6 h-6 mr-2 opacity-50"}),e.jsx("span",{children:"No packet data available"})]}):e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex-1 min-h-0 relative",children:[e.jsx("div",{className:"absolute top-0 left-0 flex flex-col justify-between",style:{width:32,bottom:20},children:J.map((U,D)=>e.jsx("span",{className:"type-data-xs text-fg-secondary text-right pr-1.5",style:{position:"absolute",top:`${U.pos}%`,transform:D===0?"translateY(-100%)":D===J.length-1?"none":"translateY(-50%)",right:0},children:U.label},D))}),e.jsxs("div",{className:"absolute overflow-hidden radius-inner ring-1 ring-inset ring-edge-subtle bg-chart-inner",style:{left:32,right:0,top:0,bottom:20},children:[e.jsx(Rt,{scatterData:N,yAxisMode:t==="share"?"share":"airtime",onHover:v,noiseFloorAnomalies:x,showNoiseFloorOverlay:o,overlayOpacity:p,highlightedType:P,timeRangeHours:H,yAxisMaxOverride:w,dotSize:j,dotOpacity:b,startTs:s,endTs:a,externalAxes:!0}),B&&e.jsx("div",{className:"absolute top-1 right-1 px-2 py-0.5 bg-elevated/90 rounded type-data-xs text-sys-indigo pointer-events-none z-10",children:B})]}),d&&h&&e.jsxs("div",{className:"absolute left-0 right-0 bottom-0 flex justify-between pointer-events-none type-data-xs text-fg-muted/60",style:{left:32,height:20,paddingTop:4},children:[e.jsx("span",{children:d}),e.jsx("span",{children:h})]})]}),e.jsx("div",{style:{minHeight:g},children:e.jsx(st,{sortedTypes:r,highlightedType:P,onTypeHover:V,aggregateShares:l,hoverData:R})})]})}function Us({mode:t,onChange:n}){return e.jsxs("div",{className:"toggle-group toggle-group-sm",children:[e.jsx("button",{onClick:()=>n("share"),className:`toggle-group-item ${t==="share"?"active":""}`,children:"Total"}),e.jsx("button",{onClick:()=>n("airtime"),className:`toggle-group-item ${t==="airtime"?"active":""}`,children:"Airtime"})]})}function Gs({smoothing:t,onChange:n}){return e.jsxs("div",{className:"toggle-group toggle-group-sm",children:[e.jsx("button",{onClick:()=>n("stats"),className:`toggle-group-item ${t==="stats"?"active":""}`,title:"Statistics view (scatter plot)",children:e.jsx(ws,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>n("trend"),className:`toggle-group-item ${t==="trend"?"active":""}`,title:"Trend line chart",children:e.jsx(js,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>n("ema"),className:`toggle-group-item ${t==="ema"?"active":""}`,title:"Stacked area (moderate smoothing)",children:e.jsx(Se,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>n("ultra"),className:`toggle-group-item ${t==="ultra"?"active":""}`,title:"Stacked area (heavy smoothing)",children:e.jsx(Cs,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>n("mosaic"),className:`toggle-group-item ${t==="mosaic"?"active":""}`,title:"Mosaic view (treemap)",children:e.jsx(Ss,{className:"w-3.5 h-3.5"})})]})}function qs({enabled:t,onChange:n,anomalyCount:s=0,showTuning:a=!1,onTuningChange:i}){return e.jsxs("div",{className:"relative inline-flex items-center gap-1",children:[t&&i&&e.jsx("button",{onClick:()=>i(!a),className:`toggle-group toggle-group-sm ${a?"active":""}`,title:a?"Hide tuning panel":"Show tuning panel",children:e.jsx("span",{className:`toggle-group-item ${a?"active":""}`,children:e.jsx(gs,{className:"w-3.5 h-3.5"})})}),e.jsx("button",{onClick:()=>n(!t),className:`toggle-group toggle-group-sm ${t?"active":""}`,title:t?"Hide noise floor anomalies":"Show noise floor anomalies",children:e.jsx("span",{className:`toggle-group-item ${t?"active":""}`,children:e.jsx(cs,{className:"w-3.5 h-3.5"})})}),s>0&&e.jsx("span",{className:"absolute -top-2 -right-2 min-w-[18px] h-[18px] px-1 rounded-full bg-sys-red text-white text-xs font-bold flex items-center justify-center pointer-events-none z-10",children:s>99?"99+":s})]})}const Nt=[{target:"PacketAnalyzer",fn:"type",minStage:1},{target:"PacketAnalyzer",fn:"airtime",minStage:1,when:ss}];tt(Nt);const ht=360,Vs=500,Ks={sf:10,bw:25e4,cr:5,preamble:8},qe=32;function xt(t,n){const s=new Date(t*1e3),a=l=>l.toString().padStart(2,"0"),i=`${a(s.getHours())}:${a(s.getMinutes())}`;return n<24?i:`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][s.getMonth()]} ${s.getDate()} ${i}`}function Ys(t){return yt[t]??`TYPE_${t.toString(16).toUpperCase()}`}function Xs(t,n){const s=new Map;for(const i of t){const r=i.type??i.payload_type??-1,l=ve(i,{spreadingFactor:n.sf,bandwidthHz:n.bw,codingRate:n.cr,preambleLength:n.preamble}),x=s.get(r)??{count:0,airtime:0};s.set(r,{count:x.count+1,airtime:x.airtime+l})}const a=[];for(const[i,r]of s)a.push({typeNum:i,key:`TYPE_${i}`,label:Ys(i),totalCount:r.count,totalAirtime:r.airtime});return a.sort((i,r)=>r.totalCount-i.totalCount)}function Zs(t,n,s,a,i,r,l=0){const x=s-n,o=x/a,p=o*1e3,d=x/3600,h=n-l*o,w=s+l*o,g=a+2*l,j=[];for(let b=0;b<g;b++){const k=h+b*o,L=new Date(k*1e3),P=d>=24?L.toLocaleDateString([],{weekday:"short",hour:"2-digit",minute:"2-digit",hour12:!1}):L.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),z={timestamp:k,time:P,counts:{},shares:{},airtimes:{},total:0,totalAirtime:0,bucketDurationMs:p};for(const H of r)z.counts[H.key]=0,z.airtimes[H.key]=0;j.push(z)}for(const b of t){const k=b.timestamp;if(k<h||k>=w)continue;const L=Math.min(Math.floor((k-h)/o),g-1),P=`TYPE_${b.type??b.payload_type??-1}`;j[L].counts[P]=(j[L].counts[P]??0)+1,j[L].total++;const z=ve(b,{spreadingFactor:i.sf,bandwidthHz:i.bw,codingRate:i.cr,preambleLength:i.preamble});j[L].airtimes[P]=(j[L].airtimes[P]??0)+z,j[L].totalAirtime+=z}for(const b of j)for(const k of r)b.shares[k.key]=b.total>0?b.counts[k.key]/b.total*100:0;return{buckets:j,visibleStart:l,visibleEnd:l+a}}function Qs(t,n){const s=t.length;if(s===0)return[];if(n<.5)return[...t];const a=Math.sqrt(12*n*n/3+1);let i=Math.floor(a);i%2===0&&i--;const r=i+2,l=(12*n*n-3*i*i-12*i-9)/(-4*i-4),x=Math.round(l),o=[x>0?i:r,x>1?i:r,x>2?i:r];let p=new Float32Array(t);const d=new Float32Array(s);for(const h of o){const w=(h-1)/2;Js(p,d,s,w);const g=p;p=d,d.set(g)}return Array.from(p)}function Js(t,n,s,a){const i=a*2+1;let r=0;for(let l=0;l<=a;l++)r+=t[Math.min(l,s-1)];for(let l=0;l<a;l++)r+=t[0];for(let l=0;l<s;l++){n[l]=r/i;const x=l-a,o=l+a+1;r-=t[Math.max(0,Math.min(x,s-1))],r+=t[Math.max(0,Math.min(o,s-1))]}}function en(t,n){if(t.length===0)return[];if(n<=1)return[...t];const s=t.length,a=new Float32Array(s),i=Math.floor(n/2);let r=0,l=0;for(let x=0;x<=Math.min(i,s-1);x++)r+=t[x],l++;for(let x=0;x<s;x++){a[x]=r/l;const o=x-i,p=x+i+1;o>=0&&(r-=t[o],l--),p<s&&(r+=t[p],l++)}return Array.from(a)}const tn={ema:1800,ultra:14400},sn={ema:"sma",ultra:"gaussian"};function vt(t,n,s){const a=tn[t],i=sn[t]??"sma";if(!a)return{sigma:0,window:1,handleSize:0};let r=Math.round(a/n);r=Math.max(3,Math.min(r,Math.floor(s/3))),r%2===0&&(r+=1);const l=Math.ceil(i==="gaussian"?r*Math.sqrt(4/12)*3:r/2);return i==="gaussian"?{sigma:r*Math.sqrt(.3333333333333333),window:r,handleSize:l}:{sigma:0,window:r,handleSize:l}}function nn(t,n,s,a="ultra",i,r,l){var V;const{buckets:x,visibleStart:o,visibleEnd:p}=t,d=x.length,h=s.length,w=p-o;if(d===0||h===0)return[];const g=l&&i!==void 0&&r!==void 0?(r-i)/l:(V=x[0])!=null&&V.bucketDurationMs?x[0].bucketDurationMs/1e3:240,j=Array.from({length:h},()=>new Array(d).fill(0));for(let O=0;O<d;O++){const N=x[O];if(n==="share"){if(N.total>0)for(let m=0;m<h;m++)j[m][O]=(N.counts[s[m].key]??0)/N.total}else{let m=0;for(let f=0;f<h;f++)m+=N.airtimes[s[f].key]??0;if(m>0)for(let f=0;f<h;f++)j[f][O]=(N.airtimes[s[f].key]??0)/m}}const{sigma:b,window:k}=vt(a,g,w);let L;b>0?L=j.map(O=>Qs(O,b)):L=j.map(O=>en(O,k));for(let O=0;O<d;O++){let N=0;for(let m=0;m<h;m++)L[m][O]=Math.max(0,L[m][O]),N+=L[m][O];if(N>0){const m=1/N;for(let f=0;f<h;f++)L[f][O]*=m}}const P=w>ht?Math.ceil(w/ht):1,z=Math.ceil(w/P),H=[];for(let O=0;O<z;O++){const N=o+O*P,m=Math.min(o+(O+1)*P,p),f=m-N,v=new Array(h).fill(0);for(let R=N;R<m;R++)for(let W=0;W<h;W++)v[W]+=L[W][R];for(let R=0;R<h;R++)v[R]/=f;let T=0;for(let R=0;R<h;R++)T+=v[R];if(T>0){const R=1/T;for(let W=0;W<h;W++)v[W]*=R}const B={timestamp:x[N].timestamp,time:x[N].time};for(let R=0;R<h;R++)B[s[R].key]=v[R];H.push(B)}return H}const Ve=80;function an(t,n,s,a,i){const x=Math.max(1,Math.ceil((s-n)/300));if(a==="airtime"){const o=new Float64Array(x);for(const d of t){const h=d.timestamp;if(h<n||h>=s)continue;const w=Math.min(Math.floor((h-n)/300),x-1);o[w]+=ve(d,{spreadingFactor:i.sf,bandwidthHz:i.bw,codingRate:i.cr,preambleLength:i.preamble})}let p=0;for(let d=0;d<x;d++){const h=o[d]/3e5*100;h>p&&(p=h)}return Math.max(1,Math.ceil(p*1.1))}else{let o=0;for(const p of t){const d=p.timestamp;if(d<n||d>=s)continue;const h=Je(p);h>o&&(o=h)}return o<=200?200:Math.ceil(o*1.1/50)*50}}function rn({packets:t,allPackets:n,startTs:s,endTs:a,parentStartTs:i,parentEndTs:r,bucketCount:l,radioConfig:x=Ks,mode:o="share",smoothing:p="stats",noiseFloorAnomalies:d=null,showNoiseFloorOverlay:h=!1,overlayOpacity:w=.5,dotSize:g,dotOpacity:j}){et(Nt);const b=Lt(),[k,L]=c.useState(null),[P,z]=c.useState(null),[H,V]=c.useState([]),O=c.useRef(null),N=c.useRef(0);c.useEffect(()=>{const y=Math.abs(t.length-N.current);if(y===0&&H.length>0)return;O.current&&clearTimeout(O.current);const S=y>100?50:Vs;return O.current=setTimeout(()=>{N.current=t.length,V(t)},S),()=>{O.current&&clearTimeout(O.current)}},[t,H.length]);const m=c.useMemo(()=>Xs(H,x),[H,x]),f=c.useMemo(()=>{if(p!=="ema"&&p!=="ultra")return 0;const S=(a-s)/l,{handleSize:A}=vt(p,S,l);return A},[p,s,a,l]),v=c.useMemo(()=>Zs(H,s,a,l,x,m,f),[H,s,a,l,x,m,f]),T=c.useMemo(()=>m.reduce((y,S)=>y+S.totalCount,0),[m]),B=c.useMemo(()=>m.reduce((y,S)=>y+S.totalAirtime,0),[m]),{sortedTypes:R,aggregateShares:W}=c.useMemo(()=>{const y=new Map,S=o==="share"?T:B;if(S>0)for(const I of m){const Q=o==="share"?I.totalCount:I.totalAirtime;y.set(I.key,Q/S)}return{sortedTypes:[...m].sort((I,Q)=>(y.get(Q.key)??0)-(y.get(I.key)??0)),aggregateShares:y}},[m,T,B,o]),q=c.useMemo(()=>nn(v,o,R,p,s,a,l),[v,o,R,p,s,a,l]),te=c.useCallback(y=>L(y),[]),J=c.useCallback(y=>z(y),[]),U=c.useCallback(y=>L(y),[]),D=c.useMemo(()=>{if(P===null||!q[P])return null;const y=q[P];return{timestamp:y.timestamp,timeLabel:y.time,items:R.map(S=>({key:S.key,label:S.label,value:y[S.key]??0,color:Ce(S.typeNum)}))}},[P,q,R]),Y=c.useMemo(()=>{const y=q.map(A=>A.timestamp),S=R.map(A=>({key:A.key,label:A.label,color:Ce(A.typeNum),values:q.map(I=>I[A.key]??0)}));return{timestamps:y,series:S}},[q,R]),se=null,re=n&&i!==void 0&&r!==void 0&&(s!==i||a!==r),ae=c.useMemo(()=>{if(!(!re||!n||i===void 0||r===void 0))return an(n,i,r,o,x)},[re,n,i,r,o,x]);if(H.length===0)return t.length===0?e.jsxs("div",{className:"h-full flex items-center justify-center text-fg-muted",children:[e.jsx(Se,{className:"w-6 h-6 mr-2 opacity-50"}),e.jsx("span",{children:"No packet data available"})]}):null;if(p==="mosaic")return e.jsx(Fs,{sortedTypes:R,aggregateShares:W,mode:o});const ne=(a-s)/3600,ce=xt(s,ne),$=xt(a,ne);return p==="stats"?e.jsx(Ws,{mode:o,packets:H,startTs:s,endTs:a,radioConfig:x,sortedTypes:R,aggregateShares:W,noiseFloorAnomalies:d,showNoiseFloorOverlay:h,overlayOpacity:w,startLabel:ce,endLabel:$,lockedYMax:ae,legendMinH:Ve,dotSize:g,dotOpacity:j}):p==="trend"?e.jsx(Bs,{packets:H,mode:o,startTs:s,endTs:a,radioConfig:x,bucketCount:l,lockedYMax:ae,legendMinH:Ve}):e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex-1 min-h-0 relative",children:[e.jsx("div",{className:"absolute top-0 left-0 flex flex-col justify-between",style:{width:qe,bottom:20},children:[0,20,40,60,80,100].map((y,S,A)=>e.jsxs("span",{className:"type-data-xs text-fg-secondary text-right pr-1.5",style:{position:"absolute",top:`${(1-y/100)*100}%`,transform:S===0?"translateY(-100%)":S===A.length-1?"none":"translateY(-50%)",right:0},children:[y,"%"]},y))}),e.jsx("div",{className:"absolute overflow-hidden radius-inner ring-1 ring-inset ring-edge-subtle bg-chart-inner",style:{left:qe,right:0,top:0,bottom:20},children:e.jsx(Dt,{timestamps:Y.timestamps,series:Y.series,highlightedKey:k,cursorColor:b.cursor,onHover:J,onSeriesHover:U,overlayLine:se,startTs:s,endTs:a,externalAxes:!0})}),e.jsxs("div",{className:"absolute left-0 right-0 bottom-0 flex justify-between pointer-events-none type-data-xs text-fg-muted/60",style:{left:qe,height:20,paddingTop:4},children:[e.jsx("span",{children:ce}),e.jsx("span",{children:$})]})]}),e.jsx("div",{style:{minHeight:Ve},children:e.jsx(st,{sortedTypes:R,highlightedType:k,onTypeHover:te,aggregateShares:W,hoverData:D})})]})}const on=c.memo(rn),Ke={ZOOM_DURATION:400,BLINK_DURATION:600},oe={PADDING:6,DOT_RADIUS:5,DOT_RADIUS_HOVERED:7,LOCAL_DOT_RADIUS:5,CARDINAL_FONT_SIZE:10,INTERCARDINAL_FONT_SIZE:9,LABEL_INSET:8,DATA_HEADROOM:1.08},ln={"1x":1,"2x":2,"4x":4,"8x":8,"16x":16,"36x":36},cn=[1,5,10,25,50,100,150],mn=22.5,St=mn*Math.PI/180,pt=Math.sin(St),ft=Math.cos(St);function dn(t,n,s,a){const i=Math.PI/180,r=(a-n)*i,l=t*i,x=s*i,o=Math.sin(r)*Math.cos(x),p=Math.cos(l)*Math.sin(x)-Math.sin(l)*Math.cos(x)*Math.cos(r);return(Math.atan2(o,p)*180/Math.PI+360)%360}function un(t,n,s,a){const r=Math.PI/180,l=(s-t)*r,x=(a-n)*r,o=Math.sin(l/2)**2+Math.cos(t*r)*Math.cos(s*r)*Math.sin(x/2)**2;return 6371*2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))}const hn=[{min:10,label:"Excellent"},{min:7,label:"Very Good"},{min:4,label:"Good"},{min:1,label:"Fair+"},{min:-2,label:"Fair"},{min:-5,label:"Fair-"},{min:-8,label:"Poor"},{min:-11,label:"Bad"},{min:-1/0,label:"Critical"}];function xn(t){var n;return((n=hn.find(s=>t>=s.min))==null?void 0:n.label)??"Critical"}function gt(t,n,s){const a=Ft(t,s);return n[a]||"#808080"}function pn({neighbors:t,quickNeighbors:n,localLat:s,localLon:a,onStatsChange:i,title:r,badge:l,stats:x}){const[o,p]=c.useState(null),[d,h]=c.useState(new Set),[w,g]=c.useState({width:0,height:0}),[j,b]=c.useState("1x"),[k,L]=c.useState(1),P=c.useRef(null),z=c.useRef({}),H=c.useRef(null),V=c.useRef(k);V.current=k;const O=Et(),N=Tt(),m=It(),f=Pt(),v=bt(),T=Ot(),B=f?m.primary:m.secondary,R=f?.15:.4,W=f?.08:.25,q=f?v.blue:m.primary;c.useEffect(()=>{const u=H.current;if(!u)return;const E=new ResizeObserver(_=>{for(const F of _){const{width:X,height:K}=F.contentRect;X>0&&K>0&&g({width:X,height:K})}});E.observe(u);const C=u.getBoundingClientRect();return C.width>0&&C.height>0&&g({width:C.width,height:C.height}),()=>E.disconnect()},[]);const te=c.useMemo(()=>{const u=new Set;if(n)for(const E of n)u.add(E.hash);return u},[n]),J=c.useMemo(()=>{const u=new Map;if(n)for(const E of n)u.set(E.hash,{snr:E.avgSnr,rssi:E.avgRssi});return u},[n]),{processedNeighbors:U,maxDistance:D,totalNeighbors:Y,zeroHopCount:se}=c.useMemo(()=>{const u=[];for(const[_,F]of Object.entries(t)){if(!F.latitude||!F.longitude||F.latitude===0||F.longitude===0||!te.has(_))continue;const K=dn(s,a,F.latitude,F.longitude),ee=un(s,a,F.latitude,F.longitude),Z=J.get(_);u.push({hash:_.slice(0,8),name:F.node_name||F.name||"Unknown",snr:(Z==null?void 0:Z.snr)??F.snr??null,rssi:(Z==null?void 0:Z.rssi)??F.rssi??null,bearing:K,distance:ee,normalizedDistance:0,lastSeen:F.last_seen,isZeroHop:!0})}const C=(u.length>0?Math.max(...u.map(_=>_.distance)):0)*oe.DATA_HEADROOM;return u.sort((_,F)=>(_.snr??-1/0)-(F.snr??-1/0)),{processedNeighbors:u,maxDistance:C,totalNeighbors:u.length,zeroHopCount:u.length}},[t,s,a,te,J]);c.useEffect(()=>{i==null||i({zeroHopCount:se,totalCount:Y,maxDistanceKm:D})},[se,Y,D]),c.useEffect(()=>{const u=ln[j],E=V.current;P.current&&cancelAnimationFrame(P.current);const C=performance.now(),_=F=>{const X=F-C,K=Math.min(X/Ke.ZOOM_DURATION,1),ee=ns(K),Z=E+(u-E)*ee;L(Z),K<1?P.current=requestAnimationFrame(_):P.current=null};return P.current=requestAnimationFrame(_),()=>{P.current&&cancelAnimationFrame(P.current)}},[j]);const re=D/k,ae=c.useMemo(()=>cn.filter(u=>u<=re*1.1),[re]);c.useEffect(()=>{const u=[];for(const C of U){const _=z.current[C.hash];_!==void 0&&_!==C.lastSeen&&u.push(C.hash),z.current[C.hash]=C.lastSeen}if(u.length===0)return;queueMicrotask(()=>{h(C=>new Set([...C,...u]))});const E=setTimeout(()=>{h(C=>{const _=new Set(C);return u.forEach(F=>_.delete(F)),_})},Ke.BLINK_DURATION);return()=>clearTimeout(E)},[U]);const ne=s!==0&&a!==0,ce=c.useMemo(()=>{const{width:u,height:E}=w,C=u/2,_=E/2,F=Math.min(u,E),X=Math.max(10,F/2-oe.PADDING),K=Math.max(10,X-oe.LABEL_INSET);return{width:u,height:E,centerX:C,centerY:_,radius:K,labelRadius:X}},[w]),{width:$,height:y,centerX:S,centerY:A,radius:I,labelRadius:Q}=ce,ue=c.useId(),pe=c.useCallback((u,E)=>{const C=u*Math.PI/180;return{x:S+I*E*Math.sin(C),y:A-I*E*Math.cos(C)}},[S,A,I]),fe=c.useCallback(u=>{const C={N:0,NE:45,E:90,SE:135,S:180,SW:225,W:270,NW:315}[u]*Math.PI/180;return{x:S+Q*Math.sin(C),y:A-Q*Math.cos(C)}},[S,A,Q]),_e=c.useCallback(u=>{p(u)},[]),Re=c.useCallback(u=>{b(u)},[]),Le=c.useCallback(u=>D<=0?0:u/D*k,[D,k]),De=u=>`${u}km`,ke=28,Ee=c.useMemo(()=>{const u=[{x:S,y:A-Q},{x:S+Q*Math.SQRT1_2,y:A-Q*Math.SQRT1_2}],E=ae.map(_=>{const F=_/D*k,X=S+I*F*pt,K=A-I*F*ft;return{km:_,scale:F,lx:X,ly:K}}).filter(_=>_.scale<=1.05&&_.scale>=.02).sort((_,F)=>F.km-_.km),C=[];for(const _ of E){const F=C.some(K=>{const ee=K.lx-_.lx,Z=K.ly-_.ly;return Math.sqrt(ee*ee+Z*Z)<ke}),X=u.some(K=>{const ee=K.x-_.lx,Z=K.y-_.ly;return Math.sqrt(ee*ee+Z*Z)<ke});!F&&!X&&C.push(_)}return C},[ae,D,k,S,A,I,Q]),Te=w.width>0&&w.height>0;return ne?Y===0?e.jsxs("div",{ref:H,className:"flex flex-col items-center justify-center h-full text-fg-secondary",children:[e.jsx(ze,{className:"w-8 h-8 mb-2 opacity-50"}),e.jsx("p",{children:"No nodes with location data"})]}):e.jsxs("div",{className:"flex h-full w-full overflow-visible",children:[e.jsxs("div",{ref:H,className:"relative flex-1 min-w-0 h-full overflow-visible -ml-4 sm:-ml-5",children:[Te&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute depth-raised",style:{left:S-I-oe.LABEL_INSET-4,top:A-I-oe.LABEL_INSET-4,width:(I+oe.LABEL_INSET)*2+8,height:(I+oe.LABEL_INSET)*2+8,borderRadius:"50%",padding:4,boxSizing:"border-box",backgroundColor:f?"var(--zinc-925)":"var(--zinc-75)"}}),e.jsxs("svg",{width:$,height:y,className:"absolute inset-0 z-0",style:{overflow:"visible"},children:[e.jsxs("defs",{children:[e.jsx("style",{children:`
                @keyframes neighbor-blink-scale {
                  0%, 100% {
                    transform: scale(1);
                    opacity: 0;
                  }
                  50% {
                    transform: scale(1.3);
                    opacity: 0.8;
                  }
                }
                .neighbor-blink-ring {
                  transform-origin: center;
                  animation: neighbor-blink-scale ${Ke.BLINK_DURATION}ms ease-out forwards;
                }
              `}),e.jsx("clipPath",{id:ue,children:e.jsx("circle",{cx:S,cy:A,r:I})})]}),(()=>{const u=I+oe.LABEL_INSET+12,E=f?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.15)",C=f?"rgba(59, 130, 246, 0.4)":"rgba(59, 130, 246, 0.5)",_=6,F=16,X=4,K=[0,90,180,270],ee=[45,135,225,315];return e.jsxs("g",{className:"radar-frame","aria-hidden":"true",children:[e.jsx("circle",{cx:S,cy:A,r:u,fill:"none",stroke:E,strokeWidth:1,strokeDasharray:"2 6"}),ee.map(Z=>{const ie=Z*Math.PI/180,me=Math.cos(ie),de=Math.sin(ie),he=u+X,M=u+X+F,G=S+he*de,ye=A-he*me,Ie=S+M*de,He=A-M*me;return e.jsxs("g",{children:[e.jsx("line",{x1:G,y1:ye,x2:Ie,y2:He,stroke:C,strokeWidth:1}),e.jsx("line",{x1:Ie-4*me,y1:He-4*de,x2:Ie+4*me,y2:He+4*de,stroke:C,strokeWidth:1})]},`corner-${Z}`)}),K.map(Z=>{const ie=Z*Math.PI/180,me=S+(u-_)*Math.sin(ie),de=A-(u-_)*Math.cos(ie),he=S+(u+2)*Math.sin(ie),M=A-(u+2)*Math.cos(ie);return e.jsx("line",{x1:me,y1:de,x2:he,y2:M,stroke:E,strokeWidth:1},`tick-cardinal-${Z}`)}),ee.map(Z=>{const ie=Z*Math.PI/180,me=S+(u-4)*Math.sin(ie),de=A-(u-4)*Math.cos(ie),he=S+(u+1)*Math.sin(ie),M=A-(u+1)*Math.cos(ie);return e.jsx("line",{x1:me,y1:de,x2:he,y2:M,stroke:E,strokeWidth:1},`tick-intercardinal-${Z}`)})]})})(),(()=>{const E=[(I+oe.LABEL_INSET+4)/I,...ae.map(C=>Le(C)).filter(C=>C>.02&&C<=1.05).sort((C,_)=>_-C),0];return E.slice(0,-1).map((C,_)=>{const F=E[_+1],X=I*C,K=I*F,ee=X-K;return ee<=0||_%2!==0?null:e.jsx("circle",{cx:S,cy:A,r:(X+K)/2,fill:"none",stroke:"var(--subtle-fill)",strokeWidth:ee,opacity:.8},`band-${_}`)})})(),ae.map(u=>{const E=Le(u);if(E>1.05||E<.02)return null;const C=Ee.some(X=>X.km===u),_=S+I*E*pt,F=A-I*E*ft;return e.jsxs("g",{children:[e.jsx("circle",{cx:S,cy:A,r:I*E,fill:"none",stroke:B,strokeOpacity:R,strokeWidth:1}),C&&e.jsx("text",{x:_+4,y:F-2,textAnchor:"start",dominantBaseline:"auto",fill:m.secondary,fontSize:10,fontFamily:Be,children:De(u)})]},`ring-${u}`)}),["N","E","S","W"].map(u=>{const C={N:0,E:90,S:180,W:270}[u]*Math.PI/180;return e.jsx("line",{x1:S,y1:A,x2:S+I*Math.sin(C),y2:A-I*Math.cos(C),stroke:B,strokeOpacity:R,strokeWidth:1,strokeDasharray:"4 4"},u)}),["NE","SE","SW","NW"].map(u=>{const C={NE:45,SE:135,SW:225,NW:315}[u]*Math.PI/180;return e.jsx("line",{x1:S,y1:A,x2:S+I*Math.sin(C),y2:A-I*Math.cos(C),stroke:B,strokeOpacity:W,strokeWidth:1,strokeDasharray:"4 4"},`diag-${u}`)}),["N","E","S","W"].map(u=>{const E=fe(u),C=u==="E"?"end":u==="W"?"start":"middle",_=u==="N"?"hanging":u==="S"?"auto":"middle";return e.jsx("text",{x:E.x,y:E.y,textAnchor:C,dominantBaseline:_,fill:q,fontSize:oe.CARDINAL_FONT_SIZE,fontWeight:700,fontFamily:Be,"aria-hidden":"true",children:u},u)}),["NE","SE","SW","NW"].map(u=>{const E=fe(u),C=u==="NE"||u==="SE"?"end":"start",_=u==="NE"||u==="NW"?"hanging":"auto";return e.jsx("text",{x:E.x,y:E.y,textAnchor:C,dominantBaseline:_,fill:q,fontSize:oe.INTERCARDINAL_FONT_SIZE,fontWeight:600,fontFamily:Be,"aria-hidden":"true",children:u},u)}),e.jsx("circle",{cx:S,cy:A,r:oe.LOCAL_DOT_RADIUS,fill:N.chart6,stroke:f?"rgba(255,255,255,0.3)":"rgba(0,0,0,0.2)",strokeWidth:1,role:"img","aria-label":"Local node"}),e.jsx("g",{clipPath:`url(#${ue})`,children:U.map(u=>{const E=D>0?u.distance/D*k:0;if(E>1)return null;const{x:C,y:_}=pe(u.bearing,E),F=u.snr!==null?gt(u.snr,O,T):"#808080",X=(o==null?void 0:o.hash)===u.hash,K=d.has(u.hash),ee=oe.DOT_RADIUS_HOVERED*1.5;return e.jsxs("g",{role:"img","aria-label":`${u.name}: ${u.distance.toFixed(1)}km ${u.bearing.toFixed(0)}°`,children:[K&&e.jsx("circle",{cx:C,cy:_,r:ee,fill:"none",stroke:f?"rgba(255,255,255,0.9)":"rgba(0,0,0,0.7)",strokeWidth:2,className:"neighbor-blink-ring"}),X&&e.jsx("circle",{cx:C,cy:_,r:ee,fill:F,opacity:.3}),e.jsx("circle",{cx:C,cy:_,r:X?oe.DOT_RADIUS_HOVERED:oe.DOT_RADIUS,fill:F,stroke:f?"rgba(0,0,0,0.5)":"rgba(0,0,0,0.25)",strokeWidth:1,style:{cursor:"pointer",transition:"r 0.15s"},onMouseEnter:()=>_e(u),onMouseLeave:()=>_e(null)})]},u.hash)})})]})]}),o&&e.jsxs("div",{className:"absolute bg-tooltip-bg border border-edge-subtle rounded-lg px-3 py-2 text-sm pointer-events-none z-10 shadow-xl",style:{left:"50%",bottom:8,transform:"translateX(-50%)"},children:[e.jsx("div",{className:"font-medium text-fg-primary",children:o.name}),e.jsx("div",{className:"type-data-xs text-fg-secondary",children:o.hash}),o.snr!==null?e.jsx("div",{className:"flex gap-3 mt-1 text-xs",children:e.jsxs("span",{children:[e.jsx("span",{className:"text-fg-secondary",children:"SNR:"})," ",e.jsxs("span",{className:"tabular-nums",style:{color:gt(o.snr,O,T)},children:[o.snr.toFixed(1)," dB"]}),e.jsxs("span",{className:"text-fg-secondary ml-1",children:["(",xn(o.snr),")"]})]})}):e.jsx("div",{className:"text-xs text-fg-secondary mt-1",children:"No SNR data"}),e.jsxs("div",{className:"flex gap-3 text-xs",children:[e.jsxs("span",{children:[e.jsx("span",{className:"text-fg-secondary",children:"Distance:"})," ",e.jsxs("span",{className:"tabular-nums text-fg-primary",children:[o.distance.toFixed(2)," km"]})]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-fg-secondary",children:"Bearing:"})," ",e.jsxs("span",{className:"tabular-nums text-fg-primary",children:[o.bearing.toFixed(0),"°"]})]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-1 px-1.5 py-2 flex-shrink-0 depth-raised radius-inset self-stretch",style:{width:"calc(100% / 6)"},children:[r&&e.jsxs("div",{className:"flex flex-col items-center gap-1 pb-2 border-b border-edge-subtle mb-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"icon-md flex items-center justify-center text-icon-card-title",children:e.jsx(ze,{className:"w-3.5 h-3.5"})}),l&&e.jsx(Fe,{color:"zinc",children:l})]}),e.jsx("span",{className:"type-micro text-center text-[10px] leading-tight",children:r})]}),e.jsx("div",{className:"flex flex-col gap-1 flex-1",role:"group","aria-label":"Zoom level",children:["1x","2x","4x","8x","16x","36x"].map(u=>e.jsx("button",{onClick:()=>Re(u),"aria-pressed":j===u,className:`flex flex-1 items-center justify-center min-w-[44px] sm:min-w-[32px] text-xs font-medium radius-inner depth-stroke-raised transition-colors ${j===u?"bg-sys-blue/20 text-sys-blue":"bg-subtle-fill/80 text-fg-secondary hover:bg-subtle-fill-strong hover:text-fg-primary"}`,children:u},u))})]})]}):e.jsxs("div",{ref:H,className:"flex flex-col items-center justify-center h-full text-fg-secondary",children:[e.jsx(ze,{className:"w-8 h-8 mb-2 opacity-50"}),e.jsx("p",{children:"Local node coordinates not configured"}),e.jsx("p",{className:"text-xs mt-1",children:"Set latitude/longitude in config to enable"})]})}const fn=c.memo(pn),Ye={repeater:"var(--sys-blue)",companion:"var(--sys-cyan)",room_server:"var(--sys-indigo)"};function gn(t){if(t.contact_type){const n=t.contact_type.toLowerCase();if(n==="repeater"||n==="rep")return"repeater";if(n==="room server"||n==="room_server"||n==="room"||n==="server")return"room_server";if(n==="companion"||n==="client"||n==="cli")return"companion"}return t.is_repeater?"repeater":"companion"}function yn({neighbors:t}){const n=c.useMemo(()=>{const s={repeater:0,companion:0,room_server:0};for(const r of Object.values(t)){const l=gn(r);s[l]=(s[l]||0)+1}const a=Object.values(s).reduce((r,l)=>r+l,0);return{items:[{label:"Repeaters",count:s.repeater,percent:0,color:Ye.repeater},{label:"Companions",count:s.companion,percent:0,color:Ye.companion},{label:"Room Servers",count:s.room_server,percent:0,color:Ye.room_server}].map(r=>({...r,percent:a>0?r.count/a*100:0})).filter(r=>r.count>0).sort((r,l)=>l.count-r.count),total:a}},[t]);return n.total===0?e.jsx("div",{className:"h-full flex items-center justify-center text-fg-muted type-body-sm",children:"No neighbors discovered yet"}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex-1 flex flex-col justify-evenly",children:n.items.map(s=>e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"type-data-sm text-fg-secondary",children:s.label}),e.jsxs("span",{className:"type-data-sm text-fg-secondary tabular-nums",children:[s.count," ",e.jsxs("span",{className:"text-fg-secondary/60",children:["(",s.percent.toFixed(0),"%)"]})]})]}),e.jsx("div",{className:"h-2.5 bg-subtle-fill/80 overflow-hidden rounded-full depth-stroke-inset",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500 ease-out",style:{width:`${s.percent}%`,backgroundColor:s.color,minWidth:s.count>0?"4px":"0"}})})]},s.label))}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-edge-subtle",children:[e.jsx("span",{className:"type-data-xs text-fg-secondary",children:"Total Nodes"}),e.jsx("span",{className:"type-data-sm text-fg-primary font-medium tabular-nums",children:n.total})]})]})}const bn=c.memo(yn);function Xe({children:t,minHeight:n="100%",rootMargin:s="200px 0px",keepMounted:a=!0,className:i=""}){const r=c.useRef(null),[l,x]=c.useState(!1),[o,p]=c.useState(!1);c.useEffect(()=>{const h=r.current;if(!h)return;const w=new IntersectionObserver(([g])=>{const j=g.isIntersecting;p(j),j&&x(!0)},{rootMargin:s,threshold:0});return w.observe(h),()=>{w.disconnect()}},[s]);const d=o||a&&l;return e.jsx("div",{ref:r,className:`h-full w-full ${i}`,style:{minHeight:n},children:d?t:e.jsx("div",{className:"h-full w-full flex items-center justify-center text-fg-muted/50",children:e.jsx("div",{className:"animate-pulse text-xs",children:"Loading chart..."})})})}const kt=[{target:"DisambiguationCard",fn:"disambiguation.collisions",minStage:2}];tt(kt);const jn=.9,Nn=.7,vn=.5,Sn=10,kn=25,Pe={excellent:"text-signal-excellent",good:"text-signal-good",fair:"text-signal-fair",poor:"text-sys-blue"},wn={excellent:"bg-signal-excellent/10",good:"bg-signal-good/10",fair:"bg-signal-fair/10",poor:"bg-sys-blue/10"};function Mn(t){return t>=jn?"excellent":t>=Nn?"good":t>=vn?"fair":"poor"}function Cn(t){return t<=Sn?"excellent":t<=kn?"good":"poor"}function An(){et(kt);const t=Ht(),n=Bt(),[s,a]=c.useState(null),i=c.useCallback((d,h)=>{a({prefix:d,candidateHashes:h})},[]),r=c.useCallback(()=>{a(null)},[]);if(!n)return e.jsxs(le,{neomorphic:!0,children:[e.jsx(Ne,{icon:e.jsx(rt,{}),title:"Prefix Conflicts"}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-fg-secondary",children:[e.jsx($t,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"type-data-xs",children:"No topology data available"}),e.jsx("p",{className:"type-data-xs opacity-70",children:"Run deep analysis to see stats"})]})})]});const l=Mn(t.avgConfidence),x=Cn(t.collisionRate),o=l==="poor"||x==="poor"?"poor":l==="fair"||x==="fair"?"fair":l==="good"||x==="good"?"good":"excellent",p=o==="excellent"||o==="good"?it:Ze;return e.jsxs(le,{neomorphic:!0,className:"flex flex-col overflow-hidden",children:[e.jsx(Ne,{icon:e.jsx(rt,{}),title:"Prefix Conflicts",badgeColor:"zinc",actions:o==="poor"?e.jsxs(Fe,{color:"red",children:[e.jsx(Ze,{className:"w-3 h-3"}),"Needs Attention"]}):e.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1 rounded-full ${wn[o]}`,children:[e.jsx(p,{className:`w-3.5 h-3.5 ${Pe[o]}`}),e.jsx("span",{className:`type-data-xs font-medium ${Pe[o]}`,children:o==="excellent"?"Excellent":o==="good"?"Good":"Fair"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"flex gap-2 sm:gap-3 py-3 sm:py-4",children:[e.jsxs("div",{className:"flex-1 flex flex-col radius-inner depth-stroke-raised bg-subtle-fill/80 px-3 py-2.5 sm:py-3 cursor-help",title:"Total unique 2-character prefixes observed in packet paths.",children:[e.jsx("span",{className:"type-data-xl text-fg-primary",children:e.jsx(Oe,{value:t.totalPrefixes,priority:"low"})}),e.jsx("span",{className:"type-micro text-fg-muted mt-0.5 sm:mt-1",children:"Prefixes"})]}),e.jsxs("div",{className:"flex-1 flex flex-col radius-inner depth-stroke-raised bg-subtle-fill/80 px-3 py-2.5 sm:py-3 cursor-help",title:"Prefixes that map to exactly one known node. No disambiguation needed.",children:[e.jsx("span",{className:"type-data-xl text-fg-primary",children:e.jsx(Oe,{value:t.unambiguousPrefixes,priority:"low"})}),e.jsx("span",{className:"type-micro text-fg-muted mt-0.5 sm:mt-1",children:"Unique"})]}),e.jsxs("div",{className:"flex-1 flex flex-col radius-inner depth-stroke-raised bg-subtle-fill/80 px-3 py-2.5 sm:py-3 cursor-help",title:"Prefixes matching multiple known nodes. Click a prefix below to explore candidates.",children:[e.jsx("span",{className:`type-data-xl ${t.collisionPrefixes>0?"text-sys-blue":"text-fg-primary"}`,children:e.jsx(Oe,{value:t.collisionPrefixes,priority:"low"})}),e.jsx("span",{className:`type-micro mt-0.5 sm:mt-1 ${t.collisionPrefixes>0?"text-sys-blue":"text-fg-muted"}`,children:"Conflicts"})]})]}),t.highCollisionPrefixes.length>0&&e.jsxs("div",{className:"pt-2",children:[e.jsx("div",{className:"type-data-xs text-fg-secondary mb-1.5",children:"Problem Prefixes"}),e.jsx("div",{className:"flex flex-wrap gap-1.5 content-start",children:t.highCollisionPrefixes.map(({prefix:d,candidateCount:h,candidateHashes:w})=>e.jsxs("button",{type:"button",onClick:()=>i(d,w),className:"inline-flex items-center gap-0.5 group",title:`${h} candidates - click to explore`,children:[e.jsx(ls,{children:d}),e.jsxs("span",{className:"text-fg-muted type-data-xs group-hover:text-fg-secondary transition-colors",children:["×",h]})]},d))})]}),t.lowConfidencePrefixes.length===0&&t.collisionPrefixes===0&&e.jsx("div",{className:"flex-1 flex items-center",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(it,{className:"w-3.5 h-3.5 text-signal-excellent"}),e.jsx("span",{className:"type-data-xs text-signal-excellent",children:"All prefixes uniquely identified"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 mt-auto pt-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2 cursor-help",title:"Average confidence score across all disambiguated prefixes. Higher = more certain node identification.",children:[e.jsx("span",{className:"type-data-xs text-fg-secondary",children:"Confidence"}),e.jsxs("span",{className:`data-box ${Pe[l]}`,children:[(t.avgConfidence*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2 cursor-help",title:"Percentage of 2-character prefixes that match multiple known nodes. Lower is better.",children:[e.jsx("span",{className:"type-data-xs text-fg-secondary",children:"Collisions"}),e.jsxs("span",{className:`data-box ${Pe[x]}`,children:[t.collisionRate.toFixed(1),"%"]})]})]})]}),e.jsx(ms,{isOpen:!!s,prefix:(s==null?void 0:s.prefix)||"",candidateHashes:(s==null?void 0:s.candidateHashes)||[],onClose:r})]})}const wt=[{target:"PacketHealth",fn:"type",minStage:1},{target:"PacketHealth",fn:"duplicates",minStage:1}];tt(wt);const _n=new Set(["Duplicate","Empty payload","Path too long","Unknown"]),Me=24;function Rn(t,n){const s=Date.now()/1e3,a=n*60,i=s-a,r=a/Me,l=new Array(Me).fill(0),x=new Array(Me).fill(0);let o=0,p=0,d=0,h=0;for(const g of t){if(g.packet_origin==="tx_local")continue;const j=g.timestamp;if(j<i||j>s)continue;o++;const b=Math.min(Me-1,Math.floor((j-i)/r));x[b]++,g.transmitted||g.packet_origin==="tx_forward"?(p++,l[b]++):(g.is_duplicate||g.drop_reason==="Duplicate")&&d++,g.drop_reason&&_n.has(g.drop_reason)&&h++}const w=[];for(let g=0;g<Me;g++){const j=x[g],b=l[g];w.push({count:j>0?Math.round(b/j*100):0,timestamp:(i+g*r)*1e3})}return{totalRx:o,forwarded:p,duplicates:d,waste:h,efficiency:o>0?p/o*100:0,duplicateRate:o>0?d/o*100:0,wasteRate:o>0?h/o*100:0,sparkline:w}}function Ln(t){return t>=90?"excellent":t>=75?"good":t>=60?"fair":"poor"}const Dn={excellent:"bg-status-success",good:"bg-sys-blue",fair:"bg-status-warning",poor:"bg-status-danger"};function En({packets:t,rangeMinutes:n,rangeHours:s,timeRangeLabel:a,isLoaded:i=!0}){et(wt);const r=c.useMemo(()=>Rn(t,n),[t,n]),[l,x]=c.useState(null),o=c.useCallback(async()=>{try{const h=await zt(s);h.success&&h.data&&x(h.data.count)}catch{}},[s]);c.useEffect(()=>{o()},[o]);const p=Ln(r.efficiency),d=r.totalRx>0;return e.jsx(le,{neomorphic:!0,isLoaded:i,skeletonType:"chart",children:i&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{icon:e.jsx(us,{}),title:"Packet Health",badge:a,badgeColor:"zinc"}),e.jsx(Wt,{children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("div",{className:"type-data-xl text-fg-primary",children:[d?e.jsx(Oe,{value:Math.round(r.efficiency*10)/10,className:"font-mono tabular-nums",priority:"medium",format:{minimumFractionDigits:1,maximumFractionDigits:1}}):e.jsx("span",{className:"opacity-30",children:"—"}),e.jsx("span",{className:"type-data-sm text-fg-muted ml-0.5",children:"%"})]}),d&&e.jsx("div",{className:`w-2 h-2 rounded-full ${Dn[p]}`})]}),e.jsx("div",{className:"type-micro mb-2 cursor-help",title:"Forwarded packets / total received. CRC failures, garbled packets, and RF collisions that destroy packets before reaching software are not included in this ratio — see CRC Errors for hardware-level failures.",children:"FORWARDING RATE"}),e.jsx("div",{className:"flex-1 min-h-[28px] max-h-[48px] mb-2",children:e.jsx(ds,{data:r.sparkline,width:9999,height:36,color:"var(--sys-blue)",className:"w-full"})}),e.jsxs("div",{className:"flex gap-2 sm:gap-3 mt-auto",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"data-box-label",children:"Dupes"}),e.jsx("div",{className:"data-box data-box-fill data-box-left",children:d?`${r.duplicateRate.toFixed(1)}%`:"—"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"data-box-label",children:"Waste"}),e.jsx("div",{className:"data-box data-box-fill data-box-left",children:d?`${r.wasteRate.toFixed(1)}%`:"—"})]}),l!==null&&l>0&&e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"data-box-label flex items-center gap-1",children:[e.jsx(Ze,{className:"w-3 h-3 text-status-warning"}),"CRC"]}),e.jsx("div",{className:"data-box data-box-fill data-box-left text-status-warning",children:l})]})]})]})})]})})}function la(){var De,ke,Ee,Te,u,E,C,_,F,X,K,ee,Z,ie,me,de,he;const t=Ut(),n=Gt(),s=qt(),a=Vt(),i=Kt(),r=Yt(),l=t!==null&&i,x=c.useRef(!1);l&&!x.current&&(x.current=!0);const o=x.current,p=Xt(),d=Zt(),h=Qt(),[w,g]=c.useState(null),[,j]=c.useState(null),[b]=c.useState(null),[k,L]=c.useState(()=>{const M=localStorage.getItem("statistics-view-mode");return M==="share"||M==="airtime"?M:"airtime"});c.useEffect(()=>{localStorage.setItem("statistics-view-mode",k)},[k]);const[P,z]=c.useState(()=>{const M=localStorage.getItem("statistics-smoothing-mode");return["ema","ultra","mosaic","stats","trend"].includes(M)?M:"stats"});c.useEffect(()=>{localStorage.setItem("statistics-smoothing-mode",P)},[P]);const[H,V]=c.useState(!1),[O,N]=c.useState(!1),[m,f]=c.useState(jt),[v,T]=c.useState(.5),[B,R]=c.useState(hs),[W,q]=c.useState(.8),[te,J]=c.useState(50),U=c.useMemo(()=>({0:0,1:0,2:1,3:2,4:3,5:4,6:5,7:6,8:7,9:8,10:9})[p]??3,[p]),D=$e[U].hours,Y=D*60,se=$e[U],re=at(D),ae=r.isBackgroundLoading,ne=c.useCallback(M=>{const ye={0:1,1:2,2:3,3:4,4:5,5:6,6:7,7:8,8:9,9:10}[M]??4;d(ye)},[d]),ce=c.useMemo(()=>{var G;if(!((G=t==null?void 0:t.config)!=null&&G.radio))return null;const M=t.config.radio;return{sf:M.spreading_factor??10,bw:M.bandwidth??25e4,cr:M.coding_rate??5,preamble:M.preamble_length??8}},[(ke=(De=t==null?void 0:t.config)==null?void 0:De.radio)==null?void 0:ke.spreading_factor,(Te=(Ee=t==null?void 0:t.config)==null?void 0:Ee.radio)==null?void 0:Te.bandwidth,(E=(u=t==null?void 0:t.config)==null?void 0:u.radio)==null?void 0:E.coding_rate,(_=(C=t==null?void 0:t.config)==null?void 0:C.radio)==null?void 0:_.preamble_length]),$=c.useMemo(()=>h.length===0?{timestamps:[],values:[]}:{timestamps:h.map(M=>M.timestamp),values:h.map(M=>M.noise_floor_dbm)},[h]),y=c.useMemo(()=>{if(h.length<10)return{anomalies:[],debug:void 0};const M=As(h,m);return{anomalies:M.anomalies,debug:M.debug}},[h,m]),S=y.anomalies,A=c.useMemo(()=>{const M=(t==null?void 0:t.neighbors)??{};return Object.fromEntries(Object.entries(M).filter(([G])=>!n.has(G)))},[t==null?void 0:t.neighbors,n]),I=c.useMemo(()=>{const M=Date.now()/1e3-D*3600;return Object.fromEntries(Object.entries(A).filter(([,G])=>G.last_seen>=M))},[A,D]),Q=c.useMemo(()=>{const M=Y*60/re,G=Math.floor(Date.now()/1e3),ye=Math.floor(G/M)*M;return{start:ye-Y*60,end:ye}},[Y,re]),ue=B.timeStart??Q.start,pe=B.timeEnd??Q.end,fe=(pe-ue)/3600,_e=at(fe),Re=fs(),Le=c.useMemo(()=>xs(a,B,Re,Q),[a,B,Re,Q]);return e.jsxs(rs,{children:[e.jsx(is,{title:"Statistics",icon:e.jsx(Jt,{}),controls:e.jsx(as,{ranges:$e,selectedIndex:U,onSelect:ne,isPending:ae})}),b&&e.jsx(le,{className:"border border-sys-red/50 bg-sys-red/10",children:e.jsx("p",{className:"text-sys-red",children:b})}),H&&O&&e.jsxs(le,{className:"border border-sys-indigo/30 bg-surface/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"type-label",children:"Anomaly Detection Tuning"}),e.jsxs("span",{className:"type-data-xs text-fg-muted",children:["(",se.label,")"]})]}),e.jsx("button",{onClick:()=>f(M=>({...M,useAbsoluteThresholds:!M.useAbsoluteThresholds})),className:`type-data-xs px-2 py-1 rounded transition-colors ${m.useAbsoluteThresholds?"bg-sys-indigo/30 text-sys-indigo":"bg-elevated text-fg-muted hover:text-fg-secondary"}`,children:m.useAbsoluteThresholds?"Absolute dBm":"Percentile"})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"type-micro",children:"Baseline"}),e.jsxs("span",{className:"ml-2 type-data-sm text-status-warning",children:[((X=(F=y.debug)==null?void 0:F.baselineCutoff)==null?void 0:X.toFixed(1))??"—"," dBm"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"type-micro",children:"Spike"}),e.jsxs("span",{className:"ml-2 type-data-sm text-status-warning",children:[((ee=(K=y.debug)==null?void 0:K.spikeCutoff)==null?void 0:ee.toFixed(1))??"—"," dBm"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"type-micro",children:"Mid-band"}),e.jsx("span",{className:"ml-2 type-data-sm text-sys-indigo",children:((Z=y.debug)==null?void 0:Z.midBandSamples)??0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"type-micro",children:"Anomalies"}),e.jsx("span",{className:"ml-2 type-data-sm text-status-danger",children:S.length})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-edge-subtle space-y-4",children:[m.useAbsoluteThresholds?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Baseline (",m.baselineDbm," dBm)"]}),e.jsx("input",{type:"range",min:"-120",max:"-60",value:m.baselineDbm,onChange:M=>f(G=>({...G,baselineDbm:Number(M.target.value)})),className:"w-full accent-sys-indigo"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Spike (",m.spikeDbm," dBm)"]}),e.jsx("input",{type:"range",min:"-100",max:"-20",value:m.spikeDbm,onChange:M=>f(G=>({...G,spikeDbm:Number(M.target.value)})),className:"w-full accent-sys-indigo"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Merge Gap (",m.mergeGapSeconds,"s)"]}),e.jsx("input",{type:"range",min:"5",max:"120",step:"5",value:m.mergeGapSeconds,onChange:M=>f(G=>({...G,mergeGapSeconds:Number(M.target.value)})),className:"w-full accent-sys-indigo"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Min Sequence (",m.minSequenceLength,")"]}),e.jsx("input",{type:"range",min:"2",max:"20",value:m.minSequenceLength,onChange:M=>f(G=>({...G,minSequenceLength:Number(M.target.value)})),className:"w-full accent-sys-indigo"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Similarity (±",m.similarityToleranceDbm," dBm)"]}),e.jsx("input",{type:"range",min:"1",max:"15",value:m.similarityToleranceDbm,onChange:M=>f(G=>({...G,similarityToleranceDbm:Number(M.target.value)})),className:"w-full accent-sys-indigo"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Opacity (",Math.round(v*100),"%)"]}),e.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.05",value:v,onChange:M=>T(Number(M.target.value)),className:"w-full accent-sys-indigo"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Baseline (P",m.baselinePercentile,")"]}),e.jsx("input",{type:"range",min:"1",max:"50",value:m.baselinePercentile,onChange:M=>f(G=>({...G,baselinePercentile:Number(M.target.value)})),className:"w-full accent-sys-indigo"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Spike (P",m.spikePercentile,")"]}),e.jsx("input",{type:"range",min:"50",max:"99",value:m.spikePercentile,onChange:M=>f(G=>({...G,spikePercentile:Number(M.target.value)})),className:"w-full accent-sys-indigo"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Merge Gap (",m.mergeGapSeconds,"s)"]}),e.jsx("input",{type:"range",min:"5",max:"120",step:"5",value:m.mergeGapSeconds,onChange:M=>f(G=>({...G,mergeGapSeconds:Number(M.target.value)})),className:"w-full accent-sys-indigo"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Min Sequence (",m.minSequenceLength,")"]}),e.jsx("input",{type:"range",min:"2",max:"20",value:m.minSequenceLength,onChange:M=>f(G=>({...G,minSequenceLength:Number(M.target.value)})),className:"w-full accent-sys-indigo"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Similarity (±",m.similarityToleranceDbm," dBm)"]}),e.jsx("input",{type:"range",min:"1",max:"15",value:m.similarityToleranceDbm,onChange:M=>f(G=>({...G,similarityToleranceDbm:Number(M.target.value)})),className:"w-full accent-sys-indigo"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Opacity (",Math.round(v*100),"%)"]}),e.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.05",value:v,onChange:M=>T(Number(M.target.value)),className:"w-full accent-sys-indigo"})]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-elevated radius-inner",children:[e.jsx("div",{className:"type-micro mb-1",children:"Config output"}),e.jsxs("div",{className:"type-data-sm text-status-success",children:[m.useAbsoluteThresholds?`useAbsoluteThresholds: true, baselineDbm: ${m.baselineDbm}, spikeDbm: ${m.spikeDbm}`:`useAbsoluteThresholds: false, baselinePercentile: ${m.baselinePercentile}, spikePercentile: ${m.spikePercentile}`,", mergeGapSeconds: ",m.mergeGapSeconds,", minSequenceLength: ",m.minSequenceLength,", similarityToleranceDbm: ",m.similarityToleranceDbm]})]})]})]}),e.jsxs(os,{children:[e.jsx("div",{className:"sm:hidden",children:ae&&e.jsx(ge,{template:"auto",children:e.jsx(le,{className:"border border-sys-blue/30 bg-sys-blue/5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-sys-blue opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-sys-blue"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"type-body-sm text-fg-primary",children:["Loading ",se.label," data..."]}),r.loadProgress&&e.jsxs("p",{className:"type-data-xs text-fg-muted mt-0.5",children:[r.loadProgress.loaded.toLocaleString()," packets (",r.loadProgress.percent,"%)"]})]})]})})})}),o?e.jsxs(e.Fragment,{children:[e.jsx(ge,{template:"hero-auto",children:e.jsx(le,{neomorphic:!0,isLoaded:o,skeletonType:"chart",children:o&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{icon:e.jsx(Se,{}),title:"Packet Analyzer",badge:se.label,badgeColor:"zinc",stackActionsOnMobile:!0,actions:e.jsxs("div",{className:"flex flex-wrap items-center gap-2 justify-end",children:[P==="stats"&&e.jsx(qs,{enabled:H,onChange:V,anomalyCount:S.length,showTuning:O,onTuningChange:N}),e.jsx(Gs,{smoothing:P,onChange:z}),e.jsx(Us,{mode:k,onChange:L})]})}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(on,{packets:Le,allPackets:a,startTs:ue,endTs:pe,parentStartTs:Q.start,parentEndTs:Q.end,bucketCount:_e,radioConfig:ce??void 0,mode:k,smoothing:P,noiseFloorAnomalies:S,showNoiseFloorOverlay:H,overlayOpacity:v,dotSize:W,dotOpacity:te/100})})]})})}),e.jsx(ge,{template:"auto",className:"relative z-10",children:e.jsx(le,{neomorphic:!0,noPadding:!0,isLoaded:o,className:"overflow-visible",children:o&&e.jsx(ps,{parentStartTs:Q.start,parentEndTs:Q.end,neighbors:A,filter:B,onChange:R,...P==="stats"?{scatterDotSize:W,onScatterDotSizeChange:q,scatterOpacity:te,onScatterOpacityChange:J}:{}})})}),e.jsxs(ge,{template:"panel",children:[e.jsx(we,{span:12,md:6,children:e.jsx(le,{neomorphic:!1,isLoaded:o,skeletonType:"chart",noPadding:o,className:"!bg-transparent !ring-0 !shadow-none !overflow-visible -mx-4 sm:mx-0 !px-0 !pr-0",children:o&&e.jsx(Xe,{children:e.jsx(fn,{neighbors:I,quickNeighbors:s,localLat:((me=(ie=t==null?void 0:t.config)==null?void 0:ie.repeater)==null?void 0:me.latitude)??0,localLon:((he=(de=t==null?void 0:t.config)==null?void 0:de.repeater)==null?void 0:he.longitude)??0,onStatsChange:j,title:"Link Quality",badge:se.label})})})}),e.jsx(we,{span:12,md:6,children:e.jsx(le,{neomorphic:!0,isLoaded:o,skeletonType:"chart",children:o&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{icon:e.jsx(ys,{}),title:"Network Composition",badge:se.label,badgeColor:"zinc"}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(Xe,{children:e.jsx(bn,{neighbors:I})})})]})})})]}),e.jsxs(ge,{template:"panel",children:[e.jsx(we,{span:12,md:6,children:e.jsx(An,{})}),e.jsx(we,{span:12,md:6,children:e.jsx(En,{packets:a,rangeMinutes:Y,rangeHours:D,timeRangeLabel:se.label,isLoaded:o})})]}),e.jsx(ge,{template:"panel",children:e.jsx(we,{span:12,children:e.jsx(le,{neomorphic:!0,isLoaded:o,skeletonType:"chart",children:o&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{icon:e.jsx(es,{}),title:"NOISE FLOOR dBm",stackActionsOnMobile:!0,actions:w?e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("span",{className:"type-data-xs text-fg-muted whitespace-nowrap",children:["min ",e.jsx("span",{className:"data-box",children:w.min.toFixed(0)})]}),e.jsxs("span",{className:"type-data-xs text-fg-muted whitespace-nowrap",children:["avg ",e.jsx("span",{className:"data-box",children:w.avg.toFixed(0)})]}),e.jsxs("span",{className:"type-data-xs text-fg-muted whitespace-nowrap",children:["max ",e.jsx("span",{className:"data-box",children:w.max.toFixed(0)})]})]}):null}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(Xe,{children:e.jsx(ts,{timestamps:$.timestamps,values:$.values,onStatsChange:g})})})]})})})})]}):e.jsx(ge,{template:"auto",children:e.jsx(le,{neomorphic:!0,className:"text-center py-12",children:e.jsx("div",{className:"animate-pulse text-fg-muted",children:"Loading statistics..."})})})]})]})}export{la as default};
