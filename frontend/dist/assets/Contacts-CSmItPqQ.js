const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ContactsMapMapLibre-B-gE8juY.js","assets/vendor-react-nG6Am_s0.js","assets/vendor-core-XI_xDZ-M.js","assets/index-BIZ3jtzu.js","assets/ConfirmModal-V3007Nz2.js","assets/useThemeColors-C9IVL-ly.js","assets/SignalIndicator-CC9fMGoT.js","assets/HashBadge-CXiNob7o.js","assets/CollisionExplorerModal-DDHyPIHs.js","assets/PageLayout-D3aCCXDi.js","assets/maplibre-gl-B1CfjdFi.css","assets/index-CXggJtlY.css","assets/leaflet-CIGW-MKW.css"])))=>i.map(i=>d[i]);
import{j as e,r as t,a8 as s,a4 as a,z as n,h as r,a9 as c,k as i,aa as l,Z as o,ab as d,T as x,D as h,a7 as m,a2 as u,o as p,Y as g,ac as j,p as f,ad as N,X as v,ae as b,af as y,ag as w,ah as k,ai as C,aj as M,ak as S,al as L,am as H,an as P}from"./vendor-react-nG6Am_s0.js";import{x as $,y as R,v as F,z as _,A as E,B as T,C as O,r as A,E as D,f as W,F as K,G as U,H as z,e as G,I as B,J as I,K as V}from"./index-BIZ3jtzu.js";import{a as q}from"./SignalIndicator-CC9fMGoT.js";import{_ as J}from"./deckgl-MTXp-Y3t.js";import{c as Y,d as Z,T as Q,b as X,a as ee,L as te}from"./recharts-BJXKa0n8.js";import{H as se}from"./HashBadge-CXiNob7o.js";import{C as ae}from"./ConfirmModal-V3007Nz2.js";import{C as ne}from"./CollisionExplorerModal-DDHyPIHs.js";import{P as re,a as ce}from"./PageLayout-D3aCCXDi.js";class ie extends t.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}render(){var t;return this.state.hasError?e.jsx("div",{className:"map-container-16-9 glass-card flex items-center justify-center",role:"alert","aria-live":"assertive",children:e.jsxs("div",{className:"text-center text-white/50 p-4",children:[e.jsx("p",{className:"text-lg mb-2",children:"Map failed to load"}),e.jsx("p",{className:"text-sm text-white/30",children:(null==(t=this.state.error)?void 0:t.message)||"Unknown error"}),e.jsx("p",{className:"text-xs text-white/20 mt-2",children:"Try refreshing the page or check your browser's WebGL support."})]})}):this.props.children}}const le=t.lazy(()=>J(()=>import("./ContactsMapMapLibre-B-gE8juY.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])));function oe({neighbors:s,localNode:a,localHash:n,onRemoveNode:r,selectedNodeHash:c,onNodeSelected:i,highlightedEdgeKey:l}){return e.jsx(ie,{children:e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"map-container-16-9 glass-card flex items-center justify-center",role:"status","aria-live":"polite","aria-label":"Loading map",children:e.jsxs("div",{className:"text-white/50 flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-accent-primary border-t-transparent rounded-full animate-spin","aria-hidden":"true"}),e.jsx("span",{children:"Loading map..."})]})}),children:e.jsx(le,{neighbors:s,localNode:a,localHash:n,onRemoveNode:r,selectedNodeHash:c,onNodeSelected:i,highlightedEdgeKey:l})})})}function de(e){return e>=.7?"text-accent-success":e>=.5?"text-accent-secondary":e>=.3?"text-signal-poor":"text-accent-danger"}function xe(e){return`${Math.round(100*e)}%`}function he(e,t){return t.has(e.toUpperCase())}const me=t.memo(function({path:t,isHighlighted:s,onHighlight:c,ghostPrefixes:i}){const l=function(t){return t>.2?{icon:e.jsx(x,{className:"w-3 h-3"}),color:"text-accent-success"}:t<-.2?{icon:e.jsx(n,{className:"w-3 h-3"}),color:"text-accent-danger"}:{icon:e.jsx(h,{className:"w-3 h-3"}),color:"text-text-muted"}}(t.observationTrend),m=t.weakestLinkKey&&t.weakestLinkConfidence<.5,u=t.hops.some(e=>he(e,i));return e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-md transition-colors cursor-pointer "+(s?"bg-accent-primary/20 border border-accent-primary/40":"hover:bg-white/5"),onClick:()=>c(s?null:t.weakestLinkKey),children:[e.jsx("div",{className:"flex-shrink-0 w-12 text-center py-1 rounded-md "+(p=t.healthScore,p>=.7?"bg-accent-success/10":p>=.5?"bg-accent-secondary/10":p>=.3?"bg-signal-poor/10":"bg-accent-danger/10"),children:e.jsx("span",{className:`text-xs font-semibold tabular-nums ${de(t.healthScore)}`,children:xe(t.healthScore)})}),e.jsx("div",{className:"flex-1 flex items-center gap-0.5 overflow-x-auto min-w-0",children:t.hops.map((s,a)=>{var n;const c=he(s,i),l=m&&(null==(n=t.weakestLinkKey)?void 0:n.includes(s));return e.jsxs("span",{className:"flex items-center",children:[e.jsxs("span",{className:"text-[10px] font-mono px-1.5 py-0.5 rounded flex items-center gap-0.5 "+(c?"bg-accent-tertiary/20 text-accent-tertiary border border-accent-tertiary/30":l?"bg-accent-danger/20 text-accent-danger":"bg-white/10 text-text-secondary"),children:[c&&e.jsx(r,{className:"w-2.5 h-2.5"}),s]}),a<t.hops.length-1&&e.jsx("span",{className:"text-text-muted mx-0.5",children:"→"})]},a)})}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-3",children:[e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded "+("direct"===t.routeType?"bg-accent-success/20 text-accent-success":"flood"===t.routeType?"bg-accent-primary/20 text-accent-primary":"bg-white/10 text-text-muted"),children:"direct"===t.routeType?"D":"flood"===t.routeType?"F":"M"}),e.jsxs("div",{className:"flex items-center gap-1 text-text-muted",title:"Estimated latency",children:[e.jsx(o,{className:"w-3 h-3"}),e.jsxs("span",{className:"text-[10px] tabular-nums",children:[t.estimatedLatencyMs,"ms"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-text-muted",title:"Observations",children:[e.jsx(d,{className:"w-3 h-3"}),e.jsx("span",{className:"text-[10px] tabular-nums",children:t.observationCount})]}),e.jsx("div",{className:`flex items-center gap-1 ${l.color}`,title:"Usage trend",children:l.icon}),u&&e.jsx("div",{className:"text-accent-tertiary",title:"Path includes ghost (unknown) nodes",children:e.jsx(r,{className:"w-3 h-3"})}),m&&e.jsx("div",{className:"text-accent-danger",title:`Weak link: ${t.weakestLinkConfidence.toFixed(0)}% confidence`,children:e.jsx(a,{className:"w-3 h-3"})})]})]});var p}),ue=t.memo(function({maxPaths:o=10,onHighlightEdge:d,highlightedEdge:x}){const h=$(),m=R(),u=F(),[p,g]=t.useState(!1),j=t.useMemo(()=>new Set(u.map(e=>e.prefix.toUpperCase())),[u]),f=t.useMemo(()=>h.slice(0,o),[h,o]),N=t.useMemo(()=>0===h.length?null:{avgHealth:h.reduce((e,t)=>e+t.healthScore,0)/h.length,declining:h.filter(e=>e.observationTrend<-.2).length,weakLinks:h.filter(e=>e.weakestLinkConfidence<.5).length,pathsWithGhosts:h.filter(e=>e.hops.some(e=>j.has(e.toUpperCase()))).length},[h,j]),v=e=>{null==d||d(e)};return 0===h.length?null:e.jsxs("div",{className:"chart-container",children:[e.jsxs("button",{onClick:()=>g(!p),className:"w-full chart-header hover:bg-white/5 transition-colors rounded-t-lg cursor-pointer",children:[e.jsxs("div",{className:"chart-title",children:[e.jsx(s,{className:"chart-title-icon"}),"Path Health",e.jsxs("span",{className:"ml-2 text-[10px] font-normal text-text-muted",children:["(",h.length," paths)"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[N&&e.jsxs("div",{className:"flex items-center gap-3 text-[10px]",children:[e.jsxs("span",{className:`tabular-nums ${de(N.avgHealth)}`,children:["Avg: ",xe(N.avgHealth)]}),N.weakLinks>0&&e.jsxs("span",{className:"text-accent-danger flex items-center gap-1",children:[e.jsx(a,{className:"w-3 h-3"}),N.weakLinks," weak"]}),N.declining>0&&e.jsxs("span",{className:"text-signal-poor flex items-center gap-1",children:[e.jsx(n,{className:"w-3 h-3"}),N.declining," declining"]}),N.pathsWithGhosts>0&&e.jsxs("span",{className:"text-accent-tertiary flex items-center gap-1",children:[e.jsx(r,{className:"w-3 h-3"}),N.pathsWithGhosts," ghost"]})]}),p?e.jsx(c,{className:"w-4 h-4 text-text-muted"}):e.jsx(i,{className:"w-4 h-4 text-text-muted"})]})]}),p&&e.jsxs("div",{className:"p-3 pt-0 space-y-1",children:[m.totalPaths>0&&e.jsxs("div",{className:"flex items-center gap-3 text-[10px] text-text-muted pb-2 border-b border-white/5",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(l,{className:"w-3 h-3 text-accent-primary"}),e.jsx("span",{className:"text-text-secondary",children:m.totalPaths.toLocaleString()})," Viterbi decoded"]}),m.observationOverrideCount>0&&e.jsxs("span",{className:"text-accent-success",children:[Math.round(m.observationOverrideCount/m.totalPaths*100),"% observation override"]}),u.length>0&&e.jsxs("span",{className:"text-accent-tertiary flex items-center gap-1",children:[e.jsx(r,{className:"w-3 h-3"}),u.length," ghost",1!==u.length?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-[10px] text-text-muted pb-2 border-b border-white/5",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-accent-success"})," Healthy (≥70%)"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-accent-secondary"})," Fair (50-70%)"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-signal-poor"})," Weak (30-50%)"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-accent-danger"})," Critical (<30%)"]}),u.length>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(r,{className:"w-3 h-3 text-accent-tertiary"})," Ghost"]})]}),e.jsx("div",{className:"space-y-1 max-h-64 overflow-y-auto",children:f.map(t=>e.jsx(me,{path:t,isHighlighted:x===t.weakestLinkKey,onHighlight:v,ghostPrefixes:j},t.pathKey))}),h.length>o&&e.jsxs("div",{className:"text-center text-[10px] text-text-muted pt-2",children:["Showing top ",o," of ",h.length," paths"]})]})]})});function pe({ghost:s,neighbors:n,isExpanded:o,onToggle:d}){const x=t.useMemo(()=>Array.from(s.commonNeighbors).map(e=>{var t;return{hash:e,name:null==(t=n[e])?void 0:t.name}}),[s.commonNeighbors,n]),h=s.confidence>=.8?"text-accent-success":s.confidence>=.5?"text-accent-secondary":"text-signal-poor",m=s.estimatedLocation?s.estimatedLocation.uncertaintyM>=1e3?`±${(s.estimatedLocation.uncertaintyM/1e3).toFixed(1)}km`:`±${Math.round(s.estimatedLocation.uncertaintyM)}m`:null;return e.jsxs("div",{className:Y("rounded-lg border transition-all duration-150",s.isLikelyReal?"border-accent-tertiary/30 bg-accent-tertiary/5":"border-border-muted bg-bg-card/50"),children:[e.jsxs("button",{onClick:d,className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-white/5 rounded-lg",children:[e.jsx(r,{className:Y("w-5 h-5 flex-shrink-0",s.isLikelyReal?"text-accent-tertiary":"text-text-muted")}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-sm font-semibold text-text-primary",children:s.prefix.toUpperCase()}),s.isLikelyReal&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-xs font-medium bg-accent-tertiary/20 text-accent-tertiary",children:"Likely Real"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-text-muted mt-0.5",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(l,{className:"w-3 h-3"}),s.observationCount," obs"]}),e.jsxs("span",{className:Y("flex items-center gap-1",h),children:[(100*s.confidence).toFixed(0),"% conf"]})]})]}),o?e.jsx(c,{className:"w-4 h-4 text-text-muted"}):e.jsx(i,{className:"w-4 h-4 text-text-muted"})]}),o&&e.jsxs("div",{className:"px-3 pb-3 space-y-3 border-t border-border-muted/50 mt-1 pt-3",children:[s.estimatedLocation?e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(u,{className:"w-4 h-4 text-accent-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-xs",children:[e.jsxs("div",{className:"text-text-primary font-medium",children:[s.estimatedLocation.lat.toFixed(5),", ",s.estimatedLocation.lon.toFixed(5)]}),e.jsxs("div",{className:"text-text-muted",children:["Uncertainty: ",m]})]})]}):e.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-muted",children:[e.jsx(a,{className:"w-4 h-4 text-signal-poor"}),"Location unknown (neighbors lack coordinates)"]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(p,{className:"w-4 h-4 text-text-muted mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-xs",children:[e.jsxs("div",{className:"text-text-primary",children:["First seen: ",_(s.firstSeen)," ago"]}),e.jsxs("div",{className:"text-text-muted",children:["Last seen: ",_(s.lastSeen)," ago"]})]})]}),x.length>0&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(g,{className:"w-4 h-4 text-text-muted mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-xs",children:[e.jsxs("div",{className:"text-text-muted mb-1",children:["Adjacent to ",x.length," known node",1!==x.length?"s":"",":"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[x.slice(0,5).map(({hash:t})=>e.jsx(se,{hash:t,size:"sm"},t)),x.length>5&&e.jsxs("span",{className:"text-text-muted",children:["+",x.length-5," more"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t border-border-muted/30",children:[e.jsx("div",{className:"flex-1 h-2 rounded-full bg-bg-elevated overflow-hidden",children:e.jsx("div",{className:Y("h-full rounded-full transition-all",s.confidence>=.8?"bg-accent-success":s.confidence>=.5?"bg-accent-secondary":"bg-signal-poor"),style:{width:100*s.confidence+"%"}})}),e.jsxs("span",{className:"text-xs text-text-muted w-12 text-right",children:[(100*s.confidence).toFixed(0),"%"]})]})]})]})}function ge({neighbors:s,className:n}){const c=F(),i=R(),[l,o]=t.useState(new Set),[d,x]=t.useState(!1),{likelyReal:h,uncertain:u}=t.useMemo(()=>{const e=[],t=[];for(const a of c)a.isLikelyReal?e.push(a):t.push(a);const s=(e,t)=>t.confidence-e.confidence||t.observationCount-e.observationCount;return e.sort(s),t.sort(s),{likelyReal:e,uncertain:t}},[c]);if(0===c.length)return null;const p=e=>{o(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},g=d?u:u.slice(0,5);return e.jsxs("div",{className:Y("space-y-4",n),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:"w-5 h-5 text-accent-tertiary"}),e.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Discovered Nodes"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-accent-tertiary/20 text-accent-tertiary",children:c.length})]}),i.totalPaths>0&&e.jsxs("div",{className:"text-xs text-text-muted",children:[i.pathsWithGhosts," / ",i.totalPaths," paths"]})]}),h.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-accent-tertiary",children:[e.jsx(m,{className:"w-3.5 h-3.5"}),e.jsxs("span",{className:"font-medium",children:["Likely Undiscovered Repeaters (",h.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:h.map(t=>e.jsx(pe,{ghost:t,neighbors:s,isExpanded:l.has(t.prefix),onToggle:()=>p(t.prefix)},t.prefix))})]}),u.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-muted",children:[e.jsx(a,{className:"w-3.5 h-3.5"}),e.jsxs("span",{children:["Uncertain (",u.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:g.map(t=>e.jsx(pe,{ghost:t,neighbors:s,isExpanded:l.has(t.prefix),onToggle:()=>p(t.prefix)},t.prefix))}),u.length>5&&e.jsx("button",{onClick:()=>x(!d),className:"w-full py-1.5 text-xs text-accent-primary hover:text-accent-primary/80 transition-colors",children:d?"Show less":`Show ${u.length-5} more`})]}),i.observationOverrideCount>0&&e.jsxs("div",{className:"pt-2 border-t border-border-muted/30 text-xs text-text-muted",children:[e.jsx("span",{className:"text-accent-primary",children:i.observationOverrideCount})," observation overrides • Avg confidence: ",e.jsxs("span",{className:"text-accent-secondary",children:[(100*i.avgPathConfidence).toFixed(0),"%"]})]})]})}const je="var(--signal-critical)",fe="var(--signal-poor)",Ne="var(--signal-fair)",ve="var(--signal-good)",be="var(--signal-excellent)",ye="var(--text-muted)";function we({active:t,payload:s}){if(!t||!s||!s.length)return null;const a=s[0].payload,n=new Date(a.timestamp),r=`${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getDate().toString().padStart(2,"0")}`;return e.jsxs("div",{className:"bg-tooltip-bg border border-border-subtle rounded px-1.5 py-0.5 text-[10px] shadow-xl",children:[e.jsx("span",{className:"text-text-muted",children:r}),e.jsx("span",{className:"ml-1.5 font-semibold tabular-nums",children:a.count})]})}const ke=t.memo(function({nodeHash:t,width:s=60,height:a=20,color:n,showArea:r=!0,showTooltip:c=!1,className:i=""}){const l=E(t),o=T(),d=n??(l.length>0?function(e){if(0===e.length)return je;const t=e.slice(-4),s=t.reduce((e,t)=>e+t.count,0),a=s/t.length,n=e.reduce((e,t)=>e+t.count,0)/e.length;if(0===s)return je;if(n>0){const e=a/n;return e>=1.2?be:e>=.8?ve:e>=.4?Ne:e>=.1?fe:je}return s>=10?be:s>=5?ve:s>=2?Ne:s>=1?fe:je}(l):ye),x="number"==typeof s?s:60,h=a,m=`sparkline-gradient-${t.slice(-6)}`;if(l.length<2){const t=o?ye:je;return e.jsx("div",{className:`flex items-center justify-center ${i}`,style:{width:x,height:h,color:t},children:e.jsx("svg",{width:x,height:h,viewBox:`0 0 ${x} ${h}`,preserveAspectRatio:"none",children:e.jsx("line",{x1:4,y1:h/2,x2:x-4,y2:h/2,stroke:"currentColor",strokeWidth:1.5,strokeDasharray:"3,2",className:o?"animate-pulse":""})})})}return e.jsx("div",{className:i,style:{width:x,height:h},children:r?e.jsxs(Z,{data:l,width:x,height:h,margin:{top:1,right:1,bottom:1,left:1},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:m,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:d,stopOpacity:.35}),e.jsx("stop",{offset:"100%",stopColor:d,stopOpacity:.05})]})}),c&&e.jsx(Q,{content:e.jsx(we,{}),cursor:{stroke:"rgba(255,255,255,0.2)",strokeWidth:1}}),e.jsx(X,{type:"monotone",dataKey:"count",stroke:"none",fill:`url(#${m})`,isAnimationActive:!1}),e.jsx(ee,{type:"monotone",dataKey:"count",stroke:d,strokeWidth:1.5,dot:!1,isAnimationActive:!1})]}):e.jsxs(te,{data:l,width:x,height:h,margin:{top:1,right:1,bottom:1,left:1},children:[c&&e.jsx(Q,{content:e.jsx(we,{}),cursor:{stroke:"rgba(255,255,255,0.2)",strokeWidth:1}}),e.jsx(ee,{type:"monotone",dataKey:"count",stroke:d,strokeWidth:1.5,dot:!1,isAnimationActive:!1})]})})}),Ce=t.memo(function({hash:s,className:a="",size:n="sm"}){const r=O(),c=R(),[i,o]=t.useState(!1),d=t.useMemo(()=>A(s),[s]),x=t.useMemo(()=>d?r.find(e=>e.prefix===d)??null:null,[d,r]),h=c.totalPaths>0&&c.avgPathConfidence>=.7,u=t.useCallback(e=>{e.preventDefault(),e.stopPropagation(),o(!0)},[]),p=t.useCallback(()=>{o(!1)},[]);if(!x)return null;const g="sm"===n?"w-3.5 h-3.5":"w-4 h-4",f=h?"text-accent-tertiary hover:text-accent-tertiary hover:bg-accent-tertiary/10 focus:ring-accent-tertiary/50":"text-signal-fair hover:text-accent-secondary hover:bg-signal-fair/10 focus:ring-signal-fair/50",N=h?`Prefix conflict resolved by Viterbi HMM (${(100*c.avgPathConfidence).toFixed(0)}% confidence)`:`Prefix conflict: ${x.candidateCount} nodes share prefix "${d}"`;return e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:u,className:`inline-flex items-center justify-center p-0.5 rounded focus:outline-none focus:ring-2 transition-colors cursor-pointer touch-manipulation ${f} ${a}`,title:N,"aria-label":`View prefix conflict for ${d}${h?" (Viterbi resolved)":""}`,children:h?e.jsxs("span",{className:"relative",children:[e.jsx(l,{className:g}),e.jsx(m,{className:"absolute -bottom-0.5 -right-0.5 w-2 h-2 text-accent-success"})]}):e.jsx(j,{className:g})}),e.jsx(ne,{isOpen:i,prefix:x.prefix,candidateHashes:x.candidateHashes,onClose:p})]})});function Me(e,t,s,a){const n=(s-e)*Math.PI/180,r=(a-t)*Math.PI/180,c=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))*6371e3}const Se=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const{stats:s}=D(),a=W(),n=K(),r=U(),c=z(),i=G(),l=B(),[o,x]=t.useState(null),[h,j]=t.useState("lastHeard"),[$,R]=t.useState("desc"),[F,_]=t.useState(""),[E,T]=t.useState(!1),[O,A]=t.useState(null),[J,Y]=t.useState(null),[Z,Q]=t.useState(null),[X,ee]=t.useState(new Map),[te,ne]=t.useState(new Map),ie=t.useMemo(()=>(null==s?void 0:s.neighbors)??{},[null==s?void 0:s.neighbors]),le=t.useMemo(()=>Object.fromEntries(Object.entries(ie).filter(([e])=>!a.has(e))),[ie,a]),de=t.useMemo(()=>{var e;return(null==(e=null==s?void 0:s.config)?void 0:e.repeater)?{latitude:s.config.repeater.latitude,longitude:s.config.repeater.longitude,name:s.config.node_name||"Local Node"}:void 0},[s]),xe=null==s?void 0:s.local_hash,he=t.useMemo(()=>{const e=new Map;if(!(null==de?void 0:de.latitude)||!(null==de?void 0:de.longitude))return e;for(const[t,s]of Object.entries(le))s.latitude&&s.longitude&&0!==s.latitude&&0!==s.longitude?e.set(t,Me(de.latitude,de.longitude,s.latitude,s.longitude)):e.set(t,null);return e},[le,de]),{neighborHashSet:me,neighborSignalMap:pe}=t.useMemo(()=>{const e=new Set,t=new Map;for(const s of i)e.add(s.hash),t.set(s.hash,{avgRssi:s.avgRssi,avgSnr:s.avgSnr});return{neighborHashSet:e,neighborSignalMap:t}},[i]),je=t.useMemo(()=>{const e=F.toLowerCase().trim(),t="neighbor"===e||"neighbors"===e,s=E||t;return Object.fromEntries(Object.entries(le).filter(([a,n])=>{if(s&&!me.has(a))return!1;if(t)return!0;if(!e)return!0;const r=(n.node_name||n.name||"").toLowerCase(),c=a.slice(2,4).toLowerCase();return r.includes(e)||c.includes(e)||a.toLowerCase().includes(e)}))},[le,F,E,me]),fe=t.useMemo(()=>Object.entries(je).sort(([e,t],[s,a])=>{let n=0;switch(h){case"lastHeard":n=(t.last_seen||0)-(a.last_seen||0);break;case"distance":{const t=he.get(e)??null,a=he.get(s)??null;n=null===t&&null===a?0:null===t?1:null===a?-1:t-a;break}case"centrality":n=(c.get(e)||0)-(c.get(s)||0)}return"desc"===$?-n:n}),[je,h,$,he,c]),Ne=fe.filter(([,e])=>e.latitude&&e.longitude&&0!==e.latitude&&0!==e.longitude).length,ve=t.useMemo(()=>new Set(r),[r]),be=t.useCallback(e=>{h===e?R(e=>"desc"===e?"asc":"desc"):(j(e),R("desc"))},[h]),ye=t.useCallback(e=>{const t=le[e];(null==t?void 0:t.latitude)&&(null==t?void 0:t.longitude)&&0!==t.latitude&&0!==t.longitude&&A(e)},[le]),we=t.useCallback(()=>{A(null)},[]),Se=t.useCallback(async(e,t)=>{if(t.stopPropagation(),!Z){Q(e),ee(t=>{const s=new Map(t);return s.delete(e),s}),ne(t=>{const s=new Map(t);return s.delete(e),s});try{const t=e.startsWith("0x")?e.slice(0,4):`0x${e.slice(0,2)}`,s=await I(t,30);s.success&&s.data?(ee(t=>new Map(t).set(e,s.data)),setTimeout(()=>{ee(t=>{const s=new Map(t);return s.delete(e),s})},1e4)):(ne(t=>new Map(t).set(e,s.error||"Ping failed")),setTimeout(()=>{ne(t=>{const s=new Map(t);return s.delete(e),s})},5e3))}catch(s){const t=s instanceof Error?s.message:"Ping failed";ne(s=>new Map(s).set(e,t)),setTimeout(()=>{ne(t=>{const s=new Map(t);return s.delete(e),s})},5e3)}finally{Q(null)}}},[Z]);return e.jsxs(re,{children:[e.jsx(ce,{title:"Contacts",icon:e.jsx(g,{}),controls:e.jsxs("div",{className:"flex items-baseline gap-3 sm:gap-4",children:[e.jsxs("span",{className:"roster-title tabular-nums",children:[fe.length," node",1!==fe.length?"s":""]}),Ne>0&&e.jsxs("span",{className:"roster-title flex items-baseline gap-1.5 tabular-nums",children:[e.jsx(u,{className:"w-3.5 h-3.5 relative top-[2px]"}),Ne," with location"]})]})}),e.jsx("div",{className:"relative",children:e.jsx(oe,{neighbors:le,localNode:de,localHash:xe,onRemoveNode:n,selectedNodeHash:O,onNodeSelected:we,highlightedEdgeKey:J})}),e.jsx(ue,{maxPaths:10,highlightedEdge:J,onHighlightEdge:Y}),l.length>0&&e.jsx("div",{className:"chart-container",children:e.jsx(ge,{neighbors:le})}),e.jsxs("div",{className:"chart-container",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"chart-title",children:[e.jsx(g,{className:"chart-title-icon"}),"Discovered Contacts"]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[me.size>0&&e.jsxs("button",{onClick:()=>T(!E),className:"flex items-center gap-1 px-1.5 sm:px-2.5 py-1.5 text-xs rounded-lg transition-colors "+(E?"bg-accent-success/20 text-accent-success border border-accent-success/30":"text-text-muted hover:text-text-secondary hover:bg-white/5 border border-transparent"),title:E?"Show all contacts":"Show only MeshCore neighbors (direct RF contact)",children:[e.jsx(f,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Neighbors"}),e.jsx("span",{className:"sm:hidden tabular-nums",children:me.size})]}),e.jsxs("div",{className:"relative",children:[e.jsx(N,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-text-muted"}),e.jsx("input",{type:"text",value:F,onChange:e=>_(e.target.value),placeholder:"Search...",className:"w-20 sm:w-28 lg:w-32 pl-6 sm:pl-7 pr-6 py-1.5 text-xs bg-white/5 border border-white/10 rounded-lg text-text-primary placeholder:text-text-muted focus:outline-none focus:border-accent-primary/50"}),F&&e.jsx("button",{onClick:()=>{_(""),"neighbor"!==F.toLowerCase().trim()&&"neighbors"!==F.toLowerCase().trim()||T(!1)},className:"absolute right-1.5 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-secondary p-0.5",children:e.jsx(v,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex items-center gap-0.5 sm:gap-1",children:[e.jsxs("button",{onClick:()=>be("lastHeard"),className:"flex items-center gap-1 p-1.5 sm:px-2 sm:py-1.5 text-xs rounded-lg transition-colors "+("lastHeard"===h?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-secondary hover:bg-white/5"),title:"Sort by last heard",children:[e.jsx(p,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Recent"}),"lastHeard"===h&&e.jsx(b,{className:"w-3 h-3 "+("asc"===$?"rotate-180":"")})]}),e.jsxs("button",{onClick:()=>be("distance"),className:"flex items-center gap-1 p-1.5 sm:px-2 sm:py-1.5 text-xs rounded-lg transition-colors "+("distance"===h?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-secondary hover:bg-white/5"),title:"Sort by distance",children:[e.jsx(y,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Distance"}),"distance"===h&&e.jsx(b,{className:"w-3 h-3 "+("asc"===$?"rotate-180":"")})]}),e.jsxs("button",{onClick:()=>be("centrality"),className:"flex items-center gap-1 p-1.5 sm:px-2 sm:py-1.5 text-xs rounded-lg transition-colors "+("centrality"===h?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-secondary hover:bg-white/5"),title:"Sort by network centrality",children:[e.jsx(d,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Centrality"}),"centrality"===h&&e.jsx(b,{className:"w-3 h-3 "+("asc"===$?"rotate-180":"")})]})]})]})]}),fe.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden sm:grid contacts-grid-header border-b border-border-subtle/50 px-3 py-2 text-[10px] uppercase tracking-wider text-text-muted",children:[e.jsx("div",{className:"contacts-col-node",children:"Node"}),e.jsx("div",{className:"contacts-col-signal text-right",children:"Signal"}),e.jsx("div",{className:"contacts-col-distance text-right",children:"Distance"}),e.jsx("div",{className:"contacts-col-centrality text-right",children:"Centrality"}),e.jsx("div",{className:"contacts-col-activity text-center",children:"Activity"}),e.jsx("div",{className:"contacts-col-seen text-right",children:"Last Seen"}),e.jsx("div",{className:"contacts-col-actions"})]}),e.jsx("div",{className:"divide-y divide-border-subtle/30",children:fe.map(([t,s])=>{var a;const n=s.latitude&&s.longitude&&0!==s.latitude&&0!==s.longitude,r=s.node_name||s.name||"Unknown",i=ve.has(t),l=me.has(t),o=he.get(t),h=c.get(t)||0,u=l?pe.get(t):void 0,p=l&&u,g=null==(a=s.contact_type)?void 0:a.toLowerCase(),j="room server"===g||"room_server"===g||"room"===g||"server"===g,f="companion"===g||"client"===g||"cli"===g,N=s.is_repeater||"repeater"===g||"rep"===g,v=l?"direct":"flood",b=l?"Direct RF contact (zero-hop neighbor)":"Flood routing (multi-hop via mesh)";return e.jsxs("div",{className:`contacts-grid-row ${i?"bg-amber-500/5 border-l-2 border-l-amber-400":""} ${n?"cursor-pointer hover:bg-white/[0.02]":""}`,onClick:()=>ye(t),children:[e.jsxs("div",{className:"contacts-col-node flex items-center gap-2 min-w-0",children:[p&&null!==(null==u?void 0:u.avgSnr)?e.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0 self-center "+(R=u.avgSnr,void 0===R?"bg-[var(--signal-unknown)]":R>=5?"bg-[var(--signal-excellent)]":R>=0?"bg-[var(--signal-good)]":R>=-5?"bg-[var(--signal-fair)]":R>=-10?"bg-[var(--signal-poor)]":"bg-[var(--signal-critical)]")}):e.jsx("div",{className:"w-2 flex-shrink-0"}),e.jsx("div",{className:"roster-icon flex-shrink-0",title:b,children:j&&N?e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx(w,{className:"w-5 h-5 absolute inset-0 text-accent-secondary"}),e.jsx(k,{className:"w-2.5 h-2.5 absolute -bottom-0.5 -right-0.5 text-accent-primary"})]}):j?e.jsx(w,{className:"w-5 h-5 text-accent-secondary"}):f?e.jsx(C,{className:"w-5 h-5 text-text-muted"}):N?"direct"===v?e.jsx(M,{className:"w-5 h-5 text-accent-success"}):e.jsx(k,{className:"w-5 h-5 text-accent-tertiary"}):e.jsx(C,{className:"w-5 h-5 text-text-muted"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 overflow-hidden",children:[e.jsx("span",{className:"roster-title truncate",title:r,children:r}),l&&e.jsx("span",{className:"type-badge px-1.5 py-0.5 rounded flex-shrink-0",style:{backgroundColor:"rgba(113, 152, 114, 0.2)",color:"var(--accent-success)"},children:"NBR"}),i&&e.jsxs("span",{className:"type-badge px-1.5 py-0.5 rounded flex items-center gap-1 flex-shrink-0",style:{backgroundColor:"rgba(223, 188, 114, 0.2)",color:"var(--accent-secondary)"},children:[e.jsx(S,{className:"w-3 h-3"}),"HUB"]}),N&&e.jsx("span",{className:"pill-tag flex-shrink-0",children:"RPT"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[e.jsx(se,{hash:t,size:"xs",prefixLength:8,suffixLength:6}),e.jsx(Ce,{hash:t})]})]})]}),e.jsxs("div",{className:"contacts-col-signal flex items-center justify-end gap-2",children:[p&&null!==(null==u?void 0:u.avgRssi)&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{rssi:u.avgRssi,className:"w-3.5 h-3.5"}),e.jsx("span",{className:"type-data-xs tabular-nums text-text-muted",children:Math.round(u.avgRssi)})]}),p&&null!==(null==u?void 0:u.avgSnr)&&e.jsxs("span",{className:"type-data-xs tabular-nums text-text-muted",children:[u.avgSnr.toFixed(1)," dB"]})]}),e.jsx("div",{className:"contacts-col-distance flex items-center justify-end gap-1 text-text-muted",children:null!=o&&e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-3 h-3"}),e.jsx("span",{className:"type-data-xs tabular-nums",children:($=o,$<1e3?`${Math.round($)}m`:`${($/1e3).toFixed(1)}km`)})]})}),e.jsx("div",{className:"contacts-col-centrality flex items-center justify-end gap-1",children:h>0&&e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"w-3 h-3 text-accent-secondary"}),e.jsxs("span",{className:"type-data-xs tabular-nums text-text-muted",children:[(100*h).toFixed(0),"%"]})]})}),e.jsx("div",{className:"contacts-col-activity flex items-center justify-center",children:e.jsx(ke,{nodeHash:t,width:48,height:16})}),e.jsx("div",{className:"contacts-col-seen flex items-center justify-end",children:e.jsx("span",{className:"type-data-xs tabular-nums text-text-primary whitespace-nowrap",children:s.last_seen?V(s.last_seen):"—"})}),e.jsxs("div",{className:"contacts-col-actions flex items-center justify-end gap-1",children:[l&&e.jsx(e.Fragment,{children:X.has(t)?e.jsxs("div",{className:"flex items-center gap-1 text-accent-success",title:`RTT: ${X.get(t).rtt_ms.toFixed(0)}ms`,children:[e.jsx(m,{className:"w-3.5 h-3.5"}),e.jsxs("span",{className:"type-data-xs tabular-nums hidden sm:inline",children:[X.get(t).snr_db.toFixed(1),"dB"]})]}):te.has(t)?e.jsx("span",{className:"text-red-400 text-[10px]",title:te.get(t),children:"✗"}):e.jsx("button",{onClick:e=>Se(t,e),disabled:null!==Z,className:"p-1 sm:p-1.5 rounded-lg text-text-muted/50 hover:text-accent-primary hover:bg-accent-primary/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Ping neighbor for updated signal info",children:Z===t?e.jsx(L,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),x({hash:t,name:r})},className:"p-1 sm:p-1.5 rounded-lg text-text-muted/50 hover:text-red-400 hover:bg-red-500/10 transition-colors",title:"Remove contact",children:e.jsx(P,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})]})]},t);var $,R})})]}):e.jsxs("div",{className:"roster-empty",children:[e.jsx(g,{className:"roster-empty-icon"}),e.jsx("div",{className:"type-label text-text-secondary",children:"No Contacts Discovered"}),e.jsx("div",{className:"type-data-xs text-text-muted mt-1",children:"Contacts will appear here as they advertise on the mesh network."})]})]}),e.jsx(ae,{isOpen:!!o,title:"Remove Contact",message:`Are you sure you would like to remove ${(null==o?void 0:o.name)||"this contact"}?`,confirmLabel:"Remove",cancelLabel:"Cancel",variant:"danger",onConfirm:()=>{o&&n(o.hash),x(null)},onCancel:()=>x(null)})]})}},Symbol.toStringTag,{value:"Module"}));export{Se as C,ke as N,Ce as P};
