import{r as e,j as s,c as a}from"./vendor-react-Co0R0q1H.js";import{c as t,dw as l,dx as i,b$ as n,B as c,L as d,p as r,ab as m,cj as o,aM as x}from"./index-DqKbxKNs.js";import{C as h,T as u}from"./ConfirmModal-DY-sgBQD.js";import{D as p}from"./DataBox-DlnGnPLj.js";import{P as y,b as j,B as f,a as b}from"./PageLayout-BsguBtK-.js";import{R as g}from"./refresh-cw-CVz6XHrp.js";import{R as N,C as v}from"./Grid-CTmu8x0g.js";import{C as w}from"./circle-question-mark-B7d1rYjU.js";import{T as k}from"./triangle-alert-BYQiMrfu.js";import{S as _}from"./shield-W5bqR1Qf.js";import{a as C}from"./Card-CP0taT8c.js";import{A as S}from"./antenna-B5-Jo6mG.js";import"./maplibre-gl-b91ci4Kr.js";import"./vendor-core-B_fdKJ1g.js";const A=t("badge-check",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),M=t("layout-grid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),L=t("lock-keyhole",[["circle",{cx:"12",cy:"16",r:"1",key:"1au0dj"}],["rect",{x:"3",y:"10",width:"18",height:"12",rx:"2",key:"6s8ecr"}],["path",{d:"M7 10V7a5 5 0 0 1 10 0v3",key:"1pqi11"}]]),R=t("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),I=[{id:"overview",label:"Overview",icon:M},{id:"clients",label:"Authenticated Clients",icon:t("user-check",[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},{id:"identities",label:"By Identity",icon:A}];function P(e){return e?new Date(1e3*e).toLocaleString():"Never"}function $(e){if(!e)return"Never";const s=Date.now()-1e3*e,a=Math.floor(s/6e4),t=Math.floor(s/36e5),l=Math.floor(s/864e5);return a<1?"Just now":a<60?`${a}m ago`:t<24?`${t}h ago`:l<365?`${l}d ago`:`${Math.floor(l/365)}y ago`}function D({label:e,value:a,icon:t}){return s.jsxs(b,{neomorphic:!0,children:[s.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-2 sm:mb-3",children:[t&&s.jsx("span",{className:"icon-sm text-icon-card-title",children:t}),s.jsx("span",{className:"type-micro",children:e})]}),s.jsx(C,{centered:!0,children:s.jsx("span",{className:"type-data-xl text-fg-primary font-mono font-normal tabular-nums",children:a})})]})}function F({identity:e}){const t="repeater"===e.type;return s.jsxs(b,{neomorphic:!0,className:"bg-subtle-fill",children:[s.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-3",children:[s.jsx("span",{className:"icon-sm text-icon-card-title",children:t?s.jsx(S,{className:"w-4 h-4"}):s.jsx(x,{className:"w-4 h-4"})}),s.jsx("span",{className:"type-micro",children:e.name}),s.jsx(p,{copy:!0,size:"compact",truncate:[8,6],color:"text-fg-muted",children:e.hash}),s.jsx("span",{className:"data-box data-box-compact data-box-outlined ml-auto",style:{"--data-box-accent":t?"var(--sys-blue)":"var(--sys-pink)"},children:e.type})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"data-box-label",children:"Max Clients"}),s.jsx("div",{className:"data-box data-box-fill data-box-left",children:e.max_clients})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"data-box-label",children:"Authenticated"}),s.jsx("div",{className:"data-box data-box-fill data-box-left",children:e.authenticated_clients})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"data-box-label",children:"Admin Password"}),s.jsx("div",{className:"data-box data-box-fill data-box-left",style:{"--data-box-color":e.has_admin_password?"var(--sys-green)":"var(--sys-red)"},children:e.has_admin_password?"✓ Set":"✗ Not Set"})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"data-box-label",children:"Guest Password"}),s.jsx("div",{className:"data-box data-box-fill data-box-left",style:{"--data-box-color":e.has_guest_password?"var(--sys-green)":"var(--sys-red)"},children:e.has_guest_password?"✓ Set":"✗ Not Set"})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"data-box-label",children:"Read-Only Access"}),s.jsx("div",{className:a("data-box data-box-fill data-box-left",e.allow_read_only?"text-sys-green":"text-sys-red"),children:e.allow_read_only?"Allowed":"Disabled"})]})]})]})}function K({client:e,onRemove:t}){return s.jsx("div",{className:"bg-subtle-fill radius-inner p-4 transition-base hover:bg-subtle-fill-strong",children:s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[s.jsxs("div",{className:"flex-1 min-w-0 grid grid-cols-1 sm:grid-cols-5 gap-2 sm:gap-4 items-center",children:[s.jsxs("div",{className:"sm:col-span-1",children:[s.jsx("span",{className:"type-data-xs text-fg-muted block sm:hidden mb-0.5",children:"Client"}),s.jsx("span",{className:"type-data-sm text-fg-primary font-mono truncate block",children:e.public_key})]}),s.jsxs("div",{className:"sm:col-span-1",children:[s.jsx("span",{className:"type-data-xs text-fg-muted block sm:hidden mb-0.5",children:"Address"}),s.jsx("span",{className:"type-data-xs text-fg-muted font-mono truncate block",children:e.address})]}),s.jsxs("div",{className:"sm:col-span-1",children:[s.jsx("span",{className:"type-data-xs text-fg-muted block sm:hidden mb-0.5",children:"Identity"}),s.jsx("span",{className:"type-data-sm text-fg-primary block truncate",children:e.identity_name}),s.jsx("span",{className:"type-data-xs text-fg-muted block truncate",children:e.identity_hash})]}),s.jsxs("div",{className:"sm:col-span-1",children:[s.jsx("span",{className:"type-data-xs text-fg-muted block sm:hidden mb-0.5",children:"Permissions"}),s.jsx("span",{className:a("type-data-xs px-2 py-0.5 rounded-full font-medium inline-block","admin"===e.permissions?"bg-sys-green/15 text-sys-green":"bg-sys-amber/15 text-sys-amber"),children:e.permissions})]}),s.jsxs("div",{className:"sm:col-span-1",children:[s.jsx("span",{className:"type-data-xs text-fg-muted block sm:hidden mb-0.5",children:"Last Activity"}),s.jsx("span",{className:"type-data-xs text-fg-muted",children:$(e.last_activity)})]})]}),s.jsxs(c,{color:"danger",outline:!0,onClick:t,className:"flex-shrink-0",children:[s.jsx(u,{"data-slot":"icon"}),"Remove"]})]})})}function q({client:e,onRemove:t}){return s.jsx("div",{className:"bg-subtle-fill radius-inner p-4 transition-base hover:bg-subtle-fill-strong",children:s.jsxs("div",{className:"flex items-start justify-between gap-3",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("span",{className:a("type-data-xs px-2 py-0.5 rounded-full font-medium","admin"===e.permissions?"bg-sys-green/15 text-sys-green":"bg-sys-amber/15 text-sys-amber"),children:e.permissions}),s.jsx("span",{className:"type-data-sm text-fg-primary font-mono truncate",children:e.public_key})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-fg-muted",children:"Address: "}),s.jsx("span",{className:"text-fg-primary/90 font-mono",children:e.address})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-fg-muted",children:"Identity: "}),s.jsxs("span",{className:"text-fg-primary/90",children:[e.identity_name," (",e.identity_hash,")"]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-fg-muted",children:"Last Activity: "}),s.jsx("span",{className:"text-fg-primary/90",children:P(e.last_activity)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-fg-muted",children:"Last Login: "}),s.jsx("span",{className:"text-fg-primary/90",children:P(e.last_login_success)})]})]})]}),s.jsx(c,{color:"danger",outline:!0,onClick:t,className:"flex-shrink-0",children:s.jsx(u,{"data-slot":"icon"})})]})})}function z(){const[t,x]=e.useState("overview"),[u,p]=e.useState(!0),[C,S]=e.useState(!1),[A,M]=e.useState("idle"),[P,$]=e.useState(null),[z,B]=e.useState(null),[E,H]=e.useState([]),[T,G]=e.useState(null),[O,V]=e.useState(null),[J,Z]=e.useState(null),[Q,U]=e.useState(!1),W=(null==z?void 0:z.acls)??[],X=e.useMemo(()=>O?E.filter(e=>e.identity_name===O):E,[E,O]),Y=e.useCallback(async()=>{$(null);try{const[e,s,a]=await Promise.all([l(),i(),n()]);e.success&&e.data&&B(e.data),s.success&&s.data&&H(s.data.clients||[]),a.success&&a.data&&G(a.data)}catch(e){$(e instanceof Error?e.message:"Failed to load session data")}},[]);e.useEffect(()=>{Y().finally(()=>p(!1))},[Y]);const ee=async()=>{S(!0),M("loading"),await Y(),S(!1),M("success"),setTimeout(()=>M("idle"),1500)};return s.jsxs(y,{children:[s.jsx(j,{title:"Sessions",icon:s.jsx(m,{}),controls:s.jsxs(c,{color:"success"===A?"success":"primary",outline:!0,onClick:ee,disabled:C,children:["loading"===A?s.jsx(d,{"data-slot":"icon",className:"animate-spin"}):"success"===A?s.jsx(r,{"data-slot":"icon"}):s.jsx(g,{"data-slot":"icon"}),"success"===A?"Done":"Refresh"]}),subtitle:s.jsx("p",{className:"type-body-sm text-fg-muted",children:"Manage authenticated clients and access control lists"})}),s.jsxs(f,{children:[T&&s.jsxs(N,{template:"widget",children:[s.jsx(v,{span:6,md:3,children:s.jsx(D,{label:"Identities",value:T.total_identities,icon:s.jsx(m,{className:"w-4 h-4"})})}),s.jsx(v,{span:6,md:3,children:s.jsx(D,{label:"Authenticated",value:T.total_clients,icon:s.jsx(L,{className:"w-4 h-4"})})}),s.jsx(v,{span:6,md:3,children:s.jsx(D,{label:"Admin",value:T.admin_clients,icon:s.jsx(R,{className:"w-4 h-4"})})}),s.jsx(v,{span:6,md:3,children:s.jsx(D,{label:"Guest",value:T.guest_clients,icon:s.jsx(w,{className:"w-4 h-4"})})})]}),s.jsx(N,{template:"auto",children:s.jsxs(b,{neomorphic:!0,children:[s.jsx("div",{className:"flex flex-wrap gap-1 mb-5",children:s.jsx("div",{className:"toggle-group",children:I.map(e=>{const l=t===e.id;return s.jsxs("button",{onClick:()=>x(e.id),className:a("toggle-group-item flex items-center gap-1.5",l&&"active"),children:[s.jsx(e.icon,{className:"w-3.5 h-3.5"}),e.label]},e.id)})})}),s.jsx("div",{className:"min-h-[300px]",children:u?s.jsxs("div",{className:"flex items-center justify-center py-12",children:[s.jsx(d,{className:"w-6 h-6 animate-spin text-sys-blue mr-3"}),s.jsx("span",{className:"type-body text-fg-muted",children:"Loading session data..."})]}):P?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"w-12 h-12 rounded-full bg-sys-red/10 mx-auto mb-3 flex items-center justify-center",children:s.jsx(k,{className:"w-6 h-6 text-sys-red"})}),s.jsx("p",{className:"type-body text-sys-red mb-2",children:"Failed to load session data"}),s.jsx("p",{className:"type-body-sm text-fg-muted mb-4",children:P}),s.jsx(c,{color:"primary",outline:!0,onClick:ee,children:"Retry"})]}):s.jsxs(s.Fragment,{children:["overview"===t&&s.jsx("div",{className:"space-y-4",children:0===W.length?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"w-14 h-14 rounded-full bg-subtle-fill mx-auto mb-4 flex items-center justify-center",children:s.jsx(R,{className:"w-7 h-7 text-fg-muted/50"})}),s.jsx("p",{className:"type-body text-fg-muted",children:"No identities configured"})]}):W.map(e=>s.jsx(F,{identity:e},e.hash))}),"clients"===t&&s.jsxs("div",{className:"space-y-3",children:[E.length>0&&s.jsxs("div",{className:"hidden sm:grid grid-cols-5 gap-4 px-4 pb-2 border-b border-edge-subtle",children:[s.jsx("span",{className:"type-data-xs text-fg-muted font-medium",children:"Client"}),s.jsx("span",{className:"type-data-xs text-fg-muted font-medium",children:"Address"}),s.jsx("span",{className:"type-data-xs text-fg-muted font-medium",children:"Identity"}),s.jsx("span",{className:"type-data-xs text-fg-muted font-medium",children:"Permissions"}),s.jsx("span",{className:"type-data-xs text-fg-muted font-medium",children:"Last Activity"})]}),0===E.length?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"w-14 h-14 rounded-full bg-subtle-fill mx-auto mb-4 flex items-center justify-center",children:s.jsx(m,{className:"w-7 h-7 text-fg-muted/50"})}),s.jsx("p",{className:"type-body text-fg-muted",children:"No authenticated clients"})]}):E.map(e=>s.jsx(K,{client:e,onRemove:()=>Z({publicKey:e.public_key_full,identityHash:e.identity_hash,displayKey:e.public_key})},e.public_key_full))]}),"identities"===t&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-fg-muted block mb-2",children:"Filter by Identity"}),s.jsxs("select",{value:O??"",onChange:e=>V(e.target.value||null),className:"w-full sm:w-auto bg-subtle-fill border border-edge-subtle radius-inner px-4 py-2 type-data text-fg-primary focus:outline-none focus:border-sys-blue/50 transition-colors",children:[s.jsx("option",{value:"",children:"All Identities"}),W.map(e=>s.jsxs("option",{value:e.name,children:[e.name," (",e.authenticated_clients," clients)"]},e.name))]})]}),0===X.length?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"w-14 h-14 rounded-full bg-subtle-fill mx-auto mb-4 flex items-center justify-center",children:s.jsx(_,{className:"w-7 h-7 text-fg-muted/50"})}),s.jsx("p",{className:"type-body text-fg-muted",children:O?"No clients for selected identity":"No clients found"})]}):s.jsx("div",{className:"space-y-3",children:X.map(e=>s.jsx(q,{client:e,onRemove:()=>Z({publicKey:e.public_key_full,identityHash:e.identity_hash,displayKey:e.public_key})},e.public_key_full))})]})]})})]})})]}),s.jsx(h,{isOpen:!!J,title:"Remove Client",message:`Are you sure you want to remove client '${null==J?void 0:J.displayKey}' from the ACL? This will disconnect the client.`,confirmLabel:Q?"Removing...":"Remove",cancelLabel:"Cancel",variant:"danger",onConfirm:async()=>{if(J){U(!0);try{const e=await o({public_key:J.publicKey,identity_hash:J.identityHash});e.success?await Y():$(`Failed to remove client: ${e.error}`)}catch(e){$(e instanceof Error?e.message:"Failed to remove client")}finally{U(!1),Z(null)}}},onCancel:()=>Z(null)})]})}export{z as default};
