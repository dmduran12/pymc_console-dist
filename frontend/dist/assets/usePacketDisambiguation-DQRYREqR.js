import{r as e,j as n}from"./vendor-react-Co0R0q1H.js";import{c as t,M as s,C as a,m as r,i as o}from"./TimeRangeStepper-C6x7icr9.js";import{c as l,a7 as i,R as u,B as c,H as d}from"./index-rO1UlJSY.js";import{F as p,M as m}from"./monitor-smartphone-Dj-785oH.js";import{S as h}from"./search-0DzTMYLg.js";import{b as x}from"./prefix-disambiguation-C9_JUdtD.js";const f=l("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),b=l("droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);function v(e,n){const t=new Date(1e3*e),s=e=>e.toString().padStart(2,"0"),a=`${s(t.getHours())}:${s(t.getMinutes())}`;return n<=24?a:`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]} ${t.getDate()} ${a}`}const g=[{type:"repeater",label:"Repeater",icon:u,buttonColor:"primary",iconColor:"text-sys-blue",hoverClass:"hover:border-sys-blue hover:text-sys-blue hover:!bg-transparent"},{type:"companion",label:"Companion",icon:m,buttonColor:"indigo",iconColor:"text-sys-indigo",hoverClass:"hover:border-sys-indigo hover:text-sys-indigo hover:!bg-transparent"},{type:"room_server",label:"Room",icon:s,buttonColor:"purple",iconColor:"text-sys-purple",hoverClass:"hover:border-sys-purple hover:text-sys-purple hover:!bg-transparent"},{type:"unknown",label:"Unknown",icon:a,buttonColor:"zinc",iconColor:"text-zinc-400",hoverClass:"hover:border-zinc-400 hover:text-zinc-400 hover:!bg-transparent"}],y=60,w=.005;function j({min:t,max:s,valueStart:a,valueEnd:r,onChange:o}){const l=e.useRef(null),[i,u]=e.useState(null),c=e.useRef({valueStart:a,valueEnd:r,min:t,max:s});c.current={valueStart:a,valueEnd:r,min:t,max:s};const d=e.useRef({offset:0,width:0}),p=s-t||1,m=p/3600,h=a??t,x=r??s,f=(h-t)/p*100,b=(x-t)/p*100,g=null!==a||null!==r,j=e.useCallback(e=>{const n=l.current.getBoundingClientRect(),t=Math.max(0,Math.min(1,(e-n.left)/n.width)),{min:s,max:a}=c.current;return Math.round(s+t*(a-s||1))},[]),C=e.useCallback((e,n)=>{n.preventDefault(),n.stopPropagation();const t=n.currentTarget;t.setPointerCapture(n.pointerId),u(e);const s=n=>{const t=j(n.clientX),{valueStart:s,valueEnd:a,min:r,max:l}=c.current,i=l-r||1;if("start"===e){const e=Math.min(t,(a??l)-y);o(e<=r+i*w?null:e,a)}else{const e=Math.max(t,(s??r)+y);o(s,e>=l-i*w?null:e)}},a=()=>{u(null),t.removeEventListener("pointermove",s),t.removeEventListener("pointerup",a),t.removeEventListener("pointercancel",a)};t.addEventListener("pointermove",s),t.addEventListener("pointerup",a),t.addEventListener("pointercancel",a)},[j,o]),k=e.useCallback(e=>{e.preventDefault(),e.stopPropagation();const n=e.currentTarget;n.setPointerCapture(e.pointerId),u("range");const t=c.current.valueStart??c.current.min,s=c.current.valueEnd??c.current.max;d.current={offset:j(e.clientX)-t,width:s-t};const a=e=>{const n=j(e.clientX),{min:t,max:s}=c.current,{offset:a,width:r}=d.current;let l=n-a;l=Math.max(t,Math.min(s-r,l));const i=l+r;o(Math.round(l)<=t?null:Math.round(l),Math.round(i)>=s?null:Math.round(i))},r=()=>{u(null),n.removeEventListener("pointermove",a),n.removeEventListener("pointerup",r),n.removeEventListener("pointercancel",r)};n.addEventListener("pointermove",a),n.addEventListener("pointerup",r),n.addEventListener("pointercancel",r)},[j,o]),N=e.useCallback(e=>{const n=j(e.clientX),{valueStart:t,valueEnd:s,min:a,max:r}=c.current,l=r-a||1,i=t??a,u=s??r;if(Math.abs(n-i)<=Math.abs(n-u)){const e=Math.min(n,u-y);o(e<=a+l*w?null:e,s)}else{const e=Math.max(n,i+y);o(t,e>=r-l*w?null:e)}},[j,o]),M=e.useCallback(()=>o(null,null),[o]),S=e.useCallback((e,n)=>{const t="ArrowRight"===n.key||"ArrowUp"===n.key?1:"ArrowLeft"===n.key||"ArrowDown"===n.key?-1:0;if(!t)return;n.preventDefault();const s=(n.shiftKey?.1:.01)*p,{valueStart:a,valueEnd:r,min:l,max:i}=c.current,u=i-l||1;if("start"===e){const e=Math.max(l,Math.min((a??l)+t*s,(r??i)-y));o(e<=l+u*w?null:e,r)}else{const e=Math.min(i,Math.max((r??i)+t*s,(a??l)+y));o(a,e>=i-u*w?null:e)}},[p,o]),_=e=>{const n=i===e;return["absolute top-1/2 -translate-y-1/2 -translate-x-1/2 w-1 h-4 rounded-full","before:content-[''] before:absolute before:-inset-x-3 before:-inset-y-1","touch-none outline-none",n?"cursor-grabbing":"cursor-ew-resize",n?"bg-sys-blue shadow-[0_0_8px_var(--sys-blue)] scale-x-150 z-20":("start"===e?null!==a:null!==r)?"bg-sys-blue shadow-[0_0_4px_var(--sys-blue)] hover:shadow-[0_0_8px_var(--sys-blue)] hover:scale-x-150 z-10":"bg-edge-subtle hover:bg-fg-muted hover:scale-x-150 z-10",n?"":"transition-[transform,box-shadow,background-color] duration-150 ease-out","focus-visible:ring-2 focus-visible:ring-sys-blue/50"].filter(Boolean).join(" ")};return n.jsxs("div",{className:"flex flex-col gap-0.5 min-w-[160px] sm:min-w-[220px]",children:[n.jsxs("div",{className:"flex items-center justify-between type-data-xs text-fg-muted tabular-nums select-none",children:[n.jsx("span",{className:g&&null!==a?"text-sys-blue":"",children:v(h,m)}),n.jsx("span",{className:g&&null!==r?"text-sys-blue":"",children:v(x,m)})]}),n.jsxs("div",{ref:l,className:"relative h-5 select-none",onPointerDown:N,onDoubleClick:M,children:[n.jsx("div",{className:"absolute inset-x-0 top-1/2 -translate-y-1/2 h-1.5 rounded-full bg-white/[0.06] pointer-events-none"}),g?n.jsx("div",{className:["group/band absolute inset-y-0 touch-none","range"===i?"cursor-grabbing":"cursor-grab"].join(" "),style:{left:`${f}%`,right:100-b+"%"},onPointerDown:k,children:n.jsx("div",{className:["absolute inset-x-0 top-1/2 -translate-y-1/2 h-1.5 rounded-full pointer-events-none transition-colors","range"===i?"bg-sys-blue/40":"bg-sys-blue/25 group-hover/band:bg-sys-blue/35"].join(" ")})}):n.jsx("div",{className:"absolute inset-x-0 top-1/2 -translate-y-1/2 h-1.5 rounded-full bg-white/[0.04] pointer-events-none"}),n.jsx("div",{role:"slider",tabIndex:0,"aria-label":"Range start","aria-valuenow":h,className:_("start"),style:{left:`${f}%`},onPointerDown:e=>C("start",e),onKeyDown:e=>S("start",e)}),n.jsx("div",{role:"slider",tabIndex:0,"aria-label":"Range end","aria-valuenow":x,className:_("end"),style:{left:`${b}%`},onPointerDown:e=>C("end",e),onKeyDown:e=>S("end",e)})]})]})}function C({parentStartTs:s,parentEndTs:a,neighbors:r,filter:o,onChange:l,scatterDotSize:u,onScatterDotSizeChange:d,scatterOpacity:m,onScatterOpacityChange:x}){const[v,y]=e.useState(""),[w,C]=e.useState(!1),N=e.useRef(null);e.useEffect(()=>{function e(e){N.current&&!N.current.contains(e.target)&&C(!1)}if(w)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[w]);const M=e.useMemo(()=>Object.entries(r).map(([e,n])=>{const s=t(n);return{hash:e,name:n.name??n.node_name??e.slice(0,8),type:s.type,label:s.label}}).sort((e,n)=>e.name.localeCompare(n.name)),[r]),S=e.useMemo(()=>{if(!v)return M;const e=v.toLowerCase();return M.filter(n=>n.name.toLowerCase().includes(e)||n.hash.toLowerCase().includes(e))},[M,v]),_=null!==o.timeStart||null!==o.timeEnd||o.deviceTypes.size>0||o.nodeIds.size>0,E=e.useCallback((e,n)=>{l({...o,timeStart:e,timeEnd:n})},[o,l]),T=e.useCallback(e=>{const n=new Set(o.deviceTypes);n.has(e)?n.delete(e):n.add(e),l({...o,deviceTypes:n})},[o,l]),z=e.useCallback(e=>{const n=new Set(o.nodeIds);n.has(e)?n.delete(e):n.add(e),l({...o,nodeIds:n}),y("")},[o,l]),L=e.useCallback(e=>{const n=new Set(o.nodeIds);n.delete(e),l({...o,nodeIds:n})},[o,l]),$=e.useCallback(()=>{l({timeStart:null,timeEnd:null,deviceTypes:new Set,nodeIds:new Set}),y("")},[l]),I=e.useMemo(()=>{const e=new Map;for(const n of o.nodeIds){const t=r[n];e.set(n,(null==t?void 0:t.name)??(null==t?void 0:t.node_name)??n.slice(0,8))}return e},[o.nodeIds,r]),D=!(!d||!x);return n.jsxs("div",{className:"flex flex-col gap-2 card-padding",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[D&&n.jsxs(n.Fragment,{children:[n.jsx(k,{icon:n.jsx(f,{className:"w-3 h-3"}),label:"Size",value:u??.8,onChange:d,min:.3,max:3,step:.1,format:e=>e.toFixed(1)}),n.jsx(k,{icon:n.jsx(b,{className:"w-3 h-3"}),label:"Opacity",value:m??50,onChange:x,min:5,max:100,step:5,format:e=>`${Math.round(e)}%`}),n.jsx("div",{className:"w-px h-4 bg-edge-subtle shrink-0 hidden sm:block"})]}),n.jsx("div",{className:"flex items-center gap-1.5 text-fg-muted shrink-0",children:n.jsx(p,{className:"w-3.5 h-3.5"})}),n.jsx("div",{className:"flex-1 min-w-[120px]",children:n.jsx(j,{min:s,max:a,valueStart:o.timeStart,valueEnd:o.timeEnd,onChange:E})}),_&&n.jsxs("button",{type:"button",onClick:$,className:"flex items-center gap-1 px-2 py-0.5 rounded-full type-data-xs text-fg-muted hover:text-fg-primary border border-edge-subtle hover:border-fg-muted/40 transition-colors shrink-0",title:"Clear all filters",children:[n.jsx(i,{className:"w-3 h-3"}),n.jsx("span",{className:"hidden sm:inline",children:"Clear"})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("div",{className:"flex items-center gap-1.5 overflow-x-auto pb-0.5 -mb-0.5 shrink-0",children:g.map(({type:e,label:t,icon:s,buttonColor:a,iconColor:r,hoverClass:l})=>{const i=o.deviceTypes.has(e);return n.jsxs(c,{color:i?a:"zinc",outline:!i,className:`!h-8 !py-0 ${i?"":l}`,onClick:()=>T(e),title:`Filter by ${t}`,children:[n.jsx(s,{"data-slot":"icon",className:i?"":r}),n.jsx("span",{className:"hidden sm:inline "+(i?"":"text-fg-muted"),children:t})]},e)})}),n.jsx("div",{className:"w-px h-4 bg-edge-subtle shrink-0 hidden md:block"}),n.jsxs("div",{className:"relative flex items-center gap-1.5 flex-1 min-w-[120px] sm:min-w-[180px] h-8 px-2 rounded-md border border-edge-subtle bg-white/[0.03] transition-colors focus-within:border-sys-blue",ref:N,children:[n.jsx(h,{className:"w-3 h-3 text-fg-muted/50 shrink-0"}),n.jsx("input",{type:"text",className:"flex-1 min-w-[60px] type-data-xs py-0.5 bg-transparent text-fg-secondary placeholder:text-fg-muted/40 border-none focus:outline-none",placeholder:"Search nodes...",value:v,onChange:e=>{y(e.target.value),C(!0)},onFocus:()=>C(!0)}),w&&S.length>0&&n.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 z-[200] surface-popover border border-edge-subtle radius-inner max-h-48 overflow-y-auto",children:S.slice(0,20).map(e=>{const t=o.nodeIds.has(e.hash);return n.jsxs("button",{type:"button",onClick:()=>z(e.hash),className:`\n                      w-full flex items-center gap-2 px-2.5 py-1.5 type-data-xs text-left transition-colors\n                      ${t?"bg-sys-indigo/15 text-sys-indigo":"text-fg-secondary hover:bg-subtle-fill"}\n                    `,children:[n.jsx("span",{className:"flex-1 truncate",children:e.name}),n.jsx("span",{className:"text-fg-muted type-data-xs shrink-0",children:e.label})]},e.hash)})})]})]}),o.nodeIds.size>0&&n.jsx("div",{className:"flex flex-wrap items-center gap-1.5",children:Array.from(o.nodeIds).map(e=>n.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-sys-indigo/15 text-sys-indigo type-data-xs border border-sys-indigo/25 transition-colors hover:bg-sys-indigo/25",children:[I.get(e)??e.slice(0,8),n.jsx("button",{type:"button",onClick:()=>L(e),className:"hover:text-fg-primary transition-colors -mr-0.5",children:n.jsx(i,{className:"w-3 h-3"})})]},e))})]})}const k=e.memo(function({icon:e,label:t,value:s,onChange:a,min:r,max:o,step:l,format:i}){return n.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[n.jsxs("div",{className:"flex items-center gap-1.5 text-fg-muted shrink-0",children:[e,n.jsx("span",{className:"type-data-xs font-medium hidden sm:inline",children:t})]}),n.jsx("input",{type:"range",min:r,max:o,step:l,value:s,onChange:e=>a(parseFloat(e.target.value)),className:"flex-1 h-1 min-w-[60px] bg-subtle-fill rounded appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-2.5 [&::-webkit-slider-thumb]:h-2.5 [&::-webkit-slider-thumb]:bg-sys-blue [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer"}),n.jsx("span",{className:"type-data-xs text-fg-secondary tabular-nums shrink-0 w-8 text-right",children:i?i(s):s})]})});function N(){return{timeStart:null,timeEnd:null,deviceTypes:new Set,nodeIds:new Set}}function M(e){return e.name||e.node_name||null}function S(e,n,t,s){return{hash:e,type:n,name:t,isRepeater:"repeater"===n,isCompanion:"companion"===n,confident:s}}const _=Object.freeze(S(null,"unknown",null,!1));function E(n,s){const a=e.useMemo(()=>{const e=new Map,n=new Map,a=new Map,r=new Map;for(const[i,u]of Object.entries(s)){const s=t(u).type;e.set(i,s);const o=(i.startsWith("0x")?i.slice(2):i).toLowerCase();n.set(o,i);const l=d(i),c=M(u);let p=a.get(l);p||(p=[],a.set(l,p)),p.push({hash:i,name:c,type:s});const m=r.get(l)||{repeaters:0,others:0};"repeater"===s?m.repeaters++:m.others++,r.set(l,m)}const o=new Set,l=new Set;for(const[t,s]of r)s.repeaters>0&&s.others>0&&o.add(t),(s.repeaters>=2||s.others>=2)&&l.add(t);return{hashToType:e,pubKeyMap:n,prefixIndex:a,crossClassPrefixes:o,sameClassAmbiguous:l}},[s]),l=e.useMemo(()=>{const e=new Map(a.hashToType),{pubKeyMap:t}=a;for(const s of n){if(null==s._advertNodeType)continue;let n;if(s._advertSender&&(n=t.get(s._advertSender)),!n&&s.src_hash&&e.has(s.src_hash)&&(n=s.src_hash),!n)continue;const a=e.get(n);if(a&&"unknown"!==a)continue;const o=r(s._advertNodeType);"unknown"!==o&&e.set(n,o)}return e},[n,a.hashToType,a.pubKeyMap]),i=e.useRef({map:new Map,fingerprint:""}),u=e.useMemo(()=>{const e=`${Object.keys(s).length}:${n.length}:${a.crossClassPrefixes.size}`;if(e===i.current.fingerprint)return i.current.map;const t=x(n,s);return i.current={map:t,fingerprint:e},t},[n,s,a.crossClassPrefixes.size]),c=e.useRef(new Map);return e.useMemo(()=>{c.current=new Map},[a,l,u]),{resolvePacketSource:e.useCallback(e=>{var n,t,s,i;const p=e.src_hash;if(!p){const n=e.type??e.payload_type,t=o(n);if("unknown"!==t)return S(null,t,null,!1);if(null!=e._advertNodeType){const n=r(e._advertNodeType);if("unknown"!==n)return S(null,n,null,!1)}return _}const m=e.type??e.payload_type??-1,h=e._advertSender?`${p}\0${e._advertSender}`:`${p}\0${m}`,x=c.current.get(h);if(x)return x;const f=d(p),{pubKeyMap:b,prefixIndex:v,crossClassPrefixes:g,sameClassAmbiguous:y}=a;let w;if(e._advertSender){const t=b.get(e._advertSender);if(t){const e=l.get(t)??"unknown",s=null==(n=v.get(f))?void 0:n.find(e=>e.hash===t);w=S(t,e,(null==s?void 0:s.name)??null,!0)}}if(!w&&g.has(f)){const n=o(e.type??e.payload_type);if("unknown"!==n){const e=null==(t=v.get(f))?void 0:t.find(e=>e.type===n);e&&(w=S(e.hash,n,e.name,!0))}if(!w){const e=v.get(f),n=u.get(f),t=n?null==e?void 0:e.find(e=>e.hash===n):null==e?void 0:e[0],s=t?l.get(t.hash)??t.type:"unknown";w=S((null==t?void 0:t.hash)??null,s,(null==t?void 0:t.name)??null,!1)}}if(!w){const e=u.get(f);if(e){const n=l.get(e)??"unknown",t=null==(s=v.get(f))?void 0:s.find(n=>n.hash===e);w=S(e,n,(null==t?void 0:t.name)??null,!0)}}if(!w&&y.has(f)){const e=null==(i=v.get(f))?void 0:i[0];w=S((null==e?void 0:e.hash)??null,(null==e?void 0:e.type)??"unknown",(null==e?void 0:e.name)??null,!1)}if(!w){const e=v.get(f);if(1===(null==e?void 0:e.length)){const n=e[0];w=S(n.hash,n.type,n.name,!0)}else w=S(null,o(m),null,!1)}const j=o(m);if("unknown"!==j&&j!==w.type&&(w=S(w.hash,j,w.name,w.confident)),"unknown"===w.type&&null!=e._advertNodeType){const n=r(e._advertNodeType);"unknown"!==n&&(w=S(w.hash,n,w.name,w.confident))}return c.current.set(h,w),w},[a,l,u]),neighborContext:a}}export{C as A,N as c,E as u};
