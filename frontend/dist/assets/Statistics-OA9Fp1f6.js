import{c as e,j as t,C as s,Q as a,S as n,f as l,h as i,g as r,T as o,o as c,U as d,k as m,V as x,R as h}from"./index-DayZzjzL.js";import{b as u,d as p,i as f,L as g,C as j,X as y,Y as b,T as v,e as N}from"./recharts-bmHCCfxU.js";import{T as M}from"./TimeRangeSelector-Bxx4Sshs.js";import{u as w}from"./usePolling-DMtQdE_y.js";import{a as k,u as S,b as $,c as C}from"./useThemeColors-CMkWsRmX.js";import{C as P,b as W,P as T,a as F}from"./PageLayout-Bqe-U1fd.js";import{C as L,N as R}from"./CollisionExplorerModal-ieUUKw86.js";import{I as A}from"./info-BsgO8YX9.js";import{T as z}from"./triangle-alert-BGFtbNuo.js";import{R as H,C as E}from"./Grid-0cv4bxbg.js";import{T as _}from"./trending-up-C9oVMbw8.js";import"./maplibre-gl-CFO9X1Ek.js";import"./leaflet-ClE6qLuu.js";import"./map-pin-CXfpa6xA.js";const D=e("chart-pie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]),I=e("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),U=e("compass",[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),B=e("expand",[["path",{d:"m15 15 6 6",key:"1s409w"}],["path",{d:"m15 9 6-6",key:"ko1vev"}],["path",{d:"M21 16v5h-5",key:"1ck2sf"}],["path",{d:"M21 8V3h-5",key:"1qoq8a"}],["path",{d:"M3 16v5h5",key:"1t08am"}],["path",{d:"m3 21 6-6",key:"wwnumi"}],["path",{d:"M3 8V3h5",key:"1ln10m"}],["path",{d:"M9 9 3 3",key:"v551iv"}]]),O=e("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),q=e("shrink",[["path",{d:"m15 15 6 6m-6-6v4.8m0-4.8h4.8",key:"17vawe"}],["path",{d:"M9 19.8V15m0 0H4.2M9 15l-6 6",key:"chjx8e"}],["path",{d:"M15 4.2V9m0 0h4.8M15 9l6-6",key:"lav6yq"}],["path",{d:"M9 4.2V9m0 0H4.2M9 9 3 3",key:"1pxi2q"}]]);function Z(e){const t=e.match(/\(([^)]+)\)\s*$/);return t?t[1]:e.length>10?e.slice(0,10):e}function X({x:e,y:s,width:a,height:n,name:l,size:i,index:r,colors:o,depth:c,hoveredIndex:d,onHover:m,total:x}){if(1!==c)return null;const h=null!==d&&!(d===r),u=o[r%o.length],p=x>0?i/x*100:0,f=a>36&&n>20,g=a>36&&n>32,j=Z(l);return t.jsxs("g",{onMouseEnter:e=>m(r,e),onMouseLeave:()=>m(null),style:{cursor:"default"},children:[t.jsx("rect",{x:e,y:s,width:a,height:n,fill:u,opacity:h?.4:1,stroke:"rgba(0,0,0,0.2)",strokeWidth:1,rx:3,style:{transition:"opacity 150ms ease"}}),f&&t.jsxs(t.Fragment,{children:[g&&t.jsxs("text",{x:e+4,y:s+n-4-11,textAnchor:"start",dominantBaseline:"auto",fill:"rgba(0,0,0,0.6)",fontSize:8,fontFamily:"'JetBrains Mono', monospace",fontWeight:500,style:{pointerEvents:"none"},children:[p.toFixed(1),"%"]}),t.jsx("text",{x:e+4,y:s+n-4,textAnchor:"start",dominantBaseline:"auto",fill:"rgba(0,0,0,0.85)",fontSize:9,fontFamily:"'JetBrains Mono', monospace",fontWeight:600,style:{pointerEvents:"none"},children:j})]})]})}function V({data:e,total:s,color:a,position:n,containerWidth:l}){if(!e||!n)return null;const i=(e.value/s*100).toFixed(1),r=l-n.x<184?Math.max(8,n.x-160-8):n.x+16;return t.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:r,top:Math.max(8,n.y-60)},children:t.jsxs("div",{className:"bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 shadow-xl min-w-[140px]",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-sm flex-shrink-0",style:{backgroundColor:a}}),t.jsx("span",{className:"type-data-sm font-semibold text-text-primary",children:Z(e.name)})]}),t.jsxs("div",{className:"space-y-0.5 type-data-xs text-text-muted",children:[t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("span",{children:"Count"}),t.jsx("span",{className:"text-text-primary tabular-nums font-medium",children:e.value.toLocaleString()})]}),t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("span",{children:"Share"}),t.jsxs("span",{className:"text-text-primary tabular-nums font-medium",children:[i,"%"]})]}),t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("span",{children:"Total"}),t.jsx("span",{className:"text-text-primary tabular-nums font-medium",children:s.toLocaleString()})]})]})]})})}const G=u.memo(function({data:e}){var s,a;const[n,l]=u.useState(null),[i,r]=u.useState(null),[o,c]=u.useState(0),d=u.useRef(null),m=k(),{treemapData:x,total:h}=u.useMemo(()=>{const t=e.reduce((e,t)=>e+t.value,0);return{treemapData:[...e].sort((e,t)=>t.value-e.value).filter(e=>t>0&&e.value/t*100>=.5).map((e,t)=>({name:e.name,size:e.value,index:t})),total:t}},[e]),g=u.useCallback((e,t)=>{if(l(e),t&&null!==e){const e=d.current;if(e){const s=e.getBoundingClientRect();c(s.width),r({x:t.clientX-s.left,y:t.clientY-s.top})}}else r(null)},[]),j=null!==n?{name:(null==(s=x[n])?void 0:s.name)??"",value:(null==(a=x[n])?void 0:a.size)??0}:null,y=null!==n?m[n%m.length]:"";return 0===e.length||0===h?t.jsx("div",{className:"h-56 flex items-center justify-center text-text-muted",children:"No packet type data available"}):t.jsxs("div",{className:"h-56 relative treemap-container",ref:d,children:[t.jsx(p,{width:"100%",height:"100%",children:t.jsx(f,{data:x,dataKey:"size",aspectRatio:4/3,stroke:"none",isAnimationActive:!1,content:t.jsx(X,{x:0,y:0,width:0,height:0,name:"",value:0,size:0,index:0,colors:m,depth:0,hoveredIndex:n,onHover:g,total:h})})}),t.jsx(V,{data:j,total:h,color:y,position:i,containerWidth:o})]})}),K="airtimeSpectrumBlur";function Q({active:e,payload:s,label:a}){if(!e||!s||0===s.length)return null;const n=s.filter(e=>null!==e.value&&void 0!==e.value);if(0===n.length)return null;const l=a?new Date(1e3*a).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}):"";return t.jsxs("div",{className:"bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 text-sm shadow-xl",children:[t.jsx("div",{className:"font-medium text-text-primary mb-1 font-mono",children:l}),n.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-0.5",style:{backgroundColor:e.color}}),t.jsxs("span",{className:"text-text-muted",children:[e.name,":"]}),t.jsxs("span",{className:"text-text-primary tabular-nums font-mono",children:[Number(e.value).toFixed(2),"%"]})]},s))]})}function J({payload:e,showDensityScale:s=!1}){return e?t.jsxs("div",{className:"flex items-center gap-4 justify-start text-xs font-mono pl-11",children:[e.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"w-4 h-0.5",style:{backgroundColor:e.color}}),t.jsx("span",{className:"text-text-muted",children:e.value})]},s)),s&&t.jsxs("div",{className:"flex items-center gap-1.5 ml-2",children:[t.jsx("div",{className:"w-16 h-2 rounded-sm",style:{background:"linear-gradient(to right, \n                rgb(1,26,51), \n                rgb(53,82,85), \n                rgb(85,121,74), \n                rgb(150,149,53), \n                rgb(228,168,98), \n                rgb(250,195,165)\n              )"}}),t.jsx("span",{className:"text-text-muted",children:"Density"})]})]}):null}const Y=[[1,26,51],[20,43,67],[38,62,79],[53,82,85],[67,102,83],[85,121,74],[112,137,62],[150,149,53],[192,156,58],[228,168,98],[250,195,165]];function ee(e){const t=Math.max(0,Math.min(1,e))*(Y.length-1),s=Math.floor(t),a=Math.min(s+1,Y.length-1),n=t-s;return`rgb(${Math.round(Y[s][0]+n*(Y[a][0]-Y[s][0]))},${Math.round(Y[s][1]+n*(Y[a][1]-Y[s][1]))},${Math.round(Y[s][2]+n*(Y[a][2]-Y[s][2]))})`}const te=u.memo(function({samples:e,startTs:a,endTs:n,yMax:l}){const i=S(),r=$(),o=u.useMemo(()=>void 0!==l?l:function(e){if(0===e.length)return 10;let t=0;for(const n of e){const e=n.rxRolling??n.rxUtilW,s=n.txRolling??n.txUtilW;e>t&&(t=e),s>t&&(t=s)}const s=1.05*t,a=5*Math.ceil(s/5);return Math.max(10,a)}(e),[l,e]),c=r.poor,d=i.neutral,{cells:m,cellWidth:x,cellHeight:h}=u.useMemo(()=>function(e,t,s,a,n=120,l=30){const i=100/n+.5+"%",r=100/l+.5+"%";if(0===e.length||s<=t)return{cells:[],cellWidth:i,cellHeight:r};const o=s-t,c=l*n,d=new Float32Array(c),m=new Float32Array(c),x=(e,t)=>e*n+t;for(let b=0;b<e.length;b++){const i=e[b];if(i.timestamp<t||i.timestamp>s)continue;const r=Math.floor((i.timestamp-t)/o*(n-1)),c=Math.max(0,Math.min(n-1,r));if(i.rxUtilW>0){const e=Math.min(i.rxUtilW/a,1),t=Math.floor((1-e)*(l-1));for(let s=t;s<l;s++){const e=l-1-t,a=e>0?1-(s-t)/e*.7:1;d[x(s,c)]+=a}}if(i.txUtilW>0){const e=Math.min(i.txUtilW/a,1),t=Math.floor((1-e)*(l-1));for(let s=t;s<l;s++){const e=l-1-t,a=e>0?1-(s-t)/e*.7:1;m[x(s,c)]+=a}}}const h=[];for(let b=0;b<c;b++)d[b]>0&&h.push(d[b]),m[b]>0&&h.push(m[b]);h.sort((e,t)=>e-t);const u=h.length>0?h[Math.floor(.95*h.length)]:1,p=new Array(n),f=new Array(l),g=100/n,j=100/l;for(let b=0;b<n;b++)p[b]=b*g+"%";for(let b=0;b<l;b++)f[b]=b*j+"%";const y=[];for(let b=0;b<l;b++)for(let e=0;e<n;e++){const t=x(b,e),s=d[t]+.3*m[t];if(s>0&&u>0){const t=Math.min(s/u,1.5),a=Math.sqrt(t/1.5);y.push({xPct:p[e],yPct:f[b],intensity:a})}}return{cells:y,cellWidth:i,cellHeight:r}}(e,a,n,100,200,20),[e,a,n]),f=u.useMemo(()=>{if(0===e.length)return[];const t=Math.max(1,Math.floor(e.length/400)),s=[];for(let a=0;a<e.length;a+=t){const t=e[a];if(t&&"number"==typeof t.timestamp&&!isNaN(t.timestamp)){const e=t.rxRolling??t.rxUtilW,a=t.txRolling??t.txUtilW;s.push({timestamp:t.timestamp,rx:"number"!=typeof e||isNaN(e)?0:e,tx:"number"!=typeof a||isNaN(a)?0:a})}}return s},[e]),M=u.useMemo(()=>{const e=n-a,t=e/3600;return[0,.25,.5,.75,1].map(s=>{const n=new Date(1e3*(a+e*s)),l=n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),i=n.toLocaleDateString([],{weekday:"short"});return{pct:s,label:t>24?`${i} ${l}`:l}})},[a,n]);return 0===e.length?t.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No traffic data available"}):t.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[t.jsx("div",{className:"flex items-center flex-shrink-0 text-text-muted",style:{height:20,paddingLeft:44,paddingRight:8},children:t.jsx("div",{className:"relative w-full h-full flex items-center",children:M.map((e,a)=>t.jsxs("div",{className:"absolute flex items-center gap-1 type-data-xs",style:{left:100*e.pct+"%",transform:0===e.pct?"translateX(0)":1===e.pct?"translateX(-100%)":"translateX(-50%)"},children:[t.jsx(s,{className:"w-2.5 h-2.5 opacity-60"}),t.jsx("span",{className:"tabular-nums",children:e.label})]},a))})}),t.jsx("div",{className:"relative flex-1 min-h-0",children:t.jsx(p,{width:"100%",height:"100%",children:t.jsxs(g,{data:f,margin:{top:4,right:8,bottom:0,left:0},children:[t.jsx(j,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.04)",vertical:!1}),t.jsx(y,{dataKey:"timestamp",type:"number",domain:[a,n],axisLine:!1,tickLine:!1,tick:!1,height:0}),t.jsx(b,{axisLine:!1,tickLine:!1,tick:{fill:"rgba(255,255,255,0.4)",fontSize:10,fontFamily:"'JetBrains Mono', monospace"},dx:-8,width:44,tickFormatter:e=>`${e.toFixed(0)}%`,domain:[0,o]}),t.jsx(v,{content:t.jsx(Q,{})}),t.jsx(N,{type:"linear",dataKey:"rx",name:"RX Avg",stroke:c,strokeWidth:2.5,strokeOpacity:.9,dot:!1,connectNulls:!1,isAnimationActive:!1}),t.jsx(N,{type:"linear",dataKey:"tx",name:"TX Avg",stroke:d,strokeWidth:2.5,strokeOpacity:.9,dot:!1,connectNulls:!1,isAnimationActive:!1})]})})}),t.jsx("div",{className:"relative overflow-hidden",style:{height:32,marginLeft:44,marginRight:8},children:t.jsxs("svg",{className:"absolute inset-0 w-full h-full",preserveAspectRatio:"none","aria-hidden":"true",children:[t.jsx("defs",{children:t.jsx("filter",{id:K,x:"-100%",y:"-100%",width:"300%",height:"300%",children:t.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"1 3"})})}),t.jsx("g",{filter:`url(#${K})`,children:m.map((e,s)=>t.jsx("rect",{x:e.xPct,y:e.yPct,width:x,height:h,fill:ee(e.intensity),opacity:.9},`cell-${s}`))})]})}),t.jsx("div",{className:"flex-shrink-0",style:{height:24,marginTop:8},children:t.jsx(J,{payload:[{value:"RX Avg",color:c},{value:"TX Avg",color:d}],showDensityScale:!0})})]})});function se(e,t,s,a){const n=(a-t)*Math.PI/180,l=e*Math.PI/180,i=s*Math.PI/180,r=Math.sin(n)*Math.cos(i),o=Math.cos(l)*Math.sin(i)-Math.sin(l)*Math.cos(i)*Math.cos(n);let c=180*Math.atan2(r,o)/Math.PI;return c=(c+360)%360,c}function ae(e,t,s,a){const n=(s-e)*Math.PI/180,l=(a-t)*Math.PI/180,i=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371}function ne(e,t){return e>=10?t.excellent:e>=7||e>=4?t.good:e>=1||e>=-2||e>=-5?t.fair:e>=-8?t.poor:t.critical}const le=u.memo(function({neighbors:e,quickNeighbors:s,localLat:a,localLon:n,onStatsChange:l}){const[i,r]=u.useState(null),[o,c]=u.useState(new Set),[d,m]=u.useState(0),[x,h]=u.useState({width:320,height:180}),p=u.useRef({}),f=u.useRef(null),g=$(),j=C();u.useEffect(()=>{const e=f.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e){const{width:e,height:s}=t.contentRect;e>0&&s>0&&h({width:e,height:s})}});t.observe(e);const s=e.getBoundingClientRect();return s.width>0&&s.height>0&&h({width:s.width,height:s.height}),()=>t.disconnect()},[]),u.useEffect(()=>{const e=setTimeout(()=>{m(1)},100),t=setInterval(()=>{m(e=>e+1)},9500);return()=>{clearTimeout(e),clearInterval(t)}},[]);const y=u.useMemo(()=>{const e=new Set;if(s)for(const t of s)e.add(t.hash);return e},[s]),b=u.useMemo(()=>{const e=new Map;if(s)for(const t of s)e.set(t.hash,{snr:t.avgSnr,rssi:t.avgRssi});return e},[s]),{processedNeighbors:v,maxDistance:N,totalNeighbors:M,zeroHopCount:w}=u.useMemo(()=>{const t=[];let s=0,l=0;for(const[i,r]of Object.entries(e)){if(!r.latitude||!r.longitude||0===r.latitude||0===r.longitude)continue;const e=se(a,n,r.latitude,r.longitude),o=ae(a,n,r.latitude,r.longitude);o>s&&(s=o);const c=y.has(i);c&&l++;const d=b.get(i);t.push({hash:i.slice(0,8),name:r.node_name||r.name||"Unknown",snr:c?(null==d?void 0:d.snr)??r.snr??null:null,rssi:c?(null==d?void 0:d.rssi)??r.rssi??null:null,bearing:e,distance:o,normalizedDistance:0,lastSeen:r.last_seen,isZeroHop:c})}for(const e of t)e.normalizedDistance=s>0?.08+e.distance/s*.89:.08;return t.sort((e,t)=>!e.isZeroHop&&t.isZeroHop?-1:e.isZeroHop&&!t.isZeroHop?1:e.isZeroHop||t.isZeroHop?(e.snr??-1/0)-(t.snr??-1/0):t.distance-e.distance),{processedNeighbors:t,maxDistance:s,totalNeighbors:t.length,zeroHopCount:l}},[e,a,n,y,b]);u.useEffect(()=>{l&&l({zeroHopCount:w,totalCount:M,maxDistanceKm:N})},[w,M,N,l]),u.useEffect(()=>{const e=[];for(const t of v){const s=p.current[t.hash];void 0!==s&&s!==t.lastSeen&&e.push(t.hash),p.current[t.hash]=t.lastSeen}e.length>0&&(queueMicrotask(()=>{c(t=>{const s=new Set(t);return e.forEach(e=>s.add(e)),s})}),setTimeout(()=>{c(t=>{const s=new Set(t);return e.forEach(e=>s.delete(e)),s})},600))},[v]);const k=0!==a&&0!==n,{width:S,height:P}=x,W=S/2,T=P/2,F=Math.max(10,S/2-12),L=Math.max(10,P/2-12),R=.2*Math.min(F,L),A=(e,t=1)=>{const s=F*t,a=L*t,n=Math.min(R*t,s,a),l=(e%360+360)%360,i=l*Math.PI/180,r=180*Math.atan2(a-n,s-n)/Math.PI;let o,c;if(l<=45-r||l>315+r){const e=Math.tan(i);o=W+a*e*(s/a),o=Math.max(W-s+n,Math.min(W+s-n,o)),c=T-a}else if(l>45-r&&l<=45+r){const e=T-a+n;o=W+s-n+n*Math.sin(i),c=e-n*Math.cos(i)}else if(l>45+r&&l<=135-r){const e=1/Math.tan(i);c=T+s*e*(a/s),c=Math.max(T-a+n,Math.min(T+a-n,c)),o=W+s}else if(l>135-r&&l<=135+r){const e=T+a-n;o=W+s-n+n*Math.sin(i),c=e-n*Math.cos(i)}else if(l>135+r&&l<=225-r){const e=Math.tan(i);o=W+a*e*(s/a),o=Math.max(W-s+n,Math.min(W+s-n,o)),c=T+a}else if(l>225-r&&l<=225+r){const e=T+a-n;o=W-s+n+n*Math.sin(i),c=e-n*Math.cos(i)}else if(l>225+r&&l<=315-r){const e=1/Math.tan(i);c=T+s*e*(a/s),c=Math.max(T-a+n,Math.min(T+a-n,c)),o=W-s}else{const e=T-a+n;o=W-s+n+n*Math.sin(i),c=e-n*Math.cos(i)}return{x:o,y:c}},z=e=>{const t=F*e,s=L*e,a=Math.min(R*e,t,s),n=W-t,l=W+t,i=T-s,r=T+s;return`\n      M ${n+a} ${i}\n      L ${l-a} ${i}\n      Q ${l} ${i} ${l} ${i+a}\n      L ${l} ${r-a}\n      Q ${l} ${r} ${l-a} ${r}\n      L ${n+a} ${r}\n      Q ${n} ${r} ${n} ${r-a}\n      L ${n} ${i+a}\n      Q ${n} ${i} ${n+a} ${i}\n      Z\n    `};return k?0===M?t.jsxs("div",{ref:f,className:"flex flex-col items-center justify-center h-full text-text-muted",children:[t.jsx(U,{className:"w-8 h-8 mb-2 opacity-50"}),t.jsx("p",{children:"No nodes with location data"})]}):t.jsxs("div",{ref:f,className:"relative h-full w-full overflow-hidden",children:[t.jsxs("svg",{width:S,height:P,className:"absolute inset-0",children:[t.jsx("defs",{children:t.jsx("style",{children:`\n                @keyframes radar-ring-pop {\n                  0% {\n                    opacity: 0;\n                    stroke-width: 1;\n                  }\n                  8% {\n                    opacity: 0.9;\n                    stroke-width: 2.5;\n                  }\n                  20% {\n                    opacity: 0.7;\n                    stroke-width: 2;\n                  }\n                  /* Neon flicker fadeout */\n                  50% {\n                    opacity: 0.5;\n                    stroke-width: 1.5;\n                  }\n                  60% {\n                    opacity: 0.3;\n                  }\n                  65% {\n                    opacity: 0.45;\n                  }\n                  72% {\n                    opacity: 0.15;\n                  }\n                  78% {\n                    opacity: 0.3;\n                  }\n                  85% {\n                    opacity: 0.08;\n                  }\n                  90% {\n                    opacity: 0.15;\n                  }\n                  100% {\n                    opacity: 0;\n                    stroke-width: 1;\n                  }\n                }\n                @keyframes local-node-ping {\n                  0% {\n                    fill: ${g.excellent};\n                  }\n                  100% {\n                    fill: ${j.chart6};\n                  }\n                }\n                @keyframes neighbor-blink-scale {\n                  0%, 100% {\n                    transform: scale(1);\n                    opacity: 0;\n                  }\n                  50% {\n                    transform: scale(1.3);\n                    opacity: 0.8;\n                  }\n                }\n                .radar-ring-0 {\n                  opacity: 0;\n                  animation: radar-ring-pop 875ms cubic-bezier(0.1, 0, 0.3, 1) both;\n                  animation-delay: 0ms;\n                }\n                .radar-ring-1 {\n                  opacity: 0;\n                  animation: radar-ring-pop 875ms cubic-bezier(0.1, 0, 0.3, 1) both;\n                  animation-delay: 450ms;\n                }\n                .radar-ring-2 {\n                  opacity: 0;\n                  animation: radar-ring-pop 875ms cubic-bezier(0.1, 0, 0.3, 1) both;\n                  animation-delay: 900ms;\n                }\n                .radar-ring-3 {\n                  opacity: 0;\n                  animation: radar-ring-pop 875ms cubic-bezier(0.1, 0, 0.3, 1) both;\n                  animation-delay: 1350ms;\n                }\n                .local-node-ping {\n                  animation: local-node-ping 1250ms ease-out forwards;\n                }\n                .neighbor-blink-ring {\n                  transform-origin: center;\n                  animation: neighbor-blink-scale 600ms ease-out forwards;\n                }\n              `})}),d>0&&[.25,.5,.75,1].map((e,s)=>t.jsx("path",{d:z(e),fill:"none",stroke:g.critical,strokeWidth:1,className:`radar-ring-${s}`},`${e}-${d}`)),["N","E","S","W"].map(e=>{const s="N"===e||"S"===e,a=s?W:"E"===e?W+F:W-F,n=s?"N"===e?T-L:T+L:T;return t.jsx("line",{x1:W,y1:T,x2:a,y2:n,stroke:"rgba(255,255,255,0.08)",strokeWidth:1},e)}),Array.from({length:24},(e,s)=>{const a=15*s,n=a%45==0;if(a%90==0)return null;const l=A(a,1),i=A(a,n?.92:.96);return t.jsx("line",{x1:i.x,y1:i.y,x2:l.x,y2:l.y,stroke:g.critical,strokeOpacity:1,strokeWidth:n?2.5:1.5},a)}),["N","E","S","W"].map(e=>{const s=(e=>{switch(e){case"N":return{x:W,y:T-L};case"S":return{x:W,y:T+L};case"E":return{x:W+F,y:T};case"W":return{x:W-F,y:T}}})(e),a="E"===e?"end":"W"===e?"start":"middle",n="N"===e?"hanging":"S"===e?"auto":"middle";return t.jsx("text",{x:s.x,y:s.y,textAnchor:a,dominantBaseline:n,fill:g.critical,fillOpacity:.9,fontSize:16,fontWeight:600,fontFamily:"'JetBrains Mono', monospace",children:e},e)}),t.jsx("circle",{cx:W,cy:T,r:5,fill:j.chart6,stroke:"rgba(255,255,255,0.3)",strokeWidth:1,className:d>0?"local-node-ping":""},`local-${d}`),v.map(e=>{const{x:s,y:a}=((e,t)=>{const s=(e-90)*Math.PI/180,a=Math.cos(s),n=Math.sin(s);return{x:W+t*F*a,y:T+t*L*n}})(e.bearing,e.normalizedDistance),n=e.isZeroHop&&null!==e.snr?ne(e.snr,g):"rgba(107, 114, 128, 0.66)",l=e.isZeroHop?1:.33,c=(null==i?void 0:i.hash)===e.hash,d=o.has(e.hash);return t.jsxs("g",{children:[d&&t.jsx("circle",{cx:s,cy:a,r:10.5,fill:"none",stroke:"rgba(255,255,255,0.9)",strokeWidth:2,className:"neighbor-blink-ring"}),c&&t.jsx("circle",{cx:s,cy:a,r:10.5,fill:n,opacity:.3}),t.jsx("circle",{cx:s,cy:a,r:c?7:5,fill:n,fillOpacity:c?1:l,stroke:"rgba(0,0,0,0.5)",strokeWidth:1,style:{cursor:"pointer",transition:"r 0.15s, fill-opacity 0.15s"},onMouseEnter:()=>r(e),onMouseLeave:()=>r(null)})]},e.hash)})]}),i&&t.jsxs("div",{className:"absolute bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 text-sm pointer-events-none z-10 shadow-xl",style:{left:"50%",bottom:8,transform:"translateX(-50%)"},children:[t.jsx("div",{className:"font-medium text-text-primary",children:i.name}),t.jsxs("div",{className:"text-text-muted text-xs font-mono",children:[i.hash,!i.isZeroHop&&t.jsx("span",{className:"ml-2 text-text-muted",children:"(not direct)"})]}),i.isZeroHop&&null!==i.snr?t.jsx("div",{className:"flex gap-3 mt-1 text-xs",children:t.jsxs("span",{children:[t.jsx("span",{className:"text-text-muted",children:"SNR:"})," ",t.jsxs("span",{className:"tabular-nums",style:{color:ne(i.snr,g)},children:[i.snr.toFixed(1)," dB"]}),t.jsxs("span",{className:"text-text-muted ml-1",children:["(",(H=i.snr,H>=10?"Excellent":H>=7?"Very Good":H>=4?"Good":H>=1?"Fair+":H>=-2?"Fair":H>=-5?"Fair-":H>=-8?"Poor":H>=-11?"Bad":"Critical"),")"]})]})}):t.jsx("div",{className:"text-xs text-text-muted mt-1",children:"No direct RF data"}),t.jsxs("div",{className:"flex gap-3 text-xs",children:[t.jsxs("span",{children:[t.jsx("span",{className:"text-text-muted",children:"Distance:"})," ",t.jsxs("span",{className:"tabular-nums text-text-secondary",children:[i.distance.toFixed(2)," km"]})]}),t.jsxs("span",{children:[t.jsx("span",{className:"text-text-muted",children:"Bearing:"})," ",t.jsxs("span",{className:"tabular-nums text-text-secondary",children:[i.bearing.toFixed(0),"°"]})]})]})]})]}):t.jsxs("div",{ref:f,className:"flex flex-col items-center justify-center h-full text-text-muted",children:[t.jsx(U,{className:"w-8 h-8 mb-2 opacity-50"}),t.jsx("p",{children:"Local node coordinates not configured"}),t.jsx("p",{className:"text-xs mt-1",children:"Set latitude/longitude in config to enable"})]});var H});function ie(e,t){if(0===e.length)return 0;const s=t/100*(e.length-1),a=Math.floor(s),n=Math.ceil(s);return a===n?e[a]:e[a]+(e[n]-e[a])*(s-a)}const re=u.memo(function({timestamps:e,values:s,onStatsChange:a}){var n,l;const i=$(),[r,o]=u.useState(!0),c=u.useMemo(()=>{if(0===s.length)return null;const e=Math.min(...s),t=Math.max(...s),a=s.reduce((e,t)=>e+t,0)/s.length,n=[...s].sort((e,t)=>e-t);return{min:e,max:t,avg:a,p5:ie(n,5),p95:ie(n,95)}},[s]);u.useEffect(()=>{null==a||a(c)},[c,a]);const d=u.useCallback(()=>{o(e=>!e)},[]),{cells:m,gridInfo:x,xLabels:h,yLabels:p}=u.useMemo(()=>{if(0===e.length||0===s.length||!c)return{cells:[],gridInfo:null,xLabels:[],yLabels:[]};const t=Math.max(100,e.length),a=200;let n,l;if(r){const e=.1*(c.p95-c.p5||1);n=c.p5-e,l=c.p95+e}else{const e=.1*(c.max-c.min||1);n=c.min-e,l=c.max+e}const i=l-n,o=Math.min(...e),d=Math.max(...e)-o||1,m=Array(a).fill(null).map(()=>Array(t).fill(0));for(let r=0;r<e.length;r++){const a=Math.floor((e[r]-o)/d*(t-1)),c=Math.max(n,Math.min(l,s[r])),x=Math.floor((c-n)/i*199),h=Math.max(0,Math.min(t-1,a)),u=Math.max(0,Math.min(199,199-x));m[u][h]++,u>0&&(m[u-1][h]+=.4),u<199&&(m[u+1][h]+=.4),h>0&&(m[u][h-1]+=.3),h<t-1&&(m[u][h+1]+=.3),u>0&&h>0&&(m[u-1][h-1]+=.2),u>0&&h<t-1&&(m[u-1][h+1]+=.2),u<199&&h>0&&(m[u+1][h-1]+=.2),u<199&&h<t-1&&(m[u+1][h+1]+=.2),u>1&&(m[u-2][h]+=.15),u<198&&(m[u+2][h]+=.15),h>1&&(m[u][h-2]+=.1),h<t-2&&(m[u][h+2]+=.1)}let x=0;for(let e=0;e<a;e++)for(let s=0;s<t;s++)m[e][s]>x&&(x=m[e][s]);const h=[];for(let e=0;e<a;e++)for(let s=0;s<t;s++)m[e][s]>0&&h.push({x:s,y:e,intensity:m[e][s]/x});const u=[];for(let e=0;e<=5;e++){const t=o+d*e/5;u.push({pos:e/5*100,label:new Date(1e3*t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})}const p=[];for(let e=0;e<=4;e++){const t=n+i*e/4;p.push({pos:100*(1-e/4),label:`${Math.round(t)}`})}return{cells:h,gridInfo:{cols:t,rows:a},xLabels:u,yLabels:p}},[e,s,c,r]);if(!x||0===m.length)return t.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No noise floor data available"});const f=100/x.cols,g=100/x.rows,j=i.poor;return t.jsxs("div",{className:"relative w-full h-full",role:"img","aria-label":`RF noise floor heatmap showing values from ${(null==(n=null==c?void 0:c.min)?void 0:n.toFixed(0))??"N/A"} to ${(null==(l=null==c?void 0:c.max)?void 0:l.toFixed(0))??"N/A"} dBm`,children:[t.jsx("div",{className:"absolute top-0 left-0 flex flex-col justify-between",style:{width:32,bottom:20},"aria-hidden":"true",children:p.map((e,s)=>t.jsx("span",{className:"type-data-xs text-text-muted tabular-nums text-right pr-1.5",style:{position:"absolute",top:`${e.pos}%`,transform:"translateY(-50%)",right:0},children:e.label},s))}),t.jsxs("div",{className:"absolute overflow-hidden",style:{left:32,right:0,top:0,bottom:20},children:[t.jsx("svg",{className:"absolute inset-0 w-full h-full",preserveAspectRatio:"none","aria-hidden":"true",children:[0,25,50,75,100].map(e=>t.jsx("line",{x1:"0",y1:`${e}%`,x2:"100%",y2:`${e}%`,stroke:"rgba(255,255,255,0.06)",strokeDasharray:"3 3"},e))}),t.jsx("svg",{className:"absolute inset-0 w-full h-full",preserveAspectRatio:"none","aria-hidden":"true",children:m.map((e,s)=>{const a=.2+.8*e.intensity;return t.jsx("rect",{x:e.x*f+"%",y:e.y*g+"%",width:`${f+.1}%`,height:`${g+.1}%`,fill:j,opacity:a},s)})}),t.jsx("button",{type:"button",onClick:d,className:"absolute bottom-1 right-1 p-1.5 rounded bg-tooltip-bg/80 hover:bg-tooltip-bg active:bg-tooltip-bg transition-colors touch-manipulation",title:r?"Show full range (min/max)":"Show trimmed range (P5-P95)","aria-label":r?"Expand to show full data range":"Shrink to show trimmed percentile range","aria-pressed":!r,children:r?t.jsx(B,{className:"w-3.5 h-3.5 text-text-muted","aria-hidden":"true"}):t.jsx(q,{className:"w-3.5 h-3.5 text-text-muted","aria-hidden":"true"})})]}),t.jsx("div",{className:"absolute left-0 right-0 bottom-0",style:{left:32,height:20},"aria-hidden":"true",children:h.map((e,s)=>t.jsx("span",{className:"type-data-xs text-text-muted tabular-nums absolute top-1",style:{left:`${e.pos}%`,transform:"translateX(-50%)"},children:e.label},s))})]})}),oe={repeater:"var(--signal-poor)",companion:"var(--accent-tertiary)",room_server:"var(--accent-secondary)"};function ce(e){if(e.contact_type){const t=e.contact_type.toLowerCase();if("repeater"===t||"rep"===t)return"repeater";if("room server"===t||"room_server"===t||"room"===t||"server"===t)return"room_server";if("companion"===t||"client"===t||"cli"===t)return"companion"}return e.is_repeater?"repeater":"companion"}const de=u.memo(function({neighbors:e}){const s=u.useMemo(()=>{const t={repeater:0,companion:0,room_server:0};for(const a of Object.values(e)){const e=ce(a);t[e]=(t[e]||0)+1}const s=Object.values(t).reduce((e,t)=>e+t,0);return{items:[{label:"Repeaters",count:t.repeater,percent:0,color:oe.repeater},{label:"Companions",count:t.companion,percent:0,color:oe.companion},{label:"Room Servers",count:t.room_server,percent:0,color:oe.room_server}].map(e=>({...e,percent:s>0?e.count/s*100:0})).filter(e=>e.count>0).sort((e,t)=>t.count-e.count),total:s}},[e]);return 0===s.total?t.jsx("div",{className:"h-full flex items-center justify-center text-text-muted type-body-sm",children:"No neighbors discovered yet"}):t.jsxs("div",{className:"h-full flex flex-col",children:[t.jsx("div",{className:"flex-1 flex flex-col justify-evenly",children:s.items.map(e=>t.jsxs("div",{className:"flex flex-col gap-1.5",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"type-data-sm text-text-secondary",children:e.label}),t.jsxs("span",{className:"type-data-sm text-text-muted tabular-nums",children:[e.count," ",t.jsxs("span",{className:"text-text-muted/60",children:["(",e.percent.toFixed(0),"%)"]})]})]}),t.jsx("div",{className:"h-2.5 bg-bg-elevated rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full rounded-full transition-all duration-500 ease-out",style:{width:`${e.percent}%`,backgroundColor:e.color,minWidth:e.count>0?"4px":"0"}})})]},e.label))}),t.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border-subtle",children:[t.jsx("span",{className:"type-data-xs text-text-muted",children:"Total Nodes"}),t.jsx("span",{className:"type-data-sm text-text-primary font-medium tabular-nums",children:s.total})]})]})});function me(e,t,s,a=!0,n=60){const l=new Map(e.map(e=>[e.start,e])),i=new Map(t.map(e=>[e.start,e])),r=Array.from(new Set([...l.keys(),...i.keys()])).sort((e,t)=>e-t).map(e=>{const t=l.get(e),a=i.get(e);return{timestamp:e,rxUtilW:((null==t?void 0:t.airtime_ms)??0)/s*100,txUtilW:((null==a?void 0:a.airtime_ms)??0)/s*100}});return a&&r.length>1?function(e,t=60){if(0===e.length)return[];const s=1-Math.pow(.5,1/t),a=Math.min(e.length,Math.max(10,Math.floor(t/3)));let n=0,l=0;for(let i=0;i<a;i++)n+=e[i].rxUtilW,l+=e[i].txUtilW;return n/=a,l/=a,e.map(e=>(n=s*e.rxUtilW+(1-s)*n,l=s*e.txUtilW+(1-s)*l,{...e,rxRolling:n,txRolling:l}))}(r,n):r}const xe={excellent:"text-signal-excellent",good:"text-signal-good",fair:"text-signal-fair",poor:"text-signal-poor"},he={excellent:"bg-signal-excellent/10",good:"bg-signal-good/10",fair:"bg-signal-fair/10",poor:"bg-signal-poor/10"};function ue({value:e,status:s}){const a={excellent:"bg-signal-excellent",good:"bg-signal-good",fair:"bg-signal-fair",poor:"bg-signal-poor"}[s];return t.jsx("div",{className:"w-full h-2 bg-surface-elevated rounded-full overflow-hidden",children:t.jsx("div",{className:`h-full ${a} transition-all duration-300`,style:{width:`${Math.min(100,Math.max(0,e))}%`}})})}function pe(){const e=a(),s=n(),[l,i]=u.useState(null),r=u.useCallback((e,t)=>{i({prefix:e,candidateHashes:t})},[]),o=u.useCallback(()=>{i(null)},[]);if(!s)return t.jsxs(P,{children:[t.jsx(W,{icon:t.jsx(O,{}),title:"Prefix Conflicts",largeTitle:!0}),t.jsx("div",{className:"flex-1 flex items-center justify-center",children:t.jsxs("div",{className:"text-center text-text-muted",children:[t.jsx(A,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"type-data-xs",children:"No topology data available"}),t.jsx("p",{className:"type-data-xs opacity-70",children:"Run deep analysis to see stats"})]})})]});const c=(d=e.avgConfidence)>=.9?"excellent":d>=.7?"good":d>=.5?"fair":"poor";var d;const m=(x=e.collisionRate)<=10?"excellent":x<=25?"good":"poor";var x;const h="poor"===c||"poor"===m?"poor":"fair"===c||"fair"===m?"fair":"good"===c||"good"===m?"good":"excellent",p="excellent"===h||"good"===h?I:z;return t.jsxs(P,{children:[t.jsx(W,{icon:t.jsx(O,{}),title:"Prefix Conflicts",largeTitle:!0,actions:t.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1 rounded-full ${he[h]}`,children:[t.jsx(p,{className:`w-3.5 h-3.5 ${xe[h]}`}),t.jsx("span",{className:`type-data-xs font-medium ${xe[h]}`,children:"excellent"===h?"Excellent":"good"===h?"Good":"fair"===h?"Fair":"Needs Attention"})]})}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-baseline justify-between mb-1",children:[t.jsx("span",{className:"type-data-xs text-text-muted",children:"Avg Confidence"}),t.jsxs("span",{className:`type-data-lg font-semibold ${xe[c]}`,children:[(100*e.avgConfidence).toFixed(1),"%"]})]}),t.jsx(ue,{value:100*e.avgConfidence,status:c})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-baseline justify-between mb-1",children:[t.jsx("span",{className:"type-data-xs text-text-muted",children:"Collision Rate"}),t.jsxs("span",{className:`type-data-lg font-semibold ${xe[m]}`,children:[e.collisionRate.toFixed(1),"%"]})]}),t.jsx(ue,{value:e.collisionRate,status:m})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4 py-3 border-t border-b border-border-subtle",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"type-data-lg font-semibold text-text-primary",children:e.totalPrefixes}),t.jsx("div",{className:"type-data-xs text-text-muted",children:"Prefixes"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"type-data-lg font-semibold text-signal-good",children:e.unambiguousPrefixes}),t.jsx("div",{className:"type-data-xs text-text-muted",children:"Unique"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"type-data-lg font-semibold "+(e.collisionPrefixes>0?"text-signal-poor":"text-text-primary"),children:e.collisionPrefixes}),t.jsx("div",{className:"type-data-xs "+(e.collisionPrefixes>0?"text-signal-poor":"text-text-muted"),children:"Collisions"})]})]}),e.highCollisionPrefixes.length>0&&t.jsxs("div",{className:"mb-3",children:[t.jsx("div",{className:"type-data-xs text-text-muted mb-2",children:"Highest Collisions"}),t.jsx("div",{className:"flex flex-wrap gap-1.5",children:e.highCollisionPrefixes.map(({prefix:e,candidateCount:s,candidateHashes:a})=>t.jsxs("button",{type:"button",onClick:()=>r(e,a),className:"inline-flex items-center gap-1 px-2 py-1 min-h-[28px] rounded bg-surface-elevated text-text-secondary type-data-xs font-mono hover:bg-signal-poor/20 hover:text-signal-poor focus:outline-none focus:ring-2 focus:ring-signal-poor/50 transition-colors cursor-pointer touch-manipulation",title:`Click to explore ${s} candidates matching this prefix`,"aria-label":`Explore prefix ${e} with ${s} colliding candidates`,children:[e,t.jsxs("span",{className:"text-signal-poor",children:["×",s]})]},e))})]}),e.lowConfidencePrefixes.length>0&&t.jsx("div",{className:"mt-auto pt-3 border-t border-border-subtle",children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx(z,{className:"w-3.5 h-3.5 text-signal-poor mt-0.5 flex-shrink-0"}),t.jsxs("div",{children:[t.jsxs("div",{className:"type-data-xs text-signal-poor font-medium",children:[t.jsx("span",{className:"text-signal-poor",children:e.lowConfidencePrefixes.length})," prefix",1!==e.lowConfidencePrefixes.length?"es":""," with low confidence"]}),t.jsxs("div",{className:"type-data-xs text-text-muted mt-0.5 font-mono",children:[e.lowConfidencePrefixes.slice(0,5).join(", "),e.lowConfidencePrefixes.length>5&&t.jsxs("span",{className:"text-signal-poor",children:[" +",e.lowConfidencePrefixes.length-5," more"]})]})]})]})}),0===e.lowConfidencePrefixes.length&&0===e.collisionPrefixes&&t.jsx("div",{className:"mt-auto pt-3 border-t border-border-subtle",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(I,{className:"w-3.5 h-3.5 text-signal-excellent"}),t.jsx("span",{className:"type-data-xs text-signal-excellent",children:"All prefixes uniquely identified"})]})}),t.jsx(L,{isOpen:!!l,prefix:(null==l?void 0:l.prefix)||"",candidateHashes:(null==l?void 0:l.candidateHashes)||[],onClose:o})]})}function fe(){var e,s,a,n;const p=l(),f=i(),g=r(),[j,y]=u.useState(null),[b,v]=u.useState(null),[N,k]=u.useState([]),[S,$]=u.useState(null),[C,L]=u.useState(null),[A,z]=u.useState(!0),[I,B]=u.useState(null),[O,q]=u.useState(3),Z=function(e){const[t,s]=u.useState(e);return u.useEffect(()=>{const t=setTimeout(()=>s(e),150);return()=>clearTimeout(t)},[e,150]),t}(O),X=o[Z].hours,V=60*X,K=Math.ceil(60*V/10);u.useEffect(()=>{!async function(){var e;B(null);try{const[t,s,a]=await Promise.all([c(V,K),d(X),m(X)]);t.success&&t.data&&y(t.data),s.success&&s.data&&v(s.data),a.success&&(null==(e=a.data)?void 0:e.history)&&k(a.data.history)}catch(t){B(t instanceof Error?t.message:"Failed to load chart data")}finally{z(!1)}}()},[X,V,K]);const{utilSamples:Q,startTs:J,endTs:Y}=u.useMemo(()=>{if(!j)return{utilSamples:[],startTs:0,endTs:0};const{received:e,transmitted:t,forwarded:s,bucket_duration_seconds:a,start_time:n,end_time:l}=j,i=1e3*a,r=function(e,t){const s=new Map;for(const a of e)s.set(a.start,{...a});for(const a of t){const e=s.get(a.start);e?(e.airtime_ms+=a.airtime_ms,e.count+=a.count):s.set(a.start,{...a})}return Array.from(s.values()).sort((e,t)=>e.start-t.start)}(t,s);return{utilSamples:me(e,r,i),startTs:n,endTs:l}},[j]),ee=u.useMemo(()=>{switch(X){case 72:return 6e5;case 168:return 18e5;default:return 3e5}},[X]),se=u.useCallback(async()=>{try{const e=await c(V,K);e.success&&e.data&&y(e.data)}catch{}},[V,K]),ae=u.useCallback(async()=>{try{const e=await d(X);e.success&&e.data&&v(e.data)}catch{}},[X]),ne=u.useCallback(async()=>{var e;try{const t=await m(X);t.success&&(null==(e=t.data)?void 0:e.history)&&k(t.data.history)}catch{}},[X]);w(se,ee,!0,!0),w(ae,ee,!0,!0),w(ne,ee,!0,!0);const ie=u.useMemo(()=>b&&b.series?b.series.map(e=>({name:e.name,value:e.data.reduce((e,t)=>e+(t[1]??0),0)})).filter(e=>e.value>0):[],[b]),oe=u.useMemo(()=>0===N.length?{timestamps:[],values:[]}:{timestamps:N.map(e=>e.timestamp),values:N.map(e=>e.noise_floor_dbm)},[N]),ce=o[O],xe=u.useMemo(()=>{const e=(null==p?void 0:p.neighbors)??{};return Object.fromEntries(Object.entries(e).filter(([e])=>!f.has(e)))},[null==p?void 0:p.neighbors,f]),he=u.useMemo(()=>{const e=Date.now()/1e3-3600*X;return Object.fromEntries(Object.entries(xe).filter(([,t])=>t.last_seen>=e))},[xe,X]),ue=u.useMemo(()=>0===Q.length?{peak:0,mean:0}:{peak:Math.max(...Q.map(e=>e.rxUtilW)),mean:Q.reduce((e,t)=>e+t.rxUtilW,0)/Q.length},[Q]);return t.jsxs(T,{children:[t.jsx(F,{title:"Statistics",icon:t.jsx(x,{}),controls:t.jsx(M,{ranges:o,selectedIndex:O,onSelect:q})}),I&&t.jsx(P,{className:"border border-accent-red/50 bg-accent-red/10",children:t.jsx("p",{className:"text-accent-red",children:I})}),A?t.jsx(H,{template:"auto",children:t.jsx(P,{className:"text-center py-12",children:t.jsx("div",{className:"animate-pulse text-text-muted",children:"Loading statistics..."})})}):t.jsxs(t.Fragment,{children:[t.jsxs(H,{template:"panel",children:[t.jsx(E,{span:12,md:6,children:t.jsxs(P,{children:[t.jsx(W,{icon:t.jsx(_,{}),title:"Airtime Utilization",badge:ce.label,largeTitle:!0,actions:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("span",{className:"type-data-xs text-text-muted",children:["Peak ",t.jsxs("span",{className:"text-text-secondary tabular-nums font-medium",children:[ue.peak.toFixed(2),"%"]})]}),t.jsxs("span",{className:"type-data-xs text-text-muted",children:["Mean ",t.jsxs("span",{className:"text-text-secondary tabular-nums font-medium",children:[ue.mean.toFixed(2),"%"]})]})]})}),t.jsx("div",{className:"flex-1 min-h-0",children:t.jsx(te,{samples:Q,startTs:J,endTs:Y})})]})}),t.jsx(E,{span:12,md:6,children:t.jsxs(P,{children:[t.jsx(W,{icon:t.jsx(U,{}),title:"Link Quality",badge:ce.label,largeTitle:!0,actions:C?t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 type-data-xs text-text-muted",children:[t.jsxs("span",{children:[t.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:C.zeroHopCount})," nbr"]}),t.jsxs("span",{children:[t.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:C.totalCount})," obs"]}),t.jsxs("span",{children:[t.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:C.maxDistanceKm.toFixed(0)})," km"]})]}):null}),t.jsx("div",{className:"flex-1 min-h-0",children:t.jsx(le,{neighbors:he,quickNeighbors:g,localLat:(null==(s=null==(e=null==p?void 0:p.config)?void 0:e.repeater)?void 0:s.latitude)??0,localLon:(null==(n=null==(a=null==p?void 0:p.config)?void 0:a.repeater)?void 0:n.longitude)??0,onStatsChange:L})})]})})]}),t.jsxs(H,{template:"panel",children:[t.jsx(E,{span:12,md:6,children:t.jsxs(P,{children:[t.jsx(W,{icon:t.jsx(D,{}),title:"Packet Types",largeTitle:!0}),t.jsx("div",{className:"flex-1 min-h-0",children:ie.length>0?t.jsx(G,{data:ie}):t.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No packet type data available"})})]})}),t.jsx(E,{span:12,md:6,children:t.jsxs(P,{children:[t.jsx(W,{icon:t.jsx(R,{}),title:"Network Composition",badge:ce.label,largeTitle:!0}),t.jsx("div",{className:"flex-1 min-h-0",children:t.jsx(de,{neighbors:he})})]})})]}),t.jsxs(H,{template:"panel",children:[t.jsx(E,{span:12,md:6,children:t.jsx(pe,{})}),t.jsx(E,{span:12,md:6,children:t.jsxs(P,{children:[t.jsx(W,{icon:t.jsx(h,{}),title:"RF Noise Floor",largeTitle:!0,actions:S?t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 md:gap-3",children:[t.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["min ",t.jsx("span",{className:"text-text-secondary tabular-nums",children:S.min.toFixed(0)})]}),t.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["avg ",t.jsx("span",{className:"text-text-secondary tabular-nums",children:S.avg.toFixed(0)})]}),t.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["max ",t.jsx("span",{className:"text-text-secondary tabular-nums",children:S.max.toFixed(0)})]}),t.jsx("span",{className:"type-data-xs text-text-muted",children:"dBm"})]}):t.jsx("span",{className:"type-data-xs text-text-muted",children:"dBm"})}),t.jsx("div",{className:"flex-1 min-h-0",children:t.jsx(re,{timestamps:oe.timestamps,values:oe.values,onStatsChange:$})})]})})]})]})]})}export{fe as default};
