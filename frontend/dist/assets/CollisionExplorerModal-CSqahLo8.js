import{r as c,j as e}from"./vendor-react-CHg3w57L.js";import{M as L,S,L as k,a as H}from"./maplibre-gl-B21pqYGi.js";import{c as N}from"./vendor-core-CgllfypI.js";import{p as R,al as T,r as B,Y as E,_,ab as D,h as w}from"./index-B4woLUMa.js";import{u as P,B as z}from"./BasemapLayer-VM7R8hCP.js";import{a3 as I,a1 as W,aj as U,a as F,o as Y,j as q,at as A}from"./vendor-icons-rRVc_l7g.js";function $(r){var f;return(f=navigator.clipboard)!=null&&f.writeText?(navigator.clipboard.writeText(r).catch(()=>{}),!0):!1}const G={version:8,sources:{},layers:[],glyphs:"https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf"};function M({node:r,isHovered:f,onHover:g}){const[b,x]=c.useState(!1),y=c.useCallback(d=>{d.stopPropagation(),$(r.hash),x(!0),setTimeout(()=>x(!1),2e3)},[r.hash]),h=r.contactType.toLowerCase(),m=h.includes("room")||h.includes("server"),o=h==="companion"||h==="client";let n=U,l="text-sys-blue";return m?(n=q,l="text-signal-fair"):o?(n=A,l="text-fg-muted"):r.isNeighbor&&(l="text-sys-green"),e.jsxs("div",{className:N("flex items-center gap-3 px-3 py-2.5 radius-inner transition-base cursor-pointer",f?"bg-sys-blue/10":"hover:bg-subtle-fill"),onMouseEnter:()=>g(r.hash),onMouseLeave:()=>g(null),children:[e.jsx(n,{className:N("w-4 h-4 flex-shrink-0",l)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"type-label text-fg-primary truncate",children:r.name}),r.isNeighbor&&e.jsx(w,{color:"green",compact:!0,children:"NBR"}),r.isRepeater&&e.jsx(w,{color:"zinc",compact:!0,children:"RPT"}),r.isHub&&e.jsx(w,{color:"indigo",compact:!0,children:"HUB"})]}),e.jsxs("button",{onClick:y,className:N("mt-1 inline-flex items-center gap-1 type-data-xs px-1.5 py-0.5 rounded","border transition-all cursor-pointer",b?"border-sys-green/50 bg-sys-green/10 text-sys-green":"border-edge-subtle bg-subtle/50 text-fg-muted hover:border-edge-strong"),title:`Copy: ${r.hash}`,children:[r.hash.slice(0,12),"…",b?e.jsx(F,{className:"w-2.5 h-2.5"}):e.jsx(Y,{className:"w-2.5 h-2.5 opacity-50"})]})]})]})}function C({nodes:r,hoveredHash:f,onHover:g}){const b=P(),x=c.useRef(null),y=D(),[h,m]=c.useState(!1),o=c.useMemo(()=>r.filter(a=>a.latitude!=null&&a.longitude!=null&&(a.latitude!==0||a.longitude!==0)),[r]),n=c.useMemo(()=>{if(o.length===0)return null;let a=1/0,s=-1/0,t=1/0,i=-1/0;for(const p of o)a=Math.min(a,p.longitude),s=Math.max(s,p.longitude),t=Math.min(t,p.latitude),i=Math.max(i,p.latitude);const u=.01;if(i-t<u){const p=(i+t)/2;t=p-u/2,i=p+u/2}if(s-a<u){const p=(s+a)/2;a=p-u/2,s=p+u/2}return[[a,t],[s,i]]},[o]),l=c.useMemo(()=>n?{longitude:(n[0][0]+n[1][0])/2,latitude:(n[0][1]+n[1][1])/2}:{longitude:0,latitude:0},[n]),d=c.useMemo(()=>{if(o.length<2)return null;const a=[];for(let s=0;s<o.length;s++)for(let t=s+1;t<o.length;t++){const i=o[s],u=o[t];a.push({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[[i.longitude,i.latitude],[u.longitude,u.latitude]]}})}return{type:"FeatureCollection",features:a}},[o]),v=c.useCallback(()=>{var s;const a=(s=x.current)==null?void 0:s.getMap();if(!a||!n){m(!0);return}a.fitBounds(n,{padding:{top:50,bottom:50,left:50,right:50},maxZoom:13,duration:0}),setTimeout(()=>m(!0),50)},[n]),j=y&&h;return o.length===0?e.jsx("div",{className:"h-full flex items-center justify-center bg-subtle/30 radius-inner",children:e.jsxs("div",{className:"text-center text-fg-secondary p-4",children:[e.jsx(W,{className:"w-8 h-8 mx-auto mb-2 opacity-40"}),e.jsx("p",{className:"text-sm",children:"No location data available"})]})}):e.jsxs("div",{className:"h-full w-full relative radius-inner overflow-hidden bg-elevated",children:[e.jsx("div",{className:N("absolute inset-0 flex items-center justify-center z-10","transition-opacity duration-200 pointer-events-none",j?"opacity-0":"opacity-100 bg-elevated"),children:e.jsx("div",{className:"w-5 h-5 border-2 border-text-muted/30 border-t-text-muted rounded-full animate-spin"})}),e.jsx("div",{className:N("h-full w-full transition-opacity duration-200",j?"opacity-100":"opacity-0"),children:e.jsxs(L,{ref:x,initialViewState:{longitude:l.longitude,latitude:l.latitude,zoom:10},style:{height:"100%",width:"100%"},mapStyle:G,attributionControl:!1,onLoad:v,children:[e.jsx(z,{mode:b}),d&&e.jsx(S,{id:"collision-edges",type:"geojson",data:d,children:e.jsx(k,{id:"collision-edges-line",type:"line",paint:{"line-color":"#3B3F4A","line-width":2,"line-opacity":.8},layout:{"line-cap":"round","line-join":"round"}})}),o.map(a=>{const s=a.hash===f,t=a.hash.startsWith("0x")?a.hash.slice(2,4).toUpperCase():a.hash.slice(0,2).toUpperCase();return e.jsx(H,{longitude:a.longitude,latitude:a.latitude,anchor:"center",children:e.jsx("div",{className:"cursor-pointer transition-all duration-150",onMouseEnter:()=>g(a.hash),onMouseLeave:()=>g(null),style:{pointerEvents:"auto"},children:e.jsxs(w,{color:"amber",filled:!0,className:"type-data-xs shadow-lg",children:[t,s&&e.jsx("span",{className:"ml-1 opacity-75 font-sans",children:a.name})]})})},a.hash)})]})})]})}function J({isOpen:r,prefix:f,candidateHashes:g,onClose:b}){const x=R(),y=T(),h=B(),[m,o]=c.useState(null),n=c.useMemo(()=>new Set(h.map(s=>s.hash)),[h]),l=(x==null?void 0:x.neighbors)??{},d=c.useMemo(()=>{const s=t=>{if(l[t])return l[t];if(!t.startsWith("0x")&&l["0x"+t])return l["0x"+t];if(t.startsWith("0x")&&l[t.slice(2)])return l[t.slice(2)]};return g.map(t=>{var u;const i=s(t);return{hash:t,name:(i==null?void 0:i.node_name)||(i==null?void 0:i.name)||`Unknown (${t.slice(0,8)}…)`,contactType:(i==null?void 0:i.contact_type)||"",isRepeater:(i==null?void 0:i.is_repeater)||((u=i==null?void 0:i.contact_type)==null?void 0:u.toLowerCase())==="repeater"||!1,isNeighbor:n.has(t)||n.has("0x"+t)||n.has(t.replace(/^0x/,"")),isHub:y.has(t),latitude:i==null?void 0:i.latitude,longitude:i==null?void 0:i.longitude}}).sort((t,i)=>t.isNeighbor!==i.isNeighbor?t.isNeighbor?-1:1:t.isHub!==i.isHub?t.isHub?-1:1:t.name.localeCompare(i.name))},[g,l,n,y]),v=c.useMemo(()=>d.some(s=>s.latitude!=null&&s.longitude!=null&&(s.latitude!==0||s.longitude!==0)),[d]),j=c.useCallback(s=>{o(s)},[]),a=v?"4xl":"lg";return r?e.jsxs(E,{open:r,onClose:b,size:a,motionPlus:!0,className:v?"sm:h-[500px] sm:max-h-[600px]":"",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-edge-subtle",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 radius-inner bg-signal-fair/10",children:e.jsx(I,{className:"w-5 h-5 text-signal-fair"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"type-micro",children:["Prefix Collision: ",e.jsx("span",{className:"font-mono text-sys-blue",children:f})]}),e.jsxs("p",{className:"text-xs text-fg-secondary",children:[d.length," nodes share this prefix"]})]})]}),e.jsx("button",{onClick:b,className:"sm:hidden min-h-[44px] min-w-[44px] px-3 flex items-center justify-center text-[15px] font-medium text-sys-blue active:text-sys-blue/70 transition-base radius-inner active:bg-subtle-fill",children:"Done"}),e.jsx("button",{onClick:b,className:"hidden sm:flex items-center justify-center p-2 text-fg-muted hover:text-fg-primary transition-base radius-inner hover:bg-subtle","aria-label":"Close",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs(_,{className:"p-0 overflow-hidden flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"sm:hidden flex-1 overflow-y-auto",children:[v&&e.jsx("div",{className:"h-64 p-2 border-b border-edge-subtle",children:e.jsx(C,{nodes:d,hoveredHash:m,onHover:j})}),e.jsx("div",{className:"p-2",children:d.map(s=>e.jsx(M,{node:s,isHovered:m===s.hash,onHover:j},s.hash))})]}),v?e.jsxs("div",{className:"hidden sm:grid sm:grid-cols-[280px_minmax(400px,1fr)] flex-1 overflow-hidden sm:min-w-[700px]",children:[e.jsx("div",{className:"overflow-y-auto border-r border-edge-subtle",children:e.jsx("div",{className:"p-2",children:d.map(s=>e.jsx(M,{node:s,isHovered:m===s.hash,onHover:j},s.hash))})}),e.jsx("div",{className:"overflow-hidden p-2",children:e.jsx(C,{nodes:d,hoveredHash:m,onHover:j})})]}):e.jsx("div",{className:"hidden sm:block flex-1 overflow-y-auto",children:e.jsx("div",{className:"p-2",children:d.map(s=>e.jsx(M,{node:s,isHovered:m===s.hash,onHover:j},s.hash))})})]})]}):null}const ee=c.memo(J);export{ee as C};
