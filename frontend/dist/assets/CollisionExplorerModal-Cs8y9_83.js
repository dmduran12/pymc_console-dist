import{d as k,r as c,G as L,bF as S,K as H,j as e,ag as R,ah as T,bs as B,c as N,v as w,y as E,z as _,bP as P}from"./index-DhkG1Nx9.js";import{u as z,M as D,B as I,S as W,L as q,a as F}from"./BasemapLayer-CfNeG6Jg.js";import{T as U}from"./triangle-alert-D8NErBXC.js";import{M as A}from"./map-pin-BHGohRD7.js";import{M as G}from"./monitor-smartphone-jV9bAwUA.js";/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],$=k("share-2",Y);function J(n){var f;return(f=navigator.clipboard)!=null&&f.writeText?(navigator.clipboard.writeText(n).catch(()=>{}),!0):!1}const K={version:8,sources:{},layers:[],glyphs:"https://tiles.basemaps.cartocdn.com/fonts/{fontstack}/{range}.pbf"};function M({node:n,isHovered:f,onHover:g}){const[y,p]=c.useState(!1),j=c.useCallback(d=>{d.stopPropagation(),J(n.hash),p(!0),setTimeout(()=>p(!1),2e3)},[n.hash]),h=n.contactType.toLowerCase(),m=h.includes("room")||h.includes("server"),o=h==="companion"||h==="client";let r=$,l="text-sys-blue";return m?(r=P,l="text-signal-fair"):o?(r=G,l="text-fg-muted"):n.isNeighbor&&(l="text-sys-green"),e.jsxs("div",{className:N("flex items-center gap-3 px-3 py-2.5 radius-inner transition-base cursor-pointer",f?"bg-sys-blue/10":"hover:bg-subtle-fill"),onMouseEnter:()=>g(n.hash),onMouseLeave:()=>g(null),children:[e.jsx(r,{className:N("w-4 h-4 flex-shrink-0",l)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"type-label text-fg-primary truncate",children:n.name}),n.isNeighbor&&e.jsx(w,{color:"green",compact:!0,children:"NBR"}),n.isRepeater&&e.jsx(w,{color:"zinc",compact:!0,children:"RPT"}),n.isHub&&e.jsx(w,{color:"indigo",compact:!0,children:"HUB"})]}),e.jsxs("button",{onClick:j,className:N("mt-1 inline-flex items-center gap-1 type-data-xs px-1.5 py-0.5 rounded","border transition-all cursor-pointer",y?"border-sys-green/50 bg-sys-green/10 text-sys-green":"border-edge-subtle bg-subtle/50 text-fg-muted hover:border-edge-strong"),title:`Copy: ${n.hash}`,children:[n.hash.slice(0,12),"…",y?e.jsx(E,{className:"w-2.5 h-2.5"}):e.jsx(_,{className:"w-2.5 h-2.5 opacity-50"})]})]})]})}function C({nodes:n,hoveredHash:f,onHover:g}){const y=z(),p=c.useRef(null),j=B(),[h,m]=c.useState(!1),o=c.useMemo(()=>n.filter(a=>a.latitude!=null&&a.longitude!=null&&(a.latitude!==0||a.longitude!==0)),[n]),r=c.useMemo(()=>{if(o.length===0)return null;let a=1/0,s=-1/0,t=1/0,i=-1/0;for(const x of o)a=Math.min(a,x.longitude),s=Math.max(s,x.longitude),t=Math.min(t,x.latitude),i=Math.max(i,x.latitude);const u=.01;if(i-t<u){const x=(i+t)/2;t=x-u/2,i=x+u/2}if(s-a<u){const x=(s+a)/2;a=x-u/2,s=x+u/2}return[[a,t],[s,i]]},[o]),l=c.useMemo(()=>r?{longitude:(r[0][0]+r[1][0])/2,latitude:(r[0][1]+r[1][1])/2}:{longitude:0,latitude:0},[r]),d=c.useMemo(()=>{if(o.length<2)return null;const a=[];for(let s=0;s<o.length;s++)for(let t=s+1;t<o.length;t++){const i=o[s],u=o[t];a.push({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[[i.longitude,i.latitude],[u.longitude,u.latitude]]}})}return{type:"FeatureCollection",features:a}},[o]),v=c.useCallback(()=>{var s;const a=(s=p.current)==null?void 0:s.getMap();if(!a||!r){m(!0);return}a.fitBounds(r,{padding:{top:50,bottom:50,left:50,right:50},maxZoom:13,duration:0}),setTimeout(()=>m(!0),50)},[r]),b=j&&h;return o.length===0?e.jsx("div",{className:"h-full flex items-center justify-center bg-subtle/30 radius-inner",children:e.jsxs("div",{className:"text-center text-fg-secondary p-4",children:[e.jsx(A,{className:"w-8 h-8 mx-auto mb-2 opacity-40"}),e.jsx("p",{className:"text-sm",children:"No location data available"})]})}):e.jsxs("div",{className:"h-full w-full relative radius-inner overflow-hidden bg-elevated",children:[e.jsx("div",{className:N("absolute inset-0 flex items-center justify-center z-10","transition-opacity duration-200 pointer-events-none",b?"opacity-0":"opacity-100 bg-elevated"),children:e.jsx("div",{className:"w-5 h-5 border-2 border-text-muted/30 border-t-text-muted rounded-full animate-spin"})}),e.jsx("div",{className:N("h-full w-full transition-opacity duration-200",b?"opacity-100":"opacity-0"),children:e.jsxs(D,{ref:p,initialViewState:{longitude:l.longitude,latitude:l.latitude,zoom:10},style:{height:"100%",width:"100%"},mapStyle:K,attributionControl:!1,onLoad:v,children:[e.jsx(I,{mode:y}),d&&e.jsx(W,{id:"collision-edges",type:"geojson",data:d,children:e.jsx(q,{id:"collision-edges-line",type:"line",paint:{"line-color":"#3B3F4A","line-width":2,"line-opacity":.8},layout:{"line-cap":"round","line-join":"round"}})}),o.map(a=>{const s=a.hash===f,t=a.hash.startsWith("0x")?a.hash.slice(2,4).toUpperCase():a.hash.slice(0,2).toUpperCase();return e.jsx(F,{longitude:a.longitude,latitude:a.latitude,anchor:"center",children:e.jsx("div",{className:"cursor-pointer transition-all duration-150",onMouseEnter:()=>g(a.hash),onMouseLeave:()=>g(null),style:{pointerEvents:"auto"},children:e.jsxs(w,{color:"amber",filled:!0,className:"type-data-xs shadow-lg",children:[t,s&&e.jsx("span",{className:"ml-1 opacity-75 font-sans",children:a.name})]})})},a.hash)})]})})]})}function Q({isOpen:n,prefix:f,candidateHashes:g,onClose:y}){const p=L(),j=S(),h=H(),[m,o]=c.useState(null),r=c.useMemo(()=>new Set(h.map(s=>s.hash)),[h]),l=(p==null?void 0:p.neighbors)??{},d=c.useMemo(()=>{const s=t=>{if(l[t])return l[t];if(!t.startsWith("0x")&&l["0x"+t])return l["0x"+t];if(t.startsWith("0x")&&l[t.slice(2)])return l[t.slice(2)]};return g.map(t=>{var u;const i=s(t);return{hash:t,name:(i==null?void 0:i.node_name)||(i==null?void 0:i.name)||`Unknown (${t.slice(0,8)}…)`,contactType:(i==null?void 0:i.contact_type)||"",isRepeater:(i==null?void 0:i.is_repeater)||((u=i==null?void 0:i.contact_type)==null?void 0:u.toLowerCase())==="repeater"||!1,isNeighbor:r.has(t)||r.has("0x"+t)||r.has(t.replace(/^0x/,"")),isHub:j.has(t),latitude:i==null?void 0:i.latitude,longitude:i==null?void 0:i.longitude}}).sort((t,i)=>t.isNeighbor!==i.isNeighbor?t.isNeighbor?-1:1:t.isHub!==i.isHub?t.isHub?-1:1:t.name.localeCompare(i.name))},[g,l,r,j]),v=c.useMemo(()=>d.some(s=>s.latitude!=null&&s.longitude!=null&&(s.latitude!==0||s.longitude!==0)),[d]),b=c.useCallback(s=>{o(s)},[]),a=v?"4xl":"lg";return n?e.jsxs(R,{open:n,onClose:y,size:a,motionPlus:!0,className:v?"sm:h-[500px] sm:max-h-[600px]":"",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-edge-subtle",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 radius-inner bg-signal-fair/10",children:e.jsx(U,{className:"w-5 h-5 text-signal-fair"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"type-micro",children:["Prefix Collision: ",e.jsx("span",{className:"font-mono text-sys-blue",children:f})]}),e.jsxs("p",{className:"text-xs text-fg-secondary",children:[d.length," nodes share this prefix"]})]})]}),e.jsx("button",{onClick:y,className:"sm:hidden min-h-[44px] min-w-[44px] px-3 flex items-center justify-center text-[15px] font-medium text-sys-blue active:text-sys-blue/70 transition-base radius-inner active:bg-subtle-fill",children:"Done"}),e.jsx("button",{onClick:y,className:"hidden sm:flex items-center justify-center p-2 text-fg-muted hover:text-fg-primary transition-base radius-inner hover:bg-subtle","aria-label":"Close",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs(T,{className:"p-0 overflow-hidden flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"sm:hidden flex-1 overflow-y-auto",children:[v&&e.jsx("div",{className:"h-64 p-2 border-b border-edge-subtle",children:e.jsx(C,{nodes:d,hoveredHash:m,onHover:b})}),e.jsx("div",{className:"p-2",children:d.map(s=>e.jsx(M,{node:s,isHovered:m===s.hash,onHover:b},s.hash))})]}),v?e.jsxs("div",{className:"hidden sm:grid sm:grid-cols-[280px_minmax(400px,1fr)] flex-1 overflow-hidden sm:min-w-[700px]",children:[e.jsx("div",{className:"overflow-y-auto border-r border-edge-subtle",children:e.jsx("div",{className:"p-2",children:d.map(s=>e.jsx(M,{node:s,isHovered:m===s.hash,onHover:b},s.hash))})}),e.jsx("div",{className:"overflow-hidden p-2",children:e.jsx(C,{nodes:d,hoveredHash:m,onHover:b})})]}):e.jsx("div",{className:"hidden sm:block flex-1 overflow-y-auto",children:e.jsx("div",{className:"p-2",children:d.map(s=>e.jsx(M,{node:s,isHovered:m===s.hash,onHover:b},s.hash))})})]})]}):null}const se=c.memo(Q);export{se as C,$ as S};
