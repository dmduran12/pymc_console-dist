const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PathMapMapLibre-CItCjZId.js","assets/vendor-react-Co0R0q1H.js","assets/BasemapLayer-DRuifqX0.js","assets/vendor-core-B_fdKJ1g.js","assets/index-DyhSk8IB.js","assets/DelayedAnimateNumber-BSOx2HMN.js","assets/index-plCEoie8.js","assets/payload-decoders-C26wtlgi.js","assets/TimeRangeStepper-juZ3e1TO.js","assets/chevron-right-DjeiOQnT.js","assets/badge-colors-YAE4qQ7m.js","assets/chat-utils-WDGoRf8-.js","assets/SignalIndicator-BfcSsJOC.js","assets/signal-scoring-CcBiRcks.js","assets/arrow-up-BF7OyrWc.js","assets/prefix-disambiguation-CnguQfzq.js","assets/geo-utils-BR5NTbzq.js","assets/map-pin-JvuXkIBQ.js","assets/triangle-alert-RgCY7CW7.js","assets/DataBox-D1tSvDDH.js","assets/layers-DV4nU4qa.js","assets/activity-CnKMcPpt.js","assets/circle-check-DOn2EfOm.js","assets/database-CxKqXhR_.js","assets/maplibre-gl-B1CfjdFi.css","assets/index-DBxnQa_d.css"])))=>i.map(i=>d[i]);
import{c as e}from"./vendor-core-B_fdKJ1g.js";import{j as s,c as t,r as a,_ as n,u as l}from"./vendor-react-Co0R0q1H.js";import{c as r,a8 as i,a9 as c,aa as d,ab as o,B as x,ac as m,ad as p,ae as h,p as u,j as g,af as f,R as y,ag as j,ah as b,ai as N,aj as v,ak as k,H as w,al as C,am as S,m as H,P as _,o as T,an as M,ao as P,ap as B,aq as F,ar as L,as as D,at as z,v as R,au as A,av as E,aw as $,ax as I,Y as U,_ as V,A as Q,ay as O,$ as G,az as W,aA as q,aB as K}from"./index-DyhSk8IB.js";import{P as X,d as Y,a as J,b as Z,c as ee,e as se,f as te}from"./payload-decoders-C26wtlgi.js";import{g as ae,C as ne,a as le,b as re}from"./TimeRangeStepper-juZ3e1TO.js";import{D as ie,R as ce,P as de}from"./badge-colors-YAE4qQ7m.js";import{g as oe,e as xe,a as me}from"./chat-utils-WDGoRf8-.js";import{A as pe,S as he,i as ue,a as ge,g as fe,b as ye,Z as je}from"./SignalIndicator-BfcSsJOC.js";import{a as be,A as Ne}from"./arrow-up-BF7OyrWc.js";import{C as ve}from"./chevron-right-DjeiOQnT.js";import{f as ke,r as we,H as Ce,R as Se}from"./prefix-disambiguation-CnguQfzq.js";import{M as He}from"./map-pin-JvuXkIBQ.js";import{T as _e}from"./triangle-alert-RgCY7CW7.js";import{D as Te}from"./DataBox-D1tSvDDH.js";import{L as Me}from"./layers-DV4nU4qa.js";import{A as Pe}from"./activity-CnKMcPpt.js";import{C as Be}from"./circle-check-DOn2EfOm.js";import{D as Fe}from"./database-CxKqXhR_.js";import{H as Le,D as De}from"./DelayedAnimateNumber-BSOx2HMN.js";const ze=r("corner-down-right",[["path",{d:"m15 10 5 5-5 5",key:"qqa56n"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]]),Re=r("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Ae=r("message-circle-question-mark",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Ee=r("reply",[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]]),$e=r("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),Ie=r("stethoscope",[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]),Ue=r("trophy",[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]]),Ve=r("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);function Qe(e,s){[...s].reverse().forEach(t=>{const a=e.getVariant(t);a&&c(e,a),e.variantChildren&&e.variantChildren.forEach(e=>{Qe(e,s)})})}function Oe(){const e=new Set,s={subscribe:s=>(e.add(s),()=>{e.delete(s)}),start(s,t){const a=[];return e.forEach(e=>{a.push(i(e,s,{transitionOverride:t}))}),Promise.all(a)},set:s=>e.forEach(e=>{!function(e,s){Array.isArray(s)?Qe(e,s):"string"==typeof s?Qe(e,[s]):c(e,s)}(e,s)}),stop(){e.forEach(e=>{!function(e){e.values.forEach(e=>e.stop())}(e)})},mount:()=>()=>{s.stop()}};return s}function Ge(){const e=d(Oe);return o(e.mount,[]),e}function We({"aria-label":e="Page navigation",className:a,...n}){return s.jsx("nav",{"aria-label":e,...n,className:t("flex gap-x-2",a)})}function qe({onClick:e,disabled:a=!1,className:n,children:l="Previous"}){return s.jsx("span",{className:t("grow basis-0",n),children:s.jsxs(x,{plain:!0,onClick:e,disabled:a,"aria-label":"Previous page",className:t("gap-1",a&&"invisible"),children:[s.jsx("svg",{className:"size-4 stroke-current",viewBox:"0 0 16 16",fill:"none","aria-hidden":"true",children:s.jsx("path",{d:"M2.75 8H13.25M2.75 8L5.25 5.5M2.75 8L5.25 10.5",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})}),l]})})}function Ke({onClick:e,disabled:a=!1,className:n,children:l="Next"}){return s.jsx("span",{className:t("flex grow basis-0 justify-end",n),children:s.jsxs(x,{plain:!0,onClick:e,disabled:a,"aria-label":"Next page",className:t("gap-1",a&&"invisible"),children:[l,s.jsx("svg",{className:"size-4 stroke-current",viewBox:"0 0 16 16",fill:"none","aria-hidden":"true",children:s.jsx("path",{d:"M13.25 8L2.75 8M13.25 8L10.75 10.5M13.25 8L10.75 5.5",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})})]})})}function Xe({className:e,...a}){return s.jsx("span",{...a,className:t("hidden items-baseline gap-x-2 sm:flex",e)})}function Ye({page:e,current:a=!1,onClick:n,className:l,children:r}){return s.jsx(x,{plain:!a,outline:a,onClick:()=>null==n?void 0:n(e),"aria-label":`Page ${e}`,"aria-current":a?"page":void 0,className:t("min-w-[2.25rem] before:absolute before:-inset-px before:rounded-lg",a&&"before:bg-subtle-fill",l),children:r??e})}function Je({className:e,...a}){return s.jsx("span",{"aria-hidden":"true",...a,className:t("w-[2.25rem] select-none text-center text-sm text-fg-muted",e),children:"…"})}const Ze=e(e=>({requestedHash:null,requestChannel:s=>e({requestedHash:s}),clearRequest:()=>e({requestedHash:null})}));function es(e){if(!e||e.length<8)return null;const s=parseInt(e.slice(0,2),16),t=parseInt(e.slice(2,4),16),a=parseInt(e.slice(4,6),16),n=parseInt(e.slice(6,8),16);return isNaN(s)||isNaN(t)||isNaN(a)||isNaN(n)?null:((s|t<<8|a<<16|n<<24)>>>0).toString(16).toUpperCase().padStart(8,"0")}function ss(e){return e>=10?"excellent":e>=5?"good":e>=0?"fair":e>=-5?"poor":"critical"}function ts(e){if(!e.payload)return null;try{const s=h(e.payload),t=function(e){const s=e.original_path||e.forwarded_path||[];if("string"==typeof s)try{const e=JSON.parse(s);if(Array.isArray(e))return e.map(e=>parseInt(e,16))}catch{return[]}else if(Array.isArray(s))return s.map(e=>parseInt(e,16));return[]}(e),a=J(s,t);return a?{packet:e,decoded:a,timestamp:e.timestamp??0,hopCount:a.snrValues.length,rssi:e.rssi,snr:e.snr}:null}catch{return null}}const as={rx:{icon:Ne,label:"Rx",badgeColor:ie.rx,avatarBg:"bg-sys-green/15",avatarText:"text-sys-green"},forward:{icon:pe,label:"Fwd",badgeColor:ie.forward,avatarBg:"bg-sys-cyan/15",avatarText:"text-sys-cyan"},duplicate:{icon:u,label:"Dupe",badgeColor:ie.duplicate,avatarBg:"bg-fg-muted/15",avatarText:"text-fg-secondary"},tx:{icon:be,label:"Tx",badgeColor:ie.tx,avatarBg:"bg-sys-indigo/15",avatarText:"text-sys-indigo"},dropped:{icon:ze,label:"Drop",badgeColor:ie.dropped,avatarBg:"bg-sys-amber/15",avatarText:"text-sys-amber"}},ns={sm:"w-3.5 h-3.5",md:"w-4 h-4",lg:"w-5 h-5"},ls={sm:"w-8 h-8",md:"w-9 h-9",lg:"w-10 h-10"};function rs(e){return"tx_local"===e.packet_origin?"tx":"tx_forward"===e.packet_origin?"forward":e.is_duplicate?"duplicate":e.transmitted?"forward":e.drop_reason?"dropped":"rx"}const is=a.memo(function({packet:e,showLabel:a=!0,variant:n="avatar",size:l="sm"}){const r=rs(e),i=as[r],c=i.icon;return"avatar"===n?s.jsx("div",{className:t("flex items-center justify-center rounded-full flex-shrink-0",i.avatarBg,ls[l]),children:s.jsx(c,{className:t(ns[l],i.avatarText)})}):s.jsxs(g,{color:i.badgeColor,children:[s.jsx(c,{className:ns[l]}),a&&i.label]})}),cs=a.memo(function({path:e,localHash:a,className:n}){if(!e||0===e.length)return s.jsx("span",{className:t("text-fg-muted text-xs",n),children:"—"});const l=a?(a.startsWith("0x")?a.slice(2,4):a.slice(0,2)).toUpperCase():null;return s.jsx("span",{className:t("flex items-center gap-0.5 type-data-xs overflow-hidden",n),children:e.map((t,a)=>{const n=a===e.length-1,r=l&&t.toUpperCase()===l;return s.jsxs("span",{className:"flex items-center flex-shrink-0",children:[r?s.jsx("span",{className:"px-1 py-0.5 rounded bg-sys-amber/20 text-sys-amber text-[9px] font-medium",children:"You"}):s.jsx("span",{className:"px-1 py-0.5 rounded bg-subtle-fill-hover text-fg-secondary",children:t.toUpperCase()}),!n&&s.jsx(ve,{className:"w-2.5 h-2.5 text-fg-muted mx-0.5 flex-shrink-0"})]},`${t}-${a}`)})})});function ds({channelName:e,onClick:a,active:n,compact:l,className:r}){const i=e.startsWith("#")?e:`#${e}`,c=t("inline-flex items-center flex-shrink-0","font-medium",l?"px-1.5 h-4 leading-4 rounded text-[10px]":"px-2 h-5 leading-5 rounded text-xs",n?"bg-sys-blue/20 text-sys-blue":"bg-sys-blue/10 text-sys-blue",a&&!n&&"hover:bg-sys-blue/20 cursor-pointer",r);return a?s.jsx("button",{type:"button",onClick:a,className:c,children:i}):s.jsx("span",{className:c,children:i})}function os(e){return{"--data-box-accent":v[e]}}function xs(e){const s=e.payload_type_name||b(e.payload_type??e.type),t=e.route_type_name||N(e.route_type??e.route);return{payloadType:s,routeType:t,payloadColor:de[s]??"zinc",routeColor:ce[t]??"zinc"}}function ms(e){if(!e)return[];if(Array.isArray(e))return e;try{const s=JSON.parse(e);return Array.isArray(s)?s:[]}catch{return[]}}function ps(e,s,t){if(t){const s=t(e);return{name:s.name,isCompanion:s.isCompanion,isRepeater:s.isRepeater}}const{name:a,nodeType:n}=ae(e,s);return{name:a,isCompanion:n.isCompanion||n.isClient,isRepeater:n.isRepeater}}const hs=a.memo(function({packet:e,onClick:n,localHash:l,neighbors:r,resolveSource:i,isFlashing:c=!1,isTraceHighlighted:d,onTraceHover:o,traceTag:x,onViewTraceReport:m,dupeGroupPosition:p,isDupeGroupHovered:h=!1,onDupeGroupHover:u,dupeCount:g,decodedMessages:b,onChannelClick:N}){const k=!g&&f(e.is_duplicate),w=void 0!==p,{payloadType:C,routeType:S,payloadColor:H,routeColor:_}=xs(e),T="tx_local"===e.packet_origin,M="TRACE"===C,P=ms(e.original_path),B=ms(e.forwarded_path),F=B.length>0?B:P,L=e.src_hash?(e.src_hash.startsWith("0x")?e.src_hash.slice(2,6):e.src_hash.slice(0,4)).toUpperCase():null,{name:D,isRepeater:z}=ps(e,r,i);let R=null,A=null,E=null,$=null;if("GRP_TXT"===C&&b){const s=b.get(e.packet_hash),t=null==s?void 0:s.decoded;(null==t?void 0:t.decrypted)&&!t.macCorrupted&&t.text&&(A=t.senderName||null,R=t.text,E=t.channelName||null,$=t.channelHash||null)}else if("TXT_MSG"===C&&e.raw_packet)try{const s=X.fromHex(e.raw_packet);if(s.success&&s.packet){const e=Z(s.packet.payload);e&&!e.encrypted&&(R=e.text)}}catch{}const I=A||(z?null:D),U=!!I,V=!U&&z&&!!D,Q=!U&&!V&&"GRP_TXT"===C&&!R,O=e.payload_length??e.length??0;e.lbt_attempts;const G=a.useCallback(()=>{M&&x&&m?m(x):n(e)},[M,x,m,n,e]),W=a.useCallback(()=>{M&&x&&o&&o(x),w&&u&&e.packet_hash&&u(e.packet_hash)},[M,x,o,w,u,e.packet_hash]),q=a.useCallback(()=>{o&&o(null),u&&u(null)},[o,u]),K=v[H]||v.zinc,Y=h;return s.jsxs("div",{onClick:G,onMouseEnter:W,onMouseLeave:q,className:t("group relative cursor-pointer","hover:bg-subtle-fill",k&&!h&&"opacity-40",c&&"flash-row",T&&"bg-sys-indigo/5",d&&"bg-sys-teal/10"),children:[s.jsx("div",{className:t("absolute pointer-events-none transition-opacity duration-75",w?Y?"opacity-100":"opacity-0":"opacity-0 group-hover:opacity-100"),style:(()=>{const e={pointerEvents:"none"};return"first"===p?{...e,borderTop:`2px solid ${K}`,borderLeft:`2px solid ${K}`,borderRight:`2px solid ${K}`,borderBottom:"none",borderRadius:"8px 8px 0 0",inset:"-2px -2px 0 -2px"}:"middle"===p?{...e,borderTop:"none",borderLeft:`2px solid ${K}`,borderRight:`2px solid ${K}`,borderBottom:"none",borderRadius:0,inset:"0 -2px"}:"last"===p?{...e,borderTop:"none",borderLeft:`2px solid ${K}`,borderRight:`2px solid ${K}`,borderBottom:`2px solid ${K}`,borderRadius:"0 0 8px 8px",inset:"0 -2px -2px -2px"}:{...e,border:`2px solid ${K}`,borderRadius:"8px",inset:"-2px"}})()}),s.jsxs("div",{className:"relative flex items-center gap-2 min-[600px]:gap-3 px-2 py-2 min-[600px]:px-3 min-[600px]:py-2.5",children:[s.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[s.jsx("div",{className:"relative flex-shrink-0",children:U?s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-1 ring-edge-subtle",style:{backgroundColor:oe(xe(I).cleanName)},children:xe(I).emoji?s.jsx("span",{className:"text-base leading-none",children:xe(I).emoji}):s.jsx("span",{className:"text-white text-[10px] font-bold tracking-tighter",children:me(I)})}):V?s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-[1.5px] ring-sys-blue",children:s.jsx(y,{className:"size-5 text-sys-blue"})}):Q?s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-zinc-500/20 ring-1 ring-edge-subtle",children:s.jsx(Ae,{className:"size-4 text-fg-muted"})}):s.jsx(is,{packet:e,variant:"avatar",size:"sm"})}),s.jsx("div",{className:"min-w-0",children:U?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"font-semibold text-[13px] text-fg-primary font-sans truncate max-w-[90px]",children:I}),L&&s.jsx("div",{className:"hidden min-[900px]:block text-[9px] text-fg-muted truncate",children:L})]}):V?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"font-semibold text-[13px] text-fg-primary font-sans truncate max-w-[90px]",children:D}),L&&s.jsx("div",{className:"hidden min-[900px]:block text-[9px] text-fg-muted truncate",children:L})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"font-bold text-[13px] text-fg-primary font-sans truncate",children:L||"—"}),D&&s.jsx("div",{className:"hidden min-[900px]:block text-[9px] text-fg-muted truncate max-w-[70px]",children:D})]})})]}),s.jsxs("div",{className:"flex-1 flex items-center gap-1 min-[600px]:gap-1.5 min-[900px]:gap-2 min-w-0",children:[s.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:os(H),children:C}),g&&g>1&&s.jsxs("span",{className:"data-box data-box-compact flex-shrink-0",children:["×",g]}),s.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:os(_),children:S}),s.jsxs("span",{className:"hidden min-[520px]:inline type-data-xs text-fg-muted flex-shrink-0",children:[O,"B"]}),s.jsx("div",{className:"flex-1 min-w-0 overflow-hidden",children:R?s.jsxs("span",{className:"text-[11px] text-fg-secondary truncate block flex items-center gap-1",children:[E&&s.jsx(ds,{channelName:E,compact:!0,onClick:N&&$?e=>{e.stopPropagation(),N($)}:void 0}),s.jsx("span",{className:"italic truncate",children:R})]}):s.jsx(cs,{path:F,localHash:l})})]}),s.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[s.jsx("span",{className:"data-box data-box-compact",children:j(e.timestamp)}),s.jsx(he,{rssi:e.rssi,snr:e.snr,compact:!0,showValues:!0,validated:ue(e)})]})]})]})}),us=a.memo(function({packet:e,onClick:a,localHash:n,neighbors:l,resolveSource:r,isFlashing:i=!1,isTraceHighlighted:c,traceTag:d,onViewTraceReport:o,dupeGroupPosition:x,isDupeGroupHovered:m=!1,onDupeGroupHover:p,dupeCount:h,decodedMessages:u,onChannelClick:g}){const{payloadType:b,routeType:N,payloadColor:k,routeColor:w}=xs(e),C="tx_local"===e.packet_origin,S="TRACE"===b,H=!h&&f(e.is_duplicate),_=ms(e.original_path),T=ms(e.forwarded_path),M=T.length>0?T:_,P=M.length,B=e.src_hash?(e.src_hash.startsWith("0x")?e.src_hash.slice(2,6):e.src_hash.slice(0,4)).toUpperCase():null,{name:F,isRepeater:L}=ps(e,l,r);let D=null,z=null,R=null,A=null;if("GRP_TXT"===b&&u){const s=u.get(e.packet_hash),t=null==s?void 0:s.decoded;(null==t?void 0:t.decrypted)&&!t.macCorrupted&&t.text&&(z=t.senderName||null,D=t.text,R=t.channelName||null,A=t.channelHash||null)}else if("TXT_MSG"===b&&e.raw_packet)try{const s=X.fromHex(e.raw_packet);if(s.success&&s.packet){const e=Z(s.packet.payload);e&&!e.encrypted&&(D=e.text)}}catch{}const E=z||(L?null:F),$=!!E,I=!$&&L&&!!F,U=!$&&!I&&"GRP_TXT"===b&&!D,V=e.payload_length??e.length??0,Q=e.lbt_attempts??0,O=v[k]||v.zinc;return s.jsxs("div",{onClick:()=>{S&&d&&o?o(d):a(e)},className:t("relative pl-3 pr-2.5 py-2 cursor-pointer","active:bg-subtle-fill-hover",H&&"opacity-40",i&&"flash-row",C&&"bg-sys-indigo/5",c&&"bg-sys-teal/10"),children:[s.jsx("div",{className:"absolute left-0 transition-all",style:(()=>{if(!x)return{opacity:0};const e=m?1:.4,s=m?"3px":"2px";return"first"===x?{backgroundColor:O,opacity:e,width:s,top:"6px",bottom:0,borderRadius:"0 9999px 0 0"}:"middle"===x?{backgroundColor:O,opacity:e,width:s,top:0,bottom:0,borderRadius:0}:"last"===x?{backgroundColor:O,opacity:e,width:s,top:0,bottom:"6px",borderRadius:"0 0 9999px 0"}:{backgroundColor:O,opacity:e,width:s,top:"6px",bottom:"6px",borderRadius:"9999px"}})()}),s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("div",{className:"relative flex-shrink-0 mt-0.5",children:$?s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-1 ring-edge-subtle",style:{backgroundColor:oe(xe(E).cleanName)},children:xe(E).emoji?s.jsx("span",{className:"text-base leading-none",children:xe(E).emoji}):s.jsx("span",{className:"text-white text-[10px] font-bold tracking-tighter",children:me(E)})}):I?s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-[1.5px] ring-sys-blue",children:s.jsx(y,{className:"size-5 text-sys-blue"})}):U?s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-zinc-500/20 ring-1 ring-edge-subtle",children:s.jsx(Ae,{className:"size-4 text-fg-muted"})}):s.jsx(is,{packet:e,variant:"avatar",size:"sm"})}),s.jsxs("div",{className:"flex-1 min-w-0 space-y-0.5",children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[$?s.jsx("span",{className:"font-medium text-[14px] text-fg-primary tracking-tight truncate min-w-0",children:E}):I?s.jsx("span",{className:"font-medium text-[14px] text-fg-primary tracking-tight truncate min-w-0",children:F}):s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"font-semibold text-[14px] text-fg-primary tracking-tight flex-shrink-0",children:B||"—"}),F&&s.jsx("span",{className:"text-[12px] text-fg-muted truncate min-w-0",children:F})]}),s.jsx("div",{className:"flex-1"}),s.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:os(k),children:b}),s.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:os(w),children:N}),h&&h>1&&s.jsxs("span",{className:"data-box data-box-compact flex-shrink-0",children:["×",h]}),s.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[s.jsx("span",{className:"type-data-xs text-fg-muted w-[28px] text-right",children:e.rssi}),s.jsx(he,{rssi:e.rssi,compact:!0,showValues:!1,validated:ue(e)})]})]}),s.jsxs("div",{className:"flex items-center gap-1 type-data-xs text-fg-muted",children:[s.jsx("span",{className:"data-box data-box-compact flex-shrink-0",children:j(e.timestamp)}),V>0&&s.jsxs("span",{children:[V,"B"]}),Q>0&&s.jsxs("span",{className:Q>1?"text-sys-amber/60":void 0,children:["LBT:",Q]}),null!=e.snr&&s.jsxs("span",{children:[e.snr.toFixed(0),"dB"]}),D?s.jsxs("span",{className:"text-[11px] text-fg-secondary truncate flex items-center gap-1 min-w-0",children:[R&&s.jsx(ds,{channelName:R,compact:!0,onClick:g&&A?e=>{e.stopPropagation(),g(A)}:void 0}),s.jsx("span",{className:"italic truncate",children:D})]}):P>0?s.jsx(cs,{path:M,localHash:n}):null]})]})]})]})}),gs=a.lazy(()=>n(()=>import("./PathMapMapLibre-CItCjZId.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25])));function fs(e){return`${(100*e).toFixed(0)}%`}function ys(e,s){const t=document.documentElement,a=getComputedStyle(t),n={success:a.getPropertyValue("--sys-green").trim()||"#39D98A",secondary:a.getPropertyValue("--sys-indigo").trim()||"#F9D26F",poor:a.getPropertyValue("--signal-poor").trim()||"#FF8A5C",danger:a.getPropertyValue("--sys-red").trim()||"#FF5C7A",muted:a.getPropertyValue("--text-muted").trim()||"#767688"};let l;return l=0===s?n.muted:e>=1?n.success:e>=.5?n.secondary:e>=.25?n.poor:e>0?n.danger:n.muted,{color:l}}class js extends a.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?s.jsxs("div",{className:"h-[200px] flex items-center justify-center text-fg-muted",children:[s.jsx(_e,{className:"w-4 h-4 mr-2"}),"Map failed to load"]}):this.props.children}}function bs({path:e,neighbors:n,localNode:l,localHash:r,srcHash:i,dstHash:c,neighborAffinity:d,prefixLookup:o,hubNodes:x,traceSnr:m,advertiserSource:p}){const[h,u]=a.useState(null),g=a.useMemo(()=>{if(!p)return null;const e="wardrive"===p.nodeType;return{prefix:p.prefix||"??",candidates:[{hash:p.publicKey||p.prefix||"source",name:p.name,latitude:p.latitude,longitude:p.longitude,probability:1,isLocal:!1,isWardrive:e}],confidence:1,totalMatches:1,isSource:!0}},[p]),f=a.useMemo(()=>{if(p)return null;if(!i)return null;const e=w(i),s=n[i];if((null==s?void 0:s.latitude)&&(null==s?void 0:s.longitude)&&(0!==s.latitude||0!==s.longitude))return{prefix:e,candidates:[{hash:i,name:s.node_name||s.name||"Source",latitude:s.latitude,longitude:s.longitude,probability:1,isLocal:!1,isDirectNeighbor:!0===s.zero_hop}],confidence:1,totalMatches:1,isSource:!0};const t=(null==s?void 0:s.node_name)||(null==s?void 0:s.name)||i.slice(0,8);return{prefix:e,candidates:[{hash:i,name:t,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isSource:!0}},[p,i,n]),y=a.useMemo(()=>{const e=(null==c?void 0:c.startsWith("0x"))?c.slice(2):c;if((!e||"00"===e||"0000000000000000"===e)&&l&&r){const e=w(r),s=0!==l.latitude||0!==l.longitude;return{prefix:e,candidates:[{hash:r,name:l.name||"Local Node",latitude:s?l.latitude:0,longitude:s?l.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}if(!c)return null;const s=w(c);if(r&&c===r&&l){const e=0!==l.latitude||0!==l.longitude;return{prefix:s,candidates:[{hash:c,name:l.name||"Local Node",latitude:e?l.latitude:0,longitude:e?l.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}const t=n[c];if((null==t?void 0:t.latitude)&&(null==t?void 0:t.longitude)&&(0!==t.latitude||0!==t.longitude))return{prefix:s,candidates:[{hash:c,name:t.node_name||t.name||"Destination",latitude:t.latitude,longitude:t.longitude,probability:1,isLocal:!1,isDirectNeighbor:!0===t.zero_hop}],confidence:1,totalMatches:1,isDestination:!0};const a=(null==t?void 0:t.node_name)||(null==t?void 0:t.name)||c.slice(0,8);return{prefix:s,candidates:[{hash:c,name:a,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isDestination:!0}},[c,n,l,r]),j=a.useMemo(()=>function(e,s,t,a,n,l){if(!e||0===e.length)return{hops:[],overallConfidence:0,hasValidPath:!1};const r=e.length-1,i=e.map((i,c)=>{const d=c===r,o=e.length-c,{candidates:x,totalMatches:m}=function(e,s,t,a,n=!1,l,r,i){const c=ke(s);let d;r&&(d=we(r,e,{position:i,isLastHop:n}).confidence);const{matches:o,probability:x}=function(e,s,t,a,n=!1){const l=e.toUpperCase(),r=[],i=t&&k(l,t);i&&r.push(t);for(const p of Object.keys(s))k(l,p)&&r.push(p);if(n&&i&&t&&1===r.length)return{matches:r,probability:1,bestMatch:t};if(n&&i&&r.length>1){const e=r.filter(e=>e!==t);if(1===e.length)return{matches:r,probability:1,bestMatch:e[0]}}const c=r.length>0?1/r.length:0,d=[...r].sort();let o=null,x=-1;if(1===d.length)o=d[0];else if(d.length>1&&a){for(const e of d){const s=a.get(e),t=s?"number"==typeof s?s:s.combinedScore:0;t>x&&(x=t,o=e)}o||(o=d[0])}else d.length>0&&(o=d[0]);let m=c;if(r.length>1&&a&&x>0){let e=0;for(const s of r){const t=a.get(s);e+=t?"number"==typeof t?t:t.combinedScore:0}e>0&&(m=Math.min(.95,x/e))}return{matches:r,probability:m,bestMatch:o}}(e,c,a,l,n),m=o.length,p=[],h=e.toUpperCase(),u=t&&void 0!==t.latitude&&void 0!==t.longitude&&(0!==t.latitude||0!==t.longitude);for(const f of o){if(a&&k(h,a)&&f===a&&u&&t){p.push({hash:f,name:t.name||"Local Node",latitude:t.latitude,longitude:t.longitude,probability:n?1:x,isLocal:!0});continue}const e=c[f];(null==e?void 0:e.latitude)&&(null==e?void 0:e.longitude)&&(0!==e.latitude||0!==e.longitude)&&p.push({hash:f,name:e.node_name||e.name||"Unknown",latitude:e.latitude,longitude:e.longitude,probability:x,isLocal:!1,isDirectNeighbor:!0===e.zero_hop})}const g=p.length;if(1===g)p[0].probability=d??1;else if(g>1)if(void 0!==d&&d>0){p[0].probability=d;const e=1-d,s=g-1;p.slice(1).forEach(t=>{t.probability=e/s})}else{let e=0;const s=p.map(s=>{if(s.isLocal)return{candidate:s,score:1};const a=null==l?void 0:l.get(s.hash);let n=.5;var r;let i;return u&&t&&(n=(r=function(e,s,t,a){const n=(t-e)*Math.PI/180,l=(a-s)*Math.PI/180,r=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(t*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))*6371e3}(t.latitude,t.longitude,s.latitude,s.longitude))<100?1:r<500?.9:r<1e3?.7:r<5e3?.5:r<1e4?.3:.1),a?i=.3*n+.3*a.hopConsistencyScore+.4*a.frequencyScore:(i=n,s.isDirectNeighbor&&(i=Math.max(i,.8))),e+=i,{candidate:s,score:i}});if(e>0)s.forEach(({candidate:s,score:t})=>{s.probability=Math.min(.95,t/e)});else{const e=1/g;p.forEach(s=>s.probability=e)}}return{candidates:p,totalMatches:m}}(i,s,t,a,d,n,l,o),p=x.length>0?Math.max(...x.map(e=>e.probability)):0;return{prefix:i,candidates:x,confidence:p,totalMatches:m}}),c=i.reduce((e,s)=>0===s.confidence?0:e*s.confidence,1),d=i.some(e=>e.candidates.length>0);return{hops:i,overallConfidence:c,hasValidPath:d}}(e,n,l,r,d,o),[e,n,l,r,d,o]),b=a.useMemo(()=>{const e=[];g?e.push(g):f&&e.push(f),e.push(...j.hops),y&&e.push(y);const s=e.reduce((e,s)=>0===s.confidence?0:e*s.confidence,1),t=e.some(e=>e.candidates.some(e=>0!==e.latitude||0!==e.longitude));return{hops:e,overallConfidence:s,hasValidPath:t}},[g,f,j,y]);return b.hasValidPath?s.jsxs("div",{className:"h-full flex flex-col space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between text-xs",children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx("span",{className:"text-fg-muted",children:"Path Confidence:"}),s.jsx("span",{className:(N=b.overallConfidence,N>=1?"text-sys-green":N>=.5?"text-sys-indigo":N>=.25?"text-signal-poor":N>0?"text-sys-red":"text-fg-muted"),children:fs(b.overallConfidence)}),s.jsx("button",{className:"text-fg-muted hover:text-fg-secondary transition-colors",title:"Confidence is calculated based on how many known nodes match each path prefix. Multiple matches reduce confidence due to collision probability.",children:s.jsx(ne,{className:"w-3 h-3"})})]}),s.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-sys-green"}),s.jsx("span",{className:"text-fg-muted",children:"Exact"})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-sys-indigo"}),s.jsx("span",{className:"text-fg-muted",children:"Multi"})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-fg-muted"}),s.jsx("span",{className:"text-fg-muted",children:"Unknown"})]})]})]}),s.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:s.jsx(js,{children:s.jsx(a.Suspense,{fallback:s.jsx("div",{className:"h-full bg-elevated flex items-center justify-center text-fg-muted text-sm",children:"Loading map..."}),children:s.jsx(gs,{resolvedPath:b,localNode:l,hubNodes:x,hoveredHopIndex:h,onHoverHop:u,traceSnr:m})})})}),s.jsx("div",{className:"flex flex-wrap items-center gap-1.5",children:b.hops.map((e,a)=>{var n,l,r;const i=!0===e.isSource,c=!0===e.isDestination,d=h===a;let o;return o=i?`Source: ${(null==(n=e.candidates[0])?void 0:n.name)||"Unknown"}`:c?`Destination: ${(null==(l=e.candidates[0])?void 0:l.name)||"Unknown"}`:0===e.totalMatches?"No matching nodes found":1===e.totalMatches?`Exact match: ${(null==(r=e.candidates[0])?void 0:r.name)||"Unknown"}`:`${e.totalMatches} possible matches (${(100*e.confidence).toFixed(0)}% confidence)`,s.jsxs("div",{className:t("flex items-center gap-1 px-1.5 py-0.5 rounded type-data-xs cursor-pointer transition-all",d?"bg-sys-blue/20 ring-1 ring-sys-blue/50":"bg-elevated hover:bg-subtle",i&&"border border-sys-green/30",c&&"border border-sys-blue/30"),title:o,onMouseEnter:()=>u(a),onMouseLeave:()=>u(null),children:[i&&s.jsx("span",{className:"text-sys-green text-[8px] mr-0.5",children:"SRC"}),c&&s.jsx("span",{className:"text-sys-blue text-[8px] mr-0.5",children:"DST"}),s.jsx("span",{style:ys(e.confidence,e.totalMatches),children:e.prefix}),!i&&!c&&e.totalMatches>1&&s.jsxs("span",{className:"text-fg-muted",children:["×",e.totalMatches]}),!i&&!c&&0===e.totalMatches&&s.jsx("span",{className:"text-fg-muted",children:"?"})]},a)})})]}):s.jsxs("div",{className:"flex items-center justify-center text-fg-muted text-xs py-4",children:[s.jsx(He,{className:"w-3.5 h-3.5 mr-1.5 opacity-50"}),"No location data available for path nodes"]});var N}function Ns(e){return e.match(/.{1,2}/g)||[]}function vs(e){return null!==e&&e.startsWith("payload:")}const ks=15,ws="color-mix(in srgb, var(--elevated) 60%, var(--body))",Cs="\n    inset 0 0 0 1px color-mix(in srgb, var(--fg-primary) 6%, transparent),\n    inset 0 1px 0 color-mix(in srgb, white 3%, transparent),\n    0 1px 2px color-mix(in srgb, black 5%, transparent)\n  ",Ss=2,Hs={type:"tween",duration:.25,ease:[.25,.1,.25,1]};function _s(e,s){return e?`inset 0 0 0 ${Ss}px ${v[s]}`:Cs}function Ts(e,s){return e?s:`color-mix(in srgb, ${s} ${ks}%, transparent)`}function Ms({segments:e,selectedSegment:t,onSegmentClick:n}){const[l,r]=a.useState(null),[i,c]=a.useState(null),d=e.some(e=>void 0!==e.id)&&n,o=[];for(const s of e){const e=Ns(s.hex);for(const t of e)o.push({byte:t.toUpperCase(),color:s.color,id:s.id})}const x=[];for(let s=0;s<o.length;s+=16)x.push(o.slice(s,s+16));return s.jsx("div",{className:"space-y-1",children:x.map((e,a)=>{const o=e.length<16;return s.jsx("div",{className:"flex rounded-md overflow-hidden",children:e.map(({byte:a,color:x,id:m},p)=>{const h=p===e.length-1,u=o&&h,g=v[x],f=m?l===m:i===x,y=Boolean(m&&t===m),j=f||y;return s.jsx("span",{className:"w-[1.75rem] text-xs text-center py-0.5 font-mono select-text "+(d?"cursor-pointer":""),style:{backgroundColor:Ts(j,g),color:j?"rgba(255,255,255,0.95)":g,transition:j?"none":"background-color 0.15s ease-out, color 0.15s ease-out",touchAction:"manipulation",...u?{borderRadius:"0 0.375rem 0.375rem 0"}:{}},onMouseEnter:()=>{m?r(m):c(x)},onMouseLeave:()=>{r(null),c(null)},onClick:()=>m&&(null==n?void 0:n(m)),onTouchStart:()=>{m?r(m):c(x)},onTouchEnd:()=>{r(null),c(null)},children:a},p)})},a)})})}function Ps({rawHex:e,hexSegments:t,selectedSegment:n,onSegmentClick:l}){const[r,i]=a.useState(!1),c=a.useCallback(async()=>{try{await navigator.clipboard.writeText(e.toUpperCase()),i(!0),setTimeout(()=>i(!1),2e3)}catch(s){}},[e]);return s.jsxs("div",{className:"bg-black rounded-2xl p-6 relative",children:[s.jsx(Ms,{segments:t,selectedSegment:n,onSegmentClick:l}),s.jsx("button",{onClick:c,className:"absolute bottom-3 right-3 flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg bg-subtle-fill-hover hover:bg-subtle-fill-strong text-fg-muted hover:text-fg-secondary transition-all text-xs font-sans",title:"Copy raw packet hex",children:r?s.jsxs(s.Fragment,{children:[s.jsx(T,{className:"w-3.5 h-3.5 text-sys-green"}),s.jsx("span",{className:"text-sys-green",children:"Copied"})]}):s.jsxs(s.Fragment,{children:[s.jsx(u,{className:"w-3.5 h-3.5"}),s.jsx("span",{children:"Copy"})]})})]})}function Bs({bits:e,field:t,value:a,binary:n}){return s.jsxs("tr",{children:[s.jsx("td",{className:"py-1.5 text-xs text-fg-muted tabular-nums",children:e}),s.jsx("td",{className:"py-1.5 text-sm text-fg-secondary",children:t}),s.jsx("td",{className:"py-1.5",children:(()=>{if("Payload Type"===t){const e=de[a]||"zinc";return s.jsx(g,{color:e,children:a})}if("Route Type"===t){const e=ce[a]||"zinc";return s.jsx(g,{color:e,children:a})}return s.jsx("span",{className:"text-sm text-fg-primary",children:a})})()}),s.jsx("td",{className:"py-1.5 type-data-xs text-sys-cyan",children:n})]})}function Fs({id:e,title:t,color:a,hexBytes:n,startByte:l,endByte:r,isSelected:i,children:c}){const d=n?Ns(n):[];return s.jsxs(H.div,{layout:"position",layoutId:e,transition:Hs,className:"w-full min-w-0 overflow-hidden rounded-xl p-4 sm:p-5 space-y-4",style:{backgroundColor:ws,boxShadow:_s(i,a)},children:[s.jsxs("div",{className:"flex items-start justify-between gap-4",children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-0.5 min-w-0",children:[s.jsx(g,{color:a,children:t}),d.length>0&&d.length<=16&&d.map((e,t)=>s.jsx(g,{color:a,className:"font-mono",children:e.toUpperCase()},t))]}),s.jsxs("span",{className:"type-data-xs text-fg-muted flex-shrink-0",children:["Bytes ",l,"-",r]})]}),s.jsx("div",{className:"min-w-0 overflow-hidden",children:c})]})}function Ls({advert:e,timestamp:t}){const a=P(t||e.timestamp);return s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-indigo/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[s.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-indigo) 0%, var(--sys-blue) 100%)"},children:s.jsx(y,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:e.name||"Unknown Node"}),s.jsx("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:e.nodeType})]})]}),s.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),s.jsxs("div",{className:"px-4 py-3 space-y-2",children:[void 0!==e.latitude&&void 0!==e.longitude&&s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(He,{className:"w-4 h-4 text-sys-indigo flex-shrink-0"}),s.jsxs("span",{className:"text-sm text-fg-secondary font-mono",children:[e.latitude.toFixed(5),"°, ",e.longitude.toFixed(5),"°"]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(le,{className:"w-4 h-4 text-sys-indigo flex-shrink-0"}),s.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:a})]})]})]})})}function Ds({decoded:e,timestamp:t}){const a=t?P(t):"Unknown";return s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-teal/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[s.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-teal) 0%, var(--sys-cyan) 100%)"},children:s.jsx(Fe,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:e.channelName||"Channel Data"}),s.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:[e.dataLength," bytes • ",e.decrypted?"Decrypted":"Encrypted"]})]})]}),s.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),s.jsxs("div",{className:"px-4 py-3 space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Ce,{className:"w-4 h-4 text-sys-teal flex-shrink-0"}),s.jsxs("span",{className:"text-sm text-fg-secondary font-sans",children:["Channel: ",s.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(le,{className:"w-4 h-4 text-sys-teal flex-shrink-0"}),s.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:a})]}),e.decrypted&&e.decryptedHex&&s.jsxs("div",{className:"mt-2 pt-2 border-t border-edge-subtle",children:[s.jsx("p",{className:"type-micro text-fg-muted mb-1 font-sans",children:"Decrypted Data"}),s.jsx("div",{className:"max-w-full overflow-x-auto",children:s.jsx(Te,{size:"compact",copy:!0,className:"inline-block",children:s.jsx("span",{className:"break-all text-xs",children:e.decryptedHex.toUpperCase()})})})]})]})]})})}function zs({decoded:e,timestamp:t,isLoading:n=!1,onDecrypted:l}){const r=t?P(t):"Unknown",[i,c]=a.useState(""),[d,o]=a.useState(!1),[x,m]=a.useState(null),[p,u]=a.useState(!1),g=a.useCallback(async()=>{if(i.trim()&&e.ciphertextHex&&e.macHex){o(!0),m(null);try{const s=parseInt(e.channelHash,16),t=h(e.macHex),a=h(e.ciphertextHex),n=await B(i.trim(),s,t,a);if(n.success){const s=n.result.plaintext,t=new TextDecoder("utf-8",{fatal:!1}).decode(s.slice(5)),a=t.indexOf(": "),r={...e,channelName:n.result.channelName,decrypted:!0,timestamp:s[0]|s[1]<<8|s[2]<<16|s[3]<<24,flags:s[4],senderName:a>0?t.slice(0,a):void 0,text:a>0?t.slice(a+2):t};null==l||l(r),c(""),u(!1)}else m(n.error)}catch(s){m(s instanceof Error?s.message:"Unknown error")}finally{o(!1)}}},[i,e,l]);return n?s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-xl p-4 sm:p-5",style:{backgroundColor:"color-mix(in srgb, var(--elevated) 60%, var(--body))",boxShadow:"\n              inset 0 0 0 1px color-mix(in srgb, var(--fg-primary) 6%, transparent),\n              inset 0 1px 0 color-mix(in srgb, white 3%, transparent),\n              0 1px 2px color-mix(in srgb, black 5%, transparent)\n            "},children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3 h-[15px]",children:[s.jsx("div",{className:"h-2.5 w-12 rounded bg-subtle-fill-hover animate-pulse"}),s.jsx("div",{className:"h-2.5 w-16 rounded bg-subtle-fill-hover animate-pulse"})]}),s.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tl-md",style:{background:"color-mix(in srgb, var(--sys-blue) 30%, transparent)"},children:s.jsxs("div",{className:"space-y-1.5",children:[s.jsx("div",{className:"h-3.5 w-48 rounded bg-subtle-fill-strong animate-pulse"}),s.jsx("div",{className:"h-3.5 w-32 rounded bg-subtle-fill-strong animate-pulse"})]})})]})}):e.decrypted?s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-xl p-4 sm:p-5",style:{backgroundColor:"color-mix(in srgb, var(--elevated) 60%, var(--body))",boxShadow:"\n              inset 0 0 0 1px color-mix(in srgb, var(--fg-primary) 6%, transparent),\n              inset 0 1px 0 color-mix(in srgb, white 3%, transparent),\n              0 1px 2px color-mix(in srgb, black 5%, transparent)\n            "},children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.senderName&&s.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:["From ",s.jsx("span",{className:"text-fg-secondary font-medium",children:e.senderName})]}),e.channelName&&s.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:["in ",s.jsx("span",{className:"text-sys-cyan font-medium",children:e.channelName})]})]}),s.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tl-md",style:{background:"linear-gradient(135deg, var(--sys-blue) 0%, color-mix(in srgb, var(--sys-blue) 85%, var(--sys-cyan)) 100%)"},children:s.jsx("p",{className:"text-sm text-white font-sans leading-relaxed whitespace-pre-wrap break-words",children:e.text})})]})}):s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-2xl overflow-hidden bg-zinc-500/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[s.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--zinc-500) 0%, color-mix(in srgb, var(--zinc-500) 70%, black) 100%)"},children:s.jsx(Re,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:e.isPublicHashChannel?"Public Hash Channel":"Encrypted Message"}),s.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:["Channel hash: ",s.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]})]})]}),s.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),s.jsxs("div",{className:"px-4 py-3 space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(le,{className:"w-4 h-4 text-zinc-400 flex-shrink-0"}),s.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:r})]}),e.ciphertextHex&&e.macHex&&s.jsx("div",{className:"space-y-2",children:p?s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:i,onChange:e=>c(e.target.value),placeholder:"Channel name (e.g. south-bay)",className:"flex-1 px-3 py-1.5 text-sm rounded-lg bg-subtle-fill-strong border border-edge-subtle text-fg-primary placeholder:text-fg-muted focus:outline-none focus:border-zinc-500",onKeyDown:e=>"Enter"===e.key&&g(),disabled:d}),s.jsx("button",{onClick:g,disabled:d||!i.trim(),className:"px-3 py-1.5 text-sm font-medium rounded-lg bg-zinc-600 hover:bg-zinc-500 text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:d?"Testing...":"Try"}),s.jsx("button",{onClick:()=>{u(!1),m(null),c("")},className:"px-2 py-1.5 text-sm rounded-lg hover:bg-subtle-fill-strong text-fg-muted transition-colors",children:"×"})]}),x&&s.jsx("p",{className:"text-xs text-sys-red",children:x})]}):s.jsx("button",{onClick:()=>u(!0),className:"text-xs text-zinc-400 hover:text-zinc-300 underline underline-offset-2 transition-colors",children:"Know the channel name? Try to decrypt"})}),!p&&s.jsx("p",{className:"text-xs text-fg-muted",children:e.isPublicHashChannel?"Public hash channel message. Key not in common channel list.":"Unknown hash channel. Channel name required for decryption."})]})]})})}function Rs({decoded:e,timestamp:t}){const a=t?P(t):"Unknown";return s.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:"linear-gradient(135deg, var(--sys-green) 0%, var(--sys-teal) 100%)"},children:s.jsx(Be,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-semibold text-fg-primary font-sans",children:"Acknowledgment"}),s.jsxs("p",{className:"text-xs text-fg-muted font-sans mt-0.5",children:["CRC: ",s.jsxs("span",{className:"font-mono text-sys-green",children:["0x",e.crc]})," · ",a]})]})]})}function As({decoded:e,timestamp:t}){const a=t?P(t):"Unknown",n=e.path.length;return s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-amber/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[s.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-amber) 0%, var(--sys-orange) 100%)"},children:s.jsx(Se,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:"Path Response"}),s.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:[n," ",1===n?"hop":"hops"]})]})]}),s.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),s.jsxs("div",{className:"px-4 py-3 space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(le,{className:"w-4 h-4 text-sys-amber flex-shrink-0"}),s.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:a})]}),e.path.length>0&&s.jsx("div",{className:"mt-2 pt-2 border-t border-edge-subtle",children:s.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.path.map((e,t)=>s.jsxs("div",{className:"flex items-center gap-2",children:[t>0&&s.jsx(pe,{className:"w-4 h-4 text-sys-amber"}),s.jsx(g,{color:"amber",className:"font-mono",children:e})]},t))})})]})]})})}function Es({decoded:e,timestamp:t}){const a=t?P(t):"Unknown",n=e.pathHashes.length,l=e.snrValues.length;return s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-blue/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[s.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-blue) 0%, var(--sys-indigo) 100%)"},children:s.jsx(Pe,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:["Trace ",e.isComplete?"Complete":"In Progress"]}),s.jsxs("p",{className:"text-sm text-fg-muted mt-0.5",children:["Tag: 0x",e.traceTag.slice(0,8),e.isComplete&&" • ✓"]})]})]}),s.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),s.jsxs("div",{className:"px-4 py-3 space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(le,{className:"w-4 h-4 text-sys-blue flex-shrink-0"}),s.jsx("span",{className:"text-sm text-fg-secondary",children:a})]}),s.jsxs("div",{className:"flex items-center gap-4 text-xs text-fg-muted",children:[s.jsxs("span",{children:[n," target ",1===n?"hop":"hops"]}),s.jsx("span",{children:"•"}),s.jsxs("span",{children:[l," SNR ",1===l?"sample":"samples"]}),0!==e.authCode&&s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"•"}),s.jsxs("span",{children:["Auth: ",e.authCode]})]})]}),e.pathHashes.length>0&&s.jsx("div",{className:"flex flex-wrap items-center gap-2 pt-1",children:e.pathHashes.map((t,a)=>{const n=e.snrValues[a],l=void 0!==n?(e=>e>=7?"green":e>=0?"yellow":e>=-5?"orange":"red")(n):"zinc",r=void 0!==n;return s.jsxs("div",{className:"flex items-center gap-2",children:[a>0&&s.jsx(pe,{className:"w-4 h-4 text-sys-blue flex-shrink-0"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(g,{color:r?"blue":"zinc",className:"font-mono",children:t}),r&&s.jsxs(g,{color:l,className:"font-mono",children:[n>=0?"+":"",Number.isInteger(n)?n:n.toFixed(1),"dB"]})]})]},a)})})]})]})})}function $s({decoded:e,timestamp:t}){const a=t?P(t):"Unknown";return e.encrypted?s.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:"linear-gradient(135deg, var(--sys-indigo) 0%, var(--sys-blue) 100%)"},children:s.jsx(Re,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-semibold text-fg-primary font-sans",children:"Encrypted Message"}),s.jsxs("p",{className:"text-xs text-fg-muted font-sans mt-0.5",children:[e.srcHash," → ",e.destHash," · ",a]})]})]}):s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1.5 px-1",children:[s.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:[s.jsx("span",{className:"font-mono text-fg-secondary",children:e.srcHash})," → ",s.jsx("span",{className:"font-mono text-fg-secondary",children:e.destHash})]}),s.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:["· ",a]})]}),s.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tr-md ml-auto",style:{background:"linear-gradient(135deg, var(--sys-green) 0%, var(--sys-teal) 100%)"},children:s.jsx("p",{className:"text-sm text-white font-sans leading-relaxed whitespace-pre-wrap break-words",children:e.text})})]})}function Is({decoded:e,timestamp:t}){const a=t?P(t):"Unknown",n=(e.partNumber+1)/e.totalParts*100;return s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-yellow/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[s.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-yellow) 0%, var(--sys-amber) 100%)"},children:s.jsx(Me,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:"Multipart Segment"}),s.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:["Part ",e.partNumber+1," of ",e.totalParts]})]})]}),s.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),s.jsxs("div",{className:"px-4 py-3 space-y-3",children:[s.jsx("div",{children:s.jsx("div",{className:"h-2 bg-subtle-fill-strong rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${n}%`,background:"linear-gradient(90deg, var(--sys-yellow), var(--sys-amber))"}})})}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Ce,{className:"w-4 h-4 text-sys-yellow flex-shrink-0"}),s.jsxs("span",{className:"text-sm text-fg-secondary font-sans",children:["Message ID: ",s.jsx("span",{className:"font-mono",children:e.messageId})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(le,{className:"w-4 h-4 text-sys-yellow flex-shrink-0"}),s.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:a})]})]})]})})}function Us({decoded:e,timestamp:t,payloadType:a}){const n=t?P(t):"Unknown",l=(()=>{switch(a){case _.REQ:return{icon:F,gradient:"var(--sys-orange), var(--sys-red)",bg:"rgba(249, 115, 22, 0.15)",label:"Request"};case _.RESPONSE:return{icon:Ee,gradient:"var(--sys-green), var(--sys-teal)",bg:"rgba(34, 197, 94, 0.15)",label:"Response"};case _.ANON_REQ:return{icon:Re,gradient:"var(--sys-indigo), var(--sys-pink)",bg:"rgba(91, 91, 214, 0.15)",label:"Anonymous Request"};default:return{icon:ge,gradient:"var(--sys-gray), var(--sys-slate)",bg:"rgba(107, 114, 128, 0.15)",label:e.payloadTypeName}}})(),r=l.icon;return s.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:`linear-gradient(135deg, ${l.gradient})`},children:s.jsx(r,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-semibold text-fg-primary font-sans",children:l.label}),s.jsxs("p",{className:"text-xs text-fg-muted font-sans mt-0.5",children:[e.length," bytes · ",n]})]})]})}function Vs({pathHex:e}){if(!e)return null;const t=Ns(e);return s.jsx("div",{className:"flex flex-wrap items-center gap-2 py-2",children:t.map((e,t)=>s.jsxs("div",{className:"flex items-center gap-2",children:[t>0&&s.jsx(pe,{className:"w-4 h-4 text-sys-amber flex-shrink-0"}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(Te,{size:"compact",copy:!0,children:e.toUpperCase()}),s.jsx("span",{className:"text-xs text-fg-muted font-sans tabular-nums w-4 text-left",children:t+1})]})]},t))})}function Qs({decoded:e,payloadType:t}){const a=M[t]||`TYPE_${t}`;switch(e.type){case"advert":{const t="chat"===e.nodeType?"companion":e.nodeType.replace("_"," "),a=void 0!==e.latitude&&void 0!==e.longitude&&!(0===e.latitude&&0===e.longitude);return s.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Role:"})," ",t]}),e.name&&s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Name:"})," ",e.name]}),a&&s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Location:"})," ",e.latitude.toFixed(4),"°, ",e.longitude.toFixed(4),"°"]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Time:"})," ",P(e.timestamp)]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Flags:"})," ",e.flagsDescription]})]})}case"ack":return s.jsx("div",{className:"text-xs text-fg-primary space-y-0.5",children:s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"CRC:"})," 0x",e.crc]})});case"path":return s.jsx("div",{className:"text-xs text-fg-primary space-y-1",children:s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Path:"})," ",e.pathString||"(empty)"]})});case"trace":return s.jsxs("div",{className:"text-xs text-fg-primary space-y-1",children:[s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Tag:"})," 0x",e.traceTag]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Target Path:"})," ",e.pathString||"(empty)"]}),e.snrValues.length>0&&s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"SNR:"})," ",e.snrValues.map(e=>`${e>=0?"+":""}${Number.isInteger(e)?e:e.toFixed(1)}dB`).join(" → ")]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Status:"})," ",e.isComplete?"✓ Complete":`In progress (${e.snrValues.length}/${e.pathHashes.length})`]})]});case"txt_msg":return s.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Dest:"})," ",e.destHash]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Src:"})," ",e.srcHash]}),e.encrypted?s.jsx("p",{className:"text-fg-muted italic",children:"Encrypted content"}):s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Text:"})," ",e.text]})]});case"grp_txt":return s.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Channel:"})," ",e.channelName?s.jsx("span",{className:"text-sys-green",children:e.channelName}):e.isPublicHashChannel?s.jsx("span",{className:"text-sys-indigo",children:"Public Hash Channel"}):s.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]}),e.decrypted?s.jsxs(s.Fragment,{children:[e.senderName&&s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"From:"})," ",e.senderName]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Text:"})," ",e.text]})]}):e.isPublicHashChannel?s.jsx("p",{className:"text-fg-muted italic",children:"Encrypted (public hash channel)"}):s.jsx("p",{className:"text-fg-muted italic",children:"Encrypted (unknown channel)"})]});case"grp_data":return s.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Channel:"})," ",e.channelName?s.jsx("span",{className:"text-sys-teal",children:e.channelName}):s.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Data:"})," ",e.dataLength," bytes ",e.decrypted?"(decrypted)":"(encrypted)"]})]});case"multipart":return s.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Part:"})," ",e.partNumber+1,"/",e.totalParts]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Message ID:"})," ",e.messageId]})]});default:return s.jsxs("p",{className:"text-xs text-fg-secondary",children:[a," (",e.length," bytes)"]})}}const Os=a.memo(function({packet:e,decodedGrpTxt:t}){var n,l;const r=e.raw_packet||"",i=r.length/2,c=C(),[d,o]=a.useState(null),[x,h]=a.useState(null),[u,f]=a.useState(!1),[y,j]=a.useState(null),b=a.useCallback(e=>{j(s=>s===e?null:e)},[]),N=a.useMemo(()=>function(e){if(!e||e.length<4)return null;const s=X.fromHex(e);if(!s.success||!s.packet)return null;const t=s.packet,a=function(e){const s=3&e,t=e>>2&15,a=e>>6&3;return[{bits:"0-1",field:"Route Type",value:m(s),binary:(3&s).toString(2).padStart(2,"0")},{bits:"2-5",field:"Payload Type",value:p(t),binary:(15&t).toString(2).padStart(4,"0")},{bits:"6-7",field:"Version",value:a.toString(),binary:(3&a).toString(2).padStart(2,"0")}]}(t.header),n=e.slice(0,2);let l=2,r="";t.hasTransportCodes()&&(r=e.slice(2,10),l=10);const i=e.slice(l,l+2),c=l+2,d=c+2*t.pathLen,o=e.slice(c,d),x=e.slice(d),h=Y(t);return{packet:t,headerHex:n,headerFields:a,transportCodesHex:r,pathLengthHex:i,pathDataHex:o,payloadHex:x,payloadStartByte:Math.floor(d/2),decoded:h}}(r),[r]),v=null==(n=null==N?void 0:N.packet)?void 0:n.payloadType,k=(null==N?void 0:N.payloadHex)||"",w=null==(l=null==N?void 0:N.packet)?void 0:l.payload,T=v===_.GRP_TXT,M=v===_.GRP_DATA,B=T&&!t&&(!c||u);if(a.useEffect(()=>{if(o(null),f(!1),t)return;if(!T||!w||w.length<4)return;if(!c)return void f(!0);f(!0);let e=!1;return ee(w).then(s=>{e||(o(s),f(!1))}),()=>{e=!0}},[k,T,c,t]),a.useEffect(()=>{if(h(null),!M||!w||w.length<4)return;if(!c)return;let e=!1;return se(w).then(s=>{e||h(s)}),()=>{e=!0}},[k,M,c]),!N||0===r.length)return s.jsx("div",{className:"p-4 text-center text-fg-muted",children:s.jsx("p",{className:"text-sm",children:"No raw packet data available"})});const{packet:F}=N;let L=N.decoded;t&&"grp_txt"===N.decoded.type?L=t:d&&"grp_txt"===N.decoded.type?L=d:x&&"grp_data"===N.decoded.type&&(L=x);const D=a.useMemo(()=>function(e,t){switch(e.type){case"advert":return function(e,t){const a=[];let n=0;const l=t.slice(0,64);a.push({id:"payload:publicKey",title:"Public Key",color:"pink",hex:l,startByte:n,endByte:n+31,decoded:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:e.publicKey.toUpperCase()}),s.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Ed25519 public key (32 bytes)"})]})}),n+=32;const r=t.slice(64,72);a.push({id:"payload:timestamp",title:"Timestamp",color:"orange",hex:r,startByte:n,endByte:n+3,decoded:s.jsxs(s.Fragment,{children:[s.jsx(Te,{size:"standard",copy:!0,children:r.toUpperCase()}),s.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:[e.timestamp," (",P(e.timestamp),")"]})]})}),n+=4;const i=t.slice(72,200);a.push({id:"payload:signature",title:"Signature",color:"teal",hex:i,startByte:n,endByte:n+63,decoded:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:e.signature.toUpperCase()}),s.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Ed25519 signature (64 bytes)"})]})}),n+=64;const c=t.slice(200,202);if(a.push({id:"payload:flags",title:"Flags",color:"blue",hex:c,startByte:n,endByte:n,decoded:s.jsxs(s.Fragment,{children:[s.jsxs(Te,{size:"standard",copy:!0,children:["0x",e.flags.toString(16).padStart(2,"0").toUpperCase()]}),s.jsx("p",{className:"text-xs text-fg-primary mt-1",children:e.flagsDescription}),s.jsxs("p",{className:"text-xs text-fg-muted",children:["Node Type: ",e.nodeType]})]})}),n+=1,void 0!==e.latitude){const l=t.slice(2*n,2*n+8);a.push({id:"payload:latitude",title:"Latitude",color:"green",hex:l,startByte:n,endByte:n+3,decoded:s.jsxs(s.Fragment,{children:[s.jsx(Te,{size:"standard",copy:!0,children:l.toUpperCase()}),s.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:[e.latitude.toFixed(6),"°"]})]})}),n+=4}if(void 0!==e.longitude){const l=t.slice(2*n,2*n+8);a.push({id:"payload:longitude",title:"Longitude",color:"indigo",hex:l,startByte:n,endByte:n+3,decoded:s.jsxs(s.Fragment,{children:[s.jsx(Te,{size:"standard",copy:!0,children:l.toUpperCase()}),s.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:[e.longitude.toFixed(6),"°"]})]})}),n+=4}if(e.name){const l=t.slice(2*n),r=l.length/2;a.push({id:"payload:name",title:"Name",color:"amber",hex:l,startByte:n,endByte:n+r-1,decoded:s.jsxs(s.Fragment,{children:[s.jsx(Te,{size:"standard",copy:!0,children:l.toUpperCase()}),s.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:['"',e.name,'"']})]})})}return a}(e,t);case"ack":return function(e,t){return[{id:"payload:crc",title:"CRC",color:"green",hex:t.slice(0,8),startByte:0,endByte:3,decoded:s.jsxs(s.Fragment,{children:[s.jsxs(Te,{size:"standard",copy:!0,children:["0x",e.crc]}),s.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"CRC32 of acknowledged packet"})]})}]}(e,t);case"grp_txt":return function(e,t){const a=[];a.push({id:"payload:channelHash",title:"Channel Hash",color:"blue",hex:t.slice(0,2),startByte:0,endByte:0,decoded:s.jsxs(s.Fragment,{children:[s.jsxs(Te,{size:"standard",copy:!0,children:["0x",e.channelHash]}),e.channelName&&s.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:["Channel: ",e.channelName]})]})}),e.macHex&&a.push({id:"payload:mac",title:"MAC",color:"indigo",hex:t.slice(2,6),startByte:1,endByte:2,decoded:s.jsxs(s.Fragment,{children:[s.jsx(Te,{size:"standard",copy:!0,children:e.macHex.toUpperCase()}),s.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Truncated HMAC-SHA256"})]})});const n=t.slice(6);return n&&a.push({id:"payload:ciphertext",title:e.decrypted?"Message":"Ciphertext",color:e.decrypted?"green":"zinc",hex:n,startByte:3,endByte:3+n.length/2-1,decoded:e.decrypted?s.jsxs(s.Fragment,{children:[s.jsxs("p",{className:"text-sm text-fg-primary",children:['"',e.text,'"']}),e.senderName&&s.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:["From: ",e.senderName]})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:n.toUpperCase()}),s.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"AES-128-ECB encrypted"})]})}),a}(e,t);case"grp_data":return function(e,t){const a=[];a.push({id:"payload:channelHash",title:"Channel Hash",color:"blue",hex:t.slice(0,2),startByte:0,endByte:0,decoded:s.jsxs(s.Fragment,{children:[s.jsxs(Te,{size:"standard",copy:!0,children:["0x",e.channelHash]}),e.channelName&&s.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:["Channel: ",e.channelName]})]})}),e.macHex&&a.push({id:"payload:mac",title:"MAC",color:"indigo",hex:t.slice(2,6),startByte:1,endByte:2,decoded:s.jsxs(s.Fragment,{children:[s.jsx(Te,{size:"standard",copy:!0,children:e.macHex.toUpperCase()}),s.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Truncated HMAC-SHA256"})]})});const n=t.slice(6);return n&&a.push({id:"payload:ciphertext",title:e.decrypted?"Decrypted Data":"Encrypted Data",color:e.decrypted?"green":"zinc",hex:n,startByte:3,endByte:3+n.length/2-1,decoded:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:(e.decryptedHex||n).toUpperCase()}),s.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[e.dataLength," bytes",e.decrypted?"":" (AES-128-ECB encrypted)"]})]})}),a}(e,t);case"path":return function(e,t){return[{id:"payload:path",title:"Path Hops",color:"amber",hex:t,startByte:0,endByte:t.length/2-1,decoded:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex flex-wrap items-center gap-1",children:e.path.map((e,t)=>s.jsxs("span",{className:"flex items-center gap-1",children:[t>0&&s.jsx(pe,{className:"w-3 h-3 text-fg-muted"}),s.jsx(g,{color:"amber",className:"font-mono",children:e})]},t))}),s.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[e.path.length," hops"]})]})}]}(e,t);case"trace":return function(e,t){const a=[];a.push({id:"payload:crc",title:"Trace Tag",color:"blue",hex:t.slice(0,8),startByte:0,endByte:3,decoded:s.jsxs(s.Fragment,{children:[s.jsxs(Te,{size:"standard",copy:!0,children:["0x",e.traceTag]}),s.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Unique trace request identifier"})]})}),a.push({id:"payload:mac",title:"Auth Code",color:"indigo",hex:t.slice(8,16),startByte:4,endByte:7,decoded:s.jsxs(s.Fragment,{children:[s.jsx(Te,{size:"standard",copy:!0,children:e.authCode}),s.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Authentication/verification code"})]})}),a.push({id:"payload:flags",title:"Flags",color:"amber",hex:t.slice(16,18),startByte:8,endByte:8,decoded:s.jsxs(s.Fragment,{children:[s.jsxs(Te,{size:"standard",copy:!0,children:["0x",e.flags.toString(16).toUpperCase().padStart(2,"0")]}),s.jsx("p",{className:"text-xs text-fg-muted mt-1",children:0===e.flags?"No flags set":`Flags: ${e.flags.toString(2).padStart(8,"0")}b`})]})});const n=t.slice(18);if(n){const t=e=>e>=7?"green":e>=0?"yellow":e>=-5?"orange":"red";a.push({id:"payload:path",title:"Target Path",color:"indigo",hex:n,startByte:9,endByte:9+n.length/2-1,decoded:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex flex-wrap items-center gap-1",children:e.pathHashes.map((a,n)=>{const l=e.snrValues[n],r=void 0!==l?t(l):"zinc";return s.jsxs("span",{className:"flex items-center gap-1",children:[n>0&&s.jsx(pe,{className:"w-3 h-3 text-fg-muted"}),s.jsx(g,{color:"indigo",className:"font-mono",children:a}),void 0!==l&&s.jsxs(g,{color:r,className:"font-mono",children:[l>=0?"+":"",Number.isInteger(l)?l:l.toFixed(1),"dB"]})]},n)})}),s.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[e.pathHashes.length," target ",1===e.pathHashes.length?"hop":"hops",e.snrValues.length>0&&` • ${e.snrValues.length} SNR ${1===e.snrValues.length?"value":"values"} collected`,e.isComplete&&" • ✓ Complete"]})]})})}return a}(e,t);case"multipart":return function(e,t){const a=[];a.push({id:"payload:msgId",title:"Message ID",color:"blue",hex:t.slice(0,4),startByte:0,endByte:1,decoded:s.jsxs(s.Fragment,{children:[s.jsx(Te,{size:"standard",copy:!0,children:e.messageId.toUpperCase()}),s.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Unique message identifier"})]})}),a.push({id:"payload:partNum",title:"Part Number",color:"amber",hex:t.slice(4,6),startByte:2,endByte:2,decoded:s.jsxs(s.Fragment,{children:[s.jsx(Te,{size:"standard",copy:!0,children:e.partNumber}),s.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"0-indexed part number"})]})}),a.push({id:"payload:totalParts",title:"Total Parts",color:"orange",hex:t.slice(6,8),startByte:3,endByte:3,decoded:s.jsxs(s.Fragment,{children:[s.jsx(Te,{size:"standard",copy:!0,children:e.totalParts}),s.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:["Part ",e.partNumber+1," of ",e.totalParts]})]})});const n=t.slice(8);return n&&a.push({id:"payload:partData",title:"Part Data",color:"cyan",hex:n,startByte:4,endByte:4+n.length/2-1,decoded:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:n.toUpperCase()}),s.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[n.length/2," bytes"]})]})}),a}(e,t);default:return[{id:"payload:ciphertext",title:"Raw Data",color:"zinc",hex:t,startByte:0,endByte:t.length/2-1,decoded:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:t.toUpperCase()}),s.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[t.length/2," bytes"]})]})}]}}(L,N.payloadHex),[L,N.payloadHex]),z="payload"===y||vs(y),R=a.useMemo(()=>{const e=[{id:"header",hex:N.headerHex,color:"red"},...N.transportCodesHex?[{id:"transportCodes",hex:N.transportCodesHex,color:"indigo"}]:[],{id:"pathLength",hex:N.pathLengthHex,color:"green"},...N.pathDataHex?[{id:"pathData",hex:N.pathDataHex,color:"amber"}]:[]];return z?[...e,...(s=D,s.map(e=>({id:e.id,hex:e.hex,color:e.color})))]:[...e,{id:"payload",hex:N.payloadHex,color:"cyan"}];var s},[N,z,D]);return s.jsxs("div",{className:"font-mono space-y-2 min-w-0 overflow-hidden",children:[(()=>{switch(L.type){case"advert":return s.jsx(Ls,{advert:L,timestamp:e.timestamp});case"grp_data":return s.jsx(Ds,{decoded:L,timestamp:e.timestamp});case"grp_txt":return s.jsx(zs,{decoded:L,timestamp:e.timestamp,isLoading:B,onDecrypted:o});case"ack":return s.jsx(Rs,{decoded:L,timestamp:e.timestamp});case"path":return s.jsx(As,{decoded:L,timestamp:e.timestamp});case"trace":return s.jsx(Es,{decoded:L,timestamp:e.timestamp});case"txt_msg":return s.jsx($s,{decoded:L,timestamp:e.timestamp});case"multipart":return s.jsx(Is,{decoded:L,timestamp:e.timestamp});case"generic":return F.payloadType===_.REQ||F.payloadType===_.RESPONSE||F.payloadType===_.ANON_REQ?s.jsx(Us,{decoded:L,timestamp:e.timestamp,payloadType:F.payloadType}):null;default:return null}})(),s.jsx(Ps,{rawHex:r,hexSegments:R,selectedSegment:y,onSegmentClick:b}),s.jsx(S,{children:s.jsx(H.div,{layout:!0,transition:Hs,className:"space-y-2 min-w-0",children:(()=>{var e,t,a,n;const l=[{id:"header",title:"Header",color:"red",startByte:0,endByte:0,hexBytes:`0x${N.headerHex.toUpperCase()}`,condition:!0,content:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"type-micro text-fg-muted border-b border-edge-subtle font-sans",children:[s.jsx("th",{className:"py-1 font-medium",children:"Bits"}),s.jsx("th",{className:"py-1 font-medium",children:"Field"}),s.jsx("th",{className:"py-1 font-medium",children:"Value"}),s.jsx("th",{className:"py-1 font-medium",children:"Binary"})]})}),s.jsx("tbody",{children:N.headerFields.map(e=>s.jsx(Bs,{...e},e.bits))})]})},{id:"transportCodes",title:"Transport Codes",color:"indigo",startByte:1,endByte:4,hexBytes:(null==(e=N.transportCodesHex)?void 0:e.toUpperCase())||"",condition:!!N.transportCodesHex,content:s.jsxs(s.Fragment,{children:[s.jsx("p",{className:"text-xs text-fg-muted",children:"Two 16-bit transport codes for encrypted routing"}),s.jsxs("div",{className:"mt-1 text-xs text-fg-secondary",children:["Code 1: 0x",null==(t=N.transportCodesHex)?void 0:t.slice(0,4).toUpperCase()," | Code 2: 0x",null==(a=N.transportCodesHex)?void 0:a.slice(4,8).toUpperCase()]})]})},{id:"pathLength",title:"Path Length",color:"green",startByte:N.transportCodesHex?5:1,endByte:N.transportCodesHex?5:1,hexBytes:`0x${N.pathLengthHex.toUpperCase()}`,condition:!0,content:s.jsxs("p",{className:"text-xs text-fg-muted pt-1",children:[F.pathLen," bytes showing route taken (increases as packet floods)"]})},{id:"pathData",title:"Path Data",color:"amber",startByte:N.transportCodesHex?6:2,endByte:(N.transportCodesHex?5:1)+F.pathLen,hexBytes:(null==(n=N.pathDataHex)?void 0:n.toUpperCase())||"",condition:F.pathLen>0,content:s.jsxs("div",{className:"space-y-3",children:[s.jsx(Vs,{pathHex:N.pathDataHex}),s.jsx("p",{className:"text-xs text-fg-muted",children:"Historical route taken (bytes are added as packet floods through network)"})]})},{id:"payload",title:"Payload",color:"cyan",startByte:N.payloadStartByte,endByte:i-1,hexBytes:N.payloadHex.toUpperCase(),condition:!0,content:s.jsxs(s.Fragment,{children:[!vs(y)&&s.jsxs("div",{className:"p-3 rounded-lg bg-black",children:[s.jsx("p",{className:"type-micro text-fg-muted mb-1.5 font-sans",children:"Decoded"}),s.jsx(Qs,{decoded:L,payloadType:F.payloadType})]}),!vs(y)&&D.length>0&&s.jsx("p",{className:"type-micro text-fg-muted mt-3 font-sans",children:"Click a field below to highlight its bytes"}),vs(y)&&s.jsx("p",{className:"type-micro text-fg-muted font-sans",children:"↑ Selected field above • Other fields below ↓"})]})}].filter(e=>e.condition),r=vs(y)?D.find(e=>e.id===y):null,c=vs(y)?[...l].sort((e,s)=>"payload"===e.id?-1:"payload"===s.id?1:0):[...l].sort((e,s)=>e.id===y?-1:s.id===y?1:0),d=vs(y)?D.filter(e=>e.id!==y):[];return s.jsxs(s.Fragment,{children:[r&&s.jsx(Fs,{id:`subfield-${r.id}`,title:r.title,color:r.color,startByte:N.payloadStartByte+r.startByte,endByte:N.payloadStartByte+r.endByte,hexBytes:r.hex.toUpperCase(),isSelected:!0,children:r.decoded},r.id),c.map(e=>s.jsx(Fs,{id:`section-${e.id}`,title:e.title,color:e.color,startByte:e.startByte,endByte:e.endByte,hexBytes:e.hexBytes,isSelected:e.id===y,children:e.content},e.id)),d.map(e=>s.jsxs(H.div,{layout:"position",layoutId:`subfield-${e.id}`,transition:Hs,className:"w-full min-w-0 overflow-hidden rounded-xl p-4 sm:p-5 space-y-4",style:{backgroundColor:ws,boxShadow:Cs},children:[s.jsxs("div",{className:"flex items-start justify-between gap-4",children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-0.5 min-w-0",children:[s.jsx(g,{color:e.color,children:e.title}),e.hex.length<=32&&Ns(e.hex).map((t,a)=>s.jsx(g,{color:e.color,className:"font-mono",children:t.toUpperCase()},a))]}),s.jsxs("span",{className:"type-data-xs text-fg-muted flex-shrink-0",children:["Bytes ",N.payloadStartByte+e.startByte,"-",N.payloadStartByte+e.endByte]})]}),s.jsx("div",{className:"min-w-0 overflow-hidden p-3 rounded-lg bg-black",children:e.decoded})]},e.id))]})})()})})]})});function Gs(e){if(!e)return[];if(Array.isArray(e))return e;try{const s=JSON.parse(e);return Array.isArray(s)?s:[]}catch{return[]}}function Ws(e){return e?(e.startsWith("0x")?e.slice(2):e).slice(0,2).toUpperCase():""}function qs({hop:e,compact:n=!1,index:l=0,highlightIndex:r=-1,isTrace:i=!1}){var c;const d=l===r,o=Ge();return a.useEffect(()=>{d&&i&&o.start({boxShadow:["0 0 0 0px rgba(113, 156, 223, 0)","0 0 0 2px rgba(113, 156, 223, 0.5)","0 0 0 2px rgba(113, 156, 223, 0.5)","0 0 0 0px rgba(113, 156, 223, 0)"],transition:{duration:.5,times:[0,.2,.7,1],ease:"easeInOut"}})},[d,i,o]),s.jsxs(H.div,{className:t("flex items-center gap-1.5",n?"flex-row":"flex-col"),animate:{scale:d?1.05:1,opacity:d?1:.85},transition:{duration:.3,ease:"easeInOut"},children:[s.jsxs(H.div,{className:t("flex items-center gap-1.5 px-2.5 py-1 rounded-md","font-mono text-xs font-semibold",e.isLocal?"bg-sys-amber/20 text-sys-amber ring-1 ring-sys-amber/30":"bg-elevated/50 text-fg-primary ring-1 ring-edge-strong/50"),animate:o,initial:{boxShadow:"0 0 0 0px rgba(113, 156, 223, 0)"},children:[e.isLocal&&s.jsx(Le,{className:"w-3 h-3"}),s.jsx("span",{children:e.prefix}),void 0!==e.confidence&&e.confidence<.9&&s.jsxs("span",{className:"text-[9px] opacity-70",children:[(100*e.confidence).toFixed(0),"%"]})]}),!n&&(null==(c=e.neighborInfo)?void 0:c.name)&&s.jsx("span",{className:"text-xs text-fg-muted truncate max-w-[80px]",children:e.neighborInfo.name})]})}function Ks({snr:e}){const t=D(e),a=L()[t]||"#6b7280",n=Number.isInteger(e)?e.toString():e.toFixed(1);return s.jsxs(g,{customColor:a,compact:!0,className:"font-mono",children:[e>=0?"+":"",n,"dB"]})}function Xs({hops:e,compact:n,isTrace:l=!1}){const[r,i]=a.useState(-1);return a.useEffect(()=>{if(0===e.length)return;const s=setTimeout(()=>{i(0)},400),t=setInterval(()=>{i(s=>{const a=s+1;return a>=e.length?(clearInterval(t),-1):a})},l?500:600);return()=>{clearTimeout(s),clearInterval(t)}},[e.length,l]),s.jsx("div",{className:"p-6",style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"4px 8px"},children:e.map((a,i)=>{const c=i%2==0,d=i===e.length-1;return s.jsxs("div",{className:"contents",children:[s.jsx("div",{className:t("flex items-center","justify-end"),children:c&&s.jsx(qs,{hop:a,compact:n,index:i,highlightIndex:r,isTrace:l})}),s.jsx("div",{className:"flex flex-col items-center justify-center min-h-[28px]",children:!d&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-px flex-1 bg-border-strong/40 min-h-[8px]"}),void 0!==a.snr&&s.jsx(Ks,{snr:a.snr}),s.jsx("svg",{className:"w-3 h-3 text-fg-muted flex-shrink-0",viewBox:"0 0 12 12",fill:"none",children:s.jsx("path",{d:"M6 2v8M3 7l3 3 3-3",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]})}),s.jsx("div",{className:t("flex items-center","justify-start"),children:!c&&s.jsx(qs,{hop:a,compact:n,index:i,highlightIndex:r,isTrace:l})})]},`${a.prefix}-${i}`)})})}const Ys=a.memo(function({packet:e,neighbors:n,localHash:l,neighborAffinity:r,ghostPrefixes:i,direction:c="horizontal",compact:d=!1,traceSnr:o,overridePath:x}){const m=void 0!==o&&o.length>0,p=Gs(e.original_path),h=Gs(e.forwarded_path),u=x??(h.length>0?h:p),g=Ws(l),f=a.useMemo(()=>u.map((e,s)=>{const t=e.toUpperCase(),a=t===g,l=(null==i?void 0:i.has(t))??!1,c=function(e,s,t){const a=e.toUpperCase();if(t){let e=null,n=0;if(t.forEach((s,t)=>{if(Ws(t)===a){const a=s.combinedScore??0;a>n&&(n=a,e=t)}}),e&&s[e])return{hash:e,info:s[e],confidence:n}}for(const[n,l]of Object.entries(s))if(Ws(n)===a)return{hash:n,info:l,confidence:void 0};return null}(t,n,r);return{prefix:t,fullHash:null==c?void 0:c.hash,neighborInfo:null==c?void 0:c.info,isLocal:a,isGhost:l,confidence:null==c?void 0:c.confidence,snr:null==o?void 0:o[s]}}),[u,n,r,g,i,o]);if(0===f.length)return s.jsxs("div",{className:"flex items-center gap-2 text-fg-muted text-xs",children:[s.jsx(y,{className:"w-4 h-4 opacity-50"}),s.jsx("span",{children:"Direct / No path data"})]});if("flowchart"===c)return s.jsx(Xs,{hops:f,compact:d,isTrace:m});const j="horizontal"===c?pe:Ne;return s.jsx("div",{className:t("flex gap-1.5","horizontal"===c?"flex-row flex-wrap items-center":"flex-col items-start"),children:f.map((e,a)=>s.jsxs("div",{className:t("flex items-center gap-1.5","vertical"===c&&"flex-col"),children:[s.jsx(qs,{hop:e,compact:d}),a<f.length-1&&s.jsx(j,{className:"w-3 h-3 text-fg-muted flex-shrink-0"})]},`${e.prefix}-${a}`))})});function Js(e){if(!e)return[];if(Array.isArray(e))return e;try{const s=JSON.parse(e);return Array.isArray(s)?s:[]}catch{return[]}}function Zs({packets:e,selectedIndex:a,onSelect:n,compact:l=!1}){if(e.length<=1)return null;const r=a>0,i=a<e.length-1;return s.jsxs("div",{className:t("flex items-center gap-1",l?"gap-0.5":"gap-1"),children:[s.jsx("button",{onClick:()=>r&&n(a-1),disabled:!r,className:t("p-0.5 radius-badge transition-base",r?"text-fg-muted hover:text-fg-primary hover-bg":"text-fg-muted cursor-not-allowed"),"aria-label":"Previous observation",children:s.jsx(re,{className:l?"size-3":"size-4"})}),s.jsx("div",{className:"flex items-center gap-0.5",children:e.map((e,r)=>{const i=r===a,c=new Date(1e3*e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});return s.jsx(O,{color:i?"cyan":"zinc",filled:i,compact:l,onClick:()=>n(r),title:`Observation ${r+1} at ${c}`,className:t("transition-all duration-150",!i&&"opacity-60 hover:opacity-100"),children:l?s.jsx("span",{className:"tabular-nums",children:r+1}):s.jsxs("span",{className:"tabular-nums text-xs",children:["#",r+1,null!=e.rssi&&s.jsx("span",{className:"ml-1 opacity-70",children:e.rssi})]})},`${e.timestamp}_${r}`)})}),s.jsx("button",{onClick:()=>i&&n(a+1),disabled:!i,className:t("p-0.5 radius-badge transition-base",i?"text-fg-muted hover:text-fg-primary hover-bg":"text-fg-muted cursor-not-allowed"),"aria-label":"Next observation",children:s.jsx(ve,{className:l?"size-3":"size-4"})}),s.jsxs("span",{className:t("text-fg-muted ml-1",l?"text-[9px]":"text-xs"),children:[s.jsx(u,{className:"inline size-3 mr-0.5 opacity-50"}),e.length]})]})}function et({icon:e,label:a,disabled:n=!1}){return s.jsx(H.div,{className:"flex items-center gap-1 text-xs",title:a,animate:{opacity:n?.25:.6},transition:{duration:.15,ease:[.4,0,.2,1]},children:s.jsx("span",{className:t("flex items-center justify-center size-5 radius-badge border-control transition-base",n?"bg-subtle-fill border-edge-subtle":"bg-subtle-fill"),children:e})})}function st({hasDuplicates:e,hasPrev:t,hasNext:a,canPrevDupe:n,canNextDupe:l}){return s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsxs("div",{className:"flex items-center gap-0.5",children:[s.jsx(et,{icon:s.jsx(ye,{className:"size-3"}),label:"Previous packet (↑)",disabled:!t}),s.jsx(et,{icon:s.jsx(G,{className:"size-3"}),label:"Next packet (↓)",disabled:!a})]}),e&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-px h-3 bg-subtle-fill-strong"}),s.jsxs("div",{className:"flex items-center gap-0.5",children:[s.jsx(et,{icon:s.jsx(re,{className:"size-3"}),label:"Previous observation (←)",disabled:!n}),s.jsx(et,{icon:s.jsx(ve,{className:"size-3"}),label:"Next observation (→)",disabled:!l})]})]})]})}const tt=a.memo(function({packets:e,initialIndex:t=0,onClose:n,onNavigatePrev:l,onNavigateNext:r,hasPrev:i=!1,hasNext:c=!1}){const[d,o]=a.useState(t),x=e[d]??e[0],m=e.length>1,[p,u]=a.useState(null),[f,j]=a.useState(!1);a.useEffect(()=>{if(!x._stripped)return void u(null);let e=!1;j(!0);const s=x.packet_hash;if(s)return z(s).then(s=>{e||(s.success&&s.data&&u(s.data),j(!1))}).catch(()=>{e||j(!1)}),()=>{e=!0};j(!1)},[x]);const k=p??x,w=d>0,C=d<e.length-1,S=a.useCallback(s=>{o(Math.max(0,Math.min(s,e.length-1)))},[e.length]);a.useEffect(()=>{const e=e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement))switch(e.key){case"ArrowUp":e.preventDefault(),null==l||l();break;case"ArrowDown":e.preventDefault(),null==r||r();break;case"ArrowLeft":e.preventDefault(),w&&o(e=>e-1);break;case"ArrowRight":e.preventDefault(),C&&o(e=>e+1)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[l,r,w,C]);const T=R(),M=A(),P=E(),B=$(),F=a.useMemo(()=>new Set(B.map(e=>e.prefix.toUpperCase())),[B]),L=k.payload_type_name||b(k.payload_type??k.type),D=k.route_type_name||N(k.route_type??k.route),O=k.payload_length??k.length??0,G=Js(k.original_path),W=Js(k.forwarded_path),q=G.length>0||W.length>0,K=W.length>0?W:G,X=a.useMemo(()=>{var e;if(null==(e=null==T?void 0:T.config)?void 0:e.repeater)return{latitude:T.config.repeater.latitude,longitude:T.config.repeater.longitude,name:T.config.node_name||"Local Node"}},[T]),Y=(null==T?void 0:T.neighbors)??{},Z=P.size>0?P:void 0,ee=k.raw_packet&&k.raw_packet.length>0,se=x._stripped&&f,ae=a.useMemo(()=>{if((k.payload_type??k.type)!==_.TRACE||!k.payload)return null;try{const e=h(k.payload),s=k.original_path||k.forwarded_path||[];let t=[];if("string"==typeof s)try{const e=JSON.parse(s);Array.isArray(e)&&(t=e.map(e=>parseInt(e,16)))}catch{t=[]}else Array.isArray(s)&&(t=s.map(e=>parseInt(e,16)));return J(e,t)}catch{return null}},[k]),ne=null==ae?void 0:ae.snrValues,re=a.useMemo(()=>{if((k.payload_type??k.type)!==_.ADVERT||!k.payload)return null;try{const e=h(k.payload),s=te(e);if(!s)return null;const t=s.publicKey.slice(0,2).toUpperCase();return{...s,prefix:t}}catch{return null}},[k]),ie=a.useMemo(()=>{if((null==re?void 0:re.latitude)&&(null==re?void 0:re.longitude))return{latitude:re.latitude,longitude:re.longitude,name:re.name||`Node ${re.prefix||"??"}`,prefix:re.prefix,publicKey:re.publicKey}},[re]),ce=e=>e&&0!==e?new Date(1e3*e).toLocaleString():"Unknown",oe=I(k.packet_hash),xe=a.useMemo(()=>{if((k.payload_type??k.type)!==_.GRP_TXT)return null;if(!(null==oe?void 0:oe.decoded))return null;const e=oe.decoded;return{type:"grp_txt",channelHash:e.channelHash,channelName:e.channelName,text:e.text??"",decrypted:e.decrypted,senderName:e.senderName,timestamp:e.timestamp,flags:e.flags,macCorrupted:e.macCorrupted}},[k,oe]),me=a.useCallback(e=>{if(!e)return null;const s=e.trim().match(/(-?\d+\.?\d*)\s*[,\s]\s*(-?\d+\.?\d*)/);if(!s)return null;const t=parseFloat(s[1]),a=parseFloat(s[2]);return isNaN(t)||isNaN(a)||t<-90||t>90||a<-180||a>180||0===t&&0===a?null:{lat:t,lon:a}},[]),pe=a.useMemo(()=>{var e,s;if(!(null==xe?void 0:xe.decrypted))return;if(!(null==(e=xe.channelName)?void 0:e.toLowerCase().includes("wardrive")))return;const t=me(xe.text);return t?{latitude:t.lat,longitude:t.lon,name:xe.senderName||"Wardrive Ping",prefix:(null==(s=xe.senderName)?void 0:s.slice(0,2).toUpperCase())||"WD",nodeType:"wardrive"}:void 0},[xe,me]),ge=(k.payload_type??k.type)===_.ADVERT&&(void 0!==ie||q),ye=void 0!==pe,je=ie??pe;if(0===K.length)return null;const be=(null==T?void 0:T.local_hash)?(T.local_hash.startsWith("0x")?T.local_hash.slice(2,4):T.local_hash.slice(0,2)).toUpperCase():"";for(const s of K){const e=s.toUpperCase();if(e!==be)if(Z){let s=0,t=0;if(Z.forEach((a,n)=>{(n.startsWith("0x")?n.slice(2,4):n.slice(0,2)).toUpperCase()===e&&(s++,t=Math.max(t,a.combinedScore??0))}),0===s)for(const a of Object.keys(Y))if((a.startsWith("0x")?a.slice(2,4):a.slice(0,2)).toUpperCase()===e)break}else for(const s of Object.keys(Y))if((s.startsWith("0x")?s.slice(2,4):s.slice(0,2)).toUpperCase()===e)break}const Ne=de[L]??"zinc",ve=v[Ne]||v.zinc;return s.jsxs(U,{open:!0,onClose:n,size:"5xl",motionPlus:!0,className:"sm:h-[85vh] sm:max-h-[800px] md:h-[80vh] md:max-h-[900px]",children:[s.jsxs("div",{className:"sm:hidden",children:[s.jsx("div",{className:"flex justify-center pt-2 pb-1",children:s.jsx("div",{className:"w-9 h-1 rounded-full bg-fg-muted","aria-hidden":"true"})}),s.jsxs("div",{className:"flex items-center justify-between px-3 pb-2",children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(g,{color:de[L]??"zinc",className:"!text-[9px] !px-1.5 !py-0",children:L}),s.jsx(g,{color:"DIRECT"===D||"T_DIRECT"===D?"cyan":"amber",className:"!text-[9px] !px-1.5 !py-0",children:D}),s.jsxs(g,{color:"zinc",className:"!text-[9px] !px-1.5 !py-0",children:[O,"B"]})]}),s.jsx("button",{onClick:n,className:"px-3 py-1.5 text-[15px] font-medium text-sys-blue active:text-sys-blue/80 transition-base flex-shrink-0 radius-inner active:bg-subtle-fill",children:"Done"})]}),m&&s.jsx("div",{className:"px-3 pb-2",children:s.jsx(Zs,{packets:e,selectedIndex:d,onSelect:S,compact:!0})})]}),s.jsx("div",{className:"hidden sm:block px-6 pt-5 pb-4",children:s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(g,{color:de[L]??"zinc",children:L}),s.jsx(g,{color:"DIRECT"===D||"T_DIRECT"===D?"cyan":"amber",children:D}),s.jsxs(g,{color:"zinc",children:[O,"B"]}),m&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-px h-4 bg-subtle-fill-strong"}),s.jsx(Zs,{packets:e,selectedIndex:d,onSelect:S})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(st,{hasDuplicates:m,hasPrev:i,hasNext:c,canPrevDupe:w,canNextDupe:C}),s.jsx("button",{onClick:n,className:"p-1.5 -m-1.5 text-fg-muted hover:text-fg-primary transition-base radius-inner hover:bg-elevated flex-shrink-0",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})}),s.jsx("div",{className:"sm:hidden h-[2px]",style:{backgroundColor:ve,opacity:.6}}),s.jsxs(V,{className:"p-0 overflow-hidden flex-1 flex flex-col min-h-0",children:[s.jsx("div",{className:"md:hidden flex-1 overflow-y-auto overflow-x-hidden",children:s.jsxs("div",{className:"p-2 space-y-2",children:[(null!=k.rssi||null!=k.snr)&&s.jsxs("div",{className:"relative flex items-center justify-between px-2 py-1.5 radius-inner bg-subtle-fill",children:[s.jsx(Q,{mode:"popLayout",initial:!1,children:s.jsxs(H.div,{className:"flex items-center gap-3",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[s.jsx(he,{rssi:k.rssi,snr:k.snr,compact:!0,showValues:!0,validated:ue(k)}),s.jsx("span",{className:"text-[11px] text-fg-muted",children:fe(k.rssi)})]},d)}),K.length>0&&s.jsxs("span",{className:"type-data-xs text-fg-muted",children:[K.length," hop",1!==K.length?"s":""]})]}),(q&&K.length>0||ge||ye)&&s.jsx("div",{className:"overflow-hidden radius-inset",children:s.jsx("div",{className:"aspect-[4/3] w-full",children:s.jsx(bs,{path:K,neighbors:Y,localNode:X,localHash:null==T?void 0:T.local_hash,srcHash:k.src_hash,dstHash:k.dst_hash,neighborAffinity:Z,hubNodes:[...M],traceSnr:ne,advertiserSource:je})})}),ae&&ae.pathHashes.length>0&&s.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[s.jsx("div",{className:"px-3 py-2 space-y-1.5",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"type-micro text-fg-muted",children:"Trace Route"}),s.jsx("div",{className:"flex items-center gap-1.5",children:s.jsx(g,{color:ae.isComplete?"green":"amber",compact:!0,children:ae.isComplete?"Complete":"In Progress"})})]})}),s.jsx(Ys,{packet:k,neighbors:Y,localHash:null==T?void 0:T.local_hash,neighborAffinity:Z,ghostPrefixes:F,direction:"flowchart",compact:!0,overridePath:ae.pathHashes,traceSnr:ae.snrValues})]}),q&&!ae&&s.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[s.jsx("span",{className:"type-micro text-fg-muted",children:"Path"}),s.jsxs(g,{color:"zinc",compact:!0,children:[K.length," hop",1!==K.length?"s":""]})]}),s.jsx(Ys,{packet:k,neighbors:Y,localHash:null==T?void 0:T.local_hash,neighborAffinity:Z,ghostPrefixes:F,direction:"flowchart",compact:!0,traceSnr:ne})]}),re&&s.jsxs("div",{className:"radius-inset bg-subtle-fill overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-edge-subtle",children:[s.jsx("span",{className:"type-micro text-fg-muted",children:"Advertiser Info"}),s.jsx(g,{color:"lime",compact:!0,children:re.nodeType})]}),s.jsxs("div",{className:"p-3 space-y-2",children:[re.name&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ve,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),s.jsx("span",{className:"type-label text-fg-primary truncate",children:re.name})]}),re.latitude&&re.longitude&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(He,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),s.jsxs("span",{className:"type-data-xs text-fg-secondary",children:[re.latitude.toFixed(5),", ",re.longitude.toFixed(5)]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx($e,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),s.jsxs("span",{className:"type-data-xs text-fg-muted truncate",children:[re.publicKey.slice(0,16),"...",re.publicKey.slice(-8)]})]}),re.timestamp>0&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(le,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),s.jsx("span",{className:"text-xs text-fg-muted",children:ce(re.timestamp)})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(y,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),s.jsx("span",{className:"text-xs text-fg-muted",children:re.flagsDescription||`Flags: 0x${re.flags.toString(16).padStart(2,"0")}`})]})]})]}),se?s.jsx("div",{className:"pt-1 px-3 py-6 text-center",children:s.jsx("span",{className:"text-xs text-fg-muted animate-pulse",children:"Loading packet details…"})}):ee?s.jsx("div",{className:"pt-1",children:s.jsx(Os,{packet:k,decodedGrpTxt:xe})}):null]})}),s.jsxs("div",{className:"hidden md:grid md:grid-cols-2 flex-1 overflow-hidden",children:[s.jsx("div",{className:"overflow-y-auto overflow-x-hidden scrollbar-none p-4 border-r border-edge-subtle",children:se?s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsx("span",{className:"text-sm text-fg-muted animate-pulse",children:"Loading packet details…"})}):ee?s.jsx(Os,{packet:k,decodedGrpTxt:xe}):null}),s.jsxs("div",{className:"grid overflow-hidden",style:{gridTemplateRows:"minmax(280px, 1fr) auto"},children:[s.jsx("div",{className:"overflow-hidden p-2",children:q&&K.length>0||ge||ye?s.jsx("div",{className:"h-full w-full",children:s.jsx(bs,{path:K,neighbors:Y,localNode:X,localHash:null==T?void 0:T.local_hash,srcHash:k.src_hash,dstHash:k.dst_hash,neighborAffinity:Z,hubNodes:[...M],traceSnr:ne,advertiserSource:je})}):s.jsxs("div",{className:"h-full w-full flex flex-col items-center justify-center text-center px-4",children:[s.jsx(y,{className:"w-8 h-8 text-fg-muted/50 mb-2"}),s.jsx("span",{className:"text-sm text-fg-muted",children:"Direct Reception"}),s.jsx("span",{className:"text-xs text-fg-muted/70 mt-1",children:"Zero-hop packet — received directly from sender"})]})}),s.jsxs("div",{className:"overflow-y-auto max-h-[200px] p-2 space-y-2",children:[!ae&&K.length<=1&&(null!=k.rssi||null!=k.snr)&&s.jsx("div",{className:"surface-base radius-inset p-4",children:s.jsxs("dl",{className:"text-xs grid grid-cols-2 gap-2",children:[s.jsxs("div",{children:[s.jsx("dt",{className:"text-fg-muted mb-1",children:"Signal"}),s.jsx(Q,{mode:"popLayout",initial:!1,children:s.jsxs(H.dd,{className:"flex items-center gap-2",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[s.jsx(he,{rssi:k.rssi,snr:k.snr,validated:ue(k)}),s.jsx("span",{className:"font-medium text-fg-primary",children:fe(k.rssi)})]},d)})]}),s.jsxs("div",{children:[s.jsx("dt",{className:"text-fg-muted mb-1",children:"RF"}),s.jsx(Q,{mode:"popLayout",initial:!1,children:s.jsxs(H.dd,{className:"type-data text-fg-secondary",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[null!=k.rssi&&`${k.rssi} dBm`,null!=k.snr&&` · ${k.snr.toFixed(1)} dB`]},d)})]})]})}),re&&s.jsxs("div",{className:"radius-inset bg-subtle-fill overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-edge-subtle",children:[s.jsx("span",{className:"type-micro text-fg-muted",children:"Advertiser"}),s.jsx(g,{color:"lime",compact:!0,children:re.nodeType})]}),s.jsxs("div",{className:"p-4 space-y-2.5",children:[re.name&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ve,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),s.jsx("span",{className:"type-label text-fg-primary truncate",children:re.name})]}),re.latitude&&re.longitude&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(He,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),s.jsxs("span",{className:"type-data-xs text-fg-secondary",children:[re.latitude.toFixed(5),", ",re.longitude.toFixed(5)]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx($e,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),s.jsxs("span",{className:"text-[11px] font-mono text-fg-muted truncate",children:[re.publicKey.slice(0,16),"...",re.publicKey.slice(-8)]})]}),re.timestamp>0&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(le,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),s.jsx("span",{className:"text-xs text-fg-muted",children:ce(re.timestamp)})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(y,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),s.jsx("span",{className:"text-[11px] text-fg-muted",children:re.flagsDescription||`Flags: 0x${re.flags.toString(16).padStart(2,"0")}`})]})]})]}),ae&&ae.pathHashes.length>0&&s.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[s.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[s.jsx("span",{className:"type-micro text-fg-muted",children:"Trace Route"}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(g,{color:ae.isComplete?"green":"amber",compact:!0,children:ae.isComplete?"Complete":"In Progress"}),s.jsxs(g,{color:"teal",compact:!0,children:[ae.pathHashes.length,"h"]})]})]}),s.jsx(Ys,{packet:k,neighbors:Y,localHash:null==T?void 0:T.local_hash,neighborAffinity:Z,ghostPrefixes:F,direction:"flowchart",compact:!0,overridePath:ae.pathHashes,traceSnr:ae.snrValues})]}),q&&!ae&&s.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between px-4 py-2",children:[s.jsx("span",{className:"type-micro text-fg-muted",children:"Path"}),s.jsxs(g,{color:"zinc",compact:!0,children:[K.length,"h"]})]}),s.jsx(Ys,{packet:k,neighbors:Y,localHash:null==T?void 0:T.local_hash,neighborAffinity:Z,ghostPrefixes:F,direction:"flowchart",compact:!0,traceSnr:ne})]})]})]})]})]})]})});function at({label:e,numericValue:t,unit:a,icon:n,subtext:l,showSign:r=!1}){return s.jsxs("div",{className:"radius-inner p-3 sm:radius-inset sm:p-4 bg-subtle-fill ring-1 ring-inset ring-edge-subtle",children:[s.jsx("div",{className:"mb-1.5 sm:mb-2",children:s.jsx("span",{className:"text-xs sm:type-micro text-fg-muted",children:e})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(De,{value:t,format:{minimumFractionDigits:1,maximumFractionDigits:1,signDisplay:r?"always":"auto"},className:"type-data-hero tracking-tight text-fg-primary"}),s.jsxs("div",{className:"flex flex-col items-center justify-center",children:[s.jsx(n,{className:"w-[14px] h-[14px] text-fg-muted"}),a&&s.jsx("span",{className:"text-xs font-medium leading-tight text-fg-muted",children:a})]})]}),l&&s.jsx("p",{className:"mt-1.5 sm:mt-2 type-data-xs sm:text-[11px] text-fg-muted/80 truncate",children:l})]})}function nt({snr:e}){const a=e>=5?"bg-sys-teal":e>=0?"bg-sys-green":e>=-5?"bg-sys-amber":e>=-10?"bg-sys-orange":"bg-sys-red";return s.jsx("span",{className:t("w-1.5 h-1.5 rounded-full flex-shrink-0",a),title:`SNR: ${e.toFixed(1)} dB`})}function lt({fromPrefix:e,toPrefix:a,fromName:n,toName:l,snr:r,maxSnr:i,isWeakest:c,isStrongest:d,index:o=0}){const x=Math.max(i+5,15),m=Math.max(0,Math.min(100,(r- -20)/(x- -20)*100)),p="bg-[#0074BE]",h=r>=5?"bg-sys-teal":r>=0?"bg-sys-green":r>=-5?"bg-sys-amber":r>=-10?"bg-sys-orange":"bg-sys-red",u=.3+.15*o;return s.jsxs("div",{className:"relative p-3 pl-5 radius-inner bg-subtle-fill ring-1 ring-inset ring-edge-subtle",children:[s.jsx("span",{className:t("absolute left-0 top-1/2 -translate-y-1/2 h-4 w-0.5 rounded-full",h)}),s.jsx("span",{className:"absolute -top-0.5 -right-0.5",children:s.jsx(nt,{snr:r})}),s.jsxs("div",{className:"sm:hidden",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[s.jsx("span",{className:"text-[13px] font-medium text-fg-secondary truncate",children:n||e}),s.jsx(pe,{className:"w-3 h-3 text-fg-muted flex-shrink-0"}),s.jsx("span",{className:"text-[13px] font-semibold text-fg-primary truncate",children:l||a})]}),s.jsxs("div",{className:"flex items-center gap-1.5 ml-2 flex-shrink-0",children:[c&&s.jsx(g,{color:"red",compact:!0,children:"Low"}),d&&!c&&s.jsxs(g,{color:"amber",compact:!0,children:[s.jsx(Ue,{className:"w-2.5 h-2.5"}),"Best"]}),s.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[12px] font-mono font-bold tabular-nums bg-subtle-fill-hover text-fg-primary ring-1 ring-inset ring-edge-subtle",children:[r>=0?"+":"−",Math.abs(r).toFixed(1)]})]})]}),s.jsx("div",{className:"h-1.5 bg-subtle-fill-strong rounded-full overflow-hidden",children:s.jsx(H.div,{className:t("h-full rounded-full",p),initial:{width:0},animate:{width:`${m}%`},transition:{duration:1.5,delay:u,ease:[.25,.1,.25,1]}})})]}),s.jsxs("div",{className:"hidden sm:block",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[s.jsx("code",{className:"type-data-xs text-fg-muted",children:e}),n&&s.jsx("span",{className:"text-xs text-fg-secondary truncate max-w-[100px]",children:n})]}),s.jsx(pe,{className:"w-3 h-3 text-fg-muted/40 flex-shrink-0"}),s.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[s.jsx("code",{className:"font-mono text-xs font-semibold text-fg-primary",children:a}),l&&s.jsx("span",{className:"text-xs text-fg-secondary truncate max-w-[100px]",children:l})]})]}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[c&&s.jsx(g,{color:"red",compact:!0,children:"Bottleneck"}),d&&!c&&s.jsxs(g,{color:"amber",compact:!0,children:[s.jsx(Ue,{className:"w-3 h-3"}),"Strongest"]}),s.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-sm font-mono font-semibold tabular-nums bg-subtle-fill-hover text-fg-primary ring-1 ring-inset ring-edge-subtle",children:[r>=0?"+":"−",Math.abs(r).toFixed(1)]})]})]}),s.jsx("div",{className:"h-1.5 bg-elevated rounded-full overflow-hidden",children:s.jsx(H.div,{className:t("h-full rounded-full",p),initial:{width:0},animate:{width:`${m}%`},transition:{duration:1.5,delay:u,ease:[.25,.1,.25,1]}})})]})]})}function rt(e,s){if("You"===e)return"You";const t=e.toUpperCase();for(const[a,n]of Object.entries(s))if((a.startsWith("0x")?a.slice(2,4):a.slice(0,2)).toUpperCase()===t)return n.name||n.node_name||void 0}const it=a.memo(function({report:e,onClose:t}){var a,n;const l=R(),r=(null==l?void 0:l.neighbors)??{},i=(null==(a=null==l?void 0:l.config)?void 0:a.repeater)?{latitude:l.config.repeater.latitude,longitude:l.config.repeater.longitude,name:l.config.node_name||"Local Node"}:void 0,c=null==(n=e.bestObservation)?void 0:n.decoded.snrValues,d=e.linkQuality?e.linkQuality.avgSnr>=5?"excellent":e.linkQuality.avgSnr>=0?"good":e.linkQuality.avgSnr>=-5?"fair":"poor":"unknown",o={excellent:"var(--signal-excellent)",good:"var(--signal-good)",fair:"var(--signal-fair)",poor:"var(--signal-poor)",unknown:"var(--fg-muted)"}[d];return s.jsxs(U,{open:!0,onClose:t,size:"5xl",motionPlus:!0,children:[s.jsxs("div",{className:"sm:hidden",children:[s.jsx("div",{className:"flex justify-center pt-2 pb-1",children:s.jsx("div",{className:"w-9 h-1 rounded-full bg-fg-primary/30","aria-hidden":"true"})}),s.jsxs("div",{className:"flex items-center justify-between px-4 pb-2",children:[s.jsx("h2",{className:"font-semibold text-[17px] text-fg-primary",children:"Trace Report"}),s.jsx("button",{onClick:t,className:"text-[17px] font-medium text-sys-blue active:text-sys-blue/80",children:"Done"})]})]}),s.jsx("div",{className:"sm:hidden h-[2px]",style:{backgroundColor:o,opacity:.6}}),s.jsx("div",{className:"hidden sm:block px-6 pt-5 pb-4",children:s.jsxs("div",{className:"flex items-start justify-between gap-3",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[s.jsx("h2",{className:"type-micro",children:"Trace Report"}),s.jsxs(g,{color:"excellent"===d||"good"===d?"green":"fair"===d?"amber":"red",children:[s.jsx(Ie,{className:"w-3 h-3 mr-1"}),"excellent"===d?"Excellent":"good"===d?"Good":"fair"===d?"Fair":"Poor"]})]}),s.jsx("p",{className:"mt-1 text-xs sm:text-sm font-mono text-fg-muted tabular-nums",children:e.traceTag})]}),s.jsx("button",{onClick:t,className:"p-1.5 -m-1.5 text-fg-muted hover:text-fg-primary transition-base radius-inner hover:bg-elevated flex-shrink-0",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})}),s.jsxs("div",{className:"hidden sm:flex flex-wrap items-center gap-1.5 sm:gap-2 px-4 sm:px-6 pb-3 sm:pb-4 border-b border-edge-subtle",children:[s.jsxs(g,{color:"teal",children:[s.jsx("span",{className:"font-mono tabular-nums",children:e.targetHopCount}),s.jsxs("span",{className:"ml-1",children:["hop",1!==e.targetHopCount?"s":""]})]}),s.jsxs(g,{color:"zinc",children:[s.jsx("span",{className:"font-mono tabular-nums",children:e.observationCount}),s.jsx("span",{className:"ml-1",children:"obs"})]}),e.linkQuality&&s.jsxs(g,{color:"indigo",children:[s.jsx("span",{className:"font-mono tabular-nums",children:e.linkQuality.avgSnr.toFixed(1)}),s.jsx("span",{className:"ml-1",children:"dB avg"})]}),s.jsx("span",{className:"type-data-xs text-fg-muted",children:W(e.duration)}),e.linkQuality&&s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"text-fg-muted/40",children:"•"}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-xs font-medium bg-sys-red/15 text-sys-red ring-1 ring-inset ring-sys-red/25",children:[s.jsx("span",{className:"opacity-70",children:"Min"}),s.jsx("span",{className:"font-mono tabular-nums",children:e.linkQuality.minSnr.toFixed(1)})]}),s.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-xs font-medium bg-sys-teal/15 text-sys-teal ring-1 ring-inset ring-sys-teal/25",children:[s.jsx("span",{className:"opacity-70",children:"Max"}),s.jsx("span",{className:"font-mono tabular-nums",children:e.linkQuality.maxSnr.toFixed(1)})]})]})]})]}),s.jsxs(V,{className:"p-0 overflow-hidden",children:[s.jsx("div",{className:"md:hidden h-[75vh] max-h-[calc(100vh-80px)] overflow-y-auto overflow-x-hidden",children:s.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.linkQuality&&s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("div",{className:"radius-inner bg-subtle-fill ring-1 ring-inset ring-edge-subtle p-2.5 text-center",children:[s.jsx(De,{value:Math.abs(e.linkQuality.minSnr),format:{maximumFractionDigits:0,signDisplay:"never"},prefix:e.linkQuality.minSnr<0?"-":"",className:"text-[20px] font-bold font-mono tabular-nums flex items-center justify-center text-fg-primary"}),s.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[s.jsx(_e,{className:"w-2.5 h-2.5 text-fg-muted"}),s.jsx("span",{className:"text-xs text-fg-muted",children:"Min dB"})]})]}),s.jsxs("div",{className:"radius-inner bg-subtle-fill ring-1 ring-inset ring-edge-subtle p-2.5 text-center",children:[s.jsx(De,{value:e.linkQuality.maxSnr,format:{maximumFractionDigits:0,signDisplay:"always"},className:"text-[20px] font-bold font-mono text-fg-primary tabular-nums flex items-center justify-center"}),s.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[s.jsx(je,{className:"w-2.5 h-2.5 text-fg-muted"}),s.jsx("span",{className:"text-xs text-fg-muted",children:"Max dB"})]})]})]}),s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsxs(g,{color:"excellent"===d||"good"===d?"green":"fair"===d?"amber":"red",compact:!0,children:[s.jsx(Ie,{className:"w-2.5 h-2.5 mr-0.5"}),"excellent"===d?"Excellent":"good"===d?"Good":"fair"===d?"Fair":"Poor"]}),s.jsxs(g,{color:"teal",compact:!0,children:[e.targetHopCount," hops"]}),s.jsxs(g,{color:"zinc",compact:!0,children:[e.observationCount," obs"]}),s.jsx("span",{className:"type-data-xs text-fg-muted ml-auto",children:e.traceTag.slice(0,8)})]}),e.targetPath.length>0&&s.jsx("div",{className:"overflow-hidden radius-inset",children:s.jsx("div",{className:"aspect-[4/3] w-full",children:s.jsx(bs,{path:e.targetPath,neighbors:r,localNode:i,localHash:null==l?void 0:l.local_hash,srcHash:e.srcHash,dstHash:e.dstHash,traceSnr:c})})}),s.jsxs("div",{className:"radius-inset bg-body overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-edge-subtle",children:[s.jsx("span",{className:"text-[11px] font-medium text-fg-secondary",children:"Route Path"}),e.linkQuality&&s.jsxs("span",{className:"type-data-xs text-fg-muted",children:["SNR ",e.linkQuality.minSnr.toFixed(1)," → ",e.linkQuality.maxSnr.toFixed(1)," dB"]})]}),e.bestObservation?s.jsx(Ys,{packet:e.bestObservation.packet,neighbors:r,localHash:null==l?void 0:l.local_hash,direction:"flowchart",compact:!0,overridePath:e.targetPath,traceSnr:e.bestObservation.decoded.snrValues}):s.jsx("div",{className:"p-6 text-center text-fg-muted text-xs",children:"No path data available"})]}),s.jsxs("div",{children:[s.jsxs("h3",{className:"type-micro text-fg-muted mb-2",children:["Link Quality · ",e.hopStats.length," hops"]}),s.jsx("div",{className:"space-y-1.5",children:e.hopStats.length>0?e.hopStats.map((t,a)=>{var n,l,i;const c=a<e.targetPath.length-1?e.targetPath[a+1]:"You",d=rt(t.prefix,r),o=rt(c,r);return s.jsx(lt,{fromPrefix:t.prefix,toPrefix:c,fromName:d,toName:o,snr:t.snr,maxSnr:(null==(n=e.linkQuality)?void 0:n.maxSnr)??10,isWeakest:(null==(l=e.linkQuality)?void 0:l.weakestLinkPosition)===a,isStrongest:(null==(i=e.linkQuality)?void 0:i.strongestLinkPosition)===a,index:a},`${t.prefix}-${a}`)}):s.jsx("div",{className:"text-xs text-fg-muted py-6 text-center",children:"No link data collected"})})]}),s.jsx("div",{className:"pt-1 pb-2 text-center",children:s.jsxs("span",{className:"text-xs text-fg-muted",children:["Traced ",q(e.firstSeen)]})})]})}),s.jsxs("div",{className:"hidden md:flex md:flex-row h-[70vh] max-h-[calc(100vh-200px)] overflow-hidden",children:[s.jsx("div",{className:"w-1/2 flex flex-col min-w-0 min-h-0 overflow-hidden border-r border-edge-subtle",children:s.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.linkQuality&&(()=>{const t=e.targetPath[e.linkQuality.weakestLinkPosition],a=e.targetPath[e.linkQuality.weakestLinkPosition+1]||"You",n=rt(t,r),l=rt(a,r),i=e.targetPath[e.linkQuality.strongestLinkPosition],c=e.targetPath[e.linkQuality.strongestLinkPosition+1]||"You",d=rt(i,r),o=rt(c,r);return s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsx(at,{label:"Weakest Link",numericValue:e.linkQuality.minSnr,unit:"dB",icon:_e,subtext:`${n||t} → ${l||a}`}),s.jsx(at,{label:"Best Link",numericValue:e.linkQuality.maxSnr,showSign:!0,unit:"dB",icon:je,subtext:`${d||i} → ${o||c}`})]})})(),s.jsxs("div",{children:[s.jsx("h3",{className:"type-micro text-fg-muted mb-3",children:"Link Details"}),s.jsx("div",{className:"space-y-2",children:e.hopStats.length>0?e.hopStats.map((t,a)=>{var n,l,i;const c=a<e.targetPath.length-1?e.targetPath[a+1]:"You",d=rt(t.prefix,r),o=rt(c,r);return s.jsx(lt,{fromPrefix:t.prefix,toPrefix:c,fromName:d,toName:o,snr:t.snr,maxSnr:(null==(n=e.linkQuality)?void 0:n.maxSnr)??10,isWeakest:(null==(l=e.linkQuality)?void 0:l.weakestLinkPosition)===a,isStrongest:(null==(i=e.linkQuality)?void 0:i.strongestLinkPosition)===a,index:a},`${t.prefix}-${a}`)}):s.jsx("div",{className:"text-xs text-fg-muted py-8 text-center",children:"No link data collected"})})]}),s.jsxs("div",{className:"pt-2 text-center",children:[s.jsx("span",{className:"text-xs text-fg-muted",children:"Traced "}),s.jsx("span",{className:"type-data-xs text-fg-muted",children:q(e.firstSeen)})]})]})}),s.jsxs("div",{className:"w-1/2 min-w-0 overflow-y-auto p-3 space-y-2",children:[e.targetPath.length>0&&s.jsx("div",{className:"overflow-hidden",children:s.jsx("div",{className:"aspect-square w-full",children:s.jsx(bs,{path:e.targetPath,neighbors:r,localNode:i,localHash:null==l?void 0:l.local_hash,srcHash:e.srcHash,dstHash:e.dstHash,traceSnr:c})})}),s.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[s.jsx("span",{className:"type-micro text-fg-muted",children:"Trace Route"}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(g,{color:e.isComplete?"green":"amber",compact:!0,children:e.isComplete?"Complete":`${e.maxHopsObserved}/${e.targetHopCount}`}),s.jsxs(g,{color:"teal",compact:!0,children:[e.targetHopCount," hop",1!==e.targetHopCount?"s":""]})]})]}),e.linkQuality&&e.bestObservation&&s.jsxs("div",{className:"flex items-center gap-4 px-4 pb-2 type-data-xs text-fg-muted",children:[s.jsxs("span",{children:[s.jsx("span",{className:"opacity-60",children:"Tag"})," ",s.jsx("code",{className:"text-sys-teal tabular-nums",children:e.traceTag.slice(0,8)})]}),s.jsxs("span",{children:[s.jsx("span",{className:"opacity-60",children:"SNR"})," ",s.jsxs("code",{className:"text-sys-indigo tabular-nums",children:[e.linkQuality.minSnr.toFixed(1),"–",e.linkQuality.maxSnr.toFixed(1)]}),s.jsx("span",{className:"opacity-60",children:" dB"})]})]}),e.bestObservation?s.jsx(Ys,{packet:e.bestObservation.packet,neighbors:r,localHash:null==l?void 0:l.local_hash,direction:"flowchart",compact:!0,overridePath:e.targetPath,traceSnr:e.bestObservation.decoded.snrValues}):s.jsx("div",{className:"p-8 text-center text-fg-muted text-xs",children:"No path data available"})]})]})]})]})]})}),ct="(min-width: 640px)";let dt=null;function ot(e){return"undefined"==typeof window?()=>{}:(dt||(dt=window.matchMedia(ct)),dt.addEventListener("change",e),()=>null==dt?void 0:dt.removeEventListener("change",e))}function xt(){return"undefined"==typeof window||(dt||(dt=window.matchMedia(ct)),dt.matches)}function mt(e){if(!e||e.length<6)return null;const s=e,t=parseInt(s.slice(0,2),16);if(isNaN(t))return null;const a=3&t;let n=2;if(0!==a&&3!==a||(n=10),n+2>s.length)return null;const l=parseInt(s.slice(n,n+2),16);if(isNaN(l))return null;if(n+=2+2*l,n>=s.length)return null;const r=s.slice(n);return r.length>=38?r.slice(0,38):r}function pt({message:e}){return s.jsxs("div",{className:"flex flex-col items-center justify-center py-14 text-center",children:[s.jsx(y,{className:"size-6 text-fg-muted mb-2"}),s.jsx("p",{className:"text-sm text-fg-primary",children:e}),s.jsx("p",{className:"text-xs text-fg-muted",children:"Packets will appear here"})]})}function ht(){return s.jsx("div",{className:"py-14 text-center text-sm text-fg-muted",children:"Loading packets…"})}function ut({showPagination:e,currentPage:t,perPage:a,displayCount:n,totalCount:l,action:r}){const i=e?(t-1)*a+1:1,c=e?Math.min(t*a,l):n;return s.jsxs("div",{className:"flex items-center justify-between gap-4 border-t border-edge-subtle px-4 py-3 text-xs text-fg-muted sm:px-6",children:[s.jsxs("span",{children:["Showing"," ",s.jsx("span",{className:"font-medium text-fg-secondary",children:e?`${i}–${c}`:n})," ","of"," ",s.jsx("span",{className:"font-medium text-fg-secondary",children:l})," ","packets"]}),r]})}function gt({packets:e,allPackets:n,localHash:r,neighbors:i,loading:c=!1,maxPackets:d,perPage:o=50,showPagination:x=!1,onPacketSelect:m,flashNewest:p=!1,emptyMessage:h="No packets found",className:u,footerAction:g,hideDupes:f=!1,decodedMessages:y,onChannelClick:j,resolveSource:b,virtualized:N=!0}){const[v,k]=a.useState(null),[w,C]=a.useState(null),[S,H]=a.useState({traceTag:null,dupeGroup:null}),_=a.useRef(null);a.useLayoutEffect(()=>{H({traceTag:null,dupeGroup:null})},[e]);const T=n??e,M=a.useMemo(()=>d&&d>0&&!f?e.slice(0,d):e,[e,d,f]),P=a.useMemo(()=>{if(!f)return null;const e=function(e){if(0===e.length)return[];const s=[];let t=0;for(;t<e.length;){const a=e[t],n=a.packet_hash;let l=1;if(n)for(;t+l<e.length&&e[t+l].packet_hash===n;)l++;s.push({packet:a,dupeCount:l}),t+=l}return s}(M),s=function(e){if(e.length<=1)return e;const s=new Map,t=new Map,a=new Map;for(let r=0;r<e.length;r++){const{packet:n}=e[r],l=n.payload_type??n.type;if(l!==K.GRP_TXT)continue;const i=n._payloadHexPrefix??mt(n.raw_packet);if(i){const e=s.get(i);if(void 0!==e){a.set(r,e);continue}s.set(i,r)}const c=`${l}:${n.payload_length??n.length??0}:${Math.floor((n.timestamp??0)/60)}`;if(!i){const e=t.get(c);if(void 0!==e){a.set(r,e);continue}}t.has(c)||t.set(c,r)}if(0===a.size)return e;const n=new Map;for(const[r,i]of a)n.set(i,(n.get(i)??0)+e[r].dupeCount);const l=[];for(let r=0;r<e.length;r++){if(a.has(r))continue;const s=n.get(r)??0;l.push(s>0?{packet:e[r].packet,dupeCount:e[r].dupeCount+s}:e[r])}return l}(e);return d&&d>0?s.slice(0,d):s},[M,f,d]),B=P?P.length:M.length,{currentPage:F,totalPages:L,goToPage:D,pageRange:z}=function(e,s,t){const[n,l]=a.useState(1),r=t?Math.ceil(e/s):1;a.useEffect(()=>{n>r&&r>0&&queueMicrotask(()=>l(1))},[r,n]);const i=a.useCallback(e=>l(Math.max(1,Math.min(e,r))),[r]),c=a.useMemo(()=>function(e,s,t=1){if(s<=7)return Array.from({length:s},(e,s)=>s+1);const a=Math.max(e-t,1),n=Math.min(e+t,s),l=a>2,r=n<s-1;if(!l&&r){const e=3+2*t;return[...Array.from({length:e},(e,s)=>s+1),"gap",s]}if(l&&!r){const e=3+2*t;return[1,"gap",...Array.from({length:e},(t,a)=>s-e+a+1)]}return[1,"gap",...Array.from({length:n-a+1},(e,s)=>a+s),"gap",s]}(n,r),[n,r]);return{currentPage:n,totalPages:r,goToPage:i,pageRange:c}}(B,o,x),R=a.useMemo(()=>{if(f)return M;if(!x)return M;const e=(F-1)*o;return M.slice(e,e+o)},[M,x,F,o,f]),A=a.useMemo(()=>{if(!P)return null;if(!x)return P;const e=(F-1)*o;return P.slice(e,e+o)},[P,x,F,o]),E=a.useMemo(()=>{var e;if(!y)return y;const s=new Map,t=new Map,a=[];for(const r of M){const n=r.payload_type??r.type;if(n!==K.GRP_TXT)continue;const l=mt(r.raw_packet),i=`${n}:${r.payload_length??r.length??0}:${Math.floor((r.timestamp??0)/60)}`,c=y.get(r.packet_hash);(null==(e=null==c?void 0:c.decoded)?void 0:e.decrypted)&&!c.decoded.macCorrupted?(l&&!s.has(l)&&s.set(l,c),t.has(i)||t.set(i,c)):y.has(r.packet_hash)||a.push({hash:r.packet_hash,payloadHex:l,approxKey:i})}if(0===a.length||0===s.size&&0===t.size)return y;const n=new Map(y);let l=0;for(const{hash:r,payloadHex:i,approxKey:c}of a){if(n.has(r))continue;const e=(i?s.get(i):null)??t.get(c);e&&(n.set(r,e),l++)}return l>0?n:y},[y,M]),$=a.useMemo(()=>function(e){const s=new Map;for(const t of e)if((t.payload_type??t.type)===K.TRACE&&t.packet_hash){const e=t._traceTag??(t.payload?es(t.payload):null);e&&s.set(t.packet_hash,e)}return s}(R),[R]),I=a.useMemo(()=>function(e){const s=new Map;if(0===e.length)return s;for(let t=0;t<e.length;t++){const a=e[t].packet_hash;if(!a)continue;const n=e[t-1],l=e[t+1],r=(null==n?void 0:n.packet_hash)===a,i=(null==l?void 0:l.packet_hash)===a;(r||i)&&(r&&i?s.set(t,"middle"):r?s.set(t,"last"):i&&s.set(t,"first"))}return s}(R),[R]),U=function(e,s){const[t,n]=a.useState(null),l=a.useRef(0);return a.useEffect(()=>{var t,a;if(!s||!e.length)return;const r=(null==(t=e[0])?void 0:t.timestamp)??0,i=r>l.current&&l.current>0;if(l.current=r,!i)return;const c=null==(a=e[0])?void 0:a.packet_hash;if(!c)return;const d=requestAnimationFrame(()=>n(c)),o=setTimeout(()=>n(null),600);return()=>{cancelAnimationFrame(d),clearTimeout(o)}},[e,s]),t}(e,p),V=a.useSyncExternalStore(ot,xt,()=>!0),Q=a.useMemo(()=>f&&A?A:R,[f,A,R]),O=N&&Q.length>100,G=V?48:72,W=l({count:O?Q.length:0,getScrollElement:()=>_.current,estimateSize:()=>G,overscan:5}),q=a.useCallback((e,s)=>{var t,a;const n=e.packet_hash;if(!n)return[e];let l=s;for(;l>0&&(null==(t=R[l-1])?void 0:t.packet_hash)===n;)l--;let r=s;for(;r<R.length-1&&(null==(a=R[r+1])?void 0:a.packet_hash)===n;)r++;return l===r?[e]:R.slice(l,r+1)},[R]),X=a.useCallback(e=>{var s,t;const a=null==(s=R[e])?void 0:s.packet_hash;if(!a)return e;let n=e;for(;n>0&&(null==(t=R[n-1])?void 0:t.packet_hash)===a;)n--;return n},[R]),Y=a.useCallback(e=>{var s,t;const a=null==(s=R[e])?void 0:s.packet_hash;if(!a)return e;let n=e;for(;n<R.length-1&&(null==(t=R[n+1])?void 0:t.packet_hash)===a;)n++;return n},[R]),J=a.useCallback((e,s)=>{if(m)m(e);else if(void 0!==s){const t=q(e,s),a=t.indexOf(e);k({packets:t,initialIndex:a>=0?a:0,rowIndex:s})}else k({packets:[e],initialIndex:0,rowIndex:0})},[m,q]),Z=a.useCallback(()=>{if(!v)return;const e=X(v.rowIndex)-1;if(e<0)return;const s=R[e];if(!s)return;const t=q(s,e);k({packets:t,initialIndex:0,rowIndex:e})},[v,R,X,q]),ee=a.useCallback(()=>{if(!v)return;const e=Y(v.rowIndex)+1;if(e>=R.length)return;const s=R[e];if(!s)return;const t=q(s,e);k({packets:t,initialIndex:0,rowIndex:e})},[v,R,Y,q]),se=a.useMemo(()=>!!v&&X(v.rowIndex)>0,[v,X]),te=a.useMemo(()=>!!v&&Y(v.rowIndex)<R.length-1,[v,Y,R.length]),ae=a.useCallback(e=>H(s=>({...s,traceTag:e})),[]),ne=a.useCallback(e=>H(s=>({...s,dupeGroup:e})),[]),le=a.useCallback(()=>{H({traceTag:null,dupeGroup:null})},[]),re=a.useCallback(e=>{const s=T.filter(s=>(s.payload_type??s.type)===K.TRACE&&s.payload&&es(s.payload)===e);if(0===s.length)return;const t=function(e){const s=new Map;for(const t of e){const e=ts(t);if(!e)continue;const a=e.decoded.traceTag,n=s.get(a)||[];n.push(e),s.set(a,n)}for(const[t,a]of s)a.sort((e,s)=>e.timestamp-s.timestamp),s.set(t,a);return s}(s),a=t.get(e);(null==a?void 0:a.length)&&C(function(e,s){if(0===s.length)return{traceTag:e,traceTagValue:0,targetPath:[],targetHopCount:0,observations:[],observationCount:0,firstSeen:0,lastSeen:0,duration:0,isComplete:!1,maxHopsObserved:0,progressPercent:0,bestObservation:null,hopStats:[],linkQuality:null};const t=[...s].sort((e,s)=>e.timestamp-s.timestamp),a=t.reduce((e,s)=>s.hopCount>e.hopCount?s:e,t[0]),n=t[0].timestamp,l=t[t.length-1].timestamp,r=a.decoded.pathHashes,i=r.length,c=a.hopCount,d=a.decoded.isComplete,o=[],x=a.decoded.snrValues;for(let p=0;p<x.length&&p<r.length;p++)o.push({prefix:r[p],snr:x[p],position:p,quality:ss(x[p])});let m=null;if(x.length>0){const e=Math.min(...x),s=Math.max(...x);m={minSnr:e,maxSnr:s,avgSnr:x.reduce((e,s)=>e+s,0)/x.length,weakestLinkPosition:x.indexOf(e),strongestLinkPosition:x.indexOf(s)}}return{traceTag:e,traceTagValue:a.decoded.traceTagValue,targetPath:r,targetHopCount:i,observations:t,observationCount:t.length,firstSeen:n,lastSeen:l,duration:l-n,isComplete:d,maxHopsObserved:c,progressPercent:i>0?Math.round(c/i*100):0,bestObservation:a,hopStats:o,linkQuality:m,srcHash:a.packet.src_hash,dstHash:a.packet.dst_hash}}(e,a))},[T]),ie=a.useCallback(e=>{const s=T.find(s=>s.packet_hash===e);s&&(C(null),J(s))},[T,J]),ce=a.useCallback((e,t,a)=>{const n=V?hs:us;if(a){const{packet:a,dupeCount:l}=e,c=a.packet_hash?$.get(a.packet_hash):void 0,d=null!==S.traceTag&&c===S.traceTag;return s.jsx(n,{packet:a,onClick:e=>J(e,t),localHash:r,neighbors:i,resolveSource:b,isFlashing:p&&U===a.packet_hash,traceTag:c,isTraceHighlighted:d,onTraceHover:ae,onViewTraceReport:re,dupeCount:l,decodedMessages:E,onChannelClick:j},`${a.packet_hash}_${a.timestamp}_${t}`)}const l=e,c=l.packet_hash?$.get(l.packet_hash):void 0,d=null!==S.traceTag&&c===S.traceTag,o=I.get(t),x=void 0!==o&&null!==S.dupeGroup&&l.packet_hash===S.dupeGroup;return s.jsx(n,{packet:l,onClick:e=>J(e,t),localHash:r,neighbors:i,resolveSource:b,isFlashing:p&&U===l.packet_hash,traceTag:c,isTraceHighlighted:d,onTraceHover:ae,onViewTraceReport:re,dupeGroupPosition:o,isDupeGroupHovered:x,onDupeGroupHover:ne,decodedMessages:E,onChannelClick:j},`${l.packet_hash}_${l.timestamp}_${t}`)},[V,$,S.traceTag,S.dupeGroup,J,r,i,b,p,U,ae,re,I,ne,E,j]);return s.jsxs("div",{className:t("flex flex-col",u),onMouseLeave:le,children:[O?s.jsx("div",{ref:_,className:"divide-y divide-edge-subtle overflow-auto",style:{maxHeight:600},children:(()=>{if(c&&0===e.length)return s.jsx(ht,{});if(0===Q.length)return s.jsx(pt,{message:h});const t=f&&null!==A,a=W.getVirtualItems();return s.jsx("div",{style:{height:`${W.getTotalSize()}px`,width:"100%",position:"relative"},children:a.map(e=>{const a=Q[e.index];return s.jsx("div",{"data-index":e.index,ref:W.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${e.start}px)`},children:ce(a,e.index,t)},e.key)})})})()}):s.jsx("div",{className:"divide-y divide-edge-subtle py-1",children:(()=>{if(c&&0===e.length)return s.jsx(ht,{});if(0===R.length)return s.jsx(pt,{message:h});const t=f&&null!==A;return(t?A:R).map((e,s)=>ce(e,s,t))})()}),x&&L>1&&s.jsx("nav",{className:"border-t border-edge-subtle px-4 py-3",children:s.jsxs(We,{className:"justify-center",children:[s.jsx(qe,{onClick:()=>D(F-1),disabled:1===F}),s.jsx(Xe,{children:z.map((e,t)=>"gap"===e?s.jsx(Je,{},`gap-${t}`):s.jsx(Ye,{page:e,current:e===F,onClick:D},e))}),s.jsx(Ke,{onClick:()=>D(F+1),disabled:F===L})]})}),s.jsx(ut,{showPagination:x,currentPage:F,perPage:o,displayCount:A?A.length:R.length,totalCount:x?B:e.length,action:g}),!m&&v&&s.jsx(tt,{packets:v.packets,initialIndex:v.initialIndex,onClose:()=>k(null),onNavigatePrev:Z,onNavigateNext:ee,hasPrev:se,hasNext:te}),w&&s.jsx(it,{report:w,onClose:()=>C(null),onViewPacket:ie})]})}export{ds as C,gt as P,Ie as S,Ue as T,Ge as a,rs as g,Ze as u};
