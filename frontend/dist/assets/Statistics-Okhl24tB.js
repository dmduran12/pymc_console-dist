var Ct=Object.defineProperty;var At=(t,n,s)=>n in t?Ct(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s;var xe=(t,n,s)=>At(t,typeof n!="symbol"?n+"":n,s);import{d as Ae,r as c,j as e,p as Ce,c as nt,bc as yt,c0 as jt,c1 as _t,v as Fe,c2 as Rt,c3 as Tt,f as Dt,c4 as Et,c5 as Lt,c6 as It,c7 as Pt,c8 as Ot,bz as Ft,c9 as Be,bC as Ht,ca as Bt,cb as $t,H as Ne,cc as zt,cd as Wt,ce as Ut,G as Gt,N as Vt,K as qt,D as Kt,ak as Yt,al as Xt,O as Zt,ae as Qt,cf as Jt,cg as $e,ch as at,a6 as es,R as ts,ci as ss}from"./index-DhkG1Nx9.js";import{L as ve}from"./layers-BxF7oyms.js";import{a as Je,g as ke,E as ns,A as Oe}from"./AnimatedNumber-VoU6jLG5.js";import{u as et,h as as,r as tt}from"./consumer-registry-CTQIn0m9.js";import{C as ze,e as rs}from"./easing-Ch_Y3tms.js";import{T as is}from"./TimeRangeStepper-RSPVaByt.js";import{C as ue,P as os,a as ls,B as cs}from"./PageLayout-BkUTZXJb.js";import{D as ms}from"./DataBox-BMesbbaF.js";import{C as us}from"./CollisionExplorerModal-Cs8y9_83.js";import{H as rt}from"./hash-KLxvul5e.js";import{T as Ze}from"./triangle-alert-D8NErBXC.js";import{L as ds}from"./LightSparkline-Bg_XrgTS.js";import{A as hs}from"./activity-BG24yKp1.js";import{c as xs,a as ps,A as fs}from"./AnalyzerFilterPanel-CBw2MsnC.js";import{useResolveSource as gs}from"./usePipelineStore-B9ir1Xwp.js";import{R as be,C as we}from"./Grid-DknC4rR5.js";import{S as bs}from"./settings-2-Bgw7gOTp.js";import{N as ys}from"./network-DBF70fah.js";import"./index-Bx_G2nLG.js";import"./chevron-right-na13OQfy.js";import"./map-pin-BHGohRD7.js";import"./BasemapLayer-CfNeG6Jg.js";import"./monitor-smartphone-jV9bAwUA.js";import"./node-types-CgBRFpS8.js";import"./funnel-Dr2cCUci.js";import"./circle-question-mark--xh93QHC.js";import"./search-BmkxxIVP.js";/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]],Ns=Ae("chart-line",js);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],it=Ae("circle-check-big",vs);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],Ss=Ae("grid-3x3",ks);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=[["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"19",cy:"5",r:"1",key:"w8mnmm"}],["circle",{cx:"5",cy:"5",r:"1",key:"lttvr7"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}],["circle",{cx:"19",cy:"19",r:"1",key:"shf9b7"}],["circle",{cx:"5",cy:"19",r:"1",key:"bfqh0e"}]],Ms=Ae("grip",ws);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=[["path",{d:"M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"knzxuh"}],["path",{d:"M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"2jd2cc"}],["path",{d:"M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"rd2r6e"}]],As=Ae("waves",Cs),Nt={useAbsoluteThresholds:!0,baselinePercentile:6,spikePercentile:50,baselineDbm:-107,spikeDbm:-100,mergeGapSeconds:45,minSequenceLength:16,similarityToleranceDbm:5};function je(t,n){if(t.length===0)return 0;const s=n/100*(t.length-1),a=Math.floor(s),i=Math.ceil(s);return a===i?t[a]:t[a]+(t[i]-t[a])*(s-a)}function ot(t){if(t.length===0)return{median:0,p90:0,p95:0,p99:0,max:0,min:0};const n=[...t].sort((s,a)=>s-a);return{median:je(n,50),p90:je(n,90),p95:je(n,95),p99:je(n,99),max:n[n.length-1],min:n[0]}}function _s(t,n={}){const s={...Nt,...n};if(t.length<10)return{anomalies:[],thresholds:ot([]),totalSamples:t.length,anomalySamples:0};const a=t.map(g=>g.noise_floor_dbm),i=ot(a),r=[...a].sort((g,j)=>g-j);let l,x;s.useAbsoluteThresholds?(l=s.baselineDbm,x=s.spikeDbm):(l=je(r,s.baselinePercentile),x=je(r,s.spikePercentile));const o=[...t].sort((g,j)=>g.timestamp-j.timestamp),p=[];let u=null,h=0;for(const g of o)if(g.noise_floor_dbm>l&&g.noise_floor_dbm<x)if(h++,!u)u={startTs:g.timestamp,endTs:g.timestamp,values:[g.noise_floor_dbm],timestamps:[g.timestamp],rollingAvg:g.noise_floor_dbm};else{const k=Math.abs(g.noise_floor_dbm-u.rollingAvg)<=s.similarityToleranceDbm,R=g.timestamp-u.endTs<=s.mergeGapSeconds;k&&R?(u.endTs=g.timestamp,u.values.push(g.noise_floor_dbm),u.timestamps.push(g.timestamp),u.rollingAvg=u.values.reduce((I,z)=>I+z,0)/u.values.length):(u.values.length>=s.minSequenceLength&&p.push(u),u={startTs:g.timestamp,endTs:g.timestamp,values:[g.noise_floor_dbm],timestamps:[g.timestamp],rollingAvg:g.noise_floor_dbm})}else u&&u.values.length>=s.minSequenceLength&&p.push(u),u=null;return u&&u.values.length>=s.minSequenceLength&&p.push(u),p.length===0?{anomalies:[],thresholds:i,totalSamples:t.length,anomalySamples:h,debug:{baselineCutoff:l,spikeCutoff:x,midBandSamples:h}}:{anomalies:p.map(g=>{const j=Math.max(...g.values),y=g.values.reduce((k,R)=>k+R,0)/g.values.length;return{startTs:g.startTs,endTs:g.endTs,peakValue:j,avgValue:y,severity:Rs(y,l,x),sampleCount:g.values.length}}),thresholds:i,totalSamples:t.length,anomalySamples:h,debug:{baselineCutoff:l,spikeCutoff:x,midBandSamples:h}}}function Rs(t,n,s){const a=s-n;if(a===0)return"moderate";const i=(t-n)/a;return i>.66?"critical":i>.33?"severe":"moderate"}const Ts=Object.entries(yt).map(([t,n])=>{const s=parseInt(t,10);return{typeNum:s,key:`TYPE_${s}`,label:n}});function st({sortedTypes:t,highlightedType:n,onTypeHover:s,aggregateShares:a,hoverData:i}){const r=c.useMemo(()=>{if(!i)return null;const o=new Map;for(const p of i.items)o.set(p.key,p.value);return o},[i]),l=r!==null,x=c.useMemo(()=>{const o=new Set(t.map(h=>h.key)),p=t.map(h=>({typeNum:h.typeNum,key:h.key,label:h.label})),u=Ts.filter(h=>!o.has(h.key));return[...p,...u]},[t]);return e.jsxs("div",{className:"flex-shrink-0 pt-2 sm:pt-3 mt-1 sm:mt-2 px-0 sm:pr-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mx-0 sm:ml-9 sm:mr-0 mb-1 sm:mb-1.5 type-data-xs",children:[e.jsx("span",{className:"text-fg-muted",children:"Packet Types"}),l&&(i==null?void 0:i.timeLabel)&&e.jsx("span",{className:"text-sys-indigo tabular-nums",children:i.timeLabel})]}),e.jsx("div",{className:"flex flex-wrap gap-x-3 sm:gap-x-4 gap-y-1 type-data-xs mx-0 sm:ml-9 sm:mr-0",onMouseLeave:()=>s(null),children:x.map(o=>{const p=Ce(o.typeNum),u=(r==null?void 0:r.get(o.key))??0,h=a.get(o.key)??0,w=l?u:h,g=w>1e-4,j=a.has(o.key),y=n===o.key,k=n&&!y||l&&u<=1e-4||!l&&!n&&!j;return e.jsxs("div",{className:nt("flex items-center gap-1.5 transition-opacity cursor-pointer hover:opacity-80",k&&"opacity-30"),onMouseEnter:()=>s(o.key),children:[e.jsx("div",{className:"shrink-0 w-3 h-3 rounded-xs",style:{backgroundColor:p}}),e.jsx("span",{className:"text-fg-secondary whitespace-nowrap",children:o.label}),g&&e.jsxs("span",{className:nt("tabular-nums",l?"text-fg-primary":"text-fg-muted"),children:[(w*100).toFixed(1),"%"]})]},o.key)})})]})}const lt='ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace',Ds=2,Es=3,Ls=32,Is=20,Ps=80;function ct(t,n,s,a,i){const r=t.reduce((p,u)=>p+u,0);if(r<=0||t.length===0)return[];const l=t.map((p,u)=>u).sort((p,u)=>t[u]-t[p]),x=l.map(p=>t[p]),o=new Array(t.length);return Qe(x,l,r,n,s,a,i,o),o}function Qe(t,n,s,a,i,r,l,x){if(t.length===0)return;if(t.length===1){x[n[0]]={x:a,y:i,w:r,h:l,index:n[0]};return}const o=r*l/s,p=r>=l,u=p?l:r;let h=0,w=1/0,g=0;for(let z=0;z<t.length;z++){const H=h+t[z],q=H*o/u;if(q<=0){g=z+1,h=H;continue}const O=t[0]*o/q,N=t[z]*o/q,m=Math.max(O>q?O/q:q/O,N>q?N/q:q/N);if(m<=w)w=m,g=z+1,h=H;else break}const j=u>0?h*o/u:0;let y=0;for(let z=0;z<g;z++){const q=(h>0?t[z]/h:0)*u;p?x[n[z]]={x:a,y:i+y,w:j,h:q,index:n[z]}:x[n[z]]={x:a+y,y:i,w:q,h:j,index:n[z]},y+=q}const k=t.slice(g),R=n.slice(g),I=s-h;p?Qe(k,R,I,a+j,i,r-j,l,x):Qe(k,R,I,a,i+j,r,l-j,x)}function mt(t,n,s,a,i,r){for(const l of n){const x=s[l.index];if(!x)continue;const o=Ds*r,p=l.x*r+o/2,u=l.y*r+o/2,h=l.w*r-o,w=l.h*r-o;if(h<=0||w<=0)continue;const g=Ce(x.typeNum),j=i!==null&&i!==l.index;t.save(),t.globalAlpha=j?.4:1;const y=Es*r;t.beginPath(),t.moveTo(p+y,u),t.lineTo(p+h-y,u),t.quadraticCurveTo(p+h,u,p+h,u+y),t.lineTo(p+h,u+w-y),t.quadraticCurveTo(p+h,u+w,p+h-y,u+w),t.lineTo(p+y,u+w),t.quadraticCurveTo(p,u+w,p,u+w-y),t.lineTo(p,u+y),t.quadraticCurveTo(p,u,p+y,u),t.closePath(),t.fillStyle=g,t.fill(),t.strokeStyle="rgba(0,0,0,0.2)",t.lineWidth=1*r,t.stroke();const k=4*r,R=l.w>36&&l.h>20,I=l.w>36&&l.h>32;if(R){const z=11*r;if(I){const H=a>0?x.size/a*100:0;t.font=`500 ${8*r}px ${lt}`,t.fillStyle="rgba(0,0,0,0.6)",t.textBaseline="alphabetic",t.textAlign="left",t.fillText(`${H.toFixed(1)}%`,p+k,u+w-k-z)}t.font=`600 ${9*r}px ${lt}`,t.fillStyle="rgba(0,0,0,0.85)",t.textBaseline="alphabetic",t.textAlign="left",t.fillText(x.name,p+k,u+w-k)}t.restore()}}function Os(t,n,s){for(const a of t)if(n>=a.x&&n<=a.x+a.w&&s>=a.y&&s<=a.y+a.h)return a.index;return null}function Fs({data:t,total:n,color:s,position:a,containerWidth:i,isAirtime:r}){if(!t||!a)return null;const l=(t.value/n*100).toFixed(1),x=160,u=i-a.x<x+24?Math.max(8,a.x-x-8):a.x+16;return e.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:u,top:Math.max(8,a.y-60)},children:e.jsxs("div",{className:"bg-tooltip-bg border border-edge-subtle rounded-lg px-3 py-2 shadow-xl min-w-[140px]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-sm flex-shrink-0",style:{backgroundColor:s}}),e.jsx("span",{className:"type-data-sm font-semibold text-fg-primary",children:t.name})]}),e.jsxs("div",{className:"space-y-0.5 type-data-xs text-fg-muted",children:[e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{children:r?"Airtime":"Count"}),e.jsx("span",{className:"text-fg-primary tabular-nums font-medium",children:r?ut(t.value):t.value.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{children:"Share"}),e.jsxs("span",{className:"text-fg-primary tabular-nums font-medium",children:[l,"%"]})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-fg-primary tabular-nums font-medium",children:r?ut(n):n.toLocaleString()})]})]})]})})}function ut(t){return t>=6e4?`${(t/6e4).toFixed(1)}m`:t>=1e3?`${(t/1e3).toFixed(1)}s`:`${Math.round(t)}ms`}function Hs({sortedTypes:t,aggregateShares:n,mode:s="share"}){var O,N,m;const[a,i]=c.useState(null),[r,l]=c.useState(null),[x,o]=c.useState(0),[p,u]=c.useState(null),h=c.useRef(null),w=c.useRef(null),g=c.useRef([]),j=s==="airtime",y=c.useMemo(()=>t.reduce((f,v)=>f+(j?v.totalAirtime:v.totalCount),0),[t,j]),k=c.useMemo(()=>t.map((f,v)=>({name:f.label,size:j?f.totalAirtime:f.totalCount,index:v,typeNum:f.typeNum,key:f.key})),[t,j]);c.useEffect(()=>{const f=w.current;if(!f)return;const v=f.parentElement;if(!v)return;const E=v.getBoundingClientRect(),$=E.width,T=E.height;if($<=0||T<=0)return;const W=window.devicePixelRatio||1;f.width=Math.floor($*W),f.height=Math.floor(T*W),f.style.width=`${$}px`,f.style.height=`${T}px`;const V=k.map(U=>U.size),ee=ct(V,0,0,$,T);g.current=ee;const J=f.getContext("2d");J&&(J.clearRect(0,0,f.width,f.height),mt(J,ee,k,y,a,W))},[k,y,a]),c.useEffect(()=>{const f=h.current;if(!f)return;const v=new ResizeObserver(()=>{const E=w.current;if(!E)return;const $=f.getBoundingClientRect(),T=$.width,W=$.height;if(T<=0||W<=0)return;const V=window.devicePixelRatio||1;E.width=Math.floor(T*V),E.height=Math.floor(W*V),E.style.width=`${T}px`,E.style.height=`${W}px`;const ee=k.map(D=>D.size),J=ct(ee,0,0,T,W);g.current=J;const U=E.getContext("2d");U&&(U.clearRect(0,0,E.width,E.height),mt(U,J,k,y,a,V))});return v.observe(f),()=>v.disconnect()},[k,y]);const R=c.useCallback(f=>{const v=h.current;if(!v)return;const E=v.getBoundingClientRect(),$=f.clientX-E.left,T=f.clientY-E.top,W=Os(g.current,$,T);i(W),W!==null?(o(E.width),l({x:$,y:T})):l(null)},[]),I=c.useCallback(()=>{i(null),l(null)},[]),z=c.useCallback(f=>{if(u(f),f){const v=k.findIndex(E=>E.key===f);i(v>=0?v:null)}else i(null)},[k]),H=a!==null?{name:((O=k[a])==null?void 0:O.name)??"",value:((N=k[a])==null?void 0:N.size)??0}:null,q=a!==null?Ce((m=k[a])==null?void 0:m.typeNum):"";return t.length===0||y===0?e.jsxs("div",{className:"h-full flex items-center justify-center text-fg-muted",children:[e.jsx(ve,{className:"w-6 h-6 mr-2 opacity-50"}),e.jsx("span",{children:"No packet type data available"})]}):e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"flex-1 min-h-0 relative",children:e.jsxs("div",{className:"absolute overflow-hidden radius-inner depth-stroke-inset bg-chart-inner",style:{left:Ls,right:0,top:0,bottom:Is},ref:h,onMouseMove:R,onMouseLeave:I,children:[e.jsx("canvas",{ref:w,className:"absolute inset-0",style:{cursor:"default"}}),e.jsx(Fs,{data:H,total:y,color:q,position:r,containerWidth:x,isAirtime:j})]})}),e.jsx("div",{style:{minHeight:Ps},children:e.jsx(st,{sortedTypes:t,highlightedType:p,onTypeHover:z,aggregateShares:n})})]})}const We=32,Ue=20,Bs=300;function ye(t){return t>=1e9?`${(t/1e9).toFixed(1)} Gb`:t>=1e6?`${(t/1e6).toFixed(1)} Mb`:t>=1e3?`${(t/1e3).toFixed(1)} Kb`:`${t.toFixed(0)} B`}function $s({packets:t,mode:n,startTs:s,endTs:a,radioConfig:i,bucketCount:r,lockedYMax:l,legendMinH:x}){const o=c.useMemo(()=>jt(),[]),p=o.blue,u=o.red,h=o.yellow,[w,g]=c.useState(null),{trendData:j,totals:y}=c.useMemo(()=>{if(t.length===0)return{trendData:[],totals:{rxBytes:0,txBytes:0,rxAirtime:0,txAirtime:0}};const N=a-s,m=Math.min(Math.ceil(N/Bs),r),f=N/m,v=[];let E=0,$=0,T=0,W=0;for(const B of t){const b=B.timestamp;if(b<s||b>=a)continue;const S=Je(B),C=ke(B,{spreadingFactor:i.sf,bandwidthHz:i.bw,codingRate:i.cr,preambleLength:i.preamble}),P={timestamp:b,rxAirtime:0,txAirtime:0,rxBytes:0,txBytes:0};B.transmitted?(P.txAirtime=C,P.txBytes=S,$+=S,W+=C):(P.rxAirtime=C,P.rxBytes=S,E+=S,T+=C),v.push(P)}v.sort((B,b)=>B.timestamp-b.timestamp);const V=new Float64Array(v.length+1),ee=new Float64Array(v.length+1),J=new Float64Array(v.length+1),U=new Float64Array(v.length+1),D=new Float64Array(v.length);for(let B=0;B<v.length;B++)V[B+1]=V[B]+v[B].rxAirtime,ee[B+1]=ee[B]+v[B].txAirtime,J[B+1]=J[B]+v[B].rxBytes,U[B+1]=U[B]+v[B].txBytes,D[B]=v[B].timestamp;const K=B=>{let b=0,S=D.length;for(;b<S;){const C=b+S>>>1;D[C]<B?b=C+1:S=C}return b},te=[],re=f*1e3;for(let B=0;B<m;B++){const b=s+B*f,S=b+f,C=K(b),P=K(S);if(n==="share"){const Z=J[P]-J[C],de=U[P]-U[C];te.push({timestamp:b,rx:Z>0?Z:null,tx:de>0?de:null})}else{const Z=V[P]-V[C],de=ee[P]-ee[C],pe=Z/re*100,fe=de/re*100;te.push({timestamp:b,rx:pe>0?pe:null,tx:fe>0?fe:null})}}const ae=2/31;let se=null;return{trendData:te.map(B=>{const b=B.rx;return b!==null&&b>0&&(se===null?se=b:se=ae*b+(1-ae)*se),{...B,rxSmooth:se!==null&&se>0?se:null}}),totals:{rxBytes:E,txBytes:$,rxAirtime:T,txAirtime:W}}},[t,s,a,r,n,i]),k=c.useMemo(()=>{if(j.length===0)return n==="share"?100:10;let N=0;for(const f of j){const v=f.rx??0,E=f.tx??0;v>N&&(N=v),E>N&&(N=E)}const m=N*1.1;return n==="share"?m<=100?100:m<=500?Math.ceil(m/100)*100:m<=1e3?Math.ceil(m/200)*200:m<=5e3?Math.ceil(m/500)*500:m<=1e4?Math.ceil(m/1e3)*1e3:Math.ceil(m/5e3)*5e3:Math.max(1,Math.ceil(m))},[j,n]),R=l??k,I=c.useMemo(()=>{if(w!==null&&j[w]){const N=j[w],m=N.rx??0,f=N.tx??0;return n==="share"?{rx:ye(m),tx:ye(f),total:ye(m+f),isHovered:!0}:{rx:`${m.toFixed(2)}%`,tx:`${f.toFixed(2)}%`,total:`${(m+f).toFixed(2)}%`,isHovered:!0}}if(n==="share")return{rx:ye(y.rxBytes),tx:ye(y.txBytes),total:ye(y.rxBytes+y.txBytes),isHovered:!1};{let N=0,m=0,f=0;for(const $ of j)($.rx!==null||$.tx!==null)&&(N+=$.rx??0,m+=$.tx??0,f++);const v=f>0?N/f:0,E=f>0?m/f:0;return{rx:`${v.toFixed(2)}%`,tx:`${E.toFixed(2)}%`,total:`${(v+E).toFixed(2)}%`,isHovered:!1}}},[w,j,y,n]),z=c.useMemo(()=>{const N=a-s,m=N/3600;return[0,.25,.5,.75,1].map(v=>{const E=s+N*v,$=new Date(E*1e3),T=$.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),W=$.toLocaleDateString([],{weekday:"short"}),V=v===.25||v===.75;return{pct:v,label:m>=24?`${W} ${T}`:T,mobileHidden:V}})},[s,a]),H=c.useCallback(N=>{g(N)},[]);if(j.length===0)return e.jsxs("div",{className:"h-full flex items-center justify-center text-fg-muted",children:[e.jsx(ve,{className:"w-6 h-6 mr-2 opacity-50"}),e.jsx("span",{children:"No packet data available"})]});const q=c.useMemo(()=>n==="airtime"?R<=5?1:R<=10?2:R<=20?5:Math.ceil(R/5):R<=100?25:R<=500?100:R<=1e3?200:R<=5e3?1e3:R<=1e4?2e3:Math.ceil(R/5e3)*1e3,[R,n]),O=c.useMemo(()=>{const N=[];for(let m=0;m<=R;m+=q){const f=(1-m/R)*100;let v;n==="airtime"?v=`${m}%`:m>=1e6?v=`${(m/1e6).toFixed(1)}M`:m>=1e3?v=`${(m/1e3).toFixed(0)}K`:v=`${m}`,N.push({pos:f,label:v})}return N},[R,q,n]);return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex-1 min-h-0 relative",children:[e.jsx("div",{className:"absolute top-0 left-0 flex flex-col justify-between",style:{width:We,bottom:Ue},children:O.map((N,m)=>e.jsx("span",{className:"type-data-xs text-fg-secondary text-right pr-1.5",style:{position:"absolute",top:`${N.pos}%`,transform:m===0?"translateY(-100%)":m===O.length-1?"none":"translateY(-50%)",right:0},children:N.label},m))}),e.jsx("div",{className:"absolute overflow-hidden radius-inner depth-stroke-inset bg-chart-inner",style:{left:We,right:0,top:0,bottom:Ue},children:e.jsx(_t,{data:j,yAxisMode:n==="share"?"share":"airtime",yMax:R,onHover:H,startTs:s,endTs:a,externalAxes:!0})}),e.jsx("div",{className:"absolute left-0 right-0 bottom-0 flex items-center pointer-events-none",style:{left:We,height:Ue,paddingTop:4},children:z.map((N,m)=>e.jsx("span",{className:`absolute type-data-xs text-fg-muted/60 tabular-nums ${N.mobileHidden?"hidden sm:inline":""}`,style:{left:`${N.pct*100}%`,transform:N.pct===0?"translateX(0)":N.pct===1?"translateX(-100%)":"translateX(-50%)"},children:N.label},m))})]}),e.jsxs("div",{className:"flex items-end justify-between pb-1",style:{minHeight:x},children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-5 type-data-sm pl-2 sm:pl-11",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-4 sm:w-5 h-[2px] rounded-full",style:{backgroundColor:p}}),e.jsx("span",{className:"text-fg-secondary",children:"RX"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-4 sm:w-5 h-[2px] rounded-full",style:{backgroundColor:u}}),e.jsx("span",{className:"text-fg-secondary",children:"TX"})]}),e.jsxs("div",{className:"hidden sm:flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-[2px] rounded-full",style:{backgroundColor:h}}),e.jsx("span",{className:"text-fg-secondary",children:"Avg"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 sm:gap-8",children:[e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("div",{className:"type-data-xl text-fg-primary",children:I.rx}),e.jsx(Fe,{color:"zinc",className:"mb-0.5 sm:mb-1",children:"RX"})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("div",{className:"type-data-xl text-fg-primary",children:I.tx}),e.jsx(Fe,{color:"zinc",className:"mb-0.5 sm:mb-1",children:"TX"})]})]})]})]})}const dt=Rt;class zs{constructor(){xe(this,"worker",null);xe(this,"listeners",new Set);xe(this,"currentResult",null);xe(this,"isComputing",!1);xe(this,"debounceTimer",null);xe(this,"debounceMs",250);xe(this,"lastCacheKey",null)}ensureWorker(){if(this.worker)return this.worker;if(typeof window>"u")return null;try{this.worker=new Worker(new URL("/assets/bucketing.worker-D0TT0k8y.js",import.meta.url),{type:"module"}),this.worker.onmessage=n=>{this.handleWorkerMessage(n.data)},this.worker.onerror=n=>{console.error("[BucketingService] Worker error:",n),this.isComputing=!1,this.notifyListeners()}}catch(n){console.error("[BucketingService] Failed to initialize worker:",n)}return this.worker}handleWorkerMessage(n){if(this.isComputing=!1,n.type==="error"){this.currentResult=null,this.notifyListeners();return}const s=n.payload;this.currentResult={points:s.points,rawValues:s.rawValues,packetTypes:s.packetTypes,timestamps:s.timestamps,count:s.count,minTime:s.minTime,maxTime:s.maxTime,minValue:s.minValue,maxValue:s.maxValue,rawMinValue:s.rawMinValue,rawMaxValue:s.rawMaxValue,unit:"%",stats:{p5:s.p5,p50:s.p50,p95:s.p95,uniqueValues:s.uniqueValues,topValues:s.topValues}},this.notifyListeners()}notifyListeners(){for(const n of this.listeners)try{n(this.currentResult,this.isComputing)}catch(s){console.error("[BucketingService] Listener error:",s)}}isCacheHit(n){return!this.lastCacheKey||!this.currentResult?!1:this.lastCacheKey.startTs===n.startTs&&this.lastCacheKey.endTs===n.endTs&&this.lastCacheKey.mode===n.mode&&this.lastCacheKey.packetCount===n.packetCount}compute(n,s,a,i,r){if(n.length===0||!r){this.currentResult=null,this.notifyListeners();return}const l={startTs:s,endTs:a,mode:i,packetCount:n.length};this.isCacheHit(l)||(this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.debounceTimer=null,this.computeInternal(n,s,a,i,r,l)},this.debounceMs))}computeInternal(n,s,a,i,r,l){const x=this.ensureWorker();if(!x)return;const o=n.length,p=new Float64Array(o),u=new Float64Array(o),h=new Uint16Array(o),w=new Uint8Array(o),g={spreadingFactor:r.sf,bandwidthHz:r.bw,codingRate:r.cr,preambleLength:r.preamble};for(let y=0;y<o;y++){const k=n[y];p[y]=k.timestamp??0,w[y]=(k.type??k.payload_type??255)&255,h[y]=Math.min(Je(k),65535),i==="airtime"?u[y]=ke(k,g):u[y]=1}this.isComputing=!0,this.lastCacheKey=l,this.notifyListeners();const j={type:"compute",payload:{timestamps:p,airtimeMs:u,byteSizes:h,packetTypes:w,startTs:s,endTs:a,mode:i}};x.postMessage(j,[p.buffer,u.buffer,h.buffer,w.buffer])}getResult(){return this.currentResult}isWorking(){return this.isComputing}subscribe(n){return this.listeners.add(n),n(this.currentResult,this.isComputing),()=>{this.listeners.delete(n)}}clear(){this.currentResult=null,this.lastCacheKey=null,this.notifyListeners()}terminate(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.worker&&(this.worker.terminate(),this.worker=null),this.listeners.clear()}}const Ge=new zs;function Ws(t,n,s,a,i){const[r,l]=c.useState(()=>Ge.getResult());return c.useEffect(()=>Ge.subscribe(x=>{l(x)}),[]),c.useEffect(()=>{Ge.compute(t,n,s,a,i)},[t,n,s,a,i]),r}function Us({mode:t,packets:n,startTs:s,endTs:a,radioConfig:i,sortedTypes:r,aggregateShares:l,noiseFloorAnomalies:x,showNoiseFloorOverlay:o,overlayOpacity:p=.5,startLabel:u,endLabel:h,lockedYMax:w,legendMinH:g,dotSize:j,dotOpacity:y}){const[k,R]=c.useState(null),[I,z]=c.useState(null),H=c.useMemo(()=>(a-s)/3600,[s,a]),q=c.useCallback(U=>{z(U)},[]),N=Ws(n,s,a,t==="share"?"share":"airtime",i),[m,f]=c.useState(null),v=c.useCallback((U,D)=>{R(U),f(D??null)},[]),E=c.useMemo(()=>{if(m===null||!N||N.count===0)return null;const U=s+m*(a-s);let D;H>=168?D=75:H>=72?D=35:H>=24?D=15:H>=3?D=10:D=5;const K=D*60/2;return{start:U-K,end:U+K}},[m,N,s,a,H]),$=c.useMemo(()=>E?new Date((E.start+E.end)/2*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}):null,[E]),T=c.useMemo(()=>{if(k===null||!E)return null;const U=$??"",{start:D,end:K}=E,te=n.filter(b=>b.timestamp>=D&&b.timestamp<K);if(te.length===0)return{timestamp:(D+K)/2,timeLabel:U,items:r.map(b=>({key:b.key,label:b.label,value:0,color:dt(b.typeNum)}))};const re=new Map,ae=new Map;let se=0,le=0;for(const b of te){const C=`TYPE_${b.type??b.payload_type??-1}`;if(re.set(C,(re.get(C)??0)+1),se++,i){const P=ke(b,{spreadingFactor:i.sf,bandwidthHz:i.bw,codingRate:i.cr,preambleLength:i.preamble});ae.set(C,(ae.get(C)??0)+P),le+=P}}const B=r.map(b=>{let S;return t==="airtime"?S=le>0?(ae.get(b.key)??0)/le:0:S=se>0?(re.get(b.key)??0)/se:0,{key:b.key,label:b.label,value:S,color:dt(b.typeNum)}});return{timestamp:(D+K)/2,timeLabel:U,items:B}},[k,E,$,n,r,t,i]),W=t==="share",V=w??(N==null?void 0:N.maxValue)??(W?240:10),ee=c.useMemo(()=>{if(!W)return 5;const U=[10,20,25,50,100,200,250,500,1e3],D=V/4.5;for(const K of U)if(K>=D)return K;return V>5e3?Math.ceil(D/1e3)*1e3:Math.ceil(D/100)*100},[V,W]),J=c.useMemo(()=>{const U=[];for(let D=0;D<=V;D+=ee){const K=(1-D/V)*100;U.push({pos:K,label:W?`${D}B`:`${D}%`})}return U},[V,ee,W]);return!N||N.count===0?e.jsxs("div",{className:"h-full flex items-center justify-center text-fg-muted",children:[e.jsx(ve,{className:"w-6 h-6 mr-2 opacity-50"}),e.jsx("span",{children:"No packet data available"})]}):e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex-1 min-h-0 relative",children:[e.jsx("div",{className:"absolute top-0 left-0 flex flex-col justify-between",style:{width:32,bottom:20},children:J.map((U,D)=>e.jsx("span",{className:"type-data-xs text-fg-secondary text-right pr-1.5",style:{position:"absolute",top:`${U.pos}%`,transform:D===0?"translateY(-100%)":D===J.length-1?"none":"translateY(-50%)",right:0},children:U.label},D))}),e.jsxs("div",{className:"absolute overflow-hidden radius-inner depth-stroke-inset bg-chart-inner",style:{left:32,right:0,top:0,bottom:20},children:[e.jsx(Tt,{scatterData:N,yAxisMode:t==="share"?"share":"airtime",onHover:v,noiseFloorAnomalies:x,showNoiseFloorOverlay:o,overlayOpacity:p,highlightedType:I,timeRangeHours:H,yAxisMaxOverride:w,dotSize:j,dotOpacity:y,startTs:s,endTs:a,externalAxes:!0}),$&&e.jsx("div",{className:"absolute top-1 right-1 px-2 py-0.5 bg-elevated/90 rounded type-data-xs text-sys-indigo pointer-events-none z-10",children:$})]}),u&&h&&e.jsxs("div",{className:"absolute left-0 right-0 bottom-0 flex justify-between pointer-events-none type-data-xs text-fg-muted/60",style:{left:32,height:20,paddingTop:4},children:[e.jsx("span",{children:u}),e.jsx("span",{children:h})]})]}),e.jsx("div",{style:{minHeight:g},children:e.jsx(st,{sortedTypes:r,highlightedType:I,onTypeHover:q,aggregateShares:l,hoverData:T})})]})}function Gs({mode:t,onChange:n}){return e.jsxs("div",{className:"toggle-group toggle-group-sm",children:[e.jsx("button",{onClick:()=>n("share"),className:`toggle-group-item ${t==="share"?"active":""}`,children:"Total"}),e.jsx("button",{onClick:()=>n("airtime"),className:`toggle-group-item ${t==="airtime"?"active":""}`,children:"Airtime"})]})}function Vs({smoothing:t,onChange:n}){return e.jsxs("div",{className:"toggle-group toggle-group-sm",children:[e.jsx("button",{onClick:()=>n("stats"),className:`toggle-group-item ${t==="stats"?"active":""}`,title:"Statistics view (scatter plot)",children:e.jsx(Ms,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>n("trend"),className:`toggle-group-item ${t==="trend"?"active":""}`,title:"Trend line chart",children:e.jsx(Ns,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>n("ema"),className:`toggle-group-item ${t==="ema"?"active":""}`,title:"Stacked area (moderate smoothing)",children:e.jsx(ve,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>n("ultra"),className:`toggle-group-item ${t==="ultra"?"active":""}`,title:"Stacked area (heavy smoothing)",children:e.jsx(As,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>n("mosaic"),className:`toggle-group-item ${t==="mosaic"?"active":""}`,title:"Mosaic view (treemap)",children:e.jsx(Ss,{className:"w-3.5 h-3.5"})})]})}function qs({enabled:t,onChange:n,anomalyCount:s=0,showTuning:a=!1,onTuningChange:i}){return e.jsxs("div",{className:"relative inline-flex items-center gap-1",children:[t&&i&&e.jsx("button",{onClick:()=>i(!a),className:`toggle-group toggle-group-sm ${a?"active":""}`,title:a?"Hide tuning panel":"Show tuning panel",children:e.jsx("span",{className:`toggle-group-item ${a?"active":""}`,children:e.jsx(bs,{className:"w-3.5 h-3.5"})})}),e.jsx("button",{onClick:()=>n(!t),className:`toggle-group toggle-group-sm ${t?"active":""}`,title:t?"Hide noise floor anomalies":"Show noise floor anomalies",children:e.jsx("span",{className:`toggle-group-item ${t?"active":""}`,children:e.jsx(ns,{className:"w-3.5 h-3.5"})})}),s>0&&e.jsx("span",{className:"absolute -top-2 -right-2 min-w-[18px] h-[18px] px-1 rounded-full bg-sys-red text-white text-xs font-bold flex items-center justify-center pointer-events-none z-10",children:s>99?"99+":s})]})}const vt=[{target:"PacketAnalyzer",fn:"type",minStage:1},{target:"PacketAnalyzer",fn:"airtime",minStage:1,when:as}];tt(vt);const ht=360,Ks=500,Ys={sf:10,bw:25e4,cr:5,preamble:8},Ve=32;function xt(t,n){const s=new Date(t*1e3),a=l=>l.toString().padStart(2,"0"),i=`${a(s.getHours())}:${a(s.getMinutes())}`;return n<24?i:`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][s.getMonth()]} ${s.getDate()} ${i}`}function Xs(t){return yt[t]??`TYPE_${t.toString(16).toUpperCase()}`}function Zs(t,n){const s=new Map;for(const i of t){const r=i.type??i.payload_type??-1,l=ke(i,{spreadingFactor:n.sf,bandwidthHz:n.bw,codingRate:n.cr,preambleLength:n.preamble}),x=s.get(r)??{count:0,airtime:0};s.set(r,{count:x.count+1,airtime:x.airtime+l})}const a=[];for(const[i,r]of s)a.push({typeNum:i,key:`TYPE_${i}`,label:Xs(i),totalCount:r.count,totalAirtime:r.airtime});return a.sort((i,r)=>r.totalCount-i.totalCount)}function Qs(t,n,s,a,i,r,l=0){const x=s-n,o=x/a,p=o*1e3,u=x/3600,h=n-l*o,w=s+l*o,g=a+2*l,j=[];for(let y=0;y<g;y++){const k=h+y*o,R=new Date(k*1e3),I=u>=24?R.toLocaleDateString([],{weekday:"short",hour:"2-digit",minute:"2-digit",hour12:!1}):R.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),z={timestamp:k,time:I,counts:{},shares:{},airtimes:{},total:0,totalAirtime:0,bucketDurationMs:p};for(const H of r)z.counts[H.key]=0,z.airtimes[H.key]=0;j.push(z)}for(const y of t){const k=y.timestamp;if(k<h||k>=w)continue;const R=Math.min(Math.floor((k-h)/o),g-1),I=`TYPE_${y.type??y.payload_type??-1}`;j[R].counts[I]=(j[R].counts[I]??0)+1,j[R].total++;const z=ke(y,{spreadingFactor:i.sf,bandwidthHz:i.bw,codingRate:i.cr,preambleLength:i.preamble});j[R].airtimes[I]=(j[R].airtimes[I]??0)+z,j[R].totalAirtime+=z}for(const y of j)for(const k of r)y.shares[k.key]=y.total>0?y.counts[k.key]/y.total*100:0;return{buckets:j,visibleStart:l,visibleEnd:l+a}}function Js(t,n){const s=t.length;if(s===0)return[];if(n<.5)return[...t];const a=Math.sqrt(12*n*n/3+1);let i=Math.floor(a);i%2===0&&i--;const r=i+2,l=(12*n*n-3*i*i-12*i-9)/(-4*i-4),x=Math.round(l),o=[x>0?i:r,x>1?i:r,x>2?i:r];let p=new Float32Array(t);const u=new Float32Array(s);for(const h of o){const w=(h-1)/2;en(p,u,s,w);const g=p;p=u,u.set(g)}return Array.from(p)}function en(t,n,s,a){const i=a*2+1;let r=0;for(let l=0;l<=a;l++)r+=t[Math.min(l,s-1)];for(let l=0;l<a;l++)r+=t[0];for(let l=0;l<s;l++){n[l]=r/i;const x=l-a,o=l+a+1;r-=t[Math.max(0,Math.min(x,s-1))],r+=t[Math.max(0,Math.min(o,s-1))]}}function tn(t,n){if(t.length===0)return[];if(n<=1)return[...t];const s=t.length,a=new Float32Array(s),i=Math.floor(n/2);let r=0,l=0;for(let x=0;x<=Math.min(i,s-1);x++)r+=t[x],l++;for(let x=0;x<s;x++){a[x]=r/l;const o=x-i,p=x+i+1;o>=0&&(r-=t[o],l--),p<s&&(r+=t[p],l++)}return Array.from(a)}const sn={ema:1800,ultra:14400},nn={ema:"sma",ultra:"gaussian"};function kt(t,n,s){const a=sn[t],i=nn[t]??"sma";if(!a)return{sigma:0,window:1,handleSize:0};let r=Math.round(a/n);r=Math.max(3,Math.min(r,Math.floor(s/3))),r%2===0&&(r+=1);const l=Math.ceil(i==="gaussian"?r*Math.sqrt(4/12)*3:r/2);return i==="gaussian"?{sigma:r*Math.sqrt(.3333333333333333),window:r,handleSize:l}:{sigma:0,window:r,handleSize:l}}function an(t,n,s,a="ultra",i,r,l){var q;const{buckets:x,visibleStart:o,visibleEnd:p}=t,u=x.length,h=s.length,w=p-o;if(u===0||h===0)return[];const g=l&&i!==void 0&&r!==void 0?(r-i)/l:(q=x[0])!=null&&q.bucketDurationMs?x[0].bucketDurationMs/1e3:240,j=Array.from({length:h},()=>new Array(u).fill(0));for(let O=0;O<u;O++){const N=x[O];if(n==="share"){if(N.total>0)for(let m=0;m<h;m++)j[m][O]=(N.counts[s[m].key]??0)/N.total}else{let m=0;for(let f=0;f<h;f++)m+=N.airtimes[s[f].key]??0;if(m>0)for(let f=0;f<h;f++)j[f][O]=(N.airtimes[s[f].key]??0)/m}}const{sigma:y,window:k}=kt(a,g,w);let R;y>0?R=j.map(O=>Js(O,y)):R=j.map(O=>tn(O,k));for(let O=0;O<u;O++){let N=0;for(let m=0;m<h;m++)R[m][O]=Math.max(0,R[m][O]),N+=R[m][O];if(N>0){const m=1/N;for(let f=0;f<h;f++)R[f][O]*=m}}const I=w>ht?Math.ceil(w/ht):1,z=Math.ceil(w/I),H=[];for(let O=0;O<z;O++){const N=o+O*I,m=Math.min(o+(O+1)*I,p),f=m-N,v=new Array(h).fill(0);for(let T=N;T<m;T++)for(let W=0;W<h;W++)v[W]+=R[W][T];for(let T=0;T<h;T++)v[T]/=f;let E=0;for(let T=0;T<h;T++)E+=v[T];if(E>0){const T=1/E;for(let W=0;W<h;W++)v[W]*=T}const $={timestamp:x[N].timestamp,time:x[N].time};for(let T=0;T<h;T++)$[s[T].key]=v[T];H.push($)}return H}const qe=80;function rn(t,n,s,a,i){const x=Math.max(1,Math.ceil((s-n)/300));if(a==="airtime"){const o=new Float64Array(x);for(const u of t){const h=u.timestamp;if(h<n||h>=s)continue;const w=Math.min(Math.floor((h-n)/300),x-1);o[w]+=ke(u,{spreadingFactor:i.sf,bandwidthHz:i.bw,codingRate:i.cr,preambleLength:i.preamble})}let p=0;for(let u=0;u<x;u++){const h=o[u]/3e5*100;h>p&&(p=h)}return Math.max(1,Math.ceil(p*1.1))}else{let o=0;for(const p of t){const u=p.timestamp;if(u<n||u>=s)continue;const h=Je(p);h>o&&(o=h)}return o<=240?240:Math.ceil(o*1.1/50)*50}}function on({packets:t,allPackets:n,startTs:s,endTs:a,parentStartTs:i,parentEndTs:r,bucketCount:l,radioConfig:x=Ys,mode:o="share",smoothing:p="stats",noiseFloorAnomalies:u=null,showNoiseFloorOverlay:h=!1,overlayOpacity:w=.5,dotSize:g,dotOpacity:j}){et(vt);const y=Dt(),[k,R]=c.useState(null),[I,z]=c.useState(null),[H,q]=c.useState([]),O=c.useRef(null),N=c.useRef(0);c.useEffect(()=>{const b=Math.abs(t.length-N.current);if(b===0&&H.length>0)return;O.current&&clearTimeout(O.current);const S=b>100?50:Ks;return O.current=setTimeout(()=>{N.current=t.length,q(t)},S),()=>{O.current&&clearTimeout(O.current)}},[t,H.length]);const m=c.useMemo(()=>Zs(H,x),[H,x]),f=c.useMemo(()=>{if(p!=="ema"&&p!=="ultra")return 0;const S=(a-s)/l,{handleSize:C}=kt(p,S,l);return C},[p,s,a,l]),v=c.useMemo(()=>Qs(H,s,a,l,x,m,f),[H,s,a,l,x,m,f]),E=c.useMemo(()=>m.reduce((b,S)=>b+S.totalCount,0),[m]),$=c.useMemo(()=>m.reduce((b,S)=>b+S.totalAirtime,0),[m]),{sortedTypes:T,aggregateShares:W}=c.useMemo(()=>{const b=new Map,S=o==="share"?E:$;if(S>0)for(const P of m){const Z=o==="share"?P.totalCount:P.totalAirtime;b.set(P.key,Z/S)}return{sortedTypes:[...m].sort((P,Z)=>(b.get(Z.key)??0)-(b.get(P.key)??0)),aggregateShares:b}},[m,E,$,o]),V=c.useMemo(()=>an(v,o,T,p,s,a,l),[v,o,T,p,s,a,l]),ee=c.useCallback(b=>R(b),[]),J=c.useCallback(b=>z(b),[]),U=c.useCallback(b=>R(b),[]),D=c.useMemo(()=>{if(I===null||!V[I])return null;const b=V[I];return{timestamp:b.timestamp,timeLabel:b.time,items:T.map(S=>({key:S.key,label:S.label,value:b[S.key]??0,color:Ce(S.typeNum)}))}},[I,V,T]),K=c.useMemo(()=>{const b=V.map(C=>C.timestamp),S=T.map(C=>({key:C.key,label:C.label,color:Ce(C.typeNum),values:V.map(P=>P[C.key]??0)}));return{timestamps:b,series:S}},[V,T]),te=null,re=n&&i!==void 0&&r!==void 0&&(s!==i||a!==r),ae=c.useMemo(()=>{if(!(!re||!n||i===void 0||r===void 0))return rn(n,i,r,o,x)},[re,n,i,r,o,x]);if(H.length===0)return t.length===0?e.jsxs("div",{className:"h-full flex items-center justify-center text-fg-muted",children:[e.jsx(ve,{className:"w-6 h-6 mr-2 opacity-50"}),e.jsx("span",{children:"No packet data available"})]}):null;if(p==="mosaic")return e.jsx(Hs,{sortedTypes:T,aggregateShares:W,mode:o});const se=(a-s)/3600,le=xt(s,se),B=xt(a,se);return p==="stats"?e.jsx(Us,{mode:o,packets:H,startTs:s,endTs:a,radioConfig:x,sortedTypes:T,aggregateShares:W,noiseFloorAnomalies:u,showNoiseFloorOverlay:h,overlayOpacity:w,startLabel:le,endLabel:B,lockedYMax:ae,legendMinH:qe,dotSize:g,dotOpacity:j}):p==="trend"?e.jsx($s,{packets:H,mode:o,startTs:s,endTs:a,radioConfig:x,bucketCount:l,lockedYMax:ae,legendMinH:qe}):e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex-1 min-h-0 relative",children:[e.jsx("div",{className:"absolute top-0 left-0 flex flex-col justify-between",style:{width:Ve,bottom:20},children:[0,20,40,60,80,100].map((b,S,C)=>e.jsxs("span",{className:"type-data-xs text-fg-secondary text-right pr-1.5",style:{position:"absolute",top:`${(1-b/100)*100}%`,transform:S===0?"translateY(-100%)":S===C.length-1?"none":"translateY(-50%)",right:0},children:[b,"%"]},b))}),e.jsx("div",{className:"absolute overflow-hidden radius-inner depth-stroke-inset bg-chart-inner",style:{left:Ve,right:0,top:0,bottom:20},children:e.jsx(Et,{timestamps:K.timestamps,series:K.series,highlightedKey:k,cursorColor:y.cursor,onHover:J,onSeriesHover:U,overlayLine:te,startTs:s,endTs:a,externalAxes:!0})}),e.jsxs("div",{className:"absolute left-0 right-0 bottom-0 flex justify-between pointer-events-none type-data-xs text-fg-muted/60",style:{left:Ve,height:20,paddingTop:4},children:[e.jsx("span",{children:le}),e.jsx("span",{children:B})]})]}),e.jsx("div",{style:{minHeight:qe},children:e.jsx(st,{sortedTypes:T,highlightedType:k,onTypeHover:ee,aggregateShares:W,hoverData:D})})]})}const ln=c.memo(on),Ke={ZOOM_DURATION:400,BLINK_DURATION:600},oe={PADDING:6,DOT_RADIUS:5,DOT_RADIUS_HOVERED:7,LOCAL_DOT_RADIUS:5,CARDINAL_FONT_SIZE:10,INTERCARDINAL_FONT_SIZE:9,LABEL_INSET:8,DATA_HEADROOM:1.08},cn={"1x":1,"2x":2,"4x":4,"8x":8,"16x":16,"36x":36},pt=[1,5,10,25,50,100,150],mn=22.5,St=mn*Math.PI/180,ft=Math.sin(St),gt=Math.cos(St);function un(t,n,s,a){const i=Math.PI/180,r=(a-n)*i,l=t*i,x=s*i,o=Math.sin(r)*Math.cos(x),p=Math.cos(l)*Math.sin(x)-Math.sin(l)*Math.cos(x)*Math.cos(r);return(Math.atan2(o,p)*180/Math.PI+360)%360}function dn(t,n,s,a){const r=Math.PI/180,l=(s-t)*r,x=(a-n)*r,o=Math.sin(l/2)**2+Math.cos(t*r)*Math.cos(s*r)*Math.sin(x/2)**2;return 6371*2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))}const hn=[{min:10,label:"Excellent"},{min:7,label:"Very Good"},{min:4,label:"Good"},{min:1,label:"Fair+"},{min:-2,label:"Fair"},{min:-5,label:"Fair-"},{min:-8,label:"Poor"},{min:-11,label:"Bad"},{min:-1/0,label:"Critical"}];function xn(t){var n;return((n=hn.find(s=>t>=s.min))==null?void 0:n.label)??"Critical"}function bt(t,n,s){const a=Ht(t,s);return n[a]||"#808080"}function pn({neighbors:t,quickNeighbors:n,localLat:s,localLon:a,onStatsChange:i,title:r,badge:l,stats:x}){const[o,p]=c.useState(null),[u,h]=c.useState(new Set),[w,g]=c.useState({width:0,height:0}),[j,y]=c.useState("1x"),[k,R]=c.useState(1),I=c.useRef(null),z=c.useRef({}),H=c.useRef(null),q=c.useRef(k);q.current=k;const O=Lt(),N=It(),m=Pt(),f=Ot(),v=jt(),E=Ft(),$=f?m.primary:m.secondary,T=f?.15:.4,W=f?.08:.25,V=f?v.blue:m.primary;c.useEffect(()=>{const d=H.current;if(!d)return;const L=new ResizeObserver(_=>{for(const F of _){const{width:Y,height:Q}=F.contentRect;Y>0&&Q>0&&g({width:Y,height:Q})}});L.observe(d);const A=d.getBoundingClientRect();return A.width>0&&A.height>0&&g({width:A.width,height:A.height}),()=>L.disconnect()},[]);const ee=c.useMemo(()=>{const d=new Set;if(n)for(const L of n)d.add(L.hash);return d},[n]),J=c.useMemo(()=>{const d=new Map;if(n)for(const L of n)d.set(L.hash,{snr:L.avgSnr,rssi:L.avgRssi});return d},[n]),{processedNeighbors:U,maxDistance:D,totalNeighbors:K,zeroHopCount:te}=c.useMemo(()=>{const d=[];for(const[_,F]of Object.entries(t)){if(!F.latitude||!F.longitude||F.latitude===0||F.longitude===0||!ee.has(_))continue;const Q=un(s,a,F.latitude,F.longitude),ne=dn(s,a,F.latitude,F.longitude),X=J.get(_);d.push({hash:_.slice(0,8),name:F.node_name||F.name||"Unknown",snr:(X==null?void 0:X.snr)??F.snr??null,rssi:(X==null?void 0:X.rssi)??F.rssi??null,bearing:Q,distance:ne,normalizedDistance:0,lastSeen:F.last_seen,isZeroHop:!0})}const A=(d.length>0?Math.max(...d.map(_=>_.distance)):0)*oe.DATA_HEADROOM;return d.sort((_,F)=>(_.snr??-1/0)-(F.snr??-1/0)),{processedNeighbors:d,maxDistance:A,totalNeighbors:d.length,zeroHopCount:d.length}},[t,s,a,ee,J]);c.useEffect(()=>{i==null||i({zeroHopCount:te,totalCount:K,maxDistanceKm:D})},[te,K,D]),c.useEffect(()=>{const d=cn[j],L=q.current;I.current&&cancelAnimationFrame(I.current);const A=performance.now(),_=F=>{const Y=F-A,Q=Math.min(Y/Ke.ZOOM_DURATION,1),ne=rs(Q),X=L+(d-L)*ne;R(X),Q<1?I.current=requestAnimationFrame(_):I.current=null};return I.current=requestAnimationFrame(_),()=>{I.current&&cancelAnimationFrame(I.current)}},[j]);const re=D/k,ae=c.useMemo(()=>pt.filter(d=>d<=re*1.1),[re]);c.useEffect(()=>{const d=[];for(const A of U){const _=z.current[A.hash];_!==void 0&&_!==A.lastSeen&&d.push(A.hash),z.current[A.hash]=A.lastSeen}if(d.length===0)return;queueMicrotask(()=>{h(A=>new Set([...A,...d]))});const L=setTimeout(()=>{h(A=>{const _=new Set(A);return d.forEach(F=>_.delete(F)),_})},Ke.BLINK_DURATION);return()=>clearTimeout(L)},[U]);const se=s!==0&&a!==0,le=c.useMemo(()=>{const{width:d,height:L}=w,A=d/2,_=L/2,F=Math.min(d,L),Y=Math.max(10,F/2-oe.PADDING),Q=Math.max(10,Y-oe.LABEL_INSET);return{width:d,height:L,centerX:A,centerY:_,radius:Q,labelRadius:Y}},[w]),{width:B,height:b,centerX:S,centerY:C,radius:P,labelRadius:Z}=le,de=c.useId(),pe=c.useCallback((d,L)=>{const A=d*Math.PI/180;return{x:S+P*L*Math.sin(A),y:C-P*L*Math.cos(A)}},[S,C,P]),fe=c.useCallback(d=>{const A={N:0,NE:45,E:90,SE:135,S:180,SW:225,W:270,NW:315}[d]*Math.PI/180;return{x:S+Z*Math.sin(A),y:C-Z*Math.cos(A)}},[S,C,Z]),_e=c.useCallback(d=>{p(d)},[]),Re=c.useCallback(d=>{y(d)},[]),Te=c.useCallback(d=>D<=0?0:d/D*k,[D,k]),De=d=>`${d}km`,Se=28,Ee=c.useMemo(()=>{const d=[{x:S,y:C-Z},{x:S+Z*Math.SQRT1_2,y:C-Z*Math.SQRT1_2}],L=ae.map(_=>{const F=_/D*k,Y=S+P*F*ft,Q=C-P*F*gt;return{km:_,scale:F,lx:Y,ly:Q}}).filter(_=>_.scale>=.02).sort((_,F)=>F.km-_.km),A=[];for(const _ of L){const F=A.some(Q=>{const ne=Q.lx-_.lx,X=Q.ly-_.ly;return Math.sqrt(ne*ne+X*X)<Se}),Y=d.some(Q=>{const ne=Q.x-_.lx,X=Q.y-_.ly;return Math.sqrt(ne*ne+X*X)<Se});!F&&!Y&&A.push(_)}return A},[ae,D,k,S,C,P,Z]),Le=w.width>0&&w.height>0;return se?K===0?e.jsxs("div",{ref:H,className:"flex flex-col items-center justify-center h-full text-fg-secondary",children:[e.jsx(ze,{className:"w-8 h-8 mb-2 opacity-50"}),e.jsx("p",{children:"No nodes with location data"})]}):e.jsxs("div",{className:"flex h-full w-full overflow-visible",children:[e.jsxs("div",{ref:H,className:"relative flex-1 min-w-0 h-full overflow-visible -ml-4 sm:-ml-5",children:[Le&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute depth-stroke-inset",style:{left:S-P-oe.LABEL_INSET-4,top:C-P-oe.LABEL_INSET-4,width:(P+oe.LABEL_INSET)*2+8,height:(P+oe.LABEL_INSET)*2+8,borderRadius:"50%",padding:4,boxSizing:"border-box",backgroundColor:f?"var(--zinc-925)":"var(--zinc-75)"}}),e.jsxs("svg",{width:B,height:b,className:"absolute inset-0 z-0",style:{overflow:"visible"},children:[e.jsxs("defs",{children:[e.jsx("style",{children:`
                @keyframes neighbor-blink-scale {
                  0%, 100% {
                    transform: scale(1);
                    opacity: 0;
                  }
                  50% {
                    transform: scale(1.3);
                    opacity: 0.8;
                  }
                }
                .neighbor-blink-ring {
                  transform-origin: center;
                  animation: neighbor-blink-scale ${Ke.BLINK_DURATION}ms ease-out forwards;
                }
              `}),e.jsx("clipPath",{id:de,children:e.jsx("circle",{cx:S,cy:C,r:P})})]}),(()=>{const d=P+oe.LABEL_INSET+12,L=f?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.15)",A=f?"rgba(59, 130, 246, 0.4)":"rgba(59, 130, 246, 0.5)",_=6,F=16,Y=4,Q=[0,90,180,270],ne=[45,135,225,315];return e.jsxs("g",{className:"radar-frame","aria-hidden":"true",children:[e.jsx("circle",{cx:S,cy:C,r:d,fill:"none",stroke:L,strokeWidth:1,strokeDasharray:"2 6"}),ne.map(X=>{const ie=X*Math.PI/180,ce=Math.cos(ie),me=Math.sin(ie),he=d+Y,M=d+Y+F,G=S+he*me,ge=C-he*ce,Ie=S+M*me,He=C-M*ce;return e.jsxs("g",{children:[e.jsx("line",{x1:G,y1:ge,x2:Ie,y2:He,stroke:A,strokeWidth:1}),e.jsx("line",{x1:Ie-4*ce,y1:He-4*me,x2:Ie+4*ce,y2:He+4*me,stroke:A,strokeWidth:1})]},`corner-${X}`)}),Q.map(X=>{const ie=X*Math.PI/180,ce=S+(d-_)*Math.sin(ie),me=C-(d-_)*Math.cos(ie),he=S+(d+2)*Math.sin(ie),M=C-(d+2)*Math.cos(ie);return e.jsx("line",{x1:ce,y1:me,x2:he,y2:M,stroke:L,strokeWidth:1},`tick-cardinal-${X}`)}),ne.map(X=>{const ie=X*Math.PI/180,ce=S+(d-4)*Math.sin(ie),me=C-(d-4)*Math.cos(ie),he=S+(d+1)*Math.sin(ie),M=C-(d+1)*Math.cos(ie);return e.jsx("line",{x1:ce,y1:me,x2:he,y2:M,stroke:L,strokeWidth:1},`tick-intercardinal-${X}`)})]})})(),(()=>{const d=P+oe.LABEL_INSET+4,L=[0,...pt.map(A=>{const _=Te(A);return _<=0?0:Math.min(P*_,d)}),d];return L.slice(0,-1).map((A,_)=>{const F=L[_+1],Y=F-A;return Y<.5||_%2!==0?null:e.jsx("circle",{cx:S,cy:C,r:(F+A)/2,fill:"none",stroke:"var(--subtle-fill)",strokeWidth:Y},`band-${_}`)})})(),ae.map(d=>{const L=Te(d);if(L<.02)return null;const A=Ee.some(Y=>Y.km===d),_=S+P*L*ft,F=C-P*L*gt;return e.jsx("g",{children:A&&e.jsx("text",{x:_+4,y:F-2,textAnchor:"start",dominantBaseline:"auto",fill:m.secondary,fontSize:10,fontFamily:Be,children:De(d)})},`ring-${d}`)}),["N","E","S","W"].map(d=>{const A={N:0,E:90,S:180,W:270}[d]*Math.PI/180;return e.jsx("line",{x1:S,y1:C,x2:S+P*Math.sin(A),y2:C-P*Math.cos(A),stroke:$,strokeOpacity:T,strokeWidth:1,strokeDasharray:"4 4"},d)}),["NE","SE","SW","NW"].map(d=>{const A={NE:45,SE:135,SW:225,NW:315}[d]*Math.PI/180;return e.jsx("line",{x1:S,y1:C,x2:S+P*Math.sin(A),y2:C-P*Math.cos(A),stroke:$,strokeOpacity:W,strokeWidth:1,strokeDasharray:"4 4"},`diag-${d}`)}),["N","E","S","W"].map(d=>{const L=fe(d),A=d==="E"?"end":d==="W"?"start":"middle",_=d==="N"?"hanging":d==="S"?"auto":"middle";return e.jsx("text",{x:L.x,y:L.y,textAnchor:A,dominantBaseline:_,fill:V,fontSize:oe.CARDINAL_FONT_SIZE,fontWeight:700,fontFamily:Be,"aria-hidden":"true",children:d},d)}),["NE","SE","SW","NW"].map(d=>{const L=fe(d),A=d==="NE"||d==="SE"?"end":"start",_=d==="NE"||d==="NW"?"hanging":"auto";return e.jsx("text",{x:L.x,y:L.y,textAnchor:A,dominantBaseline:_,fill:V,fontSize:oe.INTERCARDINAL_FONT_SIZE,fontWeight:600,fontFamily:Be,"aria-hidden":"true",children:d},d)}),e.jsx("circle",{cx:S,cy:C,r:oe.LOCAL_DOT_RADIUS,fill:N.chart6,stroke:f?"rgba(255,255,255,0.3)":"rgba(0,0,0,0.2)",strokeWidth:1,role:"img","aria-label":"Local node"}),e.jsx("g",{clipPath:`url(#${de})`,children:U.map(d=>{const L=D>0?d.distance/D*k:0;if(L>1)return null;const{x:A,y:_}=pe(d.bearing,L),F=d.snr!==null?bt(d.snr,O,E):"#808080",Y=(o==null?void 0:o.hash)===d.hash,Q=u.has(d.hash),ne=oe.DOT_RADIUS_HOVERED*1.5;return e.jsxs("g",{role:"img","aria-label":`${d.name}: ${d.distance.toFixed(1)}km ${d.bearing.toFixed(0)}°`,children:[Q&&e.jsx("circle",{cx:A,cy:_,r:ne,fill:"none",stroke:f?"rgba(255,255,255,0.9)":"rgba(0,0,0,0.7)",strokeWidth:2,className:"neighbor-blink-ring"}),Y&&e.jsx("circle",{cx:A,cy:_,r:ne,fill:F,opacity:.3}),e.jsx("circle",{cx:A,cy:_,r:Y?oe.DOT_RADIUS_HOVERED:oe.DOT_RADIUS,fill:F,stroke:f?"rgba(0,0,0,0.5)":"rgba(0,0,0,0.25)",strokeWidth:1,style:{cursor:"pointer",transition:"r 0.15s"},onMouseEnter:()=>_e(d),onMouseLeave:()=>_e(null)})]},d.hash)})})]})]}),o&&e.jsxs("div",{className:"absolute bg-tooltip-bg border border-edge-subtle rounded-lg px-3 py-2 text-sm pointer-events-none z-10 shadow-xl",style:{left:"50%",bottom:8,transform:"translateX(-50%)"},children:[e.jsx("div",{className:"font-medium text-fg-primary",children:o.name}),e.jsx("div",{className:"type-data-xs text-fg-secondary",children:o.hash}),o.snr!==null?e.jsx("div",{className:"flex gap-3 mt-1 text-xs",children:e.jsxs("span",{children:[e.jsx("span",{className:"text-fg-secondary",children:"SNR:"})," ",e.jsxs("span",{className:"tabular-nums",style:{color:bt(o.snr,O,E)},children:[o.snr.toFixed(1)," dB"]}),e.jsxs("span",{className:"text-fg-secondary ml-1",children:["(",xn(o.snr),")"]})]})}):e.jsx("div",{className:"text-xs text-fg-secondary mt-1",children:"No SNR data"}),e.jsxs("div",{className:"flex gap-3 text-xs",children:[e.jsxs("span",{children:[e.jsx("span",{className:"text-fg-secondary",children:"Distance:"})," ",e.jsxs("span",{className:"tabular-nums text-fg-primary",children:[o.distance.toFixed(2)," km"]})]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-fg-secondary",children:"Bearing:"})," ",e.jsxs("span",{className:"tabular-nums text-fg-primary",children:[o.bearing.toFixed(0),"°"]})]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-1 px-1.5 pt-4 sm:pt-5 pb-2 flex-shrink-0 depth-raised radius-inset self-stretch",style:{width:"calc(100% / 6)"},children:[r&&e.jsxs("div",{className:"flex flex-col items-start gap-1 pb-2 mb-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"icon-md flex items-center justify-center text-icon-card-title",children:e.jsx(ze,{className:"w-3.5 h-3.5"})}),l&&e.jsx(Fe,{color:"zinc",children:l})]}),e.jsx("span",{className:"type-micro text-left text-[10px] leading-tight px-1",children:r})]}),e.jsx("div",{className:"flex flex-col gap-1 flex-1",role:"group","aria-label":"Zoom level",children:["1x","2x","4x","8x","16x","36x"].map(d=>e.jsx("button",{onClick:()=>Re(d),"aria-pressed":j===d,className:`flex flex-1 items-center justify-center min-w-[44px] sm:min-w-[32px] text-xs font-medium radius-inner depth-stroke-raised transition-colors ${j===d?"bg-sys-blue/20 text-sys-blue":"bg-subtle-fill/80 text-fg-secondary hover:bg-subtle-fill-strong hover:text-fg-primary"}`,children:d},d))})]})]}):e.jsxs("div",{ref:H,className:"flex flex-col items-center justify-center h-full text-fg-secondary",children:[e.jsx(ze,{className:"w-8 h-8 mb-2 opacity-50"}),e.jsx("p",{children:"Local node coordinates not configured"}),e.jsx("p",{className:"text-xs mt-1",children:"Set latitude/longitude in config to enable"})]})}const fn=c.memo(pn),Ye={repeater:"var(--sys-blue)",companion:"var(--sys-cyan)",room_server:"var(--sys-indigo)"};function gn(t){if(t.contact_type){const n=t.contact_type.toLowerCase();if(n==="repeater"||n==="rep")return"repeater";if(n==="room server"||n==="room_server"||n==="room"||n==="server")return"room_server";if(n==="companion"||n==="client"||n==="cli")return"companion"}return t.is_repeater?"repeater":"companion"}function bn({neighbors:t}){const n=c.useMemo(()=>{const s={repeater:0,companion:0,room_server:0};for(const r of Object.values(t)){const l=gn(r);s[l]=(s[l]||0)+1}const a=Object.values(s).reduce((r,l)=>r+l,0);return{items:[{label:"Repeaters",count:s.repeater,percent:0,color:Ye.repeater},{label:"Companions",count:s.companion,percent:0,color:Ye.companion},{label:"Room Servers",count:s.room_server,percent:0,color:Ye.room_server}].map(r=>({...r,percent:a>0?r.count/a*100:0})).filter(r=>r.count>0).sort((r,l)=>l.count-r.count),total:a}},[t]);return n.total===0?e.jsx("div",{className:"h-full flex items-center justify-center text-fg-muted type-body-sm",children:"No neighbors discovered yet"}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex-1 flex flex-col justify-evenly",children:n.items.map(s=>e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"type-data-sm text-fg-secondary",children:s.label}),e.jsxs("span",{className:"type-data-sm text-fg-secondary tabular-nums",children:[s.count," ",e.jsxs("span",{className:"text-fg-secondary/60",children:["(",s.percent.toFixed(0),"%)"]})]})]}),e.jsx("div",{className:"h-2.5 bg-subtle-fill/80 overflow-hidden rounded-full depth-stroke-inset",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500 ease-out",style:{width:`${s.percent}%`,backgroundColor:s.color,minWidth:s.count>0?"4px":"0"}})})]},s.label))}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-edge-subtle",children:[e.jsx("span",{className:"type-data-xs text-fg-secondary",children:"Total Nodes"}),e.jsx("span",{className:"type-data-sm text-fg-primary font-medium tabular-nums",children:n.total})]})]})}const yn=c.memo(bn);function Xe({children:t,minHeight:n="100%",rootMargin:s="200px 0px",keepMounted:a=!0,className:i=""}){const r=c.useRef(null),[l,x]=c.useState(!1),[o,p]=c.useState(!1);c.useEffect(()=>{const h=r.current;if(!h)return;const w=new IntersectionObserver(([g])=>{const j=g.isIntersecting;p(j),j&&x(!0)},{rootMargin:s,threshold:0});return w.observe(h),()=>{w.disconnect()}},[s]);const u=o||a&&l;return e.jsx("div",{ref:r,className:`h-full w-full ${i}`,style:{minHeight:n},children:u?t:e.jsx("div",{className:"h-full w-full flex items-center justify-center text-fg-muted/50",children:e.jsx("div",{className:"animate-pulse text-xs",children:"Loading chart..."})})})}const wt=[{target:"DisambiguationCard",fn:"disambiguation.collisions",minStage:2}];tt(wt);const jn=.9,Nn=.7,vn=.5,kn=10,Sn=25,Pe={excellent:"text-signal-excellent",good:"text-signal-good",fair:"text-signal-fair",poor:"text-sys-blue"},wn={excellent:"bg-signal-excellent/10",good:"bg-signal-good/10",fair:"bg-signal-fair/10",poor:"bg-sys-blue/10"};function Mn(t){return t>=jn?"excellent":t>=Nn?"good":t>=vn?"fair":"poor"}function Cn(t){return t<=kn?"excellent":t<=Sn?"good":"poor"}function An(){et(wt);const t=Bt(),n=$t(),[s,a]=c.useState(null),i=c.useCallback((u,h)=>{a({prefix:u,candidateHashes:h})},[]),r=c.useCallback(()=>{a(null)},[]);if(!n)return e.jsxs(ue,{neomorphic:!0,children:[e.jsx(Ne,{icon:e.jsx(rt,{}),title:"Prefix Conflicts"}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-fg-secondary",children:[e.jsx(zt,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"type-data-xs",children:"No topology data available"}),e.jsx("p",{className:"type-data-xs opacity-70",children:"Run deep analysis to see stats"})]})})]});const l=Mn(t.avgConfidence),x=Cn(t.collisionRate),o=l==="poor"||x==="poor"?"poor":l==="fair"||x==="fair"?"fair":l==="good"||x==="good"?"good":"excellent",p=o==="excellent"||o==="good"?it:Ze;return e.jsxs(ue,{neomorphic:!0,className:"flex flex-col overflow-hidden",children:[e.jsx(Ne,{icon:e.jsx(rt,{}),title:"Prefix Conflicts",badgeColor:"zinc",actions:o==="poor"?e.jsxs(Fe,{color:"red",children:[e.jsx(Ze,{className:"w-3 h-3"}),"Needs Attention"]}):e.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1 rounded-full ${wn[o]}`,children:[e.jsx(p,{className:`w-3.5 h-3.5 ${Pe[o]}`}),e.jsx("span",{className:`type-data-xs font-medium ${Pe[o]}`,children:o==="excellent"?"Excellent":o==="good"?"Good":"Fair"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex-1 flex flex-col radius-inner depth-stroke-inset px-3 py-2.5 sm:py-3 cursor-help",title:"Total unique 2-character prefixes observed in packet paths.",children:[e.jsx("span",{className:"type-data-xl text-fg-primary",children:e.jsx(Oe,{value:t.totalPrefixes,priority:"low"})}),e.jsx("span",{className:"type-micro text-fg-muted mt-0.5 sm:mt-1",children:"Prefixes"})]}),e.jsxs("div",{className:"flex-1 flex flex-col radius-inner depth-stroke-inset px-3 py-2.5 sm:py-3 cursor-help",title:"Prefixes that map to exactly one known node. No disambiguation needed.",children:[e.jsx("span",{className:"type-data-xl text-fg-primary",children:e.jsx(Oe,{value:t.unambiguousPrefixes,priority:"low"})}),e.jsx("span",{className:"type-micro text-fg-muted mt-0.5 sm:mt-1",children:"Unique"})]}),e.jsxs("div",{className:"flex-1 flex flex-col radius-inner depth-stroke-inset px-3 py-2.5 sm:py-3 cursor-help",title:"Prefixes matching multiple known nodes. Click a prefix below to explore candidates.",children:[e.jsx("span",{className:`type-data-xl ${t.collisionPrefixes>0?"text-sys-blue":"text-fg-primary"}`,children:e.jsx(Oe,{value:t.collisionPrefixes,priority:"low"})}),e.jsx("span",{className:`type-micro mt-0.5 sm:mt-1 ${t.collisionPrefixes>0?"text-sys-blue":"text-fg-muted"}`,children:"Conflicts"})]})]}),t.highCollisionPrefixes.length>0&&e.jsxs("div",{className:"pt-3",children:[e.jsx("div",{className:"data-box-label",children:"Problem Prefixes"}),e.jsx("div",{className:"flex flex-wrap gap-1.5 content-start",children:t.highCollisionPrefixes.map(({prefix:u,candidateCount:h,candidateHashes:w})=>e.jsxs("button",{type:"button",onClick:()=>i(u,w),className:"inline-flex items-center gap-0.5 group",title:`${h} candidates - click to explore`,children:[e.jsx(ms,{children:u}),e.jsxs("span",{className:"text-fg-muted type-data-xs group-hover:text-fg-secondary transition-colors",children:["×",h]})]},u))})]}),t.lowConfidencePrefixes.length===0&&t.collisionPrefixes===0&&e.jsx("div",{className:"flex-1 flex items-center",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(it,{className:"w-3.5 h-3.5 text-signal-excellent"}),e.jsx("span",{className:"type-data-xs text-signal-excellent",children:"All prefixes uniquely identified"})]})}),e.jsxs("div",{className:"flex gap-2 sm:gap-3 mt-auto pt-3",children:[e.jsxs("div",{className:"flex-1 min-w-0 cursor-help",title:"Average confidence score across all disambiguated prefixes. Higher = more certain node identification.",children:[e.jsx("div",{className:"data-box-label",children:"Confidence"}),e.jsxs("div",{className:`data-box data-box-fill data-box-left ${Pe[l]}`,children:[(t.avgConfidence*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex-1 min-w-0 cursor-help",title:"Percentage of 2-character prefixes that match multiple known nodes. Lower is better.",children:[e.jsx("div",{className:"data-box-label",children:"Collisions"}),e.jsxs("div",{className:`data-box data-box-fill data-box-left ${Pe[x]}`,children:[t.collisionRate.toFixed(1),"%"]})]})]})]}),e.jsx(us,{isOpen:!!s,prefix:(s==null?void 0:s.prefix)||"",candidateHashes:(s==null?void 0:s.candidateHashes)||[],onClose:r})]})}const Mt=[{target:"PacketHealth",fn:"type",minStage:1},{target:"PacketHealth",fn:"duplicates",minStage:1}];tt(Mt);const _n=new Set(["Duplicate","Empty payload","Path too long","Unknown"]),Me=24;function Rn(t,n){const s=Date.now()/1e3,a=n*60,i=s-a,r=a/Me,l=new Array(Me).fill(0),x=new Array(Me).fill(0);let o=0,p=0,u=0,h=0;for(const g of t){if(g.packet_origin==="tx_local")continue;const j=g.timestamp;if(j<i||j>s)continue;o++;const y=Math.min(Me-1,Math.floor((j-i)/r));x[y]++,g.transmitted||g.packet_origin==="tx_forward"?(p++,l[y]++):(g.is_duplicate||g.drop_reason==="Duplicate")&&u++,g.drop_reason&&_n.has(g.drop_reason)&&h++}const w=[];for(let g=0;g<Me;g++){const j=x[g],y=l[g];w.push({count:j>0?Math.round(y/j*100):0,timestamp:(i+g*r)*1e3})}return{totalRx:o,forwarded:p,duplicates:u,waste:h,efficiency:o>0?p/o*100:0,duplicateRate:o>0?u/o*100:0,wasteRate:o>0?h/o*100:0,sparkline:w}}function Tn(t){return t>=90?"excellent":t>=75?"good":t>=60?"fair":"poor"}const Dn={excellent:"bg-status-success",good:"bg-sys-blue",fair:"bg-status-warning",poor:"bg-status-danger"};function En({packets:t,rangeMinutes:n,rangeHours:s,timeRangeLabel:a,isLoaded:i=!0}){et(Mt);const r=c.useMemo(()=>Rn(t,n),[t,n]),[l,x]=c.useState(null),o=c.useCallback(async()=>{try{const h=await Wt(s);h.success&&h.data&&x(h.data.count)}catch{}},[s]);c.useEffect(()=>{o()},[o]);const p=Tn(r.efficiency),u=r.totalRx>0;return e.jsx(ue,{neomorphic:!0,isLoaded:i,skeletonType:"chart",children:i&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{icon:e.jsx(hs,{}),title:"Packet Health",badge:a,badgeColor:"zinc"}),e.jsx(Ut,{children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("div",{className:"type-data-xl text-fg-primary",children:[u?e.jsx(Oe,{value:Math.round(r.efficiency*10)/10,className:"font-mono tabular-nums",priority:"medium",format:{minimumFractionDigits:1,maximumFractionDigits:1}}):e.jsx("span",{className:"opacity-30",children:"—"}),e.jsx("span",{className:"type-data-sm text-fg-muted ml-0.5",children:"%"})]}),u&&e.jsx("div",{className:`w-2 h-2 rounded-full ${Dn[p]}`})]}),e.jsx("div",{className:"type-micro mb-2 cursor-help",title:"Forwarded packets / total received. CRC failures, garbled packets, and RF collisions that destroy packets before reaching software are not included in this ratio — see CRC Errors for hardware-level failures.",children:"FORWARDING RATE"}),e.jsx("div",{className:"flex-1 min-h-[28px] max-h-[48px] mb-2",children:e.jsx(ds,{data:r.sparkline,width:9999,height:36,color:"var(--sys-blue)",className:"w-full"})}),e.jsxs("div",{className:"flex gap-2 sm:gap-3 mt-auto",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"data-box-label",children:"Dupes"}),e.jsx("div",{className:"data-box data-box-fill data-box-left",children:u?`${r.duplicateRate.toFixed(1)}%`:"—"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"data-box-label",children:"Waste"}),e.jsx("div",{className:"data-box data-box-fill data-box-left",children:u?`${r.wasteRate.toFixed(1)}%`:"—"})]}),l!==null&&l>0&&e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"data-box-label flex items-center gap-1",children:[e.jsx(Ze,{className:"w-3 h-3 text-status-warning"}),"CRC"]}),e.jsx("div",{className:"data-box data-box-fill data-box-left text-status-warning",children:l})]})]})]})})]})})}function la(){var De,Se,Ee,Le,d,L,A,_,F,Y,Q,ne,X,ie,ce,me,he;const t=Gt(),n=Vt(),s=qt(),a=Kt(),i=Yt(),r=Xt(),l=t!==null&&i,x=c.useRef(!1);l&&!x.current&&(x.current=!0);const o=x.current,p=Zt(),u=Qt(),h=Jt(),[w,g]=c.useState(null),[,j]=c.useState(null),[y]=c.useState(null),[k,R]=c.useState(()=>{const M=localStorage.getItem("statistics-view-mode");return M==="share"||M==="airtime"?M:"airtime"});c.useEffect(()=>{localStorage.setItem("statistics-view-mode",k)},[k]);const[I,z]=c.useState(()=>{const M=localStorage.getItem("statistics-smoothing-mode");return["ema","ultra","mosaic","stats","trend"].includes(M)?M:"stats"});c.useEffect(()=>{localStorage.setItem("statistics-smoothing-mode",I)},[I]);const[H,q]=c.useState(!1),[O,N]=c.useState(!1),[m,f]=c.useState(Nt),[v,E]=c.useState(.5),[$,T]=c.useState(xs),[W,V]=c.useState(.8),[ee,J]=c.useState(50),U=c.useMemo(()=>({0:0,1:0,2:1,3:2,4:3,5:4,6:5,7:6,8:7,9:8,10:9})[p]??3,[p]),D=$e[U].hours,K=D*60,te=$e[U],re=at(D),ae=r.isBackgroundLoading,se=c.useCallback(M=>{const ge={0:1,1:2,2:3,3:4,4:5,5:6,6:7,7:8,8:9,9:10}[M]??4;u(ge)},[u]),le=c.useMemo(()=>{var G;if(!((G=t==null?void 0:t.config)!=null&&G.radio))return null;const M=t.config.radio;return{sf:M.spreading_factor??10,bw:M.bandwidth??25e4,cr:M.coding_rate??5,preamble:M.preamble_length??8}},[(Se=(De=t==null?void 0:t.config)==null?void 0:De.radio)==null?void 0:Se.spreading_factor,(Le=(Ee=t==null?void 0:t.config)==null?void 0:Ee.radio)==null?void 0:Le.bandwidth,(L=(d=t==null?void 0:t.config)==null?void 0:d.radio)==null?void 0:L.coding_rate,(_=(A=t==null?void 0:t.config)==null?void 0:A.radio)==null?void 0:_.preamble_length]),B=c.useMemo(()=>h.length===0?{timestamps:[],values:[]}:{timestamps:h.map(M=>M.timestamp),values:h.map(M=>M.noise_floor_dbm)},[h]),b=c.useMemo(()=>{if(h.length<10)return{anomalies:[],debug:void 0};const M=_s(h,m);return{anomalies:M.anomalies,debug:M.debug}},[h,m]),S=b.anomalies,C=c.useMemo(()=>{const M=(t==null?void 0:t.neighbors)??{};return Object.fromEntries(Object.entries(M).filter(([G])=>!n.has(G)))},[t==null?void 0:t.neighbors,n]),P=c.useMemo(()=>{const M=Date.now()/1e3-D*3600;return Object.fromEntries(Object.entries(C).filter(([,G])=>G.last_seen>=M))},[C,D]),Z=c.useMemo(()=>{const M=K*60/re,G=Math.floor(Date.now()/1e3),ge=Math.floor(G/M)*M;return{start:ge-K*60,end:ge}},[K,re]),de=$.timeStart??Z.start,pe=$.timeEnd??Z.end,fe=(pe-de)/3600,_e=at(fe),Re=gs(),Te=c.useMemo(()=>ps(a,$,Re,Z),[a,$,Re,Z]);return e.jsxs(os,{children:[e.jsx(ls,{title:"Statistics",icon:e.jsx(es,{}),controls:e.jsx(is,{ranges:$e,selectedIndex:U,onSelect:se,isPending:ae})}),y&&e.jsx(ue,{className:"border border-sys-red/50 bg-sys-red/10",children:e.jsx("p",{className:"text-sys-red",children:y})}),H&&O&&e.jsxs(ue,{className:"border border-sys-indigo/30 bg-surface/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"type-label",children:"Anomaly Detection Tuning"}),e.jsxs("span",{className:"type-data-xs text-fg-muted",children:["(",te.label,")"]})]}),e.jsx("button",{onClick:()=>f(M=>({...M,useAbsoluteThresholds:!M.useAbsoluteThresholds})),className:`type-data-xs px-2 py-1 rounded transition-colors ${m.useAbsoluteThresholds?"bg-sys-indigo/30 text-sys-indigo":"bg-elevated text-fg-muted hover:text-fg-secondary"}`,children:m.useAbsoluteThresholds?"Absolute dBm":"Percentile"})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"type-micro",children:"Baseline"}),e.jsxs("span",{className:"ml-2 type-data-sm text-status-warning",children:[((Y=(F=b.debug)==null?void 0:F.baselineCutoff)==null?void 0:Y.toFixed(1))??"—"," dBm"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"type-micro",children:"Spike"}),e.jsxs("span",{className:"ml-2 type-data-sm text-status-warning",children:[((ne=(Q=b.debug)==null?void 0:Q.spikeCutoff)==null?void 0:ne.toFixed(1))??"—"," dBm"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"type-micro",children:"Mid-band"}),e.jsx("span",{className:"ml-2 type-data-sm text-sys-indigo",children:((X=b.debug)==null?void 0:X.midBandSamples)??0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"type-micro",children:"Anomalies"}),e.jsx("span",{className:"ml-2 type-data-sm text-status-danger",children:S.length})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-edge-subtle space-y-4",children:[m.useAbsoluteThresholds?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Baseline (",m.baselineDbm," dBm)"]}),e.jsx("input",{type:"range",min:"-120",max:"-60",value:m.baselineDbm,onChange:M=>f(G=>({...G,baselineDbm:Number(M.target.value)})),className:"w-full accent-sys-indigo"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Spike (",m.spikeDbm," dBm)"]}),e.jsx("input",{type:"range",min:"-100",max:"-20",value:m.spikeDbm,onChange:M=>f(G=>({...G,spikeDbm:Number(M.target.value)})),className:"w-full accent-sys-indigo"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Merge Gap (",m.mergeGapSeconds,"s)"]}),e.jsx("input",{type:"range",min:"5",max:"120",step:"5",value:m.mergeGapSeconds,onChange:M=>f(G=>({...G,mergeGapSeconds:Number(M.target.value)})),className:"w-full accent-sys-indigo"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Min Sequence (",m.minSequenceLength,")"]}),e.jsx("input",{type:"range",min:"2",max:"20",value:m.minSequenceLength,onChange:M=>f(G=>({...G,minSequenceLength:Number(M.target.value)})),className:"w-full accent-sys-indigo"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Similarity (±",m.similarityToleranceDbm," dBm)"]}),e.jsx("input",{type:"range",min:"1",max:"15",value:m.similarityToleranceDbm,onChange:M=>f(G=>({...G,similarityToleranceDbm:Number(M.target.value)})),className:"w-full accent-sys-indigo"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Opacity (",Math.round(v*100),"%)"]}),e.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.05",value:v,onChange:M=>E(Number(M.target.value)),className:"w-full accent-sys-indigo"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Baseline (P",m.baselinePercentile,")"]}),e.jsx("input",{type:"range",min:"1",max:"50",value:m.baselinePercentile,onChange:M=>f(G=>({...G,baselinePercentile:Number(M.target.value)})),className:"w-full accent-sys-indigo"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Spike (P",m.spikePercentile,")"]}),e.jsx("input",{type:"range",min:"50",max:"99",value:m.spikePercentile,onChange:M=>f(G=>({...G,spikePercentile:Number(M.target.value)})),className:"w-full accent-sys-indigo"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Merge Gap (",m.mergeGapSeconds,"s)"]}),e.jsx("input",{type:"range",min:"5",max:"120",step:"5",value:m.mergeGapSeconds,onChange:M=>f(G=>({...G,mergeGapSeconds:Number(M.target.value)})),className:"w-full accent-sys-indigo"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Min Sequence (",m.minSequenceLength,")"]}),e.jsx("input",{type:"range",min:"2",max:"20",value:m.minSequenceLength,onChange:M=>f(G=>({...G,minSequenceLength:Number(M.target.value)})),className:"w-full accent-sys-indigo"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Similarity (±",m.similarityToleranceDbm," dBm)"]}),e.jsx("input",{type:"range",min:"1",max:"15",value:m.similarityToleranceDbm,onChange:M=>f(G=>({...G,similarityToleranceDbm:Number(M.target.value)})),className:"w-full accent-sys-indigo"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"type-micro block mb-1",children:["Opacity (",Math.round(v*100),"%)"]}),e.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.05",value:v,onChange:M=>E(Number(M.target.value)),className:"w-full accent-sys-indigo"})]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-elevated radius-inner",children:[e.jsx("div",{className:"type-micro mb-1",children:"Config output"}),e.jsxs("div",{className:"type-data-sm text-status-success",children:[m.useAbsoluteThresholds?`useAbsoluteThresholds: true, baselineDbm: ${m.baselineDbm}, spikeDbm: ${m.spikeDbm}`:`useAbsoluteThresholds: false, baselinePercentile: ${m.baselinePercentile}, spikePercentile: ${m.spikePercentile}`,", mergeGapSeconds: ",m.mergeGapSeconds,", minSequenceLength: ",m.minSequenceLength,", similarityToleranceDbm: ",m.similarityToleranceDbm]})]})]})]}),e.jsxs(cs,{ready:o,children:[e.jsx("div",{className:"sm:hidden",children:ae&&e.jsx(be,{template:"auto",children:e.jsx(ue,{className:"border border-sys-blue/30 bg-sys-blue/5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-sys-blue opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-sys-blue"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"type-body-sm text-fg-primary",children:["Loading ",te.label," data..."]}),r.loadProgress&&e.jsxs("p",{className:"type-data-xs text-fg-muted mt-0.5",children:[r.loadProgress.loaded.toLocaleString()," packets (",r.loadProgress.percent,"%)"]})]})]})})})}),e.jsxs(e.Fragment,{children:[e.jsx(be,{template:"hero-auto",children:e.jsx(ue,{neomorphic:!0,skeletonType:"chart",children:o&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{icon:e.jsx(ve,{}),title:"Packet Analyzer",badge:te.label,badgeColor:"zinc",stackActionsOnMobile:!0,actions:e.jsxs("div",{className:"flex flex-wrap items-center gap-2 justify-end",children:[I==="stats"&&e.jsx(qs,{enabled:H,onChange:q,anomalyCount:S.length,showTuning:O,onTuningChange:N}),e.jsx(Vs,{smoothing:I,onChange:z}),e.jsx(Gs,{mode:k,onChange:R})]})}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(ln,{packets:Te,allPackets:a,startTs:de,endTs:pe,parentStartTs:Z.start,parentEndTs:Z.end,bucketCount:_e,radioConfig:le??void 0,mode:k,smoothing:I,noiseFloorAnomalies:S,showNoiseFloorOverlay:H,overlayOpacity:v,dotSize:W,dotOpacity:ee/100})})]})})}),e.jsx(be,{template:"auto",className:"relative z-10",children:e.jsx(ue,{neomorphic:!0,noPadding:!0,className:"overflow-visible",children:o&&e.jsx(fs,{parentStartTs:Z.start,parentEndTs:Z.end,neighbors:C,filter:$,onChange:T,...I==="stats"?{scatterDotSize:W,onScatterDotSizeChange:V,scatterOpacity:ee,onScatterOpacityChange:J}:{}})})}),e.jsxs(be,{template:"panel",children:[e.jsx(we,{span:12,md:6,children:e.jsx(ue,{neomorphic:!1,skeletonType:"chart",noPadding:o,className:"!bg-transparent !ring-0 !shadow-none !overflow-visible -mx-4 sm:mx-0 !px-0 !pr-0",children:o&&e.jsx(Xe,{children:e.jsx(fn,{neighbors:P,quickNeighbors:s,localLat:((ce=(ie=t==null?void 0:t.config)==null?void 0:ie.repeater)==null?void 0:ce.latitude)??0,localLon:((he=(me=t==null?void 0:t.config)==null?void 0:me.repeater)==null?void 0:he.longitude)??0,onStatsChange:j,title:"Link Quality",badge:te.label})})})}),e.jsx(we,{span:12,md:6,children:e.jsx(ue,{neomorphic:!0,skeletonType:"chart",children:o&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{icon:e.jsx(ys,{}),title:"Network Composition",badge:te.label,badgeColor:"zinc"}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(Xe,{children:e.jsx(yn,{neighbors:P})})})]})})})]}),e.jsxs(be,{template:"panel",children:[e.jsx(we,{span:12,md:6,children:e.jsx(An,{})}),e.jsx(we,{span:12,md:6,children:e.jsx(En,{packets:a,rangeMinutes:K,rangeHours:D,timeRangeLabel:te.label})})]}),e.jsx(be,{template:"panel",children:e.jsx(we,{span:12,children:e.jsx(ue,{neomorphic:!0,skeletonType:"chart",children:o&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{icon:e.jsx(ts,{}),title:"NOISE FLOOR dBm",stackActionsOnMobile:!0,actions:w?e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("span",{className:"type-data-xs text-fg-muted whitespace-nowrap",children:["min ",e.jsx("span",{className:"data-box",children:w.min.toFixed(0)})]}),e.jsxs("span",{className:"type-data-xs text-fg-muted whitespace-nowrap",children:["avg ",e.jsx("span",{className:"data-box",children:w.avg.toFixed(0)})]}),e.jsxs("span",{className:"type-data-xs text-fg-muted whitespace-nowrap",children:["max ",e.jsx("span",{className:"data-box",children:w.max.toFixed(0)})]})]}):null}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(Xe,{children:e.jsx(ss,{timestamps:B.timestamps,values:B.values,onStatsChange:g})})})]})})})})]})]})]})}export{la as default};
