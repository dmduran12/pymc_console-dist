import{c as e,ad as t,ae as s,af as a,j as l,H as r,ag as n,X as i,A as c,ah as d,ai as o,R as x,aj as u,ab as m}from"./index-Bcoy3A07.js";import{b as p,c as b}from"./recharts-bmHCCfxU.js";import{H as h}from"./HashBadge-ClXKFeFg.js";import{P as g,a as v,C as j,b as y}from"./PageLayout-Cdzbj79W.js";import{R as f,C as N}from"./Grid-Dw0K_vCr.js";import{L as k}from"./loader-circle-CV8NBPoZ.js";import{a as w,M as _}from"./map-pin-Jv_eYJxL.js";import"./maplibre-gl-CFO9X1Ek.js";const C=e("antenna",[["path",{d:"M2 12 7 2",key:"117k30"}],["path",{d:"m7 12 5-10",key:"1tvx22"}],["path",{d:"m12 12 5-10",key:"ev1o1a"}],["path",{d:"m17 12 5-10",key:"1e4ti3"}],["path",{d:"M4.5 7h15",key:"vlsxkz"}],["path",{d:"M12 16v6",key:"c8a4gj"}]]),L=e("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),S=p.memo(function(){var e;const{theme:r,setThemePreset:n,setBrightness:i}=t(),{backgroundImage:c,brightness:d}=r,[o,x]=p.useState(!1),[u,m]=p.useState(!1),h=p.useRef(null),g=p.useRef(null),v=(null==(e=s.find(e=>e.backgroundImage===c))?void 0:e.id)??"default",j=p.useCallback((e,t)=>{if(!g.current)return d;const s=(g.current.y-e)/(t?200:80)*100;return Math.round(Math.max(0,Math.min(100,g.current.brightness+s)))},[d]),y=p.useCallback(e=>{n(e),x(!0)},[n]),f=p.useCallback(e=>{i(e)},[i]),N=p.useCallback(e=>{const t=s.find(t=>t.id===e);t&&a(t.backgroundImage)},[]);return l.jsx("div",{className:"flex gap-2 items-center flex-shrink-0",children:s.map(e=>{const t=v===e.id,s=t&&(o||u);return l.jsxs("div",{ref:t?h:void 0,className:b("relative rounded-md overflow-hidden transition-all duration-300 ease-out","ring-offset-1 ring-offset-bg-body w-10 h-10",t?"ring-2 ring-accent-primary scale-105 cursor-ns-resize":"ring-1 ring-white/20 hover:ring-white/40 opacity-70 hover:opacity-100 cursor-pointer"),onMouseEnter:()=>{t?x(!0):N(e.id)},onMouseLeave:()=>!u&&x(!1),onClick:()=>!t&&y(e.id),onTouchStart:e=>{if(!t)return;e.preventDefault();const s=e.touches[0];g.current={y:s.clientY,brightness:d},m(!0),x(!0);const a=e=>{e.preventDefault();const t=e.touches[0];f(j(t.clientY,!0))},l=()=>{document.removeEventListener("touchmove",a),document.removeEventListener("touchend",l),g.current=null,m(!1),setTimeout(()=>x(!1),1500)};document.addEventListener("touchmove",a,{passive:!1}),document.addEventListener("touchend",l)},onMouseDown:e=>{if(!t)return;e.preventDefault(),g.current={y:e.clientY,brightness:d},m(!0),x(!0);const s=e=>{f(j(e.clientY,!1))},a=()=>{document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",a),g.current=null,m(!1)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",a)},children:[l.jsx("div",{className:"absolute bg-cover bg-center transition-opacity duration-200",style:{inset:0,backgroundImage:`url(${e.backgroundImage})`,opacity:s?.4:1}}),t&&l.jsxs("div",{className:b("absolute inset-0 transition-opacity duration-200",s?"opacity-100":"opacity-0"),children:[l.jsx("div",{className:"absolute inset-x-0 bottom-0 bg-black/70 transition-all duration-100 ease-out",style:{height:100-d+"%"}}),l.jsx("div",{className:"absolute inset-x-1 h-0.5 bg-white rounded-full shadow-lg transition-all duration-100 ease-out",style:{top:100-d+"%"}}),l.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:l.jsxs("span",{className:"text-[10px] font-mono font-bold text-white drop-shadow-lg",children:[d,"%"]})})]})]},e.id)})})}),M=[{value:7.8,label:"7.8 kHz"},{value:10.4,label:"10.4 kHz"},{value:15.6,label:"15.6 kHz"},{value:20.8,label:"20.8 kHz"},{value:31.25,label:"31.25 kHz"},{value:41.7,label:"41.7 kHz"},{value:62.5,label:"62.5 kHz"},{value:125,label:"125 kHz"},{value:250,label:"250 kHz"},{value:500,label:"500 kHz"}],z=[5,6,7,8,9,10,11,12],E=[{value:5,label:"4/5"},{value:6,label:"4/6"},{value:7,label:"4/7"},{value:8,label:"4/8"}];function F(){var e,t,s,a;const{stats:F,setMode:H,setDutyCycle:I,fetchStats:T}=r(),q=null==(e=null==F?void 0:F.config)?void 0:e.radio,D=null==(t=null==F?void 0:F.config)?void 0:t.repeater,R=null==(s=null==F?void 0:F.config)?void 0:s.duty_cycle,P=(null==F?void 0:F.node_name)||(null==(a=null==F?void 0:F.config)?void 0:a.node_name)||"Unknown Node",B=(null==D?void 0:D.mode)??"forward",A=(null==R?void 0:R.enforcement_enabled)??!1,[Y,$]=p.useState(!1),[X,O]=p.useState(""),[U,V]=p.useState(62.5),[G,K]=p.useState(7),[J,Q]=p.useState(5),[W,Z]=p.useState(""),[ee,te]=p.useState(!1),[se,ae]=p.useState(null),le=p.useRef(null);p.useEffect(()=>{q&&Y&&(O((q.frequency/1e6).toFixed(3)),V(q.bandwidth/1e3),K(q.spreading_factor),Q(q.coding_rate),Z(String(q.tx_power)))},[q,Y]);const re=p.useMemo(()=>{if(!q||!Y)return!1;const e=q.frequency/1e6,t=q.bandwidth/1e3,s=parseFloat(X)||0;return Math.abs(s-e)>1e-4||U!==t||G!==q.spreading_factor||J!==q.coding_rate||parseInt(W)!==q.tx_power},[q,Y,X,U,G,J,W]),ne=p.useCallback(()=>{$(!1),ae(null),q&&(O((q.frequency/1e6).toFixed(3)),V(q.bandwidth/1e3),K(q.spreading_factor),Q(q.coding_rate),Z(String(q.tx_power)))},[q]);return p.useEffect(()=>{if(!Y)return;const e=e=>{le.current&&!le.current.contains(e.target)&&ne()};return document.addEventListener("mouseup",e),()=>{document.removeEventListener("mouseup",e)}},[Y,ne]),l.jsxs(g,{children:[l.jsx(v,{title:"Settings",icon:l.jsx(n,{}),controls:l.jsx(S,{})}),l.jsxs(f,{template:"standard",children:[l.jsx(N,{span:12,md:6,children:l.jsx(j,{children:l.jsxs("div",{ref:le,children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("h2",{className:"type-subheading text-text-primary flex items-center gap-2",children:[l.jsx(C,{className:"icon-md text-accent-primary"}),"Radio Configuration"]}),l.jsx("div",{className:"flex items-center gap-1",children:q&&(Y?l.jsxs(l.Fragment,{children:[l.jsx("button",{onClick:ne,disabled:ee,className:b("p-2 rounded-lg transition-colors",ee?"text-text-muted cursor-not-allowed":"text-text-muted hover:text-accent-danger hover:bg-accent-danger/10"),title:"Cancel",children:l.jsx(i,{className:"w-4 h-4"})}),l.jsx("button",{onClick:async()=>{te(!0),ae(null);try{const e={},t=parseFloat(X),s=q?q.frequency/1e6:0;Math.abs(t-s)>1e-4&&(e.frequency_mhz=t);const a=q?q.bandwidth/1e3:0;U!==a&&(e.bandwidth_khz=U),G!==(null==q?void 0:q.spreading_factor)&&(e.spreading_factor=G),J!==(null==q?void 0:q.coding_rate)&&(e.coding_rate=J);const l=parseInt(W);if(l!==(null==q?void 0:q.tx_power)&&(e.tx_power=l),0===Object.keys(e).length)return ae({success:!0,message:"No changes to save"}),void te(!1);const r=await m(e);if(r.success&&r.data){const e=r.data.applied.join(", "),t=r.data.live_update?" (applied live)":" (restart required)";ae({success:!0,message:`Updated: ${e}${t}`}),T(),setTimeout(()=>{$(!1),ae(null)},1500)}else ae({success:!1,message:r.error||"Failed to save"})}catch(e){ae({success:!1,message:String(e)})}finally{te(!1)}},disabled:ee||!re,className:b("p-2 rounded-lg transition-colors",ee?"text-accent-primary cursor-wait":re?"text-accent-success hover:bg-accent-success/10":"text-text-muted cursor-not-allowed"),title:re?"Save changes":"No changes to save",children:ee?l.jsx(k,{className:"w-4 h-4 animate-spin"}):l.jsx(w,{className:"w-4 h-4"})})]}):l.jsx("button",{onClick:()=>{q&&(O((q.frequency/1e6).toFixed(3)),V(q.bandwidth/1e3),K(q.spreading_factor),Q(q.coding_rate),Z(String(q.tx_power))),ae(null),$(!0)},className:"p-2 rounded-lg transition-colors text-text-muted hover:text-text-primary hover:bg-bg-subtle",title:"Edit radio settings",children:l.jsx(L,{className:"w-4 h-4"})}))})]}),se&&l.jsx("div",{className:b("text-xs mb-3 px-2 py-1.5 rounded-md",se.success?"text-accent-success bg-accent-success/10":"text-accent-danger bg-accent-danger/10"),children:se.message}),q?Y?l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Frequency (MHz)"}),l.jsx("input",{type:"number",value:X,onChange:e=>O(e.target.value),step:"0.001",min:"400",max:"930",className:"w-full h-[38px] bg-bg-subtle border border-border-subtle rounded-lg px-3 py-2 text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary/50"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"type-label text-text-muted block mb-1",children:"TX Power (dBm)"}),l.jsx("input",{type:"number",value:W,onChange:e=>Z(e.target.value),min:"-9",max:"22",className:"w-full h-[38px] bg-bg-subtle border border-border-subtle rounded-lg px-3 py-2 text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary/50"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Bandwidth"}),l.jsxs("div",{className:"relative",children:[l.jsx("select",{value:U,onChange:e=>V(parseFloat(e.target.value)),className:"w-full h-[38px] bg-bg-subtle border border-border-subtle rounded-lg px-3 pr-8 py-2 text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary/50 appearance-none cursor-pointer",children:M.map(e=>l.jsx("option",{value:e.value,children:e.label},e.value))}),l.jsx(c,{className:"absolute right-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Spreading Factor"}),l.jsxs("div",{className:"relative",children:[l.jsx("select",{value:G,onChange:e=>K(parseInt(e.target.value)),className:"w-full h-[38px] bg-bg-subtle border border-border-subtle rounded-lg px-3 pr-8 py-2 text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary/50 appearance-none cursor-pointer",children:z.map(e=>l.jsxs("option",{value:e,children:["SF",e]},e))}),l.jsx(c,{className:"absolute right-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Coding Rate"}),l.jsxs("div",{className:"relative",children:[l.jsx("select",{value:J,onChange:e=>Q(parseInt(e.target.value)),className:"w-full h-[38px] bg-bg-subtle border border-border-subtle rounded-lg px-3 pr-8 py-2 text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary/50 appearance-none cursor-pointer",children:E.map(e=>l.jsx("option",{value:e.value,children:e.label},e.value))}),l.jsx(c,{className:"absolute right-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Preamble"}),l.jsxs("p",{className:"type-body text-text-primary font-medium h-[38px] flex items-center",children:[q.preamble_length," symbols"]})]})]}):l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Frequency"}),l.jsx("p",{className:"type-data text-text-primary h-[38px] flex items-center",children:d(q.frequency)})]}),l.jsxs("div",{children:[l.jsx("label",{className:"type-label text-text-muted block mb-1",children:"TX Power"}),l.jsxs("p",{className:"type-data text-text-primary h-[38px] flex items-center",children:[q.tx_power," dBm"]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Bandwidth"}),l.jsx("p",{className:"type-data text-text-primary h-[38px] flex items-center",children:o(q.bandwidth)})]}),l.jsxs("div",{children:[l.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Spreading Factor"}),l.jsxs("p",{className:"type-data text-text-primary h-[38px] flex items-center",children:["SF",q.spreading_factor]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Coding Rate"}),l.jsxs("p",{className:"type-data text-text-primary h-[38px] flex items-center",children:["4/",q.coding_rate]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Preamble Length"}),l.jsxs("p",{className:"type-data text-text-primary h-[38px] flex items-center",children:[q.preamble_length," symbols"]})]})]}):l.jsx("p",{className:"text-text-muted",children:"Loading radio configuration..."})]})})}),l.jsx(N,{span:12,md:6,children:l.jsxs(j,{children:[l.jsx(y,{icon:l.jsx(_,{}),title:"Location",largeTitle:!0}),D?l.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[l.jsxs("div",{children:[l.jsx("label",{className:"type-label text-text-muted",children:"Latitude"}),l.jsx("p",{className:"type-data text-text-primary mt-1 text-sm",children:0!==D.latitude?D.latitude.toFixed(6):"Not set"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"type-label text-text-muted",children:"Longitude"}),l.jsx("p",{className:"type-data text-text-primary mt-1 text-sm",children:0!==D.longitude?D.longitude.toFixed(6):"Not set"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"type-label text-text-muted",children:"Advert Interval"}),l.jsx("p",{className:"type-data text-text-primary mt-1 text-sm",children:D.send_advert_interval_hours>0?`${D.send_advert_interval_hours}h`:"Disabled"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"type-label text-text-muted",children:"Score-based TX"}),l.jsx("p",{className:"type-body text-text-primary mt-1 text-sm",children:D.use_score_for_tx?"Enabled":"Disabled"})]})]}):l.jsx("p",{className:"text-text-muted",children:"Loading location settings..."})]})})]}),l.jsxs(f,{template:"standard",children:[l.jsx(N,{span:12,md:6,children:l.jsxs(j,{children:[l.jsx(y,{icon:l.jsx(x,{}),title:"Operating Mode",largeTitle:!0}),l.jsx("p",{className:"type-label text-text-muted mb-3",children:"Control how the repeater handles incoming packets."}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("button",{onClick:()=>H("forward"),className:b("w-full p-3 rounded-lg border text-left transition-all duration-200","forward"===B?"bg-accent-success/20 border-accent-success/50 text-accent-success":"bg-bg-subtle border-border-subtle text-text-secondary hover:bg-bg-elevated"),children:[l.jsx("div",{className:"font-medium text-sm",children:"Forward Mode"}),l.jsx("div",{className:"text-xs opacity-70 mt-0.5",children:"Receive and retransmit to extend coverage"})]}),l.jsxs("button",{onClick:()=>H("monitor"),className:b("w-full p-3 rounded-lg border text-left transition-all duration-200","monitor"===B?"bg-accent-secondary/20 border-accent-secondary/50 text-accent-secondary":"bg-bg-subtle border-border-subtle text-text-secondary hover:bg-bg-elevated"),children:[l.jsx("div",{className:"font-medium text-sm",children:"Monitor Mode"}),l.jsx("div",{className:"text-xs opacity-70 mt-0.5",children:"Log packets without retransmitting"})]})]})]})}),l.jsx(N,{span:12,md:6,children:l.jsxs(j,{children:[l.jsx(y,{icon:l.jsx(u,{}),title:"Duty Cycle Enforcement",largeTitle:!0}),l.jsx("p",{className:"type-label text-text-muted mb-3",children:"Limit airtime to comply with regulations."}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("button",{onClick:()=>I(!0),className:b("w-full p-3 rounded-lg border text-left transition-all duration-200",A?"bg-accent-success/20 border-accent-success/50 text-accent-success":"bg-bg-subtle border-border-subtle text-text-secondary hover:bg-bg-elevated"),children:[l.jsx("div",{className:"font-medium text-sm",children:"Enabled"}),l.jsx("div",{className:"text-xs opacity-70 mt-0.5",children:"Enforce airtime limits for regulatory compliance"})]}),l.jsxs("button",{onClick:()=>I(!1),className:b("w-full p-3 rounded-lg border text-left transition-all duration-200",A?"bg-bg-subtle border-border-subtle text-text-secondary hover:bg-bg-elevated":"bg-accent-secondary/20 border-accent-secondary/50 text-accent-secondary"),children:[l.jsx("div",{className:"font-medium text-sm",children:"Disabled"}),l.jsx("div",{className:"text-xs opacity-70 mt-0.5",children:"No airtime limiting (use with caution)"})]})]})]})})]}),l.jsx(f,{template:"auto",children:l.jsxs(j,{children:[l.jsx(y,{icon:l.jsx(x,{}),title:"Node Information",largeTitle:!0}),F?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[l.jsxs("div",{children:[l.jsx("span",{className:"type-label text-text-muted",children:"Node Name"}),l.jsx("p",{className:"type-body text-text-primary mt-1",children:P})]}),l.jsxs("div",{children:[l.jsx("span",{className:"type-label text-text-muted",children:"Version"}),l.jsxs("p",{className:"type-data text-text-primary mt-1",children:["v",F.version]})]}),l.jsxs("div",{children:[l.jsx("span",{className:"type-label text-text-muted",children:"Core Version"}),l.jsxs("p",{className:"type-data text-text-primary mt-1",children:["v",F.core_version]})]}),l.jsxs("div",{children:[l.jsx("span",{className:"type-label text-text-muted",children:"Local Hash"}),l.jsx("div",{className:"mt-1",children:F.local_hash?l.jsx(h,{hash:F.local_hash,size:"sm"}):l.jsx("span",{className:"type-data-sm text-text-muted",children:"N/A"})})]})]}),F.public_key&&l.jsxs("div",{className:"mt-4 pt-4 border-t border-border-subtle",children:[l.jsx("span",{className:"type-label text-text-muted",children:"Public Key"}),l.jsx("div",{className:"mt-1",children:l.jsx(h,{hash:F.public_key,prefixLength:12,suffixLength:8})})]})]}):l.jsx("p",{className:"text-text-muted",children:"Loading node information..."})]})})]})}export{F as default};
