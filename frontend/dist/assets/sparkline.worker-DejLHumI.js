(function(){"use strict";function S(e){return e?e.startsWith("0x")||e.startsWith("0X")?e.slice(2,4).toUpperCase():e.slice(0,2).toUpperCase():""}function m(e){if(!e)return null;if(Array.isArray(e))return e;if(typeof e=="string")try{const r=JSON.parse(e);return Array.isArray(r)?r:null}catch{return null}return null}function E(e,r){const d=Date.now(),i=d-6048e5,s=new Map;for(const t of r){const n=S(t);n&&(s.has(n)||s.set(n,new Set),s.get(n).add(t))}const c=new Map,f=new Map;for(const t of r)c.set(t,new Map),f.set(t,d);for(const t of e){const n=t.timestamp??0,p=n>1e12?n:n*1e3;if(p<i)continue;const a=new Set,M=t.forwarded_path??t.original_path,o=m(M);if(o&&o.length>0)for(const l of o){const h=String(l).toUpperCase();s.has(h)&&a.add(h)}if((!o||o.length===0)&&t.src_hash){const l=S(t.src_hash);s.has(l)&&a.add(l)}if(a.size>0){const l=Math.floor((p-i)/216e5),h=Math.max(0,Math.min(27,l));for(const y of a){const U=s.get(y);for(const g of U){const _=c.get(g);_.set(h,(_.get(h)||0)+1);const k=f.get(g);p<k&&f.set(g,p)}}}}const u=new Map;for(const t of r){const n=c.get(t),p=f.get(t);if(n.size===0){u.set(t,[]);continue}const a=Math.max(0,Math.floor((p-i)/216e5)),M=[];for(let o=a;o<28;o++)M.push({idx:o-a,count:n.get(o)||0,timestamp:i+o*216e5});u.set(t,M)}return u}self.onmessage=e=>{const{type:r,payload:d}=e.data;if(r!=="compute"){self.postMessage({type:"error",error:`Unknown message type: ${r}`});return}const i=performance.now();try{const{packets:s,nodeHashes:c}=d,f=E(s,c),u=performance.now()-i,t={type:"result",payload:{sparklineEntries:Array.from(f.entries())},computeTimeMs:u,packetCount:s.length,nodeCount:c.length};self.postMessage(t)}catch(s){const c={type:"error",error:s instanceof Error?s.message:"Unknown error in sparkline worker"};self.postMessage(c)}}})();
