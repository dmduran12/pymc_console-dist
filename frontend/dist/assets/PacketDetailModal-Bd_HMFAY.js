const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PathMapMapLibre-BuLpHsPI.js","assets/vendor-react-CVaYKp51.js","assets/vendor-core-WoOfkQwm.js","assets/maplibre-gl-B1CfjdFi.css"])))=>i.map(i=>d[i]);
import{r as e,$ as t,a3 as s,D as a,a4 as n,_ as r,j as o,a5 as l,a6 as c,a7 as i,a8 as d,b as x,X as h,h as p,a9 as u,k as m,aa as f,ab as g}from"./vendor-react-CVaYKp51.js";import{c as b}from"./recharts-ccH8-7Db.js";import{t as y,R as j,v,x as N,y as w,z as _,d as k,c as M,A as C,B as T,C as P,E}from"./index-D7mmFuyN.js";import{S,g as R}from"./SignalIndicator-2MYdVBzQ.js";import{H as A}from"./HashBadge-D1AhNxni.js";import{g as D}from"./useScientificColormap-DWXyqERV.js";import{_ as L}from"./deckgl-DTsmDcfs.js";function O(e){return null==e?"UNKNOWN":y[e]||`TYPE_${e}`}function F(e){return null==e?"UNKNOWN":j[e]||`ROUTE_${e}`}const V={REQ:v.REQ,RESPONSE:v.RESPONSE,TXT_MSG:v.TXT_MSG,ACK:v.ACK,ADVERT:v.ADVERT,GRP_TXT:v.GRP_TXT,GRP_DATA:v.GRP_DATA,ANON_REQ:v.ANON_REQ,PATH:v.PATH,TRACE:v.TRACE,MULTIPART:v.MULTIPART,RAW_CUSTOM:v.RAW_CUSTOM};function U(e,t){return(Math.max(e,t)+.05)/(Math.min(e,t)+.05)}function H(e){const t=function(e){const t=e.replace("#",""),s=parseInt(t.slice(0,2),16)/255,a=parseInt(t.slice(2,4),16)/255,n=parseInt(t.slice(4,6),16)/255,r=e=>e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4);return.2126*r(s)+.7152*r(a)+.0722*r(n)}(e);return U(t,1)>U(t,0)?"light":"dark"}const z={light:"rgba(255, 255, 255, 0.95)",dark:"rgba(0, 0, 0, 0.85)"};function I(e){const t=function(e){return D(V[e])}(e),s=H(t);return{bgColor:t,textColor:z[s]}}function $(e){return{FLOOD:"var(--route-flood)",DIRECT:"var(--route-direct)",TRANSPORT:"var(--route-transport)",T_FLOOD:"var(--route-flood)",T_DIRECT:"var(--route-direct)"}[e]||"var(--text-muted)"}function G(e){return 1===e||!0===e}const X={light:"rgba(255, 255, 255, 0.95)",dark:"rgba(0, 0, 0, 0.85)"},Q={rx:{icon:r,label:"RX",colorVar:"var(--accent-primary)"},tx:{icon:n,label:"TX",colorVar:"var(--accent-secondary)"},forward:{icon:a,label:"FWD",colorVar:"var(--accent-success)"},dropped:{icon:s,label:"DROP",colorVar:"var(--accent-danger)"},duplicate:{icon:t,label:"DUPE",colorVar:"var(--text-muted)"}},W={rx:"#719CDF",tx:"#DFBC72",forward:"#719872",dropped:"#E12672",duplicate:"#727272"},q={sm:"w-3.5 h-3.5",md:"w-4 h-4"};function K(e){return"tx_local"===e.packet_origin?"tx":"tx_forward"===e.packet_origin?"forward":e.is_duplicate?"duplicate":e.transmitted?"forward":e.drop_reason?"dropped":"rx"}const B=e.memo(function({packet:t,showLabel:s=!0,size:a="sm"}){const n=K(t),r=Q[n],l=r.icon,c=e.useMemo(()=>{const e=H(W[n]);return X[e]},[n]);return o.jsxs("span",{className:"color-pill color-pill-filled",style:{"--pill-color":r.colorVar,"--pill-text":c},children:[o.jsx(l,{className:q[a]}),s&&r.label]})});function Y(e){return"tx_local"===e.packet_origin?"Transmitted":"tx_forward"===e.packet_origin||e.transmitted?"Forwarded":e.is_duplicate?"Duplicate":"No transport keys configured"===e.drop_reason?"Monitor Only":e.drop_reason?e.drop_reason:"Received"}function J(e){return Q[K(e)].colorVar}function Z(e){const t=e.payload_type_name||O(e.payload_type??e.type);return{payloadType:t,routeType:e.route_type_name||F(e.route_type??e.route),typeColor:I(t)}}function ee({packet:e,onClick:t,isFlashing:s=!1,isPending:a}){const{payloadType:n,routeType:r,typeColor:c}=Z(e),i="tx_local"===e.packet_origin,d=a??e.isPending;return o.jsxs("tr",{onClick:()=>t(e),className:b("cursor-pointer","hover:bg-bg-subtle",G(e.is_duplicate)&&"opacity-50",s&&"flash-row",d&&"opacity-70 bg-accent-secondary/5",i&&"ring-1 ring-inset ring-accent-primary/60 bg-accent-primary/5"),children:[o.jsx("td",{className:"py-2.5 px-3",children:o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx(B,{packet:e,showLabel:!0}),d&&o.jsx(l,{className:"w-3 h-3 text-accent-secondary animate-spin"})]})}),o.jsx("td",{className:"py-2.5 px-3 text-sm font-mono text-text-secondary whitespace-nowrap",children:w(e.timestamp)}),o.jsx("td",{className:"py-2.5 px-3",children:e.src_hash?o.jsx(A,{hash:e.src_hash,copyValue:e.src_hash_full,size:"xs"}):o.jsx("span",{className:"text-sm text-text-muted",children:"—"})}),o.jsx("td",{className:"py-2.5 px-3",children:o.jsx("span",{className:"color-pill color-pill-filled",style:{"--pill-color":c.bgColor,"--pill-text":c.textColor},children:n})}),o.jsx("td",{className:"py-2.5 px-3",children:o.jsx("span",{className:"color-pill",style:{"--pill-color":$(r)},children:r})}),o.jsx("td",{className:"py-2.5 px-3 pr-4",children:o.jsx("div",{className:"flex justify-end",children:o.jsx(S,{rssi:e.rssi,snr:e.snr,compact:!0,showValues:!0})})})]})}const te=e.memo(function(e){return o.jsx(ee,{...e})}),se=e.memo(function({packet:e,onClick:t,isFlashing:s=!1,isPending:a}){const{payloadType:n,routeType:r,typeColor:c}=Z(e),i="tx_local"===e.packet_origin,d=a??e.isPending;return o.jsx("div",{onClick:()=>t(e),className:b("packet-row px-3 py-2.5 cursor-pointer","hover:bg-bg-subtle","active:bg-bg-elevated",G(e.is_duplicate)&&"opacity-50",s&&"flash-row",d&&"opacity-70 bg-accent-secondary/5",i&&"ring-1 ring-inset ring-accent-primary/60 bg-accent-primary/5"),children:o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsxs("div",{className:"w-14 flex-shrink-0 flex items-center gap-1",children:[o.jsx(B,{packet:e,showLabel:!0,size:"sm"}),d&&o.jsx(l,{className:"w-3 h-3 text-accent-secondary animate-spin"})]}),o.jsx("span",{className:"text-[10px] font-mono text-text-muted w-7 flex-shrink-0",children:N(e.timestamp)}),o.jsx("div",{className:"w-9 flex-shrink-0",children:e.src_hash?o.jsx(A,{hash:e.src_hash,copyValue:e.src_hash_full,size:"xs"}):o.jsx("span",{className:"text-[10px] text-text-muted",children:"—"})}),o.jsx("span",{className:"color-pill color-pill-filled truncate flex-1 min-w-0",style:{"--pill-color":c.bgColor,"--pill-text":c.textColor},children:n}),o.jsx("div",{className:"w-14 flex-shrink-0",children:o.jsx("span",{className:"color-pill",style:{"--pill-color":$(r)},children:r})}),o.jsx("div",{className:"w-12 flex-shrink-0 flex justify-end",children:o.jsx(S,{rssi:e.rssi,compact:!0,showValues:!0})})]})})});function ae(e){if(e.contact_type){const t=e.contact_type.toLowerCase();if("repeater"===t||"rep"===t)return!0;if("companion"===t||"client"===t||"cli"===t)return!1;if("room server"===t||"room_server"===t||"room"===t||"server"===t)return!1}return!0===e.is_repeater||(e.is_repeater,!1)}const ne=e.lazy(()=>L(()=>import("./PathMapMapLibre-BuLpHsPI.js"),__vite__mapDeps([0,1,2,3])));function re(e){return`${(100*e).toFixed(0)}%`}function oe(e,t){const s=document.documentElement,a=getComputedStyle(s),n={success:a.getPropertyValue("--accent-success").trim()||"#39D98A",secondary:a.getPropertyValue("--accent-secondary").trim()||"#F9D26F",poor:a.getPropertyValue("--signal-poor").trim()||"#FF8A5C",danger:a.getPropertyValue("--accent-danger").trim()||"#FF5C7A",muted:a.getPropertyValue("--text-muted").trim()||"#767688"};let r;return r=0===t?n.muted:e>=1?n.success:e>=.5?n.secondary:e>=.25?n.poor:e>0?n.danger:n.muted,{color:r}}class le extends e.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?o.jsxs("div",{className:"h-[200px] flex items-center justify-center text-text-muted",children:[o.jsx(d,{className:"w-4 h-4 mr-2"}),"Map failed to load"]}):this.props.children}}function ce({path:t,neighbors:s,localNode:a,localHash:n,srcHash:r,dstHash:l,neighborAffinity:d,prefixLookup:x,hubNodes:h}){const[p,u]=e.useState(null),m=e.useMemo(()=>{if(!r)return null;const e=k(r),t=s[r];if((null==t?void 0:t.latitude)&&(null==t?void 0:t.longitude)&&(0!==t.latitude||0!==t.longitude))return{prefix:e,candidates:[{hash:r,name:t.node_name||t.name||"Source",latitude:t.latitude,longitude:t.longitude,probability:1,isLocal:!1,isDirectNeighbor:!0===t.zero_hop}],confidence:1,totalMatches:1,isSource:!0};const a=(null==t?void 0:t.node_name)||(null==t?void 0:t.name)||r.slice(0,8);return{prefix:e,candidates:[{hash:r,name:a,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isSource:!0}},[r,s]),f=e.useMemo(()=>{if(!l)return null;const e=k(l);if(n&&l===n&&a){const t=0!==a.latitude||0!==a.longitude;return{prefix:e,candidates:[{hash:l,name:a.name||"Local Node",latitude:t?a.latitude:0,longitude:t?a.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}const t=s[l];if((null==t?void 0:t.latitude)&&(null==t?void 0:t.longitude)&&(0!==t.latitude||0!==t.longitude))return{prefix:e,candidates:[{hash:l,name:t.node_name||t.name||"Destination",latitude:t.latitude,longitude:t.longitude,probability:1,isLocal:!1,isDirectNeighbor:!0===t.zero_hop}],confidence:1,totalMatches:1,isDestination:!0};const r=(null==t?void 0:t.node_name)||(null==t?void 0:t.name)||l.slice(0,8);return{prefix:e,candidates:[{hash:l,name:r,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isDestination:!0}},[l,s,a,n]),g=e.useMemo(()=>function(e,t,s,a,n,r){if(!e||0===e.length)return{hops:[],overallConfidence:0,hasValidPath:!1};const o=e.length-1,l=e.map((l,c)=>{const i=c===o,d=e.length-c,{candidates:x,totalMatches:h}=function(e,t,s,a,n=!1,r,o,l){const c=function(e){const t={};for(const[s,a]of Object.entries(e))ae(a)&&(t[s]=a);return t}(t);let i;if(o){const t=function(e,t,s){const a=t.toUpperCase(),n=e.get(a);if(!n||0===n.candidates.length)return{hash:null,confidence:0};if(null==s?void 0:s.isLastHop)return{hash:n.bestMatch,confidence:n.confidence};if(1===(null==s?void 0:s.position))return{hash:n.bestMatch,confidence:n.confidence};if((null==s?void 0:s.position)&&n.bestMatchForPosition.has(s.position)){const e=n.bestMatchForPosition.get(s.position),t=Math.max(e.confidence,n.confidence);return{hash:e.hash,confidence:t}}if((null==s?void 0:s.adjacentPrefixes)&&s.adjacentPrefixes.length>0){let e=n.bestMatch,t=0;for(const a of n.candidates){let n=0;for(const e of s.adjacentPrefixes)n+=a.adjacentPrefixCounts.get(e.toUpperCase())||0;const r=a.combinedScore+n/Math.max(1,a.totalAdjacentObservations)*.3;r>t&&(t=r,e=a.hash)}return{hash:e,confidence:n.confidence}}return{hash:n.bestMatch,confidence:n.confidence}}(o,e,{position:l,isLastHop:n});i=t.confidence}const{matches:d,probability:x}=function(e,t,s,a,n=!1){const r=e.toUpperCase(),o=[],l=s&&_(r,s);l&&o.push(s);for(const p of Object.keys(t))_(r,p)&&o.push(p);if(n&&l&&s&&1===o.length)return{matches:o,probability:1,bestMatch:s};if(n&&l&&o.length>1){const e=o.filter(e=>e!==s);if(1===e.length)return{matches:o,probability:1,bestMatch:e[0]}}const c=o.length>0?1/o.length:0,i=[...o].sort();let d=null,x=-1;if(1===i.length)d=i[0];else if(i.length>1&&a){for(const e of i){const t=a.get(e),s=t?"number"==typeof t?t:t.combinedScore:0;s>x&&(x=s,d=e)}d||(d=i[0])}else i.length>0&&(d=i[0]);let h=c;if(o.length>1&&a&&x>0){let e=0;for(const t of o){const s=a.get(t);e+=s?"number"==typeof s?s:s.combinedScore:0}e>0&&(h=Math.min(.95,x/e))}return{matches:o,probability:h,bestMatch:d}}(e,c,a,r,n),h=d.length,p=[],u=e.toUpperCase(),m=s&&void 0!==s.latitude&&void 0!==s.longitude&&(0!==s.latitude||0!==s.longitude);for(const g of d){if(a&&_(u,a)&&g===a&&m&&s){p.push({hash:g,name:s.name||"Local Node",latitude:s.latitude,longitude:s.longitude,probability:n?1:x,isLocal:!0});continue}const e=c[g];(null==e?void 0:e.latitude)&&(null==e?void 0:e.longitude)&&(0!==e.latitude||0!==e.longitude)&&p.push({hash:g,name:e.node_name||e.name||"Unknown",latitude:e.latitude,longitude:e.longitude,probability:x,isLocal:!1,isDirectNeighbor:!0===e.zero_hop})}const f=p.length;if(1===f)p[0].probability=i??1;else if(f>1)if(void 0!==i&&i>0){p[0].probability=i;const e=1-i,t=f-1;p.slice(1).forEach(s=>{s.probability=e/t})}else{let e=0;const t=p.map(t=>{if(t.isLocal)return{candidate:t,score:1};const a=null==r?void 0:r.get(t.hash);let n=.5;var o;let l;return m&&s&&(n=(o=function(e,t,s,a){const n=(s-e)*Math.PI/180,r=(a-t)*Math.PI/180,o=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))*6371e3}(s.latitude,s.longitude,t.latitude,t.longitude))<100?1:o<500?.9:o<1e3?.7:o<5e3?.5:o<1e4?.3:.1),a?l=.3*n+.3*a.hopConsistencyScore+.4*a.frequencyScore:(l=n,t.isDirectNeighbor&&(l=Math.max(l,.8))),e+=l,{candidate:t,score:l}});if(e>0)t.forEach(({candidate:t,score:s})=>{t.probability=Math.min(.95,s/e)});else{const e=1/f;p.forEach(t=>t.probability=e)}}return{candidates:p,totalMatches:h}}(l,t,s,a,i,n,r,d),p=x.length>0?Math.max(...x.map(e=>e.probability)):0;return{prefix:l,candidates:x,confidence:p,totalMatches:h}}),c=l.reduce((e,t)=>0===t.confidence?0:e*t.confidence,1),i=l.some(e=>e.candidates.length>0);return{hops:l,overallConfidence:c,hasValidPath:i}}(t,s,a,n,d,x),[t,s,a,n,d,x]),y=e.useMemo(()=>{const e=[];m&&e.push(m),e.push(...g.hops),f&&e.push(f);const t=e.reduce((e,t)=>0===t.confidence?0:e*t.confidence,1),s=e.some(e=>e.candidates.some(e=>0!==e.latitude||0!==e.longitude));return{hops:e,overallConfidence:t,hasValidPath:s}},[m,g,f]);return y.hasValidPath?o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center justify-between text-xs",children:[o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("span",{className:"text-text-muted",children:"Path Confidence:"}),o.jsx("span",{className:(j=y.overallConfidence,j>=1?"text-accent-success":j>=.5?"text-accent-secondary":j>=.25?"text-signal-poor":j>0?"text-accent-danger":"text-text-muted"),children:re(y.overallConfidence)}),o.jsx("button",{className:"text-text-muted hover:text-text-secondary transition-colors",title:"Confidence is calculated based on how many known nodes match each path prefix. Multiple matches reduce confidence due to collision probability.",children:o.jsx(i,{className:"w-3 h-3"})})]}),o.jsxs("div",{className:"flex items-center gap-2 text-[10px]",children:[o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("div",{className:"w-2 h-2 rounded-full bg-accent-success"}),o.jsx("span",{className:"text-text-muted",children:"Exact"})]}),o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("div",{className:"w-2 h-2 rounded-full bg-accent-secondary"}),o.jsx("span",{className:"text-text-muted",children:"Multi"})]}),o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("div",{className:"w-2 h-2 rounded-full bg-text-muted"}),o.jsx("span",{className:"text-text-muted",children:"Unknown"})]})]})]}),o.jsx("div",{className:"rounded-lg overflow-hidden border border-border-subtle",children:o.jsx(le,{children:o.jsx(e.Suspense,{fallback:o.jsx("div",{className:"h-[200px] bg-bg-elevated flex items-center justify-center text-text-muted text-sm",children:"Loading map..."}),children:o.jsx(ne,{resolvedPath:y,localNode:a,hubNodes:h,hoveredHopIndex:p,onHoverHop:u})})})}),o.jsx("div",{className:"flex flex-wrap items-center gap-1.5",children:y.hops.map((e,t)=>{var s,a,n;const r=!0===e.isSource,l=!0===e.isDestination,c=p===t;let i;return i=r?`Source: ${(null==(s=e.candidates[0])?void 0:s.name)||"Unknown"}`:l?`Destination: ${(null==(a=e.candidates[0])?void 0:a.name)||"Unknown"}`:0===e.totalMatches?"No matching nodes found":1===e.totalMatches?`Exact match: ${(null==(n=e.candidates[0])?void 0:n.name)||"Unknown"}`:`${e.totalMatches} possible matches (${(100*e.confidence).toFixed(0)}% confidence)`,o.jsxs("div",{className:b("flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-mono cursor-pointer transition-all",c?"bg-accent-primary/20 ring-1 ring-accent-primary/50":"bg-bg-elevated hover:bg-bg-subtle",r&&"border border-accent-success/30",l&&"border border-accent-primary/30"),title:i,onMouseEnter:()=>u(t),onMouseLeave:()=>u(null),children:[r&&o.jsx("span",{className:"text-accent-success text-[8px] mr-0.5",children:"SRC"}),l&&o.jsx("span",{className:"text-accent-primary text-[8px] mr-0.5",children:"DST"}),o.jsx("span",{style:oe(e.confidence,e.totalMatches),children:e.prefix}),!r&&!l&&e.totalMatches>1&&o.jsxs("span",{className:"text-text-muted",children:["×",e.totalMatches]}),!r&&!l&&0===e.totalMatches&&o.jsx("span",{className:"text-text-muted",children:"?"})]},t)})})]}):o.jsxs("div",{className:"flex items-center justify-center text-text-muted text-xs py-4",children:[o.jsx(c,{className:"w-3.5 h-3.5 mr-1.5 opacity-50"}),"No location data available for path nodes"]});var j}function ie(e){if(!e)return[];if(Array.isArray(e))return e;try{const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}}function de({label:e,children:t,compact:s=!1}){return o.jsxs("div",{className:b("flex flex-col",s?"gap-0.5":"gap-1"),children:[o.jsx("span",{className:"text-[10px] text-text-muted uppercase tracking-wide",children:e}),o.jsx("span",{className:b("text-text-primary","text-sm"),children:t})]})}function xe({onClick:e,copied:s}){return o.jsx("button",{onClick:t=>{t.stopPropagation(),e()},className:"p-1 rounded hover:bg-bg-subtle transition-colors",children:s?o.jsx(g,{className:"w-3 h-3 text-accent-success"}):o.jsx(t,{className:"w-3 h-3 text-text-muted"})})}function he({originalPath:e,forwardedPath:t,ghostPrefixes:s}){const n=t.length>0?t:e;if(0===n.length)return o.jsx("span",{className:"text-sm text-text-muted",children:"No path data"});const r=e=>null==s?void 0:s.has(e.toUpperCase());return o.jsx("div",{className:"flex items-center gap-1 flex-wrap",children:n.map((e,t)=>o.jsxs("div",{className:"flex items-center gap-1",children:[r(e)?o.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-accent-tertiary/20 text-accent-tertiary font-mono text-sm",children:[o.jsx(p,{className:"w-3 h-3"}),e.toUpperCase()]}):o.jsx(A,{hash:e,size:"xs"}),t<n.length-1&&o.jsx(a,{className:"w-3 h-3 text-text-muted flex-shrink-0"})]},t))})}const pe=e.memo(function({packet:s,onClose:a}){var n;const[r,l]=e.useState(!1),[c,i]=e.useState(!0),[d,y]=e.useState(null);e.useEffect(()=>{const e=e=>{"Escape"===e.key&&a()};window.addEventListener("keydown",e);const t=document.body.style.overflow,s=document.body.style.position,n=document.body.style.width,r=document.body.style.top,o=window.scrollY;return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.top=`-${o}px`,()=>{window.removeEventListener("keydown",e),document.body.style.overflow=t,document.body.style.position=s,document.body.style.width=n,document.body.style.top=r,window.scrollTo(0,o)}},[a]);const j=M(),v=C(),N=T(),w=P(),_=e.useMemo(()=>new Set(w.map(e=>e.prefix.toUpperCase())),[w]),k=s.payload_type_name||O(s.payload_type??s.type),D=s.route_type_name||F(s.route_type??s.route),L=s.payload_length??s.length??0,V=s.tx_delay_ms??0,U=ie(s.original_path),H=ie(s.forwarded_path),z=U.length>0||H.length>0,I=H.length>0?H:U,$=e.useMemo(()=>{var e;if(null==(e=null==j?void 0:j.config)?void 0:e.repeater)return{latitude:j.config.repeater.latitude,longitude:j.config.repeater.longitude,name:j.config.node_name||"Local Node"}},[j]),G=(null==j?void 0:j.neighbors)??{},X=N.size>0?N:void 0,Q=function(e){var t;if(!e)return{text:null,isText:!1};try{if(/^[0-9a-fA-F]+$/.test(e)){const s=(null==(t=e.match(/.{1,2}/g))?void 0:t.map(e=>parseInt(e,16)))??[],a=String.fromCharCode(...s),n=a.replace(/[^\x20-\x7E]/g,"");if(n.length>.7*a.length)return{text:n,isText:!0}}if(/^[\x20-\x7E\s]+$/.test(e))return{text:e,isText:!0}}catch{}return{text:null,isText:!1}}(s.payload),W=s.payload&&s.payload.length>0,q=s.raw_packet&&s.raw_packet.length>0,K=e.useCallback(async(e,t)=>{try{await navigator.clipboard.writeText(e),y(t),setTimeout(()=>y(null),2e3)}catch{}},[]);return x.createPortal(o.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-md z-[10010] flex items-end sm:items-center justify-center",onClick:a,role:"dialog","aria-modal":"true","aria-labelledby":"packet-modal-title",children:o.jsxs("div",{className:b("glass-card-elevated w-full max-h-[90vh] flex flex-col","sm:max-w-xl sm:mx-4 sm:rounded-xl","rounded-t-2xl rounded-b-none sm:rounded-b-xl","pb-safe"),onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border-subtle flex-shrink-0",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(B,{packet:s,showLabel:!0,size:"md"}),o.jsxs("div",{children:[o.jsx("h3",{id:"packet-modal-title",className:b("text-base font-semibold",(ee=k,{ADVERT:"text-[var(--pkt-advert)]",FLOOD:"text-[var(--pkt-flood)]",TXT_MSG:"text-[var(--pkt-txt-msg)]",ACK:"text-[var(--pkt-ack)]",TRACE:"text-[var(--pkt-trace)]",REQ:"text-[var(--pkt-req)]",RESPONSE:"text-[var(--pkt-response)]",GRP_TXT:"text-[var(--pkt-grp-txt)]",GRP_DATA:"text-[var(--pkt-grp-data)]",PATH:"text-[var(--pkt-path)]",ANON_REQ:"text-[var(--pkt-anon)]"}[ee]||"text-[var(--pkt-unknown)]")),children:k}),o.jsx("p",{className:"text-sm text-text-muted",children:E(s.timestamp)})]})]}),o.jsx("button",{onClick:a,className:"p-2 rounded-lg text-text-muted hover:text-text-primary hover:bg-bg-subtle transition-colors",children:o.jsx(h,{className:"w-5 h-5"})})]}),o.jsxs("div",{className:"overflow-y-auto flex-1 p-4 space-y-4 overscroll-contain",style:{WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsx(de,{label:"Packet Hash",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(A,{hash:s.packet_hash,size:"sm"}),o.jsx(xe,{onClick:()=>K(s.packet_hash,"hash"),copied:"hash"===d})]})}),o.jsx(de,{label:"Route",children:o.jsx("span",{className:b("px-2 py-0.5 rounded text-sm border font-medium",(Z=D,{FLOOD:"bg-[var(--route-flood)]/20 text-[var(--route-flood)] border-[var(--route-flood)]/30",DIRECT:"bg-[var(--route-direct)]/20 text-[var(--route-direct)] border-[var(--route-direct)]/30",TRANSPORT:"bg-[var(--route-transport)]/20 text-[var(--route-transport)] border-[var(--route-transport)]/30",T_FLOOD:"bg-[var(--route-flood)]/20 text-[var(--route-flood)] border-[var(--route-flood)]/30",T_DIRECT:"bg-[var(--route-direct)]/20 text-[var(--route-direct)] border-[var(--route-direct)]/30"}[Z]||"bg-bg-subtle text-text-muted border-border-subtle")),children:D})})]}),o.jsx("div",{className:"glass-card-inner p-3",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-sm text-text-muted mb-1",children:"Signal Quality"}),o.jsx("p",{className:"text-sm font-medium text-text-primary",children:R(s.rssi)})]}),o.jsx(S,{rssi:s.rssi,snr:s.snr,showValues:!0})]})}),(s.src_hash||s.dst_hash)&&o.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[s.src_hash&&o.jsx(de,{label:"Source",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(A,{hash:s.src_hash,size:"sm"}),o.jsx(xe,{onClick:()=>K(s.src_hash,"src"),copied:"src"===d})]})}),s.dst_hash&&o.jsx(de,{label:"Destination",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(A,{hash:s.dst_hash,size:"sm"}),o.jsx(xe,{onClick:()=>K(s.dst_hash,"dst"),copied:"dst"===d})]})})]}),z&&o.jsxs("div",{className:"glass-card-inner p-3",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("p",{className:"text-sm text-text-muted",children:"Packet Path"}),I.some(e=>_.has(e.toUpperCase()))&&o.jsxs("span",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-full bg-accent-tertiary/20 text-accent-tertiary text-[10px]",children:[o.jsx(p,{className:"w-3 h-3"}),o.jsx("span",{children:"Ghost Detected"})]})]}),o.jsx(he,{originalPath:U,forwardedPath:H,ghostPrefixes:_})]}),z&&I.length>0&&o.jsxs("div",{className:"glass-card-inner overflow-hidden",children:[o.jsxs("button",{onClick:()=>i(!c),className:"w-full p-3 flex items-center justify-between text-left hover:bg-bg-subtle transition-colors",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(u,{className:"w-4 h-4 text-accent-primary"}),o.jsx("span",{className:"text-sm text-text-secondary font-medium",children:"Path Map"})]}),c?o.jsx(m,{className:"w-4 h-4 text-text-muted"}):o.jsx(f,{className:"w-4 h-4 text-text-muted"})]}),c&&o.jsx("div",{className:"px-3 pb-3",children:o.jsx(ce,{path:I,neighbors:G,localNode:$,localHash:null==j?void 0:j.local_hash,srcHash:s.src_hash,dstHash:s.dst_hash,neighborAffinity:X,hubNodes:[...v]})})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[o.jsx(de,{label:"Size",compact:!0,children:o.jsxs("span",{className:"font-mono",children:[L,"B"]})}),o.jsx(de,{label:"TX Delay",compact:!0,children:o.jsxs("span",{className:"font-mono",children:[V.toFixed(1),"ms"]})}),o.jsx(de,{label:"Score",compact:!0,children:o.jsx("span",{className:"font-mono",children:void 0!==s.score?s.score.toFixed(3):"—"})})]}),o.jsx(de,{label:"Status",children:o.jsx("span",{className:J(s),children:Y(s)})}),W&&o.jsxs("div",{className:"glass-card-inner p-3",children:[o.jsx("p",{className:"text-sm text-text-muted mb-2",children:"Payload"}),Q.isText&&Q.text?o.jsx("div",{className:"bg-bg-base rounded p-2",children:o.jsx("p",{className:"text-sm text-text-primary font-mono break-all",children:Q.text})}):o.jsxs("p",{className:"text-sm text-text-muted font-mono break-all",children:[null==(n=s.payload)?void 0:n.slice(0,100),s.payload&&s.payload.length>100&&"..."]})]}),q&&o.jsxs("div",{className:"glass-card-inner overflow-hidden",children:[o.jsxs("button",{onClick:()=>l(!r),className:"w-full p-3 flex items-center justify-between text-left hover:bg-bg-subtle transition-colors",children:[o.jsx("span",{className:"text-sm text-text-muted",children:"Raw Packet Hex"}),r?o.jsx(m,{className:"w-4 h-4 text-text-muted"}):o.jsx(f,{className:"w-4 h-4 text-text-muted"})]}),r&&o.jsx("div",{className:"px-3 pb-3",children:o.jsxs("div",{className:"bg-bg-base rounded p-2 relative",children:[o.jsx("pre",{className:"text-[10px] text-text-secondary font-mono break-all whitespace-pre-wrap",children:s.raw_packet}),o.jsx("button",{onClick:()=>K(s.raw_packet,"raw"),className:"absolute top-2 right-2 p-1 rounded bg-bg-elevated hover:bg-bg-subtle transition-colors",children:"raw"===d?o.jsx(g,{className:"w-3 h-3 text-accent-success"}):o.jsx(t,{className:"w-3 h-3 text-text-muted"})})]})})]})]})]})}),document.body);var Z,ee});export{te as P,se as a,pe as b,K as g};
