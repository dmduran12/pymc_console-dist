import{j as e}from"./index-CSdhf7Y1.js";import{b as t}from"./recharts-CGff6_7g.js";import{M as o,S as n,L as r,a,P as i}from"./maplibre-gl-jOQAESDj.js";import"./maplibre-gl-DsiI67my.js";const s="#4F46E5",l="#F9D26F",d="#B49DFF",c="#39D98A",p="#B49DFF";function u(e,t,o,n=!1,r=!1,a=!1){let i;i=r?c:a?p:e?s:t?"#6366F1":o?"transparent":l;const u=e||t||!o||r||a;return`<div style="\n    width: 14px;\n    height: 14px;\n    background: ${i};\n    border-radius: 50%;\n    border: ${u?0:5}px solid ${u?"transparent":"#4338CA"};\n    box-sizing: border-box;\n    transition: box-shadow 0.15s ease;\n    ${n?`box-shadow: 0 0 0 3px ${d}40, 0 0 8px ${d}60;`:""}\n  "></div>`}const m={id:"path-line",type:"line",paint:{"line-color":"#3B3F4A","line-width":2,"line-opacity":.7},layout:{"line-cap":"round","line-join":"round"}};function x({resolvedPath:d,localNode:x,hubNodes:h=[],hoveredHopIndex:f,onHoverHop:b}){const y=t.useRef(null),g=t.useMemo(()=>new Set(h),[h]),[v,N]=t.useState(null),{positions:C,markers:F,pathLineGeoJSON:k}=t.useMemo(()=>{const e=[],t=[],o=[];d.hops.forEach((n,r)=>{const a=n.candidates.filter(e=>{return t=e.latitude,o=e.longitude,0!==t||0!==o;var t,o});if(0===a.length)return;const i=[...a].sort((e,t)=>t.probability-e.probability)[0];o.push([i.longitude,i.latitude]);const s=!0===n.isSource,l=!0===n.isDestination;a.forEach((o,i)=>{const d=[o.latitude,o.longitude];e.push(d);const c=0===i;t.push({position:d,prefix:n.prefix,confidence:n.confidence,candidateCount:a.length,hopIndex:r,candidate:o,isHub:g.has(o.hash),isPrimary:c,isSource:s,isDestination:l})})});const n={type:"FeatureCollection",features:o.length>=2?[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:o}}]:[]};return{positions:e,markers:t,pathLineGeoJSON:n}},[d,g]),{center:S,zoom:j}=t.useMemo(()=>{if(0===C.length)return x?{center:[x.longitude,x.latitude],zoom:10}:{center:[0,0],zoom:2};let e=1/0,t=-1/0,o=1/0,n=-1/0;for(const[c,p]of C)c<e&&(e=c),c>t&&(t=c),p<o&&(o=p),p>n&&(n=p);const r=(e+t)/2,a=(o+n)/2,i=t-e,s=n-o,l=Math.max(i,s);let d;return d=l<.01?15:l<.05?13:l<.1?12:l<.5?10:l<1?9:l<5?7:5,{center:[a,r],zoom:d}},[C,x]);t.useEffect(()=>{if(!y.current||C.length<2)return;let e=1/0,t=-1/0,o=1/0,n=-1/0;for(const[r,a]of C)r<e&&(e=r),r>t&&(t=r),a<o&&(o=a),a>n&&(n=a);y.current.fitBounds([[o,e],[n,t]],{padding:30,maxZoom:16,duration:0})},[C]);const L=t.useCallback(e=>{N({longitude:e.position[1],latitude:e.position[0],marker:e})},[]);return 0===C.length?e.jsx("div",{className:"h-[200px] flex items-center justify-center text-text-muted text-sm bg-bg-elevated",children:"No mappable path data"}):e.jsxs(o,{ref:y,initialViewState:{longitude:S[0],latitude:S[1],zoom:j},style:{height:"200px",width:"100%"},mapStyle:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",attributionControl:!1,children:[k.features.length>0&&e.jsx(n,{id:"path-line-source",type:"geojson",data:k,children:e.jsx(r,{...m})}),F.map(t=>{const o=f===t.hopIndex;return e.jsx(a,{longitude:t.position[1],latitude:t.position[0],anchor:"center",onClick:()=>L(t),children:e.jsx("div",{style:{cursor:"pointer",opacity:t.isPrimary?1:.5},onMouseEnter:()=>null==b?void 0:b(t.hopIndex),onMouseLeave:()=>null==b?void 0:b(null),dangerouslySetInnerHTML:{t:u(t.candidate.isLocal||!1,t.isHub,t.isPrimary,o,t.isSource,t.isDestination)}})},`${t.hopIndex}-${t.candidate.hash}`)}),v&&e.jsx(i,{longitude:v.longitude,latitude:v.latitude,anchor:"bottom",offset:[0,-12],closeOnClick:!1,onClose:()=>N(null),className:"maplibre-popup",children:e.jsxs("div",{className:"text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"font-semibold",children:v.marker.candidate.name}),v.marker.isSource&&e.jsx("span",{className:"px-1 py-0.5 text-[8px] font-bold rounded",style:{backgroundColor:c,color:"#000"},children:"SRC"}),v.marker.isDestination&&e.jsx("span",{className:"px-1 py-0.5 text-[8px] font-bold rounded",style:{backgroundColor:p,color:"#000"},children:"DST"}),v.marker.isHub&&e.jsx("span",{className:"px-1 py-0.5 text-[8px] font-bold rounded",style:{backgroundColor:"#FBBF24",color:"#000"},children:"HUB"}),v.marker.candidate.isLocal&&e.jsx("span",{className:"px-1 py-0.5 text-[8px] font-bold rounded",style:{backgroundColor:s,color:"#fff"},children:"LOCAL"})]}),e.jsxs("div",{className:"text-text-muted font-mono text-[10px]",children:[v.marker.prefix," â€¢ ",v.marker.candidate.hash.slice(0,10),"..."]}),!v.marker.isPrimary&&v.marker.candidateCount>1&&e.jsxs("div",{style:{color:l},children:["Alternative (",(100*v.marker.candidate.probability).toFixed(0),"%)"]}),v.marker.isPrimary&&v.marker.candidateCount>1&&e.jsxs("div",{className:"text-text-muted",children:[v.marker.candidateCount," candidates"]})]})})]})}export{x as default};
