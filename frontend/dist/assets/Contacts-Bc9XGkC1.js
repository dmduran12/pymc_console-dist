const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ContactsMapMapLibre-CsZGQooS.js","assets/vendor-react-DCIF8YoJ.js","assets/BasemapLayer-g9CXC1Ky.js","assets/vendor-core-Dl9MTgSr.js","assets/link-scoring-DTgOSmRe.js","assets/index-BGs2yNOg.js","assets/ConfirmModal-_bkwu5cd.js","assets/triangle-alert-2-1YN-Am.js","assets/DeepAnalysisModal-Dhmx8Gh2.js","assets/check-qb29v-su.js","assets/git-branch-Sfdze11O.js","assets/house-CCeK_0TO.js","assets/loader-circle-CwUrmZrV.js","assets/useThemeColors-CGx-Jxyf.js","assets/refresh-cw-ccP9GKH1.js","assets/target-De7OqeGi.js","assets/trending-up-2SYsZdKi.js","assets/compass-DMvXEtHv.js","assets/zap-CQ3I2hAj.js","assets/font-loader-jlbdh9Fw.js","assets/car-DXNv2W8D.js","assets/users-D0iUt2so.js","assets/SignalIndicator-DWWkJgSd.js","assets/DataBox-nCNZLfvU.js","assets/map-pin-x5eP-WEg.js","assets/ping-HGVILoRV.js","assets/PageLayout-DIXn4UXM.js","assets/chevron-up-ClXInh9N.js","assets/funnel-DZRnHLZd.js","assets/circle-check-Bd9Kbu6i.js","assets/CollisionExplorerModal-CyK7TMsS.js","assets/network-DpalqfB8.js","assets/maplibre-gl-B1CfjdFi.css","assets/index-CIefRaAd.css"])))=>i.map(i=>d[i]);
import{j as e,a as s}from"./vendor-react-DCIF8YoJ.js";import{c as t,aA as a,aB as n,ap as l,aC as c,C as r,al as i,aD as o,aE as d,aF as x,v as m,aG as h,p,aH as u,j as g,aI as j,aJ as b,aK as N,h as v,r as f,aL as y,R as w,X as k,B as C,aM as M}from"./index-BGs2yNOg.js";import{p as S}from"./ping-HGVILoRV.js";import{P as L,b as H}from"./PageLayout-DIXn4UXM.js";import{_ as P}from"./deckgl-DTsmDcfs.js";import{G as F}from"./git-branch-Sfdze11O.js";import{T as E}from"./triangle-alert-2-1YN-Am.js";import{a as R,T,M as $}from"./trending-up-2SYsZdKi.js";import{C as A,A as O}from"./chevron-up-ClXInh9N.js";import{E as _,S as D,T as z}from"./target-De7OqeGi.js";import{Z as G,C as I}from"./zap-CQ3I2hAj.js";import{n as K,L as U,T as V,u as W}from"./recharts-DVj1EL-m.js";import{D as B}from"./DataBox-nCNZLfvU.js";import{F as q}from"./funnel-DZRnHLZd.js";import{P as Z,T as J,C as Q}from"./ConfirmModal-_bkwu5cd.js";import{C as X}from"./check-qb29v-su.js";import{U as Y}from"./users-D0iUt2so.js";import{M as ee}from"./map-pin-x5eP-WEg.js";import{C as se}from"./circle-check-Bd9Kbu6i.js";import{C as te,b as ae,c as ne}from"./SignalIndicator-DWWkJgSd.js";import{C as le,S as ce,M as re}from"./CollisionExplorerModal-CyK7TMsS.js";import{N as ie}from"./network-DpalqfB8.js";import{L as oe}from"./loader-circle-CwUrmZrV.js";const de=t("arrow-left-right",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]),xe=t("arrow-up-down",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]),me=t("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),he=t("file-digit",[["path",{d:"M4 12V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2",key:"jrl274"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 16h2v6",key:"1bxocy"}],["path",{d:"M10 22h4",key:"ceow96"}],["rect",{x:"2",y:"16",width:"4",height:"6",rx:"2",key:"r45zd0"}]]),pe=t("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]),ue=t("ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]),ge=t("shield-alert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]),je=t("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]);class be extends s.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}render(){var s;return this.state.hasError?e.jsx("div",{className:"map-container-16-9 glass-card flex items-center justify-center",role:"alert","aria-live":"assertive",children:e.jsxs("div",{className:"text-center text-white/50 p-4",children:[e.jsx("p",{className:"text-lg mb-2",children:"Map failed to load"}),e.jsx("p",{className:"text-sm text-white/30",children:(null==(s=this.state.error)?void 0:s.message)||"Unknown error"}),e.jsx("p",{className:"text-xs text-white/20 mt-2",children:"Try refreshing the page or check your browser's WebGL support."})]})}):this.props.children}}const Ne=s.lazy(()=>P(()=>import("./ContactsMapMapLibre-CsZGQooS.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33])));function ve({neighbors:t,localNode:a,localHash:n,onRemoveNode:l,selectedNodeHash:c,onNodeSelected:r,highlightedEdgeKey:i,highlightedGhost:o}){return e.jsx(be,{children:e.jsx(s.Suspense,{fallback:e.jsx("div",{className:"map-container-16-9 glass-card flex items-center justify-center",role:"status","aria-live":"polite","aria-label":"Loading map",children:e.jsxs("div",{className:"text-white/50 flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-accent-primary border-t-transparent rounded-full animate-spin","aria-hidden":"true"}),e.jsx("span",{children:"Loading map..."})]})}),children:e.jsx(Ne,{neighbors:t,localNode:a,localHash:n,onRemoveNode:l,selectedNodeHash:c,onNodeSelected:r,highlightedEdgeKey:i,highlightedGhost:o})})})}function fe(e){return e>=.7?"text-accent-success":e>=.5?"text-accent-secondary":e>=.3?"text-signal-poor":"text-accent-danger"}function ye(e){return`${Math.round(100*e)}%`}function we(e,s){return s.has(e.toUpperCase())}const ke=s.memo(function({path:s,isHighlighted:t,onHighlight:a,ghostPrefixes:n}){const l=function(s){return s>.2?{icon:e.jsx(T,{className:"w-3 h-3"}),color:"text-accent-success"}:s<-.2?{icon:e.jsx(R,{className:"w-3 h-3"}),color:"text-accent-danger"}:{icon:e.jsx($,{className:"w-3 h-3"}),color:"text-text-muted"}}(s.observationTrend),r=s.weakestLinkKey&&s.weakestLinkConfidence<.5,i=s.hops.some(e=>we(e,n));return e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-md transition-colors cursor-pointer "+(t?"bg-accent-primary/20 border border-accent-primary/40":"hover:bg-white/5"),onClick:()=>a(t?null:s.weakestLinkKey),children:[e.jsx("div",{className:"flex-shrink-0 w-12 text-center py-1 rounded-md "+(o=s.healthScore,o>=.7?"bg-accent-success/10":o>=.5?"bg-accent-secondary/10":o>=.3?"bg-signal-poor/10":"bg-accent-danger/10"),children:e.jsx("span",{className:`text-xs font-semibold tabular-nums ${fe(s.healthScore)}`,children:ye(s.healthScore)})}),e.jsx("div",{className:"flex-1 flex items-center gap-0.5 overflow-x-auto min-w-0",children:s.hops.map((t,a)=>{var l;const i=we(t,n),o=r&&(null==(l=s.weakestLinkKey)?void 0:l.includes(t));return e.jsxs("span",{className:"flex items-center",children:[e.jsxs("span",{className:"text-[10px] font-mono px-1.5 py-0.5 rounded flex items-center gap-0.5 "+(i?"bg-accent-tertiary/20 text-accent-tertiary border border-accent-tertiary/30":o?"bg-accent-danger/20 text-accent-danger":"bg-white/10 text-text-secondary"),children:[i&&e.jsx(c,{className:"w-2.5 h-2.5"}),t]}),a<s.hops.length-1&&e.jsx("span",{className:"text-text-muted mx-0.5",children:"→"})]},a)})}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-3",children:[e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded "+("direct"===s.routeType?"bg-accent-success/20 text-accent-success":"flood"===s.routeType?"bg-accent-primary/20 text-accent-primary":"bg-white/10 text-text-muted"),children:"direct"===s.routeType?"D":"flood"===s.routeType?"F":"M"}),e.jsxs("div",{className:"flex items-center gap-1 text-text-muted",title:"Estimated latency",children:[e.jsx(G,{className:"w-3 h-3"}),e.jsxs("span",{className:"text-[10px] tabular-nums",children:[s.estimatedLatencyMs,"ms"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-text-muted",title:"Observations",children:[e.jsx(O,{className:"w-3 h-3"}),e.jsx("span",{className:"text-[10px] tabular-nums",children:s.observationCount})]}),e.jsx("div",{className:`flex items-center gap-1 ${l.color}`,title:"Usage trend",children:l.icon}),i&&e.jsx("div",{className:"text-accent-tertiary",title:"Path includes ghost (unknown) nodes",children:e.jsx(c,{className:"w-3 h-3"})}),r&&e.jsx("div",{className:"text-accent-danger",title:`Weak link: ${s.weakestLinkConfidence.toFixed(0)}% confidence`,children:e.jsx(E,{className:"w-3 h-3"})})]})]});var o}),Ce=s.memo(function({maxPaths:t=10,onHighlightEdge:i,highlightedEdge:o}){const d=a(),x=n(),m=l(),[h,p]=s.useState(!1),u=s.useMemo(()=>new Set(m.map(e=>e.prefix.toUpperCase())),[m]),g=s.useMemo(()=>d.slice(0,t),[d,t]),j=s.useMemo(()=>0===d.length?null:{avgHealth:d.reduce((e,s)=>e+s.healthScore,0)/d.length,declining:d.filter(e=>e.observationTrend<-.2).length,weakLinks:d.filter(e=>e.weakestLinkConfidence<.5).length,pathsWithGhosts:d.filter(e=>e.hops.some(e=>u.has(e.toUpperCase()))).length},[d,u]),b=e=>{null==i||i(e)};return 0===d.length?null:e.jsxs("div",{className:"chart-container",children:[e.jsxs("button",{onClick:()=>p(!h),className:"w-full chart-header hover:bg-white/5 transition-colors rounded-t-lg cursor-pointer",children:[e.jsxs("div",{className:"chart-title",children:[e.jsx(F,{className:"chart-title-icon"}),"Path Health",e.jsxs("span",{className:"ml-2 text-[10px] font-normal text-text-muted",children:["(",d.length," paths)"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[j&&e.jsxs("div",{className:"flex items-center gap-3 text-[10px]",children:[e.jsxs("span",{className:`tabular-nums ${fe(j.avgHealth)}`,children:["Avg: ",ye(j.avgHealth)]}),j.weakLinks>0&&e.jsxs("span",{className:"text-accent-danger flex items-center gap-1",children:[e.jsx(E,{className:"w-3 h-3"}),j.weakLinks," weak"]}),j.declining>0&&e.jsxs("span",{className:"text-signal-poor flex items-center gap-1",children:[e.jsx(R,{className:"w-3 h-3"}),j.declining," declining"]}),j.pathsWithGhosts>0&&e.jsxs("span",{className:"text-accent-tertiary flex items-center gap-1",children:[e.jsx(c,{className:"w-3 h-3"}),j.pathsWithGhosts," ghost"]})]}),h?e.jsx(A,{className:"w-4 h-4 text-text-muted"}):e.jsx(r,{className:"w-4 h-4 text-text-muted"})]})]}),h&&e.jsxs("div",{className:"p-3 pt-0 space-y-1",children:[x.totalPaths>0&&e.jsxs("div",{className:"flex items-center gap-3 text-[10px] text-text-muted pb-2 border-b border-white/5",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"w-3 h-3 text-accent-primary"}),e.jsx("span",{className:"text-text-secondary",children:x.totalPaths.toLocaleString()})," Viterbi decoded"]}),x.observationOverrideCount>0&&e.jsxs("span",{className:"text-accent-success",children:[Math.round(x.observationOverrideCount/x.totalPaths*100),"% observation override"]}),m.length>0&&e.jsxs("span",{className:"text-accent-tertiary flex items-center gap-1",children:[e.jsx(c,{className:"w-3 h-3"}),m.length," ghost",1!==m.length?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-[10px] text-text-muted pb-2 border-b border-white/5",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-accent-success"})," Healthy (≥70%)"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-accent-secondary"})," Fair (50-70%)"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-signal-poor"})," Weak (30-50%)"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-accent-danger"})," Critical (<30%)"]}),m.length>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(c,{className:"w-3 h-3 text-accent-tertiary"})," Ghost"]})]}),e.jsx("div",{className:"space-y-1 max-h-64 overflow-y-auto",children:g.map(s=>e.jsx(ke,{path:s,isHighlighted:o===s.weakestLinkKey,onHighlight:b,ghostPrefixes:u},s.pathKey))}),d.length>t&&e.jsxs("div",{className:"text-center text-[10px] text-text-muted pt-2",children:["Showing top ",t," of ",d.length," paths"]})]})]})});function Me(e){switch(e){case"rf_intersection":return"RF Circle Intersection";case"weighted_centroid":return"Weighted Centroid";case"single_anchor":return"Single Anchor (less reliable)";default:return e}}const Se={confirmed:{label:"Confirmed",icon:e.jsx(je,{className:"w-3.5 h-3.5"}),borderClass:"border-accent-success/40",bgClass:"bg-accent-success/10",textClass:"text-accent-success",badgeClass:"bg-accent-success/20 text-accent-success"},likely:{label:"Likely",icon:e.jsx(X,{className:"w-3.5 h-3.5"}),borderClass:"border-accent-tertiary/30",bgClass:"bg-accent-tertiary/5",textClass:"text-accent-tertiary",badgeClass:"bg-accent-tertiary/20 text-accent-tertiary"},possible:{label:"Possible",icon:e.jsx(I,{className:"w-3.5 h-3.5"}),borderClass:"border-accent-secondary/20",bgClass:"bg-accent-secondary/5",textClass:"text-accent-secondary",badgeClass:"bg-accent-secondary/20 text-accent-secondary"},noise:{label:"Noise",icon:e.jsx(E,{className:"w-3.5 h-3.5"}),borderClass:"border-border-muted",bgClass:"bg-bg-card/30",textClass:"text-text-muted",badgeClass:"bg-bg-elevated text-text-muted"}};function Le({ghost:t,neighbors:a,isExpanded:n,onToggle:l,compact:d}){var x,m;const h=(null==(x=t.classification)?void 0:x.tier)??"noise",p=Se[h],u="clusterId"in(g=t)&&"temporal"in g;var g;const j=s.useMemo(()=>Array.from(t.commonNeighbors).map(e=>{var s;return{hash:e,name:null==(s=a[e])?void 0:s.name}}),[t.commonNeighbors,a]),b=t.estimatedLocation?t.estimatedLocation.uncertaintyM>=1e3?`±${(t.estimatedLocation.uncertaintyM/1e3).toFixed(1)}km`:`±${Math.round(t.estimatedLocation.uncertaintyM)}m`:null,N=u&&t.temporal?(v=t.temporal.consistency)>=.7?{label:"Steady",color:"text-accent-success"}:v>=.4?{label:"Regular",color:"text-accent-tertiary"}:v>=.2?{label:"Sporadic",color:"text-accent-secondary"}:{label:"Bursty",color:"text-signal-poor"}:null;var v;const f=u&&t.collisionCandidates&&t.collisionCandidates.length>0,y=f?t.collisionCandidates[0]:null;return d?e.jsxs("div",{className:"inline-flex items-center gap-1.5 px-2 py-1 rounded bg-bg-elevated/50 text-sm",children:[e.jsx("span",{className:"font-mono font-medium text-text-secondary",children:t.prefix.toUpperCase()}),e.jsx("span",{className:"text-text-muted",children:t.observationCount})]}):e.jsxs("div",{className:K("rounded-lg border transition-all duration-150",p.borderClass,p.bgClass),children:[e.jsxs("button",{onClick:l,className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-white/5 rounded-lg",children:[e.jsx(c,{className:K("w-5 h-5 flex-shrink-0",p.textClass)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-sm font-semibold text-text-primary",children:t.prefix.toUpperCase()}),e.jsx("span",{className:K("px-1.5 py-0.5 rounded text-sm font-medium",p.badgeClass),children:p.label})]}),e.jsx("div",{className:K("text-sm mt-0.5",p.textClass),children:(null==(m=t.classification)?void 0:m.reason)??"Unknown"}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-text-muted mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"w-3 h-3"}),t.observationCount]}),e.jsxs("span",{children:[(100*t.confidence).toFixed(0),"%"]}),t.commonNeighbors.size>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:"w-3 h-3"}),t.commonNeighbors.size]}),t.estimatedLocation&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"w-3 h-3"}),b]}),N&&e.jsxs("span",{className:K("flex items-center gap-1",N.color),children:[e.jsx(O,{className:"w-3 h-3"}),N.label]}),f&&e.jsxs("span",{className:"flex items-center gap-1 text-signal-poor",children:[e.jsx(ge,{className:"w-3 h-3"}),"Collision?"]})]})]}),n?e.jsx(A,{className:"w-4 h-4 text-text-muted"}):e.jsx(r,{className:"w-4 h-4 text-text-muted"})]}),n&&e.jsxs("div",{className:"px-3 pb-3 space-y-3 border-t border-border-muted/50 mt-1 pt-3",children:[f&&y&&e.jsx("div",{className:"p-2 rounded bg-signal-poor/10 border border-signal-poor/30",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ge,{className:"w-4 h-4 text-signal-poor flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-signal-poor font-medium",children:"Possible collision with known node"}),e.jsx("div",{className:"text-text-secondary mt-0.5",children:y.knownNodeName?e.jsxs("span",{children:["May match ",e.jsx("span",{className:"font-medium",children:y.knownNodeName})," ","(",(100*y.collisionProbability).toFixed(0),"% probability)"]}):e.jsxs("span",{children:["May match ",e.jsx(B,{copy:!0,size:"compact",className:"inline",children:y.knownNodeHash})," ","(",(100*y.collisionProbability).toFixed(0),"% probability)"]})}),y.evidence&&e.jsxs("div",{className:"text-text-muted mt-1 text-[10px]",children:[y.evidence.sharedEdgeCount>0&&e.jsxs("span",{className:"mr-2",children:[y.evidence.sharedEdgeCount," shared edges"]}),void 0!==y.evidence.distanceKm&&e.jsxs("span",{className:"mr-2",children:[y.evidence.distanceKm.toFixed(1),"km apart"]}),y.evidence.withinUncertainty&&e.jsx("span",{className:"text-accent-secondary",children:"Within uncertainty radius"})]})]})]})}),t.estimatedLocation?e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ee,{className:"w-4 h-4 text-accent-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"text-text-primary font-medium",children:[t.estimatedLocation.lat.toFixed(5),", ",t.estimatedLocation.lon.toFixed(5)]}),e.jsxs("div",{className:"text-text-muted",children:["Uncertainty: ",b]}),u&&t.location&&e.jsxs("div",{className:"mt-1 text-text-muted",children:[e.jsxs("div",{children:["Method: ",Me(t.location.method)]}),t.location.anchors&&t.location.anchors.length>0&&e.jsxs("div",{children:[t.location.anchors.length," anchor",1!==t.location.anchors.length?"s":""," used"," · ",(100*t.location.locationConfidence).toFixed(0),"% confidence"]})]})]})]}):e.jsxs("div",{className:"flex items-center gap-2 text-sm text-text-muted",children:[e.jsx(E,{className:"w-4 h-4 text-signal-poor"}),"Location unknown (neighbors lack coordinates)"]}),u&&t.temporal&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(O,{className:"w-4 h-4 text-text-muted mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"text-text-primary font-medium",children:["Temporal Pattern: ",e.jsx("span",{className:null==N?void 0:N.color,children:null==N?void 0:N.label})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-0.5 mt-1 text-text-muted",children:[e.jsxs("span",{children:["Distinct hours: ",t.temporal.distinctHours]}),e.jsxs("span",{children:["Distinct days: ",t.temporal.distinctDays]}),e.jsxs("span",{children:["Burstiness: ",(100*t.temporal.burstiness).toFixed(0),"%"]}),e.jsxs("span",{children:["Consistency: ",(100*t.temporal.consistency).toFixed(0),"%"]}),e.jsxs("span",{children:["Last 24h: ",t.temporal.last24HourCount," obs"]}),e.jsxs("span",{children:["Active hours: ",t.temporal.activeHoursLast24,"/24"]})]})]})]}),!u&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(i,{className:"w-4 h-4 text-text-muted mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"text-text-primary",children:["First seen: ",o(t.firstSeen)," ago"]}),e.jsxs("div",{className:"text-text-muted",children:["Last seen: ",o(t.lastSeen)," ago"]})]})]}),u&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-text-muted mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"text-text-primary",children:["Active period: ",o(t.firstSeen)," – ",o(t.lastSeen)," ago"]}),t.temporal&&e.jsxs("div",{className:"text-text-muted",children:["Obs/hour avg: ",t.temporal.observationsPerHour.toFixed(1)]})]})]}),j.length>0&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-text-muted mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"text-text-muted mb-1",children:["Adjacent to ",j.length," known node",1!==j.length?"s":"",":"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[j.slice(0,5).map(({hash:s})=>e.jsx(B,{copy:!0,size:"compact",children:s},s)),j.length>5&&e.jsxs("span",{className:"text-text-muted",children:["+",j.length-5," more"]})]})]})]}),u&&t.validationStages&&e.jsxs("div",{className:"pt-2 border-t border-border-muted/30",children:[e.jsx("div",{className:"text-[10px] text-text-muted mb-1.5 uppercase tracking-wide",children:"Validation Stages"}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[e.jsx(He,{label:"Candidates",passed:t.validationStages.candidateExhaustion}),e.jsx(He,{label:"Temporal",passed:t.validationStages.temporalConsistency}),e.jsx(He,{label:"Topology",passed:t.validationStages.topologicalFit}),e.jsx(He,{label:"Location",passed:t.validationStages.locationPlausible})]})]}),t.classification&&!u&&e.jsx("div",{className:"pt-2 border-t border-border-muted/30",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.classification.criteria.hasVeryHighObservations&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-accent-success/20 text-accent-success",children:"200+ obs"}),t.classification.criteria.hasHighObservations&&!t.classification.criteria.hasVeryHighObservations&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-accent-tertiary/20 text-accent-tertiary",children:"50+ obs"}),t.classification.criteria.hasHighConfidence&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-accent-success/20 text-accent-success",children:"70%+ conf"}),t.classification.criteria.hasCommonNeighbors&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-accent-primary/20 text-accent-primary",children:"2+ neighbors"}),t.classification.criteria.hasGoodLocation&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-accent-primary/20 text-accent-primary",children:"good loc"}),t.classification.criteria.isRecent&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-text-muted/20 text-text-muted",children:"recent"})]})}),u&&t.upgradeRequirements&&t.upgradeRequirements.length>0&&"confirmed"!==h&&e.jsxs("div",{className:"pt-2 border-t border-border-muted/30",children:[e.jsx("div",{className:"text-[10px] text-text-muted mb-1 uppercase tracking-wide",children:"To upgrade tier:"}),e.jsx("ul",{className:"text-xs text-text-secondary space-y-0.5",children:t.upgradeRequirements.slice(0,3).map((s,t)=>e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-accent-tertiary",children:"•"})," ",s]},t))})]})]})]})}function He({label:s,passed:t}){return e.jsxs("span",{className:K("inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-medium",t?"bg-accent-success/20 text-accent-success":"bg-bg-elevated text-text-muted"),children:[t?e.jsx(se,{className:"w-2.5 h-2.5"}):e.jsx(te,{className:"w-2.5 h-2.5"}),s]})}function Pe({neighbors:t,className:a,onGhostSelect:i}){const o=l(),d=n(),[x,m]=s.useState(new Set),[h,p]=s.useState("actionable"),[u,g]=s.useState(!1),[j,b]=s.useState(!0),[N,v]=s.useState(Date.now);s.useEffect(()=>{v(Date.now())},[o]);const f=s.useMemo(()=>o.filter(e=>!function(e,s){return s-1e3*e.lastSeen>6048e5}(e,N)),[o,N]),y=s.useMemo(()=>{const e=Array.from(x);return e.length>0?e[0]:null},[x]),w=s.useMemo(()=>y?f.find(e=>e.prefix===y)??null:null,[y,f]);s.useEffect(()=>{i&&i(w&&!j?{prefix:w.prefix,commonNeighbors:Array.from(w.commonNeighbors),estimatedLocation:w.estimatedLocation}:null)},[w,j,i]),s.useEffect(()=>{j&&m(new Set)},[j]);const{confirmed:k,likely:C,possible:M,noise:S,actionableCount:L}=s.useMemo(()=>{var e;const s=[],t=[],a=[],n=[];for(const c of f)switch((null==(e=c.classification)?void 0:e.tier)??"noise"){case"confirmed":s.push(c);break;case"likely":t.push(c);break;case"possible":a.push(c);break;case"noise":n.push(c)}const l=(e,s)=>s.observationCount-e.observationCount;return s.sort(l),t.sort(l),a.sort(l),n.sort(l),{confirmed:s,likely:t,possible:a,noise:n,actionableCount:s.length+t.length}},[f]);if(0===f.length)return null;const H=e=>{m(s=>s.has(e)?new Set:new Set([e]))},P="all"===h,F=k.length+C.length+(P?M.length:0)+(u?S.length:0);return e.jsxs("div",{className:a,children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"chart-title",children:[e.jsx(c,{className:"chart-title-icon"}),"Ghost Buster",L>0&&e.jsxs("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-accent-success/20 text-accent-success",children:[L," actionable"]}),j&&f.length>0&&e.jsxs("span",{className:"text-xs text-text-muted ml-2",children:["(",f.length," total)"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!j&&e.jsxs("button",{onClick:()=>p(e=>"actionable"===e?"all":"actionable"),className:K("flex items-center gap-1.5 px-2 py-1 rounded text-xs transition-colors","all"===h?"bg-accent-primary/20 text-accent-primary":"bg-bg-elevated text-text-muted hover:text-text-secondary"),children:[e.jsx(q,{className:"w-3 h-3"}),"actionable"===h?"Actionable":"All"]}),e.jsx("button",{onClick:()=>b(e=>!e),className:"flex items-center gap-1 px-2 py-1 rounded text-xs bg-bg-elevated text-text-muted hover:text-text-secondary transition-colors",title:j?"Expand panel":"Minimize panel",children:j?e.jsx(Z,{className:"w-3 h-3"}):e.jsx($,{className:"w-3 h-3"})})]})]}),j?e.jsxs("div",{className:"px-5 py-3 flex items-center gap-3 text-xs cursor-pointer hover:bg-white/5 transition-colors",onClick:()=>b(!1),children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[k.length>0&&e.jsxs("span",{className:"flex items-center gap-1 text-accent-success",children:[e.jsx(je,{className:"w-3 h-3"}),k.length," confirmed"]}),C.length>0&&e.jsxs("span",{className:"flex items-center gap-1 text-accent-tertiary",children:[e.jsx(X,{className:"w-3 h-3"}),C.length," likely"]}),M.length>0&&e.jsxs("span",{className:"text-accent-secondary",children:[M.length," possible"]}),S.length>0&&e.jsxs("span",{className:"text-text-muted",children:[S.length," noise"]})]}),e.jsx("span",{className:"text-text-muted ml-auto",children:"Click to expand"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-5 py-2 flex items-center gap-3 text-xs border-b border-border-muted/30",children:[e.jsxs("span",{className:"text-text-muted",children:[d.pathsWithGhosts.toLocaleString()," / ",d.totalPaths.toLocaleString()," paths"]}),e.jsx("span",{className:"text-text-muted",children:"•"}),e.jsxs("div",{className:"flex items-center gap-2",children:[k.length>0&&e.jsxs("span",{className:"text-accent-success",children:[k.length," confirmed"]}),C.length>0&&e.jsxs("span",{className:"text-accent-tertiary",children:[C.length," likely"]}),M.length>0&&e.jsxs("span",{className:"text-accent-secondary",children:[M.length," possible"]}),S.length>0&&e.jsxs("span",{className:"text-text-muted",children:[S.length," noise"]})]})]}),e.jsxs("div",{className:"px-5 py-4 space-y-4",children:[k.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-accent-success",children:[e.jsx(je,{className:"w-3.5 h-3.5"}),e.jsxs("span",{className:"font-medium",children:["Confirmed Repeaters (",k.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:k.map(s=>e.jsx(Le,{ghost:s,neighbors:t,isExpanded:x.has(s.prefix),onToggle:()=>H(s.prefix)},s.prefix))})]}),C.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-accent-tertiary",children:[e.jsx(X,{className:"w-3.5 h-3.5"}),e.jsxs("span",{className:"font-medium",children:["Likely Repeaters (",C.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:C.map(s=>e.jsx(Le,{ghost:s,neighbors:t,isExpanded:x.has(s.prefix),onToggle:()=>H(s.prefix)},s.prefix))})]}),P&&M.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-accent-secondary",children:[e.jsx(I,{className:"w-3.5 h-3.5"}),e.jsxs("span",{className:"font-medium",children:["Possible (",M.length,")"]})]}),e.jsxs("div",{className:"space-y-2",children:[M.slice(0,10).map(s=>e.jsx(Le,{ghost:s,neighbors:t,isExpanded:x.has(s.prefix),onToggle:()=>H(s.prefix)},s.prefix)),M.length>10&&e.jsxs("div",{className:"text-xs text-text-muted text-center py-1",children:["+",M.length-10," more possible nodes"]})]})]}),S.length>0&&"all"===h&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>g(!u),className:"flex items-center gap-2 text-xs text-text-muted hover:text-text-secondary transition-colors",children:[u?e.jsx(A,{className:"w-3.5 h-3.5"}):e.jsx(r,{className:"w-3.5 h-3.5"}),e.jsx(E,{className:"w-3.5 h-3.5"}),e.jsxs("span",{children:["Noise (",S.length,")"]})]}),u&&e.jsx("div",{className:"flex flex-wrap gap-1",children:S.map(s=>e.jsx(Le,{ghost:s,neighbors:t,isExpanded:!1,onToggle:()=>{},compact:!0},s.prefix))})]}),"actionable"===h&&0===L&&e.jsxs("div",{className:"text-center py-6 text-sm text-text-muted",children:[e.jsx(c,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No confirmed or likely repeaters yet."}),e.jsxs("p",{className:"text-xs mt-1",children:[M.length+S.length," prefixes need more evidence."]}),e.jsxs("button",{onClick:()=>p("all"),className:"mt-3 text-accent-primary hover:underline",children:["View all ",f.length," discovered nodes"]})]}),d.observationOverrideCount>0&&F>0&&e.jsxs("div",{className:"pt-2 border-t border-border-muted/30 text-xs text-text-muted",children:[e.jsx("span",{className:"text-accent-primary",children:d.observationOverrideCount})," observation overrides • Avg confidence: ",e.jsxs("span",{className:"text-accent-secondary",children:[(100*d.avgPathConfidence).toFixed(0),"%"]})]})]})]})]})}const Fe="var(--sparkline-critical)",Ee="var(--sparkline-poor)",Re="var(--sparkline-fair)",Te="var(--sparkline-good)",$e="var(--sparkline-excellent)";function Ae({active:s,payload:t}){if(!s||!t||!t.length)return null;const a=t[0].payload,n=new Date(a.timestamp),l=`${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getDate().toString().padStart(2,"0")}`;return e.jsxs("div",{className:"bg-tooltip-bg border border-border-subtle rounded px-1.5 py-0.5 text-[10px] shadow-xl",children:[e.jsx("span",{className:"text-text-muted",children:l}),e.jsx("span",{className:"ml-1.5 font-semibold tabular-nums",children:a.count})]})}const Oe=s.memo(function({nodeHash:s,width:t=60,height:a=20,color:n,showArea:l=!0,showTooltip:c=!1,className:r=""}){const i=d(s),o=x(),h=!m().backgroundLoadComplete||o,p=n??(i.length>0?function(e){if(0===e.length)return Fe;const s=e.slice(-4),t=s.reduce((e,s)=>e+s.count,0),a=t/s.length,n=e.reduce((e,s)=>e+s.count,0)/e.length;if(0===t)return Fe;if(n>0){const e=a/n;return e>=1.2?$e:e>=.8?Te:e>=.4?Re:e>=.1?Ee:Fe}return t>=10?$e:t>=5?Te:t>=2?Re:t>=1?Ee:Fe}(i):"var(--text-muted)"),u="number"==typeof t?t:60,g=a;return h&&i.length<2?e.jsx("div",{className:`flex items-center justify-center ${r}`,style:{width:u,height:g},children:e.jsx("div",{className:"rounded animate-pulse bg-white/[0.06]",style:{width:u-8,height:g-6}})}):i.length<2?e.jsx("div",{className:`flex items-center justify-center ${r}`,style:{width:u,height:g,color:Fe},children:e.jsx("svg",{width:u,height:g,viewBox:`0 0 ${u} ${g}`,preserveAspectRatio:"none",children:e.jsx("line",{x1:4,y1:g/2,x2:u-4,y2:g/2,stroke:"currentColor",strokeWidth:1.5,strokeDasharray:"3,2"})})}):e.jsx("div",{className:r,style:{width:u,height:g},children:e.jsxs(U,{data:i,width:u,height:g,margin:{top:1,right:1,bottom:1,left:1},children:[c&&e.jsx(V,{content:e.jsx(Ae,{}),cursor:{stroke:"rgba(255,255,255,0.2)",strokeWidth:1}}),e.jsx(W,{type:"monotone",dataKey:"count",stroke:p,strokeWidth:1.5,dot:!1,isAnimationActive:!1})]})})}),_e=s.memo(function({hash:t,className:a="",size:l="sm"}){const c=h(),r=n(),[i,o]=s.useState(!1),d=s.useMemo(()=>p(t),[t]),x=s.useMemo(()=>d?c.find(e=>e.prefix===d)??null:null,[d,c]),m=r.totalPaths>0&&r.avgPathConfidence>=.7,u=s.useCallback(e=>{e.preventDefault(),e.stopPropagation(),o(!0)},[]),g=s.useCallback(()=>{o(!1)},[]);if(!x)return null;const j="sm"===l?"w-3.5 h-3.5":"w-4 h-4",b=m?"text-accent-tertiary hover:text-accent-tertiary hover:bg-accent-tertiary/10 focus:ring-accent-tertiary/50":"text-signal-fair hover:text-accent-secondary hover:bg-signal-fair/10 focus:ring-signal-fair/50",N=m?`Prefix conflict resolved by Viterbi HMM (${(100*r.avgPathConfidence).toFixed(0)}% confidence)`:`Prefix conflict: ${x.candidateCount} nodes share prefix "${d}"`;return e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:u,className:`inline-flex items-center justify-center p-0.5 rounded focus:outline-none focus:ring-2 transition-colors cursor-pointer touch-manipulation ${b} ${a}`,title:N,"aria-label":`View prefix conflict for ${d}${m?" (Viterbi resolved)":""}`,children:m?e.jsxs("span",{className:"relative",children:[e.jsx(_,{className:j}),e.jsx(X,{className:"absolute -bottom-0.5 -right-0.5 w-2 h-2 text-accent-success"})]}):e.jsx(he,{className:j})}),e.jsx(le,{isOpen:i,prefix:x.prefix,candidateHashes:x.candidateHashes,onClose:g})]})});function De(e,s,t,a){const n=(t-e)*Math.PI/180,l=(a-s)*Math.PI/180,c=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(t*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))*6371e3}const ze=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const{stats:t}=u(),a=g(),n=j(),c=b(),o=N(),d=v(),x=l(),m=f(),[h,p]=s.useState(null),[P,F]=s.useState("lastHeard"),[E,R]=s.useState("desc"),[T,$]=s.useState(""),[A,_]=s.useState(!1),[G,I]=s.useState(null),[K,U]=s.useState(null),[V,W]=s.useState(null),[q,Z]=s.useState(null),[se,te]=s.useState(new Map),[le,me]=s.useState(new Map),[he,ge]=s.useState(25),[je,be]=s.useState(25),Ne=s.useRef(null),[fe,ye]=s.useState(!1),we=s.useMemo(()=>(null==t?void 0:t.neighbors)??{},[null==t?void 0:t.neighbors]),ke=s.useMemo(()=>Object.fromEntries(Object.entries(we).filter(([e])=>!a.has(e))),[we,a]),Me=y(),Se=null==t?void 0:t.local_hash,Le=s.useMemo(()=>{const e=new Map;if(!(null==Me?void 0:Me.latitude)||!(null==Me?void 0:Me.longitude))return e;for(const[s,t]of Object.entries(ke))t.latitude&&t.longitude&&0!==t.latitude&&0!==t.longitude?e.set(s,De(Me.latitude,Me.longitude,t.latitude,t.longitude)):e.set(s,null);return e},[ke,Me]),{neighborHashSet:He,neighborSignalMap:Fe}=s.useMemo(()=>{const e=new Set,s=new Map;for(const t of d)e.add(t.hash),s.set(t.hash,{avgRssi:t.avgRssi,avgSnr:t.avgSnr});return{neighborHashSet:e,neighborSignalMap:s}},[d]),Ee=s.useMemo(()=>{const e=T.toLowerCase().trim(),s="neighbor"===e||"neighbors"===e,t=A||s;return Object.fromEntries(Object.entries(ke).filter(([a,n])=>{if(t&&!He.has(a))return!1;if(s)return!0;if(!e)return!0;const l=(n.node_name||n.name||"").toLowerCase(),c=a.slice(2,4).toLowerCase();return l.includes(e)||c.includes(e)||a.toLowerCase().includes(e)}))},[ke,T,A,He]),Re=s.useMemo(()=>Object.entries(Ee).sort(([e,s],[t,a])=>{let n=0;switch(P){case"lastHeard":n=(s.last_seen||0)-(a.last_seen||0);break;case"distance":{const s=Le.get(e)??null,a=Le.get(t)??null;n=null===s&&null===a?0:null===s?1:null===a?-1:s-a;break}case"centrality":n=(o.get(e)||0)-(o.get(t)||0)}return"desc"===E?-n:n}),[Ee,P,E,Le,o]),Te=Re.filter(([,e])=>e.latitude&&e.longitude&&0!==e.latitude&&0!==e.longitude).length,$e=s.useMemo(()=>new Set(c),[c]),Ae=s.useMemo(()=>0===he?Re:Re.slice(0,je),[Re,je,he]);s.useEffect(()=>{be(he||Re.length)},[P,E,T,A,he,Re.length]),s.useEffect(()=>{if(0===he)return;const e=new IntersectionObserver(e=>{e[0].isIntersecting&&je<Re.length&&be(e=>Math.min(e+he,Re.length))},{threshold:.1,rootMargin:"100px"});return Ne.current&&e.observe(Ne.current),()=>e.disconnect()},[he,je,Re.length]);const ze=s.useCallback(e=>{ge(e),be(e||Re.length),ye(!1)},[Re.length]),Ge=s.useCallback(e=>{P===e?R(e=>"desc"===e?"asc":"desc"):(F(e),R("desc"))},[P]),Ie=s.useCallback(e=>{const s=ke[e];(null==s?void 0:s.latitude)&&(null==s?void 0:s.longitude)&&0!==s.latitude&&0!==s.longitude&&I(e)},[ke]),Ke=s.useCallback(()=>{I(null)},[]),Ue=s.useCallback(async(e,s)=>{if(s.stopPropagation(),!q){Z(e),te(s=>{const t=new Map(s);return t.delete(e),t}),me(s=>{const t=new Map(s);return t.delete(e),t});try{const s=e.startsWith("0x")?e.slice(0,4):`0x${e.slice(0,2)}`,t=await S(s,30);t.success&&t.data?(te(s=>new Map(s).set(e,t.data)),setTimeout(()=>{te(s=>{const t=new Map(s);return t.delete(e),t})},1e4)):(me(s=>new Map(s).set(e,t.error||"Ping failed")),setTimeout(()=>{me(s=>{const t=new Map(s);return t.delete(e),t})},5e3))}catch(t){const s=t instanceof Error?t.message:"Ping failed";me(t=>new Map(t).set(e,s)),setTimeout(()=>{me(s=>{const t=new Map(s);return t.delete(e),t})},5e3)}finally{Z(null)}}},[q]);return e.jsxs(L,{children:[e.jsx(H,{title:"Contacts",icon:e.jsx(Y,{}),controls:e.jsxs("div",{className:"flex items-baseline gap-3 sm:gap-4",children:[e.jsxs("span",{className:"roster-title tabular-nums",children:[Re.length," node",1!==Re.length?"s":""]}),Te>0&&e.jsxs("span",{className:"roster-title flex items-baseline gap-1.5 tabular-nums",children:[e.jsx(ee,{className:"w-3.5 h-3.5 relative top-[2px]"}),Te," with location"]})]})}),m?e.jsx(ve,{neighbors:ke,localNode:Me??void 0,localHash:Se,onRemoveNode:n,selectedNodeHash:G,onNodeSelected:Ke,highlightedEdgeKey:K,highlightedGhost:V}):e.jsx("div",{className:"glass-card aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-accent-primary border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm text-text-muted",children:"Loading map..."})]})}),e.jsx(Ce,{maxPaths:10,highlightedEdge:K,onHighlightEdge:U}),x.length>0&&(m?e.jsx("div",{className:"chart-container",children:e.jsx(Pe,{neighbors:ke,onGhostSelect:W})}):e.jsxs("div",{className:"glass-card",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-bg-elevated animate-pulse"}),e.jsx("div",{className:"w-24 h-4 rounded bg-bg-elevated animate-pulse"})]}),e.jsx("div",{className:"w-6 h-6 rounded bg-bg-elevated animate-pulse"})]}),e.jsx("div",{className:"px-5 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-20 h-4 rounded bg-bg-elevated animate-pulse"}),e.jsx("div",{className:"w-16 h-4 rounded bg-bg-elevated animate-pulse"})]})})]})),e.jsx("div",{className:"chart-container",children:m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"chart-title",children:[e.jsx(Y,{className:"chart-title-icon"}),"Discovered Contacts"]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[He.size>0&&e.jsxs("button",{onClick:()=>_(!A),className:"flex items-center gap-1 px-1.5 sm:px-2.5 py-1.5 text-sm rounded-lg transition-colors "+(A?"bg-accent-success/20 text-accent-success border border-accent-success/30":"text-text-muted hover:text-text-secondary hover:bg-white/5 border border-transparent"),title:A?"Show all contacts":"Show only MeshCore neighbors (direct RF contact)",children:[e.jsx(w,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Neighbors"}),e.jsx("span",{className:"sm:hidden tabular-nums",children:He.size})]}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-text-muted"}),e.jsx("input",{type:"text",name:"contact-search",id:"contact-search",autoComplete:"off",value:T,onChange:e=>$(e.target.value),placeholder:"Search...",className:"w-20 sm:w-28 lg:w-32 pl-6 sm:pl-7 pr-6 py-1.5 text-sm bg-white/5 border border-white/10 rounded-lg text-text-primary placeholder:text-text-muted focus:outline-none focus:border-accent-primary/50"}),T&&e.jsx("button",{onClick:()=>{$(""),"neighbor"!==T.toLowerCase().trim()&&"neighbors"!==T.toLowerCase().trim()||_(!1)},className:"absolute right-1.5 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-secondary p-0.5",children:e.jsx(k,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex items-center gap-0.5 sm:gap-1",children:[e.jsxs("button",{onClick:()=>Ge("lastHeard"),className:"flex items-center gap-1 p-1.5 sm:px-2 sm:py-1.5 text-sm rounded-lg transition-colors "+("lastHeard"===P?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-secondary hover:bg-white/5"),title:"Sort by last heard",children:[e.jsx(i,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Recent"}),"lastHeard"===P&&e.jsx(xe,{className:"w-3 h-3 "+("asc"===E?"rotate-180":"")})]}),e.jsxs("button",{onClick:()=>Ge("distance"),className:"flex items-center gap-1 p-1.5 sm:px-2 sm:py-1.5 text-sm rounded-lg transition-colors "+("distance"===P?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-secondary hover:bg-white/5"),title:"Sort by distance",children:[e.jsx(ue,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Distance"}),"distance"===P&&e.jsx(xe,{className:"w-3 h-3 "+("asc"===E?"rotate-180":"")})]}),e.jsxs("button",{onClick:()=>Ge("centrality"),className:"flex items-center gap-1 p-1.5 sm:px-2 sm:py-1.5 text-sm rounded-lg transition-colors "+("centrality"===P?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-secondary hover:bg-white/5"),title:"Sort by network centrality",children:[e.jsx(O,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Centrality"}),"centrality"===P&&e.jsx(xe,{className:"w-3 h-3 "+("asc"===E?"rotate-180":"")})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>ye(!fe),className:"flex items-center gap-1 px-2 py-1.5 text-sm text-text-muted hover:text-text-secondary hover:bg-white/5 rounded-lg transition-colors",title:"Items per page",children:[e.jsx("span",{className:"tabular-nums",children:0===he?"All":he}),e.jsx(r,{className:"w-3 h-3 transition-transform "+(fe?"rotate-180":"")})]}),fe&&e.jsx("div",{className:"absolute right-0 top-full mt-1 z-50 bg-bg-surface border border-border-subtle rounded-lg shadow-lg py-1 min-w-[80px]",children:[25,50,100,0].map(s=>e.jsx("button",{onClick:()=>ze(s),className:"w-full px-3 py-1.5 text-sm text-left hover:bg-white/5 transition-colors "+(he===s?"text-accent-primary":"text-text-secondary"),children:0===s?"All":s},s))})]})]})]}),Re.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden sm:grid contacts-grid-header border-b border-border-subtle/50 px-3 py-2 text-[10px] uppercase tracking-wider text-text-muted",children:[e.jsx("div",{className:"contacts-col-node",children:"Node"}),e.jsx("div",{className:"contacts-col-signal text-right",children:"Signal"}),e.jsx("div",{className:"contacts-col-distance text-right",children:"Distance"}),e.jsx("div",{className:"contacts-col-centrality text-right",children:"Centrality"}),e.jsx("div",{className:"contacts-col-activity text-center",children:"Activity"}),e.jsx("div",{className:"contacts-col-seen text-right",children:"Last Seen"}),e.jsx("div",{className:"contacts-col-actions"})]}),e.jsx("div",{className:"divide-y divide-border-subtle/30",children:Ae.map(([s,t])=>{var a;const n=t.latitude&&t.longitude&&0!==t.latitude&&0!==t.longitude,l=t.node_name||t.name||"Unknown",c=$e.has(s),r=He.has(s),i=Le.get(s),d=o.get(s)||0,x=r?Fe.get(s):void 0,m=r&&x,h=null==(a=t.contact_type)?void 0:a.toLowerCase(),u="room server"===h||"room_server"===h||"room"===h||"server"===h,g="companion"===h,j="client"===h||"cli"===h,b=t.is_repeater||"repeater"===h||"rep"===h,N=r?"direct":"flood",v=r?"Direct RF contact (zero-hop neighbor)":"Flood routing (multi-hop via mesh)";return e.jsxs("div",{className:`contacts-grid-row ${c?"bg-amber-500/5 border-l-2 border-l-amber-400":""} ${n?"cursor-pointer hover:bg-white/[0.02]":""}`,onClick:()=>Ie(s),children:[e.jsxs("div",{className:"contacts-col-node flex items-center gap-2 min-w-0",children:[m&&null!==(null==x?void 0:x.avgSnr)?e.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0 self-center "+(y=x.avgSnr,void 0===y?"bg-[var(--signal-unknown)]":y>=5?"bg-[var(--signal-excellent)]":y>=0?"bg-[var(--signal-good)]":y>=-5?"bg-[var(--signal-fair)]":y>=-10?"bg-[var(--signal-poor)]":"bg-[var(--signal-critical)]")}):e.jsx("div",{className:"w-2 flex-shrink-0"}),e.jsx("div",{className:"roster-icon flex-shrink-0",title:v,children:u&&b?e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx(pe,{className:"w-5 h-5 absolute inset-0 text-sys-pink"}),e.jsx(ce,{className:"w-2.5 h-2.5 absolute -bottom-0.5 -right-0.5 text-sys-teal"})]}):u?e.jsx(pe,{className:"w-5 h-5 text-sys-pink"}):g?e.jsx(re,{className:"w-5 h-5 text-text-muted"}):b?"direct"===N?e.jsx(de,{className:"w-5 h-5 text-sys-green"}):e.jsx(ce,{className:"w-5 h-5 text-sys-cyan"}):e.jsx(re,{className:"w-5 h-5 text-text-muted"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 overflow-hidden",children:[e.jsx("span",{className:"roster-title truncate",title:l,children:l}),r&&e.jsx(C,{color:ae.neighbor,compact:!0,className:"flex-shrink-0",children:"NBR"}),c&&e.jsxs(C,{color:ae.hub,compact:!0,className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx(ie,{className:"w-3 h-3"}),"HUB"]}),b&&e.jsx(C,{color:ae.repeater,compact:!0,className:"flex-shrink-0",children:"RPT"}),u&&e.jsx(C,{color:ae.room,compact:!0,className:"flex-shrink-0",children:"ROOM"}),g&&e.jsx(C,{color:ae.companion,compact:!0,className:"flex-shrink-0",children:"COMP"}),j&&e.jsx(C,{color:ae.client,compact:!0,className:"flex-shrink-0",children:"CLIENT"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[e.jsx(B,{copy:!0,size:"compact",truncate:[8,6],children:s}),e.jsx(_e,{hash:s})]})]})]}),e.jsxs("div",{className:"contacts-col-signal flex items-center justify-end gap-2",children:[m&&null!==(null==x?void 0:x.avgRssi)&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ne,{rssi:x.avgRssi,className:"w-3.5 h-3.5"}),e.jsx("span",{className:"type-data-xs tabular-nums text-text-muted",children:Math.round(x.avgRssi)})]}),m&&null!==(null==x?void 0:x.avgSnr)&&e.jsxs("span",{className:"type-data-xs tabular-nums text-text-muted",children:[x.avgSnr.toFixed(1)," dB"]})]}),e.jsx("div",{className:"contacts-col-distance flex items-center justify-end gap-1 text-text-muted",children:null!=i&&e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"w-3 h-3"}),e.jsx("span",{className:"type-data-xs tabular-nums",children:(f=i,f<1e3?`${Math.round(f)}m`:`${(f/1e3).toFixed(1)}km`)})]})}),e.jsx("div",{className:"contacts-col-centrality flex items-center justify-end gap-1",children:d>0&&e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-3 h-3 text-accent-secondary"}),e.jsxs("span",{className:"type-data-xs tabular-nums text-text-muted",children:[(100*d).toFixed(0),"%"]})]})}),e.jsx("div",{className:"contacts-col-activity flex items-center justify-center",children:e.jsx(Oe,{nodeHash:s,width:48,height:16})}),e.jsx("div",{className:"contacts-col-seen flex items-center justify-end",children:e.jsx("span",{className:"type-data-xs tabular-nums text-text-primary whitespace-nowrap",children:t.last_seen?M(t.last_seen):"—"})}),e.jsxs("div",{className:"contacts-col-actions flex items-center justify-end gap-1",children:[r&&e.jsx(e.Fragment,{children:se.has(s)?e.jsxs("div",{className:"flex items-center gap-1 text-accent-success",title:`RTT: ${se.get(s).rtt_ms.toFixed(0)}ms`,children:[e.jsx(X,{className:"w-3.5 h-3.5"}),e.jsxs("span",{className:"type-data-xs tabular-nums hidden sm:inline",children:[se.get(s).snr_db.toFixed(1),"dB"]})]}):le.has(s)?e.jsx("span",{className:"text-red-400 text-[10px]",title:le.get(s),children:"✗"}):e.jsx("button",{onClick:e=>Ue(s,e),disabled:null!==q,className:"p-1 sm:p-1.5 rounded-lg text-text-muted/50 hover:text-accent-primary hover:bg-accent-primary/10 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Ping neighbor for updated signal info",children:q===s?e.jsx(oe,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 animate-spin"}):e.jsx(z,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),p({hash:s,name:l})},className:"p-1 sm:p-1.5 rounded-lg text-text-muted/50 hover:text-red-400 hover:bg-red-500/10 transition-colors",title:"Remove contact",children:e.jsx(J,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})]})]},s);var f,y})}),he>0&&je<Re.length&&e.jsxs("div",{ref:Ne,className:"flex items-center justify-center py-4 text-text-muted",children:[e.jsx(oe,{className:"w-4 h-4 animate-spin mr-2"}),e.jsx("span",{className:"text-xs",children:"Loading more..."})]}),e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-t border-border-subtle/50 text-xs text-text-muted",children:[e.jsxs("span",{className:"tabular-nums",children:["Showing ",Ae.length," of ",Re.length]}),he>0&&je<Re.length&&e.jsx("button",{onClick:()=>be(e=>Math.min(e+he,Re.length)),className:"text-accent-primary hover:text-accent-primary/80 transition-colors",children:"Load more"})]})]}):e.jsxs("div",{className:"roster-empty",children:[e.jsx(Y,{className:"roster-empty-icon"}),e.jsx("div",{className:"type-label text-text-secondary",children:"No Contacts Discovered"}),e.jsx("div",{className:"type-data-xs text-text-muted mt-1",children:"Contacts will appear here as they advertise on the mesh network."})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-bg-elevated animate-pulse"}),e.jsx("div",{className:"w-32 h-4 rounded bg-bg-elevated animate-pulse"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 h-6 rounded bg-bg-elevated animate-pulse"}),e.jsx("div",{className:"w-24 h-6 rounded bg-bg-elevated animate-pulse"}),e.jsx("div",{className:"w-16 h-6 rounded bg-bg-elevated animate-pulse"})]})]}),e.jsx("div",{className:"px-3 py-3 space-y-3",children:[...Array(5)].map((s,t)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded bg-bg-elevated animate-pulse"}),e.jsxs("div",{className:"flex-1 space-y-1.5",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-bg-elevated animate-pulse"}),e.jsx("div",{className:"h-3 w-24 rounded bg-bg-elevated animate-pulse"})]}),e.jsx("div",{className:"w-12 h-4 rounded bg-bg-elevated animate-pulse"}),e.jsx("div",{className:"w-16 h-4 rounded bg-bg-elevated animate-pulse"})]},t))})]})}),e.jsx(Q,{isOpen:!!h,title:"Remove Contact",message:`Are you sure you would like to remove ${(null==h?void 0:h.name)||"this contact"}?`,confirmLabel:"Remove",cancelLabel:"Cancel",variant:"danger",onConfirm:()=>{h&&n(h.hash),p(null)},onCancel:()=>p(null)})]})}},Symbol.toStringTag,{value:"Module"}));export{ze as C,pe as M,Oe as N,_e as P,ue as R};
