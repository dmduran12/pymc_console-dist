const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PathMapMapLibre-Ouls8uhs.js","assets/vendor-react-C341c8YC.js","assets/vendor-core-WoOfkQwm.js","assets/BasemapLayer-S9Ush6Hh.js","assets/useThemeColors-AeHMyThq.js","assets/index-CPdqYR4z.js","assets/maplibre-gl-B1CfjdFi.css","assets/index-CIefRaAd.css"])))=>i.map(i=>d[i]);
import{j as e,r as t,an as s,ao as a,a0 as n,a1 as r,aj as l,ap as i,aq as c,ar as o,as as d,at as x,e as m,m as p,au as h,av as u,D as g,aw as f,ax as j,ay as y,az as b,aA as N,E as v,aB as w,aC as k,t as C,aD as S,ab as P,A as _,aE as T,aF as H,aG as B,aH as M,C as F,V as L,a9 as D,aI as z,a5 as A}from"./vendor-react-C341c8YC.js";import{n as E}from"./recharts-6XUQYgRA.js";import{y as R,B as U,z as I,A as $,C as V,E as Q,G as O,n as W,H as G,I as q,e as K,J as Y,K as J,M as X,N as Z,O as ee,Q as te,U as se,V as ae,W as ne}from"./index-CPdqYR4z.js";import{P as re,d as le,g as ie,a as ce,h as oe,b as de,c as xe,e as me,f as pe,i as he,j as ue}from"./channel-keys-DJWRrSwE.js";import{D as ge,S as fe,R as je,P as ye,g as be}from"./SignalIndicator-BLrEkFNb.js";import{_ as Ne}from"./deckgl-DTsmDcfs.js";import{D as ve}from"./DataBox-CRX76VsB.js";import{g as we,s as ke}from"./useThemeColors-AeHMyThq.js";function Ce({"aria-label":t="Page navigation",className:s,...a}){return e.jsx("nav",{"aria-label":t,...a,className:E("flex gap-x-2",s)})}function Se({onClick:t,disabled:s=!1,className:a,children:n="Previous"}){return e.jsx("span",{className:E("grow basis-0",a),children:e.jsxs(R,{plain:!0,onClick:t,disabled:s,"aria-label":"Previous page",className:E("gap-1",s&&"invisible"),children:[e.jsx("svg",{className:"size-4 stroke-current",viewBox:"0 0 16 16",fill:"none","aria-hidden":"true",children:e.jsx("path",{d:"M2.75 8H13.25M2.75 8L5.25 5.5M2.75 8L5.25 10.5",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})}),n]})})}function Pe({onClick:t,disabled:s=!1,className:a,children:n="Next"}){return e.jsx("span",{className:E("flex grow basis-0 justify-end",a),children:e.jsxs(R,{plain:!0,onClick:t,disabled:s,"aria-label":"Next page",className:E("gap-1",s&&"invisible"),children:[n,e.jsx("svg",{className:"size-4 stroke-current",viewBox:"0 0 16 16",fill:"none","aria-hidden":"true",children:e.jsx("path",{d:"M13.25 8L2.75 8M13.25 8L10.75 10.5M13.25 8L10.75 5.5",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})})]})})}function _e({className:t,...s}){return e.jsx("span",{...s,className:E("hidden items-baseline gap-x-2 sm:flex",t)})}function Te({page:t,current:s=!1,onClick:a,className:n,children:r}){return e.jsx(R,{plain:!s,outline:s,onClick:()=>null==a?void 0:a(t),"aria-label":`Page ${t}`,"aria-current":s?"page":void 0,className:E("min-w-[2.25rem] before:absolute before:-inset-px before:rounded-lg",s&&"before:bg-white/5",n),children:r??t})}function He({className:t,...s}){return e.jsx("span",{"aria-hidden":"true",...s,className:E("w-[2.25rem] select-none text-center text-sm text-text-muted",t),children:"…"})}function Be(e){if(!e||e.length<8)return null;const t=parseInt(e.slice(0,2),16),s=parseInt(e.slice(2,4),16),a=parseInt(e.slice(4,6),16),n=parseInt(e.slice(6,8),16);return isNaN(t)||isNaN(s)||isNaN(a)||isNaN(n)?null:((t|s<<8|a<<16|n<<24)>>>0).toString(16).toUpperCase().padStart(8,"0")}function Me(e){return e>=10?"excellent":e>=5?"good":e>=0?"fair":e>=-5?"poor":"critical"}function Fe(e){if(!e.payload)return null;try{const t=oe(e.payload),s=function(e){const t=e.original_path||e.forwarded_path||[];if("string"==typeof t)try{const e=JSON.parse(t);if(Array.isArray(e))return e.map(e=>parseInt(e,16))}catch{return[]}else if(Array.isArray(t))return t.map(e=>parseInt(e,16));return[]}(e),a=de(t,s);return a?{packet:e,decoded:a,timestamp:e.timestamp??0,hopCount:a.snrValues.length,rssi:e.rssi,snr:e.snr}:null}catch{return null}}const Le={rx:{icon:l,label:"Rx",badgeColor:ge.rx,avatarBg:"bg-emerald-500/15",avatarText:"text-emerald-400"},forward:{icon:r,label:"Fwd",badgeColor:ge.forward,avatarBg:"bg-sky-500/15",avatarText:"text-sky-400"},duplicate:{icon:n,label:"Dupe",badgeColor:ge.duplicate,avatarBg:"bg-zinc-500/15",avatarText:"text-zinc-400"},tx:{icon:a,label:"Tx",badgeColor:ge.tx,avatarBg:"bg-violet-500/15",avatarText:"text-violet-400"},dropped:{icon:s,label:"Drop",badgeColor:ge.dropped,avatarBg:"bg-amber-500/15",avatarText:"text-amber-400"}},De={sm:"w-3 h-3",md:"w-3.5 h-3.5",lg:"w-4 h-4"},ze={sm:"w-7 h-7",md:"w-8 h-8",lg:"w-9 h-9"};function Ae(e){return"tx_local"===e.packet_origin?"tx":"tx_forward"===e.packet_origin?"forward":e.is_duplicate?"duplicate":e.transmitted?"forward":e.drop_reason?"dropped":"rx"}const Ee=t.memo(function({packet:t,showLabel:s=!0,variant:a="avatar",size:n="sm"}){const r=Ae(t),l=Le[r],i=l.icon;return"avatar"===a?e.jsx("div",{className:E("flex items-center justify-center rounded-full flex-shrink-0",l.avatarBg,ze[n]),children:e.jsx(i,{className:E(De[n],l.avatarText)})}):e.jsxs(U,{color:l.badgeColor,children:[e.jsx(i,{className:De[n]}),s&&l.label]})}),Re=t.memo(function({path:t,localHash:s,className:a}){if(!t||0===t.length)return e.jsx("span",{className:E("text-white/30 text-[10px]",a),children:"—"});const n=s?(s.startsWith("0x")?s.slice(2,4):s.slice(0,2)).toUpperCase():null;return e.jsx("span",{className:E("flex items-center gap-0.5 font-mono text-[10px] overflow-hidden",a),children:t.map((s,a)=>{const r=a===t.length-1,l=n&&s.toUpperCase()===n;return e.jsxs("span",{className:"flex items-center flex-shrink-0",children:[l?e.jsx("span",{className:"px-1 py-0.5 rounded bg-amber-500/20 text-amber-400 text-[9px] font-medium",children:"You"}):e.jsx("span",{className:"px-1 py-0.5 rounded bg-white/[0.06] text-white/60",children:s.toUpperCase()}),!r&&e.jsx(i,{className:"w-2.5 h-2.5 text-white/20 mx-0.5 flex-shrink-0"})]},`${s}-${a}`)})})}),Ue=t.memo(function({count:t,className:s}){const a=t>=2;return e.jsxs("span",{className:E("font-mono text-xs tabular-nums",a?"text-white/70":"text-white/30",s),children:[t,e.jsx("span",{className:"text-white/20",children:"→"})]})});function Ie(e){const t=e.payload_type_name||V(e.payload_type??e.type),s=e.route_type_name||Q(e.route_type??e.route);return{payloadType:t,routeType:s,payloadColor:ye[t]??"zinc",routeColor:je[s]??"zinc"}}function $e(e){if(!e)return[];if(Array.isArray(e))return e;try{const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}}function Ve(e,t){if(!e||!t)return null;const s=e.startsWith("0x")?e.slice(2):e;for(const[a,n]of Object.entries(t))if((a.startsWith("0x")?a.slice(2):a).toLowerCase().startsWith(s.toLowerCase()))return n.name||n.node_name||null;return null}const Qe=t.memo(function({packet:s,onClick:a,localHash:n,neighbors:r,isFlashing:l=!1,isPending:i,isTraceHighlighted:o,onTraceHover:d,traceTag:x,onViewTraceReport:m,dupeGroupPosition:p,isDupeGroupHovered:h=!1,onDupeGroupHover:u}){const g=I(s.is_duplicate),f=void 0!==p,{payloadType:j,routeType:y,payloadColor:b,routeColor:N}=Ie(s),v="tx_local"===s.packet_origin,w=i??s.isPending,k="TRACE"===j,C=$e(s.original_path),S=$e(s.forwarded_path),P=S.length>0?S:C,_=P.length,T=s.src_hash?(s.src_hash.startsWith("0x")?s.src_hash.slice(2,6):s.src_hash.slice(0,4)).toUpperCase():null,H=Ve(s.src_hash,r),B=s.payload_length??s.length??0;s.lbt_attempts;const M=t.useCallback(()=>{k&&x&&m?m(x):a(s)},[k,x,m,a,s]),F=t.useCallback(()=>{k&&x&&d&&d(x),f&&u&&s.packet_hash&&u(s.packet_hash)},[k,x,d,f,u,s.packet_hash]),L=t.useCallback(()=>{d&&d(null),u&&u(null)},[d,u]),D={lime:"rgb(132, 204, 22)",cyan:"rgb(34, 211, 238)",amber:"rgb(251, 191, 36)",violet:"rgb(167, 139, 250)",rose:"rgb(251, 113, 133)",emerald:"rgb(52, 211, 153)",sky:"rgb(56, 189, 248)",orange:"rgb(251, 146, 60)",pink:"rgb(244, 114, 182)",zinc:"rgb(161, 161, 170)",purple:"rgb(168, 85, 247)",indigo:"rgb(129, 140, 248)",teal:"rgb(45, 212, 191)",fuchsia:"rgb(232, 121, 249)",blue:"rgb(59, 130, 246)",green:"rgb(34, 197, 94)",yellow:"rgb(250, 204, 21)",red:"rgb(239, 68, 68)",brown:"rgb(168, 133, 107)"},z=D[b]||D.zinc,A=h;return e.jsxs("div",{onClick:M,onMouseEnter:F,onMouseLeave:L,className:E("group relative cursor-pointer","hover:bg-white/[0.02]",g&&!h&&"opacity-40",l&&"flash-row",w&&"opacity-70",v&&"bg-violet-500/5",o&&"bg-teal-500/10"),children:[e.jsx("div",{className:E("absolute pointer-events-none transition-opacity duration-75",f?A?"opacity-100":"opacity-0":"opacity-0 group-hover:opacity-100"),style:(()=>{const e={pointerEvents:"none"};return"first"===p?{...e,borderTop:`2px solid ${z}`,borderLeft:`2px solid ${z}`,borderRight:`2px solid ${z}`,borderBottom:"none",borderRadius:"8px 8px 0 0",inset:"-2px -2px 0 -2px"}:"middle"===p?{...e,borderTop:"none",borderLeft:`2px solid ${z}`,borderRight:`2px solid ${z}`,borderBottom:"none",borderRadius:0,inset:"0 -2px"}:"last"===p?{...e,borderTop:"none",borderLeft:`2px solid ${z}`,borderRight:`2px solid ${z}`,borderBottom:`2px solid ${z}`,borderRadius:"0 0 8px 8px",inset:"0 -2px -2px -2px"}:{...e,border:`2px solid ${z}`,borderRadius:"8px",inset:"-2px"}})()}),e.jsxs("div",{className:"relative flex items-center gap-2 min-[600px]:gap-3 px-2 py-2 min-[600px]:px-3 min-[600px]:py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx(Ee,{packet:s,variant:"avatar",size:"sm"}),w&&e.jsx(c,{className:"absolute -right-1 -bottom-1 w-3 h-3 text-amber-400 animate-spin"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-bold text-[13px] text-white font-sans truncate",children:T||"—"}),H&&e.jsx("div",{className:"hidden min-[900px]:block text-[9px] text-white/40 truncate max-w-[70px]",children:H})]})]}),e.jsxs("div",{className:"flex-1 flex items-center gap-1 min-[600px]:gap-1.5 min-[900px]:gap-2 min-w-0",children:[e.jsx("span",{className:"text-[10px] min-[600px]:text-[11px] text-white/50 font-mono tabular-nums whitespace-nowrap flex-shrink-0",children:$(s.timestamp)}),e.jsx(U,{color:b,className:"flex-shrink-0",children:j}),e.jsx("span",{className:"min-[600px]:hidden text-[10px] font-mono text-white/40 flex-shrink-0",children:y.charAt(0)}),e.jsx(U,{color:N,className:"flex-shrink-0 hidden min-[600px]:inline-flex",children:y}),e.jsx("div",{className:"flex-shrink-0 flex items-center",children:e.jsx(Ue,{count:_})}),e.jsxs("span",{className:"hidden min-[520px]:inline text-[10px] text-white/40 font-mono flex-shrink-0",children:[B,"B"]}),e.jsx("div",{className:"flex-1 min-w-0 overflow-hidden",children:e.jsx(Re,{path:P,localHash:n})})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(fe,{rssi:s.rssi,snr:s.snr,compact:!0,showValues:!0})})]})]})}),Oe=t.memo(function({packet:t,onClick:s,localHash:a,neighbors:n,isFlashing:r=!1,isPending:l,isTraceHighlighted:i,traceTag:o,onViewTraceReport:d,dupeGroupPosition:x,isDupeGroupHovered:m=!1,onDupeGroupHover:p}){const{payloadType:h,routeType:u,payloadColor:g,routeColor:f}=Ie(t),j="tx_local"===t.packet_origin,y=l??t.isPending,b="TRACE"===h,N=I(t.is_duplicate),v=$e(t.original_path),w=$e(t.forwarded_path),k=w.length>0?w:v,C=k.length,S=t.src_hash?(t.src_hash.startsWith("0x")?t.src_hash.slice(2,6):t.src_hash.slice(0,4)).toUpperCase():null,P=Ve(t.src_hash,n),_=t.payload_length??t.length??0,T=t.lbt_attempts??0,H={lime:"rgb(132, 204, 22)",cyan:"rgb(34, 211, 238)",amber:"rgb(251, 191, 36)",violet:"rgb(167, 139, 250)",rose:"rgb(251, 113, 133)",emerald:"rgb(52, 211, 153)",sky:"rgb(56, 189, 248)",orange:"rgb(251, 146, 60)",pink:"rgb(244, 114, 182)",zinc:"rgb(161, 161, 170)",purple:"rgb(168, 85, 247)",indigo:"rgb(129, 140, 248)",teal:"rgb(45, 212, 191)",fuchsia:"rgb(232, 121, 249)",blue:"rgb(59, 130, 246)",green:"rgb(34, 197, 94)",yellow:"rgb(250, 204, 21)",red:"rgb(239, 68, 68)"},B=H[g]||H.zinc;return e.jsxs("div",{onClick:()=>{b&&o&&d?d(o):s(t)},className:E("relative pl-3 pr-2.5 py-2 cursor-pointer","active:bg-white/[0.04]",N&&"opacity-40",r&&"flash-row",y&&"opacity-70",j&&"bg-violet-500/5",i&&"bg-teal-500/10"),children:[e.jsx("div",{className:"absolute left-0 transition-all",style:(()=>{if(!x)return{opacity:0};const e=m?1:.4,t=m?"3px":"2px";return"first"===x?{backgroundColor:B,opacity:e,width:t,top:"6px",bottom:0,borderRadius:"0 9999px 0 0"}:"middle"===x?{backgroundColor:B,opacity:e,width:t,top:0,bottom:0,borderRadius:0}:"last"===x?{backgroundColor:B,opacity:e,width:t,top:0,bottom:"6px",borderRadius:"0 0 9999px 0"}:{backgroundColor:B,opacity:e,width:t,top:"6px",bottom:"6px",borderRadius:"9999px"}})()}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"relative flex-shrink-0 mt-0.5",children:[e.jsx(Ee,{packet:t,variant:"avatar",size:"sm"}),y&&e.jsx(c,{className:"absolute -right-1 -bottom-1 w-2.5 h-2.5 text-amber-400 animate-spin"})]}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"font-semibold text-[14px] text-white tracking-tight",children:S||"—"}),P&&e.jsx("span",{className:"text-[12px] text-white/40 truncate max-w-[80px]",children:P}),e.jsx("div",{className:"flex-1"}),e.jsx(U,{color:g,className:"flex-shrink-0 !text-[9px] !px-1.5 !py-0",children:h}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("span",{className:"text-[10px] font-mono text-white/50 tabular-nums w-[28px] text-right",children:t.rssi}),e.jsx(fe,{rssi:t.rssi,compact:!0,showValues:!1})]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-white/40 font-mono",children:[e.jsx("span",{className:"tabular-nums",children:$(t.timestamp)}),e.jsx(U,{color:f,className:"!text-[8px] !px-1 !py-0 !leading-none",children:u.charAt(0)}),C>0&&e.jsxs("span",{className:"text-white/30",children:[C,"h"]}),_>0&&e.jsxs("span",{className:"text-white/30",children:[_,"B"]}),T>0&&e.jsxs("span",{className:T>1?"text-amber-400/60":"text-white/30",children:["LBT:",T]}),null!=t.snr&&e.jsxs("span",{className:"text-white/30",children:[t.snr.toFixed(0),"dB"]})]}),C>0&&e.jsx("div",{className:"pt-0.5",children:e.jsx(Re,{path:k,localHash:a})})]})]})]})});function We(e){if(e.contact_type){const t=e.contact_type.toLowerCase();if("repeater"===t||"rep"===t)return!0;if("companion"===t||"client"===t||"cli"===t)return!1;if("room server"===t||"room_server"===t||"room"===t||"server"===t)return!1}return!0===e.is_repeater||(e.is_repeater,!1)}const Ge=t.lazy(()=>Ne(()=>import("./PathMapMapLibre-Ouls8uhs.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])));function qe(e){return`${(100*e).toFixed(0)}%`}function Ke(e,t){const s=document.documentElement,a=getComputedStyle(s),n={success:a.getPropertyValue("--accent-success").trim()||"#39D98A",secondary:a.getPropertyValue("--accent-secondary").trim()||"#F9D26F",poor:a.getPropertyValue("--signal-poor").trim()||"#FF8A5C",danger:a.getPropertyValue("--accent-danger").trim()||"#FF5C7A",muted:a.getPropertyValue("--text-muted").trim()||"#767688"};let r;return r=0===t?n.muted:e>=1?n.success:e>=.5?n.secondary:e>=.25?n.poor:e>0?n.danger:n.muted,{color:r}}class Ye extends t.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?e.jsxs("div",{className:"h-[200px] flex items-center justify-center text-text-muted",children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"Map failed to load"]}):this.props.children}}function Je({path:s,neighbors:a,localNode:n,localHash:r,srcHash:l,dstHash:i,neighborAffinity:c,prefixLookup:x,hubNodes:m,traceSnr:p,advertiserSource:h}){const[u,g]=t.useState(null),f=t.useMemo(()=>{if(!h)return null;const e="wardrive"===h.nodeType;return{prefix:h.prefix||"??",candidates:[{hash:h.publicKey||h.prefix||"source",name:h.name,latitude:h.latitude,longitude:h.longitude,probability:1,isLocal:!1,isWardrive:e}],confidence:1,totalMatches:1,isSource:!0}},[h]),j=t.useMemo(()=>{if(h)return null;if(!l)return null;const e=W(l),t=a[l];if((null==t?void 0:t.latitude)&&(null==t?void 0:t.longitude)&&(0!==t.latitude||0!==t.longitude))return{prefix:e,candidates:[{hash:l,name:t.node_name||t.name||"Source",latitude:t.latitude,longitude:t.longitude,probability:1,isLocal:!1,isDirectNeighbor:!0===t.zero_hop}],confidence:1,totalMatches:1,isSource:!0};const s=(null==t?void 0:t.node_name)||(null==t?void 0:t.name)||l.slice(0,8);return{prefix:e,candidates:[{hash:l,name:s,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isSource:!0}},[h,l,a]),y=t.useMemo(()=>{const e=(null==i?void 0:i.startsWith("0x"))?i.slice(2):i;if((!e||"00"===e||"0000000000000000"===e)&&n&&r){const e=W(r),t=0!==n.latitude||0!==n.longitude;return{prefix:e,candidates:[{hash:r,name:n.name||"Local Node",latitude:t?n.latitude:0,longitude:t?n.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}if(!i)return null;const t=W(i);if(r&&i===r&&n){const e=0!==n.latitude||0!==n.longitude;return{prefix:t,candidates:[{hash:i,name:n.name||"Local Node",latitude:e?n.latitude:0,longitude:e?n.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}const s=a[i];if((null==s?void 0:s.latitude)&&(null==s?void 0:s.longitude)&&(0!==s.latitude||0!==s.longitude))return{prefix:t,candidates:[{hash:i,name:s.node_name||s.name||"Destination",latitude:s.latitude,longitude:s.longitude,probability:1,isLocal:!1,isDirectNeighbor:!0===s.zero_hop}],confidence:1,totalMatches:1,isDestination:!0};const l=(null==s?void 0:s.node_name)||(null==s?void 0:s.name)||i.slice(0,8);return{prefix:t,candidates:[{hash:i,name:l,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isDestination:!0}},[i,a,n,r]),b=t.useMemo(()=>function(e,t,s,a,n,r){if(!e||0===e.length)return{hops:[],overallConfidence:0,hasValidPath:!1};const l=e.length-1,i=e.map((i,c)=>{const o=c===l,d=e.length-c,{candidates:x,totalMatches:m}=function(e,t,s,a,n=!1,r,l,i){const c=function(e){const t={};for(const[s,a]of Object.entries(e))We(a)&&(t[s]=a);return t}(t);let o;if(l){const t=function(e,t,s){const a=t.toUpperCase(),n=e.get(a);if(!n||0===n.candidates.length)return{hash:null,confidence:0};if(null==s?void 0:s.isLastHop)return{hash:n.bestMatch,confidence:n.confidence};if(1===(null==s?void 0:s.position))return{hash:n.bestMatch,confidence:n.confidence};if((null==s?void 0:s.position)&&n.bestMatchForPosition.has(s.position)){const e=n.bestMatchForPosition.get(s.position),t=Math.max(e.confidence,n.confidence);return{hash:e.hash,confidence:t}}if((null==s?void 0:s.adjacentPrefixes)&&s.adjacentPrefixes.length>0){let e=n.bestMatch,t=0;for(const a of n.candidates){let n=0;for(const e of s.adjacentPrefixes)n+=a.adjacentPrefixCounts.get(e.toUpperCase())||0;const r=a.combinedScore+n/Math.max(1,a.totalAdjacentObservations)*.3;r>t&&(t=r,e=a.hash)}return{hash:e,confidence:n.confidence}}return{hash:n.bestMatch,confidence:n.confidence}}(l,e,{position:i,isLastHop:n});o=t.confidence}const{matches:d,probability:x}=function(e,t,s,a,n=!1){const r=e.toUpperCase(),l=[],i=s&&O(r,s);i&&l.push(s);for(const p of Object.keys(t))O(r,p)&&l.push(p);if(n&&i&&s&&1===l.length)return{matches:l,probability:1,bestMatch:s};if(n&&i&&l.length>1){const e=l.filter(e=>e!==s);if(1===e.length)return{matches:l,probability:1,bestMatch:e[0]}}const c=l.length>0?1/l.length:0,o=[...l].sort();let d=null,x=-1;if(1===o.length)d=o[0];else if(o.length>1&&a){for(const e of o){const t=a.get(e),s=t?"number"==typeof t?t:t.combinedScore:0;s>x&&(x=s,d=e)}d||(d=o[0])}else o.length>0&&(d=o[0]);let m=c;if(l.length>1&&a&&x>0){let e=0;for(const t of l){const s=a.get(t);e+=s?"number"==typeof s?s:s.combinedScore:0}e>0&&(m=Math.min(.95,x/e))}return{matches:l,probability:m,bestMatch:d}}(e,c,a,r,n),m=d.length,p=[],h=e.toUpperCase(),u=s&&void 0!==s.latitude&&void 0!==s.longitude&&(0!==s.latitude||0!==s.longitude);for(const f of d){if(a&&O(h,a)&&f===a&&u&&s){p.push({hash:f,name:s.name||"Local Node",latitude:s.latitude,longitude:s.longitude,probability:n?1:x,isLocal:!0});continue}const e=c[f];(null==e?void 0:e.latitude)&&(null==e?void 0:e.longitude)&&(0!==e.latitude||0!==e.longitude)&&p.push({hash:f,name:e.node_name||e.name||"Unknown",latitude:e.latitude,longitude:e.longitude,probability:x,isLocal:!1,isDirectNeighbor:!0===e.zero_hop})}const g=p.length;if(1===g)p[0].probability=o??1;else if(g>1)if(void 0!==o&&o>0){p[0].probability=o;const e=1-o,t=g-1;p.slice(1).forEach(s=>{s.probability=e/t})}else{let e=0;const t=p.map(t=>{if(t.isLocal)return{candidate:t,score:1};const a=null==r?void 0:r.get(t.hash);let n=.5;var l;let i;return u&&s&&(n=(l=function(e,t,s,a){const n=(s-e)*Math.PI/180,r=(a-t)*Math.PI/180,l=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3}(s.latitude,s.longitude,t.latitude,t.longitude))<100?1:l<500?.9:l<1e3?.7:l<5e3?.5:l<1e4?.3:.1),a?i=.3*n+.3*a.hopConsistencyScore+.4*a.frequencyScore:(i=n,t.isDirectNeighbor&&(i=Math.max(i,.8))),e+=i,{candidate:t,score:i}});if(e>0)t.forEach(({candidate:t,score:s})=>{t.probability=Math.min(.95,s/e)});else{const e=1/g;p.forEach(t=>t.probability=e)}}return{candidates:p,totalMatches:m}}(i,t,s,a,o,n,r,d),p=x.length>0?Math.max(...x.map(e=>e.probability)):0;return{prefix:i,candidates:x,confidence:p,totalMatches:m}}),c=i.reduce((e,t)=>0===t.confidence?0:e*t.confidence,1),o=i.some(e=>e.candidates.length>0);return{hops:i,overallConfidence:c,hasValidPath:o}}(s,a,n,r,c,x),[s,a,n,r,c,x]),N=t.useMemo(()=>{const e=[];f?e.push(f):j&&e.push(j),e.push(...b.hops),y&&e.push(y);const t=e.reduce((e,t)=>0===t.confidence?0:e*t.confidence,1),s=e.some(e=>e.candidates.some(e=>0!==e.latitude||0!==e.longitude));return{hops:e,overallConfidence:t,hasValidPath:s}},[f,j,b,y]);return N.hasValidPath?e.jsxs("div",{className:"h-full flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-text-muted",children:"Path Confidence:"}),e.jsx("span",{className:(v=N.overallConfidence,v>=1?"text-accent-success":v>=.5?"text-accent-secondary":v>=.25?"text-signal-poor":v>0?"text-accent-danger":"text-text-muted"),children:qe(N.overallConfidence)}),e.jsx("button",{className:"text-text-muted hover:text-text-secondary transition-colors",title:"Confidence is calculated based on how many known nodes match each path prefix. Multiple matches reduce confidence due to collision probability.",children:e.jsx(d,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px]",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-accent-success"}),e.jsx("span",{className:"text-text-muted",children:"Exact"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-accent-secondary"}),e.jsx("span",{className:"text-text-muted",children:"Multi"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-text-muted"}),e.jsx("span",{className:"text-text-muted",children:"Unknown"})]})]})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:e.jsx(Ye,{children:e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"h-full bg-bg-elevated flex items-center justify-center text-text-muted text-sm",children:"Loading map..."}),children:e.jsx(Ge,{resolvedPath:N,localNode:n,hubNodes:m,hoveredHopIndex:u,onHoverHop:g,traceSnr:p})})})}),e.jsx("div",{className:"flex flex-wrap items-center gap-1.5",children:N.hops.map((t,s)=>{var a,n,r;const l=!0===t.isSource,i=!0===t.isDestination,c=u===s;let o;return o=l?`Source: ${(null==(a=t.candidates[0])?void 0:a.name)||"Unknown"}`:i?`Destination: ${(null==(n=t.candidates[0])?void 0:n.name)||"Unknown"}`:0===t.totalMatches?"No matching nodes found":1===t.totalMatches?`Exact match: ${(null==(r=t.candidates[0])?void 0:r.name)||"Unknown"}`:`${t.totalMatches} possible matches (${(100*t.confidence).toFixed(0)}% confidence)`,e.jsxs("div",{className:E("flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-mono cursor-pointer transition-all",c?"bg-accent-primary/20 ring-1 ring-accent-primary/50":"bg-bg-elevated hover:bg-bg-subtle",l&&"border border-accent-success/30",i&&"border border-accent-primary/30"),title:o,onMouseEnter:()=>g(s),onMouseLeave:()=>g(null),children:[l&&e.jsx("span",{className:"text-accent-success text-[8px] mr-0.5",children:"SRC"}),i&&e.jsx("span",{className:"text-accent-primary text-[8px] mr-0.5",children:"DST"}),e.jsx("span",{style:Ke(t.confidence,t.totalMatches),children:t.prefix}),!l&&!i&&t.totalMatches>1&&e.jsxs("span",{className:"text-text-muted",children:["×",t.totalMatches]}),!l&&!i&&0===t.totalMatches&&e.jsx("span",{className:"text-text-muted",children:"?"})]},s)})})]}):e.jsxs("div",{className:"flex items-center justify-center text-text-muted text-xs py-4",children:[e.jsx(o,{className:"w-3.5 h-3.5 mr-1.5 opacity-50"}),"No location data available for path nodes"]});var v}function Xe(e){return e.match(/.{1,2}/g)||[]}function Ze(e){return null!==e&&e.startsWith("payload:")}const et={red:"var(--sys-red)",orange:"var(--sys-orange)",amber:"var(--sys-amber)",yellow:"var(--sys-yellow)",lime:"var(--sys-green)",green:"var(--sys-green)",emerald:"var(--sys-green)",teal:"var(--sys-teal)",cyan:"var(--sys-cyan)",sky:"var(--sys-cyan)",blue:"var(--sys-blue)",indigo:"var(--sys-indigo)",violet:"var(--sys-indigo)",purple:"var(--sys-purple)",fuchsia:"var(--sys-pink)",pink:"var(--sys-pink)",rose:"var(--sys-red)",brown:"var(--sys-brown)",zinc:"var(--text-muted)"},tt=15,st="color-mix(in srgb, var(--bg-elevated) 60%, var(--bg-body))",at="\n    inset 0 0 0 1px color-mix(in srgb, var(--text-primary) 6%, transparent),\n    inset 0 1px 0 color-mix(in srgb, white 3%, transparent),\n    0 1px 2px color-mix(in srgb, black 5%, transparent)\n  ",nt=2,rt={type:"tween",duration:.25,ease:[.25,.1,.25,1]};function lt(e,t){return e?`inset 0 0 0 ${nt}px ${et[t]}`:at}function it(e,t){return e?t:`color-mix(in srgb, ${t} ${tt}%, transparent)`}function ct({segments:s,selectedSegment:a,onSegmentClick:n}){const[r,l]=t.useState(null),[i,c]=t.useState(null),o=s.some(e=>void 0!==e.id)&&n,d=[];for(const e of s){const t=Xe(e.hex);for(const s of t)d.push({byte:s.toUpperCase(),color:e.color,id:e.id})}const x=[];for(let e=0;e<d.length;e+=16)x.push(d.slice(e,e+16));return e.jsx("div",{className:"space-y-1",children:x.map((t,s)=>{const d=t.length<16;return e.jsx("div",{className:"flex rounded-md overflow-hidden",children:t.map(({byte:s,color:x,id:m},p)=>{const h=p===t.length-1,u=d&&h,g=et[x],f=m?r===m:i===x,j=Boolean(m&&a===m),y=f||j;return e.jsx("span",{className:"w-[1.75rem] text-xs text-center py-0.5 font-mono select-none "+(o?"cursor-pointer":""),style:{backgroundColor:it(y,g),color:y?"rgba(255,255,255,0.95)":g,transition:y?"none":"background-color 0.15s ease-out, color 0.15s ease-out",touchAction:"manipulation",...u?{borderRadius:"0 0.375rem 0.375rem 0"}:{}},onMouseEnter:()=>{m?l(m):c(x)},onMouseLeave:()=>{l(null),c(null)},onClick:()=>m&&(null==n?void 0:n(m)),onTouchStart:()=>{m?l(m):c(x)},onTouchEnd:()=>{l(null),c(null)},children:s},p)})},s)})})}function ot({bits:t,field:s,value:a,binary:n}){return e.jsxs("tr",{children:[e.jsx("td",{className:"py-1.5 text-xs text-text-muted tabular-nums",children:t}),e.jsx("td",{className:"py-1.5 text-sm text-text-secondary",children:s}),e.jsx("td",{className:"py-1.5",children:(()=>{if("Payload Type"===s){const t=ye[a]||"zinc";return e.jsx(U,{color:t,children:a})}if("Route Type"===s){const t=je[a]||"zinc";return e.jsx(U,{color:t,children:a})}return e.jsx("span",{className:"text-sm text-text-primary",children:a})})()}),e.jsx("td",{className:"py-1.5 font-mono text-xs text-sys-cyan",children:n})]})}function dt({id:t,title:s,color:a,hexBytes:n,startByte:r,endByte:l,isSelected:i,children:c}){const o=n?Xe(n):[];return e.jsxs(p.div,{layout:"position",layoutId:t,transition:rt,className:"w-full min-w-0 overflow-hidden rounded-xl p-4 sm:p-5 space-y-4",style:{backgroundColor:st,boxShadow:lt(i,a)},children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-0.5 min-w-0",children:[e.jsx(U,{color:a,children:s}),o.length>0&&o.length<=16&&o.map((t,s)=>e.jsx(U,{color:a,className:"font-mono",children:t.toUpperCase()},s))]}),e.jsxs("span",{className:"text-[10px] text-text-muted font-mono flex-shrink-0",children:["Bytes ",r,"-",l]})]}),e.jsx("div",{className:"min-w-0 overflow-hidden",children:c})]})}function xt({advert:t,timestamp:s}){const a=q(s||t.timestamp);return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-purple-500/10 dark:bg-purple-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-purple) 0%, var(--sys-blue) 100%)"},children:e.jsx(v,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:t.name||"Unknown Node"}),e.jsx("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:t.nodeType})]})]}),e.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),e.jsxs("div",{className:"px-4 py-3 space-y-2",children:[void 0!==t.latitude&&void 0!==t.longitude&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 flex-shrink-0"}),e.jsxs("span",{className:"text-sm text-text-secondary font-mono",children:[t.latitude.toFixed(5),"°, ",t.longitude.toFixed(5),"°"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-text-secondary font-sans",children:a})]})]})]})})}function mt({decoded:t,timestamp:s}){const a=s?q(s):"Unknown";return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-teal-500/10 dark:bg-teal-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-teal) 0%, var(--sys-cyan) 100%)"},children:e.jsx(N,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:t.channelName||"Channel Data"}),e.jsxs("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:[t.dataLength," bytes • ",t.decrypted?"Decrypted":"Encrypted"]})]})]}),e.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),e.jsxs("div",{className:"px-4 py-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{className:"w-4 h-4 text-teal-600 dark:text-teal-400 flex-shrink-0"}),e.jsxs("span",{className:"text-sm text-text-secondary font-sans",children:["Channel: ",e.jsxs("span",{className:"font-mono",children:["0x",t.channelHash]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{className:"w-4 h-4 text-teal-600 dark:text-teal-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-text-secondary font-sans",children:a})]}),t.decrypted&&t.decryptedHex&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-black/10 dark:border-white/10",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-wide text-text-muted mb-1 font-sans",children:"Decrypted Data"}),e.jsx("div",{className:"max-w-full overflow-x-auto",children:e.jsx(ve,{size:"compact",copy:!0,className:"inline-block",children:e.jsx("span",{className:"break-all text-xs",children:t.decryptedHex.toUpperCase()})})})]})]})]})})}function pt({decoded:t,timestamp:s,isLoading:a=!1}){const n=s?q(s):"Unknown";return a?e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-xl p-4 sm:p-5",style:{backgroundColor:"color-mix(in srgb, var(--bg-elevated) 60%, var(--bg-body))",boxShadow:"\n              inset 0 0 0 1px color-mix(in srgb, var(--text-primary) 6%, transparent),\n              inset 0 1px 0 color-mix(in srgb, white 3%, transparent),\n              0 1px 2px color-mix(in srgb, black 5%, transparent)\n            "},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 h-[15px]",children:[e.jsx("div",{className:"h-2.5 w-12 rounded bg-white/[0.08] animate-pulse"}),e.jsx("div",{className:"h-2.5 w-16 rounded bg-white/[0.08] animate-pulse"})]}),e.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tl-md",style:{background:"color-mix(in srgb, var(--sys-blue) 30%, transparent)"},children:e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("div",{className:"h-3.5 w-48 rounded bg-white/[0.15] animate-pulse"}),e.jsx("div",{className:"h-3.5 w-32 rounded bg-white/[0.15] animate-pulse"})]})})]})}):t.decrypted?e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-xl p-4 sm:p-5",style:{backgroundColor:"color-mix(in srgb, var(--bg-elevated) 60%, var(--bg-body))",boxShadow:"\n              inset 0 0 0 1px color-mix(in srgb, var(--text-primary) 6%, transparent),\n              inset 0 1px 0 color-mix(in srgb, white 3%, transparent),\n              0 1px 2px color-mix(in srgb, black 5%, transparent)\n            "},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.senderName&&e.jsxs("span",{className:"text-[11px] text-text-muted font-sans",children:["From ",e.jsx("span",{className:"text-text-secondary font-medium",children:t.senderName})]}),t.channelName&&e.jsxs("span",{className:"text-[11px] text-text-muted font-sans",children:["in ",e.jsx("span",{className:"text-sys-cyan font-medium",children:t.channelName})]})]}),e.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tl-md",style:{background:"linear-gradient(135deg, var(--sys-blue) 0%, color-mix(in srgb, var(--sys-blue) 85%, var(--sys-cyan)) 100%)"},children:e.jsx("p",{className:"text-sm text-white font-sans leading-relaxed whitespace-pre-wrap break-words",children:t.text})})]})}):e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-zinc-500/10 dark:bg-zinc-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-zinc) 0%, color-mix(in srgb, var(--sys-zinc) 70%, black) 100%)"},children:e.jsx(f,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:"Encrypted Message"}),e.jsxs("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:["Channel hash: ",e.jsxs("span",{className:"font-mono",children:["0x",t.channelHash]})]})]})]}),e.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),e.jsxs("div",{className:"px-4 py-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{className:"w-4 h-4 text-zinc-500 dark:text-zinc-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-text-secondary font-sans",children:n})]}),e.jsx("p",{className:"text-xs text-text-muted",children:"Private channel or unknown hash channel. Channel secret required for decryption."})]})]})})}function ht({decoded:t,timestamp:s}){const a=s?q(s):"Unknown";return e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:"linear-gradient(135deg, var(--sys-green) 0%, var(--sys-teal) 100%)"},children:e.jsx(b,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-text-primary font-sans",children:"Acknowledgment"}),e.jsxs("p",{className:"text-xs text-text-muted font-sans mt-0.5",children:["CRC: ",e.jsxs("span",{className:"font-mono text-sys-green",children:["0x",t.crc]})," · ",a]})]})]})}function ut({decoded:t,timestamp:s}){const a=s?q(s):"Unknown",n=t.path.length;return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-amber-500/10 dark:bg-amber-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-amber) 0%, var(--sys-orange) 100%)"},children:e.jsx(y,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:"Path Response"}),e.jsxs("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:[n," ",1===n?"hop":"hops"]})]})]}),e.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),e.jsxs("div",{className:"px-4 py-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{className:"w-4 h-4 text-amber-600 dark:text-amber-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-text-secondary font-sans",children:a})]}),t.path.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-black/10 dark:border-white/10",children:e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:t.path.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2",children:[s>0&&e.jsx(r,{className:"w-4 h-4 text-amber-500 dark:text-amber-400"}),e.jsx(U,{color:"amber",className:"font-mono",children:t})]},s))})})]})]})})}function gt({decoded:t,timestamp:s}){const a=s?q(s):"Unknown",n=t.pathHashes.length,l=t.snrValues.length;return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-blue-500/10 dark:bg-blue-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-blue) 0%, var(--sys-indigo) 100%)"},children:e.jsx(j,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h3",{className:"text-lg font-medium text-text-primary truncate leading-tight",children:["Trace ",t.isComplete?"Complete":"In Progress"]}),e.jsxs("p",{className:"text-sm text-text-muted mt-0.5",children:["Tag: 0x",t.traceTag.slice(0,8),t.isComplete&&" • ✓"]})]})]}),e.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{className:"w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-text-secondary",children:a})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-text-muted",children:[e.jsxs("span",{children:[n," target ",1===n?"hop":"hops"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[l," SNR ",1===l?"sample":"samples"]}),0!==t.authCode&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Auth: ",t.authCode]})]})]}),t.pathHashes.length>0&&e.jsx("div",{className:"flex flex-wrap items-center gap-2 pt-1",children:t.pathHashes.map((s,a)=>{const n=t.snrValues[a],l=void 0!==n?(e=>e>=7?"green":e>=0?"yellow":e>=-5?"orange":"red")(n):"zinc",i=void 0!==n;return e.jsxs("div",{className:"flex items-center gap-2",children:[a>0&&e.jsx(r,{className:"w-4 h-4 text-blue-500 dark:text-blue-400 flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{color:i?"blue":"zinc",className:"font-mono",children:s}),i&&e.jsxs(U,{color:l,className:"font-mono",children:[n>=0?"+":"",Number.isInteger(n)?n:n.toFixed(1),"dB"]})]})]},a)})})]})]})})}function ft({decoded:t,timestamp:s}){const a=s?q(s):"Unknown";return t.encrypted?e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:"linear-gradient(135deg, var(--sys-purple) 0%, var(--sys-indigo) 100%)"},children:e.jsx(f,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-text-primary font-sans",children:"Encrypted Message"}),e.jsxs("p",{className:"text-xs text-text-muted font-sans mt-0.5",children:[t.srcHash," → ",t.destHash," · ",a]})]})]}):e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5 px-1",children:[e.jsxs("span",{className:"text-[11px] text-text-muted font-sans",children:[e.jsx("span",{className:"font-mono text-text-secondary",children:t.srcHash})," → ",e.jsx("span",{className:"font-mono text-text-secondary",children:t.destHash})]}),e.jsxs("span",{className:"text-[11px] text-text-muted font-sans",children:["· ",a]})]}),e.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tr-md ml-auto",style:{background:"linear-gradient(135deg, var(--sys-green) 0%, var(--sys-teal) 100%)"},children:e.jsx("p",{className:"text-sm text-white font-sans leading-relaxed whitespace-pre-wrap break-words",children:t.text})})]})}function jt({decoded:t,timestamp:s}){const a=s?q(s):"Unknown",n=(t.partNumber+1)/t.totalParts*100;return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-yellow-500/10 dark:bg-yellow-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-yellow) 0%, var(--sys-amber) 100%)"},children:e.jsx(h,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:"Multipart Segment"}),e.jsxs("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:["Part ",t.partNumber+1," of ",t.totalParts]})]})]}),e.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.jsx("div",{children:e.jsx("div",{className:"h-2 bg-black/10 dark:bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${n}%`,background:"linear-gradient(90deg, var(--sys-yellow), var(--sys-amber))"}})})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400 flex-shrink-0"}),e.jsxs("span",{className:"text-sm text-text-secondary font-sans",children:["Message ID: ",e.jsx("span",{className:"font-mono",children:t.messageId})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-text-secondary font-sans",children:a})]})]})]})})}function yt({decoded:t,timestamp:s,payloadType:a}){const n=s?q(s):"Unknown",r=(()=>{switch(a){case xe.REQ:return{icon:C,gradient:"var(--sys-orange), var(--sys-red)",bg:"rgba(249, 115, 22, 0.15)",label:"Request"};case xe.RESPONSE:return{icon:k,gradient:"var(--sys-green), var(--sys-teal)",bg:"rgba(34, 197, 94, 0.15)",label:"Response"};case xe.ANON_REQ:return{icon:f,gradient:"var(--sys-purple), var(--sys-pink)",bg:"rgba(168, 85, 247, 0.15)",label:"Anonymous Request"};default:return{icon:w,gradient:"var(--sys-gray), var(--sys-slate)",bg:"rgba(107, 114, 128, 0.15)",label:t.payloadTypeName}}})(),l=r.icon;return e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:`linear-gradient(135deg, ${r.gradient})`},children:e.jsx(l,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-text-primary font-sans",children:r.label}),e.jsxs("p",{className:"text-xs text-text-muted font-sans mt-0.5",children:[t.length," bytes · ",n]})]})]})}function bt({pathHex:t}){if(!t)return null;const s=Xe(t);return e.jsx("div",{className:"flex flex-wrap items-center gap-2 py-2",children:s.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2",children:[s>0&&e.jsx(r,{className:"w-4 h-4 text-sys-amber flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ve,{size:"compact",copy:!0,children:t.toUpperCase()}),e.jsx("span",{className:"text-[10px] text-text-muted font-sans tabular-nums w-4 text-left",children:s+1})]})]},s))})}function Nt({decoded:t,payloadType:s}){const a=he[s]||`TYPE_${s}`;switch(t.type){case"advert":{const s="chat"===t.nodeType?"companion":t.nodeType.replace("_"," "),a=void 0!==t.latitude&&void 0!==t.longitude&&!(0===t.latitude&&0===t.longitude);return e.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-text-muted",children:"Role:"})," ",s]}),t.name&&e.jsxs("p",{children:[e.jsx("span",{className:"text-text-muted",children:"Name:"})," ",t.name]}),a&&e.jsxs("p",{children:[e.jsx("span",{className:"text-text-muted",children:"Location:"})," ",t.latitude.toFixed(4),"°, ",t.longitude.toFixed(4),"°"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-text-muted",children:"Time:"})," ",q(t.timestamp)]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-text-muted",children:"Flags:"})," ",t.flagsDescription]})]})}case"ack":return e.jsx("div",{className:"text-xs text-text-primary space-y-0.5",children:e.jsxs("p",{children:[e.jsx("span",{className:"text-text-muted",children:"CRC:"})," 0x",t.crc]})});case"path":return e.jsx("div",{className:"text-xs text-text-primary space-y-1",children:e.jsxs("p",{children:[e.jsx("span",{className:"text-text-muted",children:"Path:"})," ",t.pathString||"(empty)"]})});case"trace":return e.jsxs("div",{className:"text-xs text-text-primary space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-text-muted",children:"Tag:"})," 0x",t.traceTag]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-text-muted",children:"Target Path:"})," ",t.pathString||"(empty)"]}),t.snrValues.length>0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-text-muted",children:"SNR:"})," ",t.snrValues.map(e=>`${e>=0?"+":""}${Number.isInteger(e)?e:e.toFixed(1)}dB`).join(" → ")]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-text-muted",children:"Status:"})," ",t.isComplete?"✓ Complete":`In progress (${t.snrValues.length}/${t.pathHashes.length})`]})]});case"txt_msg":return e.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-text-muted",children:"Dest:"})," ",t.destHash]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-text-muted",children:"Src:"})," ",t.srcHash]}),t.encrypted?e.jsx("p",{className:"text-text-muted italic",children:"Encrypted content"}):e.jsxs("p",{children:[e.jsx("span",{className:"text-text-muted",children:"Text:"})," ",t.text]})]});case"grp_txt":return e.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-text-muted",children:"Channel:"})," ",t.channelName?e.jsx("span",{className:"text-accent-success",children:t.channelName}):e.jsxs("span",{className:"font-mono",children:["0x",t.channelHash]})]}),t.decrypted?e.jsxs(e.Fragment,{children:[t.senderName&&e.jsxs("p",{children:[e.jsx("span",{className:"text-text-muted",children:"From:"})," ",t.senderName]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-text-muted",children:"Text:"})," ",t.text]})]}):e.jsx("p",{className:"text-text-muted italic",children:"Encrypted (unknown channel)"})]});case"grp_data":return e.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-text-muted",children:"Channel:"})," ",t.channelName?e.jsx("span",{className:"text-sys-teal",children:t.channelName}):e.jsxs("span",{className:"font-mono",children:["0x",t.channelHash]})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-text-muted",children:"Data:"})," ",t.dataLength," bytes ",t.decrypted?"(decrypted)":"(encrypted)"]})]});case"multipart":return e.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-text-muted",children:"Part:"})," ",t.partNumber+1,"/",t.totalParts]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-text-muted",children:"Message ID:"})," ",t.messageId]})]});default:return e.jsxs("p",{className:"text-xs text-text-secondary",children:[a," (",t.length," bytes)"]})}}const vt=t.memo(function({packet:s}){var a;const n=s.raw_packet||"",l=n.length/2,i=G(),[c,o]=t.useState(null),[d,x]=t.useState(null),[h,u]=t.useState(!1),[g,f]=t.useState(null),j=t.useCallback(e=>{f(t=>t===e?null:e)},[]),y=t.useMemo(()=>function(e){if(!e||e.length<4)return null;const t=re.fromHex(e);if(!t.success||!t.packet)return null;const s=t.packet,a=function(e){const t=3&e,s=e>>2&15,a=e>>6&3;return[{bits:"0-1",field:"Route Type",value:ie(t),binary:(3&t).toString(2).padStart(2,"0")},{bits:"2-5",field:"Payload Type",value:ce(s),binary:(15&s).toString(2).padStart(4,"0")},{bits:"6-7",field:"Version",value:a.toString(),binary:(3&a).toString(2).padStart(2,"0")}]}(s.header),n=e.slice(0,2);let r=2,l="";s.hasTransportCodes()&&(l=e.slice(2,10),r=10);const i=e.slice(r,r+2),c=r+2,o=c+2*s.pathLen,d=e.slice(c,o),x=e.slice(o),m=le(s);return{packet:s,headerHex:n,headerFields:a,transportCodesHex:l,pathLengthHex:i,pathDataHex:d,payloadHex:x,payloadStartByte:Math.floor(o/2),decoded:m}}(n),[n]),b=(null==(a=null==y?void 0:y.packet)?void 0:a.payloadType)===xe.GRP_TXT&&(!i||h);if(t.useEffect(()=>{if(!(null==y?void 0:y.packet)||y.packet.payloadType!==xe.GRP_TXT)return o(null),void u(!1);if(!i)return void u(!0);u(!0);let e=!1;return me(y.packet.payload).then(t=>{e||(t&&o(t),u(!1))}),()=>{e=!0}},[null==y?void 0:y.packet,i]),t.useEffect(()=>{if(!(null==y?void 0:y.packet)||y.packet.payloadType!==xe.GRP_DATA)return void x(null);if(!i)return;let e=!1;return pe(y.packet.payload).then(t=>{!e&&t&&x(t)}),()=>{e=!0}},[null==y?void 0:y.packet,i]),!y||0===n.length)return e.jsx("div",{className:"p-4 text-center text-text-muted",children:e.jsx("p",{className:"text-sm",children:"No raw packet data available"})});const{packet:N}=y;let v=y.decoded;c&&"grp_txt"===y.decoded.type?v=c:d&&"grp_data"===y.decoded.type&&(v=d);const w=t.useMemo(()=>function(t,s){switch(t.type){case"advert":return function(t,s){const a=[];let n=0;const r=s.slice(0,64);a.push({id:"payload:publicKey",title:"Public Key",color:"pink",hex:r,startByte:n,endByte:n+31,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:t.publicKey.toUpperCase()}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Ed25519 public key (32 bytes)"})]})}),n+=32;const l=s.slice(64,72);a.push({id:"payload:timestamp",title:"Timestamp",color:"orange",hex:l,startByte:n,endByte:n+3,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ve,{size:"standard",copy:!0,children:l.toUpperCase()}),e.jsxs("p",{className:"text-xs text-text-primary mt-1",children:[t.timestamp," (",q(t.timestamp),")"]})]})}),n+=4;const i=s.slice(72,200);a.push({id:"payload:signature",title:"Signature",color:"teal",hex:i,startByte:n,endByte:n+63,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:t.signature.toUpperCase()}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Ed25519 signature (64 bytes)"})]})}),n+=64;const c=s.slice(200,202);if(a.push({id:"payload:flags",title:"Flags",color:"blue",hex:c,startByte:n,endByte:n,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(ve,{size:"standard",copy:!0,children:["0x",t.flags.toString(16).padStart(2,"0").toUpperCase()]}),e.jsx("p",{className:"text-xs text-text-primary mt-1",children:t.flagsDescription}),e.jsxs("p",{className:"text-xs text-text-muted",children:["Node Type: ",t.nodeType]})]})}),n+=1,void 0!==t.latitude){const r=s.slice(2*n,2*n+8);a.push({id:"payload:latitude",title:"Latitude",color:"green",hex:r,startByte:n,endByte:n+3,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ve,{size:"standard",copy:!0,children:r.toUpperCase()}),e.jsxs("p",{className:"text-xs text-text-primary mt-1",children:[t.latitude.toFixed(6),"°"]})]})}),n+=4}if(void 0!==t.longitude){const r=s.slice(2*n,2*n+8);a.push({id:"payload:longitude",title:"Longitude",color:"purple",hex:r,startByte:n,endByte:n+3,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ve,{size:"standard",copy:!0,children:r.toUpperCase()}),e.jsxs("p",{className:"text-xs text-text-primary mt-1",children:[t.longitude.toFixed(6),"°"]})]})}),n+=4}if(t.name){const r=s.slice(2*n),l=r.length/2;a.push({id:"payload:name",title:"Name",color:"amber",hex:r,startByte:n,endByte:n+l-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ve,{size:"standard",copy:!0,children:r.toUpperCase()}),e.jsxs("p",{className:"text-xs text-text-primary mt-1",children:['"',t.name,'"']})]})})}return a}(t,s);case"ack":return function(t,s){return[{id:"payload:crc",title:"CRC",color:"green",hex:s.slice(0,8),startByte:0,endByte:3,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(ve,{size:"standard",copy:!0,children:["0x",t.crc]}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"CRC32 of acknowledged packet"})]})}]}(t,s);case"grp_txt":return function(t,s){const a=[];a.push({id:"payload:channelHash",title:"Channel Hash",color:"blue",hex:s.slice(0,2),startByte:0,endByte:0,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(ve,{size:"standard",copy:!0,children:["0x",t.channelHash]}),t.channelName&&e.jsxs("p",{className:"text-xs text-text-primary mt-1",children:["Channel: ",t.channelName]})]})}),t.macHex&&a.push({id:"payload:mac",title:"MAC",color:"purple",hex:s.slice(2,6),startByte:1,endByte:2,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ve,{size:"standard",copy:!0,children:t.macHex.toUpperCase()}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Truncated HMAC-SHA256"})]})});const n=s.slice(6);return n&&a.push({id:"payload:ciphertext",title:t.decrypted?"Message":"Ciphertext",color:t.decrypted?"green":"zinc",hex:n,startByte:3,endByte:3+n.length/2-1,decoded:t.decrypted?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-text-primary",children:['"',t.text,'"']}),t.senderName&&e.jsxs("p",{className:"text-xs text-text-muted mt-1",children:["From: ",t.senderName]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:n.toUpperCase()}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"AES-128-ECB encrypted"})]})}),a}(t,s);case"grp_data":return function(t,s){const a=[];a.push({id:"payload:channelHash",title:"Channel Hash",color:"blue",hex:s.slice(0,2),startByte:0,endByte:0,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(ve,{size:"standard",copy:!0,children:["0x",t.channelHash]}),t.channelName&&e.jsxs("p",{className:"text-xs text-text-primary mt-1",children:["Channel: ",t.channelName]})]})}),t.macHex&&a.push({id:"payload:mac",title:"MAC",color:"purple",hex:s.slice(2,6),startByte:1,endByte:2,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ve,{size:"standard",copy:!0,children:t.macHex.toUpperCase()}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Truncated HMAC-SHA256"})]})});const n=s.slice(6);return n&&a.push({id:"payload:ciphertext",title:t.decrypted?"Decrypted Data":"Encrypted Data",color:t.decrypted?"green":"zinc",hex:n,startByte:3,endByte:3+n.length/2-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:(t.decryptedHex||n).toUpperCase()}),e.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[t.dataLength," bytes",t.decrypted?"":" (AES-128-ECB encrypted)"]})]})}),a}(t,s);case"path":return function(t,s){return[{id:"payload:path",title:"Path Hops",color:"amber",hex:s,startByte:0,endByte:s.length/2-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-wrap items-center gap-1",children:t.path.map((t,s)=>e.jsxs("span",{className:"flex items-center gap-1",children:[s>0&&e.jsx(r,{className:"w-3 h-3 text-text-muted"}),e.jsx(U,{color:"amber",className:"font-mono",children:t})]},s))}),e.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[t.path.length," hops"]})]})}]}(t,s);case"trace":return function(t,s){const a=[];a.push({id:"payload:crc",title:"Trace Tag",color:"blue",hex:s.slice(0,8),startByte:0,endByte:3,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(ve,{size:"standard",copy:!0,children:["0x",t.traceTag]}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Unique trace request identifier"})]})}),a.push({id:"payload:mac",title:"Auth Code",color:"purple",hex:s.slice(8,16),startByte:4,endByte:7,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ve,{size:"standard",copy:!0,children:t.authCode}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Authentication/verification code"})]})}),a.push({id:"payload:flags",title:"Flags",color:"amber",hex:s.slice(16,18),startByte:8,endByte:8,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(ve,{size:"standard",copy:!0,children:["0x",t.flags.toString(16).toUpperCase().padStart(2,"0")]}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:0===t.flags?"No flags set":`Flags: ${t.flags.toString(2).padStart(8,"0")}b`})]})});const n=s.slice(18);if(n){const s=e=>e>=7?"green":e>=0?"yellow":e>=-5?"orange":"red";a.push({id:"payload:path",title:"Target Path",color:"indigo",hex:n,startByte:9,endByte:9+n.length/2-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-wrap items-center gap-1",children:t.pathHashes.map((a,n)=>{const l=t.snrValues[n],i=void 0!==l?s(l):"zinc";return e.jsxs("span",{className:"flex items-center gap-1",children:[n>0&&e.jsx(r,{className:"w-3 h-3 text-text-muted"}),e.jsx(U,{color:"indigo",className:"font-mono",children:a}),void 0!==l&&e.jsxs(U,{color:i,className:"font-mono",children:[l>=0?"+":"",Number.isInteger(l)?l:l.toFixed(1),"dB"]})]},n)})}),e.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[t.pathHashes.length," target ",1===t.pathHashes.length?"hop":"hops",t.snrValues.length>0&&` • ${t.snrValues.length} SNR ${1===t.snrValues.length?"value":"values"} collected`,t.isComplete&&" • ✓ Complete"]})]})})}return a}(t,s);case"multipart":return function(t,s){const a=[];a.push({id:"payload:msgId",title:"Message ID",color:"blue",hex:s.slice(0,4),startByte:0,endByte:1,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ve,{size:"standard",copy:!0,children:t.messageId.toUpperCase()}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Unique message identifier"})]})}),a.push({id:"payload:partNum",title:"Part Number",color:"amber",hex:s.slice(4,6),startByte:2,endByte:2,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ve,{size:"standard",copy:!0,children:t.partNumber}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"0-indexed part number"})]})}),a.push({id:"payload:totalParts",title:"Total Parts",color:"orange",hex:s.slice(6,8),startByte:3,endByte:3,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ve,{size:"standard",copy:!0,children:t.totalParts}),e.jsxs("p",{className:"text-xs text-text-muted mt-1",children:["Part ",t.partNumber+1," of ",t.totalParts]})]})});const n=s.slice(8);return n&&a.push({id:"payload:partData",title:"Part Data",color:"cyan",hex:n,startByte:4,endByte:4+n.length/2-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:n.toUpperCase()}),e.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[n.length/2," bytes"]})]})}),a}(t,s);default:return[{id:"payload:ciphertext",title:"Raw Data",color:"zinc",hex:s,startByte:0,endByte:s.length/2-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:s.toUpperCase()}),e.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[s.length/2," bytes"]})]})}]}}(v,y.payloadHex),[v,y.payloadHex]),k="payload"===g||Ze(g),C=t.useMemo(()=>{const e=[{id:"header",hex:y.headerHex,color:"red"},...y.transportCodesHex?[{id:"transportCodes",hex:y.transportCodesHex,color:"purple"}]:[],{id:"pathLength",hex:y.pathLengthHex,color:"green"},...y.pathDataHex?[{id:"pathData",hex:y.pathDataHex,color:"amber"}]:[]];return k?[...e,...(t=w,t.map(e=>({id:e.id,hex:e.hex,color:e.color})))]:[...e,{id:"payload",hex:y.payloadHex,color:"cyan"}];var t},[y,k,w]);return e.jsxs("div",{className:"font-mono space-y-2 min-w-0 overflow-hidden",children:[(()=>{switch(v.type){case"advert":return e.jsx(xt,{advert:v,timestamp:s.timestamp});case"grp_data":return e.jsx(mt,{decoded:v,timestamp:s.timestamp});case"grp_txt":return e.jsx(pt,{decoded:v,timestamp:s.timestamp,isLoading:b});case"ack":return e.jsx(ht,{decoded:v,timestamp:s.timestamp});case"path":return e.jsx(ut,{decoded:v,timestamp:s.timestamp});case"trace":return e.jsx(gt,{decoded:v,timestamp:s.timestamp});case"txt_msg":return e.jsx(ft,{decoded:v,timestamp:s.timestamp});case"multipart":return e.jsx(jt,{decoded:v,timestamp:s.timestamp});case"generic":return N.payloadType===xe.REQ||N.payloadType===xe.RESPONSE||N.payloadType===xe.ANON_REQ?e.jsx(yt,{decoded:v,timestamp:s.timestamp,payloadType:N.payloadType}):null;default:return null}})(),e.jsx("div",{className:"bg-black rounded-2xl p-6",children:e.jsx(ct,{segments:C,selectedSegment:g,onSegmentClick:j})}),e.jsx(m,{children:e.jsx(p.div,{layout:!0,transition:rt,className:"space-y-2 min-w-0",children:(()=>{var t,s,a,n;const r=[{id:"header",title:"Header",color:"red",startByte:0,endByte:0,hexBytes:`0x${y.headerHex.toUpperCase()}`,condition:!0,content:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-[10px] uppercase tracking-wide text-text-muted border-b border-border-subtle font-sans",children:[e.jsx("th",{className:"py-1 font-medium",children:"Bits"}),e.jsx("th",{className:"py-1 font-medium",children:"Field"}),e.jsx("th",{className:"py-1 font-medium",children:"Value"}),e.jsx("th",{className:"py-1 font-medium",children:"Binary"})]})}),e.jsx("tbody",{children:y.headerFields.map(t=>e.jsx(ot,{...t},t.bits))})]})},{id:"transportCodes",title:"Transport Codes",color:"purple",startByte:1,endByte:4,hexBytes:(null==(t=y.transportCodesHex)?void 0:t.toUpperCase())||"",condition:!!y.transportCodesHex,content:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-text-muted",children:"Two 16-bit transport codes for encrypted routing"}),e.jsxs("div",{className:"mt-1 text-xs text-text-secondary",children:["Code 1: 0x",null==(s=y.transportCodesHex)?void 0:s.slice(0,4).toUpperCase()," | Code 2: 0x",null==(a=y.transportCodesHex)?void 0:a.slice(4,8).toUpperCase()]})]})},{id:"pathLength",title:"Path Length",color:"green",startByte:y.transportCodesHex?5:1,endByte:y.transportCodesHex?5:1,hexBytes:`0x${y.pathLengthHex.toUpperCase()}`,condition:!0,content:e.jsxs("p",{className:"text-xs text-text-muted pt-1",children:[N.pathLen," bytes showing route taken (increases as packet floods)"]})},{id:"pathData",title:"Path Data",color:"amber",startByte:y.transportCodesHex?6:2,endByte:(y.transportCodesHex?5:1)+N.pathLen,hexBytes:(null==(n=y.pathDataHex)?void 0:n.toUpperCase())||"",condition:N.pathLen>0,content:e.jsxs("div",{className:"space-y-3",children:[e.jsx(bt,{pathHex:y.pathDataHex}),e.jsx("p",{className:"text-xs text-text-muted",children:"Historical route taken (bytes are added as packet floods through network)"})]})},{id:"payload",title:"Payload",color:"cyan",startByte:y.payloadStartByte,endByte:l-1,hexBytes:y.payloadHex.toUpperCase(),condition:!0,content:e.jsxs(e.Fragment,{children:[!Ze(g)&&e.jsxs("div",{className:"p-3 rounded-lg bg-black",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-wide text-text-muted mb-1.5 font-sans",children:"Decoded"}),e.jsx(Nt,{decoded:v,payloadType:N.payloadType})]}),!Ze(g)&&w.length>0&&e.jsx("p",{className:"text-[10px] uppercase tracking-wide text-text-muted mt-3 font-sans",children:"Click a field below to highlight its bytes"}),Ze(g)&&e.jsx("p",{className:"text-[10px] uppercase tracking-wide text-text-muted font-sans",children:"↑ Selected field above • Other fields below ↓"})]})}].filter(e=>e.condition),i=Ze(g)?w.find(e=>e.id===g):null,c=Ze(g)?[...r].sort((e,t)=>"payload"===e.id?-1:"payload"===t.id?1:0):[...r].sort((e,t)=>e.id===g?-1:t.id===g?1:0),o=Ze(g)?w.filter(e=>e.id!==g):[];return e.jsxs(e.Fragment,{children:[i&&e.jsx(dt,{id:`subfield-${i.id}`,title:i.title,color:i.color,startByte:y.payloadStartByte+i.startByte,endByte:y.payloadStartByte+i.endByte,hexBytes:i.hex.toUpperCase(),isSelected:!0,children:i.decoded},i.id),c.map(t=>e.jsx(dt,{id:`section-${t.id}`,title:t.title,color:t.color,startByte:t.startByte,endByte:t.endByte,hexBytes:t.hexBytes,isSelected:t.id===g,children:t.content},t.id)),o.map(t=>e.jsxs(p.div,{layout:"position",layoutId:`subfield-${t.id}`,transition:rt,className:"w-full min-w-0 overflow-hidden rounded-xl p-4 sm:p-5 space-y-4",style:{backgroundColor:st,boxShadow:at},children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-0.5 min-w-0",children:[e.jsx(U,{color:t.color,children:t.title}),t.hex.length<=32&&Xe(t.hex).map((s,a)=>e.jsx(U,{color:t.color,className:"font-mono",children:s.toUpperCase()},a))]}),e.jsxs("span",{className:"text-[10px] text-text-muted font-mono flex-shrink-0",children:["Bytes ",y.payloadStartByte+t.startByte,"-",y.payloadStartByte+t.endByte]})]}),e.jsx("div",{className:"min-w-0 overflow-hidden p-3 rounded-lg bg-black",children:t.decoded})]},t.id))]})})()})})]})});function wt(e){if(!e)return[];if(Array.isArray(e))return e;try{const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}}function kt(e){return e?(e.startsWith("0x")?e.slice(2):e).slice(0,2).toUpperCase():""}function Ct({hop:s,compact:a=!1,index:n=0,highlightIndex:r=-1,isTrace:l=!1}){var i;const c=n===r,o=S();return t.useEffect(()=>{c&&l&&o.start({boxShadow:["0 0 0 0px rgba(113, 156, 223, 0)","0 0 0 2px rgba(113, 156, 223, 0.5)","0 0 0 2px rgba(113, 156, 223, 0.5)","0 0 0 0px rgba(113, 156, 223, 0)"],transition:{duration:.5,times:[0,.2,.7,1],ease:"easeInOut"}})},[c,l,o]),e.jsxs(p.div,{className:E("flex items-center gap-1.5",a?"flex-row":"flex-col"),animate:{scale:c?1.05:1,opacity:c?1:.85},transition:{duration:.3,ease:"easeInOut"},children:[e.jsxs(p.div,{className:E("flex items-center gap-1.5 px-2.5 py-1 rounded-md","font-mono text-xs font-semibold",s.isLocal?"bg-amber-500/20 text-amber-300 ring-1 ring-amber-500/30":"bg-zinc-700/50 text-zinc-200 ring-1 ring-zinc-600/50"),animate:o,initial:{boxShadow:"0 0 0 0px rgba(113, 156, 223, 0)"},children:[s.isLocal&&e.jsx(P,{className:"w-3 h-3"}),e.jsx("span",{children:s.prefix}),void 0!==s.confidence&&s.confidence<.9&&e.jsxs("span",{className:"text-[9px] opacity-70",children:[(100*s.confidence).toFixed(0),"%"]})]}),!a&&(null==(i=s.neighborInfo)?void 0:i.name)&&e.jsx("span",{className:"text-[10px] text-text-muted truncate max-w-[80px]",children:s.neighborInfo.name})]})}function St({snr:t}){const s=ke(t),a=we()[s]||"#6b7280",n=Number.isInteger(t)?t.toString():t.toFixed(1);return e.jsxs(U,{customColor:a,compact:!0,className:"font-mono",children:[t>=0?"+":"",n,"dB"]})}function Pt({hops:s,compact:a,isTrace:n=!1}){const[r,l]=t.useState(-1);return t.useEffect(()=>{if(0===s.length)return;const e=setTimeout(()=>{l(0)},400),t=setInterval(()=>{l(e=>{const a=e+1;return a>=s.length?(clearInterval(t),-1):a})},n?500:600);return()=>{clearTimeout(e),clearInterval(t)}},[s.length,n]),e.jsx("div",{className:"p-6",style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"4px 8px"},children:s.map((t,l)=>{const i=l%2==0,c=l===s.length-1;return e.jsxs("div",{className:"contents",children:[e.jsx("div",{className:E("flex items-center","justify-end"),children:i&&e.jsx(Ct,{hop:t,compact:a,index:l,highlightIndex:r,isTrace:n})}),e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[28px]",children:!c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px flex-1 bg-zinc-600/40 min-h-[8px]"}),void 0!==t.snr&&e.jsx(St,{snr:t.snr}),e.jsx("svg",{className:"w-3 h-3 text-zinc-500 flex-shrink-0",viewBox:"0 0 12 12",fill:"none",children:e.jsx("path",{d:"M6 2v8M3 7l3 3 3-3",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]})}),e.jsx("div",{className:E("flex items-center","justify-start"),children:!i&&e.jsx(Ct,{hop:t,compact:a,index:l,highlightIndex:r,isTrace:n})})]},`${t.prefix}-${l}`)})})}const _t=t.memo(function({packet:s,neighbors:a,localHash:n,neighborAffinity:i,ghostPrefixes:c,direction:o="horizontal",compact:d=!1,traceSnr:x,overridePath:m}){const p=void 0!==x&&x.length>0,h=wt(s.original_path),u=wt(s.forwarded_path),g=m??(u.length>0?u:h),f=kt(n),j=t.useMemo(()=>g.map((e,t)=>{const s=e.toUpperCase(),n=s===f,r=(null==c?void 0:c.has(s))??!1,l=function(e,t,s){const a=e.toUpperCase();if(s){let e=null,n=0;if(s.forEach((t,s)=>{if(kt(s)===a){const a=t.combinedScore??0;a>n&&(n=a,e=s)}}),e&&t[e])return{hash:e,info:t[e],confidence:n}}for(const[n,r]of Object.entries(t))if(kt(n)===a)return{hash:n,info:r,confidence:void 0};return null}(s,a,i);return{prefix:s,fullHash:null==l?void 0:l.hash,neighborInfo:null==l?void 0:l.info,isLocal:n,isGhost:r,confidence:null==l?void 0:l.confidence,snr:null==x?void 0:x[t]}}),[g,a,i,f,c,x]);if(0===j.length)return e.jsxs("div",{className:"flex items-center gap-2 text-text-muted text-xs",children:[e.jsx(v,{className:"w-4 h-4 opacity-50"}),e.jsx("span",{children:"Direct / No path data"})]});if("flowchart"===o)return e.jsx(Pt,{hops:j,compact:d,isTrace:p});const y="horizontal"===o?r:l;return e.jsx("div",{className:E("flex gap-1.5","horizontal"===o?"flex-row flex-wrap items-center":"flex-col items-start"),children:j.map((t,s)=>e.jsxs("div",{className:E("flex items-center gap-1.5","vertical"===o&&"flex-col"),children:[e.jsx(Ct,{hop:t,compact:d}),s<j.length-1&&e.jsx(y,{className:"w-3 h-3 text-text-muted flex-shrink-0"})]},`${t.prefix}-${s}`))})});function Tt(e){if(!e)return[];if(Array.isArray(e))return e;try{const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}}function Ht({packets:t,selectedIndex:s,onSelect:a,compact:r=!1}){if(t.length<=1)return null;const l=s>0,c=s<t.length-1;return e.jsxs("div",{className:E("flex items-center gap-1",r?"gap-0.5":"gap-1"),children:[e.jsx("button",{onClick:()=>l&&a(s-1),disabled:!l,className:E("p-0.5 rounded transition-colors",l?"text-text-muted hover:text-text-primary hover:bg-white/10":"text-white/20 cursor-not-allowed"),"aria-label":"Previous observation",children:e.jsx(B,{className:r?"size-3":"size-4"})}),e.jsx("div",{className:"flex items-center gap-0.5",children:t.map((t,n)=>{const l=n===s,i=new Date(1e3*t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});return e.jsx(te,{color:l?"cyan":"zinc",filled:l,compact:r,onClick:()=>a(n),title:`Observation ${n+1} at ${i}`,className:E("transition-all duration-150",!l&&"opacity-60 hover:opacity-100"),children:r?e.jsx("span",{className:"tabular-nums",children:n+1}):e.jsxs("span",{className:"tabular-nums text-[10px]",children:["#",n+1,null!=t.rssi&&e.jsx("span",{className:"ml-1 opacity-70",children:t.rssi})]})},`${t.timestamp}_${n}`)})}),e.jsx("button",{onClick:()=>c&&a(s+1),disabled:!c,className:E("p-0.5 rounded transition-colors",c?"text-text-muted hover:text-text-primary hover:bg-white/10":"text-white/20 cursor-not-allowed"),"aria-label":"Next observation",children:e.jsx(i,{className:r?"size-3":"size-4"})}),e.jsxs("span",{className:E("text-text-muted ml-1",r?"text-[9px]":"text-[10px]"),children:[e.jsx(n,{className:"inline size-3 mr-0.5 opacity-50"}),t.length]})]})}function Bt({icon:t,label:s,disabled:a=!1}){return e.jsx(p.div,{className:"flex items-center gap-1 text-[10px]",title:s,animate:{opacity:a?.25:.6},transition:{duration:.15,ease:[.4,0,.2,1]},children:e.jsx("span",{className:E("flex items-center justify-center size-5 rounded border transition-colors duration-150",a?"bg-white/[0.02] border-white/5":"bg-white/5 border-white/10"),children:t})})}function Mt({hasDuplicates:t,hasPrev:s,hasNext:a,canPrevDupe:n,canNextDupe:r}){return e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(Bt,{icon:e.jsx(M,{className:"size-3"}),label:"Previous packet (↑)",disabled:!s}),e.jsx(Bt,{icon:e.jsx(F,{className:"size-3"}),label:"Next packet (↓)",disabled:!a})]}),t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-3 bg-white/10"}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(Bt,{icon:e.jsx(B,{className:"size-3"}),label:"Previous observation (←)",disabled:!n}),e.jsx(Bt,{icon:e.jsx(i,{className:"size-3"}),label:"Next observation (→)",disabled:!r})]})]})]})}const Ft=t.memo(function({packets:s,initialIndex:a=0,onClose:n,onNavigatePrev:r,onNavigateNext:l,hasPrev:i=!1,hasNext:c=!1}){const[d,x]=t.useState(a),m=s[d]??s[0],h=s.length>1,u=d>0,f=d<s.length-1,j=t.useCallback(e=>{x(Math.max(0,Math.min(e,s.length-1)))},[s.length]);t.useEffect(()=>{const e=e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement))switch(e.key){case"ArrowUp":e.preventDefault(),null==r||r();break;case"ArrowDown":e.preventDefault(),null==l||l();break;case"ArrowLeft":e.preventDefault(),u&&x(e=>e-1);break;case"ArrowRight":e.preventDefault(),f&&x(e=>e+1)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[r,l,u,f]);const y=K(),b=Y(),N=J(),w=X(),k=t.useMemo(()=>new Set(w.map(e=>e.prefix.toUpperCase())),[w]),C=m.payload_type_name||V(m.payload_type??m.type),S=m.route_type_name||Q(m.route_type??m.route),P=m.payload_length??m.length??0,B=Tt(m.original_path),M=Tt(m.forwarded_path),F=B.length>0||M.length>0,L=M.length>0?M:B,D=t.useMemo(()=>{var e;if(null==(e=null==y?void 0:y.config)?void 0:e.repeater)return{latitude:y.config.repeater.latitude,longitude:y.config.repeater.longitude,name:y.config.node_name||"Local Node"}},[y]),z=(null==y?void 0:y.neighbors)??{},A=N.size>0?N:void 0,E=m.raw_packet&&m.raw_packet.length>0,R=t.useMemo(()=>{if((m.payload_type??m.type)!==xe.TRACE||!m.payload)return null;try{const e=oe(m.payload),t=m.original_path||m.forwarded_path||[];let s=[];if("string"==typeof t)try{const e=JSON.parse(t);Array.isArray(e)&&(s=e.map(e=>parseInt(e,16)))}catch{s=[]}else Array.isArray(t)&&(s=t.map(e=>parseInt(e,16)));return de(e,s)}catch{return null}},[m]),I=null==R?void 0:R.snrValues,$=t.useMemo(()=>{if((m.payload_type??m.type)!==xe.ADVERT||!m.payload)return null;try{const e=oe(m.payload),t=ue(e);if(!t)return null;const s=t.publicKey.slice(0,2).toUpperCase();return{...t,prefix:s}}catch{return null}},[m]),O=t.useMemo(()=>{if((null==$?void 0:$.latitude)&&(null==$?void 0:$.longitude))return{latitude:$.latitude,longitude:$.longitude,name:$.name||`Node ${$.prefix||"??"}`,prefix:$.prefix,publicKey:$.publicKey}},[$]),W=e=>e&&0!==e?new Date(1e3*e).toLocaleString():"Unknown",[G,q]=t.useState(null);t.useEffect(()=>{if((m.payload_type??m.type)!==xe.GRP_TXT||!m.payload)return void q(null);let e=!1;const t=oe(m.payload);return me(t).then(t=>{!e&&t&&q(t)}),()=>{e=!0}},[m]);const te=t.useCallback(e=>{if(!e)return null;const t=e.trim().match(/(-?\d+\.?\d*)\s*[,\s]\s*(-?\d+\.?\d*)/);if(!t)return null;const s=parseFloat(t[1]),a=parseFloat(t[2]);return isNaN(s)||isNaN(a)||s<-90||s>90||a<-180||a>180||0===s&&0===a?null:{lat:s,lon:a}},[]),se=t.useMemo(()=>{var e,t;if(!(null==G?void 0:G.decrypted))return;if(!(null==(e=G.channelName)?void 0:e.toLowerCase().includes("wardrive")))return;const s=te(G.text);return s?{latitude:s.lat,longitude:s.lon,name:G.senderName||"Wardrive Ping",prefix:(null==(t=G.senderName)?void 0:t.slice(0,2).toUpperCase())||"WD",nodeType:"wardrive"}:void 0},[G,te]),ae=(m.payload_type??m.type)===xe.ADVERT&&(void 0!==O||F),ne=void 0!==se,re=O??se;if(0===L.length)return null;const le=(null==y?void 0:y.local_hash)?(y.local_hash.startsWith("0x")?y.local_hash.slice(2,4):y.local_hash.slice(0,2)).toUpperCase():"";for(const e of L){const t=e.toUpperCase();if(t!==le)if(A){let e=0,s=0;if(A.forEach((a,n)=>{(n.startsWith("0x")?n.slice(2,4):n.slice(0,2)).toUpperCase()===t&&(e++,s=Math.max(s,a.combinedScore??0))}),0===e)for(const a of Object.keys(z))if((a.startsWith("0x")?a.slice(2,4):a.slice(0,2)).toUpperCase()===t)break}else for(const e of Object.keys(z))if((e.startsWith("0x")?e.slice(2,4):e.slice(0,2)).toUpperCase()===t)break}const ie={lime:"rgb(132, 204, 22)",cyan:"rgb(34, 211, 238)",amber:"rgb(251, 191, 36)",violet:"rgb(167, 139, 250)",rose:"rgb(251, 113, 133)",emerald:"rgb(52, 211, 153)",sky:"rgb(56, 189, 248)",orange:"rgb(251, 146, 60)",pink:"rgb(244, 114, 182)",zinc:"rgb(161, 161, 170)",purple:"rgb(168, 85, 247)",indigo:"rgb(129, 140, 248)",teal:"rgb(45, 212, 191)",fuchsia:"rgb(232, 121, 249)",blue:"rgb(59, 130, 246)",green:"rgb(34, 197, 94)",yellow:"rgb(250, 204, 21)",red:"rgb(239, 68, 68)"},ce=ie[ye[C]??"zinc"]||ie.zinc;return e.jsxs(Z,{open:!0,onClose:n,size:"5xl",motionPlus:!0,className:"sm:h-[85vh] sm:max-h-[800px] md:h-[80vh] md:max-h-[900px]",children:[e.jsxs("div",{className:"sm:hidden",children:[e.jsx("div",{className:"flex justify-center pt-2 pb-1",children:e.jsx("div",{className:"w-9 h-1 rounded-full bg-white/30","aria-hidden":"true"})}),e.jsxs("div",{className:"flex items-center justify-between px-3 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(U,{color:ye[C]??"zinc",className:"!text-[9px] !px-1.5 !py-0",children:C}),e.jsx(U,{color:"DIRECT"===S||"T_DIRECT"===S?"cyan":"amber",className:"!text-[9px] !px-1.5 !py-0",children:S}),e.jsxs(U,{color:"zinc",className:"!text-[9px] !px-1.5 !py-0",children:[P,"B"]})]}),e.jsx("button",{onClick:n,className:"px-3 py-1.5 text-[15px] font-medium text-blue-400 active:text-blue-300 transition-colors flex-shrink-0 rounded-lg active:bg-white/5",children:"Done"})]}),h&&e.jsx("div",{className:"px-3 pb-2",children:e.jsx(Ht,{packets:s,selectedIndex:d,onSelect:j,compact:!0})})]}),e.jsx("div",{className:"hidden sm:block px-6 pt-5 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{color:ye[C]??"zinc",children:C}),e.jsx(U,{color:"DIRECT"===S||"T_DIRECT"===S?"cyan":"amber",children:S}),e.jsxs(U,{color:"zinc",children:[P,"B"]}),h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-4 bg-white/10"}),e.jsx(Ht,{packets:s,selectedIndex:d,onSelect:j})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Mt,{hasDuplicates:h,hasPrev:i,hasNext:c,canPrevDupe:u,canNextDupe:f}),e.jsx("button",{onClick:n,className:"p-1.5 -m-1.5 text-text-muted hover:text-text-primary transition-colors rounded-lg hover:bg-bg-elevated flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})}),e.jsx("div",{className:"sm:hidden h-[2px]",style:{backgroundColor:ce,opacity:.6}}),e.jsxs(ee,{className:"p-0 overflow-hidden flex-1 flex flex-col min-h-0",children:[e.jsx("div",{className:"md:hidden flex-1 overflow-y-auto overflow-x-hidden",children:e.jsxs("div",{className:"p-2 space-y-2",children:[(null!=m.rssi||null!=m.snr)&&e.jsxs("div",{className:"relative flex items-center justify-between px-2 py-1.5 rounded-lg bg-white/[0.03]",children:[e.jsx(_,{mode:"popLayout",initial:!1,children:e.jsxs(p.div,{className:"flex items-center gap-3",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[e.jsx(fe,{rssi:m.rssi,snr:m.snr,compact:!0,showValues:!0}),e.jsx("span",{className:"text-[11px] text-white/50",children:be(m.rssi)})]},d)}),L.length>0&&e.jsxs("span",{className:"text-[10px] font-mono text-white/40",children:[L.length," hop",1!==L.length?"s":""]})]}),(F&&L.length>0||ae||ne)&&e.jsx("div",{className:"overflow-hidden rounded-xl",children:e.jsx("div",{className:"aspect-[4/3] w-full",children:e.jsx(Je,{path:L,neighbors:z,localNode:D,localHash:null==y?void 0:y.local_hash,srcHash:m.src_hash,dstHash:m.dst_hash,neighborAffinity:A,hubNodes:[...b],traceSnr:I,advertiserSource:re})})}),R&&R.pathHashes.length>0&&e.jsxs("div",{className:"rounded-xl bg-black overflow-hidden",children:[e.jsx("div",{className:"px-3 py-2 space-y-1.5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] font-medium text-text-muted uppercase tracking-wide",children:"Trace Route"}),e.jsx("div",{className:"flex items-center gap-1.5",children:e.jsx(U,{color:R.isComplete?"green":"amber",compact:!0,children:R.isComplete?"Complete":"In Progress"})})]})}),e.jsx(_t,{packet:m,neighbors:z,localHash:null==y?void 0:y.local_hash,neighborAffinity:A,ghostPrefixes:k,direction:"flowchart",compact:!0,overridePath:R.pathHashes,traceSnr:R.snrValues})]}),F&&!R&&e.jsxs("div",{className:"rounded-xl bg-black overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[e.jsx("span",{className:"text-[10px] font-medium text-text-muted uppercase tracking-wide",children:"Path"}),e.jsxs(U,{color:"zinc",compact:!0,children:[L.length," hop",1!==L.length?"s":""]})]}),e.jsx(_t,{packet:m,neighbors:z,localHash:null==y?void 0:y.local_hash,neighborAffinity:A,ghostPrefixes:k,direction:"flowchart",compact:!0,traceSnr:I})]}),$&&e.jsxs("div",{className:"rounded-xl bg-white/[0.03] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-white/5",children:[e.jsx("span",{className:"text-[10px] font-medium text-text-muted uppercase tracking-wide",children:"Advertiser Info"}),e.jsx(U,{color:"lime",compact:!0,children:$.nodeType})]}),e.jsxs("div",{className:"p-3 space-y-2",children:[$.name&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-3.5 h-3.5 text-text-muted flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-text-primary truncate",children:$.name})]}),$.latitude&&$.longitude&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{className:"w-3.5 h-3.5 text-text-muted flex-shrink-0"}),e.jsxs("span",{className:"text-xs font-mono text-text-secondary",children:[$.latitude.toFixed(5),", ",$.longitude.toFixed(5)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-3.5 h-3.5 text-text-muted flex-shrink-0"}),e.jsxs("span",{className:"text-[10px] font-mono text-text-muted truncate",children:[$.publicKey.slice(0,16),"...",$.publicKey.slice(-8)]})]}),$.timestamp>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-3.5 h-3.5 text-text-muted flex-shrink-0"}),e.jsx("span",{className:"text-xs text-text-muted",children:W($.timestamp)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-3.5 h-3.5 text-text-muted flex-shrink-0"}),e.jsx("span",{className:"text-[10px] text-text-muted",children:$.flagsDescription||`Flags: 0x${$.flags.toString(16).padStart(2,"0")}`})]})]})]}),E&&e.jsx("div",{className:"pt-1",children:e.jsx(vt,{packet:m})})]})}),e.jsxs("div",{className:"hidden md:grid md:grid-cols-2 flex-1 overflow-hidden",children:[e.jsx("div",{className:"overflow-y-auto overflow-x-hidden scrollbar-none p-4 border-r border-border-subtle",children:E&&e.jsx(vt,{packet:m})}),e.jsxs("div",{className:"grid overflow-hidden",style:{gridTemplateRows:"minmax(280px, 1fr) auto"},children:[e.jsx("div",{className:"overflow-hidden p-2",children:F&&L.length>0||ae||ne?e.jsx("div",{className:"h-full w-full",children:e.jsx(Je,{path:L,neighbors:z,localNode:D,localHash:null==y?void 0:y.local_hash,srcHash:m.src_hash,dstHash:m.dst_hash,neighborAffinity:A,hubNodes:[...b],traceSnr:I,advertiserSource:re})}):e.jsxs("div",{className:"h-full w-full flex flex-col items-center justify-center text-center px-4",children:[e.jsx(v,{className:"w-8 h-8 text-text-muted/50 mb-2"}),e.jsx("span",{className:"text-sm text-text-muted",children:"Direct Reception"}),e.jsx("span",{className:"text-xs text-text-muted/70 mt-1",children:"Zero-hop packet — received directly from sender"})]})}),e.jsxs("div",{className:"overflow-y-auto max-h-[200px] p-2 space-y-2",children:[!R&&L.length<=1&&(null!=m.rssi||null!=m.snr)&&e.jsx("div",{className:"glass-card rounded-xl p-4",children:e.jsxs("dl",{className:"text-xs grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-text-muted mb-1",children:"Signal"}),e.jsx(_,{mode:"popLayout",initial:!1,children:e.jsxs(p.dd,{className:"flex items-center gap-2",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[e.jsx(fe,{rssi:m.rssi,snr:m.snr}),e.jsx("span",{className:"font-medium text-text-primary",children:be(m.rssi)})]},d)})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-text-muted mb-1",children:"RF"}),e.jsx(_,{mode:"popLayout",initial:!1,children:e.jsxs(p.dd,{className:"font-mono text-text-secondary tabular-nums",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[null!=m.rssi&&`${m.rssi} dBm`,null!=m.snr&&` · ${m.snr.toFixed(1)} dB`]},d)})]})]})}),$&&e.jsxs("div",{className:"rounded-xl bg-white/[0.03] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-white/5",children:[e.jsx("span",{className:"text-xs font-medium text-text-muted uppercase tracking-wide",children:"Advertiser"}),e.jsx(U,{color:"lime",compact:!0,children:$.nodeType})]}),e.jsxs("div",{className:"p-4 space-y-2.5",children:[$.name&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4 text-text-muted flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-text-primary truncate",children:$.name})]}),$.latitude&&$.longitude&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{className:"w-4 h-4 text-text-muted flex-shrink-0"}),e.jsxs("span",{className:"text-xs font-mono text-text-secondary",children:[$.latitude.toFixed(5),", ",$.longitude.toFixed(5)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-text-muted flex-shrink-0"}),e.jsxs("span",{className:"text-[11px] font-mono text-text-muted truncate",children:[$.publicKey.slice(0,16),"...",$.publicKey.slice(-8)]})]}),$.timestamp>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4 text-text-muted flex-shrink-0"}),e.jsx("span",{className:"text-xs text-text-muted",children:W($.timestamp)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-4 h-4 text-text-muted flex-shrink-0"}),e.jsx("span",{className:"text-[11px] text-text-muted",children:$.flagsDescription||`Flags: 0x${$.flags.toString(16).padStart(2,"0")}`})]})]})]}),R&&R.pathHashes.length>0&&e.jsxs("div",{className:"rounded-xl bg-black overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-text-muted uppercase tracking-wide",children:"Trace Route"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(U,{color:R.isComplete?"green":"amber",compact:!0,children:R.isComplete?"Complete":"In Progress"}),e.jsxs(U,{color:"teal",compact:!0,children:[R.pathHashes.length,"h"]})]})]}),e.jsx(_t,{packet:m,neighbors:z,localHash:null==y?void 0:y.local_hash,neighborAffinity:A,ghostPrefixes:k,direction:"flowchart",compact:!0,overridePath:R.pathHashes,traceSnr:R.snrValues})]}),F&&!R&&e.jsxs("div",{className:"rounded-xl bg-black overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2",children:[e.jsx("span",{className:"text-xs font-medium text-text-muted uppercase tracking-wide",children:"Path"}),e.jsxs(U,{color:"zinc",compact:!0,children:[L.length,"h"]})]}),e.jsx(_t,{packet:m,neighbors:z,localHash:null==y?void 0:y.local_hash,neighborAffinity:A,ghostPrefixes:k,direction:"flowchart",compact:!0,traceSnr:I})]})]})]})]})]})]})}),Lt={type:"spring",visualDuration:.6,bounce:.25,opacity:{duration:.2,ease:"linear"}};function Dt({value:s,format:a,prefix:n,className:r}){const[l,i]=t.useState("waiting");if(t.useEffect(()=>{const e=setTimeout(()=>{i("mounted")},400);return()=>clearTimeout(e)},[]),t.useEffect(()=>{if("mounted"===l){const e=requestAnimationFrame(()=>{i("animating")});return()=>cancelAnimationFrame(e)}},[l]),"waiting"===l){const t=(0).toLocaleString(void 0,a);return e.jsxs("span",{className:r,children:[n,t]})}return e.jsx(z,{className:r,format:a,prefix:n,transition:Lt,children:"animating"===l?s:0})}function zt({label:t,numericValue:s,unit:a,icon:n,subtext:r,showSign:l=!1}){return e.jsxs("div",{className:"rounded-lg p-3 sm:rounded-xl sm:p-4 bg-white/[0.03] ring-1 ring-inset ring-white/[0.06]",children:[e.jsx("div",{className:"mb-1.5 sm:mb-2",children:e.jsx("span",{className:"text-[10px] sm:text-[11px] font-medium uppercase tracking-wide text-text-muted",children:t})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Dt,{value:s,format:{minimumFractionDigits:1,maximumFractionDigits:1,signDisplay:l?"always":"auto"},className:"font-mono text-xl sm:text-2xl font-semibold tabular-nums tracking-tight text-white"}),e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(n,{className:"w-[14px] h-[14px] text-text-muted"}),a&&e.jsx("span",{className:"text-[10px] sm:text-xs font-medium leading-tight text-text-muted",children:a})]})]}),r&&e.jsx("p",{className:"mt-1.5 sm:mt-2 font-mono text-[10px] sm:text-[11px] text-text-muted/80 truncate",children:r})]})}function At({snr:t}){const s=t>=5?"bg-sys-teal":t>=0?"bg-sys-green":t>=-5?"bg-sys-amber":t>=-10?"bg-sys-orange":"bg-sys-red";return e.jsx("span",{className:E("w-1.5 h-1.5 rounded-full flex-shrink-0",s),title:`SNR: ${t.toFixed(1)} dB`})}function Et({fromPrefix:t,toPrefix:s,fromName:a,toName:n,snr:l,maxSnr:i,isWeakest:c,isStrongest:o,index:d=0}){const x=Math.max(i+5,15),m=Math.max(0,Math.min(100,(l- -20)/(x- -20)*100)),h="bg-[#0074BE]",u=l>=5?"bg-sys-teal":l>=0?"bg-sys-green":l>=-5?"bg-sys-amber":l>=-10?"bg-sys-orange":"bg-sys-red",g=.3+.15*d;return e.jsxs("div",{className:"relative p-3 pl-5 rounded-lg bg-white/[0.03] ring-1 ring-inset ring-white/[0.06]",children:[e.jsx("span",{className:E("absolute left-0 top-1/2 -translate-y-1/2 h-4 w-0.5 rounded-full",u)}),e.jsx("span",{className:"absolute -top-0.5 -right-0.5",children:e.jsx(At,{snr:l})}),e.jsxs("div",{className:"sm:hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("span",{className:"text-[13px] font-medium text-white/70 truncate",children:a||t}),e.jsx(r,{className:"w-3 h-3 text-white/30 flex-shrink-0"}),e.jsx("span",{className:"text-[13px] font-semibold text-white truncate",children:n||s})]}),e.jsxs("div",{className:"flex items-center gap-1.5 ml-2 flex-shrink-0",children:[c&&e.jsx(U,{color:"red",compact:!0,children:"Low"}),o&&!c&&e.jsxs(U,{color:"amber",compact:!0,children:[e.jsx(A,{className:"w-2.5 h-2.5"}),"Best"]}),e.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[12px] font-mono font-bold tabular-nums bg-white/[0.06] text-text-primary ring-1 ring-inset ring-white/[0.1]",children:[l>=0?"+":"−",Math.abs(l).toFixed(1)]})]})]}),e.jsx("div",{className:"h-1.5 bg-white/10 rounded-full overflow-hidden",children:e.jsx(p.div,{className:E("h-full rounded-full",h),initial:{width:0},animate:{width:`${m}%`},transition:{duration:1.5,delay:g,ease:[.25,.1,.25,1]}})})]}),e.jsxs("div",{className:"hidden sm:block",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx("code",{className:"font-mono text-xs text-text-muted",children:t}),a&&e.jsx("span",{className:"text-xs text-text-secondary truncate max-w-[100px]",children:a})]}),e.jsx(r,{className:"w-3 h-3 text-text-muted/40 flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx("code",{className:"font-mono text-xs font-semibold text-text-primary",children:s}),n&&e.jsx("span",{className:"text-xs text-text-secondary truncate max-w-[100px]",children:n})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[c&&e.jsx(U,{color:"red",compact:!0,children:"Bottleneck"}),o&&!c&&e.jsxs(U,{color:"amber",compact:!0,children:[e.jsx(A,{className:"w-3 h-3"}),"Strongest"]}),e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-sm font-mono font-semibold tabular-nums bg-white/[0.06] text-text-primary ring-1 ring-inset ring-white/[0.1]",children:[l>=0?"+":"−",Math.abs(l).toFixed(1)]})]})]}),e.jsx("div",{className:"h-1.5 bg-bg-elevated rounded-full overflow-hidden",children:e.jsx(p.div,{className:E("h-full rounded-full",h),initial:{width:0},animate:{width:`${m}%`},transition:{duration:1.5,delay:g,ease:[.25,.1,.25,1]}})})]})]})}function Rt(e,t){if("You"===e)return"You";const s=e.toUpperCase();for(const[a,n]of Object.entries(t))if((a.startsWith("0x")?a.slice(2,4):a.slice(0,2)).toUpperCase()===s)return n.name||n.node_name||void 0}const Ut=t.memo(function({report:t,onClose:s}){var a,n;const r=K(),l=(null==r?void 0:r.neighbors)??{},i=(null==(a=null==r?void 0:r.config)?void 0:a.repeater)?{latitude:r.config.repeater.latitude,longitude:r.config.repeater.longitude,name:r.config.node_name||"Local Node"}:void 0,c=null==(n=t.bestObservation)?void 0:n.decoded.snrValues,o=t.linkQuality?t.linkQuality.avgSnr>=5?"excellent":t.linkQuality.avgSnr>=0?"good":t.linkQuality.avgSnr>=-5?"fair":"poor":"unknown",d={excellent:"var(--signal-excellent)",good:"var(--signal-good)",fair:"var(--signal-fair)",poor:"var(--signal-poor)",unknown:"var(--text-muted)"}[o];return e.jsxs(Z,{open:!0,onClose:s,size:"5xl",motionPlus:!0,children:[e.jsxs("div",{className:"sm:hidden",children:[e.jsx("div",{className:"flex justify-center pt-2 pb-1",children:e.jsx("div",{className:"w-9 h-1 rounded-full bg-white/30","aria-hidden":"true"})}),e.jsxs("div",{className:"flex items-center justify-between px-4 pb-2",children:[e.jsx("h2",{className:"font-semibold text-[17px] text-white",children:"Trace Report"}),e.jsx("button",{onClick:s,className:"text-[17px] font-medium text-blue-400 active:text-blue-300",children:"Done"})]})]}),e.jsx("div",{className:"sm:hidden h-[2px]",style:{backgroundColor:d,opacity:.6}}),e.jsx("div",{className:"hidden sm:block px-6 pt-5 pb-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-text-primary",children:"Trace Report"}),e.jsxs(U,{color:"excellent"===o||"good"===o?"green":"fair"===o?"amber":"red",children:[e.jsx(L,{className:"w-3 h-3 mr-1"}),"excellent"===o?"Excellent":"good"===o?"Good":"fair"===o?"Fair":"Poor"]})]}),e.jsx("p",{className:"mt-1 text-xs sm:text-sm font-mono text-text-muted tabular-nums",children:t.traceTag})]}),e.jsx("button",{onClick:s,className:"p-1.5 -m-1.5 text-text-muted hover:text-text-primary transition-colors rounded-lg hover:bg-bg-elevated flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsxs("div",{className:"hidden sm:flex flex-wrap items-center gap-1.5 sm:gap-2 px-4 sm:px-6 pb-3 sm:pb-4 border-b border-border-subtle",children:[e.jsxs(U,{color:"teal",children:[e.jsx("span",{className:"font-mono tabular-nums",children:t.targetHopCount}),e.jsxs("span",{className:"ml-1",children:["hop",1!==t.targetHopCount?"s":""]})]}),e.jsxs(U,{color:"zinc",children:[e.jsx("span",{className:"font-mono tabular-nums",children:t.observationCount}),e.jsx("span",{className:"ml-1",children:"obs"})]}),t.linkQuality&&e.jsxs(U,{color:"purple",children:[e.jsx("span",{className:"font-mono tabular-nums",children:t.linkQuality.avgSnr.toFixed(1)}),e.jsx("span",{className:"ml-1",children:"dB avg"})]}),e.jsx("span",{className:"font-mono text-xs text-text-muted tabular-nums",children:se(t.duration)}),t.linkQuality&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-text-muted/40",children:"•"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-medium bg-sys-red/15 text-sys-red ring-1 ring-inset ring-sys-red/25",children:[e.jsx("span",{className:"opacity-70",children:"Min"}),e.jsx("span",{className:"font-mono tabular-nums",children:t.linkQuality.minSnr.toFixed(1)})]}),e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-medium bg-sys-teal/15 text-sys-teal ring-1 ring-inset ring-sys-teal/25",children:[e.jsx("span",{className:"opacity-70",children:"Max"}),e.jsx("span",{className:"font-mono tabular-nums",children:t.linkQuality.maxSnr.toFixed(1)})]})]})]})]}),e.jsxs(ee,{className:"p-0 overflow-hidden",children:[e.jsx("div",{className:"md:hidden h-[75vh] max-h-[calc(100vh-80px)] overflow-y-auto overflow-x-hidden",children:e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[t.linkQuality&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"rounded-lg bg-white/[0.03] ring-1 ring-inset ring-white/[0.06] p-2.5 text-center",children:[e.jsx(Dt,{value:Math.abs(t.linkQuality.minSnr),format:{maximumFractionDigits:0,signDisplay:"never"},prefix:t.linkQuality.minSnr<0?"-":"",className:"text-[20px] font-bold font-mono tabular-nums flex items-center justify-center text-white"}),e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[e.jsx(x,{className:"w-2.5 h-2.5 text-text-muted"}),e.jsx("span",{className:"text-[10px] text-white/40",children:"Min dB"})]})]}),e.jsxs("div",{className:"rounded-lg bg-white/[0.03] ring-1 ring-inset ring-white/[0.06] p-2.5 text-center",children:[e.jsx(Dt,{value:t.linkQuality.maxSnr,format:{maximumFractionDigits:0,signDisplay:"always"},className:"text-[20px] font-bold font-mono text-white tabular-nums flex items-center justify-center"}),e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[e.jsx(D,{className:"w-2.5 h-2.5 text-text-muted"}),e.jsx("span",{className:"text-[10px] text-white/40",children:"Max dB"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(U,{color:"excellent"===o||"good"===o?"green":"fair"===o?"amber":"red",compact:!0,children:[e.jsx(L,{className:"w-2.5 h-2.5 mr-0.5"}),"excellent"===o?"Excellent":"good"===o?"Good":"fair"===o?"Fair":"Poor"]}),e.jsxs(U,{color:"teal",compact:!0,children:[t.targetHopCount," hops"]}),e.jsxs(U,{color:"zinc",compact:!0,children:[t.observationCount," obs"]}),e.jsx("span",{className:"text-[10px] font-mono text-white/30 ml-auto",children:t.traceTag.slice(0,8)})]}),t.targetPath.length>0&&e.jsx("div",{className:"overflow-hidden rounded-xl",children:e.jsx("div",{className:"aspect-[4/3] w-full",children:e.jsx(Je,{path:t.targetPath,neighbors:l,localNode:i,localHash:null==r?void 0:r.local_hash,srcHash:t.srcHash,dstHash:t.dstHash,traceSnr:c})})}),e.jsxs("div",{className:"rounded-xl bg-black overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-white/5",children:[e.jsx("span",{className:"text-[11px] font-medium text-white/60",children:"Route Path"}),t.linkQuality&&e.jsxs("span",{className:"text-[10px] font-mono text-white/40",children:["SNR ",t.linkQuality.minSnr.toFixed(1)," → ",t.linkQuality.maxSnr.toFixed(1)," dB"]})]}),t.bestObservation?e.jsx(_t,{packet:t.bestObservation.packet,neighbors:l,localHash:null==r?void 0:r.local_hash,direction:"flowchart",compact:!0,overridePath:t.targetPath,traceSnr:t.bestObservation.decoded.snrValues}):e.jsx("div",{className:"p-6 text-center text-text-muted text-[11px]",children:"No path data available"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[11px] font-medium uppercase tracking-wide text-white/40 mb-2",children:["Link Quality · ",t.hopStats.length," hops"]}),e.jsx("div",{className:"space-y-1.5",children:t.hopStats.length>0?t.hopStats.map((s,a)=>{var n,r,i;const c=a<t.targetPath.length-1?t.targetPath[a+1]:"You",o=Rt(s.prefix,l),d=Rt(c,l);return e.jsx(Et,{fromPrefix:s.prefix,toPrefix:c,fromName:o,toName:d,snr:s.snr,maxSnr:(null==(n=t.linkQuality)?void 0:n.maxSnr)??10,isWeakest:(null==(r=t.linkQuality)?void 0:r.weakestLinkPosition)===a,isStrongest:(null==(i=t.linkQuality)?void 0:i.strongestLinkPosition)===a,index:a},`${s.prefix}-${a}`)}):e.jsx("div",{className:"text-[11px] text-text-muted py-6 text-center",children:"No link data collected"})})]}),e.jsx("div",{className:"pt-1 pb-2 text-center",children:e.jsxs("span",{className:"text-[10px] text-white/30",children:["Traced ",ae(t.firstSeen)]})})]})}),e.jsxs("div",{className:"hidden md:flex md:flex-row h-[70vh] max-h-[calc(100vh-200px)] overflow-hidden",children:[e.jsx("div",{className:"w-1/2 flex flex-col min-w-0 min-h-0 overflow-hidden border-r border-border-subtle",children:e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[t.linkQuality&&(()=>{const s=t.targetPath[t.linkQuality.weakestLinkPosition],a=t.targetPath[t.linkQuality.weakestLinkPosition+1]||"You",n=Rt(s,l),r=Rt(a,l),i=t.targetPath[t.linkQuality.strongestLinkPosition],c=t.targetPath[t.linkQuality.strongestLinkPosition+1]||"You",o=Rt(i,l),d=Rt(c,l);return e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(zt,{label:"Weakest Link",numericValue:t.linkQuality.minSnr,unit:"dB",icon:x,subtext:`${n||s} → ${r||a}`}),e.jsx(zt,{label:"Best Link",numericValue:t.linkQuality.maxSnr,showSign:!0,unit:"dB",icon:D,subtext:`${o||i} → ${d||c}`})]})})(),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[11px] font-medium uppercase tracking-wide text-text-muted mb-3",children:"Link Details"}),e.jsx("div",{className:"space-y-2",children:t.hopStats.length>0?t.hopStats.map((s,a)=>{var n,r,i;const c=a<t.targetPath.length-1?t.targetPath[a+1]:"You",o=Rt(s.prefix,l),d=Rt(c,l);return e.jsx(Et,{fromPrefix:s.prefix,toPrefix:c,fromName:o,toName:d,snr:s.snr,maxSnr:(null==(n=t.linkQuality)?void 0:n.maxSnr)??10,isWeakest:(null==(r=t.linkQuality)?void 0:r.weakestLinkPosition)===a,isStrongest:(null==(i=t.linkQuality)?void 0:i.strongestLinkPosition)===a,index:a},`${s.prefix}-${a}`)}):e.jsx("div",{className:"text-xs text-text-muted py-8 text-center",children:"No link data collected"})})]}),e.jsxs("div",{className:"pt-2 text-center",children:[e.jsx("span",{className:"text-[10px] text-text-muted",children:"Traced "}),e.jsx("span",{className:"font-mono text-[10px] text-text-muted tabular-nums",children:ae(t.firstSeen)})]})]})}),e.jsxs("div",{className:"w-1/2 min-w-0 overflow-y-auto p-3 space-y-2",children:[t.targetPath.length>0&&e.jsx("div",{className:"overflow-hidden",children:e.jsx("div",{className:"aspect-square w-full",children:e.jsx(Je,{path:t.targetPath,neighbors:l,localNode:i,localHash:null==r?void 0:r.local_hash,srcHash:t.srcHash,dstHash:t.dstHash,traceSnr:c})})}),e.jsxs("div",{className:"rounded-xl bg-black overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("span",{className:"text-xs font-medium text-text-muted uppercase tracking-wide",children:"Trace Route"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(U,{color:t.isComplete?"green":"amber",compact:!0,children:t.isComplete?"Complete":`${t.maxHopsObserved}/${t.targetHopCount}`}),e.jsxs(U,{color:"teal",compact:!0,children:[t.targetHopCount," hop",1!==t.targetHopCount?"s":""]})]})]}),t.linkQuality&&t.bestObservation&&e.jsxs("div",{className:"flex items-center gap-4 px-4 pb-2 font-mono text-[10px] text-text-muted",children:[e.jsxs("span",{children:[e.jsx("span",{className:"opacity-60",children:"Tag"})," ",e.jsx("code",{className:"text-teal-400 tabular-nums",children:t.traceTag.slice(0,8)})]}),e.jsxs("span",{children:[e.jsx("span",{className:"opacity-60",children:"SNR"})," ",e.jsxs("code",{className:"text-accent-secondary tabular-nums",children:[t.linkQuality.minSnr.toFixed(1),"–",t.linkQuality.maxSnr.toFixed(1)]}),e.jsx("span",{className:"opacity-60",children:" dB"})]})]}),t.bestObservation?e.jsx(_t,{packet:t.bestObservation.packet,neighbors:l,localHash:null==r?void 0:r.local_hash,direction:"flowchart",compact:!0,overridePath:t.targetPath,traceSnr:t.bestObservation.decoded.snrValues}):e.jsx("div",{className:"p-8 text-center text-text-muted text-xs",children:"No path data available"})]})]})]})]})]})});function It({message:t}){return e.jsxs("div",{className:"flex flex-col items-center justify-center py-14 text-center",children:[e.jsx(v,{className:"size-6 text-text-muted mb-2"}),e.jsx("p",{className:"text-sm text-text-primary",children:t}),e.jsx("p",{className:"text-xs text-text-muted",children:"Packets will appear here"})]})}function $t(){return e.jsx("div",{className:"py-14 text-center text-sm text-text-muted",children:"Loading packets…"})}function Vt({showPagination:t,currentPage:s,perPage:a,displayCount:n,totalCount:r,action:l}){const i=t?(s-1)*a+1:1,c=t?Math.min(s*a,r):n;return e.jsxs("div",{className:"flex items-center justify-between gap-4 border-t border-white/5 px-4 py-3 text-xs text-text-muted sm:px-6",children:[e.jsxs("span",{children:["Showing"," ",e.jsx("span",{className:"font-medium text-text-secondary",children:t?`${i}–${c}`:n})," ","of"," ",e.jsx("span",{className:"font-medium text-text-secondary",children:r})," ","packets"]}),l]})}function Qt({packets:s,allPackets:a,localHash:n,neighbors:r,loading:l=!1,maxPackets:i,perPage:c=50,showPagination:o=!1,onPacketSelect:d,flashNewest:x=!1,emptyMessage:m="No packets found",className:p,footerAction:h}){const[u,g]=t.useState(null),[f,j]=t.useState(null),[y,b]=t.useState({traceTag:null,dupeGroup:null});t.useLayoutEffect(()=>{b({traceTag:null,dupeGroup:null})},[s]);const N=a??s,v=t.useMemo(()=>i&&i>0?s.slice(0,i):s,[s,i]),{currentPage:w,totalPages:k,goToPage:C,pageRange:S}=function(e,s,a){const[n,r]=t.useState(1),l=a?Math.ceil(e/s):1;t.useEffect(()=>{n>l&&l>0&&queueMicrotask(()=>r(1))},[l,n]);const i=t.useCallback(e=>r(Math.max(1,Math.min(e,l))),[l]),c=t.useMemo(()=>function(e,t,s=1){if(t<=7)return Array.from({length:t},(e,t)=>t+1);const a=Math.max(e-s,1),n=Math.min(e+s,t),r=a>2,l=n<t-1;if(!r&&l){const e=3+2*s;return[...Array.from({length:e},(e,t)=>t+1),"gap",t]}if(r&&!l){const e=3+2*s;return[1,"gap",...Array.from({length:e},(s,a)=>t-e+a+1)]}return[1,"gap",...Array.from({length:n-a+1},(e,t)=>a+t),"gap",t]}(n,l),[n,l]);return{currentPage:n,totalPages:l,goToPage:i,pageRange:c}}(v.length,c,o),P=t.useMemo(()=>{if(!o)return v;const e=(w-1)*c;return v.slice(e,e+c)},[v,o,w,c]),_=t.useMemo(()=>function(e){const t=new Map;for(const s of e)if((s.payload_type??s.type)===ne.TRACE&&s.payload&&s.packet_hash){const e=Be(s.payload);e&&t.set(s.packet_hash,e)}return t}(P),[P]),T=t.useMemo(()=>function(e){const t=new Map;if(0===e.length)return t;for(let s=0;s<e.length;s++){const a=e[s].packet_hash;if(!a)continue;const n=e[s-1],r=e[s+1],l=(null==n?void 0:n.packet_hash)===a,i=(null==r?void 0:r.packet_hash)===a;(l||i)&&(l&&i?t.set(s,"middle"):l?t.set(s,"last"):i&&t.set(s,"first"))}return t}(P),[P]),H=function(e,s){const[a,n]=t.useState(null),r=t.useRef(0);return t.useEffect(()=>{var t,a;if(!s||!e.length)return;const l=(null==(t=e[0])?void 0:t.timestamp)??0,i=l>r.current&&r.current>0;if(r.current=l,!i)return;const c=null==(a=e[0])?void 0:a.packet_hash;if(!c)return;const o=requestAnimationFrame(()=>n(c)),d=setTimeout(()=>n(null),600);return()=>{cancelAnimationFrame(o),clearTimeout(d)}},[e,s]),a}(s,x),B=t.useCallback((e,t)=>{var s,a;const n=e.packet_hash;if(!n)return[e];let r=t;for(;r>0&&(null==(s=P[r-1])?void 0:s.packet_hash)===n;)r--;let l=t;for(;l<P.length-1&&(null==(a=P[l+1])?void 0:a.packet_hash)===n;)l++;return r===l?[e]:P.slice(r,l+1)},[P]),M=t.useCallback(e=>{var t,s;const a=null==(t=P[e])?void 0:t.packet_hash;if(!a)return e;let n=e;for(;n>0&&(null==(s=P[n-1])?void 0:s.packet_hash)===a;)n--;return n},[P]),F=t.useCallback(e=>{var t,s;const a=null==(t=P[e])?void 0:t.packet_hash;if(!a)return e;let n=e;for(;n<P.length-1&&(null==(s=P[n+1])?void 0:s.packet_hash)===a;)n++;return n},[P]),L=t.useCallback((e,t)=>{if(d)d(e);else if(void 0!==t){const s=B(e,t),a=s.indexOf(e);g({packets:s,initialIndex:a>=0?a:0,rowIndex:t})}else g({packets:[e],initialIndex:0,rowIndex:0})},[d,B]),D=t.useCallback(()=>{if(!u)return;const e=M(u.rowIndex)-1;if(e<0)return;const t=P[e];if(!t)return;const s=B(t,e);g({packets:s,initialIndex:0,rowIndex:e})},[u,P,M,B]),z=t.useCallback(()=>{if(!u)return;const e=F(u.rowIndex)+1;if(e>=P.length)return;const t=P[e];if(!t)return;const s=B(t,e);g({packets:s,initialIndex:0,rowIndex:e})},[u,P,F,B]),A=t.useMemo(()=>!!u&&M(u.rowIndex)>0,[u,M]),R=t.useMemo(()=>!!u&&F(u.rowIndex)<P.length-1,[u,F,P.length]),U=t.useCallback(e=>b(t=>({...t,traceTag:e})),[]),I=t.useCallback(e=>b(t=>({...t,dupeGroup:e})),[]),$=t.useCallback(()=>{b({traceTag:null,dupeGroup:null})},[]),V=t.useCallback(e=>{const t=N.filter(t=>(t.payload_type??t.type)===ne.TRACE&&t.payload&&Be(t.payload)===e);if(0===t.length)return;const s=function(e){const t=new Map;for(const s of e){const e=Fe(s);if(!e)continue;const a=e.decoded.traceTag,n=t.get(a)||[];n.push(e),t.set(a,n)}for(const[s,a]of t)a.sort((e,t)=>e.timestamp-t.timestamp),t.set(s,a);return t}(t),a=s.get(e);(null==a?void 0:a.length)&&j(function(e,t){if(0===t.length)return{traceTag:e,traceTagValue:0,targetPath:[],targetHopCount:0,observations:[],observationCount:0,firstSeen:0,lastSeen:0,duration:0,isComplete:!1,maxHopsObserved:0,progressPercent:0,bestObservation:null,hopStats:[],linkQuality:null};const s=[...t].sort((e,t)=>e.timestamp-t.timestamp),a=s.reduce((e,t)=>t.hopCount>e.hopCount?t:e,s[0]),n=s[0].timestamp,r=s[s.length-1].timestamp,l=a.decoded.pathHashes,i=l.length,c=a.hopCount,o=a.decoded.isComplete,d=[],x=a.decoded.snrValues;for(let p=0;p<x.length&&p<l.length;p++)d.push({prefix:l[p],snr:x[p],position:p,quality:Me(x[p])});let m=null;if(x.length>0){const e=Math.min(...x),t=Math.max(...x);m={minSnr:e,maxSnr:t,avgSnr:x.reduce((e,t)=>e+t,0)/x.length,weakestLinkPosition:x.indexOf(e),strongestLinkPosition:x.indexOf(t)}}return{traceTag:e,traceTagValue:a.decoded.traceTagValue,targetPath:l,targetHopCount:i,observations:s,observationCount:s.length,firstSeen:n,lastSeen:r,duration:r-n,isComplete:o,maxHopsObserved:c,progressPercent:i>0?Math.round(c/i*100):0,bestObservation:a,hopStats:d,linkQuality:m,srcHash:a.packet.src_hash,dstHash:a.packet.dst_hash}}(e,a))},[N]),Q=t.useCallback(e=>{const t=N.find(t=>t.packet_hash===e);t&&(j(null),L(t))},[N,L]),O=t=>{if(l&&0===s.length)return e.jsx($t,{});if(0===P.length)return e.jsx(It,{message:m});const a=t?Oe:Qe;return P.map((t,s)=>{const l=t.packet_hash?_.get(t.packet_hash):void 0,i=null!==y.traceTag&&l===y.traceTag,c=T.get(s),o=void 0!==c&&null!==y.dupeGroup&&t.packet_hash===y.dupeGroup;return e.jsx(a,{packet:t,onClick:e=>L(e,s),localHash:n,neighbors:r,isFlashing:x&&H===t.packet_hash,traceTag:l,isTraceHighlighted:i,onTraceHover:U,onViewTraceReport:V,dupeGroupPosition:c,isDupeGroupHovered:o,onDupeGroupHover:I},`${t.packet_hash}_${t.timestamp}_${s}`)})};return e.jsxs("div",{className:E("flex flex-col",p),onMouseLeave:$,children:[e.jsx("div",{className:"hidden divide-y divide-white/5 py-1 sm:block",children:O(!1)}),e.jsx("div",{className:"divide-y divide-white/5 sm:hidden",children:O(!0)}),o&&k>1&&e.jsx("nav",{className:"border-t border-white/5 px-4 py-3",children:e.jsxs(Ce,{className:"justify-center",children:[e.jsx(Se,{onClick:()=>C(w-1),disabled:1===w}),e.jsx(_e,{children:S.map((t,s)=>"gap"===t?e.jsx(He,{},`gap-${s}`):e.jsx(Te,{page:t,current:t===w,onClick:C},t))}),e.jsx(Pe,{onClick:()=>C(w+1),disabled:w===k})]})}),e.jsx(Vt,{showPagination:o,currentPage:w,perPage:c,displayCount:P.length,totalCount:o?v.length:s.length,action:h}),!d&&u&&e.jsx(Ft,{packets:u.packets,initialIndex:u.initialIndex,onClose:()=>g(null),onNavigatePrev:D,onNavigateNext:z,hasPrev:A,hasNext:R}),f&&e.jsx(Ut,{report:f,onClose:()=>j(null),onViewPacket:Q})]})}export{Qt as P,Ae as g};
