const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Login-BVGfeeRd.js","assets/vendor-react-CUlQ5-Td.js","assets/vendor-core-XI_xDZ-M.js","assets/Dashboard-BfZs_ThN.js","assets/useThemeColors-8RSyMp_o.js","assets/PageLayout-CViR4hDG.js","assets/PacketDetailModal-BvhyK15u.js","assets/SignalIndicator-DOiETQwB.js","assets/HashBadge-Do84dDmK.js","assets/TimeRangeSelector-Pa-lVKQc.js","assets/Grid-HJLNnEZz.js","assets/Packets-wtXWXIE0.js","assets/Contacts-CZV5Ovbv.js","assets/ConfirmModal-DLMcH5KX.js","assets/CollisionExplorerModal-BU96fXkT.js","assets/leaflet-CIGW-MKW.css","assets/Statistics-C2Q9qDtH.js","assets/usePolling-BvmU-1bN.js","assets/Statistics-D1GxaB_c.css","assets/System-BSF0fscu.js","assets/Logs-CZ5S1k0r.js","assets/Terminal-fFigQMKz.js","assets/Configuration-HwYFsp1c.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,s,a)=>((t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a)(t,"symbol"!=typeof s?s+"":s,a);import{r as s,j as a,c as n,u as o,X as i,M as r,L as c,d as l,e as d,C as u,G as h,F as p,S as m,f as g,g as f,h as y,i as b,k as x,l as w,m as k,n as v,o as j,p as S,q as C,t as N,v as _,N as T,w as M,B as P}from"./vendor-react-CUlQ5-Td.js";import{_ as L}from"./deckgl-MTXp-Y3t.js";import{c as E}from"./recharts-7RsRrQtf.js";import"./vendor-core-XI_xDZ-M.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const I=[{id:"default",name:"Shades of Purple",dataTheme:null,previewColor:"#B39DF3"},{id:"amber",name:"Gruvbox",dataTheme:"amber",previewColor:"#fabd2f"},{id:"grey",name:"Deus",dataTheme:"grey",previewColor:"#83a598"},{id:"black",name:"Gotham",dataTheme:"black",previewColor:"#33859d"},{id:"flora",name:"Sonokai",dataTheme:"flora",previewColor:"#9ed072"},{id:"kanagawa",name:"Kanagawa",dataTheme:"kanagawa",previewColor:"#7E9CD8"}],A=[{id:"sand",src:"/assets/sand.jpg",suggestedScheme:"default",suggestedBrightness:80},{id:"water",src:"/assets/water.webp",suggestedScheme:"grey",suggestedBrightness:40},{id:"magma",src:"/assets/magma.webp",suggestedScheme:"amber",suggestedBrightness:50},{id:"stars",src:"/assets/stars.jpg",suggestedScheme:"black",suggestedBrightness:100},{id:"ribbons",src:"/assets/ribbons.webp",suggestedScheme:"flora",suggestedBrightness:75},{id:"folds",src:"/assets/folds.webp",suggestedScheme:"kanagawa",suggestedBrightness:50}],R=[{id:"default",name:"Shades of Purple",displayName:"BlkSand",colorScheme:"default",backgroundImage:"/assets/sand.jpg",paletteColors:[["#B49DFF","#F9D26F","#71F8E5","#39D98A","#FF5C7A"],["#4CFFB5","#FF8A5C","#A78BFA","#60A5FA","#F472B6"]],displayFont:"'Rubik Mono One', monospace",displayColor:"#4A4A52",displaySize:.8},{id:"amber",name:"Gruvbox",displayName:"Magma",colorScheme:"amber",backgroundImage:"/assets/magma.webp",paletteColors:[["#fabd2f","#fb4934","#8ec07c","#b8bb26","#d3869b"],["#fe8019","#83a598","#d65d0e","#928374","#ebdbb2"]],displayFont:"'Jacquard 12', serif",displayColor:"#fe8019",displaySize:1.75},{id:"grey",name:"Deus",displayName:"Waves",colorScheme:"grey",backgroundImage:"/assets/water.webp",paletteColors:[["#83a598","#a89984","#8ec07c","#d79921","#b16286"],["#fe8019","#cc241d","#7c6f64","#bdae93","#ebdbb2"]],displayFont:"'Cantora One', sans-serif",displayColor:"#83a598",displaySize:1.25},{id:"black",name:"Gotham",displayName:"Stars",colorScheme:"black",backgroundImage:"/assets/stars.jpg",paletteColors:[["#33859d","#edb54b","#26a98b","#c23127","#888ca6"],["#195465","#d26939","#99d1ce","#4e5165","#0c1014"]],displayFont:"'IBM Plex Mono', monospace",displayColor:"#c23127",displaySize:1.25},{id:"flora",name:"Sonokai",displayName:"Ribbon",colorScheme:"flora",backgroundImage:"/assets/ribbons.webp",paletteColors:[["#9ed072","#fc5d7c","#76cce0","#e7c664","#b39df3"],["#f39660","#7f8490","#e2e2e3","#55575e","#2c2e34"]],displayFont:"'Instrument Serif', serif",displayColor:"#E2E2E3",displaySize:1.4},{id:"kanagawa",name:"Kanagawa",displayName:"Folds",colorScheme:"kanagawa",backgroundImage:"/assets/folds.webp",paletteColors:[["#7E9CD8","#E46876","#7AA89F","#DCA561","#957FB8"],["#7FB4CA","#D27E99","#98BB6C","#727169","#1F1F28"]],displayFont:"'Inter', sans-serif",displayColor:"#7E9CD8",displaySize:1.25}],F={colorScheme:"grey",backgroundImage:"/assets/water.webp",brightness:60},O="pymc-color-scheme",D="pymc-background-image",z="pymc-bg-brightness",$="pymc-background";function B(e){(new Image).src=e}const W={50:.97,100:.92,200:.84,300:.73,400:.62,500:.5,600:.4,700:.32,800:.24,900:.16},H=[50,100,200,300,400,500,600,700,800,900],q=["red","orange","yellow","green","aqua","blue","purple"];function U(e,t,s){const a=e=>Math.round(Math.max(0,Math.min(255,e))).toString(16).padStart(2,"0");return`#${a(e)}${a(t)}${a(s)}`}function J(e){const t=e/255;return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function G(e){const t=e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055;return Math.round(255*t)}function V(e,t,s){const a=s*(Math.PI/180),n=t*Math.cos(a),o=t*Math.sin(a),i=e+.3963377774*n+.2158037573*o,r=e-.1055613458*n-.0638541728*o,c=e-.0894841775*n-1.291485548*o,l=i*i*i,d=r*r*r,u=c*c*c,h=-1.2684380046*l+2.6097574011*d-.3413193965*u,p=-.0041960863*l-.7034186147*d+1.707614701*u;return[G(4.0767416621*l-3.3077115913*d+.2309699292*u),G(h),G(p)]}function K(e){const[t,s,a]=function(e){const t=e.replace("#","");return[parseInt(t.slice(0,2),16),parseInt(t.slice(2,4),16),parseInt(t.slice(4,6),16)]}(e),[,n,o]=function(e,t,s){const a=J(e),n=J(t),o=J(s),i=.4122214708*a+.5363325363*n+.0514459929*o,r=.2119034982*a+.6806995451*n+.1073969566*o,c=.0883024619*a+.2817188376*n+.6299787005*o,l=Math.cbrt(i),d=Math.cbrt(r),u=Math.cbrt(c),h=.2104542553*l+.793617785*d-.0040720468*u,p=1.9779984951*l-2.428592205*d+.4505937099*u,m=.0259040371*l+.7827717662*d-.808675766*u,g=Math.sqrt(p*p+m*m);let f=Math.atan2(m,p)*(180/Math.PI);return f<0&&(f+=360),[h,g,f]}(t,s,a),i={};for(const r of H){const e=W[r],t=n*(1-.3*Math.abs(e-.5)),[s,a,c]=V(e,t,o);i[r]=U(s,a,c)}return i}function Q(e){return"undefined"==typeof window?"":getComputedStyle(document.documentElement).getPropertyValue(e).trim()}function X(e,t){"undefined"!=typeof document&&document.documentElement.style.setProperty(e,t)}const Z=s.createContext(null);function Y({children:e}){const[t,n]=s.useState(()=>function(){if("undefined"==typeof window)return F;try{let t=localStorage.getItem(O),s=localStorage.getItem(D);const a=localStorage.getItem(z);if(!t&&!s){const e=localStorage.getItem($);if(e){const a=R.find(t=>t.id===e);a&&(t=a.colorScheme,s=a.backgroundImage,localStorage.setItem(O,t),localStorage.setItem(D,s),localStorage.removeItem($))}}const n="string"==typeof(e=t)&&I.some(t=>t.id===e)?t:F.colorScheme,o=s||F.backgroundImage;let i=F.brightness;if(a){const e=parseInt(a,10);!isNaN(e)&&e>=0&&e<=100&&(i=e)}return{colorScheme:n,backgroundImage:o,brightness:i}}catch{return F}var e}());s.useEffect(()=>{(function(e){const t=(s=e,I.find(e=>e.id===s)??I[0]);var s;t.dataTheme?document.documentElement.setAttribute("data-theme",t.dataTheme):document.documentElement.removeAttribute("data-theme")})(t.colorScheme),requestAnimationFrame(()=>{!function(){if("undefined"==typeof window)return;for(const t of q){const e=Q(`--palette-${t}-bright`),s=Q(`--palette-${t}`),a=e||s;if(!a)continue;const n=K(a);for(const o of H)X(`--palette-${t}-${o}`,n[o])}const e=Q("--palette-bg-4");if(e){const t=K(e);for(const e of H)X(`--palette-neutral-${e}`,t[e])}}()})},[t.colorScheme]),s.useEffect(()=>{!function(e){if("undefined"!=typeof window)try{localStorage.setItem(O,e.colorScheme),localStorage.setItem(D,e.backgroundImage),localStorage.setItem(z,String(e.brightness))}catch{}}(t)},[t]),s.useEffect(()=>{A.forEach(e=>{(new Image).src=e.src})},[]);const o=s.useCallback(e=>{n(t=>({...t,colorScheme:e}))},[]),i=s.useCallback(e=>{const t=A.find(t=>t.src===e);n(s=>({...s,backgroundImage:e,brightness:(null==t?void 0:t.suggestedBrightness)??s.brightness}))},[]),r=s.useCallback(e=>{const t=Math.max(0,Math.min(100,Math.round(e)));n(e=>({...e,brightness:t}))},[]),c=s.useCallback(e=>{const t=R.find(t=>t.id===e);t&&n(e=>({...e,colorScheme:t.colorScheme,backgroundImage:t.backgroundImage}))},[]),l=s.useMemo(()=>({theme:t,setColorScheme:o,setBackgroundImage:i,setBrightness:r,setThemePreset:c}),[t,o,i,r,c]);return a.jsx(Z.Provider,{value:l,children:e})}function ee(){const e=s.useContext(Z);if(!e)throw new Error("useTheme must be used within a ThemeProvider. Wrap your app with <ThemeProvider> in App.tsx.");return e}const te="0.9.133",se="/assets/WCM_Waves-RN-_ocPH.gif",ae=s.memo(function({height:e=16,className:t=""}){const s={fontFamily:"'Space Mono', monospace",fontSize:`${"string"==typeof e?parseFloat(e):e}px`,fontWeight:400,lineHeight:1,letterSpacing:"-0.02em",whiteSpace:"nowrap"},n="rgba(255, 255, 255, 0.7)",o="#FFFFFF";return a.jsxs("span",{className:t,style:s,role:"img","aria-label":"pyMC:Console",children:[a.jsx("span",{style:{color:n},children:"py"}),a.jsx("span",{style:{color:o},children:"MC"}),a.jsx("span",{style:{color:n},children:":"}),a.jsx("span",{style:{color:o},children:"Console"})]})}),ne={0:"REQ",1:"RESPONSE",2:"TXT_MSG",3:"ACK",4:"ADVERT",5:"GRP_TXT",6:"GRP_DATA",7:"ANON_REQ",8:"PATH",9:"TRACE",10:"MULTIPART",15:"RAW_CUSTOM"},oe={0:"T_FLOOD",1:"FLOOD",2:"DIRECT",3:"T_DIRECT"},ie={REQ:0,RESPONSE:1,TXT_MSG:2,ACK:3,ADVERT:4,GRP_TXT:5,GRP_DATA:6,ANON_REQ:7,PATH:8,TRACE:9,MULTIPART:10,RAW_CUSTOM:15},re={spreadingFactor:7,bandwidthHz:125e3,codingRate:5,preambleLength:8,crcEnabled:!0,explicitHeader:!0};function ce(e){if(e.raw_packet){const t=e.raw_packet;if(/^[0-9a-fA-F]+$/.test(t)&&t.length%2==0)return t.length/2;if(/^[A-Za-z0-9+/=]+$/.test(t)){const e=(t.match(/=+$/)||[""])[0].length;return Math.floor(3*t.length/4)-e}return t.length}if(e.length&&e.length>0)return e.length;if(e.payload_length&&e.payload_length>0)return e.payload_length;if(e.payload){const t=e.payload;return/^[0-9a-fA-F]+$/.test(t)&&t.length%2==0?t.length/2:t.length}return 32}function le(e,t={}){const s=t.spreadingFactor??re.spreadingFactor,a=t.bandwidthHz??re.bandwidthHz,n=t.codingRate??re.codingRate,o=t.preambleLength??re.preambleLength??8,i=t.crcEnabled??re.crcEnabled?1:0,r=t.explicitHeader??re.explicitHeader?0:1,c=s>=11&&a<=125e3?1:0,l=a/1e3,d=Math.pow(2,s)/l,u=(o+4.25)*d,h=Math.max(8*e-4*s+28+16*i-20*r,0),p=4*(s-2*c);return u+(8+Math.ceil(h/p)*n)*d}const de="pymc_jwt_token",ue="pymc_client_id";function he(){let e=localStorage.getItem(ue);return e||(e=`${Date.now()}-${Math.random().toString(36).substring(2,15)}`,localStorage.setItem(ue,e)),e}function pe(){return localStorage.getItem(de)}function me(e){localStorage.setItem(de,e)}function ge(){localStorage.removeItem(de)}function fe(){return!!pe()&&!be()}function ye(e){try{const t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),s=decodeURIComponent(atob(t).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(s)}catch{return null}}function be(){const e=pe();if(!e)return!0;const t=ye(e);return!t||!t.exp||Date.now()>=1e3*t.exp-6e4}function xe(){const e=pe();if(!e)return!1;const t=ye(e);if(!t||!t.exp)return!1;const s=1e3*t.exp-Date.now();return s>0&&s<18e4}function we(){const e=pe();if(!e)return null;const t=ye(e);return t&&t.sub?t.sub:null}async function ke(e,t){try{const s=await fetch("/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t,client_id:he()})}),a=s.headers.get("content-type");if(!a||!a.includes("application/json"))return{success:!1,error:`Server error: ${s.status}`};const n=await s.json();return n.success&&n.token?(me(n.token),{success:!0}):{success:!1,error:n.error||"Login failed"}}catch(s){return{success:!1,error:"Connection error. Please try again."}}}async function ve(){const e=pe();if(!e)return!1;try{const t=await fetch("/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({client_id:he()})});if(!t.ok)return!1;const s=await t.json();return!(!s.success||!s.token||(me(s.token),0))}catch(t){return!1}}function je(){ge()}const Se=Object.freeze(Object.defineProperty({__proto__:null,clearToken:ge,getClientId:he,getToken:pe,getUsername:we,isAuthenticated:fe,isTokenExpired:be,login:ke,logout:je,parseJWT:ye,refreshToken:ve,setToken:me,shouldRefreshToken:xe},Symbol.toStringTag,{value:"Module"})),Ce=new Map;let Ne=!1;async function _e(e,t,s=!1){const a=function(e,t){return(null==t?void 0:t.method)&&"GET"!==t.method?"":e}(e,t);if(a){const e=Ce.get(a);if(e)return e}const n=`${e}`;!s&&xe()&&await ve();const o=pe(),i=o?{Authorization:`Bearer ${o}`}:{};if(null==t?void 0:t.headers){const e=t.headers;e instanceof Headers?e.forEach((e,t)=>{i[t]=e}):Array.isArray(e)?e.forEach(([e,t])=>{i[e]=t}):Object.assign(i,e)}(null==t?void 0:t.body)&&(i["Content-Type"]="application/json");const r=(async()=>{const a=await fetch(n,{...t,headers:i});if(401===a.status){if(!s&&!Ne&&await ve())return _e(e,t,!0);throw Ne||(Ne=!0,ge(),window.location.href="/login"),new Error("Session expired. Please log in again.")}if(!a.ok)throw new Error(`API error: ${a.status} ${a.statusText}`);return a.json()})();return a&&(Ce.set(a,r),r.finally(()=>{Ce.delete(a)})),r}function Te(e){return e&&"chat node"===e.toLowerCase()?"Companion":e}async function Me(){return function(e){if(e.neighbors)for(const t of Object.values(e.neighbors))t.contact_type=Te(t.contact_type);return e}(await _e("/api/stats"))}async function Pe(){return _e("/api/logs")}async function Le(e=24){return _e(`/api/packet_type_graph_data?hours=${e}`)}async function Ee(e=24){return _e(`/api/noise_floor_history?hours=${e}`)}async function Ie(){return _e("/api/hardware_stats")}async function Ae(){return _e("/api/send_advert",{method:"POST",body:"{}"})}async function Re(e){return _e("/api/set_mode",{method:"POST",body:JSON.stringify({mode:e})})}async function Fe(e){return _e("/api/set_duty_cycle",{method:"POST",body:JSON.stringify({enabled:e})})}const Oe=new Map;function De(e,t,s,a){const n=60*e/t,o=Math.floor(Date.now()/1e3),i=Math.floor(o/n)*n,r=i-60*e,c=s.filter(e=>e.timestamp>=r&&e.timestamp<=i),l=a?function(e){var t;const s=null==(t=null==e?void 0:e.config)?void 0:t.radio;return{spreadingFactor:(null==s?void 0:s.spreading_factor)??re.spreadingFactor,bandwidthHz:(null==s?void 0:s.bandwidth)??re.bandwidthHz,codingRate:(null==s?void 0:s.coding_rate)??re.codingRate,preambleLength:(null==s?void 0:s.preamble_length)??re.preambleLength,crcEnabled:!0,explicitHeader:!0}}(a):re,d=function(e,t,s,a,n){const o=new Array(t),i=new Array(t),r=new Array(t),c=new Array(t),l=new Array(t);for(let u=0;u<t;u++){const e=s+u*a,t={bucket:u,start:e,end:e+a,count:0,airtime_ms:0,avg_snr:0,avg_rssi:0};o[u]={...t},i[u]={...t},r[u]={...t},c[u]={...t},l[u]={snr:0,rssi:0,count:0}}const d=e.length;for(let u=0;u<d;u++){const d=e[u],h=Math.floor((d.timestamp-s)/a);if(h<0||h>=t)continue;const p=le(ce(d),n),m=d.packet_origin;"tx_local"===m?(i[h].count++,i[h].airtime_ms+=p):"tx_forward"===m||d.transmitted?(r[h].count++,r[h].airtime_ms+=p):d.drop_reason&&(c[h].count++,c[h].airtime_ms+=p),"tx_local"!==m&&(o[h].count++,o[h].airtime_ms+=p,l[h].snr+=d.snr||0,l[h].rssi+=d.rssi||0,l[h].count++)}for(let u=0;u<t;u++)l[u].count>0&&(o[u].avg_snr=l[u].snr/l[u].count,o[u].avg_rssi=l[u].rssi/l[u].count);return{received:o,transmitted:i,forwarded:r,dropped:c}}(c,t,r,n,l);return{time_range_minutes:e,bucket_count:t,bucket_duration_seconds:n,start_time:r,end_time:i,...d}}async function ze(e){return _e("/api/update_radio_config",{method:"POST",body:JSON.stringify(e)})}async function $e(e){return _e("/api/set_log_level",{method:"POST",body:JSON.stringify({level:e})})}async function Be(){return _e("/api/transport_keys")}async function We(e){return _e("/api/transport_keys",{method:"POST",body:JSON.stringify(e)})}async function He(e,t){return _e(`/api/transport_key/${e}`,{method:"PUT",body:JSON.stringify(t)})}async function qe(e){return _e(`/api/transport_key/${e}`,{method:"DELETE"})}async function Ue(e){return _e("/api/global_flood_policy",{method:"POST",body:JSON.stringify({global_flood_allow:e})})}async function Je(e,t=10){return _e("/api/ping_neighbor",{method:"POST",body:JSON.stringify({target_id:e,timeout:t})})}async function Ge(e){return _e("/api/update_web_config",{method:"POST",body:JSON.stringify(e)})}async function Ve(){return _e("/api/check_pymc_console")}async function Ke(){return _e("/api/restart_service",{method:"POST",body:"{}"})}async function Qe(){return _e("/auth/tokens")}async function Xe(e){return _e("/auth/tokens",{method:"POST",body:JSON.stringify({name:e})})}async function Ze(e){return _e(`/auth/tokens/${e}`,{method:"DELETE"})}const Ye="pymc-packet-cache",et="pymc-packet-cache-meta",tt=36e5,st=75e3,at=75e3,nt=5e3,ot=75e3,it=new class{constructor(){t(this,"packets",new Map),t(this,"sortedPackets",[]),t(this,"sortedDirty",!0),t(this,"meta",{oldestTimestamp:0,newestTimestamp:0,lastUpdated:0,packetCount:0,backgroundLoadComplete:!1,topologyLoadComplete:!1}),t(this,"isLoading",!1),t(this,"isBackgroundLoading",!1),t(this,"isTopologyLoading",!1),t(this,"listeners",new Set),t(this,"loadProgress",null),t(this,"statusMessage",""),this.loadFromStorage()}subscribe(e){return this.listeners.add(e),e(this.getState()),()=>this.listeners.delete(e)}getState(){return{isLoading:this.isLoading,isBackgroundLoading:this.isBackgroundLoading,isTopologyLoading:this.isTopologyLoading,backgroundLoadComplete:this.meta.backgroundLoadComplete,topologyLoadComplete:this.meta.topologyLoadComplete,packetCount:this.packets.size,statusMessage:this.statusMessage,loadProgress:this.loadProgress}}getPackets(){return this.sortedDirty&&(this.sortedPackets=Array.from(this.packets.values()).sort((e,t)=>(e.timestamp??0)-(t.timestamp??0)),this.sortedDirty=!1),this.sortedPackets}isStale(){return 0===this.packets.size||Date.now()-this.meta.lastUpdated>tt}isHeavyLoadInProgress(){return this.isBackgroundLoading||this.isTopologyLoading}async initialLoad(e){if(this.isStale()&&this.packets.size>0&&this.clear(),this.meta.backgroundLoadComplete&&this.packets.size>0)return this.getPackets();this.isLoading=!0,this.loadProgress={loaded:0,target:st,percent:0},this.statusMessage="Loading packets...",this.notifyListeners();try{let t;this.packets.size>0&&(this.packets.clear(),this.sortedPackets=[],this.sortedDirty=!0,this.meta.oldestTimestamp=0,this.meta.newestTimestamp=0);let s=0,a=0,n=0;const o=Math.ceil(15);for(let i=0;i<o;i++){const r=this.packets.size>0?Math.min(99,Math.round(this.packets.size/st*100)):0;this.statusMessage="Loading packets...",this.loadProgress={loaded:this.packets.size,target:st,percent:r},this.notifyListeners();const c=await this.fetchChunkWithRetry(t,nt,i,o);if(null!==c){if(n=0,!(c.success&&c.data&&c.data.length>0))break;{const n=this.packets.size;this.mergePackets(c.data);const o=this.packets.size-n;s+=o;const i=Math.min(...c.data.map(e=>e.timestamp??1/0));if(i!==1/0&&(void 0===t||i<t)&&(t=i),e&&e(),0===o){if(a++,a>=2)break}else a=0;if(c.data.length<nt)break;if(this.packets.size>=ot)break}i<o-1&&await this.delay(300)}else{if(n++,n>=5){this.statusMessage="Connection issues, loaded partial data",this.notifyListeners();break}await this.delay(2e3)}}this.enforceMemoryCap(),this.meta.backgroundLoadComplete=!0,this.loadProgress={loaded:this.packets.size,target:this.packets.size,percent:100},this.notifyListeners(),this.saveToStorage()}catch(t){this.statusMessage="Load failed"}finally{this.isLoading=!1,this.statusMessage="",this.loadProgress=null,this.notifyListeners()}return this.getPackets()}async quickLoad(){return this.initialLoad()}async backgroundLoad(){await this.initialLoad()}async topologyLoad(){if(!this.meta.topologyLoadComplete&&!this.isTopologyLoading)return this.doTopologyLoad()}async forceTopologyLoad(){if(!this.isTopologyLoading)return this.meta.topologyLoadComplete=!1,this.doTopologyLoad()}async forceDeepLoad(){return this.forceTopologyLoad()}async doTopologyLoad(){this.isTopologyLoading=!0,this.statusMessage="Fetching topology data...",this.loadProgress={loaded:0,target:at,percent:0},this.notifyListeners();try{let e,t=0,s=0,a=0;const n=Math.ceil(15);for(let o=0;o<n;o++){const i=this.packets.size>0?Math.min(99,Math.round(this.packets.size/at*100)):0;this.statusMessage=`Loading ${this.packets.size.toLocaleString()} packets...`,this.loadProgress={loaded:this.packets.size,target:at,percent:i},this.notifyListeners();const r=await this.fetchChunkWithRetry(e,nt,o,n);if(null!==r){if(a=0,!(r.success&&r.data&&r.data.length>0))break;{const a=this.packets.size;this.mergePackets(r.data);const n=this.packets.size-a;t+=n;const o=Math.min(...r.data.map(e=>e.timestamp??1/0));if(o!==1/0&&(void 0===e||o<e)&&(e=o),0===n){if(s++,s>=2)break}else s=0;if(r.data.length<nt)break;if(this.packets.size>=ot)break}o<n-1&&await this.delay(300)}else{if(a++,a>=5){this.statusMessage="Connection issues, loaded partial data",this.notifyListeners();break}await this.delay(2e3)}}this.statusMessage=`Processing ${this.packets.size.toLocaleString()} packets...`,this.loadProgress={loaded:this.packets.size,target:this.packets.size,percent:100},this.notifyListeners(),this.enforceMemoryCap(),this.meta.topologyLoadComplete=!0,this.saveToStorage()}catch(e){this.statusMessage="Topology load failed"}finally{this.isTopologyLoading=!1,this.statusMessage="",this.loadProgress=null,this.notifyListeners()}}async poll(){try{const e=await this.fetchRecentPackets(200);if(e.success&&e.data){const t=this.packets.size;this.mergePackets(e.data),this.packets.size>t&&(this.saveToStorage(),this.notifyListeners())}}catch(e){}return this.getPackets()}clear(){this.packets.clear(),this.sortedPackets=[],this.sortedDirty=!0,this.meta={oldestTimestamp:0,newestTimestamp:0,lastUpdated:0,packetCount:0,backgroundLoadComplete:!1,topologyLoadComplete:!1},this.clearStorage(),this.notifyListeners()}mergePackets(e){let t=!1;for(const s of e){const e=s.packet_hash;if(e&&!this.packets.has(e)){this.packets.set(e,s),t=!0;const a=s.timestamp??0;(0===this.meta.oldestTimestamp||a<this.meta.oldestTimestamp)&&(this.meta.oldestTimestamp=a),a>this.meta.newestTimestamp&&(this.meta.newestTimestamp=a)}}t&&(this.sortedDirty=!0),this.meta.lastUpdated=Date.now(),this.meta.packetCount=this.packets.size}notifyListeners(){const e=this.getState();for(const t of this.listeners)t(e)}waitForIdle(){return new Promise(e=>{"requestIdleCallback"in window?window.requestIdleCallback(()=>e(),{timeout:2e3}):setTimeout(e,100)})}delay(e){return new Promise(t=>setTimeout(t,e))}async fetchChunkWithRetry(e,t,s,a){for(let o=0;o<3;o++)try{return await this.fetchFilteredPackets(e,t)}catch(n){const e=2===o,t=1e3*Math.pow(2,o);n instanceof Error&&n.name,e||(this.statusMessage=`Retry in ${Math.round(t/1e3)}s...`,this.notifyListeners(),await this.delay(t))}return null}enforceMemoryCap(){if(this.packets.size<=ot)return;const e=this.getPackets(),t=e.length-ot;for(let s=0;s<t;s++){const t=e[s];t.packet_hash&&this.packets.delete(t.packet_hash)}this.sortedDirty=!0,this.meta.packetCount=this.packets.size,e.length>t&&(this.meta.oldestTimestamp=e[t].timestamp??0)}loadFromStorage(){if("undefined"!=typeof window)try{const e=localStorage.getItem(et);e&&(this.meta=JSON.parse(e));const t=localStorage.getItem(Ye);if(t){const e=JSON.parse(t);for(const t of e)t.packet_hash&&this.packets.set(t.packet_hash,t)}if(this.meta.lastUpdated>0&&Date.now()-this.meta.lastUpdated>tt)return void this.clear();this.meta.backgroundLoadComplete=!1;const s=37500;this.meta.topologyLoadComplete&&this.packets.size<s&&(this.meta.topologyLoadComplete=!1),"deepLoadComplete"in this.meta&&delete this.meta.deepLoadComplete}catch(e){this.clear()}}saveToStorage(){if("undefined"!=typeof window)try{localStorage.setItem(et,JSON.stringify(this.meta));const e=this.getPackets(),t=e.length>3e3?e.slice(-3e3):e;localStorage.setItem(Ye,JSON.stringify(t))}catch(e){if(e instanceof DOMException&&"QuotaExceededError"===e.name)try{localStorage.removeItem(Ye),localStorage.setItem(et,JSON.stringify(this.meta))}catch{}}}clearStorage(){if("undefined"!=typeof window)try{localStorage.removeItem(Ye),localStorage.removeItem(et)}catch(e){}}async fetchRecentPackets(e=1e3,t=!1){const s=`/api/recent_packets?limit=${e}`,a=localStorage.getItem("pymc_jwt_token"),n={};a&&(n.Authorization=`Bearer ${a}`);const o=await fetch(s,{headers:n});if(401===o.status&&!t){const{refreshToken:t}=await L(async()=>{const{refreshToken:e}=await Promise.resolve().then(()=>Se);return{refreshToken:e}},void 0);if(await t())return this.fetchRecentPackets(e,!0)}if(!o.ok)throw new Error(`API error: ${o.status}`);return o.json()}async fetchFilteredPackets(e,t=5e3,s=!1){const a=new URLSearchParams;a.set("limit",String(t)),void 0!==e&&a.set("end_timestamp",String(e-.001));const n=`/api/filtered_packets?${a}`,o=localStorage.getItem("pymc_jwt_token"),i={};o&&(i.Authorization=`Bearer ${o}`);const r=new AbortController,c=setTimeout(()=>r.abort(),3e4);try{const a=await fetch(n,{headers:i,signal:r.signal});if(401===a.status&&!s){const{refreshToken:s}=await L(async()=>{const{refreshToken:e}=await Promise.resolve().then(()=>Se);return{refreshToken:e}},void 0);if(await s())return this.fetchFilteredPackets(e,t,!0)}if(!a.ok)throw new Error(`API error: ${a.status}`);return a.json()}finally{clearTimeout(c)}}};function rt(e){return{paths:e.paths,byEndpoints:new Map(e.byEndpointsEntries),canonicalPaths:new Map(e.canonicalPathsEntries),totalObservations:e.totalObservations,uniquePathCount:e.uniquePathCount}}function ct(){return{paths:[],byEndpoints:new Map,canonicalPaths:new Map,totalObservations:0,uniquePathCount:0}}const lt=new class{constructor(){t(this,"worker",null),t(this,"listeners",new Set),t(this,"currentTopology",{edges:[],validatedEdges:[],weakEdges:[],certainEdges:[],uncertainEdges:[],edgeMap:new Map,maxPacketCount:0,maxCertainCount:0,neighborAffinity:new Map,fullAffinity:new Map,localPrefix:null,centrality:new Map,hubNodes:[],gatewayNodes:[],loops:[],loopEdgeKeys:new Set,txDelayRecommendations:new Map,pathRegistry:ct(),edgeBetweenness:new Map,backboneEdges:[],nodeMobility:new Map,mobileNodes:[],pathHealth:[],lastHopNeighbors:[],disambiguationStats:{totalPrefixes:0,unambiguousPrefixes:0,collisionPrefixes:0,collisionRate:0,avgConfidence:0,lowConfidencePrefixes:[],highCollisionPrefixes:[],totalResolutions:0},discoveredNodes:[],viterbiStats:{totalPaths:0,pathsWithGhosts:0,avgPathCost:0,avgPathConfidence:0,observationOverrideCount:0,tracePacketsProcessed:0,pathPacketsProcessed:0,distantEdgesDiscovered:0,duplicateGroupsFound:0,duplicatePathsUnique:0,echolocationEdgesInferred:0}}),t(this,"isComputing",!1),t(this,"pendingRequest",null),t(this,"debounceTimer",null),t(this,"debounceMs",100),this.initWorker()}initWorker(){if("undefined"!=typeof window)try{this.worker=new Worker(new URL("/assets/topology.worker-eIne159M.js",import.meta.url),{type:"module"}),this.worker.onmessage=e=>{this.handleWorkerMessage(e.data)},this.worker.onerror=e=>{}}catch(e){}}handleWorkerMessage(e){if(this.isComputing=!1,"error"!==e.type){var t;this.currentTopology={edges:(t=e.payload).edges??[],validatedEdges:t.validatedEdges??[],weakEdges:t.weakEdges??[],certainEdges:t.certainEdges??[],uncertainEdges:t.uncertainEdges??[],maxPacketCount:t.maxPacketCount??0,maxCertainCount:t.maxCertainCount??0,localPrefix:t.localPrefix??null,hubNodes:t.hubNodes??[],gatewayNodes:t.gatewayNodes??[],edgeMap:new Map(t.edgeMapEntries??[]),neighborAffinity:new Map(t.neighborAffinityEntries??[]),fullAffinity:new Map(t.fullAffinityEntries??[]),centrality:new Map(t.centralityEntries??[]),loops:t.loops??[],loopEdgeKeys:new Set(t.loopEdgeKeyEntries??[]),txDelayRecommendations:new Map(t.txDelayRecommendationEntries??[]),pathRegistry:t.pathRegistry?rt(t.pathRegistry):ct(),edgeBetweenness:new Map(t.edgeBetweennessEntries??[]),backboneEdges:t.backboneEdges??[],nodeMobility:new Map(t.nodeMobilityEntries??[]),mobileNodes:t.mobileNodes??[],pathHealth:t.pathHealth??[],lastHopNeighbors:t.lastHopNeighbors??[],disambiguationStats:t.disambiguationStats??{totalPrefixes:0,unambiguousPrefixes:0,collisionPrefixes:0,collisionRate:0,avgConfidence:0,lowConfidencePrefixes:[],highCollisionPrefixes:[],totalResolutions:0},discoveredNodes:t.discoveredNodes??[],viterbiStats:t.viterbiStats??{totalPaths:0,pathsWithGhosts:0,avgPathCost:0,avgPathConfidence:0,observationOverrideCount:0,tracePacketsProcessed:0,pathPacketsProcessed:0,distantEdgesDiscovered:0,duplicateGroupsFound:0,duplicatePathsUnique:0,echolocationEdgesInferred:0}};for(const t of this.listeners)try{t(this.currentTopology,e.computeTimeMs)}catch(s){}if(this.pendingRequest){const e=this.pendingRequest;this.pendingRequest=null,this.computeInternal(e)}}}computeInternal(e){if(!this.worker)return;this.isComputing=!0;const t={type:"compute",payload:e};this.worker.postMessage(t)}compute(e,t,s,a,n,o,i){const r={packets:e,neighbors:t,localHash:s,localLat:a,localLon:n,airtimeMs:o,zeroHopNeighbors:i};this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.debounceTimer=null,this.isComputing?this.pendingRequest=r:this.computeInternal(r)},this.debounceMs)}subscribe(e){return this.listeners.add(e),this.currentTopology.edges.length>0&&e(this.currentTopology,0),()=>{this.listeners.delete(e)}}getTopology(){return this.currentTopology}isWorking(){return this.isComputing}terminate(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.worker&&(this.worker.terminate(),this.worker=null),this.listeners.clear()}},dt=new class{constructor(){t(this,"worker",null),t(this,"listeners",new Set),t(this,"sparklines",new Map),t(this,"isComputing",!1),t(this,"lastComputeTimeMs",0),t(this,"pendingRequest",null),t(this,"debounceTimer",null),t(this,"debounceMs",150),this.initWorker()}initWorker(){if("undefined"!=typeof window)try{this.worker=new Worker(new URL("/assets/sparkline.worker-CmKhBAy5.js",import.meta.url),{type:"module"}),this.worker.onmessage=e=>{this.handleWorkerMessage(e.data)},this.worker.onerror=e=>{this.isComputing=!1,this.notifyListeners()}}catch(e){}}handleWorkerMessage(e){if(this.isComputing=!1,"error"!==e.type){if(this.sparklines=new Map(e.payload.sparklineEntries),this.lastComputeTimeMs=e.computeTimeMs,this.notifyListeners(),this.pendingRequest){const e=this.pendingRequest;this.pendingRequest=null,this.computeInternal(e.packets,e.nodeHashes)}}else this.notifyListeners()}computeInternal(e,t){if(!this.worker)return;if(0===t.length)return this.isComputing=!1,void this.notifyListeners();this.isComputing=!0,this.notifyListeners();const s={type:"compute",payload:{packets:e,nodeHashes:t}};this.worker.postMessage(s)}notifyListeners(){for(const t of this.listeners)try{t(this.sparklines,this.isComputing)}catch(e){}}compute(e,t){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.debounceTimer=null,this.isComputing?this.pendingRequest={packets:e,nodeHashes:t}:this.computeInternal(e,t)},this.debounceMs)}getSparkline(e){return this.sparklines.get(e)??[]}getAllSparklines(){return this.sparklines}hasSparkline(e){return this.sparklines.has(e)}isWorking(){return this.isComputing}getLastComputeTime(){return this.lastComputeTimeMs}subscribe(e){return this.listeners.add(e),e(this.sparklines,this.isComputing),()=>{this.listeners.delete(e)}}clear(){this.sparklines.clear(),this.notifyListeners()}terminate(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.worker&&(this.worker.terminate(),this.worker=null),this.listeners.clear()}};function ut(e){return e.startsWith("0x")||e.startsWith("0X")?e.slice(2,4).toUpperCase():e.slice(0,2).toUpperCase()}function ht(e,t){let s=e.forwarded_path??e.original_path;if("string"==typeof s)try{s=JSON.parse(s)}catch{return null}if(!s||!Array.isArray(s)||0===s.length)return null;const a=s.map(e=>String(e).toUpperCase()),n=t?ut(t):null,o=a[a.length-1],i=null!==n&&o===n,r=i?a.slice(0,-1):[...a];return{effective:r,original:a,hadLocal:i,effectiveLength:r.length}}function pt(e,t){const s=e.toUpperCase();return t.startsWith("0x")||t.startsWith("0X")?t.slice(2).toUpperCase().startsWith(s):t.toUpperCase().startsWith(s)}const mt=[{label:"20m",minutes:20,buckets:40},{label:"1h",minutes:60,buckets:60},{label:"3h",minutes:180,buckets:90},{label:"12h",minutes:720,buckets:72},{label:"24h",minutes:1440,buckets:96},{label:"3d",minutes:4320,buckets:72},{label:"7d",minutes:10080,buckets:84}],gt=[{label:"1h",hours:1},{label:"3h",hours:3},{label:"12h",hours:12},{label:"24h",hours:24},{label:"3d",hours:72},{label:"7d",hours:168}];function ft(e){switch(e){case 1:return 3600;case 3:case 12:return 5400;case 24:return 8640;case 72:return 14400;case 168:return 10080;default:{const t=3600*e;return Math.max(360,Math.round(t/10))}}}function yt(e){switch(e){case 1:return 3600;case 3:case 12:return 5400;case 24:return 8640;case 72:case 168:return 720;default:{const t=3600*e,s=Math.round(t/10);return Math.min(Math.max(360,s),720)}}}const bt={stats:3e3,packets:3e3,logs:2e3,system:3e3},xt={DEBUG:"text-[var(--log-debug)]",INFO:"text-[var(--log-info)]",WARNING:"text-[var(--log-warning)]",ERROR:"text-[var(--log-error)]",CRITICAL:"text-[var(--log-critical)]"};function wt(e){return xt[e]||"text-text-muted border-border-subtle"}const kt="pymc-resource-history",vt="pymc-resource-last-fetch",jt="pymc-hidden-contacts",St="pymc-quick-neighbors",Ct="pymc-local-hash";let Nt=null,_t=null;function Tt(e,t){const s=t-1e3*e;return s<=6048e5?"active":s<=12096e5?"stale":"expired"}function Mt(e){return 4===(e.type??e.payload_type)&&!0!==e.transmitted&&function(e){const t=function(e){if(Array.isArray(e))return e;if("string"==typeof e&&e.startsWith("["))try{const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}return[]}(e.original_path),s=e.route??e.route_type;return 2===(a=s)||3===a?0===t.length:function(e){return 1===e||0===e}(s)?t.length<=1:0===t.length;var a}(e)}function Pt(e,t,s,a,n){if(!e)return null;let o=e;if(e.length<=4){const a=e.replace(/^0x/i,"").toUpperCase();if(a===t)return null;const n=s.get(a);if(!n)return null;o=n}return a.has(o)?o===n?null:o:null}function Lt(e,t){e.count++,void 0!==t.rssi&&null!==t.rssi&&(e.rssiSum+=t.rssi,e.rssiCount++),void 0!==t.snr&&null!==t.snr&&(e.snrSum+=t.snr,e.snrCount++);const s=t.timestamp??0;s>e.lastSeen&&(e.lastSeen=s)}function Et(e){return{hash:e,count:0,rssiSum:0,rssiCount:0,snrSum:0,snrCount:0,lastSeen:0}}function It(e,t){const s=Tt(e.lastSeen,t);return"expired"===s?null:{hash:e.hash,prefix:ut(e.hash),count:e.count,avgRssi:e.rssiCount>0?e.rssiSum/e.rssiCount:null,avgSnr:e.snrCount>0?e.snrSum/e.snrCount:null,lastSeen:e.lastSeen,status:s}}function At(){if("undefined"==typeof window)return[];try{const e=localStorage.getItem(St);if(e)return JSON.parse(e)}catch{}return[]}function Rt(e){"undefined"!=typeof window&&(_t&&clearTimeout(_t),_t=setTimeout(()=>{try{localStorage.setItem(St,JSON.stringify(e))}catch{}_t=null},1e3))}function Ft(){if("undefined"!=typeof window)try{const e=localStorage.getItem(Ct);if(e)return e}catch{}}function Ot(e){if("undefined"!=typeof window)try{localStorage.setItem(Ct,e)}catch{}}function Dt(){if("undefined"==typeof window)return[];try{const e=localStorage.getItem(kt);if(e)return JSON.parse(e)}catch{}return[]}function zt(){if("undefined"==typeof window)return new Set;try{const e=localStorage.getItem(jt);if(e)return new Set(JSON.parse(e))}catch{}return new Set}function $t(){if("undefined"==typeof window)return 0;try{const e=localStorage.getItem(vt);if(e)return parseInt(e,10)||0}catch{}return 0}const Bt=n((e,t)=>({stats:null,statsLoading:!1,statsError:null,packets:[],packetsLoading:!1,packetsError:null,lastPacketTimestamp:0,logs:[],logsLoading:!1,liveMode:!0,flashReceived:0,flashAdvert:0,resourceHistory:Dt(),lastResourceFetch:$t(),hiddenContacts:zt(),quickNeighbors:At(),cachedLocalHash:Ft(),initialized:!1,packetCacheState:it.getState(),mutationsInFlight:new Set,initializeApp:async()=>{const{initialized:s}=t();if(!s){e({initialized:!0,statsLoading:!0,packetsLoading:!0}),it.subscribe(t=>{e({packetCacheState:t})});try{const{hiddenContacts:s}=t(),a=await Me(),n=a.neighbors??{},o=Date.now(),i=[];for(const[e,t]of Object.entries(n)){if(s.has(e))continue;if(!t.zero_hop)continue;const a=Tt(t.last_seen??0,o);"expired"!==a&&i.push({hash:e,prefix:ut(e),count:t.advert_count??0,avgRssi:t.rssi??null,avgSnr:t.snr??null,lastSeen:t.last_seen??0,status:a})}i.sort((e,t)=>t.count!==e.count?t.count-e.count:t.lastSeen-e.lastSeen);const r=a.local_hash;e({stats:a,statsLoading:!1,quickNeighbors:i,cachedLocalHash:r}),Rt(i),r&&Ot(r);const c=()=>{const s=it.getPackets();if(s.length>0){const a=s.reduce((e,t)=>{const s=t.timestamp??0;return s>e?s:e},0);e({packets:[...s],lastPacketTimestamp:a}),t().triggerTopologyCompute(),t().triggerSparklineCompute()}},l=await it.initialLoad(c);if(l.length>0){const s=l.reduce((e,t)=>{const s=t.timestamp??0;return s>e?s:e},0);e({packets:[...l],packetsLoading:!1,lastPacketTimestamp:s}),t().triggerTopologyCompute(),t().triggerSparklineCompute()}else e({packetsLoading:!1})}catch(a){e({statsError:a instanceof Error?a.message:"Failed to initialize",statsLoading:!1,packetsLoading:!1})}setInterval(()=>{t().fetchStats()},bt.stats),setInterval(()=>{t().liveMode&&!it.isHeavyLoadInProgress()&&t().fetchPackets()},bt.packets)}},prefetchForRoute:e=>{switch(e){case"/logs":Pe().catch(()=>{});break;case"/system":Ie().catch(()=>{});break;case"/statistics":Le(3).catch(()=>{}),Ee(3).catch(()=>{});break;case"/settings":(async function(){return _e("/api/radio_presets")})().catch(()=>{})}},fetchStats:async s=>{const{stats:a,mutationsInFlight:n,hiddenContacts:o}=t();if(!(n.size>0)||(null==s?void 0:s.force)){a||e({statsLoading:!0}),e({statsError:null});try{const t=await Me(),s=t.neighbors??{},a=Date.now(),n=[];for(const[e,r]of Object.entries(s)){if(o.has(e))continue;if(!r.zero_hop)continue;const t=Tt(r.last_seen??0,a);"expired"!==t&&n.push({hash:e,prefix:ut(e),count:r.advert_count??0,avgRssi:r.rssi??null,avgSnr:r.snr??null,lastSeen:r.last_seen??0,status:t})}n.sort((e,t)=>t.count!==e.count?t.count-e.count:t.lastSeen-e.lastSeen);const i=t.local_hash;e({stats:t,statsLoading:!1,quickNeighbors:n,cachedLocalHash:i}),Rt(n),i&&Ot(i)}catch(i){e({statsError:i instanceof Error?i.message:"Failed to fetch stats",statsLoading:!1})}}},fetchPackets:async s=>{const{packets:a}=t();0===a.length&&e({packetsLoading:!0}),e({packetsError:null});try{const s=await it.poll(),{lastPacketTimestamp:a}=t(),n=s.length>0?s.reduce((e,t)=>Math.max(e,t.timestamp??0),0):0,o=n>a&&a>0;o&&(e({flashReceived:t().flashReceived+1}),function(e=!1){if(e)Oe.clear();else for(const[t]of Oe)parseInt(t.split("-")[0],10)<=60&&Oe.delete(t)}()),e({packets:s,packetsLoading:!1,lastPacketTimestamp:n||a}),o&&t().triggerTopologyCompute()}catch(n){e({packetsError:n instanceof Error?n.message:"Failed to fetch packets",packetsLoading:!1})}},fetchLogs:async()=>{const{logs:s}=t();0===s.length&&e({logsLoading:!0});try{const t=await Pe();e({logs:t.logs,logsLoading:!1})}catch{e({logsLoading:!1})}},setLiveMode:t=>{e({liveMode:t})},setMode:async s=>{const a="setMode",{mutationsInFlight:n}=t(),o=new Set(n);o.add(a),e({mutationsInFlight:o});try{if(!(await Re(s)).success)throw new Error("Backend returned unsuccessful response");await t().fetchStats({force:!0})}catch(i){const{mutationsInFlight:s}=t(),n=new Set(s);throw n.delete(a),e({mutationsInFlight:n}),i}},clearModeMutation:()=>{const{mutationsInFlight:s}=t(),a=new Set(s);a.delete("setMode"),e({mutationsInFlight:a})},setDutyCycle:async s=>{const a="setDutyCycle",{mutationsInFlight:n}=t(),o=new Set(n);o.add(a),e({mutationsInFlight:o});try{if(!(await Fe(s)).success)throw new Error("Backend returned unsuccessful response");await t().fetchStats({force:!0})}finally{const{mutationsInFlight:s}=t(),n=new Set(s);n.delete(a),e({mutationsInFlight:n})}},setDutyCycleConfig:async s=>{var a;const n="setDutyCycleConfig",{mutationsInFlight:o}=t(),i=new Set(o);i.add(n),e({mutationsInFlight:i});try{const e=await async function(e){return _e("/api/update_duty_cycle_config",{method:"POST",body:JSON.stringify(e)})}(s);if(!e.success&&!(null==(a=e.data)?void 0:a.persisted))throw new Error("Backend returned unsuccessful response");await t().fetchStats({force:!0})}catch(r){const{mutationsInFlight:s}=t(),a=new Set(s);throw a.delete(n),e({mutationsInFlight:a}),r}},clearDutyCycleMutation:()=>{const{mutationsInFlight:s}=t(),a=new Set(s);a.delete("setDutyCycleConfig"),e({mutationsInFlight:a})},sendAdvert:async()=>{try{const s=await Ae();return s.success&&e({flashAdvert:t().flashAdvert+1}),s.success}catch(s){return!1}},triggerFlashReceived:()=>{e({flashReceived:t().flashReceived+1})},triggerFlashAdvert:()=>{e({flashAdvert:t().flashAdvert+1})},addResourceDataPoint:(s,a,n)=>{const o=Date.now(),{lastResourceFetch:i,resourceHistory:r}=t();if(o-i<1e3)return;const c=[...r,{timestamp:o,time:new Date(o).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),cpu:s,memory:a}],l=c.length>n?c.slice(-n):c;var d,u;e({resourceHistory:l,lastResourceFetch:o}),d=l,u=o,"undefined"!=typeof window&&(Nt&&clearTimeout(Nt),Nt=setTimeout(()=>{try{localStorage.setItem(kt,JSON.stringify(d)),localStorage.setItem(vt,u.toString())}catch{}Nt=null},1e3))},hideContact:s=>{const{hiddenContacts:a}=t(),n=new Set(a);n.add(s),e({hiddenContacts:n}),function(e){if("undefined"!=typeof window)try{localStorage.setItem(jt,JSON.stringify([...e]))}catch{}}(n)},clearPacketCache:()=>{it.clear(),e({packets:[],lastPacketTimestamp:0}),it.quickLoad().then(s=>{if(s.length>0){const a=s.reduce((e,t)=>Math.max(e,t.timestamp??0),0);e({packets:s,lastPacketTimestamp:a}),t().triggerTopologyCompute()}})},triggerTopologyCompute:()=>{var e,s,a,n;const{packets:o,stats:i,hiddenContacts:r}=t();if(0===o.length||!i)return;const c=i.neighbors??{},l=Object.fromEntries(Object.entries(c).filter(([e])=>!r.has(e))),d=i.local_hash,u=null==(s=null==(e=i.config)?void 0:e.repeater)?void 0:s.latitude,h=null==(n=null==(a=i.config)?void 0:a.repeater)?void 0:n.longitude,p=[];for(const[t,m]of Object.entries(l))m.zero_hop&&p.push({hash:t,advertCount:m.advert_count??1,avgRssi:m.rssi??null,avgSnr:m.snr??null,lastSeen:m.last_seen??0,latitude:m.latitude,longitude:m.longitude});lt.compute(o,l,d,u,h,void 0,p)},triggerDeepAnalysis:async()=>{await it.forceDeepLoad();const s=it.getPackets();if(s.length>0){const a=s.reduce((e,t)=>Math.max(e,t.timestamp??0),0);e({packets:s,lastPacketTimestamp:a}),t().triggerTopologyCompute(),t().triggerSparklineCompute()}},updateQuickNeighbors:()=>{const{packets:s,stats:a,hiddenContacts:n}=t();if(0===s.length||!a)return;const o=a.neighbors??{},i=function(e,t,s){if(!s||0===e.length||0===Object.keys(t).length)return[];const a=Date.now(),n=ut(s),o=new Set(Object.keys(t)),i=function(e){var t,s;const a=new Map;for(const n of Object.keys(e)){const o=ut(n),i=a.get(o);if(i){const r=null==(t=e[i])?void 0:t.zero_hop;(null==(s=e[n])?void 0:s.zero_hop)&&!r&&a.set(o,n)}else a.set(o,n)}return a}(t),r=new Map;for(const l of e){if(!Mt(l))continue;const e=Pt(l.src_hash,n,i,o,s);if(!e)continue;let t=r.get(e);t||(t=Et(e),r.set(e,t)),Lt(t,l)}for(const[l,d]of Object.entries(t))d.zero_hop&&!r.has(l)&&r.set(l,{hash:l,count:d.advert_count??0,rssiSum:d.rssi??0,rssiCount:void 0!==d.rssi?1:0,snrSum:d.snr??0,snrCount:void 0!==d.snr?1:0,lastSeen:d.last_seen??0});const c=[];for(const l of r.values()){const e=It(l,a);e&&c.push(e)}return c.sort((e,t)=>t.count!==e.count?t.count-e.count:t.lastSeen-e.lastSeen),c}(s,Object.fromEntries(Object.entries(o).filter(([e])=>!n.has(e))),a.local_hash),r=t().quickNeighbors;(i.length!==r.length||i.some((e,t)=>{var s,a;return e.hash!==(null==(s=r[t])?void 0:s.hash)||e.count!==(null==(a=r[t])?void 0:a.count)}))&&(e({quickNeighbors:i}),Rt(i))},triggerSparklineCompute:()=>{const{packets:e,stats:s,hiddenContacts:a}=t();if(0===e.length||!s)return;const n=s.neighbors??{},o=Object.keys(n).filter(e=>!a.has(e));0!==o.length&&dt.compute(e,o)}})),Wt=Bt,Ht=()=>Bt(e=>e.stats),qt=()=>Bt(e=>e.statsError),Ut=()=>Bt(e=>e.packets),Jt=()=>Bt(e=>e.packetsLoading),Gt=()=>Bt(e=>e.logs),Vt=()=>Bt(e=>e.logsLoading),Kt=()=>Bt(e=>e.liveMode),Qt=()=>Bt(e=>e.flashAdvert),Xt=()=>Bt(e=>e.fetchLogs),Zt=()=>Bt(e=>e.setLiveMode),Yt=()=>Bt(e=>e.resourceHistory),es=()=>Bt(e=>e.addResourceDataPoint),ts=()=>Bt(e=>e.hiddenContacts),ss=()=>Bt(e=>e.hideContact),as=()=>Bt(e=>e.packetCacheState),ns=()=>Bt(e=>e.triggerDeepAnalysis),os=()=>Bt(e=>e.quickNeighbors),is=()=>Bt(e=>e.cachedLocalHash),rs=()=>Bt(e=>e.packetCacheState.backgroundLoadComplete);function cs({showLabel:e=!1,className:t}){const n=Bt(e=>e.flashReceived),o=Qt(),[i,r]=s.useState("idle");return s.useEffect(()=>{if(n>0){r("received");const e=setTimeout(()=>r("idle"),300);return()=>clearTimeout(e)}},[n]),s.useEffect(()=>{if(o>0){r("transmitted");const e=setTimeout(()=>r("idle"),300);return()=>clearTimeout(e)}},[o]),a.jsxs("span",{className:E("inline-flex items-center gap-2",t),children:[a.jsx("span",{className:E("inline-flex rounded-full h-2 w-2 transition-all duration-150","received"===i&&"bg-accent-danger scale-150","transmitted"===i&&"bg-white scale-150","idle"===i&&"bg-accent-success")}),e&&a.jsx("span",{className:"type-data-xs text-text-muted uppercase tracking-wide",children:"Live"})]})}const ls=n(e=>({sparklines:new Map,isComputing:!1,lastUpdated:0,nodeCount:0,setSparklines:t=>e({sparklines:t,lastUpdated:Date.now(),nodeCount:t.size,isComputing:!1}),setComputing:t=>e({isComputing:t})}));"undefined"!=typeof window&&setTimeout(()=>{dt.subscribe((e,t)=>{const s=ls.getState();t&&!s.isComputing?s.setComputing(!0):!t&&e.size>0?s.setSparklines(e):!t&&s.isComputing&&s.setComputing(!1)})},0);const ds=()=>ls(e=>e.isComputing),us=[],hs=new Map;function ps(e){return ls(t=>{const s=t.sparklines.get(e);if(!s||0===s.length)return us;const a=hs.get(e);return a===s?a:(hs.set(e,s),s)})}const ms=n(e=>({topology:{edges:[],validatedEdges:[],weakEdges:[],certainEdges:[],uncertainEdges:[],edgeMap:new Map,maxPacketCount:0,maxCertainCount:0,neighborAffinity:new Map,fullAffinity:new Map,localPrefix:null,centrality:new Map,hubNodes:[],gatewayNodes:[],loops:[],loopEdgeKeys:new Set,txDelayRecommendations:new Map,pathRegistry:ct(),edgeBetweenness:new Map,backboneEdges:[],nodeMobility:new Map,mobileNodes:[],pathHealth:[],lastHopNeighbors:[],disambiguationStats:{totalPrefixes:0,unambiguousPrefixes:0,collisionPrefixes:0,collisionRate:0,avgConfidence:0,lowConfidencePrefixes:[],highCollisionPrefixes:[],totalResolutions:0},discoveredNodes:[],viterbiStats:{totalPaths:0,pathsWithGhosts:0,avgPathCost:0,avgPathConfidence:0,observationOverrideCount:0,tracePacketsProcessed:0,pathPacketsProcessed:0,distantEdgesDiscovered:0,duplicateGroupsFound:0,duplicatePathsUnique:0,echolocationEdgesInferred:0}},isComputing:!1,lastComputeTimeMs:0,lastUpdated:0,setTopology:(t,s)=>e({topology:t,lastComputeTimeMs:s,lastUpdated:Date.now(),isComputing:!1}),setComputing:t=>e({isComputing:t})}));"undefined"!=typeof window&&lt.subscribe((e,t)=>{ms.getState().setTopology(e,t)});const gs=()=>ms(e=>e.topology),fs=()=>ms(e=>e.topology.hubNodes),ys=()=>ms(e=>e.topology.centrality),bs=()=>ms(e=>e.topology.fullAffinity);let xs=null,ws=null,ks=null,vs=null;const js=()=>ms(e=>(e.topology.hubNodes!==ws&&(ws=e.topology.hubNodes,xs=new Set(e.topology.hubNodes)),xs)),Ss=()=>ms(e=>e.topology.pathHealth),Cs=()=>ms(e=>e.topology.disambiguationStats),Ns=()=>ms(e=>e.topology.disambiguationStats.highCollisionPrefixes),_s=()=>ms(e=>e.topology.disambiguationStats.totalPrefixes>0),Ts=()=>ms(e=>e.topology.discoveredNodes),Ms=()=>ms(e=>e.topology.viterbiStats),Ps=()=>ms(e=>(e.topology.discoveredNodes!==vs&&(vs=e.topology.discoveredNodes,ks=e.topology.discoveredNodes.filter(e=>e.isLikelyReal)),ks));function Ls(e){if(e<60)return`${Math.floor(e)}s`;const t=Math.floor(e/86400),s=Math.floor(e%86400/3600),a=Math.floor(e%3600/60),n=[];return t>0&&n.push(`${t}d`),s>0&&n.push(`${s}h`),(a>0||0===n.length)&&n.push(`${a}m`),n.join(" ")}function Es(e){const t=Date.now()/1e3-e;return t<60?"just now":t<3600?`${Math.floor(t/60)}m ago`:t<86400?`${Math.floor(t/3600)}h ago`:`${Math.floor(t/86400)}d ago`}function Is(e){const t=Date.now()/1e3-e;return t<60?`${Math.floor(t)}s`:t<3600?`${Math.floor(t/60)}m`:t<86400?`${Math.floor(t/3600)}h`:`${Math.floor(t/86400)}d`}function As(e){return new Date(1e3*e).toLocaleString()}function Rs(e){const t=new Date(1e3*e);return`${t.toLocaleString("en-US",{month:"short"})} ${t.getDate()}, ${t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}`}function Fs(e){return`${(e/1e6).toFixed(3)} MHz`}function Os(e){return`${(e/1e3).toFixed(1)} kHz`}function Ds(e){const t=e>1e12?e:1e3*e,s=Date.now(),a=Math.abs(s-t),n=Math.floor(a/1e3),o=Math.floor(n/60),i=Math.floor(o/60),r=Math.floor(i/24);return r>0?`${r} day${1!==r?"s":""}`:i>0?`${i} hour${1!==i?"s":""}`:o>0?`${o} minute${1!==o?"s":""}`:`${n} second${1!==n?"s":""}`}const zs=[{name:"Dashboard",to:"/",icon:c},{name:"Contacts",to:"/contacts",icon:l},{name:"Packets",to:"/packets",icon:d},{name:"Statistics",to:"/statistics",icon:u},{name:"System",to:"/system",icon:h},{name:"Logs",to:"/logs",icon:p},{name:"Terminal",to:"/terminal",icon:m},{name:"Configuration",to:"/configuration",icon:g}],$s="pymc-controls-expanded";function Bs(){var e,t,n,c;const{pathname:l}=o(),{stats:d,setMode:u,setDutyCycle:p,sendAdvert:m}=Wt(),g=we(),N=Bt(e=>e.prefetchForRoute),_=as(),T=ds(),M=ms(e=>e.isComputing),P=Ps(),[L,I]=s.useState(!1),[A,R]=s.useState(!0),[F,O]=s.useState(!1),D=s.useRef(null),z=s.useCallback(e=>{e!==l&&(D.current&&clearTimeout(D.current),D.current=setTimeout(()=>{N(e)},100))},[l,N]),$=s.useCallback(()=>{D.current&&(clearTimeout(D.current),D.current=null)},[]);s.useEffect(()=>{const e=localStorage.getItem($s);null!==e&&queueMicrotask(()=>R("true"===e))},[]);const B=()=>{const e=!A;R(e),localStorage.setItem($s,String(e))};s.useEffect(()=>{queueMicrotask(()=>I(!1))},[l]),s.useEffect(()=>(document.body.style.overflow=L?"hidden":"",()=>{document.body.style.overflow=""}),[L]);const W=null==d?void 0:d.noise_floor_dbm,H=(null==(t=null==(e=null==d?void 0:d.config)?void 0:e.repeater)?void 0:t.mode)??"forward",q=(null==(c=null==(n=null==d?void 0:d.config)?void 0:n.duty_cycle)?void 0:c.enforcement_enabled)??!1,U=async()=>{O(!0),await m(),setTimeout(()=>O(!1),1e3)},J=()=>{u("forward"===H?"monitor":"forward")},G=()=>{p(!q)},V=()=>{je(),window.location.href="/login"},K=_.isLoading||_.isTopologyLoading,Q=K||T||M,X=_.loadProgress,Z=()=>{if(!Q)return null;let e="Analyzing database";K&&X?e=`Loading ${X.loaded.toLocaleString()} packets`:T?e="Computing sparklines":M&&(e="Building topology");const t=(null==X?void 0:X.percent)??null,s=null!==t&&K;return a.jsxs("div",{className:"px-3 pb-2",children:[a.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5",children:[a.jsxs("div",{className:"relative flex h-2 w-2",children:[a.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-accent-primary opacity-75"}),a.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-accent-primary"})]}),a.jsx("span",{className:"type-data-xs text-text-muted",children:e}),s&&a.jsxs("span",{className:"type-data-xs text-text-muted ml-auto",children:[t,"%"]})]}),a.jsx("div",{className:"mx-2 h-0.5 bg-white/5 rounded-full overflow-hidden",children:s?a.jsx("div",{className:"h-full bg-accent-primary/60 rounded-full transition-all duration-300 ease-out",style:{width:`${t}%`}}):a.jsx("div",{className:"h-full bg-accent-primary/60 rounded-full animate-pulse",style:{width:"100%",animation:"shimmer 1.5s ease-in-out infinite"}})})]})},Y=()=>a.jsx("nav",{className:"flex-1 px-3 py-4 space-y-1 overflow-y-auto",children:zs.map(e=>{const t=l===e.to;return a.jsxs(f,{to:e.to,onClick:()=>I(!1),onMouseEnter:()=>z(e.to),onMouseLeave:$,className:E("flex items-center gap-3 px-3 py-2.5 rounded-xl transition-all duration-150 min-h-[44px]",t?"bg-accent-primary/15 text-accent-primary":"text-text-muted hover:text-text-primary hover:bg-white/5"),children:[a.jsx(e.icon,{className:E("w-5 h-5 flex-shrink-0",t&&"text-accent-primary")}),a.jsx("span",{className:"type-body-sm font-medium",children:e.name}),"/contacts"===e.to&&P.length>0&&a.jsxs("span",{className:"ml-auto flex items-center gap-1 px-1.5 py-0.5 rounded-full bg-accent-tertiary/20 text-accent-tertiary",children:[a.jsx(y,{className:"w-3 h-3"}),a.jsx("span",{className:"type-data-xs font-medium",children:P.length})]})]},e.name)})}),ee=()=>a.jsxs("div",{className:"px-3 py-3",children:[a.jsxs("button",{onClick:B,className:"w-full flex items-center justify-between px-2 py-1.5 mb-2 rounded-lg hover:bg-white/5 transition-colors",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(b,{className:"w-4 h-4 text-accent-primary"}),a.jsx("span",{className:"type-data-xs text-text-muted uppercase tracking-wide",children:"Controls"})]}),a.jsx(x,{className:E("w-4 h-4 text-text-muted transition-transform duration-200",A?"rotate-0":"-rotate-90")})]}),a.jsx("div",{className:E("overflow-hidden transition-all duration-300 ease-out",A?"max-h-96 opacity-100":"max-h-0 opacity-0"),children:a.jsxs("div",{className:"control-panel-skeuo",children:[a.jsxs("button",{onClick:U,disabled:F,className:E("control-btn control-btn-primary w-full",F&&"opacity-70"),children:[a.jsx(w,{className:E("w-4 h-4",F&&"animate-pulse")}),a.jsx("span",{children:F?"Sending...":"Send Advert"})]}),a.jsxs("div",{className:"control-toggle-group",children:[a.jsxs("div",{className:"control-toggle-label",children:[a.jsx("span",{children:"Mode"}),a.jsx("span",{className:E("control-toggle-status","forward"===H?"text-accent-success":"text-accent-secondary"),children:"forward"===H?"FWD":"MON"})]}),a.jsx("button",{onClick:J,className:E("control-btn w-full","forward"===H?"control-btn-success":"control-btn-warning"),children:"forward"===H?a.jsxs(a.Fragment,{children:[a.jsx(k,{className:"w-4 h-4"}),a.jsx("span",{children:"Forward"})]}):a.jsxs(a.Fragment,{children:[a.jsx(v,{className:"w-4 h-4"}),a.jsx("span",{children:"Monitor"})]})})]}),a.jsxs("div",{className:"control-toggle-group",children:[a.jsxs("div",{className:"control-toggle-label",children:[a.jsx("span",{children:"Duty Cycle"}),a.jsx("span",{className:E("control-toggle-status",q?"text-accent-success":"text-text-muted"),children:q?"ON":"OFF"})]}),a.jsxs("button",{onClick:G,className:E("control-btn w-full",q?"control-btn-success":"control-btn-neutral"),children:[a.jsx(h,{className:"w-4 h-4"}),a.jsx("span",{children:q?"Enabled":"Disabled"})]})]})]})})]}),ne=()=>a.jsxs("div",{className:"mt-auto border-t border-white/5",children:[void 0!==(null==d?void 0:d.uptime_seconds)&&a.jsxs("div",{className:"px-4 py-3 flex items-center gap-2",children:[a.jsx(j,{className:"w-3.5 h-3.5 text-text-muted"}),a.jsxs("span",{className:"type-data-xs text-text-secondary tabular-nums",children:[Ls(d.uptime_seconds)," uptime"]})]}),a.jsx("div",{className:"px-3 pb-3",children:a.jsx("div",{className:"bg-white/[0.03] rounded-xl p-3",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(S,{className:"w-4 h-4 text-accent-primary"}),a.jsx("span",{className:"type-data-xs text-text-muted",children:"Noise Floor"})]}),a.jsx("span",{className:"type-data text-text-primary tabular-nums",children:null!=W?`${W.toFixed(0)} dBm`:""})]})})}),a.jsxs("div",{className:"px-4 py-3 flex items-center justify-between border-t border-white/5",children:[a.jsx(cs,{showLabel:!0}),(null==d?void 0:d.version)&&a.jsxs("span",{className:"type-data-xs text-text-muted",children:["v",d.version]})]}),a.jsx("div",{className:"px-3 pb-3",children:a.jsxs("button",{onClick:V,className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-xl text-text-muted hover:text-accent-danger hover:bg-accent-danger/10 transition-all duration-150",children:[a.jsx(C,{className:"w-4 h-4"}),a.jsx("span",{className:"type-body-sm",children:"Sign Out"}),g&&a.jsxs("span",{className:"ml-auto type-data-xs text-text-muted",children:["(",g,")"]})]})})]});return a.jsxs(a.Fragment,{children:[a.jsx("header",{className:"lg:hidden fixed top-0 inset-x-0 z-[10001] h-14 bg-bg-body/70 backdrop-blur-xl border-b border-white/10",children:a.jsxs("div",{className:"flex items-center justify-between h-full px-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("a",{href:"https://wcmesh.com",target:"_blank",rel:"noopener noreferrer",className:"w-10 h-10 rounded-xl overflow-hidden border border-white/10 shadow-lg shadow-black/20 hover:border-white/20 hover:shadow-xl transition-all flex-shrink-0",title:"West Coast Mesh",children:a.jsx("img",{src:se,alt:"West Coast Mesh",className:"w-full h-full object-cover"})}),a.jsx("h1",{className:"sr-only",children:"pyMC Console"}),a.jsx(ae,{height:20,className:"block"})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("p",{className:"type-data-xs text-text-muted",children:["v",te]}),a.jsx(cs,{}),a.jsx("button",{onClick:()=>I(!L),className:"w-10 h-10 flex items-center justify-center rounded-xl hover:bg-white/5 active:bg-white/10 transition-colors","aria-label":L?"Close menu":"Open menu",children:L?a.jsx(i,{className:"w-5 h-5 text-text-primary"}):a.jsx(r,{className:"w-5 h-5 text-text-primary"})})]})]})}),a.jsx("div",{className:E("lg:hidden fixed inset-0 z-[10002] bg-black/60 backdrop-blur-sm transition-opacity duration-300",L?"opacity-100":"opacity-0 pointer-events-none"),onClick:()=>I(!1),"aria-hidden":"true"}),a.jsxs("aside",{className:E("lg:hidden fixed top-0 left-0 z-[10003] w-72 max-w-[85vw] h-full","glass-sidebar","flex flex-col","transform transition-transform duration-300 ease-out",L?"translate-x-0":"-translate-x-full pointer-events-none"),children:[a.jsxs("div",{className:"flex items-center gap-3 px-4 py-5 border-b border-white/5",children:[a.jsx("a",{href:"https://wcmesh.com",target:"_blank",rel:"noopener noreferrer",className:"w-11 h-11 rounded-xl overflow-hidden border border-white/10 shadow-lg shadow-black/20 hover:border-white/20 hover:shadow-xl transition-all flex-shrink-0",title:"West Coast Mesh",children:a.jsx("img",{src:se,alt:"West Coast Mesh",className:"w-full h-full object-cover"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h1",{className:"sr-only",children:"pyMC Console"}),a.jsx(ae,{height:18,className:"block"}),a.jsxs("p",{className:"type-data-xs text-text-muted mt-0.5",children:["v",te]})]})]}),Y(),Z(),ee(),ne()]}),a.jsxs("aside",{className:"hidden lg:flex flex-col w-64 flex-shrink-0 h-full relative glass-sidebar",children:[a.jsxs("div",{className:"flex items-center gap-3 px-5 py-6 border-b border-white/5",children:[a.jsx("a",{href:"https://wcmesh.com",target:"_blank",rel:"noopener noreferrer",className:"w-11 h-11 rounded-xl overflow-hidden border border-white/10 shadow-lg shadow-black/20 hover:border-white/20 hover:shadow-xl transition-all flex-shrink-0",title:"West Coast Mesh",children:a.jsx("img",{src:se,alt:"West Coast Mesh",className:"w-full h-full object-cover"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h1",{className:"sr-only",children:"pyMC Console"}),a.jsx(ae,{height:18,className:"block"}),a.jsxs("p",{className:"type-data-xs text-text-muted mt-0.5",children:["v",te]})]})]}),Y(),Z(),ee(),ne()]})]})}const Ws=s.memo(function(){const{theme:e}=ee(),{backgroundImage:t,brightness:n}=e,[o,i]=s.useState(t),[r,c]=s.useState(!1);s.useEffect(()=>{if(t===o)return;const e=new Image;e.onload=()=>{c(!0),requestAnimationFrame(()=>{i(t),setTimeout(()=>c(!1),300)})},e.onerror=()=>{i(t)},e.src=t},[t,o]);const l=(100-n)/100;return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 -z-20",style:{contain:"paint",willChange:r?"opacity":"auto"},"aria-hidden":"true",children:a.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat transition-opacity duration-300 ease-out",style:{backgroundImage:`url(${o})`,opacity:r?.7:1}})}),a.jsx("div",{className:"fixed inset-0 -z-10 bg-black pointer-events-none transition-opacity duration-200 ease-out",style:{opacity:l,contain:"paint"},"aria-hidden":"true"})]})});function Hs({className:e=""}){return a.jsx("div",{className:`bg-white/5 animate-pulse rounded-lg ${e}`,"aria-hidden":"true"})}function qs(){return a.jsxs("div",{className:"section-gap","aria-label":"Loading dashboard",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(Hs,{className:"h-8 w-48"}),a.jsx(Hs,{className:"h-8 w-32"})]}),a.jsx(Hs,{className:"h-72"}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-3",children:Array.from({length:8}).map((e,t)=>a.jsx(Hs,{className:"h-24"},t))}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Array.from({length:4}).map((e,t)=>a.jsx(Hs,{className:"h-44"},t))}),a.jsx(Hs,{className:"h-96"})]})}function Us(){return a.jsxs("div",{className:"section-gap","aria-label":"Loading list",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(Hs,{className:"h-8 w-40"}),a.jsx(Hs,{className:"h-8 w-24"})]}),a.jsx(Hs,{className:"h-20"}),a.jsxs("div",{className:"glass-card overflow-hidden",children:[a.jsx(Hs,{className:"h-10 rounded-none"}),a.jsx("div",{className:"divide-y divide-border-subtle/30",children:Array.from({length:10}).map((e,t)=>a.jsx("div",{className:"px-4 py-3",children:a.jsx(Hs,{className:"h-6"})},t))})]})]})}function Js(){return a.jsxs("div",{className:"section-gap","aria-label":"Loading map",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(Hs,{className:"h-8 w-32"}),a.jsx(Hs,{className:"h-6 w-48"})]}),a.jsx(Hs,{className:"h-[500px]"}),a.jsx(Hs,{className:"h-64"})]})}function Gs(){return a.jsxs("div",{className:"section-gap","aria-label":"Loading charts",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(Hs,{className:"h-8 w-36"}),a.jsx(Hs,{className:"h-8 w-40"})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[a.jsx(Hs,{className:"h-80"}),a.jsx(Hs,{className:"h-80"})]}),a.jsx(Hs,{className:"h-64"})]})}function Vs(){return a.jsxs("div",{className:"section-gap","aria-label":"Loading settings",children:[a.jsx(Hs,{className:"h-8 w-32"}),a.jsxs("div",{className:"space-y-6",children:[a.jsx(Hs,{className:"h-48"}),a.jsx(Hs,{className:"h-64"}),a.jsx(Hs,{className:"h-32"})]})]})}function Ks(){return a.jsxs("div",{className:"section-gap","aria-label":"Loading system info",children:[a.jsx(Hs,{className:"h-8 w-28"}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Array.from({length:4}).map((e,t)=>a.jsx(Hs,{className:"h-28"},t))}),a.jsx(Hs,{className:"h-64"}),a.jsx(Hs,{className:"h-48"})]})}const Qs=s.lazy(()=>L(()=>import("./Login-BVGfeeRd.js"),__vite__mapDeps([0,1,2]))),Xs=s.lazy(()=>L(()=>import("./Dashboard-BfZs_ThN.js"),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10]))),Zs=s.lazy(()=>L(()=>import("./Packets-wtXWXIE0.js"),__vite__mapDeps([11,1,2,6,7,8,5]))),Ys=s.lazy(()=>L(()=>import("./Contacts-CZV5Ovbv.js").then(e=>e.C),__vite__mapDeps([12,1,2,7,8,13,14,5,15]))),ea=s.lazy(()=>L(()=>import("./Statistics-C2Q9qDtH.js"),__vite__mapDeps([16,1,2,9,17,4,5,14,10,15,18]))),ta=s.lazy(()=>L(()=>import("./System-BSF0fscu.js"),__vite__mapDeps([19,1,2,5,4,10]))),sa=s.lazy(()=>L(()=>import("./Logs-CZ5S1k0r.js"),__vite__mapDeps([20,1,2,17,5]))),aa=s.lazy(()=>L(()=>import("./Terminal-fFigQMKz.js"),__vite__mapDeps([21,1,2,5]))),na=s.lazy(()=>L(()=>import("./Configuration-HwYFsp1c.js"),__vite__mapDeps([22,1,2,8,13,5,10])));function oa({children:e}){const t=o();return fe()?a.jsx(a.Fragment,{children:e}):a.jsx(T,{to:"/login",state:{from:t},replace:!0})}class ia extends s.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}render(){var e;return this.state.hasError?a.jsxs("div",{className:"glass-card p-8 text-center",children:[a.jsx("p",{className:"type-subheading text-accent-red mb-2",children:"Page failed to render"}),a.jsx("p",{className:"type-body text-white/50 mb-4",children:(null==(e=this.state.error)?void 0:e.message)||"Unknown error"}),a.jsx("button",{onClick:()=>this.setState({hasError:!1}),className:"px-4 py-2 bg-accent-primary/20 text-accent-primary rounded-lg hover:bg-accent-primary/30 transition-colors",children:"Try Again"})]}):this.props.children}}function ra(){const e=Bt(e=>e.initializeApp),t=fe();return s.useEffect(()=>{t&&e()},[e,t]),a.jsxs(a.Fragment,{children:[a.jsx(Ws,{}),a.jsxs(N,{children:[a.jsx(_,{path:"/login",element:a.jsx(s.Suspense,{fallback:a.jsx("div",{className:"min-h-screen bg-bg-body"}),children:a.jsx(Qs,{})})}),a.jsx(_,{path:"/*",element:a.jsx(oa,{children:a.jsxs("div",{className:"flex h-screen overflow-hidden",children:[a.jsx(Bs,{}),a.jsx("main",{className:"flex-1 w-full min-w-0 pt-14 lg:pt-0 overflow-y-auto",children:a.jsx("div",{className:"p-4 sm:p-6 lg:p-8 max-w-7xl mx-auto",children:a.jsx(ia,{children:a.jsxs(N,{children:[a.jsx(_,{path:"/",element:a.jsx(s.Suspense,{fallback:a.jsx(qs,{}),children:a.jsx(Xs,{})})}),a.jsx(_,{path:"/packets",element:a.jsx(s.Suspense,{fallback:a.jsx(Us,{}),children:a.jsx(Zs,{})})}),a.jsx(_,{path:"/contacts",element:a.jsx(s.Suspense,{fallback:a.jsx(Js,{}),children:a.jsx(Ys,{})})}),a.jsx(_,{path:"/statistics",element:a.jsx(s.Suspense,{fallback:a.jsx(Gs,{}),children:a.jsx(ea,{})})}),a.jsx(_,{path:"/system",element:a.jsx(s.Suspense,{fallback:a.jsx(Ks,{}),children:a.jsx(ta,{})})}),a.jsx(_,{path:"/logs",element:a.jsx(s.Suspense,{fallback:a.jsx(Us,{}),children:a.jsx(sa,{})})}),a.jsx(_,{path:"/terminal",element:a.jsx(s.Suspense,{fallback:a.jsx(Us,{}),children:a.jsx(aa,{})})}),a.jsx(_,{path:"/configuration",element:a.jsx(s.Suspense,{fallback:a.jsx(Vs,{}),children:a.jsx(na,{})})})]})})})})]})})})]})]})}const ca=console.warn;console.warn=(...e)=>{const t=e[0];"string"==typeof t&&t.includes("width")&&t.includes("height")&&t.includes("chart should be greater than 0")||ca.apply(console,e)},M.createRoot(document.getElementById("root")).render(a.jsx(s.StrictMode,{children:a.jsx(Y,{children:a.jsx(P,{children:a.jsx(ra,{})})})}));export{bt as $,Ds as A,ps as B,ds as C,mt as D,Ns as E,Wt as F,ss as G,fs as H,ys as I,Ps as J,Je as K,Es as L,ce as M,le as N,ie as O,ae as P,Cs as Q,oe as R,_s as S,gt as T,ft as U,Le as V,se as W,yt as X,Yt as Y,es as Z,Ie as _,Jt as a,Gt as a0,Vt as a1,Xt as a2,$e as a3,wt as a4,Me as a5,Ae as a6,Re as a7,Fe as a8,ze as a9,ee as aa,R as ab,B as ac,Qe as ad,Be as ae,Fs as af,Os as ag,Ge as ah,Ve as ai,Ke as aj,Xe as ak,Ze as al,Ue as am,We as an,He as ao,qe as ap,ht as aq,gs as ar,ns as as,as as at,is as au,Kt as b,Qt as c,Ht as d,os as e,ts as f,Ee as g,qt as h,fe as i,rs as j,De as k,ke as l,Ls as m,Zt as n,ne as o,Is as p,Rs as q,pt as r,ut as s,js as t,Ut as u,bs as v,Ts as w,As as x,Ss as y,Ms as z};
