var t=Object.defineProperty,s=(s,a,e)=>((s,a,e)=>a in s?t(s,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[a]=e)(s,"symbol"!=typeof a?a+"":a,e);import{a4 as a,bi as e,bj as r,bk as h,bl as i,af as n,bm as o,bn as p,bo as y,bp as d,bq as l,br as u,bs as g,ba as c,bt as b,bu as T,bv as m,bw as C,bx as L,by as w,bz as f,bA as S,bB as N,bC as $,bD as x,bE as A}from"./index-DMudLcCy.js";class U{constructor(){s(this,"header",0),s(this,"transportCodes",[0,0]),s(this,"pathLen",0),s(this,"path",new Uint8Array(0)),s(this,"payload",new Uint8Array(0)),s(this,"decrypted",{}),s(this,"_rssi",0),s(this,"_snr",0)}static fromBytes(t){const s=new U;try{return s.readFrom(t),{success:!0,packet:s}}catch(a){return{success:!1,error:a instanceof Error?a.message:String(a)}}}static fromHex(t){try{const s=a(t);return U.fromBytes(s)}catch(s){return{success:!1,error:s instanceof Error?s.message:String(s)}}}get routeType(){return this.header&e}get routeTypeName(){return r[this.routeType]??`UNKNOWN(${this.routeType})`}get payloadType(){return this.header>>h&i}get payloadTypeName(){return n[this.payloadType]??`UNKNOWN(${this.payloadType})`}get payloadVersion(){return this.header>>o&p}hasTransportCodes(){return y(this.routeType)}isFlood(){return d(this.routeType)}isDirect(){return l(this.routeType)}get pathBytes(){return Array.from(this.path)}get pathString(){return u(this.path)}get pathHexArray(){return Array.from(this.path).map(t=>g(t,!0))}get payloadLen(){return this.payload.length}get payloadHex(){return c(this.payload,!0)}getPayloadAppData(){const t=$+x+A;return this.payload.length>=t?this.payload.slice(t):new Uint8Array(0)}get rssi(){return this._rssi}set rssi(t){this._rssi=t}get snr(){return this._snr}set snr(t){this._snr=t}readFrom(t){let s=0;const a=t.length;b(s,1,a,"Missing header byte"),this.header=t[s++];const e=this.payloadVersion;if(e>T)throw new Error(`Unsupported packet version: ${e}`);if(this.hasTransportCodes()?(b(s,4,a,"Missing transport codes"),this.transportCodes=[m(t,s),m(t,s+2)],s+=4):this.transportCodes=[0,0],b(s,1,a,"Missing path_len"),this.pathLen=t[s++],this.pathLen>C)throw new Error(`path_len too large: ${this.pathLen} > ${C}`);return b(s,this.pathLen,a,"Truncated path"),this.path=t.slice(s,s+this.pathLen),s+=this.pathLen,this.payload=t.slice(s),L(this.payload.length),!0}writeTo(){let t=1;this.hasTransportCodes()&&(t+=4),t+=1,t+=this.path.length,t+=this.payload.length;const s=new Uint8Array(t);let a=0;return s[a++]=this.header,this.hasTransportCodes()&&(w(this.transportCodes[0],s,a),w(this.transportCodes[1],s,a+2),a+=4),s[a++]=this.path.length,s.set(this.path,a),a+=this.path.length,s.set(this.payload,a),s}toHex(){return c(this.writeTo(),!0)}async calculateHash(){return f(this.payloadType,this.pathLen,this.payload)}async calculateHashString(t){return S(this.payloadType,this.pathLen,this.payload,t)}async calculateCRC(){return N(this.payloadType,this.pathLen,this.payload)}getRawLength(){let t=2+this.pathLen+this.payload.length;return this.hasTransportCodes()&&(t+=4),t}getSummary(){return{header:g(this.header,!0),routeType:this.routeTypeName,payloadType:this.payloadTypeName,version:this.payloadVersion,pathLen:this.pathLen,pathStr:this.pathString,transportCodes:this.hasTransportCodes()?[this.transportCodes[0].toString(16).toUpperCase().padStart(4,"0"),this.transportCodes[1].toString(16).toUpperCase().padStart(4,"0")]:null,payloadLen:this.payload.length,payloadHex:this.payloadHex,rawLength:this.getRawLength()}}toString(){const t=[`[${this.routeTypeName}/${this.payloadTypeName} v${this.payloadVersion}]`,`path=${this.pathString||"(empty)"}`,`payload=${this.payload.length}B`];return this.hasTransportCodes()&&t.push(`transport=[${this.transportCodes[0]},${this.transportCodes[1]}]`),t.join(" ")}}export{U as P};
