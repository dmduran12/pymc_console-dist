var e=Object.defineProperty,t=(t,s,a)=>((t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a)(t,"symbol"!=typeof s?s+"":s,a);import{r as s,j as a,c as n}from"./vendor-react-Co0R0q1H.js";import{c as i,e as l,a4 as r,aR as o,aS as c,aT as d,aU as m,j as u,aV as h,aW as x,u as p,aX as g,aY as f,aZ as y,a_ as b,a$ as j,b0 as v,as as N,b1 as k,b2 as w,b3 as M,aE as S,b4 as C,b5 as T,b6 as A,v as F,z as P,y as L,q as R,a1 as D,a2 as $,D as z,W as E,b7 as _,F as H,b8 as B,H as O,K as q,R as W,b9 as I}from"./index-BM4uXpTw.js";import{u as G}from"./usePolling-CDO4A079.js";import{L as V}from"./layers-BEMHN1oo.js";import{a as K,T as X}from"./TimeRangeStepper-BxfcNVFV.js";import{C as Y,e as U}from"./easing-CJUYg5Op.js";import{a as J,P as Q,b as Z,B as ee}from"./PageLayout-DQ0Skliw.js";import{D as te}from"./DataBox-DEEdPY07.js";import{E as se,A as ae}from"./AnimatedNumber-DLBsg2Vo.js";import{C as ne}from"./CollisionExplorerModal-Bs62nqxu.js";import{C as ie,a as le}from"./Card-DWO63Trz.js";import{H as re,R as oe}from"./prefix-disambiguation-eQ-voc0_.js";import{T as ce}from"./triangle-alert-B9uiNsK5.js";import{a as de,G as me}from"./git-branch-93f-myeM.js";import{L as ue}from"./LightSparkline-DnTPTfQA.js";import{A as he}from"./activity-M0JL_UrA.js";import{c as xe,u as pe,A as ge}from"./usePacketDisambiguation-BR11bFw9.js";import{R as fe,C as ye}from"./Grid-CTmu8x0g.js";import{S as be}from"./settings-2-D2zvbRG1.js";import{N as je}from"./network-CdHT2fVG.js";import"./maplibre-gl-b91ci4Kr.js";import"./vendor-core-B_fdKJ1g.js";import"./chevron-right-CSyaTYjH.js";import"./index-UUasZcAa.js";import"./BasemapLayer-DRuifqX0.js";import"./map-pin-CCVA0eXK.js";import"./monitor-smartphone-CuaCSnUS.js";import"./geo-utils-BR5NTbzq.js";import"./payload-decoders-B5IY7u0X.js";import"./search-UmBREV7E.js";const ve=i("chart-line",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]),Ne=i("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),ke=i("grid-3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),we=i("grip",[["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"19",cy:"5",r:"1",key:"w8mnmm"}],["circle",{cx:"5",cy:"5",r:"1",key:"lttvr7"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}],["circle",{cx:"19",cy:"19",r:"1",key:"shf9b7"}],["circle",{cx:"5",cy:"19",r:"1",key:"bfqh0e"}]]),Me=i("id-card",[["path",{d:"M16 10h2",key:"8sgtl7"}],["path",{d:"M16 14h2",key:"epxaof"}],["path",{d:"M6.17 15a3 3 0 0 1 5.66 0",key:"n6f512"}],["circle",{cx:"9",cy:"11",r:"2",key:"yxgjnd"}],["rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",key:"qneu4z"}]]),Se=i("radar",[["path",{d:"M19.07 4.93A10 10 0 0 0 6.99 3.34",key:"z3du51"}],["path",{d:"M4 6h.01",key:"oypzma"}],["path",{d:"M2.29 9.62A10 10 0 1 0 21.31 8.35",key:"qzzz0"}],["path",{d:"M16.24 7.76A6 6 0 1 0 8.23 16.67",key:"1yjesh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M17.99 11.66A6 6 0 0 1 15.77 16.67",key:"1u2y91"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"m13.41 10.59 5.66-5.66",key:"mhq4k0"}]]),Ce=i("sparkle",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}]]),Te=i("waves",[["path",{d:"M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"knzxuh"}],["path",{d:"M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"2jd2cc"}],["path",{d:"M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"rd2r6e"}]]),Ae={useAbsoluteThresholds:!0,baselinePercentile:6,spikePercentile:50,baselineDbm:-107,spikeDbm:-100,mergeGapSeconds:45,minSequenceLength:16,similarityToleranceDbm:5};function Fe(e,t){if(0===e.length)return 0;const s=t/100*(e.length-1),a=Math.floor(s),n=Math.ceil(s);return a===n?e[a]:e[a]+(e[n]-e[a])*(s-a)}function Pe(e){if(0===e.length)return{median:0,p90:0,p95:0,p99:0,max:0,min:0};const t=[...e].sort((e,t)=>e-t);return{median:Fe(t,50),p90:Fe(t,90),p95:Fe(t,95),p99:Fe(t,99),max:t[t.length-1],min:t[0]}}function Le(e,t,s){const a=s-t;if(0===a)return"moderate";const n=(e-t)/a;return n>.66?"critical":n>.33?"severe":"moderate"}const Re=Object.entries(r).map(([e,t])=>{const s=parseInt(e,10);return{typeNum:s,key:`TYPE_${s}`,label:t}});function De({sortedTypes:e,highlightedType:t,onTypeHover:i,aggregateShares:r,hoverData:o}){const c=s.useMemo(()=>{if(!o)return null;const e=new Map;for(const t of o.items)e.set(t.key,t.value);return e},[o]),d=null!==c,m=s.useMemo(()=>{const t=new Set(e.map(e=>e.key));return[...e.map(e=>({typeNum:e.typeNum,key:e.key,label:e.label})),...Re.filter(e=>!t.has(e.key))]},[e]);return a.jsxs("div",{className:"flex-shrink-0 pt-2 sm:pt-3 mt-1 sm:mt-2 px-0 sm:pr-0",children:[a.jsxs("div",{className:"flex items-center gap-2 mx-0 sm:ml-9 sm:mr-0 mb-1 sm:mb-1.5 type-data-xs",children:[a.jsx("span",{className:"text-fg-muted",children:"Packet Types"}),d&&(null==o?void 0:o.timeLabel)&&a.jsx("span",{className:"text-sys-indigo tabular-nums",children:o.timeLabel})]}),a.jsx("div",{className:"flex flex-wrap gap-x-3 sm:gap-x-4 gap-y-1 type-data-xs mx-0 sm:ml-9 sm:mr-0",onMouseLeave:()=>i(null),children:m.map(e=>{const s=l(e.typeNum),o=(null==c?void 0:c.get(e.key))??0,m=r.get(e.key)??0,u=d?o:m,h=u>1e-4,x=r.has(e.key),p=t===e.key,g=t&&!p||d&&o<=1e-4||!d&&!t&&!x;return a.jsxs("div",{className:n("flex items-center gap-1.5 transition-opacity cursor-pointer hover:opacity-80",g&&"opacity-30"),onMouseEnter:()=>i(e.key),children:[a.jsx("div",{className:"shrink-0 w-3 h-3 rounded-xs",style:{backgroundColor:s}}),a.jsx("span",{className:"text-fg-secondary whitespace-nowrap",children:e.label}),h&&a.jsxs("span",{className:n("tabular-nums",d?"text-fg-primary":"text-fg-muted"),children:[(100*u).toFixed(1),"%"]})]},e.key)})})]})}const $e='ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace';function ze(e,t,s,a,n){const i=e.reduce((e,t)=>e+t,0);if(i<=0||0===e.length)return[];const l=e.map((e,t)=>t).sort((t,s)=>e[s]-e[t]),r=l.map(t=>e[t]),o=new Array(e.length);return Ee(r,l,i,t,s,a,n,o),o}function Ee(e,t,s,a,n,i,l,r){if(0===e.length)return;if(1===e.length)return void(r[t[0]]={x:a,y:n,w:i,h:l,index:t[0]});const o=i*l/s,c=i>=l,d=c?l:i;let m=0,u=1/0,h=0;for(let b=0;b<e.length;b++){const t=m+e[b],s=t*o/d;if(s<=0){h=b+1,m=t;continue}const a=e[0]*o/s,n=e[b]*o/s,i=Math.max(a>s?a/s:s/a,n>s?n/s:s/n);if(!(i<=u))break;u=i,h=b+1,m=t}const x=d>0?m*o/d:0;let p=0;for(let b=0;b<h;b++){const s=(m>0?e[b]/m:0)*d;r[t[b]]=c?{x:a,y:n+p,w:x,h:s,index:t[b]}:{x:a+p,y:n,w:s,h:x,index:t[b]},p+=s}const g=e.slice(h),f=t.slice(h),y=s-m;c?Ee(g,f,y,a+x,n,i-x,l,r):Ee(g,f,y,a,n+x,i,l-x,r)}function _e(e,t,s,a,n,i){for(const r of t){const t=s[r.index];if(!t)continue;const o=2*i,c=r.x*i+o/2,d=r.y*i+o/2,m=r.w*i-o,u=r.h*i-o;if(m<=0||u<=0)continue;const h=l(t.typeNum),x=null!==n&&n!==r.index;e.save(),e.globalAlpha=x?.4:1;const p=3*i;e.beginPath(),e.moveTo(c+p,d),e.lineTo(c+m-p,d),e.quadraticCurveTo(c+m,d,c+m,d+p),e.lineTo(c+m,d+u-p),e.quadraticCurveTo(c+m,d+u,c+m-p,d+u),e.lineTo(c+p,d+u),e.quadraticCurveTo(c,d+u,c,d+u-p),e.lineTo(c,d+p),e.quadraticCurveTo(c,d,c+p,d),e.closePath(),e.fillStyle=h,e.fill(),e.strokeStyle="rgba(0,0,0,0.2)",e.lineWidth=1*i,e.stroke();const g=4*i,f=r.w>36&&r.h>20,y=r.w>36&&r.h>32;if(f){const s=11*i;if(y){const n=a>0?t.size/a*100:0;e.font=`500 ${8*i}px ${$e}`,e.fillStyle="rgba(0,0,0,0.6)",e.textBaseline="alphabetic",e.textAlign="left",e.fillText(`${n.toFixed(1)}%`,c+g,d+u-g-s)}e.font=`600 ${9*i}px ${$e}`,e.fillStyle="rgba(0,0,0,0.85)",e.textBaseline="alphabetic",e.textAlign="left",e.fillText(t.name,c+g,d+u-g)}e.restore()}}function He({data:e,total:t,color:s,position:n,containerWidth:i,isAirtime:l}){if(!e||!n)return null;const r=(e.value/t*100).toFixed(1),o=i-n.x<184?Math.max(8,n.x-160-8):n.x+16;return a.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:o,top:Math.max(8,n.y-60)},children:a.jsxs("div",{className:"bg-tooltip-bg border border-edge-subtle rounded-lg px-3 py-2 shadow-xl min-w-[140px]",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("span",{className:"w-2.5 h-2.5 rounded-sm flex-shrink-0",style:{backgroundColor:s}}),a.jsx("span",{className:"type-data-sm font-semibold text-fg-primary",children:e.name})]}),a.jsxs("div",{className:"space-y-0.5 type-data-xs text-fg-muted",children:[a.jsxs("div",{className:"flex justify-between gap-4",children:[a.jsx("span",{children:l?"Airtime":"Count"}),a.jsx("span",{className:"text-fg-primary tabular-nums font-medium",children:l?Be(e.value):e.value.toLocaleString()})]}),a.jsxs("div",{className:"flex justify-between gap-4",children:[a.jsx("span",{children:"Share"}),a.jsxs("span",{className:"text-fg-primary tabular-nums font-medium",children:[r,"%"]})]}),a.jsxs("div",{className:"flex justify-between gap-4",children:[a.jsx("span",{children:"Total"}),a.jsx("span",{className:"text-fg-primary tabular-nums font-medium",children:l?Be(t):t.toLocaleString()})]})]})]})})}function Be(e){return e>=6e4?`${(e/6e4).toFixed(1)}m`:e>=1e3?`${(e/1e3).toFixed(1)}s`:`${Math.round(e)}ms`}function Oe({sortedTypes:e,aggregateShares:t,mode:n="share"}){var i,r,o;const[c,d]=s.useState(null),[m,u]=s.useState(null),[h,x]=s.useState(0),[p,g]=s.useState(null),f=s.useRef(null),y=s.useRef(null),b=s.useRef([]),j="airtime"===n,v=s.useMemo(()=>e.reduce((e,t)=>e+(j?t.totalAirtime:t.totalCount),0),[e,j]),N=s.useMemo(()=>e.map((e,t)=>({name:e.label,size:j?e.totalAirtime:e.totalCount,index:t,typeNum:e.typeNum,key:e.key})),[e,j]);s.useEffect(()=>{const e=y.current;if(!e)return;const t=e.parentElement;if(!t)return;const s=t.getBoundingClientRect(),a=s.width,n=s.height;if(a<=0||n<=0)return;const i=window.devicePixelRatio||1;e.width=Math.floor(a*i),e.height=Math.floor(n*i),e.style.width=`${a}px`,e.style.height=`${n}px`;const l=ze(N.map(e=>e.size),0,0,a,n);b.current=l;const r=e.getContext("2d");r&&(r.clearRect(0,0,e.width,e.height),_e(r,l,N,v,c,i))},[N,v,c]),s.useEffect(()=>{const e=f.current;if(!e)return;const t=new ResizeObserver(()=>{const t=y.current;if(!t)return;const s=e.getBoundingClientRect(),a=s.width,n=s.height;if(a<=0||n<=0)return;const i=window.devicePixelRatio||1;t.width=Math.floor(a*i),t.height=Math.floor(n*i),t.style.width=`${a}px`,t.style.height=`${n}px`;const l=ze(N.map(e=>e.size),0,0,a,n);b.current=l;const r=t.getContext("2d");r&&(r.clearRect(0,0,t.width,t.height),_e(r,l,N,v,c,i))});return t.observe(e),()=>t.disconnect()},[N,v]);const k=s.useCallback(e=>{const t=f.current;if(!t)return;const s=t.getBoundingClientRect(),a=e.clientX-s.left,n=e.clientY-s.top,i=function(e,t,s){for(const a of e)if(t>=a.x&&t<=a.x+a.w&&s>=a.y&&s<=a.y+a.h)return a.index;return null}(b.current,a,n);d(i),null!==i?(x(s.width),u({x:a,y:n})):u(null)},[]),w=s.useCallback(()=>{d(null),u(null)},[]),M=s.useCallback(e=>{if(g(e),e){const t=N.findIndex(t=>t.key===e);d(t>=0?t:null)}else d(null)},[N]),S=null!==c?{name:(null==(i=N[c])?void 0:i.name)??"",value:(null==(r=N[c])?void 0:r.size)??0}:null,C=null!==c?l(null==(o=N[c])?void 0:o.typeNum):"";return 0===e.length||0===v?a.jsxs("div",{className:"h-full flex items-center justify-center text-fg-muted",children:[a.jsx(V,{className:"w-6 h-6 mr-2 opacity-50"}),a.jsx("span",{children:"No packet type data available"})]}):a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:"flex-1 min-h-0 relative",ref:f,onMouseMove:k,onMouseLeave:w,children:[a.jsx("canvas",{ref:y,className:"absolute inset-0",style:{cursor:"default"}}),a.jsx(He,{data:S,total:v,color:C,position:m,containerWidth:h,isAirtime:j})]}),a.jsx("div",{style:{minHeight:80},children:a.jsx(De,{sortedTypes:e,highlightedType:p,onTypeHover:M,aggregateShares:t})})]})}function qe(e){return e>=1e9?`${(e/1e9).toFixed(1)} Gb`:e>=1e6?`${(e/1e6).toFixed(1)} Mb`:e>=1e3?`${(e/1e3).toFixed(1)} Kb`:`${e.toFixed(0)} B`}function We({packets:e,mode:t,startTs:n,endTs:i,radioConfig:l,bucketCount:r,lockedYMax:h,legendMinH:x}){const p=s.useMemo(()=>o(),[]),g=p.blue,f=p.red,y=p.yellow,[b,j]=s.useState(null),{trendData:v,totals:N}=s.useMemo(()=>{if(0===e.length)return{trendData:[],totals:{rxBytes:0,txBytes:0,rxAirtime:0,txAirtime:0}};const s=i-n,a=Math.min(Math.ceil(s/300),r),o=s/a,m=[];let u=0,h=0,x=0,p=0;for(const t of e){const e=t.timestamp;if(e<n||e>=i)continue;const s=c(t),a=d(t,{spreadingFactor:l.sf,bandwidthHz:l.bw,codingRate:l.cr,preambleLength:l.preamble}),r={timestamp:e,rxAirtime:0,txAirtime:0,rxBytes:0,txBytes:0};t.transmitted?(r.txAirtime=a,r.txBytes=s,h+=s,p+=a):(r.rxAirtime=a,r.rxBytes=s,u+=s,x+=a),m.push(r)}m.sort((e,t)=>e.timestamp-t.timestamp);const g=new Float64Array(m.length+1),f=new Float64Array(m.length+1),y=new Float64Array(m.length+1),b=new Float64Array(m.length+1),j=new Float64Array(m.length);for(let e=0;e<m.length;e++)g[e+1]=g[e]+m[e].rxAirtime,f[e+1]=f[e]+m[e].txAirtime,y[e+1]=y[e]+m[e].rxBytes,b[e+1]=b[e]+m[e].txBytes,j[e]=m[e].timestamp;const v=e=>{let t=0,s=j.length;for(;t<s;){const a=t+s>>>1;j[a]<e?t=a+1:s=a}return t},N=[],k=1e3*o;for(let e=0;e<a;e++){const s=n+e*o,a=s+o,i=v(s),l=v(a);if("share"===t){const e=y[l]-y[i],t=b[l]-b[i];N.push({timestamp:s,rx:e>0?e:null,tx:t>0?t:null})}else{const e=(g[l]-g[i])/k*100,t=(f[l]-f[i])/k*100;N.push({timestamp:s,rx:e>0?e:null,tx:t>0?t:null})}}const w=2/31;let M=null;return{trendData:N.map(e=>{const t=e.rx;return null!==t&&t>0&&(M=null===M?t:w*t+(1-w)*M),{...e,rxSmooth:null!==M&&M>0?M:null}}),totals:{rxBytes:u,txBytes:h,rxAirtime:x,txAirtime:p}}},[e,n,i,r,t,l]),k=s.useMemo(()=>{if(0===v.length)return"share"===t?100:10;let e=0;for(const t of v){const s=t.rx??0,a=t.tx??0;s>e&&(e=s),a>e&&(e=a)}const s=1.1*e;return"share"===t?s<=100?100:s<=500?100*Math.ceil(s/100):s<=1e3?200*Math.ceil(s/200):s<=5e3?500*Math.ceil(s/500):s<=1e4?1e3*Math.ceil(s/1e3):5e3*Math.ceil(s/5e3):Math.max(1,Math.ceil(s))},[v,t]),w=h??k,M=s.useMemo(()=>{if(null!==b&&v[b]){const e=v[b],s=e.rx??0,a=e.tx??0;return"share"===t?{rx:qe(s),tx:qe(a),total:qe(s+a),isHovered:!0}:{rx:`${s.toFixed(2)}%`,tx:`${a.toFixed(2)}%`,total:`${(s+a).toFixed(2)}%`,isHovered:!0}}if("share"===t)return{rx:qe(N.rxBytes),tx:qe(N.txBytes),total:qe(N.rxBytes+N.txBytes),isHovered:!1};{let e=0,t=0,s=0;for(const i of v)null===i.rx&&null===i.tx||(e+=i.rx??0,t+=i.tx??0,s++);const a=s>0?e/s:0,n=s>0?t/s:0;return{rx:`${a.toFixed(2)}%`,tx:`${n.toFixed(2)}%`,total:`${(a+n).toFixed(2)}%`,isHovered:!1}}},[b,v,N,t]),S=s.useMemo(()=>{const e=i-n,t=e/3600;return[0,.25,.5,.75,1].map(s=>{const a=new Date(1e3*(n+e*s)),i=a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),l=a.toLocaleDateString([],{weekday:"short"});return{pct:s,label:t>24?`${l} ${i}`:i,mobileHidden:.25===s||.75===s}})},[n,i]),C=s.useCallback(e=>{j(e)},[]);return 0===v.length?a.jsxs("div",{className:"h-full flex items-center justify-center text-fg-muted",children:[a.jsx(V,{className:"w-6 h-6 mr-2 opacity-50"}),a.jsx("span",{children:"No packet data available"})]}):a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:"flex-1 min-h-0 relative",children:[a.jsx("div",{className:"absolute top-0 left-0 right-0 z-10 flex items-center text-fg-secondary",style:{height:20,paddingLeft:44,paddingRight:8},children:a.jsx("div",{className:"relative w-full h-full flex items-center",children:S.map((e,t)=>a.jsxs("div",{className:"absolute flex items-center gap-0.5 sm:gap-1 type-data-xs "+(e.mobileHidden?"hidden sm:flex":""),style:{left:100*e.pct+"%",transform:0===e.pct?"translateX(0)":1===e.pct?"translateX(-100%)":"translateX(-50%)"},children:[a.jsx(K,{className:"w-2.5 h-2.5 opacity-60 hidden sm:block"}),a.jsx("span",{className:"tabular-nums",children:e.label})]},t))})}),a.jsx("div",{className:"absolute inset-0 rounded-lg overflow-hidden",style:{paddingTop:20},children:a.jsx(m,{data:v,yAxisMode:"share"===t?"share":"airtime",yMax:w,onHover:C,startTs:n,endTs:i})})]}),a.jsxs("div",{className:"flex items-center justify-between mt-1.5 sm:mt-2",style:{minHeight:x},children:[a.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 type-data-xs pl-2 sm:pl-11",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("div",{className:"w-3 sm:w-4 h-0.5",style:{backgroundColor:g}}),a.jsx("span",{className:"text-fg-secondary",children:"RX"})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("div",{className:"w-3 sm:w-4 h-0.5",style:{backgroundColor:f}}),a.jsx("span",{className:"text-fg-secondary",children:"TX"})]}),a.jsxs("div",{className:"hidden sm:flex items-center gap-1.5",children:[a.jsx("div",{className:"w-4 h-0.5",style:{backgroundColor:y}}),a.jsx("span",{className:"text-fg-secondary",children:"Avg"})]})]}),a.jsxs("div",{className:"flex flex-wrap gap-4 sm:gap-8",children:[a.jsxs("div",{className:"flex items-end gap-2",children:[a.jsx("div",{className:"type-data-xl text-fg-primary",children:M.rx}),a.jsx(u,{color:"zinc",className:"mb-0.5 sm:mb-1",children:"RX"})]}),a.jsxs("div",{className:"flex items-end gap-2",children:[a.jsx("div",{className:"type-data-xl text-fg-primary",children:M.tx}),a.jsx(u,{color:"zinc",className:"mb-0.5 sm:mb-1",children:"TX"})]})]})]})]})}const Ie=h,Ge=new class{constructor(){t(this,"worker",null),t(this,"listeners",new Set),t(this,"currentResult",null),t(this,"isComputing",!1),t(this,"debounceTimer",null),t(this,"debounceMs",250),t(this,"lastCacheKey",null)}ensureWorker(){if(this.worker)return this.worker;if("undefined"==typeof window)return null;try{this.worker=new Worker(new URL("/assets/bucketing.worker-CgIH5X6q.js",import.meta.url),{type:"module"}),this.worker.onmessage=e=>{this.handleWorkerMessage(e.data)},this.worker.onerror=e=>{this.isComputing=!1,this.notifyListeners()}}catch(e){}return this.worker}handleWorkerMessage(e){if(this.isComputing=!1,"error"===e.type)return this.currentResult=null,void this.notifyListeners();const t=e.payload;this.currentResult={points:t.points,rawValues:t.rawValues,packetTypes:t.packetTypes,timestamps:t.timestamps,count:t.count,minTime:t.minTime,maxTime:t.maxTime,minValue:t.minValue,maxValue:t.maxValue,rawMinValue:t.rawMinValue,rawMaxValue:t.rawMaxValue,unit:"%",stats:{p5:t.p5,p50:t.p50,p95:t.p95,uniqueValues:t.uniqueValues,topValues:t.topValues}},this.notifyListeners()}notifyListeners(){for(const t of this.listeners)try{t(this.currentResult,this.isComputing)}catch(e){}}isCacheHit(e){return!(!this.lastCacheKey||!this.currentResult)&&this.lastCacheKey.startTs===e.startTs&&this.lastCacheKey.endTs===e.endTs&&this.lastCacheKey.mode===e.mode&&this.lastCacheKey.packetCount===e.packetCount}compute(e,t,s,a,n){if(0===e.length||!n)return this.currentResult=null,void this.notifyListeners();const i={startTs:t,endTs:s,mode:a,packetCount:e.length};this.isCacheHit(i)||(this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.debounceTimer=null,this.computeInternal(e,t,s,a,n,i)},this.debounceMs))}computeInternal(e,t,s,a,n,i){const l=this.ensureWorker();if(!l)return;const r=e.length,o=new Float64Array(r),m=new Float64Array(r),u=new Uint16Array(r),h=new Uint8Array(r),x={spreadingFactor:n.sf,bandwidthHz:n.bw,codingRate:n.cr,preambleLength:n.preamble};for(let g=0;g<r;g++){const t=e[g];o[g]=t.timestamp??0,h[g]=255&(t.type??t.payload_type??255),u[g]=Math.min(c(t),65535),m[g]="airtime"===a?d(t,x):1}this.isComputing=!0,this.lastCacheKey=i,this.notifyListeners();const p={type:"compute",payload:{timestamps:o,airtimeMs:m,byteSizes:u,packetTypes:h,startTs:t,endTs:s,mode:a}};l.postMessage(p,[o.buffer,m.buffer,u.buffer,h.buffer])}getResult(){return this.currentResult}isWorking(){return this.isComputing}subscribe(e){return this.listeners.add(e),e(this.currentResult,this.isComputing),()=>{this.listeners.delete(e)}}clear(){this.currentResult=null,this.lastCacheKey=null,this.notifyListeners()}terminate(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.worker&&(this.worker.terminate(),this.worker=null),this.listeners.clear()}};function Ve({mode:e,packets:t,startTs:n,endTs:i,radioConfig:l,sortedTypes:r,aggregateShares:o,noiseFloorAnomalies:c,showNoiseFloorOverlay:m,overlayOpacity:u=.5,startLabel:h,endLabel:p,yAxisPad:g=28,lockedYMax:f,legendMinH:y,dotSize:b,dotOpacity:j}){const[v,N]=s.useState(null),[k,w]=s.useState(null),M=s.useMemo(()=>(i-n)/3600,[n,i]),S=s.useCallback(e=>{w(e)},[]),C=function(e,t,a,n,i){const[l,r]=s.useState(()=>Ge.getResult());return s.useEffect(()=>Ge.subscribe(e=>{r(e)}),[]),s.useEffect(()=>{Ge.compute(e,t,a,n,i)},[e,t,a,n,i]),l}(t,n,i,"share"===e?"share":"airtime",l),[T,A]=s.useState(null),F=s.useCallback((e,t)=>{N(e),A(t??null)},[]),P=s.useMemo(()=>{if(null===T||!C||0===C.count)return null;const e=C.maxTime-C.minTime||1,t=C.minTime+T*e;let s;s=M>=168?75:M>=72?35:M>=24?15:M>=3?10:5;const a=60*s/2;return{start:t-a,end:t+a}},[T,C,M]),L=s.useMemo(()=>P?new Date((P.start+P.end)/2*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}):null,[P]),R=s.useMemo(()=>{if(null===v||!P)return null;const s=L??"",{start:a,end:n}=P,i=t.filter(e=>e.timestamp>=a&&e.timestamp<n);if(0===i.length)return{timestamp:(a+n)/2,timeLabel:s,items:r.map(e=>({key:e.key,label:e.label,value:0,color:Ie(e.typeNum)}))};const o=new Map,c=new Map;let m=0,u=0;for(const e of i){const t=`TYPE_${e.type??e.payload_type??-1}`;if(o.set(t,(o.get(t)??0)+1),m++,l){const s=d(e,{spreadingFactor:l.sf,bandwidthHz:l.bw,codingRate:l.cr,preambleLength:l.preamble});c.set(t,(c.get(t)??0)+s),u+=s}}const h=r.map(t=>{let s;return s="airtime"===e?u>0?(c.get(t.key)??0)/u:0:m>0?(o.get(t.key)??0)/m:0,{key:t.key,label:t.label,value:s,color:Ie(t.typeNum)}});return{timestamp:(a+n)/2,timeLabel:s,items:h}},[v,P,L,t,r,e,l]);return C&&0!==C.count?a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:"flex-1 min-h-0 relative",children:[a.jsx("div",{className:"absolute inset-0 rounded-lg overflow-hidden",children:a.jsx(x,{scatterData:C,yAxisMode:"share"===e?"share":"airtime",onHover:F,noiseFloorAnomalies:c,showNoiseFloorOverlay:m,overlayOpacity:u,highlightedType:k,timeRangeHours:M,yAxisMaxOverride:f,dotSize:b,dotOpacity:j})}),L&&a.jsx("div",{className:"absolute top-1 right-1 px-2 py-0.5 bg-elevated/90 rounded type-data-xs text-sys-indigo pointer-events-none",children:L}),h&&p&&a.jsxs("div",{className:"absolute bottom-0.5 left-0 right-0 flex justify-between pointer-events-none type-data-xs text-fg-muted/60",style:{paddingLeft:g},children:[a.jsx("span",{children:h}),a.jsx("span",{children:p})]})]}),a.jsx("div",{style:{minHeight:y},children:a.jsx(De,{sortedTypes:r,highlightedType:k,onTypeHover:S,aggregateShares:o,hoverData:R})})]}):a.jsxs("div",{className:"h-full flex items-center justify-center text-fg-muted",children:[a.jsx(V,{className:"w-6 h-6 mr-2 opacity-50"}),a.jsx("span",{children:"No packet data available"})]})}function Ke({mode:e,onChange:t}){return a.jsxs("div",{className:"toggle-group toggle-group-sm",children:[a.jsx("button",{onClick:()=>t("share"),className:"toggle-group-item "+("share"===e?"active":""),children:"Total"}),a.jsx("button",{onClick:()=>t("airtime"),className:"toggle-group-item "+("airtime"===e?"active":""),children:"Airtime"})]})}function Xe({smoothing:e,onChange:t}){return a.jsxs("div",{className:"toggle-group toggle-group-sm",children:[a.jsx("button",{onClick:()=>t("stats"),className:"toggle-group-item "+("stats"===e?"active":""),title:"Statistics view (scatter plot)",children:a.jsx(we,{className:"w-3.5 h-3.5"})}),a.jsx("button",{onClick:()=>t("trend"),className:"toggle-group-item "+("trend"===e?"active":""),title:"Trend line chart",children:a.jsx(ve,{className:"w-3.5 h-3.5"})}),a.jsx("button",{onClick:()=>t("ema"),className:"toggle-group-item "+("ema"===e?"active":""),title:"Stacked area (moderate smoothing)",children:a.jsx(V,{className:"w-3.5 h-3.5"})}),a.jsx("button",{onClick:()=>t("ultra"),className:"toggle-group-item "+("ultra"===e?"active":""),title:"Stacked area (heavy smoothing)",children:a.jsx(Te,{className:"w-3.5 h-3.5"})}),a.jsx("button",{onClick:()=>t("mosaic"),className:"toggle-group-item "+("mosaic"===e?"active":""),title:"Mosaic view (treemap)",children:a.jsx(ke,{className:"w-3.5 h-3.5"})})]})}function Ye({enabled:e,onChange:t,anomalyCount:s=0,showTuning:n=!1,onTuningChange:i}){return a.jsxs("div",{className:"relative inline-flex items-center gap-1",children:[e&&i&&a.jsx("button",{onClick:()=>i(!n),className:"toggle-group toggle-group-sm "+(n?"active":""),title:n?"Hide tuning panel":"Show tuning panel",children:a.jsx("span",{className:"toggle-group-item "+(n?"active":""),children:a.jsx(be,{className:"w-3.5 h-3.5"})})}),a.jsx("button",{onClick:()=>t(!e),className:"toggle-group toggle-group-sm "+(e?"active":""),title:e?"Hide noise floor anomalies":"Show noise floor anomalies",children:a.jsx("span",{className:"toggle-group-item "+(e?"active":""),children:a.jsx(se,{className:"w-3.5 h-3.5"})})}),s>0&&a.jsx("span",{className:"absolute -top-2 -right-2 min-w-[18px] h-[18px] px-1 rounded-full bg-sys-red text-white text-xs font-bold flex items-center justify-center pointer-events-none z-10",children:s>99?"99+":s})]})}const Ue={sf:10,bw:25e4,cr:5,preamble:8};function Je(e,t){const s=new Date(1e3*e),a=e=>e.toString().padStart(2,"0"),n=`${a(s.getHours())}:${a(s.getMinutes())}`;return t<=24?n:`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][s.getMonth()]} ${s.getDate()} ${n}`}function Qe(e){return r[e]??`TYPE_${e.toString(16).toUpperCase()}`}function Ze(e,t,s,a){const n=2*a+1;let i=0;for(let l=0;l<=a;l++)i+=e[Math.min(l,s-1)];for(let l=0;l<a;l++)i+=e[0];for(let l=0;l<s;l++){t[l]=i/n;const r=l-a,o=l+a+1;i-=e[Math.max(0,Math.min(r,s-1))],i+=e[Math.max(0,Math.min(o,s-1))]}}const et={ema:1800,ultra:14400},tt={ema:"sma",ultra:"gaussian"};function st(e,t,s){const a=et[e],n=tt[e]??"sma";if(!a)return{sigma:0,window:1,handleSize:0};let i=Math.round(a/t);i=Math.max(3,Math.min(i,Math.floor(s/3))),i%2==0&&(i+=1);const l="gaussian"===n?Math.ceil(i*Math.sqrt(4/12)*3):Math.ceil(i/2);return"gaussian"===n?{sigma:i*Math.sqrt(4/12),window:i,handleSize:l}:{sigma:0,window:i,handleSize:l}}const at=s.memo(function({packets:e,allPackets:t,startTs:n,endTs:i,parentStartTs:r,parentEndTs:o,bucketCount:m,radioConfig:u=Ue,mode:h="share",smoothing:x="stats",noiseFloorAnomalies:f=null,showNoiseFloorOverlay:y=!1,overlayOpacity:b=.5,dotSize:j,dotOpacity:v}){const N=p(),[k,w]=s.useState(null),[M,S]=s.useState(null),[C,T]=s.useState([]),A=s.useRef(null),F=s.useRef(0);s.useEffect(()=>{const t=Math.abs(e.length-F.current);if(0===t&&C.length>0)return;A.current&&clearTimeout(A.current);const s=t>100?50:500;return A.current=setTimeout(()=>{F.current=e.length,T(e)},s),()=>{A.current&&clearTimeout(A.current)}},[e,C.length]);const P=s.useMemo(()=>function(e,t){const s=new Map;for(const n of e){const e=n.type??n.payload_type??-1,a=d(n,{spreadingFactor:t.sf,bandwidthHz:t.bw,codingRate:t.cr,preambleLength:t.preamble}),i=s.get(e)??{count:0,airtime:0};s.set(e,{count:i.count+1,airtime:i.airtime+a})}const a=[];for(const[n,i]of s)a.push({typeNum:n,key:`TYPE_${n}`,label:Qe(n),totalCount:i.count,totalAirtime:i.airtime});return a.sort((e,t)=>t.totalCount-e.totalCount)}(C,u),[C,u]),L=s.useMemo(()=>{if("ema"!==x&&"ultra"!==x)return 0;const e=(i-n)/m,{handleSize:t}=st(x,e,m);return t},[x,n,i,m]),R=s.useMemo(()=>function(e,t,s,a,n,i,l=0){const r=s-t,o=r/a,c=1e3*o,m=r/3600,u=t-l*o,h=s+l*o,x=a+2*l,p=[];for(let d=0;d<x;d++){const e=u+d*o,t=new Date(1e3*e),s={timestamp:e,time:m>24?t.toLocaleDateString([],{weekday:"short",hour:"2-digit",minute:"2-digit",hour12:!1}):t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),counts:{},shares:{},airtimes:{},total:0,totalAirtime:0,bucketDurationMs:c};for(const a of i)s.counts[a.key]=0,s.airtimes[a.key]=0;p.push(s)}for(const g of e){const e=g.timestamp;if(e<u||e>=h)continue;const t=Math.min(Math.floor((e-u)/o),x-1),s=`TYPE_${g.type??g.payload_type??-1}`;p[t].counts[s]=(p[t].counts[s]??0)+1,p[t].total++;const a=d(g,{spreadingFactor:n.sf,bandwidthHz:n.bw,codingRate:n.cr,preambleLength:n.preamble});p[t].airtimes[s]=(p[t].airtimes[s]??0)+a,p[t].totalAirtime+=a}for(const d of p)for(const e of i)d.shares[e.key]=d.total>0?d.counts[e.key]/d.total*100:0;return{buckets:p,visibleStart:l,visibleEnd:l+a}}(C,n,i,m,u,P,L),[C,n,i,m,u,P,L]),D=s.useMemo(()=>P.reduce((e,t)=>e+t.totalCount,0),[P]),$=s.useMemo(()=>P.reduce((e,t)=>e+t.totalAirtime,0),[P]),{sortedTypes:z,aggregateShares:E}=s.useMemo(()=>{const e=new Map,t="share"===h?D:$;if(t>0)for(const s of P){const a="share"===h?s.totalCount:s.totalAirtime;e.set(s.key,a/t)}return{sortedTypes:[...P].sort((t,s)=>(e.get(s.key)??0)-(e.get(t.key)??0)),aggregateShares:e}},[P,D,$,h]),_=s.useMemo(()=>function(e,t,s,a="ultra",n,i,l){var r;const{buckets:o,visibleStart:c,visibleEnd:d}=e,m=o.length,u=s.length,h=d-c;if(0===m||0===u)return[];const x=l&&void 0!==n&&void 0!==i?(i-n)/l:(null==(r=o[0])?void 0:r.bucketDurationMs)?o[0].bucketDurationMs/1e3:240,p=Array.from({length:u},()=>new Array(m).fill(0));for(let N=0;N<m;N++){const e=o[N];if("share"===t){if(e.total>0)for(let t=0;t<u;t++)p[t][N]=(e.counts[s[t].key]??0)/e.total}else{let t=0;for(let a=0;a<u;a++)t+=e.airtimes[s[a].key]??0;if(t>0)for(let a=0;a<u;a++)p[a][N]=(e.airtimes[s[a].key]??0)/t}}const{sigma:g,window:f}=st(a,x,h);let y;y=g>0?p.map(e=>function(e,t){const s=e.length;if(0===s)return[];if(t<.5)return[...e];const a=Math.sqrt(12*t*t/3+1);let n=Math.floor(a);n%2==0&&n--;const i=n+2,l=(12*t*t-3*n*n-12*n-9)/(-4*n-4),r=Math.round(l),o=[r>0?n:i,r>1?n:i,r>2?n:i];let c=new Float32Array(e);const d=new Float32Array(s);for(const m of o){Ze(c,d,s,(m-1)/2);const e=c;c=d,d.set(e)}return Array.from(c)}(e,g)):p.map(e=>function(e,t){if(0===e.length)return[];if(t<=1)return[...e];const s=e.length,a=new Float32Array(s),n=Math.floor(t/2);let i=0,l=0;for(let r=0;r<=Math.min(n,s-1);r++)i+=e[r],l++;for(let r=0;r<s;r++){a[r]=i/l;const t=r-n,o=r+n+1;t>=0&&(i-=e[t],l--),o<s&&(i+=e[o],l++)}return Array.from(a)}(e,f));for(let N=0;N<m;N++){let e=0;for(let t=0;t<u;t++)y[t][N]=Math.max(0,y[t][N]),e+=y[t][N];if(e>0){const t=1/e;for(let e=0;e<u;e++)y[e][N]*=t}}const b=h>360?Math.ceil(h/360):1,j=Math.ceil(h/b),v=[];for(let N=0;N<j;N++){const e=c+N*b,t=Math.min(c+(N+1)*b,d),a=t-e,n=new Array(u).fill(0);for(let s=e;s<t;s++)for(let e=0;e<u;e++)n[e]+=y[e][s];for(let s=0;s<u;s++)n[s]/=a;let i=0;for(let s=0;s<u;s++)i+=n[s];if(i>0){const e=1/i;for(let t=0;t<u;t++)n[t]*=e}const l={timestamp:o[e].timestamp,time:o[e].time};for(let r=0;r<u;r++)l[s[r].key]=n[r];v.push(l)}return v}(R,h,z,x,n,i,m),[R,h,z,x,n,i,m]),H=s.useCallback(e=>w(e),[]),B=s.useCallback(e=>S(e),[]),O=s.useCallback(e=>w(e),[]),q=s.useMemo(()=>{if(null===M||!_[M])return null;const e=_[M];return{timestamp:e.timestamp,timeLabel:e.time,items:z.map(t=>({key:t.key,label:t.label,value:e[t.key]??0,color:l(t.typeNum)}))}},[M,_,z]),W=s.useMemo(()=>({timestamps:_.map(e=>e.timestamp),series:z.map(e=>({key:e.key,label:e.label,color:l(e.typeNum),values:_.map(t=>t[e.key]??0)}))}),[_,z]),I=t&&void 0!==r&&void 0!==o&&(n!==r||i!==o),G=s.useMemo(()=>{if(I&&t&&void 0!==r&&void 0!==o)return function(e,t,s,a,n){const i=Math.max(1,Math.ceil((s-t)/300));if("airtime"===a){const a=new Float64Array(i);for(const r of e){const e=r.timestamp;e<t||e>=s||(a[Math.min(Math.floor((e-t)/300),i-1)]+=d(r,{spreadingFactor:n.sf,bandwidthHz:n.bw,codingRate:n.cr,preambleLength:n.preamble}))}let l=0;for(let e=0;e<i;e++){const t=a[e]/3e5*100;t>l&&(l=t)}return Math.max(1,Math.ceil(1.1*l))}{let a=0;for(const n of e){const e=n.timestamp;if(e<t||e>=s)continue;const i=c(n);i>a&&(a=i)}return a<=200?200:50*Math.ceil(1.1*a/50)}}(t,r,o,h,u)},[I,t,r,o,h,u]);if(0===C.length)return 0===e.length?a.jsxs("div",{className:"h-full flex items-center justify-center text-fg-muted",children:[a.jsx(V,{className:"w-6 h-6 mr-2 opacity-50"}),a.jsx("span",{children:"No packet data available"})]}):null;if("mosaic"===x)return a.jsx(Oe,{sortedTypes:z,aggregateShares:E,mode:h});const K=(i-n)/3600,X=Je(n,K),Y=Je(i,K);return"stats"===x?a.jsx(Ve,{mode:h,packets:C,startTs:n,endTs:i,radioConfig:u,sortedTypes:z,aggregateShares:E,noiseFloorAnomalies:f,showNoiseFloorOverlay:y,overlayOpacity:b,startLabel:X,endLabel:Y,yAxisPad:28,lockedYMax:G,legendMinH:80,dotSize:j,dotOpacity:v}):"trend"===x?a.jsx(We,{packets:C,mode:h,startTs:n,endTs:i,radioConfig:u,bucketCount:m,lockedYMax:G,legendMinH:80}):a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:"flex-1 min-h-0 relative",children:[a.jsx("div",{className:"absolute inset-0 rounded-lg overflow-hidden",children:a.jsx(g,{timestamps:W.timestamps,series:W.series,highlightedKey:k,cursorColor:N.cursor,onHover:B,onSeriesHover:O,overlayLine:null,startTs:n,endTs:i})}),a.jsxs("div",{className:"absolute bottom-0.5 left-0 right-0 flex justify-between pointer-events-none type-data-xs text-fg-muted/60",style:{paddingLeft:32},children:[a.jsx("span",{children:X}),a.jsx("span",{children:Y})]})]}),a.jsx("div",{style:{minHeight:80},children:a.jsx(De,{sortedTypes:z,highlightedType:k,onTypeHover:H,aggregateShares:E,hoverData:q})})]})}),nt={"1x":1,"2x":2,"4x":4,"8x":8,"16x":16,"36x":36},it=[1,5,10,25,50,100,150],lt=22.5*Math.PI/180,rt=Math.sin(lt),ot=Math.cos(lt);function ct(e,t,s,a){const n=Math.PI/180,i=(a-t)*n,l=e*n,r=s*n,o=Math.sin(i)*Math.cos(r),c=Math.cos(l)*Math.sin(r)-Math.sin(l)*Math.cos(r)*Math.cos(i);return(180*Math.atan2(o,c)/Math.PI+360)%360}function dt(e,t,s,a){const n=Math.PI/180,i=(s-e)*n,l=(a-t)*n,r=Math.sin(i/2)**2+Math.cos(e*n)*Math.cos(s*n)*Math.sin(l/2)**2;return 12742*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))}const mt=[{min:10,label:"Excellent"},{min:7,label:"Very Good"},{min:4,label:"Good"},{min:1,label:"Fair+"},{min:-2,label:"Fair"},{min:-5,label:"Fair-"},{min:-8,label:"Poor"},{min:-11,label:"Bad"},{min:-1/0,label:"Critical"}];function ut(e,t){return t[N(e)]||"#808080"}const ht=s.memo(function({neighbors:e,quickNeighbors:t,localLat:n,localLon:i,onStatsChange:l,title:r,badge:c,stats:d}){const[m,h]=s.useState(null),[x,p]=s.useState(new Set),[g,N]=s.useState({width:0,height:0}),[k,w]=s.useState("1x"),[M,S]=s.useState(1),C=s.useRef(null),T=s.useRef({}),A=s.useRef(null),F=s.useRef(M);F.current=M;const P=f(),L=y(),R=b(),D=j(),$=o(),z=D?R.primary:R.secondary,E=D?.15:.4,_=D?.08:.25,H=D?$.blue:R.primary;s.useEffect(()=>{const e=A.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e){const{width:e,height:s}=t.contentRect;e>0&&s>0&&N({width:e,height:s})}});t.observe(e);const s=e.getBoundingClientRect();return s.width>0&&s.height>0&&N({width:s.width,height:s.height}),()=>t.disconnect()},[]);const B=s.useMemo(()=>{const e=new Set;if(t)for(const s of t)e.add(s.hash);return e},[t]),O=s.useMemo(()=>{const e=new Map;if(t)for(const s of t)e.set(s.hash,{snr:s.avgSnr,rssi:s.avgRssi});return e},[t]),{processedNeighbors:q,maxDistance:W,totalNeighbors:I,zeroHopCount:G}=s.useMemo(()=>{const t=[];for(const[a,l]of Object.entries(e)){if(!l.latitude||!l.longitude||0===l.latitude||0===l.longitude)continue;if(!B.has(a))continue;const e=ct(n,i,l.latitude,l.longitude),s=dt(n,i,l.latitude,l.longitude),r=O.get(a);t.push({hash:a.slice(0,8),name:l.node_name||l.name||"Unknown",snr:(null==r?void 0:r.snr)??l.snr??null,rssi:(null==r?void 0:r.rssi)??l.rssi??null,bearing:e,distance:s,normalizedDistance:0,lastSeen:l.last_seen,isZeroHop:!0})}const s=1.08*(t.length>0?Math.max(...t.map(e=>e.distance)):0);return t.sort((e,t)=>(e.snr??-1/0)-(t.snr??-1/0)),{processedNeighbors:t,maxDistance:s,totalNeighbors:t.length,zeroHopCount:t.length}},[e,n,i,B,O]);s.useEffect(()=>{null==l||l({zeroHopCount:G,totalCount:I,maxDistanceKm:W})},[G,I,W]),s.useEffect(()=>{const e=nt[k],t=F.current;C.current&&cancelAnimationFrame(C.current);const s=performance.now(),a=n=>{const i=n-s,l=Math.min(i/400,1),r=U(l);S(t+(e-t)*r),C.current=l<1?requestAnimationFrame(a):null};return C.current=requestAnimationFrame(a),()=>{C.current&&cancelAnimationFrame(C.current)}},[k]);const V=W/M,K=s.useMemo(()=>it.filter(e=>e<=1.1*V),[V]);s.useEffect(()=>{const e=[];for(const s of q){const t=T.current[s.hash];void 0!==t&&t!==s.lastSeen&&e.push(s.hash),T.current[s.hash]=s.lastSeen}if(0===e.length)return;queueMicrotask(()=>{p(t=>new Set([...t,...e]))});const t=setTimeout(()=>{p(t=>{const s=new Set(t);return e.forEach(e=>s.delete(e)),s})},600);return()=>clearTimeout(t)},[q]);const X=0!==n&&0!==i,J=s.useMemo(()=>{const{width:e,height:t}=g,s=e/2,a=t/2,n=Math.min(e,t),i=Math.max(10,n/2-6);return{width:e,height:t,centerX:s,centerY:a,radius:Math.max(10,i-8),labelRadius:i}},[g]),{width:Q,height:Z,centerX:ee,centerY:te,radius:se,labelRadius:ae}=J,ne=s.useId(),ie=s.useCallback((e,t)=>{const s=e*Math.PI/180;return{x:ee+se*t*Math.sin(s),y:te-se*t*Math.cos(s)}},[ee,te,se]),le=s.useCallback(e=>{const t={N:0,NE:45,E:90,SE:135,S:180,SW:225,W:270,NW:315}[e]*Math.PI/180;return{x:ee+ae*Math.sin(t),y:te-ae*Math.cos(t)}},[ee,te,ae]),re=s.useCallback(e=>{h(e)},[]),oe=s.useCallback(e=>{w(e)},[]),ce=s.useCallback(e=>W<=0?0:e/W*M,[W,M]),de=e=>`${e}km`,me=s.useMemo(()=>{const e=[{x:ee,y:te-ae},{x:ee+ae*Math.SQRT1_2,y:te-ae*Math.SQRT1_2}],t=K.map(e=>{const t=e/W*M;return{km:e,scale:t,lx:ee+se*t*rt,ly:te-se*t*ot}}).filter(e=>e.scale<=1.05&&e.scale>=.02).sort((e,t)=>t.km-e.km),s=[];for(const a of t){const t=s.some(e=>{const t=e.lx-a.lx,s=e.ly-a.ly;return Math.sqrt(t*t+s*s)<28}),n=e.some(e=>{const t=e.x-a.lx,s=e.y-a.ly;return Math.sqrt(t*t+s*s)<28});t||n||s.push(a)}return s},[K,W,M,ee,te,se,ae]),ue=g.width>0&&g.height>0;return X?0===I?a.jsxs("div",{ref:A,className:"flex flex-col items-center justify-center h-full text-fg-secondary",children:[a.jsx(Y,{className:"w-8 h-8 mb-2 opacity-50"}),a.jsx("p",{children:"No nodes with location data"})]}):a.jsxs("div",{className:"flex h-full w-full overflow-visible",children:[a.jsxs("div",{ref:A,className:"relative flex-1 min-w-0 h-full overflow-visible -ml-4 sm:-ml-5",children:[ue&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"absolute neomorphic-outer-soft",style:{left:ee-se-8-4,top:te-se-8-4,width:2*(se+8)+8,height:2*(se+8)+8,borderRadius:"50%",padding:4,boxSizing:"border-box"}}),a.jsxs("svg",{width:Q,height:Z,className:"absolute inset-0 z-0",style:{overflow:"visible"},children:[a.jsxs("defs",{children:[a.jsx("style",{children:"\n                @keyframes neighbor-blink-scale {\n                  0%, 100% {\n                    transform: scale(1);\n                    opacity: 0;\n                  }\n                  50% {\n                    transform: scale(1.3);\n                    opacity: 0.8;\n                  }\n                }\n                .neighbor-blink-ring {\n                  transform-origin: center;\n                  animation: neighbor-blink-scale 600ms ease-out forwards;\n                }\n              "}),a.jsx("clipPath",{id:ne,children:a.jsx("circle",{cx:ee,cy:te,r:se})})]}),(()=>{const e=se+8+12,t=D?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.15)",s=D?"rgba(59, 130, 246, 0.4)":"rgba(59, 130, 246, 0.5)",n=[45,135,225,315];return a.jsxs("g",{className:"radar-frame","aria-hidden":"true",children:[a.jsx("circle",{cx:ee,cy:te,r:e,fill:"none",stroke:t,strokeWidth:1,strokeDasharray:"2 6"}),n.map(t=>{const n=t*Math.PI/180,i=Math.cos(n),l=Math.sin(n),r=e+4,o=e+4+16,c=ee+r*l,d=te-r*i,m=ee+o*l,u=te-o*i;return a.jsxs("g",{children:[a.jsx("line",{x1:c,y1:d,x2:m,y2:u,stroke:s,strokeWidth:1}),a.jsx("line",{x1:m-4*i,y1:u-4*l,x2:m+4*i,y2:u+4*l,stroke:s,strokeWidth:1})]},`corner-${t}`)}),[0,90,180,270].map(s=>{const n=s*Math.PI/180,i=ee+(e-6)*Math.sin(n),l=te-(e-6)*Math.cos(n),r=ee+(e+2)*Math.sin(n),o=te-(e+2)*Math.cos(n);return a.jsx("line",{x1:i,y1:l,x2:r,y2:o,stroke:t,strokeWidth:1},`tick-cardinal-${s}`)}),n.map(s=>{const n=s*Math.PI/180,i=ee+(e-4)*Math.sin(n),l=te-(e-4)*Math.cos(n),r=ee+(e+1)*Math.sin(n),o=te-(e+1)*Math.cos(n);return a.jsx("line",{x1:i,y1:l,x2:r,y2:o,stroke:t,strokeWidth:1},`tick-intercardinal-${s}`)})]})})(),K.map(e=>{const t=ce(e);if(t>1.05||t<.02)return null;const s=me.some(t=>t.km===e),n=ee+se*t*rt,i=te-se*t*ot;return a.jsxs("g",{children:[a.jsx("circle",{cx:ee,cy:te,r:se*t,fill:"none",stroke:z,strokeOpacity:E,strokeWidth:1}),s&&a.jsx("text",{x:n+4,y:i-2,textAnchor:"start",dominantBaseline:"auto",fill:R.secondary,fontSize:10,fontFamily:v,children:de(e)})]},`ring-${e}`)}),["N","E","S","W"].map(e=>{const t={N:0,E:90,S:180,W:270}[e]*Math.PI/180;return a.jsx("line",{x1:ee,y1:te,x2:ee+se*Math.sin(t),y2:te-se*Math.cos(t),stroke:z,strokeOpacity:E,strokeWidth:1,strokeDasharray:"4 4"},e)}),["NE","SE","SW","NW"].map(e=>{const t={NE:45,SE:135,SW:225,NW:315}[e]*Math.PI/180;return a.jsx("line",{x1:ee,y1:te,x2:ee+se*Math.sin(t),y2:te-se*Math.cos(t),stroke:z,strokeOpacity:_,strokeWidth:1,strokeDasharray:"4 4"},`diag-${e}`)}),["N","E","S","W"].map(e=>{const t=le(e),s="E"===e?"end":"W"===e?"start":"middle",n="N"===e?"hanging":"S"===e?"auto":"middle";return a.jsx("text",{x:t.x,y:t.y,textAnchor:s,dominantBaseline:n,fill:H,fontSize:10,fontWeight:700,fontFamily:v,"aria-hidden":"true",children:e},e)}),["NE","SE","SW","NW"].map(e=>{const t=le(e),s="NE"===e||"SE"===e?"end":"start",n="NE"===e||"NW"===e?"hanging":"auto";return a.jsx("text",{x:t.x,y:t.y,textAnchor:s,dominantBaseline:n,fill:H,fontSize:9,fontWeight:600,fontFamily:v,"aria-hidden":"true",children:e},e)}),a.jsx("circle",{cx:ee,cy:te,r:5,fill:L.chart6,stroke:D?"rgba(255,255,255,0.3)":"rgba(0,0,0,0.2)",strokeWidth:1,role:"img","aria-label":"Local node"}),a.jsx("g",{clipPath:`url(#${ne})`,children:q.map(e=>{const t=W>0?e.distance/W*M:0;if(t>1)return null;const{x:s,y:n}=ie(e.bearing,t),i=null!==e.snr?ut(e.snr,P):"#808080",l=(null==m?void 0:m.hash)===e.hash,r=x.has(e.hash);return a.jsxs("g",{role:"img","aria-label":`${e.name}: ${e.distance.toFixed(1)}km ${e.bearing.toFixed(0)}°`,children:[r&&a.jsx("circle",{cx:s,cy:n,r:10.5,fill:"none",stroke:D?"rgba(255,255,255,0.9)":"rgba(0,0,0,0.7)",strokeWidth:2,className:"neighbor-blink-ring"}),l&&a.jsx("circle",{cx:s,cy:n,r:10.5,fill:i,opacity:.3}),a.jsx("circle",{cx:s,cy:n,r:l?7:5,fill:i,stroke:D?"rgba(0,0,0,0.5)":"rgba(0,0,0,0.25)",strokeWidth:1,style:{cursor:"pointer",transition:"r 0.15s"},onMouseEnter:()=>re(e),onMouseLeave:()=>re(null)})]},e.hash)})})]})]}),m&&a.jsxs("div",{className:"absolute bg-tooltip-bg border border-edge-subtle rounded-lg px-3 py-2 text-sm pointer-events-none z-10 shadow-xl",style:{left:"50%",bottom:8,transform:"translateX(-50%)"},children:[a.jsx("div",{className:"font-medium text-fg-primary",children:m.name}),a.jsx("div",{className:"type-data-xs text-fg-secondary",children:m.hash}),null!==m.snr?a.jsx("div",{className:"flex gap-3 mt-1 text-xs",children:a.jsxs("span",{children:[a.jsx("span",{className:"text-fg-secondary",children:"SNR:"})," ",a.jsxs("span",{className:"tabular-nums",style:{color:ut(m.snr,P)},children:[m.snr.toFixed(1)," dB"]}),a.jsxs("span",{className:"text-fg-secondary ml-1",children:["(",(he=m.snr,(null==(xe=mt.find(e=>he>=e.min))?void 0:xe.label)??"Critical"),")"]})]})}):a.jsx("div",{className:"text-xs text-fg-secondary mt-1",children:"No SNR data"}),a.jsxs("div",{className:"flex gap-3 text-xs",children:[a.jsxs("span",{children:[a.jsx("span",{className:"text-fg-secondary",children:"Distance:"})," ",a.jsxs("span",{className:"tabular-nums text-fg-primary",children:[m.distance.toFixed(2)," km"]})]}),a.jsxs("span",{children:[a.jsx("span",{className:"text-fg-secondary",children:"Bearing:"})," ",a.jsxs("span",{className:"tabular-nums text-fg-primary",children:[m.bearing.toFixed(0),"°"]})]})]})]})]}),a.jsxs("div",{className:"flex flex-col gap-1 px-2 py-2 flex-shrink-0 neomorphic-outer-soft rounded-l-[12px] rounded-r-none self-stretch",children:[r&&a.jsxs("div",{className:"flex flex-col items-center gap-1 pb-2 border-b border-edge-subtle mb-1",children:[a.jsx("span",{className:"icon-md flex items-center justify-center text-icon-card-title",children:a.jsx(Y,{className:"w-4 h-4"})}),a.jsx("span",{className:"type-micro text-center text-[10px] leading-tight",children:r}),c&&a.jsx(u,{color:"zinc",children:c})]}),a.jsx("div",{className:"flex flex-col gap-1 flex-1",role:"group","aria-label":"Zoom level",children:["1x","2x","4x","8x","16x","36x"].map(e=>a.jsx("button",{onClick:()=>oe(e),"aria-pressed":k===e,className:"flex flex-1 items-center justify-center min-w-[44px] sm:min-w-[32px] text-xs font-medium radius-inner transition-colors "+(k===e?"bg-sys-blue/20 text-sys-blue":"bg-subtle-fill/80 text-fg-secondary hover:bg-subtle-fill-strong hover:text-fg-primary"),children:e},e))})]})]}):a.jsxs("div",{ref:A,className:"flex flex-col items-center justify-center h-full text-fg-secondary",children:[a.jsx(Y,{className:"w-8 h-8 mb-2 opacity-50"}),a.jsx("p",{children:"Local node coordinates not configured"}),a.jsx("p",{className:"text-xs mt-1",children:"Set latitude/longitude in config to enable"})]});var he,xe}),xt={repeater:"var(--sys-blue)",companion:"var(--sys-cyan)",room_server:"var(--sys-indigo)"};function pt(e){if(e.contact_type){const t=e.contact_type.toLowerCase();if("repeater"===t||"rep"===t)return"repeater";if("room server"===t||"room_server"===t||"room"===t||"server"===t)return"room_server";if("companion"===t||"client"===t||"cli"===t)return"companion"}return e.is_repeater?"repeater":"companion"}const gt=s.memo(function({neighbors:e}){const t=s.useMemo(()=>{const t={repeater:0,companion:0,room_server:0};for(const a of Object.values(e)){const e=pt(a);t[e]=(t[e]||0)+1}const s=Object.values(t).reduce((e,t)=>e+t,0);return{items:[{label:"Repeaters",count:t.repeater,percent:0,color:xt.repeater},{label:"Companions",count:t.companion,percent:0,color:xt.companion},{label:"Room Servers",count:t.room_server,percent:0,color:xt.room_server}].map(e=>({...e,percent:s>0?e.count/s*100:0})).filter(e=>e.count>0).sort((e,t)=>t.count-e.count),total:s}},[e]);return 0===t.total?a.jsx("div",{className:"h-full flex items-center justify-center text-fg-muted type-body-sm",children:"No neighbors discovered yet"}):a.jsxs("div",{className:"h-full flex flex-col",children:[a.jsx("div",{className:"flex-1 flex flex-col justify-evenly",children:t.items.map(e=>a.jsxs("div",{className:"flex flex-col gap-1.5",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"type-data-sm text-fg-secondary",children:e.label}),a.jsxs("span",{className:"type-data-sm text-fg-secondary tabular-nums",children:[e.count," ",a.jsxs("span",{className:"text-fg-secondary/60",children:["(",e.percent.toFixed(0),"%)"]})]})]}),a.jsx("div",{className:"h-2.5 bg-elevated overflow-hidden",children:a.jsx("div",{className:"h-full transition-all duration-500 ease-out",style:{width:`${e.percent}%`,backgroundColor:e.color,minWidth:e.count>0?"4px":"0"}})})]},e.label))}),a.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-edge-subtle",children:[a.jsx("span",{className:"type-data-xs text-fg-secondary",children:"Total Nodes"}),a.jsx("span",{className:"type-data-sm text-fg-primary font-medium tabular-nums",children:t.total})]})]})});function ft({children:e,minHeight:t="100%",rootMargin:n="200px 0px",keepMounted:i=!0,className:l=""}){const r=s.useRef(null),[o,c]=s.useState(!1),[d,m]=s.useState(!1);s.useEffect(()=>{const e=r.current;if(!e)return;const t=new IntersectionObserver(([e])=>{const t=e.isIntersecting;m(t),t&&c(!0)},{rootMargin:n,threshold:0});return t.observe(e),()=>{t.disconnect()}},[n]);const u=d||i&&o;return a.jsx("div",{ref:r,className:`h-full w-full ${l}`,style:{minHeight:t},children:u?e:a.jsx("div",{className:"h-full w-full flex items-center justify-center text-fg-muted/50",children:a.jsx("div",{className:"animate-pulse text-xs",children:"Loading chart..."})})})}const yt={excellent:"text-signal-excellent",good:"text-signal-good",fair:"text-signal-fair",poor:"text-sys-blue"},bt={excellent:"bg-signal-excellent/10",good:"bg-signal-good/10",fair:"bg-signal-fair/10",poor:"bg-sys-blue/10"};function jt(){const e=k(),t=w(),[n,i]=s.useState(null),l=s.useCallback((e,t)=>{i({prefix:e,candidateHashes:t})},[]),r=s.useCallback(()=>{i(null)},[]);if(!t)return a.jsxs(J,{neomorphic:!0,children:[a.jsx(ie,{icon:a.jsx(re,{}),title:"Prefix Conflicts"}),a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"text-center text-fg-secondary",children:[a.jsx(M,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),a.jsx("p",{className:"type-data-xs",children:"No topology data available"}),a.jsx("p",{className:"type-data-xs opacity-70",children:"Run deep analysis to see stats"})]})})]});const o=(c=e.avgConfidence)>=.9?"excellent":c>=.7?"good":c>=.5?"fair":"poor";var c;const d=(m=e.collisionRate)<=10?"excellent":m<=25?"good":"poor";var m;const h="poor"===o||"poor"===d?"poor":"fair"===o||"fair"===d?"fair":"good"===o||"good"===d?"good":"excellent",x="excellent"===h||"good"===h?Ne:ce;return a.jsxs(J,{neomorphic:!0,className:"flex flex-col overflow-hidden",children:[a.jsx(ie,{icon:a.jsx(re,{}),title:"Prefix Conflicts",badgeColor:"zinc",actions:"poor"===h?a.jsxs(u,{color:"red",children:[a.jsx(ce,{className:"w-3 h-3"}),"Needs Attention"]}):a.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1 rounded-full ${bt[h]}`,children:[a.jsx(x,{className:`w-3.5 h-3.5 ${yt[h]}`}),a.jsx("span",{className:`type-data-xs font-medium ${yt[h]}`,children:"excellent"===h?"Excellent":"good"===h?"Good":"Fair"})]})}),a.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[a.jsxs("div",{className:"grid grid-cols-3 gap-1.5 sm:gap-2 py-3 sm:py-4",children:[a.jsxs("div",{className:"flex flex-col items-center cursor-help bg-subtle-fill radius-inner sm:radius-inset py-2 sm:py-3 px-1.5 sm:px-2",title:"Total unique 2-character prefixes observed in packet paths.",children:[a.jsx(ae,{value:e.totalPrefixes,className:"type-data-hero text-fg-primary",priority:"low"}),a.jsx("span",{className:"type-data-xs sm:type-data-sm text-fg-secondary mt-0.5 sm:mt-1",children:"Prefixes"})]}),a.jsxs("div",{className:"flex flex-col items-center cursor-help bg-subtle-fill radius-inner sm:radius-inset py-2 sm:py-3 px-1.5 sm:px-2",title:"Prefixes that map to exactly one known node. No disambiguation needed.",children:[a.jsx(ae,{value:e.unambiguousPrefixes,className:"type-data-hero text-fg-primary",priority:"low"}),a.jsx("span",{className:"type-data-xs sm:type-data-sm text-fg-secondary mt-0.5 sm:mt-1",children:"Unique"})]}),a.jsxs("div",{className:"flex flex-col items-center cursor-help radius-inner sm:radius-inset py-2 sm:py-3 px-1.5 sm:px-2 "+(e.collisionPrefixes>0?"bg-sys-blue/15":"bg-subtle-fill"),title:"Prefixes matching multiple known nodes. Click a prefix below to explore candidates.",children:[a.jsx(ae,{value:e.collisionPrefixes,className:"type-data-hero "+(e.collisionPrefixes>0?"text-sys-blue":"text-fg-primary"),priority:"low"}),a.jsx("span",{className:"type-data-xs sm:type-data-sm mt-0.5 sm:mt-1 "+(e.collisionPrefixes>0?"text-sys-blue":"text-fg-secondary"),children:"Conflicts"})]})]}),e.highCollisionPrefixes.length>0&&a.jsxs("div",{children:[a.jsx("div",{className:"type-data-xs text-fg-secondary mb-1.5",children:"Problem Prefixes"}),a.jsx("div",{className:"flex flex-wrap gap-1.5 content-start",children:e.highCollisionPrefixes.map(({prefix:e,candidateCount:t,candidateHashes:s})=>a.jsxs("button",{type:"button",onClick:()=>l(e,s),className:"inline-flex items-center gap-0.5 group",title:`${t} candidates - click to explore`,children:[a.jsx(te,{children:e}),a.jsxs("span",{className:"text-fg-muted type-data-xs group-hover:text-fg-secondary transition-colors",children:["×",t]})]},e))})]}),0===e.lowConfidencePrefixes.length&&0===e.collisionPrefixes&&a.jsx("div",{className:"flex-1 flex items-center",children:a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx(Ne,{className:"w-3.5 h-3.5 text-signal-excellent"}),a.jsx("span",{className:"type-data-xs text-signal-excellent",children:"All prefixes uniquely identified"})]})}),a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 mt-auto pt-3",children:[a.jsxs("div",{className:"flex items-center gap-2 cursor-help",title:"Average confidence score across all disambiguated prefixes. Higher = more certain node identification.",children:[a.jsx("span",{className:"type-data-xs text-fg-secondary",children:"Confidence"}),a.jsxs("span",{className:`data-box ${yt[o]}`,children:[(100*e.avgConfidence).toFixed(1),"%"]})]}),a.jsxs("div",{className:"flex items-center gap-2 cursor-help",title:"Percentage of 2-character prefixes that match multiple known nodes. Lower is better.",children:[a.jsx("span",{className:"type-data-xs text-fg-secondary",children:"Collisions"}),a.jsxs("span",{className:`data-box ${yt[d]}`,children:[e.collisionRate.toFixed(1),"%"]})]})]})]}),a.jsx(ne,{isOpen:!!n,prefix:(null==n?void 0:n.prefix)||"",candidateHashes:(null==n?void 0:n.candidateHashes)||[],onClose:r})]})}function vt({icon:e,label:t,value:s,sublabel:n,highlight:i,tooltip:l}){return a.jsxs("div",{className:"flex items-center justify-between gap-2 py-1.5 "+(l?"cursor-help":""),title:l,children:[a.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 min-w-0",children:[a.jsx("span",{className:"icon-xs text-icon-widget flex-shrink-0",children:e}),a.jsx("span",{className:"type-body-sm text-fg-secondary truncate",children:t})]}),a.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5 flex-shrink-0",children:[a.jsx("span",{className:"data-box",style:i?{"--data-box-color":"var(--sys-blue)"}:void 0,children:s}),n&&a.jsx("span",{className:"type-data-xs text-fg-secondary hidden sm:inline",children:n})]})]})}function Nt(){const e=S(),t=C().length;if(!e||0===e.totalPaths)return null;const{totalPaths:s,pathsWithGhosts:n,observationOverrideCount:i,tracePacketsProcessed:l,pathPacketsProcessed:r,distantEdgesDiscovered:o,duplicateGroupsFound:c,duplicatePathsUnique:d,echolocationEdgesInferred:m}=e,u=s>0?((s-n)/s*100).toFixed(1):"0",h=s>0?(i/s*100).toFixed(1):"0",x=l+r,p=x>0||o>0,g=c>0||m>0;return a.jsxs(J,{neomorphic:!0,children:[a.jsx(ie,{title:"Path Decoder",icon:a.jsx(oe,{}),badge:t>0?`${t} hidden`:void 0,badgeColor:"zinc"}),a.jsxs(le,{children:[a.jsxs("div",{children:[a.jsx(vt,{icon:a.jsx(Me,{className:"w-3.5 h-3.5"}),label:"Traceable",value:`${u}%`,sublabel:`of ${s.toLocaleString()} paths`,tooltip:"Percentage of packet journeys where every hop was identified. Higher = better visibility into how traffic flows through your mesh."}),a.jsx(vt,{icon:a.jsx(Ce,{className:"w-3.5 h-3.5"}),label:"Learning Rate",value:`${h}%`,sublabel:"adapted",tooltip:"How often real traffic patterns improved our predictions over geography alone. Higher values mean the decoder is learning your mesh's actual behavior — which routes are preferred, which nodes are most active."})]}),p&&a.jsxs("div",{className:"mt-3",children:[a.jsx("p",{className:"type-micro mb-2",children:"Beyond Line-of-Sight"}),a.jsxs("div",{children:[a.jsx(vt,{icon:a.jsx(Se,{className:"w-3.5 h-3.5"}),label:"Route Reports",value:x.toLocaleString(),sublabel:l>0?`(${l} TRACE)`:void 0,tooltip:"TRACE/PATH packets from distant nodes share their routing tables. This reveals connections we can't directly observe — mapping parts of the mesh we don't touch."}),a.jsx(vt,{icon:a.jsx(de,{className:"w-3.5 h-3.5"}),label:"Remote Links",value:o.toLocaleString(),highlight:o>0,tooltip:"Node-to-node connections discovered from route reports. These links exist outside our RF range but help complete the topology picture."})]})]}),g&&a.jsx(vt,{icon:a.jsx(T,{className:"w-3.5 h-3.5"}),label:"Multi-Path Packets",value:c.toLocaleString(),sublabel:d>0?`(${d} routes)`:void 0,tooltip:"Packets received via multiple paths simultaneously. Like sonar, these 'echoes' reveal redundant routes — important for understanding mesh resilience."}),t>0&&a.jsx(vt,{icon:a.jsx(me,{className:"w-3.5 h-3.5 text-sys-blue"}),label:"Ghost Repeaters",value:t,highlight:!0,tooltip:"High-confidence hidden repeaters: appear in 10+ paths, have 2+ known neighbors, ≥30% confidence, and plausible location. View them on the Contacts map."})]})]})}const kt=new Set(["Duplicate","Empty payload","Path too long","Unknown"]),wt={excellent:"bg-status-success",good:"bg-sys-blue",fair:"bg-status-warning",poor:"bg-status-danger"};function Mt({packets:e,rangeMinutes:t,rangeHours:n,timeRangeLabel:i,isLoaded:l=!0}){const r=s.useMemo(()=>function(e,t){const s=Date.now()/1e3,a=60*t,n=s-a,i=a/24,l=new Array(24).fill(0),r=new Array(24).fill(0);let o=0,c=0,d=0,m=0;for(const h of e){if("tx_local"===h.packet_origin)continue;const e=h.timestamp;if(e<n||e>s)continue;o++;const t=Math.min(23,Math.floor((e-n)/i));r[t]++,h.transmitted||"tx_forward"===h.packet_origin?(c++,l[t]++):(h.is_duplicate||"Duplicate"===h.drop_reason)&&d++,h.drop_reason&&kt.has(h.drop_reason)&&m++}const u=[];for(let h=0;h<24;h++){const e=r[h],t=l[h];u.push({count:e>0?Math.round(t/e*100):0,timestamp:1e3*(n+h*i)})}return{totalRx:o,forwarded:c,duplicates:d,waste:m,efficiency:o>0?c/o*100:0,duplicateRate:o>0?d/o*100:0,wasteRate:o>0?m/o*100:0,sparkline:u}}(e,t),[e,t]),[o,c]=s.useState(null),d=s.useCallback(async()=>{try{const e=await A(n);e.success&&e.data&&c(e.data.count)}catch{}},[n]);s.useEffect(()=>{d()},[d]);const m=(u=r.efficiency)>=90?"excellent":u>=75?"good":u>=60?"fair":"poor";var u;const h=r.totalRx>0;return a.jsx(J,{neomorphic:!0,isLoaded:l,skeletonType:"chart",children:l&&a.jsxs(a.Fragment,{children:[a.jsx(ie,{icon:a.jsx(he,{}),title:"Packet Health",badge:i,badgeColor:"zinc"}),a.jsx(le,{children:a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:"flex items-baseline gap-2",children:[a.jsxs("div",{className:"type-data-xl text-fg-primary",children:[h?a.jsx(ae,{value:Math.round(10*r.efficiency)/10,className:"font-mono tabular-nums",priority:"medium",format:{minimumFractionDigits:1,maximumFractionDigits:1}}):a.jsx("span",{className:"opacity-30",children:"—"}),a.jsx("span",{className:"type-data-sm text-fg-muted ml-0.5",children:"%"})]}),h&&a.jsx("div",{className:`w-2 h-2 rounded-full ${wt[m]}`})]}),a.jsx("div",{className:"type-micro mb-2 cursor-help",title:"Forwarded packets / total received. CRC failures, garbled packets, and RF collisions that destroy packets before reaching software are not included in this ratio — see CRC Errors for hardware-level failures.",children:"FORWARDING RATE"}),a.jsx("div",{className:"flex-1 min-h-[28px] max-h-[48px] mb-2",children:a.jsx(ue,{data:r.sparkline,width:9999,height:36,color:"var(--sys-blue)",className:"w-full"})}),a.jsxs("div",{className:"flex gap-2 sm:gap-3 mt-auto",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"data-box-label",children:"Dupes"}),a.jsx("div",{className:"data-box data-box-fill data-box-left",children:h?`${r.duplicateRate.toFixed(1)}%`:"—"})]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"data-box-label",children:"Waste"}),a.jsx("div",{className:"data-box data-box-fill data-box-left",children:h?`${r.wasteRate.toFixed(1)}%`:"—"})]}),null!==o&&o>0&&a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"data-box-label flex items-center gap-1",children:[a.jsx(ce,{className:"w-3 h-3 text-status-warning"}),"CRC"]}),a.jsx("div",{className:"data-box data-box-fill data-box-left text-status-warning",children:o})]})]})]})})]})})}function St(){var e,t,n,i,l,r,o,c,d,m,u,h,x,p,g,f,y;const b=F(),j=P(),v=L(),N=R(),k=D(),w=$(),M=null!==b&&k,S=s.useRef(!1);M&&!S.current&&(S.current=!0);const C=S.current,T=z(),A=E(),[K,Y]=s.useState([]),[U,te]=s.useState(null),[,se]=s.useState(null),[ae,ne]=s.useState(!0),[le,re]=s.useState(null),[oe,ce]=s.useState(()=>{const e=localStorage.getItem("statistics-view-mode");return"share"===e||"airtime"===e?e:"airtime"});s.useEffect(()=>{localStorage.setItem("statistics-view-mode",oe)},[oe]);const[de,me]=s.useState(()=>{const e=localStorage.getItem("statistics-smoothing-mode");return["ema","ultra","mosaic","stats","trend"].includes(e)?e:"stats"});s.useEffect(()=>{localStorage.setItem("statistics-smoothing-mode",de)},[de]);const[ue,he]=s.useState(!1),[be,ve]=s.useState(!1),[Ne,ke]=s.useState(Ae),[we,Me]=s.useState(.5),[Se,Ce]=s.useState(xe),[Te,Re]=s.useState(.8),[De,$e]=s.useState(50),ze=s.useMemo(()=>({0:0,1:0,2:1,3:2,4:3,5:4,6:5,7:6,8:7,9:8,10:9}[T]??3),[T]),Ee=_[ze].hours,_e=60*Ee,He=_[ze],Be=B(Ee),Oe=w.isBackgroundLoading,qe=s.useCallback(e=>{A({0:1,1:2,2:3,3:4,4:5,5:6,6:7,7:8,8:9,9:10}[e]??4)},[A]),We=s.useMemo(()=>{var e;if(!(null==(e=null==b?void 0:b.config)?void 0:e.radio))return null;const t=b.config.radio;return{sf:t.spreading_factor??10,bw:t.bandwidth??25e4,cr:t.coding_rate??5,preamble:t.preamble_length??8}},[null==(t=null==(e=null==b?void 0:b.config)?void 0:e.radio)?void 0:t.spreading_factor,null==(i=null==(n=null==b?void 0:b.config)?void 0:n.radio)?void 0:i.bandwidth,null==(r=null==(l=null==b?void 0:b.config)?void 0:l.radio)?void 0:r.coding_rate,null==(c=null==(o=null==b?void 0:b.config)?void 0:o.radio)?void 0:c.preamble_length]);s.useEffect(()=>{!async function(){var e;re(null);try{const t=await H(Ee);t.success&&(null==(e=t.data)?void 0:e.history)&&Y(t.data.history)}catch(t){re(t instanceof Error?t.message:"Failed to load chart data")}finally{ne(!1)}}()},[Ee]);const Ie=s.useMemo(()=>Ee>=504?72e5:336===Ee?36e5:168===Ee?18e5:72===Ee?6e5:3e5,[Ee]),Ge=s.useCallback(async()=>{var e;try{const t=await H(Ee);t.success&&(null==(e=t.data)?void 0:e.history)&&Y(t.data.history)}catch{}},[Ee]);G(Ge,Ie,!0,!0);const Ve=s.useMemo(()=>0===K.length?{timestamps:[],values:[]}:{timestamps:K.map(e=>e.timestamp),values:K.map(e=>e.noise_floor_dbm)},[K]),Ue=s.useMemo(()=>{if(K.length<10)return{anomalies:[],debug:void 0};const e=function(e,t={}){const s={...Ae,...t};if(e.length<10)return{anomalies:[],thresholds:Pe([]),totalSamples:e.length,anomalySamples:0};const a=e.map(e=>e.noise_floor_dbm),n=Pe(a),i=[...a].sort((e,t)=>e-t);let l,r;s.useAbsoluteThresholds?(l=s.baselineDbm,r=s.spikeDbm):(l=Fe(i,s.baselinePercentile),r=Fe(i,s.spikePercentile));const o=[...e].sort((e,t)=>e.timestamp-t.timestamp),c=[];let d=null,m=0;for(const u of o)if(u.noise_floor_dbm>l&&u.noise_floor_dbm<r)if(m++,d){const e=Math.abs(u.noise_floor_dbm-d.rollingAvg)<=s.similarityToleranceDbm,t=u.timestamp-d.endTs<=s.mergeGapSeconds;e&&t?(d.endTs=u.timestamp,d.values.push(u.noise_floor_dbm),d.timestamps.push(u.timestamp),d.rollingAvg=d.values.reduce((e,t)=>e+t,0)/d.values.length):(d.values.length>=s.minSequenceLength&&c.push(d),d={startTs:u.timestamp,endTs:u.timestamp,values:[u.noise_floor_dbm],timestamps:[u.timestamp],rollingAvg:u.noise_floor_dbm})}else d={startTs:u.timestamp,endTs:u.timestamp,values:[u.noise_floor_dbm],timestamps:[u.timestamp],rollingAvg:u.noise_floor_dbm};else d&&d.values.length>=s.minSequenceLength&&c.push(d),d=null;return d&&d.values.length>=s.minSequenceLength&&c.push(d),0===c.length?{anomalies:[],thresholds:n,totalSamples:e.length,anomalySamples:m,debug:{baselineCutoff:l,spikeCutoff:r,midBandSamples:m}}:{anomalies:c.map(e=>{const t=Math.max(...e.values),s=e.values.reduce((e,t)=>e+t,0)/e.values.length;return{startTs:e.startTs,endTs:e.endTs,peakValue:t,avgValue:s,severity:Le(s,l,r),sampleCount:e.values.length}}),thresholds:n,totalSamples:e.length,anomalySamples:m,debug:{baselineCutoff:l,spikeCutoff:r,midBandSamples:m}}}(K,Ne);return{anomalies:e.anomalies,debug:e.debug}},[K,Ne]),Je=Ue.anomalies,Qe=s.useMemo(()=>{const e=(null==b?void 0:b.neighbors)??{};return Object.fromEntries(Object.entries(e).filter(([e])=>!j.has(e)))},[null==b?void 0:b.neighbors,j]),Ze=s.useMemo(()=>{const e=Date.now()/1e3-3600*Ee;return Object.fromEntries(Object.entries(Qe).filter(([,t])=>t.last_seen>=e))},[Qe,Ee]),et=s.useMemo(()=>{const e=60*_e/Be,t=Math.floor(Date.now()/1e3),s=Math.floor(t/e)*e;return{start:s-60*_e,end:s}},[_e,Be]),tt=Se.timeStart??et.start,st=Se.timeEnd??et.end,nt=B((st-tt)/3600),it=s.useMemo(()=>(null==b?void 0:b.neighbors)??{},[null==b?void 0:b.neighbors]),{resolvePacketSource:lt}=pe(N,it),rt=s.useMemo(()=>{const{timeStart:e,timeEnd:t,deviceTypes:s,nodeIds:a}=Se,n=null!==e||null!==t,i=s.size>0,l=a.size>0;if(!n&&!i&&!l)return N;let r=null;if(l){r=new Set;for(const e of a)r.add(O(e))}const o=e??et.start,c=t??et.end;return N.filter(e=>{if(n&&(e.timestamp<o||e.timestamp>c))return!1;const t=lt(e);if(i&&!s.has(t.type))return!1;if(l)if(t.confident){if(!t.hash||!a.has(t.hash))return!1}else{const t=e.src_hash?O(e.src_hash):"";if(!t||!r.has(t))return!1}return!0})},[N,Se,lt,et]);return a.jsxs(Q,{children:[a.jsx(Z,{title:"Statistics",icon:a.jsx(q,{}),controls:a.jsx(X,{ranges:_,selectedIndex:ze,onSelect:qe,isPending:Oe})}),le&&a.jsx(J,{className:"border border-sys-red/50 bg-sys-red/10",children:a.jsx("p",{className:"text-sys-red",children:le})}),ue&&be&&a.jsxs(J,{className:"border border-sys-indigo/30 bg-surface/50",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"type-label",children:"Anomaly Detection Tuning"}),a.jsxs("span",{className:"type-data-xs text-fg-muted",children:["(",He.label,")"]})]}),a.jsx("button",{onClick:()=>ke(e=>({...e,useAbsoluteThresholds:!e.useAbsoluteThresholds})),className:"type-data-xs px-2 py-1 rounded transition-colors "+(Ne.useAbsoluteThresholds?"bg-sys-indigo/30 text-sys-indigo":"bg-elevated text-fg-muted hover:text-fg-secondary"),children:Ne.useAbsoluteThresholds?"Absolute dBm":"Percentile"})]}),a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[a.jsxs("div",{children:[a.jsx("span",{className:"type-micro",children:"Baseline"}),a.jsxs("span",{className:"ml-2 type-data-sm text-status-warning",children:[(null==(m=null==(d=Ue.debug)?void 0:d.baselineCutoff)?void 0:m.toFixed(1))??"—"," dBm"]})]}),a.jsxs("div",{children:[a.jsx("span",{className:"type-micro",children:"Spike"}),a.jsxs("span",{className:"ml-2 type-data-sm text-status-warning",children:[(null==(h=null==(u=Ue.debug)?void 0:u.spikeCutoff)?void 0:h.toFixed(1))??"—"," dBm"]})]}),a.jsxs("div",{children:[a.jsx("span",{className:"type-micro",children:"Mid-band"}),a.jsx("span",{className:"ml-2 type-data-sm text-sys-indigo",children:(null==(x=Ue.debug)?void 0:x.midBandSamples)??0})]}),a.jsxs("div",{children:[a.jsx("span",{className:"type-micro",children:"Anomalies"}),a.jsx("span",{className:"ml-2 type-data-sm text-status-danger",children:Je.length})]})]}),a.jsxs("div",{className:"mt-4 pt-4 border-t border-edge-subtle space-y-4",children:[Ne.useAbsoluteThresholds?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Baseline (",Ne.baselineDbm," dBm)"]}),a.jsx("input",{type:"range",min:"-120",max:"-60",value:Ne.baselineDbm,onChange:e=>ke(t=>({...t,baselineDbm:Number(e.target.value)})),className:"w-full accent-sys-indigo"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Spike (",Ne.spikeDbm," dBm)"]}),a.jsx("input",{type:"range",min:"-100",max:"-20",value:Ne.spikeDbm,onChange:e=>ke(t=>({...t,spikeDbm:Number(e.target.value)})),className:"w-full accent-sys-indigo"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Merge Gap (",Ne.mergeGapSeconds,"s)"]}),a.jsx("input",{type:"range",min:"5",max:"120",step:"5",value:Ne.mergeGapSeconds,onChange:e=>ke(t=>({...t,mergeGapSeconds:Number(e.target.value)})),className:"w-full accent-sys-indigo"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Min Sequence (",Ne.minSequenceLength,")"]}),a.jsx("input",{type:"range",min:"2",max:"20",value:Ne.minSequenceLength,onChange:e=>ke(t=>({...t,minSequenceLength:Number(e.target.value)})),className:"w-full accent-sys-indigo"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Similarity (±",Ne.similarityToleranceDbm," dBm)"]}),a.jsx("input",{type:"range",min:"1",max:"15",value:Ne.similarityToleranceDbm,onChange:e=>ke(t=>({...t,similarityToleranceDbm:Number(e.target.value)})),className:"w-full accent-sys-indigo"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Opacity (",Math.round(100*we),"%)"]}),a.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.05",value:we,onChange:e=>Me(Number(e.target.value)),className:"w-full accent-sys-indigo"})]})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Baseline (P",Ne.baselinePercentile,")"]}),a.jsx("input",{type:"range",min:"1",max:"50",value:Ne.baselinePercentile,onChange:e=>ke(t=>({...t,baselinePercentile:Number(e.target.value)})),className:"w-full accent-sys-indigo"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Spike (P",Ne.spikePercentile,")"]}),a.jsx("input",{type:"range",min:"50",max:"99",value:Ne.spikePercentile,onChange:e=>ke(t=>({...t,spikePercentile:Number(e.target.value)})),className:"w-full accent-sys-indigo"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Merge Gap (",Ne.mergeGapSeconds,"s)"]}),a.jsx("input",{type:"range",min:"5",max:"120",step:"5",value:Ne.mergeGapSeconds,onChange:e=>ke(t=>({...t,mergeGapSeconds:Number(e.target.value)})),className:"w-full accent-sys-indigo"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Min Sequence (",Ne.minSequenceLength,")"]}),a.jsx("input",{type:"range",min:"2",max:"20",value:Ne.minSequenceLength,onChange:e=>ke(t=>({...t,minSequenceLength:Number(e.target.value)})),className:"w-full accent-sys-indigo"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Similarity (±",Ne.similarityToleranceDbm," dBm)"]}),a.jsx("input",{type:"range",min:"1",max:"15",value:Ne.similarityToleranceDbm,onChange:e=>ke(t=>({...t,similarityToleranceDbm:Number(e.target.value)})),className:"w-full accent-sys-indigo"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"type-micro block mb-1",children:["Opacity (",Math.round(100*we),"%)"]}),a.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.05",value:we,onChange:e=>Me(Number(e.target.value)),className:"w-full accent-sys-indigo"})]})]})]}),a.jsxs("div",{className:"mt-4 p-3 bg-elevated radius-inner",children:[a.jsx("div",{className:"type-micro mb-1",children:"Config output"}),a.jsxs("div",{className:"type-data-sm text-status-success",children:[Ne.useAbsoluteThresholds?`useAbsoluteThresholds: true, baselineDbm: ${Ne.baselineDbm}, spikeDbm: ${Ne.spikeDbm}`:`useAbsoluteThresholds: false, baselinePercentile: ${Ne.baselinePercentile}, spikePercentile: ${Ne.spikePercentile}`,", mergeGapSeconds: ",Ne.mergeGapSeconds,", minSequenceLength: ",Ne.minSequenceLength,", similarityToleranceDbm: ",Ne.similarityToleranceDbm]})]})]})]}),a.jsxs(ee,{children:[a.jsx("div",{className:"sm:hidden",children:Oe&&a.jsx(fe,{template:"auto",children:a.jsx(J,{className:"border border-sys-blue/30 bg-sys-blue/5",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"relative flex h-3 w-3",children:[a.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-sys-blue opacity-75"}),a.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-sys-blue"})]}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("p",{className:"type-body-sm text-fg-primary",children:["Loading ",He.label," data..."]}),w.loadProgress&&a.jsxs("p",{className:"type-data-xs text-fg-muted mt-0.5",children:[w.loadProgress.loaded.toLocaleString()," packets (",w.loadProgress.percent,"%)"]})]})]})})})}),ae?a.jsx(fe,{template:"auto",children:a.jsx(J,{neomorphic:!0,className:"text-center py-12",children:a.jsx("div",{className:"animate-pulse text-fg-muted",children:"Loading statistics..."})})}):a.jsxs(a.Fragment,{children:[a.jsx(fe,{template:"hero-auto",children:a.jsx(J,{neomorphic:!0,isLoaded:C,skeletonType:"chart",children:C&&a.jsxs(a.Fragment,{children:[a.jsx(ie,{icon:a.jsx(V,{}),title:"Packet Analyzer",badge:He.label,badgeColor:"zinc",stackActionsOnMobile:!0,actions:a.jsxs("div",{className:"flex flex-wrap items-center gap-2 justify-end",children:["stats"===de&&a.jsx(Ye,{enabled:ue,onChange:he,anomalyCount:Je.length,showTuning:be,onTuningChange:ve}),a.jsx(Xe,{smoothing:de,onChange:me}),a.jsx(Ke,{mode:oe,onChange:ce})]})}),a.jsx("div",{className:"flex-1 min-h-0",children:a.jsx(at,{packets:rt,allPackets:N,startTs:tt,endTs:st,parentStartTs:et.start,parentEndTs:et.end,bucketCount:nt,radioConfig:We??void 0,mode:oe,smoothing:de,noiseFloorAnomalies:Je,showNoiseFloorOverlay:ue,overlayOpacity:we,dotSize:Te,dotOpacity:De/100})})]})})}),a.jsx(fe,{template:"auto",className:"relative z-10",children:a.jsx(J,{neomorphic:!0,noPadding:!0,isLoaded:C,className:"overflow-visible",children:C&&a.jsx(ge,{parentStartTs:et.start,parentEndTs:et.end,neighbors:Qe,filter:Se,onChange:Ce,..."stats"===de?{scatterDotSize:Te,onScatterDotSizeChange:Re,scatterOpacity:De,onScatterOpacityChange:$e}:{}})})}),a.jsxs(fe,{template:"panel",children:[a.jsx(ye,{span:12,md:6,children:a.jsx(J,{neomorphic:!1,isLoaded:C,skeletonType:"chart",noPadding:C,className:"!bg-transparent !ring-0 !shadow-none !overflow-visible -mx-4 sm:mx-0 !px-0 !pr-0",children:C&&a.jsx(ft,{children:a.jsx(ht,{neighbors:Ze,quickNeighbors:v,localLat:(null==(g=null==(p=null==b?void 0:b.config)?void 0:p.repeater)?void 0:g.latitude)??0,localLon:(null==(y=null==(f=null==b?void 0:b.config)?void 0:f.repeater)?void 0:y.longitude)??0,onStatsChange:se,title:"Link Quality",badge:He.label})})})}),a.jsx(ye,{span:12,md:6,children:a.jsx(J,{neomorphic:!0,isLoaded:C,skeletonType:"chart",children:C&&a.jsxs(a.Fragment,{children:[a.jsx(ie,{icon:a.jsx(je,{}),title:"Network Composition",badge:He.label,badgeColor:"zinc"}),a.jsx("div",{className:"flex-1 min-h-0",children:a.jsx(ft,{children:a.jsx(gt,{neighbors:Ze})})})]})})})]}),a.jsxs(fe,{template:"panel",children:[a.jsx(ye,{span:12,md:6,children:a.jsx(jt,{})}),a.jsx(ye,{span:12,md:6,children:a.jsx(Nt,{})})]}),a.jsxs(fe,{template:"panel",children:[a.jsx(ye,{span:12,md:8,children:a.jsx(J,{neomorphic:!0,isLoaded:C,skeletonType:"chart",children:C&&a.jsxs(a.Fragment,{children:[a.jsx(ie,{icon:a.jsx(W,{}),title:"NOISE FLOOR dBm",stackActionsOnMobile:!0,actions:U?a.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[a.jsxs("span",{className:"type-data-xs text-fg-muted whitespace-nowrap",children:["min ",a.jsx("span",{className:"data-box",children:U.min.toFixed(0)})]}),a.jsxs("span",{className:"type-data-xs text-fg-muted whitespace-nowrap",children:["avg ",a.jsx("span",{className:"data-box",children:U.avg.toFixed(0)})]}),a.jsxs("span",{className:"type-data-xs text-fg-muted whitespace-nowrap",children:["max ",a.jsx("span",{className:"data-box",children:U.max.toFixed(0)})]})]}):null}),a.jsx("div",{className:"flex-1 min-h-0",children:a.jsx(ft,{children:a.jsx(I,{timestamps:Ve.timestamps,values:Ve.values,onStatsChange:te})})})]})})}),a.jsx(ye,{span:12,md:4,children:a.jsx(Mt,{packets:N,rangeMinutes:_e,rangeHours:Ee,timeRangeLabel:He.label,isLoaded:C})})]})]})]})]})}export{St as default};
