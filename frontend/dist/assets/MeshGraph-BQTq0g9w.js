var e=Object.defineProperty,t=(t,s,n)=>((t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n)(t,"symbol"!=typeof s?s+"":s,n);import{r as s,j as n,m as a,i,W as r,Z as o}from"./vendor-react-j_fHog8x.js";import{c as l,b3 as c,b4 as d,b5 as u,A as x,m,M as h,a0 as p,aE as g,b6 as f,b7 as v,aX as b,b8 as y,b9 as j,av as N,n as w,aT as C,r as k,aY as S,e as D,T as F,ba as L,bb as R,R as M,bc as B,O as H,Q as A,bd as E,be as P,B as z,bf as T,aA as $}from"./index-BXGLLJB2.js";import{h as I,c as G,u as O,G as Z,M as W,a as V,E as K,D as _,b as q,d as U,s as X}from"./DeepAnalysisModal-DxNaNa2l.js";import{D as Y}from"./DataBox-4oJaeRJp.js";import{E as Q,a as J,S as ee,T as te}from"./target-CItOaWy7.js";import{L as se}from"./layers-Bl6z3as4.js";import{S as ne}from"./settings-2-6gEVfS6r.js";import{C as ae}from"./chevron-right-CdMU4A3M.js";import{N as ie}from"./network-DJKSnv93.js";import"./maplibre-gl-b91ci4Kr.js";import"./vendor-core-CDNU4oKM.js";import"./config-CTM8_93T.js";import"./git-branch-B4P3YZmc.js";import"./database-_xh4COBD.js";import"./copy-gotHysUv.js";const re=l("arrow-right-left",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]),oe=l("focus",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]),le=l("group",[["path",{d:"M3 7V5c0-1.1.9-2 2-2h2",key:"adw53z"}],["path",{d:"M17 3h2c1.1 0 2 .9 2 2v2",key:"an4l38"}],["path",{d:"M21 17v2c0 1.1-.9 2-2 2h-2",key:"144t0e"}],["path",{d:"M7 21H5c-1.1 0-2-.9-2-2v-2",key:"rtnfgi"}],["rect",{width:"7",height:"5",x:"7",y:"7",rx:"1",key:"1eyiv7"}],["rect",{width:"7",height:"5",x:"10",y:"12",rx:"1",key:"1qlmkx"}]]),ce=l("lasso",[["path",{d:"M3.704 14.467A10 8 0 0 1 2 10a10 8 0 0 1 20 0 10 8 0 0 1-10 8 10 8 0 0 1-5.181-1.158",key:"1yant3"}],["path",{d:"M7 22a5 5 0 0 1-2-3.994",key:"1xp6a4"}],["circle",{cx:"5",cy:"16",r:"2",key:"18csp3"}]]),de=l("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);function ue(e){if(null==e)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?`"${t.replace(/"/g,'""')}"`:t}function xe(e,t){const s=[e.join(",")];for(const n of t)s.push(n.map(ue).join(","));return s.join("\n")}function me(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function he(e){return!e||e<=0?"":new Date(1e3*e).toISOString()}function pe(e,t){return`${e}-${(new Date).toISOString().replace(/[:.]/g,"-").slice(0,19)}.${t}`}const ge=["hash","prefix","name","nodeClass","communityId","degree","inDegree","outDegree","betweenness","pathDiversity","packetCount","lastSeen","activityLevel","recencyScore","avgRssi","avgSnr","isZeroHop","prefixConfidence","hasCollision","collisionCandidates","isLocal","isHub","isGateway","isBackbone","isMobile","isGhost","isInLoop","latitude","longitude","contactType"];function fe(e){var t,s;return[e.hash,e.prefix,e.name??"",e.nodeClass,e.communityId,e.degree,e.inDegree,e.outDegree,e.betweenness.toFixed(6),e.pathDiversity,e.packetCount,he(e.lastSeen),e.activityLevel,e.recencyScore.toFixed(4),(null==(t=e.avgRssi)?void 0:t.toFixed(1))??"",(null==(s=e.avgSnr)?void 0:s.toFixed(1))??"",e.isZeroHop,e.prefixConfidence.toFixed(4),e.hasCollision,e.collisionCandidates,e.isLocal,e.isHub,e.isGateway,e.isBackbone,e.isMobile,e.isGhost,e.isInLoop,e.latitude??"",e.longitude??"",e.contactType??""]}function ve(e,t){const s=[];for(const n of e.nodeMetrics.values())!t&&n.isGhost||s.push({hash:n.hash,prefix:n.prefix,name:n.name,nodeClass:n.nodeClass,communityId:n.communityId,degree:n.degree,inDegree:n.inDegree,outDegree:n.outDegree,betweenness:n.betweenness,pathDiversity:n.pathDiversity,packetCount:n.packetCount,lastSeen:n.lastSeen,activityLevel:n.activityLevel,recencyScore:n.recencyScore,avgRssi:n.avgRssi,avgSnr:n.avgSnr,isZeroHop:n.isZeroHop,prefixConfidence:n.prefixConfidence,hasCollision:n.hasCollision,isLocal:n.isLocal,isHub:n.isHub,isGateway:n.isGateway,isBackbone:n.isBackbone,isMobile:n.isMobile,isGhost:n.isGhost,isInLoop:n.isInLoop,latitude:n.latitude,longitude:n.longitude,contactType:n.contactType});return s}const be=["fromHash","toHash","key","packetCount","certainCount","avgConfidence","strength","forwardCount","reverseCount","symmetryRatio","dominantDirection","floodCount","directCount","isDirectPathEdge","isZeroHop","isLoopEdge","isCertain","avgRssi","avgSnr","avgRecency","hopDistanceFromLocal","edgeBetweenness","isBackbone"];function ye(e,t){const s=t?e.edges:e.validatedEdges,n=new Set(e.backboneEdges);return s.map(t=>({fromHash:t.fromHash,toHash:t.toHash,key:t.key,packetCount:t.packetCount,certainCount:t.certainCount,avgConfidence:t.avgConfidence,strength:t.strength,forwardCount:t.forwardCount,reverseCount:t.reverseCount,symmetryRatio:t.symmetryRatio,dominantDirection:t.dominantDirection,floodCount:t.floodCount,directCount:t.directCount,isDirectPathEdge:t.isDirectPathEdge,isZeroHop:t.isZeroHop??!1,isLoopEdge:t.isLoopEdge??!1,isCertain:t.isCertain,avgRssi:t.avgRssi??null,avgSnr:t.avgSnr??null,avgRecency:t.avgRecency,hopDistanceFromLocal:t.hopDistanceFromLocal,edgeBetweenness:e.edgeBetweenness.get(t.key)??0,isBackbone:n.has(t.key)}))}const je=["pathKey","hops","hopCount","healthScore","weakestLinkKey","weakestLinkConfidence","avgEdgeCertainty","observationTrend","alternatePathsCount","estimatedLatencyMs","observationCount","routeType","lastSeen","involvesHub"];function Ne(e){return[e.pathKey,e.hops.join(">"),e.hops.length,e.healthScore.toFixed(4),e.weakestLinkKey??"",e.weakestLinkConfidence.toFixed(4),e.avgEdgeCertainty.toFixed(4),e.observationTrend.toFixed(4),e.alternatePathsCount,e.estimatedLatencyMs.toFixed(0),e.observationCount,e.routeType,he(e.lastSeen),e.involvesHub]}const we=["nodeHash","nodePrefix","nodeName","networkRole","floodFactor","directFactor","floodSlots","directSlots","trafficIntensity","directNeighborCount","collisionRisk","confidence","adjustment","dataConfidence","observationSymmetry","rationale"];function Ce(e,t,s){const n=s.get(e);return[e,(null==n?void 0:n.prefix)??"",(null==n?void 0:n.name)??"",t.networkRole,t.floodFactor.toFixed(2),t.directFactor.toFixed(2),t.floodSlots,t.directSlots,t.trafficIntensity.toFixed(4),t.directNeighborCount,t.collisionRisk.toFixed(4),t.confidence.toFixed(4),t.adjustment,t.dataConfidence,t.observationSymmetry.toFixed(4),t.rationale]}function ke(e,t){var s,n;const a=new Set(e.backboneEdges),i=['<?xml version="1.0" encoding="UTF-8"?>','<gexf xmlns="http://gexf.net/1.3" version="1.3">',`  <meta lastmodifieddate="${(new Date).toISOString()}">`,`    <creator>pymc_console v${c}</creator>`,"    <description>MeshCore LoRa Mesh Network Topology</description>","  </meta>",'  <graph defaultedgetype="directed" mode="static">',"","    \x3c!-- Node Attributes --\x3e",'    <attributes class="node">','      <attribute id="n0" title="prefix" type="string"/>','      <attribute id="n1" title="name" type="string"/>','      <attribute id="n2" title="nodeClass" type="string"/>','      <attribute id="n3" title="communityId" type="integer"/>','      <attribute id="n4" title="degree" type="integer"/>','      <attribute id="n5" title="betweenness" type="float"/>','      <attribute id="n6" title="packetCount" type="integer"/>','      <attribute id="n7" title="activityLevel" type="string"/>','      <attribute id="n8" title="isHub" type="boolean"/>','      <attribute id="n9" title="isGateway" type="boolean"/>','      <attribute id="n10" title="isBackbone" type="boolean"/>','      <attribute id="n11" title="isMobile" type="boolean"/>','      <attribute id="n12" title="isGhost" type="boolean"/>','      <attribute id="n13" title="isZeroHop" type="boolean"/>','      <attribute id="n14" title="prefixConfidence" type="float"/>','      <attribute id="n15" title="avgRssi" type="float"/>','      <attribute id="n16" title="avgSnr" type="float"/>',"    </attributes>","","    \x3c!-- Edge Attributes --\x3e",'    <attributes class="edge">','      <attribute id="e0" title="packetCount" type="integer"/>','      <attribute id="e1" title="certainCount" type="integer"/>','      <attribute id="e2" title="confidence" type="float"/>','      <attribute id="e3" title="symmetryRatio" type="float"/>','      <attribute id="e4" title="dominantDirection" type="string"/>','      <attribute id="e5" title="isBackbone" type="boolean"/>','      <attribute id="e6" title="isLoopEdge" type="boolean"/>','      <attribute id="e7" title="isDirectPath" type="boolean"/>','      <attribute id="e8" title="isZeroHop" type="boolean"/>','      <attribute id="e9" title="edgeBetweenness" type="float"/>','      <attribute id="e10" title="floodCount" type="integer"/>','      <attribute id="e11" title="directCount" type="integer"/>',"    </attributes>","","    <nodes>"];for(const r of e.nodeMetrics.values()){if(!t&&r.isGhost)continue;const e=me(r.name??r.prefix);i.push(`      <node id="${me(r.hash)}" label="${e}">`),i.push("        <attvalues>"),i.push(`          <attvalue for="n0" value="${me(r.prefix)}"/>`),i.push(`          <attvalue for="n1" value="${me(r.name??"")}"/>`),i.push(`          <attvalue for="n2" value="${r.nodeClass}"/>`),i.push(`          <attvalue for="n3" value="${r.communityId}"/>`),i.push(`          <attvalue for="n4" value="${r.degree}"/>`),i.push(`          <attvalue for="n5" value="${r.betweenness}"/>`),i.push(`          <attvalue for="n6" value="${r.packetCount}"/>`),i.push(`          <attvalue for="n7" value="${r.activityLevel}"/>`),i.push(`          <attvalue for="n8" value="${r.isHub}"/>`),i.push(`          <attvalue for="n9" value="${r.isGateway}"/>`),i.push(`          <attvalue for="n10" value="${r.isBackbone}"/>`),i.push(`          <attvalue for="n11" value="${r.isMobile}"/>`),i.push(`          <attvalue for="n12" value="${r.isGhost}"/>`),i.push(`          <attvalue for="n13" value="${r.isZeroHop}"/>`),i.push(`          <attvalue for="n14" value="${r.prefixConfidence}"/>`),null!=r.avgRssi&&i.push(`          <attvalue for="n15" value="${r.avgRssi}"/>`),null!=r.avgSnr&&i.push(`          <attvalue for="n16" value="${r.avgSnr}"/>`),i.push("        </attvalues>"),null==r.latitude||null==r.longitude||0===r.latitude&&0===r.longitude||i.push(`        <viz:position x="${r.longitude}" y="${r.latitude}" z="0.0"/>`),i.push("      </node>")}i.push("    </nodes>"),i.push(""),i.push("    <edges>");for(const r of e.validatedEdges){const o=e.nodeMetrics;if(!t&&((null==(s=o.get(r.fromHash))?void 0:s.isGhost)||(null==(n=o.get(r.toHash))?void 0:n.isGhost)))continue;const l=e.edgeBetweenness.get(r.key)??0;i.push(`      <edge id="${me(r.key)}" source="${me(r.fromHash)}" target="${me(r.toHash)}" weight="${r.strength}">`),i.push("        <attvalues>"),i.push(`          <attvalue for="e0" value="${r.packetCount}"/>`),i.push(`          <attvalue for="e1" value="${r.certainCount}"/>`),i.push(`          <attvalue for="e2" value="${r.avgConfidence}"/>`),i.push(`          <attvalue for="e3" value="${r.symmetryRatio}"/>`),i.push(`          <attvalue for="e4" value="${r.dominantDirection}"/>`),i.push(`          <attvalue for="e5" value="${a.has(r.key)}"/>`),i.push(`          <attvalue for="e6" value="${r.isLoopEdge??!1}"/>`),i.push(`          <attvalue for="e7" value="${r.isDirectPathEdge}"/>`),i.push(`          <attvalue for="e8" value="${r.isZeroHop??!1}"/>`),i.push(`          <attvalue for="e9" value="${l}"/>`),i.push(`          <attvalue for="e10" value="${r.floodCount}"/>`),i.push(`          <attvalue for="e11" value="${r.directCount}"/>`),i.push("        </attvalues>"),i.push("      </edge>")}return i.push("    </edges>"),i.push("  </graph>"),i.push("</gexf>"),i.join("\n")}function Se(e,t,s){const n={meta:{exportedAt:(new Date).toISOString(),pymcConsoleVersion:c,nodeCount:e.nodeMetrics.size,edgeCount:e.validatedEdges.length,communityCount:e.communityCount,loopCount:e.loops.length,backboneEdgeCount:e.backboneEdges.length,hubNodes:e.hubNodes.length,gatewayNodes:e.gatewayNodes.length,mobileNodes:e.mobileNodes.length,ghostNodes:e.discoveredNodes.filter(e=>e.isLikelyReal).length},nodes:ve(e,t),edges:ye(e,s),pathHealth:e.pathHealth.map(e=>({pathKey:e.pathKey,hops:e.hops,healthScore:e.healthScore,weakestLinkKey:e.weakestLinkKey,weakestLinkConfidence:e.weakestLinkConfidence,avgEdgeCertainty:e.avgEdgeCertainty,observationTrend:e.observationTrend,alternatePathsCount:e.alternatePathsCount,estimatedLatencyMs:e.estimatedLatencyMs,observationCount:e.observationCount,routeType:e.routeType,lastSeen:e.lastSeen,involvesHub:e.involvesHub})),txDelayRecommendations:Array.from(e.txDelayRecommendations.entries()).map(([t,s])=>{var n,a;return{nodeHash:t,nodePrefix:(null==(n=e.nodeMetrics.get(t))?void 0:n.prefix)??"",nodeName:(null==(a=e.nodeMetrics.get(t))?void 0:a.name)??null,networkRole:s.networkRole,floodFactor:s.floodFactor,directFactor:s.directFactor,floodSlots:s.floodSlots,directSlots:s.directSlots,trafficIntensity:s.trafficIntensity,collisionRisk:s.collisionRisk,confidence:s.confidence,adjustment:s.adjustment,dataConfidence:s.dataConfidence,rationale:s.rationale}}),loops:e.loops.map(e=>({id:e.id,nodes:e.nodes,edgeKeys:e.edgeKeys,size:e.size,avgCertainCount:e.avgCertainCount,minCertainCount:e.minCertainCount,includesLocal:e.includesLocal,strength:e.strength})),disambiguationStats:{totalPrefixes:e.disambiguationStats.totalPrefixes,unambiguousPrefixes:e.disambiguationStats.unambiguousPrefixes,collisionPrefixes:e.disambiguationStats.collisionPrefixes,collisionRate:e.disambiguationStats.collisionRate,avgConfidence:e.disambiguationStats.avgConfidence},viterbiStats:{totalPaths:e.viterbiStats.totalPaths,pathsWithGhosts:e.viterbiStats.pathsWithGhosts,avgPathConfidence:e.viterbiStats.avgPathConfidence,tracePacketsProcessed:e.viterbiStats.tracePacketsProcessed,pathPacketsProcessed:e.viterbiStats.pathPacketsProcessed,distantEdgesDiscovered:e.viterbiStats.distantEdgesDiscovered,duplicateGroupsFound:e.viterbiStats.duplicateGroupsFound,echolocationEdgesInferred:e.viterbiStats.echolocationEdgesInferred}};return JSON.stringify(n,null,2)}function De(e,t){const s=t.includeGhosts??!0,n=t.includeWeakEdges??!1;switch(t.format){case"csv":{let a,i;switch(t.dataset){case"nodes":case"full":default:a=function(e,t){const s=[];for(const n of e.nodeMetrics.values())!t&&n.isGhost||s.push(fe(n));return xe(ge,s)}(e,s),i="mesh-nodes";break;case"edges":a=function(e,t){const s=t?e.edges:e.validatedEdges,n=new Set(e.backboneEdges),a=s.map(t=>function(e,t,s){var n,a;return[e.fromHash,e.toHash,e.key,e.packetCount,e.certainCount,e.avgConfidence.toFixed(4),e.strength.toFixed(4),e.forwardCount,e.reverseCount,e.symmetryRatio.toFixed(4),e.dominantDirection,e.floodCount,e.directCount,e.isDirectPathEdge,e.isZeroHop??!1,e.isLoopEdge??!1,e.isCertain,(null==(n=e.avgRssi)?void 0:n.toFixed(1))??"",(null==(a=e.avgSnr)?void 0:a.toFixed(1))??"",e.avgRecency.toFixed(4),e.hopDistanceFromLocal,(t.get(e.key)??0).toFixed(6),s.has(e.key)]}(t,e.edgeBetweenness,n));return xe(be,a)}(e,n),i="mesh-edges";break;case"pathHealth":a=function(e){const t=e.pathHealth.map(Ne);return xe(je,t)}(e),i="mesh-path-health";break;case"txDelay":a=function(e){const t=[];for(const[s,n]of e.txDelayRecommendations)t.push(Ce(s,n,e.nodeMetrics));return xe(we,t)}(e),i="mesh-tx-delay"}return{content:a,filename:pe(i,"csv"),mimeType:"text/csv"}}case"gexf":return{content:ke(e,s),filename:pe("mesh-topology","gexf"),mimeType:"application/xml"};default:return{content:Se(e,s,n),filename:pe("mesh-topology","json"),mimeType:"application/json"}}}function Fe(e,t,s=1){const{n:n,adjList:a,totalWeight:i,degree:r}=e;if(0===i)return!1;const o=2*i,l=new Float64Array(n);for(let u=0;u<n;u++)l[t[u]]+=r[u];let c=!1,d=!0;for(;d;){d=!1;for(let e=0;e<n;e++){const n=t[e],u=r[e];if(0===u)continue;const x=new Map;for(const{j:s,w:i}of a[e]){const e=t[s];x.set(e,(x.get(e)??0)+i)}const m=-(x.get(n)??0)/i+s*(u*(l[n]-u))/(o*i);let h=n,p=0;for(const[e,t]of x){if(e===n)continue;const a=m+(t/i-s*(u*l[e])/(o*i));a>p+1e-7&&(p=a,h=e)}h!==n&&(l[n]-=u,l[h]+=u,t[e]=h,d=!0,c=!0)}}return c}function Le(e,t){const{n:s,adjList:n}=e,a=new Set;for(let m=0;m<s;m++)a.add(t[m]);const i=Array.from(a).sort((e,t)=>e-t),r=new Map;for(let m=0;m<i.length;m++)r.set(i[m],m);const o=i.length,l=new Int32Array(s);for(let m=0;m<s;m++)l[m]=r.get(t[m]);const c=new Map,d=new Float64Array(o);let u=0;for(let m=0;m<s;m++){const e=l[m];for(const{j:t,w:s}of n[m]){const n=l[t];if(e===n)continue;const a=e<=n?`${e}-${n}`:`${n}-${e}`;c.set(a,(c.get(a)??0)+s)}}const x=Array.from({length:o},()=>[]);for(const[m,h]of c){const[e,t]=m.split("-").map(Number),s=h/2;x[e].push({j:t,w:s}),x[t].push({j:e,w:s}),d[e]+=s,d[t]+=s,u+=s}return{newGraph:{n:o,adjList:x,totalWeight:u,degree:Array.from(d)},mapping:l}}function Re(e,t,s){const n=(null==s?void 0:s.resolution)??1,a=(null==s?void 0:s.kWeight)??1,i=t.length;if(0===i)return{communities:new Map,numCommunities:0,modularity:0,passes:0};if(1===i)return{communities:new Map([[t[0],0]]),numCommunities:1,modularity:0,passes:0};const{graph:r}=function(e,t,s=1){const n=t.length,a=new Map;for(let l=0;l<n;l++)a.set(t[l],l);const i=Array.from({length:n},()=>[]),r=new Array(n).fill(0);let o=0;for(const l of e){const e=a.get(l.fromHash),t=a.get(l.toHash);if(void 0===e||void 0===t)continue;if(e===t)continue;const n=Math.max(.01,(l.certainCount+1)*l.avgConfidence*l.strength),c=1===s?n:Math.pow(n,s);i[e].push({j:t,w:c}),i[t].push({j:e,w:c}),r[e]+=c,r[t]+=c,o+=c}return{graph:{n:n,adjList:i,totalWeight:o,degree:r},hashToIdx:a}}(e,t,a);let o=r,l=new Int32Array(i);for(let v=0;v<i;v++)l[v]=v;const c=[];let d=0;for(;d<10&&Fe(o,l,n);){d++;const{newGraph:e,mapping:t}=Le(o,l);if(c.push(t),e.n>=o.n)break;o=e,l=new Int32Array(e.n);for(let s=0;s<e.n;s++)l[s]=s}const u=new Int32Array(i);for(let v=0;v<i;v++)u[v]=v;for(const v of c)for(let e=0;e<i;e++)u[e]=v[u[e]];for(let v=0;v<i;v++)u[v]=l[u[v]];const x=new Set;for(let v=0;v<i;v++)x.add(u[v]);const m=Array.from(x).sort((e,t)=>e-t),h=new Map;for(let v=0;v<m.length;v++)h.set(m[v],v);const p=new Map;for(let v=0;v<i;v++)p.set(t[v],h.get(u[v]));const g=new Int32Array(i);for(let v=0;v<i;v++)g[v]=h.get(u[v]);const f=function(e,t,s=1){const{n:n,adjList:a,totalWeight:i,degree:r}=e;if(0===i)return 0;const o=2*i;let l=0;for(let c=0;c<n;c++)for(const{j:e,w:n}of a[c])t[c]===t[e]&&(l+=n-s*(r[c]*r[e])/o);return l/o}(r,g,n);return{communities:p,numCommunities:m.length,modularity:f,passes:d}}const Me={7:-124,8:-127,9:-130,10:-133,11:-135.5,12:-137},Be={62.5:3,125:0,250:-3,500:-6},He={5:0,6:-.6,7:-1.1,8:-1.5};function Ae(e,t){if(e<=0)return 0;const s=1e6*t;return 20*Math.log10(e)+20*Math.log10(s)+20*Math.log10(4*Math.PI/299792458)}function Ee(e,t,s=5){return(Me[e]??Me[12])+(Be[t]??0)+(He[s]??0)}function Pe(e,t=6){return 10*Math.log10(e)-174+t}function ze(e){return e>=20?"excellent":e>=10?"good":e>=3?"fair":e>=0?"marginal":"critical"}function Te(e){return e>=15?"anomalous-good":e>=5?"better":e>=-5?"expected":e>=-20?"worse":"anomalous-bad"}function $e(e,t,s,n,a){const i=n.tx_power??22,r=n.spreading_factor??12,o=n.coding_rate??5,l=n.frequency??0,c=l>1e5?l/1e6:l||915,d=n.bandwidth??0,u=d>1e3?d/1e3:d||125,x=(null==a?void 0:a.sensitivityOverrideDbm)??Ee(r,u,o);let m=null,h=null;t&&s&&I(t.latitude??void 0,t.longitude??void 0)&&I(s.latitude??void 0,s.longitude??void 0)&&(m=G(t.latitude,t.longitude,s.latitude,s.longitude),h=m/1e3);let p=null,g=null;null!=m&&m>0&&(p=Ae(m,c),g=i+2.15+2.15-p);const f=e.avgRssi??null,v=e.avgSnr??null;let b=null,y=null;null!=f&&null!=g&&(b=f-g,y=Te(b));let j=null,N=null;null!=f&&(j=f-x,N=ze(j));const w=null!=f,C="anomalous-good"===y||"anomalous-bad"===y;return{edgeKey:e.key,fromHash:e.fromHash,toHash:e.toHash,distanceM:m,distanceKm:h,fsplDb:p,theoreticalRxPowerDbm:g,observedRssiDbm:f,observedSnrDb:v,deviationDb:b,deviationClass:y,marginDb:j,marginClass:N,sensitivityDbm:x,txPowerDbm:i,frequencyMhz:c,spreadingFactor:r,bandwidthKhz:u,noiseFloorDbm:null,isZeroHop:e.isZeroHop??!1,isTraceEstimated:!1,hasData:w,isAnomalous:C}}function Ie(e,t,s,n,a=22,i){const r=e.traceQuality;if(!r)return null;let o=null;if(o=null!=r.forwardSnr&&null!=r.reverseSnr?Math.min(r.forwardSnr,r.reverseSnr):r.forwardSnr??r.reverseSnr,null==o)return null;const l=n.spreading_factor??12,c=n.coding_rate??5,d=n.bandwidth??0,u=d>1e3?d/1e3:d||125,x=1e3*u,m=n.frequency??0,h=m>1e5?m/1e6:m||915,p=(null==i?void 0:i.sensitivityOverrideDbm)??Ee(l,u,c),g=(null==i?void 0:i.observedNoiseFloorDbm)??Pe(x),f=g+o;let v=null,b=null;t&&s&&I(t.latitude??void 0,t.longitude??void 0)&&I(s.latitude??void 0,s.longitude??void 0)&&(v=G(t.latitude,t.longitude,s.latitude,s.longitude),b=v/1e3);let y=null,j=null;null!=v&&v>0&&(y=Ae(v,h),j=a+2.15+2.15-y);let N=null,w=null;null!=j&&(N=f-j,w=Te(N));const C=f-p,k=ze(C);return{edgeKey:e.key,fromHash:e.fromHash,toHash:e.toHash,distanceM:v,distanceKm:b,fsplDb:y,theoreticalRxPowerDbm:j,observedRssiDbm:f,observedSnrDb:o,deviationDb:N,deviationClass:w,marginDb:C,marginClass:k,sensitivityDbm:p,noiseFloorDbm:g,txPowerDbm:a,frequencyMhz:h,spreadingFactor:l,bandwidthKhz:u,isZeroHop:!1,isTraceEstimated:!0,hasData:!0,isAnomalous:"anomalous-good"===w||"anomalous-bad"===w}}const Ge={"anomalous-good":"#2DD4BF",better:"#34D399",expected:"#9CA3AF",worse:"#FB923C","anomalous-bad":"#EF4444"},Oe={excellent:"#34D399",good:"#A3E635",fair:"#FBBF24",marginal:"#FB923C",critical:"#EF4444"};function Ze(e,t="margin"){return e.hasData?"deviation"===t?e.deviationClass?Ge[e.deviationClass]:"#505058":e.marginClass?Oe[e.marginClass]:"#505058":"#505058"}function We(e,t=.5,s=4){return null==e.marginDb?t:t+Math.max(0,Math.min(1,e.marginDb/40))*(s-t)}let Ve=0;function Ke(){return`ta-${++Ve}-${Date.now()}`}function _e(e){return{standard:0,ghost:1,mobile:2,neighbor:3,backbone:4,gateway:5,hub:6,local:7}[e]??0}class qe{constructor(e=200){t(this,"prevSnapshot",null),t(this,"log",[]),t(this,"maxLog"),this.maxLog=e}update(e,t){const s=function(e){const t=new Set;for(const o of e.edges)t.add(o.key);const s=new Map,n=new Map,a=new Map,i=new Set;for(const[o,l]of e.nodeMetrics)s.set(o,l.betweenness),n.set(o,l.communityId),a.set(o,l.nodeClass),i.add(o);const r=new Set;for(const o of e.discoveredNodes)o.isLikelyReal&&r.add(o.prefix);return{timestamp:Date.now(),edgeKeys:t,betweenness:s,communities:n,nodeClasses:a,ghostPrefixes:r,nodeHashes:i}}(e);if(!this.prevSnapshot)return this.prevSnapshot=s,{anomalies:[],categoryCounts:{"edge-appeared":0,"edge-disappeared":0,"ghost-appeared":0,"ghost-disappeared":0,"betweenness-shift":0,"community-change":0,"class-change":0,"node-appeared":0,"node-disappeared":0},severityCounts:{info:0,warning:0,critical:0},totalCount:0,timestamp:Date.now()};const n=function(e,t,s){const n=Date.now(),a=[],i=e=>(null==s?void 0:s.get(e))??null;for(const d of t.edgeKeys)if(!e.edgeKeys.has(d)){const[e,t]=d.split("-"),s=i(e)??(null==e?void 0:e.slice(0,6)),r=i(t)??(null==t?void 0:t.slice(0,6));a.push({id:Ke(),detectedAt:n,category:"edge-appeared",severity:"info",description:`New edge: ${s} ↔ ${r}`,edgeKey:d})}for(const d of e.edgeKeys)if(!t.edgeKeys.has(d)){const[e,t]=d.split("-"),s=i(e)??(null==e?void 0:e.slice(0,6)),r=i(t)??(null==t?void 0:t.slice(0,6));a.push({id:Ke(),detectedAt:n,category:"edge-disappeared",severity:"warning",description:`Edge lost: ${s} ↔ ${r}`,edgeKey:d})}for(const d of t.nodeHashes)if(!e.nodeHashes.has(d)){const e=i(d);a.push({id:Ke(),detectedAt:n,category:"node-appeared",severity:"info",description:`Node appeared: ${e??d.slice(0,8)}`,nodeHash:d,nodeName:e??void 0})}for(const d of e.nodeHashes)if(!t.nodeHashes.has(d)){const e=i(d);a.push({id:Ke(),detectedAt:n,category:"node-disappeared",severity:"warning",description:`Node dropped: ${e??d.slice(0,8)}`,nodeHash:d,nodeName:e??void 0})}for(const d of t.ghostPrefixes)e.ghostPrefixes.has(d)||a.push({id:Ke(),detectedAt:n,category:"ghost-appeared",severity:"info",description:`Ghost node discovered: ${d.toUpperCase()}`});for(const d of e.ghostPrefixes)t.ghostPrefixes.has(d)||a.push({id:Ke(),detectedAt:n,category:"ghost-disappeared",severity:"info",description:`Ghost node resolved: ${d.toUpperCase()}`});for(const[d,u]of t.betweenness){const t=e.betweenness.get(d);if(void 0===t)continue;const s=Math.abs(u-t);if(s>=.15){const e=i(d),r=u>t?"increased":"decreased";a.push({id:Ke(),detectedAt:n,category:"betweenness-shift",severity:s>=.3?"critical":"warning",description:`${e??d.slice(0,8)} betweenness ${r}: ${t.toFixed(3)} → ${u.toFixed(3)}`,nodeHash:d,nodeName:e??void 0,previousValue:t,currentValue:u})}}for(const[d,u]of t.communities){const t=e.communities.get(d);if(void 0!==t&&u!==t){const e=i(d);a.push({id:Ke(),detectedAt:n,category:"community-change",severity:"info",description:`${e??d.slice(0,8)} moved: community #${t} → #${u}`,nodeHash:d,nodeName:e??void 0,previousValue:t,currentValue:u})}}for(const[d,u]of t.nodeClasses){const t=e.nodeClasses.get(d);if(void 0!==t&&u!==t){const e=i(d),s=_e(u)>_e(t);a.push({id:Ke(),detectedAt:n,category:"class-change",severity:s?"warning":"info",description:`${e??d.slice(0,8)} ${s?"promoted":"changed"}: ${t} → ${u}`,nodeHash:d,nodeName:e??void 0,previousValue:t,currentValue:u})}}const r={},o={},l=["edge-appeared","edge-disappeared","ghost-appeared","ghost-disappeared","betweenness-shift","community-change","class-change","node-appeared","node-disappeared"],c=["info","warning","critical"];for(const d of l)r[d]=0;for(const d of c)o[d]=0;for(const d of a)r[d.category]++,o[d.severity]++;return a.sort((e,t)=>t.detectedAt-e.detectedAt),{anomalies:a,categoryCounts:r,severityCounts:o,totalCount:a.length,timestamp:n}}(this.prevSnapshot,s,t);this.prevSnapshot=s;try{!function(e,t){const s=t.edgeMap,n=t.nodeMetrics,a=new Set(t.backboneEdges??[]);for(const i of e){if(i.edgeKey&&("edge-appeared"===i.category||"edge-disappeared"===i.category)){const e=null==s?void 0:s.get(i.edgeKey),t=i.edgeKey.split("-"),r=t[0],o=t[1],l=r?null==n?void 0:n.get(r):void 0,c=o?null==n?void 0:n.get(o):void 0;i.edgeDetail=e?{fromName:(null==l?void 0:l.name)??null,toName:(null==c?void 0:c.name)??null,fromClass:(null==l?void 0:l.nodeClass)??null,toClass:(null==c?void 0:c.nodeClass)??null,packetCount:e.packetCount,confidence:e.avgConfidence,symmetryRatio:e.symmetryRatio,isBackbone:a.has(i.edgeKey),isLoop:e.isLoopEdge??!1,isZeroHop:e.isZeroHop??!1,isDirectPath:e.isDirectPathEdge,avgRssi:e.avgRssi??null,avgSnr:e.avgSnr??null,fromBetweenness:(null==l?void 0:l.betweenness)??null,toBetweenness:(null==c?void 0:c.betweenness)??null}:{fromName:(null==l?void 0:l.name)??null,toName:(null==c?void 0:c.name)??null,fromClass:(null==l?void 0:l.nodeClass)??null,toClass:(null==c?void 0:c.nodeClass)??null,packetCount:0,confidence:0,symmetryRatio:0,isBackbone:!1,isLoop:!1,isZeroHop:!1,isDirectPath:!1,avgRssi:null,avgSnr:null,fromBetweenness:(null==l?void 0:l.betweenness)??null,toBetweenness:(null==c?void 0:c.betweenness)??null}}if(i.nodeHash){const e=null==n?void 0:n.get(i.nodeHash);e&&(i.nodeDetail=Ue(e))}}}(n.anomalies,e)}catch(a){}return this.log.unshift(...n.anomalies),this.log.length>this.maxLog&&(this.log.length=this.maxLog),n}getLog(){return this.log}getFiltered(e){const t=Date.now();return this.log.filter(s=>!(e.category&&s.category!==e.category||e.severity&&s.severity!==e.severity||e.nodeHash&&s.nodeHash!==e.nodeHash||e.maxAge&&t-s.detectedAt>e.maxAge))}clear(){this.log=[],this.prevSnapshot=null}}function Ue(e){return{nodeClass:e.nodeClass,degree:e.degree,betweenness:e.betweenness,activityLevel:e.activityLevel,isZeroHop:e.isZeroHop,avgRssi:e.avgRssi,avgSnr:e.avgSnr,communityId:e.communityId,packetCount:e.packetCount,connectionCount:e.degree}}function Xe(e){if(e.length<2)return 0;const t=e.length;let s=0,n=0,a=0,i=0;for(let o=0;o<t;o++)s+=o,n+=e[o],a+=o*e[o],i+=o*o;const r=t*i-s*s;return 0===r?0:(t*a-s*n)/r}const Ye=.15;function Qe(e,t,s){if(e.observationCount<5)return null;const n=[];let a=0;e.observationTrend<0&&(a=Math.abs(e.observationTrend),n.push({name:"Declining usage",description:e.observationTrend<-.3?"Traffic rapidly declining":"Traffic gradually declining",score:a,weight:.35}));const i=1-Math.min(1,e.avgEdgeCertainty);i>.3&&n.push({name:"Weak link certainty",description:e.weakestLinkKey?`Weakest: ${e.weakestLinkConfidence<.3?"very low":"low"} confidence`:`Average certainty: ${(100*e.avgEdgeCertainty).toFixed(0)}%`,score:i,weight:.3});let r=0;0===e.alternatePathsCount?(r=1,n.push({name:"No alternate paths",description:"Single route to destination — no failover available",score:r,weight:.2})):1===e.alternatePathsCount&&(r=.5,n.push({name:"Limited redundancy",description:"Only 1 alternate path available",score:r,weight:.2}));let o=0;if(e.weakestLinkKey){const a=t.get(e.weakestLinkKey);if(null!=(null==a?void 0:a.avgRssi)){const e=a.avgRssi-s;e<3?(o=1,n.push({name:"Signal near sensitivity",description:`Weakest link: ${e.toFixed(1)} dB margin (< 3 dB)`,score:o,weight:Ye})):e<10&&(o=1-(e-3)/7,n.push({name:"Low signal margin",description:`Weakest link: ${e.toFixed(1)} dB margin`,score:o,weight:Ye}))}}const l=.35*a+.3*i+.2*r+o*Ye;if(l<.35)return null;let c,d;return l>=.75?(c="critical",d="imminent"):l>=.55?(c="high",d="near-term"):(c="moderate",d="watch"),{pathKey:e.pathKey,hops:e.hops,riskScore:Math.round(100*l)/100,riskLevel:c,factors:n,weakestEdgeKey:e.weakestLinkKey,healthScore:e.healthScore,observationTrend:e.observationTrend,alternatePathsCount:e.alternatePathsCount,urgency:d}}let Je=100;function et(){return++Je}const tt="meshgraph-panel-";function st(e){try{const t=localStorage.getItem(tt+e);return t?JSON.parse(t):null}catch{return null}}function nt({id:e,title:t,icon:a,open:i,onClose:r,defaultPosition:o,defaultSize:l,minSize:c={width:180,height:120},maxSize:d,autoHeight:u=!1,headerActions:g,children:f}){const v=O(),b=s.useRef(null),y=s.useRef(null),j=s.useMemo(()=>{const t=st(e);return t?{x:t.x,y:t.y,w:t.w,h:u?l.height:t.h,minimized:t.minimized}:{x:o.x,y:o.y,w:l.width,h:l.height,minimized:!1}},[e]),[N,w]=s.useState({w:j.w,h:j.h}),[C,k]=s.useState(j.minimized),[S,D]=s.useState(()=>et()),[F,L]=s.useState({x:j.x,y:j.y});s.useLayoutEffect(()=>{const t=b.current;if(!i||!t)return;const s=t.getBoundingClientRect();if(s.width<1||s.height<1)return;const n=st(e),a=(r=(null==n?void 0:n.x)??j.x,o=(null==n?void 0:n.y)??j.y,l=(null==n?void 0:n.w)??N.w,c=s.width,d=s.height,{x:Math.max(8,Math.min(r,Math.max(8,c-l-8))),y:Math.max(8,Math.min(o,Math.max(8,d-36)))});var r,o,l,c,d;L(a)},[i,e]);const[R,M]=s.useState(!1),B=s.useRef({startX:0,startY:0,startW:0,startH:0,edge:""}),H=s.useRef(),A=s.useCallback(()=>{H.current&&clearTimeout(H.current),H.current=setTimeout(()=>{const t=y.current;if(!t)return;const s=window.getComputedStyle(t),n=new DOMMatrix(s.transform);!function(e,t){try{localStorage.setItem(tt+e,JSON.stringify(t))}catch{}}(e,{x:n.m41,y:n.m42,w:N.w,h:N.h,minimized:C})},300)},[e,N.w,N.h,C]);s.useEffect(()=>{A()},[N,C,A]);const E=s.useCallback(()=>{D(et())},[]),P=s.useCallback(()=>{k(e=>!e)},[]),z=s.useCallback((e,t)=>{e.preventDefault(),e.stopPropagation(),M(!0),B.current={startX:e.clientX,startY:e.clientY,startW:N.w,startH:N.h,edge:t},E();const s=e=>{const{startX:t,startY:s,startW:n,startH:a,edge:i}=B.current,r=e.clientX-t,o=e.clientY-s;let l=n,u=a;"e"!==i&&"se"!==i||(l=Math.max(c.width,n+r),d&&(l=Math.min(d.width,l))),"s"!==i&&"se"!==i||(u=Math.max(c.height,a+o),d&&(u=Math.min(d.height,u))),w({w:l,h:u})},n=()=>{M(!1),window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",n)};window.addEventListener("pointermove",s),window.addEventListener("pointerup",n)},[N,c,d,E]);return n.jsx("div",{ref:b,className:"absolute inset-0 pointer-events-none",style:{zIndex:S},children:n.jsx(x,{children:i&&n.jsxs(m.div,{ref:y,drag:!R,dragControls:v,dragConstraints:b,dragElastic:.05,dragMomentum:!1,dragListener:!1,initial:{opacity:0,scale:.96,x:F.x,y:F.y},animate:{opacity:1,scale:1,x:F.x,y:F.y},exit:{opacity:0,scale:.96},transition:{duration:.15},onPointerDown:E,className:"absolute top-0 left-0 pointer-events-auto",style:{width:N.w,touchAction:"none"},children:[n.jsxs("div",{className:"surface-elevated radius-inset shadow-xl overflow-hidden flex flex-col",style:{maxHeight:C?void 0:u?"80vh":N.h},children:[n.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1.5 border-b border-border-subtle cursor-grab active:cursor-grabbing select-none shrink-0",onPointerDown:e=>{E(),v.start(e)},children:[n.jsx(Z,{className:"w-3 h-3 text-text-muted/50 shrink-0"}),a&&n.jsx("span",{className:"text-text-muted shrink-0 [&>svg]:w-3 [&>svg]:h-3",children:a}),n.jsx("span",{className:"text-[11px] font-medium text-text-primary flex-1 truncate",children:t}),g,n.jsx("button",{onClick:P,className:"p-0.5 radius-badge hover-bg transition-base",title:C?"Expand":"Minimize",children:C?n.jsx(W,{className:"w-2.5 h-2.5 text-text-muted"}):n.jsx(h,{className:"w-2.5 h-2.5 text-text-muted"})}),n.jsx("button",{onClick:r,className:"p-0.5 radius-badge hover-bg transition-base",title:"Close",children:n.jsx(p,{className:"w-2.5 h-2.5 text-text-muted"})})]}),n.jsx(x,{initial:!1,children:!C&&n.jsx(m.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.15},className:"overflow-hidden",children:n.jsx("div",{className:"overflow-y-auto",style:{maxHeight:u?"70vh":void 0},children:f})})})]}),!C&&!u&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"absolute top-0 -right-1 w-2 h-full cursor-ew-resize",onPointerDown:e=>z(e,"e")}),n.jsx("div",{className:"absolute -bottom-1 left-0 w-full h-2 cursor-ns-resize",onPointerDown:e=>z(e,"s")}),n.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 cursor-nwse-resize",onPointerDown:e=>z(e,"se"),children:n.jsxs("svg",{className:"w-full h-full text-text-muted/30",viewBox:"0 0 12 12",children:[n.jsx("path",{d:"M10 2 L10 10 L2 10",fill:"none",stroke:"currentColor",strokeWidth:"1.5"}),n.jsx("path",{d:"M7 5 L7 7 L5 7",fill:"none",stroke:"currentColor",strokeWidth:"1"})]})})]})]})})})}const at=800,it={critical:["#EF4444","#DC2626"],poor:["#F97316","#EA580C"],fair:["#FBBF24","#D97706"],good:["#34D399","#059669"],excellent:["#60A5FA","#2563EB"]},rt={active:1,recent:.85,stale:.45,inactive:.25},ot=["#A78BFA","#34D399","#FBBF24","#F87171","#60A5FA","#F472B6","#2DD4BF","#FB923C"],lt=["#7C3AED","#059669","#D97706","#DC2626","#2563EB","#DB2777","#0D9488","#EA580C"],ct={zeroHop:"#C8A850",directPath:"#70A8AA",loop:"#9888B0",backbone:"#B0B0B8",standard:"#707078",standardDim:"#505058",ghost:"#606068"},dt={zeroHop:"#A08030",directPath:"#308080",loop:"#685898",backbone:"#404048",standard:"#909098",standardDim:"#B0B0B8",ghost:"#A0A0A8"},ut=!1,xt=!0,mt=!0,ht=!0,pt=!0,gt=!0,ft={local:"#FFB224",hub:"#A78BFA",gateway:"#60A5FA",backbone:"#34D399",neighbor:"#F472B6",mobile:"#FB923C",ghost:"#A1A1AA",standard:"#D4D4D8"},vt={local:"#FFB224",hub:"#7C3AED",gateway:"#2563EB",backbone:"#059669",neighbor:"#DB2777",mobile:"#EA580C",ghost:"#71717A",standard:"#52525B"},bt={local:"Your repeater — the home node running this dashboard",hub:"≥10% of last-hop traffic — dominant forwarder for your local node",gateway:"7-10% of last-hop traffic — significant relay node",backbone:"High betweenness centrality — critical path node connecting clusters",neighbor:"Zero-hop direct RF contact — no intermediate forwarders",mobile:"High path volatility — node appears and disappears frequently",ghost:"Unresolved prefix inferred by Viterbi HMM from path patterns",standard:"<7% of traffic — normal mesh participant"};function yt(e){const t=e.replace("#","");return[parseInt(t.slice(0,2),16),parseInt(t.slice(2,4),16),parseInt(t.slice(4,6),16)]}function jt(e,t,s){const[n,a,i]=yt(e),[r,o,l]=yt(t),c=Math.max(0,Math.min(1,s)),d=Math.round(n*c+r*(1-c)),u=Math.round(a*c+o*(1-c)),x=Math.round(i*c+l*(1-c));return`#${d.toString(16).padStart(2,"0")}${u.toString(16).padStart(2,"0")}${x.toString(16).padStart(2,"0")}`}function Nt(e,t){return e.isZeroHop?"zero-hop":e.isDirectPathEdge?"direct-path":e.isLoopEdge?"loop":t.has(e.key)?"backbone":"standard"}function wt(e,t,s){const n=s?ct:dt;switch(e){case"zero-hop":return n.zeroHop;case"direct-path":return n.directPath;case"loop":return n.loop;case"backbone":return n.backbone;case"ghost":return n.ghost;default:return t>=.7?n.standard:n.standardDim}}const Ct={"zero-hop":"Zero-Hop (Direct RF)","direct-path":"Direct Path (Unicast)",loop:"Redundant Loop",backbone:"Backbone",standard:"Standard",ghost:"Ghost (Inferred)"},kt={"zero-hop":"Direct radio contact — no intermediate forwarders in path","direct-path":"Unicast-routed edge — verified via DIRECT route type packets",loop:"Redundant path — alternate route between the same endpoints exists",backbone:"High betweenness centrality — critical traffic flow edge",standard:"Normal mesh edge with moderate-to-high confidence",ghost:"Inferred connection from Viterbi HMM ghost node analysis"},St=s.memo(function({timeline:e}){const t=e.buckets;if(t.length<2)return null;const[s,a]=e.rssiRange,i=Math.max(1,a-s),[r,o]=e.snrRange,l=Math.max(1,o-r),c=198/(t.length-1),d=t.map((e,t)=>{const n=1+t*c,a=1+34*(1-(e.avgRssi-s)/i);return`${n.toFixed(1)},${a.toFixed(1)}`}).join(" "),u=t.map((e,t)=>{const s=1+t*c,n=1+34*(1-(e.avgSnr-r)/l);return`${s.toFixed(1)},${n.toFixed(1)}`}).join(" "),x=e.rssiTrend>.1?"↑":e.rssiTrend<-.1?"↓":"→",m=e.snrTrend>.1?"↑":e.snrTrend<-.1?"↓":"→",h=e.rssiTrend>.1?"#34D399":e.rssiTrend<-.1?"#EF4444":"#9CA3AF",p=e.snrTrend>.1?"#34D399":e.snrTrend<-.1?"#EF4444":"#9CA3AF",g=(e.timeSpanMs/36e5).toFixed(1),f=function(e){const t=e.rssiTrend<-.1,s=e.snrTrend<-.1,n=e.rssiTrend>.1,a=e.snrTrend>.1,i=e.rssiRange[1]-e.rssiRange[0],r=e.snrRange[1]-e.snrRange[0];return t&&s?{text:"Both RSSI and SNR declining — possible antenna degradation or increasing distance",color:"#EF4444"}:s&&!t?{text:"SNR declining while RSSI stable — likely RF interference or noise floor increase",color:"#F97316"}:t&&!s?{text:"RSSI declining while SNR stable — possible path obstruction or power change",color:"#F97316"}:n&&a?{text:"Signal improving — conditions favorable or antenna adjustment working",color:"#34D399"}:i>15||r>10?{text:"High signal variance — intermittent obstruction or multipath fading",color:"#FBBF24"}:{text:"Signal stable — no significant degradation detected",color:"#9CA3AF"}}(e);return n.jsxs("div",{className:"mt-2 pt-2 border-t border-border-subtle/50",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx(F,{content:n.jsxs("div",{className:"max-w-xs space-y-1.5",children:[n.jsx("div",{className:"font-semibold text-text-primary",children:"Signal Quality Over Time"}),n.jsx("div",{className:"text-text-secondary text-[11px]",children:"Tracks RSSI (signal power) and SNR (signal-to-noise ratio) for zero-hop packets received directly from this neighbor. Reveals weather effects, interference, and antenna degradation."}),n.jsxs("div",{className:"pt-1 border-t border-border-subtle/30 space-y-0.5 font-mono text-[10px]",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-text-muted",children:"Samples"}),n.jsx("span",{className:"text-text-primary tabular-nums",children:e.totalSamples})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-text-muted",children:"Time span"}),n.jsxs("span",{className:"text-text-primary tabular-nums",children:[g,"h"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-text-muted",children:"Avg RSSI"}),n.jsxs("span",{className:"text-text-primary tabular-nums",children:[e.avgRssi.toFixed(1)," dBm"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-text-muted",children:"Avg SNR"}),n.jsxs("span",{className:"text-text-primary tabular-nums",children:[e.avgSnr.toFixed(1)," dB"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-text-muted",children:"RSSI trend"}),n.jsxs("span",{className:"tabular-nums",style:{color:h},children:[e.rssiTrend>0?"+":"",e.rssiTrend.toFixed(3)," dBm/bucket"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-text-muted",children:"SNR trend"}),n.jsxs("span",{className:"tabular-nums",style:{color:p},children:[e.snrTrend>0?"+":"",e.snrTrend.toFixed(3)," dB/bucket"]})]})]}),n.jsxs("div",{className:"text-[10px] text-text-muted italic",children:["Trend is linear regression slope across ",t.length," time buckets. ↑ = improving, ↓ = degrading, → = stable."]})]}),children:n.jsx("span",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Signal Timeline"})}),n.jsxs("span",{className:"text-[9px] text-text-muted tabular-nums",children:[e.totalSamples," samples · ",g,"h"]})]}),n.jsxs("svg",{viewBox:"0 0 200 36",className:"w-full h-9",preserveAspectRatio:"none",children:[n.jsx("polyline",{points:d,fill:"none",stroke:"#60A5FA",strokeWidth:"1.5",strokeLinejoin:"round",strokeLinecap:"round",opacity:"0.8"}),n.jsx("polyline",{points:u,fill:"none",stroke:"#34D399",strokeWidth:"1",strokeLinejoin:"round",strokeLinecap:"round",opacity:"0.5",strokeDasharray:"3 2"})]}),n.jsxs("div",{className:"flex items-center justify-between text-[9px] mt-0.5",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:"flex items-center gap-0.5",children:[n.jsx("span",{className:"w-2.5 h-[1.5px] bg-[#60A5FA] rounded-full inline-block"}),n.jsx("span",{className:"text-text-muted",children:"RSSI"}),n.jsx("span",{className:"tabular-nums",style:{color:h},children:x})]}),n.jsxs("span",{className:"flex items-center gap-0.5",children:[n.jsx("span",{className:"w-2.5 h-[1px] bg-[#34D399] rounded-full inline-block opacity-50",style:{borderTop:"1px dashed #34D399"}}),n.jsx("span",{className:"text-text-muted",children:"SNR"}),n.jsx("span",{className:"tabular-nums",style:{color:p},children:m})]})]}),n.jsxs("div",{className:"flex items-center gap-2 text-text-muted tabular-nums",children:[n.jsxs("span",{children:[s.toFixed(0),"…",a.toFixed(0)," dBm"]}),n.jsxs("span",{children:[r.toFixed(0),"…",o.toFixed(0)," dB"]})]})]}),n.jsx("div",{className:"mt-1 text-[9px] leading-tight",style:{color:f.color},children:f.text})]})}),Dt=s.memo(function({edge:e,onClose:t}){const[a,i]=s.useState(null);return s.useEffect(()=>{if(!e.isZeroHop&&"zero-hop"!==e.edgeType)return void i(null);const t=$.getState().packets,s=$.getState().cachedLocalHash??void 0,n=function(e,t,s,n,a=24){const i=function(e,t,s,n){var a;const i=[],r=t.replace(/^0x/i,"").slice(0,2).toLowerCase();for(const o of e){if(o.transmitted)continue;if(null==o.rssi||null==o.snr)continue;if(0===o.rssi&&0===o.snr)continue;const e=(null==(a=o.src_hash)?void 0:a.replace(/^0x/i,""))??"";if(e.slice(0,2).toLowerCase()!==r&&e!==t.replace(/^0x/i,""))continue;const s=o.original_path??o.forwarded_path??[],l=d(s,n),c=(null==l?void 0:l.effectiveLength)??0,x=o.route??o.route_type;let m=!1;m=null!=x&&u(x)?c<=1:0===c,m&&i.push({timestamp:1e3*o.timestamp,rssi:o.rssi,snr:o.snr})}if(i.sort((e,t)=>e.timestamp-t.timestamp),i.length>0&&i[0].timestamp<4102444800)for(const o of i)o.timestamp*=1e3;return i}(e,t,0,n);if(i.length<3)return null;const r=function(e,t=24){if(0===e.length)return[];const s=e[0].timestamp,n=e[e.length-1].timestamp-s;if(n<=0)return[{timestamp:s,avgRssi:e.reduce((e,t)=>e+t.rssi,0)/e.length,avgSnr:e.reduce((e,t)=>e+t.snr,0)/e.length,minRssi:Math.min(...e.map(e=>e.rssi)),maxRssi:Math.max(...e.map(e=>e.rssi)),minSnr:Math.min(...e.map(e=>e.snr)),maxSnr:Math.max(...e.map(e=>e.snr)),count:e.length}];const a=n/t,i=[];for(let o=0;o<t;o++)i.push({timestamp:s+(o+.5)*a,avgRssi:0,avgSnr:0,minRssi:1/0,maxRssi:-1/0,minSnr:1/0,maxSnr:-1/0,count:0});for(const o of e){const e=i[Math.min(t-1,Math.floor((o.timestamp-s)/a))];e.avgRssi+=o.rssi,e.avgSnr+=o.snr,e.minRssi=Math.min(e.minRssi,o.rssi),e.maxRssi=Math.max(e.maxRssi,o.rssi),e.minSnr=Math.min(e.minSnr,o.snr),e.maxSnr=Math.max(e.maxSnr,o.snr),e.count++}const r=[];for(const o of i)o.count>0&&(o.avgRssi/=o.count,o.avgSnr/=o.count,r.push(o));return r}(i,a);if(r.length<2)return null;let o=0,l=0,c=1/0,x=-1/0,m=1/0,h=-1/0;for(const d of i)o+=d.rssi,l+=d.snr,c=Math.min(c,d.rssi),x=Math.max(x,d.rssi),m=Math.min(m,d.snr),h=Math.max(h,d.snr);const p=Xe(r.map(e=>e.avgRssi)),g=Xe(r.map(e=>e.avgSnr)),f=i[0].timestamp,v=i[i.length-1].timestamp;return{buckets:r,totalSamples:i.length,rssiRange:[c,x],snrRange:[m,h],avgRssi:o/i.length,avgSnr:l/i.length,rssiTrend:p,snrTrend:g,timeSpanMs:v-f}}(t,e.source,e.target,s);i(n)},[e.source,e.target,e.isZeroHop,e.edgeType]),n.jsxs(m.div,{variants:X,initial:"hidden",animate:"visible",exit:"exit",className:"absolute inset-x-3 bottom-3 z-20 surface-elevated radius-inset shadow-xl",children:[n.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5 border-b border-border-subtle/50",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[n.jsx(re,{className:"size-3.5 text-text-muted shrink-0"}),n.jsxs("span",{className:"text-sm font-semibold text-text-primary truncate",children:[e.fromName??e.source.slice(0,6)," → ",e.toName??e.target.slice(0,6)]}),n.jsxs("div",{className:"flex gap-1 shrink-0",children:[n.jsx(D,{color:"zinc",compact:!0,children:Ct[e.edgeType]}),e.isBackbone&&n.jsx(D,{color:"emerald",compact:!0,children:"BONE"}),e.isLoopEdge&&n.jsx(D,{color:"purple",compact:!0,children:"LOOP"}),e.isGhost&&n.jsx(D,{color:"zinc",compact:!0,children:"GHOST"})]})]}),n.jsx(z,{plain:!0,onClick:t,title:"Close",className:"shrink-0",children:n.jsx(p,{className:"size-4"})})]}),n.jsxs("div",{className:"p-3 font-mono text-[11px]",children:[n.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[n.jsxs("div",{children:[n.jsx(F,{content:"Average disambiguation confidence across all observations of this edge",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Confidence"})}),n.jsxs("div",{className:"text-text-primary tabular-nums",children:[(100*e.confidence).toFixed(0),"%"]})]}),n.jsxs("div",{children:[n.jsx(F,{content:"Observations where both endpoints had high-confidence disambiguation",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Certain"})}),n.jsx("div",{className:"text-text-primary tabular-nums",children:e.certainCount.toLocaleString()})]}),n.jsxs("div",{children:[n.jsx(F,{content:"Total packets observed traversing this edge",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Packets"})}),n.jsx("div",{className:"text-text-primary tabular-nums",children:e.packetCount.toLocaleString()})]}),n.jsxs("div",{children:[n.jsx(F,{content:"Combined certainCount × confidence metric for edge ranking",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Strength"})}),n.jsx("div",{className:"text-text-primary tabular-nums",children:e.strength.toFixed(2)})]})]}),n.jsxs("div",{className:"grid grid-cols-4 gap-3 mt-2",children:[n.jsxs("div",{children:[n.jsx(F,{content:"Bidirectional balance (min/max) — 0 = one-way traffic, 1 = perfectly balanced",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Symmetry"})}),n.jsx("div",{className:"text-text-primary tabular-nums",children:e.symmetryRatio.toFixed(2)})]}),n.jsxs("div",{children:[n.jsx(F,{content:"Dominant traffic flow direction between these nodes",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Direction"})}),n.jsx("div",{className:"text-text-primary capitalize",children:e.dominantDirection})]}),n.jsxs("div",{children:[n.jsx(F,{content:"Forward (A→B) vs reverse (B→A) observation counts",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Fwd / Rev"})}),n.jsxs("div",{className:"text-text-primary tabular-nums",children:[e.forwardCount," / ",e.reverseCount]})]}),n.jsxs("div",{children:[n.jsx(F,{content:"Routing method — broadcast flood vs unicast direct routing",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Flood / Direct"})}),n.jsxs("div",{className:"text-text-primary tabular-nums",children:[e.floodCount," / ",e.directCount]})]})]}),(null!=e.avgRssi||null!=e.avgSnr)&&n.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-2 pt-2 border-t border-border-subtle/50",children:[null!=e.avgRssi&&n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-text-muted uppercase",children:"RSSI"}),n.jsxs("div",{className:"text-text-primary tabular-nums",children:[e.avgRssi.toFixed(1)," dBm"]})]}),null!=e.avgSnr&&n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-text-muted uppercase",children:"SNR"}),n.jsxs("div",{className:"text-text-primary tabular-nums",children:[e.avgSnr.toFixed(1)," dB"]})]})]}),e.linkBudget&&n.jsxs("div",{className:"grid grid-cols-4 gap-3 mt-2 pt-2 border-t border-border-subtle/50",children:[null!=e.linkBudget.distanceKm&&n.jsxs("div",{children:[n.jsx(F,{content:"Haversine distance between endpoint locations",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Distance"})}),n.jsxs("div",{className:"text-text-primary tabular-nums",children:[e.linkBudget.distanceKm.toFixed(2)," km"]})]}),null!=e.linkBudget.fsplDb&&n.jsxs("div",{children:[n.jsx(F,{content:"Free Space Path Loss — theoretical signal attenuation over this distance at configured frequency",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"FSPL"})}),n.jsxs("div",{className:"text-text-primary tabular-nums",children:[e.linkBudget.fsplDb.toFixed(1)," dB"]})]}),null!=e.linkBudget.marginDb&&n.jsxs("div",{children:[n.jsx(F,{content:"Link margin — observed RSSI minus receiver sensitivity. Positive = signal headroom above minimum.",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Margin"})}),n.jsxs("div",{className:"text-text-primary tabular-nums",style:{color:e.linkBudget.marginClass?Oe[e.linkBudget.marginClass]:void 0},children:[e.linkBudget.marginDb>0?"+":"",e.linkBudget.marginDb.toFixed(1)," dB"]})]}),null!=e.linkBudget.deviationDb&&n.jsxs("div",{children:[n.jsx(F,{content:"Deviation from theoretical FSPL — positive means better signal than free-space prediction",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"vs Theory"})}),n.jsxs("div",{className:"text-text-primary tabular-nums",children:[e.linkBudget.deviationDb>0?"+":"",e.linkBudget.deviationDb.toFixed(1)," dB"]})]})]}),a&&n.jsx(St,{timeline:a})]})]})}),Ft=s.memo(function({node:e,onClose:t,egoMetrics:a,onExpandEgo:i,neighbors:r,onSelectNeighbor:o}){const[l,c]=s.useState(!1);return n.jsxs(m.div,{variants:X,initial:"hidden",animate:"visible",exit:"exit",className:"absolute inset-x-3 bottom-3 z-20 surface-elevated radius-inset shadow-xl max-h-[60vh] flex flex-col",children:[n.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5 border-b border-border-subtle/50",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[n.jsx("span",{className:"size-2 shrink-0 rounded-full",style:{backgroundColor:(P()?ft:vt)[e.nodeClass]}}),n.jsx("code",{className:"text-sm font-semibold text-text-primary shrink-0",children:e.prefix}),e.name&&n.jsx("span",{className:"text-sm text-text-secondary truncate",children:e.name}),n.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.isLocal&&n.jsx(D,{color:"yellow",compact:!0,children:"LOCAL"}),e.isHub&&n.jsx(D,{color:"violet",compact:!0,children:"HUB"}),e.isGateway&&n.jsx(D,{color:"sky",compact:!0,children:"GW"}),e.isBackbone&&n.jsx(D,{color:"emerald",compact:!0,children:"BONE"}),e.isMobile&&n.jsx(D,{color:"orange",compact:!0,children:"MOB"}),e.isZeroHop&&n.jsx(D,{color:"amber",compact:!0,children:"RF"}),e.isGhost&&n.jsx(D,{color:"zinc",compact:!0,children:"GHOST"}),e.isInLoop&&n.jsx(D,{color:"purple",compact:!0,children:"LOOP"})]})]}),n.jsx(z,{plain:!0,onClick:t,title:"Close",className:"shrink-0",children:n.jsx(p,{className:"size-4"})})]}),n.jsxs("div",{className:"p-3 font-mono text-[11px]",children:[n.jsx(Y,{copy:!0,size:"compact",truncate:[10,6],className:"w-full mb-3",children:e.hash}),n.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[n.jsxs("div",{children:[n.jsx(F,{content:"Total connections (edges) to this node",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Degree"})}),n.jsx("div",{className:"text-text-primary tabular-nums",children:e.degree})]}),n.jsxs("div",{children:[n.jsx(F,{content:"Inbound vs outbound edge count — indicates traffic directionality",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"In / Out"})}),n.jsxs("div",{className:"text-text-primary tabular-nums",children:[e.inDegree," / ",e.outDegree]})]}),n.jsxs("div",{children:[n.jsx(F,{content:"Betweenness centrality (0–1) — how often this node lies on shortest paths. High value = critical relay.",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Between."})}),n.jsx("div",{className:"text-text-primary tabular-nums",children:e.betweenness.toFixed(3)})]}),n.jsxs("div",{children:[n.jsx(F,{content:"Total packets observed involving this node",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Packets"})}),n.jsx("div",{className:"text-text-primary tabular-nums",children:e.packetCount.toLocaleString()})]})]}),n.jsxs("div",{className:"grid grid-cols-4 gap-3 mt-2",children:[n.jsxs("div",{children:[n.jsx(F,{content:"Number of topology edges connected to this node",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Edges"})}),n.jsx("div",{className:"text-text-primary tabular-nums",children:e.edgeCount})]}),n.jsxs("div",{children:[n.jsx(F,{content:"Community cluster assignment from graph partitioning algorithm",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Community"})}),n.jsxs("div",{className:"text-text-primary tabular-nums",children:["#",e.communityId]})]}),n.jsxs("div",{children:[n.jsx(F,{content:"Prefix disambiguation confidence — how certain the 2-char prefix→node mapping is (multi-factor scoring)",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Confidence"})}),n.jsxs("div",{className:"text-text-primary tabular-nums",children:[(100*e.prefixConfidence).toFixed(0),"%"]})]}),n.jsxs("div",{children:[n.jsx(F,{content:"Recency level — active (<1h), recent (<6h), stale (<24h), inactive (>24h)",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Activity"})}),n.jsx("div",{className:"text-text-primary capitalize",children:e.activityLevel})]})]}),(null!=e.avgRssi||null!=e.avgSnr)&&n.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-2 pt-2 border-t border-border-subtle/50",children:[null!=e.avgRssi&&n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-text-muted uppercase",children:"RSSI"}),n.jsxs("div",{className:"text-text-primary tabular-nums",children:[e.avgRssi.toFixed(1)," dBm"]})]}),null!=e.avgSnr&&n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-text-muted uppercase",children:"SNR"}),n.jsxs("div",{className:"text-text-primary tabular-nums",children:[e.avgSnr.toFixed(1)," dB"]})]})]}),a&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-2 pt-2 border-t border-border-subtle/50",children:[n.jsxs("div",{children:[n.jsx(F,{content:"Number of direct 1-hop neighbors in the topology",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Ego Size"})}),n.jsx("div",{className:"text-text-primary tabular-nums",children:a.neighborCount})]}),n.jsxs("div",{children:[n.jsx(F,{content:"Local clustering coefficient — how interconnected this node's neighbors are (0 = none, 1 = fully connected)",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Clustering"})}),n.jsx("div",{className:"text-text-primary tabular-nums",children:a.clusteringCoeff.toFixed(3)})]}),n.jsxs("div",{children:[n.jsx(F,{content:"Average betweenness centrality of this node's direct neighbors",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Avg Nbr Btw."})}),n.jsx("div",{className:"text-text-primary tabular-nums",children:a.avgNeighborBetweenness.toFixed(3)})]})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-2",children:[n.jsxs("div",{children:[n.jsx(F,{content:"Average disambiguation confidence across all connected edges",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Edge Conf."})}),n.jsxs("div",{className:"text-text-primary tabular-nums",children:[(100*a.avgEdgeConfidence).toFixed(0),"%"]})]}),null!=a.avgRssi&&n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-text-muted uppercase",children:"Avg RSSI"}),n.jsxs("div",{className:"text-text-primary tabular-nums",children:[a.avgRssi.toFixed(1)," dBm"]})]}),null!=a.avgSnr&&n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-text-muted uppercase",children:"Avg SNR"}),n.jsxs("div",{className:"text-text-primary tabular-nums",children:[a.avgSnr.toFixed(1)," dB"]})]})]})]}),i&&n.jsx("div",{className:"mt-2 pt-2 border-t border-border-subtle/50",children:n.jsxs("button",{onClick:i,className:"flex items-center gap-1.5 text-[10px] text-accent-primary hover:text-accent-primary/80 transition-base",children:[n.jsx(T,{className:"w-3 h-3"}),"Expand 2-hop neighborhood"]})}),r&&r.length>0&&n.jsxs("div",{className:"mt-2 pt-2 border-t border-border-subtle/50",children:[n.jsxs("button",{onClick:()=>c(e=>!e),className:"flex items-center justify-between w-full text-[9px] text-text-muted uppercase tracking-wide cursor-pointer hover:text-text-secondary transition-base",children:[n.jsxs("span",{children:["Neighbors (",r.length,")"]}),n.jsx(H,{className:"w-3 h-3 transition-transform "+(l?"rotate-180":"")})]}),l&&n.jsx("div",{className:"mt-1.5 max-h-32 overflow-y-auto space-y-0.5",children:r.map(e=>n.jsxs("button",{onClick:()=>null==o?void 0:o(e.hash),className:"w-full flex items-center gap-2 px-1.5 py-1 radius-badge hover-bg transition-base text-left group",children:[n.jsx("code",{className:"text-[10px] text-accent-primary shrink-0 tabular-nums",children:e.prefix}),n.jsx("span",{className:"text-[10px] text-text-secondary truncate flex-1",children:e.name||"—"}),null!=e.avgSnr&&n.jsxs("span",{className:"text-[9px] text-text-muted tabular-nums shrink-0",children:[e.avgSnr.toFixed(0)," dB"]}),null!=e.avgRssi&&n.jsx("span",{className:"text-[9px] text-text-muted tabular-nums shrink-0",children:e.avgRssi.toFixed(0)}),n.jsxs("span",{className:"text-[9px] text-text-muted/60 tabular-nums shrink-0",children:[(100*e.edgeConfidence).toFixed(0),"%"]})]},e.hash))})]})]})]})}),Lt=s.memo(function({metrics:e,onClose:t}){const s=Object.entries(e.communities).sort(([,e],[,t])=>t-e),a=Object.entries(e.nodeClasses).sort(([,e],[,t])=>t-e);return n.jsxs(m.div,{variants:X,initial:"hidden",animate:"visible",exit:"exit",className:"absolute inset-x-3 bottom-3 z-20 surface-elevated radius-inset shadow-xl",children:[n.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5 border-b border-border-subtle/50",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[n.jsx(ce,{className:"size-3.5 text-text-muted shrink-0"}),n.jsx("span",{className:"text-sm font-semibold text-text-primary",children:"Subgraph Analysis"}),n.jsxs(D,{color:"violet",compact:!0,children:[e.nodeCount," nodes"]})]}),n.jsx(z,{plain:!0,onClick:t,title:"Close",className:"shrink-0",children:n.jsx(p,{className:"size-4"})})]}),n.jsxs("div",{className:"p-3 font-mono text-[11px]",children:[n.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-text-muted uppercase",children:"Nodes"}),n.jsx("div",{className:"text-text-primary tabular-nums",children:e.nodeCount})]}),n.jsxs("div",{children:[n.jsx(F,{content:"Edges where both endpoints are within the lasso selection",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Internal Edges"})}),n.jsx("div",{className:"text-text-primary tabular-nums",children:e.edgeCount})]}),n.jsxs("div",{children:[n.jsx(F,{content:"Mean betweenness centrality of selected nodes",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Avg Between."})}),n.jsx("div",{className:"text-text-primary tabular-nums",children:e.avgBetweenness.toFixed(3)})]}),n.jsxs("div",{children:[n.jsx(F,{content:"Mean edge disambiguation confidence for internal edges",children:n.jsx("div",{className:"text-[9px] text-text-muted uppercase cursor-help",children:"Avg Confidence"})}),n.jsxs("div",{className:"text-text-primary tabular-nums",children:[(100*e.avgConfidence).toFixed(0),"%"]})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-2 pt-2 border-t border-border-subtle/50",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-text-muted uppercase mb-1",children:"Communities"}),n.jsx("div",{className:"flex flex-wrap gap-1",children:s.map(([e,t])=>n.jsxs("span",{className:"text-text-secondary",children:["#",e,"×",t]},e))})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[9px] text-text-muted uppercase mb-1",children:"Node Types"}),n.jsx("div",{className:"flex flex-wrap gap-1",children:a.map(([e,t])=>n.jsxs("span",{className:"text-text-secondary capitalize",children:[e,"×",t]},e))})]})]}),e.nodeCount>1&&n.jsx("div",{className:"mt-2 pt-2 border-t border-border-subtle/50",children:n.jsxs("div",{className:"text-[9px] text-text-muted flex items-center gap-1 flex-wrap",children:[n.jsx(F,{content:"Fraction of possible edges that exist — 2E / N(N-1)",children:n.jsxs("span",{className:"cursor-help",children:["Density: ",(2*e.edgeCount/(e.nodeCount*(e.nodeCount-1))*100).toFixed(1),"%"]})}),n.jsx("span",{children:"·"}),n.jsx(F,{content:"Mean connections per node — 2E / N",children:n.jsxs("span",{className:"cursor-help",children:["Avg Degree: ",(2*e.edgeCount/e.nodeCount).toFixed(1)]})}),null!=e.avgPathHealth&&n.jsxs(n.Fragment,{children:[n.jsx("span",{children:"·"}),n.jsx(F,{content:"Average health score of paths within the selection",children:n.jsxs("span",{className:"cursor-help",children:["Path Health: ",(100*e.avgPathHealth).toFixed(0),"%"]})})]})]})})]})]})});function Rt(){return n.jsxs("div",{className:"flex flex-col items-center justify-center gap-6 text-center px-8",children:[n.jsx("div",{className:"p-4 radius-pill bg-subtle-fill",children:n.jsx(ie,{className:"w-8 h-8 text-text-muted"})}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("h2",{className:"type-subheading text-text-primary",children:"No Topology Data"}),n.jsx("p",{className:"type-body text-text-muted max-w-sm",children:"The mesh topology will appear here once packets are received and processed."})]}),n.jsxs("div",{className:"flex items-center gap-2 type-data-xs text-text-muted",children:[n.jsx(M,{className:"w-4 h-4 animate-pulse"}),n.jsx("span",{children:"Waiting for mesh traffic..."})]})]})}const Mt=s.memo(function({label:e,value:t,onChange:a,min:i,max:r,step:o}){const[l,c]=s.useState(!1),[d,u]=s.useState(""),x=s.useRef(null),m=s.useCallback(()=>{const e=parseFloat(d);isNaN(e)||a(Math.min(r,Math.max(i,Math.round(e/o)*o))),c(!1)},[d,a,i,r,o]),h=s.useCallback(()=>{u(t.toFixed(2)),c(!0),setTimeout(()=>{var e;return null==(e=x.current)?void 0:e.select()},0)},[t]);return n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-[10px] text-text-muted",children:e}),l?n.jsx("input",{ref:x,type:"number",value:d,onChange:e=>u(e.target.value),onBlur:m,onKeyDown:e=>{"Enter"===e.key&&m(),"Escape"===e.key&&c(!1)},min:i,max:r,step:o,className:"w-14 text-right text-[10px] text-text-secondary tabular-nums bg-subtle-fill radius-badge px-1 py-0.5 border border-border-subtle focus:outline-none focus:border-accent-primary"}):n.jsx("button",{onClick:h,className:"text-[10px] text-text-secondary tabular-nums hover:text-accent-primary cursor-text transition-colors",title:"Click to type a value",children:t.toFixed(2)})]}),n.jsx("input",{type:"range",min:i,max:r,step:o,value:t,onChange:e=>a(parseFloat(e.target.value)),className:"w-full h-1 bg-subtle-fill rounded appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:bg-accent-primary [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer"})]})}),Bt=s.memo(function({label:e,checked:t,onChange:s}){return n.jsxs(r,{className:"flex items-center justify-between",children:[n.jsx(o,{className:"text-[10px] text-text-muted cursor-pointer select-none",children:e}),n.jsx(E,{enabled:t,onChange:s,size:"sm"})]})});function Ht(){var e,t,r,o,l,c,d,u,h,E,P,z,T,$,I;const G=g(),[O,Z]=s.useState(!1),[X,Y]=s.useState(!1),ie=s.useRef(!1);s.useEffect(()=>{G&&!ie.current&&(ie.current=!0,Y(!0))},[G]);const re=s.useCallback(()=>{Y(!1),Z(!0)},[]),ue=f(),xe=function(e,t=1e3){const[n,a]=s.useState(e),i=s.useRef(Date.now()),r=s.useRef(null);return s.useEffect(()=>{const s=Date.now(),n=t-(s-i.current);return n<=0?(a(e),i.current=s):(r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{a(e),i.current=Date.now()},n)),()=>{r.current&&clearTimeout(r.current)}},[e,t]),n}(v(),2e3),me=b(),he=y(),pe=j(),ge=N(),fe=w(),ve=C(),be=ve?ft:vt,ye=ve?ot:lt,je=s.useMemo(()=>function(e){if("undefined"==typeof document)return e?"#171717":"#EFF0F1";const t=getComputedStyle(document.documentElement).getPropertyValue("--bg-body").trim();return t.startsWith("#")?t:e?"#171717":"#EFF0F1"}(ve),[ve]),Ne=s.useMemo(()=>function(e){if("undefined"==typeof document)return e?"#A1A1AA":"#71717A";const t=getComputedStyle(document.documentElement).getPropertyValue("--text-secondary").trim();return t.startsWith("#")?t:e?"#A1A1AA":"#71717A"}(ve),[ve]),[we,Ce]=s.useState(!0),[ke,Se]=s.useState(null),[Fe,Le]=s.useState(null),[Me,Be]=s.useState(!1),[He,Ae]=s.useState(""),[ze,Te]=s.useState(!1),[Ge,Ve]=s.useState(!1),[Ke,_e]=s.useState("simulation"),[Ue,Xe]=s.useState(!0),[Ye,Je]=s.useState(!1),[et,tt]=s.useState(!0),[st,yt]=s.useState(!1),[Ct,St]=s.useState(!1),[Ht,At]=s.useState(new Set),[Et,Pt]=s.useState(!1),[zt,Tt]=s.useState("spectral"),[$t,It]=s.useState(1),[Gt,Ot]=s.useState(1),[Zt,Wt]=s.useState(!1),[Vt,Kt]=s.useState(null),[_t,qt]=s.useState(!1),[Ut,Xt]=s.useState(!1),[Yt,Qt]=s.useState(null),[Jt,es]=s.useState(null),[ts,ss]=s.useState(null),[ns,as]=s.useState(null),[is,rs]=s.useState(null),[os,ls]=s.useState(null),cs=s.useRef(!1),[ds,us]=s.useState(!1),[xs,ms]=s.useState([]),[hs,ps]=s.useState(0),[gs,fs]=s.useState(null),vs=s.useRef(new qe),bs=s.useRef(null),ys=s.useRef(null),[js,Ns]=s.useState(null),[ws,Cs]=s.useState(null),[ks,Ss]=s.useState({}),[Ds,Fs]=s.useState({simulationDecay:2e4,simulationGravity:.05,simulationCenter:.05,simulationRepulsion:5,simulationRepulsionTheta:.4,simulationLinkSpring:.05,simulationLinkDistance:78,simulationFriction:.72,simulationRepulsionFromMouse:0,pointSizeScale:.4,pointOpacity:1,pointGreyoutOpacity:.1,linkWidthScale:.06,linkOpacity:.95,linkGreyoutOpacity:.1,curvedLinks:ut,curvedLinkWeight:.8,linkDefaultArrows:xt,linkArrowsSizeScale:1.7,scalePointsOnZoom:mt,scaleLinksOnZoom:ht,renderLinks:pt,renderHoveredPointRing:gt,spaceSize:4096}),Ls=s.useCallback((e,t)=>{Fs(s=>({...s,[e]:t}))},[]),Rs=s.useCallback(()=>{Fs({simulationDecay:2e4,simulationGravity:.05,simulationCenter:.05,simulationRepulsion:5,simulationRepulsionTheta:.4,simulationLinkSpring:.05,simulationLinkDistance:78,simulationFriction:.72,simulationRepulsionFromMouse:0,pointSizeScale:.4,pointOpacity:1,pointGreyoutOpacity:.1,linkWidthScale:.06,linkOpacity:.95,linkGreyoutOpacity:.1,curvedLinks:ut,curvedLinkWeight:.8,linkDefaultArrows:xt,linkArrowsSizeScale:1.7,scalePointsOnZoom:mt,scaleLinksOnZoom:ht,renderLinks:pt,renderHoveredPointRing:gt,spaceSize:4096})},[]);s.useEffect(()=>()=>{var e;try{null==(e=ys.current)||e.destroy()}catch{}ys.current=null},[]),s.useEffect(()=>{const e=e=>{var t,s;if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLSelectElement))switch(e.key.toLowerCase()){case"f":e.metaKey||e.ctrlKey||(e.preventDefault(),null==(t=ys.current)||t.fitView(at));break;case"escape":ze?(Te(!1),Ae("")):ke&&(Se(null),null==(s=ys.current)||s.unselectAllPoints());break;case"/":ze||(e.preventDefault(),Te(!0),setTimeout(()=>{var e;return null==(e=bs.current)?void 0:e.focus()},50));break;case" ":e.preventDefault(),ys.current&&(we?ys.current.pause():ys.current.start(),Ce(e=>!e));break;case"l":Xe(e=>!e)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ze,ke,we]);const Ms=s.useMemo(()=>new Set((null==ue?void 0:ue.backboneEdges)??[]),[null==ue?void 0:ue.backboneEdges]),Bs=s.useMemo(()=>({resolution:$t,kWeight:Gt}),[$t,Gt]),Hs=s.useMemo(()=>{if("louvain"!==zt)return null;const e=null==ue?void 0:ue.edges;return!e||0===e.length||!xe||xe.size<3?null:Re(e,Array.from(xe.keys()),Bs).communities},[zt,null==ue?void 0:ue.edges,xe,Bs]),As=s.useMemo(()=>{var e;if(!xe||0===xe.size||!O)return[];const t=[],s=(null==fe?void 0:fe.node_name)??(null==(e=null==fe?void 0:fe.config)?void 0:e.node_name)??null,n=ve?"#171717":"#EFF0F1";let a=1;for(const i of xe.values())i.degree>a&&(a=i.degree);for(const i of xe.values()){const e=i,r=e.degree>0?Math.log10(e.degree+1)/Math.log10(a+1):0,o=5+23*Math.min(1,r),l=6*e.betweenness,c=e.isLocal?28:Math.min(34,o+l),d=(null==Hs?void 0:Hs.get(e.hash))??e.communityId,u=Et&&d>=0?ye[d%ye.length]:be[e.nodeClass],x=rt[e.activityLevel]??1,m=e.isLocal?be.local:x<1?jt(u,n,x):u,h=e.isLocal?s??e.name:e.name;t.push({id:e.hash,label:h?`${e.prefix} ${h}`:e.prefix,color:m,size:c,nodeClass:e.nodeClass,name:h,prefix:e.prefix,packetCount:e.packetCount,isLocal:e.isLocal,isHub:e.isHub,isGateway:e.isGateway,isBackbone:e.isBackbone,isMobile:e.isMobile,isZeroHop:e.isZeroHop,isGhost:e.isGhost,degree:e.degree,betweenness:e.betweenness,communityId:(null==Hs?void 0:Hs.get(e.hash))??e.communityId,activityLevel:e.activityLevel,prefixConfidence:e.prefixConfidence,hasCollision:e.hasCollision,inDegree:e.inDegree,outDegree:e.outDegree,isInLoop:e.isInLoop,avgRssi:e.avgRssi,avgSnr:e.avgSnr})}for(const i of me){const e=`ghost-${i.prefix}`;if(t.some(t=>t.id===e))continue;const s=jt(be.ghost,n,.6);t.push({id:e,label:`? ${i.prefix.toUpperCase()}`,color:s,size:6,nodeClass:"ghost",name:null,prefix:i.prefix,packetCount:i.observationCount,isLocal:!1,isHub:!1,isGateway:!1,isBackbone:!1,isMobile:!1,isZeroHop:!1,isGhost:!0,degree:i.commonNeighbors.size,betweenness:0,communityId:-1,activityLevel:"active",prefixConfidence:i.confidence,hasCollision:!1,inDegree:0,outDegree:0,isInLoop:!1,avgRssi:null,avgSnr:null})}return t},[xe,O,null==fe?void 0:fe.node_name,null==(e=null==fe?void 0:fe.config)?void 0:e.node_name,be,ve,me,ye,Et,zt,Hs]),Es=s.useMemo(()=>new Set(As.map(e=>e.id)),[As]),Ps=s.useMemo(()=>{const e=new Map;if(!xe)return e;for(const t of xe.values())e.set(t.hash,t.name);return e},[xe]),zs=s.useMemo(()=>{const e=(null==ue?void 0:ue.edges)??[];if(!e.length||!O)return[];const t=[],s=(null==ue?void 0:ue.edgeBetweenness)??new Map;for(const a of e){if(!Es.has(a.fromHash)||!Es.has(a.toHash))continue;const e=Nt(a,Ms),n=wt(e,a.avgConfidence,ve),i=s.get(a.key)??0,r=i>0?.5+4*i:.5+2*Math.min(1,a.certainCount/50);t.push({source:a.fromHash,target:a.toHash,color:n,width:r,key:a.key,packetCount:a.packetCount,certainCount:a.certainCount,confidence:a.avgConfidence,symmetryRatio:a.symmetryRatio,dominantDirection:a.dominantDirection,isBackbone:Ms.has(a.key),isLoopEdge:a.isLoopEdge??!1,isDirectPath:a.isDirectPathEdge,isZeroHop:a.isZeroHop??!1,isGhost:!1,forwardCount:a.forwardCount,reverseCount:a.reverseCount,floodCount:a.floodCount,directCount:a.directCount,avgRssi:a.avgRssi??null,avgSnr:a.avgSnr??null,strength:a.strength,fromName:Ps.get(a.fromHash)??null,toName:Ps.get(a.toHash)??null,edgeType:e})}const n=ve?ct:dt;for(const a of me){const e=`ghost-${a.prefix}`;if(Es.has(e))for(const s of a.commonNeighbors)Es.has(s)&&t.push({source:e,target:s,color:n.ghost,width:.4,key:`ghost-${a.prefix}-${s}`,packetCount:a.observationCount,certainCount:0,confidence:a.confidence,symmetryRatio:0,dominantDirection:"balanced",isBackbone:!1,isLoopEdge:!1,isDirectPath:!1,isZeroHop:!1,isGhost:!0,forwardCount:0,reverseCount:0,floodCount:0,directCount:0,avgRssi:null,avgSnr:null,strength:a.confidence,fromName:null,toName:Ps.get(s)??null,edgeType:"ghost"})}return t},[null==ue?void 0:ue.edges,null==ue?void 0:ue.edgeBetweenness,O,Es,ve,Ms,Ps,me]),Ts=null==(r=null==(t=null==fe?void 0:fe.config)?void 0:t.radio)?void 0:r.frequency,$s=null==(l=null==(o=null==fe?void 0:fe.config)?void 0:o.radio)?void 0:l.bandwidth,Is=null==(d=null==(c=null==fe?void 0:fe.config)?void 0:c.radio)?void 0:d.spreading_factor,Gs=null==(h=null==(u=null==fe?void 0:fe.config)?void 0:u.radio)?void 0:h.tx_power,Os=null==(P=null==(E=null==fe?void 0:fe.config)?void 0:E.radio)?void 0:P.coding_rate;s.useEffect(()=>{Ut&&!cs.current&&(cs.current=!0,(async()=>{var e,t;try{const s=await k(24);if(s.success&&(null==(t=null==(e=s.data)?void 0:e.history)?void 0:t.length)){const e=s.data.history.map(e=>e.noise_floor_dbm).filter(e=>null!=e&&e>-200&&e<0);if(e.length>0){const t=[...e].sort((e,t)=>e-t),s=t[Math.floor(t.length/2)];ls(s)}}}catch{}})())},[Ut]);const Zs=s.useMemo(()=>{if(!ue||!Ut)return null;const e={frequency:Ts,bandwidth:null!=ts?1e3*ts:$s,spreading_factor:Jt??Is,tx_power:Yt??Gs,coding_rate:ns??Os},t={};return null!=is&&(t.sensitivityOverrideDbm=is),null!=os&&(t.observedNoiseFloorDbm=os),function(e,t,s){const n=[],a=e.nodeMetrics,i=new Set,r=t.tx_power??22;for(const o of e.edges){if(!o.isZeroHop)continue;const e=a.get(o.fromHash),r=a.get(o.toHash);n.push($e(o,e,r,t,s)),i.add(o.key)}for(const o of e.edges){if(i.has(o.key))continue;if(!o.traceQuality)continue;const e=Ie(o,a.get(o.fromHash),a.get(o.toHash),t,r,s);e&&(n.push(e),i.add(o.key))}return n}(ue,e,t)},[ue,Ut,Ts,$s,Is,Gs,Os,Yt,Jt,ts,ns,is,os]),Ws=s.useMemo(()=>{if(!Zs)return null;const e=new Map;for(const t of Zs)e.set(t.edgeKey,t);return e},[Zs]),Vs=s.useMemo(()=>Zs&&0!==Zs.length?function(e){const t={"anomalous-good":0,better:0,expected:0,worse:0,"anomalous-bad":0},s={excellent:0,good:0,fair:0,marginal:0,critical:0};let n=0,a=0,i=null,r=null,o=0,l=0;for(const c of e)c.hasData&&(null!=c.marginDb&&(n+=c.marginDb,a++,(!i||c.marginDb<(i.marginDb??1/0))&&(i=c),(!r||c.marginDb>(r.marginDb??-1/0))&&(r=c)),c.marginClass&&s[c.marginClass]++,null!=c.deviationDb&&c.deviationClass?(t[c.deviationClass]++,l++):o++);return{totalEdges:e.length,analyzedEdges:l,rssiOnlyEdges:o,avgMarginDb:a>0?n/a:null,worstMargin:i,bestMargin:r,deviationCounts:t,marginCounts:s,anomalousCount:t["anomalous-good"]+t["anomalous-bad"]}}(Zs):null,[Zs]),Ks=s.useMemo(()=>{if(!Ut||!Ws)return zs;const e=ve?"#303038":"#D0D0D8";return zs.map(t=>{const s=Ws.get(t.key);return s&&s.hasData?{...t,color:Ze(s,"margin"),width:We(s),linkBudget:s}:{...t,color:e,width:.3}})},[zs,Ut,Ws,ve]),_s=s.useMemo(()=>0===Ht.size?As:As.filter(e=>!Ht.has(e.nodeClass)),[As,Ht]),qs=s.useMemo(()=>{if(0===Ht.size)return Ks;const e=new Set(_s.map(e=>e.id));return Ks.filter(t=>e.has(t.source)&&e.has(t.target))},[Ks,_s,Ht]),Us=s.useRef([]);s.useEffect(()=>{Us.current=qs},[qs]);const Xs=s.useMemo(()=>{const e=new Map;for(const t of zs)e.set(t.source,(e.get(t.source)??0)+1),e.set(t.target,(e.get(t.target)??0)+1);return e},[zs]),Ys=s.useMemo(()=>{const e=new Map;for(const t of As)e.set(t.id,t);return e},[As]);s.useEffect(()=>{if(0===_s.length)return Ns(null),Cs(null),void Ss({});let e=!1;const t=setTimeout(async()=>{try{const t=_s.map(e=>({id:e.id,label:e.label,color:e.color,size:e.size,communityId:String(e.communityId)})),s=qs.map(e=>({source:e.source,target:e.target,color:e.color,width:e.width})),n={points:{pointIdBy:"id",pointColorBy:"color",pointColorStrategy:"direct",pointDefaultColor:ve?"#9CA3AF":"#374151",pointLabelBy:"label",pointSizeBy:"size",pointSizeStrategy:"direct",pointDefaultSize:8,pointSizeScale:1,pointGreyoutOpacity:.3,pointIncludeColumns:["communityId"]},links:{linkSourceBy:"source",linkTargetsBy:["target"],linkColorBy:"color",linkColorStrategy:"direct",linkDefaultColor:ve?"#6B7280":"#9CA3AF",linkWidthBy:"width",linkWidthStrategy:"direct",linkDefaultWidth:1,linkWidthScale:1,linkGreyoutOpacity:.1}},a=await i(n,t,s);if(e||!a)return;Ns(a.points??null),Cs(a.links??null),Ss(a.cosmographConfig??{})}catch(t){}},100);return()=>{e=!0,clearTimeout(t)}},[_s,qs,ve]);const Qs=s.useCallback(e=>{e&&(ys.current=e,e.start(),setTimeout(()=>{e.fitView(at)},1500))},[]),Js=s.useCallback(()=>{var e;null==(e=ys.current)||e.fitView(at)},[]),en=s.useCallback(()=>{const e=ys.current;e&&(we?e.pause():e.start(),Ce(!we))},[we]),tn=s.useCallback(async e=>{const t=ys.current,s=Ys.get(e);if(s){if(t)try{const s=await t.getPointIndicesByIds([e]);s&&s.length>0&&void 0!==s[0]&&(t.zoomToPoint(s[0],400,2.5),t.selectPoint(s[0],!1,!0))}catch{}Le(null),Se({hash:e,name:s.name,prefix:s.prefix,nodeClass:s.nodeClass,packetCount:s.packetCount,edgeCount:Xs.get(e)??0,degree:s.degree,betweenness:s.betweenness,communityId:s.communityId,isLocal:s.isLocal,isHub:s.isHub,isGateway:s.isGateway,isBackbone:s.isBackbone,isMobile:s.isMobile,isZeroHop:s.isZeroHop,isGhost:s.isGhost,isInLoop:s.isInLoop,activityLevel:s.activityLevel,prefixConfidence:s.prefixConfidence,hasCollision:s.hasCollision,inDegree:s.inDegree,outDegree:s.outDegree,avgRssi:s.avgRssi,avgSnr:s.avgSnr})}},[Ys,Xs]),sn=s.useRef(null);s.useEffect(()=>{sn.current=Ws},[Ws]);const nn=s.useCallback(e=>{var t;if(void 0===e)return void Le(null);const s=Us.current[e];if(!s)return;const n=null==(t=sn.current)?void 0:t.get(s.key);Le(n&&!s.linkBudget?{...s,linkBudget:n}:s),Se(null)},[]),an=s.useCallback(async(e,t,s)=>{var n;if(void 0===e)return Se(null),Kt(null),void(null==(n=ys.current)||n.unselectAllPoints());Le(null);const a=ys.current;if(a)try{const t=await a.getPointIdsByIndices([e]);if(!t||0===t.length)return;const s=t[0],n=Ys.get(s);if(!n)return;a.selectPoint(e,!1,!0),Se({hash:s,name:n.name,prefix:n.prefix,nodeClass:n.nodeClass,packetCount:n.packetCount,edgeCount:Xs.get(s)??0,degree:n.degree,betweenness:n.betweenness,communityId:n.communityId,isLocal:n.isLocal,isHub:n.isHub,isGateway:n.isGateway,isBackbone:n.isBackbone,isMobile:n.isMobile,isZeroHop:n.isZeroHop,isGhost:n.isGhost,isInLoop:n.isInLoop,activityLevel:n.activityLevel,prefixConfidence:n.prefixConfidence,hasCollision:n.hasCollision,inDegree:n.inDegree,outDegree:n.outDegree,avgRssi:n.avgRssi,avgSnr:n.avgSnr})}catch{}},[Ys,Xs]),rn=s.useMemo(()=>{if(!ze||!He.trim())return[];const e=He.toLowerCase();return As.filter(t=>{var s;return t.prefix.toLowerCase().includes(e)||(null==(s=t.name)?void 0:s.toLowerCase().includes(e))||t.id.toLowerCase().includes(e)}).slice(0,8)},[As,He,ze]),on=s.useCallback(e=>{Te(!1),Ae(""),tn(e.id)},[tn]),ln=s.useCallback(()=>{Be(e=>!e)},[]),cn=s.useCallback(e=>{At(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[]),dn=s.useCallback(()=>{Pt(e=>{const t=!e,s=ys.current;return s&&s.start(.5),t})},[]),un=s.useCallback(()=>{Wt(e=>{const t=!e,s=ys.current;return s?(t?s.activatePolygonalSelection():(s.deactivatePolygonalSelection(),Kt(null),s.unselectAllPoints()),t):t})},[]),xn=s.useCallback(async()=>{const e=ys.current;if(!e)return;await new Promise(e=>setTimeout(e,80));const t=e.getSelectedPointIndices();if(!t||0===t.length)return void Kt(null);const s=await e.getPointIdsByIndices(t);if(!s||0===s.length)return void Kt(null);const n=new Set(s);let a=0,i=0;for(const x of Us.current)n.has(x.source)&&n.has(x.target)&&(a++,i+=x.confidence);let r=0;const o={},l={};for(const x of s){const e=Ys.get(x);e&&(r+=e.betweenness,o[e.communityId]=(o[e.communityId]??0)+1,l[e.nodeClass]=(l[e.nodeClass]??0)+1)}const c=new Set;for(const x of s){const e=Ys.get(x);e&&c.add(e.prefix.toLowerCase())}let d=0,u=0;for(const x of ge)if(x.hops.length>=2){const e=x.hops[0].toLowerCase(),t=x.hops[x.hops.length-1].toLowerCase();c.has(e)&&c.has(t)&&(d+=x.healthScore,u++)}Kt({nodeCount:s.length,edgeCount:a,avgBetweenness:s.length>0?r/s.length:0,avgConfidence:a>0?i/a:0,avgPathHealth:u>0?d/u:null,communities:o,nodeClasses:l}),Se(null),Le(null)},[Ys,ge]),mn=s.useCallback(()=>{var e;Kt(null),null==(e=ys.current)||e.unselectAllPoints()},[]),hn=s.useMemo(()=>{var e;if(!ke)return null;const t=ke.hash,s=new Set;for(const m of qs)m.source===t?s.add(m.target):m.target===t&&s.add(m.source);if(0===s.size)return{clusteringCoeff:0,avgNeighborBetweenness:0,neighborCount:0,avgEdgeConfidence:0,avgRssi:null,avgSnr:null};let n=0;for(const m of qs)s.has(m.source)&&s.has(m.target)&&n++;const a=s.size,i=a>1?2*n/(a*(a-1)):0;let r=0;for(const m of s)r+=(null==(e=Ys.get(m))?void 0:e.betweenness)??0;let o=0,l=0,c=0,d=0,u=0,x=0;for(const m of qs)m.source!==t&&m.target!==t||(o+=m.confidence,l++,null!=m.avgRssi&&(c+=m.avgRssi,d++),null!=m.avgSnr&&(u+=m.avgSnr,x++));return{clusteringCoeff:Math.min(1,i),avgNeighborBetweenness:r/a,neighborCount:a,avgEdgeConfidence:l>0?o/l:0,avgRssi:d>0?c/d:null,avgSnr:x>0?u/x:null}},[ke,qs,Ys]),pn=s.useMemo(()=>{if(!ke)return[];const e=ke.hash,t=[],s=new Set;for(const n of qs){let a=null;if(n.source===e?a=n.target:n.target===e&&(a=n.source),!a||s.has(a))continue;s.add(a);const i=Ys.get(a);t.push({hash:a,prefix:(null==i?void 0:i.prefix)??a.slice(2,4).toUpperCase(),name:(null==i?void 0:i.name)??null,edgeConfidence:n.confidence,edgeType:n.edgeType,avgRssi:n.avgRssi,avgSnr:n.avgSnr})}return t.sort((e,t)=>t.edgeConfidence-e.edgeConfidence),t},[ke,qs,Ys]),gn=s.useCallback(async()=>{const e=ys.current;if(!e||!ke)return;const t=await e.getPointIndicesByIds([ke.hash]);if(!t||void 0===t[0])return;const s=t[0],n=e.getConnectedPointIndices(s)??[],a=new Set([s,...n]);for(const r of n){const t=e.getConnectedPointIndices(r)??[];for(const e of t)a.add(e)}const i=Array.from(a);e.selectPoints(i),e.fitViewByIndices(i,at,.15)},[ke]);s.useEffect(()=>{if(!Zt)return;const e=e=>{var t,s;"Escape"===e.key&&(Wt(!1),null==(t=ys.current)||t.deactivatePolygonalSelection(),Kt(null),null==(s=ys.current)||s.unselectAllPoints())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[Zt]);const fn=s.useCallback((e,t)=>{ue&&(function(e,t){!function(e){const t=new Blob([e.content],{type:e.mimeType}),s=URL.createObjectURL(t),n=document.createElement("a");n.href=s,n.download=e.filename,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)}(De(e,t))}(ue,{format:e,dataset:t}),qt(!1))},[ue]),vn=s.useMemo(()=>{if(!ue||!ge.length)return null;const e=ue.edges??[];return 0===e.length?null:function(e,t,s=-137){const n=new Map;for(const r of t)n.set(r.key,r);const a=t.filter(e=>null!=e.avgRssi).length,i=[];for(const r of e){const e=Qe(r,n,s);e&&i.push(e)}return i.sort((e,t)=>t.riskScore-e.riskScore),{atRiskPaths:i,criticalCount:i.filter(e=>"critical"===e.riskLevel).length,highCount:i.filter(e=>"high"===e.riskLevel).length,moderateCount:i.filter(e=>"moderate"===e.riskLevel).length,edgesAnalyzed:t.length,edgesWithSignal:a}}(ge,e)},[ue,ge]),bn=s.useMemo(()=>{const e=null==ue?void 0:ue.edges;if(!e||0===e.length||!xe||xe.size<3)return null;const t=Array.from(xe.keys());return V(e,t)},[null==ue?void 0:ue.edges,xe]),yn=s.useMemo(()=>{if("louvain"!==zt)return null;const e=null==ue?void 0:ue.edges;return!e||0===e.length||!xe||xe.size<3?null:Re(e,Array.from(xe.keys()),Bs)},[zt,null==ue?void 0:ue.edges,xe,Bs]);s.useEffect(()=>{if(!ue)return;const e=new Map;for(const[s,n]of ue.nodeMetrics)e.set(s,n.name);const t=vs.current.update(ue,e);t.totalCount>0&&(ms(vs.current.getLog()),ps(e=>e+t.totalCount))},[ue]);const jn=s.useCallback(()=>{ps(0),us(e=>!e)},[]),Nn=s.useMemo(()=>function(e,t){if(null==e)return null;const s=Math.max(0,e),n=s>0?(Math.log10(s)+4)/4.5:0,a=Math.round(Math.max(0,Math.min(100,100*n)));let i,r;a<10?(i="critical",r="Partition risk"):a<30?(i="poor",r="Weak connectivity"):a<55?(i="fair",r="Moderate resilience"):a<80?(i="good",r="Well connected"):(i="excellent",r="Highly resilient");const[o,l]=it[i];return{score:a,grade:i,label:r,color:t?o:l}}(bn,ve),[bn,ve]),wn=n.jsxs("div",{className:"absolute top-0 left-0 right-0 z-20 px-4 py-3 pointer-events-none flex items-start justify-between",children:[n.jsxs("h1",{className:"type-title text-text-primary flex items-center gap-2 sm:gap-3 pointer-events-auto",children:[n.jsx(S,{className:"w-5 h-5 sm:w-6 sm:h-6 text-icon-page-title"}),n.jsx("span",{children:"MeshGraph"}),n.jsx(D,{color:"violet",compact:!0,children:"Analytics"})]}),Nn&&n.jsx(F,{content:n.jsxs("div",{className:"max-w-xs space-y-2",children:[n.jsx("div",{className:"font-semibold text-text-primary",children:"Mesh Resilience Score"}),n.jsx("div",{className:"text-text-secondary",children:"Derived from the Fiedler eigenvalue (λ₂) — the second-smallest eigenvalue of the graph Laplacian. Measures how well-connected the mesh is and how resistant it is to partitioning."}),n.jsxs("div",{className:"space-y-0.5 font-mono text-[10px]",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-text-muted",children:"Raw λ₂"}),n.jsx("span",{className:"text-text-primary tabular-nums",children:(null==bn?void 0:bn.toFixed(6))??"—"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-text-muted",children:"Score"}),n.jsxs("span",{className:"tabular-nums",style:{color:Nn.color},children:[Nn.score,"/100"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-text-muted",children:"Grade"}),n.jsx("span",{className:"capitalize",style:{color:Nn.color},children:Nn.grade})]})]}),n.jsxs("div",{className:"pt-1 border-t border-border-subtle/30 space-y-0.5 text-[10px]",children:[n.jsx("div",{className:"text-text-muted font-medium",children:"Grade thresholds"}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{style:{color:it.excellent[0]},children:"Excellent"}),n.jsx("span",{className:"text-text-muted tabular-nums",children:"80-100 (λ₂ > 0.3)"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{style:{color:it.good[0]},children:"Good"}),n.jsx("span",{className:"text-text-muted tabular-nums",children:"55-79 (λ₂ 0.03-0.3)"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{style:{color:it.fair[0]},children:"Fair"}),n.jsx("span",{className:"text-text-muted tabular-nums",children:"30-54 (λ₂ 0.003-0.03)"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{style:{color:it.poor[0]},children:"Poor"}),n.jsx("span",{className:"text-text-muted tabular-nums",children:"10-29 (λ₂ 0.0001-0.003)"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{style:{color:it.critical[0]},children:"Critical"}),n.jsx("span",{className:"text-text-muted tabular-nums",children:"<10 (λ₂ ≈ 0)"})]})]}),n.jsx("div",{className:"text-[10px] text-text-muted italic",children:"Near-zero λ₂ = one bridge away from network partition. Log-scale mapping: small λ₂ changes at low values have outsized impact."})]}),children:n.jsxs("div",{className:"pointer-events-auto surface-control radius-inner px-3 py-1.5 flex items-center gap-2 cursor-help",children:[n.jsxs("div",{className:"flex items-baseline gap-1.5",children:[n.jsx("span",{className:"text-[10px] text-text-muted uppercase tracking-wider",children:"Resilience"}),n.jsx("span",{className:"text-lg font-semibold tabular-nums leading-none",style:{color:Nn.color},children:Nn.score})]}),n.jsx("div",{className:"w-12 h-1.5 rounded-full bg-subtle-fill overflow-hidden",children:n.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${Nn.score}%`,backgroundColor:Nn.color}})})]})})]}),Cn=(e,t=!1)=>{const s="flex flex-col items-center gap-0.5 px-1.5 py-1 radius-inner transition-all duration-100 active:scale-95";return e&&t?`${s} bg-status-warning/15 text-status-warning shadow-inner`:e?`${s} bg-accent-primary/20 text-accent-primary shadow-inner`:`${s} hover:bg-white/5 hover:scale-105 text-text-secondary`},kn=n.jsx("div",{className:"w-px h-6 bg-border-subtle/40 mx-0.5 shrink-0"}),Sn=n.jsxs("div",{className:"absolute top-12 right-3 z-10 flex items-center gap-0.5 surface-control radius-inner px-1.5 py-1",children:[n.jsx(F,{content:"Visible nodes / edges in the graph",children:n.jsxs("span",{className:"text-[9px] text-text-muted tabular-nums mr-1.5 leading-none cursor-help",children:[_s.length,n.jsx("br",{}),qs.length]})}),kn,n.jsx(F,{content:Ue?"Hide labels (L)":"Show labels (L)",children:n.jsxs("button",{onClick:()=>Xe(e=>!e),className:Cn(!Ue,!0),children:[Ue?n.jsx(Q,{className:"w-3.5 h-3.5"}):n.jsx(K,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Lbl"})]})}),n.jsx(F,{content:Et?"Disable clustering":"Community clustering",children:n.jsxs("button",{onClick:dn,className:Cn(Et),children:[n.jsx(le,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Grp"})]})}),n.jsx(F,{content:Zt?"Exit lasso (Esc)":"Lasso selection",children:n.jsxs("button",{onClick:un,className:Cn(Zt,!0),children:[n.jsx(ce,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Sel"})]})}),kn,n.jsx(F,{content:"Legend",children:n.jsxs("button",{onClick:()=>Je(e=>!e),className:Cn(Ye),children:[n.jsx(se,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Map"})]})}),n.jsx(F,{content:"Search (/)",children:n.jsxs("button",{onClick:()=>{Te(!0),setTimeout(()=>{var e;return null==(e=bs.current)?void 0:e.focus()},50)},className:Cn(ze),children:[n.jsx(J,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Fnd"})]})}),kn,n.jsx(F,{content:we?"Pause (Space)":"Play (Space)",children:n.jsxs("button",{onClick:en,className:Cn(!we),children:[we?n.jsx(L,{className:"w-3.5 h-3.5 text-accent-success"}):n.jsx(R,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:we?"Run":"Stop"})]})}),n.jsx(F,{content:"Fit view (F)",children:n.jsxs("button",{onClick:Js,className:Cn(!1),children:[n.jsx(oe,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Fit"})]})}),kn,n.jsx(F,{content:Ut?"Disable link budget":"Link budget overlay",children:n.jsxs("button",{onClick:()=>Xt(e=>!e),className:Cn(Ut),children:[n.jsx(M,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"RF"})]})}),n.jsx(F,{content:"Anomaly log",children:n.jsxs("button",{onClick:jn,className:`relative ${Cn(ds,!0)}`,children:[n.jsx(ee,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Alert"}),hs>0&&n.jsx("span",{className:"absolute -top-1 -right-0.5 w-3 h-3 rounded-full bg-status-danger text-[7px] font-bold text-white flex items-center justify-center",children:hs>9?"9+":hs})]})}),n.jsx(F,{content:"Export topology",children:n.jsxs("button",{onClick:()=>qt(e=>!e),className:Cn(_t),children:[n.jsx(_,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Exp"})]})}),n.jsx(F,{content:"Settings",children:n.jsxs("button",{onClick:()=>Ve(e=>!e),className:Cn(Ge),children:[n.jsx(ne,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Cfg"})]})}),kn,n.jsx(F,{content:Me?"Exit fullscreen":"Fullscreen",children:n.jsxs("button",{onClick:ln,className:Cn(Me),children:[Me?n.jsx(q,{className:"w-3.5 h-3.5"}):n.jsx(W,{className:"w-3.5 h-3.5"}),n.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Max"})]})})]}),Dn=n.jsxs(nt,{id:"settings",title:"Graph Settings",icon:n.jsx(ne,{}),open:Ge,onClose:()=>Ve(!1),defaultPosition:{x:"undefined"!=typeof window?window.innerWidth-308:600,y:60},defaultSize:{width:288,height:420},minSize:{width:260,height:200},maxSize:{width:400,height:600},headerActions:n.jsx(F,{content:"Reset to defaults",children:n.jsx("button",{onClick:Rs,className:"p-0.5 radius-badge hover-bg transition-base",children:n.jsx(de,{className:"w-2.5 h-2.5 text-text-muted"})})}),children:[n.jsx("div",{className:"flex border-b border-border-subtle",children:["simulation","points","links","rendering"].map(e=>n.jsx("button",{onClick:()=>_e(e),className:"flex-1 px-2 py-1.5 text-[10px] font-medium capitalize transition-colors "+(Ke===e?"text-accent-primary border-b-2 border-accent-primary":"text-text-muted hover:text-text-secondary"),children:e},e))}),n.jsxs("div",{className:"p-3 space-y-3",children:["simulation"===Ke&&n.jsxs(n.Fragment,{children:[n.jsx(Mt,{label:"Gravity",value:Ds.simulationGravity,onChange:e=>Ls("simulationGravity",e),min:0,max:1,step:.01}),n.jsx(Mt,{label:"Repulsion",value:Ds.simulationRepulsion,onChange:e=>Ls("simulationRepulsion",e),min:0,max:5,step:.1}),n.jsx(Mt,{label:"Link Spring",value:Ds.simulationLinkSpring,onChange:e=>Ls("simulationLinkSpring",e),min:0,max:2,step:.05}),n.jsx(Mt,{label:"Link Distance",value:Ds.simulationLinkDistance,onChange:e=>Ls("simulationLinkDistance",e),min:1,max:100,step:1}),n.jsx(Mt,{label:"Friction",value:Ds.simulationFriction,onChange:e=>Ls("simulationFriction",e),min:0,max:1,step:.01}),n.jsx(Mt,{label:"Center Force",value:Ds.simulationCenter,onChange:e=>Ls("simulationCenter",e),min:0,max:1,step:.01}),n.jsx(Mt,{label:"Decay",value:Ds.simulationDecay,onChange:e=>Ls("simulationDecay",e),min:100,max:2e4,step:100}),n.jsx(Mt,{label:"Repulsion Theta",value:Ds.simulationRepulsionTheta,onChange:e=>Ls("simulationRepulsionTheta",e),min:.1,max:3,step:.05}),n.jsx(Mt,{label:"Mouse Repulsion",value:Ds.simulationRepulsionFromMouse,onChange:e=>Ls("simulationRepulsionFromMouse",e),min:0,max:10,step:.5})]}),"points"===Ke&&n.jsxs(n.Fragment,{children:[n.jsx(Mt,{label:"Size Scale",value:Ds.pointSizeScale,onChange:e=>Ls("pointSizeScale",e),min:.1,max:5,step:.1}),n.jsx(Mt,{label:"Opacity",value:Ds.pointOpacity,onChange:e=>Ls("pointOpacity",e),min:0,max:1,step:.05}),n.jsx(Mt,{label:"Greyout Opacity",value:Ds.pointGreyoutOpacity,onChange:e=>Ls("pointGreyoutOpacity",e),min:0,max:1,step:.05}),n.jsx(Bt,{label:"Scale on Zoom",checked:Ds.scalePointsOnZoom,onChange:e=>Ls("scalePointsOnZoom",e)}),n.jsx(Bt,{label:"Hover Ring",checked:Ds.renderHoveredPointRing,onChange:e=>Ls("renderHoveredPointRing",e)})]}),"links"===Ke&&n.jsxs(n.Fragment,{children:[n.jsx(Bt,{label:"Show Links",checked:Ds.renderLinks,onChange:e=>Ls("renderLinks",e)}),n.jsx(Bt,{label:"Curved Links",checked:Ds.curvedLinks,onChange:e=>Ls("curvedLinks",e)}),n.jsx(Bt,{label:"Show Arrows",checked:Ds.linkDefaultArrows,onChange:e=>Ls("linkDefaultArrows",e)}),n.jsx(Mt,{label:"Width Scale",value:Ds.linkWidthScale,onChange:e=>Ls("linkWidthScale",e),min:.1,max:5,step:.1}),n.jsx(Mt,{label:"Opacity",value:Ds.linkOpacity,onChange:e=>Ls("linkOpacity",e),min:0,max:1,step:.05}),n.jsx(Mt,{label:"Greyout Opacity",value:Ds.linkGreyoutOpacity,onChange:e=>Ls("linkGreyoutOpacity",e),min:0,max:1,step:.05}),Ds.curvedLinks&&n.jsx(Mt,{label:"Curve Weight",value:Ds.curvedLinkWeight,onChange:e=>Ls("curvedLinkWeight",e),min:0,max:1,step:.05}),Ds.linkDefaultArrows&&n.jsx(Mt,{label:"Arrow Size",value:Ds.linkArrowsSizeScale,onChange:e=>Ls("linkArrowsSizeScale",e),min:.1,max:3,step:.1}),n.jsx(Bt,{label:"Scale on Zoom",checked:Ds.scaleLinksOnZoom,onChange:e=>Ls("scaleLinksOnZoom",e)})]}),"rendering"===Ke&&n.jsxs(n.Fragment,{children:[n.jsx(Mt,{label:"Space Size",value:Ds.spaceSize,onChange:e=>Ls("spaceSize",e),min:1024,max:16384,step:512}),n.jsx("div",{className:"pt-2 border-t border-border-subtle/50",children:n.jsx("p",{className:"text-[9px] text-text-muted",children:"Space size defines the simulation boundary. Larger values allow more spread."})})]})]})]}),Fn=n.jsxs(nt,{id:"export",title:"Export Topology",icon:n.jsx(_,{}),open:_t,onClose:()=>qt(!1),defaultPosition:{x:"undefined"!=typeof window?window.innerWidth-280:600,y:100},defaultSize:{width:256,height:320},minSize:{width:220,height:150},autoHeight:!0,children:[n.jsx("div",{className:"py-1",children:[{label:"Full Topology (JSON)",format:"json",dataset:"full",desc:"All data: nodes, edges, paths, TX delay"},{label:"Gephi Graph (GEXF)",format:"gexf",dataset:"full",desc:"Import into Gephi for advanced analysis"},{label:"Nodes (CSV)",format:"csv",dataset:"nodes",desc:"Node metrics: centrality, class, signal"},{label:"Edges (CSV)",format:"csv",dataset:"edges",desc:"Edge metrics: confidence, symmetry, type"},{label:"Path Health (CSV)",format:"csv",dataset:"pathHealth",desc:"Route health scores and trends"},{label:"TX Delay (CSV)",format:"csv",dataset:"txDelay",desc:"TX delay recommendations per node"}].map(({label:e,format:t,dataset:s,desc:a})=>n.jsxs("button",{onClick:()=>fn(t,s),className:"w-full flex flex-col px-3 py-2 text-left hover-bg transition-base",children:[n.jsx("span",{className:"text-[11px] font-medium text-text-primary",children:e}),n.jsx("span",{className:"text-[9px] text-text-muted",children:a})]},`${t}-${s}`))}),n.jsx("div",{className:"px-3 py-1.5 border-t border-border-subtle",children:n.jsxs("span",{className:"text-[9px] text-text-muted",children:[(null==(z=null==ue?void 0:ue.nodeMetrics)?void 0:z.size)??0," nodes · ",(null==(T=null==ue?void 0:ue.validatedEdges)?void 0:T.length)??0," edges"]})})]}),Ln={info:{dot:"bg-accent-primary",text:"text-text-secondary"},warning:{dot:"bg-status-warning",text:"text-status-warning"},critical:{dot:"bg-status-danger",text:"text-status-danger"}},Rn={"edge-appeared":"Link Discovered","edge-disappeared":"Link Lost","ghost-appeared":"Ghost Discovered","ghost-disappeared":"Ghost Resolved","betweenness-shift":"Traffic Rerouting","community-change":"Community Change","class-change":"Role Change","node-appeared":"Node Appeared","node-disappeared":"Node Dropped"},Mn=(e,t,s)=>null==t||""===t?null:n.jsxs("div",{className:"flex justify-between gap-2",children:[n.jsx("span",{className:"text-text-muted",children:e}),n.jsx("span",{className:`tabular-nums text-right ${s??"text-text-secondary"}`,children:t})]}),Bn=e=>{const t=[];return e.isZeroHop&&t.push({label:"Zero-Hop",color:"text-status-warning"}),e.isDirectPath&&t.push({label:"Direct",color:"text-accent-primary"}),e.isBackbone&&t.push({label:"Backbone",color:"text-text-primary"}),e.isLoop&&t.push({label:"Loop",color:"text-accent-secondary"}),0===t.length?null:n.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.map(e=>n.jsx("span",{className:`text-[8px] font-medium uppercase tracking-wider px-1 py-px radius-badge bg-subtle-fill ${e.color}`,children:e.label},e.label))})},Hn=e=>n.jsxs("div",{className:"text-[9px] space-y-0.5",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"capitalize font-medium text-text-secondary",children:e.nodeClass}),e.isZeroHop&&n.jsx("span",{className:"text-[8px] font-medium uppercase tracking-wider px-1 py-px radius-badge bg-subtle-fill text-status-warning",children:"Neighbor"})]}),Mn("Degree",e.degree),e.betweenness>.01&&Mn("Betweenness",e.betweenness.toFixed(3)),Mn("Packets",e.packetCount),Mn("Community",`#${e.communityId}`),Mn("Activity",e.activityLevel),null!=e.avgRssi&&Mn("RSSI",`${e.avgRssi.toFixed(0)} dBm`),null!=e.avgSnr&&Mn("SNR",`${e.avgSnr.toFixed(1)} dB`)]}),An=e=>n.jsxs("div",{className:"text-[9px] space-y-0.5",children:[null!=e.previousValue&&null!=e.currentValue&&n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx("span",{className:"text-text-muted font-mono",children:"number"==typeof e.previousValue?e.previousValue.toFixed(3):e.previousValue}),n.jsx("span",{className:"text-text-muted/40",children:"→"}),n.jsx("span",{className:"text-text-secondary font-mono",children:"number"==typeof e.currentValue?e.currentValue.toFixed(3):e.currentValue}),"number"==typeof e.previousValue&&"number"==typeof e.currentValue&&n.jsxs("span",{className:e.currentValue>e.previousValue?"text-accent-success":"text-signal-poor",children:["(",e.currentValue>e.previousValue?"+":"",(e.currentValue-e.previousValue).toFixed(3),")"]})]}),e.nodeDetail&&n.jsxs(n.Fragment,{children:[Mn("Class",e.nodeDetail.nodeClass),Mn("Degree",e.nodeDetail.degree),e.nodeDetail.betweenness>.01&&Mn("Betweenness",e.nodeDetail.betweenness.toFixed(3))]})]}),En=s.useCallback(e=>{fs(t=>t===e?null:e)},[]),Pn=n.jsxs(nt,{id:"anomaly",title:"Anomaly Log",icon:n.jsx(ee,{}),open:ds,onClose:()=>us(!1),defaultPosition:{x:"undefined"!=typeof window?window.innerWidth-328:600,y:100},defaultSize:{width:308,height:400},minSize:{width:260,height:180},maxSize:{width:440,height:700},headerActions:xs.length>0?n.jsx("button",{onClick:()=>{vs.current.clear(),ms([]),fs(null)},className:"p-0.5 radius-badge hover-bg transition-base",title:"Clear all",children:n.jsx(de,{className:"w-2.5 h-2.5 text-text-muted"})}):void 0,children:[0===xs.length?n.jsxs("div",{className:"px-3 py-6 text-center",children:[n.jsx(ee,{className:"w-5 h-5 text-text-muted mx-auto mb-1.5"}),n.jsx("p",{className:"text-[11px] text-text-muted",children:"No anomalies detected yet"}),n.jsx("p",{className:"text-[9px] text-text-muted/60 mt-0.5",children:"Changes appear after topology recomputes"})]}):n.jsx("div",{className:"overflow-y-auto",children:xs.slice(0,50).map(e=>{const t=Ln[e.severity],s=B(e.detectedAt/1e3),a=gs===e.id,i=!(!e.edgeDetail&&!e.nodeDetail&&null==e.previousValue);return n.jsxs("div",{className:`border-b border-border-subtle/50 last:border-0 transition-colors ${i?"cursor-pointer hover-bg":""} ${a?"bg-subtle-fill/50":""}`,onClick:i?()=>En(e.id):void 0,children:[n.jsxs("div",{className:"flex items-start gap-2 px-3 py-1.5",children:[n.jsx("span",{className:`w-1.5 h-1.5 rounded-full shrink-0 mt-1.5 ${t.dot}`}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:`text-[10px] leading-tight ${t.text}`,children:e.description}),n.jsxs("p",{className:"text-[9px] text-text-muted/60 mt-0.5",children:[Rn[e.category]??e.category," · ",s]})]}),i&&n.jsx(H,{className:"w-3 h-3 text-text-muted/40 shrink-0 mt-0.5 transition-transform duration-150 "+(a?"rotate-180":"")})]}),a&&n.jsx("div",{className:"px-3 pb-2 pl-6",children:n.jsxs("div",{className:"border-l-2 border-border-subtle/60 pl-2 py-0.5",children:[e.edgeDetail&&(r=e.edgeDetail,o=e.category,n.jsxs("div",{className:"text-[9px] space-y-0.5",children:[(r.fromClass||r.toClass)&&n.jsxs("div",{className:"flex items-center gap-1 text-text-muted",children:[n.jsx("span",{className:"capitalize",children:r.fromClass??"?"}),n.jsx("span",{className:"text-text-muted/40",children:"↔"}),n.jsx("span",{className:"capitalize",children:r.toClass??"?"})]}),"edge-appeared"===o&&r.packetCount>0&&n.jsxs(n.Fragment,{children:[Mn("Packets",r.packetCount),Mn("Confidence",`${(100*r.confidence).toFixed(0)}%`,r.confidence>=.8?"text-accent-success":r.confidence>=.5?"text-accent-secondary":"text-signal-poor"),Mn("Symmetry",`${(100*r.symmetryRatio).toFixed(0)}%`)]}),r.isZeroHop&&null!=r.avgRssi&&Mn("RSSI",`${r.avgRssi.toFixed(0)} dBm`),r.isZeroHop&&null!=r.avgSnr&&Mn("SNR",`${r.avgSnr.toFixed(1)} dB`),null!=r.fromBetweenness&&r.fromBetweenness>.01&&Mn(`${r.fromName??"A"} centrality`,r.fromBetweenness.toFixed(3)),null!=r.toBetweenness&&r.toBetweenness>.01&&Mn(`${r.toName??"B"} centrality`,r.toBetweenness.toFixed(3)),Bn(r)]})),e.nodeDetail&&!e.edgeDetail&&("node-appeared"===e.category||"node-disappeared"===e.category)&&Hn(e.nodeDetail),("betweenness-shift"===e.category||"community-change"===e.category||"class-change"===e.category)&&An(e)]})})]},e.id);var r,o})}),xs.length>0&&n.jsx("div",{className:"px-3 py-1.5 border-t border-border-subtle",children:n.jsxs("span",{className:"text-[9px] text-text-muted",children:[xs.length," total · showing ",Math.min(xs.length,50)]})})]}),zn=s.useMemo(()=>{const e={};for(const t of zs)e[t.edgeType]=(e[t.edgeType]??0)+1;return e},[zs]),Tn=n.jsxs(nt,{id:"legend",title:"Legend",icon:n.jsx(se,{}),open:Ye,onClose:()=>Je(!1),defaultPosition:{x:12,y:60},defaultSize:{width:224,height:400},minSize:{width:200,height:150},maxSize:{width:360,height:700},autoHeight:!0,children:[n.jsxs("div",{className:"border-b border-border-subtle",children:[n.jsxs("button",{onClick:()=>tt(e=>!e),className:"w-full flex items-center gap-1.5 px-3 py-1.5 text-[10px] font-medium text-text-secondary hover-bg transition-base",children:[et?n.jsx(H,{className:"w-3 h-3"}):n.jsx(ae,{className:"w-3 h-3"}),"Nodes",n.jsx("span",{className:"text-text-muted ml-auto tabular-nums",children:_s.length})]}),et&&n.jsx("div",{className:"px-2 pb-2 space-y-0.5",children:[["local","Local"],["hub","Hub"],["gateway","Gateway"],["backbone","Backbone"],["neighbor","Neighbor"],["mobile","Mobile"],["ghost","Ghost"],["standard","Standard"]].map(([e,t])=>{const s=he[e]??0;if(0===s&&"local"!==e)return null;const a=Ht.has(e);return n.jsx(F,{content:bt[e],children:n.jsxs("button",{onClick:()=>cn(e),className:"w-full flex items-center gap-2 px-2 py-1 radius-badge transition-base text-left "+(a?"opacity-40":"hover-bg"),children:[n.jsx("span",{className:"w-2.5 h-2.5 rounded-full shrink-0",style:{backgroundColor:be[e]}}),n.jsx("span",{className:"text-[10px] text-text-secondary flex-1",children:t}),n.jsx("span",{className:"text-[10px] text-text-muted tabular-nums",children:s})]})},e)})})]}),n.jsxs("div",{className:"border-b border-border-subtle",children:[n.jsxs("button",{onClick:()=>yt(e=>!e),className:"w-full flex items-center gap-1.5 px-3 py-1.5 text-[10px] font-medium text-text-secondary hover-bg transition-base",children:[st?n.jsx(H,{className:"w-3 h-3"}):n.jsx(ae,{className:"w-3 h-3"}),"Edges",n.jsx("span",{className:"text-text-muted ml-auto tabular-nums",children:qs.length})]}),st&&n.jsx("div",{className:"px-2 pb-2 space-y-0.5",children:[{type:"zero-hop",label:"Zero-Hop RF"},{type:"direct-path",label:"Direct Path"},{type:"loop",label:"Loop"},{type:"backbone",label:"Backbone"},{type:"standard",label:"Standard"},{type:"ghost",label:"Ghost"}].map(({type:e,label:t})=>{const s=zn[e]??0;if(0===s)return null;const a=wt(e,.8,ve);return n.jsx(F,{content:kt[e],children:n.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 cursor-help",children:[n.jsx("span",{className:"w-4 h-0.5 shrink-0 rounded-full",style:{backgroundColor:a}}),n.jsx("span",{className:"text-[10px] text-text-secondary flex-1",children:t}),n.jsx("span",{className:"text-[10px] text-text-muted tabular-nums",children:s})]})},e)})})]}),Ut&&Vs&&n.jsxs("div",{className:"border-b border-border-subtle",children:[n.jsxs("div",{className:"px-3 py-1.5 text-[10px] font-medium text-accent-success flex items-center gap-1.5",children:[n.jsx(M,{className:"w-3 h-3"}),"Link Budget",n.jsxs("span",{className:"text-text-muted ml-auto tabular-nums",children:[Vs.analyzedEdges+Vs.rssiOnlyEdges,"/",Vs.totalEdges]})]}),n.jsxs("div",{className:"px-3 pb-2 space-y-0.5",children:[(()=>{const e=Ts&&Ts>1e5?Ts/1e6:Ts||915,t=Jt??Is??12,s=ts??($s&&$s>1e3?$s/1e3:$s||125),a=ns??Os??5,i=Yt??Gs??22,r=Ee(t,s,a),o=is??r,l=Pe(1e3*s),c=os??l,d=(null==Zs?void 0:Zs.filter(e=>e.isTraceEstimated).length)??0,u=(null==Zs?void 0:Zs.filter(e=>e.isZeroHop).length)??0,x=null!=Yt||null!=Jt||null!=ts||null!=ns||null!=is,m="w-10 px-1 py-0 text-[10px] text-right tabular-nums bg-subtle-fill border border-border-subtle rounded text-text-secondary focus:outline-none focus:border-accent-primary";return n.jsxs("div",{className:"pb-1 mb-1 border-b border-border-subtle space-y-0.5",children:[n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx("span",{className:"text-text-muted",children:"Frequency"}),n.jsxs("span",{className:"text-text-secondary tabular-nums",children:[e.toFixed(3)," MHz"]})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px] gap-1",children:[n.jsx("span",{className:"text-text-muted",children:"SF"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("select",{value:t,onChange:e=>{const t=parseInt(e.target.value,10);es(t===(Is??12)?null:t)},className:m+" w-12 appearance-none",children:[7,8,9,10,11,12].map(e=>n.jsxs("option",{value:e,children:["SF",e]},e))}),null!=Jt&&n.jsx("button",{onClick:()=>es(null),className:"text-[8px] text-accent-primary hover:underline",title:"Reset",children:"↺"})]})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px] gap-1",children:[n.jsx("span",{className:"text-text-muted",children:"BW"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("select",{value:s,onChange:e=>{const t=parseFloat(e.target.value);ss(t===($s&&$s>1e3?$s/1e3:$s||125)?null:t)},className:m+" w-14 appearance-none",children:[62.5,125,250,500].map(e=>n.jsxs("option",{value:e,children:[e," kHz"]},e))}),null!=ts&&n.jsx("button",{onClick:()=>ss(null),className:"text-[8px] text-accent-primary hover:underline",title:"Reset",children:"↺"})]})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px] gap-1",children:[n.jsx("span",{className:"text-text-muted",children:"CR"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("select",{value:a,onChange:e=>{const t=parseInt(e.target.value,10);as(t===(Os??5)?null:t)},className:m+" w-12 appearance-none",children:[5,6,7,8].map(e=>n.jsxs("option",{value:e,children:["4/",e]},e))}),null!=ns&&n.jsx("button",{onClick:()=>as(null),className:"text-[8px] text-accent-primary hover:underline",title:"Reset",children:"↺"})]})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px] gap-1",children:[n.jsx("span",{className:"text-text-muted",children:"TX Power"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("input",{type:"number",min:1,max:36,step:1,value:i,onChange:e=>{const t=parseInt(e.target.value,10);isNaN(t)||Qt(t)},onBlur:e=>{const t=parseInt(e.target.value,10);isNaN(t)?Qt(null):Qt(Math.max(1,Math.min(36,t)))},className:m}),n.jsx("span",{className:"text-text-muted",children:"dBm"}),null!=Yt&&n.jsx("button",{onClick:()=>Qt(null),className:"text-[8px] text-accent-primary hover:underline",title:"Reset",children:"↺"})]})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px] gap-1",children:[n.jsx("span",{className:"text-text-muted",children:"Sensitivity"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("input",{type:"number",min:-150,max:-80,step:.5,value:Math.round(10*o)/10,onChange:e=>{const t=parseFloat(e.target.value);isNaN(t)||rs(t)},onBlur:e=>{const t=parseFloat(e.target.value);isNaN(t)?rs(null):rs(Math.max(-150,Math.min(-80,t)))},className:m+" w-12"}),n.jsx("span",{className:"text-text-muted",children:"dBm"}),null!=is&&n.jsx("button",{onClick:()=>rs(null),className:"text-[8px] text-accent-primary hover:underline",title:"Reset",children:"↺"})]})]}),d>0&&n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx("span",{className:"text-text-muted",children:"Noise Floor"}),n.jsxs("span",{className:"text-text-secondary tabular-nums "+(null!=os?"":"italic text-text-muted"),children:[c.toFixed(1)," dBm",null!=os?"":" (est.)"]})]}),x&&n.jsx("button",{onClick:()=>{Qt(null),es(null),ss(null),as(null),rs(null)},className:"w-full text-[9px] text-accent-primary hover:underline text-center pt-0.5",children:"Reset all to radio config"}),(u>0||d>0)&&n.jsxs("div",{className:"flex items-center justify-between text-[10px] pt-0.5",children:[n.jsx("span",{className:"text-text-muted",children:"Sources"}),n.jsxs("span",{className:"text-text-secondary tabular-nums",children:[u>0&&n.jsxs("span",{children:[u," direct"]}),u>0&&d>0&&n.jsx("span",{className:"text-text-muted",children:" · "}),d>0&&n.jsxs("span",{className:"text-accent-secondary",children:[d," trace"]})]})]})]})})(),null!=Vs.avgMarginDb&&n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx("span",{className:"text-text-muted",children:"Avg Margin"}),n.jsxs("span",{className:"text-text-secondary tabular-nums",children:[Vs.avgMarginDb>0?"+":"",Vs.avgMarginDb.toFixed(1)," dB"]})]}),["excellent","good","fair","marginal","critical"].map(e=>{const t=Vs.marginCounts[e];return 0===t?null:n.jsxs("div",{className:"flex items-center gap-2 px-1 py-0.5",children:[n.jsx("span",{className:"w-3 h-0.5 shrink-0 rounded-full",style:{backgroundColor:Oe[e]}}),n.jsx("span",{className:"text-[10px] text-text-secondary flex-1 capitalize",children:e}),n.jsx("span",{className:"text-[10px] text-text-muted tabular-nums",children:t})]},e)}),Vs.anomalousCount>0&&n.jsxs("div",{className:"flex items-center justify-between text-[10px] pt-0.5",children:[n.jsx("span",{className:"text-status-warning",children:"Anomalous"}),n.jsx("span",{className:"text-status-warning tabular-nums",children:Vs.anomalousCount})]})]})]}),vn&&vn.atRiskPaths.length>0&&n.jsxs("div",{className:"border-b border-border-subtle",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsxs("button",{onClick:()=>St(e=>!e),className:"flex-1 flex items-center gap-1.5 px-3 py-1.5 text-[10px] font-medium text-status-warning hover-bg transition-base",children:[Ct?n.jsx(H,{className:"w-3 h-3"}):n.jsx(ae,{className:"w-3 h-3"}),"At-Risk Paths",n.jsxs("span",{className:"text-text-muted ml-auto tabular-nums",children:[vn.criticalCount>0&&n.jsxs("span",{className:"text-status-danger",children:[vn.criticalCount,"c"]}),vn.criticalCount>0&&vn.highCount>0&&" ",vn.highCount>0&&n.jsxs("span",{className:"text-status-warning",children:[vn.highCount,"h"]}),(vn.criticalCount>0||vn.highCount>0)&&vn.moderateCount>0&&" ",vn.moderateCount>0&&n.jsxs("span",{className:"text-text-muted",children:[vn.moderateCount,"m"]})]})]}),n.jsx(F,{content:n.jsxs("div",{className:"max-w-xs space-y-1.5",children:[n.jsx("div",{className:"font-semibold text-text-primary",children:"Predictive Path Failure"}),n.jsx("div",{className:"text-text-secondary text-[11px]",children:"Identifies paths at risk of failure by combining four weighted factors. Paths below the moderate threshold (35%) are not shown."}),n.jsxs("div",{className:"pt-1 border-t border-border-subtle/30 space-y-0.5 text-[10px]",children:[n.jsx("div",{className:"text-text-muted font-medium",children:"Factor weights"}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-text-secondary",children:"Declining usage"}),n.jsx("span",{className:"text-text-muted tabular-nums",children:"35%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-text-secondary",children:"Weak link certainty"}),n.jsx("span",{className:"text-text-muted tabular-nums",children:"30%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-text-secondary",children:"No alternate paths"}),n.jsx("span",{className:"text-text-muted tabular-nums",children:"20%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-text-secondary",children:"Low signal margin"}),n.jsx("span",{className:"text-text-muted tabular-nums",children:"15%"})]})]}),n.jsxs("div",{className:"pt-1 border-t border-border-subtle/30 space-y-0.5 text-[10px]",children:[n.jsx("div",{className:"text-text-muted font-medium",children:"Risk thresholds"}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-status-danger",children:"Critical"}),n.jsx("span",{className:"text-text-muted tabular-nums",children:"≥75% — failure likely imminent"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-status-warning",children:"High"}),n.jsx("span",{className:"text-text-muted tabular-nums",children:"55-74% — significant risk"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-text-muted",children:"Moderate"}),n.jsx("span",{className:"text-text-muted tabular-nums",children:"35-54% — worth monitoring"})]})]}),n.jsxs("div",{className:"pt-1 border-t border-border-subtle/30 text-[10px] text-text-muted font-mono space-y-0.5",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:"Edges analyzed"}),n.jsx("span",{className:"tabular-nums",children:vn.edgesAnalyzed})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:"With signal data"}),n.jsx("span",{className:"tabular-nums",children:vn.edgesWithSignal})]})]})]}),children:n.jsx("span",{className:"px-2 py-1.5 text-text-muted cursor-help",children:n.jsx(ee,{className:"w-3 h-3"})})})]}),Ct&&n.jsx("div",{className:"px-2 pb-2 space-y-1",children:vn.atRiskPaths.slice(0,8).map(e=>{const t="critical"===e.riskLevel?"#EF4444":"high"===e.riskLevel?"#F97316":"#FBBF24",s="imminent"===e.urgency?"IMM":"near-term"===e.urgency?"NEAR":"WATCH";return n.jsx(F,{content:n.jsxs("div",{className:"max-w-xs space-y-1.5",children:[n.jsx("div",{className:"font-semibold text-text-primary font-mono text-[11px]",children:e.hops.join(" → ")}),n.jsxs("div",{className:"space-y-0.5 text-[10px]",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-text-muted",children:"Risk score"}),n.jsxs("span",{className:"font-semibold tabular-nums",style:{color:t},children:[(100*e.riskScore).toFixed(1),"%"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-text-muted",children:"Health score"}),n.jsxs("span",{className:"text-text-primary tabular-nums",children:[(100*e.healthScore).toFixed(0),"%"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-text-muted",children:"Obs. trend"}),n.jsxs("span",{className:"tabular-nums "+(e.observationTrend<0?"text-status-danger":"text-text-secondary"),children:[e.observationTrend>0?"+":"",e.observationTrend.toFixed(3)]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-text-muted",children:"Alt. paths"}),n.jsx("span",{className:"tabular-nums "+(0===e.alternatePathsCount?"text-status-danger":"text-text-secondary"),children:e.alternatePathsCount})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-text-muted",children:"Urgency"}),n.jsx("span",{className:"capitalize",style:{color:t},children:e.urgency})]})]}),e.factors.length>0&&n.jsxs("div",{className:"pt-1 border-t border-border-subtle/30 space-y-0.5 text-[10px]",children:[n.jsx("div",{className:"text-text-muted font-medium",children:"Contributing factors"}),e.factors.map((e,t)=>n.jsxs("div",{className:"space-y-0.5",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-text-secondary",children:e.name}),n.jsxs("span",{className:"text-text-muted tabular-nums",children:[(e.score*e.weight*100).toFixed(1),"% (",(100*e.weight).toFixed(0),"w × ",(100*e.score).toFixed(0),"s)"]})]}),n.jsx("div",{className:"text-text-muted pl-1",children:e.description})]},t))]})]}),children:n.jsxs("div",{className:"px-2 py-1 radius-badge bg-subtle-fill/30 cursor-help",children:[n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx("span",{className:"w-1.5 h-1.5 rounded-full shrink-0",style:{backgroundColor:t}}),n.jsx("span",{className:"text-[10px] text-text-secondary font-mono truncate flex-1",children:e.hops.join(" → ")}),n.jsx("span",{className:"text-[8px] uppercase tracking-wide px-1 py-px radius-badge",style:{backgroundColor:`${t}20`,color:t},children:s}),n.jsxs("span",{className:"text-[10px] tabular-nums font-semibold",style:{color:t},children:[(100*e.riskScore).toFixed(0),"%"]})]}),n.jsx("div",{className:"flex flex-wrap gap-1 mt-0.5 pl-3",children:e.factors.map((t,s)=>n.jsxs("span",{className:"text-[8px] text-text-muted",children:[t.name," (",(t.score*t.weight*100).toFixed(0),"%)",s<e.factors.length-1?" ·":""]},s))})]})},e.pathKey)})})]}),n.jsxs("div",{className:"px-3 py-2 space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(F,{content:"Number of detected community clusters via graph partitioning",children:n.jsx("span",{className:"text-text-muted cursor-help",children:"Communities"})}),n.jsx("span",{className:"text-text-secondary tabular-nums",children:"louvain"===zt&&yn?yn.numCommunities:pe})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(F,{content:"Spectral uses eigenvector decomposition; Louvain maximizes modularity iteratively. Click to switch.",children:n.jsx("span",{className:"text-text-muted cursor-help",children:"Algorithm"})}),n.jsx("button",{onClick:()=>Tt(e=>"spectral"===e?"louvain":"spectral"),className:"text-accent-primary hover:underline cursor-pointer",children:"spectral"===zt?"Spectral":"Louvain"})]}),"louvain"===zt&&yn&&n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(F,{content:"Louvain modularity score — quality of community partition (higher = better defined communities)",children:n.jsx("span",{className:"text-text-muted cursor-help",children:"Modularity Q"})}),n.jsx("span",{className:"text-text-secondary tabular-nums",children:yn.modularity.toFixed(4)})]}),"louvain"===zt&&n.jsxs("div",{className:"mt-1.5 pt-1.5 border-t border-border-subtle space-y-1.5",children:[n.jsx(Mt,{label:"Resolution γ",value:$t,onChange:It,min:.01,max:5,step:.01}),n.jsx(Mt,{label:"K-weight",value:Gt,onChange:Ot,min:.01,max:5,step:.01}),(1!==$t||1!==Gt)&&n.jsx("button",{onClick:()=>{It(1),Ot(1)},className:"w-full text-[10px] text-accent-primary hover:underline text-center",children:"Reset defaults"})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(F,{content:"Redundant path cycles in the topology — indicates alternate routing options",children:n.jsx("span",{className:"text-text-muted cursor-help",children:"Loops"})}),n.jsx("span",{className:"text-text-secondary tabular-nums",children:(null==($=null==ue?void 0:ue.loops)?void 0:$.length)??0})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(F,{content:"High-betweenness edges that carry disproportionate traffic flow",children:n.jsx("span",{className:"text-text-muted cursor-help",children:"Backbone"})}),n.jsx("span",{className:"text-text-secondary tabular-nums",children:(null==(I=null==ue?void 0:ue.backboneEdges)?void 0:I.length)??0})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(F,{content:"Unresolved prefix nodes inferred by Viterbi HMM from repeated path patterns",children:n.jsx("span",{className:"text-text-muted cursor-help",children:"Ghosts"})}),n.jsx("span",{className:"text-text-secondary tabular-nums",children:me.length})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(F,{content:"Community-aware node coloring — groups nodes by cluster assignment",children:n.jsx("span",{className:"text-text-muted cursor-help",children:"Clustering"})}),n.jsx("span",{className:"tabular-nums "+(Et?"text-accent-primary":"text-text-muted"),children:Et?"On":"Off"})]}),null!=bn&&n.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[n.jsx(F,{content:"Algebraic connectivity — 2nd-smallest eigenvalue of the graph Laplacian. Near-zero = one bridge from network partition.",children:n.jsx("span",{className:"text-text-muted cursor-help",children:"Fiedler λ₂"})}),n.jsx("span",{className:"tabular-nums "+(bn<.01?"text-status-warning":"text-text-secondary"),children:bn.toFixed(4)})]}),Ht.size>0&&n.jsxs("button",{onClick:()=>At(new Set),className:"w-full mt-1 text-[10px] text-accent-primary hover:underline text-center",children:["Clear filters (",Ht.size,")"]})]})]}),$n=n.jsx(x,{children:ze&&n.jsx(m.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.15},className:"absolute top-4 left-1/2 -translate-x-1/2 z-30 w-80",children:n.jsxs("div",{className:"surface-elevated radius-inset shadow-2xl overflow-hidden",children:[n.jsxs("div",{className:"flex items-center gap-2 px-3 py-2.5 border-b border-border-subtle",children:[n.jsx(J,{className:"w-4 h-4 text-text-muted shrink-0"}),n.jsx("input",{ref:bs,type:"text",value:He,onChange:e=>Ae(e.target.value),placeholder:"Search by name or prefix...",className:"flex-1 bg-transparent text-sm text-text-primary placeholder:text-text-muted focus:outline-none",onKeyDown:e=>{"Escape"===e.key?(Te(!1),Ae("")):"Enter"===e.key&&rn.length>0&&on(rn[0])}}),He&&n.jsx("button",{onClick:()=>Ae(""),className:"p-0.5 radius-badge hover-bg transition-base",children:n.jsx(p,{className:"w-3 h-3 text-text-muted"})})]}),rn.length>0&&n.jsx("div",{className:"max-h-64 overflow-y-auto",children:rn.map((e,t)=>n.jsxs("button",{onClick:()=>on(e),className:"w-full flex items-center gap-3 px-3 py-2 text-left hover-bg transition-base "+(0===t?"bg-subtle-fill/50":""),children:[n.jsx("span",{className:"w-2.5 h-2.5 rounded-full shrink-0",style:{backgroundColor:be[e.nodeClass]}}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-sm text-text-primary truncate",children:e.name||e.prefix}),e.name&&n.jsx("div",{className:"text-[10px] text-text-muted",children:e.prefix})]}),n.jsx(te,{className:"w-3 h-3 text-text-muted shrink-0"})]},e.id))}),He&&0===rn.length&&n.jsx("div",{className:"px-3 py-4 text-center text-sm text-text-muted",children:"No nodes found"}),!He&&n.jsx("div",{className:"px-3 py-2 type-data-xs text-text-muted",children:"Type to search • Enter to select • Esc to close"})]})})});return O?0===As.length?n.jsxs("div",{className:"relative h-[calc(100dvh-56px)] lg:h-dvh min-h-[500px] -mx-4 sm:-mx-6 lg:-mx-8 -mt-5 -mb-4 sm:-mb-6 lg:-mb-8 overflow-hidden",children:[wn,n.jsx("div",{className:"absolute inset-0 bg-bg-body flex items-center justify-center",children:n.jsx(Rt,{})})]}):js?Me?n.jsxs("div",{className:"fixed inset-0 z-50 bg-bg-body flex flex-col overflow-hidden",children:[n.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5 surface-header z-10",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(S,{className:"w-5 h-5 text-icon-page-title"}),n.jsxs("h1",{className:"type-title text-text-primary flex items-center gap-2",children:["MeshGraph",n.jsx(D,{color:"violet",compact:!0,children:"Analytics"})]}),n.jsxs("span",{className:"text-[10px] text-text-muted tabular-nums",children:[_s.length," nodes • ",qs.length," edges"]})]}),n.jsx(F,{content:"Exit fullscreen",children:n.jsx("button",{onClick:ln,className:"p-1.5 radius-inner hover-bg transition-base",children:n.jsx(q,{className:"w-4 h-4 text-text-muted"})})})]}),n.jsxs("div",{className:"flex-1 relative min-h-0 m-2 surface-base radius-inset overflow-hidden border border-border-subtle",children:[n.jsx(a,{className:"absolute inset-0",points:js,links:ws,...ks,...Ds,backgroundColor:je,fitViewOnInit:!0,fitViewPadding:.15,showLabels:Ue,showDynamicLabels:!1,showTopLabels:Ue,showTopLabelsLimit:200,showHoveredPointLabel:!0,pointLabelColor:Ne,pointClusterBy:Et?"communityId":void 0,onPolygonSelected:Zt?xn:void 0,polygonalSelectorStrokeColor:ve?"#FBBF24":"#D97706",onClick:an,onLinkClick:nn,onMount:Qs,hoveredPointRingColor:ve?"#FBBF24":"#D97706",hoveredPointCursor:"pointer",hoveredLinkCursor:"pointer"}),$n,Tn,Sn,Dn,Fn,Pn,n.jsxs(x,{children:[ke&&n.jsx(Ft,{node:ke,egoMetrics:hn,onExpandEgo:gn,neighbors:pn,onSelectNeighbor:tn,onClose:()=>{var e;Se(null),null==(e=ys.current)||e.unselectAllPoints()}}),Fe&&!ke&&n.jsx(Dt,{edge:Fe,onClose:()=>Le(null)}),Vt&&!ke&&!Fe&&n.jsx(Lt,{metrics:Vt,onClose:mn})]})]})]}):n.jsxs("div",{className:"relative h-[calc(100dvh-56px)] lg:h-dvh min-h-[500px] -mx-4 sm:-mx-6 lg:-mx-8 -mt-5 -mb-4 sm:-mb-6 lg:-mb-8 overflow-hidden",children:[wn,n.jsxs("div",{className:"absolute inset-0",children:[n.jsx(a,{className:"absolute inset-0",points:js,links:ws,...ks,...Ds,backgroundColor:je,fitViewOnInit:!0,fitViewPadding:.15,showLabels:Ue,showDynamicLabels:!1,showTopLabels:Ue,showTopLabelsLimit:200,showHoveredPointLabel:!0,pointLabelColor:Ne,pointClusterBy:Et?"communityId":void 0,onPolygonSelected:Zt?xn:void 0,polygonalSelectorStrokeColor:ve?"#FBBF24":"#D97706",onClick:an,onLinkClick:nn,onMount:Qs,hoveredPointRingColor:ve?"#FBBF24":"#D97706",hoveredPointCursor:"pointer",hoveredLinkCursor:"pointer"}),$n,Tn,Sn,Dn,Fn,Pn,n.jsxs("div",{className:"absolute bottom-4 right-4 z-10 hidden lg:flex items-center gap-3 type-data-xs text-text-muted/60",children:[n.jsxs("span",{children:[n.jsx("kbd",{className:"px-1 py-0.5 radius-badge bg-subtle-fill/50 font-mono",children:"/"})," Search"]}),n.jsxs("span",{children:[n.jsx("kbd",{className:"px-1 py-0.5 radius-badge bg-subtle-fill/50 font-mono",children:"F"})," Fit"]}),n.jsxs("span",{children:[n.jsx("kbd",{className:"px-1 py-0.5 radius-badge bg-subtle-fill/50 font-mono",children:"L"})," Labels"]}),n.jsxs("span",{children:[n.jsx("kbd",{className:"px-1 py-0.5 radius-badge bg-subtle-fill/50 font-mono",children:"Space"})," Pause"]}),n.jsxs("span",{children:[n.jsx("kbd",{className:"px-1 py-0.5 radius-badge bg-subtle-fill/50 font-mono",children:"Esc"})," Clear"]})]}),n.jsxs(x,{children:[ke&&n.jsx(Ft,{node:ke,egoMetrics:hn,onExpandEgo:gn,neighbors:pn,onSelectNeighbor:tn,onClose:()=>{var e;Se(null),null==(e=ys.current)||e.unselectAllPoints()}}),Fe&&!ke&&n.jsx(Dt,{edge:Fe,onClose:()=>Le(null)}),Vt&&!ke&&!Fe&&n.jsx(Lt,{metrics:Vt,onClose:mn})]})]})]}):n.jsxs("div",{className:"relative h-[calc(100dvh-56px)] lg:h-dvh min-h-[500px] -mx-4 sm:-mx-6 lg:-mx-8 -mt-5 -mb-4 sm:-mb-6 lg:-mb-8 overflow-hidden",children:[wn,n.jsxs("div",{className:"absolute inset-0 bg-bg-body flex flex-col items-center justify-center gap-3",children:[n.jsx(A,{className:"w-8 h-8 text-accent-primary animate-spin"}),n.jsx("span",{className:"type-body text-text-muted",children:"Preparing graph..."})]})]}):n.jsxs("div",{className:"relative h-[calc(100dvh-56px)] lg:h-dvh min-h-[500px] -mx-4 sm:-mx-6 lg:-mx-8 -mt-5 -mb-4 sm:-mb-6 lg:-mb-8 overflow-hidden",children:[wn,n.jsxs("div",{className:"absolute inset-0 bg-bg-body flex items-center justify-center",children:[n.jsx(U,{isOpen:X,onClose:re}),!X&&n.jsx(A,{className:"w-8 h-8 text-accent-primary animate-spin"})]})]})}export{Ht as default};
