import{f as e,r as t,j as a,S as r}from"./vendor-react-BXhrzaGn.js";import{c as s}from"./recharts-CnLSZmAf.js";import{c as n,ap as o,aq as i,ar as l,as as c,at as m,au as d}from"./index-BnwqqupC.js";import{a as p}from"./ping-DT1J3Ijc.js";import{P as u,b as y,a as g}from"./PageLayout-CkP0WgKw.js";import"./vendor-core-WoOfkQwm.js";import"./deckgl-DTsmDcfs.js";const h=e(e=>({entries:[],commandHistory:[],isInitialized:!1,addEntry:t=>{const a="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),r={...t,id:a,timestamp:Date.now()};return e(e=>({entries:[...e.entries,r]})),a},updateEntry:(t,a)=>{e(e=>({entries:e.entries.map(e=>e.id===t?{...e,...a}:e)}))},addCommand:t=>{e(e=>({commandHistory:[...e.commandHistory,t]}))},clearEntries:()=>{e({entries:[],commandHistory:[]})},setInitialized:t=>{e({isInitialized:t})}})),f=new Set(["start ota","erase","reboot"]),v=["gps","sensor"],x=[{cmd:"help",desc:"Show available commands"},{cmd:"clear",desc:"Clear terminal screen"},{cmd:"status",desc:"Get repeater status summary"},{cmd:"uptime",desc:"Show system uptime"},{cmd:"packets",desc:"Show packet statistics"},{cmd:"board",desc:"Show board/platform info"},{cmd:"ping",desc:"Ping neighbor (name or 0xXX)",params:"{target} [timeout]",required:!0},{cmd:"convert hex",desc:"Hex → base64 (for config.yaml)",params:"{hex}",required:!0},{cmd:"convert base64",desc:"Base64 → hex",params:"{base64}",required:!0},...[{name:"get adc.multiplier",category:"get",params:[],description:"Get ADC multiplier for battery",serialOnly:!1,hasParam:!1},{name:"get advert.interval",category:"get",params:[],description:"Get local advert interval (minutes)",serialOnly:!1,hasParam:!1},{name:"get af",category:"get",params:[],description:"Get airtime factor",serialOnly:!1,hasParam:!1},{name:"get agc.reset.interval",category:"get",params:[],description:"Get AGC reset interval (seconds)",serialOnly:!1,hasParam:!1},{name:"get allow.read.only",category:"get",params:[],description:"Get read-only access setting",serialOnly:!1,hasParam:!1},{name:"get bridge.baud",category:"get",params:[],description:"Get bridge baud rate",serialOnly:!1,hasParam:!1},{name:"get bridge.channel",category:"get",params:[],description:"Get bridge channel (ESP-NOW)",serialOnly:!1,hasParam:!1},{name:"get bridge.delay",category:"get",params:[],description:"Get bridge delay (ms)",serialOnly:!1,hasParam:!1},{name:"get bridge.enabled",category:"get",params:[],description:"Get bridge enabled status",serialOnly:!1,hasParam:!1},{name:"get bridge.secret",category:"get",params:[],description:"Get bridge encryption secret",serialOnly:!1,hasParam:!1},{name:"get bridge.source",category:"get",params:[],description:"Get bridge packet source",serialOnly:!1,hasParam:!1},{name:"get bridge.type",category:"get",params:[],description:"Get bridge type (rs232/espnow/none)",serialOnly:!1,hasParam:!1},{name:"get direct.txdelay",category:"get",params:[],description:"Get direct TX delay factor",serialOnly:!1,hasParam:!1},{name:"get flood.advert.interval",category:"get",params:[],description:"Get flood advert interval (hours)",serialOnly:!1,hasParam:!1},{name:"get flood.max",category:"get",params:[],description:"Get max flood hops",serialOnly:!1,hasParam:!1},{name:"get freq",category:"get",params:[],description:"Get frequency (MHz)",serialOnly:!1,hasParam:!1},{name:"get guest.password",category:"get",params:[],description:"Get guest password",serialOnly:!1,hasParam:!1},{name:"get int.thresh",category:"get",params:[],description:"Get interference threshold",serialOnly:!1,hasParam:!1},{name:"get lat",category:"get",params:[],description:"Get latitude",serialOnly:!1,hasParam:!1},{name:"get lon",category:"get",params:[],description:"Get longitude",serialOnly:!1,hasParam:!1},{name:"get multi.acks",category:"get",params:[],description:"Get multi-ack setting",serialOnly:!1,hasParam:!1},{name:"get name",category:"get",params:[],description:"Get node name",serialOnly:!1,hasParam:!1},{name:"get prv.key",category:"get",params:[],description:"Get private key (hex)",serialOnly:!1,hasParam:!1},{name:"get public.key",category:"get",params:[],description:"Get public key (hex)",serialOnly:!1,hasParam:!1},{name:"get radio",category:"get",params:[],description:"Get radio params (freq,bw,sf,cr)",serialOnly:!1,hasParam:!1},{name:"get repeat",category:"get",params:[],description:"Get repeat/forward status (on/off)",serialOnly:!1,hasParam:!1},{name:"get role",category:"get",params:[],description:"Get device role",serialOnly:!1,hasParam:!1},{name:"get rxdelay",category:"get",params:[],description:"Get RX delay base",serialOnly:!1,hasParam:!1},{name:"get tx",category:"get",params:[],description:"Get TX power (dBm)",serialOnly:!1,hasParam:!1},{name:"get txdelay",category:"get",params:[],description:"Get TX delay factor",serialOnly:!1,hasParam:!1},{name:"gps",category:"gps",params:[],description:"Show GPS status",serialOnly:!1,hasParam:!1},{name:"gps advert",category:"gps",params:[],description:"Get/set GPS advert location policy",serialOnly:!1,hasParam:!0},{name:"gps off",category:"gps",params:[],description:"Disable GPS",serialOnly:!1,hasParam:!0},{name:"gps on",category:"gps",params:[],description:"Enable GPS",serialOnly:!1,hasParam:!0},{name:"gps setloc",category:"gps",params:[],description:"Set node location from GPS",serialOnly:!1,hasParam:!0},{name:"gps sync",category:"gps",params:[],description:"Sync time from GPS",serialOnly:!1,hasParam:!0},{name:"log",category:"logging",params:[],description:"Dump log file (serial only)",serialOnly:!0,hasParam:!1},{name:"log erase",category:"logging",params:[],description:"Erase log file",serialOnly:!1,hasParam:!0},{name:"log start",category:"logging",params:[],description:"Start packet logging",serialOnly:!1,hasParam:!0},{name:"log stop",category:"logging",params:[],description:"Stop packet logging",serialOnly:!1,hasParam:!0},{name:"neighbor.remove",category:"neighbor",params:[],description:"Remove neighbor by pubkey",serialOnly:!1,hasParam:!0},{name:"neighbors",category:"neighbor",params:[],description:"List neighbors",serialOnly:!1,hasParam:!1},{name:"get",category:"other",params:[],description:"Execute get command",serialOnly:!1,hasParam:!0},{name:"set",category:"other",params:[{name:"value",type:"float"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Execute set command",serialOnly:!1,hasParam:!0},{name:"tempradio",category:"radio",params:[{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Apply temporary radio params (freq bw sf cr timeout_mins)",serialOnly:!1,hasParam:!0},{name:"sensor get",category:"sensor",params:[],description:"Get sensor/custom variable value",serialOnly:!1,hasParam:!0},{name:"sensor list",category:"sensor",params:[{name:"value",type:"int"}],description:"List all sensor/custom variables",serialOnly:!1,hasParam:!0},{name:"sensor set",category:"sensor",params:[],description:"Set sensor/custom variable value",serialOnly:!1,hasParam:!0},{name:"set adc.multiplier",category:"set",params:[{name:"value",type:"float"}],description:"Set ADC multiplier",serialOnly:!1,hasParam:!0},{name:"set advert.interval",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"string"}],description:"Set local advert interval (1-10080 min, 0=off)",serialOnly:!1,hasParam:!0},{name:"set af",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set airtime factor (0-9)",serialOnly:!1,hasParam:!0},{name:"set agc.reset.interval",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set AGC reset interval (seconds, rounded to 4)",serialOnly:!1,hasParam:!0},{name:"set allow.read.only",category:"set",params:[{name:"value",type:"int"}],description:"Set read-only access (on/off)",serialOnly:!1,hasParam:!0},{name:"set bridge.baud",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set bridge baud (9600-115200)",serialOnly:!1,hasParam:!0},{name:"set bridge.channel",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"string"}],description:"Set bridge channel (1-14)",serialOnly:!1,hasParam:!0},{name:"set bridge.delay",category:"set",params:[{name:"value",type:"int"}],description:"Set bridge delay (0-10000 ms)",serialOnly:!1,hasParam:!0},{name:"set bridge.enabled",category:"set",params:[{name:"value",type:"int"}],description:"Enable/disable bridge",serialOnly:!1,hasParam:!0},{name:"set bridge.secret",category:"set",params:[{name:"value",type:"string"},{name:"value",type:"float"}],description:"Set bridge encryption secret",serialOnly:!1,hasParam:!0},{name:"set bridge.source",category:"set",params:[{name:"value",type:"int"}],description:"Set bridge source (rx/tx)",serialOnly:!1,hasParam:!0},{name:"set direct.txdelay",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"}],description:"Set direct TX delay factor",serialOnly:!1,hasParam:!0},{name:"set flood.advert.interval",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set flood advert interval (3-48 hours, 0=off)",serialOnly:!1,hasParam:!0},{name:"set flood.max",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"float"}],description:"Set max flood hops (0-64)",serialOnly:!1,hasParam:!0},{name:"set freq",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"}],description:"Set frequency MHz (serial only, reboot required)",serialOnly:!0,hasParam:!0},{name:"set guest.password",category:"set",params:[{name:"value",type:"string"}],description:"Set guest password",serialOnly:!1,hasParam:!0},{name:"set int.thresh",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set interference threshold",serialOnly:!1,hasParam:!0},{name:"set lat",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"float"},{name:"value",type:"float"}],description:"Set latitude",serialOnly:!1,hasParam:!0},{name:"set lon",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"float"},{name:"value",type:"float"}],description:"Set longitude",serialOnly:!1,hasParam:!0},{name:"set multi.acks",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set multi-ack (0/1)",serialOnly:!1,hasParam:!0},{name:"set name",category:"set",params:[{name:"value",type:"string"},{name:"value",type:"int"}],description:"Set node name",serialOnly:!1,hasParam:!0},{name:"set prv.key",category:"set",params:[{name:"value",type:"string"}],description:"Set private key (hex, restart required)",serialOnly:!1,hasParam:!0},{name:"set radio",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set radio params (freq bw sf cr)",serialOnly:!1,hasParam:!0},{name:"set repeat",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set repeat/forward (on/off)",serialOnly:!1,hasParam:!0},{name:"set rxdelay",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"float"}],description:"Set RX delay base",serialOnly:!1,hasParam:!0},{name:"set tx",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"float"}],description:"Set TX power (dBm)",serialOnly:!1,hasParam:!0},{name:"set txdelay",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"}],description:"Set TX delay factor",serialOnly:!1,hasParam:!0},{name:"stats-core",category:"stats",params:[],description:"Show core statistics (serial only)",serialOnly:!0,hasParam:!1},{name:"stats-packets",category:"stats",params:[],description:"Show packet statistics (serial only)",serialOnly:!0,hasParam:!1},{name:"stats-radio",category:"stats",params:[],description:"Show radio statistics (serial only)",serialOnly:!0,hasParam:!1},{name:"advert",category:"system",params:[],description:"Send self advertisement",serialOnly:!1,hasParam:!1},{name:"board",category:"system",params:[],description:"Show board/manufacturer name",serialOnly:!1,hasParam:!1},{name:"clear stats",category:"system",params:[],description:"Reset statistics counters",serialOnly:!1,hasParam:!0},{name:"clock",category:"system",params:[{name:"value",type:"int"}],description:"Display current time",serialOnly:!1,hasParam:!0},{name:"clock sync",category:"system",params:[],description:"Sync clock from sender timestamp",serialOnly:!1,hasParam:!0},{name:"password",category:"system",params:[{name:"value",type:"string"}],description:"Change admin password",serialOnly:!1,hasParam:!0},{name:"reboot",category:"system",params:[],description:"Reboot the device",serialOnly:!1,hasParam:!1},{name:"start ota",category:"system",params:[{name:"value",type:"int"}],description:"Start OTA firmware update",serialOnly:!1,hasParam:!0},{name:"time",category:"system",params:[{name:"value",type:"int"}],description:"Set time to epoch seconds",serialOnly:!1,hasParam:!0},{name:"ver",category:"system",params:[],description:"Show firmware version and build date",serialOnly:!1,hasParam:!1}].filter(e=>!e.serialOnly&&!f.has(e.name)&&!v.some(t=>e.name.startsWith(t))).map(e=>({cmd:e.name,desc:e.description,params:e.hasParam?"{value}":void 0,required:e.hasParam}))],b={"set mode":["forward","monitor"],"set duty":["on","off"],"set repeat":["on","off"],"set tx":["10","14","17","20","22"],"set sf":["7","8","9","10","11","12"],"set bw":["125","250","500"],"set af":["0.5","1.0","1.5","2.0"],"set txdelay":["0.5","0.7","1.0","1.5"],"set direct.txdelay":["0.3","0.5","0.7"],"set log":["debug","info","warning"]};function w(e){switch(e){case"success":return"text-accent-success";case"error":return"text-accent-danger";case"warning":return"text-amber-400";case"info":return"text-accent-tertiary";case"value":return"text-accent-primary";case"system":return"text-text-muted";default:return"text-text-secondary"}}const P=t.memo(function({entry:e}){return"command"===e.type?a.jsxs("div",{className:"flex items-center gap-2 py-1",children:[a.jsx("span",{className:"text-text-muted font-medium select-none",children:"$"}),a.jsx("span",{className:"text-text-primary font-semibold",children:e.content})]}):"system"===e.type?a.jsx("div",{className:s("py-0.5",w(e.outputType||"system")),children:e.content}):e.content.includes("██")?a.jsx("pre",{className:s("terminal-ascii font-mono leading-none py-2 whitespace-pre",w(e.outputType||"value")),children:e.content}):a.jsx("div",{className:"ml-4 font-mono text-[13px] py-1",children:e.content.split("\n").map((t,r)=>{const s=function(e,t){if(e.startsWith("HELP_HEADER:::"))return[{text:e.slice(14),color:"text-text-primary font-bold"}];if(e.startsWith("HELP_NOTE:::"))return[{text:e.slice(12),color:"text-text-muted italic"}];const a=e.match(/^([a-z][a-z0-9.]*(?:\s+[a-z][a-z0-9.]*)?):::(.+)$/);if(a){const[,e,t]=a,r=e.split(" "),s=r[0];let n="text-accent-tertiary";"get"===s?n="text-accent-success":"set"===s&&(n="text-amber-400");const o=[{text:`  ${s}`,color:`${n} font-semibold`}];r.length>1&&o.push({text:` ${r.slice(1).join(" ")}`,color:"text-accent-primary"});const i=" ".repeat(Math.max(1,22-e.length));return o.push({text:`${i}${t}`,color:"text-text-muted"}),o}if("error"===t||"warning"===t)return[{text:e,color:w(t)}];if("value"===t)return[{text:e,color:w("value")}];const r=e.match(/^([\w\s.]+):\s*(.+)$/);if(r){const[,e,t]=r;return[{text:`${e}: `,color:"text-text-muted"},{text:t,color:"text-accent-primary font-semibold"}]}return e.startsWith("OK")?[{text:e,color:w("success")}]:[{text:e,color:w(t)}]}(t,e.outputType||"default");return a.jsx("div",{className:"leading-relaxed",children:s.map((e,t)=>a.jsx("span",{className:e.color,children:e.text},t))},r)})})});function O(){const e=n(),f=h(e=>e.entries),v=h(e=>e.commandHistory),w=h(e=>e.isInitialized),{addEntry:O,updateEntry:k,addCommand:S,clearEntries:$,setInitialized:_}=h(),[E,N]=t.useState(""),[T,j]=t.useState(-1),[G,C]=t.useState(!1),[F,W]=t.useState([]),[I,D]=t.useState(0),[A,L]=t.useState(0),[R,q]=t.useState(!1),M=t.useRef(null),H=t.useRef(null),K=t.useRef(null);t.useEffect(()=>{w||(async()=>{O({type:"output",content:"██████  ██    ██ ███    ███  ██████\n██   ██  ██  ██  ████  ████ ██     \n██████    ████   ██ ████ ██ ██     \n██         ██    ██  ██  ██ ██     \n██         ██    ██      ██  ██████",outputType:"value"}),await new Promise(e=>setTimeout(e,200));const e=O({type:"system",content:"● Initializing terminal...",outputType:"system"});await new Promise(e=>setTimeout(e,400)),k(e,{content:"✓ Initializing terminal...",outputType:"success"});const t=O({type:"system",content:"● Connecting to repeater...",outputType:"system"});await new Promise(e=>setTimeout(e,600)),k(t,{content:"✓ Connected to repeater",outputType:"success"}),O({type:"system",content:"Ready. Type 'help' for commands.",outputType:"system"}),_(!0)})()},[w,O,k,_]),t.useEffect(()=>{H.current&&(H.current.scrollTop=H.current.scrollHeight)},[f]);const X=t.useCallback(()=>{var e;const t=window.getSelection();t&&t.toString().length>0||null==(e=M.current)||e.focus()},[]),U=t.useMemo(()=>(null==e?void 0:e.neighbors)?Object.values(e.neighbors).map(e=>e.node_name||e.name).filter(e=>!!e).sort():[],[null==e?void 0:e.neighbors]),z=t.useCallback(e=>{const t=e.trim().toLowerCase();if(!t)return C(!1),void W([]);const a=x.filter(e=>e.cmd.toLowerCase().startsWith(t));if(a.length>0)return W(a),D(0),void C(!0);if(t.includes(" ")){const e=t.lastIndexOf(" "),a=t.substring(0,e),r=t.substring(e+1);if("ping"===a&&U.length>0){const e=U.filter(e=>e.toLowerCase().startsWith(r)).slice(0,10).map(e=>({cmd:`ping ${e}`,desc:`→ ${e}`}));if(e.length>0)return W(e),D(0),void C(!0)}const s=x.find(e=>e.cmd.toLowerCase()===a);if(s&&b[s.cmd]){const e=b[s.cmd].filter(e=>e.toLowerCase().startsWith(r)).map(e=>({cmd:`${s.cmd} ${e}`,desc:`→ ${e}`}));if(e.length>0)return W(e),D(0),void C(!0)}}C(!1),W([])},[U]),B=t.useCallback(e=>{var t;const a=F[e];a&&(a.required&&a.params?(N(a.cmd+" "),z(a.cmd+" ")):(N(a.cmd),C(!1)),null==(t=M.current)||t.focus())},[F,z]),V=t.useCallback(async e=>{var t,a,r,s,n,u,y,g,h;const f=e.trim();if(!f)return;const v=f.toLowerCase();if(S(f),O({type:"command",content:f}),"clear"===v)return void $();if("help"===v){const e=x.map(e=>`${e.cmd}:::${e.desc}`).join("\n");return void O({type:"output",content:`HELP_HEADER:::Available commands\n${e}\nHELP_NOTE:::Some MeshCore commands not available via HTTP.`,outputType:"default"})}const b=O({type:"output",content:"processing...",outputType:"system"});try{const e=await o();let x="",O="info";const S=e=>{const t=Math.floor(e/86400),a=Math.floor(e%86400/3600),r=Math.floor(e%3600/60);return t>0?`${t}d ${a}h ${r}m`:a>0?`${a}h ${r}m`:`${r}m`};if("status"===v){x=`Mode: ${(null==(a=null==(t=e.config)?void 0:t.repeater)?void 0:a.mode)||"unknown"} | Neighbors: ${Object.keys(e.neighbors||{}).length} | Uptime: ${S(e.uptime_seconds||0)}`}else if("uptime"===v)x=S(e.uptime_seconds||0),O="value";else if("packets"===v)x=`rx: ${e.rx_count??0}\ntx: ${e.tx_count??0}\nfwd: ${e.forwarded_count??0}\ndrop: ${e.dropped_count??0}`;else if("neighbors"===v){const t=e.neighbors||{},a=Object.entries(t);if(0===a.length)x="No neighbors discovered yet.",O="warning";else{const e=a.map(([e,t])=>{const a=t.name||t.node_name||"Unknown";return`  ${e.slice(0,8)}  ${a}`});x=`Neighbors (${a.length}):\n${e.join("\n")}`}}else if("board"===v)x="pyMC_Repeater (Linux/RPi)",O="value";else if(v.startsWith("get ")){const t=v.slice(4).trim(),a=null==(r=e.config)?void 0:r.delays,o=null==(s=e.config)?void 0:s.radio,i=null==(n=e.config)?void 0:n.repeater,l=null==(u=e.config)?void 0:u.duty_cycle;switch(t){case"name":x=(null==(y=e.config)?void 0:y.node_name)||"Unknown";break;case"role":x="repeater";break;case"lat":x=null!=(null==i?void 0:i.latitude)?String(i.latitude):"not set";break;case"lon":x=null!=(null==i?void 0:i.longitude)?String(i.longitude):"not set";break;case"freq":x=(null==o?void 0:o.frequency)?(o.frequency/1e6).toFixed(3):"?";break;case"tx":x=String((null==o?void 0:o.tx_power)??"?");break;case"bw":x=(null==o?void 0:o.bandwidth)?String(o.bandwidth/1e3):"?";break;case"sf":x=String((null==o?void 0:o.spreading_factor)??"?");break;case"cr":x=String((null==o?void 0:o.coding_rate)??"?");break;case"radio":x=o?`freq: ${(o.frequency/1e6).toFixed(3)} MHz\nbw: ${o.bandwidth/1e3} kHz\nsf: ${o.spreading_factor}\ncr: 4/${o.coding_rate}`:"?";break;case"af":case"txdelay":x=String((null==a?void 0:a.tx_delay_factor)??"1.0");break;case"direct.txdelay":x=String((null==a?void 0:a.direct_tx_delay_factor)??"0.5");break;case"mode":x=(null==i?void 0:i.mode)||"forward";break;case"repeat":x="forward"===(null==i?void 0:i.mode)?"on":"off";break;case"flood.max":x=String((null==i?void 0:i.max_flood_hops)??"3");break;case"flood.advert.interval":x=null!=(null==i?void 0:i.send_advert_interval_hours)?`${i.send_advert_interval_hours}h`:"?";break;case"advert.interval":x=null!=(null==i?void 0:i.advert_interval_minutes)?`${i.advert_interval_minutes}m`:"120m";break;case"rxdelay":x=String((null==a?void 0:a.rx_delay_base)??"0.0");break;case"duty":case"duty.enabled":x=(null==l?void 0:l.enforcement_enabled)?"on":"off";break;case"duty.max":x=null!=(null==l?void 0:l.max_airtime_percent)?`${l.max_airtime_percent}%`:"?";break;case"public.key":x=e.public_key||"not available";break;case"prv.key":x="Private key stored in /etc/pymc_repeater/config.yaml\n\nTo view: sudo grep identity_key /etc/pymc_repeater/config.yaml\nTo set:  sudo ./convert_firmware_key.sh <64-byte-hex>",O="info";break;case"guest.password":case"allow.read.only":x="Security settings not exposed via stats API.\nCheck /etc/pymc_repeater/config.yaml",O="warning";break;default:x=`Unknown parameter: ${t}\nAvailable: name, role, lat, lon, freq, tx, bw, sf, cr, radio, af, txdelay, direct.txdelay, rxdelay, mode, repeat, flood.max, advert.interval, duty, public.key`,O="error"}"error"!==O&&(O="value")}else if("advert"===v){const e=await i();x=e.success?"OK - Advert sent":`Error: ${e.error||"Failed"}`,O=e.success?"success":"error"}else if(v.startsWith("set mode ")){const e=v.split(" ")[2];if("forward"!==e&&"monitor"!==e)x='Error: Mode must be "forward" or "monitor"',O="error";else{const t=await l(e);x=t.success?`OK - Mode set to ${e}`:"Error: Failed",O=t.success?"success":"error"}}else if(v.startsWith("set duty ")){const e=v.split(" ")[2],t="on"===e||"1"===e,a=await c(t);x=a.success?"OK - Duty cycle "+(t?"enabled":"disabled"):"Error: Failed",O=a.success?"success":"error"}else if(v.startsWith("set tx ")){const e=parseInt(v.split(" ")[2]);if(isNaN(e)||e<2||e>22)x="Error: TX power must be 2-22 dBm (SX1262 chip max)",O="error";else{const t=await m({tx_power:e});x=t.success?`OK - TX power set to ${e}dBm`:`Error: ${t.error||"Failed"}`,O=t.success?"success":"error"}}else if(v.startsWith("set af ")||v.startsWith("set txdelay ")){const e=parseFloat(v.split(" ")[2]);if(isNaN(e)||e<0||e>5)x="Error: TX delay factor must be 0.0-5.0",O="error";else{const t=await m({tx_delay_factor:e});x=t.success?`OK - TX delay set to ${e}`:`Error: ${t.error||"Failed"}`,O=t.success?"success":"error"}}else if(v.startsWith("set direct.txdelay ")){const e=parseFloat(v.split(" ")[2]);if(isNaN(e)||e<0||e>5)x="Error: Direct TX delay must be 0.0-5.0",O="error";else{const t=await m({direct_tx_delay_factor:e});x=t.success?`OK - Direct TX delay set to ${e}`:`Error: ${t.error||"Failed"}`,O=t.success?"success":"error"}}else if(v.startsWith("set log ")){const e=null==(g=v.split(" ")[2])?void 0:g.toUpperCase();if(["DEBUG","INFO","WARNING","ERROR"].includes(e)){const t=await d(e);x=t.success?`OK - Log level set to ${e}`:`Error: ${t.error||"Failed"}`,O=t.success?"success":"error"}else x="Error: Level must be debug, info, warning, or error",O="error"}else if(v.startsWith("set rxdelay ")){const e=parseFloat(v.split(" ")[2]);if(isNaN(e)||e<0)x="Error: RX delay must be >= 0",O="error";else{const t=await m({rx_delay_base:e});x=t.success?`OK - RX delay base set to ${e}s`:`Error: ${t.error||"Failed"}`,O=t.success?"success":"error"}}else if(v.startsWith("set name ")){const e=f.substring(9).trim();if(e){const t=await m({node_name:e});x=t.success?`OK - Node name set to "${e}"`:`Error: ${t.error||"Failed"}`,O=t.success?"success":"error"}else x="Error: Node name cannot be empty",O="error"}else if(v.startsWith("set lat ")){const e=parseFloat(v.split(" ")[2]);if(isNaN(e)||e<-90||e>90)x="Error: Latitude must be -90 to 90",O="error";else{const t=await m({latitude:e});x=t.success?`OK - Latitude set to ${e}°`:`Error: ${t.error||"Failed"}`,O=t.success?"success":"error"}}else if(v.startsWith("set lon ")){const e=parseFloat(v.split(" ")[2]);if(isNaN(e)||e<-180||e>180)x="Error: Longitude must be -180 to 180",O="error";else{const t=await m({longitude:e});x=t.success?`OK - Longitude set to ${e}°`:`Error: ${t.error||"Failed"}`,O=t.success?"success":"error"}}else if(v.startsWith("set flood.max ")){const e=parseInt(v.split(" ")[2]);if(isNaN(e)||e<0||e>64)x="Error: Max flood hops must be 0-64",O="error";else{const t=await m({max_flood_hops:e});x=t.success?`OK - Max flood hops set to ${e}`:`Error: ${t.error||"Failed"}`,O=t.success?"success":"error"}}else if(v.startsWith("set flood.advert.interval ")){const e=parseInt(v.split(" ")[2]);if(isNaN(e)||0!==e&&(e<3||e>48))x="Error: Flood advert interval must be 0 (off) or 3-48 hours",O="error";else{const t=await m({flood_advert_interval_hours:e});x=t.success?0===e?"OK - Flood adverts disabled":`OK - Flood advert interval set to ${e}h`:`Error: ${t.error||"Failed"}`,O=t.success?"success":"error"}}else if(v.startsWith("set advert.interval ")){const e=parseInt(v.split(" ")[2]);if(isNaN(e)||0!==e&&(e<1||e>10080))x="Error: Advert interval must be 0 (off) or 1-10080 minutes",O="error";else{const t=await m({advert_interval_minutes:e});x=t.success?0===e?"OK - Local adverts disabled":`OK - Local advert interval set to ${e}m`:`Error: ${t.error||"Failed"}`,O=t.success?"success":"error"}}else if(v.startsWith("set prv.key ")){const e=f.substring(12).trim();e?/^[0-9a-fA-F]+$/.test(e)?128!==e.length?(x=`Error: Key must be 64 bytes (128 hex chars), got ${e.length} chars`,O="error"):(x=`To set this key, run on the Pi:\n\n  sudo ./convert_firmware_key.sh ${e}\n\nThen restart: sudo systemctl restart pymc-repeater`,O="info"):(x="Error: Private key must be a hex string",O="error"):(x="Error: Private key cannot be empty",O="error")}else if(v.startsWith("convert hex ")){const e=f.substring(12).trim();if(e)if(/^[0-9a-fA-F]+$/.test(e))if(e.length%2!=0)x="Error: Hex string must have even length",O="error";else try{const t=new Uint8Array(e.length/2);for(let s=0;s<e.length;s+=2)t[s/2]=parseInt(e.substring(s,s+2),16);let a="";const r=8192;for(let e=0;e<t.length;e+=r){const s=t.subarray(e,Math.min(e+r,t.length));a+=String.fromCharCode.apply(null,Array.from(s))}x="function"==typeof globalThis.btoa?globalThis.btoa(a):Buffer.from(a,"binary").toString("base64"),O="value"}catch(w){x=`Error: Failed to convert - ${w instanceof Error?w.message:"unknown error"}`,O="error"}else x="Error: Input must be a hex string",O="error";else x="Usage: convert hex <hex-string>",O="error"}else if(v.startsWith("convert base64 ")){const e=f.substring(15).trim();if(e)try{const t="function"==typeof globalThis.atob?globalThis.atob(e):Buffer.from(e,"base64").toString("binary");let a="";for(let e=0;e<t.length;e++)a+=t.charCodeAt(e).toString(16).padStart(2,"0");x=a.toUpperCase(),O="value"}catch(w){x=`Error: Invalid base64 string - ${w instanceof Error?w.message:"unknown error"}`,O="error"}else x="Usage: convert base64 <base64-string>",O="error"}else if(v.startsWith("ping ")){const e=f.substring(5).trim(),t=e.split(/\s+/),a=t[t.length-1],r=parseInt(a),s=t.length>1&&!isNaN(r)&&r>0,n=s?t.slice(0,-1).join(" "):e,o=s?r:30;if(n){let e=1;const t=setInterval(()=>{e=e%3+1,k(b,{content:`Pinging ${n}${".".repeat(e)}`,outputType:"system"})},800);try{const e=await p(n,o);if(clearInterval(t),e.success&&e.data){const t=e.data,a=(null==(h=t.path)?void 0:h.length)?t.path.join(" → "):"direct";x=`Reply from ${t.target_id}\n  RTT: ${t.rtt_ms.toFixed(1)}ms\n  RSSI: ${t.rssi}dBm\n  SNR: ${t.snr_db}dB\n  Path: ${a}\n  Quality: ${t.quality}`,O="success"}else x=e.error||"Ping failed",O="error"}catch(P){throw clearInterval(t),P}}else x="Usage: ping <node_name> [timeout]",O="error"}else x=`Unknown command: ${f}\nType 'help' for available commands.`,O="error";k(b,{content:x,outputType:O})}catch(_){k(b,{content:`Error: ${_ instanceof Error?_.message:"Command failed"}`,outputType:"error"})}},[O,S,k,$]),Q=t.useCallback(e=>{var t,a,r,s,n,o;if(G&&F.length>0){if("ArrowDown"===e.key){e.preventDefault();const s=Math.min(I+1,F.length-1);return D(s),void(null==(r=null==(a=null==(t=K.current)?void 0:t.children[0])?void 0:a.children[s])||r.scrollIntoView({block:"nearest"}))}if("ArrowUp"===e.key){e.preventDefault();const t=Math.max(I-1,0);return D(t),void(null==(o=null==(n=null==(s=K.current)?void 0:s.children[0])?void 0:n.children[t])||o.scrollIntoView({block:"nearest"}))}if("Tab"===e.key)return e.preventDefault(),void B(I);if("Escape"===e.key)return e.preventDefault(),void C(!1)}if("Enter"===e.key){if(e.preventDefault(),G&&F.length>0){const e=F[I].cmd;return N(""),j(-1),C(!1),void V(e)}const t=E;return N(""),j(-1),C(!1),void V(t)}if("ArrowUp"!==e.key||G)if("ArrowDown"!==e.key||G);else if(e.preventDefault(),T>0){const e=T-1;j(e),N(v[v.length-1-e]||"")}else 0===T&&(j(-1),N(""));else if(e.preventDefault(),v.length>0&&T<v.length-1){const e=T+1;j(e),N(v[v.length-1-e]||"")}},[G,F,I,B,E,v,T,V]),J=t.useCallback(e=>{N(e.target.value),L(e.target.selectionStart||e.target.value.length),z(e.target.value)},[z]),Y=t.useCallback(e=>{const t=e.target;L(t.selectionStart||0)},[]);return a.jsxs(u,{children:[a.jsx(y,{title:"Terminal",icon:a.jsx(r,{})}),a.jsxs(g,{noPadding:!0,className:"terminal-card overflow-hidden flex flex-col isolate",onClick:X,children:[a.jsx("div",{ref:H,className:"flex-1 overflow-y-auto font-mono text-sm p-3 sm:p-4 md:p-5",style:{background:"var(--terminal-bg)"},children:f.map(e=>a.jsx(P,{entry:e},e.id))}),a.jsxs("div",{className:"relative",style:{borderTop:"1px solid var(--terminal-border)",background:"var(--terminal-bg-input)"},children:[a.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 px-3 sm:px-4 py-2 sm:py-3",children:[a.jsx("span",{className:"text-text-muted font-mono font-bold select-none",children:"$"}),a.jsxs("div",{className:"flex-1 relative font-mono text-sm",children:[a.jsx("input",{ref:M,type:"text",value:E,onChange:J,onKeyDown:Q,onSelect:Y,onFocus:()=>q(!0),onBlur:()=>q(!1),disabled:!w,className:"absolute inset-0 w-full bg-transparent text-transparent outline-none disabled:opacity-50 selection:bg-transparent",style:{caretColor:"transparent"},autoFocus:!0,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1}),a.jsx("div",{className:"relative pointer-events-none select-none","aria-hidden":!0,children:w?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"text-text-primary",children:E.slice(0,A)}),a.jsx("span",{className:s("inline-block w-[0.6em] h-[1.2em] align-text-bottom",R?"bg-accent-primary":"bg-text-muted/30"),style:{marginBottom:"-0.1em"},children:a.jsx("span",{className:"text-bg-primary",children:E[A]||""})}),a.jsx("span",{className:"text-text-primary",children:E.slice(A+1)})]}):a.jsx("span",{className:"text-text-muted",children:"Connecting..."})})]})]}),a.jsxs("div",{className:"px-3 sm:px-4 py-1 flex justify-between text-[10px] text-text-muted",style:{borderTop:"1px solid var(--terminal-border)",background:"var(--terminal-bg-status)"},children:[a.jsx("span",{className:"hidden sm:inline",children:"↑↓ History"}),a.jsx("span",{className:"sm:hidden",children:"Terminal"}),(null==e?void 0:e.version)&&a.jsxs("span",{children:["pyMC v",e.version]})]})]}),G&&F.length>0&&a.jsxs("div",{ref:K,className:"absolute left-2 right-2 bottom-[72px] rounded-xl shadow-2xl overflow-hidden z-50 backdrop-blur-xl",style:{border:"1px solid var(--terminal-autocomplete-border)",background:"var(--terminal-autocomplete-bg)"},children:[a.jsx("div",{className:"max-h-64 overflow-y-auto",children:F.map((e,t)=>a.jsxs("div",{onClick:()=>B(t),className:s("px-4 py-2.5 cursor-pointer last:border-b-0 transition-colors",t===I?"bg-accent-primary/25":""),style:{borderBottom:"1px solid var(--terminal-border)",...t!==I?{"--tw-bg-opacity":0}:{}},onMouseEnter:e=>{t!==I&&(e.currentTarget.style.background="var(--terminal-autocomplete-hover)")},onMouseLeave:e=>{t!==I&&(e.currentTarget.style.background="transparent")},children:[a.jsx("span",{className:s("font-mono text-sm",t===I?"text-accent-primary":"text-text-primary"),children:e.cmd}),a.jsx("span",{className:"text-xs text-text-muted ml-4",children:e.desc})]},e.cmd))}),a.jsx("div",{className:"px-3 py-1.5 text-[10px] text-text-muted text-right",style:{borderTop:"1px solid var(--terminal-border)",background:"var(--terminal-autocomplete-hover)"},children:"Tab to select"})]})]})]})}export{O as default};
