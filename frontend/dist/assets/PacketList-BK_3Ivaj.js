const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PathMapMapLibre-C-lXy13e.js","assets/vendor-react-54o2BuWt.js","assets/BasemapLayer-DuDL4O6m.js","assets/vendor-core-dnrJb0w-.js","assets/useThemeColors-BvPNffvW.js","assets/index-W7HOJkA3.js","assets/car-CRpU_cCn.js","assets/house-BPur0bhT.js","assets/channel-keys-DJWRrSwE.js","assets/SignalIndicator-gITjxuU7.js","assets/arrow-up-B3nwhPdL.js","assets/DataBox-B3hWOq8z.js","assets/chevron-right-B-fW81Tj.js","assets/loader-circle-BFq8BFSi.js","assets/map-pin-BiNqduy8.js","assets/zap-BAnS4MDP.js","assets/triangle-alert-DJGP4SlO.js","assets/route-B-i3IDor.js","assets/chevron-up-kiCOpps9.js","assets/circle-check-BReqF2aY.js","assets/maplibre-gl-B1CfjdFi.css","assets/index-C1n8eI-q.css"])))=>i.map(i=>d[i]);
import{r as e,j as t,c as s}from"./vendor-react-54o2BuWt.js";import{c as a,H as n,V as r,I as i,J as l,M as c,K as o,N as d,O as x,Q as p,U as m,W as h,Y as u,Z as f,_ as g,$ as y,a0 as j,a1 as b,a2 as v,a3 as N,a4 as w,a5 as k,a6 as C,a7 as S,a8 as M,a9 as P,aa as T,ab as H,ac as _,G as B,B as F,ad as A,ae as D,af as L,ag as $,ah as z,p as R,ai as E,aj as I,m as U,ak as V,al as O,R as W,am as Q,f as G,an as q,ao as K,ap as Y,aq as J,ar as X,A as Z,as as ee,C as te,at as se,au as ae,av as ne,aw as re,ax as ie,ay as le,az as ce}from"./index-W7HOJkA3.js";import{P as oe,d as de,g as xe,a as pe,h as me,b as he,c as ue,e as fe,f as ge,i as ye,j as je}from"./channel-keys-DJWRrSwE.js";import{D as be,S as ve,R as Ne,P as we,a as ke,g as Ce}from"./SignalIndicator-gITjxuU7.js";import{a as Se,A as Me}from"./arrow-up-B3nwhPdL.js";import{a as Pe,D as Te}from"./DataBox-B3hWOq8z.js";import{C as He}from"./chevron-right-B-fW81Tj.js";import{L as _e}from"./loader-circle-BFq8BFSi.js";import{_ as Be}from"./deckgl-DTsmDcfs.js";import{M as Fe}from"./map-pin-BiNqduy8.js";import{C as Ae,Z as De}from"./zap-BAnS4MDP.js";import{T as Le}from"./triangle-alert-DJGP4SlO.js";import{L as $e,H as ze,R as Re}from"./route-B-i3IDor.js";import{A as Ee,C as Ie}from"./chevron-up-kiCOpps9.js";import{C as Ue}from"./circle-check-BReqF2aY.js";import{D as Ve,H as Oe}from"./house-BPur0bhT.js";import{g as We,s as Qe}from"./useThemeColors-BvPNffvW.js";const Ge=a("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),qe=a("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Ke=a("corner-down-right",[["path",{d:"m15 10 5 5-5 5",key:"qqa56n"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]]),Ye=a("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Je=a("reply",[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]]),Xe=a("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),Ze=a("stethoscope",[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]),et=a("trophy",[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]]),tt=a("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);function st(e,t){return n(e)?e[((e,t,s)=>{const a=t-0;return((s-0)%a+a)%a+0})(0,e.length,t)]:e}class at{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>e.finished))}getAll(e){return this.animations[0][e]}setAll(e,t){for(let s=0;s<this.animations.length;s++)this.animations[s][e]=t}attachTimeline(e){const t=this.animations.map(t=>t.attachTimeline(e));return()=>{t.forEach((e,t)=>{e&&e(),this.animations[t].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get state(){return this.getAll("state")}get startTime(){return this.getAll("startTime")}get duration(){return nt(this.animations,"duration")}get iterationDuration(){return nt(this.animations,"iterationDuration")}runAll(e){this.animations.forEach(t=>t[e]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}function nt(e,t){let s=0;for(let a=0;a<e.length;a++){const n=e[a][t];null!==n&&n>s&&(s=n)}return s}class rt extends at{then(e,t){return this.finished.finally(e).then(()=>{})}}class it extends r{constructor(){super(...arguments),this.type="object"}readValueFromInstance(e,t){if(function(e,t){return e in t}(t,e)){const s=e[t];if("string"==typeof s||"number"==typeof s)return s}}getBaseTargetFromProps(){}removeValueFromRenderState(e,t){delete t.output[e]}measureInstanceViewportBox(){return i()}build(e,t){Object.assign(e.output,t)}renderInstance(e,{output:t}){Object.assign(e,t)}sortInstanceNodePosition(){return 0}}function lt({children:s,isValidProp:a,...n}){a&&l(a),(n={...e.useContext(c),...n}).isStatic=o(()=>n.isStatic);const r=e.useMemo(()=>n,[JSON.stringify(n.transition),n.transformPagePoint,n.reducedMotion]);return t.jsx(c.Provider,{value:r,children:s})}function ct(e,t){[...t].reverse().forEach(s=>{const a=e.getVariant(s);a&&p(e,a),e.variantChildren&&e.variantChildren.forEach(e=>{ct(e,t)})})}function ot(){const e=new Set,t={subscribe:t=>(e.add(t),()=>{e.delete(t)}),start(t,s){const a=[];return e.forEach(e=>{a.push(x(e,t,{transitionOverride:s}))}),Promise.all(a)},set:t=>e.forEach(e=>{!function(e,t){Array.isArray(t)?ct(e,t):"string"==typeof t?ct(e,[t]):p(e,t)}(e,t)}),stop(){e.forEach(e=>{!function(e){e.values.forEach(e=>e.stop())}(e)})},mount:()=>()=>{t.stop()}};return t}function dt(e){return"object"==typeof e&&!Array.isArray(e)}function xt(e,t,s,a){return null==e?[]:"string"==typeof e&&dt(t)?m(e,s,a):e instanceof NodeList?Array.from(e):Array.isArray(e)?e.filter(e=>null!=e):[e]}function pt(e,t,s){return e*(t+1)}function mt(e,t,s,a){return"number"==typeof t?t:t.startsWith("-")||t.startsWith("+")?Math.max(0,e+parseFloat(t)):"<"===t?s:t.startsWith("<")?Math.max(0,s+parseFloat(t.slice(1))):a.get(t)??e}function ht(e,t,s,a,n,r){!function(e,t,s){for(let a=0;a<e.length;a++){const n=e[a];n.at>t&&n.at<s&&(u(e,n),a--)}}(e,n,r);for(let i=0;i<t.length;i++)e.push({value:t[i],at:h(n,r,a[i]),easing:st(s,i)})}function ut(e,t){for(let s=0;s<e.length;s++)e[s]=e[s]/(t+1)}function ft(e,t){return e.at===t.at?null===e.value?1:null===t.value?-1:0:e.at-t.at}function gt(e,t){return!t.has(e)&&t.set(e,{}),t.get(e)}function yt(e,t){return t[e]||(t[e]=[]),t[e]}function jt(e){return Array.isArray(e)?e:[e]}function bt(e,t){return e&&e[t]?{...e,...e[t]}:{...e}}const vt=e=>"number"==typeof e,Nt=e=>e.every(vt);function wt(e){const t={presenceContext:null,props:{},visualState:{renderState:{transform:{},transformOrigin:{},style:{},vars:{},attrs:{}},latestValues:{}}},s=w(e)&&!k(e)?new C(t):new S(t);s.mount(e),M.set(e,s)}function kt(e){const t=new it({presenceContext:null,props:{},visualState:{renderState:{output:{}},latestValues:{}}});t.mount(e),M.set(e,t)}function Ct(e,t,s,a){const n=[];if(function(e,t){return f(e)||"number"==typeof e||"string"==typeof e&&!dt(t)}(e,t))n.push(P(e,dt(t)&&t.default||t,s&&s.default||s));else{if(null==e)return n;const r=xt(e,t,a),i=r.length;for(let e=0;e<i;e++){const a=r[e],l=a instanceof Element?wt:kt;M.has(a)||l(a);const c=M.get(a),o={...s};"delay"in o&&"function"==typeof o.delay&&(o.delay=o.delay(e,i)),n.push(...T(c,{...t,transition:o},{}))}}return n}const St=function(e,t,s){let a,n=[];if(r=e,Array.isArray(r)&&r.some(Array.isArray))n=function(e,t,s){const a=[],n=function(e,{defaultTransition:t={},...s}={},a,n){const r=t.duration||.3,i=new Map,l=new Map,c={},o=new Map;let d=0,x=0,p=0;for(let m=0;m<e.length;m++){const s=e[m];if("string"==typeof s){o.set(s,x);continue}if(!Array.isArray(s)){o.set(s.name,mt(x,s.at,d,o));continue}let[i,h,u={}]=s;void 0!==u.at&&(x=mt(x,u.at,d,o));let N=0;const w=(e,s,a,i=0,l=0)=>{const c=jt(e),{delay:o=0,times:d=g(c),type:m=t.type||"keyframes",repeat:h,repeatType:u,repeatDelay:f=0,...w}=s;let{ease:k=t.ease||"easeOut",duration:C}=s;const S="function"==typeof o?o(i,l):o,M=c.length,P=b(m)?m:null==n?void 0:n[m||"keyframes"];if(M<=2&&P){let e=100;if(2===M&&Nt(c)){const t=c[1]-c[0];e=Math.abs(t)}const s={...t,...w};void 0!==C&&(s.duration=v(C));const a=y(s,e,P);k=a.ease,C=a.duration}C??(C=r);const T=x+S;1===d.length&&0===d[0]&&(d[1]=1);const H=d.length-c.length;if(H>0&&j(d,H),1===c.length&&c.unshift(null),h){C=pt(C,h);const e=[...c],t=[...d];k=Array.isArray(k)?[...k]:[k];const s=[...k];for(let a=0;a<h;a++){c.push(...e);for(let n=0;n<e.length;n++)d.push(t[n]+(a+1)),k.push(0===n?"linear":st(s,n-1))}ut(d,h)}const _=T+C;ht(a,c,k,d,T,_),N=Math.max(S+C,N),p=Math.max(_,p)};if(f(i))w(h,u,yt("default",gt(i,l)));else{const e=xt(i,h,a,c),t=e.length;for(let s=0;s<t;s++){const a=gt(e[s],l);for(const e in h)w(h[e],bt(u,e),yt(e,a),s,t)}}d=x,x+=N}return l.forEach((e,a)=>{for(const n in e){const r=e[n];r.sort(ft);const l=[],c=[],o=[];for(let e=0;e<r.length;e++){const{at:t,value:s,easing:a}=r[e];l.push(s),c.push(N(0,p,t)),o.push(a||"easeOut")}0!==c[0]&&(c.unshift(0),l.unshift(l[0]),o.unshift("easeInOut")),1!==c[c.length-1]&&(c.push(1),l.push(null)),i.has(a)||i.set(a,{keyframes:{},transition:{}});const d=i.get(a);d.keyframes[n]=l;const{type:x,...m}=t;d.transition[n]={...m,duration:p,ease:o,times:c,...s}}}),i}(e,t,s,{spring:H});return n.forEach(({keyframes:e,transition:t},s)=>{a.push(...Ct(s,e,t))}),a}(e,t,Mt);else{const{onComplete:r,...i}=s||{};"function"==typeof r&&(a=r),n=Ct(e,t,i,Mt)}var r;const i=new rt(n);return a&&i.finished.then(a),i};var Mt;function Pt(){const e=o(ot);return _(e.mount,[]),e}function Tt({"aria-label":e="Page navigation",className:a,...n}){return t.jsx("nav",{"aria-label":e,...n,className:s("flex gap-x-2",a)})}function Ht({onClick:e,disabled:a=!1,className:n,children:r="Previous"}){return t.jsx("span",{className:s("grow basis-0",n),children:t.jsxs(B,{plain:!0,onClick:e,disabled:a,"aria-label":"Previous page",className:s("gap-1",a&&"invisible"),children:[t.jsx("svg",{className:"size-4 stroke-current",viewBox:"0 0 16 16",fill:"none","aria-hidden":"true",children:t.jsx("path",{d:"M2.75 8H13.25M2.75 8L5.25 5.5M2.75 8L5.25 10.5",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})}),r]})})}function _t({onClick:e,disabled:a=!1,className:n,children:r="Next"}){return t.jsx("span",{className:s("flex grow basis-0 justify-end",n),children:t.jsxs(B,{plain:!0,onClick:e,disabled:a,"aria-label":"Next page",className:s("gap-1",a&&"invisible"),children:[r,t.jsx("svg",{className:"size-4 stroke-current",viewBox:"0 0 16 16",fill:"none","aria-hidden":"true",children:t.jsx("path",{d:"M13.25 8L2.75 8M13.25 8L10.75 10.5M13.25 8L10.75 5.5",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})})]})})}function Bt({className:e,...a}){return t.jsx("span",{...a,className:s("hidden items-baseline gap-x-2 sm:flex",e)})}function Ft({page:e,current:a=!1,onClick:n,className:r,children:i}){return t.jsx(B,{plain:!a,outline:a,onClick:()=>null==n?void 0:n(e),"aria-label":`Page ${e}`,"aria-current":a?"page":void 0,className:s("min-w-[2.25rem] before:absolute before:-inset-px before:rounded-lg",a&&"before:bg-white/5",r),children:i??e})}function At({className:e,...a}){return t.jsx("span",{"aria-hidden":"true",...a,className:s("w-[2.25rem] select-none text-center text-sm text-text-muted",e),children:"…"})}function Dt(e){if(!e||e.length<8)return null;const t=parseInt(e.slice(0,2),16),s=parseInt(e.slice(2,4),16),a=parseInt(e.slice(4,6),16),n=parseInt(e.slice(6,8),16);return isNaN(t)||isNaN(s)||isNaN(a)||isNaN(n)?null:((t|s<<8|a<<16|n<<24)>>>0).toString(16).toUpperCase().padStart(8,"0")}function Lt(e){return e>=10?"excellent":e>=5?"good":e>=0?"fair":e>=-5?"poor":"critical"}function $t(e){if(!e.payload)return null;try{const t=me(e.payload),s=function(e){const t=e.original_path||e.forwarded_path||[];if("string"==typeof t)try{const e=JSON.parse(t);if(Array.isArray(e))return e.map(e=>parseInt(e,16))}catch{return[]}else if(Array.isArray(t))return t.map(e=>parseInt(e,16));return[]}(e),a=he(t,s);return a?{packet:e,decoded:a,timestamp:e.timestamp??0,hopCount:a.snrValues.length,rssi:e.rssi,snr:e.snr}:null}catch{return null}}const zt={rx:{icon:Me,label:"Rx",badgeColor:be.rx,avatarBg:"bg-emerald-500/15",avatarText:"text-emerald-400"},forward:{icon:Ge,label:"Fwd",badgeColor:be.forward,avatarBg:"bg-sky-500/15",avatarText:"text-sky-400"},duplicate:{icon:Pe,label:"Dupe",badgeColor:be.duplicate,avatarBg:"bg-zinc-500/15",avatarText:"text-zinc-400"},tx:{icon:Se,label:"Tx",badgeColor:be.tx,avatarBg:"bg-violet-500/15",avatarText:"text-violet-400"},dropped:{icon:Ke,label:"Drop",badgeColor:be.dropped,avatarBg:"bg-amber-500/15",avatarText:"text-amber-400"}},Rt={sm:"w-3 h-3",md:"w-3.5 h-3.5",lg:"w-4 h-4"},Et={sm:"w-7 h-7",md:"w-8 h-8",lg:"w-9 h-9"};function It(e){return"tx_local"===e.packet_origin?"tx":"tx_forward"===e.packet_origin?"forward":e.is_duplicate?"duplicate":e.transmitted?"forward":e.drop_reason?"dropped":"rx"}const Ut=e.memo(function({packet:e,showLabel:a=!0,variant:n="avatar",size:r="sm"}){const i=It(e),l=zt[i],c=l.icon;return"avatar"===n?t.jsx("div",{className:s("flex items-center justify-center rounded-full flex-shrink-0",l.avatarBg,Et[r]),children:t.jsx(c,{className:s(Rt[r],l.avatarText)})}):t.jsxs(F,{color:l.badgeColor,children:[t.jsx(c,{className:Rt[r]}),a&&l.label]})}),Vt=e.memo(function({path:e,localHash:a,className:n}){if(!e||0===e.length)return t.jsx("span",{className:s("text-white/30 text-[10px]",n),children:"—"});const r=a?(a.startsWith("0x")?a.slice(2,4):a.slice(0,2)).toUpperCase():null;return t.jsx("span",{className:s("flex items-center gap-0.5 font-mono text-[10px] overflow-hidden",n),children:e.map((s,a)=>{const n=a===e.length-1,i=r&&s.toUpperCase()===r;return t.jsxs("span",{className:"flex items-center flex-shrink-0",children:[i?t.jsx("span",{className:"px-1 py-0.5 rounded bg-amber-500/20 text-amber-400 text-[9px] font-medium",children:"You"}):t.jsx("span",{className:"px-1 py-0.5 rounded bg-white/[0.06] text-white/60",children:s.toUpperCase()}),!n&&t.jsx(He,{className:"w-2.5 h-2.5 text-white/20 mx-0.5 flex-shrink-0"})]},`${s}-${a}`)})})}),Ot=e.memo(function({count:e,className:a}){const n=e>=2;return t.jsxs("span",{className:s("font-mono text-xs tabular-nums",n?"text-white/70":"text-white/30",a),children:[e,t.jsx("span",{className:"text-white/20",children:"→"})]})});function Wt(e){const t=e.payload_type_name||L(e.payload_type??e.type),s=e.route_type_name||$(e.route_type??e.route);return{payloadType:t,routeType:s,payloadColor:we[t]??"zinc",routeColor:Ne[s]??"zinc"}}function Qt(e){if(!e)return[];if(Array.isArray(e))return e;try{const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}}function Gt(e,t){if(!e||!t)return null;const s=e.startsWith("0x")?e.slice(2):e;for(const[a,n]of Object.entries(t))if((a.startsWith("0x")?a.slice(2):a).toLowerCase().startsWith(s.toLowerCase()))return n.name||n.node_name||null;return null}const qt=e.memo(function({packet:a,onClick:n,localHash:r,neighbors:i,isFlashing:l=!1,isPending:c,isTraceHighlighted:o,onTraceHover:d,traceTag:x,onViewTraceReport:p,dupeGroupPosition:m,isDupeGroupHovered:h=!1,onDupeGroupHover:u}){const f=A(a.is_duplicate),g=void 0!==m,{payloadType:y,routeType:j,payloadColor:b,routeColor:v}=Wt(a),N="tx_local"===a.packet_origin,w=c??a.isPending,k="TRACE"===y,C=Qt(a.original_path),S=Qt(a.forwarded_path),M=S.length>0?S:C,P=M.length,T=a.src_hash?(a.src_hash.startsWith("0x")?a.src_hash.slice(2,6):a.src_hash.slice(0,4)).toUpperCase():null,H=Gt(a.src_hash,i),_=a.payload_length??a.length??0;a.lbt_attempts;const B=e.useCallback(()=>{k&&x&&p?p(x):n(a)},[k,x,p,n,a]),L=e.useCallback(()=>{k&&x&&d&&d(x),g&&u&&a.packet_hash&&u(a.packet_hash)},[k,x,d,g,u,a.packet_hash]),$=e.useCallback(()=>{d&&d(null),u&&u(null)},[d,u]),z={lime:"rgb(132, 204, 22)",cyan:"rgb(34, 211, 238)",amber:"rgb(251, 191, 36)",violet:"rgb(167, 139, 250)",rose:"rgb(251, 113, 133)",emerald:"rgb(52, 211, 153)",sky:"rgb(56, 189, 248)",orange:"rgb(251, 146, 60)",pink:"rgb(244, 114, 182)",zinc:"rgb(161, 161, 170)",purple:"rgb(168, 85, 247)",indigo:"rgb(129, 140, 248)",teal:"rgb(45, 212, 191)",fuchsia:"rgb(232, 121, 249)",blue:"rgb(59, 130, 246)",green:"rgb(34, 197, 94)",yellow:"rgb(250, 204, 21)",red:"rgb(239, 68, 68)",brown:"rgb(168, 133, 107)"},R=z[b]||z.zinc,E=h;return t.jsxs("div",{onClick:B,onMouseEnter:L,onMouseLeave:$,className:s("group relative cursor-pointer","hover:bg-white/[0.02]",f&&!h&&"opacity-40",l&&"flash-row",w&&"opacity-70",N&&"bg-violet-500/5",o&&"bg-teal-500/10"),children:[t.jsx("div",{className:s("absolute pointer-events-none transition-opacity duration-75",g?E?"opacity-100":"opacity-0":"opacity-0 group-hover:opacity-100"),style:(()=>{const e={pointerEvents:"none"};return"first"===m?{...e,borderTop:`2px solid ${R}`,borderLeft:`2px solid ${R}`,borderRight:`2px solid ${R}`,borderBottom:"none",borderRadius:"8px 8px 0 0",inset:"-2px -2px 0 -2px"}:"middle"===m?{...e,borderTop:"none",borderLeft:`2px solid ${R}`,borderRight:`2px solid ${R}`,borderBottom:"none",borderRadius:0,inset:"0 -2px"}:"last"===m?{...e,borderTop:"none",borderLeft:`2px solid ${R}`,borderRight:`2px solid ${R}`,borderBottom:`2px solid ${R}`,borderRadius:"0 0 8px 8px",inset:"0 -2px -2px -2px"}:{...e,border:`2px solid ${R}`,borderRadius:"8px",inset:"-2px"}})()}),t.jsxs("div",{className:"relative flex items-center gap-2 min-[600px]:gap-3 px-2 py-2 min-[600px]:px-3 min-[600px]:py-2.5",children:[t.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[t.jsxs("div",{className:"relative flex-shrink-0",children:[t.jsx(Ut,{packet:a,variant:"avatar",size:"sm"}),w&&t.jsx(_e,{className:"absolute -right-1 -bottom-1 w-3 h-3 text-amber-400 animate-spin"})]}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("div",{className:"font-bold text-[13px] text-white font-sans truncate",children:T||"—"}),H&&t.jsx("div",{className:"hidden min-[900px]:block text-[9px] text-white/40 truncate max-w-[70px]",children:H})]})]}),t.jsxs("div",{className:"flex-1 flex items-center gap-1 min-[600px]:gap-1.5 min-[900px]:gap-2 min-w-0",children:[t.jsx("span",{className:"text-[10px] min-[600px]:text-[11px] text-white/50 font-mono tabular-nums whitespace-nowrap flex-shrink-0",children:D(a.timestamp)}),t.jsx(F,{color:b,className:"flex-shrink-0",children:y}),t.jsx("span",{className:"min-[600px]:hidden text-[10px] font-mono text-white/40 flex-shrink-0",children:j.charAt(0)}),t.jsx(F,{color:v,className:"flex-shrink-0 hidden min-[600px]:inline-flex",children:j}),t.jsx("div",{className:"flex-shrink-0 flex items-center",children:t.jsx(Ot,{count:P})}),t.jsxs("span",{className:"hidden min-[520px]:inline text-[10px] text-white/40 font-mono flex-shrink-0",children:[_,"B"]}),t.jsx("div",{className:"flex-1 min-w-0 overflow-hidden",children:t.jsx(Vt,{path:M,localHash:r})})]}),t.jsx("div",{className:"flex-shrink-0",children:t.jsx(ve,{rssi:a.rssi,snr:a.snr,compact:!0,showValues:!0})})]})]})}),Kt=e.memo(function({packet:e,onClick:a,localHash:n,neighbors:r,isFlashing:i=!1,isPending:l,isTraceHighlighted:c,traceTag:o,onViewTraceReport:d,dupeGroupPosition:x,isDupeGroupHovered:p=!1,onDupeGroupHover:m}){const{payloadType:h,routeType:u,payloadColor:f,routeColor:g}=Wt(e),y="tx_local"===e.packet_origin,j=l??e.isPending,b="TRACE"===h,v=A(e.is_duplicate),N=Qt(e.original_path),w=Qt(e.forwarded_path),k=w.length>0?w:N,C=k.length,S=e.src_hash?(e.src_hash.startsWith("0x")?e.src_hash.slice(2,6):e.src_hash.slice(0,4)).toUpperCase():null,M=Gt(e.src_hash,r),P=e.payload_length??e.length??0,T=e.lbt_attempts??0,H={lime:"rgb(132, 204, 22)",cyan:"rgb(34, 211, 238)",amber:"rgb(251, 191, 36)",violet:"rgb(167, 139, 250)",rose:"rgb(251, 113, 133)",emerald:"rgb(52, 211, 153)",sky:"rgb(56, 189, 248)",orange:"rgb(251, 146, 60)",pink:"rgb(244, 114, 182)",zinc:"rgb(161, 161, 170)",purple:"rgb(168, 85, 247)",indigo:"rgb(129, 140, 248)",teal:"rgb(45, 212, 191)",fuchsia:"rgb(232, 121, 249)",blue:"rgb(59, 130, 246)",green:"rgb(34, 197, 94)",yellow:"rgb(250, 204, 21)",red:"rgb(239, 68, 68)"},_=H[f]||H.zinc;return t.jsxs("div",{onClick:()=>{b&&o&&d?d(o):a(e)},className:s("relative pl-3 pr-2.5 py-2 cursor-pointer","active:bg-white/[0.04]",v&&"opacity-40",i&&"flash-row",j&&"opacity-70",y&&"bg-violet-500/5",c&&"bg-teal-500/10"),children:[t.jsx("div",{className:"absolute left-0 transition-all",style:(()=>{if(!x)return{opacity:0};const e=p?1:.4,t=p?"3px":"2px";return"first"===x?{backgroundColor:_,opacity:e,width:t,top:"6px",bottom:0,borderRadius:"0 9999px 0 0"}:"middle"===x?{backgroundColor:_,opacity:e,width:t,top:0,bottom:0,borderRadius:0}:"last"===x?{backgroundColor:_,opacity:e,width:t,top:0,bottom:"6px",borderRadius:"0 0 9999px 0"}:{backgroundColor:_,opacity:e,width:t,top:"6px",bottom:"6px",borderRadius:"9999px"}})()}),t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsxs("div",{className:"relative flex-shrink-0 mt-0.5",children:[t.jsx(Ut,{packet:e,variant:"avatar",size:"sm"}),j&&t.jsx(_e,{className:"absolute -right-1 -bottom-1 w-2.5 h-2.5 text-amber-400 animate-spin"})]}),t.jsxs("div",{className:"flex-1 min-w-0 space-y-0.5",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"font-semibold text-[14px] text-white tracking-tight",children:S||"—"}),M&&t.jsx("span",{className:"text-[12px] text-white/40 truncate max-w-[80px]",children:M}),t.jsx("div",{className:"flex-1"}),t.jsx(F,{color:f,className:"flex-shrink-0 !text-[9px] !px-1.5 !py-0",children:h}),t.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[t.jsx("span",{className:"text-[10px] font-mono text-white/50 tabular-nums w-[28px] text-right",children:e.rssi}),t.jsx(ve,{rssi:e.rssi,compact:!0,showValues:!1})]})]}),t.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-white/40 font-mono",children:[t.jsx("span",{className:"tabular-nums",children:D(e.timestamp)}),t.jsx(F,{color:g,className:"!text-[8px] !px-1 !py-0 !leading-none",children:u.charAt(0)}),C>0&&t.jsxs("span",{className:"text-white/30",children:[C,"h"]}),P>0&&t.jsxs("span",{className:"text-white/30",children:[P,"B"]}),T>0&&t.jsxs("span",{className:T>1?"text-amber-400/60":"text-white/30",children:["LBT:",T]}),null!=e.snr&&t.jsxs("span",{className:"text-white/30",children:[e.snr.toFixed(0),"dB"]})]}),C>0&&t.jsx("div",{className:"pt-0.5",children:t.jsx(Vt,{path:k,localHash:n})})]})]})]})});function Yt(e){if(e.contact_type){const t=e.contact_type.toLowerCase();if("repeater"===t||"rep"===t)return!0;if("companion"===t||"client"===t||"cli"===t)return!1;if("room server"===t||"room_server"===t||"room"===t||"server"===t)return!1}return!0===e.is_repeater||(e.is_repeater,!1)}const Jt=e.lazy(()=>Be(()=>import("./PathMapMapLibre-C-lXy13e.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21])));function Xt(e){return`${(100*e).toFixed(0)}%`}function Zt(e,t){const s=document.documentElement,a=getComputedStyle(s),n={success:a.getPropertyValue("--accent-success").trim()||"#39D98A",secondary:a.getPropertyValue("--accent-secondary").trim()||"#F9D26F",poor:a.getPropertyValue("--signal-poor").trim()||"#FF8A5C",danger:a.getPropertyValue("--accent-danger").trim()||"#FF5C7A",muted:a.getPropertyValue("--text-muted").trim()||"#767688"};let r;return r=0===t?n.muted:e>=1?n.success:e>=.5?n.secondary:e>=.25?n.poor:e>0?n.danger:n.muted,{color:r}}class es extends e.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?t.jsxs("div",{className:"h-[200px] flex items-center justify-center text-text-muted",children:[t.jsx(Le,{className:"w-4 h-4 mr-2"}),"Map failed to load"]}):this.props.children}}function ts({path:a,neighbors:n,localNode:r,localHash:i,srcHash:l,dstHash:c,neighborAffinity:o,prefixLookup:d,hubNodes:x,traceSnr:p,advertiserSource:m}){const[h,u]=e.useState(null),f=e.useMemo(()=>{if(!m)return null;const e="wardrive"===m.nodeType;return{prefix:m.prefix||"??",candidates:[{hash:m.publicKey||m.prefix||"source",name:m.name,latitude:m.latitude,longitude:m.longitude,probability:1,isLocal:!1,isWardrive:e}],confidence:1,totalMatches:1,isSource:!0}},[m]),g=e.useMemo(()=>{if(m)return null;if(!l)return null;const e=R(l),t=n[l];if((null==t?void 0:t.latitude)&&(null==t?void 0:t.longitude)&&(0!==t.latitude||0!==t.longitude))return{prefix:e,candidates:[{hash:l,name:t.node_name||t.name||"Source",latitude:t.latitude,longitude:t.longitude,probability:1,isLocal:!1,isDirectNeighbor:!0===t.zero_hop}],confidence:1,totalMatches:1,isSource:!0};const s=(null==t?void 0:t.node_name)||(null==t?void 0:t.name)||l.slice(0,8);return{prefix:e,candidates:[{hash:l,name:s,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isSource:!0}},[m,l,n]),y=e.useMemo(()=>{const e=(null==c?void 0:c.startsWith("0x"))?c.slice(2):c;if((!e||"00"===e||"0000000000000000"===e)&&r&&i){const e=R(i),t=0!==r.latitude||0!==r.longitude;return{prefix:e,candidates:[{hash:i,name:r.name||"Local Node",latitude:t?r.latitude:0,longitude:t?r.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}if(!c)return null;const t=R(c);if(i&&c===i&&r){const e=0!==r.latitude||0!==r.longitude;return{prefix:t,candidates:[{hash:c,name:r.name||"Local Node",latitude:e?r.latitude:0,longitude:e?r.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}const s=n[c];if((null==s?void 0:s.latitude)&&(null==s?void 0:s.longitude)&&(0!==s.latitude||0!==s.longitude))return{prefix:t,candidates:[{hash:c,name:s.node_name||s.name||"Destination",latitude:s.latitude,longitude:s.longitude,probability:1,isLocal:!1,isDirectNeighbor:!0===s.zero_hop}],confidence:1,totalMatches:1,isDestination:!0};const a=(null==s?void 0:s.node_name)||(null==s?void 0:s.name)||c.slice(0,8);return{prefix:t,candidates:[{hash:c,name:a,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isDestination:!0}},[c,n,r,i]),j=e.useMemo(()=>function(e,t,s,a,n,r){if(!e||0===e.length)return{hops:[],overallConfidence:0,hasValidPath:!1};const i=e.length-1,l=e.map((l,c)=>{const o=c===i,d=e.length-c,{candidates:x,totalMatches:p}=function(e,t,s,a,n=!1,r,i,l){const c=function(e){const t={};for(const[s,a]of Object.entries(e))Yt(a)&&(t[s]=a);return t}(t);let o;if(i){const t=function(e,t,s){const a=t.toUpperCase(),n=e.get(a);if(!n||0===n.candidates.length)return{hash:null,confidence:0};if(null==s?void 0:s.isLastHop)return{hash:n.bestMatch,confidence:n.confidence};if(1===(null==s?void 0:s.position))return{hash:n.bestMatch,confidence:n.confidence};if((null==s?void 0:s.position)&&n.bestMatchForPosition.has(s.position)){const e=n.bestMatchForPosition.get(s.position),t=Math.max(e.confidence,n.confidence);return{hash:e.hash,confidence:t}}if((null==s?void 0:s.adjacentPrefixes)&&s.adjacentPrefixes.length>0){let e=n.bestMatch,t=0;for(const a of n.candidates){let n=0;for(const e of s.adjacentPrefixes)n+=a.adjacentPrefixCounts.get(e.toUpperCase())||0;const r=a.combinedScore+n/Math.max(1,a.totalAdjacentObservations)*.3;r>t&&(t=r,e=a.hash)}return{hash:e,confidence:n.confidence}}return{hash:n.bestMatch,confidence:n.confidence}}(i,e,{position:l,isLastHop:n});o=t.confidence}const{matches:d,probability:x}=function(e,t,s,a,n=!1){const r=e.toUpperCase(),i=[],l=s&&z(r,s);l&&i.push(s);for(const m of Object.keys(t))z(r,m)&&i.push(m);if(n&&l&&s&&1===i.length)return{matches:i,probability:1,bestMatch:s};if(n&&l&&i.length>1){const e=i.filter(e=>e!==s);if(1===e.length)return{matches:i,probability:1,bestMatch:e[0]}}const c=i.length>0?1/i.length:0,o=[...i].sort();let d=null,x=-1;if(1===o.length)d=o[0];else if(o.length>1&&a){for(const e of o){const t=a.get(e),s=t?"number"==typeof t?t:t.combinedScore:0;s>x&&(x=s,d=e)}d||(d=o[0])}else o.length>0&&(d=o[0]);let p=c;if(i.length>1&&a&&x>0){let e=0;for(const t of i){const s=a.get(t);e+=s?"number"==typeof s?s:s.combinedScore:0}e>0&&(p=Math.min(.95,x/e))}return{matches:i,probability:p,bestMatch:d}}(e,c,a,r,n),p=d.length,m=[],h=e.toUpperCase(),u=s&&void 0!==s.latitude&&void 0!==s.longitude&&(0!==s.latitude||0!==s.longitude);for(const g of d){if(a&&z(h,a)&&g===a&&u&&s){m.push({hash:g,name:s.name||"Local Node",latitude:s.latitude,longitude:s.longitude,probability:n?1:x,isLocal:!0});continue}const e=c[g];(null==e?void 0:e.latitude)&&(null==e?void 0:e.longitude)&&(0!==e.latitude||0!==e.longitude)&&m.push({hash:g,name:e.node_name||e.name||"Unknown",latitude:e.latitude,longitude:e.longitude,probability:x,isLocal:!1,isDirectNeighbor:!0===e.zero_hop})}const f=m.length;if(1===f)m[0].probability=o??1;else if(f>1)if(void 0!==o&&o>0){m[0].probability=o;const e=1-o,t=f-1;m.slice(1).forEach(s=>{s.probability=e/t})}else{let e=0;const t=m.map(t=>{if(t.isLocal)return{candidate:t,score:1};const a=null==r?void 0:r.get(t.hash);let n=.5;var i;let l;return u&&s&&(n=(i=function(e,t,s,a){const n=(s-e)*Math.PI/180,r=(a-t)*Math.PI/180,i=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371e3}(s.latitude,s.longitude,t.latitude,t.longitude))<100?1:i<500?.9:i<1e3?.7:i<5e3?.5:i<1e4?.3:.1),a?l=.3*n+.3*a.hopConsistencyScore+.4*a.frequencyScore:(l=n,t.isDirectNeighbor&&(l=Math.max(l,.8))),e+=l,{candidate:t,score:l}});if(e>0)t.forEach(({candidate:t,score:s})=>{t.probability=Math.min(.95,s/e)});else{const e=1/f;m.forEach(t=>t.probability=e)}}return{candidates:m,totalMatches:p}}(l,t,s,a,o,n,r,d),m=x.length>0?Math.max(...x.map(e=>e.probability)):0;return{prefix:l,candidates:x,confidence:m,totalMatches:p}}),c=l.reduce((e,t)=>0===t.confidence?0:e*t.confidence,1),o=l.some(e=>e.candidates.length>0);return{hops:l,overallConfidence:c,hasValidPath:o}}(a,n,r,i,o,d),[a,n,r,i,o,d]),b=e.useMemo(()=>{const e=[];f?e.push(f):g&&e.push(g),e.push(...j.hops),y&&e.push(y);const t=e.reduce((e,t)=>0===t.confidence?0:e*t.confidence,1),s=e.some(e=>e.candidates.some(e=>0!==e.latitude||0!==e.longitude));return{hops:e,overallConfidence:t,hasValidPath:s}},[f,g,j,y]);return b.hasValidPath?t.jsxs("div",{className:"h-full flex flex-col space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between text-xs",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-text-muted",children:"Path Confidence:"}),t.jsx("span",{className:(v=b.overallConfidence,v>=1?"text-accent-success":v>=.5?"text-accent-secondary":v>=.25?"text-signal-poor":v>0?"text-accent-danger":"text-text-muted"),children:Xt(b.overallConfidence)}),t.jsx("button",{className:"text-text-muted hover:text-text-secondary transition-colors",title:"Confidence is calculated based on how many known nodes match each path prefix. Multiple matches reduce confidence due to collision probability.",children:t.jsx(Ae,{className:"w-3 h-3"})})]}),t.jsxs("div",{className:"flex items-center gap-2 text-[10px]",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-accent-success"}),t.jsx("span",{className:"text-text-muted",children:"Exact"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-accent-secondary"}),t.jsx("span",{className:"text-text-muted",children:"Multi"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-text-muted"}),t.jsx("span",{className:"text-text-muted",children:"Unknown"})]})]})]}),t.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:t.jsx(es,{children:t.jsx(e.Suspense,{fallback:t.jsx("div",{className:"h-full bg-bg-elevated flex items-center justify-center text-text-muted text-sm",children:"Loading map..."}),children:t.jsx(Jt,{resolvedPath:b,localNode:r,hubNodes:x,hoveredHopIndex:h,onHoverHop:u,traceSnr:p})})})}),t.jsx("div",{className:"flex flex-wrap items-center gap-1.5",children:b.hops.map((e,a)=>{var n,r,i;const l=!0===e.isSource,c=!0===e.isDestination,o=h===a;let d;return d=l?`Source: ${(null==(n=e.candidates[0])?void 0:n.name)||"Unknown"}`:c?`Destination: ${(null==(r=e.candidates[0])?void 0:r.name)||"Unknown"}`:0===e.totalMatches?"No matching nodes found":1===e.totalMatches?`Exact match: ${(null==(i=e.candidates[0])?void 0:i.name)||"Unknown"}`:`${e.totalMatches} possible matches (${(100*e.confidence).toFixed(0)}% confidence)`,t.jsxs("div",{className:s("flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-mono cursor-pointer transition-all",o?"bg-accent-primary/20 ring-1 ring-accent-primary/50":"bg-bg-elevated hover:bg-bg-subtle",l&&"border border-accent-success/30",c&&"border border-accent-primary/30"),title:d,onMouseEnter:()=>u(a),onMouseLeave:()=>u(null),children:[l&&t.jsx("span",{className:"text-accent-success text-[8px] mr-0.5",children:"SRC"}),c&&t.jsx("span",{className:"text-accent-primary text-[8px] mr-0.5",children:"DST"}),t.jsx("span",{style:Zt(e.confidence,e.totalMatches),children:e.prefix}),!l&&!c&&e.totalMatches>1&&t.jsxs("span",{className:"text-text-muted",children:["×",e.totalMatches]}),!l&&!c&&0===e.totalMatches&&t.jsx("span",{className:"text-text-muted",children:"?"})]},a)})})]}):t.jsxs("div",{className:"flex items-center justify-center text-text-muted text-xs py-4",children:[t.jsx(Fe,{className:"w-3.5 h-3.5 mr-1.5 opacity-50"}),"No location data available for path nodes"]});var v}function ss(e){return e.match(/.{1,2}/g)||[]}function as(e){return null!==e&&e.startsWith("payload:")}const ns={red:"var(--sys-red)",orange:"var(--sys-orange)",amber:"var(--sys-amber)",yellow:"var(--sys-yellow)",lime:"var(--sys-green)",green:"var(--sys-green)",emerald:"var(--sys-green)",teal:"var(--sys-teal)",cyan:"var(--sys-cyan)",sky:"var(--sys-cyan)",blue:"var(--sys-blue)",indigo:"var(--sys-indigo)",violet:"var(--sys-indigo)",purple:"var(--sys-purple)",fuchsia:"var(--sys-pink)",pink:"var(--sys-pink)",rose:"var(--sys-red)",brown:"var(--sys-brown)",zinc:"var(--text-muted)"},rs=15,is="color-mix(in srgb, var(--bg-elevated) 60%, var(--bg-body))",ls="\n    inset 0 0 0 1px color-mix(in srgb, var(--text-primary) 6%, transparent),\n    inset 0 1px 0 color-mix(in srgb, white 3%, transparent),\n    0 1px 2px color-mix(in srgb, black 5%, transparent)\n  ",cs=2,os={type:"tween",duration:.25,ease:[.25,.1,.25,1]};function ds(e,t){return e?`inset 0 0 0 ${cs}px ${ns[t]}`:ls}function xs(e,t){return e?t:`color-mix(in srgb, ${t} ${rs}%, transparent)`}function ps({segments:s,selectedSegment:a,onSegmentClick:n}){const[r,i]=e.useState(null),[l,c]=e.useState(null),o=s.some(e=>void 0!==e.id)&&n,d=[];for(const e of s){const t=ss(e.hex);for(const s of t)d.push({byte:s.toUpperCase(),color:e.color,id:e.id})}const x=[];for(let e=0;e<d.length;e+=16)x.push(d.slice(e,e+16));return t.jsx("div",{className:"space-y-1",children:x.map((e,s)=>{const d=e.length<16;return t.jsx("div",{className:"flex rounded-md overflow-hidden",children:e.map(({byte:s,color:x,id:p},m)=>{const h=m===e.length-1,u=d&&h,f=ns[x],g=p?r===p:l===x,y=Boolean(p&&a===p),j=g||y;return t.jsx("span",{className:"w-[1.75rem] text-xs text-center py-0.5 font-mono select-none "+(o?"cursor-pointer":""),style:{backgroundColor:xs(j,f),color:j?"rgba(255,255,255,0.95)":f,transition:j?"none":"background-color 0.15s ease-out, color 0.15s ease-out",touchAction:"manipulation",...u?{borderRadius:"0 0.375rem 0.375rem 0"}:{}},onMouseEnter:()=>{p?i(p):c(x)},onMouseLeave:()=>{i(null),c(null)},onClick:()=>p&&(null==n?void 0:n(p)),onTouchStart:()=>{p?i(p):c(x)},onTouchEnd:()=>{i(null),c(null)},children:s},m)})},s)})})}function ms({bits:e,field:s,value:a,binary:n}){return t.jsxs("tr",{children:[t.jsx("td",{className:"py-1.5 text-xs text-text-muted tabular-nums",children:e}),t.jsx("td",{className:"py-1.5 text-sm text-text-secondary",children:s}),t.jsx("td",{className:"py-1.5",children:(()=>{if("Payload Type"===s){const e=we[a]||"zinc";return t.jsx(F,{color:e,children:a})}if("Route Type"===s){const e=Ne[a]||"zinc";return t.jsx(F,{color:e,children:a})}return t.jsx("span",{className:"text-sm text-text-primary",children:a})})()}),t.jsx("td",{className:"py-1.5 font-mono text-xs text-sys-cyan",children:n})]})}function hs({id:e,title:s,color:a,hexBytes:n,startByte:r,endByte:i,isSelected:l,children:c}){const o=n?ss(n):[];return t.jsxs(U.div,{layout:"position",layoutId:e,transition:os,className:"w-full min-w-0 overflow-hidden rounded-xl p-4 sm:p-5 space-y-4",style:{backgroundColor:is,boxShadow:ds(l,a)},children:[t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-0.5 min-w-0",children:[t.jsx(F,{color:a,children:s}),o.length>0&&o.length<=16&&o.map((e,s)=>t.jsx(F,{color:a,className:"font-mono",children:e.toUpperCase()},s))]}),t.jsxs("span",{className:"text-[10px] text-text-muted font-mono flex-shrink-0",children:["Bytes ",r,"-",i]})]}),t.jsx("div",{className:"min-w-0 overflow-hidden",children:c})]})}function us({advert:e,timestamp:s}){const a=V(s||e.timestamp);return t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"rounded-2xl overflow-hidden bg-purple-500/10 dark:bg-purple-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[t.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[t.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-purple) 0%, var(--sys-blue) 100%)"},children:t.jsx(W,{className:"w-6 h-6 text-white"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:e.name||"Unknown Node"}),t.jsx("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:e.nodeType})]})]}),t.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),t.jsxs("div",{className:"px-4 py-3 space-y-2",children:[void 0!==e.latitude&&void 0!==e.longitude&&t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Fe,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 flex-shrink-0"}),t.jsxs("span",{className:"text-sm text-text-secondary font-mono",children:[e.latitude.toFixed(5),"°, ",e.longitude.toFixed(5),"°"]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(O,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 flex-shrink-0"}),t.jsx("span",{className:"text-sm text-text-secondary font-sans",children:a})]})]})]})})}function fs({decoded:e,timestamp:s}){const a=s?V(s):"Unknown";return t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"rounded-2xl overflow-hidden bg-teal-500/10 dark:bg-teal-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[t.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[t.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-teal) 0%, var(--sys-cyan) 100%)"},children:t.jsx(Ve,{className:"w-6 h-6 text-white"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:e.channelName||"Channel Data"}),t.jsxs("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:[e.dataLength," bytes • ",e.decrypted?"Decrypted":"Encrypted"]})]})]}),t.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),t.jsxs("div",{className:"px-4 py-3 space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(ze,{className:"w-4 h-4 text-teal-600 dark:text-teal-400 flex-shrink-0"}),t.jsxs("span",{className:"text-sm text-text-secondary font-sans",children:["Channel: ",t.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(O,{className:"w-4 h-4 text-teal-600 dark:text-teal-400 flex-shrink-0"}),t.jsx("span",{className:"text-sm text-text-secondary font-sans",children:a})]}),e.decrypted&&e.decryptedHex&&t.jsxs("div",{className:"mt-2 pt-2 border-t border-black/10 dark:border-white/10",children:[t.jsx("p",{className:"text-[10px] uppercase tracking-wide text-text-muted mb-1 font-sans",children:"Decrypted Data"}),t.jsx("div",{className:"max-w-full overflow-x-auto",children:t.jsx(Te,{size:"compact",copy:!0,className:"inline-block",children:t.jsx("span",{className:"break-all text-xs",children:e.decryptedHex.toUpperCase()})})})]})]})]})})}function gs({decoded:e,timestamp:s,isLoading:a=!1}){const n=s?V(s):"Unknown";return a?t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"rounded-xl p-4 sm:p-5",style:{backgroundColor:"color-mix(in srgb, var(--bg-elevated) 60%, var(--bg-body))",boxShadow:"\n              inset 0 0 0 1px color-mix(in srgb, var(--text-primary) 6%, transparent),\n              inset 0 1px 0 color-mix(in srgb, white 3%, transparent),\n              0 1px 2px color-mix(in srgb, black 5%, transparent)\n            "},children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3 h-[15px]",children:[t.jsx("div",{className:"h-2.5 w-12 rounded bg-white/[0.08] animate-pulse"}),t.jsx("div",{className:"h-2.5 w-16 rounded bg-white/[0.08] animate-pulse"})]}),t.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tl-md",style:{background:"color-mix(in srgb, var(--sys-blue) 30%, transparent)"},children:t.jsxs("div",{className:"space-y-1.5",children:[t.jsx("div",{className:"h-3.5 w-48 rounded bg-white/[0.15] animate-pulse"}),t.jsx("div",{className:"h-3.5 w-32 rounded bg-white/[0.15] animate-pulse"})]})})]})}):e.decrypted?t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"rounded-xl p-4 sm:p-5",style:{backgroundColor:"color-mix(in srgb, var(--bg-elevated) 60%, var(--bg-body))",boxShadow:"\n              inset 0 0 0 1px color-mix(in srgb, var(--text-primary) 6%, transparent),\n              inset 0 1px 0 color-mix(in srgb, white 3%, transparent),\n              0 1px 2px color-mix(in srgb, black 5%, transparent)\n            "},children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.senderName&&t.jsxs("span",{className:"text-[11px] text-text-muted font-sans",children:["From ",t.jsx("span",{className:"text-text-secondary font-medium",children:e.senderName})]}),e.channelName&&t.jsxs("span",{className:"text-[11px] text-text-muted font-sans",children:["in ",t.jsx("span",{className:"text-sys-cyan font-medium",children:e.channelName})]})]}),t.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tl-md",style:{background:"linear-gradient(135deg, var(--sys-blue) 0%, color-mix(in srgb, var(--sys-blue) 85%, var(--sys-cyan)) 100%)"},children:t.jsx("p",{className:"text-sm text-white font-sans leading-relaxed whitespace-pre-wrap break-words",children:e.text})})]})}):t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"rounded-2xl overflow-hidden bg-zinc-500/10 dark:bg-zinc-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[t.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[t.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-zinc) 0%, color-mix(in srgb, var(--sys-zinc) 70%, black) 100%)"},children:t.jsx(Ye,{className:"w-6 h-6 text-white"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:"Encrypted Message"}),t.jsxs("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:["Channel hash: ",t.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]})]})]}),t.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),t.jsxs("div",{className:"px-4 py-3 space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(O,{className:"w-4 h-4 text-zinc-500 dark:text-zinc-400 flex-shrink-0"}),t.jsx("span",{className:"text-sm text-text-secondary font-sans",children:n})]}),t.jsx("p",{className:"text-xs text-text-muted",children:"Private channel or unknown hash channel. Channel secret required for decryption."})]})]})})}function ys({decoded:e,timestamp:s}){const a=s?V(s):"Unknown";return t.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:"linear-gradient(135deg, var(--sys-green) 0%, var(--sys-teal) 100%)"},children:t.jsx(Ue,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm font-semibold text-text-primary font-sans",children:"Acknowledgment"}),t.jsxs("p",{className:"text-xs text-text-muted font-sans mt-0.5",children:["CRC: ",t.jsxs("span",{className:"font-mono text-sys-green",children:["0x",e.crc]})," · ",a]})]})]})}function js({decoded:e,timestamp:s}){const a=s?V(s):"Unknown",n=e.path.length;return t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"rounded-2xl overflow-hidden bg-amber-500/10 dark:bg-amber-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[t.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[t.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-amber) 0%, var(--sys-orange) 100%)"},children:t.jsx(Re,{className:"w-6 h-6 text-white"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:"Path Response"}),t.jsxs("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:[n," ",1===n?"hop":"hops"]})]})]}),t.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),t.jsxs("div",{className:"px-4 py-3 space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(O,{className:"w-4 h-4 text-amber-600 dark:text-amber-400 flex-shrink-0"}),t.jsx("span",{className:"text-sm text-text-secondary font-sans",children:a})]}),e.path.length>0&&t.jsx("div",{className:"mt-2 pt-2 border-t border-black/10 dark:border-white/10",children:t.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.path.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-2",children:[s>0&&t.jsx(Ge,{className:"w-4 h-4 text-amber-500 dark:text-amber-400"}),t.jsx(F,{color:"amber",className:"font-mono",children:e})]},s))})})]})]})})}function bs({decoded:e,timestamp:s}){const a=s?V(s):"Unknown",n=e.pathHashes.length,r=e.snrValues.length;return t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"rounded-2xl overflow-hidden bg-blue-500/10 dark:bg-blue-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[t.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[t.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-blue) 0%, var(--sys-indigo) 100%)"},children:t.jsx(Ee,{className:"w-6 h-6 text-white"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("h3",{className:"text-lg font-medium text-text-primary truncate leading-tight",children:["Trace ",e.isComplete?"Complete":"In Progress"]}),t.jsxs("p",{className:"text-sm text-text-muted mt-0.5",children:["Tag: 0x",e.traceTag.slice(0,8),e.isComplete&&" • ✓"]})]})]}),t.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),t.jsxs("div",{className:"px-4 py-3 space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(O,{className:"w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0"}),t.jsx("span",{className:"text-sm text-text-secondary",children:a})]}),t.jsxs("div",{className:"flex items-center gap-4 text-xs text-text-muted",children:[t.jsxs("span",{children:[n," target ",1===n?"hop":"hops"]}),t.jsx("span",{children:"•"}),t.jsxs("span",{children:[r," SNR ",1===r?"sample":"samples"]}),0!==e.authCode&&t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"•"}),t.jsxs("span",{children:["Auth: ",e.authCode]})]})]}),e.pathHashes.length>0&&t.jsx("div",{className:"flex flex-wrap items-center gap-2 pt-1",children:e.pathHashes.map((s,a)=>{const n=e.snrValues[a],r=void 0!==n?(e=>e>=7?"green":e>=0?"yellow":e>=-5?"orange":"red")(n):"zinc",i=void 0!==n;return t.jsxs("div",{className:"flex items-center gap-2",children:[a>0&&t.jsx(Ge,{className:"w-4 h-4 text-blue-500 dark:text-blue-400 flex-shrink-0"}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(F,{color:i?"blue":"zinc",className:"font-mono",children:s}),i&&t.jsxs(F,{color:r,className:"font-mono",children:[n>=0?"+":"",Number.isInteger(n)?n:n.toFixed(1),"dB"]})]})]},a)})})]})]})})}function vs({decoded:e,timestamp:s}){const a=s?V(s):"Unknown";return e.encrypted?t.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:"linear-gradient(135deg, var(--sys-purple) 0%, var(--sys-indigo) 100%)"},children:t.jsx(Ye,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm font-semibold text-text-primary font-sans",children:"Encrypted Message"}),t.jsxs("p",{className:"text-xs text-text-muted font-sans mt-0.5",children:[e.srcHash," → ",e.destHash," · ",a]})]})]}):t.jsxs("div",{className:"mb-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1.5 px-1",children:[t.jsxs("span",{className:"text-[11px] text-text-muted font-sans",children:[t.jsx("span",{className:"font-mono text-text-secondary",children:e.srcHash})," → ",t.jsx("span",{className:"font-mono text-text-secondary",children:e.destHash})]}),t.jsxs("span",{className:"text-[11px] text-text-muted font-sans",children:["· ",a]})]}),t.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tr-md ml-auto",style:{background:"linear-gradient(135deg, var(--sys-green) 0%, var(--sys-teal) 100%)"},children:t.jsx("p",{className:"text-sm text-white font-sans leading-relaxed whitespace-pre-wrap break-words",children:e.text})})]})}function Ns({decoded:e,timestamp:s}){const a=s?V(s):"Unknown",n=(e.partNumber+1)/e.totalParts*100;return t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"rounded-2xl overflow-hidden bg-yellow-500/10 dark:bg-yellow-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[t.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[t.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-yellow) 0%, var(--sys-amber) 100%)"},children:t.jsx($e,{className:"w-6 h-6 text-white"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:"Multipart Segment"}),t.jsxs("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:["Part ",e.partNumber+1," of ",e.totalParts]})]})]}),t.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),t.jsxs("div",{className:"px-4 py-3 space-y-3",children:[t.jsx("div",{children:t.jsx("div",{className:"h-2 bg-black/10 dark:bg-white/10 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${n}%`,background:"linear-gradient(90deg, var(--sys-yellow), var(--sys-amber))"}})})}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(ze,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400 flex-shrink-0"}),t.jsxs("span",{className:"text-sm text-text-secondary font-sans",children:["Message ID: ",t.jsx("span",{className:"font-mono",children:e.messageId})]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(O,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400 flex-shrink-0"}),t.jsx("span",{className:"text-sm text-text-secondary font-sans",children:a})]})]})]})})}function ws({decoded:e,timestamp:s,payloadType:a}){const n=s?V(s):"Unknown",r=(()=>{switch(a){case ue.REQ:return{icon:Q,gradient:"var(--sys-orange), var(--sys-red)",bg:"rgba(249, 115, 22, 0.15)",label:"Request"};case ue.RESPONSE:return{icon:Je,gradient:"var(--sys-green), var(--sys-teal)",bg:"rgba(34, 197, 94, 0.15)",label:"Response"};case ue.ANON_REQ:return{icon:Ye,gradient:"var(--sys-purple), var(--sys-pink)",bg:"rgba(168, 85, 247, 0.15)",label:"Anonymous Request"};default:return{icon:ke,gradient:"var(--sys-gray), var(--sys-slate)",bg:"rgba(107, 114, 128, 0.15)",label:e.payloadTypeName}}})(),i=r.icon;return t.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:`linear-gradient(135deg, ${r.gradient})`},children:t.jsx(i,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm font-semibold text-text-primary font-sans",children:r.label}),t.jsxs("p",{className:"text-xs text-text-muted font-sans mt-0.5",children:[e.length," bytes · ",n]})]})]})}function ks({pathHex:e}){if(!e)return null;const s=ss(e);return t.jsx("div",{className:"flex flex-wrap items-center gap-2 py-2",children:s.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-2",children:[s>0&&t.jsx(Ge,{className:"w-4 h-4 text-sys-amber flex-shrink-0"}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(Te,{size:"compact",copy:!0,children:e.toUpperCase()}),t.jsx("span",{className:"text-[10px] text-text-muted font-sans tabular-nums w-4 text-left",children:s+1})]})]},s))})}function Cs({decoded:e,payloadType:s}){const a=ye[s]||`TYPE_${s}`;switch(e.type){case"advert":{const s="chat"===e.nodeType?"companion":e.nodeType.replace("_"," "),a=void 0!==e.latitude&&void 0!==e.longitude&&!(0===e.latitude&&0===e.longitude);return t.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[t.jsxs("p",{children:[t.jsx("span",{className:"text-text-muted",children:"Role:"})," ",s]}),e.name&&t.jsxs("p",{children:[t.jsx("span",{className:"text-text-muted",children:"Name:"})," ",e.name]}),a&&t.jsxs("p",{children:[t.jsx("span",{className:"text-text-muted",children:"Location:"})," ",e.latitude.toFixed(4),"°, ",e.longitude.toFixed(4),"°"]}),t.jsxs("p",{children:[t.jsx("span",{className:"text-text-muted",children:"Time:"})," ",V(e.timestamp)]}),t.jsxs("p",{children:[t.jsx("span",{className:"text-text-muted",children:"Flags:"})," ",e.flagsDescription]})]})}case"ack":return t.jsx("div",{className:"text-xs text-text-primary space-y-0.5",children:t.jsxs("p",{children:[t.jsx("span",{className:"text-text-muted",children:"CRC:"})," 0x",e.crc]})});case"path":return t.jsx("div",{className:"text-xs text-text-primary space-y-1",children:t.jsxs("p",{children:[t.jsx("span",{className:"text-text-muted",children:"Path:"})," ",e.pathString||"(empty)"]})});case"trace":return t.jsxs("div",{className:"text-xs text-text-primary space-y-1",children:[t.jsxs("p",{children:[t.jsx("span",{className:"text-text-muted",children:"Tag:"})," 0x",e.traceTag]}),t.jsxs("p",{children:[t.jsx("span",{className:"text-text-muted",children:"Target Path:"})," ",e.pathString||"(empty)"]}),e.snrValues.length>0&&t.jsxs("p",{children:[t.jsx("span",{className:"text-text-muted",children:"SNR:"})," ",e.snrValues.map(e=>`${e>=0?"+":""}${Number.isInteger(e)?e:e.toFixed(1)}dB`).join(" → ")]}),t.jsxs("p",{children:[t.jsx("span",{className:"text-text-muted",children:"Status:"})," ",e.isComplete?"✓ Complete":`In progress (${e.snrValues.length}/${e.pathHashes.length})`]})]});case"txt_msg":return t.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[t.jsxs("p",{children:[t.jsx("span",{className:"text-text-muted",children:"Dest:"})," ",e.destHash]}),t.jsxs("p",{children:[t.jsx("span",{className:"text-text-muted",children:"Src:"})," ",e.srcHash]}),e.encrypted?t.jsx("p",{className:"text-text-muted italic",children:"Encrypted content"}):t.jsxs("p",{children:[t.jsx("span",{className:"text-text-muted",children:"Text:"})," ",e.text]})]});case"grp_txt":return t.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[t.jsxs("p",{children:[t.jsx("span",{className:"text-text-muted",children:"Channel:"})," ",e.channelName?t.jsx("span",{className:"text-accent-success",children:e.channelName}):t.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]}),e.decrypted?t.jsxs(t.Fragment,{children:[e.senderName&&t.jsxs("p",{children:[t.jsx("span",{className:"text-text-muted",children:"From:"})," ",e.senderName]}),t.jsxs("p",{children:[t.jsx("span",{className:"text-text-muted",children:"Text:"})," ",e.text]})]}):t.jsx("p",{className:"text-text-muted italic",children:"Encrypted (unknown channel)"})]});case"grp_data":return t.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[t.jsxs("p",{children:[t.jsx("span",{className:"text-text-muted",children:"Channel:"})," ",e.channelName?t.jsx("span",{className:"text-sys-teal",children:e.channelName}):t.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]}),t.jsxs("p",{children:[t.jsx("span",{className:"text-text-muted",children:"Data:"})," ",e.dataLength," bytes ",e.decrypted?"(decrypted)":"(encrypted)"]})]});case"multipart":return t.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[t.jsxs("p",{children:[t.jsx("span",{className:"text-text-muted",children:"Part:"})," ",e.partNumber+1,"/",e.totalParts]}),t.jsxs("p",{children:[t.jsx("span",{className:"text-text-muted",children:"Message ID:"})," ",e.messageId]})]});default:return t.jsxs("p",{className:"text-xs text-text-secondary",children:[a," (",e.length," bytes)"]})}}const Ss=e.memo(function({packet:s}){var a;const n=s.raw_packet||"",r=n.length/2,i=E(),[l,c]=e.useState(null),[o,d]=e.useState(null),[x,p]=e.useState(!1),[m,h]=e.useState(null),u=e.useCallback(e=>{h(t=>t===e?null:e)},[]),f=e.useMemo(()=>function(e){if(!e||e.length<4)return null;const t=oe.fromHex(e);if(!t.success||!t.packet)return null;const s=t.packet,a=function(e){const t=3&e,s=e>>2&15,a=e>>6&3;return[{bits:"0-1",field:"Route Type",value:xe(t),binary:(3&t).toString(2).padStart(2,"0")},{bits:"2-5",field:"Payload Type",value:pe(s),binary:(15&s).toString(2).padStart(4,"0")},{bits:"6-7",field:"Version",value:a.toString(),binary:(3&a).toString(2).padStart(2,"0")}]}(s.header),n=e.slice(0,2);let r=2,i="";s.hasTransportCodes()&&(i=e.slice(2,10),r=10);const l=e.slice(r,r+2),c=r+2,o=c+2*s.pathLen,d=e.slice(c,o),x=e.slice(o),p=de(s);return{packet:s,headerHex:n,headerFields:a,transportCodesHex:i,pathLengthHex:l,pathDataHex:d,payloadHex:x,payloadStartByte:Math.floor(o/2),decoded:p}}(n),[n]),g=(null==(a=null==f?void 0:f.packet)?void 0:a.payloadType)===ue.GRP_TXT&&(!i||x);if(e.useEffect(()=>{if(!(null==f?void 0:f.packet)||f.packet.payloadType!==ue.GRP_TXT)return c(null),void p(!1);if(!i)return void p(!0);p(!0);let e=!1;return fe(f.packet.payload).then(t=>{e||(t&&c(t),p(!1))}),()=>{e=!0}},[null==f?void 0:f.packet,i]),e.useEffect(()=>{if(!(null==f?void 0:f.packet)||f.packet.payloadType!==ue.GRP_DATA)return void d(null);if(!i)return;let e=!1;return ge(f.packet.payload).then(t=>{!e&&t&&d(t)}),()=>{e=!0}},[null==f?void 0:f.packet,i]),!f||0===n.length)return t.jsx("div",{className:"p-4 text-center text-text-muted",children:t.jsx("p",{className:"text-sm",children:"No raw packet data available"})});const{packet:y}=f;let j=f.decoded;l&&"grp_txt"===f.decoded.type?j=l:o&&"grp_data"===f.decoded.type&&(j=o);const b=e.useMemo(()=>function(e,s){switch(e.type){case"advert":return function(e,s){const a=[];let n=0;const r=s.slice(0,64);a.push({id:"payload:publicKey",title:"Public Key",color:"pink",hex:r,startByte:n,endByte:n+31,decoded:t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:e.publicKey.toUpperCase()}),t.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Ed25519 public key (32 bytes)"})]})}),n+=32;const i=s.slice(64,72);a.push({id:"payload:timestamp",title:"Timestamp",color:"orange",hex:i,startByte:n,endByte:n+3,decoded:t.jsxs(t.Fragment,{children:[t.jsx(Te,{size:"standard",copy:!0,children:i.toUpperCase()}),t.jsxs("p",{className:"text-xs text-text-primary mt-1",children:[e.timestamp," (",V(e.timestamp),")"]})]})}),n+=4;const l=s.slice(72,200);a.push({id:"payload:signature",title:"Signature",color:"teal",hex:l,startByte:n,endByte:n+63,decoded:t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:e.signature.toUpperCase()}),t.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Ed25519 signature (64 bytes)"})]})}),n+=64;const c=s.slice(200,202);if(a.push({id:"payload:flags",title:"Flags",color:"blue",hex:c,startByte:n,endByte:n,decoded:t.jsxs(t.Fragment,{children:[t.jsxs(Te,{size:"standard",copy:!0,children:["0x",e.flags.toString(16).padStart(2,"0").toUpperCase()]}),t.jsx("p",{className:"text-xs text-text-primary mt-1",children:e.flagsDescription}),t.jsxs("p",{className:"text-xs text-text-muted",children:["Node Type: ",e.nodeType]})]})}),n+=1,void 0!==e.latitude){const r=s.slice(2*n,2*n+8);a.push({id:"payload:latitude",title:"Latitude",color:"green",hex:r,startByte:n,endByte:n+3,decoded:t.jsxs(t.Fragment,{children:[t.jsx(Te,{size:"standard",copy:!0,children:r.toUpperCase()}),t.jsxs("p",{className:"text-xs text-text-primary mt-1",children:[e.latitude.toFixed(6),"°"]})]})}),n+=4}if(void 0!==e.longitude){const r=s.slice(2*n,2*n+8);a.push({id:"payload:longitude",title:"Longitude",color:"purple",hex:r,startByte:n,endByte:n+3,decoded:t.jsxs(t.Fragment,{children:[t.jsx(Te,{size:"standard",copy:!0,children:r.toUpperCase()}),t.jsxs("p",{className:"text-xs text-text-primary mt-1",children:[e.longitude.toFixed(6),"°"]})]})}),n+=4}if(e.name){const r=s.slice(2*n),i=r.length/2;a.push({id:"payload:name",title:"Name",color:"amber",hex:r,startByte:n,endByte:n+i-1,decoded:t.jsxs(t.Fragment,{children:[t.jsx(Te,{size:"standard",copy:!0,children:r.toUpperCase()}),t.jsxs("p",{className:"text-xs text-text-primary mt-1",children:['"',e.name,'"']})]})})}return a}(e,s);case"ack":return function(e,s){return[{id:"payload:crc",title:"CRC",color:"green",hex:s.slice(0,8),startByte:0,endByte:3,decoded:t.jsxs(t.Fragment,{children:[t.jsxs(Te,{size:"standard",copy:!0,children:["0x",e.crc]}),t.jsx("p",{className:"text-xs text-text-muted mt-1",children:"CRC32 of acknowledged packet"})]})}]}(e,s);case"grp_txt":return function(e,s){const a=[];a.push({id:"payload:channelHash",title:"Channel Hash",color:"blue",hex:s.slice(0,2),startByte:0,endByte:0,decoded:t.jsxs(t.Fragment,{children:[t.jsxs(Te,{size:"standard",copy:!0,children:["0x",e.channelHash]}),e.channelName&&t.jsxs("p",{className:"text-xs text-text-primary mt-1",children:["Channel: ",e.channelName]})]})}),e.macHex&&a.push({id:"payload:mac",title:"MAC",color:"purple",hex:s.slice(2,6),startByte:1,endByte:2,decoded:t.jsxs(t.Fragment,{children:[t.jsx(Te,{size:"standard",copy:!0,children:e.macHex.toUpperCase()}),t.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Truncated HMAC-SHA256"})]})});const n=s.slice(6);return n&&a.push({id:"payload:ciphertext",title:e.decrypted?"Message":"Ciphertext",color:e.decrypted?"green":"zinc",hex:n,startByte:3,endByte:3+n.length/2-1,decoded:e.decrypted?t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm text-text-primary",children:['"',e.text,'"']}),e.senderName&&t.jsxs("p",{className:"text-xs text-text-muted mt-1",children:["From: ",e.senderName]})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:n.toUpperCase()}),t.jsx("p",{className:"text-xs text-text-muted mt-1",children:"AES-128-ECB encrypted"})]})}),a}(e,s);case"grp_data":return function(e,s){const a=[];a.push({id:"payload:channelHash",title:"Channel Hash",color:"blue",hex:s.slice(0,2),startByte:0,endByte:0,decoded:t.jsxs(t.Fragment,{children:[t.jsxs(Te,{size:"standard",copy:!0,children:["0x",e.channelHash]}),e.channelName&&t.jsxs("p",{className:"text-xs text-text-primary mt-1",children:["Channel: ",e.channelName]})]})}),e.macHex&&a.push({id:"payload:mac",title:"MAC",color:"purple",hex:s.slice(2,6),startByte:1,endByte:2,decoded:t.jsxs(t.Fragment,{children:[t.jsx(Te,{size:"standard",copy:!0,children:e.macHex.toUpperCase()}),t.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Truncated HMAC-SHA256"})]})});const n=s.slice(6);return n&&a.push({id:"payload:ciphertext",title:e.decrypted?"Decrypted Data":"Encrypted Data",color:e.decrypted?"green":"zinc",hex:n,startByte:3,endByte:3+n.length/2-1,decoded:t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:(e.decryptedHex||n).toUpperCase()}),t.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[e.dataLength," bytes",e.decrypted?"":" (AES-128-ECB encrypted)"]})]})}),a}(e,s);case"path":return function(e,s){return[{id:"payload:path",title:"Path Hops",color:"amber",hex:s,startByte:0,endByte:s.length/2-1,decoded:t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"flex flex-wrap items-center gap-1",children:e.path.map((e,s)=>t.jsxs("span",{className:"flex items-center gap-1",children:[s>0&&t.jsx(Ge,{className:"w-3 h-3 text-text-muted"}),t.jsx(F,{color:"amber",className:"font-mono",children:e})]},s))}),t.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[e.path.length," hops"]})]})}]}(e,s);case"trace":return function(e,s){const a=[];a.push({id:"payload:crc",title:"Trace Tag",color:"blue",hex:s.slice(0,8),startByte:0,endByte:3,decoded:t.jsxs(t.Fragment,{children:[t.jsxs(Te,{size:"standard",copy:!0,children:["0x",e.traceTag]}),t.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Unique trace request identifier"})]})}),a.push({id:"payload:mac",title:"Auth Code",color:"purple",hex:s.slice(8,16),startByte:4,endByte:7,decoded:t.jsxs(t.Fragment,{children:[t.jsx(Te,{size:"standard",copy:!0,children:e.authCode}),t.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Authentication/verification code"})]})}),a.push({id:"payload:flags",title:"Flags",color:"amber",hex:s.slice(16,18),startByte:8,endByte:8,decoded:t.jsxs(t.Fragment,{children:[t.jsxs(Te,{size:"standard",copy:!0,children:["0x",e.flags.toString(16).toUpperCase().padStart(2,"0")]}),t.jsx("p",{className:"text-xs text-text-muted mt-1",children:0===e.flags?"No flags set":`Flags: ${e.flags.toString(2).padStart(8,"0")}b`})]})});const n=s.slice(18);if(n){const s=e=>e>=7?"green":e>=0?"yellow":e>=-5?"orange":"red";a.push({id:"payload:path",title:"Target Path",color:"indigo",hex:n,startByte:9,endByte:9+n.length/2-1,decoded:t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"flex flex-wrap items-center gap-1",children:e.pathHashes.map((a,n)=>{const r=e.snrValues[n],i=void 0!==r?s(r):"zinc";return t.jsxs("span",{className:"flex items-center gap-1",children:[n>0&&t.jsx(Ge,{className:"w-3 h-3 text-text-muted"}),t.jsx(F,{color:"indigo",className:"font-mono",children:a}),void 0!==r&&t.jsxs(F,{color:i,className:"font-mono",children:[r>=0?"+":"",Number.isInteger(r)?r:r.toFixed(1),"dB"]})]},n)})}),t.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[e.pathHashes.length," target ",1===e.pathHashes.length?"hop":"hops",e.snrValues.length>0&&` • ${e.snrValues.length} SNR ${1===e.snrValues.length?"value":"values"} collected`,e.isComplete&&" • ✓ Complete"]})]})})}return a}(e,s);case"multipart":return function(e,s){const a=[];a.push({id:"payload:msgId",title:"Message ID",color:"blue",hex:s.slice(0,4),startByte:0,endByte:1,decoded:t.jsxs(t.Fragment,{children:[t.jsx(Te,{size:"standard",copy:!0,children:e.messageId.toUpperCase()}),t.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Unique message identifier"})]})}),a.push({id:"payload:partNum",title:"Part Number",color:"amber",hex:s.slice(4,6),startByte:2,endByte:2,decoded:t.jsxs(t.Fragment,{children:[t.jsx(Te,{size:"standard",copy:!0,children:e.partNumber}),t.jsx("p",{className:"text-xs text-text-muted mt-1",children:"0-indexed part number"})]})}),a.push({id:"payload:totalParts",title:"Total Parts",color:"orange",hex:s.slice(6,8),startByte:3,endByte:3,decoded:t.jsxs(t.Fragment,{children:[t.jsx(Te,{size:"standard",copy:!0,children:e.totalParts}),t.jsxs("p",{className:"text-xs text-text-muted mt-1",children:["Part ",e.partNumber+1," of ",e.totalParts]})]})});const n=s.slice(8);return n&&a.push({id:"payload:partData",title:"Part Data",color:"cyan",hex:n,startByte:4,endByte:4+n.length/2-1,decoded:t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:n.toUpperCase()}),t.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[n.length/2," bytes"]})]})}),a}(e,s);default:return[{id:"payload:ciphertext",title:"Raw Data",color:"zinc",hex:s,startByte:0,endByte:s.length/2-1,decoded:t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50 font-mono",children:s.toUpperCase()}),t.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[s.length/2," bytes"]})]})}]}}(j,f.payloadHex),[j,f.payloadHex]),v="payload"===m||as(m),N=e.useMemo(()=>{const e=[{id:"header",hex:f.headerHex,color:"red"},...f.transportCodesHex?[{id:"transportCodes",hex:f.transportCodesHex,color:"purple"}]:[],{id:"pathLength",hex:f.pathLengthHex,color:"green"},...f.pathDataHex?[{id:"pathData",hex:f.pathDataHex,color:"amber"}]:[]];return v?[...e,...(t=b,t.map(e=>({id:e.id,hex:e.hex,color:e.color})))]:[...e,{id:"payload",hex:f.payloadHex,color:"cyan"}];var t},[f,v,b]);return t.jsxs("div",{className:"font-mono space-y-2 min-w-0 overflow-hidden",children:[(()=>{switch(j.type){case"advert":return t.jsx(us,{advert:j,timestamp:s.timestamp});case"grp_data":return t.jsx(fs,{decoded:j,timestamp:s.timestamp});case"grp_txt":return t.jsx(gs,{decoded:j,timestamp:s.timestamp,isLoading:g});case"ack":return t.jsx(ys,{decoded:j,timestamp:s.timestamp});case"path":return t.jsx(js,{decoded:j,timestamp:s.timestamp});case"trace":return t.jsx(bs,{decoded:j,timestamp:s.timestamp});case"txt_msg":return t.jsx(vs,{decoded:j,timestamp:s.timestamp});case"multipart":return t.jsx(Ns,{decoded:j,timestamp:s.timestamp});case"generic":return y.payloadType===ue.REQ||y.payloadType===ue.RESPONSE||y.payloadType===ue.ANON_REQ?t.jsx(ws,{decoded:j,timestamp:s.timestamp,payloadType:y.payloadType}):null;default:return null}})(),t.jsx("div",{className:"bg-black rounded-2xl p-6",children:t.jsx(ps,{segments:N,selectedSegment:m,onSegmentClick:u})}),t.jsx(I,{children:t.jsx(U.div,{layout:!0,transition:os,className:"space-y-2 min-w-0",children:(()=>{var e,s,a,n;const i=[{id:"header",title:"Header",color:"red",startByte:0,endByte:0,hexBytes:`0x${f.headerHex.toUpperCase()}`,condition:!0,content:t.jsxs("table",{className:"w-full text-left",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"text-[10px] uppercase tracking-wide text-text-muted border-b border-border-subtle font-sans",children:[t.jsx("th",{className:"py-1 font-medium",children:"Bits"}),t.jsx("th",{className:"py-1 font-medium",children:"Field"}),t.jsx("th",{className:"py-1 font-medium",children:"Value"}),t.jsx("th",{className:"py-1 font-medium",children:"Binary"})]})}),t.jsx("tbody",{children:f.headerFields.map(e=>t.jsx(ms,{...e},e.bits))})]})},{id:"transportCodes",title:"Transport Codes",color:"purple",startByte:1,endByte:4,hexBytes:(null==(e=f.transportCodesHex)?void 0:e.toUpperCase())||"",condition:!!f.transportCodesHex,content:t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-xs text-text-muted",children:"Two 16-bit transport codes for encrypted routing"}),t.jsxs("div",{className:"mt-1 text-xs text-text-secondary",children:["Code 1: 0x",null==(s=f.transportCodesHex)?void 0:s.slice(0,4).toUpperCase()," | Code 2: 0x",null==(a=f.transportCodesHex)?void 0:a.slice(4,8).toUpperCase()]})]})},{id:"pathLength",title:"Path Length",color:"green",startByte:f.transportCodesHex?5:1,endByte:f.transportCodesHex?5:1,hexBytes:`0x${f.pathLengthHex.toUpperCase()}`,condition:!0,content:t.jsxs("p",{className:"text-xs text-text-muted pt-1",children:[y.pathLen," bytes showing route taken (increases as packet floods)"]})},{id:"pathData",title:"Path Data",color:"amber",startByte:f.transportCodesHex?6:2,endByte:(f.transportCodesHex?5:1)+y.pathLen,hexBytes:(null==(n=f.pathDataHex)?void 0:n.toUpperCase())||"",condition:y.pathLen>0,content:t.jsxs("div",{className:"space-y-3",children:[t.jsx(ks,{pathHex:f.pathDataHex}),t.jsx("p",{className:"text-xs text-text-muted",children:"Historical route taken (bytes are added as packet floods through network)"})]})},{id:"payload",title:"Payload",color:"cyan",startByte:f.payloadStartByte,endByte:r-1,hexBytes:f.payloadHex.toUpperCase(),condition:!0,content:t.jsxs(t.Fragment,{children:[!as(m)&&t.jsxs("div",{className:"p-3 rounded-lg bg-black",children:[t.jsx("p",{className:"text-[10px] uppercase tracking-wide text-text-muted mb-1.5 font-sans",children:"Decoded"}),t.jsx(Cs,{decoded:j,payloadType:y.payloadType})]}),!as(m)&&b.length>0&&t.jsx("p",{className:"text-[10px] uppercase tracking-wide text-text-muted mt-3 font-sans",children:"Click a field below to highlight its bytes"}),as(m)&&t.jsx("p",{className:"text-[10px] uppercase tracking-wide text-text-muted font-sans",children:"↑ Selected field above • Other fields below ↓"})]})}].filter(e=>e.condition),l=as(m)?b.find(e=>e.id===m):null,c=as(m)?[...i].sort((e,t)=>"payload"===e.id?-1:"payload"===t.id?1:0):[...i].sort((e,t)=>e.id===m?-1:t.id===m?1:0),o=as(m)?b.filter(e=>e.id!==m):[];return t.jsxs(t.Fragment,{children:[l&&t.jsx(hs,{id:`subfield-${l.id}`,title:l.title,color:l.color,startByte:f.payloadStartByte+l.startByte,endByte:f.payloadStartByte+l.endByte,hexBytes:l.hex.toUpperCase(),isSelected:!0,children:l.decoded},l.id),c.map(e=>t.jsx(hs,{id:`section-${e.id}`,title:e.title,color:e.color,startByte:e.startByte,endByte:e.endByte,hexBytes:e.hexBytes,isSelected:e.id===m,children:e.content},e.id)),o.map(e=>t.jsxs(U.div,{layout:"position",layoutId:`subfield-${e.id}`,transition:os,className:"w-full min-w-0 overflow-hidden rounded-xl p-4 sm:p-5 space-y-4",style:{backgroundColor:is,boxShadow:ls},children:[t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-0.5 min-w-0",children:[t.jsx(F,{color:e.color,children:e.title}),e.hex.length<=32&&ss(e.hex).map((s,a)=>t.jsx(F,{color:e.color,className:"font-mono",children:s.toUpperCase()},a))]}),t.jsxs("span",{className:"text-[10px] text-text-muted font-mono flex-shrink-0",children:["Bytes ",f.payloadStartByte+e.startByte,"-",f.payloadStartByte+e.endByte]})]}),t.jsx("div",{className:"min-w-0 overflow-hidden p-3 rounded-lg bg-black",children:e.decoded})]},e.id))]})})()})})]})});function Ms(e){if(!e)return[];if(Array.isArray(e))return e;try{const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}}function Ps(e){return e?(e.startsWith("0x")?e.slice(2):e).slice(0,2).toUpperCase():""}function Ts({hop:a,compact:n=!1,index:r=0,highlightIndex:i=-1,isTrace:l=!1}){var c;const o=r===i,d=Pt();return e.useEffect(()=>{o&&l&&d.start({boxShadow:["0 0 0 0px rgba(113, 156, 223, 0)","0 0 0 2px rgba(113, 156, 223, 0.5)","0 0 0 2px rgba(113, 156, 223, 0.5)","0 0 0 0px rgba(113, 156, 223, 0)"],transition:{duration:.5,times:[0,.2,.7,1],ease:"easeInOut"}})},[o,l,d]),t.jsxs(U.div,{className:s("flex items-center gap-1.5",n?"flex-row":"flex-col"),animate:{scale:o?1.05:1,opacity:o?1:.85},transition:{duration:.3,ease:"easeInOut"},children:[t.jsxs(U.div,{className:s("flex items-center gap-1.5 px-2.5 py-1 rounded-md","font-mono text-xs font-semibold",a.isLocal?"bg-amber-500/20 text-amber-300 ring-1 ring-amber-500/30":"bg-zinc-700/50 text-zinc-200 ring-1 ring-zinc-600/50"),animate:d,initial:{boxShadow:"0 0 0 0px rgba(113, 156, 223, 0)"},children:[a.isLocal&&t.jsx(Oe,{className:"w-3 h-3"}),t.jsx("span",{children:a.prefix}),void 0!==a.confidence&&a.confidence<.9&&t.jsxs("span",{className:"text-[9px] opacity-70",children:[(100*a.confidence).toFixed(0),"%"]})]}),!n&&(null==(c=a.neighborInfo)?void 0:c.name)&&t.jsx("span",{className:"text-[10px] text-text-muted truncate max-w-[80px]",children:a.neighborInfo.name})]})}function Hs({snr:e}){const s=Qe(e),a=We()[s]||"#6b7280",n=Number.isInteger(e)?e.toString():e.toFixed(1);return t.jsxs(F,{customColor:a,compact:!0,className:"font-mono",children:[e>=0?"+":"",n,"dB"]})}function _s({hops:a,compact:n,isTrace:r=!1}){const[i,l]=e.useState(-1);return e.useEffect(()=>{if(0===a.length)return;const e=setTimeout(()=>{l(0)},400),t=setInterval(()=>{l(e=>{const s=e+1;return s>=a.length?(clearInterval(t),-1):s})},r?500:600);return()=>{clearTimeout(e),clearInterval(t)}},[a.length,r]),t.jsx("div",{className:"p-6",style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"4px 8px"},children:a.map((e,l)=>{const c=l%2==0,o=l===a.length-1;return t.jsxs("div",{className:"contents",children:[t.jsx("div",{className:s("flex items-center","justify-end"),children:c&&t.jsx(Ts,{hop:e,compact:n,index:l,highlightIndex:i,isTrace:r})}),t.jsx("div",{className:"flex flex-col items-center justify-center min-h-[28px]",children:!o&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-px flex-1 bg-zinc-600/40 min-h-[8px]"}),void 0!==e.snr&&t.jsx(Hs,{snr:e.snr}),t.jsx("svg",{className:"w-3 h-3 text-zinc-500 flex-shrink-0",viewBox:"0 0 12 12",fill:"none",children:t.jsx("path",{d:"M6 2v8M3 7l3 3 3-3",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]})}),t.jsx("div",{className:s("flex items-center","justify-start"),children:!c&&t.jsx(Ts,{hop:e,compact:n,index:l,highlightIndex:i,isTrace:r})})]},`${e.prefix}-${l}`)})})}const Bs=e.memo(function({packet:a,neighbors:n,localHash:r,neighborAffinity:i,ghostPrefixes:l,direction:c="horizontal",compact:o=!1,traceSnr:d,overridePath:x}){const p=void 0!==d&&d.length>0,m=Ms(a.original_path),h=Ms(a.forwarded_path),u=x??(h.length>0?h:m),f=Ps(r),g=e.useMemo(()=>u.map((e,t)=>{const s=e.toUpperCase(),a=s===f,r=(null==l?void 0:l.has(s))??!1,c=function(e,t,s){const a=e.toUpperCase();if(s){let e=null,n=0;if(s.forEach((t,s)=>{if(Ps(s)===a){const a=t.combinedScore??0;a>n&&(n=a,e=s)}}),e&&t[e])return{hash:e,info:t[e],confidence:n}}for(const[n,r]of Object.entries(t))if(Ps(n)===a)return{hash:n,info:r,confidence:void 0};return null}(s,n,i);return{prefix:s,fullHash:null==c?void 0:c.hash,neighborInfo:null==c?void 0:c.info,isLocal:a,isGhost:r,confidence:null==c?void 0:c.confidence,snr:null==d?void 0:d[t]}}),[u,n,i,f,l,d]);if(0===g.length)return t.jsxs("div",{className:"flex items-center gap-2 text-text-muted text-xs",children:[t.jsx(W,{className:"w-4 h-4 opacity-50"}),t.jsx("span",{children:"Direct / No path data"})]});if("flowchart"===c)return t.jsx(_s,{hops:g,compact:o,isTrace:p});const y="horizontal"===c?Ge:Me;return t.jsx("div",{className:s("flex gap-1.5","horizontal"===c?"flex-row flex-wrap items-center":"flex-col items-start"),children:g.map((e,a)=>t.jsxs("div",{className:s("flex items-center gap-1.5","vertical"===c&&"flex-col"),children:[t.jsx(Ts,{hop:e,compact:o}),a<g.length-1&&t.jsx(y,{className:"w-3 h-3 text-text-muted flex-shrink-0"})]},`${e.prefix}-${a}`))})});function Fs(e){if(!e)return[];if(Array.isArray(e))return e;try{const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}}function As({packets:e,selectedIndex:a,onSelect:n,compact:r=!1}){if(e.length<=1)return null;const i=a>0,l=a<e.length-1;return t.jsxs("div",{className:s("flex items-center gap-1",r?"gap-0.5":"gap-1"),children:[t.jsx("button",{onClick:()=>i&&n(a-1),disabled:!i,className:s("p-0.5 rounded transition-colors",i?"text-text-muted hover:text-text-primary hover:bg-white/10":"text-white/20 cursor-not-allowed"),"aria-label":"Previous observation",children:t.jsx(qe,{className:r?"size-3":"size-4"})}),t.jsx("div",{className:"flex items-center gap-0.5",children:e.map((e,i)=>{const l=i===a,c=new Date(1e3*e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});return t.jsx(ee,{color:l?"cyan":"zinc",filled:l,compact:r,onClick:()=>n(i),title:`Observation ${i+1} at ${c}`,className:s("transition-all duration-150",!l&&"opacity-60 hover:opacity-100"),children:r?t.jsx("span",{className:"tabular-nums",children:i+1}):t.jsxs("span",{className:"tabular-nums text-[10px]",children:["#",i+1,null!=e.rssi&&t.jsx("span",{className:"ml-1 opacity-70",children:e.rssi})]})},`${e.timestamp}_${i}`)})}),t.jsx("button",{onClick:()=>l&&n(a+1),disabled:!l,className:s("p-0.5 rounded transition-colors",l?"text-text-muted hover:text-text-primary hover:bg-white/10":"text-white/20 cursor-not-allowed"),"aria-label":"Next observation",children:t.jsx(He,{className:r?"size-3":"size-4"})}),t.jsxs("span",{className:s("text-text-muted ml-1",r?"text-[9px]":"text-[10px]"),children:[t.jsx(Pe,{className:"inline size-3 mr-0.5 opacity-50"}),e.length]})]})}function Ds({icon:e,label:a,disabled:n=!1}){return t.jsx(U.div,{className:"flex items-center gap-1 text-[10px]",title:a,animate:{opacity:n?.25:.6},transition:{duration:.15,ease:[.4,0,.2,1]},children:t.jsx("span",{className:s("flex items-center justify-center size-5 rounded border transition-colors duration-150",n?"bg-white/[0.02] border-white/5":"bg-white/5 border-white/10"),children:e})})}function Ls({hasDuplicates:e,hasPrev:s,hasNext:a,canPrevDupe:n,canNextDupe:r}){return t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsxs("div",{className:"flex items-center gap-0.5",children:[t.jsx(Ds,{icon:t.jsx(Ie,{className:"size-3"}),label:"Previous packet (↑)",disabled:!s}),t.jsx(Ds,{icon:t.jsx(te,{className:"size-3"}),label:"Next packet (↓)",disabled:!a})]}),e&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-px h-3 bg-white/10"}),t.jsxs("div",{className:"flex items-center gap-0.5",children:[t.jsx(Ds,{icon:t.jsx(qe,{className:"size-3"}),label:"Previous observation (←)",disabled:!n}),t.jsx(Ds,{icon:t.jsx(He,{className:"size-3"}),label:"Next observation (→)",disabled:!r})]})]})]})}const $s=e.memo(function({packets:s,initialIndex:a=0,onClose:n,onNavigatePrev:r,onNavigateNext:i,hasPrev:l=!1,hasNext:c=!1}){const[o,d]=e.useState(a),x=s[o]??s[0],p=s.length>1,m=o>0,h=o<s.length-1,u=e.useCallback(e=>{d(Math.max(0,Math.min(e,s.length-1)))},[s.length]);e.useEffect(()=>{const e=e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement))switch(e.key){case"ArrowUp":e.preventDefault(),null==r||r();break;case"ArrowDown":e.preventDefault(),null==i||i();break;case"ArrowLeft":e.preventDefault(),m&&d(e=>e-1);break;case"ArrowRight":e.preventDefault(),h&&d(e=>e+1)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[r,i,m,h]);const f=G(),g=q(),y=K(),j=Y(),b=e.useMemo(()=>new Set(j.map(e=>e.prefix.toUpperCase())),[j]),v=x.payload_type_name||L(x.payload_type??x.type),N=x.route_type_name||$(x.route_type??x.route),w=x.payload_length??x.length??0,k=Fs(x.original_path),C=Fs(x.forwarded_path),S=k.length>0||C.length>0,M=C.length>0?C:k,P=e.useMemo(()=>{var e;if(null==(e=null==f?void 0:f.config)?void 0:e.repeater)return{latitude:f.config.repeater.latitude,longitude:f.config.repeater.longitude,name:f.config.node_name||"Local Node"}},[f]),T=(null==f?void 0:f.neighbors)??{},H=y.size>0?y:void 0,_=x.raw_packet&&x.raw_packet.length>0,B=e.useMemo(()=>{if((x.payload_type??x.type)!==ue.TRACE||!x.payload)return null;try{const e=me(x.payload),t=x.original_path||x.forwarded_path||[];let s=[];if("string"==typeof t)try{const e=JSON.parse(t);Array.isArray(e)&&(s=e.map(e=>parseInt(e,16)))}catch{s=[]}else Array.isArray(t)&&(s=t.map(e=>parseInt(e,16)));return he(e,s)}catch{return null}},[x]),A=null==B?void 0:B.snrValues,D=e.useMemo(()=>{if((x.payload_type??x.type)!==ue.ADVERT||!x.payload)return null;try{const e=me(x.payload),t=je(e);if(!t)return null;const s=t.publicKey.slice(0,2).toUpperCase();return{...t,prefix:s}}catch{return null}},[x]),z=e.useMemo(()=>{if((null==D?void 0:D.latitude)&&(null==D?void 0:D.longitude))return{latitude:D.latitude,longitude:D.longitude,name:D.name||`Node ${D.prefix||"??"}`,prefix:D.prefix,publicKey:D.publicKey}},[D]),R=e=>e&&0!==e?new Date(1e3*e).toLocaleString():"Unknown",[E,I]=e.useState(null);e.useEffect(()=>{if((x.payload_type??x.type)!==ue.GRP_TXT||!x.payload)return void I(null);let e=!1;const t=me(x.payload);return fe(t).then(t=>{!e&&t&&I(t)}),()=>{e=!0}},[x]);const V=e.useCallback(e=>{if(!e)return null;const t=e.trim().match(/(-?\d+\.?\d*)\s*[,\s]\s*(-?\d+\.?\d*)/);if(!t)return null;const s=parseFloat(t[1]),a=parseFloat(t[2]);return isNaN(s)||isNaN(a)||s<-90||s>90||a<-180||a>180||0===s&&0===a?null:{lat:s,lon:a}},[]),Q=e.useMemo(()=>{var e,t;if(!(null==E?void 0:E.decrypted))return;if(!(null==(e=E.channelName)?void 0:e.toLowerCase().includes("wardrive")))return;const s=V(E.text);return s?{latitude:s.lat,longitude:s.lon,name:E.senderName||"Wardrive Ping",prefix:(null==(t=E.senderName)?void 0:t.slice(0,2).toUpperCase())||"WD",nodeType:"wardrive"}:void 0},[E,V]),ee=(x.payload_type??x.type)===ue.ADVERT&&(void 0!==z||S),te=void 0!==Q,se=z??Q;if(0===M.length)return null;const ae=(null==f?void 0:f.local_hash)?(f.local_hash.startsWith("0x")?f.local_hash.slice(2,4):f.local_hash.slice(0,2)).toUpperCase():"";for(const e of M){const t=e.toUpperCase();if(t!==ae)if(H){let e=0,s=0;if(H.forEach((a,n)=>{(n.startsWith("0x")?n.slice(2,4):n.slice(0,2)).toUpperCase()===t&&(e++,s=Math.max(s,a.combinedScore??0))}),0===e)for(const a of Object.keys(T))if((a.startsWith("0x")?a.slice(2,4):a.slice(0,2)).toUpperCase()===t)break}else for(const e of Object.keys(T))if((e.startsWith("0x")?e.slice(2,4):e.slice(0,2)).toUpperCase()===t)break}const ne={lime:"rgb(132, 204, 22)",cyan:"rgb(34, 211, 238)",amber:"rgb(251, 191, 36)",violet:"rgb(167, 139, 250)",rose:"rgb(251, 113, 133)",emerald:"rgb(52, 211, 153)",sky:"rgb(56, 189, 248)",orange:"rgb(251, 146, 60)",pink:"rgb(244, 114, 182)",zinc:"rgb(161, 161, 170)",purple:"rgb(168, 85, 247)",indigo:"rgb(129, 140, 248)",teal:"rgb(45, 212, 191)",fuchsia:"rgb(232, 121, 249)",blue:"rgb(59, 130, 246)",green:"rgb(34, 197, 94)",yellow:"rgb(250, 204, 21)",red:"rgb(239, 68, 68)"},re=ne[we[v]??"zinc"]||ne.zinc;return t.jsxs(J,{open:!0,onClose:n,size:"5xl",motionPlus:!0,className:"sm:h-[85vh] sm:max-h-[800px] md:h-[80vh] md:max-h-[900px]",children:[t.jsxs("div",{className:"sm:hidden",children:[t.jsx("div",{className:"flex justify-center pt-2 pb-1",children:t.jsx("div",{className:"w-9 h-1 rounded-full bg-white/30","aria-hidden":"true"})}),t.jsxs("div",{className:"flex items-center justify-between px-3 pb-2",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(F,{color:we[v]??"zinc",className:"!text-[9px] !px-1.5 !py-0",children:v}),t.jsx(F,{color:"DIRECT"===N||"T_DIRECT"===N?"cyan":"amber",className:"!text-[9px] !px-1.5 !py-0",children:N}),t.jsxs(F,{color:"zinc",className:"!text-[9px] !px-1.5 !py-0",children:[w,"B"]})]}),t.jsx("button",{onClick:n,className:"px-3 py-1.5 text-[15px] font-medium text-blue-400 active:text-blue-300 transition-colors flex-shrink-0 rounded-lg active:bg-white/5",children:"Done"})]}),p&&t.jsx("div",{className:"px-3 pb-2",children:t.jsx(As,{packets:s,selectedIndex:o,onSelect:u,compact:!0})})]}),t.jsx("div",{className:"hidden sm:block px-6 pt-5 pb-4",children:t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(F,{color:we[v]??"zinc",children:v}),t.jsx(F,{color:"DIRECT"===N||"T_DIRECT"===N?"cyan":"amber",children:N}),t.jsxs(F,{color:"zinc",children:[w,"B"]}),p&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-px h-4 bg-white/10"}),t.jsx(As,{packets:s,selectedIndex:o,onSelect:u})]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Ls,{hasDuplicates:p,hasPrev:l,hasNext:c,canPrevDupe:m,canNextDupe:h}),t.jsx("button",{onClick:n,className:"p-1.5 -m-1.5 text-text-muted hover:text-text-primary transition-colors rounded-lg hover:bg-bg-elevated flex-shrink-0",children:t.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})}),t.jsx("div",{className:"sm:hidden h-[2px]",style:{backgroundColor:re,opacity:.6}}),t.jsxs(X,{className:"p-0 overflow-hidden flex-1 flex flex-col min-h-0",children:[t.jsx("div",{className:"md:hidden flex-1 overflow-y-auto overflow-x-hidden",children:t.jsxs("div",{className:"p-2 space-y-2",children:[(null!=x.rssi||null!=x.snr)&&t.jsxs("div",{className:"relative flex items-center justify-between px-2 py-1.5 rounded-lg bg-white/[0.03]",children:[t.jsx(Z,{mode:"popLayout",initial:!1,children:t.jsxs(U.div,{className:"flex items-center gap-3",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[t.jsx(ve,{rssi:x.rssi,snr:x.snr,compact:!0,showValues:!0}),t.jsx("span",{className:"text-[11px] text-white/50",children:Ce(x.rssi)})]},o)}),M.length>0&&t.jsxs("span",{className:"text-[10px] font-mono text-white/40",children:[M.length," hop",1!==M.length?"s":""]})]}),(S&&M.length>0||ee||te)&&t.jsx("div",{className:"overflow-hidden rounded-xl",children:t.jsx("div",{className:"aspect-[4/3] w-full",children:t.jsx(ts,{path:M,neighbors:T,localNode:P,localHash:null==f?void 0:f.local_hash,srcHash:x.src_hash,dstHash:x.dst_hash,neighborAffinity:H,hubNodes:[...g],traceSnr:A,advertiserSource:se})})}),B&&B.pathHashes.length>0&&t.jsxs("div",{className:"rounded-xl bg-black overflow-hidden",children:[t.jsx("div",{className:"px-3 py-2 space-y-1.5",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-[10px] font-medium text-text-muted uppercase tracking-wide",children:"Trace Route"}),t.jsx("div",{className:"flex items-center gap-1.5",children:t.jsx(F,{color:B.isComplete?"green":"amber",compact:!0,children:B.isComplete?"Complete":"In Progress"})})]})}),t.jsx(Bs,{packet:x,neighbors:T,localHash:null==f?void 0:f.local_hash,neighborAffinity:H,ghostPrefixes:b,direction:"flowchart",compact:!0,overridePath:B.pathHashes,traceSnr:B.snrValues})]}),S&&!B&&t.jsxs("div",{className:"rounded-xl bg-black overflow-hidden",children:[t.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[t.jsx("span",{className:"text-[10px] font-medium text-text-muted uppercase tracking-wide",children:"Path"}),t.jsxs(F,{color:"zinc",compact:!0,children:[M.length," hop",1!==M.length?"s":""]})]}),t.jsx(Bs,{packet:x,neighbors:T,localHash:null==f?void 0:f.local_hash,neighborAffinity:H,ghostPrefixes:b,direction:"flowchart",compact:!0,traceSnr:A})]}),D&&t.jsxs("div",{className:"rounded-xl bg-white/[0.03] overflow-hidden",children:[t.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-white/5",children:[t.jsx("span",{className:"text-[10px] font-medium text-text-muted uppercase tracking-wide",children:"Advertiser Info"}),t.jsx(F,{color:"lime",compact:!0,children:D.nodeType})]}),t.jsxs("div",{className:"p-3 space-y-2",children:[D.name&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(tt,{className:"w-3.5 h-3.5 text-text-muted flex-shrink-0"}),t.jsx("span",{className:"text-sm font-medium text-text-primary truncate",children:D.name})]}),D.latitude&&D.longitude&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Fe,{className:"w-3.5 h-3.5 text-text-muted flex-shrink-0"}),t.jsxs("span",{className:"text-xs font-mono text-text-secondary",children:[D.latitude.toFixed(5),", ",D.longitude.toFixed(5)]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Xe,{className:"w-3.5 h-3.5 text-text-muted flex-shrink-0"}),t.jsxs("span",{className:"text-[10px] font-mono text-text-muted truncate",children:[D.publicKey.slice(0,16),"...",D.publicKey.slice(-8)]})]}),D.timestamp>0&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(O,{className:"w-3.5 h-3.5 text-text-muted flex-shrink-0"}),t.jsx("span",{className:"text-xs text-text-muted",children:R(D.timestamp)})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(W,{className:"w-3.5 h-3.5 text-text-muted flex-shrink-0"}),t.jsx("span",{className:"text-[10px] text-text-muted",children:D.flagsDescription||`Flags: 0x${D.flags.toString(16).padStart(2,"0")}`})]})]})]}),_&&t.jsx("div",{className:"pt-1",children:t.jsx(Ss,{packet:x})})]})}),t.jsxs("div",{className:"hidden md:grid md:grid-cols-2 flex-1 overflow-hidden",children:[t.jsx("div",{className:"overflow-y-auto overflow-x-hidden scrollbar-none p-4 border-r border-border-subtle",children:_&&t.jsx(Ss,{packet:x})}),t.jsxs("div",{className:"grid overflow-hidden",style:{gridTemplateRows:"minmax(280px, 1fr) auto"},children:[t.jsx("div",{className:"overflow-hidden p-2",children:S&&M.length>0||ee||te?t.jsx("div",{className:"h-full w-full",children:t.jsx(ts,{path:M,neighbors:T,localNode:P,localHash:null==f?void 0:f.local_hash,srcHash:x.src_hash,dstHash:x.dst_hash,neighborAffinity:H,hubNodes:[...g],traceSnr:A,advertiserSource:se})}):t.jsxs("div",{className:"h-full w-full flex flex-col items-center justify-center text-center px-4",children:[t.jsx(W,{className:"w-8 h-8 text-text-muted/50 mb-2"}),t.jsx("span",{className:"text-sm text-text-muted",children:"Direct Reception"}),t.jsx("span",{className:"text-xs text-text-muted/70 mt-1",children:"Zero-hop packet — received directly from sender"})]})}),t.jsxs("div",{className:"overflow-y-auto max-h-[200px] p-2 space-y-2",children:[!B&&M.length<=1&&(null!=x.rssi||null!=x.snr)&&t.jsx("div",{className:"glass-card rounded-xl p-4",children:t.jsxs("dl",{className:"text-xs grid grid-cols-2 gap-2",children:[t.jsxs("div",{children:[t.jsx("dt",{className:"text-text-muted mb-1",children:"Signal"}),t.jsx(Z,{mode:"popLayout",initial:!1,children:t.jsxs(U.dd,{className:"flex items-center gap-2",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[t.jsx(ve,{rssi:x.rssi,snr:x.snr}),t.jsx("span",{className:"font-medium text-text-primary",children:Ce(x.rssi)})]},o)})]}),t.jsxs("div",{children:[t.jsx("dt",{className:"text-text-muted mb-1",children:"RF"}),t.jsx(Z,{mode:"popLayout",initial:!1,children:t.jsxs(U.dd,{className:"font-mono text-text-secondary tabular-nums",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[null!=x.rssi&&`${x.rssi} dBm`,null!=x.snr&&` · ${x.snr.toFixed(1)} dB`]},o)})]})]})}),D&&t.jsxs("div",{className:"rounded-xl bg-white/[0.03] overflow-hidden",children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-white/5",children:[t.jsx("span",{className:"text-xs font-medium text-text-muted uppercase tracking-wide",children:"Advertiser"}),t.jsx(F,{color:"lime",compact:!0,children:D.nodeType})]}),t.jsxs("div",{className:"p-4 space-y-2.5",children:[D.name&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(tt,{className:"w-4 h-4 text-text-muted flex-shrink-0"}),t.jsx("span",{className:"text-sm font-medium text-text-primary truncate",children:D.name})]}),D.latitude&&D.longitude&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Fe,{className:"w-4 h-4 text-text-muted flex-shrink-0"}),t.jsxs("span",{className:"text-xs font-mono text-text-secondary",children:[D.latitude.toFixed(5),", ",D.longitude.toFixed(5)]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Xe,{className:"w-4 h-4 text-text-muted flex-shrink-0"}),t.jsxs("span",{className:"text-[11px] font-mono text-text-muted truncate",children:[D.publicKey.slice(0,16),"...",D.publicKey.slice(-8)]})]}),D.timestamp>0&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(O,{className:"w-4 h-4 text-text-muted flex-shrink-0"}),t.jsx("span",{className:"text-xs text-text-muted",children:R(D.timestamp)})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(W,{className:"w-4 h-4 text-text-muted flex-shrink-0"}),t.jsx("span",{className:"text-[11px] text-text-muted",children:D.flagsDescription||`Flags: 0x${D.flags.toString(16).padStart(2,"0")}`})]})]})]}),B&&B.pathHashes.length>0&&t.jsxs("div",{className:"rounded-xl bg-black overflow-hidden",children:[t.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[t.jsx("span",{className:"text-xs font-medium text-text-muted uppercase tracking-wide",children:"Trace Route"}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(F,{color:B.isComplete?"green":"amber",compact:!0,children:B.isComplete?"Complete":"In Progress"}),t.jsxs(F,{color:"teal",compact:!0,children:[B.pathHashes.length,"h"]})]})]}),t.jsx(Bs,{packet:x,neighbors:T,localHash:null==f?void 0:f.local_hash,neighborAffinity:H,ghostPrefixes:b,direction:"flowchart",compact:!0,overridePath:B.pathHashes,traceSnr:B.snrValues})]}),S&&!B&&t.jsxs("div",{className:"rounded-xl bg-black overflow-hidden",children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-2",children:[t.jsx("span",{className:"text-xs font-medium text-text-muted uppercase tracking-wide",children:"Path"}),t.jsxs(F,{color:"zinc",compact:!0,children:[M.length,"h"]})]}),t.jsx(Bs,{packet:x,neighbors:T,localHash:null==f?void 0:f.local_hash,neighborAffinity:H,ghostPrefixes:b,direction:"flowchart",compact:!0,traceSnr:A})]})]})]})]})]})]})}),zs="var(--mask-height, 0.15em)",Rs="var(--mask-width, 0.5em)",Es=`calc(${Rs} / var(--invert-x, 1))`,Is="#000 0, transparent 71%",Us=`linear-gradient(to right, transparent 0, #000 ${Es}, #000 calc(100% - ${Es}), transparent),linear-gradient(to bottom, transparent 0, #000 ${zs}, #000 calc(100% - ${zs}), transparent 100%),radial-gradient(at bottom right, ${Is}),radial-gradient(at bottom left, ${Is}), radial-gradient(at top left, ${Is}), radial-gradient(at top right, ${Is})`,Vs=`100% calc(100% - ${zs} * 2),calc(100% - ${Es} * 2) 100%,${Es} ${zs},${Es} ${zs},${Es} ${zs},${Es} ${zs}`;function Os({children:e,layoutDependency:s}){return t.jsx(U.span,{layout:!0,layoutDependency:s,"aria-hidden":!0,style:{display:"inline-flex","--invert-x":1,margin:`0 calc(-1*${Rs})`,padding:`calc(${zs}/2) ${Rs}`,position:"relative",zIndex:-1,overflow:"clip",WebkitMaskImage:Us,WebkitMaskSize:Vs,WebkitMaskPosition:"center, center, top left, top right, bottom right, bottom left",WebkitMaskRepeat:"no-repeat"},children:e})}function Ws(){const t=e.useRef(!0);return e.useEffect(()=>{t.current=!1},[]),t.current}function Qs(e){const{width:t,fontSize:s}=getComputedStyle(e);return parseFloat(t)/parseFloat(s)+"em"}se({"--invert-x":{correct:(e,{treeScale:t,projectionDelta:s})=>s.x.scale*t.x}});const Gs=new WeakMap,qs=e.forwardRef(function({value:s,initialValue:a=s,...n},r){const{transition:i}=e.useContext(c),l=e.useRef(a).current,o=Ws(),d=e.useRef(null),x=e.useRef(null);e.useImperativeHandle(r,()=>x.current,[]);const p=e.useRef(new Array(10)),m=ae(),h=m?s:0;e.useLayoutEffect(()=>{d.current&&p.current[l]&&(d.current.style.width=Qs(p.current[l]))},[]);const u=e.useRef(a);e.useLayoutEffect(()=>{var e;if(!d.current||h===u.current)return;const t=d.current.getBoundingClientRect(),s=null==(e=x.current)?void 0:e.getBoundingClientRect(),a=t.height*(h-u.current)+(t.top-(s?s.top||0:t.top));return St(d.current,{y:[a,0]},i),()=>{u.current=h}},[h]);const[f,g]=e.useState();e.useEffect(()=>{if(o&&l===h)return;if(!p.current[h])return;const e=Qs(p.current[h]);x.current&&Gs.set(x.current,e),g(e)},[h]);const y=e=>t.jsx("span",{style:{display:"inline-block",padding:`calc(${zs}/2) 0`},ref:t=>{p.current[e]=t},children:e},e);return t.jsx(U.span,{...n,ref:x,layout:"position","data-state":m?void 0:"exiting",style:{display:"inline-flex",justifyContent:"center",width:f},children:t.jsxs("span",{ref:d,style:{display:"inline-flex",justifyContent:"center",flexDirection:"column",alignItems:"center",position:"relative"},children:[0!==h&&t.jsx("span",{style:{...Ks,bottom:"100%",left:0},children:new Array(h).fill(null).map((e,t)=>y(t))}),y(h),9!==h&&t.jsx("span",{style:{...Ks,top:"100%",left:0},children:new Array(9-h).fill(null).map((e,t)=>y(h+t+1))})]})})}),Ks={display:"flex",flexDirection:"column",alignItems:"center",position:"absolute",width:"100%"},Ys=e.createContext({justify:"left"}),Js=e.forwardRef(function({partKey:s,type:a,children:n,layoutDependency:r,...i},l){const c=ae(),{justify:o}=e.useContext(Ys);return t.jsx(U.span,{...i,"data-state":c?void 0:"exiting",style:{display:"inline-flex",justifyContent:o,padding:`calc(${zs}/2) 0`,position:"relative"},layout:"position",layoutDependency:r,ref:l,children:t.jsx(Z,{mode:"popLayout",anchorX:o,initial:!1,children:t.jsx(U.span,{layout:"right"===o&&"position",layoutDependency:r,initial:{opacity:0},animate:{opacity:[null,1]},exit:{opacity:[null,0]},style:{display:"inline-block",whiteSpace:"pre"},children:n},n)})})}),Xs=e.forwardRef(function({parts:s,justify:a="left",mode:n,style:r,name:i,layoutDependency:l,...c},o){const d=e.useRef(null);e.useImperativeHandle(o,()=>d.current,[]);const x=e.useMemo(()=>({justify:a}),[a]),p=e.useRef(null),m=Ws(),[h,u]=e.useState();return e.useEffect(()=>{if(!p.current)return;if(m)return void(d.current&&(d.current.style.width=Qs(p.current)));const e=Array.from(p.current.children).map(e=>{if(!(e instanceof HTMLElement))return;if("exiting"===e.dataset.state){const t=e.nextSibling;return e.remove(),()=>{p.current&&p.current.insertBefore(e,t)}}const t=Gs.get(e);if(!t)return;const s=e.style.width;return e.style.width=t,()=>{e.style.width=s}});u(Qs(p.current));for(let t=e.length-1;t>=0;t--){const s=e[t];s&&s()}},[s.map(e=>e.value).join("")]),t.jsx(Ys.Provider,{value:x,children:t.jsx(U.span,{layoutDependency:l,...c,ref:d,className:`number-section-${i}`,style:{...r,display:"inline-flex",justifyContent:a,width:h},children:t.jsxs("span",{ref:p,style:{display:"inline-flex",justifyContent:"inherit",position:"relative"},children:["​",t.jsx(Z,{mode:n,anchorX:a,initial:!1,children:s.map(e=>"integer"===e.type||"fraction"===e.type?t.jsx(qs,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},value:e.value,initialValue:m?void 0:0,layoutDependency:l},e.key):t.jsx(Js,{type:e.type,partKey:e.key,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},layoutDependency:l,children:e.value},"literal"===e.type?`${e.key}:${e.value}`:e.key))})]})})})}),Zs={opacity:{duration:1,ease:ne},layout:{type:"spring",duration:1,bounce:0},y:{type:"spring",duration:1,bounce:0}},ea=e.forwardRef(function({children:s,locales:a,format:n,transition:r,style:i,suffix:l,prefix:o,...d},x){const p=e.useMemo(()=>((e,{locales:t,format:s},a,n)=>{const r=new Intl.NumberFormat(t,s).formatToParts(Number(e));a&&r.unshift({type:"prefix",value:a}),n&&r.push({type:"suffix",value:n});const i=[],l=[],c=[],o=[],d={},x=e=>`${e}:${d[e]=(d[e]??-1)+1}`;let p="",m=!1,h=!1;for(const f of r){p+=f.value;const e="minusSign"===f.type||"plusSign"===f.type?"sign":f.type;switch(e){case"integer":m=!0,l.push(...f.value.split("").map(t=>({type:e,value:parseInt(t)})));break;case"group":l.push({type:e,value:f.value});break;case"decimal":h=!0,c.push({type:e,value:f.value,key:x(e)});break;case"fraction":c.push(...f.value.split("").map(t=>({type:e,value:parseInt(t),key:x(e)})));break;default:(m||h?o:i).push({type:e,value:f.value,key:x(e)})}}const u=[];for(let f=l.length-1;f>=0;f--)u.unshift({...l[f],key:x(l[f].type)});return{pre:i,integer:u,fraction:c,post:o,formatted:p}})(s,{locales:a,format:n},o,l),[s,a,n]),{pre:m,integer:h,fraction:u,post:f,formatted:g}=p,y=e.useContext(c).transition;r=r??y??Zs;const{layoutDependency:j}=d,b=e.useMemo(()=>{if(void 0!==j)return{layoutDependency:j,value:s}},[j,s]);return t.jsx(I,{children:t.jsx(lt,{transition:r,children:t.jsx(U.div,{...d,ref:x,layout:!0,layoutDependency:b,style:{lineHeight:1,...i,display:"inline-flex",isolation:"isolate",whiteSpace:"nowrap"},children:t.jsxs(U.div,{layout:!0,layoutDependency:b,"aria-label":g,style:{display:"inline-flex",direction:"ltr",isolation:"isolate",position:"relative",zIndex:-1},children:[t.jsx(Xs,{style:{padding:`calc(${zs}/2) 0`},layoutDependency:b,"aria-hidden":!0,justify:"right",mode:"popLayout",parts:m,name:"pre"}),t.jsxs(Os,{layoutDependency:b,children:[t.jsx(Xs,{layoutDependency:b,justify:"right",parts:h,name:"integer"}),t.jsx(Xs,{layout:"position",layoutDependency:b,parts:u,name:"fraction"})]}),t.jsx(Xs,{style:{padding:`calc(${zs}/2) 0`},"aria-hidden":!0,layout:"position",layoutDependency:b,mode:"popLayout",parts:f,name:"post"})]})})})})});function ta(e,t){return e.length>t.length||e.length>0&&!t.startsWith(e)}function sa(e,t,s){return e+(t-e)*s}U.create(e.Fragment);const aa=new Set([".",",","!","?",":",";","'",'"',"-","(",")"]),na=new Set(["!","@","#","$","%","^","&","*","(",")","_","+","{","}","|",":",'"',"<",">","?"]);const ra={slow:130,normal:75,fast:30};e.forwardRef(function({children:s="",as:a,speed:n="normal",variance:r="natural",cursorClassName:i="motion-typewriter-cursor",cursorStyle:l,cursorBlinkDuration:x=.5,onComplete:p,play:m=!0,"aria-label":h,textClassName:u,textStyle:f,replace:g="type",backspace:y="character",backspaceFactor:j=.2,...b},v){const N=a||"span",w=e.useRef(s),k=function(){const t=o(()=>d("")),{isStatic:s}=e.useContext(c);if(s){const[,s]=e.useState("");e.useEffect(()=>t.on("change",s),[])}return t}(),C=e.useRef(null),S=e.useRef(null),M=e.useRef(null),P="number"==typeof n?n:ra[n],T=()=>{var e;null==(e=C.current)||e.call(C),C.current=null},H=()=>{S.current=St(M.current,{opacity:[1,1,0,0]},{duration:x,times:[0,.5,.5,1],ease:"linear",repeat:1/0,repeatType:"reverse"})};return e.useEffect(()=>{"all"===g&&s!==w.current&&k.set(""),w.current=s},[s,g]),e.useEffect(()=>{var e;if(!m)return H(),void T();null==(e=S.current)||e.cancel();const t=()=>{const e=function(e,t,s,a){if("type"===s&&ta(e,t)){if("all"===a)return t.slice(0,function(e,t){const s=Math.min(e.length,t.length);let a=0;for(let n=0;n<s&&e[n]===t[n];n++)a=n+1;return a}(e,t));if("word"===a){const t=function(e,t){let s=t-1;for(;s>=0&&/\s/.test(e[s]);)s--;for(;s>=0&&!/\s/.test(e[s]);)s--;return Math.max(0,s+1)}(e,e.length);return e.slice(0,t)}return e.slice(0,-1)}return t.slice(0,e.length+1)}(k.get(),s,g,y);k.set(e),e!==s?a():(H(),null==p||p())},a=()=>{C.current=re(t,function(e,t,s,a,n){if(ta(t,e))return s*n;if("natural"===a)return function(e,t,s){const a=t.length,n=e[a],r=e[a-1];if(!n)return s;const i=e.slice(0,a).lastIndexOf(" "),l=a-i-1,c=i+1,o=e.slice(a).indexOf(" "),d=(-1===o?e.length:a+o)-c;let x=1;r&&/[.!?]/.test(r)&&" "===n&&(x*=3),d<=3?x*=.7:(0===l&&" "!==n&&(x*=1.5),l===d-1&&(x*=1.4)),l>0&&l<d-1&&d>3&&(x*=1-Math.min(l/d,.4)),aa.has(n)&&(x*=1.5),na.has(n)&&(x*=1.5),/\d/.test(n)&&(x*=1.3),d>8&&(x*=1.3),n!==n.toLowerCase()&&(x*=1.25),a>200&&(x*=1+Math.min((a-200)/1e3,.3)),x*=1+sa(-.25,.25,Math.random());const p=s*x;return Math.max(.2*s,p)}(e,t,s);if("number"==typeof a&&a>0){const e=s*(a/100);return s+sa(-e,e,Math.random())}return s}(s,k.get(),P,r,j))};return C.current||a(),T},[m,p,s,P,r,j,y]),t.jsxs(N,{ref:v,...b,"aria-label":h||s,children:[t.jsx(U.span,{className:u,style:f,children:k}),t.jsx(U.span,{ref:M,className:i,style:{display:"inline-block",width:"2px",height:"1em",backgroundColor:"currentColor",position:"relative",top:"0.1em",left:"0.2em",...l}})]})});const ia={type:"spring",visualDuration:.6,bounce:.25,opacity:{duration:.2,ease:"linear"}};function la({value:s,format:a,prefix:n,className:r}){const[i,l]=e.useState("waiting");if(e.useEffect(()=>{const e=setTimeout(()=>{l("mounted")},400);return()=>clearTimeout(e)},[]),e.useEffect(()=>{if("mounted"===i){const e=requestAnimationFrame(()=>{l("animating")});return()=>cancelAnimationFrame(e)}},[i]),"waiting"===i){const e=(0).toLocaleString(void 0,a);return t.jsxs("span",{className:r,children:[n,e]})}return t.jsx(ea,{className:r,format:a,prefix:n,transition:ia,children:"animating"===i?s:0})}function ca({label:e,numericValue:s,unit:a,icon:n,subtext:r,showSign:i=!1}){return t.jsxs("div",{className:"rounded-lg p-3 sm:rounded-xl sm:p-4 bg-white/[0.03] ring-1 ring-inset ring-white/[0.06]",children:[t.jsx("div",{className:"mb-1.5 sm:mb-2",children:t.jsx("span",{className:"text-[10px] sm:text-[11px] font-medium uppercase tracking-wide text-text-muted",children:e})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(la,{value:s,format:{minimumFractionDigits:1,maximumFractionDigits:1,signDisplay:i?"always":"auto"},className:"font-mono text-xl sm:text-2xl font-semibold tabular-nums tracking-tight text-white"}),t.jsxs("div",{className:"flex flex-col items-center justify-center",children:[t.jsx(n,{className:"w-[14px] h-[14px] text-text-muted"}),a&&t.jsx("span",{className:"text-[10px] sm:text-xs font-medium leading-tight text-text-muted",children:a})]})]}),r&&t.jsx("p",{className:"mt-1.5 sm:mt-2 font-mono text-[10px] sm:text-[11px] text-text-muted/80 truncate",children:r})]})}function oa({snr:e}){const a=e>=5?"bg-sys-teal":e>=0?"bg-sys-green":e>=-5?"bg-sys-amber":e>=-10?"bg-sys-orange":"bg-sys-red";return t.jsx("span",{className:s("w-1.5 h-1.5 rounded-full flex-shrink-0",a),title:`SNR: ${e.toFixed(1)} dB`})}function da({fromPrefix:e,toPrefix:a,fromName:n,toName:r,snr:i,maxSnr:l,isWeakest:c,isStrongest:o,index:d=0}){const x=Math.max(l+5,15),p=Math.max(0,Math.min(100,(i- -20)/(x- -20)*100)),m="bg-[#0074BE]",h=i>=5?"bg-sys-teal":i>=0?"bg-sys-green":i>=-5?"bg-sys-amber":i>=-10?"bg-sys-orange":"bg-sys-red",u=.3+.15*d;return t.jsxs("div",{className:"relative p-3 pl-5 rounded-lg bg-white/[0.03] ring-1 ring-inset ring-white/[0.06]",children:[t.jsx("span",{className:s("absolute left-0 top-1/2 -translate-y-1/2 h-4 w-0.5 rounded-full",h)}),t.jsx("span",{className:"absolute -top-0.5 -right-0.5",children:t.jsx(oa,{snr:i})}),t.jsxs("div",{className:"sm:hidden",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[t.jsx("span",{className:"text-[13px] font-medium text-white/70 truncate",children:n||e}),t.jsx(Ge,{className:"w-3 h-3 text-white/30 flex-shrink-0"}),t.jsx("span",{className:"text-[13px] font-semibold text-white truncate",children:r||a})]}),t.jsxs("div",{className:"flex items-center gap-1.5 ml-2 flex-shrink-0",children:[c&&t.jsx(F,{color:"red",compact:!0,children:"Low"}),o&&!c&&t.jsxs(F,{color:"amber",compact:!0,children:[t.jsx(et,{className:"w-2.5 h-2.5"}),"Best"]}),t.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[12px] font-mono font-bold tabular-nums bg-white/[0.06] text-text-primary ring-1 ring-inset ring-white/[0.1]",children:[i>=0?"+":"−",Math.abs(i).toFixed(1)]})]})]}),t.jsx("div",{className:"h-1.5 bg-white/10 rounded-full overflow-hidden",children:t.jsx(U.div,{className:s("h-full rounded-full",m),initial:{width:0},animate:{width:`${p}%`},transition:{duration:1.5,delay:u,ease:[.25,.1,.25,1]}})})]}),t.jsxs("div",{className:"hidden sm:block",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[t.jsx("code",{className:"font-mono text-xs text-text-muted",children:e}),n&&t.jsx("span",{className:"text-xs text-text-secondary truncate max-w-[100px]",children:n})]}),t.jsx(Ge,{className:"w-3 h-3 text-text-muted/40 flex-shrink-0"}),t.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[t.jsx("code",{className:"font-mono text-xs font-semibold text-text-primary",children:a}),r&&t.jsx("span",{className:"text-xs text-text-secondary truncate max-w-[100px]",children:r})]})]}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[c&&t.jsx(F,{color:"red",compact:!0,children:"Bottleneck"}),o&&!c&&t.jsxs(F,{color:"amber",compact:!0,children:[t.jsx(et,{className:"w-3 h-3"}),"Strongest"]}),t.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-sm font-mono font-semibold tabular-nums bg-white/[0.06] text-text-primary ring-1 ring-inset ring-white/[0.1]",children:[i>=0?"+":"−",Math.abs(i).toFixed(1)]})]})]}),t.jsx("div",{className:"h-1.5 bg-bg-elevated rounded-full overflow-hidden",children:t.jsx(U.div,{className:s("h-full rounded-full",m),initial:{width:0},animate:{width:`${p}%`},transition:{duration:1.5,delay:u,ease:[.25,.1,.25,1]}})})]})]})}function xa(e,t){if("You"===e)return"You";const s=e.toUpperCase();for(const[a,n]of Object.entries(t))if((a.startsWith("0x")?a.slice(2,4):a.slice(0,2)).toUpperCase()===s)return n.name||n.node_name||void 0}const pa=e.memo(function({report:e,onClose:s}){var a,n;const r=G(),i=(null==r?void 0:r.neighbors)??{},l=(null==(a=null==r?void 0:r.config)?void 0:a.repeater)?{latitude:r.config.repeater.latitude,longitude:r.config.repeater.longitude,name:r.config.node_name||"Local Node"}:void 0,c=null==(n=e.bestObservation)?void 0:n.decoded.snrValues,o=e.linkQuality?e.linkQuality.avgSnr>=5?"excellent":e.linkQuality.avgSnr>=0?"good":e.linkQuality.avgSnr>=-5?"fair":"poor":"unknown",d={excellent:"var(--signal-excellent)",good:"var(--signal-good)",fair:"var(--signal-fair)",poor:"var(--signal-poor)",unknown:"var(--text-muted)"}[o];return t.jsxs(J,{open:!0,onClose:s,size:"5xl",motionPlus:!0,children:[t.jsxs("div",{className:"sm:hidden",children:[t.jsx("div",{className:"flex justify-center pt-2 pb-1",children:t.jsx("div",{className:"w-9 h-1 rounded-full bg-white/30","aria-hidden":"true"})}),t.jsxs("div",{className:"flex items-center justify-between px-4 pb-2",children:[t.jsx("h2",{className:"font-semibold text-[17px] text-white",children:"Trace Report"}),t.jsx("button",{onClick:s,className:"text-[17px] font-medium text-blue-400 active:text-blue-300",children:"Done"})]})]}),t.jsx("div",{className:"sm:hidden h-[2px]",style:{backgroundColor:d,opacity:.6}}),t.jsx("div",{className:"hidden sm:block px-6 pt-5 pb-4",children:t.jsxs("div",{className:"flex items-start justify-between gap-3",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[t.jsx("h2",{className:"text-base sm:text-lg font-semibold text-text-primary",children:"Trace Report"}),t.jsxs(F,{color:"excellent"===o||"good"===o?"green":"fair"===o?"amber":"red",children:[t.jsx(Ze,{className:"w-3 h-3 mr-1"}),"excellent"===o?"Excellent":"good"===o?"Good":"fair"===o?"Fair":"Poor"]})]}),t.jsx("p",{className:"mt-1 text-xs sm:text-sm font-mono text-text-muted tabular-nums",children:e.traceTag})]}),t.jsx("button",{onClick:s,className:"p-1.5 -m-1.5 text-text-muted hover:text-text-primary transition-colors rounded-lg hover:bg-bg-elevated flex-shrink-0",children:t.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})}),t.jsxs("div",{className:"hidden sm:flex flex-wrap items-center gap-1.5 sm:gap-2 px-4 sm:px-6 pb-3 sm:pb-4 border-b border-border-subtle",children:[t.jsxs(F,{color:"teal",children:[t.jsx("span",{className:"font-mono tabular-nums",children:e.targetHopCount}),t.jsxs("span",{className:"ml-1",children:["hop",1!==e.targetHopCount?"s":""]})]}),t.jsxs(F,{color:"zinc",children:[t.jsx("span",{className:"font-mono tabular-nums",children:e.observationCount}),t.jsx("span",{className:"ml-1",children:"obs"})]}),e.linkQuality&&t.jsxs(F,{color:"purple",children:[t.jsx("span",{className:"font-mono tabular-nums",children:e.linkQuality.avgSnr.toFixed(1)}),t.jsx("span",{className:"ml-1",children:"dB avg"})]}),t.jsx("span",{className:"font-mono text-xs text-text-muted tabular-nums",children:ie(e.duration)}),e.linkQuality&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-text-muted/40",children:"•"}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-medium bg-sys-red/15 text-sys-red ring-1 ring-inset ring-sys-red/25",children:[t.jsx("span",{className:"opacity-70",children:"Min"}),t.jsx("span",{className:"font-mono tabular-nums",children:e.linkQuality.minSnr.toFixed(1)})]}),t.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-medium bg-sys-teal/15 text-sys-teal ring-1 ring-inset ring-sys-teal/25",children:[t.jsx("span",{className:"opacity-70",children:"Max"}),t.jsx("span",{className:"font-mono tabular-nums",children:e.linkQuality.maxSnr.toFixed(1)})]})]})]})]}),t.jsxs(X,{className:"p-0 overflow-hidden",children:[t.jsx("div",{className:"md:hidden h-[75vh] max-h-[calc(100vh-80px)] overflow-y-auto overflow-x-hidden",children:t.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.linkQuality&&t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsxs("div",{className:"rounded-lg bg-white/[0.03] ring-1 ring-inset ring-white/[0.06] p-2.5 text-center",children:[t.jsx(la,{value:Math.abs(e.linkQuality.minSnr),format:{maximumFractionDigits:0,signDisplay:"never"},prefix:e.linkQuality.minSnr<0?"-":"",className:"text-[20px] font-bold font-mono tabular-nums flex items-center justify-center text-white"}),t.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[t.jsx(Le,{className:"w-2.5 h-2.5 text-text-muted"}),t.jsx("span",{className:"text-[10px] text-white/40",children:"Min dB"})]})]}),t.jsxs("div",{className:"rounded-lg bg-white/[0.03] ring-1 ring-inset ring-white/[0.06] p-2.5 text-center",children:[t.jsx(la,{value:e.linkQuality.maxSnr,format:{maximumFractionDigits:0,signDisplay:"always"},className:"text-[20px] font-bold font-mono text-white tabular-nums flex items-center justify-center"}),t.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[t.jsx(De,{className:"w-2.5 h-2.5 text-text-muted"}),t.jsx("span",{className:"text-[10px] text-white/40",children:"Max dB"})]})]})]}),t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t.jsxs(F,{color:"excellent"===o||"good"===o?"green":"fair"===o?"amber":"red",compact:!0,children:[t.jsx(Ze,{className:"w-2.5 h-2.5 mr-0.5"}),"excellent"===o?"Excellent":"good"===o?"Good":"fair"===o?"Fair":"Poor"]}),t.jsxs(F,{color:"teal",compact:!0,children:[e.targetHopCount," hops"]}),t.jsxs(F,{color:"zinc",compact:!0,children:[e.observationCount," obs"]}),t.jsx("span",{className:"text-[10px] font-mono text-white/30 ml-auto",children:e.traceTag.slice(0,8)})]}),e.targetPath.length>0&&t.jsx("div",{className:"overflow-hidden rounded-xl",children:t.jsx("div",{className:"aspect-[4/3] w-full",children:t.jsx(ts,{path:e.targetPath,neighbors:i,localNode:l,localHash:null==r?void 0:r.local_hash,srcHash:e.srcHash,dstHash:e.dstHash,traceSnr:c})})}),t.jsxs("div",{className:"rounded-xl bg-black overflow-hidden",children:[t.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-white/5",children:[t.jsx("span",{className:"text-[11px] font-medium text-white/60",children:"Route Path"}),e.linkQuality&&t.jsxs("span",{className:"text-[10px] font-mono text-white/40",children:["SNR ",e.linkQuality.minSnr.toFixed(1)," → ",e.linkQuality.maxSnr.toFixed(1)," dB"]})]}),e.bestObservation?t.jsx(Bs,{packet:e.bestObservation.packet,neighbors:i,localHash:null==r?void 0:r.local_hash,direction:"flowchart",compact:!0,overridePath:e.targetPath,traceSnr:e.bestObservation.decoded.snrValues}):t.jsx("div",{className:"p-6 text-center text-text-muted text-[11px]",children:"No path data available"})]}),t.jsxs("div",{children:[t.jsxs("h3",{className:"text-[11px] font-medium uppercase tracking-wide text-white/40 mb-2",children:["Link Quality · ",e.hopStats.length," hops"]}),t.jsx("div",{className:"space-y-1.5",children:e.hopStats.length>0?e.hopStats.map((s,a)=>{var n,r,l;const c=a<e.targetPath.length-1?e.targetPath[a+1]:"You",o=xa(s.prefix,i),d=xa(c,i);return t.jsx(da,{fromPrefix:s.prefix,toPrefix:c,fromName:o,toName:d,snr:s.snr,maxSnr:(null==(n=e.linkQuality)?void 0:n.maxSnr)??10,isWeakest:(null==(r=e.linkQuality)?void 0:r.weakestLinkPosition)===a,isStrongest:(null==(l=e.linkQuality)?void 0:l.strongestLinkPosition)===a,index:a},`${s.prefix}-${a}`)}):t.jsx("div",{className:"text-[11px] text-text-muted py-6 text-center",children:"No link data collected"})})]}),t.jsx("div",{className:"pt-1 pb-2 text-center",children:t.jsxs("span",{className:"text-[10px] text-white/30",children:["Traced ",le(e.firstSeen)]})})]})}),t.jsxs("div",{className:"hidden md:flex md:flex-row h-[70vh] max-h-[calc(100vh-200px)] overflow-hidden",children:[t.jsx("div",{className:"w-1/2 flex flex-col min-w-0 min-h-0 overflow-hidden border-r border-border-subtle",children:t.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.linkQuality&&(()=>{const s=e.targetPath[e.linkQuality.weakestLinkPosition],a=e.targetPath[e.linkQuality.weakestLinkPosition+1]||"You",n=xa(s,i),r=xa(a,i),l=e.targetPath[e.linkQuality.strongestLinkPosition],c=e.targetPath[e.linkQuality.strongestLinkPosition+1]||"You",o=xa(l,i),d=xa(c,i);return t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx(ca,{label:"Weakest Link",numericValue:e.linkQuality.minSnr,unit:"dB",icon:Le,subtext:`${n||s} → ${r||a}`}),t.jsx(ca,{label:"Best Link",numericValue:e.linkQuality.maxSnr,showSign:!0,unit:"dB",icon:De,subtext:`${o||l} → ${d||c}`})]})})(),t.jsxs("div",{children:[t.jsx("h3",{className:"text-[11px] font-medium uppercase tracking-wide text-text-muted mb-3",children:"Link Details"}),t.jsx("div",{className:"space-y-2",children:e.hopStats.length>0?e.hopStats.map((s,a)=>{var n,r,l;const c=a<e.targetPath.length-1?e.targetPath[a+1]:"You",o=xa(s.prefix,i),d=xa(c,i);return t.jsx(da,{fromPrefix:s.prefix,toPrefix:c,fromName:o,toName:d,snr:s.snr,maxSnr:(null==(n=e.linkQuality)?void 0:n.maxSnr)??10,isWeakest:(null==(r=e.linkQuality)?void 0:r.weakestLinkPosition)===a,isStrongest:(null==(l=e.linkQuality)?void 0:l.strongestLinkPosition)===a,index:a},`${s.prefix}-${a}`)}):t.jsx("div",{className:"text-xs text-text-muted py-8 text-center",children:"No link data collected"})})]}),t.jsxs("div",{className:"pt-2 text-center",children:[t.jsx("span",{className:"text-[10px] text-text-muted",children:"Traced "}),t.jsx("span",{className:"font-mono text-[10px] text-text-muted tabular-nums",children:le(e.firstSeen)})]})]})}),t.jsxs("div",{className:"w-1/2 min-w-0 overflow-y-auto p-3 space-y-2",children:[e.targetPath.length>0&&t.jsx("div",{className:"overflow-hidden",children:t.jsx("div",{className:"aspect-square w-full",children:t.jsx(ts,{path:e.targetPath,neighbors:i,localNode:l,localHash:null==r?void 0:r.local_hash,srcHash:e.srcHash,dstHash:e.dstHash,traceSnr:c})})}),t.jsxs("div",{className:"rounded-xl bg-black overflow-hidden",children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[t.jsx("span",{className:"text-xs font-medium text-text-muted uppercase tracking-wide",children:"Trace Route"}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(F,{color:e.isComplete?"green":"amber",compact:!0,children:e.isComplete?"Complete":`${e.maxHopsObserved}/${e.targetHopCount}`}),t.jsxs(F,{color:"teal",compact:!0,children:[e.targetHopCount," hop",1!==e.targetHopCount?"s":""]})]})]}),e.linkQuality&&e.bestObservation&&t.jsxs("div",{className:"flex items-center gap-4 px-4 pb-2 font-mono text-[10px] text-text-muted",children:[t.jsxs("span",{children:[t.jsx("span",{className:"opacity-60",children:"Tag"})," ",t.jsx("code",{className:"text-teal-400 tabular-nums",children:e.traceTag.slice(0,8)})]}),t.jsxs("span",{children:[t.jsx("span",{className:"opacity-60",children:"SNR"})," ",t.jsxs("code",{className:"text-accent-secondary tabular-nums",children:[e.linkQuality.minSnr.toFixed(1),"–",e.linkQuality.maxSnr.toFixed(1)]}),t.jsx("span",{className:"opacity-60",children:" dB"})]})]}),e.bestObservation?t.jsx(Bs,{packet:e.bestObservation.packet,neighbors:i,localHash:null==r?void 0:r.local_hash,direction:"flowchart",compact:!0,overridePath:e.targetPath,traceSnr:e.bestObservation.decoded.snrValues}):t.jsx("div",{className:"p-8 text-center text-text-muted text-xs",children:"No path data available"})]})]})]})]})]})});function ma({message:e}){return t.jsxs("div",{className:"flex flex-col items-center justify-center py-14 text-center",children:[t.jsx(W,{className:"size-6 text-text-muted mb-2"}),t.jsx("p",{className:"text-sm text-text-primary",children:e}),t.jsx("p",{className:"text-xs text-text-muted",children:"Packets will appear here"})]})}function ha(){return t.jsx("div",{className:"py-14 text-center text-sm text-text-muted",children:"Loading packets…"})}function ua({showPagination:e,currentPage:s,perPage:a,displayCount:n,totalCount:r,action:i}){const l=e?(s-1)*a+1:1,c=e?Math.min(s*a,r):n;return t.jsxs("div",{className:"flex items-center justify-between gap-4 border-t border-white/5 px-4 py-3 text-xs text-text-muted sm:px-6",children:[t.jsxs("span",{children:["Showing"," ",t.jsx("span",{className:"font-medium text-text-secondary",children:e?`${l}–${c}`:n})," ","of"," ",t.jsx("span",{className:"font-medium text-text-secondary",children:r})," ","packets"]}),i]})}function fa({packets:a,allPackets:n,localHash:r,neighbors:i,loading:l=!1,maxPackets:c,perPage:o=50,showPagination:d=!1,onPacketSelect:x,flashNewest:p=!1,emptyMessage:m="No packets found",className:h,footerAction:u}){const[f,g]=e.useState(null),[y,j]=e.useState(null),[b,v]=e.useState({traceTag:null,dupeGroup:null});e.useLayoutEffect(()=>{v({traceTag:null,dupeGroup:null})},[a]);const N=n??a,w=e.useMemo(()=>c&&c>0?a.slice(0,c):a,[a,c]),{currentPage:k,totalPages:C,goToPage:S,pageRange:M}=function(t,s,a){const[n,r]=e.useState(1),i=a?Math.ceil(t/s):1;e.useEffect(()=>{n>i&&i>0&&queueMicrotask(()=>r(1))},[i,n]);const l=e.useCallback(e=>r(Math.max(1,Math.min(e,i))),[i]),c=e.useMemo(()=>function(e,t,s=1){if(t<=7)return Array.from({length:t},(e,t)=>t+1);const a=Math.max(e-s,1),n=Math.min(e+s,t),r=a>2,i=n<t-1;if(!r&&i){const e=3+2*s;return[...Array.from({length:e},(e,t)=>t+1),"gap",t]}if(r&&!i){const e=3+2*s;return[1,"gap",...Array.from({length:e},(s,a)=>t-e+a+1)]}return[1,"gap",...Array.from({length:n-a+1},(e,t)=>a+t),"gap",t]}(n,i),[n,i]);return{currentPage:n,totalPages:i,goToPage:l,pageRange:c}}(w.length,o,d),P=e.useMemo(()=>{if(!d)return w;const e=(k-1)*o;return w.slice(e,e+o)},[w,d,k,o]),T=e.useMemo(()=>function(e){const t=new Map;for(const s of e)if((s.payload_type??s.type)===ce.TRACE&&s.payload&&s.packet_hash){const e=Dt(s.payload);e&&t.set(s.packet_hash,e)}return t}(P),[P]),H=e.useMemo(()=>function(e){const t=new Map;if(0===e.length)return t;for(let s=0;s<e.length;s++){const a=e[s].packet_hash;if(!a)continue;const n=e[s-1],r=e[s+1],i=(null==n?void 0:n.packet_hash)===a,l=(null==r?void 0:r.packet_hash)===a;(i||l)&&(i&&l?t.set(s,"middle"):i?t.set(s,"last"):l&&t.set(s,"first"))}return t}(P),[P]),_=function(t,s){const[a,n]=e.useState(null),r=e.useRef(0);return e.useEffect(()=>{var e,a;if(!s||!t.length)return;const i=(null==(e=t[0])?void 0:e.timestamp)??0,l=i>r.current&&r.current>0;if(r.current=i,!l)return;const c=null==(a=t[0])?void 0:a.packet_hash;if(!c)return;const o=requestAnimationFrame(()=>n(c)),d=setTimeout(()=>n(null),600);return()=>{cancelAnimationFrame(o),clearTimeout(d)}},[t,s]),a}(a,p),B=e.useCallback((e,t)=>{var s,a;const n=e.packet_hash;if(!n)return[e];let r=t;for(;r>0&&(null==(s=P[r-1])?void 0:s.packet_hash)===n;)r--;let i=t;for(;i<P.length-1&&(null==(a=P[i+1])?void 0:a.packet_hash)===n;)i++;return r===i?[e]:P.slice(r,i+1)},[P]),F=e.useCallback(e=>{var t,s;const a=null==(t=P[e])?void 0:t.packet_hash;if(!a)return e;let n=e;for(;n>0&&(null==(s=P[n-1])?void 0:s.packet_hash)===a;)n--;return n},[P]),A=e.useCallback(e=>{var t,s;const a=null==(t=P[e])?void 0:t.packet_hash;if(!a)return e;let n=e;for(;n<P.length-1&&(null==(s=P[n+1])?void 0:s.packet_hash)===a;)n++;return n},[P]),D=e.useCallback((e,t)=>{if(x)x(e);else if(void 0!==t){const s=B(e,t),a=s.indexOf(e);g({packets:s,initialIndex:a>=0?a:0,rowIndex:t})}else g({packets:[e],initialIndex:0,rowIndex:0})},[x,B]),L=e.useCallback(()=>{if(!f)return;const e=F(f.rowIndex)-1;if(e<0)return;const t=P[e];if(!t)return;const s=B(t,e);g({packets:s,initialIndex:0,rowIndex:e})},[f,P,F,B]),$=e.useCallback(()=>{if(!f)return;const e=A(f.rowIndex)+1;if(e>=P.length)return;const t=P[e];if(!t)return;const s=B(t,e);g({packets:s,initialIndex:0,rowIndex:e})},[f,P,A,B]),z=e.useMemo(()=>!!f&&F(f.rowIndex)>0,[f,F]),R=e.useMemo(()=>!!f&&A(f.rowIndex)<P.length-1,[f,A,P.length]),E=e.useCallback(e=>v(t=>({...t,traceTag:e})),[]),I=e.useCallback(e=>v(t=>({...t,dupeGroup:e})),[]),U=e.useCallback(()=>{v({traceTag:null,dupeGroup:null})},[]),V=e.useCallback(e=>{const t=N.filter(t=>(t.payload_type??t.type)===ce.TRACE&&t.payload&&Dt(t.payload)===e);if(0===t.length)return;const s=function(e){const t=new Map;for(const s of e){const e=$t(s);if(!e)continue;const a=e.decoded.traceTag,n=t.get(a)||[];n.push(e),t.set(a,n)}for(const[s,a]of t)a.sort((e,t)=>e.timestamp-t.timestamp),t.set(s,a);return t}(t),a=s.get(e);(null==a?void 0:a.length)&&j(function(e,t){if(0===t.length)return{traceTag:e,traceTagValue:0,targetPath:[],targetHopCount:0,observations:[],observationCount:0,firstSeen:0,lastSeen:0,duration:0,isComplete:!1,maxHopsObserved:0,progressPercent:0,bestObservation:null,hopStats:[],linkQuality:null};const s=[...t].sort((e,t)=>e.timestamp-t.timestamp),a=s.reduce((e,t)=>t.hopCount>e.hopCount?t:e,s[0]),n=s[0].timestamp,r=s[s.length-1].timestamp,i=a.decoded.pathHashes,l=i.length,c=a.hopCount,o=a.decoded.isComplete,d=[],x=a.decoded.snrValues;for(let m=0;m<x.length&&m<i.length;m++)d.push({prefix:i[m],snr:x[m],position:m,quality:Lt(x[m])});let p=null;if(x.length>0){const e=Math.min(...x),t=Math.max(...x);p={minSnr:e,maxSnr:t,avgSnr:x.reduce((e,t)=>e+t,0)/x.length,weakestLinkPosition:x.indexOf(e),strongestLinkPosition:x.indexOf(t)}}return{traceTag:e,traceTagValue:a.decoded.traceTagValue,targetPath:i,targetHopCount:l,observations:s,observationCount:s.length,firstSeen:n,lastSeen:r,duration:r-n,isComplete:o,maxHopsObserved:c,progressPercent:l>0?Math.round(c/l*100):0,bestObservation:a,hopStats:d,linkQuality:p,srcHash:a.packet.src_hash,dstHash:a.packet.dst_hash}}(e,a))},[N]),O=e.useCallback(e=>{const t=N.find(t=>t.packet_hash===e);t&&(j(null),D(t))},[N,D]),W=e=>{if(l&&0===a.length)return t.jsx(ha,{});if(0===P.length)return t.jsx(ma,{message:m});const s=e?Kt:qt;return P.map((e,a)=>{const n=e.packet_hash?T.get(e.packet_hash):void 0,l=null!==b.traceTag&&n===b.traceTag,c=H.get(a),o=void 0!==c&&null!==b.dupeGroup&&e.packet_hash===b.dupeGroup;return t.jsx(s,{packet:e,onClick:e=>D(e,a),localHash:r,neighbors:i,isFlashing:p&&_===e.packet_hash,traceTag:n,isTraceHighlighted:l,onTraceHover:E,onViewTraceReport:V,dupeGroupPosition:c,isDupeGroupHovered:o,onDupeGroupHover:I},`${e.packet_hash}_${e.timestamp}_${a}`)})};return t.jsxs("div",{className:s("flex flex-col",h),onMouseLeave:U,children:[t.jsx("div",{className:"hidden divide-y divide-white/5 py-1 sm:block",children:W(!1)}),t.jsx("div",{className:"divide-y divide-white/5 sm:hidden",children:W(!0)}),d&&C>1&&t.jsx("nav",{className:"border-t border-white/5 px-4 py-3",children:t.jsxs(Tt,{className:"justify-center",children:[t.jsx(Ht,{onClick:()=>S(k-1),disabled:1===k}),t.jsx(Bt,{children:M.map((e,s)=>"gap"===e?t.jsx(At,{},`gap-${s}`):t.jsx(Ft,{page:e,current:e===k,onClick:S},e))}),t.jsx(_t,{onClick:()=>S(k+1),disabled:k===C})]})}),t.jsx(ua,{showPagination:d,currentPage:k,perPage:o,displayCount:P.length,totalCount:d?w.length:a.length,action:u}),!x&&f&&t.jsx($s,{packets:f.packets,initialIndex:f.initialIndex,onClose:()=>g(null),onNavigatePrev:L,onNavigateNext:$,hasPrev:z,hasNext:R}),y&&t.jsx(pa,{report:y,onClose:()=>j(null),onViewPacket:O})]})}export{Ge as A,fa as P,Ze as S,et as T,It as g,Pt as u};
