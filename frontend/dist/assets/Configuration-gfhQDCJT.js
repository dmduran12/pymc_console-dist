import{r as e,j as s,c as t}from"./vendor-react-j_fHog8x.js";import{c as a,L as l,o as n,a5 as r,Y as i,bY as o,cI as c,cJ as d,T as u,cK as m,b2 as x,aH as h,n as p,cL as y,cM as f,cN as g,cO as b,R as j,B as v,cP as N,I as w}from"./index-DzT87dqT.js";import{g as k,a as C,c as S,r as _,s as F,b as T,u as E,d as P}from"./system-OLJbN7m4.js";import{T as M,P as z,C as R}from"./ConfirmModal-BZI_LDda.js";import{l as D}from"./font-loader-BQzEmDrZ.js";import{M as I,S as L}from"./sun-DOVLea2x.js";import{N as A}from"./NodeInformationCard-7wd052X-.js";import{i as K,g as V,s as H,a as O,k as q}from"./keycap-sfx-CAsrNe23.js";import{a as $,P as B,b as X,B as J}from"./PageLayout-Dted0yrz.js";import{C as U}from"./Card-DNQqPhxP.js";import{R as W,C as Y}from"./Grid-OFJ4oe0a.js";import{K as G}from"./key-round-oBo6-vtO.js";import{C as Q}from"./circle-check-e3DdWv13.js";import{T as Z}from"./triangle-alert-DzB1o5NG.js";import{R as ee}from"./refresh-cw-CUN5tsNX.js";import{C as se}from"./copy-C2dzCTLR.js";import{C as te}from"./chevron-right-Bua35Hjj.js";import"./maplibre-gl-b91ci4Kr.js";import"./vendor-core-CmkNwW1A.js";import"./DataBox-Drcffsdn.js";const ae=a("antenna",[["path",{d:"M2 12 7 2",key:"117k30"}],["path",{d:"m7 12 5-10",key:"1tvx22"}],["path",{d:"m12 12 5-10",key:"ev1o1a"}],["path",{d:"m17 12 5-10",key:"1e4ti3"}],["path",{d:"M4.5 7h15",key:"vlsxkz"}],["path",{d:"M12 16v6",key:"c8a4gj"}]]),le=a("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),ne=a("folder-key",[["circle",{cx:"16",cy:"20",r:"2",key:"1vifvg"}],["path",{d:"M10 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v2",key:"3hgo9p"}],["path",{d:"m22 14-4.5 4.5",key:"1ef6z8"}],["path",{d:"m21 15 1 1",key:"1ejcpy"}]]),re=a("folder-lock",[["rect",{width:"8",height:"5",x:"14",y:"17",rx:"1",key:"19aais"}],["path",{d:"M10 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v2.5",key:"1w6v7t"}],["path",{d:"M20 17v-2a2 2 0 1 0-4 0v2",key:"pwaxnr"}]]),ie=a("monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),oe=a("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),ce=a("triangle-dashed",[["path",{d:"M10.17 4.193a2 2 0 0 1 3.666.013",key:"pltmmw"}],["path",{d:"M14 21h2",key:"v4qezv"}],["path",{d:"m15.874 7.743 1 1.732",key:"10m0iw"}],["path",{d:"m18.849 12.952 1 1.732",key:"zadnam"}],["path",{d:"M21.824 18.18a2 2 0 0 1-1.835 2.824",key:"fvwuk4"}],["path",{d:"M4.024 21a2 2 0 0 1-1.839-2.839",key:"1e1kah"}],["path",{d:"m5.136 12.952-1 1.732",key:"1u4ldi"}],["path",{d:"M8 21h2",key:"i9zjee"}],["path",{d:"m8.102 7.743-1 1.732",key:"1zzo4u"}]]),de=1500,ue="h-[38px]",me="h-[32px]",xe="px-3",he="px-2.5",pe="rounded-lg";function ye({label:a,value:i,editValue:o,onSave:c,type:d="text",suffix:u,placeholder:m,readOnly:x=!1,layout:h="stacked",min:p,max:y,step:f,maxLength:g,description:b,className:j}){const[v,N]=e.useState(!1),[w,k]=e.useState(""),[C,S]=e.useState("idle"),_=e.useRef(null),F=e.useRef(!0),T=e.useRef(null),E=!x&&!!c;e.useEffect(()=>(F.current=!0,()=>{F.current=!1,T.current&&clearTimeout(T.current)}),[]);const P=e.useCallback(()=>{E&&(k(o??i),N(!0),S("idle"),requestAnimationFrame(()=>{var e;return null==(e=_.current)?void 0:e.select()}))},[E,o,i]),M=e.useCallback(()=>{N(!1),k(""),S("idle")},[]),z=e.useCallback(async()=>{if(c&&"loading"!==C)if(w!==(o??i)){T.current&&clearTimeout(T.current),S("loading");try{if(await c(w),!F.current)return;S("success"),N(!1),T.current=setTimeout(()=>{F.current&&S("idle")},de)}catch{if(!F.current)return;S("error"),T.current=setTimeout(()=>{F.current&&S("idle")},de)}}else M()},[c,w,o,i,M,C]),R=e.useCallback(e=>{"Enter"===e.key?(e.preventDefault(),z()):"Escape"===e.key&&(e.preventDefault(),M())},[z,M]);return"inline"===h?s.jsxs("div",{className:t("group flex items-center justify-between gap-3",j),children:[s.jsx("label",{className:"type-label text-fg-muted truncate",children:a}),v?s.jsxs("div",{className:t(me,pe,he,"flex items-center transition-all","bg-transparent border border-sys-blue/50 ring-1 ring-sys-blue/20","min-w-[100px]"),children:[s.jsx("input",{ref:_,type:d,value:w,onChange:e=>k(e.target.value),onKeyDown:R,placeholder:m,min:p,max:y,step:f,maxLength:g,disabled:"loading"===C,className:t("bg-transparent text-fg-primary focus:outline-none type-data flex-1 min-w-0",u?"w-12 text-right":"w-full")}),u&&s.jsx("span",{className:"text-fg-muted type-data ml-1 shrink-0",children:u}),s.jsx("div",{className:"flex items-center gap-0.5 ml-2 shrink-0",children:"loading"===C?s.jsx(l,{className:"w-3.5 h-3.5 text-fg-muted animate-spin"}):s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:z,className:"p-0.5 rounded hover:bg-sys-green/15 text-sys-green transition-colors",title:"Save (Enter)",children:s.jsx(n,{className:"w-3 h-3"})}),s.jsx("button",{onClick:M,className:"p-0.5 rounded hover:bg-sys-red/15 text-fg-muted hover:text-sys-red transition-colors",title:"Cancel (Esc)",children:s.jsx(r,{className:"w-3 h-3"})})]})})]}):s.jsxs("div",{className:t(me,pe,he,"flex items-center justify-end transition-all min-w-[80px]","bg-input-bg border border-input-border",E&&"cursor-pointer hover:border-edge-strong"),onClick:E?P:void 0,children:[s.jsx("span",{className:"type-data text-fg-primary",children:i}),"success"===C&&s.jsx(n,{className:"w-3 h-3 text-sys-green ml-1.5 shrink-0"}),"error"===C&&s.jsx(r,{className:"w-3 h-3 text-sys-red ml-1.5 shrink-0"}),"idle"===C&&E&&s.jsx(oe,{className:"w-3 h-3 text-fg-muted ml-1.5 opacity-0 group-hover:opacity-100 transition-opacity shrink-0"})]})]}):s.jsxs("div",{className:t("group",j),children:[s.jsx("label",{className:"type-label text-fg-muted block mb-1",children:a}),v?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:t(ue,pe,xe,"flex items-center transition-all","bg-transparent border border-sys-blue/50 ring-1 ring-sys-blue/20"),children:[s.jsx("input",{ref:_,type:d,value:w,onChange:e=>k(e.target.value),onKeyDown:R,placeholder:m,min:p,max:y,step:f,maxLength:g,disabled:"loading"===C,className:"w-full bg-transparent text-fg-primary focus:outline-none type-data flex-1 min-w-0"}),u&&s.jsx("span",{className:"text-fg-muted type-data ml-1 shrink-0",children:u}),s.jsx("div",{className:"flex items-center gap-0.5 ml-2 shrink-0",children:"loading"===C?s.jsx(l,{className:"w-3.5 h-3.5 text-fg-muted animate-spin"}):s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:z,className:"p-1 rounded hover:bg-sys-green/15 text-sys-green transition-colors",title:"Save (Enter)",children:s.jsx(n,{className:"w-3.5 h-3.5"})}),s.jsx("button",{onClick:M,className:"p-1 rounded hover:bg-sys-red/15 text-fg-muted hover:text-sys-red transition-colors",title:"Cancel (Esc)",children:s.jsx(r,{className:"w-3.5 h-3.5"})})]})})]}),b&&s.jsx("p",{className:"type-data-xs text-fg-muted mt-1 ml-3",children:b})]}):s.jsxs("div",{className:t(ue,pe,xe,"flex items-center transition-all","bg-input-bg border border-input-border",E&&"cursor-pointer hover:border-edge-strong"),onClick:E?P:void 0,children:[s.jsx("span",{className:"type-data text-fg-primary flex-1 whitespace-nowrap",children:i}),"success"===C&&s.jsx(n,{className:"w-3.5 h-3.5 text-sys-green shrink-0"}),"error"===C&&s.jsx(r,{className:"w-3.5 h-3.5 text-sys-red shrink-0"}),"idle"===C&&E&&s.jsx(oe,{className:"w-3.5 h-3.5 text-fg-muted opacity-0 group-hover:opacity-100 transition-opacity shrink-0"})]})]})}function fe({label:a,value:o,editValue:c,options:d,onSave:u,readOnly:m=!1,layout:x="stacked",className:h}){const[p,y]=e.useState(!1),[f,g]=e.useState(""),[b,j]=e.useState("idle"),v=e.useRef(null),N=e.useRef(!0),w=e.useRef(null),k=!m&&!!u;e.useEffect(()=>(N.current=!0,()=>{N.current=!1,w.current&&clearTimeout(w.current)}),[]);const C=e.useCallback(()=>{k&&(g(String(c)),y(!0),j("idle"),requestAnimationFrame(()=>{var e;return null==(e=v.current)?void 0:e.focus()}))},[k,c]),S=e.useCallback(()=>{y(!1),g(""),j("idle")},[]),_=e.useCallback(async()=>{if(u&&"loading"!==b)if(f!==String(c)){w.current&&clearTimeout(w.current),j("loading");try{if(await u(f),!N.current)return;j("success"),y(!1),w.current=setTimeout(()=>{N.current&&j("idle")},de)}catch{if(!N.current)return;j("error"),w.current=setTimeout(()=>{N.current&&j("idle")},de)}}else S()},[u,f,c,S,b]),F=e.useCallback(e=>{"Escape"===e.key&&(e.preventDefault(),S())},[S]),T="inline"===x,E=T?me:ue,P=T?he:xe,M=s.jsxs("div",{className:t(E,pe,P,"flex items-center transition-all relative","bg-transparent border border-sys-blue/50 ring-1 ring-sys-blue/20",T&&"min-w-[100px]"),children:[s.jsx("select",{ref:v,value:f,onChange:e=>g(e.target.value),onKeyDown:F,disabled:"loading"===b,className:t("bg-transparent text-fg-primary focus:outline-none appearance-none cursor-pointer type-data flex-1 min-w-0","pr-6"),children:d.map(e=>s.jsx("option",{value:e.value,children:e.label},String(e.value)))}),s.jsx(i,{className:"absolute right-auto w-3.5 h-3.5 text-fg-muted pointer-events-none",style:{right:"loading"===b?"2rem":"3.5rem"}}),s.jsx("div",{className:"flex items-center gap-0.5 ml-1 shrink-0",children:"loading"===b?s.jsx(l,{className:t("text-fg-muted animate-spin",T?"w-3 h-3":"w-3.5 h-3.5")}):s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:_,className:t("rounded hover:bg-sys-green/15 text-sys-green transition-colors",T?"p-0.5":"p-1"),title:"Save",children:s.jsx(n,{className:T?"w-3 h-3":"w-3.5 h-3.5"})}),s.jsx("button",{onClick:S,className:t("rounded hover:bg-sys-red/15 text-fg-muted hover:text-sys-red transition-colors",T?"p-0.5":"p-1"),title:"Cancel (Esc)",children:s.jsx(r,{className:T?"w-3 h-3":"w-3.5 h-3.5"})})]})})]}),z=s.jsxs("div",{className:t(E,pe,P,"flex items-center transition-all","bg-input-bg border border-input-border",k&&"cursor-pointer hover:border-edge-strong",T?"justify-end min-w-[80px]":""),onClick:k?C:void 0,children:[s.jsx("span",{className:t("type-data text-fg-primary",!T&&"flex-1"),children:o}),"success"===b&&s.jsx(n,{className:t("text-sys-green shrink-0",T?"w-3 h-3 ml-1.5":"w-3.5 h-3.5")}),"error"===b&&s.jsx(r,{className:t("text-sys-red shrink-0",T?"w-3 h-3 ml-1.5":"w-3.5 h-3.5")}),"idle"===b&&k&&s.jsx(i,{className:t("text-fg-muted opacity-0 group-hover:opacity-100 transition-opacity shrink-0",T?"w-3 h-3 ml-1.5":"w-3.5 h-3.5")})]});return T?s.jsxs("div",{className:t("group flex items-center justify-between",h),children:[s.jsx("label",{className:"type-label text-fg-muted shrink-0",children:a}),p?M:z]}):s.jsxs("div",{className:t("group",h),children:[s.jsx("label",{className:"type-label text-fg-muted block mb-1",children:a}),p?M:z]})}async function ge(e){return o("/api/update_web_config",{method:"POST",body:JSON.stringify(e)})}e.memo(function(){const{theme:e}=c(),{themeId:t}=e,a=d.find(e=>e.meta.id===t)??d[0];return s.jsx("div",{className:"h-10 flex items-center justify-center",children:s.jsx("span",{className:"font-medium transition-all duration-300 leading-none text-center text-fg-secondary",style:{fontFamily:"Inter, system-ui, sans-serif",fontSize:"clamp(0.75rem, 0.6rem + 1.5vw, 1.1rem)",letterSpacing:"-0.02em"},children:a.meta.name})})});const be=e.memo(function({compact:e=!1}){const{theme:a,setTheme:l}=c(),{themeId:n}=a;return s.jsx("div",{className:t("grid grid-cols-2 gap-2",e?"w-full min-w-0 self-stretch":"w-full"),children:[...d].reverse().map(a=>{const r=n===a.meta.id,i=a.meta.isDark;return s.jsxs("button",{type:"button",title:a.meta.name,className:t("flex flex-row items-stretch radius-inner transition-all duration-200 ease-out overflow-hidden cursor-pointer",e&&"h-6",r?"ring-2 ring-sys-blue scale-[1.02]":"opacity-70 hover:opacity-100"),onClick:()=>l(a.meta.id),children:[s.jsx("div",{className:t("flex-1 h-full",i?"bg-[#18181b]":"bg-[#EFF0F1]")}),s.jsx("div",{className:"flex flex-col h-full",children:a.display.palette.map((e,t)=>s.jsx("div",{className:"flex flex-1",children:e.map((e,t)=>s.jsx("div",{className:"w-2 h-full",style:{backgroundColor:e}},t))},t))})]},a.meta.id)})})}),je=e.memo(function(){const{theme:t,setTheme:a}=c(),{themeId:l}=t,n="breeze dark"===l,r=e.useCallback(e=>{a(e?"breeze dark":"breeze light")},[a]);return s.jsx(u,{enabled:n,onChange:r,label:s.jsxs(s.Fragment,{children:["Dark Mode: ",n?s.jsx(I,{className:"w-3.5 h-3.5 text-sys-blue inline"}):s.jsx(L,{className:"w-3.5 h-3.5 text-[#e8a517] inline"})]}),tooltip:"Switch between dark and light mode",size:"md"})}),ve=e.memo(function({layout:t="horizontal"}){return e.useEffect(()=>{D()},[]),"toggle-only"===t?s.jsx(je,{}):"thumbnails-only"===t?s.jsx(be,{}):"vertical"===t?s.jsxs("div",{className:"flex flex-col items-start gap-3",children:[s.jsx(je,{}),s.jsx(be,{})]}):s.jsxs("div",{className:"flex items-stretch gap-4",children:[s.jsx("div",{className:"flex-shrink-0 flex items-start",children:s.jsx(je,{})}),s.jsx(be,{compact:!0})]})}),Ne=2e3;function we(s,t,a){const[l,n]=e.useState("idle"),[r,i]=e.useState(null),o=e.useRef(!0),c=e.useRef(null),d=e.useRef(null),u=e.useRef(!1),m=e.useRef("idle"),x=e.useRef(s),h=e.useRef(t),p=e.useRef(a);return m.current=l,x.current=s,h.current=t,p.current=a,e.useEffect(()=>(o.current=!0,()=>{o.current=!1,c.current&&clearTimeout(c.current),d.current&&clearTimeout(d.current)}),[]),{enabled:null!==r?r:s,status:l,toggle:e.useCallback(async e=>{if("loading"===m.current)return;const s=x.current;c.current&&clearTimeout(c.current),d.current&&clearTimeout(d.current),u.current=!1,i(e),n("loading"),c.current=setTimeout(()=>{!u.current&&o.current&&(i(s),n("error"),d.current=setTimeout(()=>{o.current&&(n("idle"),i(null))},Ne))},1e4);try{if(await h.current(e),u.current=!0,c.current&&clearTimeout(c.current),!o.current)return;n("success"),d.current=setTimeout(()=>{var e;o.current&&(n("idle"),i(null),null==(e=p.current)||e.call(p))},Ne)}catch{if(u.current=!0,c.current&&clearTimeout(c.current),!o.current)return;i(s),n("error"),d.current=setTimeout(()=>{o.current&&(n("idle"),i(null))},Ne)}},[])}}function ke(){const{latitude:a,longitude:i,enabled:o,setLocation:c,enable:d,disable:u,clear:h}=m(),[p,y]=e.useState(!1),[f,g]=e.useState(""),[b,j]=e.useState(""),[v,N]=e.useState("idle"),[w,k]=e.useState(null),C=e.useRef(null),S=e.useRef(null),_=e.useRef(!0);e.useEffect(()=>(_.current=!0,()=>{_.current=!1,S.current&&clearTimeout(S.current)}),[]);const F=()=>{y(!1),k(null)};e.useEffect(()=>{if(!p)return;const e=e=>{"loading"!==v&&C.current&&!C.current.contains(e.target)&&F()};return document.addEventListener("mouseup",e),()=>document.removeEventListener("mouseup",e)},[p,v]);const T=null!==a&&null!==i;return s.jsx($,{children:s.jsxs("div",{ref:C,children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx(U,{icon:s.jsx(ce,{}),title:"Stealth"}),s.jsxs("div",{className:"flex items-center gap-1",children:[T&&!p&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>{o?u():d()},className:t("relative inline-flex h-6 w-11 items-center rounded-full transition-colors border-2 mr-2",o?"bg-toggle-on border-toggle-on":"bg-toggle-off border-edge-subtle"),title:o?"Disable stealth location":"Enable stealth location",children:s.jsx("span",{className:t("inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-lg",o?"translate-x-5":"translate-x-0.5")})}),s.jsx("button",{onClick:()=>{h(),y(!1)},className:"p-2 rounded-lg transition-colors text-fg-muted hover:text-sys-red hover:bg-sys-red/10",title:"Clear stealth location",children:s.jsx(M,{className:"w-4 h-4"})})]}),p?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:F,disabled:"loading"===v,className:t("p-2 rounded-lg transition-colors","loading"===v?"text-fg-muted cursor-not-allowed":"text-fg-muted hover:text-sys-red hover:bg-sys-red/10"),title:"Cancel",children:s.jsx(r,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>{if("loading"===v)return;S.current&&clearTimeout(S.current);const e=((e,s)=>{const t=parseFloat(e),a=parseFloat(s);return isNaN(t)||isNaN(a)?"Please enter valid numbers":t<-90||t>90?"Latitude must be between -90 and 90":a<-180||a>180?"Longitude must be between -180 and 180":0===t&&0===a?"Coordinates (0, 0) are invalid":null})(f,b);if(e)return void k(e);N("loading"),k(null);const s=parseFloat(f),t=parseFloat(b);c(s,t),o||d(),N("success"),S.current=setTimeout(()=>{_.current&&(N("idle"),y(!1))},1e3)},disabled:"loading"===v,className:t("p-2 rounded-lg transition-colors","loading"===v?"text-sys-blue cursor-wait":"success"===v?"text-sys-green":"error"===v?"text-sys-red":"text-sys-green hover:bg-sys-green/10"),title:"Save",children:"loading"===v?s.jsx(l,{className:"w-4 h-4 animate-spin"}):"success"===v?s.jsx(n,{className:"w-4 h-4"}):"error"===v?s.jsx(r,{className:"w-4 h-4"}):s.jsx(n,{className:"w-4 h-4"})})]}):s.jsx("button",{onClick:()=>{g((null==a?void 0:a.toFixed(6))??""),j((null==i?void 0:i.toFixed(6))??""),k(null),y(!0)},className:"p-2 rounded-lg transition-colors text-fg-muted hover:text-fg-primary hover:bg-subtle",title:T?"Edit stealth location":"Set stealth location",children:s.jsx(oe,{className:"w-4 h-4"})})]})]}),s.jsx("div",{className:"bg-sys-cyan/5 rounded-xl p-3 mb-4",children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx(x,{className:"w-4 h-4 text-sys-cyan flex-shrink-0 mt-0.5"}),s.jsxs("p",{className:"type-body-sm text-fg-muted",children:[s.jsx("span",{className:"text-fg-secondary",children:"Stealth mode"})," allows you to appear on the map and in topology analysis without broadcasting your location. Coordinates are stored locally in your browser only — ",s.jsx("span",{className:"text-sys-cyan",children:"never sent to config.yaml or the mesh"}),"."]})]})}),w&&s.jsx("div",{className:"text-xs mb-3 px-2 py-1.5 rounded-md text-sys-red bg-sys-red/10",children:w}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-fg-muted block mb-1",children:p?"Latitude (°)":"Latitude"}),s.jsx("div",{className:t("h-[38px] rounded-full px-4 flex items-center transition-colors","bg-subtle-fill"),children:p?s.jsx("input",{type:"number",value:f,onChange:e=>g(e.target.value),step:"0.000001",min:"-90",max:"90",placeholder:"e.g. 34.052234",className:"w-full bg-transparent text-fg-primary focus:outline-none type-data placeholder:text-fg-muted/50"}):s.jsx("span",{className:t("type-data",T&&o?"text-fg-primary":"text-fg-muted"),children:T?a.toFixed(6):"Not set"})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-fg-muted block mb-1",children:p?"Longitude (°)":"Longitude"}),s.jsx("div",{className:t("h-[38px] rounded-full px-4 flex items-center transition-colors","bg-subtle-fill"),children:p?s.jsx("input",{type:"number",value:b,onChange:e=>j(e.target.value),step:"0.000001",min:"-180",max:"180",placeholder:"e.g. -118.243685",className:"w-full bg-transparent text-fg-primary focus:outline-none type-data placeholder:text-fg-muted/50"}):s.jsx("span",{className:t("type-data",T&&o?"text-fg-primary":"text-fg-muted"),children:T?i.toFixed(6):"Not set"})})]})]}),T&&!p&&s.jsx("div",{className:"mt-3 pt-3 border-t border-edge-subtle",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:t("w-2 h-2 rounded-full",o?"bg-sys-green":"bg-fg-muted")}),s.jsx("span",{className:"type-body-sm text-fg-muted",children:o?"Stealth location active — you appear on maps with these coordinates":"Stealth location disabled — coordinates saved but not in use"})]})})]})})}const Ce=[{value:7.8,label:"7.8 kHz"},{value:10.4,label:"10.4 kHz"},{value:15.6,label:"15.6 kHz"},{value:20.8,label:"20.8 kHz"},{value:31.25,label:"31.25 kHz"},{value:41.7,label:"41.7 kHz"},{value:62.5,label:"62.5 kHz"},{value:125,label:"125 kHz"},{value:250,label:"250 kHz"},{value:500,label:"500 kHz"}],Se=[5,6,7,8,9,10,11,12],_e=[{value:5,label:"4/5"},{value:6,label:"4/6"},{value:7,label:"4/7"},{value:8,label:"4/8"}],Fe="radioConfig";function Te(e){if(!e)return"Never";const s=Date.now()-1e3*e,t=Math.floor(s/6e4),a=Math.floor(s/36e5),l=Math.floor(s/864e5);return t<1?"Just now":t<60?`${t}m ago`:a<24?`${a}h ago`:l<365?`${l}d ago`:`${Math.floor(l/365)}y ago`}function Ee({node:e,level:a,expandedKeys:l,selectedKeyId:n,globalFloodPolicy:r,onSelect:i,onToggle:o}){const c=l.has(e.id),d=n===e.id,u=e.children&&e.children.length>0,m="allow"===r;return s.jsxs("div",{children:[s.jsxs("div",{className:t("flex items-center gap-2 h-[36px] px-3 rounded-full cursor-pointer transition-colors",d?"bg-sys-blue/15":"hover:bg-subtle-fill",m&&"opacity-50 cursor-not-allowed"),style:{marginLeft:16*a+"px"},onClick:()=>!m&&i(e.id),children:[u?s.jsx("button",{onClick:s=>{s.stopPropagation(),o(e.id)},className:"p-1 hover:bg-subtle-fill-hover rounded-full transition-colors",children:s.jsx(te,{className:t("w-3.5 h-3.5 text-fg-muted transition-transform",c&&"rotate-90")})}):s.jsx("span",{className:"w-5"}),s.jsx(ne,{className:"w-4 h-4 text-sys-blue flex-shrink-0"}),s.jsx("span",{className:"type-data text-fg-primary flex-1 truncate",children:e.name}),s.jsx("span",{className:"type-data-xs text-fg-muted hidden sm:inline",title:e.last_used?new Date(1e3*e.last_used).toLocaleString():void 0,children:Te(e.last_used)}),s.jsx("span",{className:t("type-data-xs px-2 py-0.5 rounded-full","allow"===e.floodPolicy?"bg-sys-green/15 text-sys-green":"bg-sys-red/15 text-sys-red"),children:"allow"===e.floodPolicy?"Allow":"Deny"})]}),u&&c&&s.jsx("div",{children:e.children.map(e=>s.jsx(Ee,{node:e,level:a+1,expandedKeys:l,selectedKeyId:n,globalFloodPolicy:r,onSelect:i,onToggle:o},e.id))})]})}function Pe(){const[a,l]=e.useState(K),[n,r]=e.useState(V),[i,o]=e.useState(!1),c=e.useCallback(e=>{l(e),H(e)},[]),d=e.useCallback(e=>{const s=parseFloat(e.target.value);r(s),O(s)},[]),m=e.useCallback(async()=>{i||(o(!0),await q(),o(!1))},[i]);return s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsx(u,{enabled:a,onChange:c,label:s.jsxs(s.Fragment,{children:["Sound: ",s.jsx("span",{className:a?"text-sys-green":"text-sys-red",children:a?"On":"Off"})]}),tooltip:"Enable or disable UI sound effects and haptic audio feedback",size:"md"}),s.jsx(v,{color:"primary",outline:!0,onClick:m,disabled:!a||i,className:"w-16 justify-center",children:i?"…":"Test"})]}),s.jsxs("div",{className:t("flex items-center gap-3",!a&&"opacity-40 pointer-events-none"),children:[s.jsx("span",{className:"type-label text-fg-muted w-14 shrink-0",children:"Volume"}),s.jsx("input",{type:"range",min:0,max:1,step:.05,value:n,onChange:d,className:"flex-1 accent-sys-blue h-1.5 cursor-pointer"}),s.jsxs("span",{className:"data-box w-16 justify-center",children:[Math.round(100*n),"%"]})]})]})}function Me(){var a,r,i,c,d,m;const{stats:D,setMode:I,clearModeMutation:L,setDutyCycleConfig:K,clearDutyCycleMutation:V,fetchStats:H,startMutation:O,clearMutation:q}=h(),te=null==(a=null==D?void 0:D.config)?void 0:a.radio,ne=null==(r=null==D?void 0:D.config)?void 0:r.repeater,oe=null==(i=null==D?void 0:D.config)?void 0:i.duty_cycle,ce=(null==D?void 0:D.node_name)||(null==(c=null==D?void 0:D.config)?void 0:c.node_name)||"Unknown Node",de=(null==ne?void 0:ne.mode)??"forward",ue=(null==oe?void 0:oe.enforcement_enabled)??!1,me=null==(d=null==D?void 0:D.config)?void 0:d.delays,xe=e.useRef(!0);e.useEffect(()=>(xe.current=!0,()=>{xe.current=!1}),[]);const he=null==(m=null==D?void 0:D.config)?void 0:m.web,[pe,be]=e.useState([]),[je,Ne]=e.useState(!1),[Te,Me]=e.useState(null),[ze,Re]=e.useState(!1),[De,Ie]=e.useState(""),[Le,Ae]=e.useState(null),[Ke,Ve]=e.useState(!1),[He,Oe]=e.useState(null),[qe,$e]=e.useState(!1),[Be,Xe]=e.useState(!1),[Je,Ue]=e.useState(!1),[We,Ye]=e.useState([]),[Ge,Qe]=e.useState(!1),[Ze,es]=e.useState(null),[ss,ts]=e.useState(()=>"allow"===localStorage.getItem("pymc:globalFloodPolicy")?"allow":"deny"),as=e.useCallback(e=>{ts(e),localStorage.setItem("pymc:globalFloodPolicy",e)},[]),[ls,ns]=e.useState(!1),[rs,is]=e.useState(null),[os,cs]=e.useState(new Set),[ds,us]=e.useState(!1),[ms,xs]=e.useState(!1),[hs,ps]=e.useState(!1),[ys,fs]=e.useState(null),[gs,bs]=e.useState(null),[js,vs]=e.useState(""),[Ns,ws]=e.useState("allow"),[ks,Cs]=e.useState(!1),[Ss,_s]=e.useState(!0),[Fs,Ts]=e.useState(!1),[Es,Ps]=e.useState(!0),[Ms,zs]=e.useState("idle"),[Rs,Ds]=e.useState(!1),[Is,Ls]=e.useState(!1),As=e.useCallback(()=>{const e=null==me?void 0:me.tx_delay_factor;return e&&"object"==typeof e&&"parsedValue"in e?e.parsedValue??1:"number"==typeof e?e:1},[me]),Ks=e.useCallback(()=>{const e=null==me?void 0:me.direct_tx_delay_factor;return"number"==typeof e?e:.5},[me]),Vs=e.useCallback(()=>{const e=null==oe?void 0:oe.max_airtime_percent;return"number"==typeof e?e:e&&"object"==typeof e&&"parsedValue"in e?e.parsedValue??6:6},[oe]),Hs=we("forward"===de,async e=>{await I(e?"forward":"monitor")},L),Os=we(ue,async e=>{await K({max_airtime_percent:Vs(),enforcement_enabled:e})},V),qs=we((null==he?void 0:he.cors_enabled)??!1,async e=>{var s;const t=await ge({web:{cors_enabled:e}});if(!t.success&&!(null==(s=t.data)?void 0:s.persisted))throw new Error("CORS update failed");await H()}),$s=e.useCallback(async e=>{O(Fe);try{const s=await p(e);if(!s.success)throw new Error(s.error||"Failed to save");await H({force:!0}).catch(()=>{})}finally{q(Fe)}},[O,q,H]);e.useEffect(()=>{(async()=>{Ps(!0);try{const e=await S();e.success&&e.data?Ts(e.data.exists):Ts(!1);const s=null==he?void 0:he.web_path;_s(!s||""===s)}catch{Ts(!1)}finally{Ps(!1)}})()},[null==he?void 0:he.web_path]);const Bs=async e=>{var s;if("loading"!==Ms){zs("loading");try{const t=await ge({web:{web_path:e?null:"/opt/pymc_console/web/html"}});if(!xe.current)return;t.success||(null==(s=t.data)?void 0:s.persisted)?(_s(e),zs("success"),Ds(!0),setTimeout(()=>{xe.current&&zs("idle")},2e3)):(zs("error"),setTimeout(()=>{xe.current&&zs("idle")},2e3))}catch{if(!xe.current)return;zs("error"),setTimeout(()=>{xe.current&&zs("idle")},2e3)}}},Xs=e.useCallback(async()=>{Ne(!0),Me(null);try{const e=await async function(){return o("/auth/tokens")}();be(e.tokens||[])}catch(e){Me(e instanceof Error?e.message:"Failed to fetch tokens")}finally{Ne(!1)}},[]);e.useEffect(()=>{Xs()},[Xs]);const Js=async()=>{if(De.trim()){$e(!0),Me(null);try{const e=await async function(e){return o("/auth/tokens",{method:"POST",body:JSON.stringify({name:e})})}(De.trim());Ae(e.token||null),Re(!1),Ve(!0),Ie(""),await Xs()}catch(e){Me(e instanceof Error?e.message:"Failed to create token")}finally{$e(!1)}}else Me("Token name is required")},Us=e=>e?new Date(1e3*e).toLocaleString():"Never",Ws=e.useCallback(e=>{const s=new Map,t=[];return e.forEach(e=>{const t={id:e.id,name:e.name,floodPolicy:e.flood_policy,transport_key:e.transport_key,last_used:e.last_used,parent_id:e.parent_id,children:[]};s.set(e.id,t)}),s.forEach(e=>{e.parent_id&&s.has(e.parent_id)?s.get(e.parent_id).children.push(e):t.push(e)}),t},[]),Ys=e.useCallback(async()=>{Qe(!0),es(null);try{const e=await k();if(e.success&&e.data){const s=Ws(e.data);Ye(s),is(e=>{if(null===e)return null;const t=s=>{for(const a of s){if(a.id===e)return!0;if(a.children&&t(a.children))return!0}return!1};return t(s)?e:null})}else es(e.error||"Failed to load transport keys")}catch(e){es(e instanceof Error?e.message:"Unknown error occurred")}finally{Qe(!1)}},[Ws]);e.useEffect(()=>{Ys(),C().then(e=>{e.success&&e.data&&as(e.data.global_flood_allow?"allow":"deny")}).catch(()=>{})},[Ys]);const Gs=e.useCallback((e,s)=>{for(const t of e){if(t.id===s)return t;if(t.children){const e=Gs(t.children,s);if(e)return e}}return null},[]),Qs=e.useCallback(()=>{if(!rs)return;const e=Gs(We,rs);return null==e?void 0:e.name},[rs,We,Gs]),Zs=e.useCallback(e=>{cs(s=>{const t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},[]),et=async()=>{if(js.trim()){Cs(!0),es(null);try{const e=await T({name:js.trim(),flood_policy:Ns,parent_id:rs??void 0});e.success?(await Ys(),us(!1),vs(""),ws("allow")):es(e.error||"Failed to add transport key")}catch(e){es(e instanceof Error?e.message:"Failed to add transport key")}finally{Cs(!1)}}else es("Key name is required")},st=e.useCallback(()=>{if(!rs)return;const e=Gs(We,rs);e&&(fs({...e}),xs(!0))},[rs,We,Gs]);e.useEffect(()=>{const e=e=>{"Escape"===e.key&&(ds&&(us(!1),vs(""),ws("allow")),ms&&(xs(!1),fs(null)),hs&&(ps(!1),bs(null)),ze&&(Re(!1),Ie("")),Ke&&(Ve(!1),Ae(null)))};if(ds||ms||hs||ze||Ke)return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ds,ms,hs,ze,Ke]);const tt=e.useCallback(()=>{if(!rs)return;const e=Gs(We,rs);e&&(bs(e),ps(!0))},[rs,We,Gs]);return s.jsxs(B,{children:[s.jsx(X,{title:"Configuration",icon:s.jsx(y,{})}),s.jsxs(J,{children:[s.jsxs(W,{template:"standard",children:[s.jsx(Y,{span:12,md:6,children:s.jsxs($,{neomorphic:!0,children:[s.jsx(U,{icon:s.jsx(f,{}),title:"Repeater Settings"}),ne?s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx("div",{className:"col-span-2",children:s.jsx(ye,{label:"Node Name",value:ce,onSave:async e=>$s({node_name:e}),placeholder:"Enter node name",maxLength:50})}),s.jsx(ye,{label:"Latitude",value:0!==ne.latitude?ne.latitude.toFixed(6):"Not set",editValue:String(ne.latitude),type:"number",suffix:"°",step:1e-6,min:-90,max:90,onSave:async e=>$s({latitude:parseFloat(e)})}),s.jsx(ye,{label:"Longitude",value:0!==ne.longitude?ne.longitude.toFixed(6):"Not set",editValue:String(ne.longitude),type:"number",suffix:"°",step:1e-6,min:-180,max:180,onSave:async e=>$s({longitude:parseFloat(e)})}),s.jsx(ye,{label:"Advert Interval",value:ne.send_advert_interval_hours>0?`${ne.send_advert_interval_hours}h`:"Disabled",editValue:String(ne.send_advert_interval_hours),type:"number",suffix:"hours",min:0,max:48,description:"0 = disabled, 3-48 hours",onSave:async e=>$s({flood_advert_interval_hours:parseInt(e,10)})}),s.jsx(ye,{label:"Score-based TX",value:ne.use_score_for_tx?"Enabled":"Disabled",readOnly:!0})]}):s.jsx("p",{className:"text-fg-muted",children:"Loading repeater settings..."})]})}),s.jsx(Y,{span:12,md:6,children:s.jsxs($,{neomorphic:!0,children:[s.jsx(U,{icon:s.jsx(ae,{}),title:"Radio Configuration"}),te?s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(ye,{label:"Frequency",value:g(te.frequency),editValue:(te.frequency/1e6).toFixed(3),type:"number",suffix:"MHz",step:.001,min:400,max:930,onSave:async e=>$s({frequency_mhz:parseFloat(e)})}),s.jsx(ye,{label:"TX Power",value:`${te.tx_power} dBm`,editValue:String(te.tx_power),type:"number",suffix:"dBm",min:2,max:30,onSave:async e=>$s({tx_power:parseInt(e,10)})}),s.jsx(fe,{label:"Bandwidth",value:b(te.bandwidth),editValue:te.bandwidth/1e3,options:Ce,onSave:async e=>$s({bandwidth_khz:parseFloat(e)})}),s.jsx(fe,{label:"Spreading Factor",value:`SF${te.spreading_factor}`,editValue:te.spreading_factor,options:Se.map(e=>({value:e,label:`SF${e}`})),onSave:async e=>$s({spreading_factor:parseInt(e,10)})}),s.jsx(fe,{label:"Coding Rate",value:`4/${te.coding_rate}`,editValue:te.coding_rate,options:_e,onSave:async e=>$s({coding_rate:parseInt(e,10)})}),s.jsx(ye,{label:"Preamble",value:`${te.preamble_length} symbols`,readOnly:!0})]}):s.jsx("p",{className:"text-fg-muted",children:"Loading radio configuration..."})]})})]}),s.jsxs(W,{template:"standard",children:[s.jsx(Y,{span:12,md:6,children:s.jsxs($,{neomorphic:!0,children:[s.jsx(U,{icon:s.jsx(j,{}),title:"Operating Mode"}),s.jsx("p",{className:"type-label text-fg-muted mb-3",children:"Control how the repeater handles packets"}),s.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[s.jsxs("div",{className:"flex-1 space-y-4",children:[s.jsx(u,{enabled:Hs.enabled,onChange:Hs.toggle,label:"Repeat",tooltip:"Toggles repeater or monitor mode. In monitor mode, the repeater will not repeat packets from the mesh.",status:Hs.status,size:"md"}),s.jsx(u,{enabled:Os.enabled,onChange:Os.toggle,label:"Duty Cycle",tooltip:"Limit transmission time to comply with airtime utilization regulations",status:Os.status,size:"md"}),s.jsx(ye,{label:"Max Airtime",layout:"inline",value:`${Vs().toFixed(1)}%`,editValue:String(Vs()),type:"number",suffix:"%",step:.5,min:.1,max:100,onSave:async e=>{await K({max_airtime_percent:parseFloat(e),enforcement_enabled:ue}),V()}})]}),s.jsx("div",{className:"hidden lg:block w-px bg-border-subtle"}),s.jsxs("div",{className:"flex-1 pt-4 lg:pt-0 border-t lg:border-t-0 border-edge-subtle",children:[s.jsx("label",{className:"type-label text-fg-muted block mb-3",children:"TX Delays"}),s.jsxs("div",{className:"space-y-3",children:[s.jsx(ye,{label:"Flood",layout:"inline",value:`${As().toFixed(2)}x`,editValue:String(As()),type:"number",suffix:"x",step:.1,min:0,max:5,onSave:async e=>$s({tx_delay_factor:parseFloat(e)})}),s.jsx(ye,{label:"Direct",layout:"inline",value:`${Ks().toFixed(2)}s`,editValue:String(Ks()),type:"number",suffix:"s",step:.1,min:0,max:5,onSave:async e=>$s({direct_tx_delay_factor:parseFloat(e)})})]})]})]})]})}),s.jsx(Y,{span:12,md:6,children:s.jsxs($,{neomorphic:!0,children:[s.jsx(U,{icon:s.jsx(y,{}),title:"App Settings"}),s.jsx("p",{className:"type-body-sm text-fg-muted mb-4",children:"Appearance and web server options."}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(u,{enabled:qs.enabled,onChange:qs.toggle,label:"Enable CORS",tooltip:"Allow cross-origin API access",status:qs.status,size:"md"}),s.jsx("div",{children:s.jsx(ve,{})}),s.jsx(Pe,{})]})]})})]}),s.jsx(W,{template:"auto",children:s.jsxs($,{neomorphic:!0,children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[s.jsx(U,{icon:s.jsx(re,{}),title:"Regions Transport Keys",subtitle:"Manage regional key hierarchy for flood control"}),s.jsxs("div",{className:"flex gap-2 flex-wrap",children:[s.jsxs(v,{color:"primary",outline:!0,onClick:()=>us(!0),disabled:"allow"===ss,children:[s.jsx(z,{"data-slot":"icon"}),"Add"]}),s.jsx(v,{color:"primary",outline:!0,onClick:st,disabled:!rs||"allow"===ss,children:"Edit"}),s.jsx(v,{color:"danger",outline:!0,onClick:tt,disabled:!rs||"allow"===ss,children:"Delete"})]})]}),s.jsx("div",{className:"bg-subtle-fill radius-inner p-4 mb-4",children:s.jsx(u,{enabled:"deny"===ss,onChange:e=>(async e=>{ns(!0),es(null);try{const s=await F("allow"===e);s.success?as(e):es(s.error||"Failed to update global flood policy")}catch(s){es(s instanceof Error?s.message:"Failed to update global flood policy")}finally{ns(!1)}})(e?"deny":"allow"),label:s.jsxs(s.Fragment,{children:["Require Transport Keys: ",s.jsx("span",{className:"deny"===ss?"text-sys-green":"text-sys-red",children:"deny"===ss?"On":"Off"})]}),tooltip:"When enabled, only packets with matching transport keys are forwarded. When disabled, all packets flood freely.",status:ls?"loading":"idle",disabled:ls,dangerOff:!0,size:"md",className:"flex-row-reverse justify-between w-full"})}),Ze&&s.jsx("div",{className:"type-body-sm mb-3 px-3 py-2 rounded-full text-sys-red bg-sys-red/10",children:Ze}),s.jsx("div",{className:"bg-subtle-fill radius-inner p-4 min-h-[120px]",children:Ge?s.jsxs("div",{className:"flex items-center justify-center py-6",children:[s.jsx(l,{className:"w-5 h-5 animate-spin text-sys-blue mr-2"}),s.jsx("span",{className:"type-body-sm text-fg-muted",children:"Loading transport keys..."})]}):0===We.length?s.jsxs("div",{className:"text-center py-6",children:[s.jsx("div",{className:"w-12 h-12 rounded-full bg-subtle-fill mx-auto mb-3 flex items-center justify-center",children:s.jsx(re,{className:"w-6 h-6 text-fg-muted/50"})}),s.jsx("p",{className:"type-body text-fg-muted",children:"No transport keys found"}),s.jsx("p",{className:"type-body-sm text-fg-muted/70 mt-1",children:"Add your first transport key to get started"})]}):s.jsx("div",{className:"space-y-1",children:We.map(e=>s.jsx(Ee,{node:e,level:0,expandedKeys:os,selectedKeyId:rs,globalFloodPolicy:ss,onSelect:is,onToggle:Zs},e.id))})})]})}),s.jsx(W,{template:"auto",children:s.jsxs($,{neomorphic:!0,children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[s.jsx(U,{icon:s.jsx(G,{}),title:"API Tokens",subtitle:"Manage API tokens for machine-to-machine authentication"}),s.jsxs(v,{color:"primary",outline:!0,onClick:()=>Re(!0),children:[s.jsx(z,{"data-slot":"icon"}),"Create Token"]})]}),s.jsx("div",{className:"bg-sys-cyan/5 radius-inner p-4 mb-4",children:s.jsxs("div",{className:"flex gap-3",children:[s.jsx("div",{className:"w-8 h-8 rounded-full bg-sys-cyan/20 flex items-center justify-center flex-shrink-0",children:s.jsx(x,{className:"w-4 h-4 text-sys-cyan"})}),s.jsxs("div",{className:"type-body-sm text-fg-muted",children:[s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-secondary",children:"API tokens"})," are used for machine-to-machine authentication. Include the token in the ",s.jsx("code",{className:"type-code bg-sys-cyan/20 px-1.5 py-0.5 rounded-full text-sys-cyan",children:"X-API-Key"})," header when making API requests."]}),s.jsx("p",{className:"mt-1 text-fg-muted/70",children:"Tokens are only shown once at creation. Store them securely."})]})]})}),Te&&s.jsx("div",{className:"type-body-sm mb-3 px-3 py-2 rounded-full text-sys-red bg-sys-red/10",children:Te}),je&&0===pe.length?s.jsxs("div",{className:"flex items-center justify-center py-6",children:[s.jsx(l,{className:"w-5 h-5 animate-spin text-sys-blue mr-2"}),s.jsx("span",{className:"type-body-sm text-fg-muted",children:"Loading tokens..."})]}):pe.length>0?s.jsx("div",{className:"space-y-2",children:pe.map(e=>s.jsx("div",{className:"bg-subtle-fill hover:bg-subtle-fill-strong radius-inner p-4 transition-base",children:s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[s.jsx("div",{className:"w-10 h-10 rounded-full bg-sys-blue/10 flex items-center justify-center flex-shrink-0",children:s.jsx(G,{className:"w-5 h-5 text-sys-blue"})}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("h3",{className:"type-body text-fg-primary font-medium truncate",children:e.name}),s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:gap-4 mt-0.5",children:[s.jsxs("span",{className:"type-data-sm text-fg-muted truncate",children:["Created: ",Us(e.created_at)]}),s.jsxs("span",{className:"type-data-sm text-fg-muted truncate",children:["Last used: ",Us(e.last_used)]})]})]})]}),s.jsxs(v,{color:"danger",outline:!0,onClick:()=>Oe({id:e.id,name:e.name}),disabled:Be,children:[s.jsx(M,{"data-slot":"icon"}),"Revoke"]})]})},e.id))}):s.jsxs("div",{className:"bg-subtle-fill radius-inner p-6 text-center",children:[s.jsx("div",{className:"w-14 h-14 rounded-full bg-subtle-fill mx-auto mb-4 flex items-center justify-center",children:s.jsx(G,{className:"w-7 h-7 text-fg-muted/50"})}),s.jsx("h3",{className:"type-body text-fg-primary font-medium mb-1",children:"No API Tokens"}),s.jsx("p",{className:"type-body-sm text-fg-muted mb-4",children:"Create a token to enable API access"}),s.jsx(v,{color:"primary",outline:!0,onClick:()=>Re(!0),children:"Create Your First Token"})]})]})}),s.jsx(W,{template:"auto",children:s.jsxs($,{neomorphic:!0,children:[s.jsx(U,{icon:s.jsx(ie,{}),title:"Web Frontend",subtitle:"Choose which web interface to use",className:"mb-4"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsxs("label",{className:t("flex items-start gap-3 p-4 bg-subtle-fill radius-card border-2 cursor-pointer transition-base",Ss?"border-sys-blue bg-sys-blue/5":"border-transparent hover:border-sys-blue/30","loading"===Ms&&"opacity-50 pointer-events-none"),children:[s.jsx("input",{type:"radio",name:"frontend",checked:Ss,onChange:()=>Bs(!0),disabled:"loading"===Ms,className:"mt-1 h-4 w-4 text-sys-blue focus:ring-sys-blue focus:ring-offset-bg-elevated"}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"type-body text-fg-primary font-medium",children:"Default Frontend"}),s.jsx("a",{href:"https://github.com/rightup/pyMC_Repeater",target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"type-data-xs bg-sys-cyan/15 text-sys-cyan px-2.5 py-0.5 rounded-full font-medium hover:bg-sys-cyan/25 transition-colors",children:"@RightUp"})]}),s.jsx("div",{className:"type-body-sm text-fg-muted mt-1",children:"Built-in pyMC Repeater web interface"}),s.jsx("div",{className:"type-data-xs text-fg-muted/60 mt-1",children:"/opt/pymc_repeater/repeater/web/html"})]})]}),s.jsxs("label",{className:t("flex items-start gap-3 p-4 bg-subtle-fill radius-card border-2 cursor-pointer transition-base",Ss?"border-transparent hover:border-sys-blue/30":"border-sys-blue bg-sys-blue/5","loading"===Ms&&"opacity-50 pointer-events-none"),children:[s.jsx("input",{type:"radio",name:"frontend",checked:!Ss,onChange:()=>Bs(!1),disabled:"loading"===Ms,className:"mt-1 h-4 w-4 text-sys-blue focus:ring-sys-blue focus:ring-offset-bg-elevated"}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"type-body text-fg-primary font-medium",children:"PyMC Console"}),s.jsx("span",{className:"type-data-xs bg-sys-indigo/15 text-sys-indigo px-2.5 py-0.5 rounded-full font-medium",children:"@Treehouse ⚡"})]}),s.jsx("div",{className:"type-body-sm text-fg-muted mt-1",children:"Alternative web interface for pyMC Repeater"}),s.jsx("div",{className:"type-data-xs text-fg-muted/60 mt-1",children:"/opt/pymc_console/web/html"})]})]})]}),!Es&&s.jsx("div",{className:t("bg-subtle-fill radius-card p-4",Fs?"border border-sys-green/20":"border border-sys-cyan/20"),children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:t("w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",Fs?"bg-sys-green/20":"bg-sys-cyan/20"),children:Fs?s.jsx(Q,{className:"w-4 h-4 text-sys-green"}):s.jsx(x,{className:"w-4 h-4 text-sys-cyan"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"type-body text-fg-primary font-medium",children:Fs?"PyMC Console has been detected":"PyMC Console Not Installed"}),Fs?s.jsxs("p",{className:"type-body-sm text-fg-muted mt-1",children:["PyMC Console is installed at ",s.jsx("code",{className:"type-code bg-sys-green/10 px-1.5 py-0.5 rounded-full text-sys-green",children:"/opt/pymc_console/web/html"})]}):s.jsxs(s.Fragment,{children:[s.jsxs("p",{className:"type-body-sm text-fg-muted mt-1 mb-3",children:["PyMC Console must be installed at ",s.jsx("code",{className:"type-code bg-sys-cyan/10 px-1.5 py-0.5 rounded-full text-sys-cyan",children:"/opt/pymc_console/web/html"})," before selecting this option."]}),s.jsxs(v,{color:"primary",outline:!0,href:"https://github.com/dmduran12/pymc_console-dist",children:[s.jsx(le,{"data-slot":"icon"}),"PyMC Console Install Instructions"]})]})]})]})}),Rs&&s.jsx("div",{className:"bg-subtle-fill radius-card p-4 border border-sys-indigo/30",children:s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[s.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[s.jsx("div",{className:"w-8 h-8 rounded-full bg-sys-indigo/20 flex items-center justify-center flex-shrink-0",children:s.jsx(Z,{className:"w-4 h-4 text-sys-indigo"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"type-body text-fg-primary font-medium",children:"Service restart required"}),s.jsx("p",{className:"type-body-sm text-fg-muted mt-1",children:"Web frontend changes will take effect after restarting the pymc-repeater service."})]})]}),s.jsx(v,{color:"warning",outline:!0,onClick:async()=>{if(!Is){Ls(!0);try{await _(),Ds(!1),setTimeout(()=>{window.location.reload()},2e3)}catch{Ds(!1),setTimeout(()=>{window.location.reload()},3e3)}}},disabled:Is,children:Is?s.jsxs(s.Fragment,{children:[s.jsx(l,{"data-slot":"icon",className:"animate-spin"}),"Restarting..."]}):s.jsxs(s.Fragment,{children:[s.jsx(ee,{"data-slot":"icon"}),"Restart Now"]})})]})})]})]})}),D&&s.jsx(W,{template:"auto",children:s.jsx(A,{nodeName:ce,repeaterVersion:D.version,coreVersion:D.core_version,localHash:D.local_hash,publicKey:D.public_key})}),D&&(0===(null==ne?void 0:ne.latitude)||!(null==ne?void 0:ne.latitude))&&(0===(null==ne?void 0:ne.longitude)||!(null==ne?void 0:ne.longitude))&&s.jsx(W,{template:"auto",children:s.jsx(ke,{})})]}),ze&&s.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&Re(!1),role:"dialog","aria-modal":"true","aria-labelledby":"create-token-modal-title",children:s.jsxs("div",{className:"surface-modal radius-card p-6 max-w-md w-full",children:[s.jsx("h3",{id:"create-token-modal-title",className:"type-micro mb-4",children:"Create API Token"}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(N,{label:"Token Name",type:"text",value:De,onChange:e=>Ie(e.target.value),placeholder:"e.g., Production Server, CI/CD Pipeline",description:"Give your token a descriptive name to identify its purpose",onKeyDown:e=>"Enter"===e.key&&Js(),autoFocus:!0}),s.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[s.jsx(v,{color:"muted",outline:!0,onClick:()=>{Re(!1),Ie(""),Me(null)},disabled:qe,children:"Cancel"}),s.jsx(v,{color:"primary",onClick:Js,disabled:qe||!De.trim(),children:qe?s.jsxs(s.Fragment,{children:[s.jsx(l,{"data-slot":"icon",className:"animate-spin"}),"Creating..."]}):"Create Token"})]})]})]})}),Ke&&Le&&s.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&Ve(!1),role:"dialog","aria-modal":"true","aria-labelledby":"show-token-modal-title",children:s.jsxs("div",{className:"surface-modal radius-card p-6 max-w-lg w-full",children:[s.jsx("h3",{id:"show-token-modal-title",className:"type-micro mb-4",children:"Token Created Successfully"}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"bg-sys-indigo/10 border border-sys-indigo/30 radius-inner p-3",children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx(Z,{className:"w-4 h-4 text-sys-indigo flex-shrink-0 mt-0.5"}),s.jsxs("div",{className:"text-sm text-fg-secondary",children:[s.jsx("strong",{children:"Save this token now!"})," For security reasons, it will not be shown again."]})]})}),s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-fg-primary block mb-1.5",children:"Your API Token"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(w,{value:Le,readOnly:!0,className:"flex-1 font-mono"}),s.jsxs(v,{color:"primary",outline:!0,onClick:()=>{Le&&(navigator.clipboard.writeText(Le),Ue(!0),setTimeout(()=>Ue(!1),2e3))},children:[Je?s.jsx(n,{"data-slot":"icon",className:"text-sys-green"}):s.jsx(se,{"data-slot":"icon"}),Je?"Copied!":"Copy"]})]})]}),s.jsxs("div",{className:"bg-sys-cyan/10 border border-sys-cyan/30 radius-inner p-3",children:[s.jsx("p",{className:"text-sm text-fg-secondary mb-2",children:s.jsx("strong",{children:"Usage Example:"})}),s.jsxs("code",{className:"block bg-sys-cyan/20 px-3 py-2 rounded type-code text-sys-cyan overflow-x-auto",children:['curl -H "X-API-Key: ',Le.slice(0,12),'..." ',window.location.origin,"/api/stats"]})]}),s.jsx("div",{className:"flex justify-end mt-6",children:s.jsx(v,{color:"primary",onClick:()=>{Ve(!1),Ae(null)},children:"Done"})})]})]})}),s.jsx(R,{isOpen:!!He,title:"Revoke API Token",message:`Are you sure you want to revoke the token '${null==He?void 0:He.name}'? This action cannot be undone.`,confirmLabel:Be?"Revoking...":"Revoke",cancelLabel:"Cancel",variant:"danger",onConfirm:async()=>{if(He){Xe(!0),Me(null);try{await async function(e){return o(`/auth/tokens/${e}`,{method:"DELETE"})}(He.id),await Xs(),Oe(null)}catch(e){Me(e instanceof Error?e.message:"Failed to revoke token")}finally{Xe(!1)}}},onCancel:()=>Oe(null)}),ds&&s.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&us(!1),role:"dialog","aria-modal":"true","aria-labelledby":"add-key-modal-title",children:s.jsxs("div",{className:"surface-modal radius-card p-6 max-w-md w-full",children:[s.jsx("h3",{id:"add-key-modal-title",className:"type-micro mb-4",children:"Add Transport Key"}),s.jsxs("div",{className:"space-y-4",children:[rs&&s.jsxs("div",{className:"bg-sys-cyan/10 border border-sys-cyan/30 radius-inner p-3 text-sm text-fg-secondary",children:["Adding as child of: ",s.jsx("strong",{className:"text-fg-primary",children:Qs()})]}),s.jsx(N,{label:"Key Name",type:"text",value:js,onChange:e=>vs(e.target.value),placeholder:"e.g., Region Name, Group Key",onKeyDown:e=>"Enter"===e.key&&et(),autoFocus:!0}),s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-fg-muted block mb-2",children:"Flood Policy"}),s.jsxs("div",{className:"toggle-group w-full",children:[s.jsx("button",{onClick:()=>ws("deny"),className:t("toggle-group-item flex-1","deny"===Ns&&"active !text-sys-red"),children:"Deny"}),s.jsx("button",{onClick:()=>ws("allow"),className:t("toggle-group-item flex-1","allow"===Ns&&"active !text-sys-green"),children:"Allow"})]})]}),s.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[s.jsx(v,{color:"muted",outline:!0,onClick:()=>{us(!1),vs(""),ws("allow")},disabled:ks,children:"Cancel"}),s.jsx(v,{color:"primary",onClick:et,disabled:ks||!js.trim(),children:ks?s.jsxs(s.Fragment,{children:[s.jsx(l,{"data-slot":"icon",className:"animate-spin"}),"Adding..."]}):"Add Key"})]})]})]})}),ms&&ys&&s.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&xs(!1),role:"dialog","aria-modal":"true","aria-labelledby":"edit-key-modal-title",children:s.jsxs("div",{className:"surface-modal radius-card p-6 max-w-md w-full",children:[s.jsx("h3",{id:"edit-key-modal-title",className:"type-micro mb-4",children:"Edit Transport Key"}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(N,{label:"Key Name",type:"text",value:ys.name,onChange:e=>fs({...ys,name:e.target.value}),autoFocus:!0}),s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-fg-muted block mb-2",children:"Flood Policy"}),s.jsxs("div",{className:"toggle-group w-full",children:[s.jsx("button",{onClick:()=>fs({...ys,floodPolicy:"deny"}),className:t("toggle-group-item flex-1","deny"===ys.floodPolicy&&"active !text-sys-red"),children:"Deny"}),s.jsx("button",{onClick:()=>fs({...ys,floodPolicy:"allow"}),className:t("toggle-group-item flex-1","allow"===ys.floodPolicy&&"active !text-sys-green"),children:"Allow"})]})]}),ys.transport_key&&s.jsxs("div",{children:[s.jsx("label",{className:"type-label text-fg-muted block mb-2",children:"Transport Key"}),s.jsx("code",{className:"block bg-input-bg px-3 py-2 radius-inner border border-input-border type-code text-fg-muted overflow-x-auto",children:ys.transport_key})]}),s.jsxs("div",{className:"flex justify-between gap-3 mt-6",children:[s.jsx(v,{color:"danger",outline:!0,onClick:()=>{xs(!1),bs(ys),ps(!0),fs(null)},disabled:ks,children:"Delete"}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx(v,{color:"muted",outline:!0,onClick:()=>{xs(!1),fs(null)},disabled:ks,children:"Cancel"}),s.jsx(v,{color:"primary",onClick:async()=>{if(ys){Cs(!0),es(null);try{const e=await E(ys.id,{name:ys.name,flood_policy:ys.floodPolicy});e.success?(await Ys(),xs(!1),fs(null)):es(e.error||"Failed to update transport key")}catch(e){es(e instanceof Error?e.message:"Failed to update transport key")}finally{Cs(!1)}}},disabled:ks||!ys.name.trim(),children:ks?s.jsxs(s.Fragment,{children:[s.jsx(l,{"data-slot":"icon",className:"animate-spin"}),"Saving..."]}):"Save"})]})]})]})]})}),hs&&gs&&s.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&ps(!1),role:"dialog","aria-modal":"true","aria-labelledby":"delete-key-modal-title",children:s.jsxs("div",{className:"surface-modal radius-card p-6 max-w-md w-full",children:[s.jsx("h3",{id:"delete-key-modal-title",className:"type-micro mb-4",children:"Delete Transport Key"}),s.jsxs("p",{className:"text-fg-secondary mb-4",children:["Are you sure you want to delete ",s.jsxs("strong",{className:"text-fg-primary",children:["'",gs.name,"'"]}),"?"]}),gs.children&&gs.children.length>0&&s.jsx("div",{className:"bg-sys-indigo/10 border border-sys-indigo/30 radius-inner p-3 mb-4",children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx(Z,{className:"w-4 h-4 text-sys-indigo flex-shrink-0 mt-0.5"}),s.jsxs("div",{className:"text-sm text-fg-secondary",children:["This key has ",gs.children.length," child key(s). Deleting will also remove all children."]})]})}),s.jsxs("div",{className:"flex justify-end gap-3",children:[s.jsx(v,{color:"muted",outline:!0,onClick:()=>{ps(!1),bs(null)},disabled:ks,children:"Cancel"}),s.jsx(v,{color:"danger",onClick:async()=>{if(gs){Cs(!0),es(null);try{const e=await P(gs.id);e.success?(await Ys(),ps(!1),bs(null),is(null)):es(e.error||"Failed to delete transport key")}catch(e){es(e instanceof Error?e.message:"Failed to delete transport key")}finally{Cs(!1)}}},disabled:ks,children:ks?s.jsxs(s.Fragment,{children:[s.jsx(l,{"data-slot":"icon",className:"animate-spin"}),"Deleting..."]}):"Delete"})]})]})})]})}export{Me as default};
