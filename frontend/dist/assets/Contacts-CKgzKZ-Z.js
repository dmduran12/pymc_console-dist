const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ContactsMapMapLibre-CKQy2_cg.js","assets/index-C8IY8K2r.js","assets/BasemapLayer-D5WYHXmJ.js","assets/consumer-registry-lDKP4bcU.js","assets/link-scoring-CX7bMGSJ.js","assets/ConfirmModal-CNsW1W2q.js","assets/triangle-alert-8k00uu7o.js","assets/DeepAnalysisModal-B2m7JxOp.js","assets/geo-utils-BP1zBK9h.js","assets/download-IUkhheKK.js","assets/database-BEyHF_p_.js","assets/useMapViewStore-ax-BqDpg.js","assets/index-B-prVW1V.js","assets/refresh-cw-BqACEANM.js","assets/target-DviLCm8U.js","assets/funnel-BDRRJl0y.js","assets/plus-PWV57wbr.js","assets/easing-CXN4GmUW.js","assets/wifi-Cq9uCDyf.js","assets/SignalIndicator-Dw_bfp50.js","assets/chevron-right-DUgYTR6d.js","assets/node-types-3T9Wr7vI.js","assets/badge-colors-BNUqIXCA.js","assets/LightSparkline-CkL4j4OZ.js","assets/map-pin-DMVHq6j8.js","assets/ping-lLlOzF2r.js","assets/PageLayout-NQBVrM09.js","assets/listbox-BhQdM5DY.js","assets/element-movement-D4o83B2Z.js","assets/TimeRangeStepper-BlC9rlkV.js","assets/chat-utils-D1Q4VWjO.js","assets/CollisionExplorerModal-DeHgfjGl.js","assets/monitor-smartphone-DF_mmgOV.js","assets/DataBox-W2v3wy8k.js","assets/circle-question-mark-C7l07_IA.js","assets/network-DBkquEPb.js","assets/activity-2-g8m4_g.js","assets/search-zALFwCS4.js","assets/index-DUfCykEc.css","assets/BasemapLayer-B1CfjdFi.css","assets/ContactsMapMapLibre-BwWOEply.css"])))=>i.map(i=>d[i]);
import{d as O,j as e,r as n,bo as Ze,bI as Te,bJ as $e,$ as ae,w as we,a9 as Re,bK as es,bL as he,R as pe,q as k,bM as ss,L as Ee,bN as ts,J as as,bO as ns,bP as rs,bQ as os,H as is,bR as cs,bS as ls,bT as ds,K as ms,aa as xs,N as Ne,bU as us,bV as ps,b8 as te,o as hs,I as fs,bc as gs,c as ve}from"./index-C8IY8K2r.js";import{p as js}from"./ping-lLlOzF2r.js";import{c as ke}from"./node-types-3T9Wr7vI.js";import{P as bs,a as Ns,B as ys}from"./PageLayout-NQBVrM09.js";import{L as vs,a as ue}from"./listbox-BhQdM5DY.js";import{T as _e}from"./TimeRangeStepper-BlC9rlkV.js";import{u as ws,e as ks,f as Cs,r as Ms}from"./consumer-registry-lDKP4bcU.js";import{e as Ss,g as Ps,a as Rs}from"./chat-utils-D1Q4VWjO.js";import{A as _s,b as Ls,C as Ts}from"./SignalIndicator-Dw_bfp50.js";import{C as $s,S as Es}from"./CollisionExplorerModal-DeHgfjGl.js";import{E as Fs,T as Os}from"./target-DviLCm8U.js";import{D as Hs}from"./DataBox-W2v3wy8k.js";import{C as W}from"./badge-colors-BNUqIXCA.js";import{C as Fe}from"./circle-question-mark-C7l07_IA.js";import{N as zs}from"./network-DBkquEPb.js";import{A as Oe}from"./activity-2-g8m4_g.js";import{T as Ds,C as Is}from"./ConfirmModal-CNsW1W2q.js";import{M as Le}from"./monitor-smartphone-DF_mmgOV.js";import{M as As}from"./map-pin-DMVHq6j8.js";import{S as Bs}from"./search-zALFwCS4.js";/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]],Us=O("arrow-down-left",Vs);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],Gs=O("arrow-up-down",qs);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Qs=O("calendar",Ws);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=[["path",{d:"M4 12V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2",key:"jrl274"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 16h2v6",key:"1bxocy"}],["path",{d:"M10 22h4",key:"ceow96"}],["rect",{x:"2",y:"16",width:"4",height:"6",rx:"2",key:"r45zd0"}]],Js=O("file-digit",Ks);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=[["path",{d:"M2 5h20",key:"1fs1ex"}],["path",{d:"M6 12h12",key:"8npq4p"}],["path",{d:"M9 19h6",key:"456am0"}]],Xs=O("list-filter",Ys);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],et=O("move",Zs);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=[["path",{d:"M4.9 16.1C1 12.2 1 5.8 4.9 1.9",key:"s0qx1y"}],["path",{d:"M7.8 4.7a6.14 6.14 0 0 0-.8 7.5",key:"1idnkw"}],["circle",{cx:"12",cy:"9",r:"2",key:"1092wv"}],["path",{d:"M16.2 4.8c2 2 2.26 5.11.8 7.47",key:"ojru2q"}],["path",{d:"M19.1 1.9a9.96 9.96 0 0 1 0 14.1",key:"rhi7fg"}],["path",{d:"M9.5 18h5",key:"mfy3pd"}],["path",{d:"m8 22 4-11 4 11",key:"25yftu"}]],tt=O("radio-tower",st);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]],He=O("ruler",at);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],rt=O("trending-down",nt);class ot extends n.Component{constructor(i){super(i),this.state={hasError:!1}}static getDerivedStateFromError(i){return{hasError:!0,error:i}}render(){var i;return this.state.hasError?e.jsx("div",{className:"map-container-16-9 flex items-center justify-center rounded-2xl surface-base",role:"alert","aria-live":"assertive",children:e.jsxs("div",{className:"text-center text-fg-muted p-4",children:[e.jsx("p",{className:"text-lg mb-2",children:"Map failed to load"}),e.jsx("p",{className:"text-sm text-fg-muted",children:((i=this.state.error)==null?void 0:i.message)||"Unknown error"}),e.jsx("p",{className:"text-xs text-fg-muted mt-2",children:"Try refreshing the page or check your browser's WebGL support."})]})}):this.props.children}}const it=n.lazy(()=>Ze(()=>import("./ContactsMapMapLibre-CKQy2_cg.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40])));function ct({neighbors:r,localNode:i,localHash:f,onRemoveNode:x,selectedNodeHash:g,onNodeSelected:N,highlightedEdgeKey:h,highlightedGhost:d}){return e.jsx(ot,{children:e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"map-container-16-9 flex items-center justify-center rounded-2xl surface-base",role:"status","aria-live":"polite","aria-label":"Loading map",children:e.jsxs("div",{className:"text-fg-muted flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-sys-blue border-t-transparent rounded-full animate-spin","aria-hidden":"true"}),e.jsx("span",{children:"Loading map..."})]})}),children:e.jsx(it,{neighbors:r,localNode:i,localHash:f,onRemoveNode:x,selectedNodeHash:g,onNodeSelected:N,highlightedEdgeKey:h,highlightedGhost:d})})})}function lt({hash:r,className:i="",size:f="sm",collisionInfo:x,isViterbiResolved:g}){const N=Te(),h=$e(),[d,z]=n.useState(!1),C=n.useMemo(()=>ae(r),[r]),L=n.useMemo(()=>x!==void 0?x:C?N.find(u=>u.prefix===C)??null:null,[C,N,x]),T=g??(h.totalPaths>0&&h.avgPathConfidence>=.7),H=n.useCallback(u=>{u.preventDefault(),u.stopPropagation(),z(!0)},[]),D=n.useCallback(()=>{z(!1)},[]);if(!L)return null;const y=f==="sm"?"w-3.5 h-3.5":"w-4 h-4",I=T?"text-sys-cyan hover:text-sys-cyan hover:bg-sys-cyan/10 focus:ring-sys-cyan/50":"text-signal-fair hover:text-sys-indigo hover:bg-signal-fair/10 focus:ring-signal-fair/50",Q=T?`Prefix conflict resolved by Viterbi HMM (${(h.avgPathConfidence*100).toFixed(0)}% confidence)`:`Prefix conflict: ${L.candidateCount} nodes share prefix "${C}"`;return e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:H,className:`inline-flex items-center justify-center p-0.5 rounded focus:outline-none focus:ring-2 transition-colors cursor-pointer touch-manipulation ${I} ${i}`,title:Q,"aria-label":`View prefix conflict for ${C}${T?" (Viterbi resolved)":""}`,children:T?e.jsxs("span",{className:"relative",children:[e.jsx(Fs,{className:y}),e.jsx(we,{className:"absolute -bottom-0.5 -right-0.5 w-2 h-2 text-sys-green"})]}):e.jsx(Js,{className:y})}),e.jsx($s,{isOpen:d,prefix:L.prefix,candidateHashes:L.candidateHashes,onClose:D})]})}const dt=n.memo(lt),ze=[{target:"Contacts",fn:"name",minStage:1,when:ks},{target:"Contacts",fn:"traceLinks.directed",minStage:2,when:Cs}];Ms(ze);function mt(r){return r<1e3?`${Math.round(r)}m`:`${(r/1e3).toFixed(1)}km`}function xt({hash:r,contact:i,isHub:f,isNeighbor:x,distance:g,centrality:N,sparklineData:h,neighborSignal:d,collisionInfo:z,isViterbiResolved:C,isPinging:L,isPingingThis:T,pingResult:H,pingError:D,gatewayInfo:y,lastForwarderPrefix:I,isMobile:Q,pathStability:u,onRowClick:K,onPing:$,onRemove:fe}){ws(ze);const V=i.latitude&&i.longitude&&i.latitude!==0&&i.longitude!==0,E=i.node_name||i.name||"Unknown",v=x&&d,ne=ke(i),{isRepeater:P,isCompanion:J,isRoomServer:j,isClient:Y,label:X}=ne,re=x?`${X} — Direct RF contact (zero-hop neighbor)`:`${X} — Flood routing (multi-hop via mesh)`,Z=i.first_seen?Re(i.first_seen).replace(/ ago$/i," old"):null;return e.jsxs("div",{className:`contacts-grid-row ${f?"bg-sys-amber/5 border-l-2 border-l-sys-amber":""} ${V?"cursor-pointer hover:bg-subtle-fill":""}`,onClick:()=>K(r),children:[e.jsxs("div",{className:"contacts-col-node flex items-center gap-2 min-w-0",children:[v&&(d==null?void 0:d.avgSnr)!==null?e.jsx("div",{className:`w-2 h-2 rounded-full flex-shrink-0 self-center ${es(d.avgSnr)}`}):e.jsx("div",{className:"w-2 flex-shrink-0"}),e.jsx("div",{className:"w-6 h-6 flex items-center justify-center flex-shrink-0",title:re,children:(()=>{if(j&&P)return e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx(he,{className:"w-5 h-5 absolute inset-0 text-sys-pink"}),e.jsx(Es,{className:"w-2.5 h-2.5 absolute -bottom-0.5 -right-0.5 text-sys-teal"})]});if(j)return e.jsx(he,{className:"w-5 h-5 text-sys-pink"});if(P)return e.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center ring-[1.5px] ring-sys-blue",children:e.jsx(pe,{className:"w-3.5 h-3.5 text-sys-blue"})});if((J||Y)&&E!=="Unknown"){const{emoji:w,cleanName:R}=Ss(E);return e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center",style:{backgroundColor:Ps(R)},children:w?e.jsx("span",{className:"text-sm leading-none",children:w}):e.jsx("span",{className:"text-white text-[9px] font-bold tracking-tighter",children:Rs(E)})})}return e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center bg-zinc-500/20",children:e.jsx(Fe,{className:"w-3.5 h-3.5 text-sys-amber"})})})()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 overflow-hidden",children:[e.jsx("span",{className:"roster-title truncate",title:E,children:E}),x&&e.jsx(k,{color:W.neighbor,compact:!0,className:"flex-shrink-0",children:"NBR"}),f&&e.jsxs(k,{color:W.hub,compact:!0,className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx(zs,{className:"w-3 h-3"}),"HUB"]}),P&&e.jsx(k,{color:W.repeater,compact:!0,className:"flex-shrink-0",children:"RPT"}),j&&e.jsx(k,{color:W.room,compact:!0,className:"flex-shrink-0",children:"ROOM"}),J&&e.jsx(k,{color:W.companion,compact:!0,className:"flex-shrink-0",children:"COMP"}),Y&&e.jsx(k,{color:W.client,compact:!0,className:"flex-shrink-0",children:"CLIENT"}),Q&&e.jsxs(k,{color:"cyan",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0",children:[e.jsx(et,{className:"w-2.5 h-2.5"}),"MOBILE"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[e.jsx(Hs,{copy:!0,size:"compact",truncate:[8,6],children:r}),e.jsx(dt,{hash:r,collisionInfo:z,isViterbiResolved:C}),!x&&y&&e.jsxs(k,{color:"zinc",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0",title:`Via ${y.name||y.prefix} (${y.hopCount} hop${y.hopCount!==1?"s":""})`,children:[e.jsx(_s,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"font-mono",children:y.prefix}),y.hopCount>1&&e.jsxs("span",{className:"opacity-60",children:["+",y.hopCount-1]})]}),I&&!x&&e.jsxs(k,{color:"zinc",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0",title:`Last forwarded by ${I}`,children:[e.jsx(Us,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"font-mono",children:I})]}),u!=null&&u!==0&&e.jsx(k,{color:u>0?"green":"amber",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0",title:u>0?"Path stability improving":"Path stability declining",children:u>0?e.jsx(ss,{className:"w-2.5 h-2.5"}):e.jsx(rt,{className:"w-2.5 h-2.5"})}),h.length>0&&(()=>{const w=h.reduce((oe,ge)=>oe+ge.count,0);if(w===0)return null;const R=w/24;return e.jsxs(k,{color:"zinc",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0",title:`${w} packets in last 24h (~${R.toFixed(1)}/hr)`,children:[e.jsx(tt,{className:"w-2.5 h-2.5"}),e.jsxs("span",{children:[R<1?"<1":R.toFixed(0),"/hr"]})]})})(),Z&&e.jsxs(k,{color:"zinc",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0 opacity-70",title:`First discovered ${Z}`,children:[e.jsx(Qs,{className:"w-2.5 h-2.5"}),e.jsx("span",{children:Z})]})]})]})]}),e.jsxs("div",{className:"contacts-col-signal flex items-center justify-end gap-2",children:[v&&(d==null?void 0:d.avgRssi)!==null&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ls,{rssi:d.avgRssi,className:"w-3.5 h-3.5"}),e.jsx("span",{className:"type-data-xs text-fg-muted",children:Math.round(d.avgRssi)})]}),v&&(d==null?void 0:d.avgSnr)!==null&&e.jsxs("span",{className:"type-data-xs text-fg-muted",children:[d.avgSnr.toFixed(1)," dB"]})]}),e.jsx("div",{className:"contacts-col-distance flex items-center justify-end gap-1 text-fg-muted",children:g!=null&&e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"w-3 h-3"}),e.jsx("span",{className:"type-data-xs",children:mt(g)})]})}),e.jsx("div",{className:"contacts-col-centrality flex items-center justify-end gap-1",children:N>0&&e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-3 h-3 text-sys-indigo"}),e.jsxs("span",{className:"type-data-xs text-fg-muted",children:[(N*100).toFixed(0),"%"]})]})}),e.jsx("div",{className:"contacts-col-seen flex items-center justify-end",children:e.jsx("span",{className:"type-data-xs text-fg-primary whitespace-nowrap",children:i.last_seen?Re(i.last_seen):"—"})}),e.jsxs("div",{className:"contacts-col-actions flex items-center justify-end gap-1",children:[x&&e.jsx(e.Fragment,{children:H?e.jsxs("div",{className:"flex items-center gap-1 text-sys-green",title:`RTT: ${H.rtt_ms.toFixed(0)}ms`,children:[e.jsx(we,{className:"w-3.5 h-3.5"}),e.jsxs("span",{className:"type-data-xs hidden sm:inline",children:[H.snr_db.toFixed(1),"dB"]})]}):D?e.jsx("span",{className:"text-sys-red text-xs",title:D,children:"✗"}):e.jsx("button",{onClick:w=>$(r,w),disabled:L,className:"p-1 sm:p-1.5 radius-inner text-fg-muted/50 hover:text-sys-blue hover:bg-sys-blue/10 transition-base disabled:opacity-50 disabled:cursor-not-allowed",title:"Ping neighbor for updated signal info",children:T?e.jsx(Ee,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 animate-spin"}):e.jsx(Os,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})}),e.jsx("button",{onClick:w=>{w.stopPropagation(),fe(r,E)},className:"p-1 sm:p-1.5 radius-inner text-fg-muted/50 hover:text-sys-red hover:bg-sys-red/10 transition-base",title:"Remove contact",children:e.jsx(Ds,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})]})]})}const ut=n.memo(xt),pt=6371e3,ht=[],ft=[{field:"lastHeard",icon:Ts,label:"Recent"},{field:"distance",icon:He,label:"Distance"},{field:"centrality",icon:Oe,label:"Centrality"}];function gt(r){switch(r){case"room_server":return"room";case"repeater":return"repeater";case"companion":return"companion";case"unknown":return"companion"}}function jt(r){const i=ke(r);return gt(i.type)}function ye(r,i){const{color:f="primary",border:x=!1}=i??{};return ve("flex items-center gap-1.5 px-2 py-1.5 text-sm radius-inner transition-base",r?f==="success"?"bg-sys-green/20 text-sys-green":"bg-sys-blue/20 text-sys-blue":"text-fg-muted hover:text-fg-secondary hover-bg",x&&(r?f==="success"?"border border-sys-green/30":"border border-sys-blue/30":"border border-transparent"))}function bt(r,i,f,x){const g=(f-r)*Math.PI/180,N=(x-i)*Math.PI/180,h=Math.sin(g/2)*Math.sin(g/2)+Math.cos(r*Math.PI/180)*Math.cos(f*Math.PI/180)*Math.sin(N/2)*Math.sin(N/2),d=2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h));return pt*d}function Nt(){const{stats:r}=ts(),i=as(),f=ns(),x=rs(),g=os(),N=is(),h=cs(),d=ls(),z=ds(),C=ms(),L=xs(),T=Ne[C],H=Te(),D=$e(),y=us(),I=D.totalPaths>0&&D.avgPathConfidence>=.7,Q=n.useMemo(()=>{const s=new Map;for(const t of H)s.set(t.prefix,t);return s},[H]),[u,K]=n.useState(null),[$,fe]=n.useState("lastHeard"),[V,E]=n.useState("desc"),[v,ne]=n.useState(""),[P,J]=n.useState(!1),[j,Y]=n.useState(new Set),[X,re]=n.useState(!1),[Z,w]=n.useState(null),[R,oe]=n.useState(null),[ge,je]=n.useState(new Map),[De,ee]=n.useState(new Map),[M,Ie]=n.useState(25),[U,ie]=n.useState(25),be=n.useRef(null),ce=n.useMemo(()=>(r==null?void 0:r.neighbors)??{},[r==null?void 0:r.neighbors]),A=n.useMemo(()=>{const t=Date.now()/1e3-T.minutes*60;return Object.fromEntries(Object.entries(ce).filter(([a,o])=>i.has(a)?!1:(o.last_seen??0)>=t))},[ce,i,T.minutes]),_=ps(),q=r==null?void 0:r.local_hash,Ae=n.useMemo(()=>{const s=new Map;if(!q||h.size===0)return s;for(const[t,a]of h)if(t.endsWith(`→${q}`)&&a.hops.length>1){const o=t.split("→")[0],c=a.hops[a.hops.length-1];s.set(o,c)}return s},[h,q]),le=n.useMemo(()=>{const s=new Map;if(!(_!=null&&_.latitude)||!(_!=null&&_.longitude))return s;for(const[t,a]of Object.entries(A))a.latitude&&a.longitude&&a.latitude!==0&&a.longitude!==0?s.set(t,bt(_.latitude,_.longitude,a.latitude,a.longitude)):s.set(t,null);return s},[A,_]),{neighborHashSet:de,neighborSignalMap:Be}=n.useMemo(()=>{const s=new Set,t=new Map;for(const a of N)s.add(a.hash),t.set(a.hash,{avgRssi:a.avgRssi,avgSnr:a.avgSnr});return{neighborHashSet:s,neighborSignalMap:t}},[N]),Ce=n.useMemo(()=>{const s=v.toLowerCase().trim(),t=s==="neighbor"||s==="neighbors",a=P||t,o=j.size>0;return Object.fromEntries(Object.entries(A).filter(([c,l])=>{if(o){const S=jt(l);if(!j.has(S))return!1}if(a&&!de.has(c))return!1;if(t||!s)return!0;const B=(l.node_name||l.name||"").toLowerCase(),b=ae(c).toLowerCase();return B.includes(s)||b.includes(s)||c.toLowerCase().includes(s)}))},[A,v,P,de,j]),p=n.useMemo(()=>{const s=Object.entries(Ce),t=v.toLowerCase().trim(),a=t.length===2&&/^[0-9a-f]{2}$/i.test(t);return s.sort(([o,c],[l,B])=>{if(a){const S=ae(o).toLowerCase(),F=ae(l).toLowerCase(),se=S===t,me=F===t;if(se&&!me)return-1;if(me&&!se)return 1}let b=0;switch($){case"lastHeard":b=(c.last_seen||0)-(B.last_seen||0);break;case"distance":{const S=le.get(o)??null,F=le.get(l)??null;S===null&&F===null?b=0:S===null?b=1:F===null?b=-1:b=S-F;break}case"centrality":{const S=g.get(o)||0,F=g.get(l)||0;b=S-F;break}}return V==="desc"?-b:b})},[Ce,$,V,le,g,v]),m=n.useMemo(()=>{let s=0,t=0,a=0,o=0,c=0;for(const[,l]of p){const B=ke(l),b=l.latitude&&l.longitude&&l.latitude!==0&&l.longitude!==0;switch(B.type){case"room_server":a++;break;case"repeater":t++;break;case"companion":s++;break;case"unknown":c++;break}b&&o++}return{companions:s,repeaters:t,roomServers:a,total:p.length,withLocation:o,unknown:c}},[p]),Ve=n.useMemo(()=>new Set(x),[x]),Me=n.useMemo(()=>M===0?p:p.slice(0,U),[p,U,M]);n.useEffect(()=>{ie(M||p.length)},[$,V,v,P,j,M,p.length]),n.useEffect(()=>{const s=t=>{t.target.closest("[data-dropdown]")||re(!1)};return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[]),n.useEffect(()=>{if(M===0)return;const s=new IntersectionObserver(t=>{t[0].isIntersecting&&U<p.length&&ie(a=>Math.min(a+M,p.length))},{threshold:.1,rootMargin:"100px"});return be.current&&s.observe(be.current),()=>s.disconnect()},[M,U,p.length]);const Ue=n.useCallback(s=>{Ie(s),ie(s||p.length)},[p.length]),qe=n.useCallback(s=>{$===s?E(t=>t==="desc"?"asc":"desc"):(fe(s),E("desc"))},[$]),Ge=n.useCallback(s=>{const t=A[s];t!=null&&t.latitude&&(t!=null&&t.longitude)&&t.latitude!==0&&t.longitude!==0&&w(s)},[A]),We=n.useCallback(()=>{w(null)},[]),Qe=n.useCallback((s,t)=>{K({hash:s,name:t})},[]),Ke=n.useCallback(async(s,t)=>{if(t.stopPropagation(),!R){oe(s),je(a=>{const o=new Map(a);return o.delete(s),o}),ee(a=>{const o=new Map(a);return o.delete(s),o});try{const a=s.startsWith("0x")?s.slice(0,4):`0x${s.slice(0,2)}`,o=await js(a,30);o.success&&o.data?(je(c=>new Map(c).set(s,o.data)),setTimeout(()=>{je(c=>{const l=new Map(c);return l.delete(s),l})},1e4)):(ee(c=>new Map(c).set(s,o.error||"Ping failed")),setTimeout(()=>{ee(c=>{const l=new Map(c);return l.delete(s),l})},5e3))}catch(a){const o=a instanceof Error?a.message:"Ping failed";ee(c=>new Map(c).set(s,o)),setTimeout(()=>{ee(c=>{const l=new Map(c);return l.delete(s),l})},5e3)}finally{oe(null)}}},[R]);return e.jsxs(bs,{children:[e.jsx(Ns,{title:"Contacts",icon:e.jsx(te,{}),controls:e.jsxs("div",{className:"flex items-center gap-3 sm:gap-5",children:[e.jsxs("div",{className:"hidden sm:flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs text-fg-muted",children:"Total:"}),e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:`${m.total} discovered node${m.total!==1?"s":""} on the mesh network`,children:[e.jsx(te,{className:"w-3.5 h-3.5 text-fg-secondary"}),e.jsx("span",{children:m.total})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs text-fg-muted",children:"Types:"}),m.repeaters>0&&e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:"Repeaters",children:[e.jsx(pe,{className:"w-3.5 h-3.5 text-sys-blue"}),e.jsx("span",{children:m.repeaters})]}),m.companions>0&&e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:"Companions",children:[e.jsx(Le,{className:"w-3.5 h-3.5 text-fg-muted"}),e.jsx("span",{children:m.companions})]}),m.roomServers>0&&e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:"Room Servers",children:[e.jsx(he,{className:"w-3.5 h-3.5 text-sys-pink"}),e.jsx("span",{children:m.roomServers})]}),m.withLocation>0&&e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:"With GPS location",children:[e.jsx(As,{className:"w-3.5 h-3.5 text-sys-green"}),e.jsx("span",{children:m.withLocation})]}),m.unknown>0&&e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:"Unknown type",children:[e.jsx(Fe,{className:"w-3.5 h-3.5 text-sys-amber"}),e.jsx("span",{children:m.unknown})]})]})]}),e.jsxs("div",{className:"flex sm:hidden items-center gap-1.5",children:[e.jsxs("span",{className:"data-box !px-1.5 !py-0.5 !text-[10px] flex items-center gap-1",children:[e.jsx(te,{className:"w-3 h-3 text-fg-secondary"}),e.jsx("span",{children:m.total})]}),m.repeaters>0&&e.jsxs("span",{className:"data-box !px-1.5 !py-0.5 !text-[10px] flex items-center gap-1",children:[e.jsx(pe,{className:"w-3 h-3 text-sys-blue"}),e.jsx("span",{children:m.repeaters})]}),m.companions>0&&e.jsxs("span",{className:"data-box !px-1.5 !py-0.5 !text-[10px] flex items-center gap-1",children:[e.jsx(Le,{className:"w-3 h-3 text-fg-muted"}),e.jsx("span",{children:m.companions})]}),m.roomServers>0&&e.jsxs("span",{className:"data-box !px-1.5 !py-0.5 !text-[10px] flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3 text-sys-pink"}),e.jsx("span",{children:m.roomServers})]}),e.jsx(_e,{ranges:Ne,selectedIndex:C,onSelect:L,size:"sm"})]}),e.jsx("div",{className:"hidden sm:block",children:e.jsx(_e,{ranges:Ne,selectedIndex:C,onSelect:L})})]})}),e.jsxs(ys,{children:[z?e.jsx(ct,{neighbors:A,localNode:_??void 0,localHash:q,onRemoveNode:f,selectedNodeHash:Z,onNodeSelected:We}):e.jsx("div",{className:"surface-base radius-card aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-sys-blue border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm text-fg-muted",children:"Loading map..."})]})}),e.jsx(hs,{noPadding:!0,children:z?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2.5 border-b border-edge-subtle",children:[e.jsx("span",{className:"icon-md flex items-center justify-center text-icon-card-title flex-shrink-0",children:e.jsx(te,{})}),e.jsx("span",{className:"type-micro flex-shrink-0 mr-auto hidden sm:block",children:"Discovered Contacts"}),e.jsx(fs,{type:"search",size:"sm",value:v,onChange:s=>ne(s.target.value),placeholder:"Search...",leadingIcon:e.jsx(Bs,{className:"w-3.5 h-3.5"}),trailingIcon:v?e.jsx("button",{onClick:()=>{ne(""),(v.toLowerCase().trim()==="neighbor"||v.toLowerCase().trim()==="neighbors")&&J(!1)},className:"text-fg-muted hover:text-fg-secondary",children:e.jsx(gs,{className:"w-3 h-3"})}):void 0,className:"w-24 sm:w-32 xl:w-44","aria-label":"Search contacts"}),e.jsx("div",{className:"h-4 w-px bg-border-subtle flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsxs("div",{className:"relative","data-dropdown":!0,children:[e.jsxs("button",{onClick:()=>re(!X),className:ye(j.size>0,{border:!0}),title:"Filter by contact type",children:[e.jsx(Xs,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden xl:inline",children:"Filter"}),j.size>0&&e.jsx("span",{className:"tabular-nums text-xs bg-sys-blue/30 px-1 rounded",children:j.size})]}),X&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 z-50 surface-elevated radius-inner py-1 min-w-[140px]",children:[[{key:"repeater",label:"Repeaters"},{key:"companion",label:"Companions"},{key:"room",label:"Rooms"}].map(({key:s,label:t})=>e.jsxs("button",{onClick:()=>{Y(a=>{const o=new Set(a);return o.has(s)?o.delete(s):o.add(s),o})},className:"w-full px-3 py-1.5 text-sm text-left hover-bg transition-base flex items-center gap-2",children:[e.jsx("span",{className:ve("w-4 h-4 flex items-center justify-center radius-badge border",j.has(s)?"bg-sys-blue border-sys-blue text-white":"border-edge-subtle"),children:j.has(s)&&e.jsx(we,{className:"w-3 h-3"})}),e.jsx("span",{className:j.has(s)?"text-fg-primary":"text-fg-secondary",children:t})]},s)),j.size>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-edge-subtle my-1"}),e.jsx("button",{onClick:()=>Y(new Set),className:"w-full px-3 py-1.5 text-sm text-left text-fg-muted hover:text-fg-secondary hover-bg transition-base",children:"Clear filters"})]})]})]}),de.size>0&&e.jsxs("button",{onClick:()=>J(!P),className:ye(P,{color:"success",border:!0}),title:P?"Show all contacts":"Show only MeshCore neighbors (direct RF contact)",children:[e.jsx(pe,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden xl:inline",children:"Neighbors"})]})]}),e.jsx("div",{className:"h-4 w-px bg-border-subtle flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[ft.map(({field:s,icon:t,label:a})=>e.jsxs("button",{onClick:()=>qe(s),className:ye($===s),title:`Sort by ${a.toLowerCase()}`,children:[e.jsx(t,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden xl:inline",children:a}),$===s&&e.jsx(Gs,{className:ve("w-3 h-3",V==="asc"&&"rotate-180")})]},s)),e.jsx("div",{className:"h-4 w-px bg-border-subtle"}),e.jsxs(vs,{value:M,onChange:Ue,className:"w-auto min-w-[50px] [&_button]:py-1 [&_button]:px-2 [&_button]:text-xs [&_button]:min-h-0","aria-label":"Items per page",children:[e.jsx(ue,{value:25,children:"25"}),e.jsx(ue,{value:50,children:"50"}),e.jsx(ue,{value:100,children:"100"}),e.jsx(ue,{value:0,children:"All"})]})]})]}),p.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden sm:grid contacts-grid-header border-b border-edge-subtle/50 px-3 py-2 type-micro text-fg-muted",children:[e.jsx("div",{className:"contacts-col-node",children:"Node"}),e.jsx("div",{className:"contacts-col-signal text-right",children:"Signal"}),e.jsx("div",{className:"contacts-col-distance text-right",children:"Distance"}),e.jsx("div",{className:"contacts-col-centrality text-right",children:"Centrality"}),e.jsx("div",{className:"contacts-col-seen text-right",children:"Last Seen"}),e.jsx("div",{className:"contacts-col-actions"})]}),e.jsx("div",{className:"divide-y divide-edge-subtle/30",children:Me.map(([s,t])=>{const a=ae(s),o=Ve.has(s),c=de.has(s),l=le.get(s)??null,B=g.get(s)||0,b=c?Be.get(s):void 0,S=a?Q.get(a)??null:null,F=y.get(s)??ht;let se=null;if(!c&&q&&h.size>0){const Ye=`${s}→${q}`,xe=h.get(Ye);if(xe&&xe.hops.length>0){const Se=xe.hops[0],Pe=Object.keys(ce).find(Xe=>Xe.toUpperCase().startsWith(Se.toUpperCase())),G=Pe?ce[Pe]:null;se={prefix:Se,name:(G==null?void 0:G.node_name)??(G==null?void 0:G.name)??null,hopCount:xe.hopCount}}}const me=d.has(s),Je=Ae.get(s)??null;return e.jsx(ut,{hash:s,contact:t,isHub:o,isNeighbor:c,distance:l,centrality:B,sparklineData:F,neighborSignal:b,collisionInfo:S,isViterbiResolved:I,isPinging:R!==null,isPingingThis:R===s,pingResult:ge.get(s),pingError:De.get(s),gatewayInfo:se,lastForwarderPrefix:Je,isMobile:me,onRowClick:Ge,onPing:Ke,onRemove:Qe},s)})}),M>0&&U<p.length&&e.jsxs("div",{ref:be,className:"flex items-center justify-center py-4 text-fg-muted",children:[e.jsx(Ee,{className:"w-4 h-4 animate-spin mr-2"}),e.jsx("span",{className:"text-xs",children:"Loading more..."})]}),e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-t border-edge-subtle/50 text-xs text-fg-muted",children:[e.jsxs("span",{className:"tabular-nums",children:["Showing ",Me.length," of ",p.length]}),M>0&&U<p.length&&e.jsx("button",{onClick:()=>ie(s=>Math.min(s+M,p.length)),className:"text-sys-blue hover:text-sys-blue/80 transition-base",children:"Load more"})]})]}):e.jsxs("div",{className:"roster-empty",children:[e.jsx(te,{className:"roster-empty-icon"}),e.jsx("div",{className:"type-label text-fg-secondary",children:"No Contacts Discovered"}),e.jsx("div",{className:"type-data-xs text-fg-muted mt-1",children:"Contacts will appear here as they advertise on the mesh network."})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-edge-subtle",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-elevated animate-pulse"}),e.jsx("div",{className:"w-32 h-4 rounded bg-elevated animate-pulse"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 h-6 rounded bg-elevated animate-pulse"}),e.jsx("div",{className:"w-24 h-6 rounded bg-elevated animate-pulse"}),e.jsx("div",{className:"w-16 h-6 rounded bg-elevated animate-pulse"})]})]}),e.jsx("div",{className:"px-3 py-3 space-y-3",children:[...Array(5)].map((s,t)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded bg-elevated animate-pulse"}),e.jsxs("div",{className:"flex-1 space-y-1.5",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-elevated animate-pulse"}),e.jsx("div",{className:"h-3 w-24 rounded bg-elevated animate-pulse"})]}),e.jsx("div",{className:"w-12 h-4 rounded bg-elevated animate-pulse"}),e.jsx("div",{className:"w-16 h-4 rounded bg-elevated animate-pulse"})]},t))})]})})]}),e.jsx(Is,{isOpen:!!u,title:"Remove Contact",message:`Are you sure you would like to remove ${(u==null?void 0:u.name)||"this contact"}?`,confirmLabel:"Remove",cancelLabel:"Cancel",variant:"danger",onConfirm:()=>{u&&f(u.hash),K(null)},onCancel:()=>K(null)})]})}const At=Object.freeze(Object.defineProperty({__proto__:null,default:Nt},Symbol.toStringTag,{value:"Module"}));export{At as C,dt as P,He as R,rt as T};
