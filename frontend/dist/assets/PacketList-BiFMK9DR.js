const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PathMapMapLibre-B3ia8Mj4.js","assets/index-C1ZF7cAz.js","assets/BasemapLayer-CfNM-FKA.js","assets/useMapViewStore-px_sYTaN.js","assets/index-DCNWD5GU.js","assets/index-DWhIzXT2.css","assets/BasemapLayer-B1CfjdFi.css"])))=>i.map(i=>d[i]);
import{r as p,aD as ds,d as me,bd as xs,be as zt,bf as ms,bg as hs,j as e,c as R,B as rt,bh as us,x as it,q as B,bi as Ft,R as de,bj as It,bk as At,bl as Dt,bm as ue,bn as Ze,$ as De,bo as ps,bp as fs,bq as gs,br as ys,bs as js,m as oe,a7 as re,w as bs,bt as Ns,bu as ie,bv as ut,bw as vs,bx as ws,by as ks,bz as Cs,bA as Ss,bB as _s,bC as Je,bD as Ms,a3 as Ts,E as Ht,bE as Ps,bF as Bs,bG as Ls,bH as Rs,ac as Ot,ad as $t,A as Ke,bI as Es,ae as zs,bJ as Fs,bK as lt}from"./index-C1ZF7cAz.js";import{p as Is,d as As,e as Ut,g as Ds,b as Hs}from"./primitives-DyUGjsV_.js";import{u as Os,r as $s,a as Us,b as Vs,c as Ws,d as Gs,i as Qs}from"./consumer-registry-CFnLzQEu.js";import{D as Pe,R as He,P as Be,g as qs}from"./badge-colors-BNUqIXCA.js";import{g as Vt,e as _e,a as Wt}from"./chat-utils-BzC-Ehs-.js";import{P as Gt,d as Qt,a as Ks,b as Ys}from"./payload-decoders-CmuRVuC0.js";import{A as pe,S as Oe,i as $e,C as xe,a as Xs,g as pt}from"./SignalIndicator-BDLlaquA.js";import{a as Zs,A as qt}from"./arrow-up-DhGrEgP7.js";import{C as ct}from"./chevron-right-DzbDJf-i.js";import{M as Ue}from"./map-pin-DEktgLFN.js";import{C as Js}from"./circle-question-mark-CxqvWhsl.js";import{T as et}from"./triangle-alert-B3ZB2VPZ.js";import{D as X}from"./DataBox-BADtaCfB.js";import{L as ea}from"./layers-BNenbfjd.js";import{H as Kt}from"./hash-2pKM_KWy.js";import{A as ta}from"./activity-Bmh45lNn.js";import{C as sa}from"./circle-check-DY6oislV.js";import{D as aa}from"./database-CdKnhwkJ.js";import{H as na,D as tt,Z as ft,u as ra}from"./useMapViewStore-px_sYTaN.js";import{S as we}from"./shield-BNyjVgrV.js";import{C as Yt}from"./TimeRangeStepper-CxA2aT1o.js";function ke(t,n,s){let a=s.initialDeps??[],r,i=!0;function l(){var c,o,u;let x;s.key&&((c=s.debug)!=null&&c.call(s))&&(x=Date.now());const g=t();if(!(g.length!==a.length||g.some((m,v)=>a[v]!==m)))return r;a=g;let y;if(s.key&&((o=s.debug)!=null&&o.call(s))&&(y=Date.now()),r=n(...g),s.key&&((u=s.debug)!=null&&u.call(s))){const m=Math.round((Date.now()-x)*100)/100,v=Math.round((Date.now()-y)*100)/100,T=v/16,h=(N,j)=>{for(N=String(N);N.length<j;)N=" "+N;return N};console.info(`%c⏱ ${h(v,5)} /${h(m,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*T,120))}deg 100% 31%);`,s==null?void 0:s.key)}return s!=null&&s.onChange&&!(i&&s.skipInitialOnChange)&&s.onChange(r),i=!1,r}return l.updateDeps=c=>{a=c},l}function gt(t,n){if(t===void 0)throw new Error("Unexpected undefined");return t}const ia=(t,n)=>Math.abs(t-n)<1.01,la=(t,n,s)=>{let a;return function(...r){t.clearTimeout(a),a=t.setTimeout(()=>n.apply(this,r),s)}},yt=t=>{const{offsetWidth:n,offsetHeight:s}=t;return{width:n,height:s}},ca=t=>t,oa=t=>{const n=Math.max(t.startIndex-t.overscan,0),s=Math.min(t.endIndex+t.overscan,t.count-1),a=[];for(let r=n;r<=s;r++)a.push(r);return a},da=(t,n)=>{const s=t.scrollElement;if(!s)return;const a=t.targetWindow;if(!a)return;const r=l=>{const{width:c,height:o}=l;n({width:Math.round(c),height:Math.round(o)})};if(r(yt(s)),!a.ResizeObserver)return()=>{};const i=new a.ResizeObserver(l=>{const c=()=>{const o=l[0];if(o!=null&&o.borderBoxSize){const u=o.borderBoxSize[0];if(u){r({width:u.inlineSize,height:u.blockSize});return}}r(yt(s))};t.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(c):c()});return i.observe(s,{box:"border-box"}),()=>{i.unobserve(s)}},jt={passive:!0},bt=typeof window>"u"?!0:"onscrollend"in window,xa=(t,n)=>{const s=t.scrollElement;if(!s)return;const a=t.targetWindow;if(!a)return;let r=0;const i=t.options.useScrollendEvent&&bt?()=>{}:la(a,()=>{n(r,!1)},t.options.isScrollingResetDelay),l=x=>()=>{const{horizontal:g,isRtl:f}=t.options;r=g?s.scrollLeft*(f&&-1||1):s.scrollTop,i(),n(r,x)},c=l(!0),o=l(!1);s.addEventListener("scroll",c,jt);const u=t.options.useScrollendEvent&&bt;return u&&s.addEventListener("scrollend",o,jt),()=>{s.removeEventListener("scroll",c),u&&s.removeEventListener("scrollend",o)}},ma=(t,n,s)=>{if(n!=null&&n.borderBoxSize){const a=n.borderBoxSize[0];if(a)return Math.round(a[s.options.horizontal?"inlineSize":"blockSize"])}return t[s.options.horizontal?"offsetWidth":"offsetHeight"]},ha=(t,{adjustments:n=0,behavior:s},a)=>{var r,i;const l=t+n;(i=(r=a.scrollElement)==null?void 0:r.scrollTo)==null||i.call(r,{[a.options.horizontal?"left":"top"]:l,behavior:s})};class ua{constructor(n){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.currentScrollToIndex=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let s=null;const a=()=>s||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:s=new this.targetWindow.ResizeObserver(r=>{r.forEach(i=>{const l=()=>{this._measureElement(i.target,i)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(l):l()})}));return{disconnect:()=>{var r;(r=a())==null||r.disconnect(),s=null},observe:r=>{var i;return(i=a())==null?void 0:i.observe(r,{box:"border-box"})},unobserve:r=>{var i;return(i=a())==null?void 0:i.unobserve(r)}}})(),this.range=null,this.setOptions=s=>{Object.entries(s).forEach(([a,r])=>{typeof r>"u"&&delete s[a]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:ca,rangeExtractor:oa,onChange:()=>{},measureElement:ma,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...s}},this.notify=s=>{var a,r;(r=(a=this.options).onChange)==null||r.call(a,this,s)},this.maybeNotify=ke(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),s=>{this.notify(s)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(s=>s()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var s;const a=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==a){if(this.cleanup(),!a){this.maybeNotify();return}this.scrollElement=a,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((s=this.scrollElement)==null?void 0:s.window)??null,this.elementsCache.forEach(r=>{this.observer.observe(r)}),this.unsubs.push(this.options.observeElementRect(this,r=>{this.scrollRect=r,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(r,i)=>{this.scrollAdjustments=0,this.scrollDirection=i?this.getScrollOffset()<r?"forward":"backward":null,this.scrollOffset=r,this.isScrolling=i,this.maybeNotify()})),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0})}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(s,a)=>{const r=new Map,i=new Map;for(let l=a-1;l>=0;l--){const c=s[l];if(r.has(c.lane))continue;const o=i.get(c.lane);if(o==null||c.end>o.end?i.set(c.lane,c):c.end<o.end&&r.set(c.lane,!0),r.size===this.options.lanes)break}return i.size===this.options.lanes?Array.from(i.values()).sort((l,c)=>l.end===c.end?l.index-c.index:l.end-c.end)[0]:void 0},this.getMeasurementOptions=ke(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(s,a,r,i,l,c)=>(this.prevLanes!==void 0&&this.prevLanes!==c&&(this.lanesChangedFlag=!0),this.prevLanes=c,this.pendingMeasuredCacheIndexes=[],{count:s,paddingStart:a,scrollMargin:r,getItemKey:i,enabled:l,lanes:c}),{key:!1}),this.getMeasurements=ke(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:s,paddingStart:a,scrollMargin:r,getItemKey:i,enabled:l,lanes:c},o)=>{if(!l)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>s)for(const f of this.laneAssignments.keys())f>=s&&this.laneAssignments.delete(f);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),this.measurementsCache.length===0&&!this.lanesSettling&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(f=>{this.itemSizeCache.set(f.key,f.size)}));const u=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===s&&(this.lanesSettling=!1);const x=this.measurementsCache.slice(0,u),g=new Array(c).fill(void 0);for(let f=0;f<u;f++){const y=x[f];y&&(g[y.lane]=f)}for(let f=u;f<s;f++){const y=i(f),m=this.laneAssignments.get(f);let v,T;if(m!==void 0&&this.options.lanes>1){v=m;const C=g[v],k=C!==void 0?x[C]:void 0;T=k?k.end+this.options.gap:a+r}else{const C=this.options.lanes===1?x[f-1]:this.getFurthestMeasurement(x,f);T=C?C.end+this.options.gap:a+r,v=C?C.lane:f%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(f,v)}const h=o.get(y),N=typeof h=="number"?h:this.options.estimateSize(f),j=T+N;x[f]={index:f,start:T,size:N,end:j,key:y,lane:v},g[v]=f}return this.measurementsCache=x,x},{key:!1,debug:()=>this.options.debug}),this.calculateRange=ke(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(s,a,r,i)=>this.range=s.length>0&&a>0?pa({measurements:s,outerSize:a,scrollOffset:r,lanes:i}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=ke(()=>{let s=null,a=null;const r=this.calculateRange();return r&&(s=r.startIndex,a=r.endIndex),this.maybeNotify.updateDeps([this.isScrolling,s,a]),[this.options.rangeExtractor,this.options.overscan,this.options.count,s,a]},(s,a,r,i,l)=>i===null||l===null?[]:s({startIndex:i,endIndex:l,overscan:a,count:r}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=s=>{const a=this.options.indexAttribute,r=s.getAttribute(a);return r?parseInt(r,10):(console.warn(`Missing attribute name '${a}={index}' on measured element.`),-1)},this._measureElement=(s,a)=>{const r=this.indexFromElement(s),i=this.measurementsCache[r];if(!i)return;const l=i.key,c=this.elementsCache.get(l);c!==s&&(c&&this.observer.unobserve(c),this.observer.observe(s),this.elementsCache.set(l,s)),s.isConnected&&this.resizeItem(r,this.options.measureElement(s,a,this))},this.resizeItem=(s,a)=>{const r=this.measurementsCache[s];if(!r)return;const i=this.itemSizeCache.get(r.key)??r.size,l=a-i;l!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(r,l,this):r.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=l,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(r.index),this.itemSizeCache=new Map(this.itemSizeCache.set(r.key,a)),this.notify(!1))},this.measureElement=s=>{if(!s){this.elementsCache.forEach((a,r)=>{a.isConnected||(this.observer.unobserve(a),this.elementsCache.delete(r))});return}this._measureElement(s,void 0)},this.getVirtualItems=ke(()=>[this.getVirtualIndexes(),this.getMeasurements()],(s,a)=>{const r=[];for(let i=0,l=s.length;i<l;i++){const c=s[i],o=a[c];r.push(o)}return r},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=s=>{const a=this.getMeasurements();if(a.length!==0)return gt(a[Xt(0,a.length-1,r=>gt(a[r]).start,s)])},this.getMaxScrollOffset=()=>{if(!this.scrollElement)return 0;if("scrollHeight"in this.scrollElement)return this.options.horizontal?this.scrollElement.scrollWidth-this.scrollElement.clientWidth:this.scrollElement.scrollHeight-this.scrollElement.clientHeight;{const s=this.scrollElement.document.documentElement;return this.options.horizontal?s.scrollWidth-this.scrollElement.innerWidth:s.scrollHeight-this.scrollElement.innerHeight}},this.getOffsetForAlignment=(s,a,r=0)=>{if(!this.scrollElement)return 0;const i=this.getSize(),l=this.getScrollOffset();a==="auto"&&(a=s>=l+i?"end":"start"),a==="center"?s+=(r-i)/2:a==="end"&&(s-=i);const c=this.getMaxScrollOffset();return Math.max(Math.min(c,s),0)},this.getOffsetForIndex=(s,a="auto")=>{s=Math.max(0,Math.min(s,this.options.count-1));const r=this.measurementsCache[s];if(!r)return;const i=this.getSize(),l=this.getScrollOffset();if(a==="auto")if(r.end>=l+i-this.options.scrollPaddingEnd)a="end";else if(r.start<=l+this.options.scrollPaddingStart)a="start";else return[l,a];if(a==="end"&&s===this.options.count-1)return[this.getMaxScrollOffset(),a];const c=a==="end"?r.end+this.options.scrollPaddingEnd:r.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(c,a,r.size),a]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(s,{align:a="start",behavior:r}={})=>{r==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(s,a),{adjustments:void 0,behavior:r})},this.scrollToIndex=(s,{align:a="auto",behavior:r}={})=>{r==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),s=Math.max(0,Math.min(s,this.options.count-1)),this.currentScrollToIndex=s;let i=0;const l=10,c=u=>{if(!this.targetWindow)return;const x=this.getOffsetForIndex(s,u);if(!x){console.warn("Failed to get offset for index:",s);return}const[g,f]=x;this._scrollToOffset(g,{adjustments:void 0,behavior:r}),this.targetWindow.requestAnimationFrame(()=>{const y=()=>{if(this.currentScrollToIndex!==s)return;const m=this.getScrollOffset(),v=this.getOffsetForIndex(s,f);if(!v){console.warn("Failed to get offset for index:",s);return}ia(v[0],m)||o(f)};this.isDynamicMode()?this.targetWindow.requestAnimationFrame(y):y()})},o=u=>{this.targetWindow&&this.currentScrollToIndex===s&&(i++,i<l?this.targetWindow.requestAnimationFrame(()=>c(u)):console.warn(`Failed to scroll to index ${s} after ${l} attempts.`))};c(a)},this.scrollBy=(s,{behavior:a}={})=>{a==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+s,{adjustments:void 0,behavior:a})},this.getTotalSize=()=>{var s;const a=this.getMeasurements();let r;if(a.length===0)r=this.options.paddingStart;else if(this.options.lanes===1)r=((s=a[a.length-1])==null?void 0:s.end)??0;else{const i=Array(this.options.lanes).fill(null);let l=a.length-1;for(;l>=0&&i.some(c=>c===null);){const c=a[l];i[c.lane]===null&&(i[c.lane]=c.end),l--}r=Math.max(...i.filter(c=>c!==null))}return Math.max(r-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(s,{adjustments:a,behavior:r})=>{this.options.scrollToFn(s,{behavior:r,adjustments:a},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(n)}}const Xt=(t,n,s,a)=>{for(;t<=n;){const r=(t+n)/2|0,i=s(r);if(i<a)t=r+1;else if(i>a)n=r-1;else return r}return t>0?t-1:0};function pa({measurements:t,outerSize:n,scrollOffset:s,lanes:a}){const r=t.length-1,i=o=>t[o].start;if(t.length<=a)return{startIndex:0,endIndex:r};let l=Xt(0,r,i,s),c=l;if(a===1)for(;c<r&&t[c].end<s+n;)c++;else if(a>1){const o=Array(a).fill(0);for(;c<r&&o.some(x=>x<s+n);){const x=t[c];o[x.lane]=x.end,c++}const u=Array(a).fill(s+n);for(;l>=0&&u.some(x=>x>=s);){const x=t[l];u[x.lane]=x.start,l--}l=Math.max(0,l-l%a),c=Math.min(r,c+(a-1-c%a))}return{startIndex:l,endIndex:c}}const Nt=typeof document<"u"?p.useLayoutEffect:p.useEffect;function fa({useFlushSync:t=!0,...n}){const s=p.useReducer(()=>({}),{})[1],a={...n,onChange:(i,l)=>{var c;t&&l?ds.flushSync(s):s(),(c=n.onChange)==null||c.call(n,i,l)}},[r]=p.useState(()=>new ua(a));return r.setOptions(a),Nt(()=>r._didMount(),[]),Nt(()=>r._willUpdate()),r}function ga(t){return fa({observeElementRect:da,observeElementOffset:xa,scrollToFn:ha,...t})}/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],ja=me("chevron-up",ya);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Tr=me("circle-x",ba);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Na=[["path",{d:"m15 10 5 5-5 5",key:"qqa56n"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]],va=me("corner-down-right",Na);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],ot=me("lock",wa);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ka=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Zt=me("message-circle-question-mark",ka);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ca=[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]],Sa=me("reply",Ca);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],Ma=me("route",_a);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ta=[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]],vt=me("stethoscope",Ta);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pa=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],wt=me("trophy",Pa);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Ce=me("user",Ba);function La(t){t.values.forEach(n=>n.stop())}function st(t,n){[...n].reverse().forEach(a=>{const r=t.getVariant(a);r&&zt(t,r),t.variantChildren&&t.variantChildren.forEach(i=>{st(i,n)})})}function Ra(t,n){if(Array.isArray(n))return st(t,n);if(typeof n=="string")return st(t,[n]);zt(t,n)}function Ea(){const t=new Set,n={subscribe(s){return t.add(s),()=>void t.delete(s)},start(s,a){const r=[];return t.forEach(i=>{r.push(xs(i,s,{transitionOverride:a}))}),Promise.all(r)},set(s){return t.forEach(a=>{Ra(a,s)})},stop(){t.forEach(s=>{La(s)})},mount(){return()=>{n.stop()}}};return n}function za(){const t=ms(Ea);return hs(t.mount,[]),t}function Fa({"aria-label":t="Page navigation",className:n,...s}){return e.jsx("nav",{"aria-label":t,...s,className:R("flex gap-x-2",n)})}function Ia({onClick:t,disabled:n=!1,className:s,children:a="Previous"}){return e.jsx("span",{className:R("grow basis-0",s),children:e.jsxs(rt,{plain:!0,onClick:t,disabled:n,"aria-label":"Previous page",className:R("gap-1",n&&"invisible"),children:[e.jsx("svg",{className:"size-4 stroke-current",viewBox:"0 0 16 16",fill:"none","aria-hidden":"true",children:e.jsx("path",{d:"M2.75 8H13.25M2.75 8L5.25 5.5M2.75 8L5.25 10.5",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})}),a]})})}function Aa({onClick:t,disabled:n=!1,className:s,children:a="Next"}){return e.jsx("span",{className:R("flex grow basis-0 justify-end",s),children:e.jsxs(rt,{plain:!0,onClick:t,disabled:n,"aria-label":"Next page",className:R("gap-1",n&&"invisible"),children:[a,e.jsx("svg",{className:"size-4 stroke-current",viewBox:"0 0 16 16",fill:"none","aria-hidden":"true",children:e.jsx("path",{d:"M13.25 8L2.75 8M13.25 8L10.75 10.5M13.25 8L10.75 5.5",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})})]})})}function Da({className:t,...n}){return e.jsx("span",{...n,className:R("hidden items-baseline gap-x-2 sm:flex",t)})}function Ha({page:t,current:n=!1,onClick:s,className:a,children:r}){return e.jsx(rt,{plain:!n,outline:n,onClick:()=>s==null?void 0:s(t),"aria-label":`Page ${t}`,"aria-current":n?"page":void 0,className:R("min-w-[2.25rem] before:absolute before:-inset-px before:rounded-lg",n&&"before:bg-subtle-fill",a),children:r??t})}function Oa({className:t,...n}){return e.jsx("span",{"aria-hidden":"true",...n,className:R("w-[2.25rem] select-none text-center text-sm text-fg-muted",t),children:"…"})}function $a(t,n,s=1){if(n<=7)return Array.from({length:n},(o,u)=>u+1);const a=Math.max(t-s,1),r=Math.min(t+s,n),i=a>2,l=r<n-1;if(!i&&l){const o=3+2*s;return[...Array.from({length:o},(x,g)=>g+1),"gap",n]}if(i&&!l){const o=3+2*s;return[1,"gap",...Array.from({length:o},(x,g)=>n-o+g+1)]}return[1,"gap",...Array.from({length:r-a+1},(o,u)=>a+u),"gap",n]}const Pr=us(t=>({requestedHash:null,requestChannel:n=>t({requestedHash:n}),clearRequest:()=>t({requestedHash:null})}));function Ua(t){if(t.length===0)return[];const n=[];let s=0;for(;s<t.length;){const a=t[s],r=a.packet_hash;let i=1,l=a;if(r)for(;s+i<t.length&&t[s+i].packet_hash===r;)t[s+i].packet_origin==="tx_local"&&(l=t[s+i]),i++;n.push({packet:l,dupeCount:i}),s+=i}return n}const Va={rx:{icon:qt,label:"Rx",badgeColor:Pe.rx,avatarBg:"bg-sys-green/15",avatarText:"text-sys-green"},forward:{icon:pe,label:"Fwd",badgeColor:Pe.forward,avatarBg:"bg-sys-cyan/15",avatarText:"text-sys-cyan"},duplicate:{icon:it,label:"Dupe",badgeColor:Pe.duplicate,avatarBg:"bg-fg-muted/15",avatarText:"text-fg-secondary"},tx:{icon:Zs,label:"Tx",badgeColor:Pe.tx,avatarBg:"bg-sys-indigo/15",avatarText:"text-sys-indigo"},dropped:{icon:va,label:"Drop",badgeColor:Pe.dropped,avatarBg:"bg-sys-amber/15",avatarText:"text-sys-amber"}},kt={sm:"w-3.5 h-3.5",md:"w-4 h-4",lg:"w-5 h-5"},Wa={sm:"w-8 h-8",md:"w-9 h-9",lg:"w-10 h-10"};function Ga(t){return t.packet_origin==="tx_local"?"tx":t.packet_origin==="tx_forward"?"forward":t.is_duplicate?"duplicate":t.transmitted?"forward":t.drop_reason?"dropped":"rx"}function Qa({packet:t,showLabel:n=!0,variant:s="avatar",size:a="sm"}){const r=Ga(t),i=Va[r],l=i.icon;return s==="avatar"?e.jsx("div",{className:R("flex items-center justify-center rounded-full flex-shrink-0",i.avatarBg,Wa[a]),children:e.jsx(l,{className:R(kt[a],i.avatarText)})}):e.jsxs(B,{color:i.badgeColor,children:[e.jsx(l,{className:kt[a]}),n&&i.label]})}const Jt=p.memo(Qa);function qa({path:t,localHash:n,className:s}){if(!t||t.length===0)return e.jsx("span",{className:R("text-fg-muted text-xs",s),children:"—"});const a=n?(n.startsWith("0x")?n.slice(2,4):n.slice(0,2)).toUpperCase():null;return e.jsx("span",{className:R("flex items-center gap-0.5 type-data-xs overflow-hidden",s),children:t.map((r,i)=>{const l=i===t.length-1,c=a&&r.toUpperCase()===a;return e.jsxs("span",{className:"flex items-center flex-shrink-0",children:[c?e.jsx("span",{className:"px-1 py-0.5 rounded bg-sys-amber/20 text-sys-amber text-[9px] font-medium",children:"You"}):e.jsx("span",{className:"px-1 py-0.5 rounded bg-subtle-fill-hover text-fg-secondary",children:r.toUpperCase()}),!l&&e.jsx(ct,{className:"w-2.5 h-2.5 text-fg-muted mx-0.5 flex-shrink-0"})]},`${r}-${i}`)})})}const es=p.memo(qa);function ts({channelName:t,onClick:n,active:s,compact:a,className:r}){const i=t.startsWith("#")?t:`#${t}`,l=R("inline-flex items-center flex-shrink-0","font-medium",a?"px-1.5 h-4 leading-4 rounded text-[10px]":"px-2 h-5 leading-5 rounded text-xs",s?"bg-sys-blue/20 text-sys-blue":"bg-sys-blue/10 text-sys-blue",n&&!s&&"hover:bg-sys-blue/20 cursor-pointer",r);return n?e.jsx("button",{type:"button",onClick:n,className:l,children:i}):e.jsx("span",{className:l,children:i})}function Me(t){return{"--data-box-accent":ue[t]}}function ss(t){const n=t.payload_type_name||At(t.payload_type??t.type),s=t.route_type_name||Dt(t.route_type??t.route),a=Be[n]??"zinc",r=He[s]??"zinc";return{payloadType:n,routeType:s,payloadColor:a,routeColor:r}}function Ve(t){if(!t)return[];if(Array.isArray(t))return t;try{const n=JSON.parse(t);return Array.isArray(n)?n:[]}catch{return[]}}function as(t,n){if(n){const s=n(t);return{name:s.name,isCompanion:s.isCompanion,isRepeater:s.isRepeater}}return{name:null,isCompanion:!1,isRepeater:!1}}function Ka({packet:t,onClick:n,localHash:s,neighbors:a,resolveSource:r,isFlashing:i=!1,isTraceHighlighted:l,onTraceHover:c,traceTag:o,onViewTraceReport:u,dupeGroupPosition:x,isDupeGroupHovered:g=!1,onDupeGroupHover:f,dupeCount:y,getDecodedContent:m,onChannelClick:v}){const T=y?!1:Ft(t.is_duplicate),h=x!==void 0,{payloadType:N,routeType:j,payloadColor:C,routeColor:k}=ss(t),b=t.packet_origin==="tx_local",A=N==="TRACE",U=Ve(t.original_path),W=Ve(t.forwarded_path),K=W.length>0?W:U,F=t.src_hash?(t.src_hash.startsWith("0x")?t.src_hash.slice(2,6):t.src_hash.slice(0,4)).toUpperCase():null,{name:Y,isRepeater:D}=as(t,r);let E=null,O=null,$=null,J=null;if(N==="GRP_TXT"&&m){const _=m(t);_!=null&&_.decrypted&&(O=_.senderName,$=_.channelName,J=_.channelHash,_.text&&(E=_.text))}else if(N==="TXT_MSG"&&t.raw_packet)try{const _=Gt.fromHex(t.raw_packet);if(_.success&&_.packet){const ce=Qt(_.packet.payload);ce&&!ce.encrypted&&(E=ce.text)}}catch{}const M=O||(D?null:Y),H=!!M,te=!H&&D&&!!Y,se=!H&&!te&&N==="GRP_TXT"&&!E,d=t.payload_length??t.length??0;t.lbt_attempts;const Z=p.useCallback(()=>{A&&o&&u?u(o):n(t)},[A,o,u,n,t]),q=p.useCallback(()=>{A&&o&&c&&c(o),h&&f&&t.packet_hash&&f(t.packet_hash)},[A,o,c,h,f,t.packet_hash]),le=p.useCallback(()=>{c&&c(null),f&&f(null)},[c,f]),P=ue[C]||ue.zinc,z=g,ae=()=>{const _={pointerEvents:"none"};return x==="first"?{..._,borderTop:`2px solid ${P}`,borderLeft:`2px solid ${P}`,borderRight:`2px solid ${P}`,borderBottom:"none",borderRadius:"8px 8px 0 0",inset:"-2px -2px 0 -2px"}:x==="middle"?{..._,borderTop:"none",borderLeft:`2px solid ${P}`,borderRight:`2px solid ${P}`,borderBottom:"none",borderRadius:0,inset:"0 -2px"}:x==="last"?{..._,borderTop:"none",borderLeft:`2px solid ${P}`,borderRight:`2px solid ${P}`,borderBottom:`2px solid ${P}`,borderRadius:"0 0 8px 8px",inset:"0 -2px -2px -2px"}:{..._,border:`2px solid ${P}`,borderRadius:"8px",inset:"-2px"}};return e.jsxs("div",{onClick:Z,onMouseEnter:q,onMouseLeave:le,className:R("group relative cursor-pointer","hover:bg-subtle-fill",T&&!g&&"opacity-40",i&&"flash-row",b&&"bg-sys-indigo/5",l&&"bg-sys-teal/10"),children:[e.jsx("div",{className:R("absolute pointer-events-none transition-opacity duration-75",h?z?"opacity-100":"opacity-0":"opacity-0 group-hover:opacity-100"),style:ae()}),e.jsxs("div",{className:"relative flex items-center gap-2 min-[600px]:gap-3 px-2 py-2 min-[600px]:px-3 min-[600px]:py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[e.jsx("div",{className:"relative flex-shrink-0",children:H?e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-1 ring-edge-subtle",style:{backgroundColor:Vt(_e(M).cleanName)},children:_e(M).emoji?e.jsx("span",{className:"text-base leading-none",children:_e(M).emoji}):e.jsx("span",{className:"text-white text-[10px] font-bold tracking-tighter",children:Wt(M)})}):te?e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-[1.5px] ring-sys-blue",children:e.jsx(de,{className:"size-5 text-sys-blue"})}):se?e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-zinc-500/20 ring-1 ring-edge-subtle",children:e.jsx(Zt,{className:"size-4 text-fg-muted"})}):e.jsx(Jt,{packet:t,variant:"avatar",size:"sm"})}),e.jsx("div",{className:"min-w-0",children:H?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-semibold text-[13px] text-fg-primary font-sans truncate max-w-[90px]",children:M}),F&&e.jsx("div",{className:"hidden min-[900px]:block text-[9px] text-fg-muted truncate",children:F})]}):te?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-semibold text-[13px] text-fg-primary font-sans truncate max-w-[90px]",children:Y}),F&&e.jsx("div",{className:"hidden min-[900px]:block text-[9px] text-fg-muted truncate",children:F})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold text-[13px] text-fg-primary font-sans truncate",children:F||"—"}),Y&&e.jsx("div",{className:"hidden min-[900px]:block text-[9px] text-fg-muted truncate max-w-[70px]",children:Y})]})})]}),e.jsxs("div",{className:"flex-1 flex items-center gap-1 min-[600px]:gap-1.5 min-[900px]:gap-2 min-w-0",children:[e.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:Me(C),children:N}),b&&e.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:Me("indigo"),children:"LOCAL"}),y&&y>1&&e.jsxs("span",{className:"data-box data-box-compact flex-shrink-0",children:["×",y]}),e.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:Me(k),children:j}),e.jsxs("span",{className:"hidden min-[520px]:inline type-data-xs text-fg-muted flex-shrink-0",children:[d,"B"]}),e.jsx("div",{className:"flex-1 min-w-0 overflow-hidden",children:E||$?e.jsxs("span",{className:"text-[11px] text-fg-secondary truncate block flex items-center gap-1",children:[$&&e.jsx(ts,{channelName:$,compact:!0,onClick:v&&J?_=>{_.stopPropagation(),v(J)}:void 0}),E&&e.jsx("span",{className:"italic truncate",children:E})]}):e.jsx(es,{path:K,localHash:s})})]}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[e.jsx("span",{className:"data-box data-box-compact",children:It(t.timestamp)}),e.jsx(Oe,{rssi:t.rssi,snr:t.snr,compact:!0,showValues:!0,validated:$e(t)})]})]})]})}function Ya({packet:t,onClick:n,localHash:s,neighbors:a,resolveSource:r,isFlashing:i=!1,isTraceHighlighted:l,traceTag:c,onViewTraceReport:o,dupeGroupPosition:u,isDupeGroupHovered:x=!1,onDupeGroupHover:g,dupeCount:f,getDecodedContent:y,onChannelClick:m}){const{payloadType:v,routeType:T,payloadColor:h,routeColor:N}=ss(t),j=t.packet_origin==="tx_local",C=v==="TRACE",k=f?!1:Ft(t.is_duplicate),b=Ve(t.original_path),A=Ve(t.forwarded_path),U=A.length>0?A:b,W=t._hopCount??U.length,K=t.src_hash?(t.src_hash.startsWith("0x")?t.src_hash.slice(2,6):t.src_hash.slice(0,4)).toUpperCase():null,{name:F,isRepeater:Y}=as(t,r);let D=null,E=null,O=null,$=null;if(v==="GRP_TXT"&&y){const P=y(t);P!=null&&P.decrypted&&(E=P.senderName,O=P.channelName,$=P.channelHash,P.text&&(D=P.text))}else if(v==="TXT_MSG"&&t.raw_packet)try{const P=Gt.fromHex(t.raw_packet);if(P.success&&P.packet){const z=Qt(P.packet.payload);z&&!z.encrypted&&(D=z.text)}}catch{}const J=E||(Y?null:F),M=!!J,H=!M&&Y&&!!F,te=!M&&!H&&v==="GRP_TXT"&&!D,se=t.payload_length??t.length??0,d=t.lbt_attempts??0,Z=()=>{C&&c&&o?o(c):n(t)},q=ue[h]||ue.zinc,le=()=>{if(!u)return{opacity:0};const P=x?1:.4,z=x?"3px":"2px";return u==="first"?{backgroundColor:q,opacity:P,width:z,top:"6px",bottom:0,borderRadius:"0 9999px 0 0"}:u==="middle"?{backgroundColor:q,opacity:P,width:z,top:0,bottom:0,borderRadius:0}:u==="last"?{backgroundColor:q,opacity:P,width:z,top:0,bottom:"6px",borderRadius:"0 0 9999px 0"}:{backgroundColor:q,opacity:P,width:z,top:"6px",bottom:"6px",borderRadius:"9999px"}};return e.jsxs("div",{onClick:Z,className:R("relative pl-3 pr-2.5 py-2 cursor-pointer","active:bg-subtle-fill-hover",k&&"opacity-40",i&&"flash-row",j&&"bg-sys-indigo/5",l&&"bg-sys-teal/10"),children:[e.jsx("div",{className:"absolute left-0 transition-all",style:le()}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"relative flex-shrink-0 mt-0.5",children:M?e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-1 ring-edge-subtle",style:{backgroundColor:Vt(_e(J).cleanName)},children:_e(J).emoji?e.jsx("span",{className:"text-base leading-none",children:_e(J).emoji}):e.jsx("span",{className:"text-white text-[10px] font-bold tracking-tighter",children:Wt(J)})}):H?e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-[1.5px] ring-sys-blue",children:e.jsx(de,{className:"size-5 text-sys-blue"})}):te?e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-zinc-500/20 ring-1 ring-edge-subtle",children:e.jsx(Zt,{className:"size-4 text-fg-muted"})}):e.jsx(Jt,{packet:t,variant:"avatar",size:"sm"})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[M?e.jsx("span",{className:"font-medium text-[14px] text-fg-primary tracking-tight truncate min-w-0",children:J}):H?e.jsx("span",{className:"font-medium text-[14px] text-fg-primary tracking-tight truncate min-w-0",children:F}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold text-[14px] text-fg-primary tracking-tight flex-shrink-0",children:K||"—"}),F&&e.jsx("span",{className:"text-[12px] text-fg-muted truncate min-w-0",children:F})]}),e.jsx("div",{className:"flex-1"}),e.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:Me(h),children:v}),j&&e.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:Me("indigo"),children:"LOCAL"}),e.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:Me(N),children:T}),f&&f>1&&e.jsxs("span",{className:"data-box data-box-compact flex-shrink-0",children:["×",f]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("span",{className:"type-data-xs text-fg-muted w-[28px] text-right",children:t.rssi}),e.jsx(Oe,{rssi:t.rssi,compact:!0,showValues:!1,validated:$e(t)})]})]}),e.jsxs("div",{className:"flex items-center gap-1 type-data-xs text-fg-muted",children:[e.jsx("span",{className:"data-box data-box-compact flex-shrink-0",children:It(t.timestamp)}),se>0&&e.jsxs("span",{children:[se,"B"]}),d>0&&e.jsxs("span",{className:d>1?"text-sys-amber/60":void 0,children:["LBT:",d]}),t.snr!=null&&e.jsxs("span",{children:[t.snr.toFixed(0),"dB"]}),D||O?e.jsxs("span",{className:"text-[11px] text-fg-secondary truncate flex items-center gap-1 min-w-0",children:[O&&e.jsx(ts,{channelName:O,compact:!0,onClick:m&&$?P=>{P.stopPropagation(),m($)}:void 0}),D&&e.jsx("span",{className:"italic truncate",children:D})]}):W>0?e.jsx(es,{path:U,localHash:s}):null]})]})]})]})}const Xa=p.memo(Ka),Za=p.memo(Ya);function Ja(t,n,s,a,r=!1){const i=t.toUpperCase(),l=[],c=s&&Ze(i,s);c&&l.push(s);for(const y of Object.keys(n))Ze(i,y)&&l.push(y);if(r&&c&&s&&l.length===1)return{matches:l,probability:1,bestMatch:s};if(r&&c&&l.length>1){const y=l.filter(m=>m!==s);if(y.length===1)return{matches:l,probability:1,bestMatch:y[0]}}const o=l.length>0?1/l.length:0,u=[...l].sort();let x=null,g=-1;if(u.length===1)x=u[0];else if(u.length>1&&a){for(const y of u){const m=a.get(y),v=m?typeof m=="number"?m:m.combinedScore:0;v>g&&(g=v,x=y)}x||(x=u[0])}else u.length>0&&(x=u[0]);let f=o;if(l.length>1&&a&&g>0){let y=0;for(const m of l){const v=a.get(m);y+=v?typeof v=="number"?v:v.combinedScore:0}y>0&&(f=Math.min(.95,g/y))}return{matches:l,probability:f,bestMatch:x}}function en(t,n,s,a){const i=(s-t)*Math.PI/180,l=(a-n)*Math.PI/180,c=Math.sin(i/2)*Math.sin(i/2)+Math.cos(t*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 6371e3*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))}function tn(t){return t<100?1:t<500?.9:t<1e3?.7:t<5e3?.5:t<1e4?.3:.1}const sn=p.lazy(()=>ps(()=>import("./PathMapMapLibre-B3ia8Mj4.js"),__vite__mapDeps([0,1,2,3,4,5,6])));function an(t,n,s,a,r=!1,i,l,c){const o=fs(n);let u;l&&(u=gs(l,t,{position:c,isLastHop:r}).confidence);const{matches:x,probability:g}=Ja(t,o,a,i,r),f=x.length,y=[],m=t.toUpperCase(),v=s&&s.latitude!==void 0&&s.longitude!==void 0&&(s.latitude!==0||s.longitude!==0);for(const h of x){if(a&&Ze(m,a)&&h===a&&v&&s){y.push({hash:h,name:s.name||"Local Node",latitude:s.latitude,longitude:s.longitude,probability:r?1:g,isLocal:!0});continue}const N=o[h];N!=null&&N.latitude&&(N!=null&&N.longitude)&&!(N.latitude===0&&N.longitude===0)&&y.push({hash:h,name:N.node_name||N.name||"Unknown",latitude:N.latitude,longitude:N.longitude,probability:g,isLocal:!1,isDirectNeighbor:N.zero_hop===!0})}const T=y.length;if(T===1)y[0].probability=u??1;else if(T>1)if(u!==void 0&&u>0){const h=y[0];h.probability=u;const N=1-u,j=T-1;y.slice(1).forEach(C=>{C.probability=N/j})}else{let h=0;const N=y.map(j=>{if(j.isLocal)return{candidate:j,score:1};const C=i==null?void 0:i.get(j.hash);let k=.5;if(v&&s){const A=en(s.latitude,s.longitude,j.latitude,j.longitude);k=tn(A)}let b;return C?b=k*.3+C.hopConsistencyScore*.3+C.frequencyScore*.4:(b=k,j.isDirectNeighbor&&(b=Math.max(b,.8))),h+=b,{candidate:j,score:b}});if(h>0)N.forEach(({candidate:j,score:C})=>{j.probability=Math.min(.95,C/h)});else{const j=1/T;y.forEach(C=>C.probability=j)}}return{candidates:y,totalMatches:f}}function nn(t,n,s,a,r,i){if(!t||t.length===0)return{hops:[],overallConfidence:0,hasValidPath:!1};const l=t.length-1,c=t.map((x,g)=>{const f=g===l,y=t.length-g,{candidates:m,totalMatches:v}=an(x,n,s,a,f,r,i,y),T=m.length>0?Math.max(...m.map(h=>h.probability)):0;return{prefix:x,candidates:m,confidence:T,totalMatches:v}}),o=c.reduce((x,g)=>g.confidence===0?0:x*g.confidence,1),u=c.some(x=>x.candidates.length>0);return{hops:c,overallConfidence:o,hasValidPath:u}}function rn(t){return`${(t*100).toFixed(0)}%`}function ln(t){return t>=1?"text-sys-green":t>=.5?"text-sys-indigo":t>=.25?"text-signal-poor":t>0?"text-sys-red":"text-fg-muted"}function cn(t,n,s){let a;return n===0?a=s.muted:t>=1?a=s.success:t>=.5?a=s.secondary:t>=.25?a=s.poor:t>0?a=s.danger:a=s.muted,{color:a}}class on extends p.Component{constructor(n){super(n),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?e.jsxs("div",{className:"h-[200px] flex items-center justify-center text-fg-muted",children:[e.jsx(et,{className:"w-4 h-4 mr-2"}),"Map failed to load"]}):this.props.children}}function We({path:t,neighbors:n,localNode:s,localHash:a,srcHash:r,dstHash:i,neighborAffinity:l,prefixLookup:c,hubNodes:o,traceSnr:u,advertiserSource:x}){const[g,f]=p.useState(null),y=p.useMemo(()=>{if(!x)return null;const j=x.nodeType==="wardrive";return{prefix:x.prefix||"??",candidates:[{hash:x.publicKey||x.prefix||"source",name:x.name,latitude:x.latitude,longitude:x.longitude,probability:1,isLocal:!1,isWardrive:j}],confidence:1,totalMatches:1,isSource:!0}},[x]),m=p.useMemo(()=>{if(x||!r)return null;const j=De(r),C=n[r];if((C==null?void 0:C.latitude)&&(C==null?void 0:C.longitude)&&!(C.latitude===0&&C.longitude===0))return{prefix:j,candidates:[{hash:r,name:C.node_name||C.name||"Source",latitude:C.latitude,longitude:C.longitude,probability:1,isLocal:!1,isDirectNeighbor:C.zero_hop===!0}],confidence:1,totalMatches:1,isSource:!0};const b=(C==null?void 0:C.node_name)||(C==null?void 0:C.name)||r.slice(0,8);return{prefix:j,candidates:[{hash:r,name:b,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isSource:!0}},[x,r,n]),v=p.useMemo(()=>{const j=i!=null&&i.startsWith("0x")?i.slice(2):i;if((!j||j==="00"||j==="0000000000000000")&&s&&a){const W=De(a),K=s.latitude!==0||s.longitude!==0;return{prefix:W,candidates:[{hash:a,name:s.name||"Local Node",latitude:K?s.latitude:0,longitude:K?s.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}if(!i)return null;const k=De(i);if(a&&i===a&&s){const W=s.latitude!==0||s.longitude!==0;return{prefix:k,candidates:[{hash:i,name:s.name||"Local Node",latitude:W?s.latitude:0,longitude:W?s.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}const b=n[i];if((b==null?void 0:b.latitude)&&(b==null?void 0:b.longitude)&&!(b.latitude===0&&b.longitude===0))return{prefix:k,candidates:[{hash:i,name:b.node_name||b.name||"Destination",latitude:b.latitude,longitude:b.longitude,probability:1,isLocal:!1,isDirectNeighbor:b.zero_hop===!0}],confidence:1,totalMatches:1,isDestination:!0};const U=(b==null?void 0:b.node_name)||(b==null?void 0:b.name)||i.slice(0,8);return{prefix:k,candidates:[{hash:i,name:U,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isDestination:!0}},[i,n,s,a]),T=p.useMemo(()=>nn(t,n,s,a,l,c),[t,n,s,a,l,c]),h=p.useMemo(()=>{const j=[];y?j.push(y):m&&j.push(m),j.push(...T.hops),v&&j.push(v);const C=j.reduce((b,A)=>A.confidence===0?0:b*A.confidence,1),k=j.some(b=>b.candidates.some(A=>A.latitude!==0||A.longitude!==0));return{hops:j,overallConfidence:C,hasValidPath:k}},[y,m,T,v]),N=p.useMemo(()=>{const j=getComputedStyle(document.documentElement);return{success:j.getPropertyValue("--sys-green").trim()||"#39D98A",secondary:j.getPropertyValue("--sys-indigo").trim()||"#F9D26F",poor:j.getPropertyValue("--signal-poor").trim()||"#FF8A5C",danger:j.getPropertyValue("--sys-red").trim()||"#FF5C7A",muted:j.getPropertyValue("--text-muted").trim()||"#767688"}},[]);return h.hasValidPath?e.jsxs("div",{className:"h-full flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-fg-muted",children:"Path Confidence:"}),e.jsx("span",{className:ln(h.overallConfidence),children:rn(h.overallConfidence)}),e.jsx("button",{className:"text-fg-muted hover:text-fg-secondary transition-colors",title:"Confidence is calculated based on how many known nodes match each path prefix. Multiple matches reduce confidence due to collision probability.",children:e.jsx(Js,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-sys-green"}),e.jsx("span",{className:"text-fg-muted",children:"Exact"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-sys-indigo"}),e.jsx("span",{className:"text-fg-muted",children:"Multi"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-fg-muted"}),e.jsx("span",{className:"text-fg-muted",children:"Unknown"})]})]})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:e.jsx(on,{children:e.jsx(p.Suspense,{fallback:e.jsx("div",{className:"h-full bg-elevated flex items-center justify-center text-fg-muted text-sm",children:"Loading map..."}),children:e.jsx(sn,{resolvedPath:h,localNode:s,hubNodes:o,hoveredHopIndex:g,onHoverHop:f,traceSnr:u})})})}),e.jsx("div",{className:"flex flex-wrap items-center gap-1.5",children:h.hops.map((j,C)=>{var W,K,F;const k=j.isSource===!0,b=j.isDestination===!0,A=g===C;let U;return k?U=`Source: ${((W=j.candidates[0])==null?void 0:W.name)||"Unknown"}`:b?U=`Destination: ${((K=j.candidates[0])==null?void 0:K.name)||"Unknown"}`:j.totalMatches===0?U="No matching nodes found":j.totalMatches===1?U=`Exact match: ${((F=j.candidates[0])==null?void 0:F.name)||"Unknown"}`:U=`${j.totalMatches} possible matches (${(j.confidence*100).toFixed(0)}% confidence)`,e.jsxs("div",{className:R("flex items-center gap-1 px-1.5 py-0.5 rounded type-data-xs cursor-pointer transition-all",A?"bg-sys-blue/20 ring-1 ring-sys-blue/50":"bg-elevated hover:bg-subtle",k&&"border border-sys-green/30",b&&"border border-sys-blue/30"),title:U,onMouseEnter:()=>f(C),onMouseLeave:()=>f(null),children:[k&&e.jsx("span",{className:"text-sys-green text-[8px] mr-0.5",children:"SRC"}),b&&e.jsx("span",{className:"text-sys-blue text-[8px] mr-0.5",children:"DST"}),e.jsx("span",{style:cn(j.confidence,j.totalMatches,N),children:j.prefix}),!k&&!b&&j.totalMatches>1&&e.jsxs("span",{className:"text-fg-muted",children:["×",j.totalMatches]}),!k&&!b&&j.totalMatches===0&&e.jsx("span",{className:"text-fg-muted",children:"?"})]},C)})})]}):e.jsxs("div",{className:"flex items-center justify-center text-fg-muted text-xs py-4",children:[e.jsx(Ue,{className:"w-3.5 h-3.5 mr-1.5 opacity-50"}),"No location data available for path nodes"]})}const Ye=16;function Ge(t){return t.match(/.{1,2}/g)||[]}function je(t){return t!==null&&t.startsWith("payload:")}const Te={hexRestOpacity:15,cardRestBg:"color-mix(in srgb, var(--elevated) 60%, var(--body))",cardRestShadow:`
    inset 0 0 0 1px color-mix(in srgb, var(--fg-primary) 6%, transparent),
    inset 0 1px 0 color-mix(in srgb, white 3%, transparent),
    0 1px 2px color-mix(in srgb, black 5%, transparent)
  `,selectionBorderWidth:2},at={type:"tween",duration:.25,ease:[.25,.1,.25,1]};function dn(t,n){return t?`inset 0 0 0 ${Te.selectionBorderWidth}px ${ue[n]}`:Te.cardRestShadow}function xn(t,n){return t?n:`color-mix(in srgb, ${n} ${Te.hexRestOpacity}%, transparent)`}function mn({segments:t,selectedSegment:n,onSegmentClick:s}){const[a,r]=p.useState(null),[i,l]=p.useState(null),c=t.some(x=>x.id!==void 0)&&s,o=[];for(const x of t){const g=Ge(x.hex);for(const f of g)o.push({byte:f.toUpperCase(),color:x.color,id:x.id})}const u=[];for(let x=0;x<o.length;x+=Ye)u.push(o.slice(x,x+Ye));return e.jsx("div",{className:"space-y-1",children:u.map((x,g)=>{const f=x.length<Ye;return e.jsx("div",{className:"flex rounded-md overflow-hidden",children:x.map(({byte:y,color:m,id:v},T)=>{const h=T===x.length-1,N=f&&h,j=ue[m],b=(v?a===v:i===m)||!!(v&&n===v);return e.jsx("span",{className:`w-[1.75rem] text-xs text-center py-0.5 font-mono select-text ${c?"cursor-pointer":""}`,style:{backgroundColor:xn(b,j),color:b?"rgba(255,255,255,0.95)":j,transition:b?"none":"background-color 0.15s ease-out, color 0.15s ease-out",touchAction:"manipulation",...N?{borderRadius:"0 0.375rem 0.375rem 0"}:{}},onMouseEnter:()=>{v?r(v):l(m)},onMouseLeave:()=>{r(null),l(null)},onClick:()=>v&&(s==null?void 0:s(v)),onTouchStart:()=>{v?r(v):l(m)},onTouchEnd:()=>{r(null),l(null)},children:y},T)})},g)})})}function hn({rawHex:t,hexSegments:n,selectedSegment:s,onSegmentClick:a}){const[r,i]=p.useState(!1),l=p.useCallback(async()=>{try{await navigator.clipboard.writeText(t.toUpperCase()),i(!0),setTimeout(()=>i(!1),2e3)}catch(c){console.error("Failed to copy:",c)}},[t]);return e.jsxs("div",{className:"bg-black rounded-2xl p-6 relative",children:[e.jsx(mn,{segments:n,selectedSegment:s,onSegmentClick:a}),e.jsx("button",{onClick:l,className:"absolute bottom-3 right-3 flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg bg-subtle-fill-hover hover:bg-subtle-fill-strong text-fg-muted hover:text-fg-secondary transition-all text-xs font-sans",title:"Copy raw packet hex",children:r?e.jsxs(e.Fragment,{children:[e.jsx(bs,{className:"w-3.5 h-3.5 text-sys-green"}),e.jsx("span",{className:"text-sys-green",children:"Copied"})]}):e.jsxs(e.Fragment,{children:[e.jsx(it,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Copy"})]})})]})}function un(t,n){const s=[];let a=0;const r=n.slice(0,64);s.push({id:"payload:publicKey",title:"Public Key",color:"pink",hex:r,startByte:a,endByte:a+31,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:t.publicKey.toUpperCase()}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Ed25519 public key (32 bytes)"})]})}),a+=32;const i=n.slice(64,72);s.push({id:"payload:timestamp",title:"Timestamp",color:"orange",hex:i,startByte:a,endByte:a+3,decoded:e.jsxs(e.Fragment,{children:[e.jsx(X,{size:"standard",copy:!0,children:i.toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:[t.timestamp," (",ie(t.timestamp),")"]})]})}),a+=4;const l=n.slice(72,200);s.push({id:"payload:signature",title:"Signature",color:"teal",hex:l,startByte:a,endByte:a+63,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:t.signature.toUpperCase()}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Ed25519 signature (64 bytes)"})]})}),a+=64;const c=n.slice(200,202);if(s.push({id:"payload:flags",title:"Flags",color:"blue",hex:c,startByte:a,endByte:a,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(X,{size:"standard",copy:!0,children:["0x",t.flags.toString(16).padStart(2,"0").toUpperCase()]}),e.jsx("p",{className:"text-xs text-fg-primary mt-1",children:t.flagsDescription}),e.jsxs("p",{className:"text-xs text-fg-muted",children:["Node Type: ",t.nodeType]})]})}),a+=1,t.latitude!==void 0){const o=n.slice(a*2,a*2+8);s.push({id:"payload:latitude",title:"Latitude",color:"green",hex:o,startByte:a,endByte:a+3,decoded:e.jsxs(e.Fragment,{children:[e.jsx(X,{size:"standard",copy:!0,children:o.toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:[t.latitude.toFixed(6),"°"]})]})}),a+=4}if(t.longitude!==void 0){const o=n.slice(a*2,a*2+8);s.push({id:"payload:longitude",title:"Longitude",color:"indigo",hex:o,startByte:a,endByte:a+3,decoded:e.jsxs(e.Fragment,{children:[e.jsx(X,{size:"standard",copy:!0,children:o.toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:[t.longitude.toFixed(6),"°"]})]})}),a+=4}if(t.name){const o=n.slice(a*2),u=o.length/2;s.push({id:"payload:name",title:"Name",color:"amber",hex:o,startByte:a,endByte:a+u-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx(X,{size:"standard",copy:!0,children:o.toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:['"',t.name,'"']})]})})}return s}function pn(t,n){return[{id:"payload:crc",title:"CRC",color:"green",hex:n.slice(0,8),startByte:0,endByte:3,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(X,{size:"standard",copy:!0,children:["0x",t.crc]}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"CRC32 of acknowledged packet"})]})}]}function fn(t,n){const s=[];s.push({id:"payload:channelHash",title:"Channel Hash",color:"blue",hex:n.slice(0,2),startByte:0,endByte:0,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(X,{size:"standard",copy:!0,children:["0x",t.channelHash]}),t.channelName&&e.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:["Channel: ",t.channelName]})]})}),t.macHex&&s.push({id:"payload:mac",title:"MAC",color:"indigo",hex:n.slice(2,6),startByte:1,endByte:2,decoded:e.jsxs(e.Fragment,{children:[e.jsx(X,{size:"standard",copy:!0,children:t.macHex.toUpperCase()}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Truncated HMAC-SHA256"})]})});const a=n.slice(6);return a&&s.push({id:"payload:ciphertext",title:t.decrypted?"Message":"Ciphertext",color:t.decrypted?"green":"zinc",hex:a,startByte:3,endByte:3+a.length/2-1,decoded:t.decrypted?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-fg-primary",children:['"',t.text,'"']}),t.senderName&&e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:["From: ",t.senderName]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:a.toUpperCase()}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"AES-128-ECB encrypted"})]})}),s}function gn(t,n){const s=[];s.push({id:"payload:channelHash",title:"Channel Hash",color:"blue",hex:n.slice(0,2),startByte:0,endByte:0,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(X,{size:"standard",copy:!0,children:["0x",t.channelHash]}),t.channelName&&e.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:["Channel: ",t.channelName]})]})}),t.macHex&&s.push({id:"payload:mac",title:"MAC",color:"indigo",hex:n.slice(2,6),startByte:1,endByte:2,decoded:e.jsxs(e.Fragment,{children:[e.jsx(X,{size:"standard",copy:!0,children:t.macHex.toUpperCase()}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Truncated HMAC-SHA256"})]})});const a=n.slice(6);return a&&s.push({id:"payload:ciphertext",title:t.decrypted?"Decrypted Data":"Encrypted Data",color:t.decrypted?"green":"zinc",hex:a,startByte:3,endByte:3+a.length/2-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:(t.decryptedHex||a).toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[t.dataLength," bytes",t.decrypted?"":" (AES-128-ECB encrypted)"]})]})}),s}function yn(t,n){const s=[];if(s.push({id:"payload:pathLength",title:"Path Length",color:"blue",hex:n.slice(0,2),startByte:0,endByte:0,decoded:e.jsxs(e.Fragment,{children:[e.jsx(X,{size:"standard",children:t.pathLength}),e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[t.pathLength," hop",t.pathLength!==1?"s":""]})]})}),t.path.length>0){const a=n.slice(2,2+t.pathLength*2);s.push({id:"payload:path",title:"Path Hops",color:"amber",hex:a,startByte:1,endByte:t.pathLength,decoded:e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex flex-wrap items-center gap-1",children:t.path.map((r,i)=>e.jsxs("span",{className:"flex items-center gap-1",children:[i>0&&e.jsx(pe,{className:"w-3 h-3 text-fg-muted"}),e.jsx(B,{color:"amber",className:"font-mono",children:r})]},i))})})})}if(t.extraType!=null){const a=1+t.pathLength;s.push({id:"payload:extraType",title:"Extra Type",color:"indigo",hex:n.slice(a*2,a*2+2),startByte:a,endByte:a,decoded:e.jsxs(e.Fragment,{children:[e.jsx(X,{size:"standard",children:t.extraTypeName??`0x${t.extraType.toString(16).padStart(2,"0")}`}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Bundled payload type"})]})})}if(t.extraData){const a=1+t.pathLength+1,r=n.slice(a*2);r&&s.push({id:"payload:extraData",title:"Extra Data",color:"indigo",hex:r,startByte:a,endByte:a+r.length/2-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:r.toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[r.length/2," bytes"]})]})})}return s}function jn(t,n){const s=[];s.push({id:"payload:crc",title:"Trace Tag",color:"blue",hex:n.slice(0,8),startByte:0,endByte:3,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(X,{size:"standard",copy:!0,children:["0x",t.traceTag]}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Unique trace request identifier"})]})}),s.push({id:"payload:mac",title:"Auth Code",color:"indigo",hex:n.slice(8,16),startByte:4,endByte:7,decoded:e.jsxs(e.Fragment,{children:[e.jsx(X,{size:"standard",copy:!0,children:t.authCode}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Authentication/verification code"})]})}),s.push({id:"payload:flags",title:"Flags",color:"amber",hex:n.slice(16,18),startByte:8,endByte:8,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(X,{size:"standard",copy:!0,children:["0x",t.flags.toString(16).toUpperCase().padStart(2,"0")]}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:t.flags===0?"No flags set":`Flags: ${t.flags.toString(2).padStart(8,"0")}b`})]})});const a=n.slice(18);return a&&s.push({id:"payload:path",title:"Target Path",color:"indigo",hex:a,startByte:9,endByte:9+a.length/2-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-wrap items-center gap-1",children:t.pathHashes.map((r,i)=>{const l=t.snrValues[i],c=l!==void 0?qs(l):"zinc";return e.jsxs("span",{className:"flex items-center gap-1",children:[i>0&&e.jsx(pe,{className:"w-3 h-3 text-fg-muted"}),e.jsx(B,{color:"indigo",className:"font-mono",children:r}),l!==void 0&&e.jsxs(B,{color:c,className:"font-mono",children:[l>=0?"+":"",Number.isInteger(l)?l:l.toFixed(1),"dB"]})]},i)})}),e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[t.pathHashes.length," target ",t.pathHashes.length===1?"hop":"hops",t.snrValues.length>0&&` • ${t.snrValues.length} SNR ${t.snrValues.length===1?"value":"values"} collected`,t.isComplete&&" • ✓ Complete"]})]})}),s}function bn(t,n){const s=[];s.push({id:"payload:msgId",title:"Message ID",color:"blue",hex:n.slice(0,4),startByte:0,endByte:1,decoded:e.jsxs(e.Fragment,{children:[e.jsx(X,{size:"standard",copy:!0,children:t.messageId.toUpperCase()}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Unique message identifier"})]})}),s.push({id:"payload:partNum",title:"Part Number",color:"amber",hex:n.slice(4,6),startByte:2,endByte:2,decoded:e.jsxs(e.Fragment,{children:[e.jsx(X,{size:"standard",copy:!0,children:t.partNumber}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"0-indexed part number"})]})}),s.push({id:"payload:totalParts",title:"Total Parts",color:"orange",hex:n.slice(6,8),startByte:3,endByte:3,decoded:e.jsxs(e.Fragment,{children:[e.jsx(X,{size:"standard",copy:!0,children:t.totalParts}),e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:["Part ",t.partNumber+1," of ",t.totalParts]})]})});const a=n.slice(8);return a&&s.push({id:"payload:partData",title:"Part Data",color:"cyan",hex:a,startByte:4,endByte:4+a.length/2-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:a.toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[a.length/2," bytes"]})]})}),s}function Nn(t,n){switch(t.type){case"advert":return un(t,n);case"ack":return pn(t,n);case"grp_txt":return fn(t,n);case"grp_data":return gn(t,n);case"path":return yn(t,n);case"trace":return jn(t,n);case"multipart":return bn(t,n);default:return[{id:"payload:ciphertext",title:"Raw Data",color:"zinc",hex:n,startByte:0,endByte:n.length/2-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:n.toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[n.length/2," bytes"]})]})}]}}function vn(t){return t.map(n=>({id:n.id,hex:n.hex,color:n.color}))}function wn({bits:t,field:n,value:s,binary:a}){const r=()=>{if(n==="Payload Type"){const i=Be[s]||"zinc";return e.jsx(B,{color:i,children:s})}if(n==="Route Type"){const i=He[s]||"zinc";return e.jsx(B,{color:i,children:s})}return e.jsx("span",{className:"text-sm text-fg-primary",children:s})};return e.jsxs("tr",{children:[e.jsx("td",{className:"py-1.5 text-xs text-fg-muted tabular-nums",children:t}),e.jsx("td",{className:"py-1.5 text-sm text-fg-secondary",children:n}),e.jsx("td",{className:"py-1.5",children:r()}),e.jsx("td",{className:"py-1.5 type-data-xs text-sys-cyan",children:a})]})}function Ct({id:t,title:n,color:s,hexBytes:a,startByte:r,endByte:i,isSelected:l,children:c}){const o=a?Ge(a):[];return e.jsxs(oe.div,{layout:"position",layoutId:t,transition:at,className:"w-full min-w-0 overflow-hidden rounded-xl p-4 sm:p-5 space-y-4",style:{backgroundColor:Te.cardRestBg,boxShadow:dn(l,s)},children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-0.5 min-w-0",children:[e.jsx(B,{color:s,children:n}),o.length>0&&o.length<=16&&o.map((u,x)=>e.jsx(B,{color:s,className:"font-mono",children:u.toUpperCase()},x))]}),e.jsxs("span",{className:"type-data-xs text-fg-muted flex-shrink-0",children:["Bytes ",r,"-",i]})]}),e.jsx("div",{className:"min-w-0 overflow-hidden",children:c})]})}function kn({advert:t,timestamp:n}){const s=n?ie(n):ie(t.timestamp);return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-indigo/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-indigo) 0%, var(--sys-blue) 100%)"},children:e.jsx(de,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:t.name||"Unknown Node"}),e.jsx("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:t.nodeType})]})]}),e.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),e.jsxs("div",{className:"px-4 py-3 space-y-2",children:[t.latitude!==void 0&&t.longitude!==void 0&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ue,{className:"w-4 h-4 text-sys-indigo flex-shrink-0"}),e.jsxs("span",{className:"text-sm text-fg-secondary font-mono",children:[t.latitude.toFixed(5),"°, ",t.longitude.toFixed(5),"°"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{className:"w-4 h-4 text-sys-indigo flex-shrink-0"}),e.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:s})]})]})]})})}function Cn({decoded:t,timestamp:n}){const s=n?ie(n):"Unknown";return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-teal/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-teal) 0%, var(--sys-cyan) 100%)"},children:e.jsx(aa,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:t.channelName||"Channel Data"}),e.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:[t.dataLength," bytes • ",t.decrypted?"Decrypted":"Encrypted"]})]})]}),e.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),e.jsxs("div",{className:"px-4 py-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Kt,{className:"w-4 h-4 text-sys-teal flex-shrink-0"}),e.jsxs("span",{className:"text-sm text-fg-secondary font-sans",children:["Channel: ",e.jsxs("span",{className:"font-mono",children:["0x",t.channelHash]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{className:"w-4 h-4 text-sys-teal flex-shrink-0"}),e.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:s})]}),t.decrypted&&t.decryptedHex&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-edge-subtle",children:[e.jsx("p",{className:"type-micro text-fg-muted mb-1 font-sans",children:"Decrypted Data"}),e.jsx("div",{className:"max-w-full overflow-x-auto",children:e.jsx(X,{size:"compact",copy:!0,className:"inline-block",children:e.jsx("span",{className:"break-all text-xs",children:t.decryptedHex.toUpperCase()})})})]})]})]})})}function Sn({decoded:t,timestamp:n,isLoading:s=!1,onDecrypted:a}){const r=n?ie(n):"Unknown",[i,l]=p.useState(""),[c,o]=p.useState(!1),[u,x]=p.useState(null),[g,f]=p.useState(!1),y=p.useCallback(async()=>{if(!(!i.trim()||!t.ciphertextHex||!t.macHex)){o(!0),x(null);try{const m=parseInt(t.channelHash,16),v=ut(t.macHex),T=ut(t.ciphertextHex),h=await vs(i.trim(),m,v,T);if(h.success){const N=h.result.plaintext,j=new TextDecoder("utf-8",{fatal:!1}).decode(N.slice(5)),C=j.indexOf(": "),k={...t,channelName:h.result.channelName,decrypted:!0,timestamp:N[0]|N[1]<<8|N[2]<<16|N[3]<<24,flags:N[4],senderName:C>0?j.slice(0,C):void 0,text:C>0?j.slice(C+2):j};a==null||a(k),l(""),f(!1)}else x(h.error)}catch(m){x(m instanceof Error?m.message:"Unknown error")}finally{o(!1)}}},[i,t,a]);return s?e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-xl p-4 sm:p-5",style:{backgroundColor:"color-mix(in srgb, var(--elevated) 60%, var(--body))",boxShadow:`
              inset 0 0 0 1px color-mix(in srgb, var(--fg-primary) 6%, transparent),
              inset 0 1px 0 color-mix(in srgb, white 3%, transparent),
              0 1px 2px color-mix(in srgb, black 5%, transparent)
            `},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 h-[15px]",children:[e.jsx("div",{className:"h-2.5 w-12 rounded bg-subtle-fill-hover animate-pulse"}),e.jsx("div",{className:"h-2.5 w-16 rounded bg-subtle-fill-hover animate-pulse"})]}),e.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tl-md",style:{background:"color-mix(in srgb, var(--sys-blue) 30%, transparent)"},children:e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("div",{className:"h-3.5 w-48 rounded bg-subtle-fill-strong animate-pulse"}),e.jsx("div",{className:"h-3.5 w-32 rounded bg-subtle-fill-strong animate-pulse"})]})})]})}):t.decrypted?e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-xl p-4 sm:p-5",style:{backgroundColor:"color-mix(in srgb, var(--elevated) 60%, var(--body))",boxShadow:`
              inset 0 0 0 1px color-mix(in srgb, var(--fg-primary) 6%, transparent),
              inset 0 1px 0 color-mix(in srgb, white 3%, transparent),
              0 1px 2px color-mix(in srgb, black 5%, transparent)
            `},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.senderName&&e.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:["From ",e.jsx("span",{className:"text-fg-secondary font-medium",children:t.senderName})]}),t.channelName&&e.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:["in ",e.jsx("span",{className:"text-sys-cyan font-medium",children:t.channelName})]})]}),e.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tl-md",style:{background:"linear-gradient(135deg, var(--sys-blue) 0%, color-mix(in srgb, var(--sys-blue) 85%, var(--sys-cyan)) 100%)"},children:e.jsx("p",{className:"text-sm text-white font-sans leading-relaxed whitespace-pre-wrap break-words",children:t.text})})]})}):e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-zinc-500/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--zinc-500) 0%, color-mix(in srgb, var(--zinc-500) 70%, black) 100%)"},children:e.jsx(ot,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:t.isPublicHashChannel?"Public Hash Channel":"Encrypted Message"}),e.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:["Channel hash: ",e.jsxs("span",{className:"font-mono",children:["0x",t.channelHash]})]})]})]}),e.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{className:"w-4 h-4 text-zinc-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:r})]}),t.ciphertextHex&&t.macHex&&e.jsx("div",{className:"space-y-2",children:g?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:i,onChange:m=>l(m.target.value),placeholder:"Channel name (e.g. south-bay)",className:"flex-1 px-3 py-1.5 text-sm rounded-lg bg-subtle-fill-strong border border-edge-subtle text-fg-primary placeholder:text-fg-muted focus:outline-none focus:border-zinc-500",onKeyDown:m=>m.key==="Enter"&&y(),disabled:c}),e.jsx("button",{onClick:y,disabled:c||!i.trim(),className:"px-3 py-1.5 text-sm font-medium rounded-lg bg-zinc-600 hover:bg-zinc-500 text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:c?"Testing...":"Try"}),e.jsx("button",{onClick:()=>{f(!1),x(null),l("")},className:"px-2 py-1.5 text-sm rounded-lg hover:bg-subtle-fill-strong text-fg-muted transition-colors",children:"×"})]}),u&&e.jsx("p",{className:"text-xs text-sys-red",children:u})]}):e.jsx("button",{onClick:()=>f(!0),className:"text-xs text-zinc-400 hover:text-zinc-300 underline underline-offset-2 transition-colors",children:"Know the channel name? Try to decrypt"})}),!g&&e.jsx("p",{className:"text-xs text-fg-muted",children:t.isPublicHashChannel?"Public hash channel message. Key not in common channel list.":"Unknown hash channel. Channel name required for decryption."})]})]})})}function _n({decoded:t,timestamp:n}){const s=n?ie(n):"Unknown";return e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:"linear-gradient(135deg, var(--sys-green) 0%, var(--sys-teal) 100%)"},children:e.jsx(sa,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-fg-primary font-sans",children:"Acknowledgment"}),e.jsxs("p",{className:"text-xs text-fg-muted font-sans mt-0.5",children:["CRC: ",e.jsxs("span",{className:"font-mono text-sys-green",children:["0x",t.crc]})," · ",s]})]})]})}function Mn({decoded:t,timestamp:n}){const s=n?ie(n):"Unknown",a=t.path.length;return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-amber/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-amber) 0%, var(--sys-orange) 100%)"},children:e.jsx(Ma,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:"Path Response"}),e.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:[a," ",a===1?"hop":"hops"]})]})]}),e.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),e.jsxs("div",{className:"px-4 py-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{className:"w-4 h-4 text-sys-amber flex-shrink-0"}),e.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:s})]}),t.path.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-edge-subtle",children:e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:t.path.map((r,i)=>e.jsxs("div",{className:"flex items-center gap-2",children:[i>0&&e.jsx(pe,{className:"w-4 h-4 text-sys-amber"}),e.jsx(B,{color:"amber",className:"font-mono",children:r})]},i))})})]})]})})}function Tn({decoded:t,timestamp:n}){const s=n?ie(n):"Unknown",a=t.pathHashes.length,r=t.snrValues.length,i=l=>l>=7?"green":l>=0?"yellow":l>=-5?"orange":"red";return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-blue/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-blue) 0%, var(--sys-indigo) 100%)"},children:e.jsx(ta,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:["Trace ",t.isComplete?"Complete":"In Progress"]}),e.jsxs("p",{className:"text-sm text-fg-muted mt-0.5",children:["Tag: 0x",t.traceTag.slice(0,8),t.isComplete&&" • ✓"]})]})]}),e.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{className:"w-4 h-4 text-sys-blue flex-shrink-0"}),e.jsx("span",{className:"text-sm text-fg-secondary",children:s})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-fg-muted",children:[e.jsxs("span",{children:[a," target ",a===1?"hop":"hops"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[r," SNR ",r===1?"sample":"samples"]}),t.authCode!==0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Auth: ",t.authCode]})]})]}),t.pathHashes.length>0&&e.jsx("div",{className:"flex flex-wrap items-center gap-2 pt-1",children:t.pathHashes.map((l,c)=>{const o=t.snrValues[c],u=o!==void 0?i(o):"zinc",x=o!==void 0;return e.jsxs("div",{className:"flex items-center gap-2",children:[c>0&&e.jsx(pe,{className:"w-4 h-4 text-sys-blue flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(B,{color:x?"blue":"zinc",className:"font-mono",children:l}),x&&e.jsxs(B,{color:u,className:"font-mono",children:[o>=0?"+":"",Number.isInteger(o)?o:o.toFixed(1),"dB"]})]})]},c)})})]})]})})}function Pn({decoded:t,timestamp:n}){const s=n?ie(n):"Unknown";return t.encrypted?e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:"linear-gradient(135deg, var(--sys-indigo) 0%, var(--sys-blue) 100%)"},children:e.jsx(ot,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-fg-primary font-sans",children:"Encrypted Message"}),e.jsxs("p",{className:"text-xs text-fg-muted font-sans mt-0.5",children:[t.srcHash," → ",t.destHash," · ",s]})]})]}):e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5 px-1",children:[e.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:[e.jsx("span",{className:"font-mono text-fg-secondary",children:t.srcHash})," → ",e.jsx("span",{className:"font-mono text-fg-secondary",children:t.destHash})]}),e.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:["· ",s]})]}),e.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tr-md ml-auto",style:{background:"linear-gradient(135deg, var(--sys-green) 0%, var(--sys-teal) 100%)"},children:e.jsx("p",{className:"text-sm text-white font-sans leading-relaxed whitespace-pre-wrap break-words",children:t.text})})]})}function Bn({decoded:t,timestamp:n}){const s=n?ie(n):"Unknown",a=(t.partNumber+1)/t.totalParts*100;return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-yellow/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-yellow) 0%, var(--sys-amber) 100%)"},children:e.jsx(ea,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:"Multipart Segment"}),e.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:["Part ",t.partNumber+1," of ",t.totalParts]})]})]}),e.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.jsx("div",{children:e.jsx("div",{className:"h-2 bg-subtle-fill-strong rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${a}%`,background:"linear-gradient(90deg, var(--sys-yellow), var(--sys-amber))"}})})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Kt,{className:"w-4 h-4 text-sys-yellow flex-shrink-0"}),e.jsxs("span",{className:"text-sm text-fg-secondary font-sans",children:["Message ID: ",e.jsx("span",{className:"font-mono",children:t.messageId})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{className:"w-4 h-4 text-sys-yellow flex-shrink-0"}),e.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:s})]})]})]})})}function Ln({decoded:t,timestamp:n,payloadType:s}){const a=n?ie(n):"Unknown",i=(()=>{switch(s){case re.REQ:return{icon:ws,gradient:"var(--sys-orange), var(--sys-red)",bg:"rgba(249, 115, 22, 0.15)",label:"Request"};case re.RESPONSE:return{icon:Sa,gradient:"var(--sys-green), var(--sys-teal)",bg:"rgba(34, 197, 94, 0.15)",label:"Response"};case re.ANON_REQ:return{icon:ot,gradient:"var(--sys-indigo), var(--sys-pink)",bg:"rgba(91, 91, 214, 0.15)",label:"Anonymous Request"};default:return{icon:Xs,gradient:"var(--sys-gray), var(--sys-slate)",bg:"rgba(107, 114, 128, 0.15)",label:t.payloadTypeName}}})(),l=i.icon;return e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:`linear-gradient(135deg, ${i.gradient})`},children:e.jsx(l,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-fg-primary font-sans",children:i.label}),e.jsxs("p",{className:"text-xs text-fg-muted font-sans mt-0.5",children:[t.length," bytes · ",a]})]})]})}function Rn({pathHex:t}){if(!t)return null;const n=Ge(t);return e.jsx("div",{className:"flex flex-wrap items-center gap-2 py-2",children:n.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[a>0&&e.jsx(pe,{className:"w-4 h-4 text-sys-amber flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(X,{size:"compact",copy:!0,children:s.toUpperCase()}),e.jsx("span",{className:"text-xs text-fg-muted font-sans tabular-nums w-4 text-left",children:a+1})]})]},a))})}function En({decoded:t,payloadType:n}){const s=Ns[n]||`TYPE_${n}`;switch(t.type){case"advert":{const a=t.nodeType==="chat"?"companion":t.nodeType.replace("_"," "),r=t.latitude!==void 0&&t.longitude!==void 0&&!(t.latitude===0&&t.longitude===0);return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Role:"})," ",a]}),t.name&&e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Name:"})," ",t.name]}),r&&e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Location:"})," ",t.latitude.toFixed(4),"°, ",t.longitude.toFixed(4),"°"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Time:"})," ",ie(t.timestamp)]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Flags:"})," ",t.flagsDescription]})]})}case"ack":return e.jsx("div",{className:"text-xs text-fg-primary space-y-0.5",children:e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"CRC:"})," 0x",t.crc]})});case"path":return e.jsx("div",{className:"text-xs text-fg-primary space-y-1",children:e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Path:"})," ",t.pathString||"(empty)"]})});case"trace":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Tag:"})," 0x",t.traceTag]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Target Path:"})," ",t.pathString||"(empty)"]}),t.snrValues.length>0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"SNR:"})," ",t.snrValues.map(a=>`${a>=0?"+":""}${Number.isInteger(a)?a:a.toFixed(1)}dB`).join(" → ")]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Status:"})," ",t.isComplete?"✓ Complete":`In progress (${t.snrValues.length}/${t.pathHashes.length})`]})]});case"txt_msg":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Dest:"})," ",t.destHash]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Src:"})," ",t.srcHash]}),t.encrypted?e.jsx("p",{className:"text-fg-muted italic",children:"Encrypted content"}):e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Text:"})," ",t.text]})]});case"grp_txt":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Channel:"})," ",t.channelName?e.jsx("span",{className:"text-sys-green",children:t.channelName}):t.isPublicHashChannel?e.jsx("span",{className:"text-sys-indigo",children:"Public Hash Channel"}):e.jsxs("span",{className:"font-mono",children:["0x",t.channelHash]})]}),t.decrypted?e.jsxs(e.Fragment,{children:[t.senderName&&e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"From:"})," ",t.senderName]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Text:"})," ",t.text]})]}):t.isPublicHashChannel?e.jsx("p",{className:"text-fg-muted italic",children:"Encrypted (public hash channel)"}):e.jsx("p",{className:"text-fg-muted italic",children:"Encrypted (unknown channel)"})]});case"grp_data":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Channel:"})," ",t.channelName?e.jsx("span",{className:"text-sys-teal",children:t.channelName}):e.jsxs("span",{className:"font-mono",children:["0x",t.channelHash]})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Data:"})," ",t.dataLength," bytes ",t.decrypted?"(decrypted)":"(encrypted)"]})]});case"multipart":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Part:"})," ",t.partNumber+1,"/",t.totalParts]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Message ID:"})," ",t.messageId]})]});case"control":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Control:"})," ",t.subtypeName]}),t.dataLength>0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Data:"})," ",t.dataLength," bytes"]})]});case"req":case"response":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Dest:"})," ",t.destHash]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Src:"})," ",t.srcHash]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Ciphertext:"})," ",t.ciphertextLength," bytes"]})]});case"anon_req":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Dest:"})," ",t.destHash]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Pub Key:"})," ",e.jsxs("span",{className:"font-mono break-all",children:[t.senderPublicKey.slice(0,16),"…"]})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Ciphertext:"})," ",t.ciphertextLength," bytes"]})]});default:return e.jsxs("p",{className:"text-xs text-fg-secondary",children:[s," (","length"in t?t.length:0," bytes)"]})}}function zn({packet:t,decodedGrpTxt:n}){var F,Y;const s=t.raw_packet||"",a=s.length/2,r=ys(),[i,l]=p.useState(null),[c,o]=p.useState(null),[u,x]=p.useState(!1),[g,f]=p.useState(null),y=p.useCallback(D=>{f(E=>E===D?null:D)},[]),m=p.useMemo(()=>Is(s),[s]),v=(F=m==null?void 0:m.packet)==null?void 0:F.payloadType,T=(m==null?void 0:m.payloadHex)||"",h=(Y=m==null?void 0:m.packet)==null?void 0:Y.payload,N=v===re.GRP_TXT,j=v===re.GRP_DATA,C=N&&!n&&(!r||u);if(p.useEffect(()=>{if(l(null),x(!1),n||!N||!h||h.length<4)return;if(!r){x(!0);return}x(!0);let D=!1;return Ks(h).then(E=>{D||(l(E),x(!1))}),()=>{D=!0}},[T,N,r,n]),p.useEffect(()=>{if(o(null),!j||!h||h.length<4||!r)return;let D=!1;return Ys(h).then(E=>{D||o(E)}),()=>{D=!0}},[T,j,r]),!m||s.length===0)return e.jsx("div",{className:"p-4 text-center text-fg-muted",children:e.jsx("p",{className:"text-sm",children:"No raw packet data available"})});const{packet:k}=m;let b=m.decoded;n&&m.decoded.type==="grp_txt"?b=n:i&&m.decoded.type==="grp_txt"?b=i:c&&m.decoded.type==="grp_data"&&(b=c);const A=()=>{switch(b.type){case"advert":return e.jsx(kn,{advert:b,timestamp:t.timestamp});case"grp_data":return e.jsx(Cn,{decoded:b,timestamp:t.timestamp});case"grp_txt":return e.jsx(Sn,{decoded:b,timestamp:t.timestamp,isLoading:C,onDecrypted:l});case"ack":return e.jsx(_n,{decoded:b,timestamp:t.timestamp});case"path":return e.jsx(Mn,{decoded:b,timestamp:t.timestamp});case"trace":return e.jsx(Tn,{decoded:b,timestamp:t.timestamp});case"txt_msg":return e.jsx(Pn,{decoded:b,timestamp:t.timestamp});case"multipart":return e.jsx(Bn,{decoded:b,timestamp:t.timestamp});case"generic":return k.payloadType===re.REQ||k.payloadType===re.RESPONSE||k.payloadType===re.ANON_REQ?e.jsx(Ln,{decoded:b,timestamp:t.timestamp,payloadType:k.payloadType}):null;default:return null}},U=p.useMemo(()=>Nn(b,m.payloadHex),[b,m.payloadHex]),W=g==="payload"||je(g),K=p.useMemo(()=>{const D=[{id:"header",hex:m.headerHex,color:"red"},...m.transportCodesHex?[{id:"transportCodes",hex:m.transportCodesHex,color:"indigo"}]:[],{id:"pathLength",hex:m.pathLengthHex,color:"green"},...m.pathDataHex?[{id:"pathData",hex:m.pathDataHex,color:"amber"}]:[]];return W?[...D,...vn(U)]:[...D,{id:"payload",hex:m.payloadHex,color:"cyan"}]},[m,W,U]);return e.jsxs("div",{className:"font-mono space-y-2 min-w-0 overflow-hidden",children:[A(),e.jsx(hn,{rawHex:s,hexSegments:K,selectedSegment:g,onSegmentClick:y}),e.jsx(js,{children:e.jsx(oe.div,{layout:!0,transition:at,className:"space-y-2 min-w-0",children:(()=>{var M,H,te,se;const E=[{id:"header",title:"Header",color:"red",startByte:0,endByte:0,hexBytes:`0x${m.headerHex.toUpperCase()}`,condition:!0,content:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"type-micro text-fg-muted border-b border-edge-subtle font-sans",children:[e.jsx("th",{className:"py-1 font-medium",children:"Bits"}),e.jsx("th",{className:"py-1 font-medium",children:"Field"}),e.jsx("th",{className:"py-1 font-medium",children:"Value"}),e.jsx("th",{className:"py-1 font-medium",children:"Binary"})]})}),e.jsx("tbody",{children:m.headerFields.map(d=>e.jsx(wn,{...d},d.bits))})]})},{id:"transportCodes",title:"Transport Codes",color:"indigo",startByte:1,endByte:4,hexBytes:((M=m.transportCodesHex)==null?void 0:M.toUpperCase())||"",condition:!!m.transportCodesHex,content:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-fg-muted",children:"Two 16-bit transport codes for encrypted routing"}),e.jsxs("div",{className:"mt-1 text-xs text-fg-secondary",children:["Code 1: 0x",(H=m.transportCodesHex)==null?void 0:H.slice(0,4).toUpperCase()," | Code 2: 0x",(te=m.transportCodesHex)==null?void 0:te.slice(4,8).toUpperCase()]})]})},{id:"pathLength",title:"Path Length",color:"green",startByte:m.transportCodesHex?5:1,endByte:m.transportCodesHex?5:1,hexBytes:`0x${m.pathLengthHex.toUpperCase()}`,condition:!0,content:e.jsxs("p",{className:"text-xs text-fg-muted pt-1",children:[k.pathLen," bytes showing route taken (increases as packet floods)"]})},{id:"pathData",title:"Path Data",color:"amber",startByte:m.transportCodesHex?6:2,endByte:(m.transportCodesHex?5:1)+k.pathLen,hexBytes:((se=m.pathDataHex)==null?void 0:se.toUpperCase())||"",condition:k.pathLen>0,content:e.jsxs("div",{className:"space-y-3",children:[e.jsx(Rn,{pathHex:m.pathDataHex}),e.jsx("p",{className:"text-xs text-fg-muted",children:"Historical route taken (bytes are added as packet floods through network)"})]})},{id:"payload",title:"Payload",color:"cyan",startByte:m.payloadStartByte,endByte:a-1,hexBytes:m.payloadHex.toUpperCase(),condition:!0,content:e.jsxs(e.Fragment,{children:[!je(g)&&e.jsxs("div",{className:"p-3 rounded-lg bg-black",children:[e.jsx("p",{className:"type-micro text-fg-muted mb-1.5 font-sans",children:"Decoded"}),e.jsx(En,{decoded:b,payloadType:k.payloadType})]}),!je(g)&&U.length>0&&e.jsx("p",{className:"type-micro text-fg-muted mt-3 font-sans",children:"Click a field below to highlight its bytes"}),je(g)&&e.jsx("p",{className:"type-micro text-fg-muted font-sans",children:"↑ Selected field above • Other fields below ↓"})]})}].filter(d=>d.condition),O=je(g)?U.find(d=>d.id===g):null,$=je(g)?[...E].sort((d,Z)=>d.id==="payload"?-1:Z.id==="payload"?1:0):[...E].sort((d,Z)=>d.id===g?-1:Z.id===g?1:0),J=je(g)?U.filter(d=>d.id!==g):[];return e.jsxs(e.Fragment,{children:[O&&e.jsx(Ct,{id:`subfield-${O.id}`,title:O.title,color:O.color,startByte:m.payloadStartByte+O.startByte,endByte:m.payloadStartByte+O.endByte,hexBytes:O.hex.toUpperCase(),isSelected:!0,children:O.decoded},O.id),$.map(d=>e.jsx(Ct,{id:`section-${d.id}`,title:d.title,color:d.color,startByte:d.startByte,endByte:d.endByte,hexBytes:d.hexBytes,isSelected:d.id===g,children:d.content},d.id)),J.map(d=>e.jsxs(oe.div,{layout:"position",layoutId:`subfield-${d.id}`,transition:at,className:"w-full min-w-0 overflow-hidden rounded-xl p-4 sm:p-5 space-y-4",style:{backgroundColor:Te.cardRestBg,boxShadow:Te.cardRestShadow},children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-0.5 min-w-0",children:[e.jsx(B,{color:d.color,children:d.title}),d.hex.length<=32&&Ge(d.hex).map((Z,q)=>e.jsx(B,{color:d.color,className:"font-mono",children:Z.toUpperCase()},q))]}),e.jsxs("span",{className:"type-data-xs text-fg-muted flex-shrink-0",children:["Bytes ",m.payloadStartByte+d.startByte,"-",m.payloadStartByte+d.endByte]})]}),e.jsx("div",{className:"min-w-0 overflow-hidden p-3 rounded-lg bg-black",children:d.decoded})]},d.id))]})})()})})]})}const St=p.memo(zn);function _t(t){if(!t)return[];if(Array.isArray(t))return t;try{const n=JSON.parse(t);return Array.isArray(n)?n:[]}catch{return[]}}function nt({hop:t,compact:n=!1,index:s=0,highlightIndex:a=-1,isTrace:r=!1}){var c;const i=s===a,l=za();return p.useEffect(()=>{i&&r&&l.start({boxShadow:["0 0 0 0px rgba(113, 156, 223, 0)","0 0 0 2px rgba(113, 156, 223, 0.5)","0 0 0 2px rgba(113, 156, 223, 0.5)","0 0 0 0px rgba(113, 156, 223, 0)"],transition:{duration:.5,times:[0,.2,.7,1],ease:"easeInOut"}})},[i,r,l]),e.jsxs(oe.div,{className:R("flex items-center gap-1.5",n?"flex-row":"flex-col"),animate:{scale:i?1.05:1,opacity:i?1:.85},transition:{duration:.3,ease:"easeInOut"},children:[e.jsxs(oe.div,{className:R("flex items-center gap-1.5 px-2.5 py-1 rounded-md","font-mono text-xs font-semibold",t.isLocal?"bg-sys-amber/20 text-sys-amber ring-1 ring-sys-amber/30":"bg-elevated/50 text-fg-primary ring-1 ring-edge-strong/50"),animate:l,initial:{boxShadow:"0 0 0 0px rgba(113, 156, 223, 0)"},children:[t.isLocal&&e.jsx(na,{className:"w-3 h-3"}),e.jsx("span",{children:t.prefix}),t.confidence!==void 0&&t.confidence<.9&&e.jsxs("span",{className:"text-[9px] opacity-70",children:[(t.confidence*100).toFixed(0),"%"]})]}),!n&&((c=t.neighborInfo)==null?void 0:c.name)&&e.jsx("span",{className:"text-xs text-fg-muted truncate max-w-[80px]",children:t.neighborInfo.name})]})}function Fn({snr:t,sf:n}){const s=_s(t,n),r=Ss()[s]||"#6b7280",i=Number.isInteger(t)?t.toString():t.toFixed(1);return e.jsxs(B,{customColor:r,compact:!0,className:"font-mono",children:[t>=0?"+":"",i,"dB"]})}function In({hops:t,compact:n,isTrace:s=!1,sf:a}){const[r,i]=p.useState(-1);return p.useEffect(()=>{if(t.length===0)return;const l=setTimeout(()=>{i(0)},400),c=setInterval(()=>{i(o=>{const u=o+1;return u>=t.length?(clearInterval(c),-1):u})},s?500:600);return()=>{clearTimeout(l),clearInterval(c)}},[t.length,s]),e.jsx("div",{className:"p-6",style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"4px 8px"},children:t.map((l,c)=>{const o=c%2===0,u=c===t.length-1;return e.jsxs("div",{className:"contents",children:[e.jsx("div",{className:R("flex items-center","justify-end"),children:o&&e.jsx(nt,{hop:l,compact:n,index:c,highlightIndex:r,isTrace:s})}),e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[28px]",children:!u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px flex-1 bg-border-strong/40 min-h-[8px]"}),l.snr!==void 0&&e.jsx(Fn,{snr:l.snr,sf:a}),e.jsx("svg",{className:"w-3 h-3 text-fg-muted flex-shrink-0",viewBox:"0 0 12 12",fill:"none",children:e.jsx("path",{d:"M6 2v8M3 7l3 3 3-3",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]})}),e.jsx("div",{className:R("flex items-center","justify-start"),children:!o&&e.jsx(nt,{hop:l,compact:n,index:c,highlightIndex:r,isTrace:s})})]},`${l.prefix}-${c}`)})})}function An({packet:t,neighbors:n,localHash:s,neighborAffinity:a,ghostPrefixes:r,direction:i="horizontal",compact:l=!1,traceSnr:c,overridePath:o}){const u=c!==void 0&&c.length>0,x=ks(),g=_t(t.original_path),f=_t(t.forwarded_path),y=o??(f.length>0?f:g),m=s?De(s):"",v=p.useMemo(()=>y.map((h,N)=>{const j=h.toUpperCase(),C=j===m,k=(r==null?void 0:r.has(j))??!1,b=Cs(j,n,a);return{prefix:j,fullHash:b==null?void 0:b.hash,neighborInfo:b==null?void 0:b.info,isLocal:C,isGhost:k,confidence:b==null?void 0:b.confidence,snr:c==null?void 0:c[N]}}),[y,n,a,m,r,c]);if(v.length===0)return e.jsxs("div",{className:"flex items-center gap-2 text-fg-muted text-xs",children:[e.jsx(de,{className:"w-4 h-4 opacity-50"}),e.jsx("span",{children:"Direct / No path data"})]});if(i==="flowchart")return e.jsx(In,{hops:v,compact:l,isTrace:u,sf:x});const T=i==="horizontal"?pe:qt;return e.jsx("div",{className:R("flex gap-1.5",i==="horizontal"?"flex-row flex-wrap items-center":"flex-col items-start"),children:v.map((h,N)=>e.jsxs("div",{className:R("flex items-center gap-1.5",i==="vertical"&&"flex-col"),children:[e.jsx(nt,{hop:h,compact:l}),N<v.length-1&&e.jsx(T,{className:"w-3 h-3 text-fg-muted flex-shrink-0"})]},`${h.prefix}-${N}`))})}const Se=p.memo(An);function ee(t,n){if(t!=null)return typeof t=="boolean"?String(t):typeof t=="number"&&n?`${t} ${n}`:String(t)}const V=()=>"blue",Dn=[{fn:"id",group:"identity",fmt:"int",read:t=>ee(t.id),color:V},{fn:"packet_hash",group:"identity",fmt:"hex<sha256>",read:t=>t.packet_hash||void 0,color:V},{fn:"timestamp",group:"identity",fmt:"epoch<s>",read:t=>t.timestamp?String(t.timestamp):void 0,color:V,annotate:t=>t.timestamp>0?Je(t.timestamp):void 0},{fn:"type",group:"classification",fmt:"enum<payload_type>",read:t=>ee(t.type??t.payload_type),color:V},{fn:"route",group:"classification",fmt:"enum<route_type>",read:t=>ee(t.route??t.route_type),color:V},{fn:"rssi",group:"signal",fmt:"int<dBm>",read:t=>ee(t.rssi,"dBm"),color:V},{fn:"snr",group:"signal",fmt:"float<dB>",read:t=>ee(t.snr,"dB"),color:V},{fn:"path_length",group:"size",fmt:"int<hops>",read:t=>{if(t.path_length!=null)return t.path_length===0?"zero-hop":`${t.path_length} hops`},color:V},{fn:"payload_length",group:"size",fmt:"int<B>",read:t=>ee(t.payload_length,"B"),color:V},{fn:"airtime",group:"size",fmt:"float<ms>",read:t=>ee(t.airtime_ms,"ms"),color:V},{fn:"src_hash",group:"addressing",fmt:"hex<2>",read:t=>t.src_hash??void 0,color:V},{fn:"dst_hash",group:"addressing",fmt:"hex<2>",read:t=>t.dst_hash??void 0,color:V},{fn:"path_hash",group:"addressing",fmt:"hex[]|hex",read:t=>Array.isArray(t.path_hash)?`[${t.path_hash.join(", ")}]`:ee(t.path_hash),color:V,renderValue:t=>Array.isArray(t.path_hash)?Xe(t.path_hash):null},{fn:"score",group:"addressing",fmt:"int",read:t=>ee(t.score),color:V},{fn:"original_path",group:"paths",fmt:"hex[]",read:t=>Array.isArray(t.original_path)?`[${t.original_path.join(", ")}]`:void 0,color:V,renderValue:t=>Array.isArray(t.original_path)&&t.original_path.length>0?Xe(t.original_path,t.src_hash||void 0,t.dst_hash||void 0,!0):null},{fn:"forwarded_path",group:"paths",fmt:"hex[]",read:t=>Array.isArray(t.forwarded_path)?`[${t.forwarded_path.join(", ")}]`:void 0,color:V,renderValue:t=>Array.isArray(t.forwarded_path)&&t.forwarded_path.length>0?Xe(t.forwarded_path):null},{fn:"transmitted",group:"status",fmt:"bool",read:t=>ee(t.transmitted),color:V},{fn:"is_duplicate",group:"status",fmt:"bool",read:t=>ee(t.is_duplicate),color:V},{fn:"drop_reason",group:"status",fmt:"string|null",read:t=>t.drop_reason??void 0,color:V},{fn:"tx_delay",group:"status",fmt:"int<ms>",read:t=>ee(t.tx_delay_ms,"ms"),color:V},{fn:"origin",group:"status",fmt:"enum<rx|tx_local|tx_forward>",read:t=>t.packet_origin??void 0,color:V},{fn:"duplicates",group:"status",fmt:"PacketDuplicate[]",read:t=>t.duplicates!=null&&t.duplicates.length>0?`${t.duplicates.length}`:ee(t.duplicates),color:V},{fn:"lbt_attempts",group:"lbt",fmt:"int",read:t=>ee(t.lbt_attempts),color:V},{fn:"lbt_backoff",group:"lbt",fmt:"json<float[]>",read:t=>ee(t.lbt_backoff_delays_ms),color:V},{fn:"lbt_busy",group:"lbt",fmt:"bool|int",read:t=>ee(t.lbt_channel_busy),color:V}];function Xe(t,n,s,a){const r=t.length>0,i=n||a,l=s||a;return e.jsxs("span",{className:"inline-flex items-center gap-1 flex-wrap",children:[i&&e.jsxs(e.Fragment,{children:[n?e.jsx("span",{className:"inline-block border border-edge-subtle rounded px-1.5 py-0.5 font-mono text-[11px] text-sys-blue",children:n}):e.jsx("span",{className:"inline-block border border-edge-subtle/50 rounded px-1.5 py-0.5 font-mono text-[11px] text-fg-muted/30",children:"XX"}),(r||l)&&e.jsx("span",{className:"text-fg-muted/40 text-[10px]",children:"→"})]}),t.map((c,o)=>e.jsxs(p.Fragment,{children:[o>0&&e.jsx("span",{className:"text-fg-muted/40 text-[10px]",children:"→"}),e.jsx("span",{className:"inline-block border border-edge-subtle rounded px-1.5 py-0.5 font-mono text-[11px] text-sys-blue",children:c})]},o)),l&&e.jsxs(e.Fragment,{children:[r&&e.jsx("span",{className:"text-fg-muted/40 text-[10px]",children:"→"}),s?e.jsx("span",{className:"inline-block border border-edge-subtle rounded px-1.5 py-0.5 font-mono text-[11px] text-sys-blue",children:s}):e.jsx("span",{className:"inline-block border border-edge-subtle/50 rounded px-1.5 py-0.5 font-mono text-[11px] text-fg-muted/30",children:"XX"})]})]})}let Ie=null;function Hn(){if(!Ie){Ie=new Map;for(const t of Dn)Ie.set(t.fn,t)}return Ie}function Mt(t,n){var l;const s=Hn().get(n);if(!s)return null;const a=s.read(t);if(a===void 0)return null;const r=s.color(t),i=(l=s.annotate)==null?void 0:l.call(s,t);return i?{text:a,color:r,annotation:i}:{text:a,color:r}}function Tt(t){if(!t)return[];if(Array.isArray(t))return t;try{const n=JSON.parse(t);return Array.isArray(n)?n:[]}catch{return[]}}function Pt({packets:t,selectedIndex:n,onSelect:s,compact:a=!1}){if(t.length<=1)return null;const r=n>0,i=n<t.length-1;return e.jsxs("div",{className:R("flex items-center gap-1",a?"gap-0.5":"gap-1"),children:[e.jsx("button",{onClick:()=>r&&s(n-1),disabled:!r,className:R("p-0.5 radius-badge transition-base",r?"text-fg-muted hover:text-fg-primary hover-bg":"text-fg-muted cursor-not-allowed"),"aria-label":"Previous observation",children:e.jsx(Yt,{className:a?"size-3":"size-4"})}),e.jsx("div",{className:"flex items-center gap-0.5",children:t.map((l,c)=>{const o=c===n,x=new Date(l.timestamp*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});return e.jsx(Es,{color:o?"cyan":"zinc",filled:o,compact:a,onClick:()=>s(c),title:`Observation ${c+1} at ${x}`,className:R("transition-all duration-150",!o&&"opacity-60 hover:opacity-100"),children:a?e.jsx("span",{className:"tabular-nums",children:c+1}):e.jsxs("span",{className:"tabular-nums text-xs",children:["#",c+1,l.rssi!=null&&e.jsx("span",{className:"ml-1 opacity-70",children:l.rssi})]})},`${l.timestamp}_${c}`)})}),e.jsx("button",{onClick:()=>i&&s(n+1),disabled:!i,className:R("p-0.5 radius-badge transition-base",i?"text-fg-muted hover:text-fg-primary hover-bg":"text-fg-muted cursor-not-allowed"),"aria-label":"Next observation",children:e.jsx(ct,{className:a?"size-3":"size-4"})}),e.jsxs("span",{className:R("text-fg-muted ml-1",a?"text-[9px]":"text-xs"),children:[e.jsx(it,{className:"inline size-3 mr-0.5 opacity-50"}),t.length]})]})}function Ae({icon:t,label:n,disabled:s=!1}){return e.jsx(oe.div,{className:"flex items-center gap-1 text-xs",title:n,animate:{opacity:s?.25:.6},transition:{duration:.15,ease:[.4,0,.2,1]},children:e.jsx("span",{className:R("flex items-center justify-center size-5 radius-badge border-control transition-base",s?"bg-subtle-fill border-edge-subtle":"bg-subtle-fill"),children:t})})}function On({hasDuplicates:t,hasPrev:n,hasNext:s,canPrevDupe:a,canNextDupe:r}){return e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(Ae,{icon:e.jsx(ja,{className:"size-3"}),label:"Previous packet (↑)",disabled:!n}),e.jsx(Ae,{icon:e.jsx(zs,{className:"size-3"}),label:"Next packet (↓)",disabled:!s})]}),t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-3 bg-subtle-fill-strong"}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(Ae,{icon:e.jsx(Yt,{className:"size-3"}),label:"Previous observation (←)",disabled:!a}),e.jsx(Ae,{icon:e.jsx(ct,{className:"size-3"}),label:"Next observation (→)",disabled:!r})]})]})]})}function $n({packets:t,initialIndex:n=0,onClose:s,onNavigatePrev:a,onNavigateNext:r,hasPrev:i=!1,hasNext:l=!1,resolveSource:c,getDecodedContent:o}){var ze;const[u,x]=p.useState(n),g=t[u]??t[0],f=t.length>1,[y,m]=p.useState(null),[v,T]=p.useState(!1);p.useEffect(()=>{if(!g._stripped){m(null);return}let G=!1;T(!0);const w=g.packet_hash;if(!w){T(!1);return}return Ms(w).then(S=>{G||(S.success&&S.data&&(m(S.data),(S.data.type??S.data.payload_type)===re.GRP_TXT&&S.data.raw_packet&&Ts.getState().queueDecryption([S.data])),T(!1))}).catch(()=>{G||T(!1)}),()=>{G=!0}},[g]);const h=y??g,N=u>0,j=u<t.length-1,C=p.useCallback(G=>{x(Math.max(0,Math.min(G,t.length-1)))},[t.length]);p.useEffect(()=>{const G=w=>{if(!(w.target instanceof HTMLInputElement||w.target instanceof HTMLTextAreaElement))switch(w.key){case"ArrowUp":w.preventDefault(),a==null||a();break;case"ArrowDown":w.preventDefault(),r==null||r();break;case"ArrowLeft":w.preventDefault(),N&&x(S=>S-1);break;case"ArrowRight":w.preventDefault(),j&&x(S=>S+1);break}};return window.addEventListener("keydown",G),()=>window.removeEventListener("keydown",G)},[a,r,N,j]);const k=Ht(),b=Ps(),A=Bs(),U=Ls(),W=p.useMemo(()=>new Set(U.map(G=>G.prefix.toUpperCase())),[U]),K=h.payload_type_name||At(h.payload_type??h.type),F=h.route_type_name||Dt(h.route_type??h.route),Y=h.payload_length??h.length??0,D=Tt(h.original_path),E=Tt(h.forwarded_path),O=D.length>0||E.length>0,$=E.length>0?E:D,J=p.useMemo(()=>{var G;if((G=k==null?void 0:k.config)!=null&&G.repeater)return{latitude:k.config.repeater.latitude,longitude:k.config.repeater.longitude,name:k.config.node_name||"Local Node"}},[k]),M=(k==null?void 0:k.neighbors)??{},H=A.size>0?A:void 0,te=h.raw_packet&&h.raw_packet.length>0,se=g._stripped&&v,d=p.useMemo(()=>c?c(h):null,[c,h]),Z=Rs(h.packet_hash),q=p.useMemo(()=>!o||(h.payload_type??h.type)!==re.GRP_TXT?null:o(h),[o,h]),le=p.useMemo(()=>{if((h.payload_type??h.type)!==re.GRP_TXT)return null;if(Z!=null&&Z.decoded){const w=Z.decoded;return{type:"grp_txt",channelHash:w.channelHash,channelName:w.channelName,text:w.text??"",decrypted:w.decrypted,senderName:w.senderName,timestamp:w.timestamp,flags:w.flags,macCorrupted:w.macCorrupted}}return q!=null&&q.decrypted?{type:"grp_txt",channelHash:q.channelHash??"",channelName:q.channelName??"",text:q.text??"",decrypted:!0,senderName:q.senderName??"",timestamp:0,flags:0,macCorrupted:q.corrupted}:null},[h,Z,q]),P=p.useMemo(()=>As(h,le),[h,le]),z=P.kind==="trace"?P.data:null,ae=P.kind==="trace"?P.snrValues:void 0,_=P.kind==="advert"?P.data:null,ce=P.kind==="advert"?P.sourceNode:void 0,fe=P.kind==="grp_txt"?P.wardriveSourceNode??void 0:void 0,ne=P.kind==="anon_req"?P.data:null,Le=G=>!G||G===0?"Unknown":new Date(G*1e3).toLocaleString(),be=(h.payload_type??h.type)===re.ADVERT&&(ce!==void 0||O),Re=fe!==void 0,Ne=ce??fe,qe=Be[K]??"zinc",Ee=ue[qe]||ue.zinc;return e.jsxs(Ot,{open:!0,onClose:s,size:"5xl",motionPlus:!0,className:"sm:h-[85vh] sm:max-h-[800px] md:h-[80vh] md:max-h-[900px]",children:[e.jsxs("div",{className:"sm:hidden",children:[e.jsx("div",{className:"flex justify-center pt-2 pb-1",children:e.jsx("div",{className:"w-9 h-1 rounded-full bg-fg-muted","aria-hidden":"true"})}),e.jsxs("div",{className:"flex items-center justify-between px-3 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(B,{color:Be[K]??"zinc",className:"!text-[9px] !px-1.5 !py-0",children:K}),e.jsx(B,{color:He[F]??"zinc",className:"!text-[9px] !px-1.5 !py-0",children:F}),e.jsxs(B,{color:"zinc",className:"!text-[9px] !px-1.5 !py-0",children:[Y,"B"]})]}),e.jsx("button",{onClick:s,className:"px-3 py-1.5 text-[15px] font-medium text-sys-blue active:text-sys-blue/80 transition-base flex-shrink-0 radius-inner active:bg-subtle-fill",children:"Done"})]}),f&&e.jsx("div",{className:"px-3 pb-2",children:e.jsx(Pt,{packets:t,selectedIndex:u,onSelect:C,compact:!0})})]}),e.jsx("div",{className:"hidden sm:block px-6 pt-5 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{color:Be[K]??"zinc",children:K}),e.jsx(B,{color:He[F]??"zinc",children:F}),e.jsxs(B,{color:"zinc",children:[Y,"B"]}),f&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-4 bg-subtle-fill-strong"}),e.jsx(Pt,{packets:t,selectedIndex:u,onSelect:C})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(On,{hasDuplicates:f,hasPrev:i,hasNext:l,canPrevDupe:N,canNextDupe:j}),e.jsx("button",{onClick:s,className:"p-1.5 -m-1.5 text-fg-muted hover:text-fg-primary transition-base radius-inner hover:bg-elevated flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})}),e.jsx("div",{className:"sm:hidden h-[2px]",style:{backgroundColor:Ee,opacity:.6}}),e.jsxs($t,{className:"p-0 overflow-hidden flex-1 flex flex-col min-h-0",children:[e.jsx("div",{className:"md:hidden flex-1 overflow-y-auto overflow-x-hidden",children:e.jsxs("div",{className:"p-2 space-y-2",children:[(h.rssi!=null||h.snr!=null)&&e.jsxs("div",{className:"relative flex items-center justify-between px-2 py-1.5 radius-inner bg-subtle-fill",children:[e.jsx(Ke,{mode:"popLayout",initial:!1,children:e.jsxs(oe.div,{className:"flex items-center gap-3",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[e.jsx(Oe,{rssi:h.rssi,snr:h.snr,compact:!0,showValues:!0,validated:$e(h)}),e.jsx("span",{className:"text-[11px] text-fg-muted",children:pt(h.rssi)})]},u)}),$.length>0&&e.jsxs("span",{className:"type-data-xs text-fg-muted",children:[$.length," hop",$.length!==1?"s":""]})]}),(O&&$.length>0||be||Re)&&e.jsx("div",{className:"overflow-hidden radius-inset",children:e.jsx("div",{className:"aspect-[4/3] w-full",children:e.jsx(We,{path:$,neighbors:M,localNode:J,localHash:k==null?void 0:k.local_hash,srcHash:h.src_hash,dstHash:h.dst_hash,neighborAffinity:H,hubNodes:[...b],traceSnr:ae,advertiserSource:Ne})})}),z&&z.pathHashes.length>0&&e.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[e.jsx("div",{className:"px-3 py-2 space-y-1.5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Trace Route"}),e.jsx("div",{className:"flex items-center gap-1.5",children:e.jsx(B,{color:z.isComplete?"green":"amber",compact:!0,children:z.isComplete?"Complete":"In Progress"})})]})}),e.jsx(Se,{packet:h,neighbors:M,localHash:k==null?void 0:k.local_hash,neighborAffinity:H,ghostPrefixes:W,direction:"flowchart",compact:!0,overridePath:z.pathHashes,traceSnr:z.snrValues})]}),O&&!z&&e.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Path"}),e.jsxs(B,{color:"zinc",compact:!0,children:[$.length," hop",$.length!==1?"s":""]})]}),e.jsx(Se,{packet:h,neighbors:M,localHash:k==null?void 0:k.local_hash,neighborAffinity:H,ghostPrefixes:W,direction:"flowchart",compact:!0,traceSnr:ae})]}),d&&(d.name||d.hash)&&!_&&!ne&&e.jsxs("div",{className:"radius-inset bg-subtle-fill overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-edge-subtle",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Source"}),e.jsx(B,{color:d.isRepeater?"blue":d.isCompanion?"violet":d.type==="room_server"?"lime":"zinc",compact:!0,children:d.type==="room_server"?"room server":d.type})]}),e.jsxs("div",{className:"p-3 space-y-1.5",children:[d.name&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"type-label text-fg-primary truncate",children:d.name}),!d.confident&&e.jsx("span",{className:"text-[9px] text-fg-muted/60 italic",children:"ambiguous"})]}),d.hash&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"type-data-xs text-fg-muted truncate font-mono",children:d.hash.length>16?`${d.hash.slice(0,16)}…${d.hash.slice(-8)}`:d.hash.startsWith("0x")?d.hash.slice(2,10)+"…":d.hash.slice(0,8)+"…"})]})]})]}),ne&&e.jsxs("div",{className:"radius-inset bg-subtle-fill overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-edge-subtle",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Sender Identity"}),e.jsx(B,{color:d!=null&&d.isRepeater?"blue":d!=null&&d.isCompanion?"violet":(d==null?void 0:d.type)==="room_server"?"lime":"amber",compact:!0,children:d!=null&&d.type&&d.type!=="unknown"?d.type==="room_server"?"room server":d.type:"companion"})]}),e.jsxs("div",{className:"p-3 space-y-2",children:[(d==null?void 0:d.name)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"type-label text-fg-primary truncate",children:d.name}),!d.confident&&e.jsx("span",{className:"text-[9px] text-fg-muted/60 italic",children:"ambiguous"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsxs("span",{className:"text-xs text-fg-muted",children:["Dest: ",e.jsx("span",{className:"font-mono",children:ne.destHash})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(we,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"type-data-xs text-fg-muted break-all font-mono leading-relaxed",children:ne.senderPublicKey})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsxs("span",{className:"text-xs text-fg-muted",children:[ne.ciphertextLength,"B encrypted payload"]})]})]})]}),_&&e.jsxs("div",{className:"radius-inset bg-subtle-fill overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-edge-subtle",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Advertiser Info"}),e.jsx(B,{color:"lime",compact:!0,children:_.nodeType})]}),e.jsxs("div",{className:"p-3 space-y-2",children:[_.name&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"type-label text-fg-primary truncate",children:_.name})]}),_.latitude&&_.longitude&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsxs("span",{className:"type-data-xs text-fg-secondary",children:[_.latitude.toFixed(5),", ",_.longitude.toFixed(5)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsxs("span",{className:"type-data-xs text-fg-muted truncate",children:[_.publicKey.slice(0,16),"...",_.publicKey.slice(-8)]})]}),_.timestamp>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"text-xs text-fg-muted",children:Le(_.timestamp)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"text-xs text-fg-muted",children:_.flagsDescription||`Flags: 0x${_.flags.toString(16).padStart(2,"0")}`})]})]})]}),se?e.jsx("div",{className:"pt-1 px-3 py-6 text-center",children:e.jsx("span",{className:"text-xs text-fg-muted animate-pulse",children:"Loading packet details…"})}):te?e.jsx("div",{className:"pt-1",children:e.jsx(St,{packet:h,decodedGrpTxt:le})}):null]})}),e.jsxs("div",{className:"hidden md:grid md:grid-cols-2 flex-1 overflow-hidden",children:[e.jsx("div",{className:"overflow-y-auto overflow-x-hidden scrollbar-none p-4 border-r border-edge-subtle",children:se?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("span",{className:"text-sm text-fg-muted animate-pulse",children:"Loading packet details…"})}):te?e.jsx(St,{packet:h,decodedGrpTxt:le}):null}),e.jsxs("div",{className:"grid overflow-hidden",style:{gridTemplateRows:"minmax(280px, 1fr) auto"},children:[e.jsx("div",{className:"overflow-hidden p-2",children:O&&$.length>0||be||Re?e.jsx("div",{className:"h-full w-full",children:e.jsx(We,{path:$,neighbors:M,localNode:J,localHash:k==null?void 0:k.local_hash,srcHash:h.src_hash,dstHash:h.dst_hash,neighborAffinity:H,hubNodes:[...b],traceSnr:ae,advertiserSource:Ne})}):e.jsxs("div",{className:"h-full w-full flex flex-col items-center justify-center text-center px-4",children:[e.jsx(de,{className:"w-8 h-8 text-fg-muted/50 mb-2"}),e.jsx("span",{className:"text-sm text-fg-muted",children:"Direct Reception"}),e.jsx("span",{className:"text-xs text-fg-muted/70 mt-1",children:"Zero-hop packet — received directly from sender"})]})}),e.jsxs("div",{className:"overflow-y-auto max-h-[200px] p-2 space-y-2",children:[!z&&$.length<=1&&(h.rssi!=null||h.snr!=null)&&e.jsx("div",{className:"surface-base radius-inset p-4",children:e.jsxs("dl",{className:"text-xs grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-fg-muted mb-1",children:"Signal"}),e.jsx(Ke,{mode:"popLayout",initial:!1,children:e.jsxs(oe.dd,{className:"flex items-center gap-2",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[e.jsx(Oe,{rssi:h.rssi,snr:h.snr,validated:$e(h)}),e.jsx("span",{className:"font-medium text-fg-primary",children:pt(h.rssi)})]},u)})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-fg-muted mb-1",children:"RF"}),e.jsx(Ke,{mode:"popLayout",initial:!1,children:e.jsxs(oe.dd,{className:"type-data text-fg-secondary",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[(ze=Mt(h,"rssi"))==null?void 0:ze.text,(()=>{const G=Mt(h,"snr");return G?` · ${G.text}`:null})()]},u)})]})]})}),d&&(d.name||d.hash)&&!_&&!ne&&e.jsxs("div",{className:"radius-inset bg-subtle-fill overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-edge-subtle",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Source"}),e.jsx(B,{color:d.isRepeater?"blue":d.isCompanion?"violet":d.type==="room_server"?"lime":"zinc",compact:!0,children:d.type==="room_server"?"room server":d.type})]}),e.jsxs("div",{className:"p-4 space-y-2",children:[d.name&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"type-label text-fg-primary truncate",children:d.name}),!d.confident&&e.jsx("span",{className:"text-[10px] text-fg-muted/60 italic",children:"ambiguous"})]}),d.hash&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"text-[11px] font-mono text-fg-muted truncate",children:d.hash.length>16?`${d.hash.slice(0,16)}…${d.hash.slice(-8)}`:d.hash.startsWith("0x")?d.hash.slice(2,10)+"…":d.hash.slice(0,8)+"…"})]})]})]}),ne&&e.jsxs("div",{className:"radius-inset bg-subtle-fill overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-edge-subtle",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Sender Identity"}),e.jsx(B,{color:d!=null&&d.isRepeater?"blue":d!=null&&d.isCompanion?"violet":(d==null?void 0:d.type)==="room_server"?"lime":"amber",compact:!0,children:d!=null&&d.type&&d.type!=="unknown"?d.type==="room_server"?"room server":d.type:"companion"})]}),e.jsxs("div",{className:"p-4 space-y-2.5",children:[(d==null?void 0:d.name)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"type-label text-fg-primary truncate",children:d.name}),!d.confident&&e.jsx("span",{className:"text-[10px] text-fg-muted/60 italic",children:"ambiguous"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsxs("span",{className:"text-xs text-fg-muted",children:["Dest: ",e.jsx("span",{className:"font-mono",children:ne.destHash})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(we,{className:"w-4 h-4 text-fg-muted flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-[11px] font-mono text-fg-muted break-all leading-relaxed",children:ne.senderPublicKey})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsxs("span",{className:"text-xs text-fg-muted",children:[ne.ciphertextLength,"B encrypted payload"]})]})]})]}),_&&e.jsxs("div",{className:"radius-inset bg-subtle-fill overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-edge-subtle",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Advertiser"}),e.jsx(B,{color:"lime",compact:!0,children:_.nodeType})]}),e.jsxs("div",{className:"p-4 space-y-2.5",children:[_.name&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"type-label text-fg-primary truncate",children:_.name})]}),_.latitude&&_.longitude&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsxs("span",{className:"type-data-xs text-fg-secondary",children:[_.latitude.toFixed(5),", ",_.longitude.toFixed(5)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsxs("span",{className:"text-[11px] font-mono text-fg-muted truncate",children:[_.publicKey.slice(0,16),"...",_.publicKey.slice(-8)]})]}),_.timestamp>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"text-xs text-fg-muted",children:Le(_.timestamp)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"text-[11px] text-fg-muted",children:_.flagsDescription||`Flags: 0x${_.flags.toString(16).padStart(2,"0")}`})]})]})]}),z&&z.pathHashes.length>0&&e.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Trace Route"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(B,{color:z.isComplete?"green":"amber",compact:!0,children:z.isComplete?"Complete":"In Progress"}),e.jsxs(B,{color:"teal",compact:!0,children:[z.pathHashes.length,"h"]})]})]}),e.jsx(Se,{packet:h,neighbors:M,localHash:k==null?void 0:k.local_hash,neighborAffinity:H,ghostPrefixes:W,direction:"flowchart",compact:!0,overridePath:z.pathHashes,traceSnr:z.snrValues})]}),O&&!z&&e.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Path"}),e.jsxs(B,{color:"zinc",compact:!0,children:[$.length,"h"]})]}),e.jsx(Se,{packet:h,neighbors:M,localHash:k==null?void 0:k.local_hash,neighborAffinity:H,ghostPrefixes:W,direction:"flowchart",compact:!0,traceSnr:ae})]})]})]})]})]})]})}const Un=p.memo($n);function Bt({label:t,numericValue:n,unit:s,icon:a,subtext:r,showSign:i=!1}){return e.jsxs("div",{className:"radius-inner p-3 sm:radius-inset sm:p-4 bg-subtle-fill ring-1 ring-inset ring-edge-subtle",children:[e.jsx("div",{className:"mb-1.5 sm:mb-2",children:e.jsx("span",{className:"text-xs sm:type-micro text-fg-muted",children:t})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(tt,{value:n,format:{minimumFractionDigits:1,maximumFractionDigits:1,signDisplay:i?"always":"auto"},className:"type-data-hero tracking-tight text-fg-primary"}),e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(a,{className:"w-[14px] h-[14px] text-fg-muted"}),s&&e.jsx("span",{className:"text-xs font-medium leading-tight text-fg-muted",children:s})]})]}),r&&e.jsx("p",{className:"mt-1.5 sm:mt-2 type-data-xs sm:text-[11px] text-fg-muted/80 truncate",children:r})]})}function Vn({snr:t}){const n=t>=5?"bg-sys-teal":t>=0?"bg-sys-green":t>=-5?"bg-sys-amber":t>=-10?"bg-sys-orange":"bg-sys-red";return e.jsx("span",{className:R("w-1.5 h-1.5 rounded-full flex-shrink-0",n),title:`SNR: ${t.toFixed(1)} dB`})}function Lt({fromPrefix:t,toPrefix:n,fromName:s,toName:a,snr:r,maxSnr:i,isWeakest:l,isStrongest:c,index:o=0}){const x=Math.max(i+5,15),g=Math.max(0,Math.min(100,(r- -20)/(x- -20)*100)),f="bg-[#0074BE]",y=r>=5?"bg-sys-teal":r>=0?"bg-sys-green":r>=-5?"bg-sys-amber":r>=-10?"bg-sys-orange":"bg-sys-red",m=.3+o*.15;return e.jsxs("div",{className:"relative p-3 pl-5 radius-inner bg-subtle-fill ring-1 ring-inset ring-edge-subtle",children:[e.jsx("span",{className:R("absolute left-0 top-1/2 -translate-y-1/2 h-4 w-0.5 rounded-full",y)}),e.jsx("span",{className:"absolute -top-0.5 -right-0.5",children:e.jsx(Vn,{snr:r})}),e.jsxs("div",{className:"sm:hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("span",{className:"text-[13px] font-medium text-fg-secondary truncate",children:s||t}),e.jsx(pe,{className:"w-3 h-3 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"text-[13px] font-semibold text-fg-primary truncate",children:a||n})]}),e.jsxs("div",{className:"flex items-center gap-1.5 ml-2 flex-shrink-0",children:[l&&e.jsx(B,{color:"red",compact:!0,children:"Low"}),c&&!l&&e.jsxs(B,{color:"amber",compact:!0,children:[e.jsx(wt,{className:"w-2.5 h-2.5"}),"Best"]}),e.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[12px] font-mono font-bold tabular-nums bg-subtle-fill-hover text-fg-primary ring-1 ring-inset ring-edge-subtle",children:[r>=0?"+":"−",Math.abs(r).toFixed(1)]})]})]}),e.jsx("div",{className:"h-1.5 bg-subtle-fill-strong rounded-full overflow-hidden",children:e.jsx(oe.div,{className:R("h-full rounded-full",f),initial:{width:0},animate:{width:`${g}%`},transition:{duration:1.5,delay:m,ease:[.25,.1,.25,1]}})})]}),e.jsxs("div",{className:"hidden sm:block",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx("code",{className:"type-data-xs text-fg-muted",children:t}),s&&e.jsx("span",{className:"text-xs text-fg-secondary truncate max-w-[100px]",children:s})]}),e.jsx(pe,{className:"w-3 h-3 text-fg-muted/40 flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx("code",{className:"font-mono text-xs font-semibold text-fg-primary",children:n}),a&&e.jsx("span",{className:"text-xs text-fg-secondary truncate max-w-[100px]",children:a})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[l&&e.jsx(B,{color:"red",compact:!0,children:"Bottleneck"}),c&&!l&&e.jsxs(B,{color:"amber",compact:!0,children:[e.jsx(wt,{className:"w-3 h-3"}),"Strongest"]}),e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-sm font-mono font-semibold tabular-nums bg-subtle-fill-hover text-fg-primary ring-1 ring-inset ring-edge-subtle",children:[r>=0?"+":"−",Math.abs(r).toFixed(1)]})]})]}),e.jsx("div",{className:"h-1.5 bg-elevated rounded-full overflow-hidden",children:e.jsx(oe.div,{className:R("h-full rounded-full",f),initial:{width:0},animate:{width:`${g}%`},transition:{duration:1.5,delay:m,ease:[.25,.1,.25,1]}})})]})]})}function ye(t,n){if(t==="You")return"You";const s=t.toUpperCase();for(const[a,r]of Object.entries(n))if((a.startsWith("0x")?a.slice(2,4):a.slice(0,2)).toUpperCase()===s)return r.name||r.node_name||void 0}function Wn({report:t,onClose:n}){var u,x;const s=Ht(),a=(s==null?void 0:s.neighbors)??{},r=(u=s==null?void 0:s.config)!=null&&u.repeater?{latitude:s.config.repeater.latitude,longitude:s.config.repeater.longitude,name:s.config.node_name||"Local Node"}:void 0,i=(x=t.bestObservation)==null?void 0:x.decoded.snrValues,l=t.linkQuality?t.linkQuality.avgSnr>=5?"excellent":t.linkQuality.avgSnr>=0?"good":t.linkQuality.avgSnr>=-5?"fair":"poor":"unknown",o={excellent:"var(--signal-excellent)",good:"var(--signal-good)",fair:"var(--signal-fair)",poor:"var(--signal-poor)",unknown:"var(--fg-muted)"}[l];return e.jsxs(Ot,{open:!0,onClose:n,size:"5xl",motionPlus:!0,children:[e.jsxs("div",{className:"sm:hidden",children:[e.jsx("div",{className:"flex justify-center pt-2 pb-1",children:e.jsx("div",{className:"w-9 h-1 rounded-full bg-fg-primary/30","aria-hidden":"true"})}),e.jsxs("div",{className:"flex items-center justify-between px-4 pb-2",children:[e.jsx("h2",{className:"font-semibold text-[17px] text-fg-primary",children:"Trace Report"}),e.jsx("button",{onClick:n,className:"text-[17px] font-medium text-sys-blue active:text-sys-blue/80",children:"Done"})]})]}),e.jsx("div",{className:"sm:hidden h-[2px]",style:{backgroundColor:o,opacity:.6}}),e.jsx("div",{className:"hidden sm:block px-6 pt-5 pb-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[e.jsx("h2",{className:"type-micro",children:"Trace Report"}),e.jsxs(B,{color:l==="excellent"||l==="good"?"green":l==="fair"?"amber":"red",children:[e.jsx(vt,{className:"w-3 h-3 mr-1"}),l==="excellent"?"Excellent":l==="good"?"Good":l==="fair"?"Fair":"Poor"]})]}),e.jsx("p",{className:"mt-1 text-xs sm:text-sm font-mono text-fg-muted tabular-nums",children:t.traceTag})]}),e.jsx("button",{onClick:n,className:"p-1.5 -m-1.5 text-fg-muted hover:text-fg-primary transition-base radius-inner hover:bg-elevated flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsxs("div",{className:"hidden sm:flex flex-wrap items-center gap-1.5 sm:gap-2 px-4 sm:px-6 pb-3 sm:pb-4 border-b border-edge-subtle",children:[e.jsxs(B,{color:"teal",children:[e.jsx("span",{className:"font-mono tabular-nums",children:t.targetHopCount}),e.jsxs("span",{className:"ml-1",children:["hop",t.targetHopCount!==1?"s":""]})]}),e.jsxs(B,{color:"zinc",children:[e.jsx("span",{className:"font-mono tabular-nums",children:t.observationCount}),e.jsx("span",{className:"ml-1",children:"obs"})]}),t.linkQuality&&e.jsxs(B,{color:"indigo",children:[e.jsx("span",{className:"font-mono tabular-nums",children:t.linkQuality.avgSnr.toFixed(1)}),e.jsx("span",{className:"ml-1",children:"dB avg"})]}),e.jsx("span",{className:"type-data-xs text-fg-muted",children:Fs(t.duration)}),t.linkQuality&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-fg-muted/40",children:"•"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-xs font-medium bg-sys-red/15 text-sys-red ring-1 ring-inset ring-sys-red/25",children:[e.jsx("span",{className:"opacity-70",children:"Min"}),e.jsx("span",{className:"font-mono tabular-nums",children:t.linkQuality.minSnr.toFixed(1)})]}),e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-xs font-medium bg-sys-teal/15 text-sys-teal ring-1 ring-inset ring-sys-teal/25",children:[e.jsx("span",{className:"opacity-70",children:"Max"}),e.jsx("span",{className:"font-mono tabular-nums",children:t.linkQuality.maxSnr.toFixed(1)})]})]})]})]}),e.jsxs($t,{className:"p-0 overflow-hidden",children:[e.jsx("div",{className:"md:hidden h-[75vh] max-h-[calc(100vh-80px)] overflow-y-auto overflow-x-hidden",children:e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[t.linkQuality&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"radius-inner bg-subtle-fill ring-1 ring-inset ring-edge-subtle p-2.5 text-center",children:[e.jsx(tt,{value:Math.abs(t.linkQuality.minSnr),format:{maximumFractionDigits:0,signDisplay:"never"},prefix:t.linkQuality.minSnr<0?"-":"",className:"text-[20px] font-bold font-mono tabular-nums flex items-center justify-center text-fg-primary"}),e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[e.jsx(et,{className:"w-2.5 h-2.5 text-fg-muted"}),e.jsx("span",{className:"text-xs text-fg-muted",children:"Min dB"})]})]}),e.jsxs("div",{className:"radius-inner bg-subtle-fill ring-1 ring-inset ring-edge-subtle p-2.5 text-center",children:[e.jsx(tt,{value:t.linkQuality.maxSnr,format:{maximumFractionDigits:0,signDisplay:"always"},className:"text-[20px] font-bold font-mono text-fg-primary tabular-nums flex items-center justify-center"}),e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[e.jsx(ft,{className:"w-2.5 h-2.5 text-fg-muted"}),e.jsx("span",{className:"text-xs text-fg-muted",children:"Max dB"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(B,{color:l==="excellent"||l==="good"?"green":l==="fair"?"amber":"red",compact:!0,children:[e.jsx(vt,{className:"w-2.5 h-2.5 mr-0.5"}),l==="excellent"?"Excellent":l==="good"?"Good":l==="fair"?"Fair":"Poor"]}),e.jsxs(B,{color:"teal",compact:!0,children:[t.targetHopCount," hops"]}),e.jsxs(B,{color:"zinc",compact:!0,children:[t.observationCount," obs"]}),e.jsx("span",{className:"type-data-xs text-fg-muted ml-auto",children:t.traceTag.slice(0,8)})]}),t.targetPath.length>0&&e.jsx("div",{className:"overflow-hidden radius-inset",children:e.jsx("div",{className:"aspect-[4/3] w-full",children:e.jsx(We,{path:t.targetPath,neighbors:a,localNode:r,localHash:s==null?void 0:s.local_hash,srcHash:t.srcHash,dstHash:t.dstHash,traceSnr:i})})}),e.jsxs("div",{className:"radius-inset bg-body overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-edge-subtle",children:[e.jsx("span",{className:"text-[11px] font-medium text-fg-secondary",children:"Route Path"}),t.linkQuality&&e.jsxs("span",{className:"type-data-xs text-fg-muted",children:["SNR ",t.linkQuality.minSnr.toFixed(1)," → ",t.linkQuality.maxSnr.toFixed(1)," dB"]})]}),t.bestObservation?e.jsx(Se,{packet:t.bestObservation.packet,neighbors:a,localHash:s==null?void 0:s.local_hash,direction:"flowchart",compact:!0,overridePath:t.targetPath,traceSnr:t.bestObservation.decoded.snrValues}):e.jsx("div",{className:"p-6 text-center text-fg-muted text-xs",children:"No path data available"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"type-micro text-fg-muted mb-2",children:["Link Quality · ",t.hopStats.length," hops"]}),e.jsx("div",{className:"space-y-1.5",children:t.hopStats.length>0?t.hopStats.map((g,f)=>{var T,h,N;const y=f<t.targetPath.length-1?t.targetPath[f+1]:"You",m=ye(g.prefix,a),v=ye(y,a);return e.jsx(Lt,{fromPrefix:g.prefix,toPrefix:y,fromName:m,toName:v,snr:g.snr,maxSnr:((T=t.linkQuality)==null?void 0:T.maxSnr)??10,isWeakest:((h=t.linkQuality)==null?void 0:h.weakestLinkPosition)===f,isStrongest:((N=t.linkQuality)==null?void 0:N.strongestLinkPosition)===f,index:f},`${g.prefix}-${f}`)}):e.jsx("div",{className:"text-xs text-fg-muted py-6 text-center",children:"No link data collected"})})]}),e.jsx("div",{className:"pt-1 pb-2 text-center",children:e.jsxs("span",{className:"text-xs text-fg-muted",children:["Traced ",Je(t.firstSeen)]})})]})}),e.jsxs("div",{className:"hidden md:flex md:flex-row h-[70vh] max-h-[calc(100vh-200px)] overflow-hidden",children:[e.jsx("div",{className:"w-1/2 flex flex-col min-w-0 min-h-0 overflow-hidden border-r border-edge-subtle",children:e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[t.linkQuality&&(()=>{const g=t.targetPath[t.linkQuality.weakestLinkPosition],f=t.targetPath[t.linkQuality.weakestLinkPosition+1]||"You",y=ye(g,a),m=ye(f,a),v=t.targetPath[t.linkQuality.strongestLinkPosition],T=t.targetPath[t.linkQuality.strongestLinkPosition+1]||"You",h=ye(v,a),N=ye(T,a);return e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(Bt,{label:"Weakest Link",numericValue:t.linkQuality.minSnr,unit:"dB",icon:et,subtext:`${y||g} → ${m||f}`}),e.jsx(Bt,{label:"Best Link",numericValue:t.linkQuality.maxSnr,showSign:!0,unit:"dB",icon:ft,subtext:`${h||v} → ${N||T}`})]})})(),e.jsxs("div",{children:[e.jsx("h3",{className:"type-micro text-fg-muted mb-3",children:"Link Details"}),e.jsx("div",{className:"space-y-2",children:t.hopStats.length>0?t.hopStats.map((g,f)=>{var T,h,N;const y=f<t.targetPath.length-1?t.targetPath[f+1]:"You",m=ye(g.prefix,a),v=ye(y,a);return e.jsx(Lt,{fromPrefix:g.prefix,toPrefix:y,fromName:m,toName:v,snr:g.snr,maxSnr:((T=t.linkQuality)==null?void 0:T.maxSnr)??10,isWeakest:((h=t.linkQuality)==null?void 0:h.weakestLinkPosition)===f,isStrongest:((N=t.linkQuality)==null?void 0:N.strongestLinkPosition)===f,index:f},`${g.prefix}-${f}`)}):e.jsx("div",{className:"text-xs text-fg-muted py-8 text-center",children:"No link data collected"})})]}),e.jsxs("div",{className:"pt-2 text-center",children:[e.jsx("span",{className:"text-xs text-fg-muted",children:"Traced "}),e.jsx("span",{className:"type-data-xs text-fg-muted",children:Je(t.firstSeen)})]})]})}),e.jsxs("div",{className:"w-1/2 min-w-0 overflow-y-auto p-3 space-y-2",children:[t.targetPath.length>0&&e.jsx("div",{className:"overflow-hidden",children:e.jsx("div",{className:"aspect-square w-full",children:e.jsx(We,{path:t.targetPath,neighbors:a,localNode:r,localHash:s==null?void 0:s.local_hash,srcHash:t.srcHash,dstHash:t.dstHash,traceSnr:i})})}),e.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Trace Route"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(B,{color:t.isComplete?"green":"amber",compact:!0,children:t.isComplete?"Complete":`${t.maxHopsObserved}/${t.targetHopCount}`}),e.jsxs(B,{color:"teal",compact:!0,children:[t.targetHopCount," hop",t.targetHopCount!==1?"s":""]})]})]}),t.linkQuality&&t.bestObservation&&e.jsxs("div",{className:"flex items-center gap-4 px-4 pb-2 type-data-xs text-fg-muted",children:[e.jsxs("span",{children:[e.jsx("span",{className:"opacity-60",children:"Tag"})," ",e.jsx("code",{className:"text-sys-teal tabular-nums",children:t.traceTag.slice(0,8)})]}),e.jsxs("span",{children:[e.jsx("span",{className:"opacity-60",children:"SNR"})," ",e.jsxs("code",{className:"text-sys-indigo tabular-nums",children:[t.linkQuality.minSnr.toFixed(1),"–",t.linkQuality.maxSnr.toFixed(1)]}),e.jsx("span",{className:"opacity-60",children:" dB"})]})]}),t.bestObservation?e.jsx(Se,{packet:t.bestObservation.packet,neighbors:a,localHash:s==null?void 0:s.local_hash,direction:"flowchart",compact:!0,overridePath:t.targetPath,traceSnr:t.bestObservation.decoded.snrValues}):e.jsx("div",{className:"p-8 text-center text-fg-muted text-xs",children:"No path data available"})]})]})]})]})]})}const Gn=p.memo(Wn),ns=[{target:"PacketList",fn:"type",minStage:1},{target:"PacketList",fn:"route",minStage:1},{target:"PacketList",fn:"rssi",minStage:1},{target:"PacketList",fn:"snr",minStage:1},{target:"PacketList",fn:"path",minStage:1,when:Us},{target:"PacketList",fn:"src_hash",minStage:1,when:Vs},{target:"PacketList",fn:"text",minStage:1,when:Ws},{target:"PacketList",fn:"ack",minStage:1,when:Gs},{target:"PacketList",fn:"decrypt",minStage:2,when:Qs},{target:"PacketList",fn:"duplicates",minStage:1}];$s(ns);const Qn=48,qn=72,Kn=100,Yn=5,Xn=600,rs="(min-width: 640px)";let he=null;function Zn(t){return typeof window>"u"?()=>{}:(he||(he=window.matchMedia(rs)),he.addEventListener("change",t),()=>he==null?void 0:he.removeEventListener("change",t))}function Jn(){return typeof window>"u"?!0:(he||(he=window.matchMedia(rs)),he.matches)}function er(){return p.useSyncExternalStore(Zn,Jn,()=>!0)}function tr(t,n,s){const[a,r]=p.useState(1),i=s?Math.ceil(t/n):1;p.useEffect(()=>{a>i&&i>0&&queueMicrotask(()=>r(1))},[i,a]);const l=p.useCallback(o=>r(Math.max(1,Math.min(o,i))),[i]),c=p.useMemo(()=>$a(a,i),[a,i]);return{currentPage:a,totalPages:i,goToPage:l,pageRange:c}}function sr(t,n){const[s,a]=p.useState(null),r=p.useRef(0);return p.useEffect(()=>{var x,g;if(!n||!t.length)return;const i=((x=t[0])==null?void 0:x.timestamp)??0,l=i>r.current&&r.current>0;if(r.current=i,!l)return;const c=(g=t[0])==null?void 0:g.packet_hash;if(!c)return;const o=requestAnimationFrame(()=>a(c)),u=setTimeout(()=>a(null),600);return()=>{cancelAnimationFrame(o),clearTimeout(u)}},[t,n]),s}function ar(t){if(!t||t.length<6)return null;const n=t,s=parseInt(n.slice(0,2),16);if(isNaN(s))return null;const a=s&3;let r=2;if((a===0||a===3)&&(r=10),r+2>n.length)return null;const i=parseInt(n.slice(r,r+2),16);if(isNaN(i)||(r+=2+i*2,r>=n.length))return null;const l=n.slice(r);return l.length>=38?l.slice(0,38):l}function nr(t){if(t.length<=1)return t;const n=new Map,s=new Map,a=new Map;for(let l=0;l<t.length;l++){const{packet:c}=t[l],o=c.payload_type??c.type;if(o!==lt.GRP_TXT)continue;const u=c._payloadHexPrefix??ar(c.raw_packet);if(u){const y=n.get(u);if(y!==void 0){a.set(l,y);continue}n.set(u,l)}const x=c.payload_length??c.length??0,g=Math.floor((c.timestamp??0)/60),f=`${o}:${x}:${g}`;if(!u){const y=s.get(f);if(y!==void 0){a.set(l,y);continue}}s.has(f)||s.set(f,l)}if(a.size===0)return t;const r=new Map;for(const[l,c]of a)r.set(c,(r.get(c)??0)+t[l].dupeCount);const i=[];for(let l=0;l<t.length;l++){if(a.has(l))continue;const c=r.get(l)??0;i.push(c>0?{packet:t[l].packet,dupeCount:t[l].dupeCount+c}:t[l])}return i}function rr(t){const n=new Map;for(const s of t)if((s.payload_type??s.type)===lt.TRACE&&s.packet_hash){const r=s._traceTag??(s.payload?Ut(s.payload):null);r&&n.set(s.packet_hash,r)}return n}function ir(t){const n=new Map;if(t.length===0)return n;for(let s=0;s<t.length;s++){const a=t[s].packet_hash;if(!a)continue;const r=t[s-1],i=t[s+1],l=(r==null?void 0:r.packet_hash)===a,c=(i==null?void 0:i.packet_hash)===a;(l||c)&&(l&&c?n.set(s,"middle"):l?n.set(s,"last"):c&&n.set(s,"first"))}return n}function Rt({message:t}){return e.jsxs("div",{className:"flex flex-col items-center justify-center py-14 text-center",children:[e.jsx(de,{className:"size-6 text-fg-muted mb-2"}),e.jsx("p",{className:"text-sm text-fg-primary",children:t}),e.jsx("p",{className:"text-xs text-fg-muted",children:"Packets will appear here"})]})}function Et(){return e.jsx("div",{className:"py-14 text-center text-sm text-fg-muted",children:"Loading packets…"})}function lr({showPagination:t,currentPage:n,perPage:s,displayCount:a,totalCount:r,action:i}){const l=t?(n-1)*s+1:1,c=t?Math.min(n*s,r):a;return e.jsxs("div",{className:"flex items-center justify-between gap-4 border-t border-edge-subtle px-4 py-3 text-xs text-fg-muted sm:px-6",children:[e.jsxs("span",{children:["Showing"," ",e.jsx("span",{className:"font-medium text-fg-secondary",children:t?`${l}–${c}`:a})," ","of"," ",e.jsx("span",{className:"font-medium text-fg-secondary",children:r})," ","packets"]}),i]})}function Br({packets:t,allPackets:n,localHash:s,neighbors:a,loading:r=!1,maxPackets:i,perPage:l=50,showPagination:c=!1,onPacketSelect:o,flashNewest:u=!1,emptyMessage:x="No packets found",className:g,footerAction:f,hideDupes:y=!1,getDecodedContent:m,onChannelClick:v,resolveSource:T,virtualized:h=!0}){Os(ns);const[N,j]=p.useState(null),[C,k]=p.useState(null),[b,A]=p.useState({traceTag:null,dupeGroup:null}),U=p.useRef(null),W=ra(w=>w.setModalMapOpen);p.useEffect(()=>(W(!!N),()=>W(!1)),[N,W]),p.useLayoutEffect(()=>{A({traceTag:null,dupeGroup:null})},[t]);const K=n??t,F=p.useMemo(()=>i&&i>0&&!y?t.slice(0,i):t,[t,i,y]),Y=p.useMemo(()=>{if(!y)return null;const w=Ua(F),S=nr(w);return i&&i>0?S.slice(0,i):S},[F,y,i]),D=Y?Y.length:F.length,{currentPage:E,totalPages:O,goToPage:$,pageRange:J}=tr(D,l,c),M=p.useMemo(()=>{if(y||!c)return F;const w=(E-1)*l;return F.slice(w,w+l)},[F,c,E,l,y]),H=p.useMemo(()=>{if(!Y)return null;if(!c)return Y;const w=(E-1)*l;return Y.slice(w,w+l)},[Y,c,E,l]),te=p.useMemo(()=>rr(M),[M]),se=p.useMemo(()=>ir(M),[M]),d=sr(t,u),Z=er(),q=p.useMemo(()=>y&&H?H:M,[y,H,M]),le=h&&q.length>Kn,P=Z?Qn:qn,z=ga({count:le?q.length:0,getScrollElement:()=>U.current,estimateSize:()=>P,overscan:Yn}),ae=p.useCallback((w,S)=>{var ve,Fe;const L=w.packet_hash;if(!L)return[w];let I=S;for(;I>0&&((ve=M[I-1])==null?void 0:ve.packet_hash)===L;)I--;let Q=S;for(;Q<M.length-1&&((Fe=M[Q+1])==null?void 0:Fe.packet_hash)===L;)Q++;return I===Q?[w]:M.slice(I,Q+1)},[M]),_=p.useCallback(w=>{var I,Q;const S=(I=M[w])==null?void 0:I.packet_hash;if(!S)return w;let L=w;for(;L>0&&((Q=M[L-1])==null?void 0:Q.packet_hash)===S;)L--;return L},[M]),ce=p.useCallback(w=>{var I,Q;const S=(I=M[w])==null?void 0:I.packet_hash;if(!S)return w;let L=w;for(;L<M.length-1&&((Q=M[L+1])==null?void 0:Q.packet_hash)===S;)L++;return L},[M]),fe=p.useCallback((w,S)=>{if(o){o(w);return}if(S!==void 0){const L=ae(w,S),I=L.indexOf(w);j({packets:L,initialIndex:I>=0?I:0,rowIndex:S})}else j({packets:[w],initialIndex:0,rowIndex:0})},[o,ae]),ne=p.useCallback(()=>{if(!N)return;const S=_(N.rowIndex)-1;if(S<0)return;const L=M[S];if(!L)return;const I=ae(L,S);j({packets:I,initialIndex:0,rowIndex:S})},[N,M,_,ae]),Le=p.useCallback(()=>{if(!N)return;const S=ce(N.rowIndex)+1;if(S>=M.length)return;const L=M[S];if(!L)return;const I=ae(L,S);j({packets:I,initialIndex:0,rowIndex:S})},[N,M,ce,ae]),dt=p.useMemo(()=>N?_(N.rowIndex)>0:!1,[N,_]),xt=p.useMemo(()=>N?ce(N.rowIndex)<M.length-1:!1,[N,ce,M.length]),be=p.useCallback(w=>A(S=>({...S,traceTag:w})),[]),Qe=p.useCallback(w=>A(S=>({...S,dupeGroup:w})),[]),Re=p.useCallback(()=>{A({traceTag:null,dupeGroup:null})},[]),Ne=p.useCallback(w=>{const S=K.filter(Q=>(Q.payload_type??Q.type)===lt.TRACE&&Q.payload&&Ut(Q.payload)===w);if(S.length===0)return;const I=Ds(S).get(w);I!=null&&I.length&&k(Hs(w,I))},[K]),qe=p.useCallback(w=>{const S=K.find(L=>L.packet_hash===w);S&&(k(null),fe(S))},[K,fe]),Ee=p.useCallback((w,S,L)=>{const I=Z?Xa:Za;if(L){const{packet:ge,dupeCount:ls}=w,ht=ge.packet_hash?te.get(ge.packet_hash):void 0,cs=b.traceTag!==null&&ht===b.traceTag;return e.jsx(I,{packet:ge,onClick:os=>fe(os,S),localHash:s,neighbors:a,resolveSource:T,isFlashing:u&&d===ge.packet_hash,traceTag:ht,isTraceHighlighted:cs,onTraceHover:be,onViewTraceReport:Ne,dupeCount:ls,getDecodedContent:m,onChannelClick:v},`${ge.packet_hash}_${ge.timestamp}_${S}`)}const Q=w,ve=Q.packet_hash?te.get(Q.packet_hash):void 0,Fe=b.traceTag!==null&&ve===b.traceTag,mt=se.get(S),is=mt!==void 0&&b.dupeGroup!==null&&Q.packet_hash===b.dupeGroup;return e.jsx(I,{packet:Q,onClick:ge=>fe(ge,S),localHash:s,neighbors:a,resolveSource:T,isFlashing:u&&d===Q.packet_hash,traceTag:ve,isTraceHighlighted:Fe,onTraceHover:be,onViewTraceReport:Ne,dupeGroupPosition:mt,isDupeGroupHovered:is,onDupeGroupHover:Qe,getDecodedContent:m,onChannelClick:v},`${Q.packet_hash}_${Q.timestamp}_${S}`)},[Z,te,b.traceTag,b.dupeGroup,fe,s,a,T,u,d,be,Ne,se,Qe,m,v]),ze=()=>{if(r&&t.length===0)return e.jsx(Et,{});if(M.length===0)return e.jsx(Rt,{message:x});const w=y&&H!==null;return(w?H:M).map((L,I)=>Ee(L,I,w))},G=()=>{if(r&&t.length===0)return e.jsx(Et,{});if(q.length===0)return e.jsx(Rt,{message:x});const w=y&&H!==null,S=z.getVirtualItems();return e.jsx("div",{style:{height:`${z.getTotalSize()}px`,width:"100%",position:"relative"},children:S.map(L=>{const I=q[L.index];return e.jsx("div",{"data-index":L.index,ref:z.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${L.start}px)`},children:Ee(I,L.index,w)},L.key)})})};return e.jsxs("div",{className:R("flex flex-col",g),onMouseLeave:Re,children:[le?e.jsx("div",{ref:U,className:"divide-y divide-edge-subtle overflow-auto",style:{maxHeight:Xn},children:G()}):e.jsx("div",{className:"divide-y divide-edge-subtle py-1",children:ze()}),c&&O>1&&e.jsx("nav",{className:"border-t border-edge-subtle px-4 py-3",children:e.jsxs(Fa,{className:"justify-center",children:[e.jsx(Ia,{onClick:()=>$(E-1),disabled:E===1}),e.jsx(Da,{children:J.map((w,S)=>w==="gap"?e.jsx(Oa,{},`gap-${S}`):e.jsx(Ha,{page:w,current:w===E,onClick:$},w))}),e.jsx(Aa,{onClick:()=>$(E+1),disabled:E===O})]})}),e.jsx(lr,{showPagination:c,currentPage:E,perPage:l,displayCount:H?H.length:M.length,totalCount:c?D:t.length,action:f}),!o&&N&&e.jsx(Un,{packets:N.packets,initialIndex:N.initialIndex,onClose:()=>j(null),onNavigatePrev:ne,onNavigateNext:Le,hasPrev:dt,hasNext:xt,resolveSource:T,getDecodedContent:m}),C&&e.jsx(Gn,{report:C,onClose:()=>k(null),onViewPacket:qe})]})}export{ts as C,Br as P,vt as S,wt as T,Tr as a,ga as b,Ga as g,Pr as u};
