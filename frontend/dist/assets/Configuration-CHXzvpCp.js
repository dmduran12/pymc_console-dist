import{r as e,j as t,c as a}from"./vendor-react-j_fHog8x.js";import{c as s,Q as r,f as n,a0 as l,O as c,cs as i,ct as o,cu as d,cv as m,aA as u,by as x,cw as p,cx as h,cy as y,cz as b,R as f,cA as g,cB as j,I as v}from"./index-Dw8YD-ih.js";import{g as N,c as w,r as k,s as C,a as S,u as _,d as F}from"./system-CAe7c5zA.js";import{T,P as E,C as P}from"./ConfirmModal-Dx9RXfWY.js";import{l as M}from"./font-loader-BQzEmDrZ.js";import{N as R}from"./NodeInformationCard-p6a467GF.js";import{a as z,P as A,b as L,B as D}from"./PageLayout-6RwS8y6W.js";import{C as I}from"./Card-ImOQ8Eqk.js";import{I as K}from"./info-BCBYbTSi.js";import{R as V,C as H}from"./Grid-OFJ4oe0a.js";import{K as q}from"./key-round-BLehldOc.js";import{C as O}from"./circle-check-_78eKVzj.js";import{T as $}from"./triangle-alert-DLkZKviZ.js";import{R as B}from"./refresh-cw-D2Wle1QI.js";import{C as X}from"./copy-BM9mjxjM.js";import{C as G}from"./chevron-right-DL3-hMMs.js";import"./maplibre-gl-b91ci4Kr.js";import"./vendor-core-CDNU4oKM.js";import"./DataBox-C8yDMgZ4.js";const U=s("antenna",[["path",{d:"M2 12 7 2",key:"117k30"}],["path",{d:"m7 12 5-10",key:"1tvx22"}],["path",{d:"m12 12 5-10",key:"ev1o1a"}],["path",{d:"m17 12 5-10",key:"1e4ti3"}],["path",{d:"M4.5 7h15",key:"vlsxkz"}],["path",{d:"M12 16v6",key:"c8a4gj"}]]),W=s("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),Y=s("folder-key",[["circle",{cx:"16",cy:"20",r:"2",key:"1vifvg"}],["path",{d:"M10 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v2",key:"3hgo9p"}],["path",{d:"m22 14-4.5 4.5",key:"1ef6z8"}],["path",{d:"m21 15 1 1",key:"1ejcpy"}]]),J=s("folder-lock",[["rect",{width:"8",height:"5",x:"14",y:"17",rx:"1",key:"19aais"}],["path",{d:"M10 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v2.5",key:"1w6v7t"}],["path",{d:"M20 17v-2a2 2 0 1 0-4 0v2",key:"pwaxnr"}]]),Q=s("monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),Z=s("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),ee=s("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),te=s("shield-x",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m14.5 9.5-5 5",key:"17q4r4"}],["path",{d:"m9.5 9.5 5 5",key:"18nt4w"}]]),ae=s("triangle-dashed",[["path",{d:"M10.17 4.193a2 2 0 0 1 3.666.013",key:"pltmmw"}],["path",{d:"M14 21h2",key:"v4qezv"}],["path",{d:"m15.874 7.743 1 1.732",key:"10m0iw"}],["path",{d:"m18.849 12.952 1 1.732",key:"zadnam"}],["path",{d:"M21.824 18.18a2 2 0 0 1-1.835 2.824",key:"fvwuk4"}],["path",{d:"M4.024 21a2 2 0 0 1-1.839-2.839",key:"1e1kah"}],["path",{d:"m5.136 12.952-1 1.732",key:"1u4ldi"}],["path",{d:"M8 21h2",key:"i9zjee"}],["path",{d:"m8.102 7.743-1 1.732",key:"1zzo4u"}]]),se=1500,re="h-[38px]",ne="h-[32px]",le="px-3",ce="px-2.5",ie="rounded-lg";function oe({label:s,value:c,editValue:i,onSave:o,type:d="text",suffix:m,placeholder:u,readOnly:x=!1,layout:p="stacked",min:h,max:y,step:b,maxLength:f,description:g,className:j}){const[v,N]=e.useState(!1),[w,k]=e.useState(""),[C,S]=e.useState("idle"),_=e.useRef(null),F=e.useRef(!0),T=e.useRef(null),E=!x&&!!o;e.useEffect(()=>(F.current=!0,()=>{F.current=!1,T.current&&clearTimeout(T.current)}),[]);const P=e.useCallback(()=>{E&&(k(i??c),N(!0),S("idle"),requestAnimationFrame(()=>{var e;return null==(e=_.current)?void 0:e.select()}))},[E,i,c]),M=e.useCallback(()=>{N(!1),k(""),S("idle")},[]),R=e.useCallback(async()=>{if(o&&"loading"!==C)if(w!==(i??c)){T.current&&clearTimeout(T.current),S("loading");try{if(await o(w),!F.current)return;S("success"),N(!1),T.current=setTimeout(()=>{F.current&&S("idle")},se)}catch{if(!F.current)return;S("error"),T.current=setTimeout(()=>{F.current&&S("idle")},se)}}else M()},[o,w,i,c,M,C]),z=e.useCallback(e=>{"Enter"===e.key?(e.preventDefault(),R()):"Escape"===e.key&&(e.preventDefault(),M())},[R,M]);return"inline"===p?t.jsxs("div",{className:a("group flex items-center justify-between",j),children:[t.jsx("label",{className:"type-label text-text-muted shrink-0",children:s}),v?t.jsxs("div",{className:a(ne,ie,ce,"flex items-center transition-all","bg-transparent border border-accent-primary/50 ring-1 ring-accent-primary/20","min-w-[100px]"),children:[t.jsx("input",{ref:_,type:d,value:w,onChange:e=>k(e.target.value),onKeyDown:z,placeholder:u,min:h,max:y,step:b,maxLength:f,disabled:"loading"===C,className:a("bg-transparent text-text-primary focus:outline-none type-data flex-1 min-w-0",m?"w-12 text-right":"w-full")}),m&&t.jsx("span",{className:"text-text-muted type-data ml-1 shrink-0",children:m}),t.jsx("div",{className:"flex items-center gap-0.5 ml-2 shrink-0",children:"loading"===C?t.jsx(r,{className:"w-3.5 h-3.5 text-text-muted animate-spin"}):t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:R,className:"p-0.5 rounded hover:bg-accent-success/15 text-accent-success transition-colors",title:"Save (Enter)",children:t.jsx(n,{className:"w-3 h-3"})}),t.jsx("button",{onClick:M,className:"p-0.5 rounded hover:bg-accent-danger/15 text-text-muted hover:text-accent-danger transition-colors",title:"Cancel (Esc)",children:t.jsx(l,{className:"w-3 h-3"})})]})})]}):t.jsxs("div",{className:a(ne,ie,ce,"flex items-center justify-end transition-all min-w-[80px]","bg-white/[0.03] border border-white/[0.06]",E&&"cursor-pointer hover:border-white/10 hover:bg-white/[0.05]"),onClick:E?P:void 0,children:[t.jsx("span",{className:"type-data text-text-primary",children:c}),"success"===C&&t.jsx(n,{className:"w-3 h-3 text-accent-success ml-1.5 shrink-0"}),"error"===C&&t.jsx(l,{className:"w-3 h-3 text-accent-danger ml-1.5 shrink-0"}),"idle"===C&&E&&t.jsx(Z,{className:"w-3 h-3 text-text-muted ml-1.5 opacity-0 group-hover:opacity-100 transition-opacity shrink-0"})]})]}):t.jsxs("div",{className:a("group",j),children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:s}),v?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:a(re,ie,le,"flex items-center transition-all","bg-transparent border border-accent-primary/50 ring-1 ring-accent-primary/20"),children:[t.jsx("input",{ref:_,type:d,value:w,onChange:e=>k(e.target.value),onKeyDown:z,placeholder:u,min:h,max:y,step:b,maxLength:f,disabled:"loading"===C,className:"w-full bg-transparent text-text-primary focus:outline-none type-data flex-1 min-w-0"}),m&&t.jsx("span",{className:"text-text-muted type-data ml-1 shrink-0",children:m}),t.jsx("div",{className:"flex items-center gap-0.5 ml-2 shrink-0",children:"loading"===C?t.jsx(r,{className:"w-3.5 h-3.5 text-text-muted animate-spin"}):t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:R,className:"p-1 rounded hover:bg-accent-success/15 text-accent-success transition-colors",title:"Save (Enter)",children:t.jsx(n,{className:"w-3.5 h-3.5"})}),t.jsx("button",{onClick:M,className:"p-1 rounded hover:bg-accent-danger/15 text-text-muted hover:text-accent-danger transition-colors",title:"Cancel (Esc)",children:t.jsx(l,{className:"w-3.5 h-3.5"})})]})})]}),g&&t.jsx("p",{className:"type-data-xs text-text-muted mt-1 ml-3",children:g})]}):t.jsxs("div",{className:a(re,ie,le,"flex items-center transition-all","bg-white/[0.03] border border-white/[0.06]",E&&"cursor-pointer hover:border-white/10 hover:bg-white/[0.05]"),onClick:E?P:void 0,children:[t.jsx("span",{className:"type-data text-text-primary flex-1",children:c}),"success"===C&&t.jsx(n,{className:"w-3.5 h-3.5 text-accent-success shrink-0"}),"error"===C&&t.jsx(l,{className:"w-3.5 h-3.5 text-accent-danger shrink-0"}),"idle"===C&&E&&t.jsx(Z,{className:"w-3.5 h-3.5 text-text-muted opacity-0 group-hover:opacity-100 transition-opacity shrink-0"})]})]})}function de({label:s,value:i,editValue:o,options:d,onSave:m,readOnly:u=!1,layout:x="stacked",className:p}){const[h,y]=e.useState(!1),[b,f]=e.useState(""),[g,j]=e.useState("idle"),v=e.useRef(null),N=e.useRef(!0),w=e.useRef(null),k=!u&&!!m;e.useEffect(()=>(N.current=!0,()=>{N.current=!1,w.current&&clearTimeout(w.current)}),[]);const C=e.useCallback(()=>{k&&(f(String(o)),y(!0),j("idle"),requestAnimationFrame(()=>{var e;return null==(e=v.current)?void 0:e.focus()}))},[k,o]),S=e.useCallback(()=>{y(!1),f(""),j("idle")},[]),_=e.useCallback(async()=>{if(m&&"loading"!==g)if(b!==String(o)){w.current&&clearTimeout(w.current),j("loading");try{if(await m(b),!N.current)return;j("success"),y(!1),w.current=setTimeout(()=>{N.current&&j("idle")},se)}catch{if(!N.current)return;j("error"),w.current=setTimeout(()=>{N.current&&j("idle")},se)}}else S()},[m,b,o,S,g]),F=e.useCallback(e=>{"Escape"===e.key&&(e.preventDefault(),S())},[S]),T="inline"===x,E=T?ne:re,P=T?ce:le,M=t.jsxs("div",{className:a(E,ie,P,"flex items-center transition-all relative","bg-transparent border border-accent-primary/50 ring-1 ring-accent-primary/20",T&&"min-w-[100px]"),children:[t.jsx("select",{ref:v,value:b,onChange:e=>f(e.target.value),onKeyDown:F,disabled:"loading"===g,className:a("bg-transparent text-text-primary focus:outline-none appearance-none cursor-pointer type-data flex-1 min-w-0","pr-6"),children:d.map(e=>t.jsx("option",{value:e.value,children:e.label},String(e.value)))}),t.jsx(c,{className:"absolute right-auto w-3.5 h-3.5 text-text-muted pointer-events-none",style:{right:"loading"===g?"2rem":"3.5rem"}}),t.jsx("div",{className:"flex items-center gap-0.5 ml-1 shrink-0",children:"loading"===g?t.jsx(r,{className:a("text-text-muted animate-spin",T?"w-3 h-3":"w-3.5 h-3.5")}):t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:_,className:a("rounded hover:bg-accent-success/15 text-accent-success transition-colors",T?"p-0.5":"p-1"),title:"Save",children:t.jsx(n,{className:T?"w-3 h-3":"w-3.5 h-3.5"})}),t.jsx("button",{onClick:S,className:a("rounded hover:bg-accent-danger/15 text-text-muted hover:text-accent-danger transition-colors",T?"p-0.5":"p-1"),title:"Cancel (Esc)",children:t.jsx(l,{className:T?"w-3 h-3":"w-3.5 h-3.5"})})]})})]}),R=t.jsxs("div",{className:a(E,ie,P,"flex items-center transition-all","bg-white/[0.03] border border-white/[0.06]",k&&"cursor-pointer hover:border-white/10 hover:bg-white/[0.05]",T?"justify-end min-w-[80px]":""),onClick:k?C:void 0,children:[t.jsx("span",{className:a("type-data text-text-primary",!T&&"flex-1"),children:i}),"success"===g&&t.jsx(n,{className:a("text-accent-success shrink-0",T?"w-3 h-3 ml-1.5":"w-3.5 h-3.5")}),"error"===g&&t.jsx(l,{className:a("text-accent-danger shrink-0",T?"w-3 h-3 ml-1.5":"w-3.5 h-3.5")}),"idle"===g&&k&&t.jsx(c,{className:a("text-text-muted opacity-0 group-hover:opacity-100 transition-opacity shrink-0",T?"w-3 h-3 ml-1.5":"w-3.5 h-3.5")})]});return T?t.jsxs("div",{className:a("group flex items-center justify-between",p),children:[t.jsx("label",{className:"type-label text-text-muted shrink-0",children:s}),h?M:R]}):t.jsxs("div",{className:a("group",p),children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:s}),h?M:R]})}async function me(e){return i("/api/update_web_config",{method:"POST",body:JSON.stringify(e)})}const ue=e.memo(function(){const{theme:e}=o(),{colorScheme:a}=e,s=d.find(e=>e.colorScheme===a)??d[0];return t.jsx("div",{className:"h-10 flex items-center justify-center",children:t.jsx("span",{className:"font-medium transition-all duration-300 leading-none text-center text-text-secondary",style:{fontFamily:"Inter, system-ui, sans-serif",fontSize:"clamp(0.75rem, 0.6rem + 1.5vw, 1.1rem)",letterSpacing:"-0.02em"},children:s.displayName})})}),xe=e.memo(function(){const{theme:e,setThemePreset:s}=o(),{colorScheme:r}=e,n=(d.find(e=>e.colorScheme===r)??d[0]).id;return t.jsx("div",{className:"grid grid-cols-2 gap-3 w-full",children:d.map(e=>{const r=n===e.id,l="breeze dark"===e.id;return t.jsxs("button",{type:"button",title:e.displayName,className:a("flex flex-col items-stretch rounded-lg transition-all duration-200 ease-out overflow-hidden cursor-pointer",r?"ring-2 ring-accent-primary scale-[1.02]":"opacity-70 hover:opacity-100"),onClick:()=>s(e.id),children:[t.jsx("div",{className:a("w-full aspect-[3/2] flex items-center justify-center",l?"bg-[#242627]":"bg-[#EFF0F1]"),children:t.jsx("span",{className:a("text-[1.5em] font-bold font-mono",l?"text-[#58b99d]":"text-[#31363B]"),children:l?">":"☀"})}),t.jsx("div",{className:"flex flex-col w-full",children:e.paletteColors.map((e,a)=>t.jsx("div",{className:"flex",children:e.map((e,a)=>t.jsx("div",{className:"flex-1 aspect-[2/1]",style:{backgroundColor:e}},a))},a))})]},e.id)})})}),pe=e.memo(function({layout:a="horizontal"}){return e.useEffect(()=>{M()},[]),"logo-only"===a?t.jsx(ue,{}):"thumbnails-only"===a?t.jsx(xe,{}):t.jsxs("div",{className:"flex flex-col items-center gap-3",children:[t.jsx(ue,{}),t.jsx(xe,{})]})}),he=2e3;function ye(t,a,s){const[r,n]=e.useState("idle"),[l,c]=e.useState(null),i=e.useRef(!0),o=e.useRef(null),d=e.useRef(null),m=e.useRef(!1),u=e.useRef("idle"),x=e.useRef(t),p=e.useRef(a),h=e.useRef(s);return u.current=r,x.current=t,p.current=a,h.current=s,e.useEffect(()=>(i.current=!0,()=>{i.current=!1,o.current&&clearTimeout(o.current),d.current&&clearTimeout(d.current)}),[]),{enabled:null!==l?l:t,status:r,toggle:e.useCallback(async e=>{if("loading"===u.current)return;const t=x.current;o.current&&clearTimeout(o.current),d.current&&clearTimeout(d.current),m.current=!1,c(e),n("loading"),o.current=setTimeout(()=>{!m.current&&i.current&&(c(t),n("error"),d.current=setTimeout(()=>{i.current&&(n("idle"),c(null))},he))},1e4);try{if(await p.current(e),m.current=!0,o.current&&clearTimeout(o.current),!i.current)return;n("success"),d.current=setTimeout(()=>{var e;i.current&&(n("idle"),c(null),null==(e=h.current)||e.call(h))},he)}catch{if(m.current=!0,o.current&&clearTimeout(o.current),!i.current)return;c(t),n("error"),d.current=setTimeout(()=>{i.current&&(n("idle"),c(null))},he)}},[])}}function be(){const{latitude:s,longitude:c,enabled:i,setLocation:o,enable:d,disable:u,clear:x}=m(),[p,h]=e.useState(!1),[y,b]=e.useState(""),[f,g]=e.useState(""),[j,v]=e.useState("idle"),[N,w]=e.useState(null),k=e.useRef(null),C=e.useRef(null),S=e.useRef(!0);e.useEffect(()=>(S.current=!0,()=>{S.current=!1,C.current&&clearTimeout(C.current)}),[]);const _=()=>{h(!1),w(null)};e.useEffect(()=>{if(!p)return;const e=e=>{"loading"!==j&&k.current&&!k.current.contains(e.target)&&_()};return document.addEventListener("mouseup",e),()=>document.removeEventListener("mouseup",e)},[p,j]);const F=null!==s&&null!==c;return t.jsx(z,{children:t.jsxs("div",{ref:k,children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx(I,{icon:t.jsx(ae,{}),title:"Stealth",largeTitle:!0}),t.jsxs("div",{className:"flex items-center gap-1",children:[F&&!p&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>{i?u():d()},className:a("relative inline-flex h-6 w-11 items-center rounded-full transition-colors border-2 mr-2",i?"bg-toggle-on border-toggle-on":"bg-toggle-off border-border-subtle"),title:i?"Disable stealth location":"Enable stealth location",children:t.jsx("span",{className:a("inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-lg",i?"translate-x-5":"translate-x-0.5")})}),t.jsx("button",{onClick:()=>{x(),h(!1)},className:"p-2 rounded-lg transition-colors text-text-muted hover:text-accent-danger hover:bg-accent-danger/10",title:"Clear stealth location",children:t.jsx(T,{className:"w-4 h-4"})})]}),p?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:_,disabled:"loading"===j,className:a("p-2 rounded-lg transition-colors","loading"===j?"text-text-muted cursor-not-allowed":"text-text-muted hover:text-accent-danger hover:bg-accent-danger/10"),title:"Cancel",children:t.jsx(l,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>{if("loading"===j)return;C.current&&clearTimeout(C.current);const e=((e,t)=>{const a=parseFloat(e),s=parseFloat(t);return isNaN(a)||isNaN(s)?"Please enter valid numbers":a<-90||a>90?"Latitude must be between -90 and 90":s<-180||s>180?"Longitude must be between -180 and 180":0===a&&0===s?"Coordinates (0, 0) are invalid":null})(y,f);if(e)return void w(e);v("loading"),w(null);const t=parseFloat(y),a=parseFloat(f);o(t,a),i||d(),v("success"),C.current=setTimeout(()=>{S.current&&(v("idle"),h(!1))},1e3)},disabled:"loading"===j,className:a("p-2 rounded-lg transition-colors","loading"===j?"text-accent-primary cursor-wait":"success"===j?"text-accent-success":"error"===j?"text-accent-danger":"text-accent-success hover:bg-accent-success/10"),title:"Save",children:"loading"===j?t.jsx(r,{className:"w-4 h-4 animate-spin"}):"success"===j?t.jsx(n,{className:"w-4 h-4"}):"error"===j?t.jsx(l,{className:"w-4 h-4"}):t.jsx(n,{className:"w-4 h-4"})})]}):t.jsx("button",{onClick:()=>{b((null==s?void 0:s.toFixed(6))??""),g((null==c?void 0:c.toFixed(6))??""),w(null),h(!0)},className:"p-2 rounded-lg transition-colors text-text-muted hover:text-text-primary hover:bg-bg-subtle",title:F?"Edit stealth location":"Set stealth location",children:t.jsx(Z,{className:"w-4 h-4"})})]})]}),t.jsx("div",{className:"bg-accent-tertiary/5 rounded-xl p-3 mb-4",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx(K,{className:"w-4 h-4 text-accent-tertiary flex-shrink-0 mt-0.5"}),t.jsxs("p",{className:"type-body-sm text-text-muted",children:[t.jsx("span",{className:"text-text-secondary",children:"Stealth mode"})," allows you to appear on the map and in topology analysis without broadcasting your location. Coordinates are stored locally in your browser only — ",t.jsx("span",{className:"text-accent-tertiary",children:"never sent to config.yaml or the mesh"}),"."]})]})}),N&&t.jsx("div",{className:"text-xs mb-3 px-2 py-1.5 rounded-md text-accent-danger bg-accent-danger/10",children:N}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:p?"Latitude (°)":"Latitude"}),t.jsx("div",{className:a("h-[38px] rounded-full px-4 flex items-center transition-colors","bg-subtle-fill"),children:p?t.jsx("input",{type:"number",value:y,onChange:e=>b(e.target.value),step:"0.000001",min:"-90",max:"90",placeholder:"e.g. 34.052234",className:"w-full bg-transparent text-text-primary focus:outline-none type-data placeholder:text-text-muted/50"}):t.jsx("span",{className:a("type-data",F&&i?"text-text-primary":"text-text-muted"),children:F?s.toFixed(6):"Not set"})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:p?"Longitude (°)":"Longitude"}),t.jsx("div",{className:a("h-[38px] rounded-full px-4 flex items-center transition-colors","bg-subtle-fill"),children:p?t.jsx("input",{type:"number",value:f,onChange:e=>g(e.target.value),step:"0.000001",min:"-180",max:"180",placeholder:"e.g. -118.243685",className:"w-full bg-transparent text-text-primary focus:outline-none type-data placeholder:text-text-muted/50"}):t.jsx("span",{className:a("type-data",F&&i?"text-text-primary":"text-text-muted"),children:F?c.toFixed(6):"Not set"})})]})]}),F&&!p&&t.jsx("div",{className:"mt-3 pt-3 border-t border-border-subtle",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:a("w-2 h-2 rounded-full",i?"bg-accent-success":"bg-text-muted")}),t.jsx("span",{className:"type-body-sm text-text-muted",children:i?"Stealth location active — you appear on maps with these coordinates":"Stealth location disabled — coordinates saved but not in use"})]})})]})})}const fe=[{value:7.8,label:"7.8 kHz"},{value:10.4,label:"10.4 kHz"},{value:15.6,label:"15.6 kHz"},{value:20.8,label:"20.8 kHz"},{value:31.25,label:"31.25 kHz"},{value:41.7,label:"41.7 kHz"},{value:62.5,label:"62.5 kHz"},{value:125,label:"125 kHz"},{value:250,label:"250 kHz"},{value:500,label:"500 kHz"}],ge=[5,6,7,8,9,10,11,12],je=[{value:5,label:"4/5"},{value:6,label:"4/6"},{value:7,label:"4/7"},{value:8,label:"4/8"}],ve="radioConfig";function Ne({node:e,level:s,expandedKeys:r,selectedKeyId:n,globalFloodPolicy:l,onSelect:c,onToggle:i}){const o=r.has(e.id),d=n===e.id,m=e.children&&e.children.length>0,u="allow"===l;return t.jsxs("div",{children:[t.jsxs("div",{className:a("flex items-center gap-2 h-[36px] px-3 rounded-full cursor-pointer transition-colors",d?"bg-accent-primary/15":"hover:bg-subtle-fill",u&&"opacity-50 cursor-not-allowed"),style:{marginLeft:16*s+"px"},onClick:()=>!u&&c(e.id),children:[m?t.jsx("button",{onClick:t=>{t.stopPropagation(),i(e.id)},className:"p-1 hover:bg-subtle-fill-hover rounded-full transition-colors",children:t.jsx(G,{className:a("w-3.5 h-3.5 text-text-muted transition-transform",o&&"rotate-90")})}):t.jsx("span",{className:"w-5"}),t.jsx(Y,{className:"w-4 h-4 text-accent-primary flex-shrink-0"}),t.jsx("span",{className:"type-data text-text-primary flex-1 truncate",children:e.name}),t.jsx("span",{className:a("type-data-xs px-2 py-0.5 rounded-full","allow"===e.floodPolicy?"bg-accent-success/15 text-accent-success":"bg-accent-danger/15 text-accent-danger"),children:"allow"===e.floodPolicy?"Allow":"Deny"})]}),m&&o&&t.jsx("div",{children:e.children.map(e=>t.jsx(Ne,{node:e,level:s+1,expandedKeys:r,selectedKeyId:n,globalFloodPolicy:l,onSelect:c,onToggle:i},e.id))})]})}function we(){var s,l,c,o,d,m;const{stats:M,setMode:G,clearModeMutation:Y,setDutyCycleConfig:Z,clearDutyCycleMutation:ae,fetchStats:se,startMutation:re,clearMutation:ne}=u(),le=null==(s=null==M?void 0:M.config)?void 0:s.radio,ce=null==(l=null==M?void 0:M.config)?void 0:l.repeater,ie=null==(c=null==M?void 0:M.config)?void 0:c.duty_cycle,ue=(null==M?void 0:M.node_name)||(null==(o=null==M?void 0:M.config)?void 0:o.node_name)||"Unknown Node",xe=(null==ce?void 0:ce.mode)??"forward",he=(null==ie?void 0:ie.enforcement_enabled)??!1,we=null==(d=null==M?void 0:M.config)?void 0:d.delays,ke=e.useRef(!0);e.useEffect(()=>(ke.current=!0,()=>{ke.current=!1}),[]);const Ce=null==(m=null==M?void 0:M.config)?void 0:m.web,[Se,_e]=e.useState([]),[Fe,Te]=e.useState(!1),[Ee,Pe]=e.useState(null),[Me,Re]=e.useState(!1),[ze,Ae]=e.useState(""),[Le,De]=e.useState(null),[Ie,Ke]=e.useState(!1),[Ve,He]=e.useState(null),[qe,Oe]=e.useState(!1),[$e,Be]=e.useState(!1),[Xe,Ge]=e.useState(!1),[Ue,We]=e.useState([]),[Ye,Je]=e.useState(!1),[Qe,Ze]=e.useState(null),[et,tt]=e.useState("deny"),[at,st]=e.useState(!1),[rt,nt]=e.useState(null),[lt,ct]=e.useState(new Set),[it,ot]=e.useState(!1),[dt,mt]=e.useState(!1),[ut,xt]=e.useState(!1),[pt,ht]=e.useState(null),[yt,bt]=e.useState(null),[ft,gt]=e.useState(""),[jt,vt]=e.useState("deny"),[Nt,wt]=e.useState(!1),[kt,Ct]=e.useState(!0),[St,_t]=e.useState(!1),[Ft,Tt]=e.useState(!0),[Et,Pt]=e.useState("idle"),[Mt,Rt]=e.useState(!1),[zt,At]=e.useState(!1),Lt=e.useCallback(()=>{const e=null==we?void 0:we.tx_delay_factor;return e&&"object"==typeof e&&"parsedValue"in e?e.parsedValue??1:"number"==typeof e?e:1},[we]),Dt=e.useCallback(()=>{const e=null==we?void 0:we.direct_tx_delay_factor;return"number"==typeof e?e:.5},[we]),It=e.useCallback(()=>{const e=null==ie?void 0:ie.max_airtime_percent;return"number"==typeof e?e:e&&"object"==typeof e&&"parsedValue"in e?e.parsedValue??6:6},[ie]),Kt=ye("forward"===xe,async e=>{await G(e?"forward":"monitor")},Y),Vt=ye(he,async e=>{await Z({max_airtime_percent:It(),enforcement_enabled:e})},ae),Ht=ye((null==Ce?void 0:Ce.cors_enabled)??!1,async e=>{var t;const a=await me({web:{cors_enabled:e}});if(!a.success&&!(null==(t=a.data)?void 0:t.persisted))throw new Error("CORS update failed");await se()}),qt=e.useCallback(async e=>{re(ve);try{const t=await x(e);if(!t.success)throw new Error(t.error||"Failed to save");await se({force:!0}).catch(()=>{})}finally{ne(ve)}},[re,ne,se]);e.useEffect(()=>{(async()=>{Tt(!0);try{const e=await w();e.success&&e.data?_t(e.data.exists):_t(!1);const t=null==Ce?void 0:Ce.web_path;Ct(!t||""===t)}catch{_t(!1)}finally{Tt(!1)}})()},[null==Ce?void 0:Ce.web_path]);const Ot=async e=>{var t;if("loading"!==Et){Pt("loading");try{const a=await me({web:{web_path:e?null:"/opt/pymc_console/web/html"}});if(!ke.current)return;a.success||(null==(t=a.data)?void 0:t.persisted)?(Ct(e),Pt("success"),Rt(!0),setTimeout(()=>{ke.current&&Pt("idle")},2e3)):(Pt("error"),setTimeout(()=>{ke.current&&Pt("idle")},2e3))}catch{if(!ke.current)return;Pt("error"),setTimeout(()=>{ke.current&&Pt("idle")},2e3)}}},$t=e.useCallback(async()=>{Te(!0),Pe(null);try{const e=await async function(){return i("/auth/tokens")}();_e(e.tokens||[])}catch(e){Pe(e instanceof Error?e.message:"Failed to fetch tokens")}finally{Te(!1)}},[]);e.useEffect(()=>{$t()},[$t]);const Bt=async()=>{if(ze.trim()){Oe(!0),Pe(null);try{const e=await async function(e){return i("/auth/tokens",{method:"POST",body:JSON.stringify({name:e})})}(ze.trim());De(e.token||null),Re(!1),Ke(!0),Ae(""),await $t()}catch(e){Pe(e instanceof Error?e.message:"Failed to create token")}finally{Oe(!1)}}else Pe("Token name is required")},Xt=e=>e?new Date(1e3*e).toLocaleString():"Never",Gt=e.useCallback(e=>{const t=new Map,a=[];return e.forEach(e=>{const a={id:e.id,name:e.name,floodPolicy:e.flood_policy,transport_key:e.transport_key,last_used:e.last_used,parent_id:e.parent_id,children:[]};t.set(e.id,a)}),t.forEach(e=>{e.parent_id&&t.has(e.parent_id)?t.get(e.parent_id).children.push(e):a.push(e)}),a},[]),Ut=e.useCallback(async()=>{Je(!0),Ze(null);try{const e=await N();e.success&&e.data?We(Gt(e.data)):Ze(e.error||"Failed to load transport keys")}catch(e){Ze(e instanceof Error?e.message:"Unknown error occurred")}finally{Je(!1)}},[Gt]);e.useEffect(()=>{Ut()},[Ut]);const Wt=e.useCallback((e,t)=>{for(const a of e){if(a.id===t)return a;if(a.children){const e=Wt(a.children,t);if(e)return e}}return null},[]),Yt=e.useCallback(()=>{if(!rt)return;const e=Wt(Ue,rt);return null==e?void 0:e.name},[rt,Ue,Wt]),Jt=e.useCallback(e=>{ct(t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},[]),Qt=async e=>{st(!0),Ze(null);try{const t=await C("allow"===e);t.success?tt(e):Ze(t.error||"Failed to update global flood policy")}catch(t){Ze(t instanceof Error?t.message:"Failed to update global flood policy")}finally{st(!1)}},Zt=async()=>{if(ft.trim()){wt(!0),Ze(null);try{const e=await S({name:ft.trim(),flood_policy:jt,parent_id:rt??void 0});e.success?(await Ut(),ot(!1),gt(""),vt("deny")):Ze(e.error||"Failed to add transport key")}catch(e){Ze(e instanceof Error?e.message:"Failed to add transport key")}finally{wt(!1)}}else Ze("Key name is required")},ea=e.useCallback(()=>{if(!rt)return;const e=Wt(Ue,rt);e&&(ht({...e}),mt(!0))},[rt,Ue,Wt]);e.useEffect(()=>{const e=e=>{"Escape"===e.key&&(it&&(ot(!1),gt(""),vt("deny")),dt&&(mt(!1),ht(null)),ut&&(xt(!1),bt(null)),Me&&(Re(!1),Ae("")),Ie&&(Ke(!1),De(null)))};if(it||dt||ut||Me||Ie)return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[it,dt,ut,Me,Ie]);const ta=e.useCallback(()=>{if(!rt)return;const e=Wt(Ue,rt);e&&(bt(e),xt(!0))},[rt,Ue,Wt]);return t.jsxs(A,{children:[t.jsx(L,{title:"Configuration",icon:t.jsx(p,{})}),t.jsxs(D,{children:[t.jsxs(V,{template:"standard",children:[t.jsx(H,{span:12,md:6,children:t.jsxs(z,{children:[t.jsx(I,{icon:t.jsx(h,{}),title:"Repeater Settings",largeTitle:!0}),ce?t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx("div",{className:"col-span-2",children:t.jsx(oe,{label:"Node Name",value:ue,onSave:async e=>qt({node_name:e}),placeholder:"Enter node name",maxLength:50})}),t.jsx(oe,{label:"Latitude",value:0!==ce.latitude?ce.latitude.toFixed(6):"Not set",editValue:String(ce.latitude),type:"number",suffix:"°",step:1e-6,min:-90,max:90,onSave:async e=>qt({latitude:parseFloat(e)})}),t.jsx(oe,{label:"Longitude",value:0!==ce.longitude?ce.longitude.toFixed(6):"Not set",editValue:String(ce.longitude),type:"number",suffix:"°",step:1e-6,min:-180,max:180,onSave:async e=>qt({longitude:parseFloat(e)})}),t.jsx(oe,{label:"Advert Interval",value:ce.send_advert_interval_hours>0?`${ce.send_advert_interval_hours}h`:"Disabled",editValue:String(ce.send_advert_interval_hours),type:"number",suffix:"hours",min:0,max:48,description:"0 = disabled, 3-48 hours",onSave:async e=>qt({flood_advert_interval_hours:parseInt(e,10)})}),t.jsx(oe,{label:"Score-based TX",value:ce.use_score_for_tx?"Enabled":"Disabled",readOnly:!0})]}):t.jsx("p",{className:"text-text-muted",children:"Loading repeater settings..."})]})}),t.jsx(H,{span:12,md:6,children:t.jsxs(z,{children:[t.jsx(I,{icon:t.jsx(U,{}),title:"Radio Configuration",largeTitle:!0}),le?t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(oe,{label:"Frequency",value:y(le.frequency),editValue:(le.frequency/1e6).toFixed(3),type:"number",suffix:"MHz",step:.001,min:400,max:930,onSave:async e=>qt({frequency_mhz:parseFloat(e)})}),t.jsx(oe,{label:"TX Power",value:`${le.tx_power} dBm`,editValue:String(le.tx_power),type:"number",suffix:"dBm",min:2,max:30,onSave:async e=>qt({tx_power:parseInt(e,10)})}),t.jsx(de,{label:"Bandwidth",value:b(le.bandwidth),editValue:le.bandwidth/1e3,options:fe,onSave:async e=>qt({bandwidth_khz:parseFloat(e)})}),t.jsx(de,{label:"Spreading Factor",value:`SF${le.spreading_factor}`,editValue:le.spreading_factor,options:ge.map(e=>({value:e,label:`SF${e}`})),onSave:async e=>qt({spreading_factor:parseInt(e,10)})}),t.jsx(de,{label:"Coding Rate",value:`4/${le.coding_rate}`,editValue:le.coding_rate,options:je,onSave:async e=>qt({coding_rate:parseInt(e,10)})}),t.jsx(oe,{label:"Preamble",value:`${le.preamble_length} symbols`,readOnly:!0})]}):t.jsx("p",{className:"text-text-muted",children:"Loading radio configuration..."})]})})]}),t.jsxs(V,{template:"standard",children:[t.jsx(H,{span:12,md:6,children:t.jsxs(z,{children:[t.jsx(I,{icon:t.jsx(f,{}),title:"Operating Mode",largeTitle:!0}),t.jsx("p",{className:"type-label text-text-muted mb-3",children:"Control how the repeater handles packets"}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsxs("div",{className:"flex-1 space-y-4",children:[t.jsx(g,{enabled:Kt.enabled,onChange:Kt.toggle,label:"Repeat",status:Kt.status,size:"md"}),t.jsx(g,{enabled:Vt.enabled,onChange:Vt.toggle,label:"Duty Cycle",status:Vt.status,size:"md"}),t.jsx(oe,{label:"Max Airtime",layout:"inline",value:`${It().toFixed(1)}%`,editValue:String(It()),type:"number",suffix:"%",step:.5,min:.1,max:100,onSave:async e=>{await Z({max_airtime_percent:parseFloat(e),enforcement_enabled:he}),ae()}})]}),t.jsx("div",{className:"hidden sm:block w-px bg-border-subtle"}),t.jsxs("div",{className:"flex-1 pt-4 sm:pt-0 border-t sm:border-t-0 border-border-subtle",children:[t.jsx("label",{className:"type-label text-text-muted block mb-3",children:"TX Delays"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx(oe,{label:"Flood",layout:"inline",value:`${Lt().toFixed(2)}x`,editValue:String(Lt()),type:"number",suffix:"x",step:.1,min:0,max:5,onSave:async e=>qt({tx_delay_factor:parseFloat(e)})}),t.jsx(oe,{label:"Direct",layout:"inline",value:`${Dt().toFixed(2)}s`,editValue:String(Dt()),type:"number",suffix:"s",step:.1,min:0,max:5,onSave:async e=>qt({direct_tx_delay_factor:parseFloat(e)})})]})]})]})]})}),t.jsx(H,{span:12,md:6,children:t.jsxs(z,{children:[t.jsx(I,{icon:t.jsx(p,{}),title:"App Settings",largeTitle:!0}),t.jsx("p",{className:"type-body-sm text-text-muted mb-4",children:"Appearance and web server options."}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(g,{enabled:Ht.enabled,onChange:Ht.toggle,label:"Enable CORS",description:"Allow cross-origin API access",status:Ht.status,size:"md"}),t.jsx("div",{children:t.jsx(pe,{})})]})]})})]}),t.jsx(V,{template:"auto",children:t.jsxs(z,{children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"type-heading text-text-primary flex items-center gap-2",children:[t.jsx(J,{className:"icon-md text-accent-primary"}),"Regions / Transport Keys"]}),t.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Manage regional key hierarchy for flood control"})]}),t.jsxs("div",{className:"flex gap-2 flex-wrap",children:[t.jsxs("button",{onClick:()=>ot(!0),disabled:"allow"===et,className:a("flex items-center gap-1.5 h-[32px] px-3 rounded-full transition-colors type-body-sm font-medium","allow"===et?"bg-subtle-fill text-text-muted cursor-not-allowed":"bg-accent-success/10 hover:bg-accent-success/20 text-accent-success"),children:[t.jsx(E,{className:"w-3.5 h-3.5"}),"Add"]}),t.jsx("button",{onClick:ea,disabled:!rt||"allow"===et,className:a("h-[32px] px-3 rounded-full transition-colors type-body-sm font-medium",rt&&"allow"!==et?"bg-accent-primary/10 hover:bg-accent-primary/20 text-accent-primary":"bg-subtle-fill text-text-muted cursor-not-allowed"),children:"Edit"}),t.jsx("button",{onClick:ta,disabled:!rt||"allow"===et,className:a("h-[32px] px-3 rounded-full transition-colors type-body-sm font-medium",rt&&"allow"!==et?"bg-accent-danger/10 hover:bg-accent-danger/20 text-accent-danger":"bg-subtle-fill text-text-muted cursor-not-allowed"),children:"Delete"})]})]}),t.jsx("div",{className:"bg-subtle-fill radius-card p-4 mb-4",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:a("w-10 h-10 rounded-full flex items-center justify-center","allow"===et?"bg-accent-success/20":"bg-accent-danger/20"),children:"allow"===et?t.jsx(ee,{className:"w-5 h-5 text-accent-success"}):t.jsx(te,{className:"w-5 h-5 text-accent-danger"})}),t.jsxs("div",{children:[t.jsx("h4",{className:"type-body text-text-primary font-medium",children:"Global Flood Policy"}),t.jsx("p",{className:"type-body-sm text-text-muted",children:"Master control for repeater flooding"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"flex bg-subtle-fill rounded-full p-1",children:[t.jsx("button",{onClick:()=>Qt("deny"),disabled:at,className:a("px-4 py-1.5 rounded-full transition-colors type-body-sm font-medium","deny"===et?"bg-accent-danger/20 text-accent-danger":"text-text-muted hover:text-text-secondary",at&&"opacity-50"),children:"Deny"}),t.jsx("button",{onClick:()=>Qt("allow"),disabled:at,className:a("px-4 py-1.5 rounded-full transition-colors type-body-sm font-medium","allow"===et?"bg-accent-success/20 text-accent-success":"text-text-muted hover:text-text-secondary",at&&"opacity-50"),children:"Allow"})]}),at&&t.jsx(r,{className:"w-4 h-4 animate-spin text-text-muted"})]})]})}),Qe&&t.jsx("div",{className:"type-body-sm mb-3 px-3 py-2 rounded-full text-accent-danger bg-accent-danger/10",children:Qe}),t.jsx("div",{className:"bg-subtle-fill radius-card p-4 min-h-[120px]",children:Ye?t.jsxs("div",{className:"flex items-center justify-center py-6",children:[t.jsx(r,{className:"w-5 h-5 animate-spin text-accent-primary mr-2"}),t.jsx("span",{className:"type-body-sm text-text-muted",children:"Loading transport keys..."})]}):0===Ue.length?t.jsxs("div",{className:"text-center py-6",children:[t.jsx("div",{className:"w-12 h-12 rounded-full bg-subtle-fill mx-auto mb-3 flex items-center justify-center",children:t.jsx(J,{className:"w-6 h-6 text-text-muted/50"})}),t.jsx("p",{className:"type-body text-text-muted",children:"No transport keys found"}),t.jsx("p",{className:"type-body-sm text-text-muted/70 mt-1",children:"Add your first transport key to get started"})]}):t.jsx("div",{className:"space-y-1",children:Ue.map(e=>t.jsx(Ne,{node:e,level:0,expandedKeys:lt,selectedKeyId:rt,globalFloodPolicy:et,onSelect:nt,onToggle:Jt},e.id))})})]})}),t.jsx(V,{template:"auto",children:t.jsxs(z,{children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"type-heading text-text-primary flex items-center gap-2",children:[t.jsx(q,{className:"icon-md text-accent-primary"}),"API Tokens"]}),t.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Manage API tokens for machine-to-machine authentication"})]}),t.jsxs("button",{onClick:()=>Re(!0),className:"flex items-center justify-center gap-2 h-[32px] px-4 bg-accent-primary/10 hover:bg-accent-primary/20 text-accent-primary rounded-full transition-colors type-body-sm font-medium",children:[t.jsx(E,{className:"w-4 h-4"}),"Create Token"]})]}),t.jsx("div",{className:"bg-accent-tertiary/5 radius-card p-4 mb-4",children:t.jsxs("div",{className:"flex gap-3",children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-accent-tertiary/20 flex items-center justify-center flex-shrink-0",children:t.jsx(K,{className:"w-4 h-4 text-accent-tertiary"})}),t.jsxs("div",{className:"type-body-sm text-text-muted",children:[t.jsxs("p",{children:[t.jsx("span",{className:"text-text-secondary",children:"API tokens"})," are used for machine-to-machine authentication. Include the token in the ",t.jsx("code",{className:"type-code bg-accent-tertiary/20 px-1.5 py-0.5 rounded-full text-accent-tertiary",children:"X-API-Key"})," header when making API requests."]}),t.jsx("p",{className:"mt-1 text-text-muted/70",children:"Tokens are only shown once at creation. Store them securely."})]})]})}),Ee&&t.jsx("div",{className:"type-body-sm mb-3 px-3 py-2 rounded-full text-accent-danger bg-accent-danger/10",children:Ee}),Fe&&0===Se.length?t.jsxs("div",{className:"flex items-center justify-center py-6",children:[t.jsx(r,{className:"w-5 h-5 animate-spin text-accent-primary mr-2"}),t.jsx("span",{className:"type-body-sm text-text-muted",children:"Loading tokens..."})]}):Se.length>0?t.jsx("div",{className:"space-y-2",children:Se.map(e=>t.jsx("div",{className:"bg-subtle-fill hover:bg-subtle-fill-strong radius-card p-4 transition-base",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-accent-primary/10 flex items-center justify-center flex-shrink-0",children:t.jsx(q,{className:"w-5 h-5 text-accent-primary"})}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("h3",{className:"type-body text-text-primary font-medium truncate",children:e.name}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:gap-4 mt-0.5",children:[t.jsxs("span",{className:"type-data-sm text-text-muted truncate",children:["Created: ",Xt(e.created_at)]}),t.jsxs("span",{className:"type-data-sm text-text-muted truncate",children:["Last used: ",Xt(e.last_used)]})]})]})]}),t.jsxs("button",{onClick:()=>He({id:e.id,name:e.name}),disabled:$e,className:"h-[32px] px-4 bg-accent-danger/10 hover:bg-accent-danger/20 text-accent-danger rounded-full transition-colors disabled:opacity-50 type-body-sm font-medium flex items-center justify-center gap-1.5",children:[t.jsx(T,{className:"w-3.5 h-3.5"}),"Revoke"]})]})},e.id))}):t.jsxs("div",{className:"bg-subtle-fill radius-card p-6 text-center",children:[t.jsx("div",{className:"w-14 h-14 rounded-full bg-subtle-fill mx-auto mb-4 flex items-center justify-center",children:t.jsx(q,{className:"w-7 h-7 text-text-muted/50"})}),t.jsx("h3",{className:"type-body text-text-primary font-medium mb-1",children:"No API Tokens"}),t.jsx("p",{className:"type-body-sm text-text-muted mb-4",children:"Create a token to enable API access"}),t.jsx("button",{onClick:()=>Re(!0),className:"h-[32px] px-4 bg-accent-primary/10 hover:bg-accent-primary/20 text-accent-primary rounded-full transition-colors type-body-sm font-medium",children:"Create Your First Token"})]})]})}),t.jsx(V,{template:"auto",children:t.jsxs(z,{children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:t.jsxs("div",{children:[t.jsxs("h2",{className:"type-heading text-text-primary flex items-center gap-2",children:[t.jsx(Q,{className:"icon-md text-accent-primary"}),"Web Frontend"]}),t.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Choose which web interface to use"})]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("label",{className:a("flex items-start gap-3 p-4 bg-subtle-fill radius-card border-2 cursor-pointer transition-base",kt?"border-accent-primary bg-accent-primary/5":"border-transparent hover:border-accent-primary/30","loading"===Et&&"opacity-50 pointer-events-none"),children:[t.jsx("input",{type:"radio",name:"frontend",checked:kt,onChange:()=>Ot(!0),disabled:"loading"===Et,className:"mt-1 h-4 w-4 text-accent-primary focus:ring-accent-primary focus:ring-offset-bg-elevated"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"type-body text-text-primary font-medium",children:"Default Frontend"}),t.jsx("a",{href:"https://github.com/rightup/pyMC_Repeater",target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"type-data-xs bg-accent-tertiary/15 text-accent-tertiary px-2.5 py-0.5 rounded-full font-medium hover:bg-accent-tertiary/25 transition-colors",children:"@RightUp"})]}),t.jsx("div",{className:"type-body-sm text-text-muted mt-1",children:"Built-in pyMC Repeater web interface"}),t.jsx("div",{className:"type-data-xs text-text-muted/60 mt-1 font-mono",children:"/opt/pymc_repeater/repeater/web/html"})]})]}),t.jsxs("label",{className:a("flex items-start gap-3 p-4 bg-subtle-fill radius-card border-2 cursor-pointer transition-base",kt?"border-transparent hover:border-accent-primary/30":"border-accent-primary bg-accent-primary/5","loading"===Et&&"opacity-50 pointer-events-none"),children:[t.jsx("input",{type:"radio",name:"frontend",checked:!kt,onChange:()=>Ot(!1),disabled:"loading"===Et,className:"mt-1 h-4 w-4 text-accent-primary focus:ring-accent-primary focus:ring-offset-bg-elevated"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"type-body text-text-primary font-medium",children:"PyMC Console"}),t.jsx("span",{className:"type-data-xs bg-accent-secondary/15 text-accent-secondary px-2.5 py-0.5 rounded-full font-medium",children:"@Treehouse ⚡"})]}),t.jsx("div",{className:"type-body-sm text-text-muted mt-1",children:"Alternative web interface for pyMC Repeater"}),t.jsx("div",{className:"type-data-xs text-text-muted/60 mt-1 font-mono",children:"/opt/pymc_console/web/html"})]})]})]}),!Ft&&t.jsx("div",{className:a("bg-subtle-fill radius-card p-4",St?"border border-accent-success/20":"border border-accent-tertiary/20"),children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:a("w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",St?"bg-accent-success/20":"bg-accent-tertiary/20"),children:St?t.jsx(O,{className:"w-4 h-4 text-accent-success"}):t.jsx(K,{className:"w-4 h-4 text-accent-tertiary"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"type-body text-text-primary font-medium",children:St?"PyMC Console has been detected":"PyMC Console Not Installed"}),St?t.jsxs("p",{className:"type-body-sm text-text-muted mt-1",children:["PyMC Console is installed at ",t.jsx("code",{className:"type-code bg-accent-success/10 px-1.5 py-0.5 rounded-full text-accent-success",children:"/opt/pymc_console/web/html"})]}):t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"type-body-sm text-text-muted mt-1 mb-3",children:["PyMC Console must be installed at ",t.jsx("code",{className:"type-code bg-accent-tertiary/10 px-1.5 py-0.5 rounded-full text-accent-tertiary",children:"/opt/pymc_console/web/html"})," before selecting this option."]}),t.jsxs("a",{href:"https://github.com/dmduran12/pymc_console-dist",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 h-[32px] px-4 bg-accent-tertiary/10 hover:bg-accent-tertiary/20 text-accent-tertiary rounded-full type-body-sm font-medium transition-colors",children:[t.jsx(W,{className:"w-4 h-4"}),"PyMC Console Install Instructions"]})]})]})]})}),Mt&&t.jsx("div",{className:"bg-subtle-fill radius-card p-4 border border-accent-secondary/30",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[t.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-accent-secondary/20 flex items-center justify-center flex-shrink-0",children:t.jsx($,{className:"w-4 h-4 text-accent-secondary"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"type-body text-text-primary font-medium",children:"Service restart required"}),t.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Web frontend changes will take effect after restarting the pymc-repeater service."})]})]}),t.jsx("button",{onClick:async()=>{if(!zt){At(!0);try{await k(),Rt(!1),setTimeout(()=>{window.location.reload()},2e3)}catch{Rt(!1),setTimeout(()=>{window.location.reload()},3e3)}}},disabled:zt,className:"h-[32px] px-4 bg-accent-secondary/10 hover:bg-accent-secondary/20 text-accent-secondary rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 whitespace-nowrap type-body-sm font-medium",children:zt?t.jsxs(t.Fragment,{children:[t.jsx(r,{className:"w-4 h-4 animate-spin"}),"Restarting..."]}):t.jsxs(t.Fragment,{children:[t.jsx(B,{className:"w-4 h-4"}),"Restart Now"]})})]})})]})]})}),M&&t.jsx(V,{template:"auto",children:t.jsx(R,{nodeName:ue,repeaterVersion:M.version,coreVersion:M.core_version,localHash:M.local_hash,publicKey:M.public_key})}),M&&(0===(null==ce?void 0:ce.latitude)||!(null==ce?void 0:ce.latitude))&&(0===(null==ce?void 0:ce.longitude)||!(null==ce?void 0:ce.longitude))&&t.jsx(V,{template:"auto",children:t.jsx(be,{})})]}),Me&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&Re(!1),role:"dialog","aria-modal":"true","aria-labelledby":"create-token-modal-title",children:t.jsxs("div",{className:"surface-modal radius-card p-6 max-w-md w-full",children:[t.jsx("h3",{id:"create-token-modal-title",className:"type-subheading text-text-primary mb-4",children:"Create API Token"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(j,{label:"Token Name",type:"text",value:ze,onChange:e=>Ae(e.target.value),placeholder:"e.g., Production Server, CI/CD Pipeline",description:"Give your token a descriptive name to identify its purpose",onKeyDown:e=>"Enter"===e.key&&Bt(),autoFocus:!0}),t.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[t.jsx("button",{onClick:()=>{Re(!1),Ae(""),Pe(null)},disabled:qe,className:"px-4 py-2 bg-bg-subtle hover-bg text-text-secondary radius-inner border-control transition-base disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:Bt,disabled:qe||!ze.trim(),className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary radius-inner border border-accent-primary/50 transition-base disabled:opacity-50 flex items-center gap-2",children:qe?t.jsxs(t.Fragment,{children:[t.jsx(r,{className:"w-4 h-4 animate-spin"}),"Creating..."]}):"Create Token"})]})]})]})}),Ie&&Le&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&Ke(!1),role:"dialog","aria-modal":"true","aria-labelledby":"show-token-modal-title",children:t.jsxs("div",{className:"surface-modal radius-card p-6 max-w-lg w-full",children:[t.jsx("h3",{id:"show-token-modal-title",className:"type-subheading text-text-primary mb-4",children:"Token Created Successfully"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"bg-accent-secondary/10 border border-accent-secondary/30 radius-inner p-3",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx($,{className:"w-4 h-4 text-accent-secondary flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"text-sm text-text-secondary",children:[t.jsx("strong",{children:"Save this token now!"})," For security reasons, it will not be shown again."]})]})}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-text-primary block mb-1.5",children:"Your API Token"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(v,{value:Le,readOnly:!0,className:"flex-1 font-mono"}),t.jsxs("button",{onClick:()=>{Le&&(navigator.clipboard.writeText(Le),Ge(!0),setTimeout(()=>Ge(!1),2e3))},className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary radius-inner border border-accent-primary/50 transition-base flex items-center gap-2",title:"Copy to clipboard",children:[Xe?t.jsx(n,{className:"w-4 h-4 text-accent-success"}):t.jsx(X,{className:"w-4 h-4"}),Xe?"Copied!":"Copy"]})]})]}),t.jsxs("div",{className:"bg-accent-tertiary/10 border border-accent-tertiary/30 radius-inner p-3",children:[t.jsx("p",{className:"text-sm text-text-secondary mb-2",children:t.jsx("strong",{children:"Usage Example:"})}),t.jsxs("code",{className:"block bg-accent-tertiary/20 px-3 py-2 rounded text-xs text-accent-tertiary font-mono overflow-x-auto",children:['curl -H "X-API-Key: ',Le.slice(0,12),'..." ',window.location.origin,"/api/stats"]})]}),t.jsx("div",{className:"flex justify-end mt-6",children:t.jsx("button",{onClick:()=>{Ke(!1),De(null)},className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary radius-inner border border-accent-primary/50 transition-base",children:"Done"})})]})]})}),t.jsx(P,{isOpen:!!Ve,title:"Revoke API Token",message:`Are you sure you want to revoke the token '${null==Ve?void 0:Ve.name}'? This action cannot be undone.`,confirmLabel:$e?"Revoking...":"Revoke",cancelLabel:"Cancel",variant:"danger",onConfirm:async()=>{if(Ve){Be(!0),Pe(null);try{await async function(e){return i(`/auth/tokens/${e}`,{method:"DELETE"})}(Ve.id),await $t(),He(null)}catch(e){Pe(e instanceof Error?e.message:"Failed to revoke token")}finally{Be(!1)}}},onCancel:()=>He(null)}),it&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&ot(!1),role:"dialog","aria-modal":"true","aria-labelledby":"add-key-modal-title",children:t.jsxs("div",{className:"surface-modal radius-card p-6 max-w-md w-full",children:[t.jsx("h3",{id:"add-key-modal-title",className:"type-subheading text-text-primary mb-4",children:"Add Transport Key"}),t.jsxs("div",{className:"space-y-4",children:[rt&&t.jsxs("div",{className:"bg-accent-tertiary/10 border border-accent-tertiary/30 radius-inner p-3 text-sm text-text-secondary",children:["Adding as child of: ",t.jsx("strong",{className:"text-text-primary",children:Yt()})]}),t.jsx(j,{label:"Key Name",type:"text",value:ft,onChange:e=>gt(e.target.value),placeholder:"e.g., Region Name, Group Key",onKeyDown:e=>"Enter"===e.key&&Zt(),autoFocus:!0}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Flood Policy"}),t.jsxs("div",{className:"flex bg-bg-subtle radius-inner border-control p-1",children:[t.jsx("button",{onClick:()=>vt("deny"),className:a("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","deny"===jt?"bg-accent-danger/20 text-accent-danger border border-accent-danger/50":"text-text-muted hover:text-text-secondary"),children:"DENY"}),t.jsx("button",{onClick:()=>vt("allow"),className:a("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","allow"===jt?"bg-accent-success/20 text-accent-success border border-accent-success/50":"text-text-muted hover:text-text-secondary"),children:"ALLOW"})]})]}),t.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[t.jsx("button",{onClick:()=>{ot(!1),gt(""),vt("deny")},disabled:Nt,className:"px-4 py-2 bg-bg-subtle hover-bg text-text-secondary radius-inner border-control transition-base disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:Zt,disabled:Nt||!ft.trim(),className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary radius-inner border border-accent-primary/50 transition-base disabled:opacity-50 flex items-center gap-2",children:Nt?t.jsxs(t.Fragment,{children:[t.jsx(r,{className:"w-4 h-4 animate-spin"}),"Adding..."]}):"Add Key"})]})]})]})}),dt&&pt&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&mt(!1),role:"dialog","aria-modal":"true","aria-labelledby":"edit-key-modal-title",children:t.jsxs("div",{className:"surface-modal radius-card p-6 max-w-md w-full",children:[t.jsx("h3",{id:"edit-key-modal-title",className:"type-subheading text-text-primary mb-4",children:"Edit Transport Key"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(j,{label:"Key Name",type:"text",value:pt.name,onChange:e=>ht({...pt,name:e.target.value}),autoFocus:!0}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Flood Policy"}),t.jsxs("div",{className:"flex bg-bg-subtle radius-inner border-control p-1",children:[t.jsx("button",{onClick:()=>ht({...pt,floodPolicy:"deny"}),className:a("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","deny"===pt.floodPolicy?"bg-accent-danger/20 text-accent-danger border border-accent-danger/50":"text-text-muted hover:text-text-secondary"),children:"DENY"}),t.jsx("button",{onClick:()=>ht({...pt,floodPolicy:"allow"}),className:a("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","allow"===pt.floodPolicy?"bg-accent-success/20 text-accent-success border border-accent-success/50":"text-text-muted hover:text-text-secondary"),children:"ALLOW"})]})]}),pt.transport_key&&t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Transport Key"}),t.jsx("code",{className:"block bg-bg-subtle px-3 py-2 radius-inner text-xs text-text-muted font-mono overflow-x-auto",children:pt.transport_key})]}),t.jsxs("div",{className:"flex justify-between gap-3 mt-6",children:[t.jsx("button",{onClick:()=>{mt(!1),bt(pt),xt(!0),ht(null)},disabled:Nt,className:"px-4 py-2 bg-accent-danger/20 hover:bg-accent-danger/30 text-accent-danger radius-inner border border-accent-danger/50 transition-base disabled:opacity-50",children:"Delete"}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:()=>{mt(!1),ht(null)},disabled:Nt,className:"px-4 py-2 bg-bg-subtle hover-bg text-text-secondary radius-inner border-control transition-base disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(pt){wt(!0),Ze(null);try{const e=await _(pt.id,{name:pt.name,flood_policy:pt.floodPolicy});e.success?(await Ut(),mt(!1),ht(null)):Ze(e.error||"Failed to update transport key")}catch(e){Ze(e instanceof Error?e.message:"Failed to update transport key")}finally{wt(!1)}}},disabled:Nt||!pt.name.trim(),className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary radius-inner border border-accent-primary/50 transition-base disabled:opacity-50 flex items-center gap-2",children:Nt?t.jsxs(t.Fragment,{children:[t.jsx(r,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):"Save"})]})]})]})]})}),ut&&yt&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&xt(!1),role:"dialog","aria-modal":"true","aria-labelledby":"delete-key-modal-title",children:t.jsxs("div",{className:"surface-modal radius-card p-6 max-w-md w-full",children:[t.jsx("h3",{id:"delete-key-modal-title",className:"type-subheading text-text-primary mb-4",children:"Delete Transport Key"}),t.jsxs("p",{className:"text-text-secondary mb-4",children:["Are you sure you want to delete ",t.jsxs("strong",{className:"text-text-primary",children:["'",yt.name,"'"]}),"?"]}),yt.children&&yt.children.length>0&&t.jsx("div",{className:"bg-accent-secondary/10 border border-accent-secondary/30 radius-inner p-3 mb-4",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx($,{className:"w-4 h-4 text-accent-secondary flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"text-sm text-text-secondary",children:["This key has ",yt.children.length," child key(s). Deleting will also remove all children."]})]})}),t.jsxs("div",{className:"flex justify-end gap-3",children:[t.jsx("button",{onClick:()=>{xt(!1),bt(null)},disabled:Nt,className:"px-4 py-2 bg-bg-subtle hover:bg-bg-elevated text-text-secondary rounded-lg border border-border-subtle transition-colors disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(yt){wt(!0),Ze(null);try{const e=await F(yt.id);e.success?(await Ut(),xt(!1),bt(null),nt(null)):Ze(e.error||"Failed to delete transport key")}catch(e){Ze(e instanceof Error?e.message:"Failed to delete transport key")}finally{wt(!1)}}},disabled:Nt,className:"px-4 py-2 bg-accent-danger/20 hover:bg-accent-danger/30 text-accent-danger radius-inner border border-accent-danger/50 transition-base disabled:opacity-50 flex items-center gap-2",children:Nt?t.jsxs(t.Fragment,{children:[t.jsx(r,{className:"w-4 h-4 animate-spin"}),"Deleting..."]}):"Delete"})]})]})})]})}export{we as default};
