const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DhkG1Nx9.js","assets/index-DySMpv2s.css"])))=>i.map(i=>d[i]);
import{d as L,e as dt,_ as we,f as mt,r as h,j as e,A as Ee,m as ee,S as ut,M as xt,U as ft,h as ht,k as pt,n as gt,o as yt,p as bt,q as H,t as pe,v as V,w as jt,x as Nt,y as ke,z as vt,L as te,D as se,E as wt,F as kt,G as ne,H as $e,T as Ct,J as Tt,B as Ce,R as He,K as Ie,N as Mt,O as X,P as F,Q as _t,V as St,W as Bt,X as Dt,Y as Rt,$ as Pt,a0 as ie,u as ge,a1 as At,a2 as Te,a3 as re,a4 as K,a5 as Oe,a6 as Ft,a7 as J,a8 as Lt,a9 as Et,aa as $t,ab as Me,ac as Ht,c as A,ad as It,ae as We,af as _e,ag as Ot,ah as Wt,ai as zt,aj as qt,ak as Ut,al as Vt}from"./index-DhkG1Nx9.js";import{r as Se,g as ze,A as G,E as Gt}from"./AnimatedNumber-VoU6jLG5.js";import{C as Be,P as Xt,a as Yt,B as Kt}from"./PageLayout-BkUTZXJb.js";import{u as O,r as W,h as Jt,a as Zt,b as Qt,i as es}from"./consumer-registry-CTQIn0m9.js";import{c as ts}from"./node-types-CgBRFpS8.js";import{b as qe,c as U,a as ss,d as ns,F as Z}from"./meshcore-tx-constants-DgpFTAmf.js";import{S as as,u as xe,P as os,T as is,C as Ue,a as rs}from"./PacketList-Dd7PQV7H.js";import{useGetDecodedContent as ls,useResolveSource as cs}from"./usePipelineStore-B9ir1Xwp.js";import{A as De}from"./SignalIndicator-DEXVYOhU.js";import{T as Ve}from"./TimeRangeStepper-RSPVaByt.js";import{L as ye}from"./LightSparkline-Bg_XrgTS.js";import{c as ds}from"./link-scoring-Ctdu509L.js";import{Z as ms,H as us}from"./useMapViewStore-BMqcaUNl.js";import{N as xs}from"./NodeInformationCard-Byom2o5k.js";import{g as fs,e as le,a as hs,f as ps}from"./chat-utils-DA-kxQ-o.js";import{M as Ge,C as gs}from"./ChatBubble-BP7NjdbB.js";import{C as Re}from"./chevron-right-na13OQfy.js";import{H as ys}from"./hash-KLxvul5e.js";import{R as ce,C as de}from"./Grid-DknC4rR5.js";import"./index-Bx_G2nLG.js";import"./primitives-nqGDyTiB.js";import"./payload-decoders-DC2sHkKr.js";import"./badge-colors-BNUqIXCA.js";import"./arrow-up-Bg1A345J.js";import"./map-pin-BHGohRD7.js";import"./circle-question-mark--xh93QHC.js";import"./triangle-alert-D8NErBXC.js";import"./DataBox-BMesbbaF.js";import"./layers-BxF7oyms.js";import"./activity-BG24yKp1.js";import"./circle-check-DJNUSJlu.js";import"./database-DE8k8U0g.js";import"./shield-XXZtlreW.js";/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],js=L("arrow-up-right",bs);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=[["path",{d:"M2 13a2 2 0 0 0 2-2V7a2 2 0 0 1 4 0v13a2 2 0 0 0 4 0V4a2 2 0 0 1 4 0v13a2 2 0 0 0 4 0v-4a2 2 0 0 1 2-2",key:"57tc96"}]],vs=L("audio-waveform",Ns);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],ks=L("chart-column",ws);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=[["path",{d:"M6 8.5a6.5 6.5 0 1 1 13 0c0 6-6 6-6 10a3.5 3.5 0 1 1-7 0",key:"1dfaln"}],["path",{d:"M15 8.5a2.5 2.5 0 0 0-5 0v1a2 2 0 1 1 0 4",key:"1qnva7"}]],Ts=L("ear",Cs);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]],_s=L("megaphone",Ms);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],Bs=L("message-square",Ss);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=[["path",{d:"M18 11h-4a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h4",key:"17ldeb"}],["path",{d:"M6 7v13a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7",key:"nc37y6"}],["rect",{width:"16",height:"5",x:"4",y:"2",rx:"1",key:"3jeezo"}]],Rs=L("pill-bottle",Ds);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=[["path",{d:"M4 10a7.31 7.31 0 0 0 10 10Z",key:"1fzpp3"}],["path",{d:"m9 15 3-3",key:"88sc13"}],["path",{d:"M17 13a6 6 0 0 0-6-6",key:"15cc6u"}],["path",{d:"M21 13A10 10 0 0 0 11 3",key:"11nf8s"}]],As=L("satellite-dish",Ps);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=[["circle",{cx:"7",cy:"7",r:"5",key:"x29byf"}],["circle",{cx:"17",cy:"17",r:"5",key:"1op1d2"}],["path",{d:"M12 17h10",key:"ls21zv"}],["path",{d:"m3.46 10.54 7.08-7.08",key:"1rehiu"}]],Ls=L("tablets",Fs);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],$s=L("timer",Es),I=dt(()=>({result:null,isComputing:!1})),Hs=500,Is=300;let z=null,Q=null;function Os(t){var a;const n=(a=t==null?void 0:t.config)==null?void 0:a.radio;return`${(n==null?void 0:n.spreading_factor)??7}:${(n==null?void 0:n.bandwidth)??125e3}:${(n==null?void 0:n.coding_rate)??5}:${(n==null?void 0:n.preamble_length)??8}`}function Ws(){if(z)return z;if(typeof window>"u")return null;try{z=new Worker(new URL("/assets/dashboard-bucketing.worker-RVncOvX0.js",import.meta.url),{type:"module"}),z.onmessage=t=>{if(t.data.type==="error"){console.error("[DashboardBucketing] Worker error:",t.data.error),I.setState({isComputing:!1});return}I.setState({result:t.data.payload,isComputing:!1})},z.onerror=t=>{console.error("[DashboardBucketing] Worker error:",t),I.setState({isComputing:!1})}}catch(t){console.error("[DashboardBucketing] Failed to init worker:",t)}return z}function zs(t,n,a,s){const o=Ws();if(!o)return;const i=t.length,c=new Float64Array(i),l=new Float64Array(i),d=new Uint16Array(i),m=new Uint8Array(i),u=new Uint8Array(i),x=new Uint8Array(i),r=new Uint8Array(i),y=new Float32Array(i),b=new Float32Array(i),p=new Uint32Array(i),w=new Map;let k=0;for(let j=0;j<i;j++){const N=t[j];c[j]=N.timestamp??0,l[j]=ze(N,s),d[j]=Math.min(N.length??N.payload_length??0,65535),m[j]=(N.type??N.payload_type??0)&15;const v=N.packet_origin;u[j]=v==="tx_local"?1:v==="tx_forward"?2:0,x[j]=N.transmitted?1:0,r[j]=N.drop_reason?1:0,y[j]=N.snr??0,b[j]=N.rssi??0;const D=N.packet_hash??"";let f=w.get(D);f===void 0&&(f=k++,w.set(D,f)),p[j]=f}I.setState({isComputing:!0});const T={type:"compute",payload:{timestamps:c,airtimeMs:l,byteSizes:d,payloadTypes:m,origins:u,transmitted:x,dropped:r,snrValues:y,rssiValues:b,hashIndices:p,rangeMinutes:n,bucketCount:a}};o.postMessage(T,[c.buffer,l.buffer,d.buffer,m.buffer,u.buffer,x.buffer,r.buffer,y.buffer,b.buffer,p.buffer])}function me(t){return Object.keys(t).map(n=>parseInt(n,10)).filter(n=>t[n]>0).sort((n,a)=>t[a]-t[n])}function qs(t,n,a){const s={...t,received:[...t.received],unique_received:[...t.unique_received],transmitted:[...t.transmitted],forwarded:[...t.forwarded],dropped:[...t.dropped],receivedBytesBuckets:t.receivedBytesBuckets.map(u=>({...u,bytesByType:{...u.bytesByType}})),forwardedBytesBuckets:t.forwardedBytesBuckets.map(u=>({...u,bytesByType:{...u.bytesByType}})),droppedBytesBuckets:t.droppedBytesBuckets.map(u=>({...u,bytesByType:{...u.bytesByType}})),receivedTotalByType:{...t.receivedTotalByType},forwardedTotalByType:{...t.forwardedTotalByType},droppedTotalByType:{...t.droppedTotalByType}},{start_time:o,end_time:i,bucket_duration_seconds:c,bucket_count:l}=t,d=new Set;for(const u of n){const x=u.timestamp??0;if(x<o||x>i)continue;const r=Math.floor((x-o)/c);if(r<0||r>=l)continue;d.has(r)||(d.add(r),s.received[r]={...s.received[r]},s.unique_received[r]={...s.unique_received[r]},s.transmitted[r]={...s.transmitted[r]},s.forwarded[r]={...s.forwarded[r]},s.dropped[r]={...s.dropped[r]});const y=ze(u,a),b=u.length??u.payload_length??0,p=u.type??u.payload_type??0,w=u.packet_origin;w==="tx_local"?(s.transmitted[r].count++,s.transmitted[r].airtime_ms+=y):w==="tx_forward"||u.transmitted?(s.forwarded[r].count++,s.forwarded[r].airtime_ms+=y,s.forwardedBytesBuckets[r].bytesByType[p]=(s.forwardedBytesBuckets[r].bytesByType[p]??0)+b,s.forwardedBytesBuckets[r].totalBytes+=b,s.forwardedTotalByType[p]=(s.forwardedTotalByType[p]??0)+b,s.totalForwardedCount++):u.drop_reason&&(s.dropped[r].count++,s.dropped[r].airtime_ms+=y,s.droppedBytesBuckets[r].bytesByType[p]=(s.droppedBytesBuckets[r].bytesByType[p]??0)+b,s.droppedBytesBuckets[r].totalBytes+=b,s.droppedTotalByType[p]=(s.droppedTotalByType[p]??0)+b,s.totalDroppedCount++),w!=="tx_local"&&(s.received[r].count++,s.received[r].airtime_ms+=y,s.unique_received[r].count++,s.unique_received[r].airtime_ms+=y,s.receivedBytesBuckets[r].bytesByType[p]=(s.receivedBytesBuckets[r].bytesByType[p]??0)+b,s.receivedBytesBuckets[r].totalBytes+=b,s.receivedTotalByType[p]=(s.receivedTotalByType[p]??0)+b,s.totalReceivedBytes+=b)}const m=s.time_range_minutes/60;return s.kbPerHour=m>0?Math.round(s.totalReceivedBytes/1024/m):0,s.forwardedRatePerHour=m>0?Math.round(s.totalForwardedCount/m):0,s.droppedRatePerHour=m>0?Math.round(s.totalDroppedCount/m):0,s.receivedActiveTypes=me(s.receivedTotalByType),s.forwardedActiveTypes=me(s.forwardedTotalByType),s.droppedActiveTypes=me(s.droppedTotalByType),s}typeof window<"u"&&Promise.all([we(()=>import("./index-DhkG1Nx9.js").then(t=>t.g1),__vite__mapDeps([0,1])),we(()=>import("./index-DhkG1Nx9.js").then(t=>t.g0),__vite__mapDeps([0,1]))]).then(([t,n])=>{const{DASHBOARD_TIME_RANGES:a}=n;let s=0,o=-1,i="";t.useStore.subscribe(c=>{const l=c.packets.length,d=c.globalTimeRangeIndex,m=Os(c.stats);if(l===s&&d===o&&m===i)return;const u=s,x=o,r=i;if(s=l,o=d,i=m,l===0)return;const y=a[d]??a[4],b=y.minutes,p=y.buckets,w=c.stats,k=Se(w),T=l-u,j=d!==x,N=m!==r,v=I.getState().result;if(!j&&!N&&T>0&&T<Hs&&v!==null&&v.time_range_minutes===b&&v.bucket_count===p){const f=c.packets.slice(l-T),C=qs(v,f,k);I.setState({result:C})}else Q&&clearTimeout(Q),Q=setTimeout(()=>{Q=null;const f=t.useStore.getState();if(f.packets.length===0||!f.stats)return;const C=a[f.globalTimeRangeIndex]??a[4],M=Se(f.stats);zs(f.packets,C.minutes,C.buckets,M)},Is)})});const Us=()=>I(t=>t.result),Xe=[{target:"ReceivedChart",fn:"type",minStage:1},{target:"ReceivedChart",fn:"airtime",minStage:1,when:Jt}];W(Xe);function Vs(t){const a=new Date(t*1e3).getHours();return a>=6&&a<18}function Gs(t){return new Date(t*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})}function Xs({buckets:t,activeTypes:n,totalByType:a}){O(Xe);const s=mt(),[o,i]=h.useState(null),[c,l]=h.useState(null),[d,m]=h.useState(null),u=h.useCallback((w,k,T)=>{i(k),l(T)},[]),x=t.length>0&&n.length>0,r=o?Vs(o.start):null,y=o?Gs(o.start):"",b=d!==null&&r!==null&&d!==r;r!==d&&m(r);const p=48;return e.jsxs("div",{className:"flex flex-col h-full relative",children:[e.jsx("div",{className:"h-5 relative mb-1 shrink-0",children:o&&c!==null&&e.jsxs("div",{className:"absolute flex items-center gap-1.5 type-data-sm -translate-x-1/2",style:{left:`calc(${p}px + ${c*100}% * (1 - ${p}px / 100%))`},children:[e.jsx(Ee,{mode:"wait",children:e.jsx(ee.span,{initial:b?{opacity:0,scale:.5,rotate:-90}:!1,animate:{opacity:1,scale:1,rotate:0},exit:{opacity:0,scale:.5,rotate:90},transition:{duration:.25,ease:"easeOut"},children:r?e.jsx(ut,{className:"w-4 h-4 text-sys-amber"}):e.jsx(xt,{className:"w-4 h-4 text-sys-blue"})},r?"sun":"moon")}),e.jsx("span",{className:"text-fg-secondary",children:y})]})}),e.jsx("div",{className:"flex-1 min-h-0",children:x&&e.jsx(ft,{buckets:t,activeTypes:n,gridColor:s.grid,axisTickColor:s.axisTick,onHover:u})}),e.jsx("div",{className:"pt-2 px-1 pb-2 shrink-0",children:x&&e.jsx(ht,{activeTypes:n,totalByType:a})})]})}function Ys(t,n,a){var i,c;if(t.length<=a)return t;const s=t.length/a,o=[];for(let l=0;l<a;l++){const d=Math.floor(l*s),m=Math.floor((l+1)*s),u=t.slice(d,m),x={start:((i=u[0])==null?void 0:i.start)??0,end:((c=u.at(-1))==null?void 0:c.end)??0,bytesByType:{},totalBytes:0};for(const r of u){x.totalBytes+=r.totalBytes;for(const y of n){const b=r.bytesByType[y]??0;b>0&&(x.bytesByType[y]=(x.bytesByType[y]??0)+b)}}o.push(x)}return o}function Ks(t,n,a,s,o,i,c){if(n.length===0)return;const l=Ys(n,a,yt.statsCard),d=l.length,m=i/d,u=l.map(r=>r.totalBytes),x=Math.max(...u);if(x!==0){for(let r=0;r<d;r++){const y=l[r],b=s+r*m,p=y.totalBytes;if(p===0)continue;const k=p/x*c;let j=o+c-k+k;for(const N of a){const v=y.bytesByType[N]??0;if(v===0)continue;const D=v/p*k,f=j-D;t.fillStyle=bt(N),t.globalAlpha=.85,t.fillRect(b,f,m,D),j=f}}t.globalAlpha=1}}function Js({buckets:t,activeTypes:n}){const a=h.useRef(null),s=h.useRef(t),o=h.useRef(n);s.current=t,o.current=n;const i=h.useMemo(()=>{const c=t.map(d=>d.start),l=t.map(()=>1);return[c,l]},[t]);return h.useEffect(()=>{if(!a.current||t.length===0)return;const c=a.current;let l=null,d=null;const m=pt(()=>{const u=c.getBoundingClientRect(),x=Math.floor(u.width)||200,r=Math.floor(u.height)||60,y={width:x,height:r,padding:[0,0,0,0],cursor:{show:!1},scales:{x:{time:!1},y:{range:[0,1]}},axes:[{show:!1},{show:!1}],series:[{},{show:!1}],legend:{show:!1},hooks:{draw:[b=>{const p=b.ctx,{left:w,top:k,width:T,height:j}=b.bbox;Ks(p,s.current,o.current,w,k,T,j)}]}};l=new gt(y,i,c),d=new ResizeObserver(()=>{const b=c.getBoundingClientRect();b.width>0&&b.height>0&&(l==null||l.setSize({width:Math.floor(b.width),height:Math.floor(b.height)}))}),d.observe(c)});return()=>{m(),d==null||d.disconnect(),l==null||l.destroy()}},[i,t.length]),t.length===0?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("div",{className:"w-full h-0.5 rounded-full bg-fg-muted/15"})}):e.jsx("div",{ref:a,className:"w-full h-full"})}const Ye=h.memo(Js),Ke=[{target:"ForwardedCard",fn:"type",minStage:1}];W(Ke);function Zs({value:t,receivedCount:n,buckets:a,activeTypes:s,ratePerHour:o,timeRangeLabel:i,icon:c,isLoaded:l=!0}){O(Ke);const d=n>0?(t/n*100).toFixed(1):null;return l?e.jsxs(H,{children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-2 sm:mb-3",children:[c&&e.jsx("span",{className:"icon-sm text-icon-card-title",children:c}),e.jsx("span",{className:"type-micro",children:"FORWARDED"}),i&&e.jsx(V,{color:"zinc",className:"hidden sm:inline-flex",children:i})]}),e.jsx("div",{className:"type-data-xl text-fg-primary",children:e.jsx(G,{value:t,className:"font-mono tabular-nums",priority:"high"})}),e.jsx("div",{className:"flex-1 mt-1 overflow-hidden min-h-[40px] sm:min-h-[60px]",children:s.length>0?e.jsx(Ye,{buckets:a,activeTypes:s}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("div",{className:"w-full h-0.5 rounded-full bg-fg-muted/15"})})}),e.jsx("div",{className:"pt-1.5 sm:pt-2 mt-1",children:e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"data-box-label",children:"Rate"}),e.jsxs("div",{className:"data-box data-box-fill data-box-left",children:[o,"/hr"]})]}),d!==null&&e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"data-box-label",children:"Ratio"}),e.jsxs("div",{className:"data-box data-box-fill data-box-left",children:[d,"%"]})]})]})})]}):e.jsx(H,{children:e.jsx(pe,{})})}const Je=[{target:"DroppedCard",fn:"type",minStage:1}];W(Je);function Qs({value:t,receivedCount:n,buckets:a,activeTypes:s,ratePerHour:o,timeRangeLabel:i,icon:c,isLoaded:l=!0}){O(Je);const d=n>0?(t/n*100).toFixed(1):null;return l?e.jsxs(H,{children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-2 sm:mb-3",children:[c&&e.jsx("span",{className:"icon-sm text-icon-card-title",children:c}),e.jsx("span",{className:"type-micro",children:"DROPPED"}),i&&e.jsx(V,{color:"zinc",className:"hidden sm:inline-flex",children:i})]}),e.jsx("div",{className:"type-data-xl text-fg-primary",children:e.jsx(G,{value:t,className:"font-mono tabular-nums",priority:"high"})}),e.jsx("div",{className:"flex-1 mt-1 overflow-hidden min-h-[40px] sm:min-h-[60px]",children:s.length>0?e.jsx(Ye,{buckets:a,activeTypes:s}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("div",{className:"w-full h-0.5 rounded-full bg-fg-muted/15"})})}),e.jsx("div",{className:"pt-1.5 sm:pt-2 mt-1",children:e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"data-box-label",children:"Rate"}),e.jsxs("div",{className:"data-box data-box-fill data-box-left",children:[o,"/hr"]})]}),d!==null&&e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"data-box-label",children:"Drop %"}),e.jsxs("div",{className:"data-box data-box-fill data-box-left",children:[d,"%"]})]})]})})]}):e.jsx(H,{children:e.jsx(pe,{})})}const en={",":"punc",".":"punc-period",":":"punc-colon","/":"punc-slash"},fe=/([,\.:\/])/g;function tn(t){return t.split(fe).map((a,s)=>{const o=en[a];return o?e.jsx("span",{className:o,children:a},s):a})}const E=h.memo(function({children:n,className:a="",as:s="span"}){const o=h.useMemo(()=>{let i;return typeof n=="number"?i=n.toLocaleString():Array.isArray(n)?i=n.join(""):i=String(n??""),fe.test(i)?(fe.lastIndex=0,tn(i)):i},[n]);return e.jsx(s,{className:`data-tight ${a}`.trim(),children:o})}),sn=2,nn=1;function an(t,n,a){const s=d=>(d==null?void 0:d.reduce((m,u)=>m+u.count,0))??0,o=s(n),i=s(a),c=o||(t==null?void 0:t.rx_count)||1,l=i||(t==null?void 0:t.dropped_count)||0;return c>0?l/(c+l)*100:0}function on(t,n,a){const s=o=>(o==null?void 0:o.reduce((i,c)=>i+c.count,0))??0;if(n!=null&&n.length&&a){const i=s(n)*100,c=n.length*a*1e3;return i/c*100}if(t){const o=(t.uptime_seconds||1)*1e3;return(t.total_airtime_ms||t.airtime_used_ms||0)/o*100}return 0}function Pe(t,n,a){return ss(Math.max(n,Math.min(a,t)))}function rn(t,n,a,s,o){let i=qe(t);n>20?i+=Z*2:n>12&&(i+=Z),a>8&&(i+=Z);const c=Pe(i,0,sn);let l=ns(t);a>8&&(l+=Z);const d=Pe(l,0,nn),m=U(c),u=U(d),x=s!==null?U(s):null;let r="stable";return x!==null&&(m>x?r="increase":m<x&&(r="decrease")),{floodFactor:c,directFactor:d,floodSlots:m,directSlots:u,adjustment:r,duplicateRate:Math.round(n*100)/100,txUtilization:Math.round(a*1e3)/1e3,zeroHopCount:t}}function ln({stats:t,receivedBuckets:n,droppedBuckets:a,forwardedBuckets:s,bucketDurationSeconds:o,timeRangeLabel:i,isLoaded:c=!0}){var be,je,Ne,ve;const[l,d]=h.useState(!1),[m,u]=h.useState("idle"),x=jt(),r=h.useCallback(async(P,$)=>{if(m!=="applying"){u("applying");try{const oe=await Nt({tx_delay_factor:P,direct_tx_delay_factor:$});oe!=null&&oe.success?(u("success"),setTimeout(()=>u("idle"),2e3)):(u("error"),setTimeout(()=>u("idle"),2500))}catch{u("error"),setTimeout(()=>u("idle"),2500)}}},[m]);if(!c)return e.jsx(H,{children:e.jsx(pe,{})});const y=10080*60,p=Math.floor(Date.now()/1e3)-y,w=Object.values((t==null?void 0:t.neighbors)??{}).filter(P=>P.zero_hop&&P.last_seen>=p&&ts(P).isRepeater).length,k=x.filter(P=>P.status==="active"||P.lastSeen>=p).length,T=Math.max(w,k),j=an(t,n,a),N=on(t,s,o),v=((je=(be=t==null?void 0:t.config)==null?void 0:be.delays)==null?void 0:je.tx_delay_factor)??null,D=((ve=(Ne=t==null?void 0:t.config)==null?void 0:Ne.delays)==null?void 0:ve.direct_tx_delay_factor)??null,f=rn(T,j,N,v),C=T!==1,M=qe(T),S=[`${T} repeater${C?"s":""} heard in the last 7 days (base Ã—${M.toFixed(1)}).`];f.floodFactor===M&&j<=12&&N<=8?S.push("No modifiers applied â€” network looks healthy."):(j>20?S.push(`High duplicate rate (${j.toFixed(1)}%) suggests frequent collisions â€” window widened.`):j>12&&S.push(`Elevated duplicate rate (${j.toFixed(1)}%) â€” window widened one step.`),N>8&&S.push(`Channel is busy (${N.toFixed(1)}% TX util) â€” extra spacing added.`));const g=[`Direct uses one forwarder â€” Ã—${f.directFactor.toFixed(1)} backoff for channel contention.`];N>8&&g.push("Busy channel â€” small extra backoff.");const _=[`Flood Ã—${f.floodFactor.toFixed(1)} (${f.floodSlots} slot${f.floodSlots!==1?"s":""})`,...S,"",`Direct Ã—${f.directFactor.toFixed(1)}`,...g,"","Click to copy CLI commands"].join(`
`),B=v!==null?U(v):null,R=D!==null?U(D):null,ae=B!==null&&f.floodSlots!==B,it=R!==null&&f.directSlots!==R,rt=ae||it,lt=async()=>{const P=`set txdelay ${f.floodFactor.toFixed(1)}
set direct.txdelay ${f.directFactor.toFixed(1)}`;try{await navigator.clipboard.writeText(P),d(!0),setTimeout(()=>d(!1),1500)}catch{const $=document.createElement("textarea");$.value=P,$.style.position="fixed",$.style.opacity="0",document.body.appendChild($),$.select();try{document.execCommand("copy"),d(!0),setTimeout(()=>d(!1),1500)}catch{console.error("Failed to copy commands")}document.body.removeChild($)}},ct=()=>r(f.floodFactor,f.directFactor);return e.jsxs(H,{children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-2 sm:mb-3 flex-wrap",children:[e.jsx(as,{className:"w-4 h-4 text-icon-card-title flex-shrink-0"}),e.jsx("span",{className:"type-micro",children:"DELAY DOCTOR"}),i&&e.jsx(V,{color:"zinc",className:"hidden sm:inline-flex",children:i})]}),e.jsxs("button",{onClick:lt,className:"flex gap-3 mb-2 sm:mb-3 w-full text-left hover:bg-subtle-fill radius-inner transition-base p-1 -m-1 group",title:_,children:[e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("span",{className:"type-data-xl text-fg-primary",children:e.jsxs(E,{children:["Ã—",f.floodFactor.toFixed(1)]})}),e.jsx("span",{className:"type-micro text-fg-muted mt-0.5 sm:mt-1",children:"Flood"})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("span",{className:"type-data-xl text-sys-blue",children:e.jsxs(E,{children:["Ã—",f.directFactor.toFixed(1)]})}),e.jsx("span",{className:"type-micro text-fg-muted mt-0.5 sm:mt-1",children:"Direct"})]}),e.jsx("div",{className:"flex items-center self-center opacity-0 group-hover:opacity-100 transition-opacity",children:l?e.jsx(ke,{className:"w-4 h-4 text-sys-green"}):e.jsx(vt,{className:"w-4 h-4 text-fg-muted"})})]}),e.jsx("div",{className:"flex-1 py-2",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"data-box-label",children:"Dupe"}),e.jsxs("div",{className:`data-box data-box-fill data-box-left ${f.duplicateRate>8?"text-status-warning":""}`,children:[f.duplicateRate.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"data-box-label",children:"TX Util"}),e.jsxs("div",{className:"data-box data-box-fill data-box-left",children:[f.txUtilization.toFixed(2),"%"]})]})]})}),e.jsx("div",{className:"pt-2 mt-auto",children:e.jsxs("div",{className:"flex items-end justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"data-box-label",children:"Current"}),e.jsx("div",{className:"flex gap-2",children:v!==null?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"data-box",children:["Ã—",v.toFixed(2)]}),e.jsxs("div",{className:"data-box",style:{color:"var(--sys-blue)"},children:["Ã—",(D==null?void 0:D.toFixed(2))??"â€”"]})]}):e.jsx("span",{className:"text-sm text-fg-muted",children:"No config"})})]}),rt&&e.jsxs("button",{onClick:ct,disabled:m==="applying"||m==="success",className:`flex items-center gap-1.5 px-2.5 py-1.5 radius-inner type-micro font-medium transition-base
                ${m==="success"?"bg-sys-green/15 text-sys-green":m==="error"?"bg-sys-red/15 text-sys-red":m==="applying"?"bg-subtle-fill text-fg-muted":"bg-sys-blue/10 text-sys-blue hover:bg-sys-blue/20"}`,title:`Apply Ã—${f.floodFactor.toFixed(1)} flood, Ã—${f.directFactor.toFixed(1)} direct`,children:[m==="success"?"Rx'd":m==="error"?"Failed":"Apply",m==="applying"?e.jsx(te,{className:"w-3.5 h-3.5 animate-spin"}):m==="success"?e.jsx(ke,{className:"w-3.5 h-3.5"}):e.jsxs("span",{className:"relative inline-flex items-end w-6 h-3.5",children:[e.jsx(Rs,{className:"w-3.5 h-3.5 absolute left-0 bottom-0"}),e.jsx(Ls,{className:"w-3 h-3 absolute right-0 bottom-0"})]})]})]})})]})}const Ze=[{target:"RecentPackets",fn:"rssi",minStage:1},{target:"RecentPackets",fn:"snr",minStage:1}];W(Ze);const cn=25;function dn(){O(Ze);const t=se(),n=wt(),a=kt(),s=ne(),o=ls(),i=xe(y=>y.requestChannel),[c,l]=h.useState(!0),d=h.useCallback(y=>l(y),[]),m=h.useMemo(()=>[...t.length<=100?t:t.slice(-100)].sort((b,p)=>(p.timestamp??0)-(b.timestamp??0)),[t]),u=s==null?void 0:s.local_hash,x=s==null?void 0:s.neighbors,r=cs();return e.jsxs(H,{noPadding:!0,className:"!overflow-visible",children:[e.jsx($e,{listHeader:!0,icon:e.jsx(He,{}),title:"Recent Packets",actions:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ct,{enabled:c,onChange:d,label:"Hide Dupes",size:"sm"}),a&&e.jsx(Tt,{showLabel:!0}),e.jsxs(Ce,{color:"primary",outline:!0,href:"/packets",children:["View all",e.jsx(De,{"data-slot":"icon"})]})]})}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto px-1",children:e.jsx(os,{packets:m,allPackets:t,localHash:u,neighbors:x,resolveSource:r,getDecodedContent:o,onChannelClick:i,loading:n,maxPackets:cn,showPagination:!1,flashNewest:!0,hideDupes:c,emptyMessage:"No packets received",footerAction:e.jsxs(Ce,{color:"primary",outline:!0,href:"/packets",children:["View all",e.jsx(De,{"data-slot":"icon"})]})})})]})}const mn={stable:"M5 12h14",up:"M5 15l7-7 7 7",down:"M19 9l-7 7-7-7"};function un({trend:t}){return e.jsx("span",{className:`mini-widget-trend ${t}`,children:e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:mn[t]})})})}function xn(){return e.jsx("div",{className:"mini-widget-loading",children:e.jsx("div",{className:"mini-widget-loading-spinner"})})}function fn({message:t}){return e.jsx("div",{className:"mini-widget-error",children:e.jsx("span",{title:t,children:"No data"})})}function q({title:t,icon:n,value:a,unit:s,valueSize:o="md",status:i,subtitle:c,trend:l,children:d,isLoading:m=!1,error:u,className:x="",onClick:r}){const y=["mini-widget-value",o==="lg"&&"mini-widget-value-lg",o==="sm"&&"mini-widget-value-sm"].filter(Boolean).join(" "),b=["mini-widget",x].filter(Boolean).join(" ");return e.jsxs(H,{noPadding:!0,className:b,onClick:r,children:[e.jsxs("div",{className:"mini-widget-header",children:[n,e.jsx("span",{className:"mini-widget-title",children:t}),i&&i!=="unknown"&&e.jsx("div",{className:`mini-widget-status-dot ${i}`}),l&&e.jsx(un,{trend:l})]}),m?e.jsx(xn,{}):u?e.jsx(fn,{message:u}):e.jsxs(e.Fragment,{children:[a!==void 0&&e.jsxs("div",{className:y,children:[typeof a=="number"?e.jsx(G,{value:a,className:"font-mono tabular-nums",priority:"medium",format:Number.isInteger(a)?void 0:{minimumFractionDigits:1,maximumFractionDigits:1}}):e.jsx(E,{children:a}),s&&e.jsx("span",{className:"mini-widget-unit",children:s})]}),c&&e.jsx("div",{className:"mini-widget-subtitle",children:c}),d]})]})}const hn={DELTA_CRITICAL:10,SLOPE_CRITICAL:4,JITTER_CRITICAL:6,DELTA_WARNING:5,SLOPE_WARNING:2,JITTER_WARNING:4},Qe={baselineMedian:null,baselineP10:null,baselineP90:null,currentMedian:null,currentSampleCount:0,delta:0,slope:0,jitter:0,penalty:0,penaltyReason:null,computedAt:0,isReliable:!1};function he(t,n){if(t.length===0)return null;const a=[...t].sort((c,l)=>c-l),s=n/100*(a.length-1),o=Math.floor(s),i=Math.ceil(s);return o===i?a[o]:a[o]+(a[i]-a[o])*(s-o)}function Ae(t){return he(t,50)}function pn(t){if(t.length<2)return 0;const n=t.reduce((o,i)=>o+i,0)/t.length,s=t.map(o=>Math.pow(o-n,2)).reduce((o,i)=>o+i,0)/t.length;return Math.sqrt(s)}function gn(t){if(t.length<2)return 0;const n=t.length;let a=0,s=0,o=0,i=0;const c=t[0].timestamp;for(const d of t){const m=(d.timestamp-c)/3600,u=d.value;a+=m,s+=u,o+=m*u,i+=m*m}const l=n*i-a*a;return Math.abs(l)<1e-4?0:(n*o-a*s)/l}function yn(t,n,a){const s=hn;return t>=s.DELTA_CRITICAL?[2,`Noise floor ${t.toFixed(1)} dB above baseline`]:n>=s.SLOPE_CRITICAL?[2,`Noise floor rising ${n.toFixed(1)} dB/hour`]:a>=s.JITTER_CRITICAL?[2,`Noise floor unstable (Â±${a.toFixed(1)} dB)`]:t>=s.DELTA_WARNING?[1,`Noise floor ${t.toFixed(1)} dB above baseline`]:n>=s.SLOPE_WARNING?[1,`Noise floor rising ${n.toFixed(1)} dB/hour`]:a>=s.JITTER_WARNING?[1,`Noise floor variable (Â±${a.toFixed(1)} dB)`]:[0,null]}function bn(t){if(t.length===0)return{...Qe,computedAt:Math.floor(Date.now()/1e3)};const n=Math.floor(Date.now()/1e3),a=t.filter(w=>Number.isFinite(w)),s=t.length>0?[t[t.length-1]]:[],o=t.slice(-4).filter(w=>Number.isFinite(w)),i=Ae(a),c=he(a,10),l=he(a,90),d=Ae(s),m=d!==null&&c!==null?d-c:0,u=o.map((w,k)=>({timestamp:n-(o.length-1-k)*3600,value:w})),x=gn(u),r=pn(o),y=a.length>=12,[b,p]=y?yn(m,x,r):[0,null];return{baselineMedian:i,baselineP10:c,baselineP90:l,currentMedian:d,currentSampleCount:s.length,delta:m,slope:x,jitter:r,penalty:b,penaltyReason:p,computedAt:n,isReliable:y}}const jn={lbtStats:null,noiseFloor:null,sparklineNoiseFloor:[],noiseFloorWindowHistory:[],linkQuality:null,channelHealth:null,nfTrend:Qe,radioConfig:null,trends:null,stats:null,recentPackets:[],quickNeighbors:[],isLoading:!0,error:null,refresh:async()=>{}},et=h.createContext(jn);function Nn({children:t}){var g;const n=ne(),a=se(),s=Ie(),o=Mt(),i=X(),c=F[i],l=Math.max(1,c.minutes/60),d=n===null,m=h.useMemo(()=>_t(a,l),[a,l]),u=(n==null?void 0:n.noise_floor_dbm)??null,x=h.useMemo(()=>St(u)?u:null,[u]),r=h.useMemo(()=>{var B;const _=(B=n==null?void 0:n.config)==null?void 0:B.radio;return _?{sf:_.spreading_factor??7,bwHz:_.bandwidth??125e3}:null},[(g=n==null?void 0:n.config)==null?void 0:g.radio]),y=Bt(l),b=Dt(l),p=n==null?void 0:n.neighbors,w=h.useMemo(()=>Object.fromEntries(Object.entries(p??{}).filter(([B])=>!o.has(B))),[p,o]),k=h.useMemo(()=>s.filter(_=>!o.has(_.hash)),[s,o]),T=h.useMemo(()=>bn(y),[y]),j=h.useMemo(()=>Rt(k,w,r),[k,w,r]),N=h.useMemo(()=>Pt(m,x,j),[m,x,j]),[v,D]=h.useState({noiseFloor:null,networkScore:null,channelHealth:null}),f=h.useRef(0);h.useEffect(()=>{const _=()=>{const R=Date.now();R-f.current>3e4&&(f.current=R,D({noiseFloor:x,networkScore:(j==null?void 0:j.networkScore)??null,channelHealth:(N==null?void 0:N.score)??null}))};_();const B=setInterval(_,5e3);return()=>clearInterval(B)},[x,j==null?void 0:j.networkScore,N==null?void 0:N.score]);const C=h.useMemo(()=>({noiseFloor:{current:x,previous:v.noiseFloor,trend:x!==null?ie(x,v.noiseFloor,2,!0):"stable"},networkScore:{current:(j==null?void 0:j.networkScore)??0,previous:v.networkScore,trend:ie((j==null?void 0:j.networkScore)??0,v.networkScore,3,!1)},channelHealth:{current:(N==null?void 0:N.score)??0,previous:v.channelHealth,trend:ie((N==null?void 0:N.score)??0,v.channelHealth,3,!1)}}),[x,j==null?void 0:j.networkScore,N==null?void 0:N.score,v]),S={lbtStats:m,noiseFloor:x,sparklineNoiseFloor:y,noiseFloorWindowHistory:b,linkQuality:j,channelHealth:N,nfTrend:T,radioConfig:r,trends:C,stats:n,recentPackets:a,quickNeighbors:s,isLoading:d,error:null,refresh:async()=>{}};return e.jsx(et.Provider,{value:S,children:t})}function Y(){const t=h.useContext(et);if(t===void 0)throw new Error("useLBTData must be used within an LBTDataProvider");return t}function vn(t){return t<100?"excellent":t<250?"good":t<500?"fair":t<1e3?"congested":"critical"}function wn(t,n){return t===0?"No backoffs":`${n.toFixed(0)}% retry rate`}function kn(){const{lbtStats:t,isLoading:n,error:a}=Y(),s=ge(),o=(t==null?void 0:t.avgBackoffMs)??0,i=(t==null?void 0:t.retryRate)??0,c=t?vn(o):"unknown",l=t==null?void 0:t.sparklineBackoff,d=h.useMemo(()=>!l||l.length<2?[]:l.map((m,u)=>({timestamp:Date.now()-(l.length-1-u)*36e5,count:m})),[l]);return e.jsx(q,{title:"LBT Backoff",icon:e.jsx($s,{className:"mini-widget-icon"}),value:Math.round(o),unit:"ms",status:c,subtitle:t?wn(o,i):void 0,isLoading:n,error:a,onClick:()=>s("/packets"),children:e.jsx("div",{className:"mini-widget-sparkline w-full",children:e.jsx(ye,{data:d,width:9999,height:24,color:"var(--sys-blue)",isLoading:n,className:"w-full"})})})}function ue(t){return t===0?"â€”":t<1?"<1":Math.round(t).toString()}function Cn(){const{lbtStats:t,isLoading:n,error:a}=Y(),s=ge(),o=(t==null?void 0:t.channelBusyCount)??0,i=(t==null?void 0:t.totalPacketsWithLBT)??0,c=(t==null?void 0:t.channelBusyRate)??0,l=(t==null?void 0:t.retryRate)??0,d=(t==null?void 0:t.avgBackoffMs)??0,m=(t==null?void 0:t.minBackoffMs)??0,u=(t==null?void 0:t.maxBackoffMs)??0,x=l>0?Math.max(0,(l-c)/l*100):100;return e.jsx(q,{title:"Ch. Busy",icon:e.jsx(Gt,{className:"mini-widget-icon"}),isLoading:n,error:a,onClick:()=>s("/packets"),children:e.jsx("div",{className:"flex-1 flex items-end",children:e.jsxs("div",{className:"grid grid-cols-[auto_minmax(0,1fr)] sm:grid-cols-[auto_minmax(0,1fr)_auto_minmax(0,1fr)] gap-x-2 gap-y-1 sm:gap-y-2 w-full items-baseline",children:[e.jsx("span",{className:"data-box-label mb-0 text-[10px] sm:text-sm",title:`${o} packets exceeded max CAD attempts (5) out of ${i} total transmissions.`,children:"Failed:"}),e.jsxs("div",{className:"data-box data-box-compact sm:data-box justify-self-start",title:`${o} packets exceeded max CAD attempts (5) out of ${i} total transmissions.`,children:[e.jsx(E,{children:o}),e.jsx("span",{className:"text-fg-muted punc-slash",children:"/"}),e.jsx(E,{children:i})]}),e.jsx("span",{className:"data-box-label mb-0 text-[10px] sm:text-sm",title:`${x.toFixed(1)}% of packets that needed LBT retries were sent successfully.`,children:"Sent:"}),e.jsx("div",{className:"data-box data-box-compact sm:data-box justify-self-start",title:`${x.toFixed(1)}% of packets that needed LBT retries were sent successfully.`,children:e.jsxs(E,{children:[x.toFixed(0),"%"]})}),e.jsx("span",{className:"data-box-label mb-0 text-[10px] sm:text-sm",title:`Average LBT backoff delay: ${d.toFixed(0)}ms.`,children:"Mean:"}),e.jsxs("div",{className:"data-box data-box-compact sm:data-box justify-self-start",title:`Average LBT backoff delay: ${d.toFixed(0)}ms.`,children:[e.jsx(E,{children:ue(d)}),e.jsx("span",{className:"text-fg-muted text-xs",children:"ms"})]}),e.jsx("span",{className:"data-box-label mb-0 text-[10px] sm:text-sm",title:`Backoff range: ${m.toFixed(0)}ms min, ${u.toFixed(0)}ms max.`,children:"Range:"}),e.jsxs("div",{className:"data-box data-box-compact sm:data-box justify-self-start",title:`Backoff range: ${m.toFixed(0)}ms min, ${u.toFixed(0)}ms max.`,children:[e.jsx(E,{children:ue(m)}),e.jsx("span",{className:"text-fg-muted punc-slash",children:"/"}),e.jsx(E,{children:ue(u)})]})]})})})}const Tn=.25,Fe=48;function Mn(t,n,a,s){const o=t.length;if(o===0)return[];if(o===1)return new Array(s).fill(n[0]);if(o===2){const x=new Array(s);for(let r=0;r<s;r++)x[r]=n[0]+(n[1]-n[0])*(r/(s-1));return x}const i=Math.max(2,Math.ceil(a*o)),c=t[0],d=t[o-1]-c||1,m=new Array(s),u=new Array(o);for(let x=0;x<s;x++){const r=c+x/(s-1)*d;for(let v=0;v<o;v++)u[v]=Math.abs(t[v]-r);const y=u.slice().sort((v,D)=>v-D),b=Math.max(y[i-1],1e-10);let p=0,w=0,k=0,T=0,j=0;for(let v=0;v<o;v++){const D=u[v]/b;if(D>=1)continue;const f=D*D*D,C=(1-f)*(1-f)*(1-f),M=t[v]-r;p+=C,w+=C*M,k+=C*n[v],T+=C*M*M,j+=C*M*n[v]}if(p===0){m[x]=n[Math.round(x/(s-1)*(o-1))];continue}const N=p*T-w*w;m[x]=Math.abs(N)<1e-10?k/p:(T*k-w*j)/N}return m}function _n(t){return t===null||t<-110?"excellent":t<-100?"good":t<-90?"fair":t<-80?"congested":"critical"}function Sn(t){return t===null?"No reading":t<-115?"Very quiet":t<-105?"Quiet":t<-95?"Moderate":t<-85?"Elevated":"High interference"}function Bn(){const{noiseFloor:t,noiseFloorWindowHistory:n,trends:a,isLoading:s,error:o}=Y(),i=_n(t),c=a==null?void 0:a.noiseFloor.trend,l=h.useMemo(()=>{if(!n||n.length<2)return[];const m=n.map(r=>r.timestamp),u=n.map(r=>-r.noise_floor_dbm);return Mn(m,u,Tn,Fe).map((r,y)=>({timestamp:Date.now()-(Fe-1-y)*36e5,count:r}))},[n]),d=t!==null?Math.round(t):"â€”";return e.jsx(q,{title:"Noise Floor",icon:e.jsx(vs,{className:"mini-widget-icon"}),value:d,unit:t!==null?"dBm":void 0,status:i,trend:c,subtitle:Sn(t),isLoading:s,error:o,children:e.jsx("div",{className:"mini-widget-sparkline w-full",children:e.jsx(ye,{data:l,width:9999,height:22,color:"var(--sys-blue)",isLoading:s,className:"w-full"})})})}const tt=[{target:"LinkLeaders",fn:"path",minStage:1,when:Zt},{target:"LinkLeaders",fn:"src_hash",minStage:1,when:Qt}];W(tt);function Dn(){O(tt);const t=ge(),n=Ie(),a=se(),s=ne(),o=X(),c=F[o].minutes*60,l=At(),d=h.useMemo(()=>{if(l===0)return a;const f=l-c;return a.filter(C=>C.timestamp>=f)},[a,c,l]),m=s===null,u=s!=null&&s.local_hash?Te(s.local_hash):"",x=(s==null?void 0:s.neighbors)??{},{neighborHashes:r,neighborNames:y}=h.useMemo(()=>{const f=new Set,C=new Map;for(const M of n){f.add(M.hash);const S=x[M.hash],g=(S==null?void 0:S.name)||(S==null?void 0:S.node_name)||M.prefix;C.set(M.hash,g)}return{neighborHashes:f,neighborNames:C}},[n,x]),b=h.useMemo(()=>{if(r.size===0||d.length===0||!u)return{champion:null,listener:null,loudest:null};const{scores:f}=ds(d,r,u),C=[];for(const[_,B]of f)B.blendedScore!==0&&C.push({...B,name:y.get(_)??Te(_)});let M=null,S=null,g=null;for(const _ of C)(!M||_.blendedScore>M.blendedScore)&&(M=_),(!S||_.listenerScore>S.listenerScore)&&(S=_),(!g||_.loudScore>g.loudScore)&&(g=_);return{champion:M,listener:S,loudest:g}},[d,r,u,y]),p=f=>e.jsxs("div",{className:"max-w-[220px]",children:[e.jsxs("div",{className:"font-semibold mb-1",children:["ðŸ† Champion: ",f.name]}),e.jsxs("div",{className:"text-fg-muted mb-1",children:["Blended Score: ",f.blendedScore,e.jsx("span",{className:"text-fg-muted/60 ml-1",children:"(Listener + Loud)"})]}),e.jsxs("div",{className:"border-t border-edge-subtle pt-1 mt-1 space-y-0.5",children:[e.jsxs("div",{children:["Listener: ",f.listenerScore,"/100 (",f.listenerCount," shared paths)"]}),e.jsxs("div",{children:["Loud: ",f.loudScore,"/100 (",f.loudCount," packets relayed)"]})]})]}),w=f=>e.jsxs("div",{className:"max-w-[220px]",children:[e.jsxs("div",{className:"font-semibold mb-1",children:["ðŸ‘‚ Best Listener: ",f.name]}),e.jsxs("div",{className:"text-fg-muted mb-1",children:["Score: ",f.listenerScore,"/100"]}),e.jsx("div",{className:"border-t border-edge-subtle pt-1 mt-1",children:e.jsxs("div",{children:[f.listenerCount," packets where they heard your transmissions"]})})]}),k=f=>e.jsxs("div",{className:"max-w-[220px]",children:[e.jsxs("div",{className:"font-semibold mb-1",children:["ðŸ“¢ Loudest: ",f.name]}),e.jsxs("div",{className:"text-fg-muted mb-1",children:["Score: ",f.loudScore,"/100"]}),e.jsx("div",{className:"border-t border-edge-subtle pt-1 mt-1",children:e.jsxs("div",{children:[f.loudCount," packets they relayed directly to you"]})})]}),{champion:T,listener:j,loudest:N}=b,D=T||j||N?e.jsxs("div",{className:"flex flex-col gap-0 sm:gap-0.5 mt-auto",children:[T&&e.jsx(re,{content:p(T),children:e.jsxs("div",{className:"flex items-center gap-1 text-xs sm:text-sm radius-badge px-1 -mx-1 hover-bg transition-base cursor-default",children:[e.jsx(is,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-map-neighbor-color flex-shrink-0"}),e.jsx("span",{className:"font-semibold text-map-neighbor-color font-mono truncate flex-1 min-w-0",children:T.name}),e.jsx("span",{className:"text-map-neighbor-color pl-1 sm:pl-2 tabular-nums flex-shrink-0 w-7 sm:w-9 text-right",children:T.blendedScore})]})}),j&&e.jsx(re,{content:w(j),children:e.jsxs("div",{className:"flex items-center gap-1 text-xs sm:text-sm radius-badge px-1 -mx-1 hover-bg transition-base cursor-default",children:[e.jsx(Ts,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"text-fg-muted font-mono truncate flex-1 min-w-0",children:j.name}),e.jsx("span",{className:"text-fg-muted pl-1 sm:pl-2 tabular-nums flex-shrink-0 w-7 sm:w-9 text-right",children:j.listenerScore})]})}),N&&e.jsx(re,{content:k(N),children:e.jsxs("div",{className:"flex items-center gap-1 text-xs sm:text-sm radius-badge px-1 -mx-1 hover-bg transition-base cursor-default",children:[e.jsx(_s,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"text-fg-muted font-mono truncate flex-1 min-w-0",children:N.name}),e.jsx("span",{className:"text-fg-muted pl-1 sm:pl-2 tabular-nums flex-shrink-0 w-7 sm:w-9 text-right",children:N.loudScore})]})})]}):n.length===0?e.jsx("div",{className:"flex items-center justify-center text-xs sm:text-sm text-fg-muted mt-auto",children:"No direct neighbors"}):e.jsx("div",{className:"flex items-center justify-center text-xs sm:text-sm text-fg-muted mt-auto",children:"No routing data yet"});return e.jsx(q,{title:"Link Leaders",icon:e.jsx(As,{className:"mini-widget-icon"}),isLoading:m,onClick:()=>t("/contacts"),children:D})}function Rn(t){const{retryRate:n,channelBusyCount:a,totalPacketsWithLBT:s,avgBackoffMs:o,maxBackoffMs:i}=t;if(s===0)return 0;const c=Math.min(s/10,1),l=.15,d=Math.log(1+n*l)/Math.log(1+100*l)*40,m=a/s*100,u=Math.min(m*.5,25);let x=0;o>100&&(x=Math.min(Math.log10(o/100)*8,15));let r=0;i>500&&o>0&&i>o*2&&(r=Math.min((i-500)/200,5));const b=(d+u+x+r)*c;return Math.min(b,85)}function Pn(t){return t<15?"excellent":t<30?"good":t<45?"fair":t<60?"congested":"critical"}function An(t){return t<15?"Clear channel":t<30?"Light traffic":t<45?"Moderate traffic":t<60?"Heavy traffic":t<75?"Congested":"Severe congestion"}function Fn(){const{lbtStats:t,isLoading:n,error:a}=Y(),s=t?Rn(t):0,o=t?Pn(s):"unknown",i=(t==null?void 0:t.maxBackoffMs)??0,c=t?i>200?`Max backoff: ${Math.round(i)}ms`:An(s):void 0,l=t==null?void 0:t.sparklineCollisionRisk,d=h.useMemo(()=>!l||l.length<2?[]:l.map((u,x)=>({timestamp:Date.now()-(l.length-1-x)*36e5,count:u})),[l]),m=Math.round(s*10)/10;return e.jsx(q,{title:"Collision Risk",icon:e.jsx(ms,{className:"mini-widget-icon"}),value:m,unit:"%",status:o,subtitle:c,isLoading:n,error:a,children:e.jsx("div",{className:"mini-widget-sparkline w-full",children:e.jsx(ye,{data:d,width:9999,height:24,color:"var(--sys-blue)",isLoading:n,className:"w-full"})})})}function Ln(t){return t<30?"excellent":t<50?"good":t<70?"fair":t<90?"congested":"critical"}function En(t){return t<1e3?`${Math.round(t)}ms`:t<6e4?`${(t/1e3).toFixed(1)}s`:`${(t/6e4).toFixed(1)}m`}function $n(){const[t,n]=h.useState(!1),[a]=h.useState(0),{stats:s,lbtStats:o,isLoading:i}=Y(),c=h.useMemo(()=>{if(!s)return null;const y=s.airtime_used_ms??0,b=s.max_airtime_ms??1,p=s.airtime_remaining_ms??0,w=s.utilization_percent??(b>0?y/b*100:0);return{usedMs:y,maxMs:b,remainingMs:p,utilizationPercent:w}},[s]),l=h.useMemo(()=>{if(!o||o.totalPacketsWithLBT===0)return 100;const y=o.totalPacketsWithLBT-o.packetsWithRetries,b=o.totalPacketsWithLBT;return y/b*100},[o]),d=(c==null?void 0:c.utilizationPercent)??0,m=Ln(d),u=(c==null?void 0:c.remainingMs)??0,x=l<95?`${l.toFixed(0)}% clean TX`:`${En(u)} remaining`,r=c?e.jsx("div",{className:"mini-widget-progress mt-auto",children:e.jsx("div",{className:`mini-widget-progress-bar ${m}`,style:{width:`${Math.min(d,100)}%`}})}):null;return e.jsx(q,{title:"Duty Cycle",icon:e.jsx(He,{className:"mini-widget-icon"}),value:d.toFixed(1),unit:"%",status:m,subtitle:x,isLoading:i,children:r})}function Hn(){return e.jsxs("div",{className:"mini-widget",children:[e.jsxs("div",{className:"mini-widget-header",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx(K,{className:"h-3 w-16"})]}),e.jsx(K,{className:"h-7 w-12 mt-2"}),e.jsx(K,{className:"h-3 w-20 mt-2"})]})}function In(){return e.jsx("div",{className:"widget-row",children:Array.from({length:6}).map((t,n)=>e.jsx(Hn,{},n))})}const st=[{target:"MeshHealth",fn:"type",minStage:1}];W(st);function On({className:t="",isLoaded:n}){O(st);const a=Oe(),s=n??a??!0;return e.jsxs("div",{className:`mesh-health-container relative ${t}`,children:[e.jsxs("div",{className:"mesh-health-header",children:[e.jsx(Ft,{className:"w-4 h-4 text-sys-blue"}),e.jsx("span",{className:"type-label text-fg-muted",children:"MESH HEALTH"})]}),s?e.jsx(Nn,{children:e.jsxs("div",{className:"widget-row",children:[e.jsx(kn,{}),e.jsx(Fn,{}),e.jsx(Bn,{}),e.jsx($n,{}),e.jsx(Cn,{}),e.jsx(Dn,{})]})}):e.jsx(In,{})]})}const nt=[{target:"PublicChannel",fn:"decrypt",minStage:2,when:es}];W(nt);let at="",ot="",Le="";function Wn(){const t=new Date,n=t.toDateString();if(n!==Le){Le=n,at=n;const a=new Date(t);a.setDate(a.getDate()-1),ot=a.toDateString()}}function zn(t){Wn();const n=new Date(t*1e3).toDateString();return n===at?"Today":n===ot?"Yesterday":new Date(t*1e3).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"})}function qn(t,n,a){return`${t||""}|${n}|${a}`}function Un(t,n){const a=t.message,s=n.message;return a.timestamp===s.timestamp&&a.text===s.text&&a.senderName===s.senderName&&a.channelHash===s.channelHash&&a.channelName===s.channelName&&t.isChannelSelected===n.isChannelSelected&&t.onChannelClick===n.onChannelClick}const Vn=h.memo(function({message:n,onChannelClick:a,isChannelSelected:s}){const o=n.channelName||n.channelHash.slice(0,6);return e.jsx("div",{style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(gs,{senderName:n.senderName||"Unknown",text:n.text,timestamp:n.timestamp,nameAccessory:e.jsx(Ue,{channelName:o,active:s,onClick:()=>a==null?void 0:a(n.channelHash)})})})},Un);function Gn({open:t,onClose:n,messages:a,onLoadMore:s,hasMoreToLoad:o,isDecoding:i,initialChannel:c}){const l=h.useRef(null),d=h.useRef(!0),m=X(),u=We(),x=h.useRef(!1);h.useEffect(()=>{t?(x.current=!0,_e.resume()):x.current&&_e.pause()},[t]);const r=h.useMemo(()=>{const g=Date.now()/1e3,_=F[m].minutes,B=g-_*60;return[...a].filter(R=>R.timestamp>=B).sort((R,ae)=>R.timestamp-ae.timestamp)},[a,m]),y=h.useCallback(()=>{const g=l.current;g&&(d.current=g.scrollTop>=-50)},[]),b=h.useMemo(()=>{const g=new Map;for(const _ of r){const B=_.channelHash,R=g.get(B);R?R.count++:g.set(B,{name:_.channelName||_.channelHash.slice(0,6),hash:_.channelHash,count:1})}return Array.from(g.values()).sort((_,B)=>B.count-_.count)},[r]),p=b.length,[w,k]=h.useState(null),[T,j]=h.useState(!1);h.useEffect(()=>{t&&c&&k(c)},[t,c]);const N=h.useCallback(()=>{s(w,b)},[s,w,b]),v=h.useMemo(()=>w?r.filter(g=>g.channelHash===w):r,[r,w]),D=h.useMemo(()=>{const g=[];let _="";for(const B of v){const R=zn(B.timestamp);R!==_&&(g.push({type:"date",date:R}),_=R),g.push({type:"message",message:B})}return g},[v]);h.useLayoutEffect(()=>{const g=l.current;g&&d.current&&(g.scrollTop=0)},[v.length]);const f=19,C=b.slice(0,f),M=b.slice(f),S=M.length>0;return e.jsx(Ot,{open:t,onClose:n,size:"lg",motionPlus:!0,solid:!0,children:e.jsxs(Wt,{className:"p-0 flex flex-col h-[80vh] max-h-[700px] rounded-2xl",children:[e.jsx("div",{className:"flex-shrink-0 px-4 sm:px-5 py-3 sm:py-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ge,{className:"size-5 text-icon-card-title flex-shrink-0"}),e.jsx("h2",{className:"type-micro",children:"Public Channels"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{ranges:F,selectedIndex:m,onSelect:u,size:"sm"}),e.jsx("button",{onClick:n,className:"sm:hidden min-h-[44px] min-w-[44px] px-3 flex items-center justify-center text-[15px] font-medium text-sys-blue active:text-sys-blue/70 transition-base radius-inner active:bg-subtle-fill",children:"Done"}),e.jsx("button",{onClick:n,className:"hidden sm:flex items-center justify-center p-2 text-fg-muted hover:text-fg-primary transition-base radius-inner hover:bg-subtle","aria-label":"Close",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})}),e.jsx("div",{className:"flex-shrink-0 px-3 pb-2 relative z-10 isolate",style:{minHeight:p>0?void 0:0},children:p>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsxs("button",{onClick:()=>k(null),className:A("px-2 py-0.5 rounded text-xs font-medium transition-all","ring-1 ring-inset",w===null?"bg-sys-blue/20 text-sys-blue ring-sys-blue/30":"bg-subtle-fill text-fg-secondary ring-edge-subtle hover:bg-subtle-fill-strong"),children:["All ",p]}),C.map(g=>e.jsx("button",{onClick:()=>k(g.hash),className:A("flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium transition-all","ring-1 ring-inset",w===g.hash?"bg-sys-blue/20 text-sys-blue ring-sys-blue/30":"bg-subtle-fill text-fg-secondary ring-edge-subtle hover:bg-subtle-fill-strong"),children:e.jsx("span",{className:"truncate max-w-[80px]",children:g.name})},g.hash)),S&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>j(!T),className:A("flex items-center gap-0.5 px-2 py-0.5 rounded text-xs font-medium transition-all","ring-1 ring-inset",T||M.some(g=>g.hash===w)?"bg-sys-blue/20 text-sys-blue ring-sys-blue/30":"bg-subtle-fill text-fg-secondary ring-edge-subtle hover:bg-subtle-fill-strong"),children:["+",M.length,e.jsx(zt,{className:A("size-3 transition-transform",T&&"rotate-180")})]}),T&&e.jsx("div",{className:A("absolute top-full left-0 mt-1 z-50","min-w-[140px] max-h-[200px] overflow-y-auto","p-1 rounded-lg","bg-elevated backdrop-blur-xl","ring-1 ring-edge-subtle shadow-xl"),children:M.map(g=>e.jsxs("button",{onClick:()=>{k(g.hash),j(!1)},className:A("w-full flex items-center gap-1.5 px-2 py-1 rounded text-xs font-medium transition-all text-left",w===g.hash?"bg-sys-blue/20 text-sys-blue":"text-fg-secondary hover:bg-subtle-fill-strong"),children:[e.jsx(ys,{className:"size-2.5 opacity-60 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:g.name}),e.jsxs("span",{className:"opacity-60 ml-auto",children:["(",g.count,")"]})]},g.hash))})]})]})}),e.jsx("div",{ref:l,onScroll:y,className:A("flex-1 overflow-y-auto overflow-x-hidden","mx-3 mb-3 rounded-md","bg-body","ring-1 ring-inset ring-edge-subtle","flex flex-col-reverse"),children:i&&v.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full min-h-[300px] text-fg-muted px-4 py-4",children:[e.jsx(te,{className:"size-12 mb-4 text-sys-indigo animate-spin"}),e.jsx("p",{className:"text-lg font-medium",children:"Loading messages..."})]}):v.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full min-h-[300px] text-fg-muted px-4 py-4",children:[e.jsx(Bs,{className:"size-16 mb-4 opacity-20"}),e.jsx("p",{className:"text-lg font-medium",children:"No messages yet"}),e.jsx("p",{className:"text-sm mt-1 opacity-70",children:w?"No messages in this channel":"Public channel messages will appear here"})]}):e.jsxs("div",{className:"px-4 py-4",children:[o&&e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("button",{onClick:N,disabled:i,className:A("px-4 py-1.5 rounded-full","text-[11px] font-medium","ring-1 ring-inset",i?"bg-subtle-fill text-fg-muted ring-edge-subtle cursor-wait":"bg-sys-blue/10 text-sys-blue ring-sys-blue/20 hover:bg-sys-blue/20 hover:ring-sys-blue/30"),children:i?e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(te,{className:"size-3 animate-spin"}),"Loading..."]}):"Load older messages"})}),D.map((g,_)=>{if(g.type==="date")return e.jsx("div",{className:"flex justify-center my-4",children:e.jsx("span",{className:A("px-3.5 py-1.5 rounded-full","bg-subtle-fill backdrop-blur-sm","text-[11px] text-fg-muted/80 font-medium","ring-1 ring-edge-subtle"),children:g.date})},`date-${g.date}-${_}`);const B=`msg-${g.message.timestamp}-${g.message.senderName||"anon"}-${g.message.channelHash}`;return e.jsx("div",{className:"mb-3",children:e.jsx(Vn,{message:g.message,onChannelClick:k,isChannelSelected:w===g.message.channelHash})},B)})]})}),e.jsx("div",{className:"flex-shrink-0 px-5 py-2 text-center",children:e.jsxs("p",{className:"text-[11px] text-fg-muted",children:[v.length," messages Â· ",p," ",p===1?"channel":"channels",i&&e.jsxs("span",{className:"ml-2 text-sys-indigo",children:[e.jsx(te,{className:"inline size-3 animate-spin mr-1"}),"Decrypting..."]})]})})]})})}function Xn(t){const n=[],a=new Set;for(const s of t.values()){const o=s.decoded;if(!o||!o.decrypted||o.macCorrupted||!o.text)continue;const i=qn(o.senderName,o.channelHash,o.text);a.has(i)||(a.add(i),n.push({timestamp:s.timestamp,channelName:o.channelName,channelHash:o.channelHash,senderName:o.senderName,text:o.text,rssi:s.rssi,snr:s.snr}))}return n}function Yn({isLoaded:t}){const n=Oe(),a=t??n??!0;O(nt);const s=se(),[o,i]=h.useState(!1),[c,l]=h.useState(null),d=X(),m=h.useCallback(()=>{l(null),i(!0),J.getState().queueDecryption(s)},[s]),u=xe(C=>C.requestedHash),x=xe(C=>C.clearRequest);h.useEffect(()=>{u&&(l(u),i(!0),J.getState().queueDecryption(s),x())},[u,x,s]);const r=Lt(),y=Et(),b=$t(),p=h.useMemo(()=>Xn(r),[r]),w=h.useMemo(()=>{const C=Date.now()/1e3,M=F[d].minutes,S=C-M*60;return p.filter(g=>g.timestamp>=S)},[p,d]),k=h.useMemo(()=>w.length===0?null:w.reduce((C,M)=>M.timestamp>C.timestamp?M:C),[w]),T=y.isDecoding,N=h.useMemo(()=>{const C=Date.now()/1e3,M=F[d].minutes,S=C-M*60,g=new Set;let _=0;for(const B of s)(B.type??B.payload_type)===Me.GRP_TXT&&((B.timestamp??0)<S||g.has(B.packet_hash)||(g.add(B.packet_hash),_++));return _},[s,d]),v=Ht(),D=h.useMemo(()=>{const C=Date.now()/1e3,M=F[d].minutes,S=C-M*60;for(const g of s)if((g.type??g.payload_type)===Me.GRP_TXT&&!((g.timestamp??0)<S)&&!v.has(g.packet_hash))return!0;return!1},[s,v,d]),f=h.useCallback((C,M)=>{if(!T){if(C){const S=M.find(g=>g.hash===C);if(S){console.log(`[PublicChannelCard] Fast-path load for #${S.name}`),J.getState().queueChannelDecryption(s,S.name);return}}J.getState().queueDecryption(s)}},[s,T]);return a?e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:m,className:A("group cursor-pointer rounded-2xl transition-all duration-150","bg-surface/80 backdrop-blur-lg depth-raised","hover:bg-subtle-fill","px-3 py-2.5 sm:px-4 sm:py-3"),children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-shrink-0",children:[e.jsx(Ge,{className:"size-4 text-icon-card-title flex-shrink-0"}),e.jsx("span",{className:"type-micro",children:"CHAT ACTIVITY"}),N>0&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-subtle-fill ring-1 ring-inset ring-edge-subtle text-sm tabular-nums text-fg-secondary",children:N}),e.jsx(Re,{className:"size-4 text-fg-muted group-hover:text-sys-indigo transition-colors ml-auto sm:hidden"})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-1.5 min-w-0 overflow-hidden",children:[e.jsx(Ee,{mode:"wait",initial:!1,children:k?e.jsxs(ee.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},exit:{opacity:0,y:-16},transition:{duration:.2,ease:[.4,0,.2,1]},className:"flex items-center gap-2 sm:gap-1.5 min-w-0",children:[k.channelName&&e.jsx("span",{className:"hidden sm:inline-flex",children:e.jsx(Ue,{channelName:k.channelName})}),e.jsx("div",{className:"hidden sm:flex w-[30px] h-[30px] rounded-full items-center justify-center flex-shrink-0 ring-1 ring-edge-subtle",style:{backgroundColor:fs(le(k.senderName||"").cleanName)},children:le(k.senderName||"").emoji?e.jsx("span",{className:"text-base",children:le(k.senderName||"").emoji}):e.jsx("span",{className:"text-white text-xs font-bold tracking-tighter",children:hs(k.senderName||"")})}),e.jsx("div",{className:"inline-flex items-center px-3 py-1.5 rounded-2xl rounded-tr-md bg-[#007AFF] shadow-sm min-w-0 flex-1 sm:flex-initial sm:max-w-xs sm:-ml-px",children:e.jsx("span",{className:"text-sm text-white truncate tracking-wide",children:ps(k.text)})}),e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-subtle-fill ring-1 ring-inset ring-edge-subtle text-sm tabular-nums text-fg-secondary flex-shrink-0",children:It(k.timestamp)})]},`msg-${k.timestamp}-${k.senderName}-${k.channelHash}`):b?e.jsx(ee.span,{initial:{opacity:0},animate:{opacity:1},className:"text-sm text-fg-muted italic",children:"No messages yet"},"empty"):e.jsxs(ee.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,y:-16},transition:{duration:.15},className:"flex items-center gap-2 sm:gap-1.5",children:[e.jsx("div",{className:"hidden sm:block w-8 h-4 rounded bg-subtle-fill-strong animate-pulse"}),e.jsx("div",{className:"hidden sm:block w-[30px] h-[30px] rounded-full bg-subtle-fill-strong animate-pulse"}),e.jsx("div",{className:"h-8 w-32 sm:w-48 rounded-2xl bg-subtle-fill-strong animate-pulse"}),e.jsx("div",{className:"w-12 h-6 rounded-md bg-subtle-fill-strong animate-pulse"})]},"skeleton")}),e.jsx(Re,{className:"size-4 text-fg-muted group-hover:text-sys-indigo transition-colors flex-shrink-0 hidden sm:block ml-1"})]})]})}),e.jsx(Gn,{open:o,onClose:()=>i(!1),messages:p,onLoadMore:f,hasMoreToLoad:D,isDecoding:T,initialChannel:c})]}):e.jsx("div",{className:"h-14 rounded-xl bg-elevated/50 animate-pulse"})}function Sa(){var b;const t=ne(),n=qt(),a=Ut(),s=Us(),o=h.useRef(!1);a&&!o.current&&(o.current=!0);const i=o.current,c=X(),l=We(),d=Vt(),m=F[c]??F[4],u=d.isBackgroundLoading&&c>=5,x=h.useMemo(()=>{const p=C=>(C==null?void 0:C.reduce((M,S)=>M+S.count,0))??0,w=p(s==null?void 0:s.received),k=p(s==null?void 0:s.unique_received),T=p(s==null?void 0:s.forwarded),j=p(s==null?void 0:s.dropped),N=p(s==null?void 0:s.transmitted),v=((s==null?void 0:s.time_range_minutes)??m.minutes)/60,D=v>0?Math.round(w/v):0,f=v>0?Math.round(T/v):0;return{received:w,uniqueReceived:k,forwarded:T,dropped:j,transmitted:N,rxPerHour:D,fwdPerHour:f}},[s,m.minutes]),r=h.useMemo(()=>s?{totalBytes:s.totalReceivedBytes,kbPerHour:s.kbPerHour}:{totalBytes:0,kbPerHour:0},[s]),y=(t==null?void 0:t.node_name)??((b=t==null?void 0:t.config)==null?void 0:b.node_name)??"Unknown Node";return h.useEffect(()=>{y&&y!=="Unknown Node"&&(document.title=`pyMC: ${y}`)},[y]),n?e.jsxs(Be,{neomorphic:!0,className:"p-8 text-center",children:[e.jsx("p",{className:"type-subheading text-sys-red mb-2",children:"Failed to connect to backend"}),e.jsx("p",{className:"type-body text-fg-muted",children:n}),e.jsx("p",{className:"type-data-sm text-fg-muted mt-4",children:"Make sure the backend is running on port 8000"})]}):e.jsxs(Xt,{children:[e.jsx(Yt,{title:y,icon:e.jsx(us,{}),controls:e.jsx(Ve,{ranges:F,selectedIndex:c,onSelect:l,isPending:u})}),e.jsxs(Kt,{ready:i,children:[e.jsx(Yn,{}),e.jsx(ce,{template:"hero-auto",children:e.jsxs(Be,{neomorphic:!0,children:[e.jsx($e,{icon:e.jsx(ks,{}),title:"PACKETS RECEIVED",badge:m.label,badgeColor:"zinc",actions:i?e.jsxs("div",{className:"data-box",children:[r.kbPerHour," KB/hr"]}):e.jsx("div",{className:"data-box opacity-0",children:"0 KB/hr"})}),e.jsxs("div",{className:"flex flex-wrap gap-4 sm:gap-8",children:[e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("div",{className:"type-data-xl text-fg-primary",children:i?e.jsx(G,{value:x.received,className:"font-mono tabular-nums",priority:"high"}):e.jsx("span",{className:"opacity-30",children:"â€”"})}),e.jsx(V,{color:"zinc",className:"mb-0.5 sm:mb-1",children:"Total Rx"})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("div",{className:"type-data-xl text-fg-primary",children:i?e.jsx(G,{value:x.uniqueReceived,className:"font-mono tabular-nums",priority:"high"}):e.jsx("span",{className:"opacity-30",children:"â€”"})}),e.jsx(V,{color:"zinc",className:"mb-0.5 sm:mb-1",children:"Unique"})]})]}),e.jsxs("div",{className:"mt-2 flex-1 min-h-0 relative",children:[e.jsx("div",{className:`absolute inset-0 flex items-end gap-1 transition-opacity duration-300 ${i?"opacity-0 pointer-events-none":"opacity-100"}`,"aria-hidden":i,children:[45,72,33,58,80,42,65,28,55,75,38,62].map((p,w)=>e.jsx("div",{className:"flex-1 bg-subtle-fill rounded-sm animate-pulse",style:{height:`${p}%`}},w))}),e.jsx("div",{className:`h-full transition-opacity duration-300 ${i?"opacity-100":"opacity-0"}`,children:e.jsx(Xs,{buckets:(s==null?void 0:s.receivedBytesBuckets)??[],activeTypes:(s==null?void 0:s.receivedActiveTypes)??[],totalByType:(s==null?void 0:s.receivedTotalByType)??{}})})]})]})}),e.jsxs(ce,{template:"compact",children:[e.jsx(de,{span:6,lg:4,children:e.jsx(Zs,{value:x.forwarded,receivedCount:x.received,buckets:(s==null?void 0:s.forwardedBytesBuckets)??[],activeTypes:(s==null?void 0:s.forwardedActiveTypes)??[],ratePerHour:(s==null?void 0:s.forwardedRatePerHour)??0,timeRangeLabel:m.label,icon:e.jsx(js,{className:"w-4 h-4"})})}),e.jsx(de,{span:6,lg:4,children:e.jsx(Qs,{value:x.dropped,receivedCount:x.received,buckets:(s==null?void 0:s.droppedBytesBuckets)??[],activeTypes:(s==null?void 0:s.droppedActiveTypes)??[],ratePerHour:(s==null?void 0:s.droppedRatePerHour)??0,timeRangeLabel:m.label,icon:e.jsx(rs,{className:"w-4 h-4"})})}),e.jsx(de,{span:12,lg:4,children:e.jsx(ln,{stats:t,localHash:t==null?void 0:t.local_hash,receivedBuckets:s==null?void 0:s.received,droppedBuckets:s==null?void 0:s.dropped,forwardedBuckets:s==null?void 0:s.forwarded,bucketDurationSeconds:s==null?void 0:s.bucket_duration_seconds,timeRangeLabel:m.label})})]}),e.jsx(On,{}),e.jsx(dn,{}),t&&e.jsx(ce,{template:"auto",children:e.jsx(xs,{nodeName:y,repeaterVersion:t.version,coreVersion:t.core_version,localHash:t.local_hash,publicKey:t.public_key})})]})]})}export{Sa as default};
