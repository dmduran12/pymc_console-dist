import{a6 as e,f as a,a7 as t,a8 as r,a9 as s,aa as n,ab as o,a4 as i,j as l,ac as c}from"./index-Bcoy3A07.js";import{b as m,c as d}from"./recharts-bmHCCfxU.js";import{P as p,a as y,C as u}from"./PageLayout-Cdzbj79W.js";import"./maplibre-gl-CFO9X1Ek.js";const g=e(e=>({entries:[],commandHistory:[],isInitialized:!1,addEntry:a=>{const t="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const a=16*Math.random()|0;return("x"===e?a:3&a|8).toString(16)}),r={...a,id:t,timestamp:Date.now()};return e(e=>({entries:[...e.entries,r]})),t},updateEntry:(a,t)=>{e(e=>({entries:e.entries.map(e=>e.id===a?{...e,...t}:e)}))},addCommand:a=>{e(e=>({commandHistory:[...e.commandHistory,a]}))},clearEntries:()=>{e({entries:[],commandHistory:[]})},setInitialized:a=>{e({isInitialized:a})}})),h=new Set(["start ota","erase","reboot"]),f=["gps","sensor"],v=[{cmd:"help",desc:"Show available commands"},{cmd:"clear",desc:"Clear terminal screen"},{cmd:"status",desc:"Get repeater status summary"},{cmd:"uptime",desc:"Show system uptime"},{cmd:"packets",desc:"Show packet statistics"},{cmd:"board",desc:"Show board/platform info"},...[{name:"get adc.multiplier",category:"get",params:[],description:"Get ADC multiplier for battery",serialOnly:!1,hasParam:!1},{name:"get advert.interval",category:"get",params:[],description:"Get local advert interval (minutes)",serialOnly:!1,hasParam:!1},{name:"get af",category:"get",params:[],description:"Get airtime factor",serialOnly:!1,hasParam:!1},{name:"get agc.reset.interval",category:"get",params:[],description:"Get AGC reset interval (seconds)",serialOnly:!1,hasParam:!1},{name:"get allow.read.only",category:"get",params:[],description:"Get read-only access setting",serialOnly:!1,hasParam:!1},{name:"get bridge.baud",category:"get",params:[],description:"Get bridge baud rate",serialOnly:!1,hasParam:!1},{name:"get bridge.channel",category:"get",params:[],description:"Get bridge channel (ESP-NOW)",serialOnly:!1,hasParam:!1},{name:"get bridge.delay",category:"get",params:[],description:"Get bridge delay (ms)",serialOnly:!1,hasParam:!1},{name:"get bridge.enabled",category:"get",params:[],description:"Get bridge enabled status",serialOnly:!1,hasParam:!1},{name:"get bridge.secret",category:"get",params:[],description:"Get bridge encryption secret",serialOnly:!1,hasParam:!1},{name:"get bridge.source",category:"get",params:[],description:"Get bridge packet source",serialOnly:!1,hasParam:!1},{name:"get bridge.type",category:"get",params:[],description:"Get bridge type (rs232/espnow/none)",serialOnly:!1,hasParam:!1},{name:"get direct.txdelay",category:"get",params:[],description:"Get direct TX delay factor",serialOnly:!1,hasParam:!1},{name:"get flood.advert.interval",category:"get",params:[],description:"Get flood advert interval (hours)",serialOnly:!1,hasParam:!1},{name:"get flood.max",category:"get",params:[],description:"Get max flood hops",serialOnly:!1,hasParam:!1},{name:"get freq",category:"get",params:[],description:"Get frequency (MHz)",serialOnly:!1,hasParam:!1},{name:"get guest.password",category:"get",params:[],description:"Get guest password",serialOnly:!1,hasParam:!1},{name:"get int.thresh",category:"get",params:[],description:"Get interference threshold",serialOnly:!1,hasParam:!1},{name:"get lat",category:"get",params:[],description:"Get latitude",serialOnly:!1,hasParam:!1},{name:"get lon",category:"get",params:[],description:"Get longitude",serialOnly:!1,hasParam:!1},{name:"get multi.acks",category:"get",params:[],description:"Get multi-ack setting",serialOnly:!1,hasParam:!1},{name:"get name",category:"get",params:[],description:"Get node name",serialOnly:!1,hasParam:!1},{name:"get prv.key",category:"get",params:[],description:"Get private key (hex)",serialOnly:!1,hasParam:!1},{name:"get public.key",category:"get",params:[],description:"Get public key (hex)",serialOnly:!1,hasParam:!1},{name:"get radio",category:"get",params:[],description:"Get radio params (freq,bw,sf,cr)",serialOnly:!1,hasParam:!1},{name:"get repeat",category:"get",params:[],description:"Get repeat/forward status (on/off)",serialOnly:!1,hasParam:!1},{name:"get role",category:"get",params:[],description:"Get device role",serialOnly:!1,hasParam:!1},{name:"get rxdelay",category:"get",params:[],description:"Get RX delay base",serialOnly:!1,hasParam:!1},{name:"get tx",category:"get",params:[],description:"Get TX power (dBm)",serialOnly:!1,hasParam:!1},{name:"get txdelay",category:"get",params:[],description:"Get TX delay factor",serialOnly:!1,hasParam:!1},{name:"gps",category:"gps",params:[],description:"Show GPS status",serialOnly:!1,hasParam:!1},{name:"gps advert",category:"gps",params:[],description:"Get/set GPS advert location policy",serialOnly:!1,hasParam:!0},{name:"gps off",category:"gps",params:[],description:"Disable GPS",serialOnly:!1,hasParam:!0},{name:"gps on",category:"gps",params:[],description:"Enable GPS",serialOnly:!1,hasParam:!0},{name:"gps setloc",category:"gps",params:[],description:"Set node location from GPS",serialOnly:!1,hasParam:!0},{name:"gps sync",category:"gps",params:[],description:"Sync time from GPS",serialOnly:!1,hasParam:!0},{name:"log",category:"logging",params:[],description:"Dump log file (serial only)",serialOnly:!0,hasParam:!1},{name:"log erase",category:"logging",params:[],description:"Erase log file",serialOnly:!1,hasParam:!0},{name:"log start",category:"logging",params:[],description:"Start packet logging",serialOnly:!1,hasParam:!0},{name:"log stop",category:"logging",params:[],description:"Stop packet logging",serialOnly:!1,hasParam:!0},{name:"neighbor.remove",category:"neighbor",params:[],description:"Remove neighbor by pubkey",serialOnly:!1,hasParam:!0},{name:"neighbors",category:"neighbor",params:[],description:"List neighbors",serialOnly:!1,hasParam:!1},{name:"get",category:"other",params:[],description:"Execute get command",serialOnly:!1,hasParam:!0},{name:"set",category:"other",params:[{name:"value",type:"float"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Execute set command",serialOnly:!1,hasParam:!0},{name:"tempradio",category:"radio",params:[{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Apply temporary radio params (freq bw sf cr timeout_mins)",serialOnly:!1,hasParam:!0},{name:"sensor get",category:"sensor",params:[],description:"Get sensor/custom variable value",serialOnly:!1,hasParam:!0},{name:"sensor list",category:"sensor",params:[{name:"value",type:"int"}],description:"List all sensor/custom variables",serialOnly:!1,hasParam:!0},{name:"sensor set",category:"sensor",params:[],description:"Set sensor/custom variable value",serialOnly:!1,hasParam:!0},{name:"set adc.multiplier",category:"set",params:[{name:"value",type:"float"}],description:"Set ADC multiplier",serialOnly:!1,hasParam:!0},{name:"set advert.interval",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"string"}],description:"Set local advert interval (1-10080 min, 0=off)",serialOnly:!1,hasParam:!0},{name:"set af",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set airtime factor (0-9)",serialOnly:!1,hasParam:!0},{name:"set agc.reset.interval",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set AGC reset interval (seconds, rounded to 4)",serialOnly:!1,hasParam:!0},{name:"set allow.read.only",category:"set",params:[{name:"value",type:"int"}],description:"Set read-only access (on/off)",serialOnly:!1,hasParam:!0},{name:"set bridge.baud",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set bridge baud (9600-115200)",serialOnly:!1,hasParam:!0},{name:"set bridge.channel",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"string"}],description:"Set bridge channel (1-14)",serialOnly:!1,hasParam:!0},{name:"set bridge.delay",category:"set",params:[{name:"value",type:"int"}],description:"Set bridge delay (0-10000 ms)",serialOnly:!1,hasParam:!0},{name:"set bridge.enabled",category:"set",params:[{name:"value",type:"int"}],description:"Enable/disable bridge",serialOnly:!1,hasParam:!0},{name:"set bridge.secret",category:"set",params:[{name:"value",type:"string"},{name:"value",type:"float"}],description:"Set bridge encryption secret",serialOnly:!1,hasParam:!0},{name:"set bridge.source",category:"set",params:[{name:"value",type:"int"}],description:"Set bridge source (rx/tx)",serialOnly:!1,hasParam:!0},{name:"set direct.txdelay",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"}],description:"Set direct TX delay factor",serialOnly:!1,hasParam:!0},{name:"set flood.advert.interval",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set flood advert interval (3-48 hours, 0=off)",serialOnly:!1,hasParam:!0},{name:"set flood.max",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"float"}],description:"Set max flood hops (0-64)",serialOnly:!1,hasParam:!0},{name:"set freq",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"}],description:"Set frequency MHz (serial only, reboot required)",serialOnly:!0,hasParam:!0},{name:"set guest.password",category:"set",params:[{name:"value",type:"string"}],description:"Set guest password",serialOnly:!1,hasParam:!0},{name:"set int.thresh",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set interference threshold",serialOnly:!1,hasParam:!0},{name:"set lat",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"float"},{name:"value",type:"float"}],description:"Set latitude",serialOnly:!1,hasParam:!0},{name:"set lon",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"float"},{name:"value",type:"float"}],description:"Set longitude",serialOnly:!1,hasParam:!0},{name:"set multi.acks",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set multi-ack (0/1)",serialOnly:!1,hasParam:!0},{name:"set name",category:"set",params:[{name:"value",type:"string"},{name:"value",type:"int"}],description:"Set node name",serialOnly:!1,hasParam:!0},{name:"set prv.key",category:"set",params:[{name:"value",type:"string"}],description:"Set private key (hex, restart required)",serialOnly:!1,hasParam:!0},{name:"set radio",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set radio params (freq bw sf cr)",serialOnly:!1,hasParam:!0},{name:"set repeat",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set repeat/forward (on/off)",serialOnly:!1,hasParam:!0},{name:"set rxdelay",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"float"}],description:"Set RX delay base",serialOnly:!1,hasParam:!0},{name:"set tx",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"float"}],description:"Set TX power (dBm)",serialOnly:!1,hasParam:!0},{name:"set txdelay",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"}],description:"Set TX delay factor",serialOnly:!1,hasParam:!0},{name:"stats-core",category:"stats",params:[],description:"Show core statistics (serial only)",serialOnly:!0,hasParam:!1},{name:"stats-packets",category:"stats",params:[],description:"Show packet statistics (serial only)",serialOnly:!0,hasParam:!1},{name:"stats-radio",category:"stats",params:[],description:"Show radio statistics (serial only)",serialOnly:!0,hasParam:!1},{name:"advert",category:"system",params:[],description:"Send self advertisement",serialOnly:!1,hasParam:!1},{name:"board",category:"system",params:[],description:"Show board/manufacturer name",serialOnly:!1,hasParam:!1},{name:"clear stats",category:"system",params:[],description:"Reset statistics counters",serialOnly:!1,hasParam:!0},{name:"clock",category:"system",params:[{name:"value",type:"int"}],description:"Display current time",serialOnly:!1,hasParam:!0},{name:"clock sync",category:"system",params:[],description:"Sync clock from sender timestamp",serialOnly:!1,hasParam:!0},{name:"password",category:"system",params:[{name:"value",type:"string"}],description:"Change admin password",serialOnly:!1,hasParam:!0},{name:"reboot",category:"system",params:[],description:"Reboot the device",serialOnly:!1,hasParam:!1},{name:"start ota",category:"system",params:[{name:"value",type:"int"}],description:"Start OTA firmware update",serialOnly:!1,hasParam:!0},{name:"time",category:"system",params:[{name:"value",type:"int"}],description:"Set time to epoch seconds",serialOnly:!1,hasParam:!0},{name:"ver",category:"system",params:[],description:"Show firmware version and build date",serialOnly:!1,hasParam:!1}].filter(e=>!e.serialOnly&&!h.has(e.name)&&!f.some(a=>e.name.startsWith(a))).map(e=>({cmd:e.name,desc:e.description,params:e.hasParam?"{value}":void 0,required:e.hasParam}))],x={"set mode":["forward","monitor"],"set duty":["on","off"],"set repeat":["on","off"],"set tx":["10","14","17","20","22"],"set sf":["7","8","9","10","11","12"],"set bw":["125","250","500"],"set af":["0.5","1.0","1.5","2.0"],"set txdelay":["0.5","0.7","1.0","1.5"],"set direct.txdelay":["0.3","0.5","0.7"],"set log":["debug","info","warning"]};function b(e){switch(e){case"success":return"text-accent-success";case"error":return"text-accent-danger";case"warning":return"text-amber-400";case"info":return"text-accent-tertiary";case"value":return"text-accent-primary";case"system":return"text-text-muted";default:return"text-text-secondary"}}const w=m.memo(function({entry:e}){return"command"===e.type?l.jsxs("div",{className:"flex items-center gap-2 py-1",children:[l.jsx("span",{className:"text-text-muted font-medium select-none",children:"$"}),l.jsx("span",{className:"text-text-primary font-semibold",children:e.content})]}):"system"===e.type?l.jsx("div",{className:d("py-0.5",b(e.outputType||"system")),children:e.content}):e.content.includes("██")?l.jsx("pre",{className:d("terminal-ascii font-mono leading-none py-2 whitespace-pre",b(e.outputType||"value")),children:e.content}):l.jsx("div",{className:"ml-4 font-mono text-[13px] py-1",children:e.content.split("\n").map((a,t)=>{const r=function(e,a){if(e.startsWith("HELP_HEADER:::"))return[{text:e.slice(14),color:"text-text-primary font-bold"}];if(e.startsWith("HELP_NOTE:::"))return[{text:e.slice(12),color:"text-text-muted italic"}];const t=e.match(/^([a-z][a-z0-9.]*(?:\s+[a-z][a-z0-9.]*)?):::(.+)$/);if(t){const[,e,a]=t,r=e.split(" "),s=r[0];let n="text-accent-tertiary";"get"===s?n="text-accent-success":"set"===s&&(n="text-amber-400");const o=[{text:`  ${s}`,color:`${n} font-semibold`}];r.length>1&&o.push({text:` ${r.slice(1).join(" ")}`,color:"text-accent-primary"});const i=" ".repeat(Math.max(1,22-e.length));return o.push({text:`${i}${a}`,color:"text-text-muted"}),o}if("error"===a||"warning"===a)return[{text:e,color:b(a)}];if("value"===a)return[{text:e,color:b("value")}];const r=e.match(/^([\w\s.]+):\s*(.+)$/);if(r){const[,e,a]=r;return[{text:`${e}: `,color:"text-text-muted"},{text:a,color:"text-accent-primary font-semibold"}]}return e.startsWith("OK")?[{text:e,color:b("success")}]:[{text:e,color:b(a)}]}(a,e.outputType||"default");return l.jsx("div",{className:"leading-relaxed",children:r.map((e,a)=>l.jsx("span",{className:e.color,children:e.text},a))},t)})})});function O(){const e=a(),h=g(e=>e.entries),f=g(e=>e.commandHistory),b=g(e=>e.isInitialized),{addEntry:O,updateEntry:P,addCommand:k,clearEntries:S,setInitialized:$}=g(),[_,N]=m.useState(""),[E,j]=m.useState(-1),[G,T]=m.useState(!1),[C,F]=m.useState([]),[D,W]=m.useState(0),[L,A]=m.useState(0),[I,R]=m.useState(!1),H=m.useRef(null),K=m.useRef(null),M=m.useRef(null);m.useEffect(()=>{b||(async()=>{O({type:"output",content:"██████  ██    ██ ███    ███  ██████\n██   ██  ██  ██  ████  ████ ██     \n██████    ████   ██ ████ ██ ██     \n██         ██    ██  ██  ██ ██     \n██         ██    ██      ██  ██████",outputType:"value"}),await new Promise(e=>setTimeout(e,200));const e=O({type:"system",content:"● Initializing terminal...",outputType:"system"});await new Promise(e=>setTimeout(e,400)),P(e,{content:"✓ Initializing terminal...",outputType:"success"});const a=O({type:"system",content:"● Connecting to repeater...",outputType:"system"});await new Promise(e=>setTimeout(e,600)),P(a,{content:"✓ Connected to repeater",outputType:"success"}),O({type:"system",content:"Ready. Type 'help' for commands.",outputType:"system"}),$(!0)})()},[b,O,P,$]),m.useEffect(()=>{K.current&&(K.current.scrollTop=K.current.scrollHeight)},[h]);const q=m.useCallback(()=>{var e;null==(e=H.current)||e.focus()},[]),z=m.useCallback(e=>{const a=e.trim().toLowerCase();if(!a)return T(!1),void F([]);const t=v.filter(e=>e.cmd.toLowerCase().startsWith(a));if(t.length>0)return F(t),W(0),void T(!0);if(a.includes(" ")){const e=a.lastIndexOf(" "),t=a.substring(0,e),r=a.substring(e+1),s=v.find(e=>e.cmd.toLowerCase()===t);if(s&&x[s.cmd]){const e=x[s.cmd].filter(e=>e.toLowerCase().startsWith(r)).map(e=>({cmd:`${s.cmd} ${e}`,desc:`→ ${e}`}));if(e.length>0)return F(e),W(0),void T(!0)}}T(!1),F([])},[]),X=m.useCallback(e=>{var a;const t=C[e];t&&(t.required&&t.params?(N(t.cmd+" "),z(t.cmd+" ")):(N(t.cmd),T(!1)),null==(a=H.current)||a.focus())},[C,z]),U=m.useCallback(async e=>{var a,l,c,m,d,p,y,u;const g=e.trim();if(!g)return;const h=g.toLowerCase();if(k(g),O({type:"command",content:g}),"clear"===h)return void S();if("help"===h){const e=v.map(e=>`${e.cmd}:::${e.desc}`).join("\n");return void O({type:"output",content:`HELP_HEADER:::Available commands\n${e}\nHELP_NOTE:::Some MeshCore commands not available via HTTP.`,outputType:"default"})}const f=O({type:"output",content:"processing...",outputType:"system"});try{const e=await t();let v="",x="info";const b=e=>{const a=Math.floor(e/86400),t=Math.floor(e%86400/3600),r=Math.floor(e%3600/60);return a>0?`${a}d ${t}h ${r}m`:t>0?`${t}h ${r}m`:`${r}m`};if("status"===h){v=`Mode: ${(null==(l=null==(a=e.config)?void 0:a.repeater)?void 0:l.mode)||"unknown"} | Neighbors: ${Object.keys(e.neighbors||{}).length} | Uptime: ${b(e.uptime_seconds||0)}`}else if("uptime"===h)v=b(e.uptime_seconds||0),x="value";else if("packets"===h)v=`rx: ${e.rx_count??0}\ntx: ${e.tx_count??0}\nfwd: ${e.forwarded_count??0}\ndrop: ${e.dropped_count??0}`;else if("neighbors"===h){const a=e.neighbors||{},t=Object.entries(a);if(0===t.length)v="No neighbors discovered yet.",x="warning";else{const e=t.map(([e,a])=>{const t=a.name||a.node_name||"Unknown";return`  ${e.slice(0,8)}  ${t}`});v=`Neighbors (${t.length}):\n${e.join("\n")}`}}else if("board"===h)v="pyMC_Repeater (Linux/RPi)",x="value";else if(h.startsWith("get ")){const a=h.slice(4).trim(),t=null==(c=e.config)?void 0:c.delays,r=null==(m=e.config)?void 0:m.radio,s=null==(d=e.config)?void 0:d.repeater,n=null==(p=e.config)?void 0:p.duty_cycle;switch(a){case"name":v=(null==(y=e.config)?void 0:y.node_name)||"Unknown";break;case"role":v="repeater";break;case"lat":v=null!=(null==s?void 0:s.latitude)?String(s.latitude):"not set";break;case"lon":v=null!=(null==s?void 0:s.longitude)?String(s.longitude):"not set";break;case"freq":v=(null==r?void 0:r.frequency)?(r.frequency/1e6).toFixed(3):"?";break;case"tx":v=String((null==r?void 0:r.tx_power)??"?");break;case"bw":v=(null==r?void 0:r.bandwidth)?String(r.bandwidth/1e3):"?";break;case"sf":v=String((null==r?void 0:r.spreading_factor)??"?");break;case"cr":v=String((null==r?void 0:r.coding_rate)??"?");break;case"radio":v=r?`freq: ${(r.frequency/1e6).toFixed(3)} MHz\nbw: ${r.bandwidth/1e3} kHz\nsf: ${r.spreading_factor}\ncr: 4/${r.coding_rate}`:"?";break;case"af":case"txdelay":v=String((null==t?void 0:t.tx_delay_factor)??"1.0");break;case"direct.txdelay":v=String((null==t?void 0:t.direct_tx_delay_factor)??"0.5");break;case"mode":v=(null==s?void 0:s.mode)||"forward";break;case"repeat":v="forward"===(null==s?void 0:s.mode)?"on":"off";break;case"flood.max":v=String((null==s?void 0:s.max_flood_hops)??"3");break;case"flood.advert.interval":v=null!=(null==s?void 0:s.send_advert_interval_hours)?`${s.send_advert_interval_hours}h`:"?";break;case"advert.interval":v=null!=(null==s?void 0:s.advert_interval_minutes)?`${s.advert_interval_minutes}m`:"120m";break;case"rxdelay":v=String((null==t?void 0:t.rx_delay_base)??"0.0");break;case"duty":case"duty.enabled":v=(null==n?void 0:n.enforcement_enabled)?"on":"off";break;case"duty.max":v=null!=(null==n?void 0:n.max_airtime_percent)?`${n.max_airtime_percent}%`:"?";break;case"public.key":v=e.public_key||"not available";break;case"prv.key":v="Private key not available via stats API.\nRun: sudo ./manage.sh upgrade to apply PATCH 6",x="warning";break;case"guest.password":case"allow.read.only":v="Security settings not exposed via stats API.\nCheck /etc/pymc_repeater/config.yaml",x="warning";break;default:v=`Unknown parameter: ${a}\nAvailable: name, role, lat, lon, freq, tx, bw, sf, cr, radio, af, txdelay, direct.txdelay, rxdelay, mode, repeat, flood.max, advert.interval, duty, public.key`,x="error"}"error"!==x&&(x="value")}else if("advert"===h){const e=await r();v=e.success?"OK - Advert sent":`Error: ${e.error||"Failed"}`,x=e.success?"success":"error"}else if(h.startsWith("set mode ")){const e=h.split(" ")[2];if("forward"!==e&&"monitor"!==e)v='Error: Mode must be "forward" or "monitor"',x="error";else{const a=await s(e);v=a.success?`OK - Mode set to ${e}`:"Error: Failed",x=a.success?"success":"error"}}else if(h.startsWith("set duty ")){const e=h.split(" ")[2],a="on"===e||"1"===e,t=await n(a);v=t.success?"OK - Duty cycle "+(a?"enabled":"disabled"):"Error: Failed",x=t.success?"success":"error"}else if(h.startsWith("set tx ")){const e=parseInt(h.split(" ")[2]);if(isNaN(e)||e<2||e>22)v="Error: TX power must be 2-22 dBm (SX1262 chip max)",x="error";else{const a=await o({tx_power:e});v=a.success?`OK - TX power set to ${e}dBm`:`Error: ${a.error||"Failed"}`,x=a.success?"success":"error"}}else if(h.startsWith("set af ")||h.startsWith("set txdelay ")){const e=parseFloat(h.split(" ")[2]);if(isNaN(e)||e<0||e>5)v="Error: TX delay factor must be 0.0-5.0",x="error";else{const a=await o({tx_delay_factor:e});v=a.success?`OK - TX delay set to ${e}`:`Error: ${a.error||"Failed"}`,x=a.success?"success":"error"}}else if(h.startsWith("set direct.txdelay ")){const e=parseFloat(h.split(" ")[2]);if(isNaN(e)||e<0||e>5)v="Error: Direct TX delay must be 0.0-5.0",x="error";else{const a=await o({direct_tx_delay_factor:e});v=a.success?`OK - Direct TX delay set to ${e}`:`Error: ${a.error||"Failed"}`,x=a.success?"success":"error"}}else if(h.startsWith("set log ")){const e=null==(u=h.split(" ")[2])?void 0:u.toUpperCase();if(["DEBUG","INFO","WARNING","ERROR"].includes(e)){const a=await i(e);v=a.success?`OK - Log level set to ${e}`:`Error: ${a.error||"Failed"}`,x=a.success?"success":"error"}else v="Error: Level must be debug, info, warning, or error",x="error"}else if(h.startsWith("set rxdelay ")){const e=parseFloat(h.split(" ")[2]);if(isNaN(e)||e<0)v="Error: RX delay must be >= 0",x="error";else{const a=await o({rx_delay_base:e});v=a.success?`OK - RX delay base set to ${e}s`:`Error: ${a.error||"Failed"}`,x=a.success?"success":"error"}}else if(h.startsWith("set name ")){const e=g.substring(9).trim();if(e){const a=await o({node_name:e});v=a.success?`OK - Node name set to "${e}"`:`Error: ${a.error||"Failed"}`,x=a.success?"success":"error"}else v="Error: Node name cannot be empty",x="error"}else if(h.startsWith("set lat ")){const e=parseFloat(h.split(" ")[2]);if(isNaN(e)||e<-90||e>90)v="Error: Latitude must be -90 to 90",x="error";else{const a=await o({latitude:e});v=a.success?`OK - Latitude set to ${e}°`:`Error: ${a.error||"Failed"}`,x=a.success?"success":"error"}}else if(h.startsWith("set lon ")){const e=parseFloat(h.split(" ")[2]);if(isNaN(e)||e<-180||e>180)v="Error: Longitude must be -180 to 180",x="error";else{const a=await o({longitude:e});v=a.success?`OK - Longitude set to ${e}°`:`Error: ${a.error||"Failed"}`,x=a.success?"success":"error"}}else if(h.startsWith("set flood.max ")){const e=parseInt(h.split(" ")[2]);if(isNaN(e)||e<0||e>64)v="Error: Max flood hops must be 0-64",x="error";else{const a=await o({max_flood_hops:e});v=a.success?`OK - Max flood hops set to ${e}`:`Error: ${a.error||"Failed"}`,x=a.success?"success":"error"}}else if(h.startsWith("set flood.advert.interval ")){const e=parseInt(h.split(" ")[2]);if(isNaN(e)||0!==e&&(e<3||e>48))v="Error: Flood advert interval must be 0 (off) or 3-48 hours",x="error";else{const a=await o({flood_advert_interval_hours:e});v=a.success?0===e?"OK - Flood adverts disabled":`OK - Flood advert interval set to ${e}h`:`Error: ${a.error||"Failed"}`,x=a.success?"success":"error"}}else if(h.startsWith("set advert.interval ")){const e=parseInt(h.split(" ")[2]);if(isNaN(e)||0!==e&&(e<1||e>10080))v="Error: Advert interval must be 0 (off) or 1-10080 minutes",x="error";else{const a=await o({advert_interval_minutes:e});v=a.success?0===e?"OK - Local adverts disabled":`OK - Local advert interval set to ${e}m`:`Error: ${a.error||"Failed"}`,x=a.success?"success":"error"}}else v=`Unknown command: ${g}\nType 'help' for available commands.`,x="error";P(f,{content:v,outputType:x})}catch(x){P(f,{content:`Error: ${x instanceof Error?x.message:"Command failed"}`,outputType:"error"})}},[O,k,P,S]),B=m.useCallback(e=>{var a,t,r,s,n,o;if(G&&C.length>0){if("ArrowDown"===e.key){e.preventDefault();const s=Math.min(D+1,C.length-1);return W(s),void(null==(r=null==(t=null==(a=M.current)?void 0:a.children[0])?void 0:t.children[s])||r.scrollIntoView({block:"nearest"}))}if("ArrowUp"===e.key){e.preventDefault();const a=Math.max(D-1,0);return W(a),void(null==(o=null==(n=null==(s=M.current)?void 0:s.children[0])?void 0:n.children[a])||o.scrollIntoView({block:"nearest"}))}if("Tab"===e.key)return e.preventDefault(),void X(D);if("Escape"===e.key)return e.preventDefault(),void T(!1)}if("Enter"===e.key){e.preventDefault();const a=_;return N(""),j(-1),T(!1),void U(a)}if("ArrowUp"!==e.key||G)if("ArrowDown"!==e.key||G);else if(e.preventDefault(),E>0){const e=E-1;j(e),N(f[f.length-1-e]||"")}else 0===E&&(j(-1),N(""));else if(e.preventDefault(),f.length>0&&E<f.length-1){const e=E+1;j(e),N(f[f.length-1-e]||"")}},[G,C,D,X,_,f,E,U]),V=m.useCallback(e=>{N(e.target.value),A(e.target.selectionStart||e.target.value.length),z(e.target.value)},[z]),J=m.useCallback(e=>{const a=e.target;A(a.selectionStart||0)},[]);return l.jsxs(p,{children:[l.jsx(y,{title:"Terminal",icon:l.jsx(c,{})}),l.jsxs(u,{noPadding:!0,className:"terminal-card overflow-hidden flex flex-col isolate",onClick:q,children:[l.jsx("div",{ref:K,className:"flex-1 overflow-y-auto font-mono text-sm bg-black/40 p-3 sm:p-4 md:p-5",children:h.map(e=>l.jsx(w,{entry:e},e.id))}),l.jsxs("div",{className:"relative border-t border-white/10 bg-black/50",children:[l.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 px-3 sm:px-4 py-2 sm:py-3",children:[l.jsx("span",{className:"text-text-muted font-mono font-bold select-none",children:"$"}),l.jsxs("div",{className:"flex-1 relative font-mono text-sm",children:[l.jsx("input",{ref:H,type:"text",value:_,onChange:V,onKeyDown:B,onSelect:J,onFocus:()=>R(!0),onBlur:()=>R(!1),disabled:!b,className:"absolute inset-0 w-full bg-transparent text-transparent outline-none disabled:opacity-50 selection:bg-transparent",style:{caretColor:"transparent"},autoFocus:!0,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1}),l.jsx("div",{className:"relative pointer-events-none select-none","aria-hidden":!0,children:b?l.jsxs(l.Fragment,{children:[l.jsx("span",{className:"text-text-primary",children:_.slice(0,L)}),l.jsx("span",{className:d("inline-block w-[0.6em] h-[1.2em] align-text-bottom",I?"bg-accent-primary":"bg-text-muted/30"),style:{marginBottom:"-0.1em"},children:l.jsx("span",{className:"text-bg-primary",children:_[L]||""})}),l.jsx("span",{className:"text-text-primary",children:_.slice(L+1)})]}):l.jsx("span",{className:"text-text-muted",children:"Connecting..."})})]})]}),l.jsxs("div",{className:"px-3 sm:px-4 py-1 border-t border-white/5 bg-black/30 flex justify-between text-[10px] text-text-muted",children:[l.jsx("span",{className:"hidden sm:inline",children:"↑↓ History"}),l.jsx("span",{className:"sm:hidden",children:"Terminal"}),(null==e?void 0:e.version)&&l.jsxs("span",{children:["pyMC v",e.version]})]})]}),G&&C.length>0&&l.jsxs("div",{ref:M,className:"absolute left-2 right-2 bottom-[72px] rounded-xl shadow-2xl overflow-hidden z-50 border border-white/20 bg-black/80 backdrop-blur-xl",children:[l.jsx("div",{className:"max-h-64 overflow-y-auto",children:C.map((e,a)=>l.jsxs("div",{onClick:()=>X(a),className:d("px-4 py-2.5 cursor-pointer border-b border-white/10 last:border-b-0 transition-colors",a===D?"bg-accent-primary/25":"hover:bg-white/10"),children:[l.jsx("span",{className:d("font-mono text-sm",a===D?"text-accent-primary":"text-text-primary"),children:e.cmd}),l.jsx("span",{className:"text-xs text-text-muted ml-4",children:e.desc})]},e.cmd))}),l.jsx("div",{className:"px-3 py-1.5 border-t border-white/10 text-[10px] text-text-muted text-right bg-white/5",children:"Tab to select"})]})]})]})}export{O as default};
