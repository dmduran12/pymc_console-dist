import{c as e,r as a,j as t,S as r}from"./vendor-react-0D__tamq.js";import{c as s}from"./recharts-BovJNxPc.js";import{c as n,ag as i,ah as o,ai as l,aj as c,ak as m,ae as d}from"./index-By5qf1JJ.js";import{a as p}from"./ping-26IZNF6r.js";import{P as y,b as u,a as g}from"./PageLayout-lVaYU4M5.js";import"./vendor-core-WoOfkQwm.js";import"./deckgl-DTsmDcfs.js";const h=e(e=>({entries:[],commandHistory:[],isInitialized:!1,addEntry:a=>{const t="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const a=16*Math.random()|0;return("x"===e?a:3&a|8).toString(16)}),r={...a,id:t,timestamp:Date.now()};return e(e=>({entries:[...e.entries,r]})),t},updateEntry:(a,t)=>{e(e=>({entries:e.entries.map(e=>e.id===a?{...e,...t}:e)}))},addCommand:a=>{e(e=>({commandHistory:[...e.commandHistory,a]}))},clearEntries:()=>{e({entries:[],commandHistory:[]})},setInitialized:a=>{e({isInitialized:a})}})),f=new Set(["start ota","erase","reboot"]),v=["gps","sensor"],x=[{cmd:"help",desc:"Show available commands"},{cmd:"clear",desc:"Clear terminal screen"},{cmd:"status",desc:"Get repeater status summary"},{cmd:"uptime",desc:"Show system uptime"},{cmd:"packets",desc:"Show packet statistics"},{cmd:"board",desc:"Show board/platform info"},{cmd:"ping",desc:"Ping neighbor (name or 0xXX)",params:"{target} [timeout]",required:!0},...[{name:"get adc.multiplier",category:"get",params:[],description:"Get ADC multiplier for battery",serialOnly:!1,hasParam:!1},{name:"get advert.interval",category:"get",params:[],description:"Get local advert interval (minutes)",serialOnly:!1,hasParam:!1},{name:"get af",category:"get",params:[],description:"Get airtime factor",serialOnly:!1,hasParam:!1},{name:"get agc.reset.interval",category:"get",params:[],description:"Get AGC reset interval (seconds)",serialOnly:!1,hasParam:!1},{name:"get allow.read.only",category:"get",params:[],description:"Get read-only access setting",serialOnly:!1,hasParam:!1},{name:"get bridge.baud",category:"get",params:[],description:"Get bridge baud rate",serialOnly:!1,hasParam:!1},{name:"get bridge.channel",category:"get",params:[],description:"Get bridge channel (ESP-NOW)",serialOnly:!1,hasParam:!1},{name:"get bridge.delay",category:"get",params:[],description:"Get bridge delay (ms)",serialOnly:!1,hasParam:!1},{name:"get bridge.enabled",category:"get",params:[],description:"Get bridge enabled status",serialOnly:!1,hasParam:!1},{name:"get bridge.secret",category:"get",params:[],description:"Get bridge encryption secret",serialOnly:!1,hasParam:!1},{name:"get bridge.source",category:"get",params:[],description:"Get bridge packet source",serialOnly:!1,hasParam:!1},{name:"get bridge.type",category:"get",params:[],description:"Get bridge type (rs232/espnow/none)",serialOnly:!1,hasParam:!1},{name:"get direct.txdelay",category:"get",params:[],description:"Get direct TX delay factor",serialOnly:!1,hasParam:!1},{name:"get flood.advert.interval",category:"get",params:[],description:"Get flood advert interval (hours)",serialOnly:!1,hasParam:!1},{name:"get flood.max",category:"get",params:[],description:"Get max flood hops",serialOnly:!1,hasParam:!1},{name:"get freq",category:"get",params:[],description:"Get frequency (MHz)",serialOnly:!1,hasParam:!1},{name:"get guest.password",category:"get",params:[],description:"Get guest password",serialOnly:!1,hasParam:!1},{name:"get int.thresh",category:"get",params:[],description:"Get interference threshold",serialOnly:!1,hasParam:!1},{name:"get lat",category:"get",params:[],description:"Get latitude",serialOnly:!1,hasParam:!1},{name:"get lon",category:"get",params:[],description:"Get longitude",serialOnly:!1,hasParam:!1},{name:"get multi.acks",category:"get",params:[],description:"Get multi-ack setting",serialOnly:!1,hasParam:!1},{name:"get name",category:"get",params:[],description:"Get node name",serialOnly:!1,hasParam:!1},{name:"get prv.key",category:"get",params:[],description:"Get private key (hex)",serialOnly:!1,hasParam:!1},{name:"get public.key",category:"get",params:[],description:"Get public key (hex)",serialOnly:!1,hasParam:!1},{name:"get radio",category:"get",params:[],description:"Get radio params (freq,bw,sf,cr)",serialOnly:!1,hasParam:!1},{name:"get repeat",category:"get",params:[],description:"Get repeat/forward status (on/off)",serialOnly:!1,hasParam:!1},{name:"get role",category:"get",params:[],description:"Get device role",serialOnly:!1,hasParam:!1},{name:"get rxdelay",category:"get",params:[],description:"Get RX delay base",serialOnly:!1,hasParam:!1},{name:"get tx",category:"get",params:[],description:"Get TX power (dBm)",serialOnly:!1,hasParam:!1},{name:"get txdelay",category:"get",params:[],description:"Get TX delay factor",serialOnly:!1,hasParam:!1},{name:"gps",category:"gps",params:[],description:"Show GPS status",serialOnly:!1,hasParam:!1},{name:"gps advert",category:"gps",params:[],description:"Get/set GPS advert location policy",serialOnly:!1,hasParam:!0},{name:"gps off",category:"gps",params:[],description:"Disable GPS",serialOnly:!1,hasParam:!0},{name:"gps on",category:"gps",params:[],description:"Enable GPS",serialOnly:!1,hasParam:!0},{name:"gps setloc",category:"gps",params:[],description:"Set node location from GPS",serialOnly:!1,hasParam:!0},{name:"gps sync",category:"gps",params:[],description:"Sync time from GPS",serialOnly:!1,hasParam:!0},{name:"log",category:"logging",params:[],description:"Dump log file (serial only)",serialOnly:!0,hasParam:!1},{name:"log erase",category:"logging",params:[],description:"Erase log file",serialOnly:!1,hasParam:!0},{name:"log start",category:"logging",params:[],description:"Start packet logging",serialOnly:!1,hasParam:!0},{name:"log stop",category:"logging",params:[],description:"Stop packet logging",serialOnly:!1,hasParam:!0},{name:"neighbor.remove",category:"neighbor",params:[],description:"Remove neighbor by pubkey",serialOnly:!1,hasParam:!0},{name:"neighbors",category:"neighbor",params:[],description:"List neighbors",serialOnly:!1,hasParam:!1},{name:"get",category:"other",params:[],description:"Execute get command",serialOnly:!1,hasParam:!0},{name:"set",category:"other",params:[{name:"value",type:"float"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Execute set command",serialOnly:!1,hasParam:!0},{name:"tempradio",category:"radio",params:[{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Apply temporary radio params (freq bw sf cr timeout_mins)",serialOnly:!1,hasParam:!0},{name:"sensor get",category:"sensor",params:[],description:"Get sensor/custom variable value",serialOnly:!1,hasParam:!0},{name:"sensor list",category:"sensor",params:[{name:"value",type:"int"}],description:"List all sensor/custom variables",serialOnly:!1,hasParam:!0},{name:"sensor set",category:"sensor",params:[],description:"Set sensor/custom variable value",serialOnly:!1,hasParam:!0},{name:"set adc.multiplier",category:"set",params:[{name:"value",type:"float"}],description:"Set ADC multiplier",serialOnly:!1,hasParam:!0},{name:"set advert.interval",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"string"}],description:"Set local advert interval (1-10080 min, 0=off)",serialOnly:!1,hasParam:!0},{name:"set af",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set airtime factor (0-9)",serialOnly:!1,hasParam:!0},{name:"set agc.reset.interval",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set AGC reset interval (seconds, rounded to 4)",serialOnly:!1,hasParam:!0},{name:"set allow.read.only",category:"set",params:[{name:"value",type:"int"}],description:"Set read-only access (on/off)",serialOnly:!1,hasParam:!0},{name:"set bridge.baud",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set bridge baud (9600-115200)",serialOnly:!1,hasParam:!0},{name:"set bridge.channel",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"string"}],description:"Set bridge channel (1-14)",serialOnly:!1,hasParam:!0},{name:"set bridge.delay",category:"set",params:[{name:"value",type:"int"}],description:"Set bridge delay (0-10000 ms)",serialOnly:!1,hasParam:!0},{name:"set bridge.enabled",category:"set",params:[{name:"value",type:"int"}],description:"Enable/disable bridge",serialOnly:!1,hasParam:!0},{name:"set bridge.secret",category:"set",params:[{name:"value",type:"string"},{name:"value",type:"float"}],description:"Set bridge encryption secret",serialOnly:!1,hasParam:!0},{name:"set bridge.source",category:"set",params:[{name:"value",type:"int"}],description:"Set bridge source (rx/tx)",serialOnly:!1,hasParam:!0},{name:"set direct.txdelay",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"}],description:"Set direct TX delay factor",serialOnly:!1,hasParam:!0},{name:"set flood.advert.interval",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set flood advert interval (3-48 hours, 0=off)",serialOnly:!1,hasParam:!0},{name:"set flood.max",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"float"}],description:"Set max flood hops (0-64)",serialOnly:!1,hasParam:!0},{name:"set freq",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"}],description:"Set frequency MHz (serial only, reboot required)",serialOnly:!0,hasParam:!0},{name:"set guest.password",category:"set",params:[{name:"value",type:"string"}],description:"Set guest password",serialOnly:!1,hasParam:!0},{name:"set int.thresh",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set interference threshold",serialOnly:!1,hasParam:!0},{name:"set lat",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"float"},{name:"value",type:"float"}],description:"Set latitude",serialOnly:!1,hasParam:!0},{name:"set lon",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"float"},{name:"value",type:"float"}],description:"Set longitude",serialOnly:!1,hasParam:!0},{name:"set multi.acks",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set multi-ack (0/1)",serialOnly:!1,hasParam:!0},{name:"set name",category:"set",params:[{name:"value",type:"string"},{name:"value",type:"int"}],description:"Set node name",serialOnly:!1,hasParam:!0},{name:"set prv.key",category:"set",params:[{name:"value",type:"string"}],description:"Set private key (hex, restart required)",serialOnly:!1,hasParam:!0},{name:"set radio",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set radio params (freq bw sf cr)",serialOnly:!1,hasParam:!0},{name:"set repeat",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"int"}],description:"Set repeat/forward (on/off)",serialOnly:!1,hasParam:!0},{name:"set rxdelay",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"float"}],description:"Set RX delay base",serialOnly:!1,hasParam:!0},{name:"set tx",category:"set",params:[{name:"value",type:"int"},{name:"value",type:"float"}],description:"Set TX power (dBm)",serialOnly:!1,hasParam:!0},{name:"set txdelay",category:"set",params:[{name:"value",type:"float"},{name:"value",type:"int"}],description:"Set TX delay factor",serialOnly:!1,hasParam:!0},{name:"stats-core",category:"stats",params:[],description:"Show core statistics (serial only)",serialOnly:!0,hasParam:!1},{name:"stats-packets",category:"stats",params:[],description:"Show packet statistics (serial only)",serialOnly:!0,hasParam:!1},{name:"stats-radio",category:"stats",params:[],description:"Show radio statistics (serial only)",serialOnly:!0,hasParam:!1},{name:"advert",category:"system",params:[],description:"Send self advertisement",serialOnly:!1,hasParam:!1},{name:"board",category:"system",params:[],description:"Show board/manufacturer name",serialOnly:!1,hasParam:!1},{name:"clear stats",category:"system",params:[],description:"Reset statistics counters",serialOnly:!1,hasParam:!0},{name:"clock",category:"system",params:[{name:"value",type:"int"}],description:"Display current time",serialOnly:!1,hasParam:!0},{name:"clock sync",category:"system",params:[],description:"Sync clock from sender timestamp",serialOnly:!1,hasParam:!0},{name:"password",category:"system",params:[{name:"value",type:"string"}],description:"Change admin password",serialOnly:!1,hasParam:!0},{name:"reboot",category:"system",params:[],description:"Reboot the device",serialOnly:!1,hasParam:!1},{name:"start ota",category:"system",params:[{name:"value",type:"int"}],description:"Start OTA firmware update",serialOnly:!1,hasParam:!0},{name:"time",category:"system",params:[{name:"value",type:"int"}],description:"Set time to epoch seconds",serialOnly:!1,hasParam:!0},{name:"ver",category:"system",params:[],description:"Show firmware version and build date",serialOnly:!1,hasParam:!1}].filter(e=>!e.serialOnly&&!f.has(e.name)&&!v.some(a=>e.name.startsWith(a))).map(e=>({cmd:e.name,desc:e.description,params:e.hasParam?"{value}":void 0,required:e.hasParam}))],b={"set mode":["forward","monitor"],"set duty":["on","off"],"set repeat":["on","off"],"set tx":["10","14","17","20","22"],"set sf":["7","8","9","10","11","12"],"set bw":["125","250","500"],"set af":["0.5","1.0","1.5","2.0"],"set txdelay":["0.5","0.7","1.0","1.5"],"set direct.txdelay":["0.3","0.5","0.7"],"set log":["debug","info","warning"]};function w(e){switch(e){case"success":return"text-accent-success";case"error":return"text-accent-danger";case"warning":return"text-amber-400";case"info":return"text-accent-tertiary";case"value":return"text-accent-primary";case"system":return"text-text-muted";default:return"text-text-secondary"}}const O=a.memo(function({entry:e}){return"command"===e.type?t.jsxs("div",{className:"flex items-center gap-2 py-1",children:[t.jsx("span",{className:"text-text-muted font-medium select-none",children:"$"}),t.jsx("span",{className:"text-text-primary font-semibold",children:e.content})]}):"system"===e.type?t.jsx("div",{className:s("py-0.5",w(e.outputType||"system")),children:e.content}):e.content.includes("██")?t.jsx("pre",{className:s("terminal-ascii font-mono leading-none py-2 whitespace-pre",w(e.outputType||"value")),children:e.content}):t.jsx("div",{className:"ml-4 font-mono text-[13px] py-1",children:e.content.split("\n").map((a,r)=>{const s=function(e,a){if(e.startsWith("HELP_HEADER:::"))return[{text:e.slice(14),color:"text-text-primary font-bold"}];if(e.startsWith("HELP_NOTE:::"))return[{text:e.slice(12),color:"text-text-muted italic"}];const t=e.match(/^([a-z][a-z0-9.]*(?:\s+[a-z][a-z0-9.]*)?):::(.+)$/);if(t){const[,e,a]=t,r=e.split(" "),s=r[0];let n="text-accent-tertiary";"get"===s?n="text-accent-success":"set"===s&&(n="text-amber-400");const i=[{text:`  ${s}`,color:`${n} font-semibold`}];r.length>1&&i.push({text:` ${r.slice(1).join(" ")}`,color:"text-accent-primary"});const o=" ".repeat(Math.max(1,22-e.length));return i.push({text:`${o}${a}`,color:"text-text-muted"}),i}if("error"===a||"warning"===a)return[{text:e,color:w(a)}];if("value"===a)return[{text:e,color:w("value")}];const r=e.match(/^([\w\s.]+):\s*(.+)$/);if(r){const[,e,a]=r;return[{text:`${e}: `,color:"text-text-muted"},{text:a,color:"text-accent-primary font-semibold"}]}return e.startsWith("OK")?[{text:e,color:w("success")}]:[{text:e,color:w(a)}]}(a,e.outputType||"default");return t.jsx("div",{className:"leading-relaxed",children:s.map((e,a)=>t.jsx("span",{className:e.color,children:e.text},a))},r)})})});function P(){const e=n(),f=h(e=>e.entries),v=h(e=>e.commandHistory),w=h(e=>e.isInitialized),{addEntry:P,updateEntry:k,addCommand:S,clearEntries:$,setInitialized:_}=h(),[N,E]=a.useState(""),[j,G]=a.useState(-1),[T,C]=a.useState(!1),[F,I]=a.useState([]),[W,D]=a.useState(0),[L,R]=a.useState(0),[q,M]=a.useState(!1),X=a.useRef(null),A=a.useRef(null),H=a.useRef(null);a.useEffect(()=>{w||(async()=>{P({type:"output",content:"██████  ██    ██ ███    ███  ██████\n██   ██  ██  ██  ████  ████ ██     \n██████    ████   ██ ████ ██ ██     \n██         ██    ██  ██  ██ ██     \n██         ██    ██      ██  ██████",outputType:"value"}),await new Promise(e=>setTimeout(e,200));const e=P({type:"system",content:"● Initializing terminal...",outputType:"system"});await new Promise(e=>setTimeout(e,400)),k(e,{content:"✓ Initializing terminal...",outputType:"success"});const a=P({type:"system",content:"● Connecting to repeater...",outputType:"system"});await new Promise(e=>setTimeout(e,600)),k(a,{content:"✓ Connected to repeater",outputType:"success"}),P({type:"system",content:"Ready. Type 'help' for commands.",outputType:"system"}),_(!0)})()},[w,P,k,_]),a.useEffect(()=>{A.current&&(A.current.scrollTop=A.current.scrollHeight)},[f]);const K=a.useCallback(()=>{var e;null==(e=X.current)||e.focus()},[]),z=a.useMemo(()=>(null==e?void 0:e.neighbors)?Object.values(e.neighbors).map(e=>e.node_name||e.name).filter(e=>!!e).sort():[],[null==e?void 0:e.neighbors]),U=a.useCallback(e=>{const a=e.trim().toLowerCase();if(!a)return C(!1),void I([]);const t=x.filter(e=>e.cmd.toLowerCase().startsWith(a));if(t.length>0)return I(t),D(0),void C(!0);if(a.includes(" ")){const e=a.lastIndexOf(" "),t=a.substring(0,e),r=a.substring(e+1);if("ping"===t&&z.length>0){const e=z.filter(e=>e.toLowerCase().startsWith(r)).slice(0,10).map(e=>({cmd:`ping ${e}`,desc:`→ ${e}`}));if(e.length>0)return I(e),D(0),void C(!0)}const s=x.find(e=>e.cmd.toLowerCase()===t);if(s&&b[s.cmd]){const e=b[s.cmd].filter(e=>e.toLowerCase().startsWith(r)).map(e=>({cmd:`${s.cmd} ${e}`,desc:`→ ${e}`}));if(e.length>0)return I(e),D(0),void C(!0)}}C(!1),I([])},[z]),B=a.useCallback(e=>{var a;const t=F[e];t&&(t.required&&t.params?(E(t.cmd+" "),U(t.cmd+" ")):(E(t.cmd),C(!1)),null==(a=X.current)||a.focus())},[F,U]),V=a.useCallback(async e=>{var a,t,r,s,n,y,u,g,h;const f=e.trim();if(!f)return;const v=f.toLowerCase();if(S(f),P({type:"command",content:f}),"clear"===v)return void $();if("help"===v){const e=x.map(e=>`${e.cmd}:::${e.desc}`).join("\n");return void P({type:"output",content:`HELP_HEADER:::Available commands\n${e}\nHELP_NOTE:::Some MeshCore commands not available via HTTP.`,outputType:"default"})}const b=P({type:"output",content:"processing...",outputType:"system"});try{const e=await i();let x="",O="info";const P=e=>{const a=Math.floor(e/86400),t=Math.floor(e%86400/3600),r=Math.floor(e%3600/60);return a>0?`${a}d ${t}h ${r}m`:t>0?`${t}h ${r}m`:`${r}m`};if("status"===v){x=`Mode: ${(null==(t=null==(a=e.config)?void 0:a.repeater)?void 0:t.mode)||"unknown"} | Neighbors: ${Object.keys(e.neighbors||{}).length} | Uptime: ${P(e.uptime_seconds||0)}`}else if("uptime"===v)x=P(e.uptime_seconds||0),O="value";else if("packets"===v)x=`rx: ${e.rx_count??0}\ntx: ${e.tx_count??0}\nfwd: ${e.forwarded_count??0}\ndrop: ${e.dropped_count??0}`;else if("neighbors"===v){const a=e.neighbors||{},t=Object.entries(a);if(0===t.length)x="No neighbors discovered yet.",O="warning";else{const e=t.map(([e,a])=>{const t=a.name||a.node_name||"Unknown";return`  ${e.slice(0,8)}  ${t}`});x=`Neighbors (${t.length}):\n${e.join("\n")}`}}else if("board"===v)x="pyMC_Repeater (Linux/RPi)",O="value";else if(v.startsWith("get ")){const a=v.slice(4).trim(),t=null==(r=e.config)?void 0:r.delays,i=null==(s=e.config)?void 0:s.radio,o=null==(n=e.config)?void 0:n.repeater,l=null==(y=e.config)?void 0:y.duty_cycle;switch(a){case"name":x=(null==(u=e.config)?void 0:u.node_name)||"Unknown";break;case"role":x="repeater";break;case"lat":x=null!=(null==o?void 0:o.latitude)?String(o.latitude):"not set";break;case"lon":x=null!=(null==o?void 0:o.longitude)?String(o.longitude):"not set";break;case"freq":x=(null==i?void 0:i.frequency)?(i.frequency/1e6).toFixed(3):"?";break;case"tx":x=String((null==i?void 0:i.tx_power)??"?");break;case"bw":x=(null==i?void 0:i.bandwidth)?String(i.bandwidth/1e3):"?";break;case"sf":x=String((null==i?void 0:i.spreading_factor)??"?");break;case"cr":x=String((null==i?void 0:i.coding_rate)??"?");break;case"radio":x=i?`freq: ${(i.frequency/1e6).toFixed(3)} MHz\nbw: ${i.bandwidth/1e3} kHz\nsf: ${i.spreading_factor}\ncr: 4/${i.coding_rate}`:"?";break;case"af":case"txdelay":x=String((null==t?void 0:t.tx_delay_factor)??"1.0");break;case"direct.txdelay":x=String((null==t?void 0:t.direct_tx_delay_factor)??"0.5");break;case"mode":x=(null==o?void 0:o.mode)||"forward";break;case"repeat":x="forward"===(null==o?void 0:o.mode)?"on":"off";break;case"flood.max":x=String((null==o?void 0:o.max_flood_hops)??"3");break;case"flood.advert.interval":x=null!=(null==o?void 0:o.send_advert_interval_hours)?`${o.send_advert_interval_hours}h`:"?";break;case"advert.interval":x=null!=(null==o?void 0:o.advert_interval_minutes)?`${o.advert_interval_minutes}m`:"120m";break;case"rxdelay":x=String((null==t?void 0:t.rx_delay_base)??"0.0");break;case"duty":case"duty.enabled":x=(null==l?void 0:l.enforcement_enabled)?"on":"off";break;case"duty.max":x=null!=(null==l?void 0:l.max_airtime_percent)?`${l.max_airtime_percent}%`:"?";break;case"public.key":x=e.public_key||"not available";break;case"prv.key":x="Private keys not available via CLI.\nUse /api/identities endpoint or config.yaml",O="warning";break;case"guest.password":case"allow.read.only":x="Security settings not exposed via stats API.\nCheck /etc/pymc_repeater/config.yaml",O="warning";break;default:x=`Unknown parameter: ${a}\nAvailable: name, role, lat, lon, freq, tx, bw, sf, cr, radio, af, txdelay, direct.txdelay, rxdelay, mode, repeat, flood.max, advert.interval, duty, public.key`,O="error"}"error"!==O&&(O="value")}else if("advert"===v){const e=await o();x=e.success?"OK - Advert sent":`Error: ${e.error||"Failed"}`,O=e.success?"success":"error"}else if(v.startsWith("set mode ")){const e=v.split(" ")[2];if("forward"!==e&&"monitor"!==e)x='Error: Mode must be "forward" or "monitor"',O="error";else{const a=await l(e);x=a.success?`OK - Mode set to ${e}`:"Error: Failed",O=a.success?"success":"error"}}else if(v.startsWith("set duty ")){const e=v.split(" ")[2],a="on"===e||"1"===e,t=await c(a);x=t.success?"OK - Duty cycle "+(a?"enabled":"disabled"):"Error: Failed",O=t.success?"success":"error"}else if(v.startsWith("set tx ")){const e=parseInt(v.split(" ")[2]);if(isNaN(e)||e<2||e>22)x="Error: TX power must be 2-22 dBm (SX1262 chip max)",O="error";else{const a=await m({tx_power:e});x=a.success?`OK - TX power set to ${e}dBm`:`Error: ${a.error||"Failed"}`,O=a.success?"success":"error"}}else if(v.startsWith("set af ")||v.startsWith("set txdelay ")){const e=parseFloat(v.split(" ")[2]);if(isNaN(e)||e<0||e>5)x="Error: TX delay factor must be 0.0-5.0",O="error";else{const a=await m({tx_delay_factor:e});x=a.success?`OK - TX delay set to ${e}`:`Error: ${a.error||"Failed"}`,O=a.success?"success":"error"}}else if(v.startsWith("set direct.txdelay ")){const e=parseFloat(v.split(" ")[2]);if(isNaN(e)||e<0||e>5)x="Error: Direct TX delay must be 0.0-5.0",O="error";else{const a=await m({direct_tx_delay_factor:e});x=a.success?`OK - Direct TX delay set to ${e}`:`Error: ${a.error||"Failed"}`,O=a.success?"success":"error"}}else if(v.startsWith("set log ")){const e=null==(g=v.split(" ")[2])?void 0:g.toUpperCase();if(["DEBUG","INFO","WARNING","ERROR"].includes(e)){const a=await d(e);x=a.success?`OK - Log level set to ${e}`:`Error: ${a.error||"Failed"}`,O=a.success?"success":"error"}else x="Error: Level must be debug, info, warning, or error",O="error"}else if(v.startsWith("set rxdelay ")){const e=parseFloat(v.split(" ")[2]);if(isNaN(e)||e<0)x="Error: RX delay must be >= 0",O="error";else{const a=await m({rx_delay_base:e});x=a.success?`OK - RX delay base set to ${e}s`:`Error: ${a.error||"Failed"}`,O=a.success?"success":"error"}}else if(v.startsWith("set name ")){const e=f.substring(9).trim();if(e){const a=await m({node_name:e});x=a.success?`OK - Node name set to "${e}"`:`Error: ${a.error||"Failed"}`,O=a.success?"success":"error"}else x="Error: Node name cannot be empty",O="error"}else if(v.startsWith("set lat ")){const e=parseFloat(v.split(" ")[2]);if(isNaN(e)||e<-90||e>90)x="Error: Latitude must be -90 to 90",O="error";else{const a=await m({latitude:e});x=a.success?`OK - Latitude set to ${e}°`:`Error: ${a.error||"Failed"}`,O=a.success?"success":"error"}}else if(v.startsWith("set lon ")){const e=parseFloat(v.split(" ")[2]);if(isNaN(e)||e<-180||e>180)x="Error: Longitude must be -180 to 180",O="error";else{const a=await m({longitude:e});x=a.success?`OK - Longitude set to ${e}°`:`Error: ${a.error||"Failed"}`,O=a.success?"success":"error"}}else if(v.startsWith("set flood.max ")){const e=parseInt(v.split(" ")[2]);if(isNaN(e)||e<0||e>64)x="Error: Max flood hops must be 0-64",O="error";else{const a=await m({max_flood_hops:e});x=a.success?`OK - Max flood hops set to ${e}`:`Error: ${a.error||"Failed"}`,O=a.success?"success":"error"}}else if(v.startsWith("set flood.advert.interval ")){const e=parseInt(v.split(" ")[2]);if(isNaN(e)||0!==e&&(e<3||e>48))x="Error: Flood advert interval must be 0 (off) or 3-48 hours",O="error";else{const a=await m({flood_advert_interval_hours:e});x=a.success?0===e?"OK - Flood adverts disabled":`OK - Flood advert interval set to ${e}h`:`Error: ${a.error||"Failed"}`,O=a.success?"success":"error"}}else if(v.startsWith("set advert.interval ")){const e=parseInt(v.split(" ")[2]);if(isNaN(e)||0!==e&&(e<1||e>10080))x="Error: Advert interval must be 0 (off) or 1-10080 minutes",O="error";else{const a=await m({advert_interval_minutes:e});x=a.success?0===e?"OK - Local adverts disabled":`OK - Local advert interval set to ${e}m`:`Error: ${a.error||"Failed"}`,O=a.success?"success":"error"}}else if(v.startsWith("ping ")){const e=f.substring(5).trim(),a=e.split(/\s+/),t=a[a.length-1],r=parseInt(t),s=a.length>1&&!isNaN(r)&&r>0,n=s?a.slice(0,-1).join(" "):e,i=s?r:30;if(n){let e=1;const a=setInterval(()=>{e=e%3+1,k(b,{content:`Pinging ${n}${".".repeat(e)}`,outputType:"system"})},800);try{const e=await p(n,i);if(clearInterval(a),e.success&&e.data){const a=e.data,t=(null==(h=a.path)?void 0:h.length)?a.path.join(" → "):"direct";x=`Reply from ${a.target_id}\n  RTT: ${a.rtt_ms.toFixed(1)}ms\n  RSSI: ${a.rssi}dBm\n  SNR: ${a.snr_db}dB\n  Path: ${t}\n  Quality: ${a.quality}`,O="success"}else x=e.error||"Ping failed",O="error"}catch(w){throw clearInterval(a),w}}else x="Usage: ping <node_name> [timeout]",O="error"}else x=`Unknown command: ${f}\nType 'help' for available commands.`,O="error";k(b,{content:x,outputType:O})}catch(O){k(b,{content:`Error: ${O instanceof Error?O.message:"Command failed"}`,outputType:"error"})}},[P,S,k,$]),Q=a.useCallback(e=>{var a,t,r,s,n,i;if(T&&F.length>0){if("ArrowDown"===e.key){e.preventDefault();const s=Math.min(W+1,F.length-1);return D(s),void(null==(r=null==(t=null==(a=H.current)?void 0:a.children[0])?void 0:t.children[s])||r.scrollIntoView({block:"nearest"}))}if("ArrowUp"===e.key){e.preventDefault();const a=Math.max(W-1,0);return D(a),void(null==(i=null==(n=null==(s=H.current)?void 0:s.children[0])?void 0:n.children[a])||i.scrollIntoView({block:"nearest"}))}if("Tab"===e.key)return e.preventDefault(),void B(W);if("Escape"===e.key)return e.preventDefault(),void C(!1)}if("Enter"===e.key){if(e.preventDefault(),T&&F.length>0){const e=F[W].cmd;return E(""),G(-1),C(!1),void V(e)}const a=N;return E(""),G(-1),C(!1),void V(a)}if("ArrowUp"!==e.key||T)if("ArrowDown"!==e.key||T);else if(e.preventDefault(),j>0){const e=j-1;G(e),E(v[v.length-1-e]||"")}else 0===j&&(G(-1),E(""));else if(e.preventDefault(),v.length>0&&j<v.length-1){const e=j+1;G(e),E(v[v.length-1-e]||"")}},[T,F,W,B,N,v,j,V]),J=a.useCallback(e=>{E(e.target.value),R(e.target.selectionStart||e.target.value.length),U(e.target.value)},[U]),Y=a.useCallback(e=>{const a=e.target;R(a.selectionStart||0)},[]);return t.jsxs(y,{children:[t.jsx(u,{title:"Terminal",icon:t.jsx(r,{})}),t.jsxs(g,{noPadding:!0,className:"terminal-card overflow-hidden flex flex-col isolate",onClick:K,children:[t.jsx("div",{ref:A,className:"flex-1 overflow-y-auto font-mono text-sm bg-black/40 p-3 sm:p-4 md:p-5",children:f.map(e=>t.jsx(O,{entry:e},e.id))}),t.jsxs("div",{className:"relative border-t border-white/10 bg-black/50",children:[t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 px-3 sm:px-4 py-2 sm:py-3",children:[t.jsx("span",{className:"text-text-muted font-mono font-bold select-none",children:"$"}),t.jsxs("div",{className:"flex-1 relative font-mono text-sm",children:[t.jsx("input",{ref:X,type:"text",value:N,onChange:J,onKeyDown:Q,onSelect:Y,onFocus:()=>M(!0),onBlur:()=>M(!1),disabled:!w,className:"absolute inset-0 w-full bg-transparent text-transparent outline-none disabled:opacity-50 selection:bg-transparent",style:{caretColor:"transparent"},autoFocus:!0,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1}),t.jsx("div",{className:"relative pointer-events-none select-none","aria-hidden":!0,children:w?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-text-primary",children:N.slice(0,L)}),t.jsx("span",{className:s("inline-block w-[0.6em] h-[1.2em] align-text-bottom",q?"bg-accent-primary":"bg-text-muted/30"),style:{marginBottom:"-0.1em"},children:t.jsx("span",{className:"text-bg-primary",children:N[L]||""})}),t.jsx("span",{className:"text-text-primary",children:N.slice(L+1)})]}):t.jsx("span",{className:"text-text-muted",children:"Connecting..."})})]})]}),t.jsxs("div",{className:"px-3 sm:px-4 py-1 border-t border-white/5 bg-black/30 flex justify-between text-[10px] text-text-muted",children:[t.jsx("span",{className:"hidden sm:inline",children:"↑↓ History"}),t.jsx("span",{className:"sm:hidden",children:"Terminal"}),(null==e?void 0:e.version)&&t.jsxs("span",{children:["pyMC v",e.version]})]})]}),T&&F.length>0&&t.jsxs("div",{ref:H,className:"absolute left-2 right-2 bottom-[72px] rounded-xl shadow-2xl overflow-hidden z-50 border border-white/20 bg-black/80 backdrop-blur-xl",children:[t.jsx("div",{className:"max-h-64 overflow-y-auto",children:F.map((e,a)=>t.jsxs("div",{onClick:()=>B(a),className:s("px-4 py-2.5 cursor-pointer border-b border-white/10 last:border-b-0 transition-colors",a===W?"bg-accent-primary/25":"hover:bg-white/10"),children:[t.jsx("span",{className:s("font-mono text-sm",a===W?"text-accent-primary":"text-text-primary"),children:e.cmd}),t.jsx("span",{className:"text-xs text-text-muted ml-4",children:e.desc})]},e.cmd))}),t.jsx("div",{className:"px-3 py-1.5 border-t border-white/10 text-[10px] text-text-muted text-right bg-white/5",children:"Tab to select"})]})]})]})}export{P as default};
