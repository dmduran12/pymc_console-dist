import{d as A,e as st,r as f,j as e,A as Re,m as Q,S as nt,M as at,U as ot,f as it,h as rt,k as lt,n as ct,o as H,p as ue,q as U,t as dt,v as mt,w as be,x as ut,L as ee,y as G,z as xt,D as ht,E as te,F as Be,T as ft,G as pt,B as je,R as Le,H as Fe,J as gt,K as X,N as P,O as yt,P as bt,Q as jt,V as Nt,W as vt,X as wt,Y as ne,u as xe,_ as kt,$ as Ne,a0 as ae,a1 as K,a2 as Mt,a3 as J,a4 as Ct,a5 as Tt,a6 as St,a7 as ve,a8 as _t,c as F,a9 as Dt,aa as Pe,ab as we,ac as Rt,ad as Bt,ae as Lt,af as Ft,ag as Pt,ah as At,ai as $t}from"./index-BwGHI0A_.js";import{C as ke,P as Et,a as Ht,B as It}from"./PageLayout-BIcqC04y.js";import{u as I,r as O,h as Ot,a as zt,b as Wt,i as qt}from"./consumer-registry-DPYvsBcc.js";import{A as V,E as Ut}from"./AnimatedNumber-BAXz0cmM.js";import{c as Vt}from"./node-types-DmTOZWT4.js";import{b as Ae,c as q,a as Gt,d as Xt,F as Z}from"./meshcore-tx-constants-DgpFTAmf.js";import{S as Yt,u as ce,P as Kt,T as Jt,C as $e,a as Zt}from"./PacketList-CnGGHFuk.js";import{useGetDecodedContent as Qt,useResolveSource as es}from"./usePipelineStore-11oXtutw.js";import{A as Me}from"./SignalIndicator-LNOR_5YF.js";import{T as Ee}from"./TimeRangeStepper-Dh4JEQ42.js";import{L as he}from"./LightSparkline-5OIe9Q0M.js";import{c as ts}from"./link-scoring-BSZA-fkH.js";import{Z as ss,H as ns}from"./useMapViewStore-CPURakCb.js";import{N as as}from"./NodeInformationCard-BLxCCOW5.js";import{g as os,e as oe,a as is,f as rs}from"./chat-utils-Di4-nywi.js";import{M as He,C as ls}from"./ChatBubble-Bxq40Qnq.js";import{C as Ce}from"./chevron-right-DqpRZiGf.js";import{H as cs}from"./hash-9uwO8S8N.js";import{R as ie,C as re}from"./Grid-BoZ-SJB7.js";import"./index-OH01SZkk.js";import"./primitives-Cgn8YJud.js";import"./payload-decoders-7zyi-Y-D.js";import"./badge-colors-BNUqIXCA.js";import"./arrow-up-DJuSVUZI.js";import"./map-pin-VRY_TOuh.js";import"./circle-question-mark-DC7QfrVK.js";import"./triangle-alert-B4kC1YDk.js";import"./DataBox-CQS-Zhu0.js";import"./layers-C8ICjJ-w.js";import"./activity-Dr_TPIps.js";import"./circle-check-CBI-CiRo.js";import"./database-CDN_R6oC.js";import"./shield-DOTPcYJ1.js";/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],ms=A("arrow-up-right",ds);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=[["path",{d:"M2 13a2 2 0 0 0 2-2V7a2 2 0 0 1 4 0v13a2 2 0 0 0 4 0V4a2 2 0 0 1 4 0v13a2 2 0 0 0 4 0v-4a2 2 0 0 1 2-2",key:"57tc96"}]],xs=A("audio-waveform",us);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],fs=A("chart-column",hs);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["path",{d:"M6 8.5a6.5 6.5 0 1 1 13 0c0 6-6 6-6 10a3.5 3.5 0 1 1-7 0",key:"1dfaln"}],["path",{d:"M15 8.5a2.5 2.5 0 0 0-5 0v1a2 2 0 1 1 0 4",key:"1qnva7"}]],gs=A("ear",ps);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]],bs=A("megaphone",ys);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],Ns=A("message-square",js);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=[["path",{d:"M18 11h-4a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h4",key:"17ldeb"}],["path",{d:"M6 7v13a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7",key:"nc37y6"}],["rect",{width:"16",height:"5",x:"4",y:"2",rx:"1",key:"3jeezo"}]],ws=A("pill-bottle",vs);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=[["path",{d:"M4 10a7.31 7.31 0 0 0 10 10Z",key:"1fzpp3"}],["path",{d:"m9 15 3-3",key:"88sc13"}],["path",{d:"M17 13a6 6 0 0 0-6-6",key:"15cc6u"}],["path",{d:"M21 13A10 10 0 0 0 11 3",key:"11nf8s"}]],Ms=A("satellite-dish",ks);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=[["circle",{cx:"7",cy:"7",r:"5",key:"x29byf"}],["circle",{cx:"17",cy:"17",r:"5",key:"1op1d2"}],["path",{d:"M12 17h10",key:"ls21zv"}],["path",{d:"m3.46 10.54 7.08-7.08",key:"1rehiu"}]],Ts=A("tablets",Cs);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],_s=A("timer",Ss),Ie=[{target:"ReceivedChart",fn:"type",minStage:1},{target:"ReceivedChart",fn:"airtime",minStage:1,when:Ot}];O(Ie);function Ds(t,s,n){const a=Date.now()/1e3,o=s*60,i=a-o,l=o/n,m=[];for(let x=0;x<n;x++)m.push({start:i+x*l,end:i+(x+1)*l,bytesByType:{},totalBytes:0});const d={};for(const x of t){if(x.transmitted)continue;const u=x.timestamp;if(u<i||u>a)continue;const g=Math.min(n-1,Math.floor((u-i)/l)),c=x.type??x.payload_type??0,h=x.length??x.payload_length??0,y=m[g];y.bytesByType[c]=(y.bytesByType[c]??0)+h,y.totalBytes+=h,d[c]=(d[c]??0)+h}const r=Object.keys(d).map(x=>parseInt(x,10)).filter(x=>d[x]>0).sort((x,u)=>d[u]-d[x]);return{buckets:m,activeTypes:r,totalByType:d}}function Rs(t){const n=new Date(t*1e3).getHours();return n>=6&&n<18}function Bs(t){return new Date(t*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})}function Ls({packets:t,rangeMinutes:s,bucketCount:n}){I(Ie);const a=st(),[o,i]=f.useState(null),[l,m]=f.useState(null),[d,r]=f.useState(null),{buckets:x,activeTypes:u,totalByType:g}=f.useMemo(()=>Ds(t,s,n),[t,s,n]),c=f.useCallback((j,N,w)=>{i(N),m(w)},[]),h=x.length>0&&u.length>0,y=o?Rs(o.start):null,v=o?Bs(o.start):"",k=d!==null&&y!==null&&d!==y;y!==d&&r(y);const M=48;return e.jsxs("div",{className:"flex flex-col h-full relative",children:[e.jsx("div",{className:"h-5 relative mb-1 shrink-0",children:o&&l!==null&&e.jsxs("div",{className:"absolute flex items-center gap-1.5 type-data-sm -translate-x-1/2",style:{left:`calc(${M}px + ${l*100}% * (1 - ${M}px / 100%))`},children:[e.jsx(Re,{mode:"wait",children:e.jsx(Q.span,{initial:k?{opacity:0,scale:.5,rotate:-90}:!1,animate:{opacity:1,scale:1,rotate:0},exit:{opacity:0,scale:.5,rotate:90},transition:{duration:.25,ease:"easeOut"},children:y?e.jsx(nt,{className:"w-4 h-4 text-sys-amber"}):e.jsx(at,{className:"w-4 h-4 text-sys-blue"})},y?"sun":"moon")}),e.jsx("span",{className:"text-fg-secondary",children:v})]})}),e.jsx("div",{className:"flex-1 min-h-0",children:h&&e.jsx(ot,{buckets:x,activeTypes:u,gridColor:a.grid,axisTickColor:a.axisTick,onHover:c})}),e.jsx("div",{className:"pt-2 px-1 pb-2 shrink-0",children:h&&e.jsx(it,{activeTypes:u,totalByType:g})})]})}function Fs(t,s,n){var i,l;if(t.length<=n)return t;const a=t.length/n,o=[];for(let m=0;m<n;m++){const d=Math.floor(m*a),r=Math.floor((m+1)*a),x=t.slice(d,r),u={start:((i=x[0])==null?void 0:i.start)??0,end:((l=x.at(-1))==null?void 0:l.end)??0,bytesByType:{},totalBytes:0};for(const g of x){u.totalBytes+=g.totalBytes;for(const c of s){const h=g.bytesByType[c]??0;h>0&&(u.bytesByType[c]=(u.bytesByType[c]??0)+h)}}o.push(u)}return o}function Ps(t,s,n,a,o,i,l){if(s.length===0)return;const m=Fs(s,n,ct.statsCard),d=m.length,r=i/d,x=m.map(g=>g.totalBytes),u=Math.max(...x);if(u!==0){for(let g=0;g<d;g++){const c=m[g],h=a+g*r,y=c.totalBytes;if(y===0)continue;const k=y/u*l;let j=o+l-k+k;for(const N of n){const w=c.bytesByType[N]??0;if(w===0)continue;const C=w/y*k,p=j-C;t.fillStyle=lt(N),t.globalAlpha=.85,t.fillRect(h,p,r,C),j=p}}t.globalAlpha=1}}function As({buckets:t,activeTypes:s}){const n=f.useRef(null),a=f.useRef(t),o=f.useRef(s);a.current=t,o.current=s;const i=f.useMemo(()=>{const l=t.map(d=>d.start),m=t.map(()=>1);return[l,m]},[t]);return f.useEffect(()=>{if(!n.current||t.length===0)return;const l=n.current,m=l.getBoundingClientRect(),d=Math.floor(m.width)||200,r=Math.floor(m.height)||60,x={width:d,height:r,padding:[0,0,0,0],cursor:{show:!1},scales:{x:{time:!1},y:{range:[0,1]}},axes:[{show:!1},{show:!1}],series:[{},{show:!1}],legend:{show:!1},hooks:{draw:[c=>{const h=c.ctx,{left:y,top:v,width:k,height:M}=c.bbox;Ps(h,a.current,o.current,y,v,k,M)}]}},u=new rt(x,i,l),g=new ResizeObserver(()=>{const c=l.getBoundingClientRect();c.width>0&&c.height>0&&u.setSize({width:Math.floor(c.width),height:Math.floor(c.height)})});return g.observe(l),()=>{g.disconnect(),u.destroy()}},[i,t.length]),t.length===0?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("div",{className:"w-full h-0.5 rounded-full bg-fg-muted/15"})}):e.jsx("div",{ref:n,className:"w-full h-full"})}const Oe=f.memo(As),ze=[{target:"ForwardedCard",fn:"type",minStage:1}];O(ze);function $s(t,s,n){const a=Date.now()/1e3,o=s*60,i=a-o,l=o/n,m=[];for(let c=0;c<n;c++)m.push({start:i+c*l,end:i+(c+1)*l,bytesByType:{},totalBytes:0});const d={};let r=0;for(const c of t){if(!(c.packet_origin==="tx_forward"||c.transmitted&&c.packet_origin!=="tx_local"))continue;const y=c.timestamp;if(y<i||y>a)continue;const v=Math.min(n-1,Math.floor((y-i)/l)),k=c.type??c.payload_type??0,M=c.length??c.payload_length??0,j=m[v];j.bytesByType[k]=(j.bytesByType[k]??0)+M,j.totalBytes+=M,d[k]=(d[k]??0)+M,r++}const x=Object.keys(d).map(c=>parseInt(c,10)).filter(c=>d[c]>0).sort((c,h)=>d[h]-d[c]),u=s/60,g=u>0?Math.round(r/u):0;return{buckets:m,activeTypes:x,ratePerHour:g}}function Es({value:t,receivedCount:s,packets:n,rangeMinutes:a,bucketCount:o,timeRangeLabel:i,icon:l,isLoaded:m=!0}){I(ze);const{buckets:d,activeTypes:r,ratePerHour:x}=f.useMemo(()=>$s(n,a,o),[n,a,o]),u=s>0?(t/s*100).toFixed(1):null;return m?e.jsxs(H,{children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-2 sm:mb-3",children:[l&&e.jsx("span",{className:"icon-sm text-icon-card-title",children:l}),e.jsx("span",{className:"type-micro",children:"FORWARDED"}),i&&e.jsx(U,{color:"zinc",className:"hidden sm:inline-flex",children:i})]}),e.jsx("div",{className:"type-data-xl text-fg-primary",children:e.jsx(V,{value:t,className:"font-mono tabular-nums",priority:"high"})}),e.jsx("div",{className:"flex-1 mt-1 overflow-hidden min-h-[40px] sm:min-h-[60px]",children:r.length>0?e.jsx(Oe,{buckets:d,activeTypes:r}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("div",{className:"w-full h-0.5 rounded-full bg-fg-muted/15"})})}),e.jsx("div",{className:"pt-1.5 sm:pt-2 mt-1",children:e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"data-box-label",children:"Rate"}),e.jsxs("div",{className:"data-box data-box-fill data-box-left",children:[x,"/hr"]})]}),u!==null&&e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"data-box-label",children:"Ratio"}),e.jsxs("div",{className:"data-box data-box-fill data-box-left",children:[u,"%"]})]})]})})]}):e.jsx(H,{children:e.jsx(ue,{})})}const We=[{target:"DroppedCard",fn:"type",minStage:1}];O(We);function Hs(t,s,n){const a=Date.now()/1e3,o=s*60,i=a-o,l=o/n,m=[];for(let c=0;c<n;c++)m.push({start:i+c*l,end:i+(c+1)*l,bytesByType:{},totalBytes:0});const d={};let r=0;for(const c of t){if(!c.drop_reason)continue;const h=c.timestamp;if(h<i||h>a)continue;const y=Math.min(n-1,Math.floor((h-i)/l)),v=c.type??c.payload_type??0,k=c.length??c.payload_length??0,M=m[y];M.bytesByType[v]=(M.bytesByType[v]??0)+k,M.totalBytes+=k,d[v]=(d[v]??0)+k,r++}const x=Object.keys(d).map(c=>parseInt(c,10)).filter(c=>d[c]>0).sort((c,h)=>d[h]-d[c]),u=s/60,g=u>0?Math.round(r/u):0;return{buckets:m,activeTypes:x,ratePerHour:g}}function Is({value:t,receivedCount:s,packets:n,rangeMinutes:a,bucketCount:o,timeRangeLabel:i,icon:l,isLoaded:m=!0}){I(We);const{buckets:d,activeTypes:r,ratePerHour:x}=f.useMemo(()=>Hs(n,a,o),[n,a,o]),u=s>0?(t/s*100).toFixed(1):null;return m?e.jsxs(H,{children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-2 sm:mb-3",children:[l&&e.jsx("span",{className:"icon-sm text-icon-card-title",children:l}),e.jsx("span",{className:"type-micro",children:"DROPPED"}),i&&e.jsx(U,{color:"zinc",className:"hidden sm:inline-flex",children:i})]}),e.jsx("div",{className:"type-data-xl text-fg-primary",children:e.jsx(V,{value:t,className:"font-mono tabular-nums",priority:"high"})}),e.jsx("div",{className:"flex-1 mt-1 overflow-hidden min-h-[40px] sm:min-h-[60px]",children:r.length>0?e.jsx(Oe,{buckets:d,activeTypes:r}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("div",{className:"w-full h-0.5 rounded-full bg-fg-muted/15"})})}),e.jsx("div",{className:"pt-1.5 sm:pt-2 mt-1",children:e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"data-box-label",children:"Rate"}),e.jsxs("div",{className:"data-box data-box-fill data-box-left",children:[x,"/hr"]})]}),u!==null&&e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"data-box-label",children:"Drop %"}),e.jsxs("div",{className:"data-box data-box-fill data-box-left",children:[u,"%"]})]})]})})]}):e.jsx(H,{children:e.jsx(ue,{})})}const Os={",":"punc",".":"punc-period",":":"punc-colon","/":"punc-slash"},de=/([,\.:\/])/g;function zs(t){return t.split(de).map((n,a)=>{const o=Os[n];return o?e.jsx("span",{className:o,children:n},a):n})}const $=f.memo(function({children:s,className:n="",as:a="span"}){const o=f.useMemo(()=>{let i;return typeof s=="number"?i=s.toLocaleString():Array.isArray(s)?i=s.join(""):i=String(s??""),de.test(i)?(de.lastIndex=0,zs(i)):i},[s]);return e.jsx(a,{className:`data-tight ${n}`.trim(),children:o})}),Ws=2,qs=1;function Us(t,s,n){const a=d=>(d==null?void 0:d.reduce((r,x)=>r+x.count,0))??0,o=a(s),i=a(n),l=o||(t==null?void 0:t.rx_count)||1,m=i||(t==null?void 0:t.dropped_count)||0;return l>0?m/(l+m)*100:0}function Vs(t,s,n){const a=o=>(o==null?void 0:o.reduce((i,l)=>i+l.count,0))??0;if(s!=null&&s.length&&n){const i=a(s)*100,l=s.length*n*1e3;return i/l*100}if(t){const o=(t.uptime_seconds||1)*1e3;return(t.total_airtime_ms||t.airtime_used_ms||0)/o*100}return 0}function Te(t,s,n){return Gt(Math.max(s,Math.min(n,t)))}function Gs(t,s,n,a,o){let i=Ae(t);s>20?i+=Z*2:s>12&&(i+=Z),n>8&&(i+=Z);const l=Te(i,0,Ws);let m=Xt(t);n>8&&(m+=Z);const d=Te(m,0,qs),r=q(l),x=q(d),u=a!==null?q(a):null;let g="stable";return u!==null&&(r>u?g="increase":r<u&&(g="decrease")),{floodFactor:l,directFactor:d,floodSlots:r,directSlots:x,adjustment:g,duplicateRate:Math.round(s*100)/100,txUtilization:Math.round(n*1e3)/1e3,zeroHopCount:t}}function Xs({stats:t,receivedBuckets:s,droppedBuckets:n,forwardedBuckets:a,bucketDurationSeconds:o,timeRangeLabel:i,isLoaded:l=!0}){var fe,pe,ge,ye;const[m,d]=f.useState(!1),[r,x]=f.useState("idle"),u=dt(),g=f.useCallback(async(L,E)=>{if(r!=="applying"){x("applying");try{const se=await mt({tx_delay_factor:L,direct_tx_delay_factor:E});se!=null&&se.success?(x("success"),setTimeout(()=>x("idle"),2e3)):(x("error"),setTimeout(()=>x("idle"),2500))}catch{x("error"),setTimeout(()=>x("idle"),2500)}}},[r]);if(!l)return e.jsx(H,{children:e.jsx(ue,{})});const c=10080*60,y=Math.floor(Date.now()/1e3)-c,v=Object.values((t==null?void 0:t.neighbors)??{}).filter(L=>L.zero_hop&&L.last_seen>=y&&Vt(L).isRepeater).length,k=u.filter(L=>L.status==="active"||L.lastSeen>=y).length,M=Math.max(v,k),j=Us(t,s,n),N=Vs(t,a,o),w=((pe=(fe=t==null?void 0:t.config)==null?void 0:fe.delays)==null?void 0:pe.tx_delay_factor)??null,C=((ye=(ge=t==null?void 0:t.config)==null?void 0:ge.delays)==null?void 0:ye.direct_tx_delay_factor)??null,p=Gs(M,j,N,w),D=M!==1,T=Ae(M),_=[`${M} repeater${D?"s":""} heard in the last 7 days (base Ã—${T.toFixed(1)}).`];p.floodFactor===T&&j<=12&&N<=8?_.push("No modifiers applied â€” network looks healthy."):(j>20?_.push(`High duplicate rate (${j.toFixed(1)}%) suggests frequent collisions â€” window widened.`):j>12&&_.push(`Elevated duplicate rate (${j.toFixed(1)}%) â€” window widened one step.`),N>8&&_.push(`Channel is busy (${N.toFixed(1)}% TX util) â€” extra spacing added.`));const b=[`Direct uses one forwarder â€” Ã—${p.directFactor.toFixed(1)} backoff for channel contention.`];N>8&&b.push("Busy channel â€” small extra backoff.");const S=[`Flood Ã—${p.floodFactor.toFixed(1)} (${p.floodSlots} slot${p.floodSlots!==1?"s":""})`,..._,"",`Direct Ã—${p.directFactor.toFixed(1)}`,...b,"","Click to copy CLI commands"].join(`
`),R=w!==null?q(w):null,B=C!==null?q(C):null,W=R!==null&&p.floodSlots!==R,Ze=B!==null&&p.directSlots!==B,Qe=W||Ze,et=async()=>{const L=`set txdelay ${p.floodFactor.toFixed(1)}
set direct.txdelay ${p.directFactor.toFixed(1)}`;try{await navigator.clipboard.writeText(L),d(!0),setTimeout(()=>d(!1),1500)}catch{const E=document.createElement("textarea");E.value=L,E.style.position="fixed",E.style.opacity="0",document.body.appendChild(E),E.select();try{document.execCommand("copy"),d(!0),setTimeout(()=>d(!1),1500)}catch{console.error("Failed to copy commands")}document.body.removeChild(E)}},tt=()=>g(p.floodFactor,p.directFactor);return e.jsxs(H,{children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-2 sm:mb-3 flex-wrap",children:[e.jsx(Yt,{className:"w-4 h-4 text-icon-card-title flex-shrink-0"}),e.jsx("span",{className:"type-micro",children:"DELAY DOCTOR"}),i&&e.jsx(U,{color:"zinc",className:"hidden sm:inline-flex",children:i})]}),e.jsxs("button",{onClick:et,className:"flex gap-3 mb-2 sm:mb-3 w-full text-left hover:bg-subtle-fill radius-inner transition-base p-1 -m-1 group",title:S,children:[e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("span",{className:"type-data-xl text-fg-primary",children:e.jsxs($,{children:["Ã—",p.floodFactor.toFixed(1)]})}),e.jsx("span",{className:"type-micro text-fg-muted mt-0.5 sm:mt-1",children:"Flood"})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("span",{className:"type-data-xl text-sys-blue",children:e.jsxs($,{children:["Ã—",p.directFactor.toFixed(1)]})}),e.jsx("span",{className:"type-micro text-fg-muted mt-0.5 sm:mt-1",children:"Direct"})]}),e.jsx("div",{className:"flex items-center self-center opacity-0 group-hover:opacity-100 transition-opacity",children:m?e.jsx(be,{className:"w-4 h-4 text-sys-green"}):e.jsx(ut,{className:"w-4 h-4 text-fg-muted"})})]}),e.jsx("div",{className:"flex-1 py-2",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"data-box-label",children:"Dupe"}),e.jsxs("div",{className:`data-box data-box-fill data-box-left ${p.duplicateRate>8?"text-status-warning":""}`,children:[p.duplicateRate.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"data-box-label",children:"TX Util"}),e.jsxs("div",{className:"data-box data-box-fill data-box-left",children:[p.txUtilization.toFixed(2),"%"]})]})]})}),e.jsx("div",{className:"pt-2 mt-auto",children:e.jsxs("div",{className:"flex items-end justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"data-box-label",children:"Current"}),e.jsx("div",{className:"flex gap-2",children:w!==null?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"data-box",children:["Ã—",w.toFixed(2)]}),e.jsxs("div",{className:"data-box",style:{color:"var(--sys-blue)"},children:["Ã—",(C==null?void 0:C.toFixed(2))??"â€”"]})]}):e.jsx("span",{className:"text-sm text-fg-muted",children:"No config"})})]}),Qe&&e.jsxs("button",{onClick:tt,disabled:r==="applying"||r==="success",className:`flex items-center gap-1.5 px-2.5 py-1.5 radius-inner type-micro font-medium transition-base
                ${r==="success"?"bg-sys-green/15 text-sys-green":r==="error"?"bg-sys-red/15 text-sys-red":r==="applying"?"bg-subtle-fill text-fg-muted":"bg-sys-blue/10 text-sys-blue hover:bg-sys-blue/20"}`,title:`Apply Ã—${p.floodFactor.toFixed(1)} flood, Ã—${p.directFactor.toFixed(1)} direct`,children:[r==="success"?"Rx'd":r==="error"?"Failed":"Apply",r==="applying"?e.jsx(ee,{className:"w-3.5 h-3.5 animate-spin"}):r==="success"?e.jsx(be,{className:"w-3.5 h-3.5"}):e.jsxs("span",{className:"relative inline-flex items-end w-6 h-3.5",children:[e.jsx(ws,{className:"w-3.5 h-3.5 absolute left-0 bottom-0"}),e.jsx(Ts,{className:"w-3 h-3 absolute right-0 bottom-0"})]})]})]})})]})}const qe=[{target:"RecentPackets",fn:"rssi",minStage:1},{target:"RecentPackets",fn:"snr",minStage:1}];O(qe);const Ys=25;function Ks(){I(qe);const t=G(),s=xt(),n=ht(),a=te(),o=Qt(),i=ce(c=>c.requestChannel),[l,m]=f.useState(!0),d=f.useCallback(c=>m(c),[]),r=f.useMemo(()=>[...t.length<=100?t:t.slice(-100)].sort((h,y)=>(y.timestamp??0)-(h.timestamp??0)),[t]),x=a==null?void 0:a.local_hash,u=a==null?void 0:a.neighbors,g=es();return e.jsxs(H,{noPadding:!0,className:"!overflow-visible",children:[e.jsx(Be,{listHeader:!0,icon:e.jsx(Le,{}),title:"Recent Packets",actions:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ft,{enabled:l,onChange:d,label:"Hide Dupes",size:"sm"}),n&&e.jsx(pt,{showLabel:!0}),e.jsxs(je,{color:"primary",outline:!0,href:"/packets",children:["View all",e.jsx(Me,{"data-slot":"icon"})]})]})}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto px-1",children:e.jsx(Kt,{packets:r,allPackets:t,localHash:x,neighbors:u,resolveSource:g,getDecodedContent:o,onChannelClick:i,loading:s,maxPackets:Ys,showPagination:!1,flashNewest:!0,hideDupes:l,emptyMessage:"No packets received",footerAction:e.jsxs(je,{color:"primary",outline:!0,href:"/packets",children:["View all",e.jsx(Me,{"data-slot":"icon"})]})})})]})}const Js={stable:"M5 12h14",up:"M5 15l7-7 7 7",down:"M19 9l-7 7-7-7"};function Zs({trend:t}){return e.jsx("span",{className:`mini-widget-trend ${t}`,children:e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:Js[t]})})})}function Qs(){return e.jsx("div",{className:"mini-widget-loading",children:e.jsx("div",{className:"mini-widget-loading-spinner"})})}function en({message:t}){return e.jsx("div",{className:"mini-widget-error",children:e.jsx("span",{title:t,children:"No data"})})}function z({title:t,icon:s,value:n,unit:a,valueSize:o="md",status:i,subtitle:l,trend:m,children:d,isLoading:r=!1,error:x,className:u="",onClick:g}){const c=["mini-widget-value",o==="lg"&&"mini-widget-value-lg",o==="sm"&&"mini-widget-value-sm"].filter(Boolean).join(" "),h=["mini-widget",u].filter(Boolean).join(" ");return e.jsxs(H,{noPadding:!0,className:h,onClick:g,children:[e.jsxs("div",{className:"mini-widget-header",children:[s,e.jsx("span",{className:"mini-widget-title",children:t}),i&&i!=="unknown"&&e.jsx("div",{className:`mini-widget-status-dot ${i}`}),m&&e.jsx(Zs,{trend:m})]}),r?e.jsx(Qs,{}):x?e.jsx(en,{message:x}):e.jsxs(e.Fragment,{children:[n!==void 0&&e.jsxs("div",{className:c,children:[typeof n=="number"?e.jsx(V,{value:n,className:"font-mono tabular-nums",priority:"medium",format:Number.isInteger(n)?void 0:{minimumFractionDigits:1,maximumFractionDigits:1}}):e.jsx($,{children:n}),a&&e.jsx("span",{className:"mini-widget-unit",children:a})]}),l&&e.jsx("div",{className:"mini-widget-subtitle",children:l}),d]})]})}const tn={DELTA_CRITICAL:10,SLOPE_CRITICAL:4,JITTER_CRITICAL:6,DELTA_WARNING:5,SLOPE_WARNING:2,JITTER_WARNING:4},Ue={baselineMedian:null,baselineP10:null,baselineP90:null,currentMedian:null,currentSampleCount:0,delta:0,slope:0,jitter:0,penalty:0,penaltyReason:null,computedAt:0,isReliable:!1};function me(t,s){if(t.length===0)return null;const n=[...t].sort((l,m)=>l-m),a=s/100*(n.length-1),o=Math.floor(a),i=Math.ceil(a);return o===i?n[o]:n[o]+(n[i]-n[o])*(a-o)}function Se(t){return me(t,50)}function sn(t){if(t.length<2)return 0;const s=t.reduce((o,i)=>o+i,0)/t.length,a=t.map(o=>Math.pow(o-s,2)).reduce((o,i)=>o+i,0)/t.length;return Math.sqrt(a)}function nn(t){if(t.length<2)return 0;const s=t.length;let n=0,a=0,o=0,i=0;const l=t[0].timestamp;for(const d of t){const r=(d.timestamp-l)/3600,x=d.value;n+=r,a+=x,o+=r*x,i+=r*r}const m=s*i-n*n;return Math.abs(m)<1e-4?0:(s*o-n*a)/m}function an(t,s,n){const a=tn;return t>=a.DELTA_CRITICAL?[2,`Noise floor ${t.toFixed(1)} dB above baseline`]:s>=a.SLOPE_CRITICAL?[2,`Noise floor rising ${s.toFixed(1)} dB/hour`]:n>=a.JITTER_CRITICAL?[2,`Noise floor unstable (Â±${n.toFixed(1)} dB)`]:t>=a.DELTA_WARNING?[1,`Noise floor ${t.toFixed(1)} dB above baseline`]:s>=a.SLOPE_WARNING?[1,`Noise floor rising ${s.toFixed(1)} dB/hour`]:n>=a.JITTER_WARNING?[1,`Noise floor variable (Â±${n.toFixed(1)} dB)`]:[0,null]}function on(t){if(t.length===0)return{...Ue,computedAt:Math.floor(Date.now()/1e3)};const s=Math.floor(Date.now()/1e3),n=t.filter(v=>Number.isFinite(v)),a=t.length>0?[t[t.length-1]]:[],o=t.slice(-4).filter(v=>Number.isFinite(v)),i=Se(n),l=me(n,10),m=me(n,90),d=Se(a),r=d!==null&&l!==null?d-l:0,x=o.map((v,k)=>({timestamp:s-(o.length-1-k)*3600,value:v})),u=nn(x),g=sn(o),c=n.length>=12,[h,y]=c?an(r,u,g):[0,null];return{baselineMedian:i,baselineP10:l,baselineP90:m,currentMedian:d,currentSampleCount:a.length,delta:r,slope:u,jitter:g,penalty:h,penaltyReason:y,computedAt:s,isReliable:c}}const rn={lbtStats:null,noiseFloor:null,sparklineNoiseFloor:[],noiseFloorWindowHistory:[],linkQuality:null,channelHealth:null,nfTrend:Ue,radioConfig:null,trends:null,stats:null,recentPackets:[],quickNeighbors:[],isLoading:!0,error:null,refresh:async()=>{}},Ve=f.createContext(rn);function ln({children:t}){var b;const s=te(),n=G(),a=Fe(),o=gt(),i=X(),l=P[i],m=Math.max(1,l.minutes/60),d=s===null,r=f.useMemo(()=>yt(n,m),[n,m]),x=(s==null?void 0:s.noise_floor_dbm)??null,u=f.useMemo(()=>bt(x)?x:null,[x]),g=f.useMemo(()=>{var R;const S=(R=s==null?void 0:s.config)==null?void 0:R.radio;return S?{sf:S.spreading_factor??7,bwHz:S.bandwidth??125e3}:null},[(b=s==null?void 0:s.config)==null?void 0:b.radio]),c=jt(m),h=Nt(m),y=s==null?void 0:s.neighbors,v=f.useMemo(()=>Object.fromEntries(Object.entries(y??{}).filter(([R])=>!o.has(R))),[y,o]),k=f.useMemo(()=>a.filter(S=>!o.has(S.hash)),[a,o]),M=f.useMemo(()=>on(c),[c]),j=f.useMemo(()=>vt(k,v,g),[k,v,g]),N=f.useMemo(()=>wt(r,u,j),[r,u,j]),[w,C]=f.useState({noiseFloor:null,networkScore:null,channelHealth:null}),p=f.useRef(0);f.useEffect(()=>{const S=()=>{const B=Date.now();B-p.current>3e4&&(p.current=B,C({noiseFloor:u,networkScore:(j==null?void 0:j.networkScore)??null,channelHealth:(N==null?void 0:N.score)??null}))};S();const R=setInterval(S,5e3);return()=>clearInterval(R)},[u,j==null?void 0:j.networkScore,N==null?void 0:N.score]);const D=f.useMemo(()=>({noiseFloor:{current:u,previous:w.noiseFloor,trend:u!==null?ne(u,w.noiseFloor,2,!0):"stable"},networkScore:{current:(j==null?void 0:j.networkScore)??0,previous:w.networkScore,trend:ne((j==null?void 0:j.networkScore)??0,w.networkScore,3,!1)},channelHealth:{current:(N==null?void 0:N.score)??0,previous:w.channelHealth,trend:ne((N==null?void 0:N.score)??0,w.channelHealth,3,!1)}}),[u,j==null?void 0:j.networkScore,N==null?void 0:N.score,w]),_={lbtStats:r,noiseFloor:u,sparklineNoiseFloor:c,noiseFloorWindowHistory:h,linkQuality:j,channelHealth:N,nfTrend:M,radioConfig:g,trends:D,stats:s,recentPackets:n,quickNeighbors:a,isLoading:d,error:null,refresh:async()=>{}};return e.jsx(Ve.Provider,{value:_,children:t})}function Y(){const t=f.useContext(Ve);if(t===void 0)throw new Error("useLBTData must be used within an LBTDataProvider");return t}function cn(t){return t<100?"excellent":t<250?"good":t<500?"fair":t<1e3?"congested":"critical"}function dn(t,s){return t===0?"No backoffs":`${s.toFixed(0)}% retry rate`}function mn(){const{lbtStats:t,isLoading:s,error:n}=Y(),a=xe(),o=(t==null?void 0:t.avgBackoffMs)??0,i=(t==null?void 0:t.retryRate)??0,l=t?cn(o):"unknown",m=t==null?void 0:t.sparklineBackoff,d=f.useMemo(()=>!m||m.length<2?[]:m.map((r,x)=>({timestamp:Date.now()-(m.length-1-x)*36e5,count:r})),[m]);return e.jsx(z,{title:"LBT Backoff",icon:e.jsx(_s,{className:"mini-widget-icon"}),value:Math.round(o),unit:"ms",status:l,subtitle:t?dn(o,i):void 0,isLoading:s,error:n,onClick:()=>a("/packets"),children:e.jsx("div",{className:"mini-widget-sparkline w-full",children:e.jsx(he,{data:d,width:9999,height:24,color:"var(--sys-blue)",isLoading:s,className:"w-full"})})})}function le(t){return t===0?"â€”":t<1?"<1":Math.round(t).toString()}function un(){const{lbtStats:t,isLoading:s,error:n}=Y(),a=xe(),o=(t==null?void 0:t.channelBusyCount)??0,i=(t==null?void 0:t.totalPacketsWithLBT)??0,l=(t==null?void 0:t.channelBusyRate)??0,m=(t==null?void 0:t.retryRate)??0,d=(t==null?void 0:t.avgBackoffMs)??0,r=(t==null?void 0:t.minBackoffMs)??0,x=(t==null?void 0:t.maxBackoffMs)??0,u=m>0?Math.max(0,(m-l)/m*100):100;return e.jsx(z,{title:"Ch. Busy",icon:e.jsx(Ut,{className:"mini-widget-icon"}),isLoading:s,error:n,onClick:()=>a("/packets"),children:e.jsx("div",{className:"flex-1 flex items-end",children:e.jsxs("div",{className:"grid grid-cols-[auto_minmax(0,1fr)] sm:grid-cols-[auto_minmax(0,1fr)_auto_minmax(0,1fr)] gap-x-2 gap-y-1 sm:gap-y-2 w-full items-baseline",children:[e.jsx("span",{className:"data-box-label mb-0 text-[10px] sm:text-sm",title:`${o} packets exceeded max CAD attempts (5) out of ${i} total transmissions.`,children:"Failed:"}),e.jsxs("div",{className:"data-box data-box-compact sm:data-box justify-self-start",title:`${o} packets exceeded max CAD attempts (5) out of ${i} total transmissions.`,children:[e.jsx($,{children:o}),e.jsx("span",{className:"text-fg-muted punc-slash",children:"/"}),e.jsx($,{children:i})]}),e.jsx("span",{className:"data-box-label mb-0 text-[10px] sm:text-sm",title:`${u.toFixed(1)}% of packets that needed LBT retries were sent successfully.`,children:"Sent:"}),e.jsx("div",{className:"data-box data-box-compact sm:data-box justify-self-start",title:`${u.toFixed(1)}% of packets that needed LBT retries were sent successfully.`,children:e.jsxs($,{children:[u.toFixed(0),"%"]})}),e.jsx("span",{className:"data-box-label mb-0 text-[10px] sm:text-sm",title:`Average LBT backoff delay: ${d.toFixed(0)}ms.`,children:"Mean:"}),e.jsxs("div",{className:"data-box data-box-compact sm:data-box justify-self-start",title:`Average LBT backoff delay: ${d.toFixed(0)}ms.`,children:[e.jsx($,{children:le(d)}),e.jsx("span",{className:"text-fg-muted text-xs",children:"ms"})]}),e.jsx("span",{className:"data-box-label mb-0 text-[10px] sm:text-sm",title:`Backoff range: ${r.toFixed(0)}ms min, ${x.toFixed(0)}ms max.`,children:"Range:"}),e.jsxs("div",{className:"data-box data-box-compact sm:data-box justify-self-start",title:`Backoff range: ${r.toFixed(0)}ms min, ${x.toFixed(0)}ms max.`,children:[e.jsx($,{children:le(r)}),e.jsx("span",{className:"text-fg-muted punc-slash",children:"/"}),e.jsx($,{children:le(x)})]})]})})})}const xn=.25,_e=48;function hn(t,s,n,a){const o=t.length;if(o===0)return[];if(o===1)return new Array(a).fill(s[0]);if(o===2){const u=new Array(a);for(let g=0;g<a;g++)u[g]=s[0]+(s[1]-s[0])*(g/(a-1));return u}const i=Math.max(2,Math.ceil(n*o)),l=t[0],d=t[o-1]-l||1,r=new Array(a),x=new Array(o);for(let u=0;u<a;u++){const g=l+u/(a-1)*d;for(let w=0;w<o;w++)x[w]=Math.abs(t[w]-g);const c=x.slice().sort((w,C)=>w-C),h=Math.max(c[i-1],1e-10);let y=0,v=0,k=0,M=0,j=0;for(let w=0;w<o;w++){const C=x[w]/h;if(C>=1)continue;const p=C*C*C,D=(1-p)*(1-p)*(1-p),T=t[w]-g;y+=D,v+=D*T,k+=D*s[w],M+=D*T*T,j+=D*T*s[w]}if(y===0){r[u]=s[Math.round(u/(a-1)*(o-1))];continue}const N=y*M-v*v;r[u]=Math.abs(N)<1e-10?k/y:(M*k-v*j)/N}return r}function fn(t){return t===null||t<-110?"excellent":t<-100?"good":t<-90?"fair":t<-80?"congested":"critical"}function pn(t){return t===null?"No reading":t<-115?"Very quiet":t<-105?"Quiet":t<-95?"Moderate":t<-85?"Elevated":"High interference"}function gn(){const{noiseFloor:t,noiseFloorWindowHistory:s,trends:n,isLoading:a,error:o}=Y(),i=fn(t),l=n==null?void 0:n.noiseFloor.trend,m=f.useMemo(()=>{if(!s||s.length<2)return[];const r=s.map(g=>g.timestamp),x=s.map(g=>-g.noise_floor_dbm);return hn(r,x,xn,_e).map((g,c)=>({timestamp:Date.now()-(_e-1-c)*36e5,count:g}))},[s]),d=t!==null?Math.round(t):"â€”";return e.jsx(z,{title:"Noise Floor",icon:e.jsx(xs,{className:"mini-widget-icon"}),value:d,unit:t!==null?"dBm":void 0,status:i,trend:l,subtitle:pn(t),isLoading:a,error:o,children:e.jsx("div",{className:"mini-widget-sparkline w-full",children:e.jsx(he,{data:m,width:9999,height:22,color:"var(--sys-blue)",isLoading:a,className:"w-full"})})})}const Ge=[{target:"LinkLeaders",fn:"path",minStage:1,when:zt},{target:"LinkLeaders",fn:"src_hash",minStage:1,when:Wt}];O(Ge);function yn(){I(Ge);const t=xe(),s=Fe(),n=G(),a=te(),o=X(),l=P[o].minutes*60,m=kt(),d=f.useMemo(()=>{if(m===0)return n;const p=m-l;return n.filter(D=>D.timestamp>=p)},[n,l,m]),r=a===null,x=a!=null&&a.local_hash?Ne(a.local_hash):"",u=(a==null?void 0:a.neighbors)??{},{neighborHashes:g,neighborNames:c}=f.useMemo(()=>{const p=new Set,D=new Map;for(const T of s){p.add(T.hash);const _=u[T.hash],b=(_==null?void 0:_.name)||(_==null?void 0:_.node_name)||T.prefix;D.set(T.hash,b)}return{neighborHashes:p,neighborNames:D}},[s,u]),h=f.useMemo(()=>{if(g.size===0||d.length===0||!x)return{champion:null,listener:null,loudest:null};const{scores:p}=ts(d,g,x),D=[];for(const[S,R]of p)R.blendedScore!==0&&D.push({...R,name:c.get(S)??Ne(S)});let T=null,_=null,b=null;for(const S of D)(!T||S.blendedScore>T.blendedScore)&&(T=S),(!_||S.listenerScore>_.listenerScore)&&(_=S),(!b||S.loudScore>b.loudScore)&&(b=S);return{champion:T,listener:_,loudest:b}},[d,g,x,c]),y=p=>e.jsxs("div",{className:"max-w-[220px]",children:[e.jsxs("div",{className:"font-semibold mb-1",children:["ðŸ† Champion: ",p.name]}),e.jsxs("div",{className:"text-fg-muted mb-1",children:["Blended Score: ",p.blendedScore,e.jsx("span",{className:"text-fg-muted/60 ml-1",children:"(Listener + Loud)"})]}),e.jsxs("div",{className:"border-t border-edge-subtle pt-1 mt-1 space-y-0.5",children:[e.jsxs("div",{children:["Listener: ",p.listenerScore,"/100 (",p.listenerCount," shared paths)"]}),e.jsxs("div",{children:["Loud: ",p.loudScore,"/100 (",p.loudCount," packets relayed)"]})]})]}),v=p=>e.jsxs("div",{className:"max-w-[220px]",children:[e.jsxs("div",{className:"font-semibold mb-1",children:["ðŸ‘‚ Best Listener: ",p.name]}),e.jsxs("div",{className:"text-fg-muted mb-1",children:["Score: ",p.listenerScore,"/100"]}),e.jsx("div",{className:"border-t border-edge-subtle pt-1 mt-1",children:e.jsxs("div",{children:[p.listenerCount," packets where they heard your transmissions"]})})]}),k=p=>e.jsxs("div",{className:"max-w-[220px]",children:[e.jsxs("div",{className:"font-semibold mb-1",children:["ðŸ“¢ Loudest: ",p.name]}),e.jsxs("div",{className:"text-fg-muted mb-1",children:["Score: ",p.loudScore,"/100"]}),e.jsx("div",{className:"border-t border-edge-subtle pt-1 mt-1",children:e.jsxs("div",{children:[p.loudCount," packets they relayed directly to you"]})})]}),{champion:M,listener:j,loudest:N}=h,C=M||j||N?e.jsxs("div",{className:"flex flex-col gap-0 sm:gap-0.5 mt-auto",children:[M&&e.jsx(ae,{content:y(M),children:e.jsxs("div",{className:"flex items-center gap-1 text-xs sm:text-sm radius-badge px-1 -mx-1 hover-bg transition-base cursor-default",children:[e.jsx(Jt,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-map-neighbor-color flex-shrink-0"}),e.jsx("span",{className:"font-semibold text-map-neighbor-color font-mono truncate flex-1 min-w-0",children:M.name}),e.jsx("span",{className:"text-map-neighbor-color pl-1 sm:pl-2 tabular-nums flex-shrink-0 w-7 sm:w-9 text-right",children:M.blendedScore})]})}),j&&e.jsx(ae,{content:v(j),children:e.jsxs("div",{className:"flex items-center gap-1 text-xs sm:text-sm radius-badge px-1 -mx-1 hover-bg transition-base cursor-default",children:[e.jsx(gs,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"text-fg-muted font-mono truncate flex-1 min-w-0",children:j.name}),e.jsx("span",{className:"text-fg-muted pl-1 sm:pl-2 tabular-nums flex-shrink-0 w-7 sm:w-9 text-right",children:j.listenerScore})]})}),N&&e.jsx(ae,{content:k(N),children:e.jsxs("div",{className:"flex items-center gap-1 text-xs sm:text-sm radius-badge px-1 -mx-1 hover-bg transition-base cursor-default",children:[e.jsx(bs,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"text-fg-muted font-mono truncate flex-1 min-w-0",children:N.name}),e.jsx("span",{className:"text-fg-muted pl-1 sm:pl-2 tabular-nums flex-shrink-0 w-7 sm:w-9 text-right",children:N.loudScore})]})})]}):s.length===0?e.jsx("div",{className:"flex items-center justify-center text-xs sm:text-sm text-fg-muted mt-auto",children:"No direct neighbors"}):e.jsx("div",{className:"flex items-center justify-center text-xs sm:text-sm text-fg-muted mt-auto",children:"No routing data yet"});return e.jsx(z,{title:"Link Leaders",icon:e.jsx(Ms,{className:"mini-widget-icon"}),isLoading:r,onClick:()=>t("/contacts"),children:C})}function bn(t){const{retryRate:s,channelBusyCount:n,totalPacketsWithLBT:a,avgBackoffMs:o,maxBackoffMs:i}=t;if(a===0)return 0;const l=Math.min(a/10,1),m=.15,d=Math.log(1+s*m)/Math.log(1+100*m)*40,r=n/a*100,x=Math.min(r*.5,25);let u=0;o>100&&(u=Math.min(Math.log10(o/100)*8,15));let g=0;i>500&&o>0&&i>o*2&&(g=Math.min((i-500)/200,5));const h=(d+x+u+g)*l;return Math.min(h,85)}function jn(t){return t<15?"excellent":t<30?"good":t<45?"fair":t<60?"congested":"critical"}function Nn(t){return t<15?"Clear channel":t<30?"Light traffic":t<45?"Moderate traffic":t<60?"Heavy traffic":t<75?"Congested":"Severe congestion"}function vn(){const{lbtStats:t,isLoading:s,error:n}=Y(),a=t?bn(t):0,o=t?jn(a):"unknown",i=(t==null?void 0:t.maxBackoffMs)??0,l=t?i>200?`Max backoff: ${Math.round(i)}ms`:Nn(a):void 0,m=t==null?void 0:t.sparklineCollisionRisk,d=f.useMemo(()=>!m||m.length<2?[]:m.map((x,u)=>({timestamp:Date.now()-(m.length-1-u)*36e5,count:x})),[m]),r=Math.round(a*10)/10;return e.jsx(z,{title:"Collision Risk",icon:e.jsx(ss,{className:"mini-widget-icon"}),value:r,unit:"%",status:o,subtitle:l,isLoading:s,error:n,children:e.jsx("div",{className:"mini-widget-sparkline w-full",children:e.jsx(he,{data:d,width:9999,height:24,color:"var(--sys-blue)",isLoading:s,className:"w-full"})})})}function wn(t){return t<30?"excellent":t<50?"good":t<70?"fair":t<90?"congested":"critical"}function kn(t){return t<1e3?`${Math.round(t)}ms`:t<6e4?`${(t/1e3).toFixed(1)}s`:`${(t/6e4).toFixed(1)}m`}function Mn(){const[t,s]=f.useState(!1),[n]=f.useState(0),{stats:a,lbtStats:o,isLoading:i}=Y(),l=f.useMemo(()=>{if(!a)return null;const c=a.airtime_used_ms??0,h=a.max_airtime_ms??1,y=a.airtime_remaining_ms??0,v=a.utilization_percent??(h>0?c/h*100:0);return{usedMs:c,maxMs:h,remainingMs:y,utilizationPercent:v}},[a]),m=f.useMemo(()=>{if(!o||o.totalPacketsWithLBT===0)return 100;const c=o.totalPacketsWithLBT-o.packetsWithRetries,h=o.totalPacketsWithLBT;return c/h*100},[o]),d=(l==null?void 0:l.utilizationPercent)??0,r=wn(d),x=(l==null?void 0:l.remainingMs)??0,u=m<95?`${m.toFixed(0)}% clean TX`:`${kn(x)} remaining`,g=l?e.jsx("div",{className:"mini-widget-progress mt-auto",children:e.jsx("div",{className:`mini-widget-progress-bar ${r}`,style:{width:`${Math.min(d,100)}%`}})}):null;return e.jsx(z,{title:"Duty Cycle",icon:e.jsx(Le,{className:"mini-widget-icon"}),value:d.toFixed(1),unit:"%",status:r,subtitle:u,isLoading:i,children:g})}function Cn(){return e.jsxs("div",{className:"mini-widget",children:[e.jsxs("div",{className:"mini-widget-header",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx(K,{className:"h-3 w-16"})]}),e.jsx(K,{className:"h-7 w-12 mt-2"}),e.jsx(K,{className:"h-3 w-20 mt-2"})]})}function Tn(){return e.jsx("div",{className:"widget-row",children:Array.from({length:6}).map((t,s)=>e.jsx(Cn,{},s))})}const Xe=[{target:"MeshHealth",fn:"type",minStage:1}];O(Xe);function Sn({className:t="",isLoaded:s=!0}){return I(Xe),e.jsxs("div",{className:`mesh-health-container relative ${t}`,children:[e.jsxs("div",{className:"mesh-health-header",children:[e.jsx(Mt,{className:"w-4 h-4 text-sys-blue"}),e.jsx("span",{className:"type-label text-fg-muted",children:"MESH HEALTH"})]}),s?e.jsx(ln,{children:e.jsxs("div",{className:"widget-row",children:[e.jsx(mn,{}),e.jsx(vn,{}),e.jsx(gn,{}),e.jsx(Mn,{}),e.jsx(un,{}),e.jsx(yn,{})]})}):e.jsx(Tn,{})]})}const Ye=[{target:"PublicChannel",fn:"decrypt",minStage:2,when:qt}];O(Ye);let Ke="",Je="",De="";function _n(){const t=new Date,s=t.toDateString();if(s!==De){De=s,Ke=s;const n=new Date(t);n.setDate(n.getDate()-1),Je=n.toDateString()}}function Dn(t){_n();const s=new Date(t*1e3).toDateString();return s===Ke?"Today":s===Je?"Yesterday":new Date(t*1e3).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"})}function Rn(t,s,n){return`${t||""}|${s}|${n}`}function Bn(t,s){const n=t.message,a=s.message;return n.timestamp===a.timestamp&&n.text===a.text&&n.senderName===a.senderName&&n.channelHash===a.channelHash&&n.channelName===a.channelName&&t.isChannelSelected===s.isChannelSelected&&t.onChannelClick===s.onChannelClick}const Ln=f.memo(function({message:s,onChannelClick:n,isChannelSelected:a}){const o=s.channelName||s.channelHash.slice(0,6);return e.jsx("div",{style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(ls,{senderName:s.senderName||"Unknown",text:s.text,timestamp:s.timestamp,nameAccessory:e.jsx($e,{channelName:o,active:a,onClick:()=>n==null?void 0:n(s.channelHash)})})})},Bn);function Fn({open:t,onClose:s,messages:n,onLoadMore:a,hasMoreToLoad:o,isDecoding:i,initialChannel:l}){const m=f.useRef(null),d=f.useRef(!0),r=X(),x=Pe(),u=f.useRef(!1);f.useEffect(()=>{t?(u.current=!0,we.resume()):u.current&&we.pause()},[t]);const g=f.useMemo(()=>{const b=Date.now()/1e3,S=P[r].minutes,R=b-S*60;return[...n].filter(B=>B.timestamp>=R).sort((B,W)=>B.timestamp-W.timestamp)},[n,r]),c=f.useCallback(()=>{const b=m.current;b&&(d.current=b.scrollTop>=-50)},[]),h=f.useMemo(()=>{const b=new Map;for(const S of g){const R=S.channelHash,B=b.get(R);B?B.count++:b.set(R,{name:S.channelName||S.channelHash.slice(0,6),hash:S.channelHash,count:1})}return Array.from(b.values()).sort((S,R)=>R.count-S.count)},[g]),y=h.length,[v,k]=f.useState(null),[M,j]=f.useState(!1);f.useEffect(()=>{t&&l&&k(l)},[t,l]);const N=f.useCallback(()=>{a(v,h)},[a,v,h]),w=f.useMemo(()=>v?g.filter(b=>b.channelHash===v):g,[g,v]),C=f.useMemo(()=>{const b=[];let S="";for(const R of w){const B=Dn(R.timestamp);B!==S&&(b.push({type:"date",date:B}),S=B),b.push({type:"message",message:R})}return b},[w]);f.useLayoutEffect(()=>{const b=m.current;b&&d.current&&(b.scrollTop=0)},[w.length]);const p=19,D=h.slice(0,p),T=h.slice(p),_=T.length>0;return e.jsx(Rt,{open:t,onClose:s,size:"lg",motionPlus:!0,solid:!0,children:e.jsxs(Bt,{className:"p-0 flex flex-col h-[80vh] max-h-[700px] rounded-2xl",children:[e.jsx("div",{className:"flex-shrink-0 px-4 sm:px-5 py-3 sm:py-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(He,{className:"size-5 text-icon-card-title flex-shrink-0"}),e.jsx("h2",{className:"type-micro",children:"Public Channels"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{ranges:P,selectedIndex:r,onSelect:x,size:"sm"}),e.jsx("button",{onClick:s,className:"sm:hidden min-h-[44px] min-w-[44px] px-3 flex items-center justify-center text-[15px] font-medium text-sys-blue active:text-sys-blue/70 transition-base radius-inner active:bg-subtle-fill",children:"Done"}),e.jsx("button",{onClick:s,className:"hidden sm:flex items-center justify-center p-2 text-fg-muted hover:text-fg-primary transition-base radius-inner hover:bg-subtle","aria-label":"Close",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})}),e.jsx("div",{className:"flex-shrink-0 px-3 pb-2 relative z-10 isolate",style:{minHeight:y>0?void 0:0},children:y>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsxs("button",{onClick:()=>k(null),className:F("px-2 py-0.5 rounded text-xs font-medium transition-all","ring-1 ring-inset",v===null?"bg-sys-blue/20 text-sys-blue ring-sys-blue/30":"bg-subtle-fill text-fg-secondary ring-edge-subtle hover:bg-subtle-fill-strong"),children:["All ",y]}),D.map(b=>e.jsx("button",{onClick:()=>k(b.hash),className:F("flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium transition-all","ring-1 ring-inset",v===b.hash?"bg-sys-blue/20 text-sys-blue ring-sys-blue/30":"bg-subtle-fill text-fg-secondary ring-edge-subtle hover:bg-subtle-fill-strong"),children:e.jsx("span",{className:"truncate max-w-[80px]",children:b.name})},b.hash)),_&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>j(!M),className:F("flex items-center gap-0.5 px-2 py-0.5 rounded text-xs font-medium transition-all","ring-1 ring-inset",M||T.some(b=>b.hash===v)?"bg-sys-blue/20 text-sys-blue ring-sys-blue/30":"bg-subtle-fill text-fg-secondary ring-edge-subtle hover:bg-subtle-fill-strong"),children:["+",T.length,e.jsx(Lt,{className:F("size-3 transition-transform",M&&"rotate-180")})]}),M&&e.jsx("div",{className:F("absolute top-full left-0 mt-1 z-50","min-w-[140px] max-h-[200px] overflow-y-auto","p-1 rounded-lg","bg-elevated backdrop-blur-xl","ring-1 ring-edge-subtle shadow-xl"),children:T.map(b=>e.jsxs("button",{onClick:()=>{k(b.hash),j(!1)},className:F("w-full flex items-center gap-1.5 px-2 py-1 rounded text-xs font-medium transition-all text-left",v===b.hash?"bg-sys-blue/20 text-sys-blue":"text-fg-secondary hover:bg-subtle-fill-strong"),children:[e.jsx(cs,{className:"size-2.5 opacity-60 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:b.name}),e.jsxs("span",{className:"opacity-60 ml-auto",children:["(",b.count,")"]})]},b.hash))})]})]})}),e.jsx("div",{ref:m,onScroll:c,className:F("flex-1 overflow-y-auto overflow-x-hidden","mx-3 mb-3 rounded-md","bg-body","ring-1 ring-inset ring-edge-subtle","flex flex-col-reverse"),children:i&&w.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full min-h-[300px] text-fg-muted px-4 py-4",children:[e.jsx(ee,{className:"size-12 mb-4 text-sys-indigo animate-spin"}),e.jsx("p",{className:"text-lg font-medium",children:"Loading messages..."})]}):w.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full min-h-[300px] text-fg-muted px-4 py-4",children:[e.jsx(Ns,{className:"size-16 mb-4 opacity-20"}),e.jsx("p",{className:"text-lg font-medium",children:"No messages yet"}),e.jsx("p",{className:"text-sm mt-1 opacity-70",children:v?"No messages in this channel":"Public channel messages will appear here"})]}):e.jsxs("div",{className:"px-4 py-4",children:[o&&e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("button",{onClick:N,disabled:i,className:F("px-4 py-1.5 rounded-full","text-[11px] font-medium","ring-1 ring-inset",i?"bg-subtle-fill text-fg-muted ring-edge-subtle cursor-wait":"bg-sys-blue/10 text-sys-blue ring-sys-blue/20 hover:bg-sys-blue/20 hover:ring-sys-blue/30"),children:i?e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(ee,{className:"size-3 animate-spin"}),"Loading..."]}):"Load older messages"})}),C.map((b,S)=>{if(b.type==="date")return e.jsx("div",{className:"flex justify-center my-4",children:e.jsx("span",{className:F("px-3.5 py-1.5 rounded-full","bg-subtle-fill backdrop-blur-sm","text-[11px] text-fg-muted/80 font-medium","ring-1 ring-edge-subtle"),children:b.date})},`date-${b.date}-${S}`);const R=`msg-${b.message.timestamp}-${b.message.senderName||"anon"}-${b.message.channelHash}`;return e.jsx("div",{className:"mb-3",children:e.jsx(Ln,{message:b.message,onChannelClick:k,isChannelSelected:v===b.message.channelHash})},R)})]})}),e.jsx("div",{className:"flex-shrink-0 px-5 py-2 text-center",children:e.jsxs("p",{className:"text-[11px] text-fg-muted",children:[w.length," messages Â· ",y," ",y===1?"channel":"channels",i&&e.jsxs("span",{className:"ml-2 text-sys-indigo",children:[e.jsx(ee,{className:"inline size-3 animate-spin mr-1"}),"Decrypting..."]})]})})]})})}function Pn(t){const s=[],n=new Set;for(const a of t.values()){const o=a.decoded;if(!o||!o.decrypted||o.macCorrupted||!o.text)continue;const i=Rn(o.senderName,o.channelHash,o.text);n.has(i)||(n.add(i),s.push({timestamp:a.timestamp,channelName:o.channelName,channelHash:o.channelHash,senderName:o.senderName,text:o.text,rssi:a.rssi,snr:a.snr}))}return s}function An({isLoaded:t=!0}){I(Ye);const s=G(),[n,a]=f.useState(!1),[o,i]=f.useState(null),l=X(),m=f.useCallback(()=>{i(null),a(!0),J.getState().queueDecryption(s)},[s]),d=ce(C=>C.requestedHash),r=ce(C=>C.clearRequest);f.useEffect(()=>{d&&(i(d),a(!0),J.getState().queueDecryption(s),r())},[d,r,s]);const x=Ct(),u=Tt(),g=St(),c=f.useMemo(()=>Pn(x),[x]),h=f.useMemo(()=>{const C=Date.now()/1e3,p=P[l].minutes,D=C-p*60;return c.filter(T=>T.timestamp>=D)},[c,l]),y=f.useMemo(()=>h.length===0?null:h.reduce((C,p)=>p.timestamp>C.timestamp?p:C),[h]),v=u.isDecoding,M=f.useMemo(()=>{const C=Date.now()/1e3,p=P[l].minutes,D=C-p*60,T=new Set;let _=0;for(const b of s)(b.type??b.payload_type)===ve.GRP_TXT&&((b.timestamp??0)<D||T.has(b.packet_hash)||(T.add(b.packet_hash),_++));return _},[s,l]),j=_t(),N=f.useMemo(()=>{const C=Date.now()/1e3,p=P[l].minutes,D=C-p*60;for(const T of s)if((T.type??T.payload_type)===ve.GRP_TXT&&!((T.timestamp??0)<D)&&!j.has(T.packet_hash))return!0;return!1},[s,j,l]),w=f.useCallback((C,p)=>{if(!v){if(C){const D=p.find(T=>T.hash===C);if(D){console.log(`[PublicChannelCard] Fast-path load for #${D.name}`),J.getState().queueChannelDecryption(s,D.name);return}}J.getState().queueDecryption(s)}},[s,v]);return t?e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:m,className:F("group cursor-pointer rounded-2xl transition-all duration-150","bg-surface/80 backdrop-blur-lg depth-raised","hover:bg-subtle-fill","px-3 py-2.5 sm:px-4 sm:py-3"),children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-shrink-0",children:[e.jsx(He,{className:"size-4 text-icon-card-title flex-shrink-0"}),e.jsx("span",{className:"type-micro",children:"CHAT ACTIVITY"}),M>0&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-subtle-fill ring-1 ring-inset ring-edge-subtle text-sm tabular-nums text-fg-secondary",children:M}),e.jsx(Ce,{className:"size-4 text-fg-muted group-hover:text-sys-indigo transition-colors ml-auto sm:hidden"})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-1.5 min-w-0 overflow-hidden",children:[e.jsx(Re,{mode:"wait",initial:!1,children:y?e.jsxs(Q.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},exit:{opacity:0,y:-16},transition:{duration:.2,ease:[.4,0,.2,1]},className:"flex items-center gap-2 sm:gap-1.5 min-w-0",children:[y.channelName&&e.jsx("span",{className:"hidden sm:inline-flex",children:e.jsx($e,{channelName:y.channelName})}),e.jsx("div",{className:"hidden sm:flex w-[30px] h-[30px] rounded-full items-center justify-center flex-shrink-0 ring-1 ring-edge-subtle",style:{backgroundColor:os(oe(y.senderName||"").cleanName)},children:oe(y.senderName||"").emoji?e.jsx("span",{className:"text-base",children:oe(y.senderName||"").emoji}):e.jsx("span",{className:"text-white text-xs font-bold tracking-tighter",children:is(y.senderName||"")})}),e.jsx("div",{className:"inline-flex items-center px-3 py-1.5 rounded-2xl rounded-tr-md bg-[#007AFF] shadow-sm min-w-0 flex-1 sm:flex-initial sm:max-w-xs sm:-ml-px",children:e.jsx("span",{className:"text-sm text-white truncate tracking-wide",children:rs(y.text)})}),e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-subtle-fill ring-1 ring-inset ring-edge-subtle text-sm tabular-nums text-fg-secondary flex-shrink-0",children:Dt(y.timestamp)})]},`msg-${y.timestamp}-${y.senderName}-${y.channelHash}`):g?e.jsx(Q.span,{initial:{opacity:0},animate:{opacity:1},className:"text-sm text-fg-muted italic",children:"No messages yet"},"empty"):e.jsxs(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,y:-16},transition:{duration:.15},className:"flex items-center gap-2 sm:gap-1.5",children:[e.jsx("div",{className:"hidden sm:block w-8 h-4 rounded bg-subtle-fill-strong animate-pulse"}),e.jsx("div",{className:"hidden sm:block w-[30px] h-[30px] rounded-full bg-subtle-fill-strong animate-pulse"}),e.jsx("div",{className:"h-8 w-32 sm:w-48 rounded-2xl bg-subtle-fill-strong animate-pulse"}),e.jsx("div",{className:"w-12 h-6 rounded-md bg-subtle-fill-strong animate-pulse"})]},"skeleton")}),e.jsx(Ce,{className:"size-4 text-fg-muted group-hover:text-sys-indigo transition-colors flex-shrink-0 hidden sm:block ml-1"})]})]})}),e.jsx(Fn,{open:n,onClose:()=>a(!1),messages:c,onLoadMore:w,hasMoreToLoad:N,isDecoding:v,initialChannel:o})]}):e.jsx("div",{className:"h-14 rounded-xl bg-elevated/50 animate-pulse"})}function pa(){var M,j;const t=te(),s=Ft(),n=G(),a=Pt(),o=f.useRef(!1);a&&!o.current&&(o.current=!0);const i=o.current,l=X(),m=Pe(),d=At(),r=P[l]??P[4],x=d.isBackgroundLoading&&l>=5,u=(M=t==null?void 0:t.config)==null?void 0:M.radio,g=f.useMemo(()=>u?{sf:u.spreading_factor??10,bw:u.bandwidth??25e4,cr:u.coding_rate??5,preamble:u.preamble_length??8}:null,[u]),c=n.length,h=f.useMemo(()=>c?$t(r.minutes,r.buckets,n,t):null,[c,r.minutes,r.buckets,g]),y=f.useMemo(()=>{const N=R=>(R==null?void 0:R.reduce((B,W)=>B+W.count,0))??0,w=N(h==null?void 0:h.received),C=N(h==null?void 0:h.unique_received),p=N(h==null?void 0:h.forwarded),D=N(h==null?void 0:h.dropped),T=N(h==null?void 0:h.transmitted),_=((h==null?void 0:h.time_range_minutes)??r.minutes)/60,b=_>0?Math.round(w/_):0,S=_>0?Math.round(p/_):0;return{received:w,uniqueReceived:C,forwarded:p,dropped:D,transmitted:T,rxPerHour:b,fwdPerHour:S}},[h,r.minutes]),v=f.useMemo(()=>{if(!n.length)return{totalBytes:0,kbPerHour:0};const N=Date.now()/1e3,w=r.minutes*60,C=N-w;let p=0;for(const _ of n)_.transmitted||_.timestamp<C||_.timestamp>N||(p+=_.length??_.payload_length??0);const D=r.minutes/60,T=D>0?Math.round(p/1024/D):0;return{totalBytes:p,kbPerHour:T}},[n,r.minutes]),k=(t==null?void 0:t.node_name)??((j=t==null?void 0:t.config)==null?void 0:j.node_name)??"Unknown Node";return f.useEffect(()=>{k&&k!=="Unknown Node"&&(document.title=`pyMC: ${k}`)},[k]),s?e.jsxs(ke,{neomorphic:!0,className:"p-8 text-center",children:[e.jsx("p",{className:"type-subheading text-sys-red mb-2",children:"Failed to connect to backend"}),e.jsx("p",{className:"type-body text-fg-muted",children:s}),e.jsx("p",{className:"type-data-sm text-fg-muted mt-4",children:"Make sure the backend is running on port 8000"})]}):e.jsxs(Et,{children:[e.jsx(Ht,{title:k,icon:e.jsx(ns,{}),controls:e.jsx(Ee,{ranges:P,selectedIndex:l,onSelect:m,isPending:x})}),e.jsxs(It,{children:[e.jsx(An,{isLoaded:i}),e.jsx(ie,{template:"hero-auto",children:e.jsxs(ke,{neomorphic:!0,children:[e.jsx(Be,{icon:e.jsx(fs,{}),title:"PACKETS RECEIVED",badge:r.label,badgeColor:"zinc",actions:i?e.jsxs("div",{className:"data-box",children:[v.kbPerHour," KB/hr"]}):e.jsx("div",{className:"data-box opacity-0",children:"0 KB/hr"})}),e.jsxs("div",{className:"flex flex-wrap gap-4 sm:gap-8",children:[e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("div",{className:"type-data-xl text-fg-primary",children:i?e.jsx(V,{value:y.received,className:"font-mono tabular-nums",priority:"high"}):e.jsx("span",{className:"opacity-30",children:"â€”"})}),e.jsx(U,{color:"zinc",className:"mb-0.5 sm:mb-1",children:"Total Rx"})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("div",{className:"type-data-xl text-fg-primary",children:i?e.jsx(V,{value:y.uniqueReceived,className:"font-mono tabular-nums",priority:"high"}):e.jsx("span",{className:"opacity-30",children:"â€”"})}),e.jsx(U,{color:"zinc",className:"mb-0.5 sm:mb-1",children:"Unique"})]})]}),e.jsxs("div",{className:"mt-2 flex-1 min-h-0 relative",children:[e.jsx("div",{className:`absolute inset-0 flex items-end gap-1 transition-opacity duration-300 ${i?"opacity-0 pointer-events-none":"opacity-100"}`,"aria-hidden":i,children:[45,72,33,58,80,42,65,28,55,75,38,62].map((N,w)=>e.jsx("div",{className:"flex-1 bg-subtle-fill rounded-sm animate-pulse",style:{height:`${N}%`}},w))}),e.jsx("div",{className:`h-full transition-opacity duration-300 ${i?"opacity-100":"opacity-0"}`,children:e.jsx(Ls,{packets:n,rangeMinutes:r.minutes,bucketCount:r.buckets})})]})]})}),e.jsxs(ie,{template:"compact",children:[e.jsx(re,{span:6,lg:4,children:e.jsx(Es,{value:y.forwarded,receivedCount:y.received,packets:n,rangeMinutes:r.minutes,bucketCount:r.buckets,timeRangeLabel:r.label,icon:e.jsx(ms,{className:"w-4 h-4"}),isLoaded:i})}),e.jsx(re,{span:6,lg:4,children:e.jsx(Is,{value:y.dropped,receivedCount:y.received,packets:n,rangeMinutes:r.minutes,bucketCount:r.buckets,timeRangeLabel:r.label,icon:e.jsx(Zt,{className:"w-4 h-4"}),isLoaded:i})}),e.jsx(re,{span:12,lg:4,children:e.jsx(Xs,{stats:t,localHash:t==null?void 0:t.local_hash,receivedBuckets:h==null?void 0:h.received,droppedBuckets:h==null?void 0:h.dropped,forwardedBuckets:h==null?void 0:h.forwarded,bucketDurationSeconds:h==null?void 0:h.bucket_duration_seconds,timeRangeLabel:r.label,isLoaded:i})})]}),e.jsx(Sn,{isLoaded:i}),e.jsx(Ks,{}),t&&e.jsx(ie,{template:"auto",children:e.jsx(as,{nodeName:k,repeaterVersion:t.version,coreVersion:t.core_version,localHash:t.local_hash,publicKey:t.public_key})})]})]})}export{pa as default};
