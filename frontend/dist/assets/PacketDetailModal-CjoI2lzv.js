const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PathMapMapLibre-DxhytyJp.js","assets/vendor-react-BXhrzaGn.js","assets/vendor-core-WoOfkQwm.js","assets/BasemapLayer-Dsr6jiMV.js","assets/maplibre-gl-B1CfjdFi.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,s,a)=>((t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a)(t,"symbol"!=typeof s?s+"":s,a);import{r as s,ai as a,aj as n,ae as r,V as l,ad as i,j as c,ak as o,al as d,am as x,an as p,ao as h,ap as m,w as u,aq as y,ar as f,as as g,at as j,au as b,x as N,p as v,av as w,aw as k,ax as C,q as _,a4 as T,n as H,ay as S,b as A,X as P,az as M}from"./vendor-react-BXhrzaGn.js";import{c as L}from"./recharts-CnLSZmAf.js";import{B as U,x as D,y as E,z as B,A as R,C as F,E as I,d as O,G as V,H as $,I as z,c as K,J as G,K as W,M as X}from"./index-BnwqqupC.js";import{S as q,g as Q,a as J}from"./SignalIndicator-C3cRv3Jl.js";import{D as Y}from"./DataBox-DKleVLc9.js";import{_ as Z}from"./deckgl-DTsmDcfs.js";const ee={rx:{icon:i,label:"RX",badgeColor:"sky"},forward:{icon:l,label:"FWD",badgeColor:"teal"},duplicate:{icon:r,label:"DUPE",badgeColor:"zinc"},tx:{icon:n,label:"TX",badgeColor:"amber"},dropped:{icon:a,label:"DROP",badgeColor:"rose"}},te={sm:"w-3 h-3",md:"w-3.5 h-3.5",lg:"w-4 h-4"};function se(e){return"tx_local"===e.packet_origin?"tx":"tx_forward"===e.packet_origin?"forward":e.is_duplicate?"duplicate":e.transmitted?"forward":e.drop_reason?"dropped":"rx"}const ae=s.memo(function({packet:e,showLabel:t=!0,size:s="sm"}){const a=se(e),n=ee[a],r=n.icon;return c.jsxs(U,{color:n.badgeColor,children:[c.jsx(r,{className:te[s]}),t&&n.label]})});function ne(e){return"tx_local"===e.packet_origin?"Transmitted":"tx_forward"===e.packet_origin||e.transmitted?"Forwarded":e.is_duplicate?"Duplicate":"No transport keys configured"===e.drop_reason?"Monitor Only":e.drop_reason?e.drop_reason:"Received"}function re(e){return ee[se(e)].badgeColor}const le={ADVERT:"blue",ACK:"emerald",REQ:"sky",RESPONSE:"sky",TXT_MSG:"teal",GRP_TXT:"teal",FLOOD:"sky",GRP_DATA:"indigo",PATH:"violet",MULTIPART:"purple",TRACE:"orange",ANON_REQ:"amber",RAW_CUSTOM:"fuchsia"},ie={FLOOD:"sky",T_FLOOD:"sky",DIRECT:"amber",T_DIRECT:"amber"};function ce(e){const t=e.payload_type_name||R(e.payload_type??e.type),s=e.route_type_name||F(e.route_type??e.route);return{payloadType:t,routeType:s,payloadColor:le[t]??"zinc",routeColor:ie[s]??"zinc"}}function oe({packet:e,onClick:t,isFlashing:s=!1,isPending:a}){const{payloadType:n,routeType:r,payloadColor:l,routeColor:i}=ce(e),d="tx_local"===e.packet_origin,x=a??e.isPending;return c.jsxs("tr",{onClick:()=>t(e),className:L("cursor-pointer","hover:bg-bg-subtle",E(e.is_duplicate)&&"opacity-50",s&&"flash-row",x&&"opacity-70 bg-accent-secondary/5",d&&"ring-1 ring-inset ring-accent-primary/60 bg-accent-primary/5"),children:[c.jsx("td",{className:"py-2.5 px-3 whitespace-nowrap",children:c.jsxs("div",{className:"inline-flex items-center gap-1",children:[c.jsx(ae,{packet:e,showLabel:!0}),c.jsx("span",{className:"w-3 h-3 inline-flex items-center justify-center",children:x&&c.jsx(o,{className:"w-3 h-3 text-accent-secondary animate-spin"})})]})}),c.jsx("td",{className:"py-2.5 px-3 text-sm font-mono text-text-secondary whitespace-nowrap",children:B(e.timestamp)}),c.jsx("td",{className:"py-2.5 px-3 whitespace-nowrap",children:e.src_hash?c.jsx(Y,{copy:!0,copyValue:e.src_hash_full,size:"compact",children:e.src_hash}):c.jsx("span",{className:"text-sm text-text-muted",children:"—"})}),c.jsx("td",{className:"py-2.5 px-3 whitespace-nowrap",children:c.jsx(U,{color:l,children:n})}),c.jsx("td",{className:"py-2.5 px-3 whitespace-nowrap",children:c.jsx(U,{color:i,children:r})}),c.jsx("td",{className:"py-2.5 px-3 pr-4 whitespace-nowrap",children:c.jsx("div",{className:"flex justify-end",children:c.jsx(q,{rssi:e.rssi,snr:e.snr,compact:!0,showValues:!0})})})]})}const de=s.memo(function(e){return c.jsx(oe,{...e})}),xe=s.memo(function({packet:e,onClick:t,isFlashing:s=!1,isPending:a}){const{payloadType:n,routeType:r,payloadColor:l,routeColor:i}=ce(e),d="tx_local"===e.packet_origin,x=a??e.isPending;return c.jsx("div",{onClick:()=>t(e),className:L("packet-row px-3 py-2.5 cursor-pointer","hover:bg-bg-subtle","active:bg-bg-elevated",E(e.is_duplicate)&&"opacity-50",s&&"flash-row",x&&"opacity-70 bg-accent-secondary/5",d&&"ring-1 ring-inset ring-accent-primary/60 bg-accent-primary/5"),children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1",children:[c.jsx(ae,{packet:e,showLabel:!0,size:"sm"}),c.jsx("span",{className:"w-3 h-3 inline-flex items-center justify-center",children:x&&c.jsx(o,{className:"w-3 h-3 text-accent-secondary animate-spin"})})]}),c.jsx("span",{className:"text-[10px] font-mono text-text-muted flex-shrink-0",children:D(e.timestamp)}),c.jsx("div",{className:"flex-shrink-0",children:e.src_hash?c.jsx(Y,{copy:!0,copyValue:e.src_hash_full,size:"compact",children:e.src_hash}):c.jsx("span",{className:"text-[10px] text-text-muted",children:"—"})}),c.jsx("div",{className:"flex-1 min-w-0"}),c.jsx(U,{color:l,className:"flex-shrink-0",children:n}),c.jsx(U,{color:i,className:"flex-shrink-0",children:r}),c.jsx("div",{className:"flex-shrink-0",children:c.jsx(q,{rssi:e.rssi,compact:!0,showValues:!0})})]})})});function pe(e){if(e.contact_type){const t=e.contact_type.toLowerCase();if("repeater"===t||"rep"===t)return!0;if("companion"===t||"client"===t||"cli"===t)return!1;if("room server"===t||"room_server"===t||"room"===t||"server"===t)return!1}return!0===e.is_repeater||(e.is_repeater,!1)}const he=s.lazy(()=>Z(()=>import("./PathMapMapLibre-DxhytyJp.js"),__vite__mapDeps([0,1,2,3,4])));function me(e){return`${(100*e).toFixed(0)}%`}function ue(e,t){const s=document.documentElement,a=getComputedStyle(s),n={success:a.getPropertyValue("--accent-success").trim()||"#39D98A",secondary:a.getPropertyValue("--accent-secondary").trim()||"#F9D26F",poor:a.getPropertyValue("--signal-poor").trim()||"#FF8A5C",danger:a.getPropertyValue("--accent-danger").trim()||"#FF5C7A",muted:a.getPropertyValue("--text-muted").trim()||"#767688"};let r;return r=0===t?n.muted:e>=1?n.success:e>=.5?n.secondary:e>=.25?n.poor:e>0?n.danger:n.muted,{color:r}}class ye extends s.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?c.jsxs("div",{className:"h-[200px] flex items-center justify-center text-text-muted",children:[c.jsx(p,{className:"w-4 h-4 mr-2"}),"Map failed to load"]}):this.props.children}}function fe({path:e,neighbors:t,localNode:a,localHash:n,srcHash:r,dstHash:l,neighborAffinity:i,prefixLookup:o,hubNodes:p}){const[h,m]=s.useState(null),u=s.useMemo(()=>{if(!r)return null;const e=O(r),s=t[r];if((null==s?void 0:s.latitude)&&(null==s?void 0:s.longitude)&&(0!==s.latitude||0!==s.longitude))return{prefix:e,candidates:[{hash:r,name:s.node_name||s.name||"Source",latitude:s.latitude,longitude:s.longitude,probability:1,isLocal:!1,isDirectNeighbor:!0===s.zero_hop}],confidence:1,totalMatches:1,isSource:!0};const a=(null==s?void 0:s.node_name)||(null==s?void 0:s.name)||r.slice(0,8);return{prefix:e,candidates:[{hash:r,name:a,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isSource:!0}},[r,t]),y=s.useMemo(()=>{if(!l)return null;const e=O(l);if(n&&l===n&&a){const t=0!==a.latitude||0!==a.longitude;return{prefix:e,candidates:[{hash:l,name:a.name||"Local Node",latitude:t?a.latitude:0,longitude:t?a.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}const s=t[l];if((null==s?void 0:s.latitude)&&(null==s?void 0:s.longitude)&&(0!==s.latitude||0!==s.longitude))return{prefix:e,candidates:[{hash:l,name:s.node_name||s.name||"Destination",latitude:s.latitude,longitude:s.longitude,probability:1,isLocal:!1,isDirectNeighbor:!0===s.zero_hop}],confidence:1,totalMatches:1,isDestination:!0};const r=(null==s?void 0:s.node_name)||(null==s?void 0:s.name)||l.slice(0,8);return{prefix:e,candidates:[{hash:l,name:r,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isDestination:!0}},[l,t,a,n]),f=s.useMemo(()=>function(e,t,s,a,n,r){if(!e||0===e.length)return{hops:[],overallConfidence:0,hasValidPath:!1};const l=e.length-1,i=e.map((i,c)=>{const o=c===l,d=e.length-c,{candidates:x,totalMatches:p}=function(e,t,s,a,n=!1,r,l,i){const c=function(e){const t={};for(const[s,a]of Object.entries(e))pe(a)&&(t[s]=a);return t}(t);let o;if(l){const t=function(e,t,s){const a=t.toUpperCase(),n=e.get(a);if(!n||0===n.candidates.length)return{hash:null,confidence:0};if(null==s?void 0:s.isLastHop)return{hash:n.bestMatch,confidence:n.confidence};if(1===(null==s?void 0:s.position))return{hash:n.bestMatch,confidence:n.confidence};if((null==s?void 0:s.position)&&n.bestMatchForPosition.has(s.position)){const e=n.bestMatchForPosition.get(s.position),t=Math.max(e.confidence,n.confidence);return{hash:e.hash,confidence:t}}if((null==s?void 0:s.adjacentPrefixes)&&s.adjacentPrefixes.length>0){let e=n.bestMatch,t=0;for(const a of n.candidates){let n=0;for(const e of s.adjacentPrefixes)n+=a.adjacentPrefixCounts.get(e.toUpperCase())||0;const r=a.combinedScore+n/Math.max(1,a.totalAdjacentObservations)*.3;r>t&&(t=r,e=a.hash)}return{hash:e,confidence:n.confidence}}return{hash:n.bestMatch,confidence:n.confidence}}(l,e,{position:i,isLastHop:n});o=t.confidence}const{matches:d,probability:x}=function(e,t,s,a,n=!1){const r=e.toUpperCase(),l=[],i=s&&I(r,s);i&&l.push(s);for(const h of Object.keys(t))I(r,h)&&l.push(h);if(n&&i&&s&&1===l.length)return{matches:l,probability:1,bestMatch:s};if(n&&i&&l.length>1){const e=l.filter(e=>e!==s);if(1===e.length)return{matches:l,probability:1,bestMatch:e[0]}}const c=l.length>0?1/l.length:0,o=[...l].sort();let d=null,x=-1;if(1===o.length)d=o[0];else if(o.length>1&&a){for(const e of o){const t=a.get(e),s=t?"number"==typeof t?t:t.combinedScore:0;s>x&&(x=s,d=e)}d||(d=o[0])}else o.length>0&&(d=o[0]);let p=c;if(l.length>1&&a&&x>0){let e=0;for(const t of l){const s=a.get(t);e+=s?"number"==typeof s?s:s.combinedScore:0}e>0&&(p=Math.min(.95,x/e))}return{matches:l,probability:p,bestMatch:d}}(e,c,a,r,n),p=d.length,h=[],m=e.toUpperCase(),u=s&&void 0!==s.latitude&&void 0!==s.longitude&&(0!==s.latitude||0!==s.longitude);for(const f of d){if(a&&I(m,a)&&f===a&&u&&s){h.push({hash:f,name:s.name||"Local Node",latitude:s.latitude,longitude:s.longitude,probability:n?1:x,isLocal:!0});continue}const e=c[f];(null==e?void 0:e.latitude)&&(null==e?void 0:e.longitude)&&(0!==e.latitude||0!==e.longitude)&&h.push({hash:f,name:e.node_name||e.name||"Unknown",latitude:e.latitude,longitude:e.longitude,probability:x,isLocal:!1,isDirectNeighbor:!0===e.zero_hop})}const y=h.length;if(1===y)h[0].probability=o??1;else if(y>1)if(void 0!==o&&o>0){h[0].probability=o;const e=1-o,t=y-1;h.slice(1).forEach(s=>{s.probability=e/t})}else{let e=0;const t=h.map(t=>{if(t.isLocal)return{candidate:t,score:1};const a=null==r?void 0:r.get(t.hash);let n=.5;var l;let i;return u&&s&&(n=(l=function(e,t,s,a){const n=(s-e)*Math.PI/180,r=(a-t)*Math.PI/180,l=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3}(s.latitude,s.longitude,t.latitude,t.longitude))<100?1:l<500?.9:l<1e3?.7:l<5e3?.5:l<1e4?.3:.1),a?i=.3*n+.3*a.hopConsistencyScore+.4*a.frequencyScore:(i=n,t.isDirectNeighbor&&(i=Math.max(i,.8))),e+=i,{candidate:t,score:i}});if(e>0)t.forEach(({candidate:t,score:s})=>{t.probability=Math.min(.95,s/e)});else{const e=1/y;h.forEach(t=>t.probability=e)}}return{candidates:h,totalMatches:p}}(i,t,s,a,o,n,r,d),h=x.length>0?Math.max(...x.map(e=>e.probability)):0;return{prefix:i,candidates:x,confidence:h,totalMatches:p}}),c=i.reduce((e,t)=>0===t.confidence?0:e*t.confidence,1),o=i.some(e=>e.candidates.length>0);return{hops:i,overallConfidence:c,hasValidPath:o}}(e,t,a,n,i,o),[e,t,a,n,i,o]),g=s.useMemo(()=>{const e=[];u&&e.push(u),e.push(...f.hops),y&&e.push(y);const t=e.reduce((e,t)=>0===t.confidence?0:e*t.confidence,1),s=e.some(e=>e.candidates.some(e=>0!==e.latitude||0!==e.longitude));return{hops:e,overallConfidence:t,hasValidPath:s}},[u,f,y]);return g.hasValidPath?c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center justify-between text-xs",children:[c.jsxs("div",{className:"flex items-center gap-1.5",children:[c.jsx("span",{className:"text-text-muted",children:"Path Confidence:"}),c.jsx("span",{className:(j=g.overallConfidence,j>=1?"text-accent-success":j>=.5?"text-accent-secondary":j>=.25?"text-signal-poor":j>0?"text-accent-danger":"text-text-muted"),children:me(g.overallConfidence)}),c.jsx("button",{className:"text-text-muted hover:text-text-secondary transition-colors",title:"Confidence is calculated based on how many known nodes match each path prefix. Multiple matches reduce confidence due to collision probability.",children:c.jsx(x,{className:"w-3 h-3"})})]}),c.jsxs("div",{className:"flex items-center gap-2 text-[10px]",children:[c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("div",{className:"w-2 h-2 rounded-full bg-accent-success"}),c.jsx("span",{className:"text-text-muted",children:"Exact"})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("div",{className:"w-2 h-2 rounded-full bg-accent-secondary"}),c.jsx("span",{className:"text-text-muted",children:"Multi"})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("div",{className:"w-2 h-2 rounded-full bg-text-muted"}),c.jsx("span",{className:"text-text-muted",children:"Unknown"})]})]})]}),c.jsx("div",{className:"rounded-lg overflow-hidden border border-border-subtle",children:c.jsx(ye,{children:c.jsx(s.Suspense,{fallback:c.jsx("div",{className:"h-[200px] bg-bg-elevated flex items-center justify-center text-text-muted text-sm",children:"Loading map..."}),children:c.jsx(he,{resolvedPath:g,localNode:a,hubNodes:p,hoveredHopIndex:h,onHoverHop:m})})})}),c.jsx("div",{className:"flex flex-wrap items-center gap-1.5",children:g.hops.map((e,t)=>{var s,a,n;const r=!0===e.isSource,l=!0===e.isDestination,i=h===t;let o;return o=r?`Source: ${(null==(s=e.candidates[0])?void 0:s.name)||"Unknown"}`:l?`Destination: ${(null==(a=e.candidates[0])?void 0:a.name)||"Unknown"}`:0===e.totalMatches?"No matching nodes found":1===e.totalMatches?`Exact match: ${(null==(n=e.candidates[0])?void 0:n.name)||"Unknown"}`:`${e.totalMatches} possible matches (${(100*e.confidence).toFixed(0)}% confidence)`,c.jsxs("div",{className:L("flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-mono cursor-pointer transition-all",i?"bg-accent-primary/20 ring-1 ring-accent-primary/50":"bg-bg-elevated hover:bg-bg-subtle",r&&"border border-accent-success/30",l&&"border border-accent-primary/30"),title:o,onMouseEnter:()=>m(t),onMouseLeave:()=>m(null),children:[r&&c.jsx("span",{className:"text-accent-success text-[8px] mr-0.5",children:"SRC"}),l&&c.jsx("span",{className:"text-accent-primary text-[8px] mr-0.5",children:"DST"}),c.jsx("span",{style:ue(e.confidence,e.totalMatches),children:e.prefix}),!r&&!l&&e.totalMatches>1&&c.jsxs("span",{className:"text-text-muted",children:["×",e.totalMatches]}),!r&&!l&&0===e.totalMatches&&c.jsx("span",{className:"text-text-muted",children:"?"})]},t)})})]}):c.jsxs("div",{className:"flex items-center justify-center text-text-muted text-xs py-4",children:[c.jsx(d,{className:"w-3.5 h-3.5 mr-1.5 opacity-50"}),"No location data available for path nodes"]});var j}const ge=0,je=1,be=2,Ne=3,ve={[ge]:"T_FLOOD",[je]:"FLOOD",[be]:"DIRECT",[Ne]:"T_DIRECT"},we=0,ke=1,Ce=2,_e=3,Te=4,He=5,Se=6,Ae=7,Pe=8,Me=9,Le=10,Ue=11,De=15,Ee={[we]:"REQ",[ke]:"RESPONSE",[Ce]:"TXT_MSG",[_e]:"ACK",[Te]:"ADVERT",[He]:"GRP_TXT",[Se]:"GRP_DATA",[Ae]:"ANON_REQ",[Pe]:"PATH",[Me]:"TRACE",[Le]:"MULTIPART",[Ue]:"CONTROL",[De]:"RAW_CUSTOM"};function Be(e){const t=e.replace(/^0x/i,"").replace(/\s/g,"");if(t.length%2!=0)throw new Error("Invalid hex string: odd number of characters");const s=new Uint8Array(t.length/2);for(let a=0;a<s.length;a++){const e=parseInt(t.substr(2*a,2),16);if(isNaN(e))throw new Error("Invalid hex character at position "+2*a);s[a]=e}return s}function Re(e,t=!0,s=!1){let a=Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join("");return t&&(a=a.toUpperCase()),s&&(a="0x"+a),a}function Fe(e,t=!0){const s=(255&e).toString(16).padStart(2,"0");return t?s.toUpperCase():s}function Ie(e,t,s,a){if(e+t>s)throw new Error(a)}function Oe(e){if(e>256)throw new Error(`payload too large: ${e} > 256`)}async function Ve(e){const t=new ArrayBuffer(e.length);new Uint8Array(t).set(e);const s=await crypto.subtle.digest("SHA-256",t);return new Uint8Array(s)}async function $e(e,t){const s=new ArrayBuffer(e.length);new Uint8Array(s).set(e);const a=new ArrayBuffer(t.length);new Uint8Array(a).set(t);const n=await crypto.subtle.importKey("raw",s,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),r=await crypto.subtle.sign("HMAC",n,a);return new Uint8Array(r)}const ze=new Uint8Array([99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22]),Ke=new Uint8Array([82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125]),Ge=new Uint8Array([1,2,4,8,16,32,64,128,27,54]);function We(e,t){let s=0;for(let a=0;a<8;a++){1&t&&(s^=e);const a=128&e;e=e<<1&255,a&&(e^=27),t>>=1}return s}function Xe(e){let t=e[13];e[13]=e[9],e[9]=e[5],e[5]=e[1],e[1]=t,t=e[2],e[2]=e[10],e[10]=t,t=e[6],e[6]=e[14],e[14]=t,t=e[3],e[3]=e[7],e[7]=e[11],e[11]=e[15],e[15]=t}function qe(e){for(let t=0;t<16;t++)e[t]=Ke[e[t]]}function Qe(e,t){for(let s=0;s<16;s++)e[s]^=t[s]}function Je(e){for(let t=0;t<4;t++){const s=4*t,a=e[s],n=e[s+1],r=e[s+2],l=e[s+3];e[s]=We(14,a)^We(11,n)^We(13,r)^We(9,l),e[s+1]=We(9,a)^We(14,n)^We(11,r)^We(13,l),e[s+2]=We(13,a)^We(9,n)^We(14,r)^We(11,l),e[s+3]=We(11,a)^We(13,n)^We(9,r)^We(14,l)}}function Ye(e,t){const s=new Uint8Array(e);Qe(s,t[10]);for(let a=9;a>=1;a--)Xe(s),qe(s),Qe(s,t[a]),Je(s);return Xe(s),qe(s),Qe(s,t[0]),s}function Ze(e,t){const s=function(e){const t=[],s=new Uint8Array(176);s.set(e.slice(0,16));for(let a=16;a<176;a+=4){let e=s[a-4],t=s[a-3],n=s[a-2],r=s[a-1];if(a%16==0){const s=e;e=ze[t]^Ge[a/16-1],t=ze[n],n=ze[r],r=ze[s]}s[a]=s[a-16]^e,s[a+1]=s[a-15]^t,s[a+2]=s[a-14]^n,s[a+3]=s[a-13]^r}for(let a=0;a<11;a++)t.push(s.slice(16*a,16*(a+1)));return t}(e),a=new Uint8Array(t.length);for(let n=0;n<t.length;n+=16){const e=t.slice(n,Math.min(n+16,t.length)),r=new Uint8Array(16);r.set(e);const l=Ye(r,s);a.set(l.slice(0,e.length),n)}return a}async function et(e,t,s){const a=[e];9===e&&a.push(t);const n=new Uint8Array(a.length+s.length);return n.set(a),n.set(s,a.length),(await Ve(n)).slice(0,32)}async function tt(e,t,s,a){const n=Re(await et(e,t,s),!0);return void 0!==a?n.slice(0,a):n}async function st(e,t,s){const a=await et(e,t,s);return(a[0]|a[1]<<8|a[2]<<16|a[3]<<24)>>>0}function at(e,t){return e[t]|e[t+1]<<8}function nt(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function rt(e,t,s){t[s]=255&e,t[s+1]=e>>8&255}function lt(e,t){const s=e[t];return s>127?s-256:s}function it(e){return(e instanceof Uint8Array?Array.from(e):e).map(e=>Fe(e,!0)).join("->")}const ct=Object.freeze(Object.defineProperty({__proto__:null,aesDecryptEcb:Ze,byteToHex:Fe,bytesToHex:Re,calculatePacketCRC:st,calculatePacketHash:et,calculatePacketHashString:tt,decryptChannelMessage:async function(e,t,s,a){const n=await $e(e,a);return s[0]!==n[0]||s[1]!==n[1]?null:Ze(t,a)},formatPathString:it,hexToBytes:Be,hmacSha256:$e,readInt8:lt,readUint16LE:at,readUint32LE:nt,sha256:Ve,validatePacketBounds:Ie,validatePayloadSize:Oe,writeUint16LE:rt},Symbol.toStringTag,{value:"Module"}));class ot{constructor(){t(this,"header",0),t(this,"transportCodes",[0,0]),t(this,"pathLen",0),t(this,"path",new Uint8Array(0)),t(this,"payload",new Uint8Array(0)),t(this,"decrypted",{}),t(this,"_rssi",0),t(this,"_snr",0)}static fromBytes(e){const t=new ot;try{return t.readFrom(e),{success:!0,packet:t}}catch(s){return{success:!1,error:s instanceof Error?s.message:String(s)}}}static fromHex(e){try{const t=Be(e);return ot.fromBytes(t)}catch(t){return{success:!1,error:t instanceof Error?t.message:String(t)}}}get routeType(){return 3&this.header}get routeTypeName(){return ve[this.routeType]??`UNKNOWN(${this.routeType})`}get payloadType(){return this.header>>2&15}get payloadTypeName(){return Ee[this.payloadType]??`UNKNOWN(${this.payloadType})`}get payloadVersion(){return this.header>>6&3}hasTransportCodes(){return 0===(e=this.routeType)||3===e;var e}isFlood(){return 1===(e=this.routeType)||0===e;var e}isDirect(){return 2===(e=this.routeType)||3===e;var e}get pathBytes(){return Array.from(this.path)}get pathString(){return it(this.path)}get pathHexArray(){return Array.from(this.path).map(e=>Fe(e,!0))}get payloadLen(){return this.payload.length}get payloadHex(){return Re(this.payload,!0)}getPayloadAppData(){return this.payload.length>=100?this.payload.slice(100):new Uint8Array(0)}get rssi(){return this._rssi}set rssi(e){this._rssi=e}get snr(){return this._snr}set snr(e){this._snr=e}readFrom(e){let t=0;const s=e.length;Ie(t,1,s,"Missing header byte"),this.header=e[t++];const a=this.payloadVersion;if(a>1)throw new Error(`Unsupported packet version: ${a}`);if(this.hasTransportCodes()?(Ie(t,4,s,"Missing transport codes"),this.transportCodes=[at(e,t),at(e,t+2)],t+=4):this.transportCodes=[0,0],Ie(t,1,s,"Missing path_len"),this.pathLen=e[t++],this.pathLen>64)throw new Error(`path_len too large: ${this.pathLen} > 64`);return Ie(t,this.pathLen,s,"Truncated path"),this.path=e.slice(t,t+this.pathLen),t+=this.pathLen,this.payload=e.slice(t),Oe(this.payload.length),!0}writeTo(){let e=1;this.hasTransportCodes()&&(e+=4),e+=1,e+=this.path.length,e+=this.payload.length;const t=new Uint8Array(e);let s=0;return t[s++]=this.header,this.hasTransportCodes()&&(rt(this.transportCodes[0],t,s),rt(this.transportCodes[1],t,s+2),s+=4),t[s++]=this.path.length,t.set(this.path,s),s+=this.path.length,t.set(this.payload,s),t}toHex(){return Re(this.writeTo(),!0)}async calculateHash(){return et(this.payloadType,this.pathLen,this.payload)}async calculateHashString(e){return tt(this.payloadType,this.pathLen,this.payload,e)}async calculateCRC(){return st(this.payloadType,this.pathLen,this.payload)}getRawLength(){let e=2+this.pathLen+this.payload.length;return this.hasTransportCodes()&&(e+=4),e}getSummary(){return{header:Fe(this.header,!0),routeType:this.routeTypeName,payloadType:this.payloadTypeName,version:this.payloadVersion,pathLen:this.pathLen,pathStr:this.pathString,transportCodes:this.hasTransportCodes()?[this.transportCodes[0].toString(16).toUpperCase().padStart(4,"0"),this.transportCodes[1].toString(16).toUpperCase().padStart(4,"0")]:null,payloadLen:this.payload.length,payloadHex:this.payloadHex,rawLength:this.getRawLength()}}toString(){const e=[`[${this.routeTypeName}/${this.payloadTypeName} v${this.payloadVersion}]`,`path=${this.pathString||"(empty)"}`,`payload=${this.payload.length}B`];return this.hasTransportCodes()&&e.push(`transport=[${this.transportCodes[0]},${this.transportCodes[1]}]`),e.join(" ")}}function dt(e,t,s){return{type:"generic",payloadType:t,payloadTypeName:s,rawHex:Re(e),length:e.length}}const xt=[{name:"Public",secret:"8b3387e9c5cdea6ac9e5edbaa115cd72"},{name:"#Test",secret:"9cd8fcf22a47333b591d96a2b848b73f"},{name:"#Wardrive",secret:"4076c315c1ef385fa93f066027320fe5"}];async function pt(e){const t=function(e){const t=new Uint8Array(e.length/2);for(let s=0;s<t.length;s++)t[s]=parseInt(e.substr(2*s,2),16);return t}(e.secret),s=(await Ve(t))[0];let a;t.length<32?(a=new Uint8Array(32),a.set(t)):a=t.length>32?t.slice(0,32):t;const n=a.slice(0,16),r=a;return{name:e.name,channelHash:s,aesKey:n,hmacKey:r}}let ht=null,mt=null;async function ut(){ht||(mt||(mt=async function(){if(!ht){ht=new Map;for(const t of xt)try{const e=await pt(t);ht.set(e.channelHash,e)}catch(e){}}}()),await mt)}ut().catch(e=>{});const yt=Object.freeze(Object.defineProperty({__proto__:null,getChannelKeys:async function(e){return await ut(),(null==ht?void 0:ht.get(e))??null}},Symbol.toStringTag,{value:"Module"}));function ft(e){return e.match(/.{1,2}/g)||[]}function gt({segments:e}){const t=[];for(const a of e){const e=ft(a.hex);for(const s of e)t.push({byte:s.toUpperCase(),pillClass:a.pillClass})}const s=[];for(let a=0;a<t.length;a+=16)s.push(t.slice(a,a+16));return c.jsx("div",{className:"space-y-1",children:s.map((e,t)=>{const s=e.length<16;return c.jsx("div",{className:"grid rounded-md overflow-hidden",style:{gridTemplateColumns:"repeat(16, minmax(0, 1fr))"},children:e.map(({byte:t,pillClass:a},n)=>{const r=n===e.length-1,l=s&&r;return c.jsx("span",{className:`color-pill-filled ${a} text-xs text-center py-1 font-mono`,style:l?{borderRadius:"0 0.375rem 0.375rem 0"}:void 0,children:t},n)})},t)})})}function jt({bits:e,field:t,value:s,binary:a}){return c.jsxs("tr",{children:[c.jsx("td",{className:"py-1.5 text-xs text-text-muted tabular-nums",children:e}),c.jsx("td",{className:"py-1.5 text-sm text-text-secondary",children:t}),c.jsx("td",{className:"py-1.5",children:(()=>{if("Payload Type"===t){const{bgColor:e,textColor:t}=$(s);return c.jsx("span",{className:"color-pill color-pill-filled",style:{"--pill-color":e,"--pill-text":t},children:s})}return"Route Type"===t?c.jsx("span",{className:"color-pill",style:{"--pill-color":z(s)},children:s}):c.jsx("span",{className:"text-sm text-text-primary",children:s})})()}),c.jsx("td",{className:"py-1.5 font-mono text-xs text-sys-cyan",children:a})]})}function bt({title:e,pillClass:t,hexBytes:s,startByte:a,endByte:n,children:r}){const l=s?ft(s):[];return c.jsxs("div",{className:"bg-black/[0.03] dark:bg-white/[0.03] rounded-2xl p-6 space-y-4",children:[c.jsxs("div",{className:"flex items-start justify-between gap-4",children:[c.jsxs("div",{className:"flex flex-wrap items-center gap-0.5",children:[c.jsx("span",{className:`color-pill color-pill-filled ${t}`,children:e}),l.length>0&&l.length<=16&&l.map((e,s)=>c.jsx("span",{className:`color-pill color-pill-filled ${t} font-mono`,children:e.toUpperCase()},s))]}),c.jsxs("span",{className:"text-[10px] text-text-muted font-mono flex-shrink-0",children:["Bytes ",a,"-",n]})]}),c.jsx("div",{children:r})]})}function Nt({title:e,pillClass:t,startByte:a,endByte:n,children:r,defaultOpen:l=!1}){const[i,o]=s.useState(l);return c.jsxs("div",{className:"glass-card-inner overflow-hidden",children:[c.jsxs("button",{onClick:()=>o(!i),className:"w-full p-2 flex items-center justify-between text-left hover:bg-bg-subtle/50 transition-colors",children:[c.jsx("span",{className:`color-pill color-pill-filled ${t}`,children:e}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:["Bytes ",a,"-",n]}),i?c.jsx(v,{className:"w-3.5 h-3.5 text-text-muted"}):c.jsx(w,{className:"w-3.5 h-3.5 text-text-muted"})]})]}),i&&c.jsx("div",{className:"px-2 pb-2 space-y-1",children:r})]})}function vt({advert:e,timestamp:t}){const s=V(t||e.timestamp);return c.jsx("div",{className:"mb-4",children:c.jsxs("div",{className:"rounded-2xl overflow-hidden bg-purple-500/10 dark:bg-purple-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[c.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[c.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-purple) 0%, var(--sys-blue) 100%)"},children:c.jsx(N,{className:"w-6 h-6 text-white"})}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:e.name||"Unknown Node"}),c.jsx("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:e.nodeType})]})]}),c.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),c.jsxs("div",{className:"px-4 py-3 space-y-2",children:[void 0!==e.latitude&&void 0!==e.longitude&&c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(d,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 flex-shrink-0"}),c.jsxs("span",{className:"text-sm text-text-secondary font-mono",children:[e.latitude.toFixed(5),"°, ",e.longitude.toFixed(5),"°"]})]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(u,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 flex-shrink-0"}),c.jsx("span",{className:"text-sm text-text-secondary font-sans",children:s})]})]})]})})}function wt({decoded:e,timestamp:t}){const s=t?V(t):"Unknown";return c.jsx("div",{className:"mb-4",children:c.jsxs("div",{className:"rounded-2xl overflow-hidden bg-teal-500/10 dark:bg-teal-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[c.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[c.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-teal) 0%, var(--sys-cyan) 100%)"},children:c.jsx(b,{className:"w-6 h-6 text-white"})}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:e.channelName||"Channel Data"}),c.jsxs("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:[e.dataLength," bytes • ",e.decrypted?"Decrypted":"Encrypted"]})]})]}),c.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),c.jsxs("div",{className:"px-4 py-3 space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(m,{className:"w-4 h-4 text-teal-600 dark:text-teal-400 flex-shrink-0"}),c.jsxs("span",{className:"text-sm text-text-secondary font-sans",children:["Channel: ",c.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]})]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(u,{className:"w-4 h-4 text-teal-600 dark:text-teal-400 flex-shrink-0"}),c.jsx("span",{className:"text-sm text-text-secondary font-sans",children:s})]}),e.decrypted&&e.decryptedHex&&c.jsxs("div",{className:"mt-2 pt-2 border-t border-black/10 dark:border-white/10",children:[c.jsx("p",{className:"text-[10px] uppercase tracking-wide text-text-muted mb-1 font-sans",children:"Decrypted Data"}),c.jsx("div",{className:"max-w-full overflow-x-auto",children:c.jsx(Y,{size:"compact",copy:!0,className:"inline-block",children:c.jsx("span",{className:"break-all text-xs",children:e.decryptedHex.toUpperCase()})})})]})]})]})})}function kt({decoded:e}){return e.decrypted?c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.senderName&&c.jsxs("span",{className:"text-[11px] text-text-muted font-sans",children:["From ",c.jsx("span",{className:"text-text-secondary font-medium",children:e.senderName})]}),e.channelName&&c.jsxs("span",{className:"text-[11px] text-text-muted font-sans",children:["in ",c.jsx("span",{className:"text-sys-cyan font-medium",children:e.channelName})]})]}),c.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tl-md",style:{background:"linear-gradient(135deg, var(--sys-blue) 0%, color-mix(in srgb, var(--sys-blue) 85%, var(--sys-cyan)) 100%)"},children:c.jsx("p",{className:"text-sm text-white font-sans leading-relaxed whitespace-pre-wrap break-words",children:e.text})})]}):null}function Ct({decoded:e,timestamp:t}){const s=t?V(t):"Unknown";return c.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[c.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:"linear-gradient(135deg, var(--sys-green) 0%, var(--sys-teal) 100%)"},children:c.jsx(j,{className:"w-5 h-5 text-white"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"text-sm font-semibold text-text-primary font-sans",children:"Acknowledgment"}),c.jsxs("p",{className:"text-xs text-text-muted font-sans mt-0.5",children:["CRC: ",c.jsxs("span",{className:"font-mono text-sys-green",children:["0x",e.crc]})," · ",s]})]})]})}function _t({decoded:e,timestamp:t}){const s=t?V(t):"Unknown",a=e.path.length;return c.jsx("div",{className:"mb-4",children:c.jsxs("div",{className:"rounded-2xl overflow-hidden bg-amber-500/10 dark:bg-amber-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[c.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[c.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-amber) 0%, var(--sys-orange) 100%)"},children:c.jsx(g,{className:"w-6 h-6 text-white"})}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:"Path Response"}),c.jsxs("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:[a," ",1===a?"hop":"hops"]})]})]}),c.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),c.jsxs("div",{className:"px-4 py-3 space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(u,{className:"w-4 h-4 text-amber-600 dark:text-amber-400 flex-shrink-0"}),c.jsx("span",{className:"text-sm text-text-secondary font-sans",children:s})]}),e.path.length>0&&c.jsx("div",{className:"mt-2 pt-2 border-t border-black/10 dark:border-white/10",children:c.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.path.map((e,t)=>c.jsxs("div",{className:"flex items-center gap-2",children:[t>0&&c.jsx(l,{className:"w-4 h-4 text-amber-500 dark:text-amber-400"}),c.jsx("span",{className:"color-pill color-pill-filled color-pill-amber font-mono",children:e})]},t))})})]})]})})}function Tt({decoded:e,timestamp:t}){const s=t?V(t):"Unknown",a=e.path.length;return c.jsx("div",{className:"mb-4",children:c.jsxs("div",{className:"rounded-2xl overflow-hidden bg-blue-500/10 dark:bg-blue-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[c.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[c.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-blue) 0%, var(--sys-indigo) 100%)"},children:c.jsx(f,{className:"w-6 h-6 text-white"})}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("h3",{className:"text-lg font-medium text-text-primary truncate leading-tight",children:"Trace Response"}),c.jsxs("p",{className:"text-sm text-text-muted mt-0.5",children:[a," ",1===a?"hop":"hops"," with SNR"]})]})]}),c.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),c.jsxs("div",{className:"px-4 py-3 space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(u,{className:"w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0"}),c.jsx("span",{className:"text-sm text-text-secondary",children:s})]}),e.path.length>0&&c.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.path.map((t,s)=>{const a=e.snrValues[s],n=void 0!==a?(e=>e>=7?"color-pill-green":e>=0?"color-pill-yellow":e>=-7?"color-pill-orange":"color-pill-red")(a):"color-pill-blue";return c.jsxs("div",{className:"flex items-center gap-2",children:[s>0&&c.jsx(l,{className:"w-4 h-4 text-blue-500 dark:text-blue-400 flex-shrink-0"}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("span",{className:"color-pill color-pill-filled color-pill-blue font-mono",children:t}),void 0!==a&&c.jsxs("span",{className:`color-pill color-pill-filled font-mono ${n}`,children:[a>=0?"+":"",a,"dB"]})]})]},s)})})]})]})})}function Ht({decoded:e,timestamp:t}){const s=t?V(t):"Unknown";return e.encrypted?c.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[c.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:"linear-gradient(135deg, var(--sys-purple) 0%, var(--sys-indigo) 100%)"},children:c.jsx(y,{className:"w-5 h-5 text-white"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"text-sm font-semibold text-text-primary font-sans",children:"Encrypted Message"}),c.jsxs("p",{className:"text-xs text-text-muted font-sans mt-0.5",children:[e.srcHash," → ",e.destHash," · ",s]})]})]}):c.jsxs("div",{className:"mb-4",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-1.5 px-1",children:[c.jsxs("span",{className:"text-[11px] text-text-muted font-sans",children:[c.jsx("span",{className:"font-mono text-text-secondary",children:e.srcHash})," → ",c.jsx("span",{className:"font-mono text-text-secondary",children:e.destHash})]}),c.jsxs("span",{className:"text-[11px] text-text-muted font-sans",children:["· ",s]})]}),c.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tr-md ml-auto",style:{background:"linear-gradient(135deg, var(--sys-green) 0%, var(--sys-teal) 100%)"},children:c.jsx("p",{className:"text-sm text-white font-sans leading-relaxed whitespace-pre-wrap break-words",children:e.text})})]})}function St({decoded:e,timestamp:t}){const s=t?V(t):"Unknown",a=(e.partNumber+1)/e.totalParts*100;return c.jsx("div",{className:"mb-4",children:c.jsxs("div",{className:"rounded-2xl overflow-hidden bg-yellow-500/10 dark:bg-yellow-400/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[c.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[c.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-yellow) 0%, var(--sys-amber) 100%)"},children:c.jsx(h,{className:"w-6 h-6 text-white"})}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("h3",{className:"text-lg font-semibold text-text-primary font-sans truncate leading-tight",children:"Multipart Segment"}),c.jsxs("p",{className:"text-sm text-text-muted font-sans mt-0.5",children:["Part ",e.partNumber+1," of ",e.totalParts]})]})]}),c.jsx("div",{className:"mx-4 border-t border-black/10 dark:border-white/10"}),c.jsxs("div",{className:"px-4 py-3 space-y-3",children:[c.jsx("div",{children:c.jsx("div",{className:"h-2 bg-black/10 dark:bg-white/10 rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${a}%`,background:"linear-gradient(90deg, var(--sys-yellow), var(--sys-amber))"}})})}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(m,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400 flex-shrink-0"}),c.jsxs("span",{className:"text-sm text-text-secondary font-sans",children:["Message ID: ",c.jsx("span",{className:"font-mono",children:e.messageId})]})]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(u,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400 flex-shrink-0"}),c.jsx("span",{className:"text-sm text-text-secondary font-sans",children:s})]})]})]})})}function At({decoded:e,timestamp:t,payloadType:s}){const a=t?V(t):"Unknown",n=(()=>{switch(s){case 0:return{icon:_,gradient:"var(--sys-orange), var(--sys-red)",bg:"rgba(249, 115, 22, 0.15)",label:"Request"};case 1:return{icon:C,gradient:"var(--sys-green), var(--sys-teal)",bg:"rgba(34, 197, 94, 0.15)",label:"Response"};case 7:return{icon:y,gradient:"var(--sys-purple), var(--sys-pink)",bg:"rgba(168, 85, 247, 0.15)",label:"Anonymous Request"};default:return{icon:k,gradient:"var(--sys-gray), var(--sys-slate)",bg:"rgba(107, 114, 128, 0.15)",label:e.payloadTypeName}}})(),r=n.icon;return c.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[c.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:`linear-gradient(135deg, ${n.gradient})`},children:c.jsx(r,{className:"w-5 h-5 text-white"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"text-sm font-semibold text-text-primary font-sans",children:n.label}),c.jsxs("p",{className:"text-xs text-text-muted font-sans mt-0.5",children:[e.length," bytes · ",a]})]})]})}function Pt({pathHex:e}){if(!e)return null;const t=ft(e);return c.jsx("div",{className:"flex flex-wrap items-center gap-2 py-2",children:t.map((e,t)=>c.jsxs("div",{className:"flex items-center gap-2",children:[t>0&&c.jsx(l,{className:"w-4 h-4 text-sys-amber flex-shrink-0"}),c.jsxs("div",{className:"flex items-center gap-1.5",children:[c.jsx(Y,{size:"compact",copy:!0,children:e.toUpperCase()}),c.jsx("span",{className:"text-[10px] text-text-muted font-sans tabular-nums w-4 text-left",children:t+1})]})]},t))})}function Mt({decoded:e,payloadType:t}){var s;const a=Ee[t]||`TYPE_${t}`;switch(e.type){case"advert":return c.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[c.jsxs("p",{children:[c.jsx("span",{className:"text-text-muted",children:"Type:"})," ",e.nodeType]}),e.name&&c.jsxs("p",{children:[c.jsx("span",{className:"text-text-muted",children:"Name:"})," ",e.name]}),void 0!==e.latitude&&c.jsxs("p",{children:[c.jsx("span",{className:"text-text-muted",children:"Location:"})," ",e.latitude.toFixed(4),"°, ",null==(s=e.longitude)?void 0:s.toFixed(4),"°"]}),c.jsxs("p",{children:[c.jsx("span",{className:"text-text-muted",children:"Time:"})," ",V(e.timestamp)]}),c.jsxs("p",{children:[c.jsx("span",{className:"text-text-muted",children:"Flags:"})," ",e.flagsDescription]})]});case"ack":return c.jsx("div",{className:"text-xs text-text-primary space-y-0.5",children:c.jsxs("p",{children:[c.jsx("span",{className:"text-text-muted",children:"CRC:"})," 0x",e.crc]})});case"path":case"trace":return c.jsxs("div",{className:"text-xs text-text-primary space-y-1",children:[c.jsxs("p",{children:[c.jsx("span",{className:"text-text-muted",children:"Path:"})," ",e.pathString||"(empty)"]}),"trace"===e.type&&e.snrValues.length>0&&c.jsxs("p",{children:[c.jsx("span",{className:"text-text-muted",children:"SNR:"})," ",e.snrValues.map(e=>`${e}dB`).join(" → ")]})]});case"txt_msg":return c.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[c.jsxs("p",{children:[c.jsx("span",{className:"text-text-muted",children:"Dest:"})," ",e.destHash]}),c.jsxs("p",{children:[c.jsx("span",{className:"text-text-muted",children:"Src:"})," ",e.srcHash]}),e.encrypted?c.jsx("p",{className:"text-text-muted italic",children:"Encrypted content"}):c.jsxs("p",{children:[c.jsx("span",{className:"text-text-muted",children:"Text:"})," ",e.text]})]});case"grp_txt":return c.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[c.jsxs("p",{children:[c.jsx("span",{className:"text-text-muted",children:"Channel:"})," ",e.channelName?c.jsx("span",{className:"text-accent-success",children:e.channelName}):c.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]}),e.decrypted?c.jsxs(c.Fragment,{children:[e.senderName&&c.jsxs("p",{children:[c.jsx("span",{className:"text-text-muted",children:"From:"})," ",e.senderName]}),c.jsxs("p",{children:[c.jsx("span",{className:"text-text-muted",children:"Text:"})," ",e.text]})]}):c.jsx("p",{className:"text-text-muted italic",children:"Encrypted (unknown channel)"})]});case"grp_data":return c.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[c.jsxs("p",{children:[c.jsx("span",{className:"text-text-muted",children:"Channel:"})," ",e.channelName?c.jsx("span",{className:"text-sys-teal",children:e.channelName}):c.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]}),c.jsxs("p",{children:[c.jsx("span",{className:"text-text-muted",children:"Data:"})," ",e.dataLength," bytes ",e.decrypted?"(decrypted)":"(encrypted)"]})]});case"multipart":return c.jsxs("div",{className:"text-xs text-text-primary space-y-0.5",children:[c.jsxs("p",{children:[c.jsx("span",{className:"text-text-muted",children:"Part:"})," ",e.partNumber+1,"/",e.totalParts]}),c.jsxs("p",{children:[c.jsx("span",{className:"text-text-muted",children:"Message ID:"})," ",e.messageId]})]});default:return c.jsxs("p",{className:"text-xs text-text-secondary",children:[a," (",e.length," bytes)"]})}}function Lt({advert:e,payloadHex:t}){const s=t.slice(0,64),a=t.slice(64,72),n=t.slice(72,200),r=t.slice(200,202);let l=202,i="",o="",d="";return void 0!==e.latitude&&(i=t.slice(l,l+8),l+=8,void 0!==e.longitude&&(o=t.slice(l,l+8),l+=8)),e.name&&(d=t.slice(l)),c.jsxs("div",{className:"space-y-3 mt-4",children:[c.jsx("h4",{className:"text-sm font-semibold text-text-primary font-sans",children:"Advert Payload Breakdown"}),c.jsx("div",{className:"p-3 rounded-lg bg-bg-body/50",children:c.jsx(gt,{segments:[{hex:s,pillClass:"color-pill-pink"},{hex:a,pillClass:"color-pill-orange"},{hex:n,pillClass:"color-pill-teal"},{hex:r,pillClass:"color-pill-blue"},...i?[{hex:i,pillClass:"color-pill-green"}]:[],...o?[{hex:o,pillClass:"color-pill-purple"}]:[],...d?[{hex:d,pillClass:"color-pill-amber"}]:[]]})}),c.jsxs(Nt,{title:"Public Key",pillClass:"color-pill-pink",startByte:0,endByte:31,children:[c.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50",children:e.publicKey.toUpperCase()}),c.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Ed25519 public key"})]}),c.jsxs(Nt,{title:"Timestamp",pillClass:"color-pill-orange",startByte:32,endByte:35,children:[c.jsx("div",{className:"mb-1",children:c.jsx(Y,{size:"standard",copy:!0,children:a.toUpperCase()})}),c.jsxs("p",{className:"text-xs text-text-primary",children:[e.timestamp," (",V(e.timestamp),")"]})]}),c.jsxs(Nt,{title:"Signature",pillClass:"color-pill-teal",startByte:36,endByte:99,children:[c.jsx("div",{className:"text-[11px] text-text-secondary break-all p-2 rounded bg-bg-body/50",children:e.signature.toUpperCase()}),c.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Ed25519 signature"})]}),c.jsxs(Nt,{title:"App Flags",pillClass:"color-pill-blue",startByte:100,endByte:100,children:[c.jsx("div",{className:"mb-1",children:c.jsxs(Y,{size:"standard",copy:!0,children:["0x",e.flags.toString(16).padStart(2,"0").toUpperCase()]})}),c.jsx("p",{className:"text-xs text-text-primary",children:e.flagsDescription}),c.jsxs("p",{className:"text-xs text-text-muted mt-1",children:["Node Type: ",e.nodeType]})]}),void 0!==e.latitude&&i&&c.jsxs(Nt,{title:"Latitude",pillClass:"color-pill-green",startByte:101,endByte:104,children:[c.jsx("div",{className:"mb-1",children:c.jsx(Y,{size:"standard",copy:!0,children:i.toUpperCase()})}),c.jsxs("p",{className:"text-xs text-text-primary",children:[e.latitude.toFixed(6),"°"]})]}),void 0!==e.longitude&&o&&c.jsxs(Nt,{title:"Longitude",pillClass:"color-pill-purple",startByte:105,endByte:108,children:[c.jsx("div",{className:"mb-1",children:c.jsx(Y,{size:"standard",copy:!0,children:o.toUpperCase()})}),c.jsxs("p",{className:"text-xs text-text-primary",children:[e.longitude.toFixed(6),"°"]})]}),e.name&&d&&c.jsxs(Nt,{title:"Node Name",pillClass:"color-pill-amber",startByte:109,endByte:109+d.length/2-1,children:[c.jsx("div",{className:"mb-1",children:c.jsx(Y,{size:"standard",copy:!0,children:d.toUpperCase()})}),c.jsxs("p",{className:"text-xs text-text-primary",children:['"',e.name,'"']})]})]})}const Ut=s.memo(function({packet:e}){const t=e.raw_packet||"",a=t.length/2,[n,r]=s.useState(null),[l,i]=s.useState(null),o=s.useMemo(()=>{if(t.length<4)return null;const e=ot.fromHex(t);if(!e.success||!e.packet)return null;const s=e.packet,a=[{bits:"0-1",field:"Route Type",value:s.routeTypeName,binary:s.routeType.toString(2).padStart(2,"0")},{bits:"2-5",field:"Payload Type",value:s.payloadTypeName,binary:s.payloadType.toString(2).padStart(4,"0")},{bits:"6-7",field:"Version",value:s.payloadVersion.toString(),binary:s.payloadVersion.toString(2).padStart(2,"0")}],n=t.slice(0,2);let r=2,l="";s.hasTransportCodes()&&(l=t.slice(2,10),r=10);const i=t.slice(r,r+2),c=r+2,o=c+2*s.pathLen,d=t.slice(c,o),x=t.slice(o),p=function(e){const{payload:t,payloadType:s,payloadTypeName:a}=e;switch(s){case 4:return function(e){if(e.length<101)return null;let t=0;const s=Re(e.slice(t,t+32));t+=32;const a=nt(e,t);t+=4;const n=Re(e.slice(t,t+64));t+=64;const r=e[t++],l=function(e){const t=[];switch(15&e){case 1:t.push("is chat node");break;case 2:t.push("is repeater");break;case 3:t.push("is room server");break;case 4:t.push("is sensor")}return 16&e&&t.push("has location"),32&e&&t.push("has feature 1"),64&e&&t.push("has feature 2"),128&e&&t.push("has name"),t.join(", ")||"none"}(r);let i="unknown";switch(15&r){case 1:i="chat";break;case 2:i="repeater";break;case 3:i="room_server";break;case 4:i="sensor"}const c={type:"advert",publicKey:s,timestamp:a,signature:n,flags:r,flagsDescription:l,nodeType:i,rawAppData:Re(e.slice(100))};if(16&r&&t+8<=e.length){const s=e.slice(t,t+8),a=new ArrayBuffer(8);new Uint8Array(a).set(s);const n=new DataView(a),r=n.getInt32(0,!0),l=n.getInt32(4,!0);c.latitude=r/1e6,c.longitude=l/1e6,t+=8}if(128&r&&t<e.length){let s=t;for(;s<e.length&&0!==e[s];)s++;s>t&&(c.name=(new TextDecoder).decode(e.slice(t,s)))}return c}(t)??dt(t,s,a);case 3:return function(e){if(e.length<4)return null;const t=nt(e,0);return{type:"ack",crc:t.toString(16).toUpperCase().padStart(8,"0"),crcValue:t}}(t)??dt(t,s,a);case 8:return function(e){if(0===e.length)return{type:"path",path:[],pathString:""};const t=Array.from(e).map(e=>Fe(e,!0)),s=t.join("->");return{type:"path",path:t,pathString:s}}(t)??dt(t,s,a);case 9:return function(e){if(0===e.length)return{type:"trace",targetHash:"",path:[],pathString:"",snrValues:[]};const t=[],s=[];for(let a=0;a<e.length;a+=2)t.push(Fe(e[a],!0)),a+1<e.length&&s.push(lt(e,a+1));return{type:"trace",targetHash:t.length>0?t[0]:"",path:t,pathString:t.join("->"),snrValues:s}}(t)??dt(t,s,a);case 2:return function(e){if(e.length<2)return null;const t=Fe(e[0],!0),s=Fe(e[1],!0),a=e.slice(2);let n="",r=!0;try{const e=new TextDecoder("utf-8",{fatal:!0}).decode(a);/^[\x20-\x7E\u00A0-\uFFFF\n\r\t]*$/.test(e)&&(n=e,r=!1)}catch{}return r&&(n=Re(a)),{type:"txt_msg",destHash:t,srcHash:s,timestamp:0,text:n,encrypted:r}}(t)??dt(t,s,a);case 5:return function(e){if(e.length<4)return null;const t=Fe(e[0],!0),s=e.slice(1,3),a=e.slice(3);return{type:"grp_txt",channelHash:t,text:Re(a),decrypted:!1,ciphertextHex:Re(a),macHex:Re(s)}}(t)??dt(t,s,a);case 6:return function(e){if(e.length<4)return null;const t=Fe(e[0],!0),s=e.slice(1,3),a=e.slice(3);return{type:"grp_data",channelHash:t,dataHex:Re(a),dataLength:a.length,decrypted:!1,macHex:Re(s)}}(t)??dt(t,s,a);case 10:return function(e){return e.length<4?null:{type:"multipart",messageId:Re(e.slice(0,2)),partNumber:e[2],totalParts:e[3],partData:Re(e.slice(4))}}(t)??dt(t,s,a);default:return dt(t,s,a)}}(s);return{packet:s,headerHex:n,headerFields:a,transportCodesHex:l,pathLengthHex:i,pathDataHex:d,payloadHex:x,payloadStartByte:Math.floor(o/2),decoded:p}},[t]);if(s.useEffect(()=>{if(!(null==o?void 0:o.packet)||5!==o.packet.payloadType)return void r(null);let e=!1;return async function(e){if(e.length<4)return null;const t=e[0],s=Fe(t,!0),a=e.slice(1,3),n=e.slice(3),r={type:"grp_txt",channelHash:s,text:Re(n),decrypted:!1,ciphertextHex:Re(n),macHex:Re(a)};try{const{getChannelKeys:e}=await Z(async()=>{const{getChannelKeys:e}=await Promise.resolve().then(()=>yt);return{getChannelKeys:e}},void 0),s=await e(t);if(s){r.channelName=s.name;const{decryptChannelMessage:e}=await Z(async()=>{const{decryptChannelMessage:e}=await Promise.resolve().then(()=>ct);return{decryptChannelMessage:e}},void 0),t=await e(s.hmacKey,s.aesKey,a,n);if(t&&t.length>=5){const e=nt(t,0),s=t[4],a=new TextDecoder("utf-8",{fatal:!1}).decode(t.slice(5));r.decrypted=!0,r.timestamp=e,r.flags=s;const n=a.indexOf(": ");n>0?(r.senderName=a.slice(0,n),r.text=a.slice(n+2)):r.text=a}}}catch(l){}return r}(o.packet.payload).then(t=>{!e&&t&&r(t)}),()=>{e=!0}},[null==o?void 0:o.packet]),s.useEffect(()=>{if(!(null==o?void 0:o.packet)||6!==o.packet.payloadType)return void i(null);let e=!1;return async function(e){if(e.length<4)return null;const t=e[0],s=Fe(t,!0),a=e.slice(1,3),n=e.slice(3),r={type:"grp_data",channelHash:s,dataHex:Re(n),dataLength:n.length,decrypted:!1,macHex:Re(a)};try{const{getChannelKeys:e}=await Z(async()=>{const{getChannelKeys:e}=await Promise.resolve().then(()=>yt);return{getChannelKeys:e}},void 0),s=await e(t);if(s){r.channelName=s.name;const{decryptChannelMessage:e}=await Z(async()=>{const{decryptChannelMessage:e}=await Promise.resolve().then(()=>ct);return{decryptChannelMessage:e}},void 0),t=await e(s.hmacKey,s.aesKey,a,n);t&&(r.decrypted=!0,r.decryptedHex=Re(t))}}catch(l){}return r}(o.packet.payload).then(t=>{!e&&t&&i(t)}),()=>{e=!0}},[null==o?void 0:o.packet]),!o||0===t.length)return c.jsx("div",{className:"p-4 text-center text-text-muted",children:c.jsx("p",{className:"text-sm",children:"No raw packet data available"})});const{packet:d}=o;let x=o.decoded;return n&&"grp_txt"===o.decoded.type?x=n:l&&"grp_data"===o.decoded.type&&(x=l),c.jsxs("div",{className:"font-mono space-y-8",children:[(()=>{switch(x.type){case"advert":return c.jsx(vt,{advert:x,timestamp:e.timestamp});case"grp_data":return c.jsx(wt,{decoded:x,timestamp:e.timestamp});case"grp_txt":return x.decrypted?c.jsx(kt,{decoded:x}):null;case"ack":return c.jsx(Ct,{decoded:x,timestamp:e.timestamp});case"path":return c.jsx(_t,{decoded:x,timestamp:e.timestamp});case"trace":return c.jsx(Tt,{decoded:x,timestamp:e.timestamp});case"txt_msg":return c.jsx(Ht,{decoded:x,timestamp:e.timestamp});case"multipart":return c.jsx(St,{decoded:x,timestamp:e.timestamp});case"generic":return 0===d.payloadType||1===d.payloadType||7===d.payloadType?c.jsx(At,{decoded:x,timestamp:e.timestamp,payloadType:d.payloadType}):null;default:return null}})(),c.jsx("div",{className:"bg-black/[0.03] dark:bg-white/[0.03] rounded-2xl p-6",children:c.jsx(gt,{segments:[{hex:o.headerHex,pillClass:"color-pill-red"},...o.transportCodesHex?[{hex:o.transportCodesHex,pillClass:"color-pill-purple"}]:[],{hex:o.pathLengthHex,pillClass:"color-pill-green"},...o.pathDataHex?[{hex:o.pathDataHex,pillClass:"color-pill-amber"}]:[],{hex:o.payloadHex,pillClass:"color-pill-cyan"}]})}),c.jsxs("div",{className:"space-y-8",children:[c.jsx(bt,{title:"Header",pillClass:"color-pill-red",startByte:0,endByte:0,hexBytes:`0x${o.headerHex.toUpperCase()}`,children:c.jsxs("table",{className:"w-full text-left",children:[c.jsx("thead",{children:c.jsxs("tr",{className:"text-[10px] uppercase tracking-wide text-text-muted border-b border-border-subtle font-sans",children:[c.jsx("th",{className:"py-1 font-medium",children:"Bits"}),c.jsx("th",{className:"py-1 font-medium",children:"Field"}),c.jsx("th",{className:"py-1 font-medium",children:"Value"}),c.jsx("th",{className:"py-1 font-medium",children:"Binary"})]})}),c.jsx("tbody",{children:o.headerFields.map(e=>c.jsx(jt,{...e},e.bits))})]})}),o.transportCodesHex&&c.jsxs(bt,{title:"Transport Codes",pillClass:"color-pill-purple",startByte:1,endByte:4,hexBytes:o.transportCodesHex.toUpperCase(),children:[c.jsx("p",{className:"text-xs text-text-muted",children:"Two 16-bit transport codes for encrypted routing"}),c.jsxs("div",{className:"mt-1 text-xs text-text-secondary",children:["Code 1: 0x",o.transportCodesHex.slice(0,4).toUpperCase()," | Code 2: 0x",o.transportCodesHex.slice(4,8).toUpperCase()]})]}),c.jsx(bt,{title:"Path Length",pillClass:"color-pill-green",startByte:o.transportCodesHex?5:1,endByte:o.transportCodesHex?5:1,hexBytes:`0x${o.pathLengthHex.toUpperCase()}`,children:c.jsxs("p",{className:"text-xs text-text-muted",children:[d.pathLen," bytes showing route taken (increases as packet floods)"]})}),d.pathLen>0&&c.jsxs(bt,{title:"Path Data",pillClass:"color-pill-amber",startByte:o.transportCodesHex?6:2,endByte:(o.transportCodesHex?5:1)+d.pathLen,hexBytes:o.pathDataHex.toUpperCase(),children:[c.jsx(Pt,{pathHex:o.pathDataHex}),c.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Historical route taken (bytes are added as packet floods through network)"})]}),c.jsxs(bt,{title:"Payload",pillClass:"color-pill-cyan",startByte:o.payloadStartByte,endByte:a-1,hexBytes:o.payloadHex.toUpperCase(),children:[c.jsxs("div",{className:"mb-2 p-2 rounded bg-bg-elevated/50 border border-border-subtle",children:[c.jsx("p",{className:"text-[10px] uppercase tracking-wide text-text-muted mb-1 font-sans",children:"Decoded"}),c.jsx(Mt,{decoded:x,payloadType:d.payloadType})]}),c.jsx("p",{className:"text-[10px] uppercase tracking-wide text-text-muted mb-1 font-sans",children:"Raw Hex"}),c.jsx("div",{className:"max-w-full overflow-x-auto",children:c.jsx(Y,{size:"standard",copy:!0,className:"inline-block max-w-full",children:c.jsx("span",{className:"break-all",children:o.payloadHex.toUpperCase()})})})]})]}),"advert"===x.type&&c.jsx("div",{className:"mt-8",children:c.jsx(Lt,{advert:x,payloadHex:o.payloadHex})})]})});function Dt(e){if(!e)return[];if(Array.isArray(e))return e;try{const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}}function Et(e){return e?(e.startsWith("0x")?e.slice(2):e).slice(0,2).toUpperCase():""}function Bt(e){if(void 0===e)return"text-text-muted";switch(Q(e)){case"excellent":return"text-signal-excellent";case"good":return"text-signal-good";case"fair":return"text-signal-fair";case"weak":return"text-signal-poor";case"poor":return"text-signal-critical";default:return"text-text-muted"}}function Rt({hop:e,isLast:t}){var s,a,n,r,l,o,x,p;const h=!(!(null==(s=e.neighborInfo)?void 0:s.latitude)||!(null==(a=e.neighborInfo)?void 0:a.longitude)),m=void 0!==(null==(n=e.neighborInfo)?void 0:n.rssi);return c.jsxs("div",{className:"relative",children:[!t&&c.jsx("div",{className:"absolute left-[19px] top-[40px] bottom-[-20px] w-[2px] bg-border-subtle"}),c.jsxs("div",{className:L("glass-card-inner p-3",e.isLocal&&"ring-1 ring-sys-amber/50",e.isGhost&&"ring-1 ring-sys-cyan/50"),children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:L("w-9 h-9 rounded-full flex items-center justify-center flex-shrink-0",e.isLocal?"bg-sys-amber/20 text-sys-amber":e.isGhost?"bg-sys-cyan/20 text-sys-cyan":"bg-accent-primary/20 text-accent-primary"),children:e.isLocal?c.jsx(T,{className:"w-4 h-4"}):e.isGhost?c.jsx(H,{className:"w-4 h-4"}):c.jsx("span",{className:"text-xs font-semibold",children:e.position})}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Y,{copy:!0,size:"compact",color:e.isGhost?"text-sys-cyan":void 0,children:e.prefix}),e.isLocal&&c.jsx("span",{className:"color-pill color-pill-filled color-pill-amber",children:"Local"}),e.isGhost&&c.jsx("span",{className:"color-pill color-pill-filled color-pill-cyan",children:"Ghost"}),void 0!==e.confidence&&c.jsxs("span",{className:L("text-[10px] font-mono",e.confidence>=.9?"text-accent-success":e.confidence>=.6?"text-accent-secondary":"text-accent-danger"),children:[(100*e.confidence).toFixed(0),"%"]})]}),(null==(r=e.neighborInfo)?void 0:r.name)&&c.jsx("p",{className:"text-sm text-text-primary truncate mt-0.5",children:e.neighborInfo.name}),e.fullHash&&c.jsx("p",{className:"text-[10px] font-mono text-text-muted truncate",children:e.fullHash})]})]}),(m||h||e.neighborInfo)&&c.jsxs("div",{className:"mt-3 pt-3 border-t border-border-subtle/50 space-y-2",children:[m&&c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(N,{className:"w-3.5 h-3.5 text-text-muted flex-shrink-0"}),c.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[c.jsx(q,{rssi:e.neighborInfo.rssi,snr:null==(l=e.neighborInfo)?void 0:l.snr,compact:!0}),c.jsxs("span",{className:"text-xs text-text-muted",children:[e.neighborInfo.rssi," dBm",null!=(null==(o=e.neighborInfo)?void 0:o.snr)&&` / ${e.neighborInfo.snr.toFixed(1)} dB`]})]})]}),h&&c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(d,{className:"w-3.5 h-3.5 text-text-muted flex-shrink-0"}),c.jsxs("span",{className:"text-xs font-mono text-text-secondary",children:[e.neighborInfo.latitude.toFixed(5),", ",e.neighborInfo.longitude.toFixed(5)]})]}),(null==(x=e.neighborInfo)?void 0:x.contact_type)&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-[10px] text-text-muted",children:"Type:"}),c.jsx("span",{className:"color-pill color-pill-compact",children:e.neighborInfo.contact_type})]}),(null==(p=e.neighborInfo)?void 0:p.last_seen)&&c.jsxs("div",{className:"text-[10px] text-text-muted",children:["Last seen: ",V(e.neighborInfo.last_seen)]})]}),!e.neighborInfo&&!e.isLocal&&!e.isGhost&&c.jsxs("div",{className:"mt-2 flex items-center gap-2 text-[10px] text-text-muted",children:[c.jsx(S,{className:"w-3 h-3"}),c.jsx("span",{children:"Unknown node - not in neighbor table"})]})]}),!t&&c.jsx("div",{className:"flex justify-center py-1",children:c.jsx(i,{className:"w-4 h-4 text-border-subtle"})})]})}const Ft=s.memo(function({packet:e,neighbors:t,localHash:a,neighborAffinity:n,ghostPrefixes:r}){const l=Dt(e.original_path),o=Dt(e.forwarded_path),d=o.length>0?o:l,x=Et(a),p=s.useMemo(()=>d.map((e,s)=>{const a=e.toUpperCase(),l=a===x,i=(null==r?void 0:r.has(a))??!1,c=function(e,t,s){const a=e.toUpperCase();if(s){let e=null,n=0;if(s.forEach((t,s)=>{if(Et(s)===a){const a=t.combinedScore??0;a>n&&(n=a,e=s)}}),e&&t[e])return{hash:e,info:t[e],confidence:n}}for(const[n,r]of Object.entries(t))if(Et(n)===a)return{hash:n,info:r,confidence:void 0};return null}(a,t,n);return{prefix:a,fullHash:null==c?void 0:c.hash,neighborInfo:null==c?void 0:c.info,isLocal:l,isGhost:i,confidence:null==c?void 0:c.confidence,position:s+1}}),[d,t,n,x,r]);return 0===p.length?c.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-6 text-center",children:[c.jsx(N,{className:"w-8 h-8 text-text-muted mb-3"}),c.jsx("p",{className:"text-sm text-text-muted",children:"No path data available"}),c.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Direct packets have no intermediate hops"})]}):c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("h3",{className:"text-base font-semibold text-text-primary",children:"Packet Path"}),c.jsxs("span",{className:"text-xs text-text-muted",children:[p.length," hop",1!==p.length?"s":""]})]}),e.src_hash&&c.jsxs("div",{className:"glass-card-inner p-3",children:[c.jsx("div",{className:"flex items-center gap-2 mb-1",children:c.jsx("span",{className:"text-[10px] uppercase tracking-wide text-text-muted",children:"Source"})}),c.jsx(Y,{copy:!0,size:"compact",children:e.src_hash})]}),e.src_hash&&c.jsx("div",{className:"flex justify-center",children:c.jsx(i,{className:"w-4 h-4 text-accent-primary"})}),c.jsx("div",{className:"space-y-1",children:p.map((e,t)=>c.jsx(Rt,{hop:e,isLast:t===p.length-1},`${e.prefix}-${t}`))}),e.dst_hash&&e.dst_hash!==a&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"flex justify-center",children:c.jsx(i,{className:"w-4 h-4 text-accent-primary"})}),c.jsxs("div",{className:"glass-card-inner p-3",children:[c.jsx("div",{className:"flex items-center gap-2 mb-1",children:c.jsx("span",{className:"text-[10px] uppercase tracking-wide text-text-muted",children:"Destination"})}),c.jsx(Y,{copy:!0,size:"compact",children:e.dst_hash})]})]}),c.jsxs("div",{className:"glass-card-inner p-3 mt-4",children:[c.jsx("p",{className:"text-[10px] uppercase tracking-wide text-text-muted mb-2",children:"Reception Summary"}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx(q,{rssi:e.rssi,snr:e.snr}),c.jsxs("div",{className:"text-xs text-text-secondary",children:[c.jsxs("span",{className:Bt(e.rssi),children:[e.rssi," dBm"]}),void 0!==e.snr&&c.jsxs("span",{className:"text-text-muted",children:[" / ",e.snr.toFixed(1)," dB SNR"]})]})]})]})]})});function It(e){if(!e)return[];if(Array.isArray(e))return e;try{const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}}const Ot={ADVERT:"blue",ACK:"emerald",REQ:"sky",RESPONSE:"sky",TXT_MSG:"teal",GRP_TXT:"teal",FLOOD:"sky",GRP_DATA:"indigo",PATH:"violet",MULTIPART:"purple",TRACE:"orange",ANON_REQ:"amber",RAW_CUSTOM:"fuchsia"};function Vt({label:e,children:t,compact:s=!1}){return c.jsxs("div",{className:L("flex flex-col",s?"gap-0.5":"gap-1"),children:[c.jsx("span",{className:"text-[10px] text-text-muted uppercase tracking-wide",children:e}),c.jsx("span",{className:L("text-text-primary","text-sm"),children:t})]})}function $t({originalPath:e,forwardedPath:t,ghostPrefixes:s}){const a=t.length>0?t:e;if(0===a.length)return c.jsx("span",{className:"text-sm text-text-muted",children:"No path data"});const n=e=>null==s?void 0:s.has(e.toUpperCase());return c.jsx("div",{className:"flex items-center gap-1 flex-wrap",children:a.map((e,t)=>c.jsxs("div",{className:"flex items-center gap-1",children:[n(e)?c.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-accent-tertiary/20 text-accent-tertiary font-mono text-sm",children:[c.jsx(H,{className:"w-3 h-3"}),e.toUpperCase()]}):c.jsx(Y,{copy:!0,size:"compact",children:e}),t<a.length-1&&c.jsx(l,{className:"w-3 h-3 text-text-muted flex-shrink-0"})]},t))})}const zt=s.memo(function({packet:e,onClose:t}){const[a,n]=s.useState("analysis");s.useEffect(()=>{const e=e=>{"Escape"===e.key&&t()};window.addEventListener("keydown",e);const s=document.body.style.overflow,a=document.body.style.position,n=document.body.style.width,r=document.body.style.top,l=window.scrollY;return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.top=`-${l}px`,()=>{window.removeEventListener("keydown",e),document.body.style.overflow=s,document.body.style.position=a,document.body.style.width=n,document.body.style.top=r,window.scrollTo(0,l)}},[t]);const r=K(),l=G(),i=W(),o=X(),d=s.useMemo(()=>new Set(o.map(e=>e.prefix.toUpperCase())),[o]),x=e.payload_type_name||R(e.payload_type??e.type),p=e.route_type_name||F(e.route_type??e.route),m=e.payload_length??e.length??0,u=e.tx_delay_ms??0,y=It(e.original_path),f=It(e.forwarded_path),g=y.length>0||f.length>0,j=f.length>0?f:y,b=s.useMemo(()=>{var e;if(null==(e=null==r?void 0:r.config)?void 0:e.repeater)return{latitude:r.config.repeater.latitude,longitude:r.config.repeater.longitude,name:r.config.node_name||"Local Node"}},[r]),v=(null==r?void 0:r.neighbors)??{},w=i.size>0?i:void 0,k=e.raw_packet&&e.raw_packet.length>0,C=j.length>0;return A.createPortal(c.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-md z-[10010] flex items-end sm:items-center justify-center p-4",onClick:t,role:"dialog","aria-modal":"true","aria-labelledby":"packet-modal-title",children:c.jsxs("div",{className:L("glass-card-elevated w-full flex flex-col","max-h-[90vh]","rounded-t-2xl rounded-b-none","sm:max-w-[900px] sm:rounded-xl sm:aspect-[5/4] sm:max-h-[85vh]","pb-safe"),onClick:e=>e.stopPropagation(),children:[c.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border-subtle flex-shrink-0",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(ae,{packet:e,showLabel:!0,size:"lg"}),c.jsx(U,{color:Ot[x]??"zinc",children:x}),c.jsx("span",{className:"text-sm font-mono text-text-secondary",children:V(e.timestamp)})]}),c.jsx("button",{onClick:t,className:"p-2 rounded-lg text-text-muted hover:text-text-primary hover:bg-bg-subtle transition-colors",children:c.jsx(P,{className:"w-5 h-5"})})]}),c.jsxs("div",{className:"hidden sm:flex items-center gap-1 px-4 pt-2 pb-1 border-b border-border-subtle/50 flex-shrink-0",children:[c.jsxs("button",{onClick:()=>n("map"),className:L("px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center gap-1.5","map"===a?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-secondary hover:bg-bg-subtle"),children:[c.jsx(N,{className:"w-3.5 h-3.5"}),"RF / Map"]}),(C||k)&&c.jsxs("button",{onClick:()=>n("analysis"),className:L("px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center gap-1.5","analysis"===a?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-secondary hover:bg-bg-subtle"),children:[c.jsx(h,{className:"w-3.5 h-3.5"}),"Path / Bytes"]})]}),c.jsxs("div",{className:"flex-1 min-h-0 flex flex-col overflow-hidden",children:[c.jsxs("div",{className:L("overflow-y-auto p-4 space-y-4 overscroll-contain","sm:hidden"),style:{WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[c.jsx("div",{className:"glass-card-inner p-3",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-text-muted mb-1",children:"Signal Quality"}),c.jsx("p",{className:"text-sm font-medium text-text-primary",children:J(e.rssi)})]}),c.jsx(q,{rssi:e.rssi,snr:e.snr,showValues:!0})]})}),g&&c.jsxs("div",{className:"glass-card-inner p-3",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsx("p",{className:"text-sm text-text-muted",children:"Packet Path"}),j.some(e=>d.has(e.toUpperCase()))&&c.jsxs("span",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-full bg-accent-tertiary/20 text-accent-tertiary text-[10px]",children:[c.jsx(H,{className:"w-3 h-3"}),c.jsx("span",{children:"Ghost Detected"})]})]}),c.jsx($t,{originalPath:y,forwardedPath:f,ghostPrefixes:d})]}),C&&c.jsx(Ft,{packet:e,neighbors:v,localHash:null==r?void 0:r.local_hash,neighborAffinity:w,ghostPrefixes:d}),k&&c.jsx("div",{className:"pt-2 border-t border-border-subtle",children:c.jsx(Ut,{packet:e})})]}),c.jsxs("div",{className:L("hidden overflow-y-auto p-4 space-y-4 overscroll-contain","map"===a?"sm:flex sm:flex-col sm:flex-1":"sm:hidden"),style:{WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[c.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[c.jsxs("div",{className:"glass-card-inner p-3",children:[c.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1",children:"Signal"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(q,{rssi:e.rssi,snr:e.snr}),c.jsx("div",{className:"text-sm",children:c.jsx("span",{className:"font-medium text-text-primary",children:J(e.rssi)})})]})]}),c.jsxs("div",{className:"glass-card-inner p-3",children:[c.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1",children:"RSSI"}),c.jsx("p",{className:"text-lg font-mono text-text-primary",children:null!=e.rssi?`${e.rssi} dBm`:"—"})]}),c.jsxs("div",{className:"glass-card-inner p-3",children:[c.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1",children:"SNR"}),c.jsx("p",{className:"text-lg font-mono text-text-primary",children:null!=e.snr?`${e.snr.toFixed(1)} dB`:"—"})]}),c.jsxs("div",{className:"glass-card-inner p-3",children:[c.jsx("p",{className:"text-[10px] text-text-muted uppercase tracking-wide mb-1",children:"Hops"}),c.jsx("p",{className:"text-lg font-mono text-text-primary",children:j.length>0?j.length:"0"})]})]}),c.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[c.jsx(Vt,{label:"Route",children:c.jsx(U,{color:"DIRECT"===p||"T_DIRECT"===p?"cyan":"amber",children:p})}),c.jsx(Vt,{label:"Size",children:c.jsxs("span",{className:"font-mono",children:[m,"B"]})}),c.jsx(Vt,{label:"TX Delay",children:c.jsxs("span",{className:"font-mono",children:[u.toFixed(1),"ms"]})}),c.jsx(Vt,{label:"Status",children:c.jsx(U,{color:re(e),children:ne(e)})})]}),g&&j.length>0&&c.jsxs("div",{className:"flex-1 min-h-[280px] glass-card-inner overflow-hidden",children:[c.jsxs("div",{className:"p-3 border-b border-border-subtle/50 flex items-center gap-2",children:[c.jsx(M,{className:"w-4 h-4 text-accent-primary"}),c.jsx("span",{className:"text-sm text-text-secondary font-medium",children:"Path Visualization"})]}),c.jsx("div",{className:"p-3 h-[calc(100%-44px)]",children:c.jsx(fe,{path:j,neighbors:v,localNode:b,localHash:null==r?void 0:r.local_hash,srcHash:e.src_hash,dstHash:e.dst_hash,neighborAffinity:w,hubNodes:[...l]})})]}),(!g||0===j.length)&&c.jsx("div",{className:"flex-1 flex items-center justify-center glass-card-inner",children:c.jsxs("div",{className:"text-center text-text-muted",children:[c.jsx(M,{className:"w-12 h-12 mx-auto mb-2 opacity-30"}),c.jsx("p",{className:"text-sm",children:"No path data available for map visualization"})]})})]}),c.jsxs("div",{className:L("hidden overflow-hidden","analysis"===a?"sm:flex sm:flex-row sm:flex-1":"sm:hidden"),children:[C&&c.jsx("div",{className:"overflow-y-auto p-4 overscroll-contain border-r border-border-subtle/50 w-2/5",style:{WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:c.jsx(Ft,{packet:e,neighbors:v,localHash:null==r?void 0:r.local_hash,neighborAffinity:w,ghostPrefixes:d})}),k&&c.jsx("div",{className:L("overflow-y-auto p-4 overscroll-contain",C?"flex-1":"w-full"),style:{WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:c.jsx(Ut,{packet:e})}),!C&&!k&&c.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:c.jsxs("div",{className:"text-center text-text-muted",children:[c.jsx(h,{className:"w-12 h-12 mx-auto mb-2 opacity-30"}),c.jsx("p",{className:"text-sm",children:"No path or raw packet data available"})]})})]})]})]})}),document.body)});export{de as P,xe as a,zt as b,se as g};
