import{c as e,j as t,f as s,x as a,g as n,X as l,M as i,N as o,h as r,S as c,n as d,O as m,Q as x,T as h,R as u}from"./index-4vFwvlpY.js";import{b as p,d as f,i as g,L as y,C as j,X as b,Y as v,T as N,e as w,g as M,c as k}from"./recharts-bmHCCfxU.js";import{u as S,T as C}from"./TimeRangeSelector-R4XT1LnQ.js";import{u as T}from"./usePolling-DMtQdE_y.js";import{a as L,u as P,b as F,c as R}from"./useThemeColors-Co3IW0xw.js";import{C as A,b as $,P as W,a as E}from"./PageLayout-DaA7xAH5.js";import{L as H}from"./leaflet-ClE6qLuu.js";import{T as _}from"./triangle-alert-VP2jWYaq.js";import{M as z,a as B,C as D}from"./map-pin-q3fcHTSo.js";import{M as U,S as I,a as O,A as q}from"./share-2-BfMjPPfA.js";import{I as Z}from"./info-DqwNwFtK.js";import{R as G,C as X}from"./Grid-BWkFZjgD.js";import{T as V,N as J}from"./trending-up-CVmSzIj2.js";import"./maplibre-gl-CFO9X1Ek.js";const Y=e("chart-pie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]),K=e("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),Q=e("compass",[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),ee=e("expand",[["path",{d:"m15 15 6 6",key:"1s409w"}],["path",{d:"m15 9 6-6",key:"ko1vev"}],["path",{d:"M21 16v5h-5",key:"1ck2sf"}],["path",{d:"M21 8V3h-5",key:"1qoq8a"}],["path",{d:"M3 16v5h5",key:"1t08am"}],["path",{d:"m3 21 6-6",key:"wwnumi"}],["path",{d:"M3 8V3h5",key:"1ln10m"}],["path",{d:"M9 9 3 3",key:"v551iv"}]]),te=e("hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),se=e("shrink",[["path",{d:"m15 15 6 6m-6-6v4.8m0-4.8h4.8",key:"17vawe"}],["path",{d:"M9 19.8V15m0 0H4.2M9 15l-6 6",key:"chjx8e"}],["path",{d:"M15 4.2V9m0 0h4.8M15 9l6-6",key:"lav6yq"}],["path",{d:"M9 4.2V9m0 0H4.2M9 9 3 3",key:"1pxi2q"}]]);function ae(e){const t=e.match(/\(([^)]+)\)\s*$/);return t?t[1]:e.length>10?e.slice(0,10):e}function ne({x:e,y:s,width:a,height:n,name:l,size:i,index:o,colors:r,depth:c,hoveredIndex:d,onHover:m,total:x}){if(1!==c)return null;const h=null!==d&&!(d===o),u=r[o%r.length],p=x>0?i/x*100:0,f=a>36&&n>20,g=a>36&&n>32,y=ae(l);return t.jsxs("g",{onMouseEnter:e=>m(o,e),onMouseLeave:()=>m(null),style:{cursor:"default"},children:[t.jsx("rect",{x:e,y:s,width:a,height:n,fill:u,opacity:h?.4:1,stroke:"rgba(0,0,0,0.2)",strokeWidth:1,rx:3,style:{transition:"opacity 150ms ease"}}),f&&t.jsxs(t.Fragment,{children:[g&&t.jsxs("text",{x:e+4,y:s+n-4-11,textAnchor:"start",dominantBaseline:"auto",fill:"rgba(0,0,0,0.6)",fontSize:8,fontFamily:"'JetBrains Mono', monospace",fontWeight:500,style:{pointerEvents:"none"},children:[p.toFixed(1),"%"]}),t.jsx("text",{x:e+4,y:s+n-4,textAnchor:"start",dominantBaseline:"auto",fill:"rgba(0,0,0,0.85)",fontSize:9,fontFamily:"'JetBrains Mono', monospace",fontWeight:600,style:{pointerEvents:"none"},children:y})]})]})}function le({data:e,total:s,color:a,position:n,containerWidth:l}){if(!e||!n)return null;const i=(e.value/s*100).toFixed(1),o=l-n.x<184?Math.max(8,n.x-160-8):n.x+16;return t.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:o,top:Math.max(8,n.y-60)},children:t.jsxs("div",{className:"bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 shadow-xl min-w-[140px]",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-sm flex-shrink-0",style:{backgroundColor:a}}),t.jsx("span",{className:"type-data-sm font-semibold text-text-primary",children:ae(e.name)})]}),t.jsxs("div",{className:"space-y-0.5 type-data-xs text-text-muted",children:[t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("span",{children:"Count"}),t.jsx("span",{className:"text-text-primary tabular-nums font-medium",children:e.value.toLocaleString()})]}),t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("span",{children:"Share"}),t.jsxs("span",{className:"text-text-primary tabular-nums font-medium",children:[i,"%"]})]}),t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("span",{children:"Total"}),t.jsx("span",{className:"text-text-primary tabular-nums font-medium",children:s.toLocaleString()})]})]})]})})}const ie=p.memo(function({data:e}){var s,a;const[n,l]=p.useState(null),[i,o]=p.useState(null),[r,c]=p.useState(0),d=p.useRef(null),m=L(),{treemapData:x,total:h}=p.useMemo(()=>{const t=e.reduce((e,t)=>e+t.value,0);return{treemapData:[...e].sort((e,t)=>t.value-e.value).filter(e=>t>0&&e.value/t*100>=.5).map((e,t)=>({name:e.name,size:e.value,index:t})),total:t}},[e]),u=p.useCallback((e,t)=>{if(l(e),t&&null!==e){const e=d.current;if(e){const s=e.getBoundingClientRect();c(s.width),o({x:t.clientX-s.left,y:t.clientY-s.top})}}else o(null)},[]),y=null!==n?{name:(null==(s=x[n])?void 0:s.name)??"",value:(null==(a=x[n])?void 0:a.size)??0}:null,j=null!==n?m[n%m.length]:"";return 0===e.length||0===h?t.jsx("div",{className:"h-56 flex items-center justify-center text-text-muted",children:"No packet type data available"}):t.jsxs("div",{className:"h-56 relative treemap-container",ref:d,children:[t.jsx(f,{width:"100%",height:"100%",children:t.jsx(g,{data:x,dataKey:"size",aspectRatio:4/3,stroke:"none",isAnimationActive:!1,content:t.jsx(ne,{x:0,y:0,width:0,height:0,name:"",value:0,size:0,index:0,colors:m,depth:0,hoveredIndex:n,onHover:u,total:h})})}),t.jsx(le,{data:y,total:h,color:j,position:i,containerWidth:r})]})}),oe="airtimeSpectrumBlur";function re({active:e,payload:s,label:a}){if(!e||!s||0===s.length)return null;const n=s.filter(e=>null!==e.value&&void 0!==e.value);if(0===n.length)return null;const l=a?new Date(1e3*a).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}):"";return t.jsxs("div",{className:"bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 text-sm shadow-xl",children:[t.jsx("div",{className:"font-medium text-text-primary mb-1 font-mono",children:l}),n.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-0.5",style:{backgroundColor:e.color}}),t.jsxs("span",{className:"text-text-muted",children:[e.name,":"]}),t.jsxs("span",{className:"text-text-primary tabular-nums font-mono",children:[Number(e.value).toFixed(2),"%"]})]},s))]})}function ce({payload:e,showDensityScale:s=!1}){return e?t.jsxs("div",{className:"flex items-center gap-4 justify-start text-xs font-mono pl-11",children:[e.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"w-4 h-0.5",style:{backgroundColor:e.color}}),t.jsx("span",{className:"text-text-muted",children:e.value})]},s)),s&&t.jsxs("div",{className:"flex items-center gap-1.5 ml-2",children:[t.jsx("div",{className:"w-16 h-2 rounded-sm",style:{background:"linear-gradient(to right, \n                rgb(1,26,51), \n                rgb(53,82,85), \n                rgb(85,121,74), \n                rgb(150,149,53), \n                rgb(228,168,98), \n                rgb(250,195,165)\n              )"}}),t.jsx("span",{className:"text-text-muted",children:"Density"})]})]}):null}const de=[[1,26,51],[20,43,67],[38,62,79],[53,82,85],[67,102,83],[85,121,74],[112,137,62],[150,149,53],[192,156,58],[228,168,98],[250,195,165]];function me(e){const t=Math.max(0,Math.min(1,e))*(de.length-1),s=Math.floor(t),a=Math.min(s+1,de.length-1),n=t-s;return`rgb(${Math.round(de[s][0]+n*(de[a][0]-de[s][0]))},${Math.round(de[s][1]+n*(de[a][1]-de[s][1]))},${Math.round(de[s][2]+n*(de[a][2]-de[s][2]))})`}const xe=p.memo(function({samples:e,startTs:s,endTs:a,yMax:n}){const l=P(),i=p.useMemo(()=>void 0!==n?n:function(e){if(0===e.length)return 10;let t=0;for(const n of e){const e=n.rxRolling??n.rxUtilW,s=n.txRolling??n.txUtilW;e>t&&(t=e),s>t&&(t=s)}const s=1.1*t,a=5*Math.ceil(s/5);return Math.max(10,a)}(e),[n,e]),o=l.received,r=l.neutral,{cells:c,cellWidth:d,cellHeight:m}=p.useMemo(()=>function(e,t,s,a,n=120,l=30){const i=100/n+.5+"%",o=100/l+.5+"%";if(0===e.length||s<=t)return{cells:[],cellWidth:i,cellHeight:o};const r=s-t,c=l*n,d=new Float32Array(c),m=new Float32Array(c),x=(e,t)=>e*n+t;for(let b=0;b<e.length;b++){const i=e[b];if(i.timestamp<t||i.timestamp>s)continue;const o=Math.floor((i.timestamp-t)/r*(n-1)),c=Math.max(0,Math.min(n-1,o));if(i.rxUtilW>0){const e=Math.min(i.rxUtilW/a,1),t=Math.floor((1-e)*(l-1));for(let s=t;s<l;s++){const e=l-1-t,a=e>0?1-(s-t)/e*.7:1;d[x(s,c)]+=a}}if(i.txUtilW>0){const e=Math.min(i.txUtilW/a,1),t=Math.floor((1-e)*(l-1));for(let s=t;s<l;s++){const e=l-1-t,a=e>0?1-(s-t)/e*.7:1;m[x(s,c)]+=a}}}const h=[];for(let b=0;b<c;b++)d[b]>0&&h.push(d[b]),m[b]>0&&h.push(m[b]);h.sort((e,t)=>e-t);const u=h.length>0?h[Math.floor(.95*h.length)]:1,p=new Array(n),f=new Array(l),g=100/n,y=100/l;for(let b=0;b<n;b++)p[b]=b*g+"%";for(let b=0;b<l;b++)f[b]=b*y+"%";const j=[];for(let b=0;b<l;b++)for(let e=0;e<n;e++){const t=x(b,e),s=d[t]+.3*m[t];if(s>0&&u>0){const t=Math.min(s/u,1.5),a=Math.sqrt(t/1.5);j.push({xPct:p[e],yPct:f[b],intensity:a})}}return{cells:j,cellWidth:i,cellHeight:o}}(e,s,a,100,200,20),[e,s,a]),x=p.useMemo(()=>{if(0===e.length)return[];const t=Math.max(1,Math.floor(e.length/400)),s=[];for(let a=0;a<e.length;a+=t){const t=e[a];if(t&&"number"==typeof t.timestamp&&!isNaN(t.timestamp)){const e=t.rxRolling??t.rxUtilW,a=t.txRolling??t.txUtilW;s.push({timestamp:t.timestamp,rx:"number"!=typeof e||isNaN(e)?0:e,tx:"number"!=typeof a||isNaN(a)?0:a})}}return s},[e]),h=p.useMemo(()=>Math.max(1,Math.floor(x.length/8)),[x.length]),u=p.useMemo(()=>{const e=(a-s)/3600;return t=>{const s=new Date(1e3*t);return e>24?s.toLocaleDateString([],{month:"short",day:"numeric"})+" "+s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}):s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})}},[a,s]);return 0===e.length?t.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No traffic data available"}):t.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[t.jsx("div",{className:"relative flex-1 min-h-0",children:t.jsx(f,{width:"100%",height:"100%",children:t.jsxs(y,{data:x,margin:{top:8,right:8,bottom:0,left:0},children:[t.jsx(j,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.04)",vertical:!1}),t.jsx(b,{dataKey:"timestamp",type:"number",domain:[s,a],axisLine:!1,tickLine:!1,tick:{fill:"rgba(255,255,255,0.4)",fontSize:9,fontFamily:"'JetBrains Mono', monospace"},dy:4,interval:h,minTickGap:60,tickFormatter:u}),t.jsx(v,{axisLine:!1,tickLine:!1,tick:{fill:"rgba(255,255,255,0.4)",fontSize:10,fontFamily:"'JetBrains Mono', monospace"},dx:-8,width:44,tickFormatter:e=>`${e.toFixed(0)}%`,domain:[0,i]}),t.jsx(N,{content:t.jsx(re,{})}),t.jsx(w,{type:"linear",dataKey:"rx",name:"RX Avg",stroke:o,strokeWidth:2.5,strokeOpacity:.9,dot:!1,connectNulls:!1,isAnimationActive:!1}),t.jsx(w,{type:"linear",dataKey:"tx",name:"TX Avg",stroke:r,strokeWidth:2.5,strokeOpacity:.9,dot:!1,connectNulls:!1,isAnimationActive:!1})]})})}),t.jsx("div",{className:"relative overflow-hidden",style:{height:32,marginLeft:44,marginRight:8},children:t.jsxs("svg",{className:"absolute inset-0 w-full h-full",preserveAspectRatio:"none","aria-hidden":"true",children:[t.jsx("defs",{children:t.jsx("filter",{id:oe,x:"-100%",y:"-100%",width:"300%",height:"300%",children:t.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"1 3"})})}),t.jsx("g",{filter:`url(#${oe})`,children:c.map((e,s)=>t.jsx("rect",{x:e.xPct,y:e.yPct,width:d,height:m,fill:me(e.intensity),opacity:.9},`cell-${s}`))})]})}),t.jsx("div",{className:"flex-shrink-0",style:{height:24,marginTop:8},children:t.jsx(ce,{payload:[{value:"RX Avg",color:o},{value:"TX Avg",color:r}],showDensityScale:!0})})]})}),he=["N","NE","E","SE","S","SW","W","NW"];function ue(e,t,s,a){const n=(a-t)*Math.PI/180,l=e*Math.PI/180,i=s*Math.PI/180,o=Math.sin(n)*Math.cos(i),r=Math.cos(l)*Math.sin(i)-Math.sin(l)*Math.cos(i)*Math.cos(n);let c=180*Math.atan2(o,r)/Math.PI;return c=(c+360)%360,c}function pe(e,t,s,a){const n=(s-e)*Math.PI/180,l=(a-t)*Math.PI/180,i=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371}function fe(e,t){return e>=10?t.excellent:e>=7||e>=4?t.good:e>=1||e>=-2||e>=-5?t.fair:e>=-8?t.poor:t.critical}const ge=p.memo(function({neighbors:e,quickNeighbors:s,localLat:a,localLon:n}){const[l,i]=p.useState(null),[o,r]=p.useState(new Set),[c,d]=p.useState(0),m=p.useRef({}),x=F(),h=R();p.useEffect(()=>{const e=setTimeout(()=>{d(1)},100),t=setInterval(()=>{d(e=>e+1)},1e4);return()=>{clearTimeout(e),clearInterval(t)}},[]);const u=p.useMemo(()=>{const e=new Set;if(s)for(const t of s)e.add(t.hash);return e},[s]),f=p.useMemo(()=>{const e=new Map;if(s)for(const t of s)e.set(t.hash,{snr:t.avgSnr,rssi:t.avgRssi});return e},[s]),{processedNeighbors:g,maxDistance:y,totalNeighbors:j,zeroHopCount:b}=p.useMemo(()=>{const t=[];let s=0,l=0;for(const[i,o]of Object.entries(e)){if(!o.latitude||!o.longitude||0===o.latitude||0===o.longitude)continue;const e=ue(a,n,o.latitude,o.longitude),r=pe(a,n,o.latitude,o.longitude);r>s&&(s=r);const c=u.has(i);c&&l++;const d=f.get(i);t.push({hash:i.slice(0,8),name:o.node_name||o.name||"Unknown",snr:c?(null==d?void 0:d.snr)??o.snr??null:null,rssi:c?(null==d?void 0:d.rssi)??o.rssi??null:null,bearing:e,distance:r,normalizedDistance:0,lastSeen:o.last_seen,isZeroHop:c})}for(const e of t)e.normalizedDistance=s>0?.15+e.distance/s*.85:.15;return t.sort((e,t)=>!e.isZeroHop&&t.isZeroHop?-1:e.isZeroHop&&!t.isZeroHop?1:e.isZeroHop||t.isZeroHop?(e.snr??-1/0)-(t.snr??-1/0):t.distance-e.distance),{processedNeighbors:t,maxDistance:s,totalNeighbors:t.length,zeroHopCount:l}},[e,a,n,u,f]);if(p.useEffect(()=>{const e=[];for(const t of g){const s=m.current[t.hash];void 0!==s&&s!==t.lastSeen&&e.push(t.hash),m.current[t.hash]=t.lastSeen}e.length>0&&(queueMicrotask(()=>{r(t=>{const s=new Set(t);return e.forEach(e=>s.add(e)),s})}),setTimeout(()=>{r(t=>{const s=new Set(t);return e.forEach(e=>s.delete(e)),s})},600))},[g]),0===a||0===n)return t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-text-muted",children:[t.jsx(Q,{className:"w-8 h-8 mb-2 opacity-50"}),t.jsx("p",{children:"Local node coordinates not configured"}),t.jsx("p",{className:"text-xs mt-1",children:"Set latitude/longitude in config to enable"})]});if(0===j)return t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-text-muted",children:[t.jsx(Q,{className:"w-8 h-8 mb-2 opacity-50"}),t.jsx("p",{children:"No nodes with location data"})]});const v=140,N=(e,t)=>{const s=(e-90)*Math.PI/180,a=110*t;return{x:v+a*Math.cos(s),y:v+a*Math.sin(s)}};return t.jsxs("div",{className:"flex flex-col h-full",children:[t.jsxs("div",{className:"text-xs text-text-muted uppercase tracking-wide mb-2",children:[b," neighbor",1!==b?"s":""," • ",j," observed • max ",y.toFixed(1)," km"]}),t.jsxs("div",{className:"relative h-[280px]",children:[t.jsxs("svg",{width:280,height:280,className:"mx-auto",children:[t.jsx("defs",{children:t.jsx("style",{children:`\n                @keyframes radar-pulse-scale {\n                  0% {\n                    transform: scale(0);\n                    opacity: 0.9;\n                    stroke-width: 10;\n                  }\n                  100% {\n                    transform: scale(1);\n                    opacity: 0;\n                    stroke-width: 1;\n                  }\n                }\n                @keyframes local-node-ping {\n                  0% {\n                    fill: ${x.excellent};\n                  }\n                  100% {\n                    fill: ${h.chart6};\n                  }\n                }\n                @keyframes neighbor-blink-scale {\n                  0%, 100% {\n                    transform: scale(1);\n                    opacity: 0;\n                  }\n                  50% {\n                    transform: scale(1.3);\n                    opacity: 0.8;\n                  }\n                }\n                .radar-pulse-circle {\n                  transform-origin: center;\n                  animation: radar-pulse-scale 2000ms cubic-bezier(0.15, 0.6, 0.4, 1) forwards;\n                }\n                .local-node-ping {\n                  animation: local-node-ping 1000ms ease-out forwards;\n                }\n                .neighbor-blink-ring {\n                  transform-origin: center;\n                  animation: neighbor-blink-scale 600ms ease-out forwards;\n                }\n              `})}),[.25,.5,.75,1].map(e=>t.jsx("circle",{cx:v,cy:v,r:110*e,fill:"none",stroke:"rgba(255,255,255,0.1)",strokeWidth:1},e)),c>0&&t.jsx("circle",{cx:v,cy:v,r:110,fill:"none",stroke:"rgba(255,255,255,0.5)",strokeWidth:1.5,className:"radar-pulse-circle"},`pulse-${c}`),he.map((e,s)=>{const a=N(45*s,1);return t.jsx("line",{x1:v,y1:v,x2:a.x,y2:a.y,stroke:"rgba(255,255,255,0.08)",strokeWidth:1},e)}),he.map((e,s)=>{const a=N(45*s,1.12);return t.jsx("text",{x:a.x,y:a.y,textAnchor:"middle",dominantBaseline:"middle",fill:"rgba(255,255,255,0.5)",fontSize:10,fontFamily:"'JetBrains Mono', monospace",children:e},e)}),t.jsx("circle",{cx:v,cy:v,r:6,fill:h.chart6,stroke:"rgba(255,255,255,0.3)",strokeWidth:1,className:c>0?"local-node-ping":""},`local-${c}`),g.map(e=>{const{x:s,y:a}=N(e.bearing,e.normalizedDistance),n=e.isZeroHop&&null!==e.snr?fe(e.snr,x):"rgba(107, 114, 128, 0.66)",r=e.isZeroHop?1:.33,c=(null==l?void 0:l.hash)===e.hash,d=o.has(e.hash);return t.jsxs("g",{children:[d&&t.jsx("circle",{cx:s,cy:a,r:12,fill:"none",stroke:"rgba(255,255,255,0.9)",strokeWidth:2,className:"neighbor-blink-ring"}),c&&t.jsx("circle",{cx:s,cy:a,r:12,fill:n,opacity:.3}),t.jsx("circle",{cx:s,cy:a,r:c?8:6,fill:n,fillOpacity:c?1:r,stroke:"rgba(0,0,0,0.5)",strokeWidth:1,style:{cursor:"pointer",transition:"r 0.15s, fill-opacity 0.15s"},onMouseEnter:()=>i(e),onMouseLeave:()=>i(null)})]},e.hash)})]}),l&&t.jsxs("div",{className:"absolute bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 text-sm pointer-events-none z-10 shadow-xl",style:{left:"50%",bottom:8,transform:"translateX(-50%)"},children:[t.jsx("div",{className:"font-medium text-text-primary",children:l.name}),t.jsxs("div",{className:"text-text-muted text-xs font-mono",children:[l.hash,!l.isZeroHop&&t.jsx("span",{className:"ml-2 text-text-muted",children:"(not direct)"})]}),l.isZeroHop&&null!==l.snr?t.jsx("div",{className:"flex gap-3 mt-1 text-xs",children:t.jsxs("span",{children:[t.jsx("span",{className:"text-text-muted",children:"SNR:"})," ",t.jsxs("span",{className:"tabular-nums",style:{color:fe(l.snr,x)},children:[l.snr.toFixed(1)," dB"]}),t.jsxs("span",{className:"text-text-muted ml-1",children:["(",(w=l.snr,w>=10?"Excellent":w>=7?"Very Good":w>=4?"Good":w>=1?"Fair+":w>=-2?"Fair":w>=-5?"Fair-":w>=-8?"Poor":w>=-11?"Bad":"Critical"),")"]})]})}):t.jsx("div",{className:"text-xs text-text-muted mt-1",children:"No direct RF data"}),t.jsxs("div",{className:"flex gap-3 text-xs",children:[t.jsxs("span",{children:[t.jsx("span",{className:"text-text-muted",children:"Distance:"})," ",t.jsxs("span",{className:"tabular-nums text-text-secondary",children:[l.distance.toFixed(2)," km"]})]}),t.jsxs("span",{children:[t.jsx("span",{className:"text-text-muted",children:"Bearing:"})," ",t.jsxs("span",{className:"tabular-nums text-text-secondary",children:[l.bearing.toFixed(0),"°"]})]})]})]})]})]});var w}),ye="noiseFloorHeatBlur";function je(e,t){if(0===e.length)return 0;const s=t/100*(e.length-1),a=Math.floor(s),n=Math.ceil(s);return a===n?e[a]:e[a]+(e[n]-e[a])*(s-a)}const be=p.memo(function({timestamps:e,values:s,height:a=224,onStatsChange:n}){var l,i;const o=R(),[r,c]=p.useState(!0),d=p.useMemo(()=>{if(0===s.length)return null;const e=Math.min(...s),t=Math.max(...s),a=s.reduce((e,t)=>e+t,0)/s.length,n=[...s].sort((e,t)=>e-t);return{min:e,max:t,avg:a,p5:je(n,5),p95:je(n,95)}},[s]);p.useEffect(()=>{null==n||n(d)},[d,n]);const m=p.useCallback(()=>{c(e=>!e)},[]),{cells:x,gridInfo:h,xLabels:u,yLabels:f}=p.useMemo(()=>{if(0===e.length||0===s.length||!d)return{cells:[],gridInfo:null,xLabels:[],yLabels:[]};const t=Math.min(720,2*e.length),a=120;let n,l;if(r){const e=.1*(d.p95-d.p5||1);n=d.p5-e,l=d.p95+e}else{const e=.1*(d.max-d.min||1);n=d.min-e,l=d.max+e}const i=l-n,o=Math.min(...e),c=Math.max(...e)-o||1,m=Array(a).fill(null).map(()=>Array(t).fill(0));for(let r=0;r<e.length;r++){const a=Math.floor((e[r]-o)/c*(t-1)),d=Math.max(n,Math.min(l,s[r])),x=Math.floor((d-n)/i*119),h=Math.max(0,Math.min(t-1,a)),u=Math.max(0,Math.min(119,119-x));m[u][h]++,u>0&&(m[u-1][h]+=.4),u<119&&(m[u+1][h]+=.4),h>0&&(m[u][h-1]+=.3),h<t-1&&(m[u][h+1]+=.3),u>0&&h>0&&(m[u-1][h-1]+=.2),u>0&&h<t-1&&(m[u-1][h+1]+=.2),u<119&&h>0&&(m[u+1][h-1]+=.2),u<119&&h<t-1&&(m[u+1][h+1]+=.2),u>1&&(m[u-2][h]+=.15),u<118&&(m[u+2][h]+=.15),h>1&&(m[u][h-2]+=.1),h<t-2&&(m[u][h+2]+=.1)}let x=0;for(let e=0;e<a;e++)for(let s=0;s<t;s++)m[e][s]>x&&(x=m[e][s]);const h=[];for(let e=0;e<a;e++)for(let s=0;s<t;s++)m[e][s]>0&&h.push({x:s,y:e,intensity:m[e][s]/x});const u=[];for(let e=0;e<=5;e++){const t=o+c*e/5;u.push({pos:e/5*100,label:new Date(1e3*t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})}const p=[];for(let e=0;e<=4;e++){const t=n+i*e/4;p.push({pos:100*(1-e/4),label:`${Math.round(t)}`})}return{cells:h,gridInfo:{cols:t,rows:a},xLabels:u,yLabels:p}},[e,s,d,r]);if(!h||0===x.length)return t.jsx("div",{style:{height:a},className:"flex items-center justify-center text-text-muted",children:"No noise floor data available"});const g=100/h.cols,y=100/h.rows,j=o.chart1;return t.jsxs("div",{className:"relative w-full",style:{height:a},role:"img","aria-label":`RF noise floor heatmap showing values from ${(null==(l=null==d?void 0:d.min)?void 0:l.toFixed(0))??"N/A"} to ${(null==(i=null==d?void 0:d.max)?void 0:i.toFixed(0))??"N/A"} dBm`,children:[t.jsx("div",{className:"absolute top-0 left-0 flex flex-col justify-between",style:{width:32,bottom:20},"aria-hidden":"true",children:f.map((e,s)=>t.jsx("span",{className:"type-data-xs text-text-muted tabular-nums text-right pr-1.5",style:{position:"absolute",top:`${e.pos}%`,transform:"translateY(-50%)",right:0},children:e.label},s))}),t.jsxs("div",{className:"absolute overflow-hidden",style:{left:32,right:0,top:0,bottom:20},children:[t.jsx("svg",{className:"absolute inset-0 w-full h-full",preserveAspectRatio:"none","aria-hidden":"true",children:[0,25,50,75,100].map(e=>t.jsx("line",{x1:"0",y1:`${e}%`,x2:"100%",y2:`${e}%`,stroke:"rgba(255,255,255,0.06)",strokeDasharray:"3 3"},e))}),t.jsxs("svg",{className:"absolute inset-0 w-full h-full",preserveAspectRatio:"none","aria-hidden":"true",children:[t.jsx("defs",{children:t.jsx("filter",{id:ye,x:"-50%",y:"-50%",width:"200%",height:"200%",children:t.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"1.5"})})}),t.jsx("g",{filter:`url(#${ye})`,children:x.map((e,s)=>{const a=.15+.85*e.intensity,n=50+50*e.intensity;return t.jsx("rect",{x:e.x*g+"%",y:e.y*y+"%",width:`${g+.1}%`,height:`${y+.1}%`,fill:j,opacity:a,style:{filter:e.intensity>.7?`saturate(${n}%)`:void 0}},s)})})]}),t.jsx("button",{type:"button",onClick:m,className:"absolute bottom-1 right-1 p-1.5 rounded bg-tooltip-bg/80 hover:bg-tooltip-bg active:bg-tooltip-bg transition-colors touch-manipulation",title:r?"Show full range (min/max)":"Show trimmed range (P5-P95)","aria-label":r?"Expand to show full data range":"Shrink to show trimmed percentile range","aria-pressed":!r,children:r?t.jsx(ee,{className:"w-3.5 h-3.5 text-text-muted","aria-hidden":"true"}):t.jsx(se,{className:"w-3.5 h-3.5 text-text-muted","aria-hidden":"true"})})]}),t.jsx("div",{className:"absolute left-0 right-0 bottom-0",style:{left:32,height:20},"aria-hidden":"true",children:u.map((e,s)=>t.jsx("span",{className:"type-data-xs text-text-muted tabular-nums absolute top-1",style:{left:`${e.pos}%`,transform:"translateX(-50%)"},children:e.label},s))})]})}),ve={repeater:"var(--accent-primary)",companion:"var(--accent-tertiary)",room_server:"var(--accent-secondary)"};function Ne(e){if(e.contact_type){const t=e.contact_type.toLowerCase();if("repeater"===t||"rep"===t)return"repeater";if("room server"===t||"room_server"===t||"room"===t||"server"===t)return"room_server";if("companion"===t||"client"===t||"cli"===t)return"companion"}return e.is_repeater?"repeater":"companion"}const we=p.memo(function({neighbors:e}){const s=p.useMemo(()=>{const t={repeater:0,companion:0,room_server:0};for(const a of Object.values(e)){const e=Ne(a);t[e]=(t[e]||0)+1}const s=Object.values(t).reduce((e,t)=>e+t,0);return{items:[{label:"Repeaters",count:t.repeater,percent:0,color:ve.repeater},{label:"Companions",count:t.companion,percent:0,color:ve.companion},{label:"Room Servers",count:t.room_server,percent:0,color:ve.room_server}].map(e=>({...e,percent:s>0?e.count/s*100:0})).filter(e=>e.count>0).sort((e,t)=>t.count-e.count),total:s}},[e]);return 0===s.total?t.jsx("div",{className:"h-full flex items-center justify-center text-text-muted type-body-sm",children:"No neighbors discovered yet"}):t.jsxs("div",{className:"flex flex-col gap-3",children:[s.items.map(e=>t.jsxs("div",{className:"flex flex-col gap-1.5",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"type-data-sm text-text-secondary",children:e.label}),t.jsxs("span",{className:"type-data-sm text-text-muted tabular-nums",children:[e.count," ",t.jsxs("span",{className:"text-text-muted/60",children:["(",e.percent.toFixed(0),"%)"]})]})]}),t.jsx("div",{className:"h-2.5 bg-bg-elevated rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full rounded-full transition-all duration-500 ease-out",style:{width:`${e.percent}%`,backgroundColor:e.color,minWidth:e.count>0?"4px":"0"}})})]},e.label)),t.jsxs("div",{className:"flex items-center justify-between pt-2 mt-1 border-t border-border-subtle",children:[t.jsx("span",{className:"type-data-xs text-text-muted",children:"Total Nodes"}),t.jsx("span",{className:"type-data-sm text-text-primary font-medium tabular-nums",children:s.total})]})]})});function Me(e,t,s,a=!0,n=60){const l=new Map(e.map(e=>[e.start,e])),i=new Map(t.map(e=>[e.start,e])),o=Array.from(new Set([...l.keys(),...i.keys()])).sort((e,t)=>e-t).map(e=>{const t=l.get(e),a=i.get(e);return{timestamp:e,rxUtilW:((null==t?void 0:t.airtime_ms)??0)/s*100,txUtilW:((null==a?void 0:a.airtime_ms)??0)/s*100}});return a&&o.length>1?function(e,t=60){if(0===e.length)return[];const s=1-Math.pow(.5,1/t),a=Math.min(e.length,Math.max(10,Math.floor(t/3)));let n=0,l=0;for(let i=0;i<a;i++)n+=e[i].rxUtilW,l+=e[i].txUtilW;return n/=a,l/=a,e.map(e=>(n=s*e.rxUtilW+(1-s)*n,l=s*e.txUtilW+(1-s)*l,{...e,rxRolling:n,txRolling:l}))}(o,n):o}const ke="#4338CA",Se="#F59E0B",Ce="#39D98A";function Te({hash:e,highlighted:s}){const[a,n]=p.useState(!1),l=p.useCallback(t=>{t.preventDefault(),t.stopPropagation(),function(e){if("undefined"!=typeof window&&(window.isSecureContext||"https:"===window.location.protocol||"localhost"===window.location.hostname)&&navigator.clipboard&&"function"==typeof navigator.clipboard.writeText)return navigator.clipboard.writeText(e).catch(()=>{}),!0;try{const t=window.scrollX,s=window.scrollY,a=document.createElement("textarea");a.value=e,a.style.cssText="position:fixed;left:-9999px;top:-9999px;opacity:0;pointer-events:none",a.setAttribute("readonly",""),document.body.appendChild(a),a.focus({preventScroll:!0}),a.select(),a.setSelectionRange(0,e.length);const n=document.execCommand("copy");return document.body.removeChild(a),window.scrollTo(t,s),n}catch{return!1}}(e),n(!0),setTimeout(()=>n(!1),2e3)},[e]),i=e.length>12?`${e.slice(0,12)}…`:e;return t.jsxs("button",{type:"button",onClick:l,className:k("inline-flex items-center gap-1 px-1.5 py-0.5 text-[10px] font-mono rounded transition-all","border border-border-subtle hover:border-border-strong cursor-pointer select-none",s?"bg-accent-secondary/20 border-accent-secondary/50":"bg-bg-subtle/80 hover:bg-bg-elevated"),title:`Click to copy: ${e}`,children:[t.jsx("span",{className:k("transition-colors",a?"text-accent-success":"text-text-secondary"),children:i}),a?t.jsx(B,{className:"w-2.5 h-2.5 text-accent-success"}):t.jsx(D,{className:"w-2.5 h-2.5 opacity-40"})]})}function Le({node:e,className:s}){const a=e.contactType.toLowerCase(),n="room server"===a||"room_server"===a||"room"===a||"server"===a,l="companion"===a||"client"===a||"cli"===a;return n&&e.isRepeater?t.jsxs("div",{className:k("relative",s),children:[t.jsx(U,{className:"w-full h-full",style:{color:Se}}),t.jsx(I,{className:"w-1/2 h-1/2 absolute -bottom-0.5 -right-0.5",style:{color:ke}})]}):n?t.jsx(U,{className:s,style:{color:Se}}):l?t.jsx(O,{className:k(s,"text-text-muted")}):e.isRepeater?e.isNeighbor?t.jsx(q,{className:s,style:{color:Ce}}):t.jsx(I,{className:s,style:{color:ke}}):t.jsx(O,{className:k(s,"text-text-muted")})}function Pe({node:e,isHovered:s,onMouseEnter:a,onMouseLeave:n,onTouchStart:l}){return t.jsxs("div",{className:k("flex items-center gap-3 px-3 py-2.5 transition-colors rounded-lg",s?"bg-accent-secondary/10":"hover:bg-white/[0.03]"),onMouseEnter:a,onMouseLeave:n,onTouchStart:l,children:[t.jsx("div",{className:"flex-shrink-0 w-5 h-5",children:t.jsx(Le,{node:e,className:"w-5 h-5"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t.jsx("span",{className:"text-sm font-medium text-text-primary truncate",children:e.name}),e.isNeighbor&&t.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded font-medium",style:{backgroundColor:"rgba(57, 217, 138, 0.2)",color:"#39D98A"},children:"NBR"}),e.isRepeater&&t.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-white/10 text-text-muted font-medium",children:"RPT"})]}),t.jsx("div",{className:"mt-1",children:t.jsx(Te,{hash:e.hash,highlighted:s})})]})]})}function Fe({nodes:e,hoveredHash:s,onNodeHover:a,onNodeLeave:n}){const l=p.useRef(null),i=p.useRef(null),o=p.useRef(new Map),r=p.useMemo(()=>e.filter(e=>e.latitude&&e.longitude&&0!==e.latitude&&0!==e.longitude),[e]);return p.useEffect(()=>{if(!i.current||l.current)return;const e=H.map(i.current,{zoomControl:!0,attributionControl:!0});return H.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> &copy; <a href="https://carto.com/">CARTO</a>'}).addTo(e),l.current=e,()=>{e.remove(),l.current=null}},[]),p.useEffect(()=>{const e=l.current;if(!e)return;if(o.current.forEach(e=>e.remove()),o.current.clear(),0===r.length)return;const t=H.latLngBounds([]);for(const s of r){if(!s.latitude||!s.longitude)continue;const l=H.latLng(s.latitude,s.longitude);t.extend(l);const i=s.isNeighbor?Ce:ke,r=H.circleMarker(l,{radius:8,fillColor:i,fillOpacity:.8,color:"#fff",weight:2,opacity:.9});r.bindTooltip(s.name,{permanent:!1,direction:"top",offset:[0,-8],className:"collision-tooltip"}),r.on("mouseover",()=>a(s.hash)),r.on("mouseout",()=>n()),r.addTo(e),o.current.set(s.hash,r)}t.isValid()&&e.fitBounds(t,{padding:[40,40],maxZoom:12})},[r,a,n]),p.useEffect(()=>{o.current.forEach((e,t)=>{const a=r.find(e=>e.hash===t);if(!a)return;const n=t===s,l=a.isNeighbor?Ce:ke;e.setStyle({radius:n?12:8,fillColor:n?"#FBBF24":l,weight:n?3:2}),n?(e.openTooltip(),e.bringToFront()):e.closeTooltip()})},[s,r]),0===r.length?t.jsx("div",{className:"h-full flex items-center justify-center bg-bg-subtle/30 rounded-lg",children:t.jsxs("div",{className:"text-center text-text-muted p-4",children:[t.jsx(z,{className:"w-8 h-8 mx-auto mb-2 opacity-40"}),t.jsx("p",{className:"text-sm",children:"No location data available"}),t.jsx("p",{className:"text-xs opacity-70",children:"Nodes need GPS coordinates to appear on the map"})]})}):t.jsx("div",{ref:i,className:"h-full w-full rounded-lg overflow-hidden"})}const Re=p.memo(function({isOpen:e,prefix:i,candidateHashes:o,onClose:r}){const c=s(),d=a(),m=n(),[x,h]=p.useState(null),u=p.useMemo(()=>new Set(m.map(e=>e.hash)),[m]),f=null==c?void 0:c.neighbors,g=p.useMemo(()=>f?o.map(e=>{var t,s;const a=f[e];return{hash:e,name:(null==a?void 0:a.node_name)||(null==a?void 0:a.name)||`Unknown (${e.slice(0,8)}…)`,contactType:(null==a?void 0:a.contact_type)||"",isRepeater:(null==a?void 0:a.is_repeater)||"repeater"===(null==(t=null==a?void 0:a.contact_type)?void 0:t.toLowerCase())||"rep"===(null==(s=null==a?void 0:a.contact_type)?void 0:s.toLowerCase())||!1,isNeighbor:u.has(e),isHub:d.has(e),latitude:null==a?void 0:a.latitude,longitude:null==a?void 0:a.longitude,lastSeen:null==a?void 0:a.last_seen}}).sort((e,t)=>e.isNeighbor!==t.isNeighbor?e.isNeighbor?-1:1:e.name.localeCompare(t.name)):[],[o,f,u,d]),y=p.useCallback(e=>h(e),[]),j=p.useCallback(()=>h(null),[]);return p.useEffect(()=>{if(!e)return;const t=e=>{"Escape"===e.key&&r()};window.addEventListener("keydown",t);const s=window.scrollY,a={overflow:document.body.style.overflow,position:document.body.style.position,width:document.body.style.width,top:document.body.style.top};return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.top=`-${s}px`,()=>{window.removeEventListener("keydown",t),document.body.style.overflow=a.overflow,document.body.style.position=a.position,document.body.style.width=a.width,document.body.style.top=a.top,window.scrollTo(0,s)}},[e,r]),e?M.createPortal(t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[10010] flex items-end sm:items-center justify-center",onClick:r,role:"dialog","aria-modal":"true","aria-labelledby":"collision-modal-title",children:t.jsxs("div",{className:k("glass-card w-full overflow-hidden flex flex-col","max-h-[85vh] rounded-t-2xl rounded-b-none","sm:max-w-2xl sm:mx-4 sm:rounded-xl sm:max-h-[80vh]","pb-safe"),onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border-subtle flex-shrink-0",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 rounded-lg bg-signal-fair/10",children:t.jsx(_,{className:"w-5 h-5 text-signal-fair"})}),t.jsxs("div",{children:[t.jsxs("h3",{id:"collision-modal-title",className:"text-base font-semibold text-text-primary",children:["Prefix Collision: ",t.jsx("span",{className:"font-mono text-accent-primary",children:i})]}),t.jsxs("p",{className:"text-xs text-text-muted",children:[g.length," nodes share this prefix"]})]})]}),t.jsx("button",{onClick:r,className:"p-2 rounded-lg text-text-muted hover:text-text-primary hover:bg-bg-subtle transition-colors",children:t.jsx(l,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"flex-1 min-h-0 flex flex-col sm:flex-row overflow-hidden",children:[t.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto sm:max-w-[280px] sm:border-r sm:border-border-subtle",children:t.jsx("div",{className:"p-2",children:g.map(e=>t.jsx(Pe,{node:e,isHovered:x===e.hash,onMouseEnter:()=>y(e.hash),onMouseLeave:j,onTouchStart:()=>y(e.hash)},e.hash))})}),t.jsx("div",{className:"h-48 sm:h-auto sm:flex-1 p-2 flex-shrink-0",children:t.jsx(Fe,{nodes:g,hoveredHash:x,onNodeHover:y,onNodeLeave:j})})]})]})}),document.body):null}),Ae={excellent:"text-signal-excellent",good:"text-signal-good",fair:"text-signal-fair",poor:"text-signal-poor"},$e={excellent:"bg-signal-excellent/10",good:"bg-signal-good/10",fair:"bg-signal-fair/10",poor:"bg-signal-poor/10"};function We({value:e,status:s}){const a={excellent:"bg-signal-excellent",good:"bg-signal-good",fair:"bg-signal-fair",poor:"bg-signal-poor"}[s];return t.jsx("div",{className:"w-full h-2 bg-surface-elevated rounded-full overflow-hidden",children:t.jsx("div",{className:`h-full ${a} transition-all duration-300`,style:{width:`${Math.min(100,Math.max(0,e))}%`}})})}function Ee(){const e=i(),s=o(),[a,n]=p.useState(null),l=p.useCallback((e,t)=>{n({prefix:e,candidateHashes:t})},[]),r=p.useCallback(()=>{n(null)},[]);if(!s)return t.jsxs(A,{size:"lg",className:"flex flex-col",children:[t.jsx($,{icon:t.jsx(te,{}),title:"Prefix Disambiguation",largeTitle:!0}),t.jsx("div",{className:"flex-1 flex items-center justify-center",children:t.jsxs("div",{className:"text-center text-text-muted",children:[t.jsx(Z,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"type-data-xs",children:"No topology data available"}),t.jsx("p",{className:"type-data-xs opacity-70",children:"Run deep analysis to see stats"})]})})]});const c=(d=e.avgConfidence)>=.9?"excellent":d>=.7?"good":d>=.5?"fair":"poor";var d;const m=(x=e.collisionRate)<=10?"excellent":x<=25?"good":"poor";var x;const h="poor"===c||"poor"===m?"poor":"fair"===c||"fair"===m?"fair":"good"===c||"good"===m?"good":"excellent",u="excellent"===h||"good"===h?K:_;return t.jsxs(A,{size:"lg",className:"flex flex-col",children:[t.jsx($,{icon:t.jsx(te,{}),title:"Prefix Disambiguation",largeTitle:!0,actions:t.jsxs("div",{className:`flex items-center gap-1.5 px-2 py-1 rounded ${$e[h]}`,children:[t.jsx(u,{className:`w-3.5 h-3.5 ${Ae[h]}`}),t.jsx("span",{className:`type-data-xs font-medium ${Ae[h]}`,children:"excellent"===h?"Excellent":"good"===h?"Good":"fair"===h?"Fair":"Needs Attention"})]})}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-baseline justify-between mb-1",children:[t.jsx("span",{className:"type-data-xs text-text-muted",children:"Avg Confidence"}),t.jsxs("span",{className:`type-data-lg font-semibold ${Ae[c]}`,children:[(100*e.avgConfidence).toFixed(1),"%"]})]}),t.jsx(We,{value:100*e.avgConfidence,status:c})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-baseline justify-between mb-1",children:[t.jsx("span",{className:"type-data-xs text-text-muted",children:"Collision Rate"}),t.jsxs("span",{className:`type-data-lg font-semibold ${Ae[m]}`,children:[e.collisionRate.toFixed(1),"%"]})]}),t.jsx(We,{value:e.collisionRate,status:m})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4 py-3 border-t border-b border-border-subtle",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"type-data-lg font-semibold text-text-primary",children:e.totalPrefixes}),t.jsx("div",{className:"type-data-xs text-text-muted",children:"Prefixes"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"type-data-lg font-semibold text-signal-good",children:e.unambiguousPrefixes}),t.jsx("div",{className:"type-data-xs text-text-muted",children:"Unique"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"type-data-lg font-semibold "+(e.collisionPrefixes>0?"text-signal-fair":"text-text-primary"),children:e.collisionPrefixes}),t.jsx("div",{className:"type-data-xs text-text-muted",children:"Collisions"})]})]}),e.highCollisionPrefixes.length>0&&t.jsxs("div",{className:"mb-3",children:[t.jsx("div",{className:"type-data-xs text-text-muted mb-2",children:"Highest Collisions"}),t.jsx("div",{className:"flex flex-wrap gap-1.5",children:e.highCollisionPrefixes.map(({prefix:e,candidateCount:s,candidateHashes:a})=>t.jsxs("button",{type:"button",onClick:()=>l(e,a),className:"inline-flex items-center gap-1 px-2 py-1 min-h-[28px] rounded bg-surface-elevated text-text-secondary type-data-xs font-mono hover:bg-accent-primary/20 hover:text-accent-primary focus:outline-none focus:ring-2 focus:ring-accent-primary/50 transition-colors cursor-pointer touch-manipulation",title:`Click to explore ${s} candidates matching this prefix`,"aria-label":`Explore prefix ${e} with ${s} colliding candidates`,children:[e,t.jsxs("span",{className:"text-signal-fair",children:["×",s]})]},e))})]}),e.lowConfidencePrefixes.length>0&&t.jsx("div",{className:"mt-auto pt-3 border-t border-border-subtle",children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx(_,{className:"w-3.5 h-3.5 text-signal-poor mt-0.5 flex-shrink-0"}),t.jsxs("div",{children:[t.jsxs("div",{className:"type-data-xs text-signal-poor font-medium",children:[e.lowConfidencePrefixes.length," prefix",1!==e.lowConfidencePrefixes.length?"es":""," with low confidence"]}),t.jsxs("div",{className:"type-data-xs text-text-muted mt-0.5",children:[e.lowConfidencePrefixes.slice(0,5).join(", "),e.lowConfidencePrefixes.length>5&&` +${e.lowConfidencePrefixes.length-5} more`]})]})]})}),0===e.lowConfidencePrefixes.length&&0===e.collisionPrefixes&&t.jsx("div",{className:"mt-auto pt-3 border-t border-border-subtle",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(K,{className:"w-3.5 h-3.5 text-signal-excellent"}),t.jsx("span",{className:"type-data-xs text-signal-excellent",children:"All prefixes uniquely identified"})]})}),t.jsx(Re,{isOpen:!!a,prefix:(null==a?void 0:a.prefix)||"",candidateHashes:(null==a?void 0:a.candidateHashes)||[],onClose:r})]})}function He(){var e,a,l,i;const o=s(),f=r(),g=n(),[y,j]=p.useState(null),[b,v]=p.useState(null),[N,w]=p.useState([]),[M,k]=p.useState(null),[L,P]=p.useState(!0),[F,R]=p.useState(null),[H,_]=p.useState(3),z=S(H,150),B=c[z].hours,D=60*B,U=Math.ceil(60*D/10);p.useEffect(()=>{!async function(){var e;R(null);try{const[t,s,a]=await Promise.all([d(D,U),m(B),x(B)]);t.success&&t.data&&j(t.data),s.success&&s.data&&v(s.data),a.success&&(null==(e=a.data)?void 0:e.history)&&w(a.data.history)}catch(t){R(t instanceof Error?t.message:"Failed to load chart data")}finally{P(!1)}}()},[B,D,U]);const{utilSamples:I,startTs:O,endTs:q}=p.useMemo(()=>{if(!y)return{utilSamples:[],startTs:0,endTs:0};const{received:e,transmitted:t,forwarded:s,bucket_duration_seconds:a,start_time:n,end_time:l}=y,i=1e3*a,o=function(e,t){const s=new Map;for(const a of e)s.set(a.start,{...a});for(const a of t){const e=s.get(a.start);e?(e.airtime_ms+=a.airtime_ms,e.count+=a.count):s.set(a.start,{...a})}return Array.from(s.values()).sort((e,t)=>e.start-t.start)}(t,s);return{utilSamples:Me(e,o,i),startTs:n,endTs:l}},[y]),Z=p.useMemo(()=>{switch(B){case 72:return 6e5;case 168:return 18e5;default:return 3e5}},[B]),K=p.useCallback(async()=>{try{const e=await d(D,U);e.success&&e.data&&j(e.data)}catch{}},[D,U]),ee=p.useCallback(async()=>{try{const e=await m(B);e.success&&e.data&&v(e.data)}catch{}},[B]),te=p.useCallback(async()=>{var e;try{const t=await x(B);t.success&&(null==(e=t.data)?void 0:e.history)&&w(t.data.history)}catch{}},[B]);T(K,Z,!0,!0),T(ee,Z,!0,!0),T(te,Z,!0,!0);const se=p.useMemo(()=>b&&b.series?b.series.map(e=>({name:e.name,value:e.data.reduce((e,t)=>e+(t[1]??0),0)})).filter(e=>e.value>0):[],[b]),ae=p.useMemo(()=>0===N.length?{timestamps:[],values:[]}:{timestamps:N.map(e=>e.timestamp),values:N.map(e=>e.noise_floor_dbm)},[N]),ne=c[H],le=p.useMemo(()=>{const e=(null==o?void 0:o.neighbors)??{};return Object.fromEntries(Object.entries(e).filter(([e])=>!f.has(e)))},[null==o?void 0:o.neighbors,f]),oe=p.useMemo(()=>{const e=Date.now()/1e3-3600*B;return Object.fromEntries(Object.entries(le).filter(([,t])=>t.last_seen>=e))},[le,B]),re=p.useMemo(()=>0===I.length?{peak:0,mean:0}:{peak:Math.max(...I.map(e=>e.rxUtilW)),mean:I.reduce((e,t)=>e+t.rxUtilW,0)/I.length},[I]);return t.jsxs(W,{children:[t.jsx(E,{title:"Statistics",icon:t.jsx(h,{}),controls:t.jsx(C,{ranges:c,selectedIndex:H,onSelect:_})}),F&&t.jsx(A,{className:"border border-accent-red/50 bg-accent-red/10",children:t.jsx("p",{className:"text-accent-red",children:F})}),L?t.jsx(G,{template:"auto",children:t.jsx(A,{className:"text-center py-12",children:t.jsx("div",{className:"animate-pulse text-text-muted",children:"Loading statistics..."})})}):t.jsxs(t.Fragment,{children:[t.jsxs(G,{template:"feature",children:[t.jsx(X,{span:12,lg:8,children:t.jsxs(A,{children:[t.jsx($,{icon:t.jsx(V,{}),title:"Airtime Utilization",badge:ne.label,largeTitle:!0,actions:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("span",{className:"type-data-xs text-text-muted",children:["Peak ",t.jsxs("span",{className:"text-text-secondary tabular-nums font-medium",children:[re.peak.toFixed(2),"%"]})]}),t.jsxs("span",{className:"type-data-xs text-text-muted",children:["Mean ",t.jsxs("span",{className:"text-text-secondary tabular-nums font-medium",children:[re.mean.toFixed(2),"%"]})]})]})}),t.jsx("div",{className:"flex-1 min-h-0",children:t.jsx(xe,{samples:I,startTs:O,endTs:q})})]})}),t.jsx(X,{span:12,lg:4,children:t.jsxs(A,{children:[t.jsx($,{icon:t.jsx(Q,{}),title:"Link Quality",badge:ne.label,largeTitle:!0}),t.jsx("div",{className:"flex-1 min-h-0",children:t.jsx(ge,{neighbors:oe,quickNeighbors:g,localLat:(null==(a=null==(e=null==o?void 0:o.config)?void 0:e.repeater)?void 0:a.latitude)??0,localLon:(null==(i=null==(l=null==o?void 0:o.config)?void 0:l.repeater)?void 0:i.longitude)??0})})]})})]}),t.jsxs(G,{template:"standard",children:[t.jsx(X,{span:12,md:6,children:t.jsxs(A,{children:[t.jsx($,{icon:t.jsx(Y,{}),title:"Packet Types",largeTitle:!0}),t.jsx("div",{className:"flex-1 min-h-0",children:se.length>0?t.jsx(ie,{data:se}):t.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No packet type data available"})})]})}),t.jsx(X,{span:12,md:6,children:t.jsx(Ee,{})})]}),t.jsxs(G,{template:"standard",children:[t.jsx(X,{span:12,md:6,children:t.jsxs(A,{children:[t.jsx($,{icon:t.jsx(J,{}),title:"Network Composition",badge:ne.label,largeTitle:!0}),t.jsx("div",{className:"flex-1 min-h-0",children:t.jsx(we,{neighbors:oe})})]})}),t.jsx(X,{span:12,md:6,children:t.jsxs(A,{children:[t.jsx($,{icon:t.jsx(u,{}),title:"RF Noise Floor",largeTitle:!0,actions:M?t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 md:gap-3",children:[t.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["min ",t.jsx("span",{className:"text-text-secondary tabular-nums",children:M.min.toFixed(0)})]}),t.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["avg ",t.jsx("span",{className:"text-text-secondary tabular-nums",children:M.avg.toFixed(0)})]}),t.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["max ",t.jsx("span",{className:"text-text-secondary tabular-nums",children:M.max.toFixed(0)})]}),t.jsx("span",{className:"type-data-xs text-text-muted",children:"dBm"})]}):t.jsx("span",{className:"type-data-xs text-text-muted",children:"dBm"})}),t.jsx("div",{className:"flex-1 min-h-0",children:t.jsx(be,{timestamps:ae.timestamps,values:ae.values,height:160,onStatsChange:k})})]})})]})]})]})}export{He as default};
