import{r as e,j as s}from"./vendor-react-SfmO5UG4.js";import{M as t,S as a,L as i,a as n}from"./maplibre-gl-BQ3zr2TW.js";import{c as l}from"./vendor-core-D1p9zwXj.js";import{p as o,al as r,r as d,Y as c,_ as u,ab as h,h as m}from"./index-CF53FmhC.js";import{u as x,B as p}from"./BasemapLayer-D8l93iaQ.js";import{a3 as g,a1 as f,aj as v,a as b,o as j,j as y,at as N}from"./vendor-icons-QG3AVsi5.js";const w={version:8,sources:{},layers:[],glyphs:"https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf"};function H({node:t,isHovered:a,onHover:i}){const[n,o]=e.useState(!1),r=e.useCallback(e=>{var s,a;e.stopPropagation(),s=t.hash,(null==(a=navigator.clipboard)?void 0:a.writeText)&&navigator.clipboard.writeText(s).catch(()=>{}),o(!0),setTimeout(()=>o(!1),2e3)},[t.hash]),d=t.contactType.toLowerCase(),c=d.includes("room")||d.includes("server");let u=v,h="text-sys-blue";return c?(u=y,h="text-signal-fair"):"companion"===d||"client"===d?(u=N,h="text-fg-muted"):t.isNeighbor&&(h="text-sys-green"),s.jsxs("div",{className:l("flex items-center gap-3 px-3 py-2.5 radius-inner transition-base cursor-pointer",a?"bg-sys-blue/10":"hover:bg-subtle-fill"),onMouseEnter:()=>i(t.hash),onMouseLeave:()=>i(null),children:[s.jsx(u,{className:l("w-4 h-4 flex-shrink-0",h)}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsx("span",{className:"type-label text-fg-primary truncate",children:t.name}),t.isNeighbor&&s.jsx(m,{color:"green",compact:!0,children:"NBR"}),t.isRepeater&&s.jsx(m,{color:"zinc",compact:!0,children:"RPT"}),t.isHub&&s.jsx(m,{color:"indigo",compact:!0,children:"HUB"})]}),s.jsxs("button",{onClick:r,className:l("mt-1 inline-flex items-center gap-1 type-data-xs px-1.5 py-0.5 rounded","border transition-all cursor-pointer",n?"border-sys-green/50 bg-sys-green/10 text-sys-green":"border-edge-subtle bg-subtle/50 text-fg-muted hover:border-edge-strong"),title:`Copy: ${t.hash}`,children:[t.hash.slice(0,12),"…",n?s.jsx(b,{className:"w-2.5 h-2.5"}):s.jsx(j,{className:"w-2.5 h-2.5 opacity-50"})]})]})]})}function C({nodes:o,hoveredHash:r,onHover:d}){const c=x(),u=e.useRef(null),g=h(),[v,b]=e.useState(!1),j=e.useMemo(()=>o.filter(e=>null!=e.latitude&&null!=e.longitude&&(0!==e.latitude||0!==e.longitude)),[o]),y=e.useMemo(()=>{if(0===j.length)return null;let e=1/0,s=-1/0,t=1/0,a=-1/0;for(const i of j)e=Math.min(e,i.longitude),s=Math.max(s,i.longitude),t=Math.min(t,i.latitude),a=Math.max(a,i.latitude);if(a-t<.01){const e=(a+t)/2;t=e-.005,a=e+.005}if(s-e<.01){const t=(s+e)/2;e=t-.005,s=t+.005}return[[e,t],[s,a]]},[j]),N=e.useMemo(()=>y?{longitude:(y[0][0]+y[1][0])/2,latitude:(y[0][1]+y[1][1])/2}:{longitude:0,latitude:0},[y]),H=e.useMemo(()=>{if(j.length<2)return null;const e=[];for(let s=0;s<j.length;s++)for(let t=s+1;t<j.length;t++){const a=j[s],i=j[t];e.push({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[[a.longitude,a.latitude],[i.longitude,i.latitude]]}})}return{type:"FeatureCollection",features:e}},[j]),C=e.useCallback(()=>{var e;const s=null==(e=u.current)?void 0:e.getMap();s&&y?(s.fitBounds(y,{padding:{top:50,bottom:50,left:50,right:50},maxZoom:13,duration:0}),setTimeout(()=>b(!0),50)):b(!0)},[y]),M=g&&v;return 0===j.length?s.jsx("div",{className:"h-full flex items-center justify-center bg-subtle/30 radius-inner",children:s.jsxs("div",{className:"text-center text-fg-secondary p-4",children:[s.jsx(f,{className:"w-8 h-8 mx-auto mb-2 opacity-40"}),s.jsx("p",{className:"text-sm",children:"No location data available"})]})}):s.jsxs("div",{className:"h-full w-full relative radius-inner overflow-hidden bg-elevated",children:[s.jsx("div",{className:l("absolute inset-0 flex items-center justify-center z-10","transition-opacity duration-200 pointer-events-none",M?"opacity-0":"opacity-100 bg-elevated"),children:s.jsx("div",{className:"w-5 h-5 border-2 border-text-muted/30 border-t-text-muted rounded-full animate-spin"})}),s.jsx("div",{className:l("h-full w-full transition-opacity duration-200",M?"opacity-100":"opacity-0"),children:s.jsxs(t,{ref:u,initialViewState:{longitude:N.longitude,latitude:N.latitude,zoom:10},style:{height:"100%",width:"100%"},mapStyle:w,attributionControl:!1,onLoad:C,children:[s.jsx(p,{mode:c}),H&&s.jsx(a,{id:"collision-edges",type:"geojson",data:H,children:s.jsx(i,{id:"collision-edges-line",type:"line",paint:{"line-color":"#3B3F4A","line-width":2,"line-opacity":.8},layout:{"line-cap":"round","line-join":"round"}})}),j.map(e=>{const t=e.hash===r,a=e.hash.startsWith("0x")?e.hash.slice(2,4).toUpperCase():e.hash.slice(0,2).toUpperCase();return s.jsx(n,{longitude:e.longitude,latitude:e.latitude,anchor:"center",children:s.jsx("div",{className:"cursor-pointer transition-all duration-150",onMouseEnter:()=>d(e.hash),onMouseLeave:()=>d(null),style:{pointerEvents:"auto"},children:s.jsxs(m,{color:"amber",filled:!0,className:"type-data-xs shadow-lg",children:[a,t&&s.jsx("span",{className:"ml-1 opacity-75 font-sans",children:e.name})]})})},e.hash)})]})})]})}const M=e.memo(function({isOpen:t,prefix:a,candidateHashes:i,onClose:n}){const l=o(),h=r(),m=d(),[x,p]=e.useState(null),f=e.useMemo(()=>new Set(m.map(e=>e.hash)),[m]),v=(null==l?void 0:l.neighbors)??{},b=e.useMemo(()=>i.map(e=>{var s;const t=(e=>v[e]?v[e]:!e.startsWith("0x")&&v["0x"+e]?v["0x"+e]:e.startsWith("0x")&&v[e.slice(2)]?v[e.slice(2)]:void 0)(e);return{hash:e,name:(null==t?void 0:t.node_name)||(null==t?void 0:t.name)||`Unknown (${e.slice(0,8)}…)`,contactType:(null==t?void 0:t.contact_type)||"",isRepeater:(null==t?void 0:t.is_repeater)||"repeater"===(null==(s=null==t?void 0:t.contact_type)?void 0:s.toLowerCase())||!1,isNeighbor:f.has(e)||f.has("0x"+e)||f.has(e.replace(/^0x/,"")),isHub:h.has(e),latitude:null==t?void 0:t.latitude,longitude:null==t?void 0:t.longitude}}).sort((e,s)=>e.isNeighbor!==s.isNeighbor?e.isNeighbor?-1:1:e.isHub!==s.isHub?e.isHub?-1:1:e.name.localeCompare(s.name)),[i,v,f,h]),j=e.useMemo(()=>b.some(e=>null!=e.latitude&&null!=e.longitude&&(0!==e.latitude||0!==e.longitude)),[b]),y=e.useCallback(e=>{p(e)},[]),N=j?"4xl":"lg";return t?s.jsxs(c,{open:t,onClose:n,size:N,motionPlus:!0,className:j?"sm:h-[500px] sm:max-h-[600px]":"",children:[s.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-edge-subtle",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 radius-inner bg-signal-fair/10",children:s.jsx(g,{className:"w-5 h-5 text-signal-fair"})}),s.jsxs("div",{children:[s.jsxs("div",{className:"type-micro",children:["Prefix Collision: ",s.jsx("span",{className:"font-mono text-sys-blue",children:a})]}),s.jsxs("p",{className:"text-xs text-fg-secondary",children:[b.length," nodes share this prefix"]})]})]}),s.jsx("button",{onClick:n,className:"sm:hidden min-h-[44px] min-w-[44px] px-3 flex items-center justify-center text-[15px] font-medium text-sys-blue active:text-sys-blue/70 transition-base radius-inner active:bg-subtle-fill",children:"Done"}),s.jsx("button",{onClick:n,className:"hidden sm:flex items-center justify-center p-2 text-fg-muted hover:text-fg-primary transition-base radius-inner hover:bg-subtle","aria-label":"Close",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsxs(u,{className:"p-0 overflow-hidden flex-1 flex flex-col min-h-0",children:[s.jsxs("div",{className:"sm:hidden flex-1 overflow-y-auto",children:[j&&s.jsx("div",{className:"h-64 p-2 border-b border-edge-subtle",children:s.jsx(C,{nodes:b,hoveredHash:x,onHover:y})}),s.jsx("div",{className:"p-2",children:b.map(e=>s.jsx(H,{node:e,isHovered:x===e.hash,onHover:y},e.hash))})]}),j?s.jsxs("div",{className:"hidden sm:grid sm:grid-cols-[280px_minmax(400px,1fr)] flex-1 overflow-hidden sm:min-w-[700px]",children:[s.jsx("div",{className:"overflow-y-auto border-r border-edge-subtle",children:s.jsx("div",{className:"p-2",children:b.map(e=>s.jsx(H,{node:e,isHovered:x===e.hash,onHover:y},e.hash))})}),s.jsx("div",{className:"overflow-hidden p-2",children:s.jsx(C,{nodes:b,hoveredHash:x,onHover:y})})]}):s.jsx("div",{className:"hidden sm:block flex-1 overflow-y-auto",children:s.jsx("div",{className:"p-2",children:b.map(e=>s.jsx(H,{node:e,isHovered:x===e.hash,onHover:y},e.hash))})})]})]}):null});export{M as C};
