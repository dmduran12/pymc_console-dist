import{c as e,W as t,aj as n,R as s,aP as r,B as a}from"./index-CcQFyPml.js";import{r as o,j as l}from"./vendor-react-Co0R0q1H.js";import{c as i}from"./node-types-C6MDVMdW.js";import{F as d}from"./funnel-Bk-Aak9Q.js";import{M as c}from"./monitor-smartphone-1chHigbs.js";import{C as u}from"./circle-question-mark-DU0_1-lF.js";import{S as m}from"./search-CN9Le_dk.js";const h=e("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),p=e("droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);function b(){return{timeStart:null,timeEnd:null,deviceTypes:new Set,nodeIds:new Set,disabledNodeIds:new Set,nodeFilterMode:"source"}}function x(e,n,s,r){const a=function(e,n){const{timeStart:s,timeEnd:r,deviceTypes:a,nodeIds:o,disabledNodeIds:l,nodeFilterMode:i}=e,d=null!==s||null!==r,c=a.size>0;let u;if(l.size>0){u=new Set;for(const e of o)l.has(e)||u.add(e)}else u=o;const m=u.size>0;let h=null;if(m){h=new Set;for(const e of u)h.add(t(e))}return{hasTime:d,hasDevice:c,hasNode:m,tStart:s??n.start,tEnd:r??n.end,deviceTypes:a,effectiveNodeIds:u,nodeIdPrefixes:h,nodeFilterMode:i,needsDisambiguation:c||m}}(n,r);return a.hasTime||a.hasDevice||a.hasNode?e.filter(e=>function(e,n,s){if(n.hasTime&&(e.timestamp<n.tStart||e.timestamp>n.tEnd))return!1;if(n.needsDisambiguation){const r=s(e);if(n.hasDevice&&!n.deviceTypes.has(r.type))return!1;if(n.hasNode)if("observed"===n.nodeFilterMode){let s=!1;if(r.hash&&n.effectiveNodeIds.has(r.hash)&&(s=!0),!s&&e.dst_hash&&(n.effectiveNodeIds.has(e.dst_hash)||n.nodeIdPrefixes.has(t(e.dst_hash)))&&(s=!0),!s){const t=e.forwarded_path??e.original_path;if(t&&Array.isArray(t))for(const e of t){const t=String(e).toUpperCase();if(n.nodeIdPrefixes.has(t)){s=!0;break}}}if(!s)return!1}else if(!r.hash||!n.effectiveNodeIds.has(r.hash))return!1}return!0}(e,a,s)):e}function f(e,t){const n=new Date(1e3*e),s=e=>e.toString().padStart(2,"0"),r=`${s(n.getHours())}:${s(n.getMinutes())}`;return t<24?r:`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n.getMonth()]} ${n.getDate()} ${r}`}const v=[{type:"repeater",label:"Repeater",icon:s,buttonColor:"primary",iconColor:"text-sys-blue",hoverClass:"hover:border-sys-blue hover:text-sys-blue hover:!bg-transparent"},{type:"companion",label:"Companion",icon:c,buttonColor:"indigo",iconColor:"text-sys-indigo",hoverClass:"hover:border-sys-indigo hover:text-sys-indigo hover:!bg-transparent"},{type:"room_server",label:"Room",icon:r,buttonColor:"purple",iconColor:"text-sys-purple",hoverClass:"hover:border-sys-purple hover:text-sys-purple hover:!bg-transparent"},{type:"unknown",label:"Unknown",icon:u,buttonColor:"zinc",iconColor:"text-zinc-400",hoverClass:"hover:border-zinc-400 hover:text-zinc-400 hover:!bg-transparent"}],g=60,y=.005;function w({min:e,max:t,valueStart:n,valueEnd:s,onChange:r}){const a=o.useRef(null),[i,d]=o.useState(null),c=o.useRef({valueStart:n,valueEnd:s,min:e,max:t});c.current={valueStart:n,valueEnd:s,min:e,max:t};const u=o.useRef({offset:0,width:0}),m=t-e||1,h=m/3600,p=n??e,b=s??t,x=(p-e)/m*100,v=(b-e)/m*100,w=null!==n||null!==s,j=o.useCallback(e=>{const t=a.current.getBoundingClientRect(),n=Math.max(0,Math.min(1,(e-t.left)/t.width)),{min:s,max:r}=c.current;return Math.round(s+n*(r-s||1))},[]),N=o.useCallback((e,t)=>{t.preventDefault(),t.stopPropagation();const n=t.currentTarget;n.setPointerCapture(t.pointerId),d(e);const s=t=>{const n=j(t.clientX),{valueStart:s,valueEnd:a,min:o,max:l}=c.current,i=l-o||1;if("start"===e){const e=Math.min(n,(a??l)-g);r(e<=o+i*y?null:e,a)}else{const e=Math.max(n,(s??o)+g);r(s,e>=l-i*y?null:e)}},a=()=>{d(null),n.removeEventListener("pointermove",s),n.removeEventListener("pointerup",a),n.removeEventListener("pointercancel",a)};n.addEventListener("pointermove",s),n.addEventListener("pointerup",a),n.addEventListener("pointercancel",a)},[j,r]),C=o.useCallback(e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget;t.setPointerCapture(e.pointerId),d("range");const n=c.current.valueStart??c.current.min,s=c.current.valueEnd??c.current.max;u.current={offset:j(e.clientX)-n,width:s-n};const a=e=>{const t=j(e.clientX),{min:n,max:s}=c.current,{offset:a,width:o}=u.current;let l=t-a;l=Math.max(n,Math.min(s-o,l));const i=l+o;r(Math.round(l)<=n?null:Math.round(l),Math.round(i)>=s?null:Math.round(i))},o=()=>{d(null),t.removeEventListener("pointermove",a),t.removeEventListener("pointerup",o),t.removeEventListener("pointercancel",o)};t.addEventListener("pointermove",a),t.addEventListener("pointerup",o),t.addEventListener("pointercancel",o)},[j,r]),k=o.useCallback(e=>{const t=j(e.clientX),{valueStart:n,valueEnd:s,min:a,max:o}=c.current,l=o-a||1,i=n??a,d=s??o;if(Math.abs(t-i)<=Math.abs(t-d)){const e=Math.min(t,d-g);r(e<=a+l*y?null:e,s)}else{const e=Math.max(t,i+g);r(n,e>=o-l*y?null:e)}},[j,r]),S=o.useCallback(()=>r(null,null),[r]),M=o.useCallback((e,t)=>{const n="ArrowRight"===t.key||"ArrowUp"===t.key?1:"ArrowLeft"===t.key||"ArrowDown"===t.key?-1:0;if(!n)return;t.preventDefault();const s=(t.shiftKey?.1:.01)*m,{valueStart:a,valueEnd:o,min:l,max:i}=c.current,d=i-l||1;if("start"===e){const e=Math.max(l,Math.min((a??l)+n*s,(o??i)-g));r(e<=l+d*y?null:e,o)}else{const e=Math.min(i,Math.max((o??i)+n*s,(a??l)+g));r(a,e>=i-d*y?null:e)}},[m,r]),E=e=>{const t=i===e;return["absolute top-1/2 -translate-y-1/2 -translate-x-1/2 w-1 h-4 rounded-full","before:content-[''] before:absolute before:-inset-x-3 before:-inset-y-1","touch-none outline-none",t?"cursor-grabbing":"cursor-ew-resize",t?"bg-sys-blue shadow-[0_0_8px_var(--sys-blue)] scale-x-150 z-20":("start"===e?null!==n:null!==s)?"bg-sys-blue shadow-[0_0_4px_var(--sys-blue)] hover:shadow-[0_0_8px_var(--sys-blue)] hover:scale-x-150 z-10":"bg-edge-subtle hover:bg-fg-muted hover:scale-x-150 z-10",t?"":"transition-[transform,box-shadow,background-color] duration-150 ease-out","focus-visible:ring-2 focus-visible:ring-sys-blue/50"].filter(Boolean).join(" ")};return l.jsxs("div",{className:"flex flex-col gap-0.5 min-w-[160px] sm:min-w-[220px]",children:[l.jsxs("div",{className:"flex items-center justify-between type-data-xs text-fg-muted tabular-nums select-none",children:[l.jsx("span",{className:w&&null!==n?"text-sys-blue":"",children:f(p,h)}),l.jsx("span",{className:w&&null!==s?"text-sys-blue":"",children:f(b,h)})]}),l.jsxs("div",{ref:a,className:"relative h-5 select-none",onPointerDown:k,onDoubleClick:S,children:[l.jsx("div",{className:"absolute inset-x-0 top-1/2 -translate-y-1/2 h-1.5 rounded-full bg-white/[0.06] pointer-events-none"}),w?l.jsx("div",{className:["group/band absolute inset-y-0 touch-none","range"===i?"cursor-grabbing":"cursor-grab"].join(" "),style:{left:`${x}%`,right:100-v+"%"},onPointerDown:C,children:l.jsx("div",{className:["absolute inset-x-0 top-1/2 -translate-y-1/2 h-1.5 rounded-full pointer-events-none transition-colors","range"===i?"bg-sys-blue/40":"bg-sys-blue/25 group-hover/band:bg-sys-blue/35"].join(" ")})}):l.jsx("div",{className:"absolute inset-x-0 top-1/2 -translate-y-1/2 h-1.5 rounded-full bg-white/[0.04] pointer-events-none"}),l.jsx("div",{role:"slider",tabIndex:0,"aria-label":"Range start","aria-valuenow":p,className:E("start"),style:{left:`${x}%`},onPointerDown:e=>N("start",e),onKeyDown:e=>M("start",e)}),l.jsx("div",{role:"slider",tabIndex:0,"aria-label":"Range end","aria-valuenow":b,className:E("end"),style:{left:`${v}%`},onPointerDown:e=>N("end",e),onKeyDown:e=>M("end",e)})]})]})}function j({parentStartTs:e,parentEndTs:t,neighbors:s,filter:r,onChange:c,scatterDotSize:u,onScatterDotSizeChange:b,scatterOpacity:x,onScatterOpacityChange:f}){const[g,y]=o.useState(""),[j,C]=o.useState(!1),k=o.useRef(null);o.useEffect(()=>{function e(e){k.current&&!k.current.contains(e.target)&&C(!1)}if(j)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[j]);const S=o.useMemo(()=>Object.entries(s).map(([e,t])=>{const n=i(t);return{hash:e,name:t.name??t.node_name??e.slice(0,8),type:n.type,label:n.label}}).sort((e,t)=>e.name.localeCompare(t.name)),[s]),M=o.useMemo(()=>{if(!g)return S;const e=g.toLowerCase();return S.filter(t=>t.name.toLowerCase().includes(e)||t.hash.toLowerCase().includes(e))},[S,g]),E=null!==r.timeStart||null!==r.timeEnd||r.deviceTypes.size>0||r.nodeIds.size>0,I=o.useCallback((e,t)=>{c({...r,timeStart:e,timeEnd:t})},[r,c]),z=o.useCallback(e=>{const t=new Set(r.deviceTypes);t.has(e)?t.delete(e):t.add(e),c({...r,deviceTypes:t})},[r,c]),D=o.useCallback(e=>{const t=new Set(r.nodeIds);t.has(e)?t.delete(e):t.add(e),c({...r,nodeIds:t}),y("")},[r,c]),L=o.useCallback(e=>{const t=new Set(r.nodeIds);t.delete(e);const n=new Set(r.disabledNodeIds);n.delete(e),c({...r,nodeIds:t,disabledNodeIds:n})},[r,c]),T=o.useCallback(e=>{const t=new Set(r.disabledNodeIds);t.has(e)?t.delete(e):t.add(e),c({...r,disabledNodeIds:t})},[r,c]),F=o.useCallback(()=>{c({...r,nodeFilterMode:"source"===r.nodeFilterMode?"observed":"source"})},[r,c]),_=o.useCallback(()=>{c({timeStart:null,timeEnd:null,deviceTypes:new Set,nodeIds:new Set,disabledNodeIds:new Set,nodeFilterMode:"source"}),y("")},[c]),P=o.useMemo(()=>{const e=new Map;for(const t of r.nodeIds){const n=s[t];e.set(t,(null==n?void 0:n.name)??(null==n?void 0:n.node_name)??t.slice(0,8))}return e},[r.nodeIds,s]),R=!(!b||!f);return l.jsxs("div",{className:"flex flex-col gap-2 card-padding",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[R&&l.jsxs(l.Fragment,{children:[l.jsx(N,{icon:l.jsx(h,{className:"w-3 h-3"}),label:"Size",value:u??.8,onChange:b,min:.3,max:3,step:.1,format:e=>e.toFixed(1)}),l.jsx(N,{icon:l.jsx(p,{className:"w-3 h-3"}),label:"Opacity",value:x??50,onChange:f,min:5,max:100,step:5,format:e=>`${Math.round(e)}%`}),l.jsx("div",{className:"w-px h-4 bg-edge-subtle shrink-0 hidden sm:block"})]}),l.jsx("div",{className:"flex items-center gap-1.5 text-fg-muted shrink-0",children:l.jsx(d,{className:"w-3.5 h-3.5"})}),l.jsx("div",{className:"flex-1 min-w-[120px]",children:l.jsx(w,{min:e,max:t,valueStart:r.timeStart,valueEnd:r.timeEnd,onChange:I})}),E&&l.jsxs("button",{type:"button",onClick:_,className:"flex items-center gap-1 px-2 py-0.5 rounded-full type-data-xs text-fg-muted hover:text-fg-primary border border-edge-subtle hover:border-fg-muted/40 transition-colors shrink-0",title:"Clear all filters",children:[l.jsx(n,{className:"w-3 h-3"}),l.jsx("span",{className:"hidden sm:inline",children:"Clear"})]})]}),l.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[l.jsx("div",{className:"flex items-center gap-1.5 overflow-x-auto pb-0.5 -mb-0.5 shrink-0",children:v.map(({type:e,label:t,icon:n,buttonColor:s,iconColor:o,hoverClass:i})=>{const d=r.deviceTypes.has(e);return l.jsxs(a,{color:d?s:"zinc",outline:!d,className:`!h-8 !py-0 ${d?"":i}`,onClick:()=>z(e),title:`Filter by ${t}`,children:[l.jsx(n,{"data-slot":"icon",className:d?"":o}),l.jsx("span",{className:"hidden sm:inline "+(d?"":"text-fg-muted"),children:t})]},e)})}),l.jsx("div",{className:"w-px h-4 bg-edge-subtle shrink-0 hidden md:block"}),l.jsxs("div",{className:"relative flex items-center gap-1.5 flex-1 min-w-[120px] sm:min-w-[180px] h-8 px-2 rounded-md border border-edge-subtle bg-white/[0.03] transition-colors focus-within:border-sys-blue",ref:k,children:[l.jsx(m,{className:"w-3 h-3 text-fg-muted/50 shrink-0"}),l.jsx("input",{type:"text",className:"flex-1 min-w-[60px] type-data-xs py-0.5 bg-transparent text-fg-secondary placeholder:text-fg-muted/40 border-none focus:outline-none",placeholder:"Search nodes...",value:g,onChange:e=>{y(e.target.value),C(!0)},onFocus:()=>C(!0)}),j&&M.length>0&&l.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 z-[200] surface-popover border border-edge-subtle radius-inner max-h-48 overflow-y-auto",children:M.slice(0,20).map(e=>{const t=r.nodeIds.has(e.hash);return l.jsxs("button",{type:"button",onClick:()=>D(e.hash),className:`\n                      w-full flex items-center gap-2 px-2.5 py-1.5 type-data-xs text-left transition-colors\n                      ${t?"bg-sys-indigo/15 text-sys-indigo":"text-fg-secondary hover:bg-subtle-fill"}\n                    `,children:[l.jsx("span",{className:"flex-1 truncate",children:e.name}),l.jsx("span",{className:"text-fg-muted type-data-xs shrink-0",children:e.label})]},e.hash)})})]})]}),r.nodeIds.size>0&&l.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[Array.from(r.nodeIds).map(e=>{const t=r.disabledNodeIds.has(e);return l.jsxs("span",{role:"button",tabIndex:0,onClick:()=>T(e),onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),T(e))},className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full type-data-xs border transition-colors select-none "+(t?"bg-zinc-500/10 text-fg-muted border-edge-subtle cursor-pointer hover:bg-zinc-500/15":"bg-sys-indigo/15 text-sys-indigo border-sys-indigo/25 cursor-pointer hover:bg-sys-indigo/25"),title:e,children:[P.get(e)??e.slice(0,8),l.jsx("button",{type:"button",onClick:t=>{t.stopPropagation(),L(e)},className:"hover:text-fg-primary transition-colors -mr-0.5",title:"Remove from filter",children:l.jsx(n,{className:"w-3 h-3"})})]},e)}),l.jsx("button",{type:"button",onClick:F,className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full type-data-xs border transition-colors "+("observed"===r.nodeFilterMode?"bg-sys-blue/15 text-sys-blue border-sys-blue/25 hover:bg-sys-blue/25":"bg-white/[0.04] text-fg-muted border-edge-subtle hover:text-fg-secondary hover:border-fg-muted/40"),title:"source"===r.nodeFilterMode?"Source Only — showing packets sent by selected node(s)":"Total Observed — showing all packets where selected node(s) appear (source, path, or destination)",children:"source"===r.nodeFilterMode?"Source Only":"Total Observed"})]})]})}const N=o.memo(function({icon:e,label:t,value:n,onChange:s,min:r,max:a,step:o,format:i}){return l.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[l.jsxs("div",{className:"flex items-center gap-1.5 text-fg-muted shrink-0",children:[e,l.jsx("span",{className:"type-data-xs font-medium hidden sm:inline",children:t})]}),l.jsx("input",{type:"range",min:r,max:a,step:o,value:n,onChange:e=>s(parseFloat(e.target.value)),className:"flex-1 h-1 min-w-[60px] bg-subtle-fill rounded appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-2.5 [&::-webkit-slider-thumb]:h-2.5 [&::-webkit-slider-thumb]:bg-sys-blue [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer"}),l.jsx("span",{className:"type-data-xs text-fg-secondary tabular-nums shrink-0 w-8 text-right",children:i?i(n):n})]})});export{j as A,x as a,b as c};
