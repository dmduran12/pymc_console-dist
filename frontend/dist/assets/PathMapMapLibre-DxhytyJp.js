import{r as e,j as o,bt as t,bu as r,bv as n,bw as i,bx as s}from"./vendor-react-BXhrzaGn.js";import"./maplibre-gl-Bk5DsYkB.js";import{u as a,B as l}from"./BasemapLayer-Dsr6jiMV.js";import"./vendor-core-WoOfkQwm.js";import"./deckgl-DTsmDcfs.js";const d={version:8,sources:{},layers:[],glyphs:"https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf"},c={nodeColor:"#4338CA",localColor:"#4F46E5",hubColor:"#6366F1",edgeColor:"#3B3F4A",ambiguousColor:"#F9D26F",highlightColor:"#B49DFF",sourceColor:"#39D98A",destinationColor:"#B49DFF"};function u(){if("undefined"==typeof document)return c;const e=document.documentElement,o=getComputedStyle(e);return{nodeColor:o.getPropertyValue("--map-node-stroke").trim()||c.nodeColor,localColor:o.getPropertyValue("--map-local-color").trim()||c.localColor,hubColor:o.getPropertyValue("--map-hub-color").trim()||c.hubColor,edgeColor:o.getPropertyValue("--map-edge-rest").trim()||c.edgeColor,ambiguousColor:o.getPropertyValue("--accent-secondary").trim()||c.ambiguousColor,highlightColor:o.getPropertyValue("--accent-primary").trim()||c.highlightColor,sourceColor:o.getPropertyValue("--accent-success").trim()||c.sourceColor,destinationColor:o.getPropertyValue("--accent-primary").trim()||c.destinationColor}}function p(e,o,t,r=!1,n=!1,i=!1){const s=u(),a=r?`box-shadow: 0 0 0 3px ${s.highlightColor}40, 0 0 8px ${s.highlightColor}60;`:"";let l;l=n?s.sourceColor:i?s.destinationColor:e?s.localColor:o?s.hubColor:t?"transparent":s.ambiguousColor;const d=e||o||!t||n||i;return`<div style="\n    width: 14px;\n    height: 14px;\n    background: ${l};\n    border-radius: 50%;\n    border: ${d?0:5}px solid ${d?"transparent":s.nodeColor};\n    box-sizing: border-box;\n    transition: box-shadow 0.15s ease;\n    ${a}\n  "></div>`}function m({resolvedPath:c,localNode:m,hubNodes:h=[],hoveredHopIndex:g,onHoverHop:x}){const b=e.useRef(null),C=a(),f=e.useMemo(()=>new Set(h),[h]),[y,v]=e.useState(null),[j,k]=e.useState(0);e.useEffect(()=>{var e;const o=null==(e=b.current)?void 0:e.getMap();if(!o)return;const t=o.getCanvas();if(!t)return;const r=e=>{e.preventDefault()},n=()=>{k(e=>e+1)};return t.addEventListener("webglcontextlost",r),t.addEventListener("webglcontextrestored",n),()=>{t.removeEventListener("webglcontextlost",r),t.removeEventListener("webglcontextrestored",n)}},[j]);const{positions:N,markers:S,pathLineGeoJSON:L}=e.useMemo(()=>{const e=[],o=[],t=[];c.hops.forEach((r,n)=>{const i=r.candidates.filter(e=>{return o=e.latitude,t=e.longitude,0!==o||0!==t;var o,t});if(0===i.length)return;const s=[...i].sort((e,o)=>o.probability-e.probability)[0];t.push([s.longitude,s.latitude]);const a=!0===r.isSource,l=!0===r.isDestination;i.forEach((t,s)=>{const d=[t.latitude,t.longitude];e.push(d);const c=0===s;o.push({position:d,prefix:r.prefix,confidence:r.confidence,candidateCount:i.length,hopIndex:n,candidate:t,isHub:f.has(t.hash),isPrimary:c,isSource:a,isDestination:l})})});const r={type:"FeatureCollection",features:t.length>=2?[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:t}}]:[]};return{positions:e,markers:o,pathLineGeoJSON:r}},[c,f]),{initialBounds:P,center:F,zoom:w}=e.useMemo(()=>{if(0===N.length)return m?{initialBounds:null,center:[m.longitude,m.latitude],zoom:10}:{initialBounds:null,center:[0,0],zoom:2};let e=1/0,o=-1/0,t=1/0,r=-1/0;for(const[s,a]of N)s<e&&(e=s),s>o&&(o=s),a<t&&(t=a),a>r&&(r=a);const n=(e+o)/2,i=(t+r)/2;if(N.length>=2){const s=.15*(o-e)||.01,a=.15*(r-t)||.01;return{initialBounds:[[t-a,e-s],[r+a,o+s]],center:[i,n],zoom:10}}return{initialBounds:null,center:[i,n],zoom:12}},[N,m]),B=e.useCallback(e=>{v({longitude:e.position[1],latitude:e.position[0],marker:e})},[]);if(0===N.length)return o.jsx("div",{className:"h-[200px] flex items-center justify-center text-text-muted text-sm bg-bg-elevated",children:"No mappable path data"});const D=P?{bounds:P,fitBoundsOptions:{padding:30,maxZoom:16}}:{longitude:F[0],latitude:F[1],zoom:w};return o.jsxs(t,{ref:b,initialViewState:D,style:{height:"200px",width:"100%"},mapStyle:d,attributionControl:!1,children:[o.jsx(l,{mode:C}),L.features.length>0&&o.jsx(r,{id:"path-line-source",type:"geojson",data:L,children:o.jsx(n,{id:"path-line",type:"line",paint:{"line-color":u().edgeColor,"line-width":2,"line-opacity":.7},layout:{"line-cap":"round","line-join":"round"}})}),S.map(e=>{const t=g===e.hopIndex;return o.jsx(i,{longitude:e.position[1],latitude:e.position[0],anchor:"center",onClick:()=>B(e),children:o.jsx("div",{style:{cursor:"pointer",opacity:e.isPrimary?1:.5},onMouseEnter:()=>null==x?void 0:x(e.hopIndex),onMouseLeave:()=>null==x?void 0:x(null),dangerouslySetInnerHTML:{__html:p(e.candidate.isLocal||!1,e.isHub,e.isPrimary,t,e.isSource,e.isDestination)}})},`${e.hopIndex}-${e.candidate.hash}`)}),y&&o.jsx(s,{longitude:y.longitude,latitude:y.latitude,anchor:"bottom",offset:[0,-12],closeOnClick:!1,onClose:()=>v(null),className:"maplibre-popup",children:o.jsxs("div",{className:"text-xs",children:[o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("span",{className:"font-semibold",children:y.marker.candidate.name}),(()=>{const e=u();return o.jsxs(o.Fragment,{children:[y.marker.isSource&&o.jsx("span",{className:"px-1 py-0.5 text-[8px] font-bold rounded",style:{backgroundColor:e.sourceColor,color:"#000"},children:"SRC"}),y.marker.isDestination&&o.jsx("span",{className:"px-1 py-0.5 text-[8px] font-bold rounded",style:{backgroundColor:e.destinationColor,color:"#000"},children:"DST"}),y.marker.isHub&&o.jsx("span",{className:"px-1 py-0.5 text-[8px] font-bold rounded",style:{backgroundColor:e.hubColor,color:"#000"},children:"HUB"}),y.marker.candidate.isLocal&&o.jsx("span",{className:"px-1 py-0.5 text-[8px] font-bold rounded",style:{backgroundColor:e.localColor,color:"#fff"},children:"LOCAL"})]})})()]}),o.jsxs("div",{className:"text-text-muted font-mono text-[10px]",children:[y.marker.prefix," â€¢ ",y.marker.candidate.hash.slice(0,10),"..."]}),!y.marker.isPrimary&&y.marker.candidateCount>1&&o.jsxs("div",{style:{color:u().ambiguousColor},children:["Alternative (",(100*y.marker.candidate.probability).toFixed(0),"%)"]}),y.marker.isPrimary&&y.marker.candidateCount>1&&o.jsxs("div",{className:"text-text-muted",children:[y.marker.candidateCount," candidates"]})]})})]},j)}export{m as default};
