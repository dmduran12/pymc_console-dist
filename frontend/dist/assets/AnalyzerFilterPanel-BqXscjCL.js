import{c as e,N as t,ac as n,R as s,B as a}from"./index-Dao0ei72.js";import{r,j as o}from"./vendor-react-Co0R0q1H.js";import{c as l}from"./node-types-CkseP2Ea.js";import{M as i}from"./monitor-smartphone-Cbi0C4v2.js";import{M as d,C as c}from"./TimeRangeStepper-3MDYhKLT.js";import{S as u}from"./search-BXXTFvoI.js";const m=e("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),h=e("droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]),p=e("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);function b(){return{timeStart:null,timeEnd:null,deviceTypes:new Set,nodeIds:new Set,disabledNodeIds:new Set,nodeFilterMode:"source"}}function x(e,n,s,a){const r=function(e,n){const{timeStart:s,timeEnd:a,deviceTypes:r,nodeIds:o,disabledNodeIds:l,nodeFilterMode:i}=e,d=null!==s||null!==a,c=r.size>0;let u;if(l.size>0){u=new Set;for(const e of o)l.has(e)||u.add(e)}else u=o;const m=u.size>0;let h=null;if(m){h=new Set;for(const e of u)h.add(t(e))}return{hasTime:d,hasDevice:c,hasNode:m,tStart:s??n.start,tEnd:a??n.end,deviceTypes:r,effectiveNodeIds:u,nodeIdPrefixes:h,nodeFilterMode:i,needsDisambiguation:c||m}}(n,a);return r.hasTime||r.hasDevice||r.hasNode?e.filter(e=>function(e,n,s){if(n.hasTime&&(e.timestamp<n.tStart||e.timestamp>n.tEnd))return!1;if(n.needsDisambiguation){const a=s(e);if(n.hasDevice&&!n.deviceTypes.has(a.type))return!1;if(n.hasNode)if("observed"===n.nodeFilterMode){let s=!1;if(a.hash&&n.effectiveNodeIds.has(a.hash)&&(s=!0),!s&&e.dst_hash&&(n.effectiveNodeIds.has(e.dst_hash)||n.nodeIdPrefixes.has(t(e.dst_hash)))&&(s=!0),!s){const t=e.forwarded_path??e.original_path;if(t&&Array.isArray(t))for(const e of t){const t=String(e).toUpperCase();if(n.nodeIdPrefixes.has(t)){s=!0;break}}}if(!s)return!1}else if(!a.hash||!n.effectiveNodeIds.has(a.hash))return!1}return!0}(e,r,s)):e}function f(e,t){const n=new Date(1e3*e),s=e=>e.toString().padStart(2,"0"),a=`${s(n.getHours())}:${s(n.getMinutes())}`;return t<=24?a:`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n.getMonth()]} ${n.getDate()} ${a}`}const v=[{type:"repeater",label:"Repeater",icon:s,buttonColor:"primary",iconColor:"text-sys-blue",hoverClass:"hover:border-sys-blue hover:text-sys-blue hover:!bg-transparent"},{type:"companion",label:"Companion",icon:i,buttonColor:"indigo",iconColor:"text-sys-indigo",hoverClass:"hover:border-sys-indigo hover:text-sys-indigo hover:!bg-transparent"},{type:"room_server",label:"Room",icon:d,buttonColor:"purple",iconColor:"text-sys-purple",hoverClass:"hover:border-sys-purple hover:text-sys-purple hover:!bg-transparent"},{type:"unknown",label:"Unknown",icon:c,buttonColor:"zinc",iconColor:"text-zinc-400",hoverClass:"hover:border-zinc-400 hover:text-zinc-400 hover:!bg-transparent"}],g=60,y=.005;function w({min:e,max:t,valueStart:n,valueEnd:s,onChange:a}){const l=r.useRef(null),[i,d]=r.useState(null),c=r.useRef({valueStart:n,valueEnd:s,min:e,max:t});c.current={valueStart:n,valueEnd:s,min:e,max:t};const u=r.useRef({offset:0,width:0}),m=t-e||1,h=m/3600,p=n??e,b=s??t,x=(p-e)/m*100,v=(b-e)/m*100,w=null!==n||null!==s,N=r.useCallback(e=>{const t=l.current.getBoundingClientRect(),n=Math.max(0,Math.min(1,(e-t.left)/t.width)),{min:s,max:a}=c.current;return Math.round(s+n*(a-s||1))},[]),j=r.useCallback((e,t)=>{t.preventDefault(),t.stopPropagation();const n=t.currentTarget;n.setPointerCapture(t.pointerId),d(e);const s=t=>{const n=N(t.clientX),{valueStart:s,valueEnd:r,min:o,max:l}=c.current,i=l-o||1;if("start"===e){const e=Math.min(n,(r??l)-g);a(e<=o+i*y?null:e,r)}else{const e=Math.max(n,(s??o)+g);a(s,e>=l-i*y?null:e)}},r=()=>{d(null),n.removeEventListener("pointermove",s),n.removeEventListener("pointerup",r),n.removeEventListener("pointercancel",r)};n.addEventListener("pointermove",s),n.addEventListener("pointerup",r),n.addEventListener("pointercancel",r)},[N,a]),C=r.useCallback(e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget;t.setPointerCapture(e.pointerId),d("range");const n=c.current.valueStart??c.current.min,s=c.current.valueEnd??c.current.max;u.current={offset:N(e.clientX)-n,width:s-n};const r=e=>{const t=N(e.clientX),{min:n,max:s}=c.current,{offset:r,width:o}=u.current;let l=t-r;l=Math.max(n,Math.min(s-o,l));const i=l+o;a(Math.round(l)<=n?null:Math.round(l),Math.round(i)>=s?null:Math.round(i))},o=()=>{d(null),t.removeEventListener("pointermove",r),t.removeEventListener("pointerup",o),t.removeEventListener("pointercancel",o)};t.addEventListener("pointermove",r),t.addEventListener("pointerup",o),t.addEventListener("pointercancel",o)},[N,a]),k=r.useCallback(e=>{const t=N(e.clientX),{valueStart:n,valueEnd:s,min:r,max:o}=c.current,l=o-r||1,i=n??r,d=s??o;if(Math.abs(t-i)<=Math.abs(t-d)){const e=Math.min(t,d-g);a(e<=r+l*y?null:e,s)}else{const e=Math.max(t,i+g);a(n,e>=o-l*y?null:e)}},[N,a]),S=r.useCallback(()=>a(null,null),[a]),M=r.useCallback((e,t)=>{const n="ArrowRight"===t.key||"ArrowUp"===t.key?1:"ArrowLeft"===t.key||"ArrowDown"===t.key?-1:0;if(!n)return;t.preventDefault();const s=(t.shiftKey?.1:.01)*m,{valueStart:r,valueEnd:o,min:l,max:i}=c.current,d=i-l||1;if("start"===e){const e=Math.max(l,Math.min((r??l)+n*s,(o??i)-g));a(e<=l+d*y?null:e,o)}else{const e=Math.min(i,Math.max((o??i)+n*s,(r??l)+g));a(r,e>=i-d*y?null:e)}},[m,a]),E=e=>{const t=i===e;return["absolute top-1/2 -translate-y-1/2 -translate-x-1/2 w-1 h-4 rounded-full","before:content-[''] before:absolute before:-inset-x-3 before:-inset-y-1","touch-none outline-none",t?"cursor-grabbing":"cursor-ew-resize",t?"bg-sys-blue shadow-[0_0_8px_var(--sys-blue)] scale-x-150 z-20":("start"===e?null!==n:null!==s)?"bg-sys-blue shadow-[0_0_4px_var(--sys-blue)] hover:shadow-[0_0_8px_var(--sys-blue)] hover:scale-x-150 z-10":"bg-edge-subtle hover:bg-fg-muted hover:scale-x-150 z-10",t?"":"transition-[transform,box-shadow,background-color] duration-150 ease-out","focus-visible:ring-2 focus-visible:ring-sys-blue/50"].filter(Boolean).join(" ")};return o.jsxs("div",{className:"flex flex-col gap-0.5 min-w-[160px] sm:min-w-[220px]",children:[o.jsxs("div",{className:"flex items-center justify-between type-data-xs text-fg-muted tabular-nums select-none",children:[o.jsx("span",{className:w&&null!==n?"text-sys-blue":"",children:f(p,h)}),o.jsx("span",{className:w&&null!==s?"text-sys-blue":"",children:f(b,h)})]}),o.jsxs("div",{ref:l,className:"relative h-5 select-none",onPointerDown:k,onDoubleClick:S,children:[o.jsx("div",{className:"absolute inset-x-0 top-1/2 -translate-y-1/2 h-1.5 rounded-full bg-white/[0.06] pointer-events-none"}),w?o.jsx("div",{className:["group/band absolute inset-y-0 touch-none","range"===i?"cursor-grabbing":"cursor-grab"].join(" "),style:{left:`${x}%`,right:100-v+"%"},onPointerDown:C,children:o.jsx("div",{className:["absolute inset-x-0 top-1/2 -translate-y-1/2 h-1.5 rounded-full pointer-events-none transition-colors","range"===i?"bg-sys-blue/40":"bg-sys-blue/25 group-hover/band:bg-sys-blue/35"].join(" ")})}):o.jsx("div",{className:"absolute inset-x-0 top-1/2 -translate-y-1/2 h-1.5 rounded-full bg-white/[0.04] pointer-events-none"}),o.jsx("div",{role:"slider",tabIndex:0,"aria-label":"Range start","aria-valuenow":p,className:E("start"),style:{left:`${x}%`},onPointerDown:e=>j("start",e),onKeyDown:e=>M("start",e)}),o.jsx("div",{role:"slider",tabIndex:0,"aria-label":"Range end","aria-valuenow":b,className:E("end"),style:{left:`${v}%`},onPointerDown:e=>j("end",e),onKeyDown:e=>M("end",e)})]})]})}function N({parentStartTs:e,parentEndTs:t,neighbors:s,filter:i,onChange:d,scatterDotSize:c,onScatterDotSizeChange:b,scatterOpacity:x,onScatterOpacityChange:f}){const[g,y]=r.useState(""),[N,C]=r.useState(!1),k=r.useRef(null);r.useEffect(()=>{function e(e){k.current&&!k.current.contains(e.target)&&C(!1)}if(N)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[N]);const S=r.useMemo(()=>Object.entries(s).map(([e,t])=>{const n=l(t);return{hash:e,name:t.name??t.node_name??e.slice(0,8),type:n.type,label:n.label}}).sort((e,t)=>e.name.localeCompare(t.name)),[s]),M=r.useMemo(()=>{if(!g)return S;const e=g.toLowerCase();return S.filter(t=>t.name.toLowerCase().includes(e)||t.hash.toLowerCase().includes(e))},[S,g]),E=null!==i.timeStart||null!==i.timeEnd||i.deviceTypes.size>0||i.nodeIds.size>0,I=r.useCallback((e,t)=>{d({...i,timeStart:e,timeEnd:t})},[i,d]),z=r.useCallback(e=>{const t=new Set(i.deviceTypes);t.has(e)?t.delete(e):t.add(e),d({...i,deviceTypes:t})},[i,d]),D=r.useCallback(e=>{const t=new Set(i.nodeIds);t.has(e)?t.delete(e):t.add(e),d({...i,nodeIds:t}),y("")},[i,d]),L=r.useCallback(e=>{const t=new Set(i.nodeIds);t.delete(e);const n=new Set(i.disabledNodeIds);n.delete(e),d({...i,nodeIds:t,disabledNodeIds:n})},[i,d]),T=r.useCallback(e=>{const t=new Set(i.disabledNodeIds);t.has(e)?t.delete(e):t.add(e),d({...i,disabledNodeIds:t})},[i,d]),F=r.useCallback(()=>{d({...i,nodeFilterMode:"source"===i.nodeFilterMode?"observed":"source"})},[i,d]),_=r.useCallback(()=>{d({timeStart:null,timeEnd:null,deviceTypes:new Set,nodeIds:new Set,disabledNodeIds:new Set,nodeFilterMode:"source"}),y("")},[d]),A=r.useMemo(()=>{const e=new Map;for(const t of i.nodeIds){const n=s[t];e.set(t,(null==n?void 0:n.name)??(null==n?void 0:n.node_name)??t.slice(0,8))}return e},[i.nodeIds,s]),R=!(!b||!f);return o.jsxs("div",{className:"flex flex-col gap-2 card-padding",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[R&&o.jsxs(o.Fragment,{children:[o.jsx(j,{icon:o.jsx(m,{className:"w-3 h-3"}),label:"Size",value:c??.8,onChange:b,min:.3,max:3,step:.1,format:e=>e.toFixed(1)}),o.jsx(j,{icon:o.jsx(h,{className:"w-3 h-3"}),label:"Opacity",value:x??50,onChange:f,min:5,max:100,step:5,format:e=>`${Math.round(e)}%`}),o.jsx("div",{className:"w-px h-4 bg-edge-subtle shrink-0 hidden sm:block"})]}),o.jsx("div",{className:"flex items-center gap-1.5 text-fg-muted shrink-0",children:o.jsx(p,{className:"w-3.5 h-3.5"})}),o.jsx("div",{className:"flex-1 min-w-[120px]",children:o.jsx(w,{min:e,max:t,valueStart:i.timeStart,valueEnd:i.timeEnd,onChange:I})}),E&&o.jsxs("button",{type:"button",onClick:_,className:"flex items-center gap-1 px-2 py-0.5 rounded-full type-data-xs text-fg-muted hover:text-fg-primary border border-edge-subtle hover:border-fg-muted/40 transition-colors shrink-0",title:"Clear all filters",children:[o.jsx(n,{className:"w-3 h-3"}),o.jsx("span",{className:"hidden sm:inline",children:"Clear"})]})]}),o.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[o.jsx("div",{className:"flex items-center gap-1.5 overflow-x-auto pb-0.5 -mb-0.5 shrink-0",children:v.map(({type:e,label:t,icon:n,buttonColor:s,iconColor:r,hoverClass:l})=>{const d=i.deviceTypes.has(e);return o.jsxs(a,{color:d?s:"zinc",outline:!d,className:`!h-8 !py-0 ${d?"":l}`,onClick:()=>z(e),title:`Filter by ${t}`,children:[o.jsx(n,{"data-slot":"icon",className:d?"":r}),o.jsx("span",{className:"hidden sm:inline "+(d?"":"text-fg-muted"),children:t})]},e)})}),o.jsx("div",{className:"w-px h-4 bg-edge-subtle shrink-0 hidden md:block"}),o.jsxs("div",{className:"relative flex items-center gap-1.5 flex-1 min-w-[120px] sm:min-w-[180px] h-8 px-2 rounded-md border border-edge-subtle bg-white/[0.03] transition-colors focus-within:border-sys-blue",ref:k,children:[o.jsx(u,{className:"w-3 h-3 text-fg-muted/50 shrink-0"}),o.jsx("input",{type:"text",className:"flex-1 min-w-[60px] type-data-xs py-0.5 bg-transparent text-fg-secondary placeholder:text-fg-muted/40 border-none focus:outline-none",placeholder:"Search nodes...",value:g,onChange:e=>{y(e.target.value),C(!0)},onFocus:()=>C(!0)}),N&&M.length>0&&o.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 z-[200] surface-popover border border-edge-subtle radius-inner max-h-48 overflow-y-auto",children:M.slice(0,20).map(e=>{const t=i.nodeIds.has(e.hash);return o.jsxs("button",{type:"button",onClick:()=>D(e.hash),className:`\n                      w-full flex items-center gap-2 px-2.5 py-1.5 type-data-xs text-left transition-colors\n                      ${t?"bg-sys-indigo/15 text-sys-indigo":"text-fg-secondary hover:bg-subtle-fill"}\n                    `,children:[o.jsx("span",{className:"flex-1 truncate",children:e.name}),o.jsx("span",{className:"text-fg-muted type-data-xs shrink-0",children:e.label})]},e.hash)})})]})]}),i.nodeIds.size>0&&o.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[Array.from(i.nodeIds).map(e=>{const t=i.disabledNodeIds.has(e);return o.jsxs("span",{role:"button",tabIndex:0,onClick:()=>T(e),onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),T(e))},className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full type-data-xs border transition-colors select-none "+(t?"bg-zinc-500/10 text-fg-muted border-edge-subtle cursor-pointer hover:bg-zinc-500/15":"bg-sys-indigo/15 text-sys-indigo border-sys-indigo/25 cursor-pointer hover:bg-sys-indigo/25"),title:e,children:[A.get(e)??e.slice(0,8),o.jsx("button",{type:"button",onClick:t=>{t.stopPropagation(),L(e)},className:"hover:text-fg-primary transition-colors -mr-0.5",title:"Remove from filter",children:o.jsx(n,{className:"w-3 h-3"})})]},e)}),o.jsx("button",{type:"button",onClick:F,className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full type-data-xs border transition-colors "+("observed"===i.nodeFilterMode?"bg-sys-blue/15 text-sys-blue border-sys-blue/25 hover:bg-sys-blue/25":"bg-white/[0.04] text-fg-muted border-edge-subtle hover:text-fg-secondary hover:border-fg-muted/40"),title:"source"===i.nodeFilterMode?"Source Only — showing packets sent by selected node(s)":"Total Observed — showing all packets where selected node(s) appear (source, path, or destination)",children:"source"===i.nodeFilterMode?"Source Only":"Total Observed"})]})]})}const j=r.memo(function({icon:e,label:t,value:n,onChange:s,min:a,max:r,step:l,format:i}){return o.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[o.jsxs("div",{className:"flex items-center gap-1.5 text-fg-muted shrink-0",children:[e,o.jsx("span",{className:"type-data-xs font-medium hidden sm:inline",children:t})]}),o.jsx("input",{type:"range",min:a,max:r,step:l,value:n,onChange:e=>s(parseFloat(e.target.value)),className:"flex-1 h-1 min-w-[60px] bg-subtle-fill rounded appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-2.5 [&::-webkit-slider-thumb]:h-2.5 [&::-webkit-slider-thumb]:bg-sys-blue [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer"}),o.jsx("span",{className:"type-data-xs text-fg-secondary tabular-nums shrink-0 w-8 text-right",children:i?i(n):n})]})});export{N as A,p as F,x as a,b as c};
