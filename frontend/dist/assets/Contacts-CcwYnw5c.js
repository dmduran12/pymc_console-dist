const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ContactsMapMapLibre-7MZRUDIi.js","assets/index-BwGHI0A_.js","assets/BasemapLayer-Bm_seLWQ.js","assets/consumer-registry-DPYvsBcc.js","assets/link-scoring-BSZA-fkH.js","assets/ConfirmModal-B0nTD1Q0.js","assets/triangle-alert-B4kC1YDk.js","assets/DeepAnalysisModal-CaP_TRSd.js","assets/download-BbqYTv8j.js","assets/database-CDN_R6oC.js","assets/useMapViewStore-CPURakCb.js","assets/index-OH01SZkk.js","assets/refresh-cw-DYpAqCT4.js","assets/target-LdPtzGwl.js","assets/funnel-D4Wxq-Fx.js","assets/plus-C0xom_iW.js","assets/easing-DSebI9nw.js","assets/wifi-BaASFkdf.js","assets/SignalIndicator-LNOR_5YF.js","assets/chevron-right-DqpRZiGf.js","assets/node-types-DmTOZWT4.js","assets/badge-colors-BNUqIXCA.js","assets/LightSparkline-5OIe9Q0M.js","assets/map-pin-VRY_TOuh.js","assets/usePipelineStore-11oXtutw.js","assets/ping-DW5e4gor.js","assets/PageLayout-BIcqC04y.js","assets/listbox-_tsR-2yL.js","assets/element-movement-BqZOD4DT.js","assets/TimeRangeStepper-Dh4JEQ42.js","assets/chat-utils-Di4-nywi.js","assets/CollisionExplorerModal-Cm5c7tcU.js","assets/monitor-smartphone-BxljwdQV.js","assets/DataBox-CQS-Zhu0.js","assets/circle-question-mark-DC7QfrVK.js","assets/network-9doWJxcL.js","assets/activity-Dr_TPIps.js","assets/search-B7iMjmGm.js","assets/index-DUfCykEc.css","assets/BasemapLayer-B1CfjdFi.css","assets/ContactsMapMapLibre-BwWOEply.css"])))=>i.map(i=>d[i]);
import{d as L,j as e,r as n,bo as ss,bL as Ee,bM as Fe,$ as ne,w as Ce,a9 as Le,bN as ts,bO as fe,R as he,q as k,bP as as,L as Oe,bQ as ns,J as rs,bR as os,bS as is,bT as cs,H as ls,bU as ds,bV as ms,bW as xs,K as us,aa as ps,N as ve,bX as hs,bY as fs,b8 as ae,o as gs,I as js,bc as bs,c as ke}from"./index-BwGHI0A_.js";import{useDiscoveredNodes as ys}from"./usePipelineStore-11oXtutw.js";import{p as Ns}from"./ping-DW5e4gor.js";import{c as Me}from"./node-types-DmTOZWT4.js";import{P as vs,a as ws,B as ks}from"./PageLayout-BIcqC04y.js";import{L as Cs,a as pe}from"./listbox-_tsR-2yL.js";import{T as Te}from"./TimeRangeStepper-Dh4JEQ42.js";import{u as Ms,e as Ss,f as _s,r as Ps}from"./consumer-registry-DPYvsBcc.js";import{e as Rs,g as Ls,a as Ts}from"./chat-utils-Di4-nywi.js";import{A as $s,b as Es,C as Fs}from"./SignalIndicator-LNOR_5YF.js";import{C as Os,S as zs}from"./CollisionExplorerModal-Cm5c7tcU.js";import{E as Hs,T as Ds}from"./target-LdPtzGwl.js";import{D as As}from"./DataBox-CQS-Zhu0.js";import{C as G}from"./badge-colors-BNUqIXCA.js";import{C as ze}from"./circle-question-mark-DC7QfrVK.js";import{N as Is}from"./network-9doWJxcL.js";import{A as He}from"./activity-Dr_TPIps.js";import{T as Bs,C as Vs}from"./ConfirmModal-B0nTD1Q0.js";import{M as $e}from"./monitor-smartphone-BxljwdQV.js";import{M as Us}from"./map-pin-VRY_TOuh.js";import{S as qs}from"./search-B7iMjmGm.js";/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]],Gs=L("arrow-down-left",Ws);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],Ks=L("arrow-up-down",Qs);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Xs=L("calendar",Ys);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=[["path",{d:"M4 12V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2",key:"jrl274"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 16h2v6",key:"1bxocy"}],["path",{d:"M10 22h4",key:"ceow96"}],["rect",{x:"2",y:"16",width:"4",height:"6",rx:"2",key:"r45zd0"}]],Zs=L("file-digit",Js);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=[["path",{d:"M2 5h20",key:"1fs1ex"}],["path",{d:"M6 12h12",key:"8npq4p"}],["path",{d:"M9 19h6",key:"456am0"}]],st=L("list-filter",et);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=[["path",{d:"M12.75 7.09a3 3 0 0 1 2.16 2.16",key:"1d4wjd"}],["path",{d:"M17.072 17.072c-1.634 2.17-3.527 3.912-4.471 4.727a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 1.432-4.568",key:"12yil7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.475 2.818A8 8 0 0 1 20 10c0 1.183-.31 2.377-.81 3.533",key:"lhrkcz"}],["path",{d:"M9.13 9.13a3 3 0 0 0 3.74 3.74",key:"13wojd"}]],at=L("map-pin-off",tt);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],rt=L("move",nt);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=[["path",{d:"M4.9 16.1C1 12.2 1 5.8 4.9 1.9",key:"s0qx1y"}],["path",{d:"M7.8 4.7a6.14 6.14 0 0 0-.8 7.5",key:"1idnkw"}],["circle",{cx:"12",cy:"9",r:"2",key:"1092wv"}],["path",{d:"M16.2 4.8c2 2 2.26 5.11.8 7.47",key:"ojru2q"}],["path",{d:"M19.1 1.9a9.96 9.96 0 0 1 0 14.1",key:"rhi7fg"}],["path",{d:"M9.5 18h5",key:"mfy3pd"}],["path",{d:"m8 22 4-11 4 11",key:"25yftu"}]],it=L("radio-tower",ot);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]],De=L("ruler",ct);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],dt=L("trending-down",lt);class mt extends n.Component{constructor(i){super(i),this.state={hasError:!1}}static getDerivedStateFromError(i){return{hasError:!0,error:i}}render(){var i;return this.state.hasError?e.jsx("div",{className:"map-container-16-9 flex items-center justify-center rounded-2xl surface-base",role:"alert","aria-live":"assertive",children:e.jsxs("div",{className:"text-center text-fg-muted p-4",children:[e.jsx("p",{className:"text-lg mb-2",children:"Map failed to load"}),e.jsx("p",{className:"text-sm text-fg-muted",children:((i=this.state.error)==null?void 0:i.message)||"Unknown error"}),e.jsx("p",{className:"text-xs text-fg-muted mt-2",children:"Try refreshing the page or check your browser's WebGL support."})]})}):this.props.children}}const xt=n.lazy(()=>ss(()=>import("./ContactsMapMapLibre-7MZRUDIi.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40])));function ut({neighbors:o,localNode:i,localHash:f,onRemoveNode:x,selectedNodeHash:g,onNodeSelected:y,highlightedEdgeKey:h,highlightedGhost:d}){return e.jsx(mt,{children:e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"map-container-16-9 flex items-center justify-center rounded-2xl surface-base",role:"status","aria-live":"polite","aria-label":"Loading map",children:e.jsxs("div",{className:"text-fg-muted flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-sys-blue border-t-transparent rounded-full animate-spin","aria-hidden":"true"}),e.jsx("span",{children:"Loading map..."})]})}),children:e.jsx(xt,{neighbors:o,localNode:i,localHash:f,onRemoveNode:x,selectedNodeHash:g,onNodeSelected:y,highlightedEdgeKey:h,highlightedGhost:d})})})}function pt({hash:o,className:i="",size:f="sm",collisionInfo:x,isViterbiResolved:g}){const y=Ee(),h=Fe(),[d,H]=n.useState(!1),C=n.useMemo(()=>ne(o),[o]),T=n.useMemo(()=>x!==void 0?x:C?y.find(u=>u.prefix===C)??null:null,[C,y,x]),$=g??(h.totalPaths>0&&h.avgPathConfidence>=.7),z=n.useCallback(u=>{u.preventDefault(),u.stopPropagation(),H(!0)},[]),D=n.useCallback(()=>{H(!1)},[]);if(!T)return null;const N=f==="sm"?"w-3.5 h-3.5":"w-4 h-4",A=$?"text-sys-cyan hover:text-sys-cyan hover:bg-sys-cyan/10 focus:ring-sys-cyan/50":"text-signal-fair hover:text-sys-indigo hover:bg-signal-fair/10 focus:ring-signal-fair/50",Q=$?`Prefix conflict resolved by Viterbi HMM (${(h.avgPathConfidence*100).toFixed(0)}% confidence)`:`Prefix conflict: ${T.candidateCount} nodes share prefix "${C}"`;return e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:z,className:`inline-flex items-center justify-center p-0.5 rounded focus:outline-none focus:ring-2 transition-colors cursor-pointer touch-manipulation ${A} ${i}`,title:Q,"aria-label":`View prefix conflict for ${C}${$?" (Viterbi resolved)":""}`,children:$?e.jsxs("span",{className:"relative",children:[e.jsx(Hs,{className:N}),e.jsx(Ce,{className:"absolute -bottom-0.5 -right-0.5 w-2 h-2 text-sys-green"})]}):e.jsx(Zs,{className:N})}),e.jsx(Os,{isOpen:d,prefix:T.prefix,candidateHashes:T.candidateHashes,onClose:D})]})}const ht=n.memo(pt),Ae=[{target:"Contacts",fn:"name",minStage:1,when:Ss},{target:"Contacts",fn:"traceLinks.directed",minStage:2,when:_s}];Ps(Ae);function ft(o){return o<1e3?`${Math.round(o)}m`:`${(o/1e3).toFixed(1)}km`}function gt({hash:o,contact:i,isHub:f,isNeighbor:x,distance:g,centrality:y,sparklineData:h,neighborSignal:d,collisionInfo:H,isViterbiResolved:C,isPinging:T,isPingingThis:$,pingResult:z,pingError:D,gatewayInfo:N,lastForwarderPrefix:A,isMobile:Q,pathStability:u,onRowClick:K,onPing:E,onRemove:ge}){Ms(Ae);const I=i.latitude&&i.longitude&&i.latitude!==0&&i.longitude!==0,F=i.node_name||i.name||"Unknown",v=x&&d,re=Me(i),{isRepeater:_,isCompanion:Y,isRoomServer:j,isClient:X,label:J}=re,oe=x?`${J} — Direct RF contact (zero-hop neighbor)`:`${J} — Flood routing (multi-hop via mesh)`,Z=i.first_seen?Le(i.first_seen).replace(/ ago$/i," old"):null;return e.jsxs("div",{className:`contacts-grid-row ${f?"bg-sys-amber/5 border-l-2 border-l-sys-amber":""} ${I?"cursor-pointer hover:bg-subtle-fill":""}`,onClick:()=>K(o),children:[e.jsxs("div",{className:"contacts-col-node flex items-center gap-2 min-w-0",children:[v&&(d==null?void 0:d.avgSnr)!==null?e.jsx("div",{className:`w-2 h-2 rounded-full flex-shrink-0 self-center ${ts(d.avgSnr)}`}):e.jsx("div",{className:"w-2 flex-shrink-0"}),e.jsx("div",{className:"w-6 h-6 flex items-center justify-center flex-shrink-0",title:oe,children:(()=>{if(j&&_)return e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx(fe,{className:"w-5 h-5 absolute inset-0 text-sys-pink"}),e.jsx(zs,{className:"w-2.5 h-2.5 absolute -bottom-0.5 -right-0.5 text-sys-teal"})]});if(j)return e.jsx(fe,{className:"w-5 h-5 text-sys-pink"});if(_)return e.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center ring-[1.5px] ring-sys-blue",children:e.jsx(he,{className:"w-3.5 h-3.5 text-sys-blue"})});if((Y||X)&&F!=="Unknown"){const{emoji:w,cleanName:P}=Rs(F);return e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center",style:{backgroundColor:Ls(P)},children:w?e.jsx("span",{className:"text-sm leading-none",children:w}):e.jsx("span",{className:"text-white text-[9px] font-bold tracking-tighter",children:Ts(F)})})}return e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center bg-zinc-500/20",children:e.jsx(ze,{className:"w-3.5 h-3.5 text-sys-amber"})})})()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 overflow-hidden",children:[e.jsx("span",{className:"roster-title truncate",title:F,children:F}),x&&e.jsx(k,{color:G.neighbor,compact:!0,className:"flex-shrink-0",children:"NBR"}),f&&e.jsxs(k,{color:G.hub,compact:!0,className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx(Is,{className:"w-3 h-3"}),"HUB"]}),_&&e.jsx(k,{color:G.repeater,compact:!0,className:"flex-shrink-0",children:"RPT"}),j&&e.jsx(k,{color:G.room,compact:!0,className:"flex-shrink-0",children:"ROOM"}),Y&&e.jsx(k,{color:G.companion,compact:!0,className:"flex-shrink-0",children:"COMP"}),X&&e.jsx(k,{color:G.client,compact:!0,className:"flex-shrink-0",children:"CLIENT"}),Q&&e.jsxs(k,{color:"cyan",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0",children:[e.jsx(rt,{className:"w-2.5 h-2.5"}),"MOBILE"]}),!I&&e.jsx("span",{className:"flex items-center gap-0.5 flex-shrink-0 text-fg-muted/50",title:"No GPS location provided",children:e.jsx(at,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[e.jsx(As,{copy:!0,size:"compact",truncate:[8,6],children:o}),e.jsx(ht,{hash:o,collisionInfo:H,isViterbiResolved:C}),!x&&N&&e.jsxs(k,{color:"zinc",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0",title:`Via ${N.name||N.prefix} (${N.hopCount} hop${N.hopCount!==1?"s":""})`,children:[e.jsx($s,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"font-mono",children:N.prefix}),N.hopCount>1&&e.jsxs("span",{className:"opacity-60",children:["+",N.hopCount-1]})]}),A&&!x&&e.jsxs(k,{color:"zinc",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0",title:`Last forwarded by ${A}`,children:[e.jsx(Gs,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"font-mono",children:A})]}),u!=null&&u!==0&&e.jsx(k,{color:u>0?"green":"amber",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0",title:u>0?"Path stability improving":"Path stability declining",children:u>0?e.jsx(as,{className:"w-2.5 h-2.5"}):e.jsx(dt,{className:"w-2.5 h-2.5"})}),h.length>0&&(()=>{const w=h.reduce((ie,je)=>ie+je.count,0);if(w===0)return null;const P=w/24;return e.jsxs(k,{color:"zinc",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0",title:`${w} packets in last 24h (~${P.toFixed(1)}/hr)`,children:[e.jsx(it,{className:"w-2.5 h-2.5"}),e.jsxs("span",{children:[P<1?"<1":P.toFixed(0),"/hr"]})]})})(),Z&&e.jsxs(k,{color:"zinc",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0 opacity-70",title:`First discovered ${Z}`,children:[e.jsx(Xs,{className:"w-2.5 h-2.5"}),e.jsx("span",{children:Z})]})]})]})]}),e.jsxs("div",{className:"contacts-col-signal flex items-center justify-end gap-2",children:[v&&(d==null?void 0:d.avgRssi)!==null&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Es,{rssi:d.avgRssi,className:"w-3.5 h-3.5"}),e.jsx("span",{className:"type-data-xs text-fg-muted",children:Math.round(d.avgRssi)})]}),v&&(d==null?void 0:d.avgSnr)!==null&&e.jsxs("span",{className:"type-data-xs text-fg-muted",children:[d.avgSnr.toFixed(1)," dB"]})]}),e.jsx("div",{className:"contacts-col-distance flex items-center justify-end gap-1 text-fg-muted",children:g!=null&&e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"w-3 h-3"}),e.jsx("span",{className:"type-data-xs",children:ft(g)})]})}),e.jsx("div",{className:"contacts-col-centrality flex items-center justify-end gap-1",children:y>0&&e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"w-3 h-3 text-sys-indigo"}),e.jsxs("span",{className:"type-data-xs text-fg-muted",children:[(y*100).toFixed(0),"%"]})]})}),e.jsx("div",{className:"contacts-col-seen flex items-center justify-end",children:e.jsx("span",{className:"type-data-xs text-fg-primary whitespace-nowrap",children:i.last_seen?Le(i.last_seen):"—"})}),e.jsxs("div",{className:"contacts-col-actions flex items-center justify-end gap-1",children:[x&&e.jsx(e.Fragment,{children:z?e.jsxs("div",{className:"flex items-center gap-1 text-sys-green",title:`RTT: ${z.rtt_ms.toFixed(0)}ms`,children:[e.jsx(Ce,{className:"w-3.5 h-3.5"}),e.jsxs("span",{className:"type-data-xs hidden sm:inline",children:[z.snr_db.toFixed(1),"dB"]})]}):D?e.jsx("span",{className:"text-sys-red text-xs",title:D,children:"✗"}):e.jsx("button",{onClick:w=>E(o,w),disabled:T,className:"p-1 sm:p-1.5 radius-inner text-fg-muted/50 hover:text-sys-blue hover:bg-sys-blue/10 transition-base disabled:opacity-50 disabled:cursor-not-allowed",title:"Ping neighbor for updated signal info",children:$?e.jsx(Oe,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 animate-spin"}):e.jsx(Ds,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})}),e.jsx("button",{onClick:w=>{w.stopPropagation(),ge(o,F)},className:"p-1 sm:p-1.5 radius-inner text-fg-muted/50 hover:text-sys-red hover:bg-sys-red/10 transition-base",title:"Remove contact",children:e.jsx(Bs,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})]})]})}const jt=n.memo(gt),bt=6371e3,yt=[],Nt=[{field:"lastHeard",icon:Fs,label:"Recent"},{field:"distance",icon:De,label:"Distance"},{field:"centrality",icon:He,label:"Centrality"}];function vt(o){switch(o){case"room_server":return"room";case"repeater":return"repeater";case"companion":return"companion";case"unknown":return"companion"}}function wt(o){const i=Me(o);return vt(i.type)}function we(o,i){const{color:f="primary",border:x=!1}=i??{};return ke("flex items-center gap-1.5 px-2 py-1.5 text-sm radius-inner transition-base",o?f==="success"?"bg-sys-green/20 text-sys-green":"bg-sys-blue/20 text-sys-blue":"text-fg-muted hover:text-fg-secondary hover-bg",x&&(o?f==="success"?"border border-sys-green/30":"border border-sys-blue/30":"border border-transparent"))}function kt(o,i,f,x){const g=(f-o)*Math.PI/180,y=(x-i)*Math.PI/180,h=Math.sin(g/2)*Math.sin(g/2)+Math.cos(o*Math.PI/180)*Math.cos(f*Math.PI/180)*Math.sin(y/2)*Math.sin(y/2),d=2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h));return bt*d}function Ct(){const{stats:o}=ns(),i=rs(),f=os(),x=is(),g=cs(),y=ls(),h=ds(),d=ms(),H=xs(),C=us(),T=ps(),$=ve[C],z=Ee(),D=Fe(),N=hs(),A=D.totalPaths>0&&D.avgPathConfidence>=.7,Q=n.useMemo(()=>{const s=new Map;for(const t of z)s.set(t.prefix,t);return s},[z]),[u,K]=n.useState(null),[E,ge]=n.useState("lastHeard"),[I,F]=n.useState("desc"),[v,re]=n.useState(""),[_,Y]=n.useState(!1),[j,X]=n.useState(new Set),[J,oe]=n.useState(!1),[Z,w]=n.useState(null),[P,ie]=n.useState(null),[je,be]=n.useState(new Map),[Ie,ee]=n.useState(new Map),[M,Be]=n.useState(25),[U,ce]=n.useState(25),ye=n.useRef(null),se=n.useMemo(()=>(o==null?void 0:o.neighbors)??{},[o==null?void 0:o.neighbors]),Ne=ys(),le=n.useMemo(()=>{if(Ne.size===0)return se;const s=new Set;for(const a of Object.keys(se))s.add((a.startsWith("0x")?a.slice(2):a).toLowerCase());let t=null;for(const[a,r]of Ne){const c=(a.startsWith("0x")?a.slice(2):a).toLowerCase();s.has(c)||(t||(t={...se}),t[a]={last_seen:r.lastSeen,name:r.name??void 0,node_name:r.name??void 0,latitude:r.latitude,longitude:r.longitude,is_repeater:r.nodeType==="repeater",contact_type:r.nodeType==="repeater"?"Repeater":r.nodeType==="companion"?"Companion":r.nodeType==="room_server"?"Room Server":void 0})}return t??se},[se,Ne]),B=n.useMemo(()=>{const t=Date.now()/1e3-$.minutes*60;return Object.fromEntries(Object.entries(le).filter(([a,r])=>i.has(a)?!1:(r.last_seen??0)>=t))},[le,i,$.minutes]),R=fs(),q=o==null?void 0:o.local_hash,Ve=n.useMemo(()=>{const s=new Map;if(!q||h.size===0)return s;for(const[t,a]of h)if(t.endsWith(`→${q}`)&&a.hops.length>1){const r=t.split("→")[0],c=a.hops[a.hops.length-1];s.set(r,c)}return s},[h,q]),de=n.useMemo(()=>{const s=new Map;if(!(R!=null&&R.latitude)||!(R!=null&&R.longitude))return s;for(const[t,a]of Object.entries(B))a.latitude&&a.longitude&&a.latitude!==0&&a.longitude!==0?s.set(t,kt(R.latitude,R.longitude,a.latitude,a.longitude)):s.set(t,null);return s},[B,R]),{neighborHashSet:me,neighborSignalMap:Ue}=n.useMemo(()=>{const s=new Set,t=new Map;for(const a of y)s.add(a.hash),t.set(a.hash,{avgRssi:a.avgRssi,avgSnr:a.avgSnr});return{neighborHashSet:s,neighborSignalMap:t}},[y]),Se=n.useMemo(()=>{const s=v.toLowerCase().trim(),t=s==="neighbor"||s==="neighbors",a=_||t,r=j.size>0;return Object.fromEntries(Object.entries(B).filter(([c,l])=>{if(r){const S=wt(l);if(!j.has(S))return!1}if(a&&!me.has(c))return!1;if(t||!s)return!0;const V=(l.node_name||l.name||"").toLowerCase(),b=ne(c).toLowerCase();return V.includes(s)||b.includes(s)||c.toLowerCase().includes(s)}))},[B,v,_,me,j]),p=n.useMemo(()=>{const s=Object.entries(Se),t=v.toLowerCase().trim(),a=t.length===2&&/^[0-9a-f]{2}$/i.test(t);return s.sort(([r,c],[l,V])=>{if(a){const S=ne(r).toLowerCase(),O=ne(l).toLowerCase(),te=S===t,xe=O===t;if(te&&!xe)return-1;if(xe&&!te)return 1}let b=0;switch(E){case"lastHeard":b=(c.last_seen||0)-(V.last_seen||0);break;case"distance":{const S=de.get(r)??null,O=de.get(l)??null;S===null&&O===null?b=0:S===null?b=1:O===null?b=-1:b=S-O;break}case"centrality":{const S=g.get(r)||0,O=g.get(l)||0;b=S-O;break}}return I==="desc"?-b:b})},[Se,E,I,de,g,v]),m=n.useMemo(()=>{let s=0,t=0,a=0,r=0,c=0;for(const[,l]of p){const V=Me(l),b=l.latitude&&l.longitude&&l.latitude!==0&&l.longitude!==0;switch(V.type){case"room_server":a++;break;case"repeater":t++;break;case"companion":s++;break;case"unknown":c++;break}b&&r++}return{companions:s,repeaters:t,roomServers:a,total:p.length,withLocation:r,unknown:c}},[p]),qe=n.useMemo(()=>new Set(x),[x]),_e=n.useMemo(()=>M===0?p:p.slice(0,U),[p,U,M]);n.useEffect(()=>{ce(M||p.length)},[E,I,v,_,j,M,p.length]),n.useEffect(()=>{const s=t=>{t.target.closest("[data-dropdown]")||oe(!1)};return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[]),n.useEffect(()=>{if(M===0)return;const s=new IntersectionObserver(t=>{t[0].isIntersecting&&U<p.length&&ce(a=>Math.min(a+M,p.length))},{threshold:.1,rootMargin:"100px"});return ye.current&&s.observe(ye.current),()=>s.disconnect()},[M,U,p.length]);const We=n.useCallback(s=>{Be(s),ce(s||p.length)},[p.length]),Ge=n.useCallback(s=>{E===s?F(t=>t==="desc"?"asc":"desc"):(ge(s),F("desc"))},[E]),Qe=n.useCallback(s=>{const t=B[s];t!=null&&t.latitude&&(t!=null&&t.longitude)&&t.latitude!==0&&t.longitude!==0&&w(s)},[B]),Ke=n.useCallback(()=>{w(null)},[]),Ye=n.useCallback((s,t)=>{K({hash:s,name:t})},[]),Xe=n.useCallback(async(s,t)=>{if(t.stopPropagation(),!P){ie(s),be(a=>{const r=new Map(a);return r.delete(s),r}),ee(a=>{const r=new Map(a);return r.delete(s),r});try{const a=s.startsWith("0x")?s.slice(0,4):`0x${s.slice(0,2)}`,r=await Ns(a,30);r.success&&r.data?(be(c=>new Map(c).set(s,r.data)),setTimeout(()=>{be(c=>{const l=new Map(c);return l.delete(s),l})},1e4)):(ee(c=>new Map(c).set(s,r.error||"Ping failed")),setTimeout(()=>{ee(c=>{const l=new Map(c);return l.delete(s),l})},5e3))}catch(a){const r=a instanceof Error?a.message:"Ping failed";ee(c=>new Map(c).set(s,r)),setTimeout(()=>{ee(c=>{const l=new Map(c);return l.delete(s),l})},5e3)}finally{ie(null)}}},[P]);return e.jsxs(vs,{children:[e.jsx(ws,{title:"Contacts",icon:e.jsx(ae,{}),controls:e.jsxs("div",{className:"flex items-center gap-3 sm:gap-5",children:[e.jsxs("div",{className:"hidden sm:flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs text-fg-muted",children:"Total:"}),e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:`${m.total} discovered node${m.total!==1?"s":""} on the mesh network`,children:[e.jsx(ae,{className:"w-3.5 h-3.5 text-fg-secondary"}),e.jsx("span",{children:m.total})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs text-fg-muted",children:"Types:"}),m.repeaters>0&&e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:"Repeaters",children:[e.jsx(he,{className:"w-3.5 h-3.5 text-sys-blue"}),e.jsx("span",{children:m.repeaters})]}),m.companions>0&&e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:"Companions",children:[e.jsx($e,{className:"w-3.5 h-3.5 text-fg-muted"}),e.jsx("span",{children:m.companions})]}),m.roomServers>0&&e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:"Room Servers",children:[e.jsx(fe,{className:"w-3.5 h-3.5 text-sys-pink"}),e.jsx("span",{children:m.roomServers})]}),m.withLocation>0&&e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:"With GPS location",children:[e.jsx(Us,{className:"w-3.5 h-3.5 text-sys-green"}),e.jsx("span",{children:m.withLocation})]}),m.unknown>0&&e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:"Unknown type",children:[e.jsx(ze,{className:"w-3.5 h-3.5 text-sys-amber"}),e.jsx("span",{children:m.unknown})]})]})]}),e.jsxs("div",{className:"flex sm:hidden items-center gap-1.5",children:[e.jsxs("span",{className:"data-box !px-1.5 !py-0.5 !text-[10px] flex items-center gap-1",children:[e.jsx(ae,{className:"w-3 h-3 text-fg-secondary"}),e.jsx("span",{children:m.total})]}),m.repeaters>0&&e.jsxs("span",{className:"data-box !px-1.5 !py-0.5 !text-[10px] flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3 text-sys-blue"}),e.jsx("span",{children:m.repeaters})]}),m.companions>0&&e.jsxs("span",{className:"data-box !px-1.5 !py-0.5 !text-[10px] flex items-center gap-1",children:[e.jsx($e,{className:"w-3 h-3 text-fg-muted"}),e.jsx("span",{children:m.companions})]}),m.roomServers>0&&e.jsxs("span",{className:"data-box !px-1.5 !py-0.5 !text-[10px] flex items-center gap-1",children:[e.jsx(fe,{className:"w-3 h-3 text-sys-pink"}),e.jsx("span",{children:m.roomServers})]}),e.jsx(Te,{ranges:ve,selectedIndex:C,onSelect:T,size:"sm"})]}),e.jsx("div",{className:"hidden sm:block",children:e.jsx(Te,{ranges:ve,selectedIndex:C,onSelect:T})})]})}),e.jsxs(ks,{children:[H?e.jsx(ut,{neighbors:B,localNode:R??void 0,localHash:q,onRemoveNode:f,selectedNodeHash:Z,onNodeSelected:Ke}):e.jsx("div",{className:"surface-base radius-card aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-sys-blue border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm text-fg-muted",children:"Loading map..."})]})}),e.jsx(gs,{noPadding:!0,children:H?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2.5 border-b border-edge-subtle",children:[e.jsx("span",{className:"icon-md flex items-center justify-center text-icon-card-title flex-shrink-0",children:e.jsx(ae,{})}),e.jsx("span",{className:"type-micro flex-shrink-0 mr-auto hidden sm:block",children:"Discovered Contacts"}),e.jsx(js,{type:"search",size:"sm",value:v,onChange:s=>re(s.target.value),placeholder:"Search...",leadingIcon:e.jsx(qs,{className:"w-3.5 h-3.5"}),trailingIcon:v?e.jsx("button",{onClick:()=>{re(""),(v.toLowerCase().trim()==="neighbor"||v.toLowerCase().trim()==="neighbors")&&Y(!1)},className:"text-fg-muted hover:text-fg-secondary",children:e.jsx(bs,{className:"w-3 h-3"})}):void 0,className:"w-24 sm:w-32 xl:w-44","aria-label":"Search contacts"}),e.jsx("div",{className:"h-4 w-px bg-border-subtle flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsxs("div",{className:"relative","data-dropdown":!0,children:[e.jsxs("button",{onClick:()=>oe(!J),className:we(j.size>0,{border:!0}),title:"Filter by contact type",children:[e.jsx(st,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden xl:inline",children:"Filter"}),j.size>0&&e.jsx("span",{className:"tabular-nums text-xs bg-sys-blue/30 px-1 rounded",children:j.size})]}),J&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 z-50 surface-elevated radius-inner py-1 min-w-[140px]",children:[[{key:"repeater",label:"Repeaters"},{key:"companion",label:"Companions"},{key:"room",label:"Rooms"}].map(({key:s,label:t})=>e.jsxs("button",{onClick:()=>{X(a=>{const r=new Set(a);return r.has(s)?r.delete(s):r.add(s),r})},className:"w-full px-3 py-1.5 text-sm text-left hover-bg transition-base flex items-center gap-2",children:[e.jsx("span",{className:ke("w-4 h-4 flex items-center justify-center radius-badge border",j.has(s)?"bg-sys-blue border-sys-blue text-white":"border-edge-subtle"),children:j.has(s)&&e.jsx(Ce,{className:"w-3 h-3"})}),e.jsx("span",{className:j.has(s)?"text-fg-primary":"text-fg-secondary",children:t})]},s)),j.size>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-edge-subtle my-1"}),e.jsx("button",{onClick:()=>X(new Set),className:"w-full px-3 py-1.5 text-sm text-left text-fg-muted hover:text-fg-secondary hover-bg transition-base",children:"Clear filters"})]})]})]}),me.size>0&&e.jsxs("button",{onClick:()=>Y(!_),className:we(_,{color:"success",border:!0}),title:_?"Show all contacts":"Show only MeshCore neighbors (direct RF contact)",children:[e.jsx(he,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden xl:inline",children:"Neighbors"})]})]}),e.jsx("div",{className:"h-4 w-px bg-border-subtle flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[Nt.map(({field:s,icon:t,label:a})=>e.jsxs("button",{onClick:()=>Ge(s),className:we(E===s),title:`Sort by ${a.toLowerCase()}`,children:[e.jsx(t,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden xl:inline",children:a}),E===s&&e.jsx(Ks,{className:ke("w-3 h-3",I==="asc"&&"rotate-180")})]},s)),e.jsx("div",{className:"h-4 w-px bg-border-subtle"}),e.jsxs(Cs,{value:M,onChange:We,className:"w-auto min-w-[50px] [&_button]:py-1 [&_button]:px-2 [&_button]:text-xs [&_button]:min-h-0","aria-label":"Items per page",children:[e.jsx(pe,{value:25,children:"25"}),e.jsx(pe,{value:50,children:"50"}),e.jsx(pe,{value:100,children:"100"}),e.jsx(pe,{value:0,children:"All"})]})]})]}),p.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden sm:grid contacts-grid-header border-b border-edge-subtle/50 px-3 py-2 type-micro text-fg-muted",children:[e.jsx("div",{className:"contacts-col-node",children:"Node"}),e.jsx("div",{className:"contacts-col-signal text-right",children:"Signal"}),e.jsx("div",{className:"contacts-col-distance text-right",children:"Distance"}),e.jsx("div",{className:"contacts-col-centrality text-right",children:"Centrality"}),e.jsx("div",{className:"contacts-col-seen text-right",children:"Last Seen"}),e.jsx("div",{className:"contacts-col-actions"})]}),e.jsx("div",{className:"divide-y divide-edge-subtle/30",children:_e.map(([s,t])=>{const a=ne(s),r=qe.has(s),c=me.has(s),l=de.get(s)??null,V=g.get(s)||0,b=c?Ue.get(s):void 0,S=a?Q.get(a)??null:null,O=N.get(s)??yt;let te=null;if(!c&&q&&h.size>0){const Ze=`${s}→${q}`,ue=h.get(Ze);if(ue&&ue.hops.length>0){const Pe=ue.hops[0],Re=Object.keys(le).find(es=>es.toUpperCase().startsWith(Pe.toUpperCase())),W=Re?le[Re]:null;te={prefix:Pe,name:(W==null?void 0:W.node_name)??(W==null?void 0:W.name)??null,hopCount:ue.hopCount}}}const xe=d.has(s),Je=Ve.get(s)??null;return e.jsx(jt,{hash:s,contact:t,isHub:r,isNeighbor:c,distance:l,centrality:V,sparklineData:O,neighborSignal:b,collisionInfo:S,isViterbiResolved:A,isPinging:P!==null,isPingingThis:P===s,pingResult:je.get(s),pingError:Ie.get(s),gatewayInfo:te,lastForwarderPrefix:Je,isMobile:xe,onRowClick:Qe,onPing:Xe,onRemove:Ye},s)})}),M>0&&U<p.length&&e.jsxs("div",{ref:ye,className:"flex items-center justify-center py-4 text-fg-muted",children:[e.jsx(Oe,{className:"w-4 h-4 animate-spin mr-2"}),e.jsx("span",{className:"text-xs",children:"Loading more..."})]}),e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-t border-edge-subtle/50 text-xs text-fg-muted",children:[e.jsxs("span",{className:"tabular-nums",children:["Showing ",_e.length," of ",p.length]}),M>0&&U<p.length&&e.jsx("button",{onClick:()=>ce(s=>Math.min(s+M,p.length)),className:"text-sys-blue hover:text-sys-blue/80 transition-base",children:"Load more"})]})]}):e.jsxs("div",{className:"roster-empty",children:[e.jsx(ae,{className:"roster-empty-icon"}),e.jsx("div",{className:"type-label text-fg-secondary",children:"No Contacts Discovered"}),e.jsx("div",{className:"type-data-xs text-fg-muted mt-1",children:"Contacts will appear here as they advertise on the mesh network."})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-edge-subtle",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-elevated animate-pulse"}),e.jsx("div",{className:"w-32 h-4 rounded bg-elevated animate-pulse"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 h-6 rounded bg-elevated animate-pulse"}),e.jsx("div",{className:"w-24 h-6 rounded bg-elevated animate-pulse"}),e.jsx("div",{className:"w-16 h-6 rounded bg-elevated animate-pulse"})]})]}),e.jsx("div",{className:"px-3 py-3 space-y-3",children:[...Array(5)].map((s,t)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded bg-elevated animate-pulse"}),e.jsxs("div",{className:"flex-1 space-y-1.5",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-elevated animate-pulse"}),e.jsx("div",{className:"h-3 w-24 rounded bg-elevated animate-pulse"})]}),e.jsx("div",{className:"w-12 h-4 rounded bg-elevated animate-pulse"}),e.jsx("div",{className:"w-16 h-4 rounded bg-elevated animate-pulse"})]},t))})]})})]}),e.jsx(Vs,{isOpen:!!u,title:"Remove Contact",message:`Are you sure you would like to remove ${(u==null?void 0:u.name)||"this contact"}?`,confirmLabel:"Remove",cancelLabel:"Cancel",variant:"danger",onConfirm:()=>{u&&f(u.hash),K(null)},onCancel:()=>K(null)})]})}const Gt=Object.freeze(Object.defineProperty({__proto__:null,default:Ct},Symbol.toStringTag,{value:"Module"}));export{Gt as C,ht as P,De as R,dt as T};
