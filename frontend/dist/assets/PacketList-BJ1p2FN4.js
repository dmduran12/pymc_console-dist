const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PathMapMapLibre-CQABb9bb.js","assets/vendor-react-j_fHog8x.js","assets/BasemapLayer-BT1oL_wV.js","assets/vendor-core-CmkNwW1A.js","assets/index-BlwPfT46.js","assets/DelayedAnimateNumber-DZN6AHzO.js","assets/index-CYKlY5bG.js","assets/payload-decoders-p1VLFauk.js","assets/node-types-DQrg781U.js","assets/badge-colors-YAE4qQ7m.js","assets/chat-utils-Dv1u04Sb.js","assets/SignalIndicator-BWauVe7z.js","assets/signal-scoring-CcBiRcks.js","assets/arrow-up-CTyqqxby.js","assets/chevron-right-yOv-Pwox.js","assets/map-pin-Cz3tR4tK.js","assets/triangle-alert-H38QV5jv.js","assets/DataBox-CaOjt0v6.js","assets/layers-BiNwbWGm.js","assets/route-CZmnQF65.js","assets/activity-zb8FvbJA.js","assets/circle-check-CF6XBxzv.js","assets/database-QrjNtSo1.js","assets/maplibre-gl-B1CfjdFi.css","assets/index-COOaFBFb.css"])))=>i.map(i=>d[i]);
import{c as e}from"./vendor-core-CmkNwW1A.js";import{j as s,c as t,r as a,_ as n}from"./vendor-react-j_fHog8x.js";import{c as l,a7 as r,a8 as i,a9 as c,aa as o,B as d,ab as x,ac as m,ad as p,p as h,j as u,ae as g,R as f,af as y,ag as j,ah as b,ai as N,aj as v,H as k,ak as w,al as C,m as S,P as _,o as H,am as M,an as T,ao as P,ap as B,aq as F,ar as L,v as D,as as z,at as R,au as A,av as E,X as $,Y as U,A as I,aw as V,_ as Q,ax as O,ay as G,az as W}from"./index-BlwPfT46.js";import{P as q,d as K,a as X,b as Y,c as J,e as Z,f as ee}from"./payload-decoders-p1VLFauk.js";import{g as se,C as te,a as ae}from"./node-types-DQrg781U.js";import{D as ne,R as le,P as re}from"./badge-colors-YAE4qQ7m.js";import{g as ie,e as ce,a as oe}from"./chat-utils-Dv1u04Sb.js";import{A as de,S as xe,i as me,a as pe,g as he,b as ue,Z as ge}from"./SignalIndicator-BWauVe7z.js";import{a as fe,A as ye}from"./arrow-up-CTyqqxby.js";import{C as je}from"./chevron-right-yOv-Pwox.js";import{M as be}from"./map-pin-Cz3tR4tK.js";import{T as Ne}from"./triangle-alert-H38QV5jv.js";import{D as ve}from"./DataBox-CaOjt0v6.js";import{L as ke}from"./layers-BiNwbWGm.js";import{H as we,R as Ce}from"./route-CZmnQF65.js";import{A as Se}from"./activity-zb8FvbJA.js";import{C as _e}from"./circle-check-CF6XBxzv.js";import{D as He}from"./database-QrjNtSo1.js";import{H as Me,D as Te}from"./DelayedAnimateNumber-DZN6AHzO.js";const Pe=l("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Be=l("corner-down-right",[["path",{d:"m15 10 5 5-5 5",key:"qqa56n"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]]),Fe=l("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Le=l("message-circle-question-mark",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),De=l("reply",[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]]),ze=l("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),Re=l("stethoscope",[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]),Ae=l("trophy",[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]]),Ee=l("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);function $e(e,s){[...s].reverse().forEach(t=>{const a=e.getVariant(t);a&&i(e,a),e.variantChildren&&e.variantChildren.forEach(e=>{$e(e,s)})})}function Ue(){const e=new Set,s={subscribe:s=>(e.add(s),()=>{e.delete(s)}),start(s,t){const a=[];return e.forEach(e=>{a.push(r(e,s,{transitionOverride:t}))}),Promise.all(a)},set:s=>e.forEach(e=>{!function(e,s){Array.isArray(s)?$e(e,s):"string"==typeof s?$e(e,[s]):i(e,s)}(e,s)}),stop(){e.forEach(e=>{!function(e){e.values.forEach(e=>e.stop())}(e)})},mount:()=>()=>{s.stop()}};return s}function Ie(){const e=c(Ue);return o(e.mount,[]),e}function Ve({"aria-label":e="Page navigation",className:a,...n}){return s.jsx("nav",{"aria-label":e,...n,className:t("flex gap-x-2",a)})}function Qe({onClick:e,disabled:a=!1,className:n,children:l="Previous"}){return s.jsx("span",{className:t("grow basis-0",n),children:s.jsxs(d,{plain:!0,onClick:e,disabled:a,"aria-label":"Previous page",className:t("gap-1",a&&"invisible"),children:[s.jsx("svg",{className:"size-4 stroke-current",viewBox:"0 0 16 16",fill:"none","aria-hidden":"true",children:s.jsx("path",{d:"M2.75 8H13.25M2.75 8L5.25 5.5M2.75 8L5.25 10.5",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})}),l]})})}function Oe({onClick:e,disabled:a=!1,className:n,children:l="Next"}){return s.jsx("span",{className:t("flex grow basis-0 justify-end",n),children:s.jsxs(d,{plain:!0,onClick:e,disabled:a,"aria-label":"Next page",className:t("gap-1",a&&"invisible"),children:[l,s.jsx("svg",{className:"size-4 stroke-current",viewBox:"0 0 16 16",fill:"none","aria-hidden":"true",children:s.jsx("path",{d:"M13.25 8L2.75 8M13.25 8L10.75 10.5M13.25 8L10.75 5.5",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})})]})})}function Ge({className:e,...a}){return s.jsx("span",{...a,className:t("hidden items-baseline gap-x-2 sm:flex",e)})}function We({page:e,current:a=!1,onClick:n,className:l,children:r}){return s.jsx(d,{plain:!a,outline:a,onClick:()=>null==n?void 0:n(e),"aria-label":`Page ${e}`,"aria-current":a?"page":void 0,className:t("min-w-[2.25rem] before:absolute before:-inset-px before:rounded-lg",a&&"before:bg-subtle-fill",l),children:r??e})}function qe({className:e,...a}){return s.jsx("span",{"aria-hidden":"true",...a,className:t("w-[2.25rem] select-none text-center text-sm text-fg-muted",e),children:"…"})}const Ke=e(e=>({requestedHash:null,requestChannel:s=>e({requestedHash:s}),clearRequest:()=>e({requestedHash:null})}));function Xe(e){if(!e||e.length<8)return null;const s=parseInt(e.slice(0,2),16),t=parseInt(e.slice(2,4),16),a=parseInt(e.slice(4,6),16),n=parseInt(e.slice(6,8),16);return isNaN(s)||isNaN(t)||isNaN(a)||isNaN(n)?null:((s|t<<8|a<<16|n<<24)>>>0).toString(16).toUpperCase().padStart(8,"0")}function Ye(e){return e>=10?"excellent":e>=5?"good":e>=0?"fair":e>=-5?"poor":"critical"}function Je(e){if(!e.payload)return null;try{const s=p(e.payload),t=function(e){const s=e.original_path||e.forwarded_path||[];if("string"==typeof s)try{const e=JSON.parse(s);if(Array.isArray(e))return e.map(e=>parseInt(e,16))}catch{return[]}else if(Array.isArray(s))return s.map(e=>parseInt(e,16));return[]}(e),a=X(s,t);return a?{packet:e,decoded:a,timestamp:e.timestamp??0,hopCount:a.snrValues.length,rssi:e.rssi,snr:e.snr}:null}catch{return null}}const Ze={rx:{icon:ye,label:"Rx",badgeColor:ne.rx,avatarBg:"bg-sys-green/15",avatarText:"text-sys-green"},forward:{icon:de,label:"Fwd",badgeColor:ne.forward,avatarBg:"bg-sys-cyan/15",avatarText:"text-sys-cyan"},duplicate:{icon:h,label:"Dupe",badgeColor:ne.duplicate,avatarBg:"bg-fg-muted/15",avatarText:"text-fg-secondary"},tx:{icon:fe,label:"Tx",badgeColor:ne.tx,avatarBg:"bg-sys-indigo/15",avatarText:"text-sys-indigo"},dropped:{icon:Be,label:"Drop",badgeColor:ne.dropped,avatarBg:"bg-sys-amber/15",avatarText:"text-sys-amber"}},es={sm:"w-3.5 h-3.5",md:"w-4 h-4",lg:"w-5 h-5"},ss={sm:"w-8 h-8",md:"w-9 h-9",lg:"w-10 h-10"};function ts(e){return"tx_local"===e.packet_origin?"tx":"tx_forward"===e.packet_origin?"forward":e.is_duplicate?"duplicate":e.transmitted?"forward":e.drop_reason?"dropped":"rx"}const as=a.memo(function({packet:e,showLabel:a=!0,variant:n="avatar",size:l="sm"}){const r=ts(e),i=Ze[r],c=i.icon;return"avatar"===n?s.jsx("div",{className:t("flex items-center justify-center rounded-full flex-shrink-0",i.avatarBg,ss[l]),children:s.jsx(c,{className:t(es[l],i.avatarText)})}):s.jsxs(u,{color:i.badgeColor,children:[s.jsx(c,{className:es[l]}),a&&i.label]})}),ns=a.memo(function({path:e,localHash:a,className:n}){if(!e||0===e.length)return s.jsx("span",{className:t("text-fg-muted text-xs",n),children:"—"});const l=a?(a.startsWith("0x")?a.slice(2,4):a.slice(0,2)).toUpperCase():null;return s.jsx("span",{className:t("flex items-center gap-0.5 type-data-xs overflow-hidden",n),children:e.map((t,a)=>{const n=a===e.length-1,r=l&&t.toUpperCase()===l;return s.jsxs("span",{className:"flex items-center flex-shrink-0",children:[r?s.jsx("span",{className:"px-1 py-0.5 rounded bg-sys-amber/20 text-sys-amber text-[9px] font-medium",children:"You"}):s.jsx("span",{className:"px-1 py-0.5 rounded bg-subtle-fill-hover text-fg-secondary",children:t.toUpperCase()}),!n&&s.jsx(je,{className:"w-2.5 h-2.5 text-fg-muted mx-0.5 flex-shrink-0"})]},`${t}-${a}`)})})});function ls({channelName:e,onClick:a,active:n,compact:l,className:r}){const i=e.startsWith("#")?e:`#${e}`,c=t("inline-flex items-center flex-shrink-0","font-medium",l?"px-1.5 h-4 leading-4 rounded text-[10px]":"px-2 h-5 leading-5 rounded text-xs",n?"bg-sys-blue/20 text-sys-blue":"bg-sys-blue/10 text-sys-blue",a&&!n&&"hover:bg-sys-blue/20 cursor-pointer",r);return a?s.jsx("button",{type:"button",onClick:a,className:c,children:i}):s.jsx("span",{className:c,children:i})}function rs(e){return{"--data-box-accent":N[e]}}function is(e){const s=e.payload_type_name||j(e.payload_type??e.type),t=e.route_type_name||b(e.route_type??e.route);return{payloadType:s,routeType:t,payloadColor:re[s]??"zinc",routeColor:le[t]??"zinc"}}function cs(e){if(!e)return[];if(Array.isArray(e))return e;try{const s=JSON.parse(e);return Array.isArray(s)?s:[]}catch{return[]}}function os(e,s){const{name:t,nodeType:a}=se(e,s);return{name:t,isCompanion:a.isCompanion||a.isClient,isRepeater:a.isRepeater}}const ds=a.memo(function({packet:e,onClick:n,localHash:l,neighbors:r,isFlashing:i=!1,isTraceHighlighted:c,onTraceHover:o,traceTag:d,onViewTraceReport:x,dupeGroupPosition:m,isDupeGroupHovered:p=!1,onDupeGroupHover:h,dupeCount:u,decodedMessages:j,onChannelClick:b}){const v=!u&&g(e.is_duplicate),k=void 0!==m,{payloadType:w,routeType:C,payloadColor:S,routeColor:_}=is(e),H="tx_local"===e.packet_origin,M="TRACE"===w,T=cs(e.original_path),P=cs(e.forwarded_path),B=P.length>0?P:T,F=e.src_hash?(e.src_hash.startsWith("0x")?e.src_hash.slice(2,6):e.src_hash.slice(0,4)).toUpperCase():null,{name:L,isRepeater:D}=os(e.src_hash,r);let z=null,R=null,A=null,E=null;if("GRP_TXT"===w&&j){const s=j.get(e.packet_hash),t=null==s?void 0:s.decoded;(null==t?void 0:t.decrypted)&&!t.macCorrupted&&t.text&&(R=t.senderName||null,z=t.text,A=t.channelName||null,E=t.channelHash||null)}else if("TXT_MSG"===w&&e.raw_packet)try{const s=q.fromHex(e.raw_packet);if(s.success&&s.packet){const e=Y(s.packet.payload);e&&!e.encrypted&&(z=e.text)}}catch{}const $=R||(D?null:L),U=!!$,I=!U&&D&&!!L,V=!U&&!I&&"GRP_TXT"===w&&!z,Q=e.payload_length??e.length??0;e.lbt_attempts;const O=a.useCallback(()=>{M&&d&&x?x(d):n(e)},[M,d,x,n,e]),G=a.useCallback(()=>{M&&d&&o&&o(d),k&&h&&e.packet_hash&&h(e.packet_hash)},[M,d,o,k,h,e.packet_hash]),W=a.useCallback(()=>{o&&o(null),h&&h(null)},[o,h]),K=N[S]||N.zinc,X=p;return s.jsxs("div",{onClick:O,onMouseEnter:G,onMouseLeave:W,className:t("group relative cursor-pointer","hover:bg-subtle-fill",v&&!p&&"opacity-40",i&&"flash-row",H&&"bg-sys-indigo/5",c&&"bg-sys-teal/10"),children:[s.jsx("div",{className:t("absolute pointer-events-none transition-opacity duration-75",k?X?"opacity-100":"opacity-0":"opacity-0 group-hover:opacity-100"),style:(()=>{const e={pointerEvents:"none"};return"first"===m?{...e,borderTop:`2px solid ${K}`,borderLeft:`2px solid ${K}`,borderRight:`2px solid ${K}`,borderBottom:"none",borderRadius:"8px 8px 0 0",inset:"-2px -2px 0 -2px"}:"middle"===m?{...e,borderTop:"none",borderLeft:`2px solid ${K}`,borderRight:`2px solid ${K}`,borderBottom:"none",borderRadius:0,inset:"0 -2px"}:"last"===m?{...e,borderTop:"none",borderLeft:`2px solid ${K}`,borderRight:`2px solid ${K}`,borderBottom:`2px solid ${K}`,borderRadius:"0 0 8px 8px",inset:"0 -2px -2px -2px"}:{...e,border:`2px solid ${K}`,borderRadius:"8px",inset:"-2px"}})()}),s.jsxs("div",{className:"relative flex items-center gap-2 min-[600px]:gap-3 px-2 py-2 min-[600px]:px-3 min-[600px]:py-2.5",children:[s.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[s.jsx("div",{className:"relative flex-shrink-0",children:U?s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-1 ring-edge-subtle",style:{backgroundColor:ie(ce($).cleanName)},children:ce($).emoji?s.jsx("span",{className:"text-base leading-none",children:ce($).emoji}):s.jsx("span",{className:"text-white text-[10px] font-bold tracking-tighter",children:oe($)})}):I?s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-[1.5px] ring-sys-blue",children:s.jsx(f,{className:"size-5 text-sys-blue"})}):V?s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-zinc-500/20 ring-1 ring-edge-subtle",children:s.jsx(Le,{className:"size-4 text-fg-muted"})}):s.jsx(as,{packet:e,variant:"avatar",size:"sm"})}),s.jsx("div",{className:"min-w-0",children:U?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"font-semibold text-[13px] text-fg-primary font-sans truncate max-w-[90px]",children:$}),F&&s.jsx("div",{className:"hidden min-[900px]:block text-[9px] text-fg-muted truncate",children:F})]}):I?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"font-semibold text-[13px] text-fg-primary font-sans truncate max-w-[90px]",children:L}),F&&s.jsx("div",{className:"hidden min-[900px]:block text-[9px] text-fg-muted truncate",children:F})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"font-bold text-[13px] text-fg-primary font-sans truncate",children:F||"—"}),L&&s.jsx("div",{className:"hidden min-[900px]:block text-[9px] text-fg-muted truncate max-w-[70px]",children:L})]})})]}),s.jsxs("div",{className:"flex-1 flex items-center gap-1 min-[600px]:gap-1.5 min-[900px]:gap-2 min-w-0",children:[s.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:rs(S),children:w}),u&&u>1&&s.jsxs("span",{className:"data-box data-box-compact flex-shrink-0",children:["×",u]}),s.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:rs(_),children:C}),s.jsxs("span",{className:"hidden min-[520px]:inline type-data-xs text-fg-muted flex-shrink-0",children:[Q,"B"]}),s.jsx("div",{className:"flex-1 min-w-0 overflow-hidden",children:z?s.jsxs("span",{className:"text-[11px] text-fg-secondary truncate block flex items-center gap-1",children:[A&&s.jsx(ls,{channelName:A,compact:!0,onClick:b&&E?e=>{e.stopPropagation(),b(E)}:void 0}),s.jsx("span",{className:"italic truncate",children:z})]}):s.jsx(ns,{path:B,localHash:l})})]}),s.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[s.jsx("span",{className:"data-box data-box-compact",children:y(e.timestamp)}),s.jsx(xe,{rssi:e.rssi,snr:e.snr,compact:!0,showValues:!0,validated:me(e)})]})]})]})}),xs=a.memo(function({packet:e,onClick:a,localHash:n,neighbors:l,isFlashing:r=!1,isTraceHighlighted:i,traceTag:c,onViewTraceReport:o,dupeGroupPosition:d,isDupeGroupHovered:x=!1,onDupeGroupHover:m,dupeCount:p,decodedMessages:h,onChannelClick:u}){const{payloadType:j,routeType:b,payloadColor:v,routeColor:k}=is(e),w="tx_local"===e.packet_origin,C="TRACE"===j,S=!p&&g(e.is_duplicate),_=cs(e.original_path),H=cs(e.forwarded_path),M=H.length>0?H:_,T=M.length,P=e.src_hash?(e.src_hash.startsWith("0x")?e.src_hash.slice(2,6):e.src_hash.slice(0,4)).toUpperCase():null,{name:B,isRepeater:F}=os(e.src_hash,l);let L=null,D=null,z=null,R=null;if("GRP_TXT"===j&&h){const s=h.get(e.packet_hash),t=null==s?void 0:s.decoded;(null==t?void 0:t.decrypted)&&!t.macCorrupted&&t.text&&(D=t.senderName||null,L=t.text,z=t.channelName||null,R=t.channelHash||null)}else if("TXT_MSG"===j&&e.raw_packet)try{const s=q.fromHex(e.raw_packet);if(s.success&&s.packet){const e=Y(s.packet.payload);e&&!e.encrypted&&(L=e.text)}}catch{}const A=D||(F?null:B),E=!!A,$=!E&&F&&!!B,U=!E&&!$&&"GRP_TXT"===j&&!L,I=e.payload_length??e.length??0,V=e.lbt_attempts??0,Q=N[v]||N.zinc;return s.jsxs("div",{onClick:()=>{C&&c&&o?o(c):a(e)},className:t("relative pl-3 pr-2.5 py-2 cursor-pointer","active:bg-subtle-fill-hover",S&&"opacity-40",r&&"flash-row",w&&"bg-sys-indigo/5",i&&"bg-sys-teal/10"),children:[s.jsx("div",{className:"absolute left-0 transition-all",style:(()=>{if(!d)return{opacity:0};const e=x?1:.4,s=x?"3px":"2px";return"first"===d?{backgroundColor:Q,opacity:e,width:s,top:"6px",bottom:0,borderRadius:"0 9999px 0 0"}:"middle"===d?{backgroundColor:Q,opacity:e,width:s,top:0,bottom:0,borderRadius:0}:"last"===d?{backgroundColor:Q,opacity:e,width:s,top:0,bottom:"6px",borderRadius:"0 0 9999px 0"}:{backgroundColor:Q,opacity:e,width:s,top:"6px",bottom:"6px",borderRadius:"9999px"}})()}),s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("div",{className:"relative flex-shrink-0 mt-0.5",children:E?s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-1 ring-edge-subtle",style:{backgroundColor:ie(ce(A).cleanName)},children:ce(A).emoji?s.jsx("span",{className:"text-base leading-none",children:ce(A).emoji}):s.jsx("span",{className:"text-white text-[10px] font-bold tracking-tighter",children:oe(A)})}):$?s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-[1.5px] ring-sys-blue",children:s.jsx(f,{className:"size-5 text-sys-blue"})}):U?s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-zinc-500/20 ring-1 ring-edge-subtle",children:s.jsx(Le,{className:"size-4 text-fg-muted"})}):s.jsx(as,{packet:e,variant:"avatar",size:"sm"})}),s.jsxs("div",{className:"flex-1 min-w-0 space-y-0.5",children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[E?s.jsx("span",{className:"font-medium text-[14px] text-fg-primary tracking-tight truncate min-w-0",children:A}):$?s.jsx("span",{className:"font-medium text-[14px] text-fg-primary tracking-tight truncate min-w-0",children:B}):s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"font-semibold text-[14px] text-fg-primary tracking-tight flex-shrink-0",children:P||"—"}),B&&s.jsx("span",{className:"text-[12px] text-fg-muted truncate min-w-0",children:B})]}),s.jsx("div",{className:"flex-1"}),s.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:rs(v),children:j}),s.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:rs(k),children:b}),p&&p>1&&s.jsxs("span",{className:"data-box data-box-compact flex-shrink-0",children:["×",p]}),s.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[s.jsx("span",{className:"type-data-xs text-fg-muted w-[28px] text-right",children:e.rssi}),s.jsx(xe,{rssi:e.rssi,compact:!0,showValues:!1,validated:me(e)})]})]}),s.jsxs("div",{className:"flex items-center gap-1 type-data-xs text-fg-muted",children:[s.jsx("span",{className:"data-box data-box-compact flex-shrink-0",children:y(e.timestamp)}),I>0&&s.jsxs("span",{children:[I,"B"]}),V>0&&s.jsxs("span",{className:V>1?"text-sys-amber/60":void 0,children:["LBT:",V]}),null!=e.snr&&s.jsxs("span",{children:[e.snr.toFixed(0),"dB"]}),L?s.jsxs("span",{className:"text-[11px] text-fg-secondary truncate flex items-center gap-1 min-w-0",children:[z&&s.jsx(ls,{channelName:z,compact:!0,onClick:u&&R?e=>{e.stopPropagation(),u(R)}:void 0}),s.jsx("span",{className:"italic truncate",children:L})]}):T>0?s.jsx(ns,{path:M,localHash:n}):null]})]})]})]})});function ms(e){if(e.contact_type){const s=e.contact_type.toLowerCase();if("repeater"===s||"rep"===s)return!0;if("companion"===s||"client"===s||"cli"===s)return!1;if("room server"===s||"room_server"===s||"room"===s||"server"===s)return!1}return!0===e.is_repeater||(e.is_repeater,!1)}const ps=a.lazy(()=>n(()=>import("./PathMapMapLibre-CQABb9bb.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])));function hs(e){return`${(100*e).toFixed(0)}%`}function us(e,s){const t=document.documentElement,a=getComputedStyle(t),n={success:a.getPropertyValue("--sys-green").trim()||"#39D98A",secondary:a.getPropertyValue("--sys-indigo").trim()||"#F9D26F",poor:a.getPropertyValue("--signal-poor").trim()||"#FF8A5C",danger:a.getPropertyValue("--sys-red").trim()||"#FF5C7A",muted:a.getPropertyValue("--text-muted").trim()||"#767688"};let l;return l=0===s?n.muted:e>=1?n.success:e>=.5?n.secondary:e>=.25?n.poor:e>0?n.danger:n.muted,{color:l}}class gs extends a.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?s.jsxs("div",{className:"h-[200px] flex items-center justify-center text-fg-muted",children:[s.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Map failed to load"]}):this.props.children}}function fs({path:e,neighbors:n,localNode:l,localHash:r,srcHash:i,dstHash:c,neighborAffinity:o,prefixLookup:d,hubNodes:x,traceSnr:m,advertiserSource:p}){const[h,u]=a.useState(null),g=a.useMemo(()=>{if(!p)return null;const e="wardrive"===p.nodeType;return{prefix:p.prefix||"??",candidates:[{hash:p.publicKey||p.prefix||"source",name:p.name,latitude:p.latitude,longitude:p.longitude,probability:1,isLocal:!1,isWardrive:e}],confidence:1,totalMatches:1,isSource:!0}},[p]),f=a.useMemo(()=>{if(p)return null;if(!i)return null;const e=k(i),s=n[i];if((null==s?void 0:s.latitude)&&(null==s?void 0:s.longitude)&&(0!==s.latitude||0!==s.longitude))return{prefix:e,candidates:[{hash:i,name:s.node_name||s.name||"Source",latitude:s.latitude,longitude:s.longitude,probability:1,isLocal:!1,isDirectNeighbor:!0===s.zero_hop}],confidence:1,totalMatches:1,isSource:!0};const t=(null==s?void 0:s.node_name)||(null==s?void 0:s.name)||i.slice(0,8);return{prefix:e,candidates:[{hash:i,name:t,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isSource:!0}},[p,i,n]),y=a.useMemo(()=>{const e=(null==c?void 0:c.startsWith("0x"))?c.slice(2):c;if((!e||"00"===e||"0000000000000000"===e)&&l&&r){const e=k(r),s=0!==l.latitude||0!==l.longitude;return{prefix:e,candidates:[{hash:r,name:l.name||"Local Node",latitude:s?l.latitude:0,longitude:s?l.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}if(!c)return null;const s=k(c);if(r&&c===r&&l){const e=0!==l.latitude||0!==l.longitude;return{prefix:s,candidates:[{hash:c,name:l.name||"Local Node",latitude:e?l.latitude:0,longitude:e?l.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}const t=n[c];if((null==t?void 0:t.latitude)&&(null==t?void 0:t.longitude)&&(0!==t.latitude||0!==t.longitude))return{prefix:s,candidates:[{hash:c,name:t.node_name||t.name||"Destination",latitude:t.latitude,longitude:t.longitude,probability:1,isLocal:!1,isDirectNeighbor:!0===t.zero_hop}],confidence:1,totalMatches:1,isDestination:!0};const a=(null==t?void 0:t.node_name)||(null==t?void 0:t.name)||c.slice(0,8);return{prefix:s,candidates:[{hash:c,name:a,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isDestination:!0}},[c,n,l,r]),j=a.useMemo(()=>function(e,s,t,a,n,l){if(!e||0===e.length)return{hops:[],overallConfidence:0,hasValidPath:!1};const r=e.length-1,i=e.map((i,c)=>{const o=c===r,d=e.length-c,{candidates:x,totalMatches:m}=function(e,s,t,a,n=!1,l,r,i){const c=function(e){const s={};for(const[t,a]of Object.entries(e))ms(a)&&(s[t]=a);return s}(s);let o;if(r){const s=function(e,s,t){const a=s.toUpperCase(),n=e.get(a);if(!n||0===n.candidates.length)return{hash:null,confidence:0};if(null==t?void 0:t.isLastHop)return{hash:n.bestMatch,confidence:n.confidence};if(1===(null==t?void 0:t.position))return{hash:n.bestMatch,confidence:n.confidence};if((null==t?void 0:t.position)&&n.bestMatchForPosition.has(t.position)){const e=n.bestMatchForPosition.get(t.position),s=Math.max(e.confidence,n.confidence);return{hash:e.hash,confidence:s}}if((null==t?void 0:t.adjacentPrefixes)&&t.adjacentPrefixes.length>0){let e=n.bestMatch,s=0;for(const a of n.candidates){let n=0;for(const e of t.adjacentPrefixes)n+=a.adjacentPrefixCounts.get(e.toUpperCase())||0;const l=a.combinedScore+n/Math.max(1,a.totalAdjacentObservations)*.3;l>s&&(s=l,e=a.hash)}return{hash:e,confidence:n.confidence}}return{hash:n.bestMatch,confidence:n.confidence}}(r,e,{position:i,isLastHop:n});o=s.confidence}const{matches:d,probability:x}=function(e,s,t,a,n=!1){const l=e.toUpperCase(),r=[],i=t&&v(l,t);i&&r.push(t);for(const p of Object.keys(s))v(l,p)&&r.push(p);if(n&&i&&t&&1===r.length)return{matches:r,probability:1,bestMatch:t};if(n&&i&&r.length>1){const e=r.filter(e=>e!==t);if(1===e.length)return{matches:r,probability:1,bestMatch:e[0]}}const c=r.length>0?1/r.length:0,o=[...r].sort();let d=null,x=-1;if(1===o.length)d=o[0];else if(o.length>1&&a){for(const e of o){const s=a.get(e),t=s?"number"==typeof s?s:s.combinedScore:0;t>x&&(x=t,d=e)}d||(d=o[0])}else o.length>0&&(d=o[0]);let m=c;if(r.length>1&&a&&x>0){let e=0;for(const s of r){const t=a.get(s);e+=t?"number"==typeof t?t:t.combinedScore:0}e>0&&(m=Math.min(.95,x/e))}return{matches:r,probability:m,bestMatch:d}}(e,c,a,l,n),m=d.length,p=[],h=e.toUpperCase(),u=t&&void 0!==t.latitude&&void 0!==t.longitude&&(0!==t.latitude||0!==t.longitude);for(const f of d){if(a&&v(h,a)&&f===a&&u&&t){p.push({hash:f,name:t.name||"Local Node",latitude:t.latitude,longitude:t.longitude,probability:n?1:x,isLocal:!0});continue}const e=c[f];(null==e?void 0:e.latitude)&&(null==e?void 0:e.longitude)&&(0!==e.latitude||0!==e.longitude)&&p.push({hash:f,name:e.node_name||e.name||"Unknown",latitude:e.latitude,longitude:e.longitude,probability:x,isLocal:!1,isDirectNeighbor:!0===e.zero_hop})}const g=p.length;if(1===g)p[0].probability=o??1;else if(g>1)if(void 0!==o&&o>0){p[0].probability=o;const e=1-o,s=g-1;p.slice(1).forEach(t=>{t.probability=e/s})}else{let e=0;const s=p.map(s=>{if(s.isLocal)return{candidate:s,score:1};const a=null==l?void 0:l.get(s.hash);let n=.5;var r;let i;return u&&t&&(n=(r=function(e,s,t,a){const n=(t-e)*Math.PI/180,l=(a-s)*Math.PI/180,r=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(t*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))*6371e3}(t.latitude,t.longitude,s.latitude,s.longitude))<100?1:r<500?.9:r<1e3?.7:r<5e3?.5:r<1e4?.3:.1),a?i=.3*n+.3*a.hopConsistencyScore+.4*a.frequencyScore:(i=n,s.isDirectNeighbor&&(i=Math.max(i,.8))),e+=i,{candidate:s,score:i}});if(e>0)s.forEach(({candidate:s,score:t})=>{s.probability=Math.min(.95,t/e)});else{const e=1/g;p.forEach(s=>s.probability=e)}}return{candidates:p,totalMatches:m}}(i,s,t,a,o,n,l,d),p=x.length>0?Math.max(...x.map(e=>e.probability)):0;return{prefix:i,candidates:x,confidence:p,totalMatches:m}}),c=i.reduce((e,s)=>0===s.confidence?0:e*s.confidence,1),o=i.some(e=>e.candidates.length>0);return{hops:i,overallConfidence:c,hasValidPath:o}}(e,n,l,r,o,d),[e,n,l,r,o,d]),b=a.useMemo(()=>{const e=[];g?e.push(g):f&&e.push(f),e.push(...j.hops),y&&e.push(y);const s=e.reduce((e,s)=>0===s.confidence?0:e*s.confidence,1),t=e.some(e=>e.candidates.some(e=>0!==e.latitude||0!==e.longitude));return{hops:e,overallConfidence:s,hasValidPath:t}},[g,f,j,y]);return b.hasValidPath?s.jsxs("div",{className:"h-full flex flex-col space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between text-xs",children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx("span",{className:"text-fg-muted",children:"Path Confidence:"}),s.jsx("span",{className:(N=b.overallConfidence,N>=1?"text-sys-green":N>=.5?"text-sys-indigo":N>=.25?"text-signal-poor":N>0?"text-sys-red":"text-fg-muted"),children:hs(b.overallConfidence)}),s.jsx("button",{className:"text-fg-muted hover:text-fg-secondary transition-colors",title:"Confidence is calculated based on how many known nodes match each path prefix. Multiple matches reduce confidence due to collision probability.",children:s.jsx(te,{className:"w-3 h-3"})})]}),s.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-sys-green"}),s.jsx("span",{className:"text-fg-muted",children:"Exact"})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-sys-indigo"}),s.jsx("span",{className:"text-fg-muted",children:"Multi"})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-fg-muted"}),s.jsx("span",{className:"text-fg-muted",children:"Unknown"})]})]})]}),s.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:s.jsx(gs,{children:s.jsx(a.Suspense,{fallback:s.jsx("div",{className:"h-full bg-elevated flex items-center justify-center text-fg-muted text-sm",children:"Loading map..."}),children:s.jsx(ps,{resolvedPath:b,localNode:l,hubNodes:x,hoveredHopIndex:h,onHoverHop:u,traceSnr:m})})})}),s.jsx("div",{className:"flex flex-wrap items-center gap-1.5",children:b.hops.map((e,a)=>{var n,l,r;const i=!0===e.isSource,c=!0===e.isDestination,o=h===a;let d;return d=i?`Source: ${(null==(n=e.candidates[0])?void 0:n.name)||"Unknown"}`:c?`Destination: ${(null==(l=e.candidates[0])?void 0:l.name)||"Unknown"}`:0===e.totalMatches?"No matching nodes found":1===e.totalMatches?`Exact match: ${(null==(r=e.candidates[0])?void 0:r.name)||"Unknown"}`:`${e.totalMatches} possible matches (${(100*e.confidence).toFixed(0)}% confidence)`,s.jsxs("div",{className:t("flex items-center gap-1 px-1.5 py-0.5 rounded type-data-xs cursor-pointer transition-all",o?"bg-sys-blue/20 ring-1 ring-sys-blue/50":"bg-elevated hover:bg-subtle",i&&"border border-sys-green/30",c&&"border border-sys-blue/30"),title:d,onMouseEnter:()=>u(a),onMouseLeave:()=>u(null),children:[i&&s.jsx("span",{className:"text-sys-green text-[8px] mr-0.5",children:"SRC"}),c&&s.jsx("span",{className:"text-sys-blue text-[8px] mr-0.5",children:"DST"}),s.jsx("span",{style:us(e.confidence,e.totalMatches),children:e.prefix}),!i&&!c&&e.totalMatches>1&&s.jsxs("span",{className:"text-fg-muted",children:["×",e.totalMatches]}),!i&&!c&&0===e.totalMatches&&s.jsx("span",{className:"text-fg-muted",children:"?"})]},a)})})]}):s.jsxs("div",{className:"flex items-center justify-center text-fg-muted text-xs py-4",children:[s.jsx(be,{className:"w-3.5 h-3.5 mr-1.5 opacity-50"}),"No location data available for path nodes"]});var N}function ys(e){return e.match(/.{1,2}/g)||[]}function js(e){return null!==e&&e.startsWith("payload:")}const bs=15,Ns="color-mix(in srgb, var(--elevated) 60%, var(--body))",vs="\n    inset 0 0 0 1px color-mix(in srgb, var(--fg-primary) 6%, transparent),\n    inset 0 1px 0 color-mix(in srgb, white 3%, transparent),\n    0 1px 2px color-mix(in srgb, black 5%, transparent)\n  ",ks=2,ws={type:"tween",duration:.25,ease:[.25,.1,.25,1]};function Cs(e,s){return e?`inset 0 0 0 ${ks}px ${N[s]}`:vs}function Ss(e,s){return e?s:`color-mix(in srgb, ${s} ${bs}%, transparent)`}function _s({segments:e,selectedSegment:t,onSegmentClick:n}){const[l,r]=a.useState(null),[i,c]=a.useState(null),o=e.some(e=>void 0!==e.id)&&n,d=[];for(const s of e){const e=ys(s.hex);for(const t of e)d.push({byte:t.toUpperCase(),color:s.color,id:s.id})}const x=[];for(let s=0;s<d.length;s+=16)x.push(d.slice(s,s+16));return s.jsx("div",{className:"space-y-1",children:x.map((e,a)=>{const d=e.length<16;return s.jsx("div",{className:"flex rounded-md overflow-hidden",children:e.map(({byte:a,color:x,id:m},p)=>{const h=p===e.length-1,u=d&&h,g=N[x],f=m?l===m:i===x,y=Boolean(m&&t===m),j=f||y;return s.jsx("span",{className:"w-[1.75rem] text-xs text-center py-0.5 font-mono select-text "+(o?"cursor-pointer":""),style:{backgroundColor:Ss(j,g),color:j?"rgba(255,255,255,0.95)":g,transition:j?"none":"background-color 0.15s ease-out, color 0.15s ease-out",touchAction:"manipulation",...u?{borderRadius:"0 0.375rem 0.375rem 0"}:{}},onMouseEnter:()=>{m?r(m):c(x)},onMouseLeave:()=>{r(null),c(null)},onClick:()=>m&&(null==n?void 0:n(m)),onTouchStart:()=>{m?r(m):c(x)},onTouchEnd:()=>{r(null),c(null)},children:a},p)})},a)})})}function Hs({rawHex:e,hexSegments:t,selectedSegment:n,onSegmentClick:l}){const[r,i]=a.useState(!1),c=a.useCallback(async()=>{try{await navigator.clipboard.writeText(e.toUpperCase()),i(!0),setTimeout(()=>i(!1),2e3)}catch(s){}},[e]);return s.jsxs("div",{className:"bg-black rounded-2xl p-6 relative",children:[s.jsx(_s,{segments:t,selectedSegment:n,onSegmentClick:l}),s.jsx("button",{onClick:c,className:"absolute bottom-3 right-3 flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg bg-subtle-fill-hover hover:bg-subtle-fill-strong text-fg-muted hover:text-fg-secondary transition-all text-xs font-sans",title:"Copy raw packet hex",children:r?s.jsxs(s.Fragment,{children:[s.jsx(H,{className:"w-3.5 h-3.5 text-sys-green"}),s.jsx("span",{className:"text-sys-green",children:"Copied"})]}):s.jsxs(s.Fragment,{children:[s.jsx(h,{className:"w-3.5 h-3.5"}),s.jsx("span",{children:"Copy"})]})})]})}function Ms({bits:e,field:t,value:a,binary:n}){return s.jsxs("tr",{children:[s.jsx("td",{className:"py-1.5 text-xs text-fg-muted tabular-nums",children:e}),s.jsx("td",{className:"py-1.5 text-sm text-fg-secondary",children:t}),s.jsx("td",{className:"py-1.5",children:(()=>{if("Payload Type"===t){const e=re[a]||"zinc";return s.jsx(u,{color:e,children:a})}if("Route Type"===t){const e=le[a]||"zinc";return s.jsx(u,{color:e,children:a})}return s.jsx("span",{className:"text-sm text-fg-primary",children:a})})()}),s.jsx("td",{className:"py-1.5 type-data-xs text-sys-cyan",children:n})]})}function Ts({id:e,title:t,color:a,hexBytes:n,startByte:l,endByte:r,isSelected:i,children:c}){const o=n?ys(n):[];return s.jsxs(S.div,{layout:"position",layoutId:e,transition:ws,className:"w-full min-w-0 overflow-hidden rounded-xl p-4 sm:p-5 space-y-4",style:{backgroundColor:Ns,boxShadow:Cs(i,a)},children:[s.jsxs("div",{className:"flex items-start justify-between gap-4",children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-0.5 min-w-0",children:[s.jsx(u,{color:a,children:t}),o.length>0&&o.length<=16&&o.map((e,t)=>s.jsx(u,{color:a,className:"font-mono",children:e.toUpperCase()},t))]}),s.jsxs("span",{className:"type-data-xs text-fg-muted flex-shrink-0",children:["Bytes ",l,"-",r]})]}),s.jsx("div",{className:"min-w-0 overflow-hidden",children:c})]})}function Ps({advert:e,timestamp:t}){const a=T(t||e.timestamp);return s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-indigo/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[s.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-indigo) 0%, var(--sys-blue) 100%)"},children:s.jsx(f,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:e.name||"Unknown Node"}),s.jsx("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:e.nodeType})]})]}),s.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),s.jsxs("div",{className:"px-4 py-3 space-y-2",children:[void 0!==e.latitude&&void 0!==e.longitude&&s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(be,{className:"w-4 h-4 text-sys-indigo flex-shrink-0"}),s.jsxs("span",{className:"text-sm text-fg-secondary font-mono",children:[e.latitude.toFixed(5),"°, ",e.longitude.toFixed(5),"°"]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(ae,{className:"w-4 h-4 text-sys-indigo flex-shrink-0"}),s.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:a})]})]})]})})}function Bs({decoded:e,timestamp:t}){const a=t?T(t):"Unknown";return s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-teal/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[s.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-teal) 0%, var(--sys-cyan) 100%)"},children:s.jsx(He,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:e.channelName||"Channel Data"}),s.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:[e.dataLength," bytes • ",e.decrypted?"Decrypted":"Encrypted"]})]})]}),s.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),s.jsxs("div",{className:"px-4 py-3 space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(we,{className:"w-4 h-4 text-sys-teal flex-shrink-0"}),s.jsxs("span",{className:"text-sm text-fg-secondary font-sans",children:["Channel: ",s.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(ae,{className:"w-4 h-4 text-sys-teal flex-shrink-0"}),s.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:a})]}),e.decrypted&&e.decryptedHex&&s.jsxs("div",{className:"mt-2 pt-2 border-t border-edge-subtle",children:[s.jsx("p",{className:"type-micro text-fg-muted mb-1 font-sans",children:"Decrypted Data"}),s.jsx("div",{className:"max-w-full overflow-x-auto",children:s.jsx(ve,{size:"compact",copy:!0,className:"inline-block",children:s.jsx("span",{className:"break-all text-xs",children:e.decryptedHex.toUpperCase()})})})]})]})]})})}function Fs({decoded:e,timestamp:t,isLoading:n=!1,onDecrypted:l}){const r=t?T(t):"Unknown",[i,c]=a.useState(""),[o,d]=a.useState(!1),[x,m]=a.useState(null),[h,u]=a.useState(!1),g=a.useCallback(async()=>{if(i.trim()&&e.ciphertextHex&&e.macHex){d(!0),m(null);try{const s=parseInt(e.channelHash,16),t=p(e.macHex),a=p(e.ciphertextHex),n=await P(i.trim(),s,t,a);if(n.success){const s=n.result.plaintext,t=new TextDecoder("utf-8",{fatal:!1}).decode(s.slice(5)),a=t.indexOf(": "),r={...e,channelName:n.result.channelName,decrypted:!0,timestamp:s[0]|s[1]<<8|s[2]<<16|s[3]<<24,flags:s[4],senderName:a>0?t.slice(0,a):void 0,text:a>0?t.slice(a+2):t};null==l||l(r),c(""),u(!1)}else m(n.error)}catch(s){m(s instanceof Error?s.message:"Unknown error")}finally{d(!1)}}},[i,e,l]);return n?s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-xl p-4 sm:p-5",style:{backgroundColor:"color-mix(in srgb, var(--elevated) 60%, var(--body))",boxShadow:"\n              inset 0 0 0 1px color-mix(in srgb, var(--fg-primary) 6%, transparent),\n              inset 0 1px 0 color-mix(in srgb, white 3%, transparent),\n              0 1px 2px color-mix(in srgb, black 5%, transparent)\n            "},children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3 h-[15px]",children:[s.jsx("div",{className:"h-2.5 w-12 rounded bg-subtle-fill-hover animate-pulse"}),s.jsx("div",{className:"h-2.5 w-16 rounded bg-subtle-fill-hover animate-pulse"})]}),s.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tl-md",style:{background:"color-mix(in srgb, var(--sys-blue) 30%, transparent)"},children:s.jsxs("div",{className:"space-y-1.5",children:[s.jsx("div",{className:"h-3.5 w-48 rounded bg-subtle-fill-strong animate-pulse"}),s.jsx("div",{className:"h-3.5 w-32 rounded bg-subtle-fill-strong animate-pulse"})]})})]})}):e.decrypted?s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-xl p-4 sm:p-5",style:{backgroundColor:"color-mix(in srgb, var(--elevated) 60%, var(--body))",boxShadow:"\n              inset 0 0 0 1px color-mix(in srgb, var(--fg-primary) 6%, transparent),\n              inset 0 1px 0 color-mix(in srgb, white 3%, transparent),\n              0 1px 2px color-mix(in srgb, black 5%, transparent)\n            "},children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.senderName&&s.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:["From ",s.jsx("span",{className:"text-fg-secondary font-medium",children:e.senderName})]}),e.channelName&&s.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:["in ",s.jsx("span",{className:"text-sys-cyan font-medium",children:e.channelName})]})]}),s.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tl-md",style:{background:"linear-gradient(135deg, var(--sys-blue) 0%, color-mix(in srgb, var(--sys-blue) 85%, var(--sys-cyan)) 100%)"},children:s.jsx("p",{className:"text-sm text-white font-sans leading-relaxed whitespace-pre-wrap break-words",children:e.text})})]})}):s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-2xl overflow-hidden bg-zinc-500/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[s.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--zinc-500) 0%, color-mix(in srgb, var(--zinc-500) 70%, black) 100%)"},children:s.jsx(Fe,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:e.isPublicHashChannel?"Public Hash Channel":"Encrypted Message"}),s.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:["Channel hash: ",s.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]})]})]}),s.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),s.jsxs("div",{className:"px-4 py-3 space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(ae,{className:"w-4 h-4 text-zinc-400 flex-shrink-0"}),s.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:r})]}),e.ciphertextHex&&e.macHex&&s.jsx("div",{className:"space-y-2",children:h?s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:i,onChange:e=>c(e.target.value),placeholder:"Channel name (e.g. south-bay)",className:"flex-1 px-3 py-1.5 text-sm rounded-lg bg-subtle-fill-strong border border-edge-subtle text-fg-primary placeholder:text-fg-muted focus:outline-none focus:border-zinc-500",onKeyDown:e=>"Enter"===e.key&&g(),disabled:o}),s.jsx("button",{onClick:g,disabled:o||!i.trim(),className:"px-3 py-1.5 text-sm font-medium rounded-lg bg-zinc-600 hover:bg-zinc-500 text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:o?"Testing...":"Try"}),s.jsx("button",{onClick:()=>{u(!1),m(null),c("")},className:"px-2 py-1.5 text-sm rounded-lg hover:bg-subtle-fill-strong text-fg-muted transition-colors",children:"×"})]}),x&&s.jsx("p",{className:"text-xs text-sys-red",children:x})]}):s.jsx("button",{onClick:()=>u(!0),className:"text-xs text-zinc-400 hover:text-zinc-300 underline underline-offset-2 transition-colors",children:"Know the channel name? Try to decrypt"})}),!h&&s.jsx("p",{className:"text-xs text-fg-muted",children:e.isPublicHashChannel?"Public hash channel message. Key not in common channel list.":"Unknown hash channel. Channel name required for decryption."})]})]})})}function Ls({decoded:e,timestamp:t}){const a=t?T(t):"Unknown";return s.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:"linear-gradient(135deg, var(--sys-green) 0%, var(--sys-teal) 100%)"},children:s.jsx(_e,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-semibold text-fg-primary font-sans",children:"Acknowledgment"}),s.jsxs("p",{className:"text-xs text-fg-muted font-sans mt-0.5",children:["CRC: ",s.jsxs("span",{className:"font-mono text-sys-green",children:["0x",e.crc]})," · ",a]})]})]})}function Ds({decoded:e,timestamp:t}){const a=t?T(t):"Unknown",n=e.path.length;return s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-amber/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[s.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-amber) 0%, var(--sys-orange) 100%)"},children:s.jsx(Ce,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:"Path Response"}),s.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:[n," ",1===n?"hop":"hops"]})]})]}),s.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),s.jsxs("div",{className:"px-4 py-3 space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(ae,{className:"w-4 h-4 text-sys-amber flex-shrink-0"}),s.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:a})]}),e.path.length>0&&s.jsx("div",{className:"mt-2 pt-2 border-t border-edge-subtle",children:s.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.path.map((e,t)=>s.jsxs("div",{className:"flex items-center gap-2",children:[t>0&&s.jsx(de,{className:"w-4 h-4 text-sys-amber"}),s.jsx(u,{color:"amber",className:"font-mono",children:e})]},t))})})]})]})})}function zs({decoded:e,timestamp:t}){const a=t?T(t):"Unknown",n=e.pathHashes.length,l=e.snrValues.length;return s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-blue/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[s.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-blue) 0%, var(--sys-indigo) 100%)"},children:s.jsx(Se,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:["Trace ",e.isComplete?"Complete":"In Progress"]}),s.jsxs("p",{className:"text-sm text-fg-muted mt-0.5",children:["Tag: 0x",e.traceTag.slice(0,8),e.isComplete&&" • ✓"]})]})]}),s.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),s.jsxs("div",{className:"px-4 py-3 space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(ae,{className:"w-4 h-4 text-sys-blue flex-shrink-0"}),s.jsx("span",{className:"text-sm text-fg-secondary",children:a})]}),s.jsxs("div",{className:"flex items-center gap-4 text-xs text-fg-muted",children:[s.jsxs("span",{children:[n," target ",1===n?"hop":"hops"]}),s.jsx("span",{children:"•"}),s.jsxs("span",{children:[l," SNR ",1===l?"sample":"samples"]}),0!==e.authCode&&s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"•"}),s.jsxs("span",{children:["Auth: ",e.authCode]})]})]}),e.pathHashes.length>0&&s.jsx("div",{className:"flex flex-wrap items-center gap-2 pt-1",children:e.pathHashes.map((t,a)=>{const n=e.snrValues[a],l=void 0!==n?(e=>e>=7?"green":e>=0?"yellow":e>=-5?"orange":"red")(n):"zinc",r=void 0!==n;return s.jsxs("div",{className:"flex items-center gap-2",children:[a>0&&s.jsx(de,{className:"w-4 h-4 text-sys-blue flex-shrink-0"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(u,{color:r?"blue":"zinc",className:"font-mono",children:t}),r&&s.jsxs(u,{color:l,className:"font-mono",children:[n>=0?"+":"",Number.isInteger(n)?n:n.toFixed(1),"dB"]})]})]},a)})})]})]})})}function Rs({decoded:e,timestamp:t}){const a=t?T(t):"Unknown";return e.encrypted?s.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:"linear-gradient(135deg, var(--sys-indigo) 0%, var(--sys-blue) 100%)"},children:s.jsx(Fe,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-semibold text-fg-primary font-sans",children:"Encrypted Message"}),s.jsxs("p",{className:"text-xs text-fg-muted font-sans mt-0.5",children:[e.srcHash," → ",e.destHash," · ",a]})]})]}):s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1.5 px-1",children:[s.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:[s.jsx("span",{className:"font-mono text-fg-secondary",children:e.srcHash})," → ",s.jsx("span",{className:"font-mono text-fg-secondary",children:e.destHash})]}),s.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:["· ",a]})]}),s.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tr-md ml-auto",style:{background:"linear-gradient(135deg, var(--sys-green) 0%, var(--sys-teal) 100%)"},children:s.jsx("p",{className:"text-sm text-white font-sans leading-relaxed whitespace-pre-wrap break-words",children:e.text})})]})}function As({decoded:e,timestamp:t}){const a=t?T(t):"Unknown",n=(e.partNumber+1)/e.totalParts*100;return s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-yellow/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[s.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-yellow) 0%, var(--sys-amber) 100%)"},children:s.jsx(ke,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:"Multipart Segment"}),s.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:["Part ",e.partNumber+1," of ",e.totalParts]})]})]}),s.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),s.jsxs("div",{className:"px-4 py-3 space-y-3",children:[s.jsx("div",{children:s.jsx("div",{className:"h-2 bg-subtle-fill-strong rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${n}%`,background:"linear-gradient(90deg, var(--sys-yellow), var(--sys-amber))"}})})}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(we,{className:"w-4 h-4 text-sys-yellow flex-shrink-0"}),s.jsxs("span",{className:"text-sm text-fg-secondary font-sans",children:["Message ID: ",s.jsx("span",{className:"font-mono",children:e.messageId})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(ae,{className:"w-4 h-4 text-sys-yellow flex-shrink-0"}),s.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:a})]})]})]})})}function Es({decoded:e,timestamp:t,payloadType:a}){const n=t?T(t):"Unknown",l=(()=>{switch(a){case _.REQ:return{icon:B,gradient:"var(--sys-orange), var(--sys-red)",bg:"rgba(249, 115, 22, 0.15)",label:"Request"};case _.RESPONSE:return{icon:De,gradient:"var(--sys-green), var(--sys-teal)",bg:"rgba(34, 197, 94, 0.15)",label:"Response"};case _.ANON_REQ:return{icon:Fe,gradient:"var(--sys-indigo), var(--sys-pink)",bg:"rgba(91, 91, 214, 0.15)",label:"Anonymous Request"};default:return{icon:pe,gradient:"var(--sys-gray), var(--sys-slate)",bg:"rgba(107, 114, 128, 0.15)",label:e.payloadTypeName}}})(),r=l.icon;return s.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:`linear-gradient(135deg, ${l.gradient})`},children:s.jsx(r,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-semibold text-fg-primary font-sans",children:l.label}),s.jsxs("p",{className:"text-xs text-fg-muted font-sans mt-0.5",children:[e.length," bytes · ",n]})]})]})}function $s({pathHex:e}){if(!e)return null;const t=ys(e);return s.jsx("div",{className:"flex flex-wrap items-center gap-2 py-2",children:t.map((e,t)=>s.jsxs("div",{className:"flex items-center gap-2",children:[t>0&&s.jsx(de,{className:"w-4 h-4 text-sys-amber flex-shrink-0"}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(ve,{size:"compact",copy:!0,children:e.toUpperCase()}),s.jsx("span",{className:"text-xs text-fg-muted font-sans tabular-nums w-4 text-left",children:t+1})]})]},t))})}function Us({decoded:e,payloadType:t}){const a=M[t]||`TYPE_${t}`;switch(e.type){case"advert":{const t="chat"===e.nodeType?"companion":e.nodeType.replace("_"," "),a=void 0!==e.latitude&&void 0!==e.longitude&&!(0===e.latitude&&0===e.longitude);return s.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Role:"})," ",t]}),e.name&&s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Name:"})," ",e.name]}),a&&s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Location:"})," ",e.latitude.toFixed(4),"°, ",e.longitude.toFixed(4),"°"]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Time:"})," ",T(e.timestamp)]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Flags:"})," ",e.flagsDescription]})]})}case"ack":return s.jsx("div",{className:"text-xs text-fg-primary space-y-0.5",children:s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"CRC:"})," 0x",e.crc]})});case"path":return s.jsx("div",{className:"text-xs text-fg-primary space-y-1",children:s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Path:"})," ",e.pathString||"(empty)"]})});case"trace":return s.jsxs("div",{className:"text-xs text-fg-primary space-y-1",children:[s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Tag:"})," 0x",e.traceTag]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Target Path:"})," ",e.pathString||"(empty)"]}),e.snrValues.length>0&&s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"SNR:"})," ",e.snrValues.map(e=>`${e>=0?"+":""}${Number.isInteger(e)?e:e.toFixed(1)}dB`).join(" → ")]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Status:"})," ",e.isComplete?"✓ Complete":`In progress (${e.snrValues.length}/${e.pathHashes.length})`]})]});case"txt_msg":return s.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Dest:"})," ",e.destHash]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Src:"})," ",e.srcHash]}),e.encrypted?s.jsx("p",{className:"text-fg-muted italic",children:"Encrypted content"}):s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Text:"})," ",e.text]})]});case"grp_txt":return s.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Channel:"})," ",e.channelName?s.jsx("span",{className:"text-sys-green",children:e.channelName}):e.isPublicHashChannel?s.jsx("span",{className:"text-sys-indigo",children:"Public Hash Channel"}):s.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]}),e.decrypted?s.jsxs(s.Fragment,{children:[e.senderName&&s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"From:"})," ",e.senderName]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Text:"})," ",e.text]})]}):e.isPublicHashChannel?s.jsx("p",{className:"text-fg-muted italic",children:"Encrypted (public hash channel)"}):s.jsx("p",{className:"text-fg-muted italic",children:"Encrypted (unknown channel)"})]});case"grp_data":return s.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Channel:"})," ",e.channelName?s.jsx("span",{className:"text-sys-teal",children:e.channelName}):s.jsxs("span",{className:"font-mono",children:["0x",e.channelHash]})]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Data:"})," ",e.dataLength," bytes ",e.decrypted?"(decrypted)":"(encrypted)"]})]});case"multipart":return s.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Part:"})," ",e.partNumber+1,"/",e.totalParts]}),s.jsxs("p",{children:[s.jsx("span",{className:"text-fg-muted",children:"Message ID:"})," ",e.messageId]})]});default:return s.jsxs("p",{className:"text-xs text-fg-secondary",children:[a," (",e.length," bytes)"]})}}const Is=a.memo(function({packet:e,decodedGrpTxt:t}){var n,l;const r=e.raw_packet||"",i=r.length/2,c=w(),[o,d]=a.useState(null),[p,h]=a.useState(null),[g,f]=a.useState(!1),[y,j]=a.useState(null),b=a.useCallback(e=>{j(s=>s===e?null:e)},[]),N=a.useMemo(()=>function(e){if(!e||e.length<4)return null;const s=q.fromHex(e);if(!s.success||!s.packet)return null;const t=s.packet,a=function(e){const s=3&e,t=e>>2&15,a=e>>6&3;return[{bits:"0-1",field:"Route Type",value:x(s),binary:(3&s).toString(2).padStart(2,"0")},{bits:"2-5",field:"Payload Type",value:m(t),binary:(15&t).toString(2).padStart(4,"0")},{bits:"6-7",field:"Version",value:a.toString(),binary:(3&a).toString(2).padStart(2,"0")}]}(t.header),n=e.slice(0,2);let l=2,r="";t.hasTransportCodes()&&(r=e.slice(2,10),l=10);const i=e.slice(l,l+2),c=l+2,o=c+2*t.pathLen,d=e.slice(c,o),p=e.slice(o),h=K(t);return{packet:t,headerHex:n,headerFields:a,transportCodesHex:r,pathLengthHex:i,pathDataHex:d,payloadHex:p,payloadStartByte:Math.floor(o/2),decoded:h}}(r),[r]),v=null==(n=null==N?void 0:N.packet)?void 0:n.payloadType,k=(null==N?void 0:N.payloadHex)||"",H=null==(l=null==N?void 0:N.packet)?void 0:l.payload,M=v===_.GRP_TXT,P=v===_.GRP_DATA,B=M&&!t&&(!c||g);if(a.useEffect(()=>{if(d(null),f(!1),t)return;if(!M||!H||H.length<4)return;if(!c)return void f(!0);f(!0);let e=!1;return J(H).then(s=>{e||(d(s),f(!1))}),()=>{e=!0}},[k,M,c,t]),a.useEffect(()=>{if(h(null),!P||!H||H.length<4)return;if(!c)return;let e=!1;return Z(H).then(s=>{e||h(s)}),()=>{e=!0}},[k,P,c]),!N||0===r.length)return s.jsx("div",{className:"p-4 text-center text-fg-muted",children:s.jsx("p",{className:"text-sm",children:"No raw packet data available"})});const{packet:F}=N;let L=N.decoded;t&&"grp_txt"===N.decoded.type?L=t:o&&"grp_txt"===N.decoded.type?L=o:p&&"grp_data"===N.decoded.type&&(L=p);const D=a.useMemo(()=>function(e,t){switch(e.type){case"advert":return function(e,t){const a=[];let n=0;const l=t.slice(0,64);a.push({id:"payload:publicKey",title:"Public Key",color:"pink",hex:l,startByte:n,endByte:n+31,decoded:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:e.publicKey.toUpperCase()}),s.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Ed25519 public key (32 bytes)"})]})}),n+=32;const r=t.slice(64,72);a.push({id:"payload:timestamp",title:"Timestamp",color:"orange",hex:r,startByte:n,endByte:n+3,decoded:s.jsxs(s.Fragment,{children:[s.jsx(ve,{size:"standard",copy:!0,children:r.toUpperCase()}),s.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:[e.timestamp," (",T(e.timestamp),")"]})]})}),n+=4;const i=t.slice(72,200);a.push({id:"payload:signature",title:"Signature",color:"teal",hex:i,startByte:n,endByte:n+63,decoded:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:e.signature.toUpperCase()}),s.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Ed25519 signature (64 bytes)"})]})}),n+=64;const c=t.slice(200,202);if(a.push({id:"payload:flags",title:"Flags",color:"blue",hex:c,startByte:n,endByte:n,decoded:s.jsxs(s.Fragment,{children:[s.jsxs(ve,{size:"standard",copy:!0,children:["0x",e.flags.toString(16).padStart(2,"0").toUpperCase()]}),s.jsx("p",{className:"text-xs text-fg-primary mt-1",children:e.flagsDescription}),s.jsxs("p",{className:"text-xs text-fg-muted",children:["Node Type: ",e.nodeType]})]})}),n+=1,void 0!==e.latitude){const l=t.slice(2*n,2*n+8);a.push({id:"payload:latitude",title:"Latitude",color:"green",hex:l,startByte:n,endByte:n+3,decoded:s.jsxs(s.Fragment,{children:[s.jsx(ve,{size:"standard",copy:!0,children:l.toUpperCase()}),s.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:[e.latitude.toFixed(6),"°"]})]})}),n+=4}if(void 0!==e.longitude){const l=t.slice(2*n,2*n+8);a.push({id:"payload:longitude",title:"Longitude",color:"indigo",hex:l,startByte:n,endByte:n+3,decoded:s.jsxs(s.Fragment,{children:[s.jsx(ve,{size:"standard",copy:!0,children:l.toUpperCase()}),s.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:[e.longitude.toFixed(6),"°"]})]})}),n+=4}if(e.name){const l=t.slice(2*n),r=l.length/2;a.push({id:"payload:name",title:"Name",color:"amber",hex:l,startByte:n,endByte:n+r-1,decoded:s.jsxs(s.Fragment,{children:[s.jsx(ve,{size:"standard",copy:!0,children:l.toUpperCase()}),s.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:['"',e.name,'"']})]})})}return a}(e,t);case"ack":return function(e,t){return[{id:"payload:crc",title:"CRC",color:"green",hex:t.slice(0,8),startByte:0,endByte:3,decoded:s.jsxs(s.Fragment,{children:[s.jsxs(ve,{size:"standard",copy:!0,children:["0x",e.crc]}),s.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"CRC32 of acknowledged packet"})]})}]}(e,t);case"grp_txt":return function(e,t){const a=[];a.push({id:"payload:channelHash",title:"Channel Hash",color:"blue",hex:t.slice(0,2),startByte:0,endByte:0,decoded:s.jsxs(s.Fragment,{children:[s.jsxs(ve,{size:"standard",copy:!0,children:["0x",e.channelHash]}),e.channelName&&s.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:["Channel: ",e.channelName]})]})}),e.macHex&&a.push({id:"payload:mac",title:"MAC",color:"indigo",hex:t.slice(2,6),startByte:1,endByte:2,decoded:s.jsxs(s.Fragment,{children:[s.jsx(ve,{size:"standard",copy:!0,children:e.macHex.toUpperCase()}),s.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Truncated HMAC-SHA256"})]})});const n=t.slice(6);return n&&a.push({id:"payload:ciphertext",title:e.decrypted?"Message":"Ciphertext",color:e.decrypted?"green":"zinc",hex:n,startByte:3,endByte:3+n.length/2-1,decoded:e.decrypted?s.jsxs(s.Fragment,{children:[s.jsxs("p",{className:"text-sm text-fg-primary",children:['"',e.text,'"']}),e.senderName&&s.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:["From: ",e.senderName]})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:n.toUpperCase()}),s.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"AES-128-ECB encrypted"})]})}),a}(e,t);case"grp_data":return function(e,t){const a=[];a.push({id:"payload:channelHash",title:"Channel Hash",color:"blue",hex:t.slice(0,2),startByte:0,endByte:0,decoded:s.jsxs(s.Fragment,{children:[s.jsxs(ve,{size:"standard",copy:!0,children:["0x",e.channelHash]}),e.channelName&&s.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:["Channel: ",e.channelName]})]})}),e.macHex&&a.push({id:"payload:mac",title:"MAC",color:"indigo",hex:t.slice(2,6),startByte:1,endByte:2,decoded:s.jsxs(s.Fragment,{children:[s.jsx(ve,{size:"standard",copy:!0,children:e.macHex.toUpperCase()}),s.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Truncated HMAC-SHA256"})]})});const n=t.slice(6);return n&&a.push({id:"payload:ciphertext",title:e.decrypted?"Decrypted Data":"Encrypted Data",color:e.decrypted?"green":"zinc",hex:n,startByte:3,endByte:3+n.length/2-1,decoded:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:(e.decryptedHex||n).toUpperCase()}),s.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[e.dataLength," bytes",e.decrypted?"":" (AES-128-ECB encrypted)"]})]})}),a}(e,t);case"path":return function(e,t){return[{id:"payload:path",title:"Path Hops",color:"amber",hex:t,startByte:0,endByte:t.length/2-1,decoded:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex flex-wrap items-center gap-1",children:e.path.map((e,t)=>s.jsxs("span",{className:"flex items-center gap-1",children:[t>0&&s.jsx(de,{className:"w-3 h-3 text-fg-muted"}),s.jsx(u,{color:"amber",className:"font-mono",children:e})]},t))}),s.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[e.path.length," hops"]})]})}]}(e,t);case"trace":return function(e,t){const a=[];a.push({id:"payload:crc",title:"Trace Tag",color:"blue",hex:t.slice(0,8),startByte:0,endByte:3,decoded:s.jsxs(s.Fragment,{children:[s.jsxs(ve,{size:"standard",copy:!0,children:["0x",e.traceTag]}),s.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Unique trace request identifier"})]})}),a.push({id:"payload:mac",title:"Auth Code",color:"indigo",hex:t.slice(8,16),startByte:4,endByte:7,decoded:s.jsxs(s.Fragment,{children:[s.jsx(ve,{size:"standard",copy:!0,children:e.authCode}),s.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Authentication/verification code"})]})}),a.push({id:"payload:flags",title:"Flags",color:"amber",hex:t.slice(16,18),startByte:8,endByte:8,decoded:s.jsxs(s.Fragment,{children:[s.jsxs(ve,{size:"standard",copy:!0,children:["0x",e.flags.toString(16).toUpperCase().padStart(2,"0")]}),s.jsx("p",{className:"text-xs text-fg-muted mt-1",children:0===e.flags?"No flags set":`Flags: ${e.flags.toString(2).padStart(8,"0")}b`})]})});const n=t.slice(18);if(n){const t=e=>e>=7?"green":e>=0?"yellow":e>=-5?"orange":"red";a.push({id:"payload:path",title:"Target Path",color:"indigo",hex:n,startByte:9,endByte:9+n.length/2-1,decoded:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex flex-wrap items-center gap-1",children:e.pathHashes.map((a,n)=>{const l=e.snrValues[n],r=void 0!==l?t(l):"zinc";return s.jsxs("span",{className:"flex items-center gap-1",children:[n>0&&s.jsx(de,{className:"w-3 h-3 text-fg-muted"}),s.jsx(u,{color:"indigo",className:"font-mono",children:a}),void 0!==l&&s.jsxs(u,{color:r,className:"font-mono",children:[l>=0?"+":"",Number.isInteger(l)?l:l.toFixed(1),"dB"]})]},n)})}),s.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[e.pathHashes.length," target ",1===e.pathHashes.length?"hop":"hops",e.snrValues.length>0&&` • ${e.snrValues.length} SNR ${1===e.snrValues.length?"value":"values"} collected`,e.isComplete&&" • ✓ Complete"]})]})})}return a}(e,t);case"multipart":return function(e,t){const a=[];a.push({id:"payload:msgId",title:"Message ID",color:"blue",hex:t.slice(0,4),startByte:0,endByte:1,decoded:s.jsxs(s.Fragment,{children:[s.jsx(ve,{size:"standard",copy:!0,children:e.messageId.toUpperCase()}),s.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Unique message identifier"})]})}),a.push({id:"payload:partNum",title:"Part Number",color:"amber",hex:t.slice(4,6),startByte:2,endByte:2,decoded:s.jsxs(s.Fragment,{children:[s.jsx(ve,{size:"standard",copy:!0,children:e.partNumber}),s.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"0-indexed part number"})]})}),a.push({id:"payload:totalParts",title:"Total Parts",color:"orange",hex:t.slice(6,8),startByte:3,endByte:3,decoded:s.jsxs(s.Fragment,{children:[s.jsx(ve,{size:"standard",copy:!0,children:e.totalParts}),s.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:["Part ",e.partNumber+1," of ",e.totalParts]})]})});const n=t.slice(8);return n&&a.push({id:"payload:partData",title:"Part Data",color:"cyan",hex:n,startByte:4,endByte:4+n.length/2-1,decoded:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:n.toUpperCase()}),s.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[n.length/2," bytes"]})]})}),a}(e,t);default:return[{id:"payload:ciphertext",title:"Raw Data",color:"zinc",hex:t,startByte:0,endByte:t.length/2-1,decoded:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:t.toUpperCase()}),s.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[t.length/2," bytes"]})]})}]}}(L,N.payloadHex),[L,N.payloadHex]),z="payload"===y||js(y),R=a.useMemo(()=>{const e=[{id:"header",hex:N.headerHex,color:"red"},...N.transportCodesHex?[{id:"transportCodes",hex:N.transportCodesHex,color:"indigo"}]:[],{id:"pathLength",hex:N.pathLengthHex,color:"green"},...N.pathDataHex?[{id:"pathData",hex:N.pathDataHex,color:"amber"}]:[]];return z?[...e,...(s=D,s.map(e=>({id:e.id,hex:e.hex,color:e.color})))]:[...e,{id:"payload",hex:N.payloadHex,color:"cyan"}];var s},[N,z,D]);return s.jsxs("div",{className:"font-mono space-y-2 min-w-0 overflow-hidden",children:[(()=>{switch(L.type){case"advert":return s.jsx(Ps,{advert:L,timestamp:e.timestamp});case"grp_data":return s.jsx(Bs,{decoded:L,timestamp:e.timestamp});case"grp_txt":return s.jsx(Fs,{decoded:L,timestamp:e.timestamp,isLoading:B,onDecrypted:d});case"ack":return s.jsx(Ls,{decoded:L,timestamp:e.timestamp});case"path":return s.jsx(Ds,{decoded:L,timestamp:e.timestamp});case"trace":return s.jsx(zs,{decoded:L,timestamp:e.timestamp});case"txt_msg":return s.jsx(Rs,{decoded:L,timestamp:e.timestamp});case"multipart":return s.jsx(As,{decoded:L,timestamp:e.timestamp});case"generic":return F.payloadType===_.REQ||F.payloadType===_.RESPONSE||F.payloadType===_.ANON_REQ?s.jsx(Es,{decoded:L,timestamp:e.timestamp,payloadType:F.payloadType}):null;default:return null}})(),s.jsx(Hs,{rawHex:r,hexSegments:R,selectedSegment:y,onSegmentClick:b}),s.jsx(C,{children:s.jsx(S.div,{layout:!0,transition:ws,className:"space-y-2 min-w-0",children:(()=>{var e,t,a,n;const l=[{id:"header",title:"Header",color:"red",startByte:0,endByte:0,hexBytes:`0x${N.headerHex.toUpperCase()}`,condition:!0,content:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"type-micro text-fg-muted border-b border-edge-subtle font-sans",children:[s.jsx("th",{className:"py-1 font-medium",children:"Bits"}),s.jsx("th",{className:"py-1 font-medium",children:"Field"}),s.jsx("th",{className:"py-1 font-medium",children:"Value"}),s.jsx("th",{className:"py-1 font-medium",children:"Binary"})]})}),s.jsx("tbody",{children:N.headerFields.map(e=>s.jsx(Ms,{...e},e.bits))})]})},{id:"transportCodes",title:"Transport Codes",color:"indigo",startByte:1,endByte:4,hexBytes:(null==(e=N.transportCodesHex)?void 0:e.toUpperCase())||"",condition:!!N.transportCodesHex,content:s.jsxs(s.Fragment,{children:[s.jsx("p",{className:"text-xs text-fg-muted",children:"Two 16-bit transport codes for encrypted routing"}),s.jsxs("div",{className:"mt-1 text-xs text-fg-secondary",children:["Code 1: 0x",null==(t=N.transportCodesHex)?void 0:t.slice(0,4).toUpperCase()," | Code 2: 0x",null==(a=N.transportCodesHex)?void 0:a.slice(4,8).toUpperCase()]})]})},{id:"pathLength",title:"Path Length",color:"green",startByte:N.transportCodesHex?5:1,endByte:N.transportCodesHex?5:1,hexBytes:`0x${N.pathLengthHex.toUpperCase()}`,condition:!0,content:s.jsxs("p",{className:"text-xs text-fg-muted pt-1",children:[F.pathLen," bytes showing route taken (increases as packet floods)"]})},{id:"pathData",title:"Path Data",color:"amber",startByte:N.transportCodesHex?6:2,endByte:(N.transportCodesHex?5:1)+F.pathLen,hexBytes:(null==(n=N.pathDataHex)?void 0:n.toUpperCase())||"",condition:F.pathLen>0,content:s.jsxs("div",{className:"space-y-3",children:[s.jsx($s,{pathHex:N.pathDataHex}),s.jsx("p",{className:"text-xs text-fg-muted",children:"Historical route taken (bytes are added as packet floods through network)"})]})},{id:"payload",title:"Payload",color:"cyan",startByte:N.payloadStartByte,endByte:i-1,hexBytes:N.payloadHex.toUpperCase(),condition:!0,content:s.jsxs(s.Fragment,{children:[!js(y)&&s.jsxs("div",{className:"p-3 rounded-lg bg-black",children:[s.jsx("p",{className:"type-micro text-fg-muted mb-1.5 font-sans",children:"Decoded"}),s.jsx(Us,{decoded:L,payloadType:F.payloadType})]}),!js(y)&&D.length>0&&s.jsx("p",{className:"type-micro text-fg-muted mt-3 font-sans",children:"Click a field below to highlight its bytes"}),js(y)&&s.jsx("p",{className:"type-micro text-fg-muted font-sans",children:"↑ Selected field above • Other fields below ↓"})]})}].filter(e=>e.condition),r=js(y)?D.find(e=>e.id===y):null,c=js(y)?[...l].sort((e,s)=>"payload"===e.id?-1:"payload"===s.id?1:0):[...l].sort((e,s)=>e.id===y?-1:s.id===y?1:0),o=js(y)?D.filter(e=>e.id!==y):[];return s.jsxs(s.Fragment,{children:[r&&s.jsx(Ts,{id:`subfield-${r.id}`,title:r.title,color:r.color,startByte:N.payloadStartByte+r.startByte,endByte:N.payloadStartByte+r.endByte,hexBytes:r.hex.toUpperCase(),isSelected:!0,children:r.decoded},r.id),c.map(e=>s.jsx(Ts,{id:`section-${e.id}`,title:e.title,color:e.color,startByte:e.startByte,endByte:e.endByte,hexBytes:e.hexBytes,isSelected:e.id===y,children:e.content},e.id)),o.map(e=>s.jsxs(S.div,{layout:"position",layoutId:`subfield-${e.id}`,transition:ws,className:"w-full min-w-0 overflow-hidden rounded-xl p-4 sm:p-5 space-y-4",style:{backgroundColor:Ns,boxShadow:vs},children:[s.jsxs("div",{className:"flex items-start justify-between gap-4",children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-0.5 min-w-0",children:[s.jsx(u,{color:e.color,children:e.title}),e.hex.length<=32&&ys(e.hex).map((t,a)=>s.jsx(u,{color:e.color,className:"font-mono",children:t.toUpperCase()},a))]}),s.jsxs("span",{className:"type-data-xs text-fg-muted flex-shrink-0",children:["Bytes ",N.payloadStartByte+e.startByte,"-",N.payloadStartByte+e.endByte]})]}),s.jsx("div",{className:"min-w-0 overflow-hidden p-3 rounded-lg bg-black",children:e.decoded})]},e.id))]})})()})})]})});function Vs(e){if(!e)return[];if(Array.isArray(e))return e;try{const s=JSON.parse(e);return Array.isArray(s)?s:[]}catch{return[]}}function Qs(e){return e?(e.startsWith("0x")?e.slice(2):e).slice(0,2).toUpperCase():""}function Os({hop:e,compact:n=!1,index:l=0,highlightIndex:r=-1,isTrace:i=!1}){var c;const o=l===r,d=Ie();return a.useEffect(()=>{o&&i&&d.start({boxShadow:["0 0 0 0px rgba(113, 156, 223, 0)","0 0 0 2px rgba(113, 156, 223, 0.5)","0 0 0 2px rgba(113, 156, 223, 0.5)","0 0 0 0px rgba(113, 156, 223, 0)"],transition:{duration:.5,times:[0,.2,.7,1],ease:"easeInOut"}})},[o,i,d]),s.jsxs(S.div,{className:t("flex items-center gap-1.5",n?"flex-row":"flex-col"),animate:{scale:o?1.05:1,opacity:o?1:.85},transition:{duration:.3,ease:"easeInOut"},children:[s.jsxs(S.div,{className:t("flex items-center gap-1.5 px-2.5 py-1 rounded-md","font-mono text-xs font-semibold",e.isLocal?"bg-sys-amber/20 text-sys-amber ring-1 ring-sys-amber/30":"bg-elevated/50 text-fg-primary ring-1 ring-edge-strong/50"),animate:d,initial:{boxShadow:"0 0 0 0px rgba(113, 156, 223, 0)"},children:[e.isLocal&&s.jsx(Me,{className:"w-3 h-3"}),s.jsx("span",{children:e.prefix}),void 0!==e.confidence&&e.confidence<.9&&s.jsxs("span",{className:"text-[9px] opacity-70",children:[(100*e.confidence).toFixed(0),"%"]})]}),!n&&(null==(c=e.neighborInfo)?void 0:c.name)&&s.jsx("span",{className:"text-xs text-fg-muted truncate max-w-[80px]",children:e.neighborInfo.name})]})}function Gs({snr:e}){const t=L(e),a=F()[t]||"#6b7280",n=Number.isInteger(e)?e.toString():e.toFixed(1);return s.jsxs(u,{customColor:a,compact:!0,className:"font-mono",children:[e>=0?"+":"",n,"dB"]})}function Ws({hops:e,compact:n,isTrace:l=!1}){const[r,i]=a.useState(-1);return a.useEffect(()=>{if(0===e.length)return;const s=setTimeout(()=>{i(0)},400),t=setInterval(()=>{i(s=>{const a=s+1;return a>=e.length?(clearInterval(t),-1):a})},l?500:600);return()=>{clearTimeout(s),clearInterval(t)}},[e.length,l]),s.jsx("div",{className:"p-6",style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"4px 8px"},children:e.map((a,i)=>{const c=i%2==0,o=i===e.length-1;return s.jsxs("div",{className:"contents",children:[s.jsx("div",{className:t("flex items-center","justify-end"),children:c&&s.jsx(Os,{hop:a,compact:n,index:i,highlightIndex:r,isTrace:l})}),s.jsx("div",{className:"flex flex-col items-center justify-center min-h-[28px]",children:!o&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-px flex-1 bg-border-strong/40 min-h-[8px]"}),void 0!==a.snr&&s.jsx(Gs,{snr:a.snr}),s.jsx("svg",{className:"w-3 h-3 text-fg-muted flex-shrink-0",viewBox:"0 0 12 12",fill:"none",children:s.jsx("path",{d:"M6 2v8M3 7l3 3 3-3",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]})}),s.jsx("div",{className:t("flex items-center","justify-start"),children:!c&&s.jsx(Os,{hop:a,compact:n,index:i,highlightIndex:r,isTrace:l})})]},`${a.prefix}-${i}`)})})}const qs=a.memo(function({packet:e,neighbors:n,localHash:l,neighborAffinity:r,ghostPrefixes:i,direction:c="horizontal",compact:o=!1,traceSnr:d,overridePath:x}){const m=void 0!==d&&d.length>0,p=Vs(e.original_path),h=Vs(e.forwarded_path),u=x??(h.length>0?h:p),g=Qs(l),y=a.useMemo(()=>u.map((e,s)=>{const t=e.toUpperCase(),a=t===g,l=(null==i?void 0:i.has(t))??!1,c=function(e,s,t){const a=e.toUpperCase();if(t){let e=null,n=0;if(t.forEach((s,t)=>{if(Qs(t)===a){const a=s.combinedScore??0;a>n&&(n=a,e=t)}}),e&&s[e])return{hash:e,info:s[e],confidence:n}}for(const[n,l]of Object.entries(s))if(Qs(n)===a)return{hash:n,info:l,confidence:void 0};return null}(t,n,r);return{prefix:t,fullHash:null==c?void 0:c.hash,neighborInfo:null==c?void 0:c.info,isLocal:a,isGhost:l,confidence:null==c?void 0:c.confidence,snr:null==d?void 0:d[s]}}),[u,n,r,g,i,d]);if(0===y.length)return s.jsxs("div",{className:"flex items-center gap-2 text-fg-muted text-xs",children:[s.jsx(f,{className:"w-4 h-4 opacity-50"}),s.jsx("span",{children:"Direct / No path data"})]});if("flowchart"===c)return s.jsx(Ws,{hops:y,compact:o,isTrace:m});const j="horizontal"===c?de:ye;return s.jsx("div",{className:t("flex gap-1.5","horizontal"===c?"flex-row flex-wrap items-center":"flex-col items-start"),children:y.map((e,a)=>s.jsxs("div",{className:t("flex items-center gap-1.5","vertical"===c&&"flex-col"),children:[s.jsx(Os,{hop:e,compact:o}),a<y.length-1&&s.jsx(j,{className:"w-3 h-3 text-fg-muted flex-shrink-0"})]},`${e.prefix}-${a}`))})});function Ks(e){if(!e)return[];if(Array.isArray(e))return e;try{const s=JSON.parse(e);return Array.isArray(s)?s:[]}catch{return[]}}function Xs({packets:e,selectedIndex:a,onSelect:n,compact:l=!1}){if(e.length<=1)return null;const r=a>0,i=a<e.length-1;return s.jsxs("div",{className:t("flex items-center gap-1",l?"gap-0.5":"gap-1"),children:[s.jsx("button",{onClick:()=>r&&n(a-1),disabled:!r,className:t("p-0.5 radius-badge transition-base",r?"text-fg-muted hover:text-fg-primary hover-bg":"text-fg-muted cursor-not-allowed"),"aria-label":"Previous observation",children:s.jsx(Pe,{className:l?"size-3":"size-4"})}),s.jsx("div",{className:"flex items-center gap-0.5",children:e.map((e,r)=>{const i=r===a,c=new Date(1e3*e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});return s.jsx(V,{color:i?"cyan":"zinc",filled:i,compact:l,onClick:()=>n(r),title:`Observation ${r+1} at ${c}`,className:t("transition-all duration-150",!i&&"opacity-60 hover:opacity-100"),children:l?s.jsx("span",{className:"tabular-nums",children:r+1}):s.jsxs("span",{className:"tabular-nums text-xs",children:["#",r+1,null!=e.rssi&&s.jsx("span",{className:"ml-1 opacity-70",children:e.rssi})]})},`${e.timestamp}_${r}`)})}),s.jsx("button",{onClick:()=>i&&n(a+1),disabled:!i,className:t("p-0.5 radius-badge transition-base",i?"text-fg-muted hover:text-fg-primary hover-bg":"text-fg-muted cursor-not-allowed"),"aria-label":"Next observation",children:s.jsx(je,{className:l?"size-3":"size-4"})}),s.jsxs("span",{className:t("text-fg-muted ml-1",l?"text-[9px]":"text-xs"),children:[s.jsx(h,{className:"inline size-3 mr-0.5 opacity-50"}),e.length]})]})}function Ys({icon:e,label:a,disabled:n=!1}){return s.jsx(S.div,{className:"flex items-center gap-1 text-xs",title:a,animate:{opacity:n?.25:.6},transition:{duration:.15,ease:[.4,0,.2,1]},children:s.jsx("span",{className:t("flex items-center justify-center size-5 radius-badge border-control transition-base",n?"bg-subtle-fill border-edge-subtle":"bg-subtle-fill"),children:e})})}function Js({hasDuplicates:e,hasPrev:t,hasNext:a,canPrevDupe:n,canNextDupe:l}){return s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsxs("div",{className:"flex items-center gap-0.5",children:[s.jsx(Ys,{icon:s.jsx(ue,{className:"size-3"}),label:"Previous packet (↑)",disabled:!t}),s.jsx(Ys,{icon:s.jsx(Q,{className:"size-3"}),label:"Next packet (↓)",disabled:!a})]}),e&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-px h-3 bg-subtle-fill-strong"}),s.jsxs("div",{className:"flex items-center gap-0.5",children:[s.jsx(Ys,{icon:s.jsx(Pe,{className:"size-3"}),label:"Previous observation (←)",disabled:!n}),s.jsx(Ys,{icon:s.jsx(je,{className:"size-3"}),label:"Next observation (→)",disabled:!l})]})]})]})}const Zs=a.memo(function({packets:e,initialIndex:t=0,onClose:n,onNavigatePrev:l,onNavigateNext:r,hasPrev:i=!1,hasNext:c=!1}){const[o,d]=a.useState(t),x=e[o]??e[0],m=e.length>1,h=o>0,g=o<e.length-1,y=a.useCallback(s=>{d(Math.max(0,Math.min(s,e.length-1)))},[e.length]);a.useEffect(()=>{const e=e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement))switch(e.key){case"ArrowUp":e.preventDefault(),null==l||l();break;case"ArrowDown":e.preventDefault(),null==r||r();break;case"ArrowLeft":e.preventDefault(),h&&d(e=>e-1);break;case"ArrowRight":e.preventDefault(),g&&d(e=>e+1)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[l,r,h,g]);const v=D(),k=z(),w=R(),C=A(),H=a.useMemo(()=>new Set(C.map(e=>e.prefix.toUpperCase())),[C]),M=x.payload_type_name||j(x.payload_type??x.type),T=x.route_type_name||b(x.route_type??x.route),P=x.payload_length??x.length??0,B=Ks(x.original_path),F=Ks(x.forwarded_path),L=B.length>0||F.length>0,V=F.length>0?F:B,Q=a.useMemo(()=>{var e;if(null==(e=null==v?void 0:v.config)?void 0:e.repeater)return{latitude:v.config.repeater.latitude,longitude:v.config.repeater.longitude,name:v.config.node_name||"Local Node"}},[v]),O=(null==v?void 0:v.neighbors)??{},G=w.size>0?w:void 0,W=x.raw_packet&&x.raw_packet.length>0,q=a.useMemo(()=>{if((x.payload_type??x.type)!==_.TRACE||!x.payload)return null;try{const e=p(x.payload),s=x.original_path||x.forwarded_path||[];let t=[];if("string"==typeof s)try{const e=JSON.parse(s);Array.isArray(e)&&(t=e.map(e=>parseInt(e,16)))}catch{t=[]}else Array.isArray(s)&&(t=s.map(e=>parseInt(e,16)));return X(e,t)}catch{return null}},[x]),K=null==q?void 0:q.snrValues,Y=a.useMemo(()=>{if((x.payload_type??x.type)!==_.ADVERT||!x.payload)return null;try{const e=p(x.payload),s=ee(e);if(!s)return null;const t=s.publicKey.slice(0,2).toUpperCase();return{...s,prefix:t}}catch{return null}},[x]),J=a.useMemo(()=>{if((null==Y?void 0:Y.latitude)&&(null==Y?void 0:Y.longitude))return{latitude:Y.latitude,longitude:Y.longitude,name:Y.name||`Node ${Y.prefix||"??"}`,prefix:Y.prefix,publicKey:Y.publicKey}},[Y]),Z=e=>e&&0!==e?new Date(1e3*e).toLocaleString():"Unknown",se=E(x.packet_hash),te=a.useMemo(()=>{if((x.payload_type??x.type)!==_.GRP_TXT)return null;if(!(null==se?void 0:se.decoded))return null;const e=se.decoded;return{type:"grp_txt",channelHash:e.channelHash,channelName:e.channelName,text:e.text??"",decrypted:e.decrypted,senderName:e.senderName,timestamp:e.timestamp,flags:e.flags,macCorrupted:e.macCorrupted}},[x,se]),ne=a.useCallback(e=>{if(!e)return null;const s=e.trim().match(/(-?\d+\.?\d*)\s*[,\s]\s*(-?\d+\.?\d*)/);if(!s)return null;const t=parseFloat(s[1]),a=parseFloat(s[2]);return isNaN(t)||isNaN(a)||t<-90||t>90||a<-180||a>180||0===t&&0===a?null:{lat:t,lon:a}},[]),le=a.useMemo(()=>{var e,s;if(!(null==te?void 0:te.decrypted))return;if(!(null==(e=te.channelName)?void 0:e.toLowerCase().includes("wardrive")))return;const t=ne(te.text);return t?{latitude:t.lat,longitude:t.lon,name:te.senderName||"Wardrive Ping",prefix:(null==(s=te.senderName)?void 0:s.slice(0,2).toUpperCase())||"WD",nodeType:"wardrive"}:void 0},[te,ne]),ie=(x.payload_type??x.type)===_.ADVERT&&(void 0!==J||L),ce=void 0!==le,oe=J??le;if(0===V.length)return null;const de=(null==v?void 0:v.local_hash)?(v.local_hash.startsWith("0x")?v.local_hash.slice(2,4):v.local_hash.slice(0,2)).toUpperCase():"";for(const s of V){const e=s.toUpperCase();if(e!==de)if(G){let s=0,t=0;if(G.forEach((a,n)=>{(n.startsWith("0x")?n.slice(2,4):n.slice(0,2)).toUpperCase()===e&&(s++,t=Math.max(t,a.combinedScore??0))}),0===s)for(const a of Object.keys(O))if((a.startsWith("0x")?a.slice(2,4):a.slice(0,2)).toUpperCase()===e)break}else for(const s of Object.keys(O))if((s.startsWith("0x")?s.slice(2,4):s.slice(0,2)).toUpperCase()===e)break}const pe=re[M]??"zinc",ue=N[pe]||N.zinc;return s.jsxs($,{open:!0,onClose:n,size:"5xl",motionPlus:!0,className:"sm:h-[85vh] sm:max-h-[800px] md:h-[80vh] md:max-h-[900px]",children:[s.jsxs("div",{className:"sm:hidden",children:[s.jsx("div",{className:"flex justify-center pt-2 pb-1",children:s.jsx("div",{className:"w-9 h-1 rounded-full bg-fg-muted","aria-hidden":"true"})}),s.jsxs("div",{className:"flex items-center justify-between px-3 pb-2",children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(u,{color:re[M]??"zinc",className:"!text-[9px] !px-1.5 !py-0",children:M}),s.jsx(u,{color:"DIRECT"===T||"T_DIRECT"===T?"cyan":"amber",className:"!text-[9px] !px-1.5 !py-0",children:T}),s.jsxs(u,{color:"zinc",className:"!text-[9px] !px-1.5 !py-0",children:[P,"B"]})]}),s.jsx("button",{onClick:n,className:"px-3 py-1.5 text-[15px] font-medium text-sys-blue active:text-sys-blue/80 transition-base flex-shrink-0 radius-inner active:bg-subtle-fill",children:"Done"})]}),m&&s.jsx("div",{className:"px-3 pb-2",children:s.jsx(Xs,{packets:e,selectedIndex:o,onSelect:y,compact:!0})})]}),s.jsx("div",{className:"hidden sm:block px-6 pt-5 pb-4",children:s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(u,{color:re[M]??"zinc",children:M}),s.jsx(u,{color:"DIRECT"===T||"T_DIRECT"===T?"cyan":"amber",children:T}),s.jsxs(u,{color:"zinc",children:[P,"B"]}),m&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-px h-4 bg-subtle-fill-strong"}),s.jsx(Xs,{packets:e,selectedIndex:o,onSelect:y})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Js,{hasDuplicates:m,hasPrev:i,hasNext:c,canPrevDupe:h,canNextDupe:g}),s.jsx("button",{onClick:n,className:"p-1.5 -m-1.5 text-fg-muted hover:text-fg-primary transition-base radius-inner hover:bg-elevated flex-shrink-0",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})}),s.jsx("div",{className:"sm:hidden h-[2px]",style:{backgroundColor:ue,opacity:.6}}),s.jsxs(U,{className:"p-0 overflow-hidden flex-1 flex flex-col min-h-0",children:[s.jsx("div",{className:"md:hidden flex-1 overflow-y-auto overflow-x-hidden",children:s.jsxs("div",{className:"p-2 space-y-2",children:[(null!=x.rssi||null!=x.snr)&&s.jsxs("div",{className:"relative flex items-center justify-between px-2 py-1.5 radius-inner bg-subtle-fill",children:[s.jsx(I,{mode:"popLayout",initial:!1,children:s.jsxs(S.div,{className:"flex items-center gap-3",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[s.jsx(xe,{rssi:x.rssi,snr:x.snr,compact:!0,showValues:!0,validated:me(x)}),s.jsx("span",{className:"text-[11px] text-fg-muted",children:he(x.rssi)})]},o)}),V.length>0&&s.jsxs("span",{className:"type-data-xs text-fg-muted",children:[V.length," hop",1!==V.length?"s":""]})]}),(L&&V.length>0||ie||ce)&&s.jsx("div",{className:"overflow-hidden radius-inset",children:s.jsx("div",{className:"aspect-[4/3] w-full",children:s.jsx(fs,{path:V,neighbors:O,localNode:Q,localHash:null==v?void 0:v.local_hash,srcHash:x.src_hash,dstHash:x.dst_hash,neighborAffinity:G,hubNodes:[...k],traceSnr:K,advertiserSource:oe})})}),q&&q.pathHashes.length>0&&s.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[s.jsx("div",{className:"px-3 py-2 space-y-1.5",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"type-micro text-fg-muted",children:"Trace Route"}),s.jsx("div",{className:"flex items-center gap-1.5",children:s.jsx(u,{color:q.isComplete?"green":"amber",compact:!0,children:q.isComplete?"Complete":"In Progress"})})]})}),s.jsx(qs,{packet:x,neighbors:O,localHash:null==v?void 0:v.local_hash,neighborAffinity:G,ghostPrefixes:H,direction:"flowchart",compact:!0,overridePath:q.pathHashes,traceSnr:q.snrValues})]}),L&&!q&&s.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[s.jsx("span",{className:"type-micro text-fg-muted",children:"Path"}),s.jsxs(u,{color:"zinc",compact:!0,children:[V.length," hop",1!==V.length?"s":""]})]}),s.jsx(qs,{packet:x,neighbors:O,localHash:null==v?void 0:v.local_hash,neighborAffinity:G,ghostPrefixes:H,direction:"flowchart",compact:!0,traceSnr:K})]}),Y&&s.jsxs("div",{className:"radius-inset bg-subtle-fill overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-edge-subtle",children:[s.jsx("span",{className:"type-micro text-fg-muted",children:"Advertiser Info"}),s.jsx(u,{color:"lime",compact:!0,children:Y.nodeType})]}),s.jsxs("div",{className:"p-3 space-y-2",children:[Y.name&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ee,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),s.jsx("span",{className:"type-label text-fg-primary truncate",children:Y.name})]}),Y.latitude&&Y.longitude&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(be,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),s.jsxs("span",{className:"type-data-xs text-fg-secondary",children:[Y.latitude.toFixed(5),", ",Y.longitude.toFixed(5)]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ze,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),s.jsxs("span",{className:"type-data-xs text-fg-muted truncate",children:[Y.publicKey.slice(0,16),"...",Y.publicKey.slice(-8)]})]}),Y.timestamp>0&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ae,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),s.jsx("span",{className:"text-xs text-fg-muted",children:Z(Y.timestamp)})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(f,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),s.jsx("span",{className:"text-xs text-fg-muted",children:Y.flagsDescription||`Flags: 0x${Y.flags.toString(16).padStart(2,"0")}`})]})]})]}),W&&s.jsx("div",{className:"pt-1",children:s.jsx(Is,{packet:x,decodedGrpTxt:te})})]})}),s.jsxs("div",{className:"hidden md:grid md:grid-cols-2 flex-1 overflow-hidden",children:[s.jsx("div",{className:"overflow-y-auto overflow-x-hidden scrollbar-none p-4 border-r border-edge-subtle",children:W&&s.jsx(Is,{packet:x,decodedGrpTxt:te})}),s.jsxs("div",{className:"grid overflow-hidden",style:{gridTemplateRows:"minmax(280px, 1fr) auto"},children:[s.jsx("div",{className:"overflow-hidden p-2",children:L&&V.length>0||ie||ce?s.jsx("div",{className:"h-full w-full",children:s.jsx(fs,{path:V,neighbors:O,localNode:Q,localHash:null==v?void 0:v.local_hash,srcHash:x.src_hash,dstHash:x.dst_hash,neighborAffinity:G,hubNodes:[...k],traceSnr:K,advertiserSource:oe})}):s.jsxs("div",{className:"h-full w-full flex flex-col items-center justify-center text-center px-4",children:[s.jsx(f,{className:"w-8 h-8 text-fg-muted/50 mb-2"}),s.jsx("span",{className:"text-sm text-fg-muted",children:"Direct Reception"}),s.jsx("span",{className:"text-xs text-fg-muted/70 mt-1",children:"Zero-hop packet — received directly from sender"})]})}),s.jsxs("div",{className:"overflow-y-auto max-h-[200px] p-2 space-y-2",children:[!q&&V.length<=1&&(null!=x.rssi||null!=x.snr)&&s.jsx("div",{className:"surface-base radius-inset p-4",children:s.jsxs("dl",{className:"text-xs grid grid-cols-2 gap-2",children:[s.jsxs("div",{children:[s.jsx("dt",{className:"text-fg-muted mb-1",children:"Signal"}),s.jsx(I,{mode:"popLayout",initial:!1,children:s.jsxs(S.dd,{className:"flex items-center gap-2",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[s.jsx(xe,{rssi:x.rssi,snr:x.snr,validated:me(x)}),s.jsx("span",{className:"font-medium text-fg-primary",children:he(x.rssi)})]},o)})]}),s.jsxs("div",{children:[s.jsx("dt",{className:"text-fg-muted mb-1",children:"RF"}),s.jsx(I,{mode:"popLayout",initial:!1,children:s.jsxs(S.dd,{className:"type-data text-fg-secondary",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[null!=x.rssi&&`${x.rssi} dBm`,null!=x.snr&&` · ${x.snr.toFixed(1)} dB`]},o)})]})]})}),Y&&s.jsxs("div",{className:"radius-inset bg-subtle-fill overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-edge-subtle",children:[s.jsx("span",{className:"type-micro text-fg-muted",children:"Advertiser"}),s.jsx(u,{color:"lime",compact:!0,children:Y.nodeType})]}),s.jsxs("div",{className:"p-4 space-y-2.5",children:[Y.name&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ee,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),s.jsx("span",{className:"type-label text-fg-primary truncate",children:Y.name})]}),Y.latitude&&Y.longitude&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(be,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),s.jsxs("span",{className:"type-data-xs text-fg-secondary",children:[Y.latitude.toFixed(5),", ",Y.longitude.toFixed(5)]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ze,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),s.jsxs("span",{className:"text-[11px] font-mono text-fg-muted truncate",children:[Y.publicKey.slice(0,16),"...",Y.publicKey.slice(-8)]})]}),Y.timestamp>0&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ae,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),s.jsx("span",{className:"text-xs text-fg-muted",children:Z(Y.timestamp)})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(f,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),s.jsx("span",{className:"text-[11px] text-fg-muted",children:Y.flagsDescription||`Flags: 0x${Y.flags.toString(16).padStart(2,"0")}`})]})]})]}),q&&q.pathHashes.length>0&&s.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[s.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[s.jsx("span",{className:"type-micro text-fg-muted",children:"Trace Route"}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(u,{color:q.isComplete?"green":"amber",compact:!0,children:q.isComplete?"Complete":"In Progress"}),s.jsxs(u,{color:"teal",compact:!0,children:[q.pathHashes.length,"h"]})]})]}),s.jsx(qs,{packet:x,neighbors:O,localHash:null==v?void 0:v.local_hash,neighborAffinity:G,ghostPrefixes:H,direction:"flowchart",compact:!0,overridePath:q.pathHashes,traceSnr:q.snrValues})]}),L&&!q&&s.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between px-4 py-2",children:[s.jsx("span",{className:"type-micro text-fg-muted",children:"Path"}),s.jsxs(u,{color:"zinc",compact:!0,children:[V.length,"h"]})]}),s.jsx(qs,{packet:x,neighbors:O,localHash:null==v?void 0:v.local_hash,neighborAffinity:G,ghostPrefixes:H,direction:"flowchart",compact:!0,traceSnr:K})]})]})]})]})]})]})});function et({label:e,numericValue:t,unit:a,icon:n,subtext:l,showSign:r=!1}){return s.jsxs("div",{className:"radius-inner p-3 sm:radius-inset sm:p-4 bg-subtle-fill ring-1 ring-inset ring-edge-subtle",children:[s.jsx("div",{className:"mb-1.5 sm:mb-2",children:s.jsx("span",{className:"text-xs sm:type-micro text-fg-muted",children:e})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Te,{value:t,format:{minimumFractionDigits:1,maximumFractionDigits:1,signDisplay:r?"always":"auto"},className:"type-data-hero tracking-tight text-fg-primary"}),s.jsxs("div",{className:"flex flex-col items-center justify-center",children:[s.jsx(n,{className:"w-[14px] h-[14px] text-fg-muted"}),a&&s.jsx("span",{className:"text-xs font-medium leading-tight text-fg-muted",children:a})]})]}),l&&s.jsx("p",{className:"mt-1.5 sm:mt-2 type-data-xs sm:text-[11px] text-fg-muted/80 truncate",children:l})]})}function st({snr:e}){const a=e>=5?"bg-sys-teal":e>=0?"bg-sys-green":e>=-5?"bg-sys-amber":e>=-10?"bg-sys-orange":"bg-sys-red";return s.jsx("span",{className:t("w-1.5 h-1.5 rounded-full flex-shrink-0",a),title:`SNR: ${e.toFixed(1)} dB`})}function tt({fromPrefix:e,toPrefix:a,fromName:n,toName:l,snr:r,maxSnr:i,isWeakest:c,isStrongest:o,index:d=0}){const x=Math.max(i+5,15),m=Math.max(0,Math.min(100,(r- -20)/(x- -20)*100)),p="bg-[#0074BE]",h=r>=5?"bg-sys-teal":r>=0?"bg-sys-green":r>=-5?"bg-sys-amber":r>=-10?"bg-sys-orange":"bg-sys-red",g=.3+.15*d;return s.jsxs("div",{className:"relative p-3 pl-5 radius-inner bg-subtle-fill ring-1 ring-inset ring-edge-subtle",children:[s.jsx("span",{className:t("absolute left-0 top-1/2 -translate-y-1/2 h-4 w-0.5 rounded-full",h)}),s.jsx("span",{className:"absolute -top-0.5 -right-0.5",children:s.jsx(st,{snr:r})}),s.jsxs("div",{className:"sm:hidden",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[s.jsx("span",{className:"text-[13px] font-medium text-fg-secondary truncate",children:n||e}),s.jsx(de,{className:"w-3 h-3 text-fg-muted flex-shrink-0"}),s.jsx("span",{className:"text-[13px] font-semibold text-fg-primary truncate",children:l||a})]}),s.jsxs("div",{className:"flex items-center gap-1.5 ml-2 flex-shrink-0",children:[c&&s.jsx(u,{color:"red",compact:!0,children:"Low"}),o&&!c&&s.jsxs(u,{color:"amber",compact:!0,children:[s.jsx(Ae,{className:"w-2.5 h-2.5"}),"Best"]}),s.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[12px] font-mono font-bold tabular-nums bg-subtle-fill-hover text-fg-primary ring-1 ring-inset ring-edge-subtle",children:[r>=0?"+":"−",Math.abs(r).toFixed(1)]})]})]}),s.jsx("div",{className:"h-1.5 bg-subtle-fill-strong rounded-full overflow-hidden",children:s.jsx(S.div,{className:t("h-full rounded-full",p),initial:{width:0},animate:{width:`${m}%`},transition:{duration:1.5,delay:g,ease:[.25,.1,.25,1]}})})]}),s.jsxs("div",{className:"hidden sm:block",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[s.jsx("code",{className:"type-data-xs text-fg-muted",children:e}),n&&s.jsx("span",{className:"text-xs text-fg-secondary truncate max-w-[100px]",children:n})]}),s.jsx(de,{className:"w-3 h-3 text-fg-muted/40 flex-shrink-0"}),s.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[s.jsx("code",{className:"font-mono text-xs font-semibold text-fg-primary",children:a}),l&&s.jsx("span",{className:"text-xs text-fg-secondary truncate max-w-[100px]",children:l})]})]}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[c&&s.jsx(u,{color:"red",compact:!0,children:"Bottleneck"}),o&&!c&&s.jsxs(u,{color:"amber",compact:!0,children:[s.jsx(Ae,{className:"w-3 h-3"}),"Strongest"]}),s.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-sm font-mono font-semibold tabular-nums bg-subtle-fill-hover text-fg-primary ring-1 ring-inset ring-edge-subtle",children:[r>=0?"+":"−",Math.abs(r).toFixed(1)]})]})]}),s.jsx("div",{className:"h-1.5 bg-elevated rounded-full overflow-hidden",children:s.jsx(S.div,{className:t("h-full rounded-full",p),initial:{width:0},animate:{width:`${m}%`},transition:{duration:1.5,delay:g,ease:[.25,.1,.25,1]}})})]})]})}function at(e,s){if("You"===e)return"You";const t=e.toUpperCase();for(const[a,n]of Object.entries(s))if((a.startsWith("0x")?a.slice(2,4):a.slice(0,2)).toUpperCase()===t)return n.name||n.node_name||void 0}const nt=a.memo(function({report:e,onClose:t}){var a,n;const l=D(),r=(null==l?void 0:l.neighbors)??{},i=(null==(a=null==l?void 0:l.config)?void 0:a.repeater)?{latitude:l.config.repeater.latitude,longitude:l.config.repeater.longitude,name:l.config.node_name||"Local Node"}:void 0,c=null==(n=e.bestObservation)?void 0:n.decoded.snrValues,o=e.linkQuality?e.linkQuality.avgSnr>=5?"excellent":e.linkQuality.avgSnr>=0?"good":e.linkQuality.avgSnr>=-5?"fair":"poor":"unknown",d={excellent:"var(--signal-excellent)",good:"var(--signal-good)",fair:"var(--signal-fair)",poor:"var(--signal-poor)",unknown:"var(--fg-muted)"}[o];return s.jsxs($,{open:!0,onClose:t,size:"5xl",motionPlus:!0,children:[s.jsxs("div",{className:"sm:hidden",children:[s.jsx("div",{className:"flex justify-center pt-2 pb-1",children:s.jsx("div",{className:"w-9 h-1 rounded-full bg-fg-primary/30","aria-hidden":"true"})}),s.jsxs("div",{className:"flex items-center justify-between px-4 pb-2",children:[s.jsx("h2",{className:"font-semibold text-[17px] text-fg-primary",children:"Trace Report"}),s.jsx("button",{onClick:t,className:"text-[17px] font-medium text-sys-blue active:text-sys-blue/80",children:"Done"})]})]}),s.jsx("div",{className:"sm:hidden h-[2px]",style:{backgroundColor:d,opacity:.6}}),s.jsx("div",{className:"hidden sm:block px-6 pt-5 pb-4",children:s.jsxs("div",{className:"flex items-start justify-between gap-3",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[s.jsx("h2",{className:"type-micro",children:"Trace Report"}),s.jsxs(u,{color:"excellent"===o||"good"===o?"green":"fair"===o?"amber":"red",children:[s.jsx(Re,{className:"w-3 h-3 mr-1"}),"excellent"===o?"Excellent":"good"===o?"Good":"fair"===o?"Fair":"Poor"]})]}),s.jsx("p",{className:"mt-1 text-xs sm:text-sm font-mono text-fg-muted tabular-nums",children:e.traceTag})]}),s.jsx("button",{onClick:t,className:"p-1.5 -m-1.5 text-fg-muted hover:text-fg-primary transition-base radius-inner hover:bg-elevated flex-shrink-0",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})}),s.jsxs("div",{className:"hidden sm:flex flex-wrap items-center gap-1.5 sm:gap-2 px-4 sm:px-6 pb-3 sm:pb-4 border-b border-edge-subtle",children:[s.jsxs(u,{color:"teal",children:[s.jsx("span",{className:"font-mono tabular-nums",children:e.targetHopCount}),s.jsxs("span",{className:"ml-1",children:["hop",1!==e.targetHopCount?"s":""]})]}),s.jsxs(u,{color:"zinc",children:[s.jsx("span",{className:"font-mono tabular-nums",children:e.observationCount}),s.jsx("span",{className:"ml-1",children:"obs"})]}),e.linkQuality&&s.jsxs(u,{color:"indigo",children:[s.jsx("span",{className:"font-mono tabular-nums",children:e.linkQuality.avgSnr.toFixed(1)}),s.jsx("span",{className:"ml-1",children:"dB avg"})]}),s.jsx("span",{className:"type-data-xs text-fg-muted",children:O(e.duration)}),e.linkQuality&&s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"text-fg-muted/40",children:"•"}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-xs font-medium bg-sys-red/15 text-sys-red ring-1 ring-inset ring-sys-red/25",children:[s.jsx("span",{className:"opacity-70",children:"Min"}),s.jsx("span",{className:"font-mono tabular-nums",children:e.linkQuality.minSnr.toFixed(1)})]}),s.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-xs font-medium bg-sys-teal/15 text-sys-teal ring-1 ring-inset ring-sys-teal/25",children:[s.jsx("span",{className:"opacity-70",children:"Max"}),s.jsx("span",{className:"font-mono tabular-nums",children:e.linkQuality.maxSnr.toFixed(1)})]})]})]})]}),s.jsxs(U,{className:"p-0 overflow-hidden",children:[s.jsx("div",{className:"md:hidden h-[75vh] max-h-[calc(100vh-80px)] overflow-y-auto overflow-x-hidden",children:s.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.linkQuality&&s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("div",{className:"radius-inner bg-subtle-fill ring-1 ring-inset ring-edge-subtle p-2.5 text-center",children:[s.jsx(Te,{value:Math.abs(e.linkQuality.minSnr),format:{maximumFractionDigits:0,signDisplay:"never"},prefix:e.linkQuality.minSnr<0?"-":"",className:"text-[20px] font-bold font-mono tabular-nums flex items-center justify-center text-fg-primary"}),s.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[s.jsx(Ne,{className:"w-2.5 h-2.5 text-fg-muted"}),s.jsx("span",{className:"text-xs text-fg-muted",children:"Min dB"})]})]}),s.jsxs("div",{className:"radius-inner bg-subtle-fill ring-1 ring-inset ring-edge-subtle p-2.5 text-center",children:[s.jsx(Te,{value:e.linkQuality.maxSnr,format:{maximumFractionDigits:0,signDisplay:"always"},className:"text-[20px] font-bold font-mono text-fg-primary tabular-nums flex items-center justify-center"}),s.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[s.jsx(ge,{className:"w-2.5 h-2.5 text-fg-muted"}),s.jsx("span",{className:"text-xs text-fg-muted",children:"Max dB"})]})]})]}),s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsxs(u,{color:"excellent"===o||"good"===o?"green":"fair"===o?"amber":"red",compact:!0,children:[s.jsx(Re,{className:"w-2.5 h-2.5 mr-0.5"}),"excellent"===o?"Excellent":"good"===o?"Good":"fair"===o?"Fair":"Poor"]}),s.jsxs(u,{color:"teal",compact:!0,children:[e.targetHopCount," hops"]}),s.jsxs(u,{color:"zinc",compact:!0,children:[e.observationCount," obs"]}),s.jsx("span",{className:"type-data-xs text-fg-muted ml-auto",children:e.traceTag.slice(0,8)})]}),e.targetPath.length>0&&s.jsx("div",{className:"overflow-hidden radius-inset",children:s.jsx("div",{className:"aspect-[4/3] w-full",children:s.jsx(fs,{path:e.targetPath,neighbors:r,localNode:i,localHash:null==l?void 0:l.local_hash,srcHash:e.srcHash,dstHash:e.dstHash,traceSnr:c})})}),s.jsxs("div",{className:"radius-inset bg-body overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-edge-subtle",children:[s.jsx("span",{className:"text-[11px] font-medium text-fg-secondary",children:"Route Path"}),e.linkQuality&&s.jsxs("span",{className:"type-data-xs text-fg-muted",children:["SNR ",e.linkQuality.minSnr.toFixed(1)," → ",e.linkQuality.maxSnr.toFixed(1)," dB"]})]}),e.bestObservation?s.jsx(qs,{packet:e.bestObservation.packet,neighbors:r,localHash:null==l?void 0:l.local_hash,direction:"flowchart",compact:!0,overridePath:e.targetPath,traceSnr:e.bestObservation.decoded.snrValues}):s.jsx("div",{className:"p-6 text-center text-fg-muted text-xs",children:"No path data available"})]}),s.jsxs("div",{children:[s.jsxs("h3",{className:"type-micro text-fg-muted mb-2",children:["Link Quality · ",e.hopStats.length," hops"]}),s.jsx("div",{className:"space-y-1.5",children:e.hopStats.length>0?e.hopStats.map((t,a)=>{var n,l,i;const c=a<e.targetPath.length-1?e.targetPath[a+1]:"You",o=at(t.prefix,r),d=at(c,r);return s.jsx(tt,{fromPrefix:t.prefix,toPrefix:c,fromName:o,toName:d,snr:t.snr,maxSnr:(null==(n=e.linkQuality)?void 0:n.maxSnr)??10,isWeakest:(null==(l=e.linkQuality)?void 0:l.weakestLinkPosition)===a,isStrongest:(null==(i=e.linkQuality)?void 0:i.strongestLinkPosition)===a,index:a},`${t.prefix}-${a}`)}):s.jsx("div",{className:"text-xs text-fg-muted py-6 text-center",children:"No link data collected"})})]}),s.jsx("div",{className:"pt-1 pb-2 text-center",children:s.jsxs("span",{className:"text-xs text-fg-muted",children:["Traced ",G(e.firstSeen)]})})]})}),s.jsxs("div",{className:"hidden md:flex md:flex-row h-[70vh] max-h-[calc(100vh-200px)] overflow-hidden",children:[s.jsx("div",{className:"w-1/2 flex flex-col min-w-0 min-h-0 overflow-hidden border-r border-edge-subtle",children:s.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.linkQuality&&(()=>{const t=e.targetPath[e.linkQuality.weakestLinkPosition],a=e.targetPath[e.linkQuality.weakestLinkPosition+1]||"You",n=at(t,r),l=at(a,r),i=e.targetPath[e.linkQuality.strongestLinkPosition],c=e.targetPath[e.linkQuality.strongestLinkPosition+1]||"You",o=at(i,r),d=at(c,r);return s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsx(et,{label:"Weakest Link",numericValue:e.linkQuality.minSnr,unit:"dB",icon:Ne,subtext:`${n||t} → ${l||a}`}),s.jsx(et,{label:"Best Link",numericValue:e.linkQuality.maxSnr,showSign:!0,unit:"dB",icon:ge,subtext:`${o||i} → ${d||c}`})]})})(),s.jsxs("div",{children:[s.jsx("h3",{className:"type-micro text-fg-muted mb-3",children:"Link Details"}),s.jsx("div",{className:"space-y-2",children:e.hopStats.length>0?e.hopStats.map((t,a)=>{var n,l,i;const c=a<e.targetPath.length-1?e.targetPath[a+1]:"You",o=at(t.prefix,r),d=at(c,r);return s.jsx(tt,{fromPrefix:t.prefix,toPrefix:c,fromName:o,toName:d,snr:t.snr,maxSnr:(null==(n=e.linkQuality)?void 0:n.maxSnr)??10,isWeakest:(null==(l=e.linkQuality)?void 0:l.weakestLinkPosition)===a,isStrongest:(null==(i=e.linkQuality)?void 0:i.strongestLinkPosition)===a,index:a},`${t.prefix}-${a}`)}):s.jsx("div",{className:"text-xs text-fg-muted py-8 text-center",children:"No link data collected"})})]}),s.jsxs("div",{className:"pt-2 text-center",children:[s.jsx("span",{className:"text-xs text-fg-muted",children:"Traced "}),s.jsx("span",{className:"type-data-xs text-fg-muted",children:G(e.firstSeen)})]})]})}),s.jsxs("div",{className:"w-1/2 min-w-0 overflow-y-auto p-3 space-y-2",children:[e.targetPath.length>0&&s.jsx("div",{className:"overflow-hidden",children:s.jsx("div",{className:"aspect-square w-full",children:s.jsx(fs,{path:e.targetPath,neighbors:r,localNode:i,localHash:null==l?void 0:l.local_hash,srcHash:e.srcHash,dstHash:e.dstHash,traceSnr:c})})}),s.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[s.jsx("span",{className:"type-micro text-fg-muted",children:"Trace Route"}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(u,{color:e.isComplete?"green":"amber",compact:!0,children:e.isComplete?"Complete":`${e.maxHopsObserved}/${e.targetHopCount}`}),s.jsxs(u,{color:"teal",compact:!0,children:[e.targetHopCount," hop",1!==e.targetHopCount?"s":""]})]})]}),e.linkQuality&&e.bestObservation&&s.jsxs("div",{className:"flex items-center gap-4 px-4 pb-2 type-data-xs text-fg-muted",children:[s.jsxs("span",{children:[s.jsx("span",{className:"opacity-60",children:"Tag"})," ",s.jsx("code",{className:"text-sys-teal tabular-nums",children:e.traceTag.slice(0,8)})]}),s.jsxs("span",{children:[s.jsx("span",{className:"opacity-60",children:"SNR"})," ",s.jsxs("code",{className:"text-sys-indigo tabular-nums",children:[e.linkQuality.minSnr.toFixed(1),"–",e.linkQuality.maxSnr.toFixed(1)]}),s.jsx("span",{className:"opacity-60",children:" dB"})]})]}),e.bestObservation?s.jsx(qs,{packet:e.bestObservation.packet,neighbors:r,localHash:null==l?void 0:l.local_hash,direction:"flowchart",compact:!0,overridePath:e.targetPath,traceSnr:e.bestObservation.decoded.snrValues}):s.jsx("div",{className:"p-8 text-center text-fg-muted text-xs",children:"No path data available"})]})]})]})]})]})}),lt="(min-width: 640px)";let rt=null;function it(e){return"undefined"==typeof window?()=>{}:(rt||(rt=window.matchMedia(lt)),rt.addEventListener("change",e),()=>null==rt?void 0:rt.removeEventListener("change",e))}function ct(){return"undefined"==typeof window||(rt||(rt=window.matchMedia(lt)),rt.matches)}function ot(e){if(!e||e.length<6)return null;const s=e,t=parseInt(s.slice(0,2),16);if(isNaN(t))return null;const a=3&t;let n=2;if(0!==a&&3!==a||(n=10),n+2>s.length)return null;const l=parseInt(s.slice(n,n+2),16);if(isNaN(l))return null;if(n+=2+2*l,n>=s.length)return null;const r=s.slice(n);return r.length>=38?r.slice(0,38):r}function dt({message:e}){return s.jsxs("div",{className:"flex flex-col items-center justify-center py-14 text-center",children:[s.jsx(f,{className:"size-6 text-fg-muted mb-2"}),s.jsx("p",{className:"text-sm text-fg-primary",children:e}),s.jsx("p",{className:"text-xs text-fg-muted",children:"Packets will appear here"})]})}function xt(){return s.jsx("div",{className:"py-14 text-center text-sm text-fg-muted",children:"Loading packets…"})}function mt({showPagination:e,currentPage:t,perPage:a,displayCount:n,totalCount:l,action:r}){const i=e?(t-1)*a+1:1,c=e?Math.min(t*a,l):n;return s.jsxs("div",{className:"flex items-center justify-between gap-4 border-t border-edge-subtle px-4 py-3 text-xs text-fg-muted sm:px-6",children:[s.jsxs("span",{children:["Showing"," ",s.jsx("span",{className:"font-medium text-fg-secondary",children:e?`${i}–${c}`:n})," ","of"," ",s.jsx("span",{className:"font-medium text-fg-secondary",children:l})," ","packets"]}),r]})}function pt({packets:e,allPackets:n,localHash:l,neighbors:r,loading:i=!1,maxPackets:c,perPage:o=50,showPagination:d=!1,onPacketSelect:x,flashNewest:m=!1,emptyMessage:p="No packets found",className:h,footerAction:u,hideDupes:g=!1,decodedMessages:f,onChannelClick:y}){const[j,b]=a.useState(null),[N,v]=a.useState(null),[k,w]=a.useState({traceTag:null,dupeGroup:null});a.useLayoutEffect(()=>{w({traceTag:null,dupeGroup:null})},[e]);const C=n??e,S=a.useMemo(()=>c&&c>0&&!g?e.slice(0,c):e,[e,c,g]),_=a.useMemo(()=>{if(!g)return null;const e=function(e){if(0===e.length)return[];const s=[];let t=0;for(;t<e.length;){const a=e[t],n=a.packet_hash;let l=1;if(n)for(;t+l<e.length&&e[t+l].packet_hash===n;)l++;s.push({packet:a,dupeCount:l}),t+=l}return s}(S),s=function(e){if(e.length<=1)return e;const s=new Map,t=new Map,a=new Map;for(let r=0;r<e.length;r++){const{packet:n}=e[r],l=n.payload_type??n.type;if(l!==W.GRP_TXT)continue;const i=ot(n.raw_packet);if(i){const e=s.get(i);if(void 0!==e){a.set(r,e);continue}s.set(i,r)}const c=`${l}:${n.payload_length??n.length??0}:${Math.floor((n.timestamp??0)/60)}`;if(!i){const e=t.get(c);if(void 0!==e){a.set(r,e);continue}}t.has(c)||t.set(c,r)}if(0===a.size)return e;const n=new Map;for(const[r,i]of a)n.set(i,(n.get(i)??0)+e[r].dupeCount);const l=[];for(let r=0;r<e.length;r++){if(a.has(r))continue;const s=n.get(r)??0;l.push(s>0?{packet:e[r].packet,dupeCount:e[r].dupeCount+s}:e[r])}return l}(e);return c&&c>0?s.slice(0,c):s},[S,g,c]),H=_?_.length:S.length,{currentPage:M,totalPages:T,goToPage:P,pageRange:B}=function(e,s,t){const[n,l]=a.useState(1),r=t?Math.ceil(e/s):1;a.useEffect(()=>{n>r&&r>0&&queueMicrotask(()=>l(1))},[r,n]);const i=a.useCallback(e=>l(Math.max(1,Math.min(e,r))),[r]),c=a.useMemo(()=>function(e,s,t=1){if(s<=7)return Array.from({length:s},(e,s)=>s+1);const a=Math.max(e-t,1),n=Math.min(e+t,s),l=a>2,r=n<s-1;if(!l&&r){const e=3+2*t;return[...Array.from({length:e},(e,s)=>s+1),"gap",s]}if(l&&!r){const e=3+2*t;return[1,"gap",...Array.from({length:e},(t,a)=>s-e+a+1)]}return[1,"gap",...Array.from({length:n-a+1},(e,s)=>a+s),"gap",s]}(n,r),[n,r]);return{currentPage:n,totalPages:r,goToPage:i,pageRange:c}}(H,o,d),F=a.useMemo(()=>{if(g)return S;if(!d)return S;const e=(M-1)*o;return S.slice(e,e+o)},[S,d,M,o,g]),L=a.useMemo(()=>{if(!_)return null;if(!d)return _;const e=(M-1)*o;return _.slice(e,e+o)},[_,d,M,o]),D=a.useMemo(()=>{var e;if(!f)return f;const s=new Map,t=new Map,a=[];for(const r of S){const n=r.payload_type??r.type;if(n!==W.GRP_TXT)continue;const l=ot(r.raw_packet),i=`${n}:${r.payload_length??r.length??0}:${Math.floor((r.timestamp??0)/60)}`,c=f.get(r.packet_hash);(null==(e=null==c?void 0:c.decoded)?void 0:e.decrypted)&&!c.decoded.macCorrupted?(l&&!s.has(l)&&s.set(l,c),t.has(i)||t.set(i,c)):f.has(r.packet_hash)||a.push({hash:r.packet_hash,payloadHex:l,approxKey:i})}if(0===a.length||0===s.size&&0===t.size)return f;const n=new Map(f);let l=0;for(const{hash:r,payloadHex:i,approxKey:c}of a){if(n.has(r))continue;const e=(i?s.get(i):null)??t.get(c);e&&(n.set(r,e),l++)}return l>0?n:f},[f,S]),z=a.useMemo(()=>function(e){const s=new Map;for(const t of e)if((t.payload_type??t.type)===W.TRACE&&t.payload&&t.packet_hash){const e=Xe(t.payload);e&&s.set(t.packet_hash,e)}return s}(F),[F]),R=a.useMemo(()=>function(e){const s=new Map;if(0===e.length)return s;for(let t=0;t<e.length;t++){const a=e[t].packet_hash;if(!a)continue;const n=e[t-1],l=e[t+1],r=(null==n?void 0:n.packet_hash)===a,i=(null==l?void 0:l.packet_hash)===a;(r||i)&&(r&&i?s.set(t,"middle"):r?s.set(t,"last"):i&&s.set(t,"first"))}return s}(F),[F]),A=function(e,s){const[t,n]=a.useState(null),l=a.useRef(0);return a.useEffect(()=>{var t,a;if(!s||!e.length)return;const r=(null==(t=e[0])?void 0:t.timestamp)??0,i=r>l.current&&l.current>0;if(l.current=r,!i)return;const c=null==(a=e[0])?void 0:a.packet_hash;if(!c)return;const o=requestAnimationFrame(()=>n(c)),d=setTimeout(()=>n(null),600);return()=>{cancelAnimationFrame(o),clearTimeout(d)}},[e,s]),t}(e,m),E=a.useCallback((e,s)=>{var t,a;const n=e.packet_hash;if(!n)return[e];let l=s;for(;l>0&&(null==(t=F[l-1])?void 0:t.packet_hash)===n;)l--;let r=s;for(;r<F.length-1&&(null==(a=F[r+1])?void 0:a.packet_hash)===n;)r++;return l===r?[e]:F.slice(l,r+1)},[F]),$=a.useCallback(e=>{var s,t;const a=null==(s=F[e])?void 0:s.packet_hash;if(!a)return e;let n=e;for(;n>0&&(null==(t=F[n-1])?void 0:t.packet_hash)===a;)n--;return n},[F]),U=a.useCallback(e=>{var s,t;const a=null==(s=F[e])?void 0:s.packet_hash;if(!a)return e;let n=e;for(;n<F.length-1&&(null==(t=F[n+1])?void 0:t.packet_hash)===a;)n++;return n},[F]),I=a.useCallback((e,s)=>{if(x)x(e);else if(void 0!==s){const t=E(e,s),a=t.indexOf(e);b({packets:t,initialIndex:a>=0?a:0,rowIndex:s})}else b({packets:[e],initialIndex:0,rowIndex:0})},[x,E]),V=a.useCallback(()=>{if(!j)return;const e=$(j.rowIndex)-1;if(e<0)return;const s=F[e];if(!s)return;const t=E(s,e);b({packets:t,initialIndex:0,rowIndex:e})},[j,F,$,E]),Q=a.useCallback(()=>{if(!j)return;const e=U(j.rowIndex)+1;if(e>=F.length)return;const s=F[e];if(!s)return;const t=E(s,e);b({packets:t,initialIndex:0,rowIndex:e})},[j,F,U,E]),O=a.useMemo(()=>!!j&&$(j.rowIndex)>0,[j,$]),G=a.useMemo(()=>!!j&&U(j.rowIndex)<F.length-1,[j,U,F.length]),q=a.useCallback(e=>w(s=>({...s,traceTag:e})),[]),K=a.useCallback(e=>w(s=>({...s,dupeGroup:e})),[]),X=a.useCallback(()=>{w({traceTag:null,dupeGroup:null})},[]),Y=a.useCallback(e=>{const s=C.filter(s=>(s.payload_type??s.type)===W.TRACE&&s.payload&&Xe(s.payload)===e);if(0===s.length)return;const t=function(e){const s=new Map;for(const t of e){const e=Je(t);if(!e)continue;const a=e.decoded.traceTag,n=s.get(a)||[];n.push(e),s.set(a,n)}for(const[t,a]of s)a.sort((e,s)=>e.timestamp-s.timestamp),s.set(t,a);return s}(s),a=t.get(e);(null==a?void 0:a.length)&&v(function(e,s){if(0===s.length)return{traceTag:e,traceTagValue:0,targetPath:[],targetHopCount:0,observations:[],observationCount:0,firstSeen:0,lastSeen:0,duration:0,isComplete:!1,maxHopsObserved:0,progressPercent:0,bestObservation:null,hopStats:[],linkQuality:null};const t=[...s].sort((e,s)=>e.timestamp-s.timestamp),a=t.reduce((e,s)=>s.hopCount>e.hopCount?s:e,t[0]),n=t[0].timestamp,l=t[t.length-1].timestamp,r=a.decoded.pathHashes,i=r.length,c=a.hopCount,o=a.decoded.isComplete,d=[],x=a.decoded.snrValues;for(let p=0;p<x.length&&p<r.length;p++)d.push({prefix:r[p],snr:x[p],position:p,quality:Ye(x[p])});let m=null;if(x.length>0){const e=Math.min(...x),s=Math.max(...x);m={minSnr:e,maxSnr:s,avgSnr:x.reduce((e,s)=>e+s,0)/x.length,weakestLinkPosition:x.indexOf(e),strongestLinkPosition:x.indexOf(s)}}return{traceTag:e,traceTagValue:a.decoded.traceTagValue,targetPath:r,targetHopCount:i,observations:t,observationCount:t.length,firstSeen:n,lastSeen:l,duration:l-n,isComplete:o,maxHopsObserved:c,progressPercent:i>0?Math.round(c/i*100):0,bestObservation:a,hopStats:d,linkQuality:m,srcHash:a.packet.src_hash,dstHash:a.packet.dst_hash}}(e,a))},[C]),J=a.useCallback(e=>{const s=C.find(s=>s.packet_hash===e);s&&(v(null),I(s))},[C,I]),Z=a.useSyncExternalStore(it,ct,()=>!0);return s.jsxs("div",{className:t("flex flex-col",h),onMouseLeave:X,children:[s.jsx("div",{className:"divide-y divide-edge-subtle py-1",children:(()=>{if(i&&0===e.length)return s.jsx(xt,{});if(0===F.length)return s.jsx(dt,{message:p});const t=Z?ds:xs;return L?L.map(({packet:e,dupeCount:a},n)=>{const i=e.packet_hash?z.get(e.packet_hash):void 0,c=null!==k.traceTag&&i===k.traceTag;return s.jsx(t,{packet:e,onClick:e=>I(e,n),localHash:l,neighbors:r,isFlashing:m&&A===e.packet_hash,traceTag:i,isTraceHighlighted:c,onTraceHover:q,onViewTraceReport:Y,dupeCount:a,decodedMessages:D,onChannelClick:y},`${e.packet_hash}_${e.timestamp}_${n}`)}):F.map((e,a)=>{const n=e.packet_hash?z.get(e.packet_hash):void 0,i=null!==k.traceTag&&n===k.traceTag,c=R.get(a),o=void 0!==c&&null!==k.dupeGroup&&e.packet_hash===k.dupeGroup;return s.jsx(t,{packet:e,onClick:e=>I(e,a),localHash:l,neighbors:r,isFlashing:m&&A===e.packet_hash,traceTag:n,isTraceHighlighted:i,onTraceHover:q,onViewTraceReport:Y,dupeGroupPosition:c,isDupeGroupHovered:o,onDupeGroupHover:K,decodedMessages:D,onChannelClick:y},`${e.packet_hash}_${e.timestamp}_${a}`)})})()}),d&&T>1&&s.jsx("nav",{className:"border-t border-edge-subtle px-4 py-3",children:s.jsxs(Ve,{className:"justify-center",children:[s.jsx(Qe,{onClick:()=>P(M-1),disabled:1===M}),s.jsx(Ge,{children:B.map((e,t)=>"gap"===e?s.jsx(qe,{},`gap-${t}`):s.jsx(We,{page:e,current:e===M,onClick:P},e))}),s.jsx(Oe,{onClick:()=>P(M+1),disabled:M===T})]})}),s.jsx(mt,{showPagination:d,currentPage:M,perPage:o,displayCount:L?L.length:F.length,totalCount:d?H:e.length,action:u}),!x&&j&&s.jsx(Zs,{packets:j.packets,initialIndex:j.initialIndex,onClose:()=>b(null),onNavigatePrev:V,onNavigateNext:Q,hasPrev:O,hasNext:G}),N&&s.jsx(nt,{report:N,onClose:()=>v(null),onViewPacket:J})]})}export{ls as C,pt as P,Re as S,Ae as T,Ie as a,ts as g,Ke as u};
