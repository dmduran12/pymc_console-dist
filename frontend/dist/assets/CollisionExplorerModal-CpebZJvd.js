import{r as e,j as s,c as t}from"./vendor-react-Co0R0q1H.js";import{u as i,M as a,B as n,S as l,L as o,a as r}from"./BasemapLayer-DRuifqX0.js";import"./maplibre-gl-b91ci4Kr.js";import{c as d,x as c,aF as u,D as h,a8 as m,a9 as x,au as p,n as g,q as f,r as v,aP as b}from"./index-nE6cslhy.js";import{T as j}from"./triangle-alert-wbV__oEe.js";import{M as y}from"./map-pin-tmXlF0NL.js";import{M as N}from"./monitor-smartphone-0zpzTTIF.js";const w=d("share-2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),H={version:8,sources:{},layers:[],glyphs:"https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf"};function M({node:i,isHovered:a,onHover:n}){const[l,o]=e.useState(!1),r=e.useCallback(e=>{var s,t;e.stopPropagation(),s=i.hash,(null==(t=navigator.clipboard)?void 0:t.writeText)&&navigator.clipboard.writeText(s).catch(()=>{}),o(!0),setTimeout(()=>o(!1),2e3)},[i.hash]),d=i.contactType.toLowerCase(),c=d.includes("room")||d.includes("server");let u=w,h="text-sys-blue";return c?(u=b,h="text-signal-fair"):"companion"===d||"client"===d?(u=N,h="text-fg-muted"):i.isNeighbor&&(h="text-sys-green"),s.jsxs("div",{className:t("flex items-center gap-3 px-3 py-2.5 radius-inner transition-base cursor-pointer",a?"bg-sys-blue/10":"hover:bg-subtle-fill"),onMouseEnter:()=>n(i.hash),onMouseLeave:()=>n(null),children:[s.jsx(u,{className:t("w-4 h-4 flex-shrink-0",h)}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsx("span",{className:"type-label text-fg-primary truncate",children:i.name}),i.isNeighbor&&s.jsx(g,{color:"green",compact:!0,children:"NBR"}),i.isRepeater&&s.jsx(g,{color:"zinc",compact:!0,children:"RPT"}),i.isHub&&s.jsx(g,{color:"indigo",compact:!0,children:"HUB"})]}),s.jsxs("button",{onClick:r,className:t("mt-1 inline-flex items-center gap-1 type-data-xs px-1.5 py-0.5 rounded","border transition-all cursor-pointer",l?"border-sys-green/50 bg-sys-green/10 text-sys-green":"border-edge-subtle bg-subtle/50 text-fg-muted hover:border-edge-strong"),title:`Copy: ${i.hash}`,children:[i.hash.slice(0,12),"…",l?s.jsx(f,{className:"w-2.5 h-2.5"}):s.jsx(v,{className:"w-2.5 h-2.5 opacity-50"})]})]})]})}function k({nodes:d,hoveredHash:c,onHover:u}){const h=i(),m=e.useRef(null),x=p(),[f,v]=e.useState(!1),b=e.useMemo(()=>d.filter(e=>null!=e.latitude&&null!=e.longitude&&(0!==e.latitude||0!==e.longitude)),[d]),j=e.useMemo(()=>{if(0===b.length)return null;let e=1/0,s=-1/0,t=1/0,i=-1/0;for(const a of b)e=Math.min(e,a.longitude),s=Math.max(s,a.longitude),t=Math.min(t,a.latitude),i=Math.max(i,a.latitude);if(i-t<.01){const e=(i+t)/2;t=e-.005,i=e+.005}if(s-e<.01){const t=(s+e)/2;e=t-.005,s=t+.005}return[[e,t],[s,i]]},[b]),N=e.useMemo(()=>j?{longitude:(j[0][0]+j[1][0])/2,latitude:(j[0][1]+j[1][1])/2}:{longitude:0,latitude:0},[j]),w=e.useMemo(()=>{if(b.length<2)return null;const e=[];for(let s=0;s<b.length;s++)for(let t=s+1;t<b.length;t++){const i=b[s],a=b[t];e.push({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[[i.longitude,i.latitude],[a.longitude,a.latitude]]}})}return{type:"FeatureCollection",features:e}},[b]),M=e.useCallback(()=>{var e;const s=null==(e=m.current)?void 0:e.getMap();s&&j?(s.fitBounds(j,{padding:{top:50,bottom:50,left:50,right:50},maxZoom:13,duration:0}),setTimeout(()=>v(!0),50)):v(!0)},[j]),k=x&&f;return 0===b.length?s.jsx("div",{className:"h-full flex items-center justify-center bg-subtle/30 radius-inner",children:s.jsxs("div",{className:"text-center text-fg-secondary p-4",children:[s.jsx(y,{className:"w-8 h-8 mx-auto mb-2 opacity-40"}),s.jsx("p",{className:"text-sm",children:"No location data available"})]})}):s.jsxs("div",{className:"h-full w-full relative radius-inner overflow-hidden bg-elevated",children:[s.jsx("div",{className:t("absolute inset-0 flex items-center justify-center z-10","transition-opacity duration-200 pointer-events-none",k?"opacity-0":"opacity-100 bg-elevated"),children:s.jsx("div",{className:"w-5 h-5 border-2 border-text-muted/30 border-t-text-muted rounded-full animate-spin"})}),s.jsx("div",{className:t("h-full w-full transition-opacity duration-200",k?"opacity-100":"opacity-0"),children:s.jsxs(a,{ref:m,initialViewState:{longitude:N.longitude,latitude:N.latitude,zoom:10},style:{height:"100%",width:"100%"},mapStyle:H,attributionControl:!1,onLoad:M,children:[s.jsx(n,{mode:h}),w&&s.jsx(l,{id:"collision-edges",type:"geojson",data:w,children:s.jsx(o,{id:"collision-edges-line",type:"line",paint:{"line-color":"#3B3F4A","line-width":2,"line-opacity":.8},layout:{"line-cap":"round","line-join":"round"}})}),b.map(e=>{const t=e.hash===c,i=e.hash.startsWith("0x")?e.hash.slice(2,4).toUpperCase():e.hash.slice(0,2).toUpperCase();return s.jsx(r,{longitude:e.longitude,latitude:e.latitude,anchor:"center",children:s.jsx("div",{className:"cursor-pointer transition-all duration-150",onMouseEnter:()=>u(e.hash),onMouseLeave:()=>u(null),style:{pointerEvents:"auto"},children:s.jsxs(g,{color:"amber",filled:!0,className:"type-data-xs shadow-lg",children:[i,t&&s.jsx("span",{className:"ml-1 opacity-75 font-sans",children:e.name})]})})},e.hash)})]})})]})}const C=e.memo(function({isOpen:t,prefix:i,candidateHashes:a,onClose:n}){const l=c(),o=u(),r=h(),[d,p]=e.useState(null),g=e.useMemo(()=>new Set(r.map(e=>e.hash)),[r]),f=(null==l?void 0:l.neighbors)??{},v=e.useMemo(()=>a.map(e=>{var s;const t=(e=>f[e]?f[e]:!e.startsWith("0x")&&f["0x"+e]?f["0x"+e]:e.startsWith("0x")&&f[e.slice(2)]?f[e.slice(2)]:void 0)(e);return{hash:e,name:(null==t?void 0:t.node_name)||(null==t?void 0:t.name)||`Unknown (${e.slice(0,8)}…)`,contactType:(null==t?void 0:t.contact_type)||"",isRepeater:(null==t?void 0:t.is_repeater)||"repeater"===(null==(s=null==t?void 0:t.contact_type)?void 0:s.toLowerCase())||!1,isNeighbor:g.has(e)||g.has("0x"+e)||g.has(e.replace(/^0x/,"")),isHub:o.has(e),latitude:null==t?void 0:t.latitude,longitude:null==t?void 0:t.longitude}}).sort((e,s)=>e.isNeighbor!==s.isNeighbor?e.isNeighbor?-1:1:e.isHub!==s.isHub?e.isHub?-1:1:e.name.localeCompare(s.name)),[a,f,g,o]),b=e.useMemo(()=>v.some(e=>null!=e.latitude&&null!=e.longitude&&(0!==e.latitude||0!==e.longitude)),[v]),y=e.useCallback(e=>{p(e)},[]),N=b?"4xl":"lg";return t?s.jsxs(m,{open:t,onClose:n,size:N,motionPlus:!0,className:b?"sm:h-[500px] sm:max-h-[600px]":"",children:[s.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-edge-subtle",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 radius-inner bg-signal-fair/10",children:s.jsx(j,{className:"w-5 h-5 text-signal-fair"})}),s.jsxs("div",{children:[s.jsxs("div",{className:"type-micro",children:["Prefix Collision: ",s.jsx("span",{className:"font-mono text-sys-blue",children:i})]}),s.jsxs("p",{className:"text-xs text-fg-secondary",children:[v.length," nodes share this prefix"]})]})]}),s.jsx("button",{onClick:n,className:"sm:hidden min-h-[44px] min-w-[44px] px-3 flex items-center justify-center text-[15px] font-medium text-sys-blue active:text-sys-blue/70 transition-base radius-inner active:bg-subtle-fill",children:"Done"}),s.jsx("button",{onClick:n,className:"hidden sm:flex items-center justify-center p-2 text-fg-muted hover:text-fg-primary transition-base radius-inner hover:bg-subtle","aria-label":"Close",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsxs(x,{className:"p-0 overflow-hidden flex-1 flex flex-col min-h-0",children:[s.jsxs("div",{className:"sm:hidden flex-1 overflow-y-auto",children:[b&&s.jsx("div",{className:"h-64 p-2 border-b border-edge-subtle",children:s.jsx(k,{nodes:v,hoveredHash:d,onHover:y})}),s.jsx("div",{className:"p-2",children:v.map(e=>s.jsx(M,{node:e,isHovered:d===e.hash,onHover:y},e.hash))})]}),b?s.jsxs("div",{className:"hidden sm:grid sm:grid-cols-[280px_minmax(400px,1fr)] flex-1 overflow-hidden sm:min-w-[700px]",children:[s.jsx("div",{className:"overflow-y-auto border-r border-edge-subtle",children:s.jsx("div",{className:"p-2",children:v.map(e=>s.jsx(M,{node:e,isHovered:d===e.hash,onHover:y},e.hash))})}),s.jsx("div",{className:"overflow-hidden p-2",children:s.jsx(k,{nodes:v,hoveredHash:d,onHover:y})})]}):s.jsx("div",{className:"hidden sm:block flex-1 overflow-y-auto",children:s.jsx("div",{className:"p-2",children:v.map(e=>s.jsx(M,{node:e,isHovered:d===e.hash,onHover:y},e.hash))})})]})]}):null});export{C,w as S};
