import{c as t,a3 as e,aA as n,d8 as a,d9 as s,K as i,da as r,N as o,m as c,f as l,ax as h,Q as m}from"./index-CDxHLYJq.js";import{r as f,j as d,c as u}from"./vendor-react-x42QsIkh.js";import{e as g,d as p}from"./config-CTM8_93T.js";import{G as x}from"./git-branch-Bp8jCdeS.js";import{D as y}from"./database-BSW1jmBU.js";const b=t("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),j=t("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),v=t("grip-vertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),M=t("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]),k=t("minimize-2",[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]]);class w{constructor(){this.componentControls=new Set}subscribe(t){return this.componentControls.add(t),()=>this.componentControls.delete(t)}start(t,e){this.componentControls.forEach(n=>{n.start(t.nativeEvent||t,e)})}cancel(){this.componentControls.forEach(t=>{t.cancel()})}stop(){this.componentControls.forEach(t=>{t.stop()})}}const N=()=>new w;function C(){return e(N)}const A={hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1,transition:{type:"spring",stiffness:400,damping:15}},exit:{opacity:0,scale:.9,transition:{duration:p.fast}}},H={hidden:{opacity:0,y:"100%"},visible:{opacity:1,y:0,transition:{type:"spring",stiffness:400,damping:30}},exit:{opacity:0,y:"100%",transition:{duration:p.medium,ease:g.easeIn}}};function P(t,e,n,a){const s=(n-t)*Math.PI/180,i=(a-e)*Math.PI/180,r=Math.sin(s/2)*Math.sin(s/2)+Math.cos(t*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))*6371e3}function T(t,e){return void 0!==t&&void 0!==e&&(0!==t||0!==e)}function V(t,e){let n=0;for(let a=0;a<t.length;a++)n+=t[a]*e[a];return n}function z(t){const e=function(t){return Math.sqrt(V(t,t))}(t);if(e>0)for(let n=0;n<t.length;n++)t[n]/=e}function E(t,e){const n=V(t,e);for(let a=0;a<t.length;a++)t[a]-=n*e[a]}function D(t,e){const n=t.length,a=new Array(n).fill(0);for(let s=0;s<n;s++)for(let i=0;i<n;i++)a[s]+=t[s][i]*e[i];return a}function L(t){const e=Math.exp(-t/30);return Math.max(.05,e)}function S(t){const e=t.length,n=Array(e).fill(null).map(()=>Array(e).fill(0));for(let a=0;a<e;a++){let s=0;for(let i=0;i<e;i++)s+=t[a][i],n[a][i]=-t[a][i];n[a][a]=s}return n}function q(t){const e=t.length,n=Array(e).fill(1/Math.sqrt(e));let a=0;for(let o=0;o<e;o++){let n=0;for(let a=0;a<e;a++)n+=Math.abs(t[o][a]);a=Math.max(a,n)}const s=Array(e).fill(null).map(()=>Array(e).fill(0));for(let o=0;o<e;o++){for(let n=0;n<e;n++)s[o][n]=-t[o][n];s[o][o]=a+s[o][o]}let i=Array(e).fill(0).map((t,e)=>43758.5453*Math.sin(12.9898*e)%1-.5);E(i,n),z(i);let r=0;for(let o=0;o<100;o++){const t=D(s,i);E(t,n);const e=V(t,t)/V(i,t);if(z(t),i=t,Math.abs(e-r)<1e-8)return{vector:i,eigenvalue:a-e};r=e}return{vector:i,eigenvalue:a-r}}function I(t,e){if(t.length<2)return 0;const n=[];for(const r of t){const t=e.get(r);t&&n.push(t)}if(n.length<2)return 0;const a=Math.min(n.length,20),s=n.length<=a?n:function(t,e){if(e>=t.length)return t;const n=[],a=t.length/e;for(let s=0;s<e;s++)n.push(t[Math.floor(s*a)]);return n}(n,a);let i=0;for(let r=0;r<s.length;r++)for(let t=r+1;t<s.length;t++){const e=P(s[r][0],s[r][1],s[t][0],s[t][1])/1e3;i=Math.max(i,e)}return i}function F(t,e,n,a){const s=e.length;if(s<3)return null;const i=new Set(e),r=t.filter(t=>i.has(t.fromHash)&&i.has(t.toHash));if(0===r.length)return null;const o=function(t,e,n,a){const s=e.length,i=new Map(e.map((t,e)=>[t,e])),r=Array(s).fill(null).map(()=>Array(s).fill(0));for(const o of t){const t=i.get(o.fromHash),e=i.get(o.toHash);if(void 0!==t&&void 0!==e&&t!==e){const s=o.strength*o.certainCount;let i=1;if(n){const t=n.get(o.fromHash),e=n.get(o.toHash);t&&e&&(i=L(P(t[0],t[1],e[0],e[1])/1e3))}let c=1;if(a){const t=[o.fromHash,o.toHash].sort().join("-");c=1-.7*(a.get(t)??0)}const l=.3+.7*(o.symmetryRatio??0),h=Math.pow(s,.7)*Math.pow(i,.3)*c*l;r[t][e]=h,r[e][t]=h}}return r}(r,e,n,a),c=S(o),{vector:l,eigenvalue:h}=q(c);if(h<.001)return null;const m=[],f=[];for(let d=0;d<s;d++)l[d]<0?m.push(e[d]):f.push(e[d]);return m.length<5||f.length<5?null:{group0:m,group1:f,fiedlerValue:h}}function $(t,e,n,a){const s=e.length;if(s<3)return{communities:new Map([[0,e]]),nodePartitions:e.map(t=>({hash:t,community:0,fiedlerValue:0})),numCommunities:1,fiedlerValue:0,isConnected:s<=1};const i=[];let r=1/0;const o=[[e,0]];for(;o.length>0;){const[e,s]=o.shift();if((n?I(e,n):0)>20&&s<4&&e.length>=10){const i=F(t,e,n,a);if(i){r=Math.min(r,i.fiedlerValue),o.push([i.group0,s+1]),o.push([i.group1,s+1]);continue}}i.push(e)}const c=new Map,l=[],h=new Map;for(let m=0;m<i.length;m++){c.set(m,i[m]);for(const t of i[m])h.set(t,m)}for(const m of e)l.push({hash:m,community:h.get(m)??0,fiedlerValue:0});return{communities:c,nodePartitions:l,numCommunities:i.length,fiedlerValue:r===1/0?0:r,isConnected:!0}}function O(t){const e=["rgba(139, 92, 246, 0.25)","rgba(16, 185, 129, 0.25)","rgba(245, 158, 11, 0.25)","rgba(239, 68, 68, 0.25)","rgba(59, 130, 246, 0.25)","rgba(236, 72, 153, 0.25)","rgba(20, 184, 166, 0.25)","rgba(249, 115, 22, 0.25)"];return e[t%e.length]}function R(t,e){if(e.length<3)return 0;const n=e.length,a=new Map(e.map((t,e)=>[t,e])),s=Array(n).fill(null).map(()=>Array(n).fill(0));for(const o of t){const t=a.get(o.fromHash),e=a.get(o.toHash);void 0!==t&&void 0!==e&&t!==e&&(s[t][e]=1,s[e][t]=1)}const i=S(s),{eigenvalue:r}=q(i);return Math.max(0,r)}function B(t){const e=["rgba(139, 92, 246, 0.6)","rgba(16, 185, 129, 0.6)","rgba(245, 158, 11, 0.6)","rgba(239, 68, 68, 0.6)","rgba(59, 130, 246, 0.6)","rgba(236, 72, 153, 0.6)","rgba(20, 184, 166, 0.6)","rgba(249, 115, 22, 0.6)"];return e[t%e.length]}function G({label:t,icon:e,status:n,detail:a}){return d.jsxs("div",{className:u("flex items-center gap-3 py-3 px-4 radius-inset transition-base","active"===n&&"bg-accent-primary/10","complete"===n&&"bg-accent-primary/10 ring-2 ring-inset ring-accent-primary","pending"===n&&"opacity-40"),children:[d.jsx("div",{className:u("w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 transition-all duration-300","active"===n&&"bg-accent-primary/20","complete"===n&&"bg-accent-primary/20","pending"===n&&"bg-subtle-fill"),children:"complete"===n?d.jsx(l,{className:"w-4 h-4 text-accent-primary"}):"active"===n?d.jsx(m,{className:"w-4 h-4 animate-spin text-accent-primary"}):d.jsx("span",{className:"text-text-muted",children:e})}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsx("div",{className:u("text-sm font-medium transition-colors","active"===n&&"text-accent-primary","complete"===n&&"text-accent-primary","pending"===n&&"text-text-muted"),children:t}),a&&"pending"!==n&&d.jsx("div",{className:"text-xs text-text-muted mt-0.5 truncate",children:a})]})]})}const J=f.memo(function({isOpen:t,onClose:e}){const{packetCacheState:m,triggerDeepAnalysis:u}=n(),g=a(),p=s(),j=m.packetCount,[v,M]=f.useState("fetching");f.useEffect(()=>{t&&u()},[t,u]),f.useEffect(()=>{if(t)if(m.isTopologyLoading)M("fetching");else if(g)M("analyzing"),setTimeout(()=>M("building"),500),setTimeout(()=>M("discovering"),1e3);else if(p>0&&!m.isTopologyLoading){M("complete");const t=setTimeout(()=>{e()},1500);return()=>clearTimeout(t)}},[t,m.isTopologyLoading,g,p,e]);const k="complete"===v,w=m.loadProgress,N=f.useMemo(()=>w&&w.target>0?`Loading... ${(w.loaded/1e3).toFixed(1)}k / ${(w.target/1e3).toFixed(1)}k packets (${w.percent}%)`:j>0?`${j.toLocaleString()} packets loaded`:"Connecting to database...",[w,j]),C=t=>{const e=["fetching","analyzing","building","discovering","complete"],n=e.indexOf(v),a=e.indexOf(t);return a<n?"complete":a===n?"active":"pending"},H=k?e:()=>{};return d.jsx(i,{open:t,onClose:H,size:"sm",bottomSheet:!1,children:d.jsx(r,{isLoading:!k,borderRadius:16,children:d.jsx(o,{className:"p-6 radius-card overflow-hidden",children:k?d.jsxs("div",{className:"flex flex-col items-center py-6",children:[d.jsx(c.div,{variants:A,initial:"hidden",animate:"visible",className:"w-16 h-16 rounded-full flex items-center justify-center mb-4 bg-accent-primary/20",children:d.jsx(l,{className:"w-8 h-8 text-accent-primary"})}),d.jsx("h3",{className:"text-lg font-semibold text-accent-primary",children:"Ready!"})]}):d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[d.jsx("div",{className:"w-10 h-10 radius-inset flex items-center justify-center bg-accent-primary/15",children:d.jsx(x,{className:"w-5 h-5 text-accent-primary"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-base font-semibold text-text-primary",children:"Deep Analysis"}),d.jsx("p",{className:"text-xs text-text-muted",children:"Building mesh topology"})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(G,{label:"Fetching Packets",icon:d.jsx(b,{className:"w-4 h-4"}),status:C("fetching"),detail:N}),d.jsx(G,{label:"Analyzing Database",icon:d.jsx(y,{className:"w-4 h-4"}),status:C("analyzing"),detail:"Processing packet paths"}),d.jsx(G,{label:"Building Topology",icon:d.jsx(x,{className:"w-4 h-4"}),status:C("building"),detail:"Computing mesh edges"}),d.jsx(G,{label:"Discovering Nodes",icon:d.jsx(h,{className:"w-4 h-4"}),status:C("discovering"),detail:"Viterbi HMM ghost detection"})]}),d.jsx("p",{className:"text-xs text-text-muted text-center mt-5",children:"This may take a few seconds..."})]})})})})});export{b as D,j as E,v as G,M,R as a,k as b,P as c,J as d,O as e,$ as f,B as g,T as h,H as s,C as u};
