var e,t,n,i,o,r=Object.defineProperty,s=(e,t,n)=>((e,t,n)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);function a(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}const l={},c=function(e,t,n){let i=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),o=(null==n?void 0:n.nonce)||(null==n?void 0:n.getAttribute("nonce"));i=e(t.map(e=>{if((e=function(e){return"/"+e}(e))in l)return;l[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const i=document.createElement("link");return i.rel=t?"stylesheet":"modulepreload",t||(i.as="script"),i.crossOrigin="",i.href=e,o&&i.setAttribute("nonce",o),document.head.appendChild(i),t?new Promise((t,n)=>{i.addEventListener("load",t),i.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function o(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return i.then(t=>{for(const e of t||[])"rejected"===e.status&&o(e.reason);return e().catch(o)})};var u=Object.defineProperty,h=(e,t,n)=>((e,t,n)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n),d="http://www.w3.org/1999/xhtml";const p={svg:"http://www.w3.org/2000/svg",xhtml:d,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function f(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),p.hasOwnProperty(t)?{space:p[t],local:e}:e}function m(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===d&&t.documentElement.namespaceURI===d?t.createElement(e):t.createElementNS(n,e)}}function _(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function g(e){var t=f(e);return(t.local?_:m)(t)}function y(){}function b(e){return null==e?y:function(){return this.querySelector(e)}}function v(){return[]}function x(e){return null==e?v:function(){return this.querySelectorAll(e)}}function w(e){return function(){return this.matches(e)}}function S(e){return function(t){return t.matches(e)}}var E=Array.prototype.find;function T(){return this.firstElementChild}var C=Array.prototype.filter;function I(){return Array.from(this.children)}function A(e){return new Array(e.length)}function k(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function L(e,t,n,i,o,r){for(var s,a=0,l=t.length,c=r.length;a<c;++a)(s=t[a])?(s.__data__=r[a],i[a]=s):n[a]=new k(e,r[a]);for(;a<l;++a)(s=t[a])&&(o[a]=s)}function R(e,t,n,i,o,r,s){var a,l,c,u=new Map,h=t.length,d=r.length,p=new Array(h);for(a=0;a<h;++a)(l=t[a])&&(p[a]=c=s.call(l,l.__data__,a,t)+"",u.has(c)?o[a]=l:u.set(c,l));for(a=0;a<d;++a)c=s.call(e,r[a],a,r)+"",(l=u.get(c))?(i[a]=l,l.__data__=r[a],u.delete(c)):n[a]=new k(e,r[a]);for(a=0;a<h;++a)(l=t[a])&&u.get(p[a])===l&&(o[a]=l)}function P(e){return e.__data__}function D(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function M(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function N(e){return function(){this.removeAttribute(e)}}function O(e){return function(){this.removeAttributeNS(e.space,e.local)}}function B(e,t){return function(){this.setAttribute(e,t)}}function F(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function z(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function U(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function $(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function V(e){return function(){this.style.removeProperty(e)}}function H(e,t,n){return function(){this.style.setProperty(e,t,n)}}function G(e,t,n){return function(){var i=t.apply(this,arguments);null==i?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function W(e,t){return e.style.getPropertyValue(t)||$(e).getComputedStyle(e,null).getPropertyValue(t)}function j(e){return function(){delete this[e]}}function Y(e,t){return function(){this[e]=t}}function q(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function X(e){return e.trim().split(/^|\s+/)}function K(e){return e.classList||new Z(e)}function Z(e){this._node=e,this._names=X(e.getAttribute("class")||"")}function Q(e,t){for(var n=K(e),i=-1,o=t.length;++i<o;)n.add(t[i])}function J(e,t){for(var n=K(e),i=-1,o=t.length;++i<o;)n.remove(t[i])}function ee(e){return function(){Q(this,e)}}function te(e){return function(){J(this,e)}}function ne(e,t){return function(){(t.apply(this,arguments)?Q:J)(this,e)}}function ie(){this.textContent=""}function oe(e){return function(){this.textContent=e}}function re(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function se(){this.innerHTML=""}function ae(e){return function(){this.innerHTML=e}}function le(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function ce(){this.nextSibling&&this.parentNode.appendChild(this)}function ue(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function he(){return null}function de(){var e=this.parentNode;e&&e.removeChild(this)}function pe(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function fe(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function me(e){return function(){var t=this.__on;if(t){for(var n,i=0,o=-1,r=t.length;i<r;++i)n=t[i],e.type&&n.type!==e.type||n.name!==e.name?t[++o]=n:this.removeEventListener(n.type,n.listener,n.options);++o?t.length=o:delete this.__on}}}function _e(e,t,n){return function(){var i,o=this.__on,r=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(o)for(var s=0,a=o.length;s<a;++s)if((i=o[s]).type===e.type&&i.name===e.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=r,i.options=n),void(i.value=t);this.addEventListener(e.type,r,n),i={type:e.type,name:e.name,value:t,listener:r,options:n},o?o.push(i):this.__on=[i]}}function ge(e,t,n){var i=$(e),o=i.CustomEvent;"function"==typeof o?o=new o(t,n):(o=i.document.createEvent("Event"),n?(o.initEvent(t,n.bubbles,n.cancelable),o.detail=n.detail):o.initEvent(t,!1,!1)),e.dispatchEvent(o)}function ye(e,t){return function(){return ge(this,e,t)}}function be(e,t){return function(){return ge(this,e,t.apply(this,arguments))}}k.prototype={constructor:k,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}},Z.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var ve=[null];function xe(e,t){this._groups=e,this._parents=t}function we(){return new xe([[document.documentElement]],ve)}function Se(e){return"string"==typeof e?new xe([[document.querySelector(e)]],[document.documentElement]):new xe([[e]],ve)}function Ee(e,t){if(e=function(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,[(i=i.matrixTransform(t.getScreenCTM().inverse())).x,i.y]}if(t.getBoundingClientRect){var o=t.getBoundingClientRect();return[e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop]}}return[e.pageX,e.pageY]}xe.prototype=we.prototype={constructor:xe,select:function(e){"function"!=typeof e&&(e=b(e));for(var t=this._groups,n=t.length,i=new Array(n),o=0;o<n;++o)for(var r,s,a=t[o],l=a.length,c=i[o]=new Array(l),u=0;u<l;++u)(r=a[u])&&(s=e.call(r,r.__data__,u,a))&&("__data__"in r&&(s.__data__=r.__data__),c[u]=s);return new xe(i,this._parents)},selectAll:function(e){e="function"==typeof e?function(e){return function(){return function(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}(e.apply(this,arguments))}}(e):x(e);for(var t=this._groups,n=t.length,i=[],o=[],r=0;r<n;++r)for(var s,a=t[r],l=a.length,c=0;c<l;++c)(s=a[c])&&(i.push(e.call(s,s.__data__,c,a)),o.push(s));return new xe(i,o)},selectChild:function(e){return this.select(null==e?T:function(e){return function(){return E.call(this.children,e)}}("function"==typeof e?e:S(e)))},selectChildren:function(e){return this.selectAll(null==e?I:function(e){return function(){return C.call(this.children,e)}}("function"==typeof e?e:S(e)))},filter:function(e){"function"!=typeof e&&(e=w(e));for(var t=this._groups,n=t.length,i=new Array(n),o=0;o<n;++o)for(var r,s=t[o],a=s.length,l=i[o]=[],c=0;c<a;++c)(r=s[c])&&e.call(r,r.__data__,c,s)&&l.push(r);return new xe(i,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,P);var n=t?R:L,i=this._parents,o=this._groups;"function"!=typeof e&&(e=function(e){return function(){return e}}(e));for(var r=o.length,s=new Array(r),a=new Array(r),l=new Array(r),c=0;c<r;++c){var u=i[c],h=o[c],d=h.length,p=D(e.call(u,u&&u.__data__,c,i)),f=p.length,m=a[c]=new Array(f),_=s[c]=new Array(f);n(u,h,m,_,l[c]=new Array(d),p,t);for(var g,y,b=0,v=0;b<f;++b)if(g=m[b]){for(b>=v&&(v=b+1);!(y=_[v])&&++v<f;);g._next=y||null}}return(s=new xe(s,i))._enter=a,s._exit=l,s},enter:function(){return new xe(this._enter||this._groups.map(A),this._parents)},exit:function(){return new xe(this._exit||this._groups.map(A),this._parents)},join:function(e,t,n){var i=this.enter(),o=this,r=this.exit();return"function"==typeof e?(i=e(i))&&(i=i.selection()):i=i.append(e+""),null!=t&&(o=t(o))&&(o=o.selection()),null==n?r.remove():n(r),i&&o?i.merge(o).order():o},merge:function(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,o=n.length,r=i.length,s=Math.min(o,r),a=new Array(o),l=0;l<s;++l)for(var c,u=n[l],h=i[l],d=u.length,p=a[l]=new Array(d),f=0;f<d;++f)(c=u[f]||h[f])&&(p[f]=c);for(;l<o;++l)a[l]=n[l];return new xe(a,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i,o=e[t],r=o.length-1,s=o[r];--r>=0;)(i=o[r])&&(s&&4^i.compareDocumentPosition(s)&&s.parentNode.insertBefore(i,s),s=i);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=M);for(var n=this._groups,i=n.length,o=new Array(i),r=0;r<i;++r){for(var s,a=n[r],l=a.length,c=o[r]=new Array(l),u=0;u<l;++u)(s=a[u])&&(c[u]=s);c.sort(t)}return new xe(o,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],o=0,r=i.length;o<r;++o){var s=i[o];if(s)return s}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var o,r=t[n],s=0,a=r.length;s<a;++s)(o=r[s])&&e.call(o,o.__data__,s,r);return this},attr:function(e,t){var n=f(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==t?n.local?O:N:"function"==typeof t?n.local?U:z:n.local?F:B)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?V:"function"==typeof t?G:H)(e,t,n??"")):W(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?j:"function"==typeof t?q:Y)(e,t)):this.node()[e]},classed:function(e,t){var n=X(e+"");if(arguments.length<2){for(var i=K(this.node()),o=-1,r=n.length;++o<r;)if(!i.contains(n[o]))return!1;return!0}return this.each(("function"==typeof t?ne:t?ee:te)(n,t))},text:function(e){return arguments.length?this.each(null==e?ie:("function"==typeof e?re:oe)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?se:("function"==typeof e?le:ae)(e)):this.node().innerHTML},raise:function(){return this.each(ce)},lower:function(){return this.each(ue)},append:function(e){var t="function"==typeof e?e:g(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var n="function"==typeof e?e:g(e),i=null==t?he:"function"==typeof t?t:b(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})},remove:function(){return this.each(de)},clone:function(e){return this.select(e?fe:pe)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var i,o,r=function(e){return e.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}(e+""),s=r.length;if(!(arguments.length<2)){for(a=t?_e:me,i=0;i<s;++i)this.each(a(r[i],t,n));return this}var a=this.node().__on;if(a)for(var l,c=0,u=a.length;c<u;++c)for(i=0,l=a[c];i<s;++i)if((o=r[i]).type===l.type&&o.name===l.name)return l.value},dispatch:function(e,t){return this.each(("function"==typeof t?be:ye)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i,o=e[t],r=0,s=o.length;r<s;++r)(i=o[r])&&(yield i)}};var Te={value:()=>{}};function Ce(){for(var e,t=0,n=arguments.length,i={};t<n;++t){if(!(e=arguments[t]+"")||e in i||/[\s.]/.test(e))throw new Error("illegal type: "+e);i[e]=[]}return new Ie(i)}function Ie(e){this._=e}function Ae(e,t){for(var n,i=0,o=e.length;i<o;++i)if((n=e[i]).name===t)return n.value}function ke(e,t,n){for(var i=0,o=e.length;i<o;++i)if(e[i].name===t){e[i]=Te,e=e.slice(0,i).concat(e.slice(i+1));break}return null!=n&&e.push({name:t,value:n}),e}Ie.prototype=Ce.prototype={constructor:Ie,on:function(e,t){var n,i=this._,o=function(e,t){return e.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");if(i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}})}(e+"",i),r=-1,s=o.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++r<s;)if(n=(e=o[r]).type)i[n]=ke(i[n],e.name,t);else if(null==t)for(n in i)i[n]=ke(i[n],e.name,null);return this}for(;++r<s;)if((n=(e=o[r]).type)&&(n=Ae(i[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Ie(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,i,o=new Array(n),r=0;r<n;++r)o[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(r=0,n=(i=this._[e]).length;r<n;++r)i[r].value.apply(t,o)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],o=0,r=i.length;o<r;++o)i[o].value.apply(t,n)}};var Le,Re,Pe=0,De=0,Me=0,Ne=0,Oe=0,Be=0,Fe="object"==typeof performance&&performance.now?performance:Date,ze="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Ue(){return Oe||(ze($e),Oe=Fe.now()+Be)}function $e(){Oe=0}function Ve(){this._call=this._time=this._next=null}function He(e,t,n){var i=new Ve;return i.restart(e,t,n),i}function Ge(){Oe=(Ne=Fe.now())+Be,Pe=De=0;try{!function(){Ue(),++Pe;for(var e,t=Le;t;)(e=Oe-t._time)>=0&&t._call.call(null,e),t=t._next;--Pe}()}finally{Pe=0,function(){for(var e,t,n=Le,i=1/0;n;)n._call?(i>n._time&&(i=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:Le=t);Re=e,je(i)}(),Oe=0}}function We(){var e=Fe.now(),t=e-Ne;t>1e3&&(Be-=t,Ne=e)}function je(e){Pe||(De&&(De=clearTimeout(De)),e-Oe>24?(e<1/0&&(De=setTimeout(Ge,e-Fe.now()-Be)),Me&&(Me=clearInterval(Me))):(Me||(Ne=Fe.now(),Me=setInterval(We,1e3)),Pe=1,ze(Ge)))}function Ye(e,t,n){var i=new Ve;return t=null==t?0:+t,i.restart(n=>{i.stop(),e(n+t)},t,n),i}Ve.prototype=He.prototype={constructor:Ve,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?Ue():+n)+(null==t?0:+t),!this._next&&Re!==this&&(Re?Re._next=this:Le=this,Re=this),this._call=e,this._time=n,je()},stop:function(){this._call&&(this._call=null,this._time=1/0,je())}};var qe=Ce("start","end","cancel","interrupt"),Xe=[];function Ke(e,t,n,i,o,r){var s=e.__transition;if(s){if(n in s)return}else e.__transition={};!function(e,t,n){var i,o=e.__transition;function r(l){var c,u,h,d;if(1!==n.state)return a();for(c in o)if((d=o[c]).name===n.name){if(3===d.state)return Ye(r);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",e,e.__data__,d.index,d.group),delete o[c]):+c<t&&(d.state=6,d.timer.stop(),d.on.call("cancel",e,e.__data__,d.index,d.group),delete o[c])}if(Ye(function(){3===n.state&&(n.state=4,n.timer.restart(s,n.delay,n.time),s(l))}),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,i=new Array(h=n.tween.length),c=0,u=-1;c<h;++c)(d=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(i[++u]=d);i.length=u+1}}function s(t){for(var o=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(a),n.state=5,1),r=-1,s=i.length;++r<s;)i[r].call(e,o);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),a())}function a(){for(var i in n.state=6,n.timer.stop(),delete o[t],o)return;delete e.__transition}o[t]=n,n.timer=He(function(e){n.state=1,n.timer.restart(r,n.delay,n.time),n.delay<=e&&r(e-n.delay)},0,n.time)}(e,n,{name:t,index:i,group:o,on:qe,tween:Xe,time:r.time,delay:r.delay,duration:r.duration,ease:r.ease,timer:null,state:0})}function Ze(e,t){var n=Je(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function Qe(e,t){var n=Je(e,t);if(n.state>3)throw new Error("too late; already running");return n}function Je(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function et(e,t){var n,i,o,r=e.__transition,s=!0;if(r){for(o in t=null==t?null:t+"",r)(n=r[o]).name===t?(i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete r[o]):s=!1;s&&delete e.__transition}}function tt(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function nt(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function it(){}var ot=.7,rt=1/ot,st="\\s*([+-]?\\d+)\\s*",at="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",lt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ct=/^#([0-9a-f]{3,8})$/,ut=new RegExp(`^rgb\\(${st},${st},${st}\\)$`),ht=new RegExp(`^rgb\\(${lt},${lt},${lt}\\)$`),dt=new RegExp(`^rgba\\(${st},${st},${st},${at}\\)$`),pt=new RegExp(`^rgba\\(${lt},${lt},${lt},${at}\\)$`),ft=new RegExp(`^hsl\\(${at},${lt},${lt}\\)$`),mt=new RegExp(`^hsla\\(${at},${lt},${lt},${at}\\)$`),_t={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function gt(){return this.rgb().formatHex()}function yt(){return this.rgb().formatRgb()}function bt(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=ct.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?vt(t):3===n?new St(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?xt(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?xt(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=ut.exec(e))?new St(t[1],t[2],t[3],1):(t=ht.exec(e))?new St(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=dt.exec(e))?xt(t[1],t[2],t[3],t[4]):(t=pt.exec(e))?xt(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=ft.exec(e))?kt(t[1],t[2]/100,t[3]/100,1):(t=mt.exec(e))?kt(t[1],t[2]/100,t[3]/100,t[4]):_t.hasOwnProperty(e)?vt(_t[e]):"transparent"===e?new St(NaN,NaN,NaN,0):null}function vt(e){return new St(e>>16&255,e>>8&255,255&e,1)}function xt(e,t,n,i){return i<=0&&(e=t=n=NaN),new St(e,t,n,i)}function wt(e,t,n,i){return 1===arguments.length?function(e){return e instanceof it||(e=bt(e)),e?new St((e=e.rgb()).r,e.g,e.b,e.opacity):new St}(e):new St(e,t,n,i??1)}function St(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}function Et(){return`#${At(this.r)}${At(this.g)}${At(this.b)}`}function Tt(){const e=Ct(this.opacity);return`${1===e?"rgb(":"rgba("}${It(this.r)}, ${It(this.g)}, ${It(this.b)}${1===e?")":`, ${e})`}`}function Ct(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function It(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function At(e){return((e=It(e))<16?"0":"")+e.toString(16)}function kt(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Rt(e,t,n,i)}function Lt(e){if(e instanceof Rt)return new Rt(e.h,e.s,e.l,e.opacity);if(e instanceof it||(e=bt(e)),!e)return new Rt;if(e instanceof Rt)return e;var t=(e=e.rgb()).r/255,n=e.g/255,i=e.b/255,o=Math.min(t,n,i),r=Math.max(t,n,i),s=NaN,a=r-o,l=(r+o)/2;return a?(s=t===r?(n-i)/a+6*(n<i):n===r?(i-t)/a+2:(t-n)/a+4,a/=l<.5?r+o:2-r-o,s*=60):a=l>0&&l<1?0:s,new Rt(s,a,l,e.opacity)}function Rt(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function Pt(e){return(e=(e||0)%360)<0?e+360:e}function Dt(e){return Math.max(0,Math.min(1,e||0))}function Mt(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}tt(it,bt,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:gt,formatHex:gt,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Lt(this).formatHsl()},formatRgb:yt,toString:yt}),tt(St,wt,nt(it,{brighter(e){return e=null==e?rt:Math.pow(rt,e),new St(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?ot:Math.pow(ot,e),new St(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new St(It(this.r),It(this.g),It(this.b),Ct(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Et,formatHex:Et,formatHex8:function(){return`#${At(this.r)}${At(this.g)}${At(this.b)}${At(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Tt,toString:Tt})),tt(Rt,function(e,t,n,i){return 1===arguments.length?Lt(e):new Rt(e,t,n,i??1)},nt(it,{brighter(e){return e=null==e?rt:Math.pow(rt,e),new Rt(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?ot:Math.pow(ot,e),new Rt(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,o=2*n-i;return new St(Mt(e>=240?e-240:e+120,o,i),Mt(e,o,i),Mt(e<120?e+240:e-120,o,i),this.opacity)},clamp(){return new Rt(Pt(this.h),Dt(this.s),Dt(this.l),Ct(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Ct(this.opacity);return`${1===e?"hsl(":"hsla("}${Pt(this.h)}, ${100*Dt(this.s)}%, ${100*Dt(this.l)}%${1===e?")":`, ${e})`}`}}));const Nt=e=>()=>e;function Ot(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):Nt(isNaN(e)?t:e)}const Bt=function e(t){var n=function(e){return 1==(e=+e)?Ot:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}(t,n,e):Nt(isNaN(t)?n:t)}}(t);function i(e,t){var i=n((e=wt(e)).r,(t=wt(t)).r),o=n(e.g,t.g),r=n(e.b,t.b),s=Ot(e.opacity,t.opacity);return function(t){return e.r=i(t),e.g=o(t),e.b=r(t),e.opacity=s(t),e+""}}return i.gamma=e,i}(1);function Ft(e,t){t||(t=[]);var n,i=e?Math.min(t.length,e.length):0,o=t.slice();return function(r){for(n=0;n<i;++n)o[n]=e[n]*(1-r)+t[n]*r;return o}}function zt(e,t){var n,i=t?t.length:0,o=e?Math.min(i,e.length):0,r=new Array(o),s=new Array(i);for(n=0;n<o;++n)r[n]=jt(e[n],t[n]);for(;n<i;++n)s[n]=t[n];return function(e){for(n=0;n<o;++n)s[n]=r[n](e);return s}}function Ut(e,t){var n=new Date;return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function $t(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Vt(e,t){var n,i={},o={};for(n in(null===e||"object"!=typeof e)&&(e={}),(null===t||"object"!=typeof t)&&(t={}),t)n in e?i[n]=jt(e[n],t[n]):o[n]=t[n];return function(e){for(n in i)o[n]=i[n](e);return o}}var Ht=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Gt=new RegExp(Ht.source,"g");function Wt(e,t){var n,i,o,r=Ht.lastIndex=Gt.lastIndex=0,s=-1,a=[],l=[];for(e+="",t+="";(n=Ht.exec(e))&&(i=Gt.exec(t));)(o=i.index)>r&&(o=t.slice(r,o),a[s]?a[s]+=o:a[++s]=o),(n=n[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,l.push({i:s,x:$t(n,i)})),r=Gt.lastIndex;return r<t.length&&(o=t.slice(r),a[s]?a[s]+=o:a[++s]=o),a.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,i=0;i<t;++i)a[(n=l[i]).i]=n.x(e);return a.join("")})}function jt(e,t){var n,i=typeof t;return null==t||"boolean"===i?Nt(t):("number"===i?$t:"string"===i?(n=bt(t))?(t=n,Bt):Wt:t instanceof bt?Bt:t instanceof Date?Ut:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(t)?Ft:Array.isArray(t)?zt:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?Vt:$t)(e,t)}function Yt(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var qt,Xt=180/Math.PI,Kt={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Zt(e,t,n,i,o,r){var s,a,l;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(l=e*n+t*i)&&(n-=e*l,i-=t*l),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,l/=a),e*i<t*n&&(e=-e,t=-t,l=-l,s=-s),{translateX:o,translateY:r,rotate:Math.atan2(t,e)*Xt,skewX:Math.atan(l)*Xt,scaleX:s,scaleY:a}}function Qt(e,t,n,i){function o(e){return e.length?e.pop()+" ":""}return function(r,s){var a=[],l=[];return r=e(r),s=e(s),function(e,i,o,r,s,a){if(e!==o||i!==r){var l=s.push("translate(",null,t,null,n);a.push({i:l-4,x:$t(e,o)},{i:l-2,x:$t(i,r)})}else(o||r)&&s.push("translate("+o+t+r+n)}(r.translateX,r.translateY,s.translateX,s.translateY,a,l),function(e,t,n,r){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),r.push({i:n.push(o(n)+"rotate(",null,i)-2,x:$t(e,t)})):t&&n.push(o(n)+"rotate("+t+i)}(r.rotate,s.rotate,a,l),function(e,t,n,r){e!==t?r.push({i:n.push(o(n)+"skewX(",null,i)-2,x:$t(e,t)}):t&&n.push(o(n)+"skewX("+t+i)}(r.skewX,s.skewX,a,l),function(e,t,n,i,r,s){if(e!==n||t!==i){var a=r.push(o(r)+"scale(",null,",",null,")");s.push({i:a-4,x:$t(e,n)},{i:a-2,x:$t(t,i)})}else(1!==n||1!==i)&&r.push(o(r)+"scale("+n+","+i+")")}(r.scaleX,r.scaleY,s.scaleX,s.scaleY,a,l),r=s=null,function(e){for(var t,n=-1,i=l.length;++n<i;)a[(t=l[n]).i]=t.x(e);return a.join("")}}}var Jt=Qt(function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Kt:Zt(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),en=Qt(function(e){return null!=e&&(qt||(qt=document.createElementNS("http://www.w3.org/2000/svg","g")),qt.setAttribute("transform",e),e=qt.transform.baseVal.consolidate())?Zt((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):Kt},", ",")",")");function tn(e){return((e=Math.exp(e))+1/e)/2}const nn=function e(t,n,i){function o(e,o){var r,s,a=e[0],l=e[1],c=e[2],u=o[0],h=o[1],d=o[2],p=u-a,f=h-l,m=p*p+f*f;if(m<1e-12)s=Math.log(d/c)/t,r=function(e){return[a+e*p,l+e*f,c*Math.exp(t*e*s)]};else{var _=Math.sqrt(m),g=(d*d-c*c+i*m)/(2*c*n*_),y=(d*d-c*c-i*m)/(2*d*n*_),b=Math.log(Math.sqrt(g*g+1)-g),v=Math.log(Math.sqrt(y*y+1)-y);s=(v-b)/t,r=function(e){var i,o=e*s,r=tn(b),u=c/(n*_)*(r*(i=t*o+b,((i=Math.exp(2*i))-1)/(i+1))-function(e){return((e=Math.exp(e))-1/e)/2}(b));return[a+u*p,l+u*f,c*r/tn(t*o+b)]}}return r.duration=1e3*s*t/Math.SQRT2,r}return o.rho=function(t){var n=Math.max(.001,+t),i=n*n;return e(n,i,i*i)},o}(Math.SQRT2,2,4);function on(e,t){var n,i;return function(){var o=Qe(this,e),r=o.tween;if(r!==n)for(var s=0,a=(i=n=r).length;s<a;++s)if(i[s].name===t){(i=i.slice()).splice(s,1);break}o.tween=i}}function rn(e,t,n){var i,o;if("function"!=typeof n)throw new Error;return function(){var r=Qe(this,e),s=r.tween;if(s!==i){o=(i=s).slice();for(var a={name:t,value:n},l=0,c=o.length;l<c;++l)if(o[l].name===t){o[l]=a;break}l===c&&o.push(a)}r.tween=o}}function sn(e,t,n){var i=e._id;return e.each(function(){var e=Qe(this,i);(e.value||(e.value={}))[t]=n.apply(this,arguments)}),function(e){return Je(e,i).value[t]}}function an(e,t){var n;return("number"==typeof t?$t:t instanceof bt?Bt:(n=bt(t))?(t=n,Bt):Wt)(e,t)}function ln(e){return function(){this.removeAttribute(e)}}function cn(e){return function(){this.removeAttributeNS(e.space,e.local)}}function un(e,t,n){var i,o,r=n+"";return function(){var s=this.getAttribute(e);return s===r?null:s===i?o:o=t(i=s,n)}}function hn(e,t,n){var i,o,r=n+"";return function(){var s=this.getAttributeNS(e.space,e.local);return s===r?null:s===i?o:o=t(i=s,n)}}function dn(e,t,n){var i,o,r;return function(){var s,a,l=n(this);return null==l?void this.removeAttribute(e):(s=this.getAttribute(e))===(a=l+"")?null:s===i&&a===o?r:(o=a,r=t(i=s,l))}}function pn(e,t,n){var i,o,r;return function(){var s,a,l=n(this);return null==l?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local))===(a=l+"")?null:s===i&&a===o?r:(o=a,r=t(i=s,l))}}function fn(e,t){var n,i;function o(){var o=t.apply(this,arguments);return o!==i&&(n=(i=o)&&function(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}(e,o)),n}return o._value=t,o}function mn(e,t){var n,i;function o(){var o=t.apply(this,arguments);return o!==i&&(n=(i=o)&&function(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}(e,o)),n}return o._value=t,o}function _n(e,t){return function(){Ze(this,e).delay=+t.apply(this,arguments)}}function gn(e,t){return t=+t,function(){Ze(this,e).delay=t}}function yn(e,t){return function(){Qe(this,e).duration=+t.apply(this,arguments)}}function bn(e,t){return t=+t,function(){Qe(this,e).duration=t}}var vn=we.prototype.constructor;function xn(e){return function(){this.style.removeProperty(e)}}var wn=0;function Sn(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function En(){return++wn}var Tn=we.prototype;function Cn(e){return e*e}function In(e){return e*(2-e)}function An(e){return((e*=2)<=1?e*e:--e*(2-e)+1)/2}Sn.prototype={constructor:Sn,select:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=b(e));for(var i=this._groups,o=i.length,r=new Array(o),s=0;s<o;++s)for(var a,l,c=i[s],u=c.length,h=r[s]=new Array(u),d=0;d<u;++d)(a=c[d])&&(l=e.call(a,a.__data__,d,c))&&("__data__"in a&&(l.__data__=a.__data__),h[d]=l,Ke(h[d],t,n,d,h,Je(a,n)));return new Sn(r,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=x(e));for(var i=this._groups,o=i.length,r=[],s=[],a=0;a<o;++a)for(var l,c=i[a],u=c.length,h=0;h<u;++h)if(l=c[h]){for(var d,p=e.call(l,l.__data__,h,c),f=Je(l,n),m=0,_=p.length;m<_;++m)(d=p[m])&&Ke(d,t,n,m,p,f);r.push(p),s.push(l)}return new Sn(r,s,t,n)},selectChild:Tn.selectChild,selectChildren:Tn.selectChildren,filter:function(e){"function"!=typeof e&&(e=w(e));for(var t=this._groups,n=t.length,i=new Array(n),o=0;o<n;++o)for(var r,s=t[o],a=s.length,l=i[o]=[],c=0;c<a;++c)(r=s[c])&&e.call(r,r.__data__,c,s)&&l.push(r);return new Sn(i,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,o=n.length,r=Math.min(i,o),s=new Array(i),a=0;a<r;++a)for(var l,c=t[a],u=n[a],h=c.length,d=s[a]=new Array(h),p=0;p<h;++p)(l=c[p]||u[p])&&(d[p]=l);for(;a<i;++a)s[a]=t[a];return new Sn(s,this._parents,this._name,this._id)},selection:function(){return new vn(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=En(),i=this._groups,o=i.length,r=0;r<o;++r)for(var s,a=i[r],l=a.length,c=0;c<l;++c)if(s=a[c]){var u=Je(s,t);Ke(s,e,n,c,a,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Sn(i,this._parents,e,n)},call:Tn.call,nodes:Tn.nodes,node:Tn.node,size:Tn.size,empty:Tn.empty,each:Tn.each,on:function(e,t){var n=this._id;return arguments.length<2?Je(this.node(),n).on.on(e):this.each(function(e,t,n){var i,o,r=function(e){return(e+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e})}(t)?Ze:Qe;return function(){var s=r(this,e),a=s.on;a!==i&&(o=(i=a).copy()).on(t,n),s.on=o}}(n,e,t))},attr:function(e,t){var n=f(e),i="transform"===n?en:an;return this.attrTween(e,"function"==typeof t?(n.local?pn:dn)(n,i,sn(this,"attr."+e,t)):null==t?(n.local?cn:ln)(n):(n.local?hn:un)(n,i,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;var i=f(e);return this.tween(n,(i.local?fn:mn)(i,t))},style:function(e,t,n){var i="transform"==(e+="")?Jt:an;return null==t?this.styleTween(e,function(e,t){var n,i,o;return function(){var r=W(this,e),s=(this.style.removeProperty(e),W(this,e));return r===s?null:r===n&&s===i?o:o=t(n=r,i=s)}}(e,i)).on("end.style."+e,xn(e)):"function"==typeof t?this.styleTween(e,function(e,t,n){var i,o,r;return function(){var s=W(this,e),a=n(this),l=a+"";return null==a&&(this.style.removeProperty(e),l=a=W(this,e)),s===l?null:s===i&&l===o?r:(o=l,r=t(i=s,a))}}(e,i,sn(this,"style."+e,t))).each(function(e,t){var n,i,o,r,s="style."+t,a="end."+s;return function(){var l=Qe(this,e),c=l.on,u=null==l.value[s]?r||(r=xn(t)):void 0;(c!==n||o!==u)&&(i=(n=c).copy()).on(a,o=u),l.on=i}}(this._id,e)):this.styleTween(e,function(e,t,n){var i,o,r=n+"";return function(){var s=W(this,e);return s===r?null:s===i?o:o=t(i=s,n)}}(e,i,t),n).on("end.style."+e,null)},styleTween:function(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==t)return this.tween(i,null);if("function"!=typeof t)throw new Error;return this.tween(i,function(e,t,n){var i,o;function r(){var r=t.apply(this,arguments);return r!==o&&(i=(o=r)&&function(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}(e,r,n)),i}return r._value=t,r}(e,t,n??""))},text:function(e){return this.tween("text","function"==typeof e?function(e){return function(){var t=e(this);this.textContent=t??""}}(sn(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,function(e){var t,n;function i(){var i=e.apply(this,arguments);return i!==n&&(t=(n=i)&&function(e){return function(t){this.textContent=e.call(this,t)}}(i)),t}return i._value=e,i}(e))},remove:function(){return this.on("end.remove",(e=this._id,function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}));var e},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var i,o=Je(this.node(),n).tween,r=0,s=o.length;r<s;++r)if((i=o[r]).name===e)return i.value;return null}return this.each((null==t?on:rn)(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?_n:gn)(t,e)):Je(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?yn:bn)(t,e)):Je(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(function(e,t){if("function"!=typeof t)throw new Error;return function(){Qe(this,e).ease=t}}(t,e)):Je(this.node(),t).ease},easeVarying:function(e){if("function"!=typeof e)throw new Error;return this.each(function(e,t){return function(){var n=t.apply(this,arguments);if("function"!=typeof n)throw new Error;Qe(this,e).ease=n}}(this._id,e))},end:function(){var e,t,n=this,i=n._id,o=n.size();return new Promise(function(r,s){var a={value:s},l={value:function(){0===--o&&r()}};n.each(function(){var n=Qe(this,i),o=n.on;o!==e&&((t=(e=o).copy())._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),n.on=t}),0===o&&r()})},[Symbol.iterator]:Tn[Symbol.iterator]};var kn={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function Ln(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function Rn(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}we.prototype.interrupt=function(e){return this.each(function(){et(this,e)})},we.prototype.transition=function(e){var t,n;e instanceof Sn?(t=e._id,e=e._name):(t=En(),(n=kn).time=Ue(),e=null==e?null:e+"");for(var i=this._groups,o=i.length,r=0;r<o;++r)for(var s,a=i[r],l=a.length,c=0;c<l;++c)(s=a[c])&&Ke(s,e,t,c,a,n||Ln(s,t));return new Sn(i,this._parents,e,t)};class Pn{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Rn(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Rn()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Dn{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(e=>this._getOrCreate(e))}_getOrCreate(e){const{name:t,type:n}=e;let i=this.stats[t];return i||(i=e instanceof Pn?e:new Pn(t,n),this.stats[t]=i),i}}const Mn=new class{constructor(){h(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Dn({id:e})),this.stats.get(e)}},Nn=globalThis,On=globalThis.process||{},Bn=globalThis.navigator||{};function Fn(e){var t,n;if(typeof window<"u"&&"renderer"===(null==(t=window.process)?void 0:t.type)||typeof process<"u"&&null!=(n=process.versions)&&n.electron)return!0;const i=typeof navigator<"u"&&navigator.userAgent;return!!(i&&i.indexOf("Electron")>=0)}function zn(){return!("object"==typeof process&&"[object process]"===String(process)&&(null==process||!process.browser))||Fn()}const Un="4.1.0";class $n{constructor(e,t,n="sessionStorage"){this.storage=function(e){try{const t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),t}catch{return null}}(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}var Vn,Hn;function Gn(e){return"string"!=typeof e?e:(e=e.toUpperCase(),Vn[e]||Vn.WHITE)}function Wn(e,t){if(!e)throw new Error("Assertion failed")}function jn(){var e,t,n;let i;if(zn()&&Nn.performance)i=null==(t=null==(e=null==Nn?void 0:Nn.performance)?void 0:e.now)?void 0:t.call(e);else if("hrtime"in On){const e=null==(n=null==On?void 0:On.hrtime)?void 0:n.call(On);i=1e3*e[0]+e[1]/1e6}else i=Date.now();return i}(Hn=Vn||(Vn={}))[Hn.BLACK=30]="BLACK",Hn[Hn.RED=31]="RED",Hn[Hn.GREEN=32]="GREEN",Hn[Hn.YELLOW=33]="YELLOW",Hn[Hn.BLUE=34]="BLUE",Hn[Hn.MAGENTA=35]="MAGENTA",Hn[Hn.CYAN=36]="CYAN",Hn[Hn.WHITE=37]="WHITE",Hn[Hn.BRIGHT_BLACK=90]="BRIGHT_BLACK",Hn[Hn.BRIGHT_RED=91]="BRIGHT_RED",Hn[Hn.BRIGHT_GREEN=92]="BRIGHT_GREEN",Hn[Hn.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",Hn[Hn.BRIGHT_BLUE=94]="BRIGHT_BLUE",Hn[Hn.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",Hn[Hn.BRIGHT_CYAN=96]="BRIGHT_CYAN",Hn[Hn.BRIGHT_WHITE=97]="BRIGHT_WHITE";const Yn={debug:zn()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},qn={enabled:!0,level:0};function Xn(){}const Kn={},Zn={once:!0};class Qn{constructor({id:e}={id:""}){this.VERSION=Un,this._startTs=jn(),this._deltaTs=jn(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new $n(`__probe-${this.id}__`,qn),this.timeStamp(`${this.id} started`),function(e,t=["constructor"]){const n=Object.getPrototypeOf(e),i=Object.getOwnPropertyNames(n),o=e;for(const r of i){const n=o[r];"function"==typeof n&&(t.find(e=>r===e)||(o[r]=n.bind(e)))}}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((jn()-this._startTs).toPrecision(10))}getDelta(){return Number((jn()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):this._storage.config}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Yn.warn,arguments,Zn)}error(e){return this._getLogFunction(0,e,Yn.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Yn.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Yn.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Yn.debug||Yn.info,arguments,Zn)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||Xn,n&&[n],{tag:ti(t)}):Xn}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Xn)}group(e,t,n={collapsed:!1}){const i=ei({logLevel:e,message:t,opts:n}),{collapsed:o}=n;return i.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t,n={}){return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Xn)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Jn(e)}_getLogFunction(e,t,n,i,o){if(this._shouldLog(e)){o=ei({logLevel:e,message:t,args:i,opts:o}),Wn(n=n||o.method),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=jn();const r=o.tag||o.message;if(o.once&&r){if(Kn[r])return Xn;Kn[r]=jn()}return t=function(e,t,n){if("string"==typeof t){const i=n.time?function(e,t=8){const n=Math.max(t-e.length,0);return`${" ".repeat(n)}${e}`}(function(e){let t;return t=e<10?`${e.toFixed(2)}ms`:e<100?`${e.toFixed(1)}ms`:e<1e3?`${e.toFixed(0)}ms`:`${(e/1e3).toFixed(2)}s`,t}(n.total)):"";t=function(e,t,n){return!zn&&"string"==typeof e&&(t&&(e=`[${Gn(t)}m${e}[39m`),n&&(e=`[${Gn(n)+10}m${e}[49m`)),e}(t=n.time?`${e}: ${i}  ${t}`:`${e}: ${t}`,n.color,n.background)}return t}(this.id,o.message,o),n.bind(console,t,...o.args)}return Xn}}function Jn(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return Wn(Number.isFinite(t)&&t>=0),t}function ei(e){const{logLevel:t,message:n}=e;e.logLevel=Jn(t);const i=e.args?Array.from(e.args):[];for(;i.length&&i.shift()!==n;);switch(typeof t){case"string":case"function":void 0!==n&&i.unshift(n),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());const o=typeof e.message;return Wn("string"===o||"object"===o),Object.assign(e,{args:i},e.opts)}function ti(e){for(const t in e)for(const n in e[t])return n||"untitled";return"empty"}Qn.VERSION=Un;const ni=new Qn({id:"luma.gl"}),ii={};function oi(e="id"){return ii[e]=ii[e]||1,`${e}-${ii[e]++}`}class ri{constructor(e,t,n){if(h(this,"id"),h(this,"props"),h(this,"userData",{}),h(this,"_device"),h(this,"destroyed",!1),h(this,"allocatedBytes",0),h(this,"_attachedResources",new Set),!e)throw new Error("no device");this._device=e,this.props=function(e,t){const n={...t};for(const i in e)void 0!==e[i]&&(n[i]=e[i]);return n}(t,n);const i="undefined"!==this.props.id?this.props.id:oi(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}}h(ri,"defaultProps",{id:"undefined",handle:void 0,userData:void 0});const si=class e extends ri{constructor(t,n){const i={...n};(n.usage||0)&e.INDEX&&!n.indexType&&(n.data instanceof Uint32Array?i.indexType="uint32":n.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data,super(t,i,e.defaultProps),h(this,"usage"),h(this,"indexType"),h(this,"updateTimestamp"),h(this,"debugData",new ArrayBuffer(0)),this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(e){return this.device.createBuffer({...this.props,...e})}_setDebugData(t,n,i){const o=ArrayBuffer.isView(t)?t.buffer:t,r=Math.min(t?t.byteLength:i,e.DEBUG_DATA_MAX_LENGTH);null===o?this.debugData=new ArrayBuffer(r):0===n&&i===o.byteLength?this.debugData=o.slice(0,r):this.debugData=o.slice(n,n+r)}};h(si,"INDEX",16),h(si,"VERTEX",32),h(si,"UNIFORM",64),h(si,"STORAGE",128),h(si,"INDIRECT",256),h(si,"QUERY_RESOLVE",512),h(si,"MAP_READ",1),h(si,"MAP_WRITE",2),h(si,"COPY_SRC",4),h(si,"COPY_DST",8),h(si,"DEBUG_DATA_MAX_LENGTH",32),h(si,"defaultProps",{...ri.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0});let ai=si;function li(e){const[t,n,i]=di[e],o=e.includes("norm");return{signedType:t,primitiveType:n,byteLength:i,normalized:o,integer:!o&&!e.startsWith("float"),signed:e.startsWith("s")}}function ci(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}function ui(e){const t=ArrayBuffer.isView(e)?e.constructor:e;if(t===Uint8ClampedArray)return"uint8";const n=Object.values(di).find(e=>t===e[4]);if(!n)throw new Error(t.name);return n[0]}function hi(e){const[,,,,t]=di[e];return t}const di={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]};function pi(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);const[n,i]=e.split("x"),o=n,r=i?parseInt(i):1,s=li(o),a={type:o,components:r,byteLength:s.byteLength*r,integer:s.integer,signed:s.signed,normalized:s.normalized};return t&&(a.webglOnly=!0),a}function fi(e,t,n){if(!t||t>4)throw new Error(`size ${t}`);const i=t;return function(e,t,n){const i=n?function(e){const t=e;switch(t){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return t}}(e):e;switch(i){case"unorm8":return 1===t?"unorm8":3===t?"unorm8x3-webgl":`${i}x${t}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(1===t||3===t)throw new Error(`size: ${t}`);return`${i}x${t}`;default:return 1===t?i:`${i}x${t}`}}(ui(e),i,n)}const mi="texture-compression-bc",_i="texture-compression-astc",gi="texture-compression-etc2",yi="texture-compression-pvrtc-webgl",bi="texture-compression-atc-webgl",vi="float32-renderable-webgl",xi="float16-renderable-webgl",wi="snorm8-renderable-webgl",Si="norm16-renderable-webgl",Ei="snorm16-renderable-webgl",Ti="float32-filterable",Ci="float16-filterable-webgl";function Ii(e){const t=Ai[e];if(!t)throw new Error(`Unsupported texture format ${e}`);return t}const Ai={r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:wi},rg8snorm:{render:wi},"rgb8snorm-webgl":{},rgba8snorm:{render:wi},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:Si},rg16unorm:{render:Si},"rgb16unorm-webgl":{f:Si},rgba16unorm:{render:Si},r16snorm:{f:Ei},rg16snorm:{render:Ei},"rgb16snorm-webgl":{f:Si},rgba16snorm:{render:Ei},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:xi,filter:"float16-filterable-webgl"},rg16float:{render:xi,filter:Ci},rgba16float:{render:xi,filter:Ci},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:vi,filter:Ti},rg32float:{render:!1,filter:Ti},"rgb32float-webgl":{render:vi,filter:Ti},rgba32float:{render:vi,filter:Ti},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:"rgb9e5ufloat-renderable-webgl"},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:vi},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:mi},"bc1-rgb-unorm-srgb-webgl":{f:mi},"bc1-rgba-unorm":{f:mi},"bc1-rgba-unorm-srgb":{f:mi},"bc2-rgba-unorm":{f:mi},"bc2-rgba-unorm-srgb":{f:mi},"bc3-rgba-unorm":{f:mi},"bc3-rgba-unorm-srgb":{f:mi},"bc4-r-unorm":{f:mi},"bc4-r-snorm":{f:mi},"bc5-rg-unorm":{f:mi},"bc5-rg-snorm":{f:mi},"bc6h-rgb-ufloat":{f:mi},"bc6h-rgb-float":{f:mi},"bc7-rgba-unorm":{f:mi},"bc7-rgba-unorm-srgb":{f:mi},"etc2-rgb8unorm":{f:gi},"etc2-rgb8unorm-srgb":{f:gi},"etc2-rgb8a1unorm":{f:gi},"etc2-rgb8a1unorm-srgb":{f:gi},"etc2-rgba8unorm":{f:gi},"etc2-rgba8unorm-srgb":{f:gi},"eac-r11unorm":{f:gi},"eac-r11snorm":{f:gi},"eac-rg11unorm":{f:gi},"eac-rg11snorm":{f:gi},"astc-4x4-unorm":{f:_i},"astc-4x4-unorm-srgb":{f:_i},"astc-5x4-unorm":{f:_i},"astc-5x4-unorm-srgb":{f:_i},"astc-5x5-unorm":{f:_i},"astc-5x5-unorm-srgb":{f:_i},"astc-6x5-unorm":{f:_i},"astc-6x5-unorm-srgb":{f:_i},"astc-6x6-unorm":{f:_i},"astc-6x6-unorm-srgb":{f:_i},"astc-8x5-unorm":{f:_i},"astc-8x5-unorm-srgb":{f:_i},"astc-8x6-unorm":{f:_i},"astc-8x6-unorm-srgb":{f:_i},"astc-8x8-unorm":{f:_i},"astc-8x8-unorm-srgb":{f:_i},"astc-10x5-unorm":{f:_i},"astc-10x5-unorm-srgb":{f:_i},"astc-10x6-unorm":{f:_i},"astc-10x6-unorm-srgb":{f:_i},"astc-10x8-unorm":{f:_i},"astc-10x8-unorm-srgb":{f:_i},"astc-10x10-unorm":{f:_i},"astc-10x10-unorm-srgb":{f:_i},"astc-12x10-unorm":{f:_i},"astc-12x10-unorm-srgb":{f:_i},"astc-12x12-unorm":{f:_i},"astc-12x12-unorm-srgb":{f:_i},"pvrtc-rgb4unorm-webgl":{f:yi},"pvrtc-rgba4unorm-webgl":{f:yi},"pvrtc-rbg2unorm-webgl":{f:yi},"pvrtc-rgba2unorm-webgl":{f:yi},"etc1-rbg-unorm-webgl":{f:"texture-compression-etc1-webgl"},"atc-rgb-unorm-webgl":{f:bi},"atc-rgba-unorm-webgl":{f:bi},"atc-rgbai-unorm-webgl":{f:bi}},ki=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],Li=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/,Ri=new class{getInfo(e){return Pi(e)}isColor(e){return e.startsWith("rgba")||e.startsWith("bgra")||e.startsWith("rgb")}isDepthStencil(e){return e.startsWith("depth")||e.startsWith("stencil")}isCompressed(e){return ki.some(t=>e.startsWith(t))}getCapabilities(e){const t=Ii(e),n={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},i=Pi(e),o=e.startsWith("depth")||e.startsWith("stencil"),r=null==i?void 0:i.signed,s=null==i?void 0:i.integer,a=null==i?void 0:i.webgl;return n.render&&(n.render=!r),n.filter&&(n.filter=!(o||r||s||a)),n}};function Pi(e){let t=function(e){var t;const n=Ii(e),i=n.bytesPerPixel||1,o=n.bitsPerChannel||[8,8,8,8];return delete n.bitsPerChannel,delete n.bytesPerPixel,delete n.f,delete n.render,delete n.filter,delete n.blend,delete n.store,{...n,format:e,attachment:n.attachment||"color",channels:n.channels||"r",components:n.components||(null==(t=n.channels)?void 0:t.length)||1,bytesPerPixel:i,bitsPerChannel:o,dataType:n.dataType||"uint8",srgb:n.srgb??!1,packed:n.packed??!1,webgl:n.webgl??!1,integer:n.integer??!1,signed:n.signed??!1,normalized:n.normalized??!1,compressed:n.compressed??!1}}(e);if(Ri.isCompressed(e)){t.channels="rgb",t.components=3,t.bytesPerPixel=1,t.srgb=!1,t.compressed=!0;const n=function(e){const t=/.*-(\d+)x(\d+)-.*/.exec(e);if(t){const[,e,n]=t;return{blockWidth:Number(e),blockHeight:Number(n)}}return null}(e);n&&(t.blockWidth=n.blockWidth,t.blockHeight=n.blockHeight)}const n=Li.exec(e);if(n){const[,i,o,r,s,a]=n,l=li(`${r}${o}`),c=8*l.byteLength,u=i.length,h=[c,u>=2?c:0,u>=3?c:0,u>=4?c:0];t={format:e,attachment:t.attachment,dataType:l.signedType,components:u,channels:i,integer:l.integer,signed:l.signed,normalized:l.normalized,bitsPerChannel:h,bytesPerPixel:l.byteLength*i.length,packed:t.packed,srgb:t.srgb},"-webgl"===a&&(t.webgl=!0),"-srgb"===s&&(t.srgb=!0)}return e.endsWith("-webgl")&&(t.webgl=!0),e.endsWith("-srgb")&&(t.srgb=!0),t}class Di{}class Mi{constructor(e=[],t){h(this,"features"),h(this,"disabledFeatures"),this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){var t;return!(null!=(t=this.disabledFeatures)&&t[e])&&this.features.has(e)}}const Ni=class e{constructor(t){h(this,"id"),h(this,"props"),h(this,"userData",{}),h(this,"statsManager",Mn),h(this,"timestamp",0),h(this,"_reused",!1),h(this,"_lumaData",{}),h(this,"_textureCaps",{}),this.props={...e.defaultProps,...t},this.id=this.props.id||oi(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}getVertexFormatInfo(e){return pi(e)}isVertexFormatSupported(e){return!0}getTextureFormatInfo(e){return Ri.getInfo(e)}getTextureFormatCapabilities(e){let t=this._textureCaps[e];if(!t){const n=this._getDeviceTextureFormatCapabilities(e);t=this._getDeviceSpecificTextureFormatCapabilities(n),this._textureCaps[e]=t}return t}getMipLevelCount(e,t,n=1){const i=Math.max(e,t,n);return 1+Math.floor(Math.log2(i))}isExternalImage(e){return function(e){return typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof VideoFrame<"u"&&e instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}(e)}getExternalImageSize(e){return function(e){if(typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if(typeof VideoFrame<"u"&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}(e)}isTextureFormatSupported(e){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return Ri.isCompressed(e)}pushDebugGroup(e){this.commandEncoder.pushDebugGroup(e)}popDebugGroup(){var e;null==(e=this.commandEncoder)||e.popDebugGroup()}insertDebugMarker(e){var t;null==(t=this.commandEncoder)||t.insertDebugMarker(e)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(e,t,...n){return this.props.onError(e,t)?()=>{}:ni.error(e.message,t,...n)}debug(){this.props.debug||ni.once(0,"'Type luma.log.set({debug: true}) in console to enable debug breakpoints',\nor create a device with the 'debug: true' prop.")()}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(e){return this.commandEncoder.beginRenderPass(e)}beginComputePass(e){return this.commandEncoder.beginComputePass(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return!0===e.createCanvasContext?{}:e.createCanvasContext}_getDeviceTextureFormatCapabilities(e){const t=Ri.getCapabilities(e),n=e=>("string"==typeof e?this.features.has(e):e)??!0,i=n(t.create);return{format:e,create:i,render:i&&n(t.render),filter:i&&n(t.filter),blend:i&&n(t.blend),store:i&&n(t.store)}}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};if((e.usage||0)&ai.INDEX&&(e.indexType||(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array&&(t.indexType="uint16")),!t.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return t}};h(Ni,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(e,t)=>{},onResize:(e,t)=>{const[n,i]=e.getDevicePixelSize();ni.log(1,`${e} resized => ${n}x${i}px`)()},onPositionChange:(e,t)=>{const[n,i]=e.getPosition();ni.log(1,`${e} repositioned => ${n},${i}`)()},onVisibilityChange:e=>ni.log(1,`${e} Visibility changed ${e.isVisible}`)(),onDevicePixelRatioChange:(e,t)=>ni.log(1,`${e} DPR changed ${t.oldRatio} => ${e.devicePixelRatio}`)(),debug:ni.get("debug")||void 0,debugShaders:ni.get("debug-shaders")||void 0,debugFramebuffers:!!ni.get("debug-framebuffers"),debugFactories:!!ni.get("debug-factories"),debugWebGL:!!ni.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0});let Oi=Ni;const Bi="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",Fi=class e{constructor(){if(h(this,"stats",Mn),h(this,"log",ni),h(this,"VERSION","9.2.5"),h(this,"spector"),h(this,"preregisteredAdapters",new Map),globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw ni.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),ni.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");ni.error("This version of luma.gl has already been initialized")()}ni.log(1,`${this.VERSION} - set luma.log.level=1 (or higher) to trace rendering`)(),globalThis.luma=this}async createDevice(t={}){const n={...e.defaultProps,...t},i=this.selectAdapter(n.type,n.adapters);if(!i)throw new Error(Bi);return n.waitForPageLoad&&await i.pageLoaded,await i.create(n)}async attachDevice(e,t){var n;const i=this._getTypeFromHandle(e,t.adapters),o=i&&this.selectAdapter(i,t.adapters);if(!o)throw new Error(Bi);return await(null==(n=null==o?void 0:o.attach)?void 0:n.call(o,e,t))}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this._getAdapterMap(e);return Array.from(t).map(([,e])=>e).filter(e=>{var t;return null==(t=e.isSupported)?void 0:t.call(e)}).map(e=>e.type)}getBestAvailableAdapterType(e=[]){var t,n;const i=["webgpu","webgl","null"],o=this._getAdapterMap(e);for(const r of i)if(null!=(n=null==(t=o.get(r))?void 0:t.isSupported)&&n.call(t))return r;return null}selectAdapter(e,t=[]){let n=e;"best-available"===e&&(n=this.getBestAvailableAdapterType(t));const i=this._getAdapterMap(t);return n&&i.get(n)||null}enforceWebGL2(e=!0,t=[]){var n;const i=this._getAdapterMap(t).get("webgl");i||ni.warn("enforceWebGL2: webgl adapter not found")(),null==(n=null==i?void 0:i.enforceWebGL2)||n.call(i,e)}setDefaultDeviceProps(t){Object.assign(e.defaultProps,t)}_getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const n of e)t.set(n.type,n);return t}_getTypeFromHandle(e,t=[]){return e instanceof WebGL2RenderingContext?"webgl":typeof GPUDevice<"u"&&e instanceof GPUDevice||null!=e&&e.queue?"webgpu":null===e?"null":(e instanceof WebGLRenderingContext?ni.warn("WebGL1 is not supported",e)():ni.warn("Unknown handle type",e)(),null)}};h(Fi,"defaultProps",{...Oi.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0});const zi=new Fi;class Ui{get pageLoaded(){return Hi||(Hi=Vi()||typeof window>"u"?Promise.resolve():new Promise(e=>window.addEventListener("load",()=>e()))),Hi}}const $i=zn()&&typeof document<"u",Vi=()=>$i&&"complete"===document.readyState;let Hi=null;const Gi=class e extends ri{get[Symbol.toStringTag](){return"Sampler"}constructor(t,n){super(t,n=e.normalizeProps(t,n),e.defaultProps)}static normalizeProps(e,t){return t}};h(Gi,"defaultProps",{...ri.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Wi=Gi;const ji={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"},Yi=class e extends ri{constructor(t,n){if(super(t,n=e.normalizeProps(t,n),e.defaultProps),h(this,"dimension"),h(this,"baseDimension"),h(this,"format"),h(this,"width"),h(this,"height"),h(this,"depth"),h(this,"mipLevels"),h(this,"updateTimestamp"),this.dimension=this.props.dimension,this.baseDimension=ji[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,void 0===this.props.width||void 0===this.props.height)if(t.isExternalImage(n.data)){const e=t.getExternalImageSize(n.data);this.width=(null==e?void 0:e.width)||1,this.height=(null==e?void 0:e.height)||1}else this.width=1,this.height=1,(void 0===this.props.width||void 0===this.props.height)&&ni.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}setSampler(e){this.sampler=e instanceof Wi?e:this.device.createSampler(e)}clone(e){return this.device.createTexture({...this.props,...e})}static normalizeProps(e,t){const n={...t},{width:i,height:o}=n;return"number"==typeof i&&(n.width=Math.max(1,Math.ceil(i))),"number"==typeof o&&(n.height=Math.max(1,Math.ceil(o))),n}_initializeData(e){this.device.isExternalImage(e)?this.copyExternalImage({image:e,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):e&&this.copyImageData({data:e,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(t){const{width:n,height:i,depth:o}=this,r={...e.defaultCopyDataOptions,width:n,height:i,depth:o,...t},s=this.device.getTextureFormatInfo(this.format);if(!t.bytesPerRow&&!s.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return r.bytesPerRow=t.bytesPerRow||n*(s.bytesPerPixel||4),r.rowsPerImage=t.rowsPerImage||i,r}_normalizeCopyExternalImageOptions(t){const n=this.device.getExternalImageSize(t.image),i={...e.defaultCopyExternalImageOptions,...n,...t};return i.width=Math.min(i.width,this.width-i.x),i.height=Math.min(i.height,this.height-i.y),i}};h(Yi,"SAMPLE",4),h(Yi,"STORAGE",8),h(Yi,"RENDER",16),h(Yi,"COPY_SRC",1),h(Yi,"COPY_DST",2),h(Yi,"TEXTURE",4),h(Yi,"RENDER_ATTACHMENT",16),h(Yi,"defaultProps",{...ri.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:Yi.TEXTURE|Yi.RENDER_ATTACHMENT|Yi.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0}),h(Yi,"defaultCopyDataOptions",{data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"}),h(Yi,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let qi=Yi;const Xi=class e extends ri{get[Symbol.toStringTag](){return"TextureView"}constructor(t,n){super(t,n,e.defaultProps)}};h(Xi,"defaultProps",{...ri.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Ki=Xi;function Zi(e,t,n,i){if(null!=i&&i.inlineSource){const i=function(e,t){let n="";for(let i=t-2;i<=t;i++){const o=e[i-1];void 0!==o&&(n+=Qi(o,t,undefined))}return n}(t,n);return`\n${i}${e.linePos>0?`${" ".repeat(e.linePos+5)}^^^\n`:""}${e.type.toUpperCase()}: ${e.message}\n\n`}const o="error"===e.type?"red":"#8B4000";return null!=i&&i.html?`<div class='luma-compiler-log-error' style="color:${o};"><b> ${e.type.toUpperCase()}: ${e.message}</b></div>`:`${e.type.toUpperCase()}: ${e.message}`}function Qi(e,t,n){const i=null!=n&&n.html?function(e){return e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}(e):e;return`${function(e){let t="";for(let n=e.length;n<4;++n)t+=" ";return t+e}(String(t))}: ${i}${null!=n&&n.html?"<br/>":"\n"}`}const Ji=class e extends ri{constructor(t,n){super(t,{id:to(n={...n,debugShaders:n.debugShaders||t.props.debugShaders||"errors"}),...n},e.defaultProps),h(this,"stage"),h(this,"source"),h(this,"compilationStatus","pending"),this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if("success"===this.compilationStatus)return}const t=await this.getCompilationInfo();"warnings"===e&&0===(null==t?void 0:t.length)||this._displayShaderLog(t,this.id)}_displayShaderLog(e,t){var n;if(typeof document>"u"||null==document||!document.createElement)return;const i=t,o=`${this.stage} shader "${i}"`;let r=function(e,t,n){let i="";const o=t.split(/\r?\n/),r=e.slice().sort((e,t)=>e.lineNum-t.lineNum);switch((null==n?void 0:n.showSourceCode)||"no"){case"all":let t=0;for(let e=1;e<=o.length;e++)for(i+=Qi(o[e-1],e,n);r.length>t&&r[t].lineNum===e;){const e=r[t++];i+=Zi(e,o,e.lineNum,{...n,inlineSource:!1})}for(;r.length>t;)i+=Zi(r[t++],[],0,{...n,inlineSource:!1});return i;case"issues":case"no":for(const r of e)i+=Zi(r,o,r.lineNum,{inlineSource:"no"!==(null==n?void 0:n.showSourceCode)});return i}}(e,this.source,{showSourceCode:"all",html:!0});const s=this.getTranslatedSource();s&&(r+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${s}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`\n<h1>Compilation error in ${o}</h1><br /><br />\n<code style="user-select:text;"><pre>\n${r}\n</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a),null==(n=document.getElementsByClassName("luma-compiler-log-error")[0])||n.scrollIntoView(),a.onclick=()=>{const e=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(e)}}};h(Ji,"defaultProps",{...ri.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let eo=Ji;function to(e){return function(e,t="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return n?n[1]:t}(e.source)||e.id||oi(`unnamed ${e.stage}-shader`)}const no=class e extends ri{constructor(t,n){super(t,n,e.defaultProps),h(this,"shaderLayout"),h(this,"bufferLayout"),h(this,"linkStatus","pending"),h(this,"hash",""),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}};h(no,"defaultProps",{...ri.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}});let io=no;const oo=class e extends ri{constructor(t,n){super(t,n,e.defaultProps),h(this,"hash",""),h(this,"shaderLayout"),this.shaderLayout=n.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};h(oo,"defaultProps",{...ri.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let ro=oo;function so(e){return co[e]}const ao={f32:4,f16:2,i32:4,u32:4},lo={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},co={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}};function uo(e,t){const n={};for(const i of e.attributes){const o=po(e,t,i.name);o&&(n[i.name]=o)}return n}function ho(e,t,n=16){const i=uo(e,t),o=new Array(n).fill(null);for(const r of Object.values(i))o[r.location]=r;return o}function po(e,t,n){const i=function(e,t){const n=e.attributes.find(e=>e.name===t);return n||ni.warn(`shader layout attribute "${t}" not present in shader`),n||null}(e,n),o=function(e,t){!function(e){for(const t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&ni.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}(e);let n=function(e,t){for(const n of e)if(n.format&&n.name===t)return{attributeName:n.name,bufferName:t,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}(e,t);return n||(n=function(e,t){var n;for(const i of e){let e=i.byteStride;if("number"!=typeof i.byteStride)for(const t of i.attributes||[])e+=pi(t.format).byteLength;const o=null==(n=i.attributes)?void 0:n.find(e=>e.attribute===t);if(o)return{attributeName:o.attribute,bufferName:i.name,stepMode:i.stepMode,vertexFormat:o.format,byteOffset:o.byteOffset,byteStride:e}}return null}(e,t),n)?n:(ni.warn(`layout for attribute "${t}" not present in buffer layout`),null)}(t,n);if(!i)return null;const r=function(e){const[t,n]=lo[e];return{primitiveType:t,components:n,byteLength:ao[t]*n,integer:"i32"===t||"u32"===t,signed:"u32"!==t}}(i.type),s=function(e){let t;switch(e.primitiveType){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e.components<=2?"float16x2":"float16x4"}return 1===e.components?t:`${t}x${e.components}`}(r),a=(null==o?void 0:o.vertexFormat)||s,l=pi(a);return{attributeName:(null==o?void 0:o.attributeName)||i.name,bufferName:(null==o?void 0:o.bufferName)||i.name,location:i.location,shaderType:i.type,primitiveType:r.primitiveType,shaderComponents:r.components,vertexFormat:a,bufferDataType:l.type,bufferComponents:l.components,normalized:l.normalized,integer:r.integer,stepMode:(null==o?void 0:o.stepMode)||i.stepMode||"vertex",byteOffset:(null==o?void 0:o.byteOffset)||0,byteStride:(null==o?void 0:o.byteStride)||0}}let fo;function mo(e){return(!fo||fo.byteLength<e)&&(fo=new ArrayBuffer(e)),fo}function _o(e,t){return new e(mo(e.BYTES_PER_ELEMENT*t),0,t)}function go(e){return Array.isArray(e)?0===e.length||"number"==typeof e[0]:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(e)}class yo{constructor(e,t={}){h(this,"layout",{}),h(this,"byteLength");let n=0;for(const[o,r]of Object.entries(e)){const e=so(r),{type:i,components:s}=e,a=s*((null==t?void 0:t[o])??1);n=ci(n,a);const l=n;n+=a,this.layout[o]={type:i,size:a,offset:l}}n+=(4-n%4)%4;const i=4*n;this.byteLength=Math.max(i,1024)}getData(e){const t=mo(this.byteLength),n={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(const[i,o]of Object.entries(e)){const e=this.layout[i];if(!e){ni.warn(`Supplied uniform value ${i} not present in uniform block layout`)();continue}const{type:t,size:r,offset:s}=e,a=n[t];if(1===r){if("number"!=typeof o&&"boolean"!=typeof o){ni.warn(`Supplied value for single component uniform ${i} is not a number: ${o}`)();continue}a[s]=Number(o)}else{if(!go(o)){ni.warn(`Supplied value for multi component / array uniform ${i} is not a numeric array: ${o}`)();continue}a.set(o,s)}}return new Uint8Array(t,0,this.byteLength)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}class bo{constructor(e){var t;if(h(this,"name"),h(this,"uniforms",{}),h(this,"modifiedUniforms",{}),h(this,"modified",!0),h(this,"bindingLayout",{}),h(this,"needsRedraw","initialized"),this.name=(null==e?void 0:e.name)||"unnamed",null!=e&&e.name&&null!=e&&e.shaderLayout){const n=null==(t=null==e?void 0:e.shaderLayout.bindings)?void 0:t.find(t=>"uniform"===t.type&&t.name===(null==e?void 0:e.name));if(!n)throw new Error(null==e?void 0:e.name);const i=n;for(const e of i.uniforms||[])this.bindingLayout[e.name]=e}}setUniforms(e){for(const[t,n]of Object.entries(e))this._setUniform(t,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){(function(e,t){if(e!==t)return!1;const n=e,i=t;if(!go(n))return!1;if(go(i)&&n.length===i.length)for(let o=0;o<n.length;++o)if(i[o]!==n[o])return!1;return!0})(this.uniforms[e],t)||(this.uniforms[e]=function(e){return go(e)?e.slice():e}(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}let vo=class{constructor(e){h(this,"uniformBlocks",new Map),h(this,"uniformBufferLayouts",new Map),h(this,"uniformBuffers",new Map);for(const[t,n]of Object.entries(e)){const e=t,i=new yo(n.uniformTypes??{},n.uniformSizes??{});this.uniformBufferLayouts.set(e,i);const o=new bo({name:t});o.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(e,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var t;for(const[n,i]of Object.entries(e))null==(t=this.uniformBlocks.get(n))||t.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){var t;return(null==(t=this.uniformBufferLayouts.get(e))?void 0:t.byteLength)||0}getUniformBufferData(e){var t,n;const i=(null==(t=this.uniformBlocks.get(e))?void 0:t.getAllUniforms())||{};return null==(n=this.uniformBufferLayouts.get(e))?void 0:n.getData(i)}createUniformBuffer(e,t,n){n&&this.setUniforms(n);const i=this.getUniformBufferByteLength(t),o=e.createBuffer({usage:ai.UNIFORM|ai.COPY_DST,byteLength:i}),r=this.getUniformBufferData(t);return o.write(r),o}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const n=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:ai.UNIFORM|ai.COPY_DST,byteLength:n});this.uniformBuffers.set(t,i)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(t);e||(e=n)}return e&&ni.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var t;const n=this.uniformBlocks.get(e);let i=this.uniformBuffers.get(e),o=!1;if(i&&null!=n&&n.needsRedraw){o||(o=n.needsRedraw);const r=this.getUniformBufferData(e);i=this.uniformBuffers.get(e),null==i||i.write(r);const s=null==(t=this.uniformBlocks.get(e))?void 0:t.getAllUniforms();ni.log(4,`Writing to uniform buffer ${String(e)}`,r,s)()}return o}};var xo;!function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.R16_EXT=33322]="R16_EXT",e[e.RG16_EXT=33324]="RG16_EXT",e[e.RGB16_EXT=32852]="RGB16_EXT",e[e.RGBA16_EXT=32859]="RGBA16_EXT",e[e.R16_SNORM_EXT=36760]="R16_SNORM_EXT",e[e.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",e[e.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",e[e.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",e[e.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",e[e.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",e[e.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",e[e.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",e[e.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",e[e.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",e[e.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",e[e.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",e[e.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",e[e.LINE_WEBGL=6913]="LINE_WEBGL",e[e.FILL_WEBGL=6914]="FILL_WEBGL",e[e.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",e[e.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",e[e.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",e[e.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",e[e.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",e[e.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",e[e.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",e[e.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",e[e.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",e[e.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",e[e.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",e[e.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",e[e.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",e[e.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",e[e.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",e[e.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",e[e.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",e[e.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",e[e.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",e[e.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",e[e.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",e[e.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",e[e.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",e[e.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"}(xo||(xo={}));const wo={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},So=e=>({drawBuffersWEBGL:t=>e.drawBuffers(t),COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),Eo=e=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES:()=>e.createVertexArray(),deleteVertexArrayOES:t=>e.deleteVertexArray(t),isVertexArrayOES:t=>e.isVertexArray(t),bindVertexArrayOES:t=>e.bindVertexArray(t)}),To=e=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE:(...t)=>e.drawArraysInstanced(...t),drawElementsInstancedANGLE:(...t)=>e.drawElementsInstanced(...t),vertexAttribDivisorANGLE:(...t)=>e.vertexAttribDivisor(...t)});async function Co(e,t){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",e),new Promise((t,o)=>{i.onload=t,i.onerror=t=>o(new Error(`Unable to load script '${e}': ${t}`)),n.appendChild(i)})}let Io=null,Ao=!1;const ko={debugSpectorJS:ni.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};function Lo(e){var t;if(!(e={...ko,...e}).debugSpectorJS)return null;if(!Io&&globalThis.SPECTOR&&(null==(t=globalThis.luma)||!t.spector)){ni.probe(1,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;Io=new e,globalThis.luma&&(globalThis.luma.spector=Io)}if(!Io)return null;if(Ao||(Ao=!0,Io.spyCanvases(),null==Io||Io.onCaptureStarted.add(e=>ni.info("Spector capture started:",e)()),null==Io||Io.onCapture.add(e=>{ni.info("Spector capture complete:",e)(),null==Io||Io.getResultUI(),null==Io||Io.resultView.display(),null==Io||Io.resultView.addCapture(e)})),e.gl){const t=e.gl,n=t.device;null==Io||Io.startCapture(e.gl,500),t.device=n,new Promise(e=>setTimeout(e,2e3)).then(e=>{ni.info("Spector capture stopped after 2 seconds")(),null==Io||Io.stopCapture()})}return Io}function Ro(e){return e.luma=e.luma||{},e.luma}function Po(e,t={}){return t.debugWebGL||t.traceWebGL?function(e,t){if(!globalThis.WebGLDebugUtils)return ni.warn("webgl-debug not loaded")(),e;const n=Ro(e);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...xo,...e});const i=globalThis.WebGLDebugUtils.makeDebugContext(e,Mo.bind(null,t),No.bind(null,t));for(const s in xo)!(s in i)&&"number"==typeof xo[s]&&(i[s]=xo[s]);class o{}Object.setPrototypeOf(i,Object.getPrototypeOf(e)),Object.setPrototypeOf(o,i);const r=Object.create(o);return n.realContext=e,n.debugContext=r,r.debug=!0,r}(e,t):function(e){const t=Ro(e);return t.realContext?t.realContext:e}(e)}function Do(e,t){t=Array.from(t).map(e=>void 0===e?"undefined":e);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${e}(${n})`}function Mo(e,t,n,i){i=Array.from(i).map(e=>void 0===e?"undefined":e);const o=`${globalThis.WebGLDebugUtils.glEnumToString(t)} in gl.${n}(${globalThis.WebGLDebugUtils.glFunctionArgsToString(n,i)})`;ni.error(o)()}function No(e,t,n){let i="";ni.level>=1&&(i=Do(t,n),e.traceWebGL&&ni.log(1,i)());for(const o of n)void 0===o&&(i=i||Do(t,n))}const Oo=new class extends Ui{constructor(){super(),h(this,"type","webgl"),Oi.defaultProps={...Oi.defaultProps,...ko}}enforceWebGL2(e){!function(e=!0){const t=HTMLCanvasElement.prototype;if(!e&&t.originalGetContext)return t.getContext=t.originalGetContext,void(t.originalGetContext=void 0);t.originalGetContext=t.getContext,t.getContext=function(e,t){if("webgl"===e||"experimental-webgl"===e){const e=this.originalGetContext("webgl2",t);return e instanceof HTMLElement&&function(e){e.getExtension("EXT_color_buffer_float");const t={...wo,WEBGL_disjoint_timer_query:e.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:So(e),OES_vertex_array_object:Eo(e),ANGLE_instanced_arrays:To(e)},n=e.getExtension;e.getExtension=function(i){return n.call(e,i)||(i in t?t[i]:null)};const i=e.getSupportedExtensions;e.getSupportedExtensions=function(){const n=i.apply(e)||[];return null==n?void 0:n.concat(Object.keys(t))}}(e),e}return this.originalGetContext(e,t)}}(e)}isSupported(){return typeof WebGL2RenderingContext<"u"}isDeviceHandle(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext||(typeof WebGLRenderingContext<"u"&&e instanceof WebGLRenderingContext&&ni.warn("WebGL1 is not supported",e)(),!1)}async attach(e,t={}){const{WebGLDevice:n}=await c(async()=>{const{WebGLDevice:e}=await import("./webgl-device-QoBMYpnS-DXxDg4EN.js");return{WebGLDevice:e}},[]);if(e instanceof n)return e;if((null==e?void 0:e.device)instanceof n)return e.device;if(!function(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext||!(!e||!Number.isFinite(e._version))}(e))throw new Error("Invalid WebGL2RenderingContext");const i=!0===t.createCanvasContext?{}:t.createCanvasContext;return new n({...t,_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1,...i}})}async create(e={}){const{WebGLDevice:t}=await c(async()=>{const{WebGLDevice:e}=await import("./webgl-device-QoBMYpnS-DXxDg4EN.js");return{WebGLDevice:e}},[]);ni.groupCollapsed(1,"WebGLDevice created")();try{const n=[];(e.debugWebGL||e.debug)&&n.push(async function(){zn()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await Co("https://unpkg.com/webgl-debug@2.0.1/index.js"))}()),e.debugSpectorJS&&n.push(async function(e){if(!globalThis.SPECTOR)try{await Co(e.debugSpectorJSUrl||ko.debugSpectorJSUrl)}catch(mC){ni.warn(String(mC))}}(e));const i=await Promise.allSettled(n);for(const e of i)"rejected"===e.status&&ni.error(`Failed to initialize debug libraries ${e.reason}`)();const o=new t(e),r=`${o._reused?"Reusing":"Created"} device with WebGL2 ${o.props.debug?"debug ":""}context: ${o.info.vendor}, ${o.info.renderer} for canvas: ${o.canvasContext.id}`;return ni.probe(1,r)(),ni.table(1,o.info)(),o}finally{ni.groupEnd(1)()}}},Bo=void 0,Fo="#222222",zo={enableSimulation:!0,spaceSize:8192,pointSizeScale:1,linkWidthScale:1,linkArrowsSizeScale:1,renderLinks:!0,curvedLinks:!1,curvedLinkSegments:19,curvedLinkWeight:.8,curvedLinkControlPointDistance:.5,linkArrows:!1,linkVisibilityDistanceRange:[50,150],linkVisibilityMinTransparency:.25,hoveredPointCursor:"auto",hoveredLinkCursor:"auto",renderHoveredPointRing:!1,hoveredPointRingColor:"white",hoveredLinkColor:void 0,hoveredLinkWidthIncrease:5,focusedPointRingColor:"white",focusedPointIndex:void 0,simulation:{decay:5e3,gravity:.25,center:0,repulsion:1,repulsionTheta:1.15,linkSpring:1,linkDistance:10,linkDistRandomVariationRange:[1,1.2],repulsionFromMouse:2,friction:.85,cluster:.1},showFPSMonitor:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||2,scalePointsOnZoom:!1,scaleLinksOnZoom:!1,enableZoom:!0,enableSimulationDuringZoom:!1,enableDrag:!1,fitViewOnInit:!0,fitViewDelay:250,fitViewPadding:.1,fitViewDuration:250,pointSamplingDistance:150,attribution:"",rescalePositions:void 0,enableRightClickRepulsion:!1},{entries:Uo,setPrototypeOf:$o,isFrozen:Vo,getPrototypeOf:Ho,getOwnPropertyDescriptor:Go}=Object;let{freeze:Wo,seal:jo,create:Yo}=Object,{apply:qo,construct:Xo}=typeof Reflect<"u"&&Reflect;Wo||(Wo=function(e){return e}),jo||(jo=function(e){return e}),qo||(qo=function(e,t,n){return e.apply(t,n)}),Xo||(Xo=function(e,t){return new e(...t)});const Ko=ur(Array.prototype.forEach),Zo=ur(Array.prototype.lastIndexOf),Qo=ur(Array.prototype.pop),Jo=ur(Array.prototype.push),er=ur(Array.prototype.splice),tr=ur(String.prototype.toLowerCase),nr=ur(String.prototype.toString),ir=ur(String.prototype.match),or=ur(String.prototype.replace),rr=ur(String.prototype.indexOf),sr=ur(String.prototype.trim),ar=ur(Object.prototype.hasOwnProperty),lr=ur(RegExp.prototype.test),cr=function(e){return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xo(e,n)}}(TypeError);function ur(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return qo(e,t,i)}}function hr(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:tr;$o&&$o(e,null);let i=t.length;for(;i--;){let o=t[i];if("string"==typeof o){const e=n(o);e!==o&&(Vo(t)||(t[i]=e),o=e)}e[o]=!0}return e}function dr(e){for(let t=0;t<e.length;t++)ar(e,t)||(e[t]=null);return e}function pr(e){const t=Yo(null);for(const[n,i]of Uo(e))ar(e,n)&&(Array.isArray(i)?t[n]=dr(i):i&&"object"==typeof i&&i.constructor===Object?t[n]=pr(i):t[n]=i);return t}function fr(e,t){for(;null!==e;){const n=Go(e,t);if(n){if(n.get)return ur(n.get);if("function"==typeof n.value)return ur(n.value)}e=Ho(e)}return function(){return null}}const mr=Wo(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),_r=Wo(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),gr=Wo(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),yr=Wo(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),br=Wo(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),vr=Wo(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),xr=Wo(["#text"]),wr=Wo(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Sr=Wo(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Er=Wo(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Tr=Wo(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Cr=jo(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Ir=jo(/<%[\w\W]*|[\w\W]*%>/gm),Ar=jo(/\$\{[\w\W]*/gm),kr=jo(/^data-[\-\w.\u00B7-\uFFFF]+$/),Lr=jo(/^aria-[\-\w]+$/),Rr=jo(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Pr=jo(/^(?:\w+script|data):/i),Dr=jo(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Mr=jo(/^html$/i),Nr=jo(/^[a-z][.\w]*(-[.\w]+)+$/i);var Or=Object.freeze({__proto__:null,ARIA_ATTR:Lr,ATTR_WHITESPACE:Dr,CUSTOM_ELEMENT:Nr,DATA_ATTR:kr,DOCTYPE_NAME:Mr,ERB_EXPR:Ir,IS_ALLOWED_URI:Rr,IS_SCRIPT_OR_DATA:Pr,MUSTACHE_EXPR:Cr,TMPLIT_EXPR:Ar});var Br=function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:typeof window>"u"?null:window;const n=t=>e(t);if(n.version="3.2.6",n.removed=[],!t||!t.document||9!==t.document.nodeType||!t.Element)return n.isSupported=!1,n;let{document:i}=t;const o=i,r=o.currentScript,{DocumentFragment:s,HTMLTemplateElement:a,Node:l,Element:c,NodeFilter:u,NamedNodeMap:h=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:d,DOMParser:p,trustedTypes:f}=t,m=c.prototype,_=fr(m,"cloneNode"),g=fr(m,"remove"),y=fr(m,"nextSibling"),b=fr(m,"childNodes"),v=fr(m,"parentNode");if("function"==typeof a){const e=i.createElement("template");e.content&&e.content.ownerDocument&&(i=e.content.ownerDocument)}let x,w="";const{implementation:S,createNodeIterator:E,createDocumentFragment:T,getElementsByTagName:C}=i,{importNode:I}=o;let A={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};n.isSupported="function"==typeof Uo&&"function"==typeof v&&S&&void 0!==S.createHTMLDocument;const{MUSTACHE_EXPR:k,ERB_EXPR:L,TMPLIT_EXPR:R,DATA_ATTR:P,ARIA_ATTR:D,IS_SCRIPT_OR_DATA:M,ATTR_WHITESPACE:N,CUSTOM_ELEMENT:O}=Or;let{IS_ALLOWED_URI:B}=Or,F=null;const z=hr({},[...mr,..._r,...gr,...br,...xr]);let U=null;const $=hr({},[...wr,...Sr,...Er,...Tr]);let V=Object.seal(Yo(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),H=null,G=null,W=!0,j=!0,Y=!1,q=!0,X=!1,K=!0,Z=!1,Q=!1,J=!1,ee=!1,te=!1,ne=!1,ie=!0,oe=!1,re=!0,se=!1,ae={},le=null;const ce=hr({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let ue=null;const he=hr({},["audio","video","img","source","image","track"]);let de=null;const pe=hr({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),fe="http://www.w3.org/1998/Math/MathML",me="http://www.w3.org/2000/svg",_e="http://www.w3.org/1999/xhtml";let ge=_e,ye=!1,be=null;const ve=hr({},[fe,me,_e],nr);let xe=hr({},["mi","mo","mn","ms","mtext"]),we=hr({},["annotation-xml"]);const Se=hr({},["title","style","font","a","script"]);let Ee=null;const Te=["application/xhtml+xml","text/html"];let Ce=null,Ie=null;const Ae=i.createElement("form"),ke=function(e){return e instanceof RegExp||e instanceof Function},Le=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!Ie||Ie!==e){if((!e||"object"!=typeof e)&&(e={}),e=pr(e),Ee=-1===Te.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,Ce="application/xhtml+xml"===Ee?nr:tr,F=ar(e,"ALLOWED_TAGS")?hr({},e.ALLOWED_TAGS,Ce):z,U=ar(e,"ALLOWED_ATTR")?hr({},e.ALLOWED_ATTR,Ce):$,be=ar(e,"ALLOWED_NAMESPACES")?hr({},e.ALLOWED_NAMESPACES,nr):ve,de=ar(e,"ADD_URI_SAFE_ATTR")?hr(pr(pe),e.ADD_URI_SAFE_ATTR,Ce):pe,ue=ar(e,"ADD_DATA_URI_TAGS")?hr(pr(he),e.ADD_DATA_URI_TAGS,Ce):he,le=ar(e,"FORBID_CONTENTS")?hr({},e.FORBID_CONTENTS,Ce):ce,H=ar(e,"FORBID_TAGS")?hr({},e.FORBID_TAGS,Ce):pr({}),G=ar(e,"FORBID_ATTR")?hr({},e.FORBID_ATTR,Ce):pr({}),ae=!!ar(e,"USE_PROFILES")&&e.USE_PROFILES,W=!1!==e.ALLOW_ARIA_ATTR,j=!1!==e.ALLOW_DATA_ATTR,Y=e.ALLOW_UNKNOWN_PROTOCOLS||!1,q=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,X=e.SAFE_FOR_TEMPLATES||!1,K=!1!==e.SAFE_FOR_XML,Z=e.WHOLE_DOCUMENT||!1,ee=e.RETURN_DOM||!1,te=e.RETURN_DOM_FRAGMENT||!1,ne=e.RETURN_TRUSTED_TYPE||!1,J=e.FORCE_BODY||!1,ie=!1!==e.SANITIZE_DOM,oe=e.SANITIZE_NAMED_PROPS||!1,re=!1!==e.KEEP_CONTENT,se=e.IN_PLACE||!1,B=e.ALLOWED_URI_REGEXP||Rr,ge=e.NAMESPACE||_e,xe=e.MATHML_TEXT_INTEGRATION_POINTS||xe,we=e.HTML_INTEGRATION_POINTS||we,V=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&ke(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(V.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&ke(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(V.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(V.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),X&&(j=!1),te&&(ee=!0),ae&&(F=hr({},xr),U=[],!0===ae.html&&(hr(F,mr),hr(U,wr)),!0===ae.svg&&(hr(F,_r),hr(U,Sr),hr(U,Tr)),!0===ae.svgFilters&&(hr(F,gr),hr(U,Sr),hr(U,Tr)),!0===ae.mathMl&&(hr(F,br),hr(U,Er),hr(U,Tr))),e.ADD_TAGS&&(F===z&&(F=pr(F)),hr(F,e.ADD_TAGS,Ce)),e.ADD_ATTR&&(U===$&&(U=pr(U)),hr(U,e.ADD_ATTR,Ce)),e.ADD_URI_SAFE_ATTR&&hr(de,e.ADD_URI_SAFE_ATTR,Ce),e.FORBID_CONTENTS&&(le===ce&&(le=pr(le)),hr(le,e.FORBID_CONTENTS,Ce)),re&&(F["#text"]=!0),Z&&hr(F,["html","head","body"]),F.table&&(hr(F,["tbody"]),delete H.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw cr('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw cr('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');x=e.TRUSTED_TYPES_POLICY,w=x.createHTML("")}else void 0===x&&(x=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let n=null;const i="data-tt-policy-suffix";t&&t.hasAttribute(i)&&(n=t.getAttribute(i));const o="dompurify"+(n?"#"+n:"");try{return e.createPolicy(o,{createHTML:e=>e,createScriptURL:e=>e})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}}(f,r)),null!==x&&"string"==typeof w&&(w=x.createHTML(""));Wo&&Wo(e),Ie=e}},Re=hr({},[..._r,...gr,...yr]),Pe=hr({},[...br,...vr]),De=function(e){Jo(n.removed,{element:e});try{v(e).removeChild(e)}catch{g(e)}},Me=function(e,t){try{Jo(n.removed,{attribute:t.getAttributeNode(e),from:t})}catch{Jo(n.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if(ee||te)try{De(t)}catch{}else try{t.setAttribute(e,"")}catch{}},Ne=function(e){let t=null,n=null;if(J)e="<remove></remove>"+e;else{const t=ir(e,/^[\r\n\t ]+/);n=t&&t[0]}"application/xhtml+xml"===Ee&&ge===_e&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const o=x?x.createHTML(e):e;if(ge===_e)try{t=(new p).parseFromString(o,Ee)}catch{}if(!t||!t.documentElement){t=S.createDocument(ge,"template",null);try{t.documentElement.innerHTML=ye?w:o}catch{}}const r=t.body||t.documentElement;return e&&n&&r.insertBefore(i.createTextNode(n),r.childNodes[0]||null),ge===_e?C.call(t,Z?"html":"body")[0]:Z?t.documentElement:r},Oe=function(e){return E.call(e.ownerDocument||e,e,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},Be=function(e){return e instanceof d&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof h)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},Fe=function(e){return"function"==typeof l&&e instanceof l};function ze(e,t,i){Ko(e,e=>{e.call(n,t,i,Ie)})}const Ue=function(e){let t=null;if(ze(A.beforeSanitizeElements,e,null),Be(e))return De(e),!0;const i=Ce(e.nodeName);if(ze(A.uponSanitizeElement,e,{tagName:i,allowedTags:F}),K&&e.hasChildNodes()&&!Fe(e.firstElementChild)&&lr(/<[/\w!]/g,e.innerHTML)&&lr(/<[/\w!]/g,e.textContent)||7===e.nodeType||K&&8===e.nodeType&&lr(/<[/\w]/g,e.data))return De(e),!0;if(!F[i]||H[i]){if(!H[i]&&Ve(i)&&(V.tagNameCheck instanceof RegExp&&lr(V.tagNameCheck,i)||V.tagNameCheck instanceof Function&&V.tagNameCheck(i)))return!1;if(re&&!le[i]){const t=v(e)||e.parentNode,n=b(e)||e.childNodes;if(n&&t)for(let i=n.length-1;i>=0;--i){const o=_(n[i],!0);o.__removalCount=(e.__removalCount||0)+1,t.insertBefore(o,y(e))}}return De(e),!0}return e instanceof c&&!function(e){let t=v(e);(!t||!t.tagName)&&(t={namespaceURI:ge,tagName:"template"});const n=tr(e.tagName),i=tr(t.tagName);return!!be[e.namespaceURI]&&(e.namespaceURI===me?t.namespaceURI===_e?"svg"===n:t.namespaceURI===fe?"svg"===n&&("annotation-xml"===i||xe[i]):!!Re[n]:e.namespaceURI===fe?t.namespaceURI===_e?"math"===n:t.namespaceURI===me?"math"===n&&we[i]:!!Pe[n]:e.namespaceURI===_e?!(t.namespaceURI===me&&!we[i]||t.namespaceURI===fe&&!xe[i])&&!Pe[n]&&(Se[n]||!Re[n]):!("application/xhtml+xml"!==Ee||!be[e.namespaceURI]))}(e)||("noscript"===i||"noembed"===i||"noframes"===i)&&lr(/<\/no(script|embed|frames)/i,e.innerHTML)?(De(e),!0):(X&&3===e.nodeType&&(t=e.textContent,Ko([k,L,R],e=>{t=or(t,e," ")}),e.textContent!==t&&(Jo(n.removed,{element:e.cloneNode()}),e.textContent=t)),ze(A.afterSanitizeElements,e,null),!1)},$e=function(e,t,n){if(ie&&("id"===t||"name"===t)&&(n in i||n in Ae))return!1;if((!j||G[t]||!lr(P,t))&&(!W||!lr(D,t)))if(!U[t]||G[t]){if(!(Ve(e)&&(V.tagNameCheck instanceof RegExp&&lr(V.tagNameCheck,e)||V.tagNameCheck instanceof Function&&V.tagNameCheck(e))&&(V.attributeNameCheck instanceof RegExp&&lr(V.attributeNameCheck,t)||V.attributeNameCheck instanceof Function&&V.attributeNameCheck(t))||"is"===t&&V.allowCustomizedBuiltInElements&&(V.tagNameCheck instanceof RegExp&&lr(V.tagNameCheck,n)||V.tagNameCheck instanceof Function&&V.tagNameCheck(n))))return!1}else if(!de[t]&&!lr(B,or(n,N,""))&&("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==rr(n,"data:")||!ue[e])&&(!Y||lr(M,or(n,N,"")))&&n)return!1;return!0},Ve=function(e){return"annotation-xml"!==e&&ir(e,O)},He=function(e){ze(A.beforeSanitizeAttributes,e,null);const{attributes:t}=e;if(!t||Be(e))return;const i={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:U,forceKeepAttr:void 0};let o=t.length;for(;o--;){const r=t[o],{name:s,namespaceURI:a,value:l}=r,c=Ce(s),u=l;let h="value"===s?u:sr(u);if(i.attrName=c,i.attrValue=h,i.keepAttr=!0,i.forceKeepAttr=void 0,ze(A.uponSanitizeAttribute,e,i),h=i.attrValue,oe&&("id"===c||"name"===c)&&(Me(s,e),h="user-content-"+h),K&&lr(/((--!?|])>)|<\/(style|title)/i,h)){Me(s,e);continue}if(i.forceKeepAttr)continue;if(!i.keepAttr){Me(s,e);continue}if(!q&&lr(/\/>/i,h)){Me(s,e);continue}X&&Ko([k,L,R],e=>{h=or(h,e," ")});const d=Ce(e.nodeName);if($e(d,c,h)){if(x&&"object"==typeof f&&"function"==typeof f.getAttributeType&&!a)switch(f.getAttributeType(d,c)){case"TrustedHTML":h=x.createHTML(h);break;case"TrustedScriptURL":h=x.createScriptURL(h)}if(h!==u)try{a?e.setAttributeNS(a,s,h):e.setAttribute(s,h),Be(e)?De(e):Qo(n.removed)}catch{Me(s,e)}}else Me(s,e)}ze(A.afterSanitizeAttributes,e,null)},Ge=function e(t){let n=null;const i=Oe(t);for(ze(A.beforeSanitizeShadowDOM,t,null);n=i.nextNode();)ze(A.uponSanitizeShadowNode,n,null),Ue(n),He(n),n.content instanceof s&&e(n.content);ze(A.afterSanitizeShadowDOM,t,null)};return n.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=null,r=null,a=null,c=null;if(ye=!e,ye&&(e="\x3c!--\x3e"),"string"!=typeof e&&!Fe(e)){if("function"!=typeof e.toString)throw cr("toString is not a function");if("string"!=typeof(e=e.toString()))throw cr("dirty is not a string, aborting")}if(!n.isSupported)return e;if(Q||Le(t),n.removed=[],"string"==typeof e&&(se=!1),se){if(e.nodeName){const t=Ce(e.nodeName);if(!F[t]||H[t])throw cr("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof l)i=Ne("\x3c!----\x3e"),r=i.ownerDocument.importNode(e,!0),1===r.nodeType&&"BODY"===r.nodeName||"HTML"===r.nodeName?i=r:i.appendChild(r);else{if(!ee&&!X&&!Z&&-1===e.indexOf("<"))return x&&ne?x.createHTML(e):e;if(i=Ne(e),!i)return ee?null:ne?w:""}i&&J&&De(i.firstChild);const u=Oe(se?e:i);for(;a=u.nextNode();)Ue(a),He(a),a.content instanceof s&&Ge(a.content);if(se)return e;if(ee){if(te)for(c=T.call(i.ownerDocument);i.firstChild;)c.appendChild(i.firstChild);else c=i;return(U.shadowroot||U.shadowrootmode)&&(c=I.call(o,c,!0)),c}let h=Z?i.outerHTML:i.innerHTML;return Z&&F["!doctype"]&&i.ownerDocument&&i.ownerDocument.doctype&&i.ownerDocument.doctype.name&&lr(Mr,i.ownerDocument.doctype.name)&&(h="<!DOCTYPE "+i.ownerDocument.doctype.name+">\n"+h),X&&Ko([k,L,R],e=>{h=or(h,e," ")}),x&&ne?x.createHTML(h):h},n.setConfig=function(){Le(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),Q=!0},n.clearConfig=function(){Ie=null,Q=!1},n.isValidAttribute=function(e,t,n){Ie||Le({});const i=Ce(e),o=Ce(t);return $e(i,o,n)},n.addHook=function(e,t){"function"==typeof t&&Jo(A[e],t)},n.removeHook=function(e,t){if(void 0!==t){const n=Zo(A[e],t);return-1===n?void 0:er(A[e],n,1)[0]}return Qo(A[e])},n.removeHooks=function(e){A[e]=[]},n.removeAllHooks=function(){A={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},n}();const Fr=e=>Array.isArray(e),zr=e=>(e=>e instanceof Object)(e)&&!Fr(e)&&!(e=>"function"==typeof e)(e)&&!(e=>e instanceof Object&&"Function"!==e.constructor.name&&"Object"!==e.constructor.name)(e);function Ur(e){let t;if(Fr(e))t=e;else{const n=bt(e),i=null==n?void 0:n.rgb();t=[(null==i?void 0:i.r)||0,(null==i?void 0:i.g)||0,(null==i?void 0:i.b)||0,(null==n?void 0:n.opacity)??1]}return[t[0]/255,t[1]/255,t[2]/255,t[3]]}function $r(e,t,n=0,i=0,o,r){return e.readPixelsToArrayWebGL(t,{sourceX:n,sourceY:i,sourceWidth:o,sourceHeight:r})}function Vr(e){return null!=e&&!Number.isNaN(e)}class Hr{constructor(){this.enableSimulation=zo.enableSimulation,this.backgroundColor=Fo,this.spaceSize=zo.spaceSize,this.pointColor="#b3b3b3",this.pointDefaultColor=void 0,this.pointGreyoutOpacity=void 0,this.pointGreyoutColor=Bo,this.pointSize=4,this.pointDefaultSize=void 0,this.pointOpacity=1,this.pointSizeScale=zo.pointSizeScale,this.hoveredPointCursor=zo.hoveredPointCursor,this.hoveredLinkCursor=zo.hoveredLinkCursor,this.renderHoveredPointRing=zo.renderHoveredPointRing,this.hoveredPointRingColor=zo.hoveredPointRingColor,this.focusedPointRingColor=zo.focusedPointRingColor,this.focusedPointIndex=zo.focusedPointIndex,this.linkColor="#666666",this.linkDefaultColor=void 0,this.linkOpacity=1,this.linkGreyoutOpacity=.1,this.linkWidth=1,this.linkDefaultWidth=void 0,this.linkWidthScale=zo.linkWidthScale,this.hoveredLinkColor=zo.hoveredLinkColor,this.hoveredLinkWidthIncrease=zo.hoveredLinkWidthIncrease,this.renderLinks=zo.renderLinks,this.curvedLinks=zo.curvedLinks,this.curvedLinkSegments=zo.curvedLinkSegments,this.curvedLinkWeight=zo.curvedLinkWeight,this.curvedLinkControlPointDistance=zo.curvedLinkControlPointDistance,this.linkArrows=zo.linkArrows,this.linkDefaultArrows=void 0,this.linkArrowsSizeScale=zo.linkArrowsSizeScale,this.scaleLinksOnZoom=zo.scaleLinksOnZoom,this.linkVisibilityDistanceRange=zo.linkVisibilityDistanceRange,this.linkVisibilityMinTransparency=zo.linkVisibilityMinTransparency,this.simulationDecay=zo.simulation.decay,this.simulationGravity=zo.simulation.gravity,this.simulationCenter=zo.simulation.center,this.simulationRepulsion=zo.simulation.repulsion,this.simulationRepulsionTheta=zo.simulation.repulsionTheta,this.simulationLinkSpring=zo.simulation.linkSpring,this.simulationLinkDistance=zo.simulation.linkDistance,this.simulationLinkDistRandomVariationRange=zo.simulation.linkDistRandomVariationRange,this.simulationRepulsionFromMouse=zo.simulation.repulsionFromMouse,this.enableRightClickRepulsion=zo.enableRightClickRepulsion,this.simulationFriction=zo.simulation.friction,this.simulationCluster=zo.simulation.cluster,this.onSimulationStart=void 0,this.onSimulationTick=void 0,this.onSimulationEnd=void 0,this.onSimulationPause=void 0,this.onSimulationRestart=void 0,this.onSimulationUnpause=void 0,this.onClick=void 0,this.onPointClick=void 0,this.onLinkClick=void 0,this.onBackgroundClick=void 0,this.onMouseMove=void 0,this.onPointMouseOver=void 0,this.onPointMouseOut=void 0,this.onLinkMouseOver=void 0,this.onLinkMouseOut=void 0,this.onZoomStart=void 0,this.onZoom=void 0,this.onZoomEnd=void 0,this.onDragStart=void 0,this.onDrag=void 0,this.onDragEnd=void 0,this.showFPSMonitor=zo.showFPSMonitor,this.pixelRatio=zo.pixelRatio,this.scalePointsOnZoom=zo.scalePointsOnZoom,this.initialZoomLevel=void 0,this.enableZoom=zo.enableZoom,this.enableSimulationDuringZoom=zo.enableSimulationDuringZoom,this.enableDrag=zo.enableDrag,this.fitViewOnInit=zo.fitViewOnInit,this.fitViewDelay=zo.fitViewDelay,this.fitViewPadding=zo.fitViewPadding,this.fitViewDuration=zo.fitViewDuration,this.fitViewByPointsInRect=void 0,this.fitViewByPointIndices=void 0,this.randomSeed=void 0,this.pointSamplingDistance=zo.pointSamplingDistance,this.attribution=zo.attribution,this.rescalePositions=zo.rescalePositions}init(e){Object.keys(e).forEach(t=>{this.deepMergeConfig(this.getConfig(),e,t)})}deepMergeConfig(e,t,n){zr(e[n])&&zr(t[n])?Object.keys(t[n]).forEach(i=>{this.deepMergeConfig(e[n],t[n],i)}):e[n]=t[n]}getConfig(){return this}}function Gr(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}const Wr={number:{type:"number",validate:(e,t)=>Number.isFinite(e)&&"object"==typeof t&&(void 0===t.max||e<=t.max)&&(void 0===t.min||e>=t.min)},array:{type:"array",validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function jr(e){let t=Yr(e);if("object"!==t)return{value:e,...Wr[t],type:t};if("object"==typeof e)return e?void 0!==e.type?{...e,...Wr[e.type],type:e.type}:void 0===e.value?{type:"object",value:e}:(t=Yr(e.value),{...e,...Wr[t],type:t}):{type:"object",value:null};throw new Error("props")}function Yr(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const qr={vertex:"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n",fragment:"#ifdef MODULE_MATERIAL\n  fragColor = material_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  fragColor = lighting_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_FOG\n  fragColor = fog_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  fragColor = picking_filterHighlightColor(fragColor);\n  fragColor = picking_filterPickingColor(fragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"},Xr=/void\s+main\s*\([^)]*\)\s*\{\n?/,Kr=/}\n?[^{}]*$/,Zr=[],Qr="__LUMA_INJECT_DECLARATIONS__";function Jr(e){const t={vertex:{},fragment:{}};for(const n in e){let i=e[n];"string"==typeof i&&(i={order:0,injection:i}),t[es(n)][n]=i}return t}function es(e){const t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function ts(e,t,n,i=!1){const o="vertex"===t;for(const r in n){const t=n[r];t.sort((e,t)=>e.order-t.order),Zr.length=t.length;for(let e=0,n=t.length;e<n;++e)Zr[e]=t[e].injection;const i=`${Zr.join("\n")}\n`;switch(r){case"vs:#decl":o&&(e=e.replace(Qr,i));break;case"vs:#main-start":o&&(e=e.replace(Xr,e=>e+i));break;case"vs:#main-end":o&&(e=e.replace(Kr,e=>i+e));break;case"fs:#decl":o||(e=e.replace(Qr,i));break;case"fs:#main-start":o||(e=e.replace(Xr,e=>e+i));break;case"fs:#main-end":o||(e=e.replace(Kr,e=>i+e));break;default:e=e.replace(r,e=>e+i)}}return e=e.replace(Qr,""),i&&(e=e.replace(/\}\s*$/,e=>e+qr[t])),e}function ns(e){e.map(e=>function(e){if(e.instance)return;ns(e.dependencies||[]);const{propTypes:t={},deprecations:n=[],inject:i={}}=e,o={normalizedInjections:Jr(i),parsedDeprecations:os(n)};t&&(o.propValidators=function(e){const t={};for(const[n,i]of Object.entries(e))t[n]=jr(i);return t}(t)),e.instance=o;let r={};t&&(r=Object.entries(t).reduce((e,[t,n])=>{const i=null==n?void 0:n.value;return i&&(e[t]=i),e},{})),e.defaultUniforms={...e.defaultUniforms,...r}}(e))}function is(e,t,n){var i;null==(i=e.deprecations)||i.forEach(e=>{var i;null!=(i=e.regex)&&i.test(t)&&(e.deprecated?n.deprecated(e.old,e.new)():n.removed(e.old,e.new)())})}function os(e){return e.forEach(e=>{"function"===e.type?e.regex=new RegExp(`\\b${e.old}\\(`):e.regex=new RegExp(`${e.type} ${e.old};`)}),e}function rs(e){ns(e);const t={},n={};ss({modules:e,level:0,moduleMap:t,moduleDepth:n});const i=Object.keys(n).sort((e,t)=>n[t]-n[e]).map(e=>t[e]);return ns(i),i}function ss(e){const{modules:t,level:n,moduleMap:i,moduleDepth:o}=e;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const r of t)i[r.name]=r,(void 0===o[r.name]||o[r.name]<n)&&(o[r.name]=n);for(const r of t)r.dependencies&&ss({modules:r.dependencies,level:n+1,moduleMap:i,moduleDepth:o})}const as=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],ls=[...as,[hs("attribute"),"in $1"],[hs("varying"),"out $1"]],cs=[...as,[hs("varying"),"in $1"]];function us(e,t){for(const[n,i]of t)e=e.replace(n,i);return e}function hs(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function ds(e,t){let n="";for(const i in e){const o=e[i];if(n+=`void ${o.signature} {\n`,o.header&&(n+=`  ${o.header}`),t[i]){const e=t[i];e.sort((e,t)=>e.order-t.order);for(const t of e)n+=`  ${t.injection}\n`}o.footer&&(n+=`  ${o.footer}`),n+="}\n"}return n}function ps(e){const t={vertex:{},fragment:{}};for(const n of e){let e,i;"string"!=typeof n?(e=n,i=e.hook):(e={},i=n),i=i.trim();const[o,r]=i.split(":"),s=i.replace(/\(.+/,""),a=Object.assign(e,{signature:r});switch(o){case"vs":t.vertex[s]=a;break;case"fs":t.fragment[s]=a;break;default:throw new Error(o)}}return t}function fs(e,t="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return n?n[1]:t}function ms(e){let t=100;const n=e.match(/[^\s]+/g);if(n&&n.length>=2&&"#version"===n[0]){const e=parseInt(n[1],10);Number.isFinite(e)&&(t=e)}if(100!==t&&300!==t)throw new Error(`Invalid GLSL version ${t}`);return t}const _s=`\n\n${Qr}\n`;function gs(e){const{vs:t,fs:n}=e,i=rs(e.modules||[]);return{vs:bs(e.platformInfo,{...e,source:t,stage:"vertex",modules:i}),fs:bs(e.platformInfo,{...e,source:n,stage:"fragment",modules:i}),getUniforms:vs(i)}}function ys(e,t){var n;const{source:i,stage:o,modules:r,hookFunctions:s=[],inject:a={},log:l}=t;Gr("string"==typeof i,"shader source must be a string");const c=i;let u="";const h=ps(s),d={},p={},f={};for(const _ in a){const e="string"==typeof a[_]?{injection:a[_],order:0}:a[_],t=/^(v|f)s:(#)?([\w-]+)$/.exec(_);if(t){const n=t[2],i=t[3];n?"decl"===i?p[_]=[e]:f[_]=[e]:d[_]=[e]}else f[_]=[e]}const m=r;for(const _ of m){l&&is(_,c,l),u+=xs(_,"wgsl");const e=(null==(n=_.injections)?void 0:n[o])||{};for(const t in e){const n=/^(v|f)s:#([\w-]+)$/.exec(t);if(n){const i="decl"===n[2]?p:f;i[t]=i[t]||[],i[t].push(e[t])}else d[t]=d[t]||[],d[t].push(e[t])}}return u+=_s,u=ts(u,o,p),u+=ds(h[o],d),u+=c,u=ts(u,o,f),u}function bs(e,t){var n;const{source:i,stage:o,language:r="glsl",modules:s,defines:a={},hookFunctions:l=[],inject:c={},prologue:u=!0,log:h}=t;Gr("string"==typeof i,"shader source must be a string");const d="glsl"===r?function(e){return{name:fs(e,void 0),language:"glsl",version:ms(e)}}(i).version:-1,p=e.shaderLanguageVersion,f=100===d?"#version 100":"#version 300 es",m=i.split("\n").slice(1).join("\n"),_={};s.forEach(e=>{Object.assign(_,e.defines)}),Object.assign(_,a);let g="";switch(r){case"wgsl":break;case"glsl":g=u?`${f}\n\n// ----- PROLOGUE -------------------------\n#define SHADER_TYPE_${o.toUpperCase()}\n\n${function(e){switch(null==e?void 0:e.gpu.toLowerCase()){case"apple":return"#define APPLE_GPU\n// Apple optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Headless Chrome's software shader 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// If the GPU doesn't have full 32 bits precision, will causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}(e)}\n${"fragment"===o?"precision highp float;\n":""}\n\n// ----- APPLICATION DEFINES -------------------------\n\n${function(e={}){let t="";for(const n in e){const i=e[n];(i||Number.isFinite(i))&&(t+=`#define ${n.toUpperCase()} ${e[n]}\n`)}return t}(_)}\n\n`:`${f}\n`}const y=ps(l),b={},v={},x={};for(const w in c){const e="string"==typeof c[w]?{injection:c[w],order:0}:c[w],t=/^(v|f)s:(#)?([\w-]+)$/.exec(w);if(t){const n=t[2],i=t[3];n?"decl"===i?v[w]=[e]:x[w]=[e]:b[w]=[e]}else x[w]=[e]}for(const w of s){h&&is(w,m,h),g+=xs(w,o);const e=(null==(n=w.instance)?void 0:n.normalizedInjections[o])||{};for(const t in e){const n=/^(v|f)s:#([\w-]+)$/.exec(t);if(n){const i="decl"===n[2]?v:x;i[t]=i[t]||[],i[t].push(e[t])}else b[t]=b[t]||[],b[t].push(e[t])}}return g+="// ----- MAIN SHADER SOURCE -------------------------",g+=_s,g=ts(g,o,v),g+=ds(y[o],b),g+=m,g=ts(g,o,x),"glsl"===r&&d!==p&&(g=function(e,t){var n;if(300!==Number((null==(n=e.match(/^#version[ \t]+(\d+)/m))?void 0:n[1])||100))throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return us(e,ls);case"fragment":return us(e,cs);default:throw new Error(t)}}(g,o)),g.trim()}function vs(e){return function(t){var n;const i={};for(const o of e){const e=null==(n=o.getUniforms)?void 0:n.call(o,t,i);Object.assign(i,e)}return i}}function xs(e,t){let n;switch(t){case"vertex":n=e.vs||"";break;case"fragment":n=e.fs||"";break;case"wgsl":n=e.source||"";break;default:Gr(!1)}if(!e.name)throw new Error("Shader module must have a name");const i=e.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let o=`// ----- MODULE ${e.name} ---------------\n\n`;return"wgsl"!==t&&(o+=`#define MODULE_${i}\n`),o+=`${n}\n`,o}const ws=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,Ss=/^\s*\#\s*endif\s*$/;function Es(e,t){const n=e.split("\n"),i=[];let o=!0,r=null;for(const s of n){const e=s.match(ws),t=s.match(Ss);e?(r=e[1],o=!1):t?o=!0:o&&i.push(s)}return i.join("\n")}const Ts=class e{constructor(){h(this,"_hookFunctions",[]),h(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return e.defaultShaderAssembler=e.defaultShaderAssembler||new e,e.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===("string"==typeof e?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter(e=>e.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,{source:i,getUniforms:o}=function(e){const t=rs(e.modules||[]);return{source:ys(e.platformInfo,{...e,source:e.source,stage:"vertex",modules:t}),getUniforms:vs(t)}}({...e,source:e.source,modules:t,hookFunctions:n});return{source:"wgsl"===e.platformInfo.shaderLanguage?Es(i):i,getUniforms:o,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),n=this._hookFunctions;return{...gs({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:n}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),n={};let i=0;for(let o=0,r=this._defaultModules.length;o<r;++o){const e=this._defaultModules[o],r=e.name;t[i++]=e,n[r]=!0}for(let o=0,r=e.length;o<r;++o){const r=e[o],s=r.name;n[s]||(t[i++]=r,n[s]=!0)}return t.length=i,ns(t),t}};h(Ts,"defaultShaderAssembler");let Cs=Ts;class Is{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class As{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class ks extends Is{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Ls extends Is{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class Rs extends Is{constructor(e,t,n){super(e,n),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class Ps extends Is{constructor(e,t,n,i){super(e,n),this.format=t,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+="f",e;if("i32"===this.format.name)return e+="i",e;if("u32"===this.format.name)return e+="u",e;if("bool"===this.format.name)return e+="b",e;if("f16"===this.format.name)return e+="h",e}e+=`<${this.format.name}>`}else if("vec2"===e||"vec3"===e||"vec4"===e)return e;return e}}var Ds;(e=>{e[e.Uniform=0]="Uniform",e[e.Storage=1]="Storage",e[e.Texture=2]="Texture",e[e.Sampler=3]="Sampler",e[e.StorageTexture=4]="StorageTexture"})(Ds||(Ds={}));class Ms{constructor(e,t,n,i,o,r,s){this.name=e,this.type=t,this.group=n,this.binding=i,this.attributes=o,this.resourceType=r,this.access=s}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Ns{constructor(e,t){this.name=e,this.type=t}}class Os{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i,this.interpolation=null}}class Bs{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i}}class Fs{constructor(e,t,n,i){this.name=e,this.type=t,this.attributes=n,this.id=i}}class zs{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n}}class Us{constructor(e,t=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=n}}class $s{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function Vs(e){var t=(32768&e)>>15,n=(31744&e)>>10,i=1023&e;return 0==n?(t?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):31==n?i?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,n-15)*(1+i/Math.pow(2,10))}const Hs=new Float32Array(1),Gs=new Int32Array(Hs.buffer),Ws=new Uint16Array(1);function js(e){Hs[0]=e;const t=Gs[0],n=t>>31&1;let i=t>>23&255,o=8388607&t;if(255===i)return Ws[0]=n<<15|31744|(0!==o?512:0),Ws[0];if(0===i){if(0===o)return Ws[0]=n<<15,Ws[0];o|=8388608;let e=113;for(;!(8388608&o);)o<<=1,e--;return i=127-e,o&=8388607,i>0?(o=(o>>126-i)+(o>>127-i&1),Ws[0]=n<<15|i<<10|o>>13,Ws[0]):(Ws[0]=n<<15,Ws[0])}return i=i-127+15,i>=31?(Ws[0]=n<<15|31744,Ws[0]):i<=0?i<-10?(Ws[0]=n<<15,Ws[0]):(o=(8388608|o)>>1-i,Ws[0]=n<<15|o>>13,Ws[0]):(o>>=13,Ws[0]=n<<15|i<<10|o,Ws[0])}const Ys=new Uint32Array(1),qs=new Float32Array(Ys.buffer,0,1);function Xs(e){const t=112+(e>>6&31)<<23|(63&e)<<17;return Ys[0]=t,qs[0]}function Ks(e,t,n,i){const o=[0,0,0,0];for(let r=0;r<i;++r)switch(n){case"8unorm":o[r]=e[t]/255,t++;break;case"8snorm":o[r]=e[t]/255*2-1,t++;break;case"8uint":o[r]=e[t],t++;break;case"8sint":o[r]=e[t]-127,t++;break;case"16uint":o[r]=e[t]|e[t+1]<<8,t+=2;break;case"16sint":o[r]=(e[t]|e[t+1]<<8)-32768,t+=2;break;case"16float":o[r]=Vs(e[t]|e[t+1]<<8),t+=2;break;case"32uint":case"32sint":o[r]=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,t+=4;break;case"32float":o[r]=new Float32Array(e.buffer,t,1)[0],t+=4}return o}function Zs(e,t,n,i,o){for(let r=0;r<i;++r)switch(n){case"8unorm":e[t]=255*o[r],t++;break;case"8snorm":e[t]=.5*(o[r]+1)*255,t++;break;case"8uint":e[t]=o[r],t++;break;case"8sint":e[t]=o[r]+127,t++;break;case"16uint":new Uint16Array(e.buffer,t,1)[0]=o[r],t+=2;break;case"16sint":new Int16Array(e.buffer,t,1)[0]=o[r],t+=2;break;case"16float":{const n=js(o[r]);new Uint16Array(e.buffer,t,1)[0]=n,t+=2;break}case"32uint":new Uint32Array(e.buffer,t,1)[0]=o[r],t+=4;break;case"32sint":new Int32Array(e.buffer,t,1)[0]=o[r],t+=4;break;case"32float":new Float32Array(e.buffer,t,1)[0]=o[r],t+=4}return o}const Qs={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Js{constructor(){this.id=Js._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(ea.instance);for(const n of e)n instanceof Array?this.searchBlock(n,t):n.search(t);t(ta.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}Js._id=0;class ea extends Js{}ea.instance=new ea;class ta extends Js{}ta.instance=new ta;const na=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class ia extends Js{constructor(){super()}}class oa extends ia{constructor(e,t,n,i,o,r){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=n,this.body=i,this.startLine=o,this.endLine=r}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class ra extends ia{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class sa extends ia{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class aa extends ia{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class la extends ia{constructor(e,t,n,i){super(),this.init=e,this.condition=t,this.increment=n,this.body=i}get astNodeType(){return"for"}search(e){var t,n,i;null===(t=this.init)||void 0===t||t.search(e),null===(n=this.condition)||void 0===n||n.search(e),null===(i=this.increment)||void 0===i||i.search(e),this.searchBlock(this.body,e)}}class ca extends ia{constructor(e,t,n,i,o){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"var"}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}class ua extends ia{constructor(e,t,n){super(),this.attributes=null,this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}search(e){var t;null===(t=this.value)||void 0===t||t.search(e)}}class ha extends ia{constructor(e,t,n,i,o){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"let"}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}class da extends ia{constructor(e,t,n,i,o){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}var pa,fa,ma,_a;(e=>{e.increment="++",e.decrement="--"})(pa||(pa={})),(e=>{e.parse=function(t){const n=t;if("parse"==n)throw new Error("Invalid value for IncrementOperator");return e[n]}})(pa||(pa={}));class ga extends ia{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(e=>{e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="})(fa||(fa={})),(fa||(fa={})).parse=function(e){const t=e;if("parse"==t)throw new Error("Invalid value for AssignOperator");return t};class ya extends ia{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class ba extends ia{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return na.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class va extends ia{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),null===(t=this.continuing)||void 0===t||t.search(e)}}class xa extends ia{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class wa extends ia{constructor(e,t,n,i){super(),this.condition=e,this.body=t,this.elseif=n,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class Sa extends ia{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;null===(t=this.value)||void 0===t||t.search(e)}}class Ea extends ia{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class Ta extends ia{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class Ca extends ia{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class Ia extends ia{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class Aa extends ia{constructor(){super()}get astNodeType(){return"discard"}}class ka extends ia{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}let La=class extends ia{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}},Ra=class e extends ia{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(t){let n=t[0];if("f32"===n.name)return n;for(let i=1;i<t.length;++i){const o=e._priority.get(n.name);e._priority.get(t[i].name)<o&&(n=t[i])}return"x32"===n.name?e.i32:n}getTypeName(){return this.name}};Ra.x32=new Ra("x32"),Ra.f32=new Ra("f32"),Ra.i32=new Ra("i32"),Ra.u32=new Ra("u32"),Ra.f16=new Ra("f16"),Ra.bool=new Ra("bool"),Ra.void=new Ra("void"),Ra._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Pa extends Ra{constructor(e){super(e)}}class Da extends Ra{constructor(e,t,n,i){super(e),this.members=t,this.startLine=n,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}let Ma=class extends Ra{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+="f",e;if("i32"===this.format.name)return e+="i",e;if("u32"===this.format.name)return e+="u",e;if("bool"===this.format.name)return e+="b",e;if("f16"===this.format.name)return e+="h",e}e+=`<${this.format.name}>`}else if("vec2"===e||"vec3"===e||"vec4"===e)return e;return e}};Ma.vec2f=new Ma("vec2",Ra.f32,null),Ma.vec3f=new Ma("vec3",Ra.f32,null),Ma.vec4f=new Ma("vec4",Ra.f32,null),Ma.vec2i=new Ma("vec2",Ra.i32,null),Ma.vec3i=new Ma("vec3",Ra.i32,null),Ma.vec4i=new Ma("vec4",Ra.i32,null),Ma.vec2u=new Ma("vec2",Ra.u32,null),Ma.vec3u=new Ma("vec3",Ra.u32,null),Ma.vec4u=new Ma("vec4",Ra.u32,null),Ma.vec2h=new Ma("vec2",Ra.f16,null),Ma.vec3h=new Ma("vec3",Ra.f16,null),Ma.vec4h=new Ma("vec4",Ra.f16,null),Ma.vec2b=new Ma("vec2",Ra.bool,null),Ma.vec3b=new Ma("vec3",Ra.bool,null),Ma.vec4b=new Ma("vec4",Ra.bool,null),Ma.mat2x2f=new Ma("mat2x2",Ra.f32,null),Ma.mat2x3f=new Ma("mat2x3",Ra.f32,null),Ma.mat2x4f=new Ma("mat2x4",Ra.f32,null),Ma.mat3x2f=new Ma("mat3x2",Ra.f32,null),Ma.mat3x3f=new Ma("mat3x3",Ra.f32,null),Ma.mat3x4f=new Ma("mat3x4",Ra.f32,null),Ma.mat4x2f=new Ma("mat4x2",Ra.f32,null),Ma.mat4x3f=new Ma("mat4x3",Ra.f32,null),Ma.mat4x4f=new Ma("mat4x4",Ra.f32,null),Ma.mat2x2h=new Ma("mat2x2",Ra.f16,null),Ma.mat2x3h=new Ma("mat2x3",Ra.f16,null),Ma.mat2x4h=new Ma("mat2x4",Ra.f16,null),Ma.mat3x2h=new Ma("mat3x2",Ra.f16,null),Ma.mat3x3h=new Ma("mat3x3",Ra.f16,null),Ma.mat3x4h=new Ma("mat3x4",Ra.f16,null),Ma.mat4x2h=new Ma("mat4x2",Ra.f16,null),Ma.mat4x3h=new Ma("mat4x3",Ra.f16,null),Ma.mat4x4h=new Ma("mat4x4",Ra.f16,null),Ma.mat2x2i=new Ma("mat2x2",Ra.i32,null),Ma.mat2x3i=new Ma("mat2x3",Ra.i32,null),Ma.mat2x4i=new Ma("mat2x4",Ra.i32,null),Ma.mat3x2i=new Ma("mat3x2",Ra.i32,null),Ma.mat3x3i=new Ma("mat3x3",Ra.i32,null),Ma.mat3x4i=new Ma("mat3x4",Ra.i32,null),Ma.mat4x2i=new Ma("mat4x2",Ra.i32,null),Ma.mat4x3i=new Ma("mat4x3",Ra.i32,null),Ma.mat4x4i=new Ma("mat4x4",Ra.i32,null),Ma.mat2x2u=new Ma("mat2x2",Ra.u32,null),Ma.mat2x3u=new Ma("mat2x3",Ra.u32,null),Ma.mat2x4u=new Ma("mat2x4",Ra.u32,null),Ma.mat3x2u=new Ma("mat3x2",Ra.u32,null),Ma.mat3x3u=new Ma("mat3x3",Ra.u32,null),Ma.mat3x4u=new Ma("mat3x4",Ra.u32,null),Ma.mat4x2u=new Ma("mat4x2",Ra.u32,null),Ma.mat4x3u=new Ma("mat4x3",Ra.u32,null),Ma.mat4x4u=new Ma("mat4x4",Ra.u32,null);class Na extends Ra{constructor(e,t,n,i){super(e),this.storage=t,this.type=n,this.access=i}get astNodeType(){return"pointer"}}class Oa extends Ra{constructor(e,t,n,i){super(e),this.attributes=t,this.format=n,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class Ba extends Ra{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}}class Fa extends Js{constructor(){super(),this.postfix=null}}class za extends Fa{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Ua extends Fa{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class $a extends Fa{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return na.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class Va extends Fa{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class Ha extends Fa{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const t=e.evalExpression(this.initializer,e.context);return null!==t&&this.postfix?t.getSubData(e,this.postfix,e.context):t}return null}search(e){this.initializer.search(e)}}class Ga extends Fa{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return void 0!==t&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof al}get isVector(){return this.value instanceof cl||this.value instanceof ul}get scalarValue(){return this.value instanceof al?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof cl||this.value instanceof ul?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class Wa extends Fa{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class ja extends Fa{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class Ya extends Fa{constructor(){super()}}class qa extends Ya{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Xa extends Ya{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:"f32"===e.name||"f32"===t.name?Ra.f32:"u32"===e.name||"u32"===t.name?Ra.u32:Ra.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class Ka extends Js{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class Za extends Fa{constructor(){super()}get astNodeType(){return"default"}}class Qa extends Ka{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class Ja extends Ka{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class el extends Js{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}}class tl extends Js{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class nl extends Js{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}}class il extends Js{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class ol{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=ol._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,n,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}ol._id=0;class rl extends ol{constructor(){super(new Is("void",null),null)}toString(){return"void"}}rl.void=new rl;class sl extends ol{constructor(e){super(new Rs("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,n,i){this.reference.setDataValue(e,t,n,i)}getSubData(e,t,n){return t?this.reference.getSubData(e,t,n):this}toString(){return`&${this.reference.toString()}`}}let al=class e extends ol{constructor(e,t,n=null){super(t,n),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:"x32"===this.typeInfo.name?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):"i32"===this.typeInfo.name||"bool"===this.typeInfo.name?this.data=new Int32Array([e]):"u32"===this.typeInfo.name?this.data=new Uint32Array([e]):"f32"===this.typeInfo.name||"f16"===this.typeInfo.name?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new e(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new e(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new e(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(t,n,i,o){if(i)return void console.error("SetDataValue: Scalar data does not support postfix",i);if(!(n instanceof e))return void console.error("SetDataValue: Invalid value",n);let r=n.data[0];"i32"===this.typeInfo.name||"u32"===this.typeInfo.name?r=Math.floor(r):"bool"===this.typeInfo.name&&(r=r?1:0),this.data[0]=r}getSubData(e,t,n){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}};function ll(e,t,n){const i=t.length;return 2===i?"f32"===n?new cl(new Float32Array(t),e.getTypeInfo("vec2f")):"i32"===n||"bool"===n?new cl(new Int32Array(t),e.getTypeInfo("vec2i")):"u32"===n?new cl(new Uint32Array(t),e.getTypeInfo("vec2u")):"f16"===n?new cl(new Float32Array(t),e.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${n}`),null):3===i?"f32"===n?new cl(new Float32Array(t),e.getTypeInfo("vec3f")):"i32"===n||"bool"===n?new cl(new Int32Array(t),e.getTypeInfo("vec3i")):"u32"===n?new cl(new Uint32Array(t),e.getTypeInfo("vec3u")):"f16"===n?new cl(new Float32Array(t),e.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${n}`),null):4===i?"f32"===n?new cl(new Float32Array(t),e.getTypeInfo("vec4f")):"i32"===n||"bool"===n?new cl(new Int32Array(t),e.getTypeInfo("vec4i")):"u32"===n?new cl(new Uint32Array(t),e.getTypeInfo("vec4u")):"f16"===n?new cl(new Float32Array(t),e.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${n}`),null):(console.error(`getSubData: Invalid vector size ${t.length}`),null)}let cl=class e extends ol{constructor(e,t,n=null){if(super(t,n),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?this.data=new Float32Array(e):"vec2i"===t||"vec3i"===t||"vec4i"===t?this.data=new Int32Array(e):"vec2u"===t||"vec3u"===t||"vec4u"===t?this.data=new Uint32Array(e):"vec2h"===t||"vec3h"===t||"vec4h"===t?this.data=new Float32Array(e):"vec2b"===t||"vec3b"===t||"vec4b"===t?this.data=new Int32Array(e):"vec2"===t||"vec3"===t||"vec4"===t?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${t}`)}}clone(){if(this.data instanceof Float32Array)return new e(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new e(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new e(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(t,n,i,o){i instanceof za?console.error("TODO: Set vector postfix"):n instanceof e?this.data=n.data:console.error("SetDataValue: Invalid value",n)}getSubData(e,t,n){if(null===t)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof Ps)i=this.typeInfo.format||i;else{const t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?i=e.getTypeInfo("f32"):"vec2i"===t||"vec3i"===t||"vec4i"===t?i=e.getTypeInfo("i32"):"vec2b"===t||"vec3b"===t||"vec4b"===t?i=e.getTypeInfo("bool"):"vec2u"===t||"vec3u"===t||"vec4u"===t?i=e.getTypeInfo("u32"):"vec2h"===t||"vec3h"===t||"vec4h"===t?i=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${t}`)}let o=this;for(;null!==t&&null!==o;){if(t instanceof ja){const r=t.index;let s=-1;if(r instanceof Ga){if(!(r.value instanceof al))return console.error(`GetSubData: Invalid array index ${r.value}`),null;s=r.value.value}else{const t=e.evalExpression(r,n);if(!(t instanceof al))return console.error("GetSubData: Unknown index type",r),null;s=t.value}if(s<0||s>=o.data.length)return console.error("GetSubData: Index out of range",s),null;if(o.data instanceof Float32Array){const e=new Float32Array(o.data.buffer,o.data.byteOffset+4*s,1);return new al(e,i)}if(o.data instanceof Int32Array){const e=new Int32Array(o.data.buffer,o.data.byteOffset+4*s,1);return new al(e,i)}if(o.data instanceof Uint32Array){const e=new Uint32Array(o.data.buffer,o.data.byteOffset+4*s,1);return new al(e,i)}throw"GetSubData: Invalid data type"}if(!(t instanceof za))return console.error("GetSubData: Unknown postfix",t),null;{const n=t.value.toLowerCase();if(1===n.length){let e=0;if("x"===n||"r"===n)e=0;else if("y"===n||"g"===n)e=1;else if("z"===n||"b"===n)e=2;else{if("w"!==n&&"a"!==n)return console.error(`GetSubData: Unknown member ${n}`),null;e=3}if(this.data instanceof Float32Array){let t=new Float32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new al(t,i,this)}if(this.data instanceof Int32Array){let t=new Int32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new al(t,i,this)}if(this.data instanceof Uint32Array){let t=new Uint32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new al(t,i,this)}}const r=[];for(const e of n)"x"===e||"r"===e?r.push(this.data[0]):"y"===e||"g"===e?r.push(this.data[1]):"z"===e||"b"===e?r.push(this.data[2]):"w"===e||"a"===e?r.push(this.data[3]):console.error(`GetDataValue: Unknown member ${e}`);o=ll(e,r,i.name)}t=t.postfix}return o}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}},ul=class e extends ol{constructor(e,t,n=null){super(t,n),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new e(new Float32Array(this.data),this.typeInfo,null)}setDataValue(t,n,i,o){i instanceof za?console.error("TODO: Set matrix postfix"):n instanceof e?this.data=n.data:console.error("SetDataValue: Invalid value",n)}getSubData(e,t,n){if(null===t)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Ps)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;e.getTypeInfo("f16")}if(t instanceof ja){const o=t.index;let r=-1;if(o instanceof Ga){if(!(o.value instanceof al))return console.error(`GetDataValue: Invalid array index ${o.value}`),null;r=o.value.value}else{const t=e.evalExpression(o,n);if(!(t instanceof al))return console.error("GetDataValue: Unknown index type",o),null;r=t.value}if(r<0||r>=this.data.length)return console.error("GetDataValue: Index out of range",r),null;const s=i.endsWith("h")?"h":"f";let a;if("mat2x2"===i||"mat2x2f"===i||"mat2x2h"===i||"mat3x2"===i||"mat3x2f"===i||"mat3x2h"===i||"mat4x2"===i||"mat4x2f"===i||"mat4x2h"===i)a=new cl(new Float32Array(this.data.buffer,this.data.byteOffset+2*r*4,2),e.getTypeInfo(`vec2${s}`));else if("mat2x3"===i||"mat2x3f"===i||"mat2x3h"===i||"mat3x3"===i||"mat3x3f"===i||"mat3x3h"===i||"mat4x3"===i||"mat4x3f"===i||"mat4x3h"===i)a=new cl(new Float32Array(this.data.buffer,this.data.byteOffset+3*r*4,3),e.getTypeInfo(`vec3${s}`));else{if("mat2x4"!==i&&"mat2x4f"!==i&&"mat2x4h"!==i&&"mat3x4"!==i&&"mat3x4f"!==i&&"mat3x4h"!==i&&"mat4x4"!==i&&"mat4x4f"!==i&&"mat4x4h"!==i)return console.error(`GetDataValue: Unknown type ${i}`),null;a=new cl(new Float32Array(this.data.buffer,this.data.byteOffset+4*r*4,4),e.getTypeInfo(`vec4${s}`))}return t.postfix?a.getSubData(e,t.postfix,n):a}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}};class hl extends ol{constructor(e,t,n=0,i=null){super(t,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new hl(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,n,i){if(null===t)return;let o=this.offset,r=this.typeInfo;for(;n;){if(n instanceof ja)if(r instanceof Ls){const t=n.index;if(t instanceof Ga){if(!(t.value instanceof al))return void console.error(`SetDataValue: Invalid index type ${t.value}`);o+=t.value.value*r.stride}else{const n=e.evalExpression(t,i);if(!(n instanceof al))return void console.error("SetDataValue: Unknown index type",t);o+=n.value*r.stride}r=r.format}else console.error(`SetDataValue: Type ${r.getTypeName()} is not an array`);else{if(!(n instanceof za))return void console.error("SetDataValue: Unknown postfix type",n);{const e=n.value;if(r instanceof ks){let t=!1;for(const n of r.members)if(n.name===e){o+=n.offset,r=n.type,t=!0;break}if(!t)return void console.error(`SetDataValue: Member ${e} not found`)}else if(r instanceof Is){const n=r.getTypeName();let i=0;if("x"===e||"r"===e)i=0;else if("y"===e||"g"===e)i=1;else if("z"===e||"b"===e)i=2;else{if("w"!==e&&"a"!==e)return void console.error(`SetDataValue: Unknown member ${e}`);i=3}if(!(t instanceof al))return void console.error("SetDataValue: Invalid value",t);const s=t.value;return"vec2f"===n?void(new Float32Array(this.buffer,o,2)[i]=s):"vec3f"===n?void(new Float32Array(this.buffer,o,3)[i]=s):"vec4f"===n?void(new Float32Array(this.buffer,o,4)[i]=s):"vec2i"===n?void(new Int32Array(this.buffer,o,2)[i]=s):"vec3i"===n?void(new Int32Array(this.buffer,o,3)[i]=s):"vec4i"===n?void(new Int32Array(this.buffer,o,4)[i]=s):"vec2u"===n?void(new Uint32Array(this.buffer,o,2)[i]=s):"vec3u"===n?void(new Uint32Array(this.buffer,o,3)[i]=s):"vec4u"===n?void(new Uint32Array(this.buffer,o,4)[i]=s):void console.error(`SetDataValue: Type ${n} is not a struct`)}}}n=n.postfix}this.setData(e,t,r,o,i)}setData(e,t,n,i,o){const r=n.getTypeName();if("f32"!==r&&"f16"!==r)if("i32"!==r&&"atomic<i32>"!==r&&"x32"!==r)if("u32"!==r&&"atomic<u32>"!==r)if("bool"!==r){if("vec2f"===r||"vec2h"===r){const e=new Float32Array(this.buffer,i,2);return void(t instanceof cl?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3f"===r||"vec3h"===r){const e=new Float32Array(this.buffer,i,3);return void(t instanceof cl?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4f"===r||"vec4h"===r){const e=new Float32Array(this.buffer,i,4);return void(t instanceof cl?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2i"===r){const e=new Int32Array(this.buffer,i,2);return void(t instanceof cl?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3i"===r){const e=new Int32Array(this.buffer,i,3);return void(t instanceof cl?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4i"===r){const e=new Int32Array(this.buffer,i,4);return void(t instanceof cl?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2u"===r){const e=new Uint32Array(this.buffer,i,2);return void(t instanceof cl?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3u"===r){const e=new Uint32Array(this.buffer,i,3);return void(t instanceof cl?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4u"===r){const e=new Uint32Array(this.buffer,i,4);return void(t instanceof cl?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2b"===r){const e=new Uint32Array(this.buffer,i,2);return void(t instanceof cl?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3b"===r){const e=new Uint32Array(this.buffer,i,3);return void(t instanceof cl?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4b"===r){const e=new Uint32Array(this.buffer,i,4);return void(t instanceof cl?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("mat2x2f"===r||"mat2x2h"===r){const e=new Float32Array(this.buffer,i,4);return void(t instanceof ul?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("mat2x3f"===r||"mat2x3h"===r){const e=new Float32Array(this.buffer,i,6);return void(t instanceof ul?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]))}if("mat2x4f"===r||"mat2x4h"===r){const e=new Float32Array(this.buffer,i,8);return void(t instanceof ul?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]))}if("mat3x2f"===r||"mat3x2h"===r){const e=new Float32Array(this.buffer,i,6);return void(t instanceof ul?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]))}if("mat3x3f"===r||"mat3x3h"===r){const e=new Float32Array(this.buffer,i,9);return void(t instanceof ul?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]))}if("mat3x4f"===r||"mat3x4h"===r){const e=new Float32Array(this.buffer,i,12);return void(t instanceof ul?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]))}if("mat4x2f"===r||"mat4x2h"===r){const e=new Float32Array(this.buffer,i,8);return void(t instanceof ul?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]))}if("mat4x3f"===r||"mat4x3h"===r){const e=new Float32Array(this.buffer,i,12);return void(t instanceof ul?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]))}if("mat4x4f"===r||"mat4x4h"===r){const e=new Float32Array(this.buffer,i,16);return void(t instanceof ul?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11],e[12]=t.data[12],e[13]=t.data[13],e[14]=t.data[14],e[15]=t.data[15]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}if(t instanceof hl){if(n===t.typeInfo)return void new Uint8Array(this.buffer,i,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",r,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${r}`)}else t instanceof al&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof al&&(new Uint32Array(this.buffer,i,1)[0]=t.value);else t instanceof al&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof al&&(new Float32Array(this.buffer,i,1)[0]=t.value)}getSubData(e,t,n){var i,o,r;if(null===t)return this;let s=this.offset,a=this.typeInfo;for(;t;){if(t instanceof ja){const i=t.index,o=i instanceof Fa?e.evalExpression(i,n):i;let r=0;if(o instanceof al?r=o.value:"number"==typeof o?r=o:console.error("GetDataValue: Invalid index type",i),a instanceof Ls)s+=r*a.stride,a=a.format;else{const t=a.getTypeName();"mat4x4"===t||"mat4x4f"===t||"mat4x4h"===t?(s+=16*r,a=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${a.getTypeName()} is not an array`)}}else{if(!(t instanceof za))return console.error("GetDataValue: Unknown postfix type",t),null;{const n=t.value;if(a instanceof ks){let e=!1;for(const t of a.members)if(t.name===n){s+=t.offset,a=t.type,e=!0;break}if(!e)return console.error(`GetDataValue: Member ${n} not found`),null}else if(a instanceof Is){const t=a.getTypeName();if("vec2f"===t||"vec3f"===t||"vec4f"===t||"vec2i"===t||"vec3i"===t||"vec4i"===t||"vec2u"===t||"vec3u"===t||"vec4u"===t||"vec2b"===t||"vec3b"===t||"vec4b"===t||"vec2h"===t||"vec3h"===t||"vec4h"===t||"vec2"===t||"vec3"===t||"vec4"===t){if(n.length>0&&n.length<5){let i="f";const o=[];for(let r=0;r<n.length;++r){const a=n[r].toLowerCase();let l=0;if("x"===a||"r"===a)l=0;else if("y"===a||"g"===a)l=1;else if("z"===a||"b"===a)l=2;else{if("w"!==a&&"a"!==a)return console.error(`Unknown member ${n}`),null;l=3}if(1===n.length){if(t.endsWith("f"))return this.buffer.byteLength<s+4*l+4?null:new al(new Float32Array(this.buffer,s+4*l,1),e.getTypeInfo("f32"),this);if(t.endsWith("h"))return new al(new Float32Array(this.buffer,s+4*l,1),e.getTypeInfo("f16"),this);if(t.endsWith("i"))return new al(new Int32Array(this.buffer,s+4*l,1),e.getTypeInfo("i32"),this);if(t.endsWith("b"))return new al(new Int32Array(this.buffer,s+4*l,1),e.getTypeInfo("bool"),this);if(t.endsWith("u"))return new al(new Uint32Array(this.buffer,s+4*l,1),e.getTypeInfo("i32"),this)}if("vec2f"===t)o.push(new Float32Array(this.buffer,s,2)[l]);else if("vec3f"===t){if(s+12>=this.buffer.byteLength)return null;const e=new Float32Array(this.buffer,s,3);o.push(e[l])}else if("vec4f"===t)o.push(new Float32Array(this.buffer,s,4)[l]);else if("vec2i"===t)i="i",o.push(new Int32Array(this.buffer,s,2)[l]);else if("vec3i"===t)i="i",o.push(new Int32Array(this.buffer,s,3)[l]);else if("vec4i"===t)i="i",o.push(new Int32Array(this.buffer,s,4)[l]);else if("vec2u"===t){i="u";const e=new Uint32Array(this.buffer,s,2);o.push(e[l])}else"vec3u"===t?(i="u",o.push(new Uint32Array(this.buffer,s,3)[l])):"vec4u"===t&&(i="u",o.push(new Uint32Array(this.buffer,s,4)[l]))}return 2===o.length?a=e.getTypeInfo(`vec2${i}`):3===o.length?a=e.getTypeInfo(`vec3${i}`):4===o.length?a=e.getTypeInfo(`vec4${i}`):console.error(`GetDataValue: Invalid vector length ${o.length}`),new cl(o,a,null)}return console.error(`GetDataValue: Unknown member ${n}`),null}return console.error(`GetDataValue: Type ${t} is not a struct`),null}}}t=t.postfix}const l=a.getTypeName();return"f32"===l?new al(new Float32Array(this.buffer,s,1),a,this):"i32"===l?new al(new Int32Array(this.buffer,s,1),a,this):"u32"===l?new al(new Uint32Array(this.buffer,s,1),a,this):"vec2f"===l?new cl(new Float32Array(this.buffer,s,2),a,this):"vec3f"===l?new cl(new Float32Array(this.buffer,s,3),a,this):"vec4f"===l?new cl(new Float32Array(this.buffer,s,4),a,this):"vec2i"===l?new cl(new Int32Array(this.buffer,s,2),a,this):"vec3i"===l?new cl(new Int32Array(this.buffer,s,3),a,this):"vec4i"===l?new cl(new Int32Array(this.buffer,s,4),a,this):"vec2u"===l?new cl(new Uint32Array(this.buffer,s,2),a,this):"vec3u"===l?new cl(new Uint32Array(this.buffer,s,3),a,this):"vec4u"===l?new cl(new Uint32Array(this.buffer,s,4),a,this):a instanceof Ps&&"atomic"===a.name?"u32"===(null===(i=a.format)||void 0===i?void 0:i.name)?new al(new Uint32Array(this.buffer,s,1)[0],a.format,this):"i32"===(null===(o=a.format)||void 0===o?void 0:o.name)?new al(new Int32Array(this.buffer,s,1)[0],a.format,this):(console.error(`GetDataValue: Invalid atomic format ${null===(r=a.format)||void 0===r?void 0:r.name}`),null):new hl(this.buffer,a,s,this)}toString(){let e="";if(this.typeInfo instanceof Ls)if("f32"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("i32"===this.typeInfo.format.name){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("u32"===this.typeInfo.format.name){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("vec2f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let n=1;n<t.length/2;++n)e+=`, [${t[2*n]}, ${t[2*n+1]}]`}else if("vec3f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}]`}else if("vec4f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}, ${t[n+3]}]`}else e="[...]";else this.typeInfo instanceof ks?e+="{...}":e="[...]";return e}}class dl extends ol{constructor(e,t,n,i){super(t,null),this.data=e,this.descriptor=n,this.view=i}clone(){return new dl(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>0?null!==(e=n[0])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.width)&&void 0!==t?t:0}get height(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>1?null!==(e=n[1])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.height)&&void 0!==t?t:0}get depthOrArrayLayers(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>2?null!==(e=n[2])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.depthOrArrayLayers)&&void 0!==t?t:0}get format(){var e;return this.descriptor&&null!==(e=this.descriptor.format)&&void 0!==e?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&null!==(e=this.descriptor.sampleCount)&&void 0!==e?e:1}get mipLevelCount(){var e;return this.descriptor&&null!==(e=this.descriptor.mipLevelCount)&&void 0!==e?e:1}get dimension(){var e;return this.descriptor&&null!==(e=this.descriptor.dimension)&&void 0!==e?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<t.length;++n)t[n]=Math.max(1,t[n]>>e);return t}get texelByteSize(){const e=this.format,t=Qs[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=Qs[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=Qs[e],n=this.width;if(!e||n<=0||!t)return-1;const i=this.height,o=this.depthOrArrayLayers,r=this.dimension;return n/t.blockWidth*("1d"===r?1:i/t.blockHeight)*t.bytesPerBlock*o}getPixel(e,t,n=0,i=0){const o=this.texelByteSize,r=this.bytesPerRow,s=this.height,a=this.data[i];return function(e,t,n,i,o,r,s,a,l){const c=i*(s>>=o)*(r>>=o)+n*s+t*a;switch(l){case"r8unorm":return[Ks(e,c,"8unorm",1)[0]];case"r8snorm":return[Ks(e,c,"8snorm",1)[0]];case"r8uint":return[Ks(e,c,"8uint",1)[0]];case"r8sint":return[Ks(e,c,"8sint",1)[0]];case"rg8unorm":{const t=Ks(e,c,"8unorm",2);return[t[0],t[1]]}case"rg8snorm":{const t=Ks(e,c,"8snorm",2);return[t[0],t[1]]}case"rg8uint":{const t=Ks(e,c,"8uint",2);return[t[0],t[1]]}case"rg8sint":{const t=Ks(e,c,"8sint",2);return[t[0],t[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const t=Ks(e,c,"8unorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8snorm":{const t=Ks(e,c,"8snorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8uint":{const t=Ks(e,c,"8uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba8sint":{const t=Ks(e,c,"8sint",4);return[t[0],t[1],t[2],t[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const t=Ks(e,c,"8unorm",4);return[t[2],t[1],t[0],t[3]]}case"r16uint":return[Ks(e,c,"16uint",1)[0]];case"r16sint":return[Ks(e,c,"16sint",1)[0]];case"r16float":return[Ks(e,c,"16float",1)[0]];case"rg16uint":{const t=Ks(e,c,"16uint",2);return[t[0],t[1]]}case"rg16sint":{const t=Ks(e,c,"16sint",2);return[t[0],t[1]]}case"rg16float":{const t=Ks(e,c,"16float",2);return[t[0],t[1]]}case"rgba16uint":{const t=Ks(e,c,"16uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16sint":{const t=Ks(e,c,"16sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16float":{const t=Ks(e,c,"16float",4);return[t[0],t[1],t[2],t[3]]}case"r32uint":return[Ks(e,c,"32uint",1)[0]];case"r32sint":return[Ks(e,c,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Ks(e,c,"32float",1)[0]];case"rg32uint":{const t=Ks(e,c,"32uint",2);return[t[0],t[1]]}case"rg32sint":{const t=Ks(e,c,"32sint",2);return[t[0],t[1]]}case"rg32float":{const t=Ks(e,c,"32float",2);return[t[0],t[1]]}case"rgba32uint":{const t=Ks(e,c,"32uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32sint":{const t=Ks(e,c,"32sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32float":{const t=Ks(e,c,"32float",4);return[t[0],t[1],t[2],t[3]]}case"rg11b10ufloat":{const t=new Uint32Array(e.buffer,c,1)[0],n=(4192256&t)>>11,i=(4290772992&t)>>22;return[Xs(2047&t),Xs(n),function(e){const t=112+(e>>5&31)<<23|(31&e)<<18;return Ys[0]=t,qs[0]}(i),1]}}return null}(new Uint8Array(a),e,t,n,i,s,r,o,this.format)}setPixel(e,t,n,i,o){const r=this.texelByteSize,s=this.bytesPerRow,a=this.height,l=this.data[i];!function(e,t,n,i,o,r,s,a,l,c){const u=i*(s>>=o)*(r>>=o)+n*s+t*a;switch(l){case"r8unorm":return void Zs(e,u,"8unorm",1,c);case"r8snorm":return void Zs(e,u,"8snorm",1,c);case"r8uint":return void Zs(e,u,"8uint",1,c);case"r8sint":return void Zs(e,u,"8sint",1,c);case"rg8unorm":return void Zs(e,u,"8unorm",2,c);case"rg8snorm":return void Zs(e,u,"8snorm",2,c);case"rg8uint":return void Zs(e,u,"8uint",2,c);case"rg8sint":return void Zs(e,u,"8sint",2,c);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void Zs(e,u,"8unorm",4,c);case"rgba8snorm":return void Zs(e,u,"8snorm",4,c);case"rgba8uint":return void Zs(e,u,"8uint",4,c);case"rgba8sint":return void Zs(e,u,"8sint",4,c);case"r16uint":return void Zs(e,u,"16uint",1,c);case"r16sint":return void Zs(e,u,"16sint",1,c);case"r16float":return void Zs(e,u,"16float",1,c);case"rg16uint":return void Zs(e,u,"16uint",2,c);case"rg16sint":return void Zs(e,u,"16sint",2,c);case"rg16float":return void Zs(e,u,"16float",2,c);case"rgba16uint":return void Zs(e,u,"16uint",4,c);case"rgba16sint":return void Zs(e,u,"16sint",4,c);case"rgba16float":return void Zs(e,u,"16float",4,c);case"r32uint":return void Zs(e,u,"32uint",1,c);case"r32sint":return void Zs(e,u,"32sint",1,c);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void Zs(e,u,"32float",1,c);case"rg32uint":return void Zs(e,u,"32uint",2,c);case"rg32sint":return void Zs(e,u,"32sint",2,c);case"rg32float":return void Zs(e,u,"32float",2,c);case"rgba32uint":return void Zs(e,u,"32uint",4,c);case"rgba32sint":return void Zs(e,u,"32sint",4,c);case"rgba32float":return void Zs(e,u,"32float",4,c);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}}(new Uint8Array(l),e,t,n,i,a,s,r,this.format,o)}}(e=>{e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"})(_a||(_a={}));let pl=class{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}},fl=class{};ma=fl,fl.none=new pl("",_a.reserved,""),fl.eof=new pl("EOF",_a.token,""),fl.reserved={asm:new pl("asm",_a.reserved,"asm"),bf16:new pl("bf16",_a.reserved,"bf16"),do:new pl("do",_a.reserved,"do"),enum:new pl("enum",_a.reserved,"enum"),f16:new pl("f16",_a.reserved,"f16"),f64:new pl("f64",_a.reserved,"f64"),handle:new pl("handle",_a.reserved,"handle"),i8:new pl("i8",_a.reserved,"i8"),i16:new pl("i16",_a.reserved,"i16"),i64:new pl("i64",_a.reserved,"i64"),mat:new pl("mat",_a.reserved,"mat"),premerge:new pl("premerge",_a.reserved,"premerge"),regardless:new pl("regardless",_a.reserved,"regardless"),typedef:new pl("typedef",_a.reserved,"typedef"),u8:new pl("u8",_a.reserved,"u8"),u16:new pl("u16",_a.reserved,"u16"),u64:new pl("u64",_a.reserved,"u64"),unless:new pl("unless",_a.reserved,"unless"),using:new pl("using",_a.reserved,"using"),vec:new pl("vec",_a.reserved,"vec"),void:new pl("void",_a.reserved,"void")},fl.keywords={array:new pl("array",_a.keyword,"array"),atomic:new pl("atomic",_a.keyword,"atomic"),bool:new pl("bool",_a.keyword,"bool"),f32:new pl("f32",_a.keyword,"f32"),i32:new pl("i32",_a.keyword,"i32"),mat2x2:new pl("mat2x2",_a.keyword,"mat2x2"),mat2x3:new pl("mat2x3",_a.keyword,"mat2x3"),mat2x4:new pl("mat2x4",_a.keyword,"mat2x4"),mat3x2:new pl("mat3x2",_a.keyword,"mat3x2"),mat3x3:new pl("mat3x3",_a.keyword,"mat3x3"),mat3x4:new pl("mat3x4",_a.keyword,"mat3x4"),mat4x2:new pl("mat4x2",_a.keyword,"mat4x2"),mat4x3:new pl("mat4x3",_a.keyword,"mat4x3"),mat4x4:new pl("mat4x4",_a.keyword,"mat4x4"),ptr:new pl("ptr",_a.keyword,"ptr"),sampler:new pl("sampler",_a.keyword,"sampler"),sampler_comparison:new pl("sampler_comparison",_a.keyword,"sampler_comparison"),struct:new pl("struct",_a.keyword,"struct"),texture_1d:new pl("texture_1d",_a.keyword,"texture_1d"),texture_2d:new pl("texture_2d",_a.keyword,"texture_2d"),texture_2d_array:new pl("texture_2d_array",_a.keyword,"texture_2d_array"),texture_3d:new pl("texture_3d",_a.keyword,"texture_3d"),texture_cube:new pl("texture_cube",_a.keyword,"texture_cube"),texture_cube_array:new pl("texture_cube_array",_a.keyword,"texture_cube_array"),texture_multisampled_2d:new pl("texture_multisampled_2d",_a.keyword,"texture_multisampled_2d"),texture_storage_1d:new pl("texture_storage_1d",_a.keyword,"texture_storage_1d"),texture_storage_2d:new pl("texture_storage_2d",_a.keyword,"texture_storage_2d"),texture_storage_2d_array:new pl("texture_storage_2d_array",_a.keyword,"texture_storage_2d_array"),texture_storage_3d:new pl("texture_storage_3d",_a.keyword,"texture_storage_3d"),texture_depth_2d:new pl("texture_depth_2d",_a.keyword,"texture_depth_2d"),texture_depth_2d_array:new pl("texture_depth_2d_array",_a.keyword,"texture_depth_2d_array"),texture_depth_cube:new pl("texture_depth_cube",_a.keyword,"texture_depth_cube"),texture_depth_cube_array:new pl("texture_depth_cube_array",_a.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new pl("texture_depth_multisampled_2d",_a.keyword,"texture_depth_multisampled_2d"),texture_external:new pl("texture_external",_a.keyword,"texture_external"),u32:new pl("u32",_a.keyword,"u32"),vec2:new pl("vec2",_a.keyword,"vec2"),vec3:new pl("vec3",_a.keyword,"vec3"),vec4:new pl("vec4",_a.keyword,"vec4"),bitcast:new pl("bitcast",_a.keyword,"bitcast"),block:new pl("block",_a.keyword,"block"),break:new pl("break",_a.keyword,"break"),case:new pl("case",_a.keyword,"case"),continue:new pl("continue",_a.keyword,"continue"),continuing:new pl("continuing",_a.keyword,"continuing"),default:new pl("default",_a.keyword,"default"),diagnostic:new pl("diagnostic",_a.keyword,"diagnostic"),discard:new pl("discard",_a.keyword,"discard"),else:new pl("else",_a.keyword,"else"),enable:new pl("enable",_a.keyword,"enable"),fallthrough:new pl("fallthrough",_a.keyword,"fallthrough"),false:new pl("false",_a.keyword,"false"),fn:new pl("fn",_a.keyword,"fn"),for:new pl("for",_a.keyword,"for"),function:new pl("function",_a.keyword,"function"),if:new pl("if",_a.keyword,"if"),let:new pl("let",_a.keyword,"let"),const:new pl("const",_a.keyword,"const"),loop:new pl("loop",_a.keyword,"loop"),while:new pl("while",_a.keyword,"while"),private:new pl("private",_a.keyword,"private"),read:new pl("read",_a.keyword,"read"),read_write:new pl("read_write",_a.keyword,"read_write"),return:new pl("return",_a.keyword,"return"),requires:new pl("requires",_a.keyword,"requires"),storage:new pl("storage",_a.keyword,"storage"),switch:new pl("switch",_a.keyword,"switch"),true:new pl("true",_a.keyword,"true"),alias:new pl("alias",_a.keyword,"alias"),type:new pl("type",_a.keyword,"type"),uniform:new pl("uniform",_a.keyword,"uniform"),var:new pl("var",_a.keyword,"var"),override:new pl("override",_a.keyword,"override"),workgroup:new pl("workgroup",_a.keyword,"workgroup"),write:new pl("write",_a.keyword,"write"),r8unorm:new pl("r8unorm",_a.keyword,"r8unorm"),r8snorm:new pl("r8snorm",_a.keyword,"r8snorm"),r8uint:new pl("r8uint",_a.keyword,"r8uint"),r8sint:new pl("r8sint",_a.keyword,"r8sint"),r16uint:new pl("r16uint",_a.keyword,"r16uint"),r16sint:new pl("r16sint",_a.keyword,"r16sint"),r16float:new pl("r16float",_a.keyword,"r16float"),rg8unorm:new pl("rg8unorm",_a.keyword,"rg8unorm"),rg8snorm:new pl("rg8snorm",_a.keyword,"rg8snorm"),rg8uint:new pl("rg8uint",_a.keyword,"rg8uint"),rg8sint:new pl("rg8sint",_a.keyword,"rg8sint"),r32uint:new pl("r32uint",_a.keyword,"r32uint"),r32sint:new pl("r32sint",_a.keyword,"r32sint"),r32float:new pl("r32float",_a.keyword,"r32float"),rg16uint:new pl("rg16uint",_a.keyword,"rg16uint"),rg16sint:new pl("rg16sint",_a.keyword,"rg16sint"),rg16float:new pl("rg16float",_a.keyword,"rg16float"),rgba8unorm:new pl("rgba8unorm",_a.keyword,"rgba8unorm"),rgba8unorm_srgb:new pl("rgba8unorm_srgb",_a.keyword,"rgba8unorm_srgb"),rgba8snorm:new pl("rgba8snorm",_a.keyword,"rgba8snorm"),rgba8uint:new pl("rgba8uint",_a.keyword,"rgba8uint"),rgba8sint:new pl("rgba8sint",_a.keyword,"rgba8sint"),bgra8unorm:new pl("bgra8unorm",_a.keyword,"bgra8unorm"),bgra8unorm_srgb:new pl("bgra8unorm_srgb",_a.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new pl("rgb10a2unorm",_a.keyword,"rgb10a2unorm"),rg11b10float:new pl("rg11b10float",_a.keyword,"rg11b10float"),rg32uint:new pl("rg32uint",_a.keyword,"rg32uint"),rg32sint:new pl("rg32sint",_a.keyword,"rg32sint"),rg32float:new pl("rg32float",_a.keyword,"rg32float"),rgba16uint:new pl("rgba16uint",_a.keyword,"rgba16uint"),rgba16sint:new pl("rgba16sint",_a.keyword,"rgba16sint"),rgba16float:new pl("rgba16float",_a.keyword,"rgba16float"),rgba32uint:new pl("rgba32uint",_a.keyword,"rgba32uint"),rgba32sint:new pl("rgba32sint",_a.keyword,"rgba32sint"),rgba32float:new pl("rgba32float",_a.keyword,"rgba32float"),static_assert:new pl("static_assert",_a.keyword,"static_assert")},fl.tokens={decimal_float_literal:new pl("decimal_float_literal",_a.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new pl("hex_float_literal",_a.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new pl("int_literal",_a.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new pl("uint_literal",_a.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new pl("name",_a.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new pl("ident",_a.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new pl("and",_a.token,"&"),and_and:new pl("and_and",_a.token,"&&"),arrow:new pl("arrow ",_a.token,"->"),attr:new pl("attr",_a.token,"@"),forward_slash:new pl("forward_slash",_a.token,"/"),bang:new pl("bang",_a.token,"!"),bracket_left:new pl("bracket_left",_a.token,"["),bracket_right:new pl("bracket_right",_a.token,"]"),brace_left:new pl("brace_left",_a.token,"{"),brace_right:new pl("brace_right",_a.token,"}"),colon:new pl("colon",_a.token,":"),comma:new pl("comma",_a.token,","),equal:new pl("equal",_a.token,"="),equal_equal:new pl("equal_equal",_a.token,"=="),not_equal:new pl("not_equal",_a.token,"!="),greater_than:new pl("greater_than",_a.token,">"),greater_than_equal:new pl("greater_than_equal",_a.token,">="),shift_right:new pl("shift_right",_a.token,">>"),less_than:new pl("less_than",_a.token,"<"),less_than_equal:new pl("less_than_equal",_a.token,"<="),shift_left:new pl("shift_left",_a.token,"<<"),modulo:new pl("modulo",_a.token,"%"),minus:new pl("minus",_a.token,"-"),minus_minus:new pl("minus_minus",_a.token,"--"),period:new pl("period",_a.token,"."),plus:new pl("plus",_a.token,"+"),plus_plus:new pl("plus_plus",_a.token,"++"),or:new pl("or",_a.token,"|"),or_or:new pl("or_or",_a.token,"||"),paren_left:new pl("paren_left",_a.token,"("),paren_right:new pl("paren_right",_a.token,")"),semicolon:new pl("semicolon",_a.token,";"),star:new pl("star",_a.token,"*"),tilde:new pl("tilde",_a.token,"~"),underscore:new pl("underscore",_a.token,"_"),xor:new pl("xor",_a.token,"^"),plus_equal:new pl("plus_equal",_a.token,"+="),minus_equal:new pl("minus_equal",_a.token,"-="),times_equal:new pl("times_equal",_a.token,"*="),division_equal:new pl("division_equal",_a.token,"/="),modulo_equal:new pl("modulo_equal",_a.token,"%="),and_equal:new pl("and_equal",_a.token,"&="),or_equal:new pl("or_equal",_a.token,"|="),xor_equal:new pl("xor_equal",_a.token,"^="),shift_right_equal:new pl("shift_right_equal",_a.token,">>="),shift_left_equal:new pl("shift_left_equal",_a.token,"<<=")},fl.simpleTokens={"@":ma.tokens.attr,"{":ma.tokens.brace_left,"}":ma.tokens.brace_right,":":ma.tokens.colon,",":ma.tokens.comma,"(":ma.tokens.paren_left,")":ma.tokens.paren_right,";":ma.tokens.semicolon},fl.literalTokens={"&":ma.tokens.and,"&&":ma.tokens.and_and,"->":ma.tokens.arrow,"/":ma.tokens.forward_slash,"!":ma.tokens.bang,"[":ma.tokens.bracket_left,"]":ma.tokens.bracket_right,"=":ma.tokens.equal,"==":ma.tokens.equal_equal,"!=":ma.tokens.not_equal,">":ma.tokens.greater_than,">=":ma.tokens.greater_than_equal,">>":ma.tokens.shift_right,"<":ma.tokens.less_than,"<=":ma.tokens.less_than_equal,"<<":ma.tokens.shift_left,"%":ma.tokens.modulo,"-":ma.tokens.minus,"--":ma.tokens.minus_minus,".":ma.tokens.period,"+":ma.tokens.plus,"++":ma.tokens.plus_plus,"|":ma.tokens.or,"||":ma.tokens.or_or,"*":ma.tokens.star,"~":ma.tokens.tilde,_:ma.tokens.underscore,"^":ma.tokens.xor,"+=":ma.tokens.plus_equal,"-=":ma.tokens.minus_equal,"*=":ma.tokens.times_equal,"/=":ma.tokens.division_equal,"%=":ma.tokens.modulo_equal,"&=":ma.tokens.and_equal,"|=":ma.tokens.or_equal,"^=":ma.tokens.xor_equal,">>=":ma.tokens.shift_right_equal,"<<=":ma.tokens.shift_left_equal},fl.regexTokens={decimal_float_literal:ma.tokens.decimal_float_literal,hex_float_literal:ma.tokens.hex_float_literal,int_literal:ma.tokens.int_literal,uint_literal:ma.tokens.uint_literal,ident:ma.tokens.ident},fl.storage_class=[ma.keywords.function,ma.keywords.private,ma.keywords.workgroup,ma.keywords.uniform,ma.keywords.storage],fl.access_mode=[ma.keywords.read,ma.keywords.write,ma.keywords.read_write],fl.sampler_type=[ma.keywords.sampler,ma.keywords.sampler_comparison],fl.sampled_texture_type=[ma.keywords.texture_1d,ma.keywords.texture_2d,ma.keywords.texture_2d_array,ma.keywords.texture_3d,ma.keywords.texture_cube,ma.keywords.texture_cube_array],fl.multisampled_texture_type=[ma.keywords.texture_multisampled_2d],fl.storage_texture_type=[ma.keywords.texture_storage_1d,ma.keywords.texture_storage_2d,ma.keywords.texture_storage_2d_array,ma.keywords.texture_storage_3d],fl.depth_texture_type=[ma.keywords.texture_depth_2d,ma.keywords.texture_depth_2d_array,ma.keywords.texture_depth_cube,ma.keywords.texture_depth_cube_array,ma.keywords.texture_depth_multisampled_2d],fl.texture_external_type=[ma.keywords.texture_external],fl.any_texture_type=[...ma.sampled_texture_type,...ma.multisampled_texture_type,...ma.storage_texture_type,...ma.depth_texture_type,...ma.texture_external_type],fl.texel_format=[ma.keywords.r8unorm,ma.keywords.r8snorm,ma.keywords.r8uint,ma.keywords.r8sint,ma.keywords.r16uint,ma.keywords.r16sint,ma.keywords.r16float,ma.keywords.rg8unorm,ma.keywords.rg8snorm,ma.keywords.rg8uint,ma.keywords.rg8sint,ma.keywords.r32uint,ma.keywords.r32sint,ma.keywords.r32float,ma.keywords.rg16uint,ma.keywords.rg16sint,ma.keywords.rg16float,ma.keywords.rgba8unorm,ma.keywords.rgba8unorm_srgb,ma.keywords.rgba8snorm,ma.keywords.rgba8uint,ma.keywords.rgba8sint,ma.keywords.bgra8unorm,ma.keywords.bgra8unorm_srgb,ma.keywords.rgb10a2unorm,ma.keywords.rg11b10float,ma.keywords.rg32uint,ma.keywords.rg32sint,ma.keywords.rg32float,ma.keywords.rgba16uint,ma.keywords.rgba16sint,ma.keywords.rgba16float,ma.keywords.rgba32uint,ma.keywords.rgba32sint,ma.keywords.rgba32float],fl.const_literal=[ma.tokens.int_literal,ma.tokens.uint_literal,ma.tokens.decimal_float_literal,ma.tokens.hex_float_literal,ma.keywords.true,ma.keywords.false],fl.literal_or_ident=[ma.tokens.ident,ma.tokens.int_literal,ma.tokens.uint_literal,ma.tokens.decimal_float_literal,ma.tokens.hex_float_literal,ma.tokens.name],fl.element_count_expression=[ma.tokens.int_literal,ma.tokens.uint_literal,ma.tokens.ident],fl.template_types=[ma.keywords.vec2,ma.keywords.vec3,ma.keywords.vec4,ma.keywords.mat2x2,ma.keywords.mat2x3,ma.keywords.mat2x4,ma.keywords.mat3x2,ma.keywords.mat3x3,ma.keywords.mat3x4,ma.keywords.mat4x2,ma.keywords.mat4x3,ma.keywords.mat4x4,ma.keywords.atomic,ma.keywords.bitcast,...ma.any_texture_type],fl.attribute_name=[ma.tokens.ident,ma.keywords.block,ma.keywords.diagnostic],fl.assignment_operators=[ma.tokens.equal,ma.tokens.plus_equal,ma.tokens.minus_equal,ma.tokens.times_equal,ma.tokens.division_equal,ma.tokens.modulo_equal,ma.tokens.and_equal,ma.tokens.or_equal,ma.tokens.xor_equal,ma.tokens.shift_right_equal,ma.tokens.shift_left_equal],fl.increment_operators=[ma.tokens.plus_plus,ma.tokens.minus_minus];class ml{constructor(e,t,n,i,o){this.type=e,this.lexeme=t,this.line=n,this.start=i,this.end=o}toString(){return this.lexeme}isTemplateType(){return-1!=fl.template_types.indexOf(this.type)}isArrayType(){return this.type==fl.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class _l{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new ml(fl.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if("\n"==e)return this._line++,!0;if(this._isWhitespace(e))return!0;if("/"==e){if("/"==this._peekAhead()){for(;"\n"!=e;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if("*"==this._peekAhead()){this._advance();let t=1;for(;t>0;){if(this._isAtEnd())return!0;if(e=this._advance(),"\n"==e)this._line++;else if("*"==e){if("/"==this._peekAhead()&&(this._advance(),t--,0==t))return!0}else"/"==e&&"*"==this._peekAhead()&&(this._advance(),t++)}return!0}}const t=fl.simpleTokens[e];if(t)return this._addToken(t),!0;let n=fl.none;const i=this._isAlpha(e),o="_"===e;if(this._isAlphaNumeric(e)){let t=this._peekAhead();for(;this._isAlphaNumeric(t);)e+=this._advance(),t=this._peekAhead()}if(i){const t=fl.keywords[e];if(t)return this._addToken(t),!0}if(i||o)return this._addToken(fl.tokens.ident),!0;for(;;){let t=this._findType(e);const i=this._peekAhead();if("-"==e&&this._tokens.length>0){if("="==i)return this._current++,e+=i,this._addToken(fl.tokens.minus_equal),!0;if("-"==i)return this._current++,e+=i,this._addToken(fl.tokens.minus_minus),!0;const n=this._tokens.length-1;if((-1!=fl.literal_or_ident.indexOf(this._tokens[n].type)||this._tokens[n].type==fl.tokens.paren_right)&&">"!=i)return this._addToken(t),!0}if(">"==e&&(">"==i||"="==i)){let e=!1,n=this._tokens.length-1;for(let t=0;t<5&&n>=0&&-1===fl.assignment_operators.indexOf(this._tokens[n].type);++t,--n)if(this._tokens[n].type===fl.tokens.less_than){n>0&&this._tokens[n-1].isArrayOrTemplateType()&&(e=!0);break}if(e)return this._addToken(t),!0}if(t===fl.none){let i=e,o=0;const r=2;for(let e=0;e<r;++e)if(i+=this._peekAhead(e),t=this._findType(i),t!==fl.none){o=e;break}if(t===fl.none)return n!==fl.none&&(this._current--,this._addToken(n),!0);e=i,this._current+=o+1}if(n=t,this._isAtEnd())break;e+=this._advance()}return n!==fl.none&&(this._addToken(n),!0)}_findType(e){for(const t in fl.regexTokens){const n=fl.regexTokens[t];if(this._match(e,n.rule))return n}return fl.literalTokens[e]||fl.none}_match(e,t){const n=t.exec(e);return n&&0==n.index&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&"_"!==e&&"."!==e&&"("!==e&&")"!==e&&"["!==e&&"]"!==e&&"{"!==e&&"}"!==e&&","!==e&&";"!==e&&":"!==e&&"="!==e&&"!"!==e&&"<"!==e&&">"!==e&&"+"!==e&&"-"!==e&&"*"!==e&&"/"!==e&&"%"!==e&&"&"!==e&&"|"!==e&&"^"!==e&&"~"!==e&&"@"!==e&&"#"!==e&&"?"!==e&&"'"!==e&&"`"!==e&&'"'!==e&&"\\"!==e&&"\n"!==e&&"\r"!==e&&"\t"!==e&&"\0"!==e}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||"_"===e}_isWhitespace(e){return" "==e||"\t"==e||"\r"==e}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new ml(e,t,this._line,this._start,this._current))}}function gl(e){return Array.isArray(e)||(null==e?void 0:e.buffer)instanceof ArrayBuffer}const yl=new Float32Array(1),bl=new Uint32Array(yl.buffer),vl=new Uint32Array(yl.buffer),xl=new Int32Array(1),wl=new Float32Array(xl.buffer),Sl=new Uint32Array(xl.buffer),El=new Uint32Array(1),Tl=new Float32Array(El.buffer),Cl=new Int32Array(El.buffer);function Il(e,t,n){if(t===n)return e;if("f32"===t){if("i32"===n||"x32"===n)return yl[0]=e,bl[0];if("u32"===n)return yl[0]=e,vl[0]}else if("i32"===t||"x32"===t){if("f32"===n)return xl[0]=e,wl[0];if("u32"===n)return xl[0]=e,Sl[0]}else if("u32"===t){if("f32"===n)return El[0]=e,Tl[0];if("i32"===n||"x32"===n)return El[0]=e,Cl[0]}return console.error(`Unsupported cast from ${t} to ${n}`),e}class Al{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class kl{constructor(e,t){this.align=e,this.size=t}}class Ll{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new $s,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return"texture_storage_1d"==e.name||"texture_storage_2d"==e.name||"texture_storage_2d_array"==e.name||"texture_storage_3d"==e.name}updateAST(e){for(const t of e)t instanceof oa&&this._functions.set(t.name,new Al(t));for(const t of e)if(t instanceof Da){const e=this.getTypeInfo(t,null);e instanceof ks&&this.structs.push(e)}for(const t of e)if(t instanceof Ia)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof ua){const e=t,n=this._getAttributeNum(e.attributes,"id",0),i=null!=e.type?this.getTypeInfo(e.type,e.attributes):null;this.overrides.push(new Fs(e.name,i,e.attributes,n));continue}if(this._isUniformVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),o=this.getTypeInfo(e.type,e.attributes),r=new Ms(e.name,o,n,i,e.attributes,Ds.Uniform,e.access);r.access||(r.access="read"),this.uniforms.push(r);continue}if(this._isStorageVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),o=this.getTypeInfo(e.type,e.attributes),r=this._isStorageTexture(o),s=new Ms(e.name,o,n,i,e.attributes,r?Ds.StorageTexture:Ds.Storage,e.access);s.access||(s.access="read"),this.storage.push(s);continue}if(this._isTextureVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),o=this.getTypeInfo(e.type,e.attributes),r=this._isStorageTexture(o),s=new Ms(e.name,o,n,i,e.attributes,r?Ds.StorageTexture:Ds.Texture,e.access);s.access||(s.access="read"),r?this.storage.push(s):this.textures.push(s);continue}if(this._isSamplerVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),o=this.getTypeInfo(e.type,e.attributes),r=new Ms(e.name,o,n,i,e.attributes,Ds.Sampler,e.access);this.samplers.push(r);continue}}for(const t of e)if(t instanceof oa){const e=this._getAttribute(t,"vertex"),n=this._getAttribute(t,"fragment"),i=this._getAttribute(t,"compute"),o=e||n||i,r=new Us(t.name,null==o?void 0:o.name,t.attributes);r.attributes=t.attributes,r.startLine=t.startLine,r.endLine=t.endLine,this.functions.push(r),this._functions.get(t.name).info=r,o&&(this._functions.get(t.name).inUse=!0,r.inUse=!0,r.resources=this._findResources(t,!!o),r.inputs=this._getInputs(t.args),r.outputs=this._getOutputs(t.returnType),this.entry[o.name].push(r)),r.arguments=t.args.map(e=>new zs(e.name,this.getTypeInfo(e.type,e.attributes),e.attributes)),r.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(e=>{var n,i,o;if(e instanceof il){if(e.value)if(gl(e.value))for(const r of e.value)for(const e of this.overrides)r===e.name&&(null===(n=t.info)||void 0===n||n.overrides.push(e));else for(const r of this.overrides)e.value===r.name&&(null===(i=t.info)||void 0===i||i.overrides.push(r))}else if(e instanceof Va)for(const r of this.overrides)e.name===r.name&&(null===(o=t.info)||void 0===o||o.overrides.push(r))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getFunctionInfo(e){for(const t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var n;for(const i of e.calls){const e=null===(n=this._functions.get(i.name))||void 0===n?void 0:n.info;e&&t.add(e)}}findResource(e,t,n){if(n){for(const i of this.entry.compute)if(i.name===n)for(const n of i.resources)if(n.group==e&&n.binding==t)return n;for(const i of this.entry.vertex)if(i.name===n)for(const n of i.resources)if(n.group==e&&n.binding==t)return n;for(const i of this.entry.fragment)if(i.name===n)for(const n of i.resources)if(n.group==e&&n.binding==t)return n}for(const i of this.uniforms)if(i.group==e&&i.binding==t)return i;for(const i of this.storage)if(i.group==e&&i.binding==t)return i;for(const i of this.textures)if(i.group==e&&i.binding==t)return i;for(const i of this.samplers)if(i.group==e&&i.binding==t)return i;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const n=[],i=this,o=[];return e.search(r=>{if(r instanceof ea)o.push({});else if(r instanceof ta)o.pop();else if(r instanceof ca){const e=r;t&&null!==e.type&&this._markStructsFromAST(e.type),o.length>0&&(o[o.length-1][e.name]=e)}else if(r instanceof Ua){const e=r;t&&null!==e.type&&this._markStructsFromAST(e.type)}else if(r instanceof ha){const e=r;t&&null!==e.type&&this._markStructsFromAST(e.type),o.length>0&&(o[o.length-1][e.name]=e)}else if(r instanceof Va){const e=r;if(o.length>0&&o[o.length-1][e.name])return;const t=i._findResource(e.name);t&&n.push(t)}else if(r instanceof $a){const o=r,s=i._functions.get(o.name);s&&(t&&(s.inUse=!0),e.calls.add(s.node),null===s.resources&&(s.resources=i._findResources(s.node,t)),n.push(...s.resources))}else if(r instanceof ba){const o=r,s=i._functions.get(o.name);s&&(t&&(s.inUse=!0),e.calls.add(s.node),null===s.resources&&(s.resources=i._findResources(s.node,t)),n.push(...s.resources))}}),[...new Map(n.map(e=>[e.name,e])).values()]}getBindGroups(){const e=[];function t(t,n){t>=e.length&&(e.length=t+1),void 0===e[t]&&(e[t]=[]),n>=e[t].length&&(e[t].length=n+1)}for(const n of this.uniforms)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)t(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e,t=void 0){if(void 0===t&&(t=[]),e instanceof Da)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);null!==n&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof Da)this._getStructOutputs(n.type,t);else{const e=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(null!==e){const i=this.getTypeInfo(n.type,n.type.attributes),o=this._parseInt(e.value),r=new Bs(n.name,i,e.name,o);t.push(r)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this.getTypeInfo(e,e.attributes),i=this._parseInt(t.value);return new Bs("",n,t.name,i)}return null}_getInputs(e,t=void 0){void 0===t&&(t=[]);for(const n of e)if(n.type instanceof Da)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof Da)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),o=this._parseInt(t.value),r=new Os(e.name,i,t.name,o);return null!==n&&(r.interpolation=this._parseString(n.value)),r}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new Ns(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof Na){const n=e.type?this.getTypeInfo(e.type,e.attributes):null,i=new Rs(e.name,n,t);return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof Oa){const n=e,i=n.format?this.getTypeInfo(n.format,n.attributes):null,o=new Ls(n.name,t);return o.format=i,o.count=n.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Da){const n=e,i=new ks(n.name,t);i.startLine=n.startLine,i.endLine=n.endLine;for(const e of n.members){const t=this.getTypeInfo(e.type,e.attributes);i.members.push(new As(e.name,t,e.attributes))}return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof Ba){const n=e,i=n.format instanceof Ra,o=n.format?i?this.getTypeInfo(n.format,null):new Is(n.format,null):null,r=new Ps(n.name,o,t,n.access);return this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof Ma){const n=e,i=n.format?this.getTypeInfo(n.format,null):null,o=new Ps(n.name,i,t,n.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const n=new Is(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n,i;const o=this._getTypeSize(e);if(e.size=null!==(t=null==o?void 0:o.size)&&void 0!==t?t:0,e instanceof Ls&&e.format){const t=this._getTypeSize(e.format);e.stride=Math.max(null!==(n=null==t?void 0:t.size)&&void 0!==n?n:0,null!==(i=null==t?void 0:t.align)&&void 0!==i?i:0),this._updateTypeInfo(e.format)}e instanceof Rs&&this._updateTypeInfo(e.format),e instanceof ks&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,i=0,o=0,r=0;for(let s=0,a=e.members.length;s<a;++s){const a=e.members[s],l=this._getTypeSize(a);if(!l)continue;null!==(t=this._getAlias(a.type.name))&&void 0!==t||a.type;const c=l.align,u=l.size;n=this._roundUp(c,n+i),i=u,o=n,r=Math.max(r,c),a.offset=n,a.size=u,this._updateTypeInfo(a.type)}e.size=this._roundUp(r,o+i),e.align=r}_getTypeSize(e){var t,n;if(null==e)return null;const i=this._getAttributeNum(e.attributes,"size",0),o=this._getAttributeNum(e.attributes,"align",0);if(e instanceof As&&(e=e.type),e instanceof Is){const t=this._getAlias(e.name);null!==t&&(e=t)}{const n=Ll._typeInfo[e.name];if(void 0!==n){const r="f16"===(null===(t=e.format)||void 0===t?void 0:t.name)?2:1;return new kl(Math.max(o,n.align/r),Math.max(i,n.size/r))}}{const t=Ll._typeInfo[e.name.substring(0,e.name.length-1)];if(t){const n="h"===e.name[e.name.length-1]?2:1;return new kl(Math.max(o,t.align/n),Math.max(i,t.size/n))}}if(e instanceof Ls){let t=e,r=8,s=8;const a=this._getTypeSize(t.format);return null!==a&&(s=a.size,r=a.align),s=t.count*this._getAttributeNum(null!==(n=null==e?void 0:e.attributes)&&void 0!==n?n:null,"stride",this._roundUp(r,s)),i&&(s=i),new kl(Math.max(o,r),Math.max(i,s))}if(e instanceof ks){let t=0,n=0,r=0,s=0,a=0;for(const i of e.members){const e=this._getTypeSize(i.type);null!==e&&(t=Math.max(e.align,t),r=this._roundUp(e.align,r+s),s=e.size,a=r)}return n=this._roundUp(t,a+s),new kl(Math.max(o,t),Math.max(i,n))}return null}_isUniformVar(e){return e instanceof ca&&"uniform"==e.storage}_isStorageVar(e){return e instanceof ca&&"storage"==e.storage}_isTextureVar(e){return e instanceof ca&&null!==e.type&&-1!=Ll._textureTypes.indexOf(e.type.name)}_isSamplerVar(e){return e instanceof ca&&null!==e.type&&-1!=Ll._samplerTypes.indexOf(e.type.name)}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const i=n.attributes;for(let o of i)if(o.name==t)return o;return null}_getAttributeNum(e,t,n){if(null===e)return n;for(let i of e)if(i.name==t){let e=null!==i&&null!==i.value?i.value:n;return e instanceof Array&&(e=e[0]),"number"==typeof e?e:"string"==typeof e?parseInt(e):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}}Ll._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Ll._textureTypes=fl.any_texture_type.map(e=>e.name),Ll._samplerTypes=fl.sampler_type.map(e=>e.name);let Rl=0;class Pl{constructor(e,t,n){this.id=Rl++,this.name=e,this.value=t,this.node=n}clone(){return new Pl(this.name,this.value,this.node)}}class Dl{constructor(e){this.id=Rl++,this.name=e.name,this.node=e}clone(){return new Dl(this.node)}}class Ml{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=Rl++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?null!==(t=this.variables.get(e))&&void 0!==t?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?null!==(t=this.functions.get(e))&&void 0!==t?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,n){this.variables.set(e,new Pl(e,t,n??null))}setVariable(e,t,n){const i=this.getVariable(e);null!==i?i.value=t:this.createVariable(e,t,n)}getVariableValue(e){var t;const n=this.getVariable(e);return null!==(t=null==n?void 0:n.value)&&void 0!==t?t:null}clone(){return new Ml(this)}}class Nl{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class Ol{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const n=this.exec.evalExpression(e.args[0],t);let i=!0;if(n instanceof cl)return n.data.forEach(e=>{e||(i=!1)}),new al(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl){const e=n.data.some(e=>e);return new al(e?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const n=this.exec.evalExpression(e.args[2],t);if(!(n instanceof al))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return n.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let n=e.args[0];n instanceof qa&&(n=n.right);const i=this.exec.evalExpression(n,t);if(i instanceof hl&&0===i.typeInfo.size){const e=i.typeInfo,t=i.buffer.byteLength/e.stride;return new al(t,this.getTypeInfo("u32"))}return new al(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.abs(e)),n.typeInfo);const i=n;return new al(Math.abs(i.value),i.typeInfo)}Acos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.acos(e)),n.typeInfo);const i=n;return new al(Math.acos(i.value),n.typeInfo)}Acosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.acosh(e)),n.typeInfo);const i=n;return new al(Math.acosh(i.value),n.typeInfo)}Asin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.asin(e)),n.typeInfo);const i=n;return new al(Math.asin(i.value),n.typeInfo)}Asinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.asinh(e)),n.typeInfo);const i=n;return new al(Math.asinh(i.value),n.typeInfo)}Atan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.atan(e)),n.typeInfo);const i=n;return new al(Math.atan(i.value),n.typeInfo)}Atanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.atanh(e)),n.typeInfo);const i=n;return new al(Math.atanh(i.value),n.typeInfo)}Atan2(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof cl&&i instanceof cl)return new cl(n.data.map((e,t)=>Math.atan2(e,i.data[t])),n.typeInfo);const o=n,r=i;return new al(Math.atan2(o.value,r.value),n.typeInfo)}Ceil(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.ceil(e)),n.typeInfo);const i=n;return new al(Math.ceil(i.value),n.typeInfo)}_clamp(e,t,n){return Math.min(Math.max(e,t),n)}Clamp(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(n instanceof cl&&i instanceof cl&&o instanceof cl)return new cl(n.data.map((e,t)=>this._clamp(e,i.data[t],o.data[t])),n.typeInfo);const r=n,s=i,a=o;return new al(this._clamp(r.value,s.value,a.value),n.typeInfo)}Cos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.cos(e)),n.typeInfo);const i=n;return new al(Math.cos(i.value),n.typeInfo)}Cosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.cosh(e)),n.typeInfo);const i=n;return new al(Math.cos(i.value),n.typeInfo)}CountLeadingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.clz32(e)),n.typeInfo);const i=n;return new al(Math.clz32(i.value),n.typeInfo)}_countOneBits(e){let t=0;for(;0!==e;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>this._countOneBits(e)),n.typeInfo);const i=n;return new al(this._countOneBits(i.value),n.typeInfo)}_countTrailingZeros(e){if(0===e)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>this._countTrailingZeros(e)),n.typeInfo);const i=n;return new al(this._countTrailingZeros(i.value),n.typeInfo)}Cross(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof cl&&i instanceof cl){if(3!==n.data.length||3!==i.data.length)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const t=n.data,o=i.data;return new cl([t[1]*o[2]-o[1]*t[2],t[2]*o[0]-o[2]*t[0],t[0]*o[1]-o[0]*t[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const n=this.exec.evalExpression(e.args[0],t),i=180/Math.PI;return n instanceof cl?new cl(n.data.map(e=>e*i),n.typeInfo):new al(n.value*i,this.getTypeInfo("f32"))}Determinant(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ul){const e=n.data,t=n.typeInfo.getTypeName(),i=t.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t)return new al(e[0]*e[3]-e[1]*e[2],i);if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t)return new al(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),i);if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t)console.error(`TODO: Determinant for ${t}`);else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t)console.error(`TODO: Determinant for ${t}`);else{if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t)return new al(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),i);"mat3x4"===t||"mat3x4f"===t||"mat3x4h"===t||"mat4x2"===t||"mat4x2f"===t||"mat4x2h"===t||"mat4x3"===t||"mat4x3f"===t||"mat4x3h"===t?console.error(`TODO: Determinant for ${t}`):"mat4x4"!==t&&"mat4x4f"!==t&&"mat4x4h"!==t||console.error(`TODO: Determinant for ${t}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof cl&&i instanceof cl){let e=0;for(let t=0;t<n.data.length;++t)e+=(n.data[t]-i.data[t])*(n.data[t]-i.data[t]);return new al(Math.sqrt(e),this.getTypeInfo("f32"))}const o=n,r=i;return new al(Math.abs(o.value-r.value),n.typeInfo)}_dot(e,t){let n=0;for(let i=0;i<e.length;++i)n+=t[i]*e[i];return n}Dot(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return n instanceof cl&&i instanceof cl?new al(this._dot(n.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.exp(e)),n.typeInfo);const i=n;return new al(Math.exp(i.value),n.typeInfo)}Exp2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.pow(2,e)),n.typeInfo);const i=n;return new al(Math.pow(2,i.value),n.typeInfo)}ExtractBits(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if("u32"!==i.typeInfo.name&&"x32"!==i.typeInfo.name)return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if("u32"!==o.typeInfo.name&&"x32"!==o.typeInfo.name)return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const r=i.value,s=o.value;if(n instanceof cl)return new cl(n.data.map(e=>e>>r&(1<<s)-1),n.typeInfo);if("i32"!==n.typeInfo.name&&"x32"!==n.typeInfo.name)return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const a=n.value;return new al(a>>r&(1<<s)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(n instanceof cl&&i instanceof cl&&o instanceof cl){const e=this._dot(i.data,o.data);return new cl(e<0?Array.from(n.data):n.data.map(e=>-e),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return 0===e?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>this._firstLeadingBit(e)),n.typeInfo);const i=n;return new al(this._firstLeadingBit(i.value),n.typeInfo)}_firstTrailingBit(e){return 0===e?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>this._firstTrailingBit(e)),n.typeInfo);const i=n;return new al(this._firstTrailingBit(i.value),n.typeInfo)}Floor(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.floor(e)),n.typeInfo);const i=n;return new al(Math.floor(i.value),n.typeInfo)}Fma(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(n instanceof cl&&i instanceof cl&&o instanceof cl)return n.data.length!==i.data.length||n.data.length!==o.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new cl(n.data.map((e,t)=>e*i.data[t]+o.data[t]),n.typeInfo);const r=n,s=i,a=o;return new al(r.value*s.value+a.value,r.typeInfo)}Fract(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>e-Math.floor(e)),n.typeInfo);const i=n;return new al(i.value-Math.floor(i.value),n.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t),r=this.exec.evalExpression(e.args[3],t);if("u32"!==o.typeInfo.name&&"x32"!==o.typeInfo.name)return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const s=o.value,a=(1<<r.value)-1<<s,l=~a;if(n instanceof cl&&i instanceof cl)return new cl(n.data.map((e,t)=>e&l|i.data[t]<<s&a),n.typeInfo);const c=n.value,u=i.value;return new al(c&l|u<<s&a,n.typeInfo)}InverseSqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>1/Math.sqrt(e)),n.typeInfo);const i=n;return new al(1/Math.sqrt(i.value),n.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl){let e=0;return n.data.forEach(t=>{e+=t*t}),new al(Math.sqrt(e),this.getTypeInfo("f32"))}const i=n;return new al(Math.abs(i.value),n.typeInfo)}Log(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.log(e)),n.typeInfo);const i=n;return new al(Math.log(i.value),n.typeInfo)}Log2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.log2(e)),n.typeInfo);const i=n;return new al(Math.log2(i.value),n.typeInfo)}Max(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof cl&&i instanceof cl)return new cl(n.data.map((e,t)=>Math.max(e,i.data[t])),n.typeInfo);const o=n,r=i;return new al(Math.max(o.value,r.value),n.typeInfo)}Min(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof cl&&i instanceof cl)return new cl(n.data.map((e,t)=>Math.min(e,i.data[t])),n.typeInfo);const o=n,r=i;return new al(Math.min(o.value,r.value),n.typeInfo)}Mix(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(n instanceof cl&&i instanceof cl&&o instanceof cl)return new cl(n.data.map((e,t)=>n.data[t]*(1-o.data[t])+i.data[t]*o.data[t]),n.typeInfo);const r=i,s=o;return new al(n.value*(1-s.value)+r.value*s.value,n.typeInfo)}Modf(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof cl&&i instanceof cl)return new cl(n.data.map((e,t)=>e%i.data[t]),n.typeInfo);const o=i;return new al(n.value%o.value,n.typeInfo)}Normalize(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl){const i=this.Length(e,t).value;return new cl(n.data.map(e=>e/i),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof cl&&i instanceof cl)return new cl(n.data.map((e,t)=>Math.pow(e,i.data[t])),n.typeInfo);const o=n,r=i;return new al(Math.pow(o.value,r.value),n.typeInfo)}QuantizeToF16(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof cl?new cl(n.data.map(e=>e),n.typeInfo):new al(n.value,n.typeInfo)}Radians(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof cl?new cl(n.data.map(e=>e*Math.PI/180),n.typeInfo):new al(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof cl&&i instanceof cl){const e=this._dot(n.data,i.data);return new cl(n.data.map((t,n)=>t-2*e*i.data[n]),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(n instanceof cl&&i instanceof cl&&o instanceof al){const e=this._dot(i.data,n.data);return new cl(n.data.map((t,n)=>{const r=1-o.value*o.value*(1-e*e);if(r<0)return 0;const s=Math.sqrt(r);return o.value*t-(o.value*e+s)*i.data[n]}),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.round(e)),n.typeInfo);const i=n;return new al(Math.round(i.value),n.typeInfo)}Saturate(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.min(Math.max(e,0),1)),n.typeInfo);const i=n;return new al(Math.min(Math.max(i.value,0),1),n.typeInfo)}Sign(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.sign(e)),n.typeInfo);const i=n;return new al(Math.sign(i.value),n.typeInfo)}Sin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.sin(e)),n.typeInfo);const i=n;return new al(Math.sin(i.value),n.typeInfo)}Sinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.sinh(e)),n.typeInfo);const i=n;return new al(Math.sinh(i.value),n.typeInfo)}_smoothstep(e,t,n){const i=Math.min(Math.max((n-e)/(t-e),0),1);return i*i*(3-2*i)}SmoothStep(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(o instanceof cl&&n instanceof cl&&i instanceof cl)return new cl(o.data.map((e,t)=>this._smoothstep(n.data[t],i.data[t],e)),o.typeInfo);const r=n,s=i,a=o;return new al(this._smoothstep(r.value,s.value,a.value),o.typeInfo)}Sqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.sqrt(e)),n.typeInfo);const i=n;return new al(Math.sqrt(i.value),n.typeInfo)}Step(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(i instanceof cl&&n instanceof cl)return new cl(i.data.map((e,t)=>e<n.data[t]?0:1),i.typeInfo);const o=n;return new al(i.value<o.value?0:1,o.typeInfo)}Tan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.tan(e)),n.typeInfo);const i=n;return new al(Math.tan(i.value),n.typeInfo)}Tanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.tanh(e)),n.typeInfo);const i=n;return new al(Math.tanh(i.value),n.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return"mat2x2f"===t||"mat2x2h"===t?e:"mat2x3f"===t?this.getTypeInfo("mat3x2f"):"mat2x3h"===t?this.getTypeInfo("mat3x2h"):"mat2x4f"===t?this.getTypeInfo("mat4x2f"):"mat2x4h"===t?this.getTypeInfo("mat4x2h"):"mat3x2f"===t?this.getTypeInfo("mat2x3f"):"mat3x2h"===t?this.getTypeInfo("mat2x3h"):"mat3x3f"===t||"mat3x3h"===t?e:"mat3x4f"===t?this.getTypeInfo("mat4x3f"):"mat3x4h"===t?this.getTypeInfo("mat4x3h"):"mat4x2f"===t?this.getTypeInfo("mat2x4f"):"mat4x2h"===t?this.getTypeInfo("mat2x4h"):"mat4x3f"===t?this.getTypeInfo("mat3x4f"):"mat4x3h"===t?this.getTypeInfo("mat3x4h"):("mat4x4f"===t||"mat4x4h"===t||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const n=this.exec.evalExpression(e.args[0],t);if(!(n instanceof ul))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const i=this._getTransposeType(n.typeInfo);if("mat2x2"===n.typeInfo.name||"mat2x2f"===n.typeInfo.name||"mat2x2h"===n.typeInfo.name){const e=n.data;return new ul([e[0],e[2],e[1],e[3]],i)}if("mat2x3"===n.typeInfo.name||"mat2x3f"===n.typeInfo.name||"mat2x3h"===n.typeInfo.name){const e=n.data;return new ul([e[0],e[3],e[6],e[1],e[4],e[7]],i)}if("mat2x4"===n.typeInfo.name||"mat2x4f"===n.typeInfo.name||"mat2x4h"===n.typeInfo.name){const e=n.data;return new ul([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13]],i)}if("mat3x2"===n.typeInfo.name||"mat3x2f"===n.typeInfo.name||"mat3x2h"===n.typeInfo.name){const e=n.data;return new ul([e[0],e[3],e[1],e[4],e[2],e[5]],i)}if("mat3x3"===n.typeInfo.name||"mat3x3f"===n.typeInfo.name||"mat3x3h"===n.typeInfo.name){const e=n.data;return new ul([e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]],i)}if("mat3x4"===n.typeInfo.name||"mat3x4f"===n.typeInfo.name||"mat3x4h"===n.typeInfo.name){const e=n.data;return new ul([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14]],i)}if("mat4x2"===n.typeInfo.name||"mat4x2f"===n.typeInfo.name||"mat4x2h"===n.typeInfo.name){const e=n.data;return new ul([e[0],e[4],e[1],e[5],e[2],e[6]],i)}if("mat4x3"===n.typeInfo.name||"mat4x3f"===n.typeInfo.name||"mat4x3h"===n.typeInfo.name){const e=n.data;return new ul([e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]],i)}if("mat4x4"===n.typeInfo.name||"mat4x4f"===n.typeInfo.name||"mat4x4h"===n.typeInfo.name){const e=n.data;return new ul([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]],i)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof cl)return new cl(n.data.map(e=>Math.trunc(e)),n.typeInfo);const i=n;return new al(Math.trunc(i.value),n.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const n=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(n instanceof Va){const o=n.name,r=t.getVariableValue(o);if(r instanceof dl){if(i<0||i>=r.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const t=r.getMipLevelSize(i),n=r.dimension;return"1d"===n?new al(t[0],this.getTypeInfo("u32")):"3d"===n?new cl(t,this.getTypeInfo("vec3u")):"2d"===n?new cl(t.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${n} not found. Line ${e.line}`),null)}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const n=e.args[0],i=this.exec.evalExpression(e.args[1],t),o=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(i instanceof cl)||2!==i.data.length)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(n instanceof Va){const r=n.name,s=t.getVariableValue(r);if(s instanceof dl){const t=Math.floor(i.data[0]),n=Math.floor(i.data[1]);if(t<0||t>=s.width||n<0||n>=s.height)return console.error(`Texture ${r} out of bounds. Line ${e.line}`),null;const a=s.getPixel(t,n,0,o);return null===a?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new cl(a,this.getTypeInfo("vec4f"))}return console.error(`Texture ${r} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const n=e.args[0];if(n instanceof Va){const i=n.name,o=t.getVariableValue(i);return o instanceof dl?new al(o.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const n=e.args[0];if(n instanceof Va){const i=n.name,o=t.getVariableValue(i);return o instanceof dl?new al(o.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const n=e.args[0];if(n instanceof Va){const i=n.name,o=t.getVariableValue(i);return o instanceof dl?new al(o.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const n=e.args[0],i=this.exec.evalExpression(e.args[1],t),o=4===e.args.length?this.exec.evalExpression(e.args[2],t).value:0,r=4===e.args.length?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(4!==r.length)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof cl)||2!==i.data.length)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(n instanceof Va){const s=n.name,a=t.getVariableValue(s);if(a instanceof dl){const t=a.getMipLevelSize(0),n=Math.floor(i.data[0]),l=Math.floor(i.data[1]);return n<0||n>=t[0]||l<0||l>=t[1]?(console.error(`Texture ${s} out of bounds. Line ${e.line}`),null):(a.setPixel(n,l,0,o,Array.from(r)),null)}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let n=e.args[0];n instanceof qa&&(n=n.right);const i=this.exec.getVariableName(n,t);return t.getVariable(i).value.getSubData(this.exec,n.postfix,t)}AtomicStore(e,t){let n=e.args[0];n instanceof qa&&(n=n.right);const i=this.exec.getVariableName(n,t),o=t.getVariable(i);let r=e.args[1];const s=this.exec.evalExpression(r,t),a=o.value.getSubData(this.exec,n.postfix,t);return a instanceof al&&s instanceof al&&(a.value=s.value),o.value instanceof hl&&o.value.setDataValue(this.exec,a,n.postfix,t),null}AtomicAdd(e,t){let n=e.args[0];n instanceof qa&&(n=n.right);const i=this.exec.getVariableName(n,t),o=t.getVariable(i);let r=e.args[1];const s=this.exec.evalExpression(r,t),a=o.value.getSubData(this.exec,n.postfix,t),l=new al(a.value,a.typeInfo);return a instanceof al&&s instanceof al&&(a.value+=s.value),o.value instanceof hl&&o.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicSub(e,t){let n=e.args[0];n instanceof qa&&(n=n.right);const i=this.exec.getVariableName(n,t),o=t.getVariable(i);let r=e.args[1];const s=this.exec.evalExpression(r,t),a=o.value.getSubData(this.exec,n.postfix,t),l=new al(a.value,a.typeInfo);return a instanceof al&&s instanceof al&&(a.value-=s.value),o.value instanceof hl&&o.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicMax(e,t){let n=e.args[0];n instanceof qa&&(n=n.right);const i=this.exec.getVariableName(n,t),o=t.getVariable(i);let r=e.args[1];const s=this.exec.evalExpression(r,t),a=o.value.getSubData(this.exec,n.postfix,t),l=new al(a.value,a.typeInfo);return a instanceof al&&s instanceof al&&(a.value=Math.max(a.value,s.value)),o.value instanceof hl&&o.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicMin(e,t){let n=e.args[0];n instanceof qa&&(n=n.right);const i=this.exec.getVariableName(n,t),o=t.getVariable(i);let r=e.args[1];const s=this.exec.evalExpression(r,t),a=o.value.getSubData(this.exec,n.postfix,t),l=new al(a.value,a.typeInfo);return a instanceof al&&s instanceof al&&(a.value=Math.min(a.value,s.value)),o.value instanceof hl&&o.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicAnd(e,t){let n=e.args[0];n instanceof qa&&(n=n.right);const i=this.exec.getVariableName(n,t),o=t.getVariable(i);let r=e.args[1];const s=this.exec.evalExpression(r,t),a=o.value.getSubData(this.exec,n.postfix,t),l=new al(a.value,a.typeInfo);return a instanceof al&&s instanceof al&&(a.value=a.value&s.value),o.value instanceof hl&&o.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicOr(e,t){let n=e.args[0];n instanceof qa&&(n=n.right);const i=this.exec.getVariableName(n,t),o=t.getVariable(i);let r=e.args[1];const s=this.exec.evalExpression(r,t),a=o.value.getSubData(this.exec,n.postfix,t),l=new al(a.value,a.typeInfo);return a instanceof al&&s instanceof al&&(a.value=a.value|s.value),o.value instanceof hl&&o.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicXor(e,t){let n=e.args[0];n instanceof qa&&(n=n.right);const i=this.exec.getVariableName(n,t),o=t.getVariable(i);let r=e.args[1];const s=this.exec.evalExpression(r,t),a=o.value.getSubData(this.exec,n.postfix,t),l=new al(a.value,a.typeInfo);return a instanceof al&&s instanceof al&&(a.value=a.value^s.value),o.value instanceof hl&&o.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicExchange(e,t){let n=e.args[0];n instanceof qa&&(n=n.right);const i=this.exec.getVariableName(n,t),o=t.getVariable(i);let r=e.args[1];const s=this.exec.evalExpression(r,t),a=o.value.getSubData(this.exec,n.postfix,t),l=new al(a.value,a.typeInfo);return a instanceof al&&s instanceof al&&(a.value=s.value),o.value instanceof hl&&o.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const Bl={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Fl={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class zl extends Nl{constructor(e,t){var n;super(),this.ast=e??[],this.reflection=new Ll,this.reflection.updateAST(this.ast),this.context=null!==(n=null==t?void 0:t.clone())&&void 0!==n?n:new Ml,this.builtins=new Ol(this),this.typeInfo={bool:this.getTypeInfo(Ra.bool),i32:this.getTypeInfo(Ra.i32),u32:this.getTypeInfo(Ra.u32),f32:this.getTypeInfo(Ra.f32),f16:this.getTypeInfo(Ra.f16),vec2f:this.getTypeInfo(Ma.vec2f),vec2u:this.getTypeInfo(Ma.vec2u),vec2i:this.getTypeInfo(Ma.vec2i),vec2h:this.getTypeInfo(Ma.vec2h),vec3f:this.getTypeInfo(Ma.vec3f),vec3u:this.getTypeInfo(Ma.vec3u),vec3i:this.getTypeInfo(Ma.vec3i),vec3h:this.getTypeInfo(Ma.vec3h),vec4f:this.getTypeInfo(Ma.vec4f),vec4u:this.getTypeInfo(Ma.vec4u),vec4i:this.getTypeInfo(Ma.vec4i),vec4h:this.getTypeInfo(Ma.vec4h),mat2x2f:this.getTypeInfo(Ma.mat2x2f),mat2x3f:this.getTypeInfo(Ma.mat2x3f),mat2x4f:this.getTypeInfo(Ma.mat2x4f),mat3x2f:this.getTypeInfo(Ma.mat3x2f),mat3x3f:this.getTypeInfo(Ma.mat3x3f),mat3x4f:this.getTypeInfo(Ma.mat3x4f),mat4x2f:this.getTypeInfo(Ma.mat4x2f),mat4x3f:this.getTypeInfo(Ma.mat4x3f),mat4x4f:this.getTypeInfo(Ma.mat4x4f)}}getVariableValue(e){var t,n;const i=null!==(n=null===(t=this.context.getVariable(e))||void 0===t?void 0:t.value)&&void 0!==n?n:null;if(null===i)return null;if(i instanceof al)return i.value;if(i instanceof cl||i instanceof ul)return Array.from(i.data);if(i instanceof hl&&i.typeInfo instanceof Ls){if("u32"===i.typeInfo.format.name)return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if("i32"===i.typeInfo.format.name)return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if("f32"===i.typeInfo.format.name)return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,n,i){const o=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,o),this._execStatements(this.ast,o);const r=o.getFunction(e);if(!r)return void console.error(`Function ${e} not found`);if("number"==typeof t)t=[t,1,1];else{if(0===t.length)return void console.error("Invalid dispatch count");1===t.length?t=[t[0],1,1]:2===t.length?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const s=t[0],a=t[1],l=t[2],c=this.getTypeInfo("vec3u");o.setVariable("@num_workgroups",new cl(t,c));const u=this.reflection.getFunctionInfo(e);null===u&&console.error(`Function ${e} not found in reflection data`);for(const h in n)for(const e in n[h]){const t=n[h][e];o.variables.forEach(n=>{var i;const o=n.node;if(null!=o&&o.attributes){let r=null,s=null;for(const e of o.attributes)"binding"===e.name?r=e.value:"group"===e.name&&(s=e.value);if(e==r&&h==s){let r=!1;for(const t of u.resources)if(t.name===n.name&&t.group===parseInt(h)&&t.binding===parseInt(e)){r=!0;break}if(r)if(void 0!==t.texture&&void 0!==t.descriptor){const e=new dl(t.texture,this.getTypeInfo(o.type),t.descriptor,null!==(i=t.texture.view)&&void 0!==i?i:null);n.value=e}else void 0!==t.uniform?n.value=new hl(t.uniform,this.getTypeInfo(o.type)):n.value=new hl(t,this.getTypeInfo(o.type))}}})}for(let h=0;h<l;++h)for(let e=0;e<a;++e)for(let t=0;t<s;++t)o.setVariable("@workgroup_id",new cl([t,e,h],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(r,[t,e,h],o)}execStatement(e,t){if(e instanceof Sa)return this.evalExpression(e.value,t);if(e instanceof ka){if(e.condition){const n=this.evalExpression(e.condition,t);if(!(n instanceof al))throw new Error("Invalid break-if condition");if(!n.value)return null}return zl._breakObj}if(e instanceof La)return zl._continueObj;if(e instanceof ha)this._let(e,t);else if(e instanceof ca)this._var(e,t);else if(e instanceof da)this._const(e,t);else if(e instanceof oa)this._function(e,t);else{if(e instanceof wa)return this._if(e,t);if(e instanceof xa)return this._switch(e,t);if(e instanceof la)return this._for(e,t);if(e instanceof sa)return this._while(e,t);if(e instanceof va)return this._loop(e,t);if(e instanceof aa){const n=t.clone();return n.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof ya)this._assign(e,t);else if(e instanceof ga)this._increment(e,t);else{if(e instanceof Da)return null;if(e instanceof ua){const n=e.name;null===t.getVariable(n)&&t.setVariable(n,new al(0,this.getTypeInfo("u32")))}else if(e instanceof ba)this._call(e,t);else{if(e instanceof Ca||e instanceof Ia)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Xa?this._evalBinaryOp(e,t):e instanceof Ga?this._evalLiteral(e,t):e instanceof Va?this._evalVariable(e,t):e instanceof $a?this._evalCall(e,t):e instanceof Ua?this._evalCreate(e,t):e instanceof Ha?this._evalConst(e,t):e instanceof Wa?this._evalBitcast(e,t):e instanceof qa?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof Ra){const t=this.reflection.getTypeInfo(e);if(null!==t)return t}let n=null!==(t=this.typeInfo[e])&&void 0!==t?t:null;return null!==n||(n=this.reflection.getTypeInfoByName(e)),n}_setOverrides(e,t){for(const n in e){const i=e[n],o=this.reflection.getOverrideInfo(n);null!==o?(null===o.type&&(o.type=this.getTypeInfo("u32")),"u32"===o.type.name||"i32"===o.type.name||"f32"===o.type.name||"f16"===o.type.name?t.setVariable(n,new al(i,o.type)):"bool"===o.type.name?t.setVariable(n,new al(i?1:0,o.type)):"vec2"===o.type.name||"vec3"===o.type.name||"vec4"===o.type.name||"vec2f"===o.type.name||"vec3f"===o.type.name||"vec4f"===o.type.name||"vec2i"===o.type.name||"vec3i"===o.type.name||"vec4i"===o.type.name||"vec2u"===o.type.name||"vec3u"===o.type.name||"vec4u"===o.type.name||"vec2h"===o.type.name||"vec3h"===o.type.name||"vec4h"===o.type.name?t.setVariable(n,new cl(i,o.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,n){const i=[1,1,1];for(const c of e.node.attributes)if("workgroup_size"===c.name){if(c.value.length>0){const e=n.getVariableValue(c.value[0]);i[0]=e instanceof al?e.value:parseInt(c.value[0])}if(c.value.length>1){const e=n.getVariableValue(c.value[1]);i[1]=e instanceof al?e.value:parseInt(c.value[1])}if(c.value.length>2){const e=n.getVariableValue(c.value[2]);i[2]=e instanceof al?e.value:parseInt(c.value[2])}}const o=this.getTypeInfo("vec3u"),r=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new cl(i,o));const s=i[0],a=i[1],l=i[2];for(let c=0,u=0;c<l;++c)for(let l=0;l<a;++l)for(let a=0;a<s;++a,++u){const s=[a,l,c],h=[a+t[0]*i[0],l+t[1]*i[1],c+t[2]*i[2]];n.setVariable("@local_invocation_id",new cl(s,o)),n.setVariable("@global_invocation_id",new cl(h,o)),n.setVariable("@local_invocation_index",new al(u,r)),this._dispatchExec(e,n)}}_dispatchExec(e,t){for(const n of e.node.args)for(const e of n.attributes)if("builtin"===e.name){const i=`@${e.value}`,o=t.getVariable(i);void 0!==o&&t.variables.set(n.name,o)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof qa;)e=e.right;return e instanceof Va?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const n of e){if(n instanceof Array){const e=t.clone(),i=this._execStatements(n,e);if(i)return i;continue}const e=this.execStatement(n,t);if(e)return e}return null}_call(e,t){const n=t.clone();n.currentFunctionName=e.name;const i=t.getFunction(e.name);if(i){for(let t=0;t<i.node.args.length;++t){const o=i.node.args[t],r=this.evalExpression(e.args[t],n);n.setVariable(o.name,r,o)}this._execStatements(i.node.body,n)}else e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const n=this.getVariableName(e.variable,t),i=t.getVariable(n);i?"++"===e.operator?i.value instanceof al?i.value.value++:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):"--"===e.operator?i.value instanceof al?i.value.value--:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${n} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof Va){const n=this.getVariableName(e,t),i=t.getVariable(n);return null===i?(console.error(`Variable ${n} not found. Line ${e.line}`),null):i.value.getSubData(this,e.postfix,t)}if(e instanceof qa){if("*"===e.operator){const n=this._getVariableData(e.right,t);return n instanceof sl?n.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if("&"===e.operator){const n=this._getVariableData(e.right,t);return new sl(n)}}return null}_assign(e,t){let n=null,i="<var>",o=null;if(e.variable instanceof qa){const n=this._getVariableData(e.variable,t),i=this.evalExpression(e.value,t),o=e.operator;if("="===o){if(n instanceof al||n instanceof cl||n instanceof ul){if(i instanceof al||i instanceof cl||i instanceof ul&&n.data.length===i.data.length)return void n.data.set(i.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(n instanceof hl&&i instanceof hl&&n.buffer.byteLength-n.offset>=i.buffer.byteLength-i.offset)return void(n.buffer.byteLength%4==0?new Uint32Array(n.buffer,n.offset,n.typeInfo.size/4).set(new Uint32Array(i.buffer,i.offset,i.typeInfo.size/4)):new Uint8Array(n.buffer,n.offset,n.typeInfo.size).set(new Uint8Array(i.buffer,i.offset,i.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if("+="===o)return n instanceof al||n instanceof cl||n instanceof ul?i instanceof al||i instanceof cl||i instanceof ul?void n.data.set(i.data.map((e,t)=>n.data[t]+e)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if("-="===o)return(n instanceof al||n instanceof cl||n instanceof ul)&&(i instanceof al||i instanceof cl||i instanceof ul)?void n.data.set(i.data.map((e,t)=>n.data[t]-e)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof qa){if("*"===e.variable.operator){i=this.getVariableName(e.variable.right,t);const o=t.getVariable(i);if(!(o&&o.value instanceof sl))return void console.error(`Variable ${i} is not a pointer. Line ${e.line}`);n=o.value.reference;let r=e.variable.postfix;if(!r){let t=e.variable.right;for(;t instanceof qa;){if(t.postfix){r=t.postfix;break}t=t.right}}r&&(n=n.getSubData(this,r,t))}}else{o=e.variable.postfix,i=this.getVariableName(e.variable,t);const r=t.getVariable(i);if(null===r)return void console.error(`Variable ${i} not found. Line ${e.line}`);n=r.value}if(n instanceof sl&&(n=n.reference),null===n)return void console.error(`Variable ${i} not found. Line ${e.line}`);const r=this.evalExpression(e.value,t),s=e.operator;if("="!==s){const i=n.getSubData(this,o,t);if(i instanceof cl&&r instanceof al){const t=i.data,n=r.value;if("+="===s)for(let e=0;e<t.length;++e)t[e]+=n;else if("-="===s)for(let e=0;e<t.length;++e)t[e]-=n;else if("*="===s)for(let e=0;e<t.length;++e)t[e]*=n;else if("/="===s)for(let e=0;e<t.length;++e)t[e]/=n;else if("%="===s)for(let e=0;e<t.length;++e)t[e]%=n;else if("&="===s)for(let e=0;e<t.length;++e)t[e]&=n;else if("|="===s)for(let e=0;e<t.length;++e)t[e]|=n;else if("^="===s)for(let e=0;e<t.length;++e)t[e]^=n;else if("<<="===s)for(let e=0;e<t.length;++e)t[e]<<=n;else if(">>="===s)for(let e=0;e<t.length;++e)t[e]>>=n;else console.error(`Invalid operator ${s}. Line ${e.line}`)}else if(i instanceof cl&&r instanceof cl){const t=i.data,n=r.data;if(t.length!==n.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if("+="===s)for(let e=0;e<t.length;++e)t[e]+=n[e];else if("-="===s)for(let e=0;e<t.length;++e)t[e]-=n[e];else if("*="===s)for(let e=0;e<t.length;++e)t[e]*=n[e];else if("/="===s)for(let e=0;e<t.length;++e)t[e]/=n[e];else if("%="===s)for(let e=0;e<t.length;++e)t[e]%=n[e];else if("&="===s)for(let e=0;e<t.length;++e)t[e]&=n[e];else if("|="===s)for(let e=0;e<t.length;++e)t[e]|=n[e];else if("^="===s)for(let e=0;e<t.length;++e)t[e]^=n[e];else if("<<="===s)for(let e=0;e<t.length;++e)t[e]<<=n[e];else if(">>="===s)for(let e=0;e<t.length;++e)t[e]>>=n[e];else console.error(`Invalid operator ${s}. Line ${e.line}`)}else{if(!(i instanceof al&&r instanceof al))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);"+="===s?i.value+=r.value:"-="===s?i.value-=r.value:"*="===s?i.value*=r.value:"/="===s?i.value/=r.value:"%="===s?i.value%=r.value:"&="===s?i.value&=r.value:"|="===s?i.value|=r.value:"^="===s?i.value^=r.value:"<<="===s?i.value<<=r.value:">>="===s?i.value>>=r.value:console.error(`Invalid operator ${s}. Line ${e.line}`)}return void(n instanceof hl&&n.setDataValue(this,i,o,t))}if(n instanceof hl)n.setDataValue(this,r,o,t);else if(o){if(!(n instanceof cl||n instanceof ul))return void console.error(`Variable ${i} is not a vector or matrix. Line ${e.line}`);if(o instanceof ja){const s=this.evalExpression(o.index,t).value;if(n instanceof cl){if(!(r instanceof al))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[s]=r.value}else{if(!(n instanceof ul))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const s=this.evalExpression(o.index,t).value;if(s<0)return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(r instanceof cl))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const t=n.typeInfo.getTypeName();if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t){if(!(s<2&&2===r.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*s]=r.data[0],n.data[2*s+1]=r.data[1]}else if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t){if(!(s<2&&3===r.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*s]=r.data[0],n.data[3*s+1]=r.data[1],n.data[3*s+2]=r.data[2]}else if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t){if(!(s<2&&4===r.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*s]=r.data[0],n.data[4*s+1]=r.data[1],n.data[4*s+2]=r.data[2],n.data[4*s+3]=r.data[3]}else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t){if(!(s<3&&2===r.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*s]=r.data[0],n.data[2*s+1]=r.data[1]}else if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t){if(!(s<3&&3===r.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*s]=r.data[0],n.data[3*s+1]=r.data[1],n.data[3*s+2]=r.data[2]}else if("mat3x4"===t||"mat3x4f"===t||"mat3x4h"===t){if(!(s<3&&4===r.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*s]=r.data[0],n.data[4*s+1]=r.data[1],n.data[4*s+2]=r.data[2],n.data[4*s+3]=r.data[3]}else if("mat4x2"===t||"mat4x2f"===t||"mat4x2h"===t){if(!(s<4&&2===r.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*s]=r.data[0],n.data[2*s+1]=r.data[1]}else if("mat4x3"===t||"mat4x3f"===t||"mat4x3h"===t){if(!(s<4&&3===r.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*s]=r.data[0],n.data[3*s+1]=r.data[1],n.data[3*s+2]=r.data[2]}else{if("mat4x4"!==t&&"mat4x4f"!==t&&"mat4x4h"!==t)return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(s<4&&4===r.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*s]=r.data[0],n.data[4*s+1]=r.data[1],n.data[4*s+2]=r.data[2],n.data[4*s+3]=r.data[3]}}}}}else if(o instanceof za){const t=o.value;if(!(n instanceof cl))return void console.error(`Invalid assignment to ${t}. Variable ${i} is not a vector. Line ${e.line}`);if(r instanceof al){if(t.length>1)return void console.error(`Invalid assignment to ${t} for variable ${i}. Line ${e.line}`);if("x"===t)n.data[0]=r.value;else if("y"===t){if(n.data.length<2)return void console.error(`Invalid assignment to ${t} for variable ${i}. Line ${e.line}`);n.data[1]=r.value}else if("z"===t){if(n.data.length<3)return void console.error(`Invalid assignment to ${t} for variable ${i}. Line ${e.line}`);n.data[2]=r.value}else if("w"===t){if(n.data.length<4)return void console.error(`Invalid assignment to ${t} for variable ${i}. Line ${e.line}`);n.data[3]=r.value}}else{if(!(r instanceof cl))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(t.length!==r.data.length)return void console.error(`Invalid assignment to ${t} for variable ${i}. Line ${e.line}`);for(let o=0;o<t.length;++o){const s=t[o];if("x"===s||"r"===s)n.data[0]=r.data[o];else if("y"===s||"g"===s){if(r.data.length<2)return void console.error(`Invalid assignment to ${s} for variable ${i}. Line ${e.line}`);n.data[1]=r.data[o]}else if("z"===s||"b"===s){if(r.data.length<3)return void console.error(`Invalid assignment to ${s} for variable ${i}. Line ${e.line}`);n.data[2]=r.data[o]}else{if("w"!==s&&"a"!==s)return void console.error(`Invalid assignment to ${s} for variable ${i}. Line ${e.line}`);if(r.data.length<4)return void console.error(`Invalid assignment to ${s} for variable ${i}. Line ${e.line}`);n.data[3]=r.data[o]}}}}}else n instanceof al&&r instanceof al?n.value=r.value:n instanceof cl&&r instanceof cl||n instanceof ul&&r instanceof ul?n.data.set(r.data):console.error(`Invalid assignment to ${i}. Line ${e.line}`)}_function(e,t){const n=new Dl(e);t.functions.set(e.name,n)}_const(e,t){let n=null;null!==e.value&&(n=this.evalExpression(e.value,t)),t.createVariable(e.name,n,e)}_let(e,t){let n=null;if(null!==e.value){if(n=this.evalExpression(e.value,t),null===n)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof qa||(n=n.clone())}else{const i=e.type.name;if("f32"===i||"i32"===i||"u32"===i||"bool"===i||"f16"===i||"vec2"===i||"vec3"===i||"vec4"===i||"vec2f"===i||"vec3f"===i||"vec4f"===i||"vec2i"===i||"vec3i"===i||"vec4i"===i||"vec2u"===i||"vec3u"===i||"vec4u"===i||"vec2h"===i||"vec3h"===i||"vec4h"===i||"vec2b"===i||"vec3b"===i||"vec4b"===i||"mat2x2"===i||"mat2x3"===i||"mat2x4"===i||"mat3x2"===i||"mat3x3"===i||"mat3x4"===i||"mat4x2"===i||"mat4x3"===i||"mat4x4"===i||"mat2x2f"===i||"mat2x3f"===i||"mat2x4f"===i||"mat3x2f"===i||"mat3x3f"===i||"mat3x4f"===i||"mat4x2f"===i||"mat4x3f"===i||"mat4x4f"===i||"mat2x2h"===i||"mat2x3h"===i||"mat2x4h"===i||"mat3x2h"===i||"mat3x3h"===i||"mat3x4h"===i||"mat4x2h"===i||"mat4x3h"===i||"mat4x4h"===i||"array"===i){const i=new Ua(e.type,[]);n=this._evalCreate(i,t)}}t.createVariable(e.name,n,e)}_var(e,t){let n=null;if(null!==e.value){if(n=this.evalExpression(e.value,t),null===n)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof qa||(n=n.clone())}else{if(null===e.type)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const i=e.type.name;if("f32"===i||"i32"===i||"u32"===i||"bool"===i||"f16"===i||"vec2"===i||"vec3"===i||"vec4"===i||"vec2f"===i||"vec3f"===i||"vec4f"===i||"vec2i"===i||"vec3i"===i||"vec4i"===i||"vec2u"===i||"vec3u"===i||"vec4u"===i||"vec2h"===i||"vec3h"===i||"vec4h"===i||"vec2b"===i||"vec3b"===i||"vec4b"===i||"mat2x2"===i||"mat2x3"===i||"mat2x4"===i||"mat3x2"===i||"mat3x3"===i||"mat3x4"===i||"mat4x2"===i||"mat4x3"===i||"mat4x4"===i||"mat2x2f"===i||"mat2x3f"===i||"mat2x4f"===i||"mat3x2f"===i||"mat3x3f"===i||"mat3x4f"===i||"mat4x2f"===i||"mat4x3f"===i||"mat4x4f"===i||"mat2x2h"===i||"mat2x3h"===i||"mat2x4h"===i||"mat3x2h"===i||"mat3x3h"===i||"mat3x4h"===i||"mat4x2h"===i||"mat4x3h"===i||"mat4x4h"===i||e.type instanceof Oa||e.type instanceof Da||e.type instanceof Ma){const i=new Ua(e.type,[]);n=this._evalCreate(i,t)}}t.createVariable(e.name,n,e)}_switch(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof al))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(const o of e.cases)if(o instanceof Qa)for(const r of o.selectors){if(r instanceof Za){i=o;continue}const s=this.evalExpression(r,t);if(!(s instanceof al))return console.error(`Invalid case selector. Line ${e.line}`),null;if(s.value===n.value)return this._execStatements(o.body,t)}else o instanceof Ja&&(i=o);return i?this._execStatements(i.body,t):null}_if(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof al))return console.error(`Invalid if condition. Line ${e.line}`),null;if(n.value)return this._execStatements(e.body,t);for(const i of e.elseif){const n=this.evalExpression(i.condition,t);if(!(n instanceof al))return console.error(`Invalid if condition. Line ${e.line}`),null;if(n.value)return this._execStatements(i.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof al?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===zl._breakObj)break;if(null!==n&&n!==zl._continueObj)return n;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const n=this._execStatements(e.body,t);if(n===zl._breakObj)break;if(n===zl._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===zl._breakObj)break}else if(null!==n)return n}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===zl._breakObj)break;if(n!==zl._continueObj&&null!==n)return n}return null}_evalBitcast(e,t){const n=this.evalExpression(e.value,t),i=e.type;if(n instanceof al){const e=Il(n.value,n.typeInfo.name,i.name);return new al(e,this.getTypeInfo(i))}if(n instanceof cl){const t=n.typeInfo.getTypeName();let o="";if(t.endsWith("f"))o="f32";else if(t.endsWith("i"))o="i32";else if(t.endsWith("u"))o="u32";else if(t.endsWith("b"))o="bool";else{if(!t.endsWith("h"))return console.error(`Unknown vector type ${t}. Line ${e.line}`),null;o="f16"}const r=i.getTypeName();let s="";if(r.endsWith("f"))s="f32";else if(r.endsWith("i"))s="i32";else if(r.endsWith("u"))s="u32";else if(r.endsWith("b"))s="bool";else{if(!r.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${e.line}`),null;s="f16"}const a=function(e,t,n){if(t===n)return e;const i=new Array(e.length);for(let o=0;o<e.length;o++)i[o]=Il(e[o],t,n);return i}(Array.from(n.data),o,s);return new cl(a,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var n;if(e instanceof Ua){if(null===e.type)return rl.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const i=e instanceof Ua?e.type.name:e.name,o=e instanceof Ua?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(null===o)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(0===o.size)return null;const r=new hl(new ArrayBuffer(o.size),o,0);if(o instanceof ks){if(e.args)for(let s=0;s<e.args.length;++s){const n=o.members[s],i=e.args[s],a=this.evalExpression(i,t);r.setData(this,a,n.type,n.offset,t)}}else if(o instanceof Ls){let i=0;if(e.args)for(let s=0;s<e.args.length;++s){const a=e.args[s],l=this.evalExpression(a,t);null===o.format&&("x32"===(null===(n=l.typeInfo)||void 0===n?void 0:n.name)?o.format=this.getTypeInfo("i32"):o.format=l.typeInfo),r.setData(this,l,o.format,i,t),i+=o.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return e instanceof Ua?r.getSubData(this,e.postfix,t):r}_evalLiteral(e,t){const n=this.getTypeInfo(e.type),i=n.name;return"x32"===i||"u32"===i||"f32"===i||"f16"===i||"i32"===i||"bool"===i?new al(e.scalarValue,n):"vec2"===i||"vec3"===i||"vec4"===i||"vec2f"===i||"vec3f"===i||"vec4f"===i||"vec2h"===i||"vec3h"===i||"vec4h"===i||"vec2i"===i||"vec3i"===i||"vec4i"===i||"vec2u"===i||"vec3u"===i||"vec4u"===i?this._callConstructorVec(e,t):"mat2x2"===i||"mat2x3"===i||"mat2x4"===i||"mat3x2"===i||"mat3x3"===i||"mat3x4"===i||"mat4x2"===i||"mat4x3"===i||"mat4x4"===i||"mat2x2f"===i||"mat2x3f"===i||"mat2x4f"===i||"mat3x2f"===i||"mat3x3f"===i||"mat3x4f"===i||"mat4x2f"===i||"mat4x3f"===i||"mat4x4f"===i||"mat2x2h"===i||"mat2x3h"===i||"mat2x4h"===i||"mat3x2h"===i||"mat3x3h"===i||"mat3x4h"===i||"mat4x2h"===i||"mat4x3h"===i||"mat4x4h"===i?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const n=t.getVariableValue(e.name);return null===n?n:n.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if("f32"===t.name)return t;for(let n=1;n<e.length;++n){const i=zl._priority.get(t.name);zl._priority.get(e[n].name)<i&&(t=e[n])}return"x32"===t.name?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const n=this.evalExpression(e.right,t);if("&"===e.operator)return new sl(n);if("*"===e.operator)return n instanceof sl?n.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const i=n instanceof al?n.value:n instanceof cl?Array.from(n.data):null;switch(e.operator){case"+":{if(gl(i)){const e=i.map((e,t)=>+e);return new cl(e,n.typeInfo)}const e=i,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new al(+e,t)}case"-":{if(gl(i)){const e=i.map((e,t)=>-e);return new cl(e,n.typeInfo)}const e=i,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new al(-e,t)}case"!":{if(gl(i)){const e=i.map((e,t)=>e?0:1);return new cl(e,n.typeInfo)}const e=i,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new al(e?0:1,t)}case"~":{if(gl(i)){const e=i.map((e,t)=>~e);return new cl(e,n.typeInfo)}const e=i,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new al(~e,t)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const n=this.evalExpression(e.left,t),i=this.evalExpression(e.right,t),o=n instanceof al?n.value:n instanceof cl||n instanceof ul?Array.from(n.data):null,r=i instanceof al?i.value:i instanceof cl||i instanceof ul?Array.from(i.data):null;switch(e.operator){case"+":{if(gl(o)&&gl(r)){const t=o,i=r;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e+i[t]);return new cl(s,n.typeInfo)}if(gl(o)){const e=r,t=o.map((t,n)=>t+e);return new cl(t,n.typeInfo)}if(gl(r)){const e=o,t=r.map((t,n)=>e+t);return new cl(t,i.typeInfo)}const t=o,s=r,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new al(t+s,a)}case"-":{if(gl(o)&&gl(r)){const t=o,i=r;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e-i[t]);return new cl(s,n.typeInfo)}if(gl(o)){const e=r,t=o.map((t,n)=>t-e);return new cl(t,n.typeInfo)}if(gl(r)){const e=o,t=r.map((t,n)=>e-t);return new cl(t,i.typeInfo)}const t=o,s=r,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new al(t-s,a)}case"*":{if(gl(o)&&gl(r)){const t=o,s=r;if(n instanceof ul&&i instanceof ul){const o=function(e,t,n,i){if(void 0===Fl[t.name]||void 0===Fl[i.name])return null;const o=Fl[t.name][0],r=Fl[t.name][1],s=Fl[i.name][0];if(o!==Fl[i.name][1])return null;const a=new Array(s*r);for(let l=0;l<r;l++)for(let t=0;t<s;t++){let i=0;for(let s=0;s<o;s++)i+=e[s*r+l]*n[t*o+s];a[l*s+t]=i}return a}(t,n.typeInfo,s,i.typeInfo);if(null===o)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const r=Fl[i.typeInfo.name][0],a=Fl[n.typeInfo.name][1],l=this.getTypeInfo(`mat${r}x${a}f`);return new ul(o,l)}if(n instanceof ul&&i instanceof cl){const o=function(e,t,n,i){if(void 0===Fl[t.name]||void 0===Bl[i.name])return null;const o=Fl[t.name][0],r=Fl[t.name][1];if(o!==n.length)return null;const s=new Array(r);for(let a=0;a<r;a++){let t=0;for(let i=0;i<o;i++)t+=e[i*r+a]*n[i];s[a]=t}return s}(t,n.typeInfo,s,i.typeInfo);return null===o?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new cl(o,i.typeInfo)}if(n instanceof cl&&i instanceof ul){const o=function(e,t,n,i){if(void 0===Bl[t.name]||void 0===Fl[i.name])return null;const o=Fl[i.name][0],r=Fl[i.name][1];if(r!==e.length)return null;const s=[];for(let a=0;a<o;a++){let t=0;for(let i=0;i<r;i++)t+=e[i]*n[i*o+a];s[a]=t}return s}(t,n.typeInfo,s,i.typeInfo);return null===o?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new cl(o,n.typeInfo)}{if(t.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const i=t.map((e,t)=>e*s[t]);return new cl(i,n.typeInfo)}}if(gl(o)){const e=r,t=o.map((t,n)=>t*e);return n instanceof ul?new ul(t,n.typeInfo):new cl(t,n.typeInfo)}if(gl(r)){const e=o,t=r.map((t,n)=>e*t);return i instanceof ul?new ul(t,i.typeInfo):new cl(t,i.typeInfo)}const t=o,s=r,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new al(t*s,a)}case"%":{if(gl(o)&&gl(r)){const t=o,i=r;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e%i[t]);return new cl(s,n.typeInfo)}if(gl(o)){const e=r,t=o.map((t,n)=>t%e);return new cl(t,n.typeInfo)}if(gl(r)){const e=o,t=r.map((t,n)=>e%t);return new cl(t,i.typeInfo)}const t=o,s=r,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new al(t%s,a)}case"/":{if(gl(o)&&gl(r)){const t=o,i=r;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e/i[t]);return new cl(s,n.typeInfo)}if(gl(o)){const e=r,t=o.map((t,n)=>t/e);return new cl(t,n.typeInfo)}if(gl(r)){const e=o,t=r.map((t,n)=>e/t);return new cl(t,i.typeInfo)}const t=o,s=r,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new al(t/s,a)}case"&":{if(gl(o)&&gl(r)){const t=o,i=r;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e&i[t]);return new cl(s,n.typeInfo)}if(gl(o)){const e=r,t=o.map((t,n)=>t&e);return new cl(t,n.typeInfo)}if(gl(r)){const e=o,t=r.map((t,n)=>e&t);return new cl(t,i.typeInfo)}const t=o,s=r,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new al(t&s,a)}case"|":{if(gl(o)&&gl(r)){const t=o,i=r;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e|i[t]);return new cl(s,n.typeInfo)}if(gl(o)){const e=r,t=o.map((t,n)=>t|e);return new cl(t,n.typeInfo)}if(gl(r)){const e=o,t=r.map((t,n)=>e|t);return new cl(t,i.typeInfo)}const t=o,s=r,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new al(t|s,a)}case"^":{if(gl(o)&&gl(r)){const t=o,i=r;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e^i[t]);return new cl(s,n.typeInfo)}if(gl(o)){const e=r,t=o.map((t,n)=>t^e);return new cl(t,n.typeInfo)}if(gl(r)){const e=o,t=r.map((t,n)=>e^t);return new cl(t,i.typeInfo)}const t=o,s=r,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new al(t^s,a)}case"<<":{if(gl(o)&&gl(r)){const t=o,i=r;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e<<i[t]);return new cl(s,n.typeInfo)}if(gl(o)){const e=r,t=o.map((t,n)=>t<<e);return new cl(t,n.typeInfo)}if(gl(r)){const e=o,t=r.map((t,n)=>e<<t);return new cl(t,i.typeInfo)}const t=o,s=r,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new al(t<<s,a)}case">>":{if(gl(o)&&gl(r)){const t=o,i=r;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e>>i[t]);return new cl(s,n.typeInfo)}if(gl(o)){const e=r,t=o.map((t,n)=>t>>e);return new cl(t,n.typeInfo)}if(gl(r)){const e=o,t=r.map((t,n)=>e>>t);return new cl(t,i.typeInfo)}const t=o,s=r,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new al(t>>s,a)}case">":if(gl(o)&&gl(r)){const t=o,i=r;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e>i[t]?1:0);return new cl(s,n.typeInfo)}if(gl(o)){const e=r,t=o.map((t,n)=>t>e?1:0);return new cl(t,n.typeInfo)}if(gl(r)){const e=o,t=r.map((t,n)=>e>t?1:0);return new cl(t,i.typeInfo)}return new al(o>r?1:0,this.getTypeInfo("bool"));case"<":if(gl(o)&&gl(r)){const t=o,i=r;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e<i[t]?1:0);return new cl(s,n.typeInfo)}if(gl(o)){const e=r,t=o.map((t,n)=>t<e?1:0);return new cl(t,n.typeInfo)}if(gl(r)){const e=o,t=r.map((t,n)=>e<t?1:0);return new cl(t,i.typeInfo)}return new al(o<r?1:0,this.getTypeInfo("bool"));case"==":if(gl(o)&&gl(r)){const t=o,i=r;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e===i[t]?1:0);return new cl(s,n.typeInfo)}if(gl(o)){const e=r,t=o.map((t,n)=>t==e?1:0);return new cl(t,n.typeInfo)}if(gl(r)){const e=o,t=r.map((t,n)=>e==t?1:0);return new cl(t,i.typeInfo)}return new al(o===r?1:0,this.getTypeInfo("bool"));case"!=":if(gl(o)&&gl(r)){const t=o,i=r;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e!==i[t]?1:0);return new cl(s,n.typeInfo)}if(gl(o)){const e=r,t=o.map((t,n)=>t!==e?1:0);return new cl(t,n.typeInfo)}if(gl(r)){const e=o,t=r.map((t,n)=>e!==t?1:0);return new cl(t,i.typeInfo)}return new al(o!==r?1:0,this.getTypeInfo("bool"));case">=":if(gl(o)&&gl(r)){const t=o,i=r;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e>=i[t]?1:0);return new cl(s,n.typeInfo)}if(gl(o)){const e=r,t=o.map((t,n)=>t>=e?1:0);return new cl(t,n.typeInfo)}if(gl(r)){const e=o,t=r.map((t,n)=>e>=t?1:0);return new cl(t,i.typeInfo)}return new al(o>=r?1:0,this.getTypeInfo("bool"));case"<=":if(gl(o)&&gl(r)){const t=o,i=r;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e<=i[t]?1:0);return new cl(s,n.typeInfo)}if(gl(o)){const e=r,t=o.map((t,n)=>t<=e?1:0);return new cl(t,n.typeInfo)}if(gl(r)){const e=o,t=r.map((t,n)=>e<=t?1:0);return new cl(t,i.typeInfo)}return new al(o<=r?1:0,this.getTypeInfo("bool"));case"&&":if(gl(o)&&gl(r)){const t=o,i=r;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e&&i[t]?1:0);return new cl(s,n.typeInfo)}if(gl(o)){const e=r,t=o.map((t,n)=>t&&e?1:0);return new cl(t,n.typeInfo)}if(gl(r)){const e=o,t=r.map((t,n)=>e&&t?1:0);return new cl(t,i.typeInfo)}return new al(o&&r?1:0,this.getTypeInfo("bool"));case"||":if(gl(o)&&gl(r)){const t=o,i=r;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map((e,t)=>e||i[t]?1:0);return new cl(s,n.typeInfo)}if(gl(o)){const e=r,t=o.map((t,n)=>t||e?1:0);return new cl(t,n.typeInfo)}if(gl(r)){const e=o,t=r.map((t,n)=>e||t?1:0);return new cl(t,i.typeInfo)}return new al(o||r?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(null!==e.cachedReturnValue)return e.cachedReturnValue;const n=t.clone();n.currentFunctionName=e.name;const i=t.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let o=0;o<i.node.args.length;++o){const t=i.node.args[o],r=this.evalExpression(e.args[o],n);n.createVariable(t.name,r,t)}return this._execStatements(i.node.body,n)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const n=t.getFunction(e.name);if(n){const i=t.clone();for(let t=0;t<n.node.args.length;++t){const o=n.node.args[t],r=this.evalExpression(e.args[t],i);i.setVariable(o.name,r,o)}return this._execStatements(n.node.body,i)}return null}_callConstructorValue(e,t){if(!e.args||0===e.args.length)return new al(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],t);return n.typeInfo=this.getTypeInfo(e.type),n.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const n=this.getTypeInfo(e.type),i=e.type.getTypeName(),o=Bl[i];if(void 0===o)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;const r=[];if(e instanceof Ga)if(e.isVector){const t=e.vectorValue;for(const e of t)r.push(e)}else r.push(e.scalarValue);else if(e.args)for(const s of e.args){const e=this.evalExpression(s,t);if(e instanceof cl){const t=e.data;for(let e=0;e<t.length;++e){let n=t[e];r.push(n)}}else if(e instanceof al){let t=e.value;r.push(t)}}if(e.type instanceof Ma&&null===e.type.format&&(e.type.format=Ma.f32),0===r.length){const i=new Array(o).fill(0);return new cl(i,n).getSubData(this,e.postfix,t)}if(1===r.length)for(;r.length<o;)r.push(r[0]);return r.length<o?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new cl(r.length>o?r.slice(0,o):r,n).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const n=this.getTypeInfo(e.type),i=e.type.getTypeName(),o=Fl[i];if(void 0===o)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;const r=[];if(e instanceof Ga)if(e.isVector){const t=e.vectorValue;for(const e of t)r.push(e)}else r.push(e.scalarValue);else if(e.args)for(const s of e.args){const e=this.evalExpression(s,t);e instanceof cl?r.push(...e.data):e instanceof al?r.push(e.value):e instanceof ul&&r.push(...e.data)}if(n instanceof Ps&&null===n.format&&(n.format=this.getTypeInfo("f32")),0===r.length){const i=new Array(o[2]).fill(0);return new ul(i,n).getSubData(this,e.postfix,t)}return r.length!==o[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new ul(r,n).getSubData(this,e.postfix,t)}}zl._breakObj=new ol(new Is("BREAK",null),null),zl._continueObj=new ol(new Is("CONTINUE",null),null),zl._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Ul{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class $l{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new Ul,this._exec=new zl,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const e=this._global_decl_or_directive();if(!e)break;t.push(e)}if(this._deferArrayCountEval.length>0){for(const e of this._deferArrayCountEval){const t=e.arrayType,n=e.countNode;if(n instanceof Va){const e=n.name,i=this._context.constants.get(e);if(i)try{const e=i.constEvaluate(this._exec);t.count=e}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const n of t)n.search(e=>{e instanceof nl||e instanceof Na?e.type=this._forwardType(e.type):e instanceof Oa?e.format=this._forwardType(e.format):e instanceof ca||e instanceof ha||e instanceof da?e.type=this._forwardType(e.type):e instanceof oa?e.returnType=this._forwardType(e.returnType):e instanceof el&&(e.type=this._forwardType(e.type))});return t}_forwardType(e){if(e instanceof Pa){const t=this._getType(e.name);if(t)return t}else e instanceof Na?e.type=this._forwardType(e.type):e instanceof Oa&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if("string"==typeof e){const t=new _l(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==fl.eof}_match(e){if(e instanceof pl)return!!this._check(e)&&(this._advance(),!0);for(let t=0,n=e.length;t<n;++t){const n=e[t];if(this._check(n))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const n=t.type;let i=!1;for(const t of e){if(n===t)return!0;t===fl.tokens.name&&(i=!0)}if(i){const e=fl.tokens.name.rule.exec(t.lexeme);if(e&&0==e.index&&e[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===fl.tokens.name){const e=fl.tokens.name.rule.exec(t.lexeme);return e&&0==e.index&&e[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=null!==(t=null===(e=this._peek())||void 0===e?void 0:e.line)&&void 0!==t?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(fl.tokens.semicolon)&&!this._isAtEnd(););if(this._match(fl.keywords.alias)){const e=this._type_alias();return this._consume(fl.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(fl.keywords.diagnostic)){const e=this._diagnostic();return this._consume(fl.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(fl.keywords.requires)){const e=this._requires_directive();return this._consume(fl.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(fl.keywords.enable)){const e=this._enable_directive();return this._consume(fl.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}const e=this._attribute();if(this._check(fl.keywords.var)){const t=this._global_variable_decl();return null!=t&&(t.attributes=e),this._consume(fl.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(fl.keywords.override)){const t=this._override_variable_decl();return null!=t&&(t.attributes=e),this._consume(fl.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(fl.keywords.let)){const t=this._global_let_decl();return null!=t&&(t.attributes=e),this._consume(fl.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(fl.keywords.const)){const t=this._global_const_decl();return null!=t&&(t.attributes=e),this._consume(fl.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(fl.keywords.struct)){const t=this._struct_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(fl.keywords.fn)){const t=this._function_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(fl.keywords.fn))return null;const e=this._currentLine,t=this._consume(fl.tokens.ident,"Expected function name.").toString();this._consume(fl.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(fl.tokens.paren_right))do{if(this._check(fl.tokens.paren_right))break;const e=this._attribute(),t=this._consume(fl.tokens.name,"Expected argument name.").toString();this._consume(fl.tokens.colon,"Expected ':' for argument type.");const i=this._attribute(),o=this._type_decl();null!=o&&(o.attributes=i,n.push(this._updateNode(new el(t,o,e))))}while(this._match(fl.tokens.comma));this._consume(fl.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(fl.tokens.arrow)){const e=this._attribute();i=this._type_decl(),null!=i&&(i.attributes=e)}const o=this._compound_statement(),r=this._currentLine;return this._updateNode(new oa(t,n,i,o,e,r),e)}_compound_statement(){const e=[];for(this._consume(fl.tokens.brace_left,"Expected '{' for block.");!this._check(fl.tokens.brace_right);){const t=this._statement();null!==t&&e.push(t)}return this._consume(fl.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(fl.tokens.semicolon)&&!this._isAtEnd(););if(this._check(fl.tokens.attr)&&this._attribute(),this._check(fl.keywords.if))return this._if_statement();if(this._check(fl.keywords.switch))return this._switch_statement();if(this._check(fl.keywords.loop))return this._loop_statement();if(this._check(fl.keywords.for))return this._for_statement();if(this._check(fl.keywords.while))return this._while_statement();if(this._check(fl.keywords.continuing))return this._continuing_statement();if(this._check(fl.keywords.static_assert))return this._static_assert_statement();if(this._check(fl.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(fl.keywords.return))e=this._return_statement();else if(this._check([fl.keywords.var,fl.keywords.let,fl.keywords.const]))e=this._variable_statement();else if(this._match(fl.keywords.discard))e=this._updateNode(new Aa);else if(this._match(fl.keywords.break)){const t=this._updateNode(new ka);if(this._currentLoop.length>0){const e=this._currentLoop[this._currentLoop.length-1];t.loopId=e.id}e=t,this._check(fl.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(fl.keywords.continue)){const t=this._updateNode(new La);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const e=this._currentLoop[this._currentLoop.length-1];t.loopId=e.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return null!=e&&this._consume(fl.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(fl.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new ra(t),e)}_while_statement(){if(!this._match(fl.keywords.while))return null;const e=this._updateNode(new sa(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(fl.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(fl.keywords.continuing))return null;const t=this._currentLine,n=this._compound_statement();return this._updateNode(new aa(n,e),t)}_for_statement(){if(!this._match(fl.keywords.for))return null;this._consume(fl.tokens.paren_left,"Expected '('.");const e=this._updateNode(new la(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(fl.tokens.semicolon)?null:this._for_init(),this._consume(fl.tokens.semicolon,"Expected ';'."),e.condition=this._check(fl.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(fl.tokens.semicolon,"Expected ';'."),e.increment=this._check(fl.tokens.paren_right)?null:this._for_increment(),this._consume(fl.tokens.paren_right,"Expected ')'."),this._check(fl.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(fl.keywords.var)){const e=this._variable_decl();if(null===e)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(fl.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new ca(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(fl.keywords.let)){const e=this._currentLine,t=this._consume(fl.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(fl.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}this._consume(fl.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new ha(t,n,null,null,i),e)}if(this._match(fl.keywords.const)){const e=this._currentLine,t=this._consume(fl.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(fl.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}this._consume(fl.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return null===n&&i instanceof Ga&&(n=i.type),this._updateNode(new da(t,n,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(null==t)return null;if(!this._check(fl.increment_operators))return this._current=e,null;const n=this._consume(fl.increment_operators,"Expected increment operator");return this._updateNode(new ga(n.type===fl.tokens.plus_plus?pa.increment:pa.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(fl.tokens.brace_right))return null;let n=this._match(fl.tokens.underscore);if(n||(e=this._unary_expression()),!n&&null==e)return null;const i=this._consume(fl.assignment_operators,"Expected assignment operator."),o=this._short_circuit_or_expression();return this._updateNode(new ya(fa.parse(i.lexeme),e,o),t)}_func_call_statement(){if(!this._check(fl.tokens.ident))return null;const e=this._currentLine,t=this._current,n=this._consume(fl.tokens.ident,"Expected function name."),i=this._argument_expression_list();return null===i?(this._current=t,null):this._updateNode(new ba(n.lexeme,i),e)}_loop_statement(){if(!this._match(fl.keywords.loop))return null;this._check(fl.tokens.attr)&&this._attribute(),this._consume(fl.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new va([],null));this._currentLoop.push(e);let t=this._statement();for(;null!==t;){if(Array.isArray(t))for(let n of t)e.body.push(n);else e.body.push(t);if(t instanceof aa){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(fl.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(fl.keywords.switch))return null;const e=this._updateNode(new xa(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(fl.tokens.attr)&&this._attribute(),this._consume(fl.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),null==e.cases||0==e.cases.length)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(fl.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([fl.keywords.default,fl.keywords.case]);){if(this._match(fl.keywords.case)){const n=this._case_selectors();for(const e of n)if(e instanceof Za){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(fl.tokens.colon),this._check(fl.tokens.attr)&&this._attribute(),this._consume(fl.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(fl.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new Qa(n,i)))}if(this._match(fl.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(fl.tokens.colon),this._check(fl.tokens.attr)&&this._attribute(),this._consume(fl.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(fl.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new Ja(n)))}}return e}_case_selectors(){const e=[];for(this._match(fl.keywords.default)?e.push(this._updateNode(new Za)):e.push(this._shift_expression());this._match(fl.tokens.comma);)this._match(fl.keywords.default)?e.push(this._updateNode(new Za)):e.push(this._shift_expression());return e}_case_body(){if(this._match(fl.keywords.fallthrough))return this._consume(fl.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(null==e)return[];e instanceof Array||(e=[e]);const t=this._case_body();return 0==t.length?e:[...e,t[0]]}_if_statement(){if(!this._match(fl.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(fl.tokens.attr)&&this._attribute();const n=this._compound_statement();let i=[];this._match_elseif()&&(this._check(fl.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let o=null;return this._match(fl.keywords.else)&&(this._check(fl.tokens.attr)&&this._attribute(),o=this._compound_statement()),this._updateNode(new wa(t,n,i,o),e)}_match_elseif(){return this._tokens[this._current].type===fl.keywords.else&&this._tokens[this._current+1].type===fl.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new tl(t,n))),this._match_elseif()&&(this._check(fl.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(fl.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new Sa(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(fl.tokens.or_or);)e=this._updateNode(new Xa(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(fl.tokens.and_and);)e=this._updateNode(new Xa(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(fl.tokens.or);)e=this._updateNode(new Xa(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(fl.tokens.xor);)e=this._updateNode(new Xa(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(fl.tokens.and);)e=this._updateNode(new Xa(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([fl.tokens.equal_equal,fl.tokens.not_equal])?this._updateNode(new Xa(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([fl.tokens.less_than,fl.tokens.greater_than,fl.tokens.less_than_equal,fl.tokens.greater_than_equal]);)e=this._updateNode(new Xa(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([fl.tokens.shift_left,fl.tokens.shift_right]);)e=this._updateNode(new Xa(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([fl.tokens.plus,fl.tokens.minus]);)e=this._updateNode(new Xa(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([fl.tokens.star,fl.tokens.forward_slash,fl.tokens.modulo]);)e=this._updateNode(new Xa(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([fl.tokens.minus,fl.tokens.bang,fl.tokens.tilde,fl.tokens.star,fl.tokens.and])?this._updateNode(new qa(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(fl.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(fl.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new ja(e)),n=this._postfix_expression();return n&&(t.postfix=n),t}if(this._match(fl.tokens.period)){const e=this._consume(fl.tokens.name,"Expected member name."),t=this._postfix_expression(),n=this._updateNode(new za(e.lexeme));return t&&(n.postfix=t),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(null!==t)return t;switch(e){case"void":return Ra.void;case"bool":return Ra.bool;case"i32":return Ra.i32;case"u32":return Ra.u32;case"f32":return Ra.f32;case"f16":return Ra.f16;case"vec2f":return Ma.vec2f;case"vec3f":return Ma.vec3f;case"vec4f":return Ma.vec4f;case"vec2i":return Ma.vec2i;case"vec3i":return Ma.vec3i;case"vec4i":return Ma.vec4i;case"vec2u":return Ma.vec2u;case"vec3u":return Ma.vec3u;case"vec4u":return Ma.vec4u;case"vec2h":return Ma.vec2h;case"vec3h":return Ma.vec3h;case"vec4h":return Ma.vec4h;case"mat2x2f":return Ma.mat2x2f;case"mat2x3f":return Ma.mat2x3f;case"mat2x4f":return Ma.mat2x4f;case"mat3x2f":return Ma.mat3x2f;case"mat3x3f":return Ma.mat3x3f;case"mat3x4f":return Ma.mat3x4f;case"mat4x2f":return Ma.mat4x2f;case"mat4x3f":return Ma.mat4x3f;case"mat4x4f":return Ma.mat4x4f;case"mat2x2h":return Ma.mat2x2h;case"mat2x3h":return Ma.mat2x3h;case"mat2x4h":return Ma.mat2x4h;case"mat3x2h":return Ma.mat3x2h;case"mat3x3h":return Ma.mat3x3h;case"mat3x4h":return Ma.mat3x4h;case"mat4x2h":return Ma.mat4x2h;case"mat4x3h":return Ma.mat4x3h;case"mat4x4h":return Ma.mat4x4h;case"mat2x2i":return Ma.mat2x2i;case"mat2x3i":return Ma.mat2x3i;case"mat2x4i":return Ma.mat2x4i;case"mat3x2i":return Ma.mat3x2i;case"mat3x3i":return Ma.mat3x3i;case"mat3x4i":return Ma.mat3x4i;case"mat4x2i":return Ma.mat4x2i;case"mat4x3i":return Ma.mat4x3i;case"mat4x4i":return Ma.mat4x4i;case"mat2x2u":return Ma.mat2x2u;case"mat2x3u":return Ma.mat2x3u;case"mat2x4u":return Ma.mat2x4u;case"mat3x2u":return Ma.mat3x2u;case"mat3x3u":return Ma.mat3x3u;case"mat3x4u":return Ma.mat3x4u;case"mat4x2u":return Ma.mat4x2u;case"mat4x3u":return Ma.mat4x3u;case"mat4x4u":return Ma.mat4x4u}return null}_validateTypeRange(e,t){if("i32"===t.name){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if("u32"===t.name&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(fl.tokens.ident)){const e=this._previous().toString();if(this._check(fl.tokens.paren_left)){const t=this._argument_expression_list(),n=this._getType(e);return null!==n?this._updateNode(new Ua(n,t)):this._updateNode(new $a(e,t))}if(this._context.constants.has(e)){const t=this._context.constants.get(e);return this._updateNode(new Ha(e,t.value))}return this._updateNode(new Va(e))}if(this._match(fl.tokens.int_literal)){const e=this._previous().toString();let t=e.endsWith("i")||e.endsWith("i")?Ra.i32:e.endsWith("u")||e.endsWith("U")?Ra.u32:Ra.x32;const n=parseInt(e);return this._validateTypeRange(n,t),this._updateNode(new Ga(new al(n,this._exec.getTypeInfo(t)),t))}if(this._match(fl.tokens.uint_literal)){const e=parseInt(this._previous().toString());return this._validateTypeRange(e,Ra.u32),this._updateNode(new Ga(new al(e,this._exec.getTypeInfo(Ra.u32)),Ra.u32))}if(this._match([fl.tokens.decimal_float_literal,fl.tokens.hex_float_literal])){let e=this._previous().toString(),t=e.endsWith("h");t&&(e=e.substring(0,e.length-1));const n=parseFloat(e);this._validateTypeRange(n,t?Ra.f16:Ra.f32);const i=t?Ra.f16:Ra.f32;return this._updateNode(new Ga(new al(n,this._exec.getTypeInfo(i)),i))}if(this._match([fl.keywords.true,fl.keywords.false])){let e=this._previous().toString()===fl.keywords.true.rule;return this._updateNode(new Ga(new al(e?1:0,this._exec.getTypeInfo(Ra.bool)),Ra.bool))}if(this._check(fl.tokens.paren_left))return this._paren_expression();if(this._match(fl.keywords.bitcast)){this._consume(fl.tokens.less_than,"Expected '<'.");const e=this._type_decl();this._consume(fl.tokens.greater_than,"Expected '>'.");const t=this._paren_expression();return this._updateNode(new Wa(e,t))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new Ua(e,t))}_argument_expression_list(){if(!this._match(fl.tokens.paren_left))return null;const e=[];do{if(this._check(fl.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(fl.tokens.comma));return this._consume(fl.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(fl.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(fl.tokens.paren_right),e}_paren_expression(){this._consume(fl.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(fl.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(fl.keywords.struct))return null;const e=this._currentLine,t=this._consume(fl.tokens.ident,"Expected name for struct.").toString();this._consume(fl.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(fl.tokens.brace_right);){const e=this._attribute(),t=this._consume(fl.tokens.name,"Expected variable name.").toString();this._consume(fl.tokens.colon,"Expected ':' for struct member type.");const i=this._attribute(),o=this._type_decl();null!=o&&(o.attributes=i),this._check(fl.tokens.brace_right)?this._match(fl.tokens.comma):this._consume(fl.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new nl(t,o,e)))}this._consume(fl.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,o=this._updateNode(new Da(t,n,e,i),e);return this._context.structs.set(t,o),o}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(fl.tokens.equal)){const t=this._const_expression();e.value=t}if(null!==e.type&&e.value instanceof Ga){if("x32"!==e.value.type.name&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else null===e.type&&e.value instanceof Ga&&(e.type="x32"===e.value.type.name?Ra.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(fl.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(fl.keywords.const))return null;const t=this._consume(fl.tokens.name,"Expected variable name"),n=this._currentLine;let i=null;if(this._match(fl.tokens.colon)){const e=this._attribute();i=this._type_decl(),null!=i&&(i.attributes=e)}let o=null;this._consume(fl.tokens.equal,"const declarations require an assignment");const r=this._short_circuit_or_expression();try{let e=[Ra.f32],n=r.constEvaluate(this._exec,e);n instanceof al&&this._validateTypeRange(n.value,e[0]),e[0]instanceof Ma&&null===e[0].format&&n.typeInfo instanceof Ps&&null!==n.typeInfo.format&&("f16"===n.typeInfo.format.name?e[0].format=Ra.f16:"f32"===n.typeInfo.format.name?e[0].format=Ra.f32:"i32"===n.typeInfo.format.name?e[0].format=Ra.i32:"u32"===n.typeInfo.format.name?e[0].format=Ra.u32:"bool"===n.typeInfo.format.name?e[0].format=Ra.bool:console.error(`TODO: impelement template format type ${n.typeInfo.format.name}`)),o=this._updateNode(new Ga(n,e[0])),this._exec.context.setVariable(t.toString(),n)}catch{o=r}if(null!==i&&o instanceof Ga){if("x32"!==o.type.name&&i.getTypeName()!==o.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${o.type.name} to ${i.name}. Line:${this._currentLine}`);o.type=i,o.isScalar&&this._validateTypeRange(o.scalarValue,o.type)}else null===i&&o instanceof Ga&&(i=null!==(e=null==o?void 0:o.type)&&void 0!==e?e:Ra.f32,i===Ra.x32&&(i=Ra.i32));const s=this._updateNode(new da(t.toString(),i,"","",o),n);return this._context.constants.set(s.name,s),s}_global_let_decl(){if(!this._match(fl.keywords.let))return null;const e=this._currentLine,t=this._consume(fl.tokens.name,"Expected variable name");let n=null;if(this._match(fl.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}let i=null;if(this._match(fl.tokens.equal)&&(i=this._const_expression()),null!==n&&i instanceof Ga){if("x32"!==i.type.name&&n.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${n.name}. Line:${this._currentLine}`);i.type=n}else null===n&&i instanceof Ga&&(n="x32"===i.type.name?Ra.i32:i.type);return i instanceof Ga&&i.isScalar&&this._validateTypeRange(i.scalarValue,n),this._updateNode(new ha(t.toString(),n,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(fl.keywords.var))return null;const e=this._currentLine;let t="",n="";this._match(fl.tokens.less_than)&&(t=this._consume(fl.storage_class,"Expected storage_class.").toString(),this._match(fl.tokens.comma)&&(n=this._consume(fl.access_mode,"Expected access_mode.").toString()),this._consume(fl.tokens.greater_than,"Expected '>'."));const i=this._consume(fl.tokens.name,"Expected variable name");let o=null;if(this._match(fl.tokens.colon)){const e=this._attribute();o=this._type_decl(),null!=o&&(o.attributes=e)}return this._updateNode(new ca(i.toString(),o,t,n,null),e)}_override_decl(){if(!this._match(fl.keywords.override))return null;const e=this._consume(fl.tokens.name,"Expected variable name");let t=null;if(this._match(fl.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}return this._updateNode(new ua(e.toString(),t,null))}_diagnostic(){this._consume(fl.tokens.paren_left,"Expected '('");const e=this._consume(fl.tokens.ident,"Expected severity control name.");this._consume(fl.tokens.comma,"Expected ','");let t=this._consume(fl.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(fl.tokens.period)&&(t+=`.${this._consume(fl.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(fl.tokens.paren_right,"Expected ')'"),this._updateNode(new Ca(e.toString(),t))}_enable_directive(){const e=this._consume(fl.tokens.ident,"identity expected.");return this._updateNode(new Ea(e.toString()))}_requires_directive(){const e=[this._consume(fl.tokens.ident,"identity expected.").toString()];for(;this._match(fl.tokens.comma);){const t=this._consume(fl.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new Ta(e))}_type_alias(){const e=this._consume(fl.tokens.ident,"identity expected.");this._consume(fl.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(null===t)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=this._updateNode(new Ia(e.toString(),t));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([fl.tokens.ident,...fl.texel_format,fl.keywords.bool,fl.keywords.f32,fl.keywords.i32,fl.keywords.u32])){const e=this._advance().toString();if(this._context.structs.has(e))return this._context.structs.get(e);if(this._context.aliases.has(e))return this._context.aliases.get(e).type;if(!this._getType(e)){const t=this._updateNode(new Pa(e));return this._forwardTypeCount++,t}return this._updateNode(new Ra(e))}let e=this._texture_sampler_types();if(e)return e;if(this._check(fl.template_types)){let e=this._advance().toString(),t=null,n=null;return this._match(fl.tokens.less_than)&&(t=this._type_decl(),n=null,this._match(fl.tokens.comma)&&(n=this._consume(fl.access_mode,"Expected access_mode for pointer").toString()),this._consume(fl.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new Ma(e,t,n))}if(this._match(fl.keywords.ptr)){let e=this._previous().toString();this._consume(fl.tokens.less_than,"Expected '<' for pointer.");const t=this._consume(fl.storage_class,"Expected storage_class for pointer");this._consume(fl.tokens.comma,"Expected ',' for pointer.");const n=this._type_decl();let i=null;return this._match(fl.tokens.comma)&&(i=this._consume(fl.access_mode,"Expected access_mode for pointer").toString()),this._consume(fl.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Na(e,t.toString(),n,i))}const t=this._attribute();if(this._match(fl.keywords.array)){let e=null,n=-1;const i=this._previous();let o=null;if(this._match(fl.tokens.less_than)){e=this._type_decl(),this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);let t="";if(this._match(fl.tokens.comma)){o=this._shift_expression();try{t=o.constEvaluate(this._exec).toString(),o=null}catch{t="1"}}this._consume(fl.tokens.greater_than,"Expected '>' for array."),n=t?parseInt(t):0}const r=this._updateNode(new Oa(i.toString(),t,e,n));return o&&this._deferArrayCountEval.push({arrayType:r,countNode:o}),r}return null}_texture_sampler_types(){if(this._match(fl.sampler_type))return this._updateNode(new Ba(this._previous().toString(),null,null));if(this._match(fl.depth_texture_type))return this._updateNode(new Ba(this._previous().toString(),null,null));if(this._match(fl.sampled_texture_type)||this._match(fl.multisampled_texture_type)){const e=this._previous();this._consume(fl.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(fl.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Ba(e.toString(),t,null))}if(this._match(fl.storage_texture_type)){const e=this._previous();this._consume(fl.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(fl.texel_format,"Invalid texel format.").toString();this._consume(fl.tokens.comma,"Expected ',' after texel format.");const n=this._consume(fl.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(fl.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Ba(e.toString(),t,n))}return null}_attribute(){let e=[];for(;this._match(fl.tokens.attr);){const t=this._consume(fl.attribute_name,"Expected attribute name"),n=this._updateNode(new il(t.toString(),null));if(this._match(fl.tokens.paren_left)){if(n.value=this._consume(fl.literal_or_ident,"Expected attribute value").toString(),this._check(fl.tokens.comma)){this._advance();do{const e=this._consume(fl.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(e)}while(this._match(fl.tokens.comma))}this._consume(fl.tokens.paren_right,"Expected ')'")}e.push(n)}return 0==e.length?null:e}}class Vl extends Ll{constructor(e){super(),e&&this.update(e)}update(e){const t=(new $l).parse(e);this.updateAST(t)}}function Hl(e){return null!=e&&e.format?`${e.name}<${e.format.name}>`:e.name}const Gl={};function Wl(e="id"){return Gl[e]=Gl[e]||1,`${e}-${Gl[e]++}`}class jl{constructor(e){if(h(this,"id"),h(this,"userData",{}),h(this,"topology"),h(this,"bufferLayout",[]),h(this,"vertexCount"),h(this,"indices"),h(this,"attributes"),this.id=e.id||Wl("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&ai.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;null==(e=this.indices)||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}const Yl=class e{constructor(e){h(this,"device"),h(this,"cachingEnabled"),h(this,"destroyPolicy"),h(this,"debug"),h(this,"_hashCounter",0),h(this,"_hashes",{}),h(this,"_renderPipelineCache",{}),h(this,"_computePipelineCache",{}),this.device=e,this.cachingEnabled=e.props._cachePipelines,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=e.props.debugFactories}static getDefaultPipelineFactory(t){return t._lumaData.defaultPipelineFactory=t._lumaData.defaultPipelineFactory||new e(t),t._lumaData.defaultPipelineFactory}get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}createRenderPipeline(e){var t;if(!this.cachingEnabled)return this.device.createRenderPipeline(e);const n={...io.defaultProps,...e},i=this._renderPipelineCache,o=this._hashRenderPipeline(n);let r=null==(t=i[o])?void 0:t.pipeline;return r?(i[o].useCount++,this.debug&&ni.log(3,`${this}: ${i[o].pipeline} reused, count=${i[o].useCount}, (id=${e.id})`)()):(r=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:Wl("unnamed-cached")}),r.hash=o,i[o]={pipeline:r,useCount:1},this.debug&&ni.log(3,`${this}: ${r} created, count=${i[o].useCount}`)()),r}createComputePipeline(e){var t;if(!this.cachingEnabled)return this.device.createComputePipeline(e);const n={...ro.defaultProps,...e},i=this._computePipelineCache,o=this._hashComputePipeline(n);let r=null==(t=i[o])?void 0:t.pipeline;return r?(i[o].useCount++,this.debug&&ni.log(3,`${this}: ${i[o].pipeline} reused, count=${i[o].useCount}, (id=${e.id})`)()):(r=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0}),r.hash=o,i[o]={pipeline:r,useCount:1},this.debug&&ni.log(3,`${this}: ${r} created, count=${i[o].useCount}`)()),r}release(e){if(!this.cachingEnabled)return void e.destroy();const t=this._getCache(e),n=e.hash;t[n].useCount--,0===t[n].useCount?(this._destroyPipeline(e),this.debug&&ni.log(3,`${this}: ${e} released and destroyed`)()):t[n].useCount<0?(ni.error(`${this}: ${e} released, useCount < 0, resetting`)(),t[n].useCount=0):this.debug&&ni.log(3,`${this}: ${e} released, count=${t[n].useCount}`)()}_destroyPipeline(e){const t=this._getCache(e);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete t[e.hash],e.destroy(),!0}}_getCache(e){let t;if(e instanceof ro&&(t=this._computePipelineCache),e instanceof io&&(t=this._renderPipelineCache),!t)throw new Error(`${this}`);if(!t[e.hash])throw new Error(`${this}: ${e} matched incorrect entry`);return t}_hashComputePipeline(e){const{type:t}=this.device;return`${t}/C/${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,i=this._getHash(JSON.stringify(e.bufferLayout)),{type:o}=this.device;if("webgl"===o)return`${o}/R/${t}/${n}V-BL${i}`;{const r=this._getHash(JSON.stringify(e.parameters));return`${o}/R/${t}/${n}V-T${e.topology}P${r}BL${i}`}}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};h(Yl,"defaultProps",{...io.defaultProps});let ql=Yl;const Xl=class e{constructor(e){h(this,"device"),h(this,"cachingEnabled"),h(this,"destroyPolicy"),h(this,"debug"),h(this,"_cache",{}),this.device=e,this.cachingEnabled=e.props._cacheShaders,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=!0}static getDefaultShaderFactory(t){var n;return(n=t._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new e(t)),t._lumaData.defaultShaderFactory}get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}createShader(e){if(!this.cachingEnabled)return this.device.createShader(e);const t=this._hashShader(e);let n=this._cache[t];if(n)n.useCount++,this.debug&&ni.log(3,`${this}: Reusing shader ${n.shader.id} count=${n.useCount}`)();else{const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=n={shader:i,useCount:1},this.debug&&ni.log(3,`${this}: Created new shader ${i.id}`)()}return n.shader}release(e){if(!this.cachingEnabled)return void e.destroy();const t=this._hashShader(e),n=this._cache[t];if(n)if(n.useCount--,0===n.useCount)"unused"===this.destroyPolicy&&(delete this._cache[t],n.shader.destroy(),this.debug&&ni.log(3,`${this}: Releasing shader ${e.id}, destroyed`)());else{if(n.useCount<0)throw new Error(`ShaderFactory: Shader ${e.id} released too many times`);this.debug&&ni.log(3,`${this}: Releasing shader ${e.id} count=${n.useCount}`)()}}_hashShader(e){return`${e.stage}:${e.source}`}};h(Xl,"defaultProps",{...eo.defaultProps});let Kl=Xl,Zl=null,Ql=null;function Jl(e,t,n){if(e===t)return!0;if(!n||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!Jl(e[i],t[i],n-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){const i=Object.keys(e),o=Object.keys(t);if(i.length!==o.length)return!1;for(const r of i)if(!t.hasOwnProperty(r)||!Jl(e[r],t[r],n-1))return!1;return!0}return!1}class ec{constructor(e){h(this,"bufferLayouts"),this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){var t;return e.attributes?null==(t=e.attributes)?void 0:t.map(e=>e.attribute):[e.name]}mergeBufferLayouts(e,t){const n=[...e];for(const i of t){const e=n.findIndex(e=>e.name===i.name);e<0?n.push(i):n[e]=i}return n}getBufferIndex(e){const t=this.bufferLayouts.findIndex(t=>t.name===e);return-1===t&&ni.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function tc(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach(n=>{const i=e[n];!function(e){return function(e){return function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(e)||function(e){return!!Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}(e)}(e)||"number"==typeof e||"boolean"==typeof e}(i)?t.bindings[n]=i:t.uniforms[n]=i}),t}class nc{constructor(e,t){h(this,"options",{disableWarnings:!1}),h(this,"modules"),h(this,"moduleUniforms"),h(this,"moduleBindings"),Object.assign(this.options,t);const n=rs(Object.values(e).filter(e=>e.dependencies));for(const i of n)e[i.name]=i;ni.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,o]of Object.entries(e))this._addModule(o),o.name&&i!==o.name&&!this.options.disableWarnings&&ni.warn(`Module name: ${i} vs ${o.name}`)()}destroy(){}setProps(e){var t;for(const n of Object.keys(e)){const i=n,o=e[i]||{},r=this.modules[i];if(!r){this.options.disableWarnings||ni.warn(`Module ${n} not found`)();continue}const s=this.moduleUniforms[i],a=this.moduleBindings[i],l=(null==(t=r.getUniforms)?void 0:t.call(r,o,s))||o,{uniforms:c,bindings:u}=tc(l);this.moduleUniforms[i]={...s,...c},this.moduleBindings[i]={...a,...u}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var e;const t={};for(const[n,i]of Object.entries(this.moduleUniforms))for(const[o,r]of Object.entries(i))t[`${n}.${o}`]={type:null==(e=this.modules[n].uniformTypes)?void 0:e[o],value:String(r)};return t}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}const ic=["+X","-X","+Y","-Y","+Z","-Z"],oc=["+X","-X","+Y","-Y","+Z","-Z"],rc=class e{constructor(t,n){h(this,"device"),h(this,"id"),h(this,"props"),h(this,"texture"),h(this,"sampler"),h(this,"view"),h(this,"ready"),h(this,"isReady",!1),h(this,"destroyed",!1),h(this,"resolveReady",()=>{}),h(this,"rejectReady",()=>{}),this.device=t;const i=Wl("async-texture");this.props={...e.defaultProps,id:i,...n},this.id=this.props.id,"string"==typeof(null==(n={...n})?void 0:n.data)&&"2d"===n.dimension&&(n.data=async function(e){const t=new Image;return t.crossOrigin="anonymous",t.src=e.startsWith("http")?e:""+e,await t.decode(),await createImageBitmap(t)}(n.data)),n.mipmaps&&(n.mipLevels="auto"),this.ready=new Promise((e,t)=>{this.resolveReady=()=>{this.isReady=!0,e()},this.rejectReady=t}),this.initAsync(n)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){const t=e.data,n=await ac(t).then(void 0,this.rejectReady);if(this.destroyed)return;const i=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(n);if(!i)throw new Error("Texture size could not be determined");const o={...i,...e,data:void 0,mipLevels:1},r=this.device.getMipLevelCount(o.width,o.height);if(o.mipLevels="auto"===this.props.mipLevels?r:Math.min(r,this.props.mipLevels),this.texture=this.device.createTexture(o),this.sampler=this.texture.sampler,this.view=this.texture.view,e.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,n);break;case"2d":this._setTexture2DData(n);break;case"3d":this._setTexture3DData(this.texture,n);break;case"2d-array":this._setTextureArrayData(this.texture,n);break;case"cube":this._setTextureCubeData(this.texture,n);break;case"cube-array":this._setTextureCubeArrayData(this.texture,n)}this.props.mipmaps&&this.generateMipmaps(),ni.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(e={}){this.texture.setSampler(e instanceof Wi?e:this.device.createSampler(e))}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}isTextureLevelData(e){const t=null==e?void 0:e.data;return ArrayBuffer.isView(t)}getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return this.getTextureDataSize(e[0]);if(this.device.isExternalImage(e))return this.device.getExternalImageSize(e);if(e&&"object"==typeof e&&e.constructor===Object){const t=Object.values(e)[0];return{width:t.width,height:t.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}setTextureData(e){}_setTexture1DData(e,t){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(e,t=0){if(!this.texture)throw new Error("Texture not initialized");const n=this._normalizeTextureData(e);n.length>1&&!1!==this.props.mipmaps&&ni.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let i=0;i<n.length;i++){const e=n[i];this.device.isExternalImage(e)?this.texture.copyExternalImage({image:e,depth:t,mipLevel:i,flipY:!0}):this.texture.copyImageData({data:e.data,mipLevel:i})}}_setTexture3DData(e,t){var n;if("3d"!==(null==(n=this.texture)?void 0:n.props.dimension))throw new Error(this.id);for(let i=0;i<t.length;i++)this._setTexture2DData(t[i],i)}_setTextureCubeData(e,t){var n;if("cube"!==(null==(n=this.texture)?void 0:n.props.dimension))throw new Error(this.id);for(const[i,o]of Object.entries(t)){const e=oc.indexOf(i);this._setTexture2DData(o,e)}}_setTextureArrayData(e,t){var n;if("2d-array"!==(null==(n=this.texture)?void 0:n.props.dimension))throw new Error(this.id);for(let i=0;i<t.length;i++)this._setTexture2DData(t[i],i)}_setTextureCubeArrayData(e,t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(e,t,n,i=0){Array.isArray(t)&&t.length>1&&!1!==this.props.mipmaps&&ni.warn(`${this.id} has mipmap and multiple LODs.`)();const o=ic.indexOf(n);this._setTexture2DData(t,o)}_normalizeTextureData(e){const t=this.texture;let n;return n=ArrayBuffer.isView(e)?[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?e:[e],n}};h(rc,"defaultProps",{...qi.defaultProps,data:null,mipmaps:!1});let sc=rc;async function ac(e){if(e=await e,Array.isArray(e))return await Promise.all(e.map(ac));if(e&&"object"==typeof e&&e.constructor===Object){const t=e,n=await Promise.all(Object.values(t)),i=Object.keys(t),o={};for(let e=0;e<i.length;e++)o[i[e]]=n[e];return o}return e}const lc=class e{constructor(t,n){var i,o,r,s;h(this,"device"),h(this,"id"),h(this,"source"),h(this,"vs"),h(this,"fs"),h(this,"pipelineFactory"),h(this,"shaderFactory"),h(this,"userData",{}),h(this,"parameters"),h(this,"topology"),h(this,"bufferLayout"),h(this,"isInstanced"),h(this,"instanceCount",0),h(this,"vertexCount"),h(this,"indexBuffer",null),h(this,"bufferAttributes",{}),h(this,"constantAttributes",{}),h(this,"bindings",{}),h(this,"vertexArray"),h(this,"transformFeedback",null),h(this,"pipeline"),h(this,"shaderInputs"),h(this,"_uniformStore"),h(this,"_attributeInfos",{}),h(this,"_gpuGeometry",null),h(this,"props"),h(this,"_pipelineNeedsUpdate","newly created"),h(this,"_needsRedraw","initializing"),h(this,"_destroyed",!1),h(this,"_lastDrawTimestamp",-1),h(this,"_lastLogTime",0),h(this,"_logOpen",!1),h(this,"_drawCount",0),this.props={...e.defaultProps,...n},n=this.props,this.id=n.id||Wl("model"),this.device=t,Object.assign(this.userData,n.userData);const a=Object.fromEntries((null==(i=this.props.modules)?void 0:i.map(e=>[e.name,e]))||[]),l=n.shaderInputs||new nc(a,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(l);const c=function(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}(t),u=((null==(o=this.props.modules)?void 0:o.length)>0?this.props.modules:null==(r=this.shaderInputs)?void 0:r.getModules())||[];if("webgpu"===this.device.type&&this.props.source){const{source:e,getUniforms:t}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:c,...this.props,modules:u});this.source=e,this._getModuleUniforms=t,(s=this.props).shaderLayout||(s.shaderLayout=function(e){var t;const n={attributes:[],bindings:[]};let i;try{i=function(e){try{return new Vl(e)}catch(n){if(n instanceof Error)throw n;let t="WGSL parse error";throw"object"==typeof n&&null!=n&&n.message&&(t+=`: ${n.message} `),"object"==typeof n&&null!=n&&n.token&&(t+=n.token.line||""),new Error(t,{cause:n})}}(e)}catch(u){return ni.error(u.message)(),n}for(const s of i.uniforms){const e=[];for(const n of(null==(t=s.type)?void 0:t.members)||[])e.push({name:n.name,type:Hl(n.type)});n.bindings.push({type:"uniform",name:s.name,group:s.group,location:s.binding,members:e})}for(const s of i.textures)n.bindings.push({type:"texture",name:s.name,group:s.group,location:s.binding});for(const s of i.samplers)n.bindings.push({type:"sampler",name:s.name,group:s.group,location:s.binding});const o=i.entry.vertex[0],r=(null==o?void 0:o.inputs.length)||0;for(let s=0;s<r;s++){const e=o.inputs[s];if("location"===e.locationType){const t=Hl(e.type);n.attributes.push({name:e.name,location:Number(e.location),type:t})}}return n}(this.source))}else{const{vs:e,fs:t,getUniforms:n}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:c,...this.props,modules:u});this.vs=e,this.fs=t,this._getModuleUniforms=n}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||ql.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||Kl.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=t.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in n&&(this.isInstanced=n.isInstanced),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.vertexCount&&this.setVertexCount(n.vertexCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),null==(e=this._gpuGeometry)||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return ni.info(2,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const t=this._getBindings();this.pipeline.setBindings(t,{disableWarnings:this.props.disableWarnings});const{indexBuffer:i}=this.vertexArray,o=i?i.byteLength/("uint32"===i.indexType?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:o,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var t;null==(t=this._gpuGeometry)||t.destroy();const n=e&&function(e,t){if(t instanceof jl)return t;const n=function(e,t){if(!t.indices)return;const n=t.indices.value;return e.createBuffer({usage:ai.INDEX,data:n})}(e,t),{attributes:i,bufferLayout:o}=function(e,t){const n=[],i={};for(const[o,r]of Object.entries(t.attributes)){let t=o;switch(o){case"POSITION":t="positions";break;case"NORMAL":t="normals";break;case"TEXCOORD_0":t="texCoords";break;case"COLOR_0":t="colors"}if(r){i[t]=e.createBuffer({data:r.value,id:`${o}-buffer`});const{value:s,size:a,normalized:l}=r;n.push({name:t,format:fi(s,a,l)})}}return{attributes:i,bufferLayout:n,vertexCount:t._calculateVertexCount(t.attributes,t.indices)}}(e,t);return new jl({topology:t.topology||"triangle-list",bufferLayout:o,vertexCount:t.vertexCount,indices:n,attributes:i})}(this.device,e);if(n){this.setTopology(n.topology||"triangle-list");const e=new ec(this.bufferLayout);this.bufferLayout=e.mergeBufferLayouts(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)}this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new ec(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Jl(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,void 0===this.isInstanced&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new vo(this.shaderInputs.modules);for(const[t,n]of Object.entries(this.shaderInputs.modules))if(uc(n)){const e=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=e}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const n=(null==t?void 0:t.disableWarnings)??this.props.disableWarnings;e.indices&&ni.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=function(e,t){const n=Object.fromEntries(e.attributes.map(e=>[e.name,e.location])),i=t.slice();return i.sort((e,t)=>{const i=e.attributes?e.attributes.map(e=>e.attribute):[e.name],o=t.attributes?t.attributes.map(e=>e.attribute):[t.name];return Math.min(...i.map(e=>n[e]))-Math.min(...o.map(e=>n[e]))}),i}(this.pipeline.shaderLayout,this.bufferLayout);const i=new ec(this.bufferLayout);for(const[o,r]of Object.entries(e)){const e=i.getBufferLayout(o);if(!e){n||ni.warn(`Model(${this.id}): Missing layout for buffer "${o}".`)();continue}const t=i.getAttributeNamesForBuffer(e);let s=!1;for(const n of t){const e=this._attributeInfos[n];if(e){const t="webgpu"===this.device.type?i.getBufferIndex(e.bufferName):e.location;this.vertexArray.setBuffer(t,r),s=!0}}!s&&!n&&ni.warn(`Model(${this.id}): Ignoring buffer "${r.id}" for unknown attribute "${o}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[n,i]of Object.entries(e)){const e=this._attributeInfos[n];e?this.vertexArray.setConstantWebGL(e.location,i):((null==t?void 0:t.disableWarnings)??this.props.disableWarnings)||ni.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof sc&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,n]of Object.entries(this.bindings))n instanceof sc?n.isReady&&(e[t]=n.texture):e[t]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof Ki?e=Math.max(e,t.texture.updateTimestamp):t instanceof ai||t instanceof qi?e=Math.max(e,t.updateTimestamp):t instanceof sc?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof Wi||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[n]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(e=>e.name===n)&&"positions"!==n&&delete t[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(ni.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=n:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:i}),this._attributeInfos=uo(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=ni.level>3?0:1e4;ni.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,ni.group(2,`>>> DRAWING MODEL ${this.id}`,{collapsed:ni.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=function(e){var t;const n={},i="Values";if(0===e.attributes.length&&(null==(t=e.varyings)||!t.length))return{"No attributes or varyings":{[i]:"N/A"}};for(const o of e.attributes)o&&(n[`in ${o.location} ${o.name}: ${o.type}`]={[i]:o.stepMode||"vertex"});for(const o of e.varyings||[])n[`out ${o.location} ${o.name}`]={[i]:JSON.stringify(o)};return n}(this.pipeline.shaderLayout,this.id);ni.table(2,e)();const t=this.shaderInputs.getDebugTable();ni.table(2,t)();const n=this._getAttributeDebugTable();ni.table(2,this._attributeInfos)(),ni.table(2,n)(),ni.groupEnd(2)(),this._logOpen=!1}}_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const n=e.props.framebuffer;n&&function(e,{id:t,minimap:n,opaque:i,top:o="0",left:r="0",rgbaScale:s=1}){Zl||(Zl=document.createElement("canvas"),Zl.id=t,Zl.title=t,Zl.style.zIndex="100",Zl.style.position="absolute",Zl.style.top=o,Zl.style.left=r,Zl.style.border="blue 5px solid",Zl.style.transform="scaleY(-1)",document.body.appendChild(Zl),Ql=Zl.getContext("2d")),(Zl.width!==e.width||Zl.height!==e.height)&&(Zl.width=e.width/2,Zl.height=e.height/2,Zl.style.width="400px",Zl.style.height="400px");const a=e.device.readPixelsToArrayWebGL(e),l=null==Ql?void 0:Ql.createImageData(e.width,e.height);if(l){for(let e=0;e<a.length;e+=4)l.data[0+e+0]=a[e+0]*s,l.data[0+e+1]=a[e+1]*s,l.data[0+e+2]=a[e+2]*s,l.data[0+e+3]=i?255:a[e+3]*s;null==Ql||Ql.putImageData(l,0,0)}}(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,n]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[n.location];e[n.location]={name:t,type:n.shaderType,values:i?this._getBufferOrConstantValues(i,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,n="uint32"===t.indexType?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,t){const n=hi(t);return(e instanceof ai?new n(e.debugData):e).toString()}};h(lc,"defaultProps",{...io.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Cs.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let cc=lc;function uc(e){return!(!e.uniformTypes||function(e){for(const t in e)return!1;return!0}(e.uniformTypes))}class hc{constructor(e,t,n,i,o){this._debugRandomNumber=Math.floor(1e3*Math.random()),this.device=e,this.config=t,this.store=n,this.data=i,o&&(this.points=o)}}function dc(e){const t=new Float32Array(e*e*2);for(let n=0;n<e;n++)for(let i=0;i<e;i++){const o=n*e*2+2*i;t[o+0]=i,t[o+1]=n}return t}function pc(e,t){return t*(Ri.getInfo(e).bytesPerPixel??0)}const fc="#version 300 es\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nin vec2 vertexCoord; // Vertex coordinates in normalized device coordinates\nout vec2 textureCoords; // Texture coordinates to pass to the fragment shader\n\nvoid main() {\n    // Convert vertex coordinates from [-1, 1] range to [0, 1] range for texture sampling\n    textureCoords = (vertexCoord + 1.0) / 2.0;\n    gl_Position = vec4(vertexCoord, 0, 1);\n}\n";class mc extends hc{create(){var e;const{device:t,store:n}=this,{pointsTextureSize:i}=n;if(i){if(this.centermassTexture||(this.centermassTexture=t.createTexture({width:1,height:1,format:"rgba32float",usage:qi.SAMPLE|qi.RENDER|qi.COPY_DST})),this.centermassTexture.copyImageData({data:new Float32Array(4).fill(0),bytesPerRow:pc("rgba32float",1),mipLevel:0,x:0,y:0}),this.centermassFbo||(this.centermassFbo=t.createFramebuffer({width:1,height:1,colorAttachments:[this.centermassTexture]})),!this.pointIndices||this.previousPointsTextureSize!==n.pointsTextureSize){this.pointIndices&&!this.pointIndices.destroyed&&this.pointIndices.destroy();const i=dc(n.pointsTextureSize);this.pointIndices=t.createBuffer({data:i,usage:ai.VERTEX|ai.COPY_DST}),null==(e=this.calculateCentermassCommand)||e.setAttributes({pointIndices:this.pointIndices})}this.previousPointsTextureSize=i}}initPrograms(){const{device:e,store:t,points:n}=this;!n||!t.pointsTextureSize||!this.centermassFbo||this.centermassFbo.destroyed||!this.centermassTexture||this.centermassTexture.destroyed||(this.forceVertexCoordBuffer||(this.forceVertexCoordBuffer=e.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.calculateUniformStore||(this.calculateUniformStore=new vo({calculateCentermassUniforms:{uniformTypes:{pointsTextureSize:"f32"}}})),this.forceUniformStore||(this.forceUniformStore=new vo({forceCenterUniforms:{uniformTypes:{centerForce:"f32",alpha:"f32"}}})),this.calculateCentermassCommand||(this.calculateCentermassCommand=new cc(e,{fs:"#version 300 es\nprecision highp float;\n\nin vec4 rgba;\nout vec4 fragColor;\n\nvoid main() {\n  fragColor = rgba;\n}",vs:"#version 300 es\nprecision highp float;\n\nuniform sampler2D positionsTexture;\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform calculateCentermassUniforms {\n  float pointsTextureSize;\n} calculateCentermass;\n\n#define pointsTextureSize calculateCentermass.pointsTextureSize\n#else\nuniform float pointsTextureSize;\n#endif\n\nin vec2 pointIndices;\n\nout vec4 rgba;\n\nvoid main() {\n  vec4 pointPosition = texture(positionsTexture, pointIndices / pointsTextureSize);\n  rgba = vec4(pointPosition.xy, 1.0, 0.0);\n\n  gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n  gl_PointSize = 1.0;\n}\n",topology:"point-list",attributes:{...this.pointIndices&&{pointIndices:this.pointIndices}},bufferLayout:[{name:"pointIndices",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{calculateCentermassUniforms:this.calculateUniformStore.getManagedUniformBuffer(e,"calculateCentermassUniforms")},parameters:{blend:!0,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"add",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",depthWriteEnabled:!1,depthCompare:"always"}})),this.calculateCentermassCommand.setVertexCount(this.data.pointsNumber??0),this.runCommand||(this.runCommand=new cc(e,{fs:"#version 300 es\nprecision highp float;\n\nuniform sampler2D positionsTexture;\nuniform sampler2D centermassTexture;\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform forceCenterUniforms {\n  float centerForce;\n  float alpha;\n} forceCenter;\n\n#define centerForce forceCenter.centerForce\n#define alpha forceCenter.alpha\n#else\nuniform float centerForce;\nuniform float alpha;\n#endif\n\nin vec2 textureCoords;\nout vec4 fragColor;\n\nvoid main() {\n  vec4 pointPosition = texture(positionsTexture, textureCoords);\n  vec4 velocity = vec4(0.0);\n  vec4 centermassValues = texture(centermassTexture, vec2(0.0));\n  vec2 centermassPosition = centermassValues.xy / centermassValues.b;\n  vec2 distVector = centermassPosition - pointPosition.xy;\n  float dist = sqrt(dot(distVector, distVector));\n  if (dist > 0.0) {\n    float angle = atan(distVector.y, distVector.x);\n    float addV = alpha * centerForce * dist * 0.01;\n    velocity.rg += addV * vec2(cos(angle), sin(angle));\n  }\n\n  fragColor = velocity;\n}",vs:fc,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.forceVertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{forceCenterUniforms:this.forceUniformStore.getManagedUniformBuffer(e,"forceCenterUniforms")},parameters:{depthWriteEnabled:!1,depthCompare:"always"}})))}run(){const{device:e,store:t,points:n}=this;if(!n||!this.calculateCentermassCommand||!this.calculateUniformStore||!this.runCommand||!this.forceUniformStore||!this.centermassFbo||!this.centermassTexture||!n.previousPositionTexture||n.previousPositionTexture.destroyed||!n.velocityFbo||n.velocityFbo.destroyed||t.pointsTextureSize!==this.previousPointsTextureSize||!this.pointIndices)return;const i=e.beginRenderPass({framebuffer:this.centermassFbo,clearColor:[0,0,0,0]});this.calculateUniformStore.setUniforms({calculateCentermassUniforms:{pointsTextureSize:t.pointsTextureSize??0}}),this.calculateCentermassCommand.setBindings({positionsTexture:n.previousPositionTexture}),this.calculateCentermassCommand.draw(i),i.end(),this.forceUniformStore.setUniforms({forceCenterUniforms:{centerForce:this.config.simulationCenter??0,alpha:t.alpha}}),this.runCommand.setBindings({positionsTexture:n.previousPositionTexture,centermassTexture:this.centermassTexture});const o=e.beginRenderPass({framebuffer:n.velocityFbo,clearColor:[0,0,0,0]});this.runCommand.draw(o),o.end()}destroy(){var e,t,n,i;null==(e=this.calculateCentermassCommand)||e.destroy(),this.calculateCentermassCommand=void 0,null==(t=this.runCommand)||t.destroy(),this.runCommand=void 0,this.centermassFbo&&!this.centermassFbo.destroyed&&this.centermassFbo.destroy(),this.centermassFbo=void 0,this.centermassTexture&&!this.centermassTexture.destroyed&&this.centermassTexture.destroy(),this.centermassTexture=void 0,null==(n=this.calculateUniformStore)||n.destroy(),this.calculateUniformStore=void 0,null==(i=this.forceUniformStore)||i.destroy(),this.forceUniformStore=void 0,this.pointIndices&&!this.pointIndices.destroyed&&this.pointIndices.destroy(),this.pointIndices=void 0,this.forceVertexCoordBuffer&&!this.forceVertexCoordBuffer.destroyed&&this.forceVertexCoordBuffer.destroy(),this.forceVertexCoordBuffer=void 0,this.previousPointsTextureSize=void 0}}class _c extends hc{initPrograms(){const{device:e,points:t,store:n}=this;!t||!n.pointsTextureSize||(this.vertexCoordBuffer||(this.vertexCoordBuffer=e.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.uniformStore||(this.uniformStore=new vo({forceGravityUniforms:{uniformTypes:{gravity:"f32",spaceSize:"f32",alpha:"f32"}}})),this.runCommand||(this.runCommand=new cc(e,{fs:"#version 300 es\nprecision highp float;\n\nuniform sampler2D positionsTexture;\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform forceGravityUniforms {\n  float gravity;\n  float spaceSize;\n  float alpha;\n} forceGravity;\n\n#define gravity forceGravity.gravity\n#define spaceSize forceGravity.spaceSize\n#define alpha forceGravity.alpha\n#else\nuniform float gravity;\nuniform float spaceSize;\nuniform float alpha;\n#endif\n\nin vec2 textureCoords;\nout vec4 fragColor;\n\nvoid main() {\n  vec4 pointPosition = texture(positionsTexture, textureCoords);\n\n  vec4 velocity = vec4(0.0);\n\n  vec2 centerPosition = vec2(spaceSize * 0.5);\n  vec2 distVector = centerPosition - pointPosition.rg;\n  float dist = sqrt(dot(distVector, distVector));\n  if (dist > 0.0) {\n    float angle = atan(distVector.y, distVector.x);\n    float additionalVelocity = alpha * gravity * dist * 0.1;\n    velocity.rg += additionalVelocity * vec2(cos(angle), sin(angle));\n  }\n\n  fragColor = velocity;\n}",vs:fc,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.vertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{forceGravityUniforms:this.uniformStore.getManagedUniformBuffer(e,"forceGravityUniforms")},parameters:{depthWriteEnabled:!1,depthCompare:"always"}})))}run(){const{device:e,points:t,store:n}=this;if(!t||!this.runCommand||!this.uniformStore||!t.previousPositionTexture||t.previousPositionTexture.destroyed||!t.velocityFbo||t.velocityFbo.destroyed)return;this.uniformStore.setUniforms({forceGravityUniforms:{gravity:this.config.simulationGravity??0,spaceSize:n.adjustedSpaceSize??0,alpha:n.alpha}}),this.runCommand.setBindings({positionsTexture:t.previousPositionTexture});const i=e.beginRenderPass({framebuffer:t.velocityFbo,clearColor:[0,0,0,0]});this.runCommand.draw(i),i.end()}destroy(){var e,t;null==(e=this.runCommand)||e.destroy(),this.runCommand=void 0,null==(t=this.uniformStore)||t.destroy(),this.uniformStore=void 0,this.vertexCoordBuffer&&!this.vertexCoordBuffer.destroyed&&this.vertexCoordBuffer.destroy(),this.vertexCoordBuffer=void 0}}function gc(e){return`#version 300 es\nprecision highp float;\n\nuniform sampler2D positionsTexture;\nuniform sampler2D linkInfoTexture; // Texture storing first link indices and amount\nuniform sampler2D linkIndicesTexture;\nuniform sampler2D linkPropertiesTexture; // Texture storing link bias and strength\nuniform sampler2D linkRandomDistanceTexture;\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform forceLinkUniforms {\n  float linkSpring;\n  float linkDistance;\n  vec2 linkDistRandomVariationRange;\n  float pointsTextureSize;\n  float linksTextureSize;\n  float alpha;\n} forceLink;\n\n#define linkSpring forceLink.linkSpring\n#define linkDistance forceLink.linkDistance\n#define linkDistRandomVariationRange forceLink.linkDistRandomVariationRange\n#define pointsTextureSize forceLink.pointsTextureSize\n#define linksTextureSize forceLink.linksTextureSize\n#define alpha forceLink.alpha\n#else\nuniform float linkSpring;\nuniform float linkDistance;\nuniform vec2 linkDistRandomVariationRange;\nuniform float pointsTextureSize;\nuniform float linksTextureSize;\nuniform float alpha;\n#endif\n\nin vec2 textureCoords;\nout vec4 fragColor;\n\nconst float MAX_LINKS = ${e}.0;\n\nvoid main() {\n  vec4 pointPosition = texture(positionsTexture, textureCoords);\n  vec4 velocity = vec4(0.0);\n\n  vec4 linkInfo = texture(linkInfoTexture, textureCoords);\n  float iCount = linkInfo.r;\n  float jCount = linkInfo.g;\n  float linkAmount = linkInfo.b;\n  if (linkAmount > 0.0) {\n    for (float i = 0.0; i < MAX_LINKS; i += 1.0) {\n      if (i < linkAmount) {\n        if (iCount >= linksTextureSize) {\n          iCount = 0.0;\n          jCount += 1.0;\n        }\n        vec2 linkTextureIndex = (vec2(iCount, jCount) + 0.5) / linksTextureSize;\n        vec4 connectedPointIndex = texture(linkIndicesTexture, linkTextureIndex);\n        vec4 biasAndStrength = texture(linkPropertiesTexture, linkTextureIndex);\n        vec4 randomMinDistance = texture(linkRandomDistanceTexture, linkTextureIndex);\n        float bias = biasAndStrength.r;\n        float strength = biasAndStrength.g;\n        float randomMinLinkDist = randomMinDistance.r * (linkDistRandomVariationRange.g - linkDistRandomVariationRange.r) + linkDistRandomVariationRange.r;\n        randomMinLinkDist *= linkDistance;\n\n        iCount += 1.0;\n\n        vec4 connectedPointPosition = texture(positionsTexture, (connectedPointIndex.rg + 0.5) / pointsTextureSize);\n        float x = connectedPointPosition.x - (pointPosition.x + velocity.x);\n        float y = connectedPointPosition.y - (pointPosition.y + velocity.y);\n        float l = sqrt(x * x + y * y);\n\n        // Apply the link force\n        l = max(l, randomMinLinkDist * 0.99);\n        l = (l - randomMinLinkDist) / l;\n        l *= linkSpring * alpha;\n        l *= strength;\n        l *= bias;\n        x *= l;\n        y *= l;\n        velocity.x += x;\n        velocity.y += y;\n      }\n    }\n  }\n\n  fragColor = vec4(velocity.rg, 0.0, 0.0);\n}\n  `}function yc(e,t){return e&&2===e.length?[e[0],e[1]]:t}function bc(e,t){return e&&4===e.length?[e[0],e[1],e[2],e[3]]:t}var vc=(e=>(e.OUTGOING="outgoing",e.INCOMING="incoming",e))(vc||{});class xc extends hc{constructor(){super(...arguments),this.linkFirstIndicesAndAmount=new Float32Array,this.indices=new Float32Array,this.maxPointDegree=0}create(e){var t;const{device:n,store:{pointsTextureSize:i,linksTextureSize:o},data:r}=this;if(!i||!o)return;this.linkFirstIndicesAndAmount=new Float32Array(i*i*4),this.indices=new Float32Array(o*o*4);const s=new Float32Array(o*o*4),a=new Float32Array(o*o*4),l="incoming"===e?r.sourceIndexToTargetIndices:r.targetIndexToSourceIndices;this.maxPointDegree=0;let c=0;null==l||l.forEach((e,t)=>{e&&(this.linkFirstIndicesAndAmount[4*t+0]=c%o,this.linkFirstIndicesAndAmount[4*t+1]=Math.floor(c/o),this.linkFirstIndicesAndAmount[4*t+2]=e.length??0,e.forEach(([e,n])=>{var o,l,u;this.indices[4*c+0]=e%i,this.indices[4*c+1]=Math.floor(e/i);const h=(null==(o=r.degree)?void 0:o[e])??0,d=(null==(l=r.degree)?void 0:l[t])??0,p=h+d,f=0!==p?h/p:.5,m=Math.min(h,d);let _=(null==(u=r.linkStrength)?void 0:u[n])??1/Math.max(m,1);_=Math.sqrt(_),s[4*c+0]=f,s[4*c+1]=_,a[4*c]=this.store.getRandomFloat(0,1),c+=1}),this.maxPointDegree=Math.max(this.maxPointDegree,e.length??0))});const u=!this.linkFirstIndicesAndAmountTexture||this.linkFirstIndicesAndAmountTexture.width!==i||this.linkFirstIndicesAndAmountTexture.height!==i,h=!this.indicesTexture||this.indicesTexture.width!==o||this.indicesTexture.height!==o;u&&(this.linkFirstIndicesAndAmountTexture&&!this.linkFirstIndicesAndAmountTexture.destroyed&&this.linkFirstIndicesAndAmountTexture.destroy(),this.linkFirstIndicesAndAmountTexture=n.createTexture({width:i,height:i,format:"rgba32float",usage:qi.SAMPLE|qi.COPY_DST})),this.linkFirstIndicesAndAmountTexture.copyImageData({data:this.linkFirstIndicesAndAmount,bytesPerRow:pc("rgba32float",i),mipLevel:0,x:0,y:0}),h&&(this.indicesTexture&&!this.indicesTexture.destroyed&&this.indicesTexture.destroy(),this.biasAndStrengthTexture&&!this.biasAndStrengthTexture.destroyed&&this.biasAndStrengthTexture.destroy(),this.randomDistanceTexture&&!this.randomDistanceTexture.destroyed&&this.randomDistanceTexture.destroy(),this.indicesTexture=n.createTexture({width:o,height:o,format:"rgba32float",usage:qi.SAMPLE|qi.COPY_DST}),this.biasAndStrengthTexture=n.createTexture({width:o,height:o,format:"rgba32float",usage:qi.SAMPLE|qi.COPY_DST}),this.randomDistanceTexture=n.createTexture({width:o,height:o,format:"rgba32float",usage:qi.SAMPLE|qi.COPY_DST})),this.indicesTexture.copyImageData({data:this.indices,bytesPerRow:pc("rgba32float",o),mipLevel:0,x:0,y:0}),this.biasAndStrengthTexture.copyImageData({data:s,bytesPerRow:pc("rgba32float",o),mipLevel:0,x:0,y:0}),this.randomDistanceTexture.copyImageData({data:a,bytesPerRow:pc("rgba32float",o),mipLevel:0,x:0,y:0}),void 0!==this.previousMaxPointDegree&&this.previousMaxPointDegree!==this.maxPointDegree&&(null==(t=this.runCommand)||t.destroy(),this.runCommand=void 0),this.previousMaxPointDegree=this.maxPointDegree,this.previousPointsTextureSize=i,this.previousLinksTextureSize=o}initPrograms(){const{device:e,store:t,points:n}=this;!n||!t.pointsTextureSize||!t.linksTextureSize||!this.linkFirstIndicesAndAmountTexture||!this.indicesTexture||!this.biasAndStrengthTexture||!this.randomDistanceTexture||(this.vertexCoordBuffer||(this.vertexCoordBuffer=e.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.uniformStore||(this.uniformStore=new vo({forceLinkUniforms:{uniformTypes:{linkSpring:"f32",linkDistance:"f32",linkDistRandomVariationRange:"vec2<f32>",pointsTextureSize:"f32",linksTextureSize:"f32",alpha:"f32"}}})),this.runCommand||(this.runCommand=new cc(e,{fs:gc(this.maxPointDegree),vs:fc,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.vertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{forceLinkUniforms:this.uniformStore.getManagedUniformBuffer(e,"forceLinkUniforms")},parameters:{depthWriteEnabled:!1,depthCompare:"always"}})))}run(){const{device:e,store:t,points:n}=this;if(!n||!this.runCommand||!this.uniformStore||!n.previousPositionTexture||n.previousPositionTexture.destroyed||!this.linkFirstIndicesAndAmountTexture||!this.indicesTexture||!this.biasAndStrengthTexture||!this.randomDistanceTexture||!n.velocityFbo||n.velocityFbo.destroyed||t.pointsTextureSize!==this.previousPointsTextureSize||t.linksTextureSize!==this.previousLinksTextureSize)return;this.uniformStore.setUniforms({forceLinkUniforms:{linkSpring:this.config.simulationLinkSpring??0,linkDistance:this.config.simulationLinkDistance??0,linkDistRandomVariationRange:yc(this.config.simulationLinkDistRandomVariationRange,[0,0]),pointsTextureSize:t.pointsTextureSize,linksTextureSize:t.linksTextureSize,alpha:t.alpha}}),this.runCommand.setBindings({positionsTexture:n.previousPositionTexture,linkInfoTexture:this.linkFirstIndicesAndAmountTexture,linkIndicesTexture:this.indicesTexture,linkPropertiesTexture:this.biasAndStrengthTexture,linkRandomDistanceTexture:this.randomDistanceTexture});const i=e.beginRenderPass({framebuffer:n.velocityFbo,clearColor:[0,0,0,0]});this.runCommand.draw(i),i.end()}destroy(){var e,t;null==(e=this.runCommand)||e.destroy(),this.runCommand=void 0,this.linkFirstIndicesAndAmountTexture&&!this.linkFirstIndicesAndAmountTexture.destroyed&&this.linkFirstIndicesAndAmountTexture.destroy(),this.linkFirstIndicesAndAmountTexture=void 0,this.indicesTexture&&!this.indicesTexture.destroyed&&this.indicesTexture.destroy(),this.indicesTexture=void 0,this.biasAndStrengthTexture&&!this.biasAndStrengthTexture.destroyed&&this.biasAndStrengthTexture.destroy(),this.biasAndStrengthTexture=void 0,this.randomDistanceTexture&&!this.randomDistanceTexture.destroyed&&this.randomDistanceTexture.destroy(),this.randomDistanceTexture=void 0,null==(t=this.uniformStore)||t.destroy(),this.uniformStore=void 0,this.vertexCoordBuffer&&!this.vertexCoordBuffer.destroyed&&this.vertexCoordBuffer.destroy(),this.vertexCoordBuffer=void 0}}class wc extends hc{constructor(){super(...arguments),this.levels=0,this.levelTargets=new Map}create(){var e;const{device:t,store:n}=this;if(!n.pointsTextureSize)return;this.levels=Math.log2(n.adjustedSpaceSize);for(let r=0;r<this.levels;r+=1){const e=Math.pow(2,r+1),n=this.levelTargets.get(r);if(n&&n.texture.width===e&&n.texture.height===e){n.texture.copyImageData({data:new Float32Array(e*e*4).fill(0),bytesPerRow:pc("rgba32float",e),mipLevel:0,x:0,y:0});continue}n&&(n.fbo.destroyed||n.fbo.destroy(),n.texture.destroyed||n.texture.destroy());const i=t.createTexture({width:e,height:e,format:"rgba32float",usage:qi.SAMPLE|qi.RENDER|qi.COPY_DST});i.copyImageData({data:new Float32Array(e*e*4).fill(0),bytesPerRow:pc("rgba32float",e),mipLevel:0,x:0,y:0});const o=t.createFramebuffer({width:e,height:e,colorAttachments:[i]});this.levelTargets.set(r,{texture:i,fbo:o})}for(const[r,s]of Array.from(this.levelTargets.entries()))r>=this.levels&&(s.fbo.destroyed||s.fbo.destroy(),s.texture.destroyed||s.texture.destroy(),this.levelTargets.delete(r));const i=n.pointsTextureSize*n.pointsTextureSize,o=new Float32Array(4*i);for(let r=0;r<i;++r)o[4*r]=1e-5*n.getRandomFloat(-1,1),o[4*r+1]=1e-5*n.getRandomFloat(-1,1);if((!this.randomValuesTexture||this.randomValuesTexture.destroyed||this.randomValuesTexture.width!==n.pointsTextureSize||this.randomValuesTexture.height!==n.pointsTextureSize)&&(this.randomValuesTexture&&!this.randomValuesTexture.destroyed&&this.randomValuesTexture.destroy(),this.randomValuesTexture=t.createTexture({width:n.pointsTextureSize,height:n.pointsTextureSize,format:"rgba32float",usage:qi.SAMPLE|qi.COPY_DST})),this.randomValuesTexture.copyImageData({data:o,bytesPerRow:pc("rgba32float",n.pointsTextureSize),mipLevel:0,x:0,y:0}),!this.pointIndices||this.previousPointsTextureSize!==n.pointsTextureSize){this.pointIndices&&!this.pointIndices.destroyed&&this.pointIndices.destroy();const i=dc(n.pointsTextureSize);this.pointIndices=t.createBuffer({data:i,usage:ai.VERTEX|ai.COPY_DST}),null==(e=this.calculateLevelsCommand)||e.setAttributes({pointIndices:this.pointIndices})}this.previousPointsTextureSize=n.pointsTextureSize,this.previousSpaceSize=n.adjustedSpaceSize}initPrograms(){const{device:e,store:t,data:n,points:i}=this;!n.pointsNumber||!i||!t.pointsTextureSize||(this.calculateLevelsUniformStore||(this.calculateLevelsUniformStore=new vo({calculateLevelsUniforms:{uniformTypes:{pointsTextureSize:"f32",levelTextureSize:"f32",cellSize:"f32"},defaultUniforms:{pointsTextureSize:t.pointsTextureSize,levelTextureSize:0,cellSize:0}}})),this.calculateLevelsCommand||(this.calculateLevelsCommand=new cc(e,{fs:"#version 300 es\nprecision highp float;\n\nin vec4 vColor;\nout vec4 fragColor;\n\nvoid main() {\n  fragColor = vColor;\n}",vs:"#version 300 es\nprecision highp float;\n\nuniform sampler2D positionsTexture;\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform calculateLevelsUniforms {\n  float pointsTextureSize;\n  float levelTextureSize;\n  float cellSize;\n} calculateLevels;\n\n#define pointsTextureSize calculateLevels.pointsTextureSize\n#define levelTextureSize calculateLevels.levelTextureSize\n#define cellSize calculateLevels.cellSize\n#else\nuniform float pointsTextureSize;\nuniform float levelTextureSize;\nuniform float cellSize;\n#endif\n\nin vec2 pointIndices;\n\nout vec4 vColor;\n\nvoid main() {\n  vec4 pointPosition = texture(positionsTexture, pointIndices / pointsTextureSize);\n  vColor = vec4(pointPosition.rg, 1.0, 0.0);\n\n  float n = floor(pointPosition.x / cellSize);\n  float m = floor(pointPosition.y / cellSize);\n  \n  vec2 levelPosition = 2.0 * (vec2(n, m) + 0.5) / levelTextureSize - 1.0;\n\n  gl_Position = vec4(levelPosition, 0.0, 1.0);\n  gl_PointSize = 1.0;\n}",topology:"point-list",vertexCount:n.pointsNumber,attributes:{...this.pointIndices&&{pointIndices:this.pointIndices}},bufferLayout:[{name:"pointIndices",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{calculateLevelsUniforms:this.calculateLevelsUniformStore.getManagedUniformBuffer(e,"calculateLevelsUniforms")},parameters:{blend:!0,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"add",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",depthWriteEnabled:!1,depthCompare:"always"}})),this.forceUniformStore||(this.forceUniformStore=new vo({forceUniforms:{uniformTypes:{level:"f32",levels:"f32",levelTextureSize:"f32",alpha:"f32",repulsion:"f32",spaceSize:"f32",theta:"f32"},defaultUniforms:{level:0,levels:this.levels,levelTextureSize:0,alpha:t.alpha,repulsion:this.config.simulationRepulsion??0,spaceSize:t.adjustedSpaceSize??0,theta:this.config.simulationRepulsionTheta??0}}})),this.forceVertexCoordBuffer||(this.forceVertexCoordBuffer=e.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.forceCommand||(this.forceCommand=new cc(e,{fs:"#version 300 es\nprecision highp float;\n\nuniform sampler2D positionsTexture;\nuniform sampler2D levelFbo;\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform forceUniforms {\n  float level;\n  float levels;\n  float levelTextureSize;\n  float repulsion;\n  float alpha;\n  float spaceSize;\n  float theta;\n} force;\n\n#define level force.level\n#define levels force.levels\n#define levelTextureSize force.levelTextureSize\n#define repulsion force.repulsion\n#define alpha force.alpha\n#define spaceSize force.spaceSize\n#define theta force.theta\n#else\nuniform float level;\nuniform float levels;\nuniform float levelTextureSize;\nuniform float repulsion;\nuniform float alpha;\nuniform float spaceSize;\nuniform float theta;\n#endif\n\nin vec2 textureCoords;\nout vec4 fragColor;\n\nconst float MAX_LEVELS_NUM = 14.0;\n\nvec2 calculateAdditionalVelocity (vec2 ij, vec2 pp) {\n  vec2 add = vec2(0.0);\n  vec4 centermass = texture(levelFbo, ij);\n  if (centermass.r > 0.0 && centermass.g > 0.0 && centermass.b > 0.0) {\n    vec2 centermassPosition = vec2(centermass.rg / centermass.b);\n    vec2 distVector = pp - centermassPosition;\n    float l = dot(distVector, distVector);\n    float dist = sqrt(l);\n    if (l > 0.0) {\n      float c = alpha * repulsion * centermass.b;\n\n      float distanceMin2 = 1.0;\n      if (l < distanceMin2) l = sqrt(distanceMin2 * l);\n      float addV = c / sqrt(l);\n      add = addV * normalize(distVector);\n    }\n  }\n  return add;\n}\n\nvoid main() {\n  vec4 pointPosition = texture(positionsTexture, textureCoords);\n  float x = pointPosition.x;\n  float y = pointPosition.y;\n\n  float left = 0.0;\n  float top = 0.0;\n  float right = spaceSize;\n  float bottom = spaceSize;\n\n  float n_left = 0.0;\n  float n_top = 0.0;\n  float n_right = 0.0;\n  float n_bottom = 0.0;\n\n  float cellSize = 0.0;\n\n  // Iterate over levels to adjust the boundaries based on the current level\n  for (float i = 0.0; i < MAX_LEVELS_NUM; i += 1.0) {\n    if (i <= level) {\n      left += cellSize * n_left;\n      top += cellSize * n_top;\n      right -= cellSize * n_right;\n      bottom -= cellSize * n_bottom;\n\n      cellSize = pow(2.0 , levels - i - 1.0);\n\n      float dist_left = x - left;\n      n_left = max(0.0, floor(dist_left / cellSize - theta));\n\n      float dist_top = y - top;\n      n_top = max(0.0, floor(dist_top / cellSize - theta));\n      \n      float dist_right = right - x;\n      n_right = max(0.0, floor(dist_right / cellSize - theta));\n\n      float dist_bottom = bottom - y;\n      n_bottom = max(0.0, floor(dist_bottom / cellSize - theta));\n\n    }\n  }\n\n  vec4 velocity = vec4(vec2(0.0), 1.0, 0.0);\n\n  // Calculate the additional velocity based on neighboring cells\n  for (float i = 0.0; i < 12.0; i += 1.0) {\n    for (float j = 0.0; j < 4.0; j += 1.0) {\n      float n = left + cellSize * j;\n      float m = top + cellSize * n_top + cellSize * i;\n\n      if (n < (left + n_left * cellSize) && m < bottom) {\n        velocity.xy += calculateAdditionalVelocity(vec2(n / cellSize, m / cellSize) / levelTextureSize, pointPosition.xy);\n      }\n\n      n = left + cellSize * i;\n      m = top + cellSize * j;\n\n      if (n < (right - n_right * cellSize) && m < (top + n_top * cellSize)) {\n        velocity.xy += calculateAdditionalVelocity(vec2(n / cellSize, m / cellSize) / levelTextureSize, pointPosition.xy);\n      }\n\n      n = right - n_right * cellSize + cellSize * j;\n      m = top + cellSize * i;\n\n      if (n < right && m < (bottom - n_bottom * cellSize)) {\n        velocity.xy += calculateAdditionalVelocity(vec2(n / cellSize, m / cellSize) / levelTextureSize, pointPosition.xy);\n      }\n\n      n = left + n_left * cellSize + cellSize * i;\n      m = bottom - n_bottom * cellSize + cellSize * j;\n\n      if (n < right && m < bottom) {\n        velocity.xy += calculateAdditionalVelocity(vec2(n / cellSize, m / cellSize) / levelTextureSize, pointPosition.xy);\n      }\n    }\n  }\n\n  fragColor = velocity;\n}",vs:fc,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.forceVertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{forceUniforms:this.forceUniformStore.getManagedUniformBuffer(e,"forceUniforms")},parameters:{blend:!0,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"add",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",depthWriteEnabled:!1,depthCompare:"always"}})),this.forceCenterUniformStore||(this.forceCenterUniformStore=new vo({forceCenterUniforms:{uniformTypes:{levelTextureSize:"f32",alpha:"f32",repulsion:"f32"},defaultUniforms:{levelTextureSize:0,alpha:t.alpha,repulsion:this.config.simulationRepulsion??0}}})),this.forceFromItsOwnCentermassCommand||(this.forceFromItsOwnCentermassCommand=new cc(e,{fs:"#version 300 es\nprecision highp float;\n\nuniform sampler2D positionsTexture;\nuniform sampler2D levelFbo;\nuniform sampler2D randomValues;\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform forceCenterUniforms {\n  float levelTextureSize;\n  float repulsion;\n  float alpha;\n} forceCenter;\n\n#define levelTextureSize forceCenter.levelTextureSize\n#define repulsion forceCenter.repulsion\n#define alpha forceCenter.alpha\n#else\nuniform float levelTextureSize;\nuniform float repulsion;\nuniform float alpha;\n#endif\n\nin vec2 textureCoords;\nout vec4 fragColor;\n\n// Calculate the additional velocity based on the center of mass\nvec2 calculateAdditionalVelocity (vec2 ij, vec2 pp) {\n  vec2 add = vec2(0.0);\n  vec4 centermass = texture(levelFbo, ij);\n  if (centermass.r > 0.0 && centermass.g > 0.0 && centermass.b > 0.0) {\n    vec2 centermassPosition = vec2(centermass.rg / centermass.b);\n    vec2 distVector = pp - centermassPosition;\n    float l = dot(distVector, distVector);\n    float dist = sqrt(l);\n    if (l > 0.0) {\n      float angle = atan(distVector.y, distVector.x);\n      float c = alpha * repulsion * centermass.b;\n\n      float distanceMin2 = 1.0;\n      if (l < distanceMin2) l = sqrt(distanceMin2 * l);\n      float addV = c / sqrt(l);\n      add = addV * vec2(cos(angle), sin(angle));\n    }\n  }\n  return add;\n}\n\nvoid main() {\n  vec4 pointPosition = texture(positionsTexture, textureCoords);\n  vec4 random = texture(randomValues, textureCoords);\n\n  vec4 velocity = vec4(0.0);\n\n  // Calculate additional velocity based on the point position\n  velocity.xy += calculateAdditionalVelocity(pointPosition.xy / levelTextureSize, pointPosition.xy);\n  // Apply random factor to the velocity\n  velocity.xy += velocity.xy * random.rg;\n\n  fragColor = velocity;\n}",vs:fc,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.forceVertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{forceCenterUniforms:this.forceCenterUniformStore.getManagedUniformBuffer(e,"forceCenterUniforms")},parameters:{blend:!0,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"add",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",depthWriteEnabled:!1,depthCompare:"always"}})))}run(){this.store.pointsTextureSize!==this.previousPointsTextureSize||this.store.adjustedSpaceSize!==this.previousSpaceSize||(this.drawLevels(),this.drawForces())}destroy(){var e,t,n,i,o,r;null==(e=this.calculateLevelsCommand)||e.destroy(),this.calculateLevelsCommand=void 0,null==(t=this.forceCommand)||t.destroy(),this.forceCommand=void 0,null==(n=this.forceFromItsOwnCentermassCommand)||n.destroy(),this.forceFromItsOwnCentermassCommand=void 0;for(const s of this.levelTargets.values())s.fbo&&!s.fbo.destroyed&&s.fbo.destroy();this.randomValuesTexture&&!this.randomValuesTexture.destroyed&&this.randomValuesTexture.destroy(),this.randomValuesTexture=void 0;for(const s of this.levelTargets.values())s.texture&&!s.texture.destroyed&&s.texture.destroy();this.levelTargets.clear(),null==(i=this.calculateLevelsUniformStore)||i.destroy(),this.calculateLevelsUniformStore=void 0,null==(o=this.forceUniformStore)||o.destroy(),this.forceUniformStore=void 0,null==(r=this.forceCenterUniformStore)||r.destroy(),this.forceCenterUniformStore=void 0,this.pointIndices&&!this.pointIndices.destroyed&&this.pointIndices.destroy(),this.pointIndices=void 0,this.forceVertexCoordBuffer&&!this.forceVertexCoordBuffer.destroyed&&this.forceVertexCoordBuffer.destroy(),this.forceVertexCoordBuffer=void 0}drawLevels(){const{device:e,store:t,data:n,points:i}=this;if(i&&this.calculateLevelsCommand&&this.calculateLevelsUniformStore&&i.previousPositionTexture&&!i.previousPositionTexture.destroyed&&n.pointsNumber&&this.pointIndices)for(let o=0;o<this.levels;o+=1){const r=this.levelTargets.get(o);if(!r||r.fbo.destroyed||r.texture.destroyed)continue;const s=Math.pow(2,o+1),a=(t.adjustedSpaceSize??0)/s;this.calculateLevelsUniformStore.setUniforms({calculateLevelsUniforms:{pointsTextureSize:t.pointsTextureSize??0,levelTextureSize:s,cellSize:a}}),this.calculateLevelsCommand.setVertexCount(n.pointsNumber),this.calculateLevelsCommand.setBindings({positionsTexture:i.previousPositionTexture});const l=e.beginRenderPass({framebuffer:r.fbo,clearColor:[0,0,0,0]});this.calculateLevelsCommand.draw(l),l.end()}}drawForces(){const{device:e,store:t,points:n}=this;if(!n||!this.forceCommand||!this.forceUniformStore||!this.forceFromItsOwnCentermassCommand||!this.forceCenterUniformStore||!n.previousPositionTexture||n.previousPositionTexture.destroyed||!this.randomValuesTexture||this.randomValuesTexture.destroyed||!n.velocityFbo||n.velocityFbo.destroyed)return;const i=e.beginRenderPass({framebuffer:n.velocityFbo,clearColor:[0,0,0,0]});for(let o=0;o<this.levels;o+=1){const e=this.levelTargets.get(o);if(!e||e.texture.destroyed)continue;const r=Math.pow(2,o+1);this.forceUniformStore.setUniforms({forceUniforms:{level:o,levels:this.levels,levelTextureSize:r,alpha:t.alpha,repulsion:this.config.simulationRepulsion??0,spaceSize:t.adjustedSpaceSize??0,theta:this.config.simulationRepulsionTheta??0}}),this.forceCommand.setBindings({positionsTexture:n.previousPositionTexture,levelFbo:e.texture}),this.forceCommand.draw(i),o===this.levels-1&&(this.forceCenterUniformStore.setUniforms({forceCenterUniforms:{levelTextureSize:r,alpha:t.alpha,repulsion:this.config.simulationRepulsion??0}}),this.forceFromItsOwnCentermassCommand.setBindings({positionsTexture:n.previousPositionTexture,randomValues:this.randomValuesTexture,levelFbo:e.texture}),this.forceFromItsOwnCentermassCommand.draw(i))}i.end()}}class Sc extends hc{initPrograms(){const{device:e,points:t}=this;t&&(this.vertexCoordBuffer||(this.vertexCoordBuffer=e.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.uniformStore||(this.uniformStore=new vo({forceMouseUniforms:{uniformTypes:{repulsion:"f32",mousePos:"vec2<f32>"}}})),this.runCommand||(this.runCommand=new cc(e,{fs:"#version 300 es\nprecision highp float;\n\nuniform sampler2D positionsTexture;\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform forceMouseUniforms {\n  float repulsion;\n  vec2 mousePos;\n} forceMouse;\n\n#define repulsion forceMouse.repulsion\n#define mousePos forceMouse.mousePos\n#else\nuniform float repulsion;\nuniform vec2 mousePos;\n#endif\n\nin vec2 textureCoords;\nout vec4 fragColor;\n\nvoid main() {\n  vec4 pointPosition = texture(positionsTexture, textureCoords);\n  vec4 velocity = vec4(0.0);\n  vec2 mouse = mousePos;\n  // Move particles away from the mouse position using a repulsive force\n  vec2 distVector = mouse - pointPosition.rg;\n  float dist = sqrt(dot(distVector, distVector));\n  dist = max(dist, 10.0);\n  float angle = atan(distVector.y, distVector.x);\n  float addV = 100.0 * repulsion / (dist * dist);\n  velocity.rg -= addV * vec2(cos(angle), sin(angle));\n\n  fragColor = velocity;\n}",vs:fc,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.vertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{forceMouseUniforms:this.uniformStore.getManagedUniformBuffer(e,"forceMouseUniforms")},parameters:{depthWriteEnabled:!1,depthCompare:"always"}})))}run(){const{device:e,points:t,store:n}=this;if(!t||!this.runCommand||!this.uniformStore||!t.previousPositionTexture||t.previousPositionTexture.destroyed||!t.velocityFbo||t.velocityFbo.destroyed)return;this.uniformStore.setUniforms({forceMouseUniforms:{repulsion:this.config.simulationRepulsionFromMouse??0,mousePos:yc(n.mousePosition,[0,0])}}),this.runCommand.setBindings({positionsTexture:t.previousPositionTexture});const i=e.beginRenderPass({framebuffer:t.velocityFbo,clearColor:[0,0,0,0]});this.runCommand.draw(i),i.end()}destroy(){var e,t;null==(e=this.runCommand)||e.destroy(),this.runCommand=void 0,null==(t=this.uniformStore)||t.destroy(),this.uniformStore=void 0,this.vertexCoordBuffer&&!this.vertexCoordBuffer.destroyed&&this.vertexCoordBuffer.destroy(),this.vertexCoordBuffer=void 0}}class Ec extends hc{create(){var e,t;const{device:n,store:i,data:o}=this,{pointsTextureSize:r}=i;if(void 0===o.pointsNumber||!o.pointClusters&&!o.clusterPositions)return;this.clusterCount=(o.pointClusters??[]).reduce((e,t)=>void 0===t||t<0?e:Math.max(e,t),0)+1,this.clustersTextureSize=Math.ceil(Math.sqrt(this.clusterCount));const s=this.previousPointsTextureSize!==r||this.previousClustersTextureSize!==this.clustersTextureSize||this.previousClusterCount!==this.clusterCount,a=r*r*4,l=this.clustersTextureSize*this.clustersTextureSize*4,c=new Float32Array(a),u=new Float32Array(l).fill(-1),h=new Float32Array(a).fill(1);if(o.clusterPositions)for(let d=0;d<this.clusterCount;++d)u[4*d+0]=o.clusterPositions[2*d+0]??-1,u[4*d+1]=o.clusterPositions[2*d+1]??-1;for(let d=0;d<o.pointsNumber;++d){const t=null==(e=o.pointClusters)?void 0:e[d];void 0===t?(c[4*d+0]=-1,c[4*d+1]=-1):(c[4*d+0]=t%this.clustersTextureSize,c[4*d+1]=Math.floor(t/this.clustersTextureSize)),o.clusterStrength&&(h[4*d+0]=o.clusterStrength[d]??1)}if(!this.clusterTexture||s?(this.clusterTexture&&!this.clusterTexture.destroyed&&this.clusterTexture.destroy(),this.clusterTexture=n.createTexture({width:r,height:r,format:"rgba32float",usage:qi.SAMPLE|qi.RENDER|qi.COPY_DST}),this.clusterTexture.copyImageData({data:c,bytesPerRow:pc("rgba32float",r),mipLevel:0,x:0,y:0})):this.clusterTexture.copyImageData({data:c,bytesPerRow:pc("rgba32float",r),mipLevel:0,x:0,y:0}),!this.clusterPositionsTexture||s?(this.clusterPositionsTexture&&!this.clusterPositionsTexture.destroyed&&this.clusterPositionsTexture.destroy(),this.clusterPositionsTexture=n.createTexture({width:this.clustersTextureSize,height:this.clustersTextureSize,format:"rgba32float",usage:qi.SAMPLE|qi.RENDER|qi.COPY_DST}),this.clusterPositionsTexture.copyImageData({data:u,bytesPerRow:pc("rgba32float",this.clustersTextureSize),mipLevel:0,x:0,y:0})):this.clusterPositionsTexture.copyImageData({data:u,bytesPerRow:pc("rgba32float",this.clustersTextureSize),mipLevel:0,x:0,y:0}),!this.clusterForceCoefficientTexture||s?(this.clusterForceCoefficientTexture&&!this.clusterForceCoefficientTexture.destroyed&&this.clusterForceCoefficientTexture.destroy(),this.clusterForceCoefficientTexture=n.createTexture({width:r,height:r,format:"rgba32float",usage:qi.SAMPLE|qi.RENDER|qi.COPY_DST}),this.clusterForceCoefficientTexture.copyImageData({data:h,bytesPerRow:pc("rgba32float",r),mipLevel:0,x:0,y:0})):this.clusterForceCoefficientTexture.copyImageData({data:h,bytesPerRow:pc("rgba32float",r),mipLevel:0,x:0,y:0}),this.centermassTexture&&this.previousClustersTextureSize===this.clustersTextureSize?this.centermassTexture.copyImageData({data:new Float32Array(l).fill(0),bytesPerRow:pc("rgba32float",this.clustersTextureSize),mipLevel:0,x:0,y:0}):(this.centermassFbo&&!this.centermassFbo.destroyed&&this.centermassFbo.destroy(),this.centermassTexture&&!this.centermassTexture.destroyed&&this.centermassTexture.destroy(),this.centermassTexture=n.createTexture({width:this.clustersTextureSize,height:this.clustersTextureSize,format:"rgba32float",usage:qi.SAMPLE|qi.RENDER|qi.COPY_DST}),this.centermassTexture.copyImageData({data:new Float32Array(l).fill(0),bytesPerRow:pc("rgba32float",this.clustersTextureSize),mipLevel:0,x:0,y:0}),this.centermassFbo=n.createFramebuffer({width:this.clustersTextureSize,height:this.clustersTextureSize,colorAttachments:[this.centermassTexture]})),!this.pointIndices||this.previousPointsTextureSize!==r){this.pointIndices&&!this.pointIndices.destroyed&&this.pointIndices.destroy();const e=dc(i.pointsTextureSize);this.pointIndices=n.createBuffer({data:e,usage:ai.VERTEX|ai.COPY_DST}),null==(t=this.calculateCentermassCommand)||t.setAttributes({pointIndices:this.pointIndices})}this.previousPointsTextureSize=r,this.previousClustersTextureSize=this.clustersTextureSize,this.previousClusterCount=this.clusterCount}initPrograms(){const{device:e,store:t,data:n}=this;void 0===n.pointsNumber||!n.pointClusters&&!n.clusterPositions||(this.calculateCentermassUniformStore||(this.calculateCentermassUniformStore=new vo({calculateCentermassUniforms:{uniformTypes:{pointsTextureSize:"f32",clustersTextureSize:"f32"},defaultUniforms:{pointsTextureSize:t.pointsTextureSize,clustersTextureSize:this.clustersTextureSize??0}}})),this.calculateCentermassCommand||(this.calculateCentermassCommand=new cc(e,{fs:"#version 300 es\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nin vec4 rgba;\n\nout vec4 fragColor;\n\nvoid main() {\n  fragColor = rgba;\n}",vs:"#version 300 es\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D positionsTexture;\nuniform sampler2D clusterTexture;\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform calculateCentermassUniforms {\n  float pointsTextureSize;\n  float clustersTextureSize;\n} calculateCentermass;\n\n#define pointsTextureSize calculateCentermass.pointsTextureSize\n#define clustersTextureSize calculateCentermass.clustersTextureSize\n#else\nuniform float pointsTextureSize;\nuniform float clustersTextureSize;\n#endif\n\nin vec2 pointIndices;\n\nout vec4 rgba;\n\nvoid main() {\n  vec4 pointPosition = texture(positionsTexture, pointIndices / pointsTextureSize);\n  rgba = vec4(pointPosition.xy, 1.0, 0.0);\n\n  vec4 pointClusterIndices = texture(clusterTexture, pointIndices / pointsTextureSize);\n  vec2 xy = vec2(0.0);\n  if (pointClusterIndices.x >= 0.0 && pointClusterIndices.y >= 0.0) {\n    xy = 2.0 * (pointClusterIndices.xy + 0.5) / clustersTextureSize - 1.0;\n  }\n  \n  gl_Position = vec4(xy, 0.0, 1.0);\n  gl_PointSize = 1.0;\n}\n",topology:"point-list",vertexCount:n.pointsNumber??0,attributes:{...this.pointIndices&&{pointIndices:this.pointIndices}},bufferLayout:[{name:"pointIndices",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{calculateCentermassUniforms:this.calculateCentermassUniformStore.getManagedUniformBuffer(e,"calculateCentermassUniforms")},parameters:{blend:!0,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"add",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",depthWriteEnabled:!1,depthCompare:"always"}})),this.applyForcesUniformStore||(this.applyForcesUniformStore=new vo({applyForcesUniforms:{uniformTypes:{alpha:"f32",clustersTextureSize:"f32",clusterCoefficient:"f32"},defaultUniforms:{alpha:t.alpha,clustersTextureSize:this.clustersTextureSize??0,clusterCoefficient:this.config.simulationCluster??0}}})),this.applyForcesVertexCoordBuffer||(this.applyForcesVertexCoordBuffer=e.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.applyForcesCommand||(this.applyForcesCommand=new cc(e,{fs:"#version 300 es\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D positionsTexture;\nuniform sampler2D centermassTexture;\nuniform sampler2D clusterTexture;\nuniform sampler2D clusterPositionsTexture;\nuniform sampler2D clusterForceCoefficient;\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform applyForcesUniforms {\n  float alpha;\n  float clustersTextureSize;\n  float clusterCoefficient;\n} applyForces;\n\n#define alpha applyForces.alpha\n#define clustersTextureSize applyForces.clustersTextureSize\n#define clusterCoefficient applyForces.clusterCoefficient\n#else\nuniform float alpha;\nuniform float clustersTextureSize;\nuniform float clusterCoefficient;\n#endif\n\nin vec2 textureCoords;\n\nout vec4 fragColor;\n\n\nvoid main() {\n  vec4 pointPosition = texture(positionsTexture, textureCoords);\n  vec4 velocity = vec4(0.0);\n  vec4 pointClusterIndices = texture(clusterTexture, textureCoords);\n  // no cluster, so no forces\n  if (pointClusterIndices.x >= 0.0 && pointClusterIndices.y >= 0.0) {\n    // positioning points to custom cluster position or either to the center of mass\n    vec2 clusterPositions = texture(clusterPositionsTexture, pointClusterIndices.xy / clustersTextureSize).xy;\n    if (clusterPositions.x < 0.0 || clusterPositions.y < 0.0) {\n      vec4 centermassValues = texture(centermassTexture, pointClusterIndices.xy / clustersTextureSize);\n      clusterPositions = centermassValues.xy / centermassValues.b;\n    }\n    vec4 clusterCustomCoeff = texture(clusterForceCoefficient, textureCoords);\n    vec2 distVector = clusterPositions.xy - pointPosition.xy;\n    float dist = length(distVector);\n    if (dist > 0.0) {\n      float addV = alpha * dist * clusterCoefficient * clusterCustomCoeff.r;\n      velocity.rg += addV * normalize(distVector);\n    }\n  }\n\n  fragColor = velocity;\n}",vs:fc,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.applyForcesVertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{applyForcesUniforms:this.applyForcesUniformStore.getManagedUniformBuffer(e,"applyForcesUniforms")}})))}calculateCentermass(){const{device:e,points:t}=this;if(!t||!this.calculateCentermassCommand||!this.calculateCentermassUniformStore||!this.pointIndices||!this.centermassFbo||this.centermassFbo.destroyed||!this.clusterTexture||this.clusterTexture.destroyed||!t.previousPositionTexture||t.previousPositionTexture.destroyed)return;this.calculateCentermassCommand.setVertexCount(this.data.pointsNumber??0),this.calculateCentermassUniformStore.setUniforms({calculateCentermassUniforms:{pointsTextureSize:this.store.pointsTextureSize,clustersTextureSize:this.clustersTextureSize??0}}),this.calculateCentermassCommand.setBindings({clusterTexture:this.clusterTexture,positionsTexture:t.previousPositionTexture});const n=e.beginRenderPass({framebuffer:this.centermassFbo,clearColor:[0,0,0,0]});this.calculateCentermassCommand.draw(n),n.end()}run(){var e;if(!this.data.pointClusters&&!this.data.clusterPositions||(this.calculateCentermass(),!this.applyForcesCommand||!this.applyForcesUniformStore)||!this.clusterTexture||this.clusterTexture.destroyed||!this.centermassTexture||this.centermassTexture.destroyed||!this.clusterPositionsTexture||this.clusterPositionsTexture.destroyed||!this.clusterForceCoefficientTexture||this.clusterForceCoefficientTexture.destroyed||null==(e=this.points)||!e.previousPositionTexture||this.points.previousPositionTexture.destroyed||!this.points.velocityFbo||this.points.velocityFbo.destroyed)return;this.applyForcesUniformStore.setUniforms({applyForcesUniforms:{alpha:this.store.alpha,clustersTextureSize:this.clustersTextureSize??0,clusterCoefficient:this.config.simulationCluster??0}}),this.applyForcesCommand.setBindings({clusterTexture:this.clusterTexture,centermassTexture:this.centermassTexture,clusterPositionsTexture:this.clusterPositionsTexture,clusterForceCoefficient:this.clusterForceCoefficientTexture,positionsTexture:this.points.previousPositionTexture});const t=this.device.beginRenderPass({framebuffer:this.points.velocityFbo,clearColor:[0,0,0,0]});this.applyForcesCommand.draw(t),t.end()}destroy(){var e,t,n,i;null==(e=this.calculateCentermassCommand)||e.destroy(),this.calculateCentermassCommand=void 0,null==(t=this.applyForcesCommand)||t.destroy(),this.applyForcesCommand=void 0,this.centermassFbo&&!this.centermassFbo.destroyed&&this.centermassFbo.destroy(),this.centermassFbo=void 0,this.clusterTexture&&!this.clusterTexture.destroyed&&this.clusterTexture.destroy(),this.clusterTexture=void 0,this.clusterPositionsTexture&&!this.clusterPositionsTexture.destroyed&&this.clusterPositionsTexture.destroy(),this.clusterPositionsTexture=void 0,this.clusterForceCoefficientTexture&&!this.clusterForceCoefficientTexture.destroyed&&this.clusterForceCoefficientTexture.destroy(),this.clusterForceCoefficientTexture=void 0,this.centermassTexture&&!this.centermassTexture.destroyed&&this.centermassTexture.destroy(),this.centermassTexture=void 0,null==(n=this.calculateCentermassUniformStore)||n.destroy(),this.calculateCentermassUniformStore=void 0,null==(i=this.applyForcesUniformStore)||i.destroy(),this.applyForcesUniformStore=void 0,this.pointIndices&&!this.pointIndices.destroyed&&this.pointIndices.destroy(),this.pointIndices=void 0,this.applyForcesVertexCoordBuffer&&!this.applyForcesVertexCoordBuffer.destroyed&&this.applyForcesVertexCoordBuffer.destroy(),this.applyForcesVertexCoordBuffer=void 0}}function Tc(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Cc(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if("function"==typeof t){var n=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var i=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,i.get?i:{enumerable:!0,get:function(){return e[t]}})}),n}var Ic,Ac={exports:{}},kc=(Ic||(Ic=1,Ac.exports=class{constructor(e,t={}){this.css="#gl-bench {\n  position:absolute;\n  left:0;\n  top:0;\n  z-index:1000;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  user-select: none;\n}\n\n#gl-bench div {\n  position: relative;\n  display: block;\n  margin: 4px;\n  padding: 0 7px 0 10px;\n  background: #6c6;\n  border-radius: 15px;\n  cursor: pointer;\n  opacity: 0.9;\n}\n\n#gl-bench svg {\n  height: 60px;\n  margin: 0 -1px;\n}\n\n#gl-bench text {\n  font-size: 12px;\n  font-family: Helvetica,Arial,sans-serif;\n  font-weight: 700;\n  dominant-baseline: middle;\n  text-anchor: middle;\n}\n\n#gl-bench .gl-mem {\n  font-size: 9px;\n}\n\n#gl-bench line {\n  stroke-width: 5;\n  stroke: #112211;\n  stroke-linecap: round;\n}\n\n#gl-bench polyline {\n  fill: none;\n  stroke: #112211;\n  stroke-linecap: round;\n  stroke-linejoin: round;\n  stroke-width: 3.5;\n}\n\n#gl-bench rect {\n  fill: #448844;\n}\n\n#gl-bench .opacity {\n  stroke: #448844;\n}\n",this.svg='<div class="gl-box">\n  <svg viewBox="0 0 55 60">\n    <text x="27" y="56" class="gl-fps">00 FPS</text>\n    <text x="28" y="8" class="gl-mem"></text>\n    <rect x="0" y="14" rx="4" ry="4" width="55" height="32"></rect>\n    <polyline class="gl-chart"></polyline>\n  </svg>\n  <svg viewBox="0 0 14 60" class="gl-cpu-svg">\n    <line x1="7" y1="38" x2="7" y2="11" class="opacity"/>\n    <line x1="7" y1="38" x2="7" y2="11" class="gl-cpu" stroke-dasharray="0 27"/>\n    <path d="M5.35 43c-.464 0-.812.377-.812.812v1.16c-.783.1972-1.421.812-1.595 1.624h-1.16c-.435 0-.812.348-.812.812s.348.812.812.812h1.102v1.653H1.812c-.464 0-.812.377-.812.812 0 .464.377.812.812.812h1.131c.1943.783.812 1.392 1.595 1.595v1.131c0 .464.377.812.812.812.464 0 .812-.377.812-.812V53.15h1.653v1.073c0 .464.377.812.812.812.464 0 .812-.377.812-.812v-1.131c.783-.1943 1.392-.812 1.595-1.595h1.131c.464 0 .812-.377.812-.812 0-.464-.377-.812-.812-.812h-1.073V48.22h1.102c.435 0 .812-.348.812-.812s-.348-.812-.812-.812h-1.16c-.1885-.783-.812-1.421-1.595-1.624v-1.131c0-.464-.377-.812-.812-.812-.464 0-.812.377-.812.812v1.073H6.162v-1.073c0-.464-.377-.812-.812-.812zm.58 3.48h2.088c.754 0 1.363.609 1.363 1.363v2.088c0 .754-.609 1.363-1.363 1.363H5.93c-.754 0-1.363-.609-1.363-1.363v-2.088c0-.754.609-1.363 1.363-1.363z"/>\n  </svg>\n  <svg viewBox="0 0 14 60" class="gl-gpu-svg">\n    <line x1="7" y1="38" x2="7" y2="11" class="opacity"/>\n    <line x1="7" y1="38" x2="7" y2="11" class="gl-gpu" stroke-dasharray="0 27"/>\n    <path d="M1.94775 43.3772a.736.736 0 10-.00416 1.472c.58535.00231.56465.1288.6348.3197.07015.18975.04933.43585.04933.43585l-.00653.05405v8.671a.736.736 0 101.472 0v-1.4145c.253.09522.52785.1495.81765.1495h5.267c1.2535 0 2.254-.9752 2.254-2.185v-3.105c0-1.2075-1.00625-2.185-2.254-2.185h-5.267c-.28865 0-.5635.05405-.8165.1495.01806-.16445.04209-.598-.1357-1.0787-.22425-.6072-.9499-1.2765-2.0125-1.2765zm2.9095 3.6455c.42435 0 .7659.36225.7659.8119v2.9785c0 .44965-.34155.8119-.7659.8119s-.7659-.36225-.7659-.8119v-2.9785c0-.44965.34155-.8119.7659-.8119zm4.117 0a2.3 2.3 0 012.3 2.3 2.3 2.3 0 01-2.3 2.3 2.3 2.3 0 01-2.3-2.3 2.3 2.3 0 012.3-2.3z"/>\n  </svg>\n</div>',this.paramLogger=()=>{},this.chartLogger=()=>{},this.chartLen=20,this.chartHz=20,this.names=[],this.cpuAccums=[],this.gpuAccums=[],this.activeAccums=[],this.chart=new Array(this.chartLen),this.now=()=>performance&&performance.now?performance.now():Date.now(),this.updateUI=()=>{[].forEach.call(this.nodes["gl-gpu-svg"],e=>{e.style.display=this.trackGPU?"inline":"none"})},Object.assign(this,t),this.detected=0,this.finished=[],this.isFramebuffer=0,this.frameId=0;let n,i,o=0,r=e=>{++o<20?n=requestAnimationFrame(r):(this.detected=Math.ceil(1e3*o/(e-i)/70),cancelAnimationFrame(n)),i||(i=e)};if(requestAnimationFrame(r),e){const t=async(t,n)=>Promise.resolve(setTimeout(()=>{e.getError();const i=this.now()-t;n.forEach((e,t)=>{e&&(this.gpuAccums[t]+=i)})},0)),n=(e,n,i)=>function(){const o=n.now();e.apply(i,arguments),n.trackGPU&&n.finished.push(t(o,n.activeAccums.slice(0)))};["drawArrays","drawElements","drawArraysInstanced","drawBuffers","drawElementsInstanced","drawRangeElements"].forEach(t=>{e[t]&&(e[t]=n(e[t],this,e))}),e.getExtension=((t,i)=>function(){let o=t.apply(e,arguments);return o&&["drawElementsInstancedANGLE","drawBuffersWEBGL"].forEach(e=>{o[e]&&(o[e]=n(o[e],i,o))}),o})(e.getExtension,this)}if(!this.withoutUI){this.dom||(this.dom=document.body);let e=document.createElement("div");e.id="gl-bench",this.dom.appendChild(e),this.dom.insertAdjacentHTML("afterbegin",'<style id="gl-bench-style">'+this.css+"</style>"),this.dom=e,this.dom.addEventListener("click",()=>{this.trackGPU=!this.trackGPU,this.updateUI()}),this.paramLogger=((e,t,n)=>{const i=["gl-cpu","gl-gpu","gl-mem","gl-fps","gl-gpu-svg","gl-chart"],o=Object.assign({},i);return i.forEach(e=>o[e]=t.getElementsByClassName(e)),this.nodes=o,(t,i,r,s,a,l,c)=>{o["gl-cpu"][t].style.strokeDasharray=(.27*i).toFixed(0)+" 100",o["gl-gpu"][t].style.strokeDasharray=(.27*r).toFixed(0)+" 100",o["gl-mem"][t].innerHTML=n[t]?n[t]:s?"mem: "+s.toFixed(0)+"mb":"",o["gl-fps"][t].innerHTML=a.toFixed(0)+" FPS",e(n[t],i,r,s,a,l,c)}})(this.paramLogger,this.dom,this.names),this.chartLogger=(e=>{let t={"gl-chart":this.dom.getElementsByClassName("gl-chart")};return(n,i,o)=>{let r="",s=i.length;for(let e=0;e<s;e++){let t=(o+e+1)%s;null!=i[t]&&(r=r+" "+(55*e/(s-1)).toFixed(1)+","+(45-22*i[t]/60/this.detected).toFixed(1))}t["gl-chart"][n].setAttribute("points",r),e(this.names[n],i,o)}})(this.chartLogger)}}addUI(e){-1==this.names.indexOf(e)&&(this.names.push(e),this.dom&&(this.dom.insertAdjacentHTML("beforeend",this.svg),this.updateUI()),this.cpuAccums.push(0),this.gpuAccums.push(0),this.activeAccums.push(!1))}nextFrame(e){this.frameId++;const t=e||this.now();if(this.frameId<=1)this.paramFrame=this.frameId,this.paramTime=t;else{let e=t-this.paramTime;if(e>=1e3){const n=this.frameId-this.paramFrame,i=n/e*1e3;for(let t=0;t<this.names.length;t++){const o=this.cpuAccums[t]/e*100,r=this.gpuAccums[t]/e*100,s=performance&&performance.memory?performance.memory.usedJSHeapSize/(1<<20):0;this.paramLogger(t,o,r,s,i,e,n),this.cpuAccums[t]=0,Promise.all(this.finished).then(()=>{this.gpuAccums[t]=0,this.finished=[]})}this.paramFrame=this.frameId,this.paramTime=t}}if(this.detected&&this.chartFrame){let e=t-this.chartTime,n=this.chartHz*e/1e3;for(;--n>0&&this.detected;){const n=(this.frameId-this.chartFrame)/e*1e3;this.chart[this.circularId%this.chartLen]=n;for(let e=0;e<this.names.length;e++)this.chartLogger(e,this.chart,this.circularId);this.circularId++,this.chartFrame=this.frameId,this.chartTime=t}}else this.chartFrame=this.frameId,this.chartTime=t,this.circularId=0}begin(e){this.updateAccums(e)}end(e){this.updateAccums(e)}updateAccums(e){let t=this.names.indexOf(e);-1==t&&(t=this.names.length,this.addUI(e));const n=this.now(),i=n-this.t0;for(let o=0;o<t+1;o++)this.activeAccums[o]&&(this.cpuAccums[o]+=i);this.activeAccums[t]=!this.activeAccums[t],this.t0=n}}),Ac.exports);const Lc=Tc(kc);class Rc{constructor(e){this.destroy();const t=e.getContext("webgl")||e.getContext("experimental-webgl");this.bench=new Lc(t,{css:"\n  #gl-bench {\n    position:absolute;\n    right:0;\n    top:0;\n    z-index:1000;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  #gl-bench div {\n    position: relative;\n    display: block;\n    margin: 4px;\n    padding: 0 7px 0 10px;\n    background: #5f69de;\n    border-radius: 15px;\n    cursor: pointer;\n    opacity: 0.9;\n  }\n  #gl-bench svg {\n    height: 60px;\n    margin: 0 -1px;\n  }\n  #gl-bench text {\n    font-size: 12px;\n    font-family: Helvetica,Arial,sans-serif;\n    font-weight: 700;\n    dominant-baseline: middle;\n    text-anchor: middle;\n  }\n  #gl-bench .gl-mem {\n    font-size: 9px;\n  }\n  #gl-bench line {\n    stroke-width: 5;\n    stroke: #112211;\n    stroke-linecap: round;\n  }\n  #gl-bench polyline {\n    fill: none;\n    stroke: #112211;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n    stroke-width: 3.5;\n  }\n  #gl-bench rect {\n    fill: #8288e4;\n  }\n  #gl-bench .opacity {\n    stroke: #8288e4;\n  }\n"})}begin(){var e;null==(e=this.bench)||e.begin("frame")}end(e){var t,n;null==(t=this.bench)||t.end("frame"),null==(n=this.bench)||n.nextFrame(e)}destroy(){this.bench=void 0,Se("#gl-bench").remove()}}class Pc{constructor(e){this._config=e}get pointsNumber(){return this.pointPositions&&this.pointPositions.length/2}get linksNumber(){return this.links&&this.links.length/2}updatePoints(){this.pointPositions=this.inputPointPositions}updatePointColor(){if(void 0===this.pointsNumber)return void(this.pointColors=void 0);const e=Ur(this._config.pointDefaultColor??this._config.pointColor);if(void 0===this.inputPointColors||this.inputPointColors.length/4!==this.pointsNumber){this.pointColors=new Float32Array(4*this.pointsNumber);for(let t=0;t<this.pointColors.length/4;t++)this.pointColors[4*t]=e[0],this.pointColors[4*t+1]=e[1],this.pointColors[4*t+2]=e[2],this.pointColors[4*t+3]=e[3]}else{this.pointColors=this.inputPointColors;for(let t=0;t<this.pointColors.length/4;t++)Vr(this.pointColors[4*t])||(this.pointColors[4*t]=e[0]),Vr(this.pointColors[4*t+1])||(this.pointColors[4*t+1]=e[1]),Vr(this.pointColors[4*t+2])||(this.pointColors[4*t+2]=e[2]),Vr(this.pointColors[4*t+3])||(this.pointColors[4*t+3]=e[3])}}updatePointSize(){if(void 0===this.pointsNumber)return void(this.pointSizes=void 0);const e=this._config.pointDefaultSize??this._config.pointSize;if(void 0===this.inputPointSizes||this.inputPointSizes.length!==this.pointsNumber)this.pointSizes=new Float32Array(this.pointsNumber).fill(e);else{this.pointSizes=this.inputPointSizes;for(let t=0;t<this.pointSizes.length;t++)Vr(this.pointSizes[t])||(this.pointSizes[t]=e)}}updatePointShape(){if(void 0!==this.pointsNumber)if(void 0===this.inputPointShapes||this.inputPointShapes.length!==this.pointsNumber)this.pointShapes=new Float32Array(this.pointsNumber).fill(0);else{this.pointShapes=new Float32Array(this.inputPointShapes);const e=this.pointShapes;for(let t=0;t<e.length;t++){const n=e[t];(null==n||!Vr(n)||n<0||n>8)&&(e[t]=0)}}else this.pointShapes=void 0}updatePointImageIndices(){if(void 0!==this.pointsNumber)if(void 0===this.inputPointImageIndices||this.inputPointImageIndices.length!==this.pointsNumber)this.pointImageIndices=new Float32Array(this.pointsNumber).fill(-1);else{const e=new Float32Array(this.inputPointImageIndices);for(let t=0;t<e.length;t++){const n=e[t],i=void 0===n?NaN:n;!Number.isFinite(i)||i<0?e[t]=-1:e[t]=Math.trunc(i)}this.pointImageIndices=e}else this.pointImageIndices=void 0}updatePointImageSizes(){var e;if(void 0===this.pointsNumber)return void(this.pointImageSizes=void 0);const t=this._config.pointDefaultSize??this._config.pointSize;if(void 0===this.inputPointImageSizes||this.inputPointImageSizes.length!==this.pointsNumber)this.pointImageSizes=this.pointSizes?new Float32Array(this.pointSizes):new Float32Array(this.pointsNumber).fill(t);else{this.pointImageSizes=new Float32Array(this.inputPointImageSizes);for(let n=0;n<this.pointImageSizes.length;n++)Vr(this.pointImageSizes[n])||(this.pointImageSizes[n]=(null==(e=this.pointSizes)?void 0:e[n])??t)}}updateLinks(){this.links=this.inputLinks}updateLinkColor(){if(void 0===this.linksNumber)return void(this.linkColors=void 0);const e=Ur(this._config.linkDefaultColor??this._config.linkColor);if(void 0===this.inputLinkColors||this.inputLinkColors.length/4!==this.linksNumber){this.linkColors=new Float32Array(4*this.linksNumber);for(let t=0;t<this.linkColors.length/4;t++)this.linkColors[4*t]=e[0],this.linkColors[4*t+1]=e[1],this.linkColors[4*t+2]=e[2],this.linkColors[4*t+3]=e[3]}else{this.linkColors=this.inputLinkColors;for(let t=0;t<this.linkColors.length/4;t++)Vr(this.linkColors[4*t])||(this.linkColors[4*t]=e[0]),Vr(this.linkColors[4*t+1])||(this.linkColors[4*t+1]=e[1]),Vr(this.linkColors[4*t+2])||(this.linkColors[4*t+2]=e[2]),Vr(this.linkColors[4*t+3])||(this.linkColors[4*t+3]=e[3])}}updateLinkWidth(){if(void 0===this.linksNumber)return void(this.linkWidths=void 0);const e=this._config.linkDefaultWidth??this._config.linkWidth;if(void 0===this.inputLinkWidths||this.inputLinkWidths.length!==this.linksNumber)this.linkWidths=new Float32Array(this.linksNumber).fill(e);else{this.linkWidths=this.inputLinkWidths;for(let t=0;t<this.linkWidths.length;t++)Vr(this.linkWidths[t])||(this.linkWidths[t]=e)}}updateArrows(){if(void 0===this.linksNumber)return void(this.linkArrows=void 0);const e=this._config.linkDefaultArrows??this._config.linkArrows;void 0===this.linkArrowsBoolean||this.linkArrowsBoolean.length!==this.linksNumber?this.linkArrows=new Array(this.linksNumber).fill(+e):this.linkArrows=this.linkArrowsBoolean.map(e=>+e)}updateLinkStrength(){void 0===this.linksNumber&&(this.linkStrength=void 0),void 0===this.inputLinkStrength||this.inputLinkStrength.length!==this.linksNumber?this.linkStrength=void 0:this.linkStrength=this.inputLinkStrength}updateClusters(){if(void 0===this.pointsNumber)return this.pointClusters=void 0,void(this.clusterPositions=void 0);void 0===this.inputPointClusters||this.inputPointClusters.length!==this.pointsNumber?this.pointClusters=void 0:this.pointClusters=this.inputPointClusters,void 0===this.inputClusterPositions?this.clusterPositions=void 0:this.clusterPositions=this.inputClusterPositions,void 0===this.inputClusterStrength||this.inputClusterStrength.length!==this.pointsNumber?this.clusterStrength=void 0:this.clusterStrength=this.inputClusterStrength}update(){this.updatePoints(),this.updatePointColor(),this.updatePointSize(),this.updatePointShape(),this.updatePointImageIndices(),this.updatePointImageSizes(),this.updateLinks(),this.updateLinkColor(),this.updateLinkWidth(),this.updateArrows(),this.updateLinkStrength(),this.updateClusters(),this._createAdjacencyLists(),this._calculateDegrees()}getAdjacentIndices(e){var t,n,i,o;return[...(null==(n=null==(t=this.sourceIndexToTargetIndices)?void 0:t[e])?void 0:n.map(e=>e[0]))||[],...(null==(o=null==(i=this.targetIndexToSourceIndices)?void 0:i[e])?void 0:o.map(e=>e[0]))||[]]}_createAdjacencyLists(){var e,t;if(void 0===this.linksNumber||void 0===this.links)return this.sourceIndexToTargetIndices=void 0,void(this.targetIndexToSourceIndices=void 0);this.sourceIndexToTargetIndices=new Array(this.pointsNumber).fill(void 0),this.targetIndexToSourceIndices=new Array(this.pointsNumber).fill(void 0);for(let n=0;n<this.linksNumber;n++){const i=this.links[2*n],o=this.links[2*n+1];void 0!==i&&void 0!==o&&(void 0===this.sourceIndexToTargetIndices[i]&&(this.sourceIndexToTargetIndices[i]=[]),null==(e=this.sourceIndexToTargetIndices[i])||e.push([o,n]),void 0===this.targetIndexToSourceIndices[o]&&(this.targetIndexToSourceIndices[o]=[]),null==(t=this.targetIndexToSourceIndices[o])||t.push([i,n]))}}_calculateDegrees(){var e,t,n,i;if(void 0===this.pointsNumber)return this.degree=void 0,this.inDegree=void 0,void(this.outDegree=void 0);this.degree=new Array(this.pointsNumber).fill(0),this.inDegree=new Array(this.pointsNumber).fill(0),this.outDegree=new Array(this.pointsNumber).fill(0);for(let o=0;o<this.pointsNumber;o++)this.inDegree[o]=(null==(t=null==(e=this.targetIndexToSourceIndices)?void 0:e[o])?void 0:t.length)??0,this.outDegree[o]=(null==(i=null==(n=this.sourceIndexToTargetIndices)?void 0:n[o])?void 0:i.length)??0,this.degree[o]=(this.inDegree[o]??0)+(this.outDegree[o]??0)}}function Dc(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Mc(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Nc(e){let t,n,i;function o(e,i,o=0,r=e.length){if(o<r){if(0!==t(i,i))return r;do{const t=o+r>>>1;n(e[t],i)<0?o=t+1:r=t}while(o<r)}return o}return 2!==e.length?(t=Dc,n=(t,n)=>Dc(e(t),n),i=(t,n)=>e(t)-n):(t=e===Dc||e===Mc?e:Oc,n=e,i=e),{left:o,center:function(e,t,n=0,r=e.length){const s=o(e,t,n,r-1);return s>n&&i(e[s-1],t)>-i(e[s],t)?s-1:s},right:function(e,i,o=0,r=e.length){if(o<r){if(0!==t(i,i))return r;do{const t=o+r>>>1;n(e[t],i)<=0?o=t+1:r=t}while(o<r)}return o}}}function Oc(){return 0}const Bc=Nc(Dc).right;function Fc(e,t){let n,i;for(const o of e)null!=o&&(void 0===n?o>=o&&(n=i=o):(n>o&&(n=o),i<o&&(i=o)));return[n,i]}Nc(function(e){return null===e?NaN:+e}).center;var zc=Math.sqrt(50),Uc=Math.sqrt(10),$c=Math.sqrt(2);function Vc(e,t,n){var i=(t-e)/Math.max(0,n),o=Math.floor(Math.log(i)/Math.LN10),r=i/Math.pow(10,o);return o>=0?(r>=zc?10:r>=Uc?5:r>=$c?2:1)*Math.pow(10,o):-Math.pow(10,-o)/(r>=zc?10:r>=Uc?5:r>=$c?2:1)}function Hc(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function Gc(e){return+e}var Wc=[0,1];function jc(e){return e}function Yc(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(e){return function(){return e}}(isNaN(t)?NaN:.5)}function qc(e,t,n){var i=e[0],o=e[1],r=t[0],s=t[1];return o<i?(i=Yc(o,i),r=n(s,r)):(i=Yc(i,o),r=n(r,s)),function(e){return r(i(e))}}function Xc(e,t,n){var i=Math.min(e.length,t.length)-1,o=new Array(i),r=new Array(i),s=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<i;)o[s]=Yc(e[s],e[s+1]),r[s]=n(t[s],t[s+1]);return function(t){var n=Bc(e,t,1,i)-1;return r[n](o[n](t))}}function Kc(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Zc(){var e,t,n,i,o,r,s=Wc,a=Wc,l=jt,c=jc;function u(){var e=Math.min(s.length,a.length);return c!==jc&&(c=function(e,t){var n;return e>t&&(n=e,e=t,t=n),function(n){return Math.max(e,Math.min(t,n))}}(s[0],s[e-1])),i=e>2?Xc:qc,o=r=null,h}function h(t){return null==t||isNaN(t=+t)?n:(o||(o=i(s.map(e),a,l)))(e(c(t)))}return h.invert=function(n){return c(t((r||(r=i(a,s.map(e),$t)))(n)))},h.domain=function(e){return arguments.length?(s=Array.from(e,Gc),u()):s.slice()},h.range=function(e){return arguments.length?(a=Array.from(e),u()):a.slice()},h.rangeRound=function(e){return a=Array.from(e),l=Yt,u()},h.clamp=function(e){return arguments.length?(c=!!e||jc,u()):c!==jc},h.interpolate=function(e){return arguments.length?(l=e,u()):l},h.unknown=function(e){return arguments.length?(n=e,h):n},function(n,i){return e=n,t=i,u()}}function Qc(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function Jc(e){return(e=Qc(Math.abs(e)))?e[1]:NaN}var eu,tu=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function nu(e){if(!(t=tu.exec(e)))throw new Error("invalid format: "+e);var t;return new iu({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function iu(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function ou(e,t){var n=Qc(e,t);if(!n)return e+"";var i=n[0],o=n[1];return o<0?"0."+new Array(-o).join("0")+i:i.length>o+1?i.slice(0,o+1)+"."+i.slice(o+1):i+new Array(o-i.length+2).join("0")}nu.prototype=iu.prototype,iu.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const ru={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>ou(100*e,t),r:ou,s:function(e,t){var n=Qc(e,t);if(!n)return e+"";var i=n[0],o=n[1],r=o-(eu=3*Math.max(-8,Math.min(8,Math.floor(o/3))))+1,s=i.length;return r===s?i:r>s?i+new Array(r-s+1).join("0"):r>0?i.slice(0,r)+"."+i.slice(r):"0."+new Array(1-r).join("0")+Qc(e,Math.max(0,t+r-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function su(e){return e}var au,lu,cu,uu=Array.prototype.map,hu=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function du(e){var t=e.domain;return e.ticks=function(e){var n=t();return function(e,t,n){var i,o,r,s,a=-1;if(n=+n,(e=+e)===(t=+t)&&n>0)return[e];if((i=t<e)&&(o=e,e=t,t=o),0===(s=Vc(e,t,n))||!isFinite(s))return[];if(s>0){let n=Math.round(e/s),i=Math.round(t/s);for(n*s<e&&++n,i*s>t&&--i,r=new Array(o=i-n+1);++a<o;)r[a]=(n+a)*s}else{s=-s;let n=Math.round(e*s),i=Math.round(t*s);for(n/s<e&&++n,i/s>t&&--i,r=new Array(o=i-n+1);++a<o;)r[a]=(n+a)/s}return i&&r.reverse(),r}(n[0],n[n.length-1],e??10)},e.tickFormat=function(e,n){var i=t();return function(e,t,n,i){var o,r=function(e,t,n){var i=Math.abs(t-e)/Math.max(0,n),o=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),r=i/o;return r>=zc?o*=10:r>=Uc?o*=5:r>=$c&&(o*=2),t<e?-o:o}(e,t,n);switch((i=nu(i??",f")).type){case"s":var s=Math.max(Math.abs(e),Math.abs(t));return null==i.precision&&!isNaN(o=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Jc(t)/3)))-Jc(Math.abs(e)))}(r,s))&&(i.precision=o),cu(i,s);case"":case"e":case"g":case"p":case"r":null==i.precision&&!isNaN(o=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Jc(t)-Jc(e))+1}(r,Math.max(Math.abs(e),Math.abs(t))))&&(i.precision=o-("e"===i.type));break;case"f":case"%":null==i.precision&&!isNaN(o=function(e){return Math.max(0,-Jc(Math.abs(e)))}(r))&&(i.precision=o-2*("%"===i.type))}return lu(i)}(i[0],i[i.length-1],e??10,n)},e.nice=function(n){null==n&&(n=10);var i,o,r=t(),s=0,a=r.length-1,l=r[s],c=r[a],u=10;for(c<l&&(o=l,l=c,c=o,o=s,s=a,a=o);u-- >0;){if((o=Vc(l,c,n))===i)return r[s]=l,r[a]=c,t(r);if(o>0)l=Math.floor(l/o)*o,c=Math.ceil(c/o)*o;else{if(!(o<0))break;l=Math.ceil(l*o)/o,c=Math.floor(c*o)/o}i=o}return e},e}function pu(){var e=Zc()(jc,jc);return e.copy=function(){return Kc(e,pu())},Hc.apply(e,arguments),du(e)}function fu(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function mu(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function _u(e){return e<0?-e*e:e*e}function gu(){var e=function(e){var t=e(jc,jc),n=1;return t.exponent=function(t){return arguments.length?1===(n=+t)?e(jc,jc):.5===n?e(mu,_u):e(fu(n),fu(1/n)):n},du(t)}(Zc());return e.copy=function(){return Kc(e,gu()).exponent(e.exponent())},Hc.apply(e,arguments),e}au=function(e){var t=void 0===e.grouping||void 0===e.thousands?su:function(e,t){return function(n,i){for(var o=n.length,r=[],s=0,a=e[0],l=0;o>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),r.push(n.substring(o-=a,o+a)),!((l+=a+1)>i));)a=e[s=(s+1)%e.length];return r.reverse().join(t)}}(uu.call(e.grouping,Number),e.thousands+""),n=void 0===e.currency?"":e.currency[0]+"",i=void 0===e.currency?"":e.currency[1]+"",o=void 0===e.decimal?".":e.decimal+"",r=void 0===e.numerals?su:function(e){return function(t){return t.replace(/[0-9]/g,function(t){return e[+t]})}}(uu.call(e.numerals,String)),s=void 0===e.percent?"%":e.percent+"",a=void 0===e.minus?"−":e.minus+"",l=void 0===e.nan?"NaN":e.nan+"";function c(e){var c=(e=nu(e)).fill,u=e.align,h=e.sign,d=e.symbol,p=e.zero,f=e.width,m=e.comma,_=e.precision,g=e.trim,y=e.type;"n"===y?(m=!0,y="g"):ru[y]||(void 0===_&&(_=12),g=!0,y="g"),(p||"0"===c&&"="===u)&&(p=!0,c="0",u="=");var b="$"===d?n:"#"===d&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",v="$"===d?i:/[%p]/.test(y)?s:"",x=ru[y],w=/[defgprs%]/.test(y);function S(e){var n,i,s,d=b,S=v;if("c"===y)S=x(e)+S,e="";else{var E=(e=+e)<0||1/e<0;if(e=isNaN(e)?l:x(Math.abs(e),_),g&&(e=function(e){e:for(var t,n=e.length,i=1,o=-1;i<n;++i)switch(e[i]){case".":o=t=i;break;case"0":0===o&&(o=i),t=i;break;default:if(!+e[i])break e;o>0&&(o=0)}return o>0?e.slice(0,o)+e.slice(t+1):e}(e)),E&&0==+e&&"+"!==h&&(E=!1),d=(E?"("===h?h:a:"-"===h||"("===h?"":h)+d,S=("s"===y?hu[8+eu/3]:"")+S+(E&&"("===h?")":""),w)for(n=-1,i=e.length;++n<i;)if(48>(s=e.charCodeAt(n))||s>57){S=(46===s?o+e.slice(n+1):e.slice(n))+S,e=e.slice(0,n);break}}m&&!p&&(e=t(e,1/0));var T=d.length+e.length+S.length,C=T<f?new Array(f-T+1).join(c):"";switch(m&&p&&(e=t(C+e,C.length?f-S.length:1/0),C=""),u){case"<":e=d+e+S+C;break;case"=":e=d+C+e+S;break;case"^":e=C.slice(0,T=C.length>>1)+d+e+S+C.slice(T);break;default:e=C+d+e+S}return r(e)}return _=void 0===_?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,_)):Math.max(0,Math.min(20,_)),S.toString=function(){return e+""},S}return{format:c,formatPrefix:function(e,t){var n=c(((e=nu(e)).type="f",e)),i=3*Math.max(-8,Math.min(8,Math.floor(Jc(t)/3))),o=Math.pow(10,-i),r=hu[8+i/3];return function(e){return n(o*e)+r}}}}({thousands:",",grouping:[3],currency:["$",""]}),lu=au.format,cu=au.formatPrefix;class yu extends hc{initPrograms(){var e;const{device:t,config:n,store:i}=this;this.updateLinkIndexFbo(),this.hoveredLineIndexTexture||(this.hoveredLineIndexTexture=t.createTexture({width:1,height:1,format:"rgba32float",usage:qi.SAMPLE|qi.RENDER|qi.COPY_DST,data:new Float32Array(4).fill(0)})),this.hoveredLineIndexFbo||(this.hoveredLineIndexFbo=t.createFramebuffer({width:1,height:1,colorAttachments:[this.hoveredLineIndexTexture]})),this.curveLineGeometry||this.updateCurveLineGeometry();const o=this.data.linksNumber??0;this.pointABuffer||(this.pointABuffer=t.createBuffer({data:new Float32Array(2*o),usage:ai.VERTEX|ai.COPY_DST})),this.pointBBuffer||(this.pointBBuffer=t.createBuffer({data:new Float32Array(2*o),usage:ai.VERTEX|ai.COPY_DST})),this.colorBuffer||(this.colorBuffer=t.createBuffer({data:new Float32Array(4*o),usage:ai.VERTEX|ai.COPY_DST})),this.widthBuffer||(this.widthBuffer=t.createBuffer({data:new Float32Array(o),usage:ai.VERTEX|ai.COPY_DST})),this.arrowBuffer||(this.arrowBuffer=t.createBuffer({data:new Float32Array(o),usage:ai.VERTEX|ai.COPY_DST})),this.linkIndexBuffer||(this.linkIndexBuffer=t.createBuffer({data:new Float32Array(o),usage:ai.VERTEX|ai.COPY_DST})),this.drawLineUniformStore||(this.drawLineUniformStore=new vo({drawLineUniforms:{uniformTypes:{transformationMatrix:"mat4x4<f32>",pointsTextureSize:"f32",widthScale:"f32",linkArrowsSizeScale:"f32",spaceSize:"f32",screenSize:"vec2<f32>",linkVisibilityDistanceRange:"vec2<f32>",linkVisibilityMinTransparency:"f32",linkOpacity:"f32",greyoutOpacity:"f32",curvedWeight:"f32",curvedLinkControlPointDistance:"f32",curvedLinkSegments:"f32",scaleLinksOnZoom:"f32",maxPointSize:"f32",renderMode:"f32",hoveredLinkIndex:"f32",hoveredLinkColor:"vec4<f32>",hoveredLinkWidthIncrease:"f32"},defaultUniforms:{transformationMatrix:i.transformationMatrix4x4,pointsTextureSize:i.pointsTextureSize,widthScale:n.linkWidthScale??1,linkArrowsSizeScale:n.linkArrowsSizeScale??1,spaceSize:i.adjustedSpaceSize??0,screenSize:yc(i.screenSize,[0,0]),linkVisibilityDistanceRange:yc(n.linkVisibilityDistanceRange,[0,0]),linkVisibilityMinTransparency:n.linkVisibilityMinTransparency??0,linkOpacity:n.linkOpacity??1,greyoutOpacity:n.linkGreyoutOpacity??1,curvedWeight:n.curvedLinkWeight??0,curvedLinkControlPointDistance:n.curvedLinkControlPointDistance??0,curvedLinkSegments:n.curvedLinks?n.curvedLinkSegments??zo.curvedLinkSegments:1,scaleLinksOnZoom:n.scaleLinksOnZoom??1?1:0,maxPointSize:i.maxPointSize??100,renderMode:0,hoveredLinkIndex:i.hoveredLinkIndex??-1,hoveredLinkColor:bc(i.hoveredLinkColor,[-1,-1,-1,-1]),hoveredLinkWidthIncrease:n.hoveredLinkWidthIncrease??0}},drawLineFragmentUniforms:{uniformTypes:{renderMode:"f32"},defaultUniforms:{renderMode:0}}})),this.drawCurveCommand||(this.drawCurveCommand=new cc(t,{vs:"#version 300 es\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nin vec2 position, pointA, pointB;\nin vec4 color;\nin float width;\nin float arrow;\nin float linkIndices;\n\nuniform sampler2D positionsTexture;\nuniform sampler2D pointGreyoutStatus;\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform drawLineUniforms {\n  mat4 transformationMatrix;\n  float pointsTextureSize;\n  float widthScale;\n  float linkArrowsSizeScale;\n  float spaceSize;\n  vec2 screenSize;\n  vec2 linkVisibilityDistanceRange;\n  float linkVisibilityMinTransparency;\n  float linkOpacity;\n  float greyoutOpacity;\n  float curvedWeight;\n  float curvedLinkControlPointDistance;\n  float curvedLinkSegments;\n  float scaleLinksOnZoom;\n  float maxPointSize;\n  float renderMode;\n  float hoveredLinkIndex;\n  vec4 hoveredLinkColor;\n  float hoveredLinkWidthIncrease;\n} drawLine;\n\n#define transformationMatrix drawLine.transformationMatrix\n#define pointsTextureSize drawLine.pointsTextureSize\n#define widthScale drawLine.widthScale\n#define linkArrowsSizeScale drawLine.linkArrowsSizeScale\n#define spaceSize drawLine.spaceSize\n#define screenSize drawLine.screenSize\n#define linkVisibilityDistanceRange drawLine.linkVisibilityDistanceRange\n#define linkVisibilityMinTransparency drawLine.linkVisibilityMinTransparency\n#define linkOpacity drawLine.linkOpacity\n#define greyoutOpacity drawLine.greyoutOpacity\n#define curvedWeight drawLine.curvedWeight\n#define curvedLinkControlPointDistance drawLine.curvedLinkControlPointDistance\n#define curvedLinkSegments drawLine.curvedLinkSegments\n#define scaleLinksOnZoom drawLine.scaleLinksOnZoom\n#define maxPointSize drawLine.maxPointSize\n#define renderMode drawLine.renderMode\n#define hoveredLinkIndex drawLine.hoveredLinkIndex\n#define hoveredLinkColor drawLine.hoveredLinkColor\n#define hoveredLinkWidthIncrease drawLine.hoveredLinkWidthIncrease\n#else\nuniform mat3 transformationMatrix;\nuniform float pointsTextureSize;\nuniform float widthScale;\nuniform float linkArrowsSizeScale;\nuniform float spaceSize;\nuniform vec2 screenSize;\nuniform vec2 linkVisibilityDistanceRange;\nuniform float linkVisibilityMinTransparency;\nuniform float linkOpacity;\nuniform float greyoutOpacity;\nuniform float curvedWeight;\nuniform float curvedLinkControlPointDistance;\nuniform float curvedLinkSegments;\nuniform bool scaleLinksOnZoom;\nuniform float maxPointSize;\n// renderMode: 0.0 = normal rendering, 1.0 = index buffer rendering for picking\nuniform float renderMode;\nuniform float hoveredLinkIndex;\nuniform vec4 hoveredLinkColor;\nuniform float hoveredLinkWidthIncrease;\n#endif\n\nout vec4 rgbaColor;\nout vec2 pos;\nout float arrowLength;\nout float useArrow;\nout float smoothing;\nout float arrowWidthFactor;\nout float linkIndex;\n\nfloat map(float value, float min1, float max1, float min2, float max2) {\n  return min2 + (value - min1) * (max2 - min2) / (max1 - min1);\n}\n\nvec2 conicParametricCurve(vec2 A, vec2 B, vec2 ControlPoint, float t, float w) {\n  vec2 divident = (1.0 - t) * (1.0 - t) * A + 2.0 * (1.0 - t) * t * w * ControlPoint + t * t * B;\n  float divisor = (1.0 - t) * (1.0 - t) + 2.0 * (1.0 - t) * t * w + t * t;\n  return divident / divisor;\n}\n\nfloat calculateLinkWidth(float width) {\n  float linkWidth;\n  if (scaleLinksOnZoom > 0.0) {\n    // Use original width if links should scale with zoom\n    linkWidth = width;\n  } else {\n    // Adjust width based on zoom level to maintain visual size\n    linkWidth = width / transformationMatrix[0][0];\n    // Apply a non-linear scaling to avoid extreme widths\n    linkWidth *= min(5.0, max(1.0, transformationMatrix[0][0] * 0.01));\n  }\n  // Limit link width based on whether it has an arrow\n  if (useArrow > 0.5) {\n    return min(linkWidth, (maxPointSize * 2.0) / transformationMatrix[0][0]);\n  } else {\n    return min(linkWidth, maxPointSize / transformationMatrix[0][0]);\n  }\n}\n\nfloat calculateArrowWidth(float arrowWidth) {\n  if (scaleLinksOnZoom > 0.0) {\n    return arrowWidth;\n  } else {\n    // Apply the same scaling logic as calculateLinkWidth to maintain proportionality\n    arrowWidth = arrowWidth / transformationMatrix[0][0];\n    // Apply the same non-linear scaling to avoid extreme widths\n    arrowWidth *= min(5.0, max(1.0, transformationMatrix[0][0] * 0.01));\n    return arrowWidth;\n  }\n}\n\nvoid main() {\n  pos = position;\n  linkIndex = linkIndices;\n\n  vec2 pointTexturePosA = (pointA + 0.5) / pointsTextureSize;\n  vec2 pointTexturePosB = (pointB + 0.5) / pointsTextureSize;\n  \n  vec4 greyoutStatusA = texture(pointGreyoutStatus, pointTexturePosA);\n  vec4 greyoutStatusB = texture(pointGreyoutStatus, pointTexturePosB);\n  \n  vec4 pointPositionA = texture(positionsTexture, pointTexturePosA);\n  vec4 pointPositionB = texture(positionsTexture, pointTexturePosB);\n  vec2 a = pointPositionA.xy;\n  vec2 b = pointPositionB.xy;\n  \n  // Calculate direction vector and its perpendicular\n  vec2 xBasis = b - a;\n  vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));\n\n  // Calculate link distance and control point for curved link\n  float linkDist = length(xBasis);\n  float h = curvedLinkControlPointDistance;\n  vec2 controlPoint = (a + b) / 2.0 + yBasis * linkDist * h;\n\n  // Convert link distance to screen pixels\n  float linkDistPx = linkDist * transformationMatrix[0][0];\n  \n  // Calculate line width using the width scale\n  float linkWidth = width * widthScale;\n  float k = 2.0;\n  // Arrow width is proportionally larger than the line width\n  float arrowWidth = linkWidth * k;\n  arrowWidth *= linkArrowsSizeScale;\n\n  // Ensure arrow width difference is non-negative to prevent unwanted changes to link width\n  float arrowWidthDifference = max(0.0, arrowWidth - linkWidth);\n\n  // Calculate arrow width in pixels\n  float arrowWidthPx = calculateArrowWidth(arrowWidth);\n\n  // Calculate arrow length proportional to its width\n  // 0.866 is approximately sqrt(3)/2 - related to equilateral triangle geometry\n  // Cap the length to avoid overly long arrows on short links\n  arrowLength = min(0.3, (0.866 * arrowWidthPx * 2.0) / linkDist);\n\n  useArrow = arrow;\n  if (useArrow > 0.5) {\n    linkWidth += arrowWidthDifference;\n  }\n\n  arrowWidthFactor = arrowWidthDifference / linkWidth;\n\n  // Calculate final link width in pixels with smoothing\n  float linkWidthPx = calculateLinkWidth(linkWidth);\n    \n  if (renderMode > 0.0) {\n    // Add 5 pixels padding for better hover detection\n    linkWidthPx += 5.0 / transformationMatrix[0][0];\n  } else {\n      // Add pixel increase if this is the hovered link\n    if (hoveredLinkIndex == linkIndex) {\n      linkWidthPx += hoveredLinkWidthIncrease / transformationMatrix[0][0];\n    }\n  }\n  float smoothingPx = 0.5 / transformationMatrix[0][0];\n  smoothing = smoothingPx / linkWidthPx;\n  linkWidthPx += smoothingPx;\n\n\n\n  // Calculate final color with opacity based on link distance\n  vec3 rgbColor = color.rgb;\n  // Adjust opacity based on link distance\n  float opacity = color.a * linkOpacity * max(linkVisibilityMinTransparency, map(linkDistPx, linkVisibilityDistanceRange.g, linkVisibilityDistanceRange.r, 0.0, 1.0));\n\n  // Apply greyed out opacity if either endpoint is greyed out\n  if (greyoutStatusA.r > 0.0 || greyoutStatusB.r > 0.0) {\n    opacity *= greyoutOpacity;\n  }\n\n  // Pass final color to fragment shader\n  rgbaColor = vec4(rgbColor, opacity);\n\n  // Apply hover color if this is the hovered link and hover color is defined\n  if (hoveredLinkIndex == linkIndex && hoveredLinkColor.a > -0.5) {\n    // Keep existing RGB values but multiply opacity with hover color opacity\n    rgbaColor.rgb = hoveredLinkColor.rgb;\n    rgbaColor.a *= hoveredLinkColor.a;\n  }\n\n  // Calculate position on the curved path\n  float t = position.x;\n  float w = curvedWeight;\n  \n  float tPrev = t - 1.0 / curvedLinkSegments;\n  float tNext = t + 1.0 / curvedLinkSegments;\n  \n  vec2 pointCurr = conicParametricCurve(a, b, controlPoint, t, w);\n  \n  vec2 pointPrev = conicParametricCurve(a, b, controlPoint, max(0.0, tPrev), w);\n  vec2 pointNext = conicParametricCurve(a, b, controlPoint, min(tNext, 1.0), w);\n  \n  vec2 xBasisCurved = pointNext - pointPrev;\n  vec2 yBasisCurved = normalize(vec2(-xBasisCurved.y, xBasisCurved.x));\n  \n  pointCurr += yBasisCurved * linkWidthPx * position.y;\n  \n  // Transform to clip space coordinates\n  vec2 p = 2.0 * pointCurr / spaceSize - 1.0;\n  p *= spaceSize / screenSize;\n  \n  #ifdef USE_UNIFORM_BUFFERS\n  mat3 transformMat3 = mat3(transformationMatrix);\n  vec3 final = transformMat3 * vec3(p, 1);\n  #else\n  vec3 final = transformationMatrix * vec3(p, 1);\n  #endif\n  \n  gl_Position = vec4(final.rg, 0, 1);\n}",fs:"#version 300 es\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nin vec4 rgbaColor;\nin vec2 pos;\nin float arrowLength;\nin float useArrow;\nin float smoothing;\nin float arrowWidthFactor;\nin float linkIndex;\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform drawLineFragmentUniforms {\n  float renderMode;\n} drawLineFrag;\n\n#define renderMode drawLineFrag.renderMode\n#else\n// renderMode: 0.0 = normal rendering, 1.0 = index buffer rendering for picking\nuniform float renderMode;\n#endif\n\nout vec4 fragColor;\n\nfloat map(float value, float min1, float max1, float min2, float max2) {\n  return min2 + (value - min1) * (max2 - min2) / (max1 - min1);\n}\n\nvoid main() {\n  float opacity = 1.0;\n  vec3 color = rgbaColor.rgb;\n\n  if (useArrow > 0.5) {\n    float end_arrow = 0.5 + arrowLength / 2.0;\n    float start_arrow = end_arrow - arrowLength;\n    float arrowWidthDelta = arrowWidthFactor / 2.0;\n    float linkOpacity = rgbaColor.a * smoothstep(0.5 - arrowWidthDelta, 0.5 - arrowWidthDelta - smoothing / 2.0, abs(pos.y));\n    float arrowOpacity = 1.0;\n    if (pos.x > start_arrow && pos.x < start_arrow + arrowLength) {\n      float xmapped = map(pos.x, start_arrow, end_arrow, 0.0, 1.0);\n      arrowOpacity = rgbaColor.a * smoothstep(xmapped - smoothing, xmapped, map(abs(pos.y), 0.5, 0.0, 0.0, 1.0));\n      if (linkOpacity != arrowOpacity) {\n        linkOpacity = max(linkOpacity, arrowOpacity);\n      }\n    }\n    opacity = linkOpacity;\n  } else opacity = rgbaColor.a * smoothstep(0.5, 0.5 - smoothing, abs(pos.y));\n  \n  if (renderMode > 0.0) {\n    if (opacity > 0.0) {\n      fragColor = vec4(linkIndex, 0.0, 0.0, 1.0);\n    } else {\n      fragColor = vec4(-1.0, 0.0, 0.0, 0.0);\n    }\n  } else fragColor = vec4(color, opacity);\n\n}",topology:"triangle-strip",vertexCount:(null==(e=this.curveLineGeometry)?void 0:e.length)??0,attributes:{...this.curveLineBuffer&&{position:this.curveLineBuffer},...this.pointABuffer&&{pointA:this.pointABuffer},...this.pointBBuffer&&{pointB:this.pointBBuffer},...this.colorBuffer&&{color:this.colorBuffer},...this.widthBuffer&&{width:this.widthBuffer},...this.arrowBuffer&&{arrow:this.arrowBuffer},...this.linkIndexBuffer&&{linkIndices:this.linkIndexBuffer}},bufferLayout:[{name:"position",format:"float32x2"},{name:"pointA",format:"float32x2",stepMode:"instance"},{name:"pointB",format:"float32x2",stepMode:"instance"},{name:"color",format:"float32x4",stepMode:"instance"},{name:"width",format:"float32",stepMode:"instance"},{name:"arrow",format:"float32",stepMode:"instance"},{name:"linkIndices",format:"float32",stepMode:"instance"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{drawLineUniforms:this.drawLineUniformStore.getManagedUniformBuffer(t,"drawLineUniforms"),drawLineFragmentUniforms:this.drawLineUniformStore.getManagedUniformBuffer(t,"drawLineFragmentUniforms")},parameters:{cullMode:"back",blend:!0,blendColorOperation:"add",blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaOperation:"add",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",depthWriteEnabled:!1,depthCompare:"always"}})),this.quadBuffer||(this.quadBuffer=t.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1]),usage:ai.VERTEX|ai.COPY_DST})),this.hoveredLineIndexUniformStore||(this.hoveredLineIndexUniformStore=new vo({hoveredLineIndexUniforms:{uniformTypes:{mousePosition:"vec2<f32>",screenSize:"vec2<f32>"},defaultUniforms:{mousePosition:yc(i.screenMousePosition,[0,0]),screenSize:yc(i.screenSize,[0,0])}}})),this.hoveredLineIndexCommand||(this.hoveredLineIndexCommand=new cc(t,{vs:"#version 300 es\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nin vec2 vertexCoord;\n\nvoid main() {\n  gl_Position = vec4(vertexCoord, 0.0, 1.0);\n} ",fs:"#version 300 es\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D linkIndexTexture;\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform hoveredLineIndexUniforms {\n  vec2 mousePosition;\n  vec2 screenSize;\n} hoveredLine;\n\n#define mousePosition hoveredLine.mousePosition\n#define screenSize hoveredLine.screenSize\n#else\nuniform vec2 mousePosition;\nuniform vec2 screenSize;\n#endif\n\nout vec4 fragColor;\n\nvoid main() {\n  // Convert mouse position to texture coordinates\n  vec2 texCoord = mousePosition / screenSize;\n  \n  // Read the link index from the linkIndexFbo texture at mouse position\n  vec4 linkIndexData = texture(linkIndexTexture, texCoord);\n  \n  // Extract the link index (stored in the red channel)\n  float linkIndex = linkIndexData.r;\n  \n  // Check if there's a valid link at this position (alpha > 0)\n  if (linkIndexData.a > 0.0 && linkIndex >= 0.0) {\n    // Output the link index\n    fragColor = vec4(linkIndex, 0.0, 0.0, 1.0);\n  } else {\n    // No link at this position, output -1 to indicate no hover\n    fragColor = vec4(-1.0, 0.0, 0.0, 0.0);\n  }\n} ",topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.quadBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{hoveredLineIndexUniforms:this.hoveredLineIndexUniformStore.getManagedUniformBuffer(t,"hoveredLineIndexUniforms")}}))}draw(e){const{config:t,points:n,store:i}=this;n&&(!n.currentPositionTexture||n.currentPositionTexture.destroyed||!n.greyoutStatusTexture||n.greyoutStatusTexture.destroyed||((!this.pointABuffer||!this.pointBBuffer)&&this.updatePointsBuffer(),this.colorBuffer||this.updateColor(),this.widthBuffer||this.updateWidth(),this.arrowBuffer||this.updateArrow(),this.curveLineGeometry||this.updateCurveLineGeometry(),this.drawCurveCommand&&this.drawLineUniformStore&&(this.drawLineUniformStore.setUniforms({drawLineUniforms:{transformationMatrix:i.transformationMatrix4x4,pointsTextureSize:i.pointsTextureSize,widthScale:t.linkWidthScale??1,linkArrowsSizeScale:t.linkArrowsSizeScale??1,spaceSize:i.adjustedSpaceSize??0,screenSize:yc(i.screenSize,[0,0]),linkVisibilityDistanceRange:yc(t.linkVisibilityDistanceRange,[0,0]),linkVisibilityMinTransparency:t.linkVisibilityMinTransparency??0,linkOpacity:t.linkOpacity??1,greyoutOpacity:t.linkGreyoutOpacity??1,curvedWeight:t.curvedLinkWeight??0,curvedLinkControlPointDistance:t.curvedLinkControlPointDistance??0,curvedLinkSegments:t.curvedLinks?t.curvedLinkSegments??zo.curvedLinkSegments:1,scaleLinksOnZoom:t.scaleLinksOnZoom??1?1:0,maxPointSize:i.maxPointSize??100,renderMode:0,hoveredLinkIndex:i.hoveredLinkIndex??-1,hoveredLinkColor:bc(i.hoveredLinkColor,[-1,-1,-1,-1]),hoveredLinkWidthIncrease:t.hoveredLinkWidthIncrease??0},drawLineFragmentUniforms:{renderMode:0}}),this.drawCurveCommand.setBindings({positionsTexture:n.currentPositionTexture,pointGreyoutStatus:n.greyoutStatusTexture}),this.drawCurveCommand.setInstanceCount(this.data.linksNumber??0),this.drawCurveCommand.draw(e))))}updateLinkIndexFbo(){var e,t;const{device:n,store:i}=this;if(!this.store.isLinkHoveringEnabled)return;const o=i.screenSize??[0,0],r=o[0],s=o[1];if(!r||!s)return;const a=(null==(e=this.previousScreenSize)?void 0:e[0])!==r||(null==(t=this.previousScreenSize)?void 0:t[1])!==s;(!this.linkIndexTexture||a)&&(this.linkIndexFbo&&!this.linkIndexFbo.destroyed&&this.linkIndexFbo.destroy(),this.linkIndexTexture&&!this.linkIndexTexture.destroyed&&this.linkIndexTexture.destroy(),this.linkIndexTexture=n.createTexture({width:r,height:s,format:"rgba32float",usage:qi.SAMPLE|qi.RENDER|qi.COPY_DST}),this.linkIndexTexture.copyImageData({data:new Float32Array(r*s*4).fill(0),bytesPerRow:pc("rgba32float",r),mipLevel:0,x:0,y:0}),this.linkIndexFbo=n.createFramebuffer({width:r,height:s,colorAttachments:[this.linkIndexTexture]}),this.previousScreenSize=[r,s])}updatePointsBuffer(){var e;const{device:t,data:n,store:i}=this;if(void 0===n.linksNumber||void 0===n.links||!i.pointsTextureSize)return;const o=new Float32Array(2*n.linksNumber),r=new Float32Array(2*n.linksNumber);for(let l=0;l<n.linksNumber;l++){const e=n.links[2*l],t=n.links[2*l+1],s=e%i.pointsTextureSize,a=Math.floor(e/i.pointsTextureSize),c=t%i.pointsTextureSize,u=Math.floor(t/i.pointsTextureSize);o[2*l]=s,o[2*l+1]=a,r[2*l]=c,r[2*l+1]=u}const s=((null==(e=this.pointABuffer)?void 0:e.byteLength)??0)/(2*Float32Array.BYTES_PER_ELEMENT);this.pointABuffer&&s===n.linksNumber?this.pointABuffer.write(o):(this.pointABuffer&&!this.pointABuffer.destroyed&&this.pointABuffer.destroy(),this.pointABuffer=t.createBuffer({data:o,usage:ai.VERTEX|ai.COPY_DST})),this.pointBBuffer&&s===n.linksNumber?this.pointBBuffer.write(r):(this.pointBBuffer&&!this.pointBBuffer.destroyed&&this.pointBBuffer.destroy(),this.pointBBuffer=t.createBuffer({data:r,usage:ai.VERTEX|ai.COPY_DST}));const a=new Float32Array(n.linksNumber);for(let l=0;l<n.linksNumber;l++)a[l]=l;this.linkIndexBuffer&&s===n.linksNumber?this.linkIndexBuffer.write(a):(this.linkIndexBuffer&&!this.linkIndexBuffer.destroyed&&this.linkIndexBuffer.destroy(),this.linkIndexBuffer=t.createBuffer({data:a,usage:ai.VERTEX|ai.COPY_DST})),this.drawCurveCommand&&this.drawCurveCommand.setAttributes({pointA:this.pointABuffer,pointB:this.pointBBuffer,linkIndices:this.linkIndexBuffer})}updateColor(){const{device:e,data:t}=this,n=t.linksNumber??0,i=t.linkColors??new Float32Array(4*n).fill(0);this.colorBuffer?(this.colorBuffer.byteLength??0)/(4*Float32Array.BYTES_PER_ELEMENT)!==n?(this.colorBuffer&&!this.colorBuffer.destroyed&&this.colorBuffer.destroy(),this.colorBuffer=e.createBuffer({data:i,usage:ai.VERTEX|ai.COPY_DST})):this.colorBuffer.write(i):this.colorBuffer=e.createBuffer({data:i,usage:ai.VERTEX|ai.COPY_DST}),this.drawCurveCommand&&this.drawCurveCommand.setAttributes({color:this.colorBuffer})}updateWidth(){const{device:e,data:t}=this,n=t.linksNumber??0,i=t.linkWidths??new Float32Array(n).fill(0);this.widthBuffer?(this.widthBuffer.byteLength??0)/Float32Array.BYTES_PER_ELEMENT!==n?(this.widthBuffer&&!this.widthBuffer.destroyed&&this.widthBuffer.destroy(),this.widthBuffer=e.createBuffer({data:i,usage:ai.VERTEX|ai.COPY_DST})):this.widthBuffer.write(i):this.widthBuffer=e.createBuffer({data:i,usage:ai.VERTEX|ai.COPY_DST}),this.drawCurveCommand&&this.drawCurveCommand.setAttributes({width:this.widthBuffer})}updateArrow(){const{device:e,data:t}=this,n=t.linksNumber??0,i=t.linkArrows?new Float32Array(t.linkArrows):new Float32Array(n).fill(0);this.arrowBuffer?(this.arrowBuffer.byteLength??0)/Float32Array.BYTES_PER_ELEMENT!==n?(this.arrowBuffer&&!this.arrowBuffer.destroyed&&this.arrowBuffer.destroy(),this.arrowBuffer=e.createBuffer({data:i,usage:ai.VERTEX|ai.COPY_DST})):this.arrowBuffer.write(i):this.arrowBuffer=e.createBuffer({data:i,usage:ai.VERTEX|ai.COPY_DST}),this.drawCurveCommand&&this.drawCurveCommand.setAttributes({arrow:this.arrowBuffer})}updateCurveLineGeometry(){var e;const{device:t,config:{curvedLinks:n,curvedLinkSegments:i}}=this;this.curveLineGeometry=(e=>{const t=gu().exponent(2).range([0,1]).domain([-1,1]),n=function(e,t,n){e=+e,t=+t,n=(o=arguments.length)<2?(t=e,e=0,1):o<3?1:+n;for(var i=-1,o=0|Math.max(0,Math.ceil((t-e)/n)),r=new Array(o);++i<o;)r[i]=e+i*n;return r}(0,e).map(t=>t/e-.5);n.push(.5);const i=new Array(2*n.length);return n.forEach((e,n)=>{i[2*n]=[t(2*e),.5],i[2*n+1]=[t(2*e),-.5]}),i})(n?i??zo.curvedLinkSegments:1);const o=new Float32Array(2*this.curveLineGeometry.length);for(let r=0;r<this.curveLineGeometry.length;r++)o[2*r]=this.curveLineGeometry[r][0],o[2*r+1]=this.curveLineGeometry[r][1];this.curveLineBuffer&&this.curveLineBuffer.byteLength===o.byteLength?this.curveLineBuffer.write(o):(null==(e=this.curveLineBuffer)||e.destroy(),this.curveLineBuffer=t.createBuffer({data:o,usage:ai.VERTEX|ai.COPY_DST})),this.drawCurveCommand&&(this.drawCurveCommand.setAttributes({position:this.curveLineBuffer}),this.drawCurveCommand.setVertexCount(this.curveLineGeometry.length))}findHoveredLine(){const{config:e,points:t,store:n}=this;if(!t||!t.currentPositionTexture||t.currentPositionTexture.destroyed||!t.greyoutStatusTexture||t.greyoutStatusTexture.destroyed||!this.data.linksNumber||!this.store.isLinkHoveringEnabled||!this.linkIndexFbo||!this.drawCurveCommand||!this.drawLineUniformStore||!this.linkIndexTexture||this.linkIndexTexture.destroyed)return;this.drawLineUniformStore.setUniforms({drawLineUniforms:{transformationMatrix:n.transformationMatrix4x4,pointsTextureSize:n.pointsTextureSize,widthScale:e.linkWidthScale??1,linkArrowsSizeScale:e.linkArrowsSizeScale??1,spaceSize:n.adjustedSpaceSize??0,screenSize:yc(n.screenSize,[0,0]),linkVisibilityDistanceRange:yc(e.linkVisibilityDistanceRange,[0,0]),linkVisibilityMinTransparency:e.linkVisibilityMinTransparency??0,linkOpacity:e.linkOpacity??1,greyoutOpacity:e.linkGreyoutOpacity??1,curvedWeight:e.curvedLinkWeight??0,curvedLinkControlPointDistance:e.curvedLinkControlPointDistance??0,curvedLinkSegments:e.curvedLinks?e.curvedLinkSegments??zo.curvedLinkSegments:1,scaleLinksOnZoom:e.scaleLinksOnZoom??1?1:0,maxPointSize:n.maxPointSize??100,renderMode:1,hoveredLinkIndex:n.hoveredLinkIndex??-1,hoveredLinkColor:bc(n.hoveredLinkColor,[-1,-1,-1,-1]),hoveredLinkWidthIncrease:e.hoveredLinkWidthIncrease??0},drawLineFragmentUniforms:{renderMode:1}}),this.drawCurveCommand.setBindings({positionsTexture:t.currentPositionTexture,pointGreyoutStatus:t.greyoutStatusTexture}),this.drawCurveCommand.setInstanceCount(this.data.linksNumber??0);const i=this.device.beginRenderPass({framebuffer:this.linkIndexFbo,clearColor:[0,0,0,0]});if(this.drawCurveCommand.draw(i),i.end(),this.hoveredLineIndexCommand&&this.hoveredLineIndexFbo&&this.hoveredLineIndexUniformStore){this.hoveredLineIndexUniformStore.setUniforms({hoveredLineIndexUniforms:{mousePosition:yc(n.screenMousePosition,[0,0]),screenSize:yc(n.screenSize,[0,0])}}),this.hoveredLineIndexCommand.setBindings({linkIndexTexture:this.linkIndexTexture});const e=this.device.beginRenderPass({framebuffer:this.hoveredLineIndexFbo});this.hoveredLineIndexCommand.draw(e),e.end()}}destroy(){var e,t,n,i;null==(e=this.drawCurveCommand)||e.destroy(),this.drawCurveCommand=void 0,null==(t=this.hoveredLineIndexCommand)||t.destroy(),this.hoveredLineIndexCommand=void 0,this.linkIndexFbo&&!this.linkIndexFbo.destroyed&&this.linkIndexFbo.destroy(),this.linkIndexFbo=void 0,this.hoveredLineIndexFbo&&!this.hoveredLineIndexFbo.destroyed&&this.hoveredLineIndexFbo.destroy(),this.hoveredLineIndexFbo=void 0,this.linkIndexTexture&&!this.linkIndexTexture.destroyed&&this.linkIndexTexture.destroy(),this.linkIndexTexture=void 0,this.hoveredLineIndexTexture&&!this.hoveredLineIndexTexture.destroyed&&this.hoveredLineIndexTexture.destroy(),this.hoveredLineIndexTexture=void 0,null==(n=this.drawLineUniformStore)||n.destroy(),this.drawLineUniformStore=void 0,null==(i=this.hoveredLineIndexUniformStore)||i.destroy(),this.hoveredLineIndexUniformStore=void 0,this.pointABuffer&&!this.pointABuffer.destroyed&&this.pointABuffer.destroy(),this.pointABuffer=void 0,this.pointBBuffer&&!this.pointBBuffer.destroyed&&this.pointBBuffer.destroy(),this.pointBBuffer=void 0,this.colorBuffer&&!this.colorBuffer.destroyed&&this.colorBuffer.destroy(),this.colorBuffer=void 0,this.widthBuffer&&!this.widthBuffer.destroyed&&this.widthBuffer.destroy(),this.widthBuffer=void 0,this.arrowBuffer&&!this.arrowBuffer.destroyed&&this.arrowBuffer.destroy(),this.arrowBuffer=void 0,this.curveLineBuffer&&!this.curveLineBuffer.destroyed&&this.curveLineBuffer.destroy(),this.curveLineBuffer=void 0,this.linkIndexBuffer&&!this.linkIndexBuffer.destroyed&&this.linkIndexBuffer.destroy(),this.linkIndexBuffer=void 0,this.quadBuffer&&!this.quadBuffer.destroyed&&this.quadBuffer.destroy(),this.quadBuffer=void 0}}class bu extends hc{constructor(){super(...arguments),this.imageCount=0,this.isPositionsUpToDate=!1,this.polygonPathLength=0}updatePositions(){var e,t,n;const{device:i,store:o,data:r,config:{rescalePositions:s,enableSimulation:a}}=this,{pointsTextureSize:l}=o;if(!l||!r.pointPositions||void 0===r.pointsNumber)return;const c=l*l*4,u=new Float32Array(c),h=l*l*4*4,d=u.byteLength;d!==h&&console.error("Texture data size mismatch:",{pointsTextureSize:l,expectedBytes:h,actualBytes:d,textureDataSize:c,dataLength:u.length});let p=s;void 0===s&&!a&&(p=!0),this.shouldSkipRescale&&(p=!1),p?this.rescaleInitialNodePositions():this.shouldSkipRescale||(this.scaleX=void 0,this.scaleY=void 0),this.shouldSkipRescale=void 0;for(let _=0;_<r.pointsNumber;++_)u[4*_+0]=r.pointPositions[2*_+0],u[4*_+1]=r.pointPositions[2*_+1],u[4*_+2]=_;if(this.currentPositionTexture&&this.currentPositionTexture.width===l&&this.currentPositionTexture.height===l?this.currentPositionTexture.copyImageData({data:u,bytesPerRow:pc("rgba32float",l),mipLevel:0,x:0,y:0}):(this.currentPositionTexture&&this.currentPositionTexture.destroy(),this.currentPositionFbo&&this.currentPositionFbo.destroy(),this.currentPositionTexture=i.createTexture({width:l,height:l,format:"rgba32float"}),this.currentPositionTexture.copyImageData({data:u,bytesPerRow:pc("rgba32float",l),mipLevel:0,x:0,y:0}),this.currentPositionFbo=i.createFramebuffer({width:l,height:l,colorAttachments:[this.currentPositionTexture]})),this.previousPositionTexture&&this.previousPositionTexture.width===l&&this.previousPositionTexture.height===l?this.previousPositionTexture.copyImageData({data:u,bytesPerRow:pc("rgba32float",l),mipLevel:0,x:0,y:0}):(this.previousPositionTexture&&this.previousPositionTexture.destroy(),this.previousPositionFbo&&this.previousPositionFbo.destroy(),this.previousPositionTexture=i.createTexture({width:l,height:l,format:"rgba32float"}),this.previousPositionTexture.copyImageData({data:u,bytesPerRow:pc("rgba32float",l),mipLevel:0,x:0,y:0}),this.previousPositionFbo=i.createFramebuffer({width:l,height:l,colorAttachments:[this.previousPositionTexture]})),this.config.enableSimulation){const e=new Float32Array(l*l*4).fill(0);this.velocityTexture&&this.velocityTexture.width===l&&this.velocityTexture.height===l?this.velocityTexture.copyImageData({data:e,bytesPerRow:pc("rgba32float",l),mipLevel:0,x:0,y:0}):(this.velocityTexture&&this.velocityTexture.destroy(),this.velocityFbo&&this.velocityFbo.destroy(),this.velocityTexture=i.createTexture({width:l,height:l,format:"rgba32float"}),this.velocityTexture.copyImageData({data:e,bytesPerRow:pc("rgba32float",l),mipLevel:0,x:0,y:0}),this.velocityFbo=i.createFramebuffer({width:l,height:l,colorAttachments:[this.velocityTexture]}))}this.selectedTexture&&this.selectedTexture.width===l&&this.selectedTexture.height===l?this.selectedTexture.copyImageData({data:u,bytesPerRow:pc("rgba32float",l),mipLevel:0,x:0,y:0}):(this.selectedTexture&&this.selectedTexture.destroy(),this.selectedFbo&&this.selectedFbo.destroy(),this.selectedTexture=i.createTexture({width:l,height:l,format:"rgba32float"}),this.selectedTexture.copyImageData({data:u,bytesPerRow:pc("rgba32float",l),mipLevel:0,x:0,y:0}),this.selectedFbo=i.createFramebuffer({width:l,height:l,colorAttachments:[this.selectedTexture]})),this.hoveredFbo||(this.hoveredFbo=i.createFramebuffer({width:2,height:2,colorAttachments:["rgba32float"]}));const f=dc(o.pointsTextureSize),m=f.byteLength;this.drawPointIndices&&this.drawPointIndices.byteLength===m?this.drawPointIndices.write(f):(null==(e=this.drawPointIndices)||e.destroy(),this.drawPointIndices=i.createBuffer({data:f,usage:ai.VERTEX|ai.COPY_DST})),this.drawCommand&&this.drawCommand.setAttributes({pointIndices:this.drawPointIndices}),this.hoveredPointIndices&&this.hoveredPointIndices.byteLength===m?this.hoveredPointIndices.write(f):(null==(t=this.hoveredPointIndices)||t.destroy(),this.hoveredPointIndices=i.createBuffer({data:f,usage:ai.VERTEX|ai.COPY_DST})),this.sampledPointIndices&&this.sampledPointIndices.byteLength===m?this.sampledPointIndices.write(f):(null==(n=this.sampledPointIndices)||n.destroy(),this.sampledPointIndices=i.createBuffer({data:f,usage:ai.VERTEX|ai.COPY_DST})),this.fillSampledPointsFboCommand&&this.fillSampledPointsFboCommand.setAttributes({pointIndices:this.sampledPointIndices}),this.updateGreyoutStatus(),this.updatePinnedStatus(),this.updateSampledPointsGrid(),this.trackPointsByIndices()}initPrograms(){var e,t,n;const{device:i,config:o,store:r,data:s}=this;(!this.imageAtlasCoordsTexture||!this.imageAtlasTexture)&&this.createAtlas(),this.colorBuffer||this.updateColor(),this.sizeBuffer||this.updateSize(),this.shapeBuffer||this.updateShape(),this.imageIndicesBuffer||this.updateImageIndices(),this.imageSizesBuffer||this.updateImageSizes(),this.greyoutStatusTexture||this.updateGreyoutStatus(),o.enableSimulation&&(this.updatePositionVertexCoordBuffer||(this.updatePositionVertexCoordBuffer=i.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.updatePositionUniformStore||(this.updatePositionUniformStore=new vo({updatePositionUniforms:{uniformTypes:{friction:"f32",spaceSize:"f32"},defaultUniforms:{friction:o.simulationFriction??0,spaceSize:r.adjustedSpaceSize??0}}})),this.updatePositionCommand||(this.updatePositionCommand=new cc(i,{fs:"#version 300 es\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D positionsTexture;\nuniform sampler2D velocity;\nuniform sampler2D pinnedStatusTexture;\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform updatePositionUniforms {\n  float friction;\n  float spaceSize;\n} updatePosition;\n\n#define friction updatePosition.friction\n#define spaceSize updatePosition.spaceSize\n#else\nuniform float friction;\nuniform float spaceSize;\n#endif\n\nin vec2 textureCoords;\n\nout vec4 fragColor;\n\nvoid main() {\n  vec4 pointPosition = texture(positionsTexture, textureCoords);\n  vec4 pointVelocity = texture(velocity, textureCoords);\n\n  // Check if point is pinned\n  // pinnedStatusTexture has the same size and layout as positionsTexture\n  // Each pixel corresponds to a point: red channel > 0.5 means the point is pinned\n  vec4 pinnedStatus = texture(pinnedStatusTexture, textureCoords);\n  \n  // If pinned, don't update position\n  if (pinnedStatus.r > 0.5) {\n    fragColor = pointPosition;\n    return;\n  }\n\n  // Friction\n  pointVelocity.rg *= friction;\n\n  pointPosition.rg += pointVelocity.rg;\n\n  pointPosition.r = clamp(pointPosition.r, 0.0, spaceSize);\n  pointPosition.g = clamp(pointPosition.g, 0.0, spaceSize);\n  \n  fragColor = pointPosition;\n}",vs:fc,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.updatePositionVertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{updatePositionUniforms:this.updatePositionUniformStore.getManagedUniformBuffer(i,"updatePositionUniforms")}}))),this.dragPointVertexCoordBuffer||(this.dragPointVertexCoordBuffer=i.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.dragPointUniformStore||(this.dragPointUniformStore=new vo({dragPointUniforms:{uniformTypes:{mousePos:"vec2<f32>",index:"f32"},defaultUniforms:{mousePos:yc(r.mousePosition,[0,0]),index:(null==(e=r.hoveredPoint)?void 0:e.index)??-1}}})),this.dragPointCommand||(this.dragPointCommand=new cc(i,{fs:"#version 300 es\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D positionsTexture;\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform dragPointUniforms {\n  vec2 mousePos;\n  float index;\n} dragPoint;\n\n#define mousePos dragPoint.mousePos\n#define index dragPoint.index\n#else\nuniform vec2 mousePos;\nuniform float index;\n#endif\n\nin vec2 textureCoords;\n\nout vec4 fragColor;\n\nvoid main() {\n  vec4 pointPosition = texture(positionsTexture, textureCoords);\n\n  // Check if a point is being dragged\n  if (index >= 0.0 && index == pointPosition.b) {\n    pointPosition.rg = mousePos.rg;\n  }\n\n  fragColor = pointPosition;\n}",vs:fc,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.dragPointVertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{dragPointUniforms:this.dragPointUniformStore.getManagedUniformBuffer(i,"dragPointUniforms")}})),this.drawUniformStore||(this.drawUniformStore=new vo({drawVertexUniforms:{uniformTypes:{ratio:"f32",transformationMatrix:"mat4x4<f32>",pointsTextureSize:"f32",sizeScale:"f32",spaceSize:"f32",screenSize:"vec2<f32>",greyoutColor:"vec4<f32>",backgroundColor:"vec4<f32>",scalePointsOnZoom:"f32",maxPointSize:"f32",isDarkenGreyout:"f32",skipSelected:"f32",skipUnselected:"f32",hasImages:"f32",imageCount:"f32",imageAtlasCoordsTextureSize:"f32"},defaultUniforms:{ratio:o.pixelRatio??zo.pixelRatio,transformationMatrix:(()=>{const e=r.transform??[1,0,0,0,1,0,0,0,1];return[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]})(),pointsTextureSize:r.pointsTextureSize??0,sizeScale:o.pointSizeScale??1,spaceSize:r.adjustedSpaceSize??0,screenSize:yc(r.screenSize,[0,0]),greyoutColor:bc(r.greyoutPointColor,[0,0,0,1]),backgroundColor:bc(r.backgroundColor,[0,0,0,1]),scalePointsOnZoom:o.scalePointsOnZoom??1?1:0,maxPointSize:r.maxPointSize??100,isDarkenGreyout:r.isDarkenGreyout?1:0,skipSelected:0,skipUnselected:0,hasImages:this.imageCount>0?1:0,imageCount:this.imageCount,imageAtlasCoordsTextureSize:this.imageAtlasCoordsTextureSize??0}},drawFragmentUniforms:{uniformTypes:{greyoutOpacity:"f32",pointOpacity:"f32",isDarkenGreyout:"f32",backgroundColor:"vec4<f32>"},defaultUniforms:{greyoutOpacity:o.pointGreyoutOpacity??-1,pointOpacity:o.pointOpacity??1,isDarkenGreyout:r.isDarkenGreyout?1:0,backgroundColor:bc(r.backgroundColor,[0,0,0,1])}}})),this.drawCommand||(this.drawCommand=new cc(i,{fs:"#version 300 es\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D imageAtlasTexture;\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform drawFragmentUniforms {\n  float greyoutOpacity;\n  float pointOpacity;\n  float isDarkenGreyout;\n  vec4 backgroundColor;\n} drawFragment;\n\n#define greyoutOpacity drawFragment.greyoutOpacity\n#define pointOpacity drawFragment.pointOpacity\n#define isDarkenGreyout drawFragment.isDarkenGreyout\n#define backgroundColor drawFragment.backgroundColor\n#else\nuniform float greyoutOpacity;\nuniform float pointOpacity;\nuniform float isDarkenGreyout;\nuniform vec4 backgroundColor;\n#endif\n\n\nin float pointShape;\nin float isGreyedOut;\nin vec4 shapeColor;\nin vec4 imageAtlasUV;\nin float shapeSize;\nin float imageSizeVarying;\nin float overallSize;\n\nout vec4 fragColor;\n\n// Smoothing controls the smoothness of the point's edge\nconst float smoothing = 0.9;\n\n// Shape constants\nconst float CIRCLE = 0.0;\nconst float SQUARE = 1.0;\nconst float TRIANGLE = 2.0;\nconst float DIAMOND = 3.0;\nconst float PENTAGON = 4.0;\nconst float HEXAGON = 5.0;\nconst float STAR = 6.0;\nconst float CROSS = 7.0;\nconst float NONE = 8.0;\n\n// Distance functions for different shapes\nfloat circleDistance(vec2 p) {\n    return dot(p, p);\n}\n\n// Function to apply greyout logic to image colors\nvec4 applyGreyoutToImage(vec4 imageColor, float isGreyedOutValue) {\n    vec3 finalColor = imageColor.rgb;\n    float finalAlpha = imageColor.a;\n    \n    if (isGreyedOutValue > 0.0) {\n        float blendFactor = 0.65; // Controls how much to modify (0.0 = original, 1.0 = target color)\n        \n        if (isDarkenGreyout > 0.0) {\n            finalColor = mix(finalColor, vec3(0.2), blendFactor);\n        } else {\n            finalColor = mix(finalColor, max(backgroundColor.rgb, vec3(0.8)), blendFactor);\n        }\n    }\n    \n    return vec4(finalColor, finalAlpha);\n}\n\nfloat squareDistance(vec2 p) {\n    vec2 d = abs(p) - vec2(0.8);\n    return length(max(d, 0.0)) + min(max(d.x, d.y), 0.0);\n}\n\nfloat triangleDistance(vec2 p) {\n    const float k = sqrt(3.0);   // ≈1.732; slope of 60° lines for an equilateral triangle\n    p.x = abs(p.x) - 0.9;        // fold the X axis and shift: brings left and right halves together\n    p.y = p.y + 0.55;             // move the whole shape up slightly so it is centred vertically\n\n    // reflect points that fall outside the main triangle back inside, to reuse the same maths\n    if (p.x + k * p.y > 0.0)\n        p = vec2(p.x - k * p.y,  -k * p.x - p.y) / 2.0;\n\n    p.x -= clamp(p.x, -1.0, 0.0); // clip any remainder on the left side\n\n    // Return signed distance: negative = inside; positive = outside\n    return -length(p) * sign(p.y);\n}\n\nfloat diamondDistance(vec2 p) {\n    // aspect > 1  →  taller diamond\n    const float aspect = 1.2;\n    return abs(p.x) + abs(p.y) / aspect - 0.8;\n}\n\nfloat pentagonDistance(vec2 p) {\n    // Regular pentagon signed-distance (Inigo Quilez)\n    const vec3 k = vec3(0.809016994, 0.587785252, 0.726542528);\n    p.x = abs(p.x);\n\n    // Reflect across the two tilted edges ─ only if point is outside\n    p -= 2.0 * min(dot(vec2(-k.x, k.y), p), 0.0) * vec2(-k.x, k.y);\n    p -= 2.0 * min(dot(vec2( k.x, k.y), p), 0.0) * vec2( k.x, k.y);\n\n    // Clip against the top horizontal edge (keeps top point sharp)\n    p -= vec2(clamp(p.x, -k.z * k.x, k.z * k.x), k.z);\n\n    // Return signed distance (negative → inside, positive → outside)\n    return length(p) * sign(p.y);\n}\n\nfloat hexagonDistance(vec2 p) {\n    const vec3 k = vec3(-0.866025404, 0.5, 0.577350269);\n    p = abs(p);\n    p -= 2.0 * min(dot(k.xy, p), 0.0) * k.xy;\n    p -= vec2(clamp(p.x, -k.z * 0.8, k.z * 0.8), 0.8);\n    return length(p) * sign(p.y);\n}\n\nfloat starDistance(vec2 p) {\n    // 5-point star signed-distance function (adapted from Inigo Quilez)\n    // r  – outer radius, rf – inner/outer radius ratio\n    const float r  = 0.9;\n    const float rf = 0.45;\n\n    // Pre-computed rotation vectors for the star arms (36° increments)\n    const vec2 k1 = vec2(0.809016994, -0.587785252);\n    const vec2 k2 = vec2(-k1.x, k1.y);\n\n    // Fold the plane into a single arm sector\n    p.x = abs(p.x);\n    p -= 2.0 * max(dot(k1, p), 0.0) * k1;\n    p -= 2.0 * max(dot(k2, p), 0.0) * k2;\n    p.x = abs(p.x);\n\n    // Translate so the top tip of the star lies on the X-axis\n    p.y -= r;\n\n    // Vector describing the edge between an outer tip and its adjacent inner point\n    vec2 ba = rf * vec2(-k1.y, k1.x) - vec2(0.0, 1.0);\n    // Project the point onto that edge and clamp the projection to the segment\n    float h = clamp(dot(p, ba) / dot(ba, ba), 0.0, r);\n\n    // Return signed distance (negative => inside, positive => outside)\n    return length(p - ba * h) * sign(p.y * ba.x - p.x * ba.y);\n}\n\nfloat crossDistance(vec2 p) {\n    // Signed distance function for a cross (union of two rectangles)\n    // Adapted from Inigo Quilez (https://iquilezles.org/)\n    // Each arm has half-sizes 0.3 (thickness) and 0.8 (length)\n    p = abs(p);\n    if (p.y > p.x) p = p.yx;       // exploit symmetry\n\n    vec2 q = p - vec2(0.8, 0.3);   // subtract half-sizes (length, thickness)\n\n    // Standard rectangle SDF, then take union of the two arms\n    return length(max(q, 0.0)) + min(max(q.x, q.y), 0.0);\n}\n\nfloat getShapeDistance(vec2 p, float shape) {\n    if (shape == SQUARE) return squareDistance(p);\n    else if (shape == TRIANGLE) return triangleDistance(p);\n    else if (shape == DIAMOND) return diamondDistance(p);\n    else if (shape == PENTAGON) return pentagonDistance(p);\n    else if (shape == HEXAGON) return hexagonDistance(p);\n    else if (shape == STAR) return starDistance(p);\n    else if (shape == CROSS) return crossDistance(p);\n    else return circleDistance(p); // Default to circle\n}\n\nvoid main() {\n    // Discard the fragment if the point is fully transparent and has no image\n    if (shapeColor.a == 0.0 && imageAtlasUV.x == -1.0) {\n        discard;\n    }\n\n    // Discard the fragment if the point has no shape and no image\n    if (pointShape == NONE && imageAtlasUV.x == -1.0) {\n        discard;\n    }\n\n    // Calculate coordinates within the point\n    vec2 pointCoord = 2.0 * gl_PointCoord - 1.0;\n\n    vec4 finalShapeColor = vec4(0.0);\n    vec4 finalImageColor = vec4(0.0);\n    \n    // Handle shape rendering with centering logic\n    if (pointShape != NONE) {\n        // Calculate shape coordinates with centering\n        vec2 shapeCoord = pointCoord;\n        if (overallSize > shapeSize && shapeSize > 0.0) {\n            // Shape is smaller than overall size, center it\n            float scale = shapeSize / overallSize;\n            shapeCoord = pointCoord / scale;\n        }\n        \n        float opacity;\n        if (pointShape == CIRCLE) {\n            // For circles, use the original distance calculation\n            float pointCenterDistance = dot(shapeCoord, shapeCoord);\n            opacity = 1.0 - smoothstep(smoothing, 1.0, pointCenterDistance);\n        } else {\n            // For other shapes, use the shape distance function\n            float shapeDistance = getShapeDistance(shapeCoord, pointShape);\n            opacity = 1.0 - smoothstep(-0.01, 0.01, shapeDistance);\n        }\n        opacity *= shapeColor.a;\n\n        finalShapeColor = vec4(shapeColor.rgb, opacity);\n    }\n\n    // Handle image rendering with centering logic\n    if (imageAtlasUV.x != -1.0) {\n        // Calculate image coordinates with centering\n        vec2 imageCoord = pointCoord;\n        if (overallSize > imageSizeVarying && imageSizeVarying > 0.0) {\n            // Image is smaller than overall size, center it\n            float scale = imageSizeVarying / overallSize;\n            imageCoord = pointCoord / scale;\n            \n            // Check if we're outside the valid image area\n            if (abs(imageCoord.x) > 1.0 || abs(imageCoord.y) > 1.0) {\n                // We're outside the image bounds, don't render the image\n                finalImageColor = vec4(0.0);\n            } else {\n                // Sample from texture atlas\n                vec2 atlasUV = mix(imageAtlasUV.xy, imageAtlasUV.zw, (imageCoord + 1.0) * 0.5);\n                vec4 imageColor = texture(imageAtlasTexture, atlasUV);\n                finalImageColor = applyGreyoutToImage(imageColor, isGreyedOut);\n            }\n        } else {\n            // Image is same size or larger than overall size, no scaling needed\n            // Sample from texture atlas\n            vec2 atlasUV = mix(imageAtlasUV.xy, imageAtlasUV.zw, (imageCoord + 1.0) * 0.5);\n            vec4 imageColor = texture(imageAtlasTexture, atlasUV);\n            finalImageColor = applyGreyoutToImage(imageColor, isGreyedOut);\n        }\n    }\n\n    float finalPointAlpha = max(finalShapeColor.a, finalImageColor.a);\n    if (isGreyedOut > 0.0 && greyoutOpacity != -1.0) {\n        finalPointAlpha *= greyoutOpacity;\n    } else {\n        finalPointAlpha *= pointOpacity;\n    }\n\n    // Blend image color above point color\n    fragColor = vec4(\n        mix(finalShapeColor.rgb, finalImageColor.rgb, finalImageColor.a),\n        finalPointAlpha\n    );\n}\n",vs:"#version 300 es\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nin vec2 pointIndices;\nin float size;\nin vec4 color;\nin float shape;\nin float imageIndex;\nin float imageSize;\n\nuniform sampler2D positionsTexture;\nuniform sampler2D pointGreyoutStatus;\nuniform sampler2D imageAtlasCoords;\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform drawVertexUniforms {\n  float ratio;\n  mat4 transformationMatrix;\n  float pointsTextureSize;\n  float sizeScale;\n  float spaceSize;\n  vec2 screenSize;\n  vec4 greyoutColor;\n  vec4 backgroundColor;\n  float scalePointsOnZoom;\n  float maxPointSize;\n  float isDarkenGreyout;\n  float skipSelected;\n  float skipUnselected;\n  float hasImages;\n  float imageCount;\n  float imageAtlasCoordsTextureSize;\n} drawVertex;\n\n#define ratio drawVertex.ratio\n#define transformationMatrix drawVertex.transformationMatrix\n#define pointsTextureSize drawVertex.pointsTextureSize\n#define sizeScale drawVertex.sizeScale\n#define spaceSize drawVertex.spaceSize\n#define screenSize drawVertex.screenSize\n#define greyoutColor drawVertex.greyoutColor\n#define backgroundColor drawVertex.backgroundColor\n#define scalePointsOnZoom drawVertex.scalePointsOnZoom\n#define maxPointSize drawVertex.maxPointSize\n#define isDarkenGreyout drawVertex.isDarkenGreyout\n#define skipSelected drawVertex.skipSelected\n#define skipUnselected drawVertex.skipUnselected\n#define hasImages drawVertex.hasImages\n#define imageCount drawVertex.imageCount\n#define imageAtlasCoordsTextureSize drawVertex.imageAtlasCoordsTextureSize\n#else\nuniform float ratio;\nuniform mat3 transformationMatrix;\nuniform float pointsTextureSize;\nuniform float sizeScale;\nuniform float spaceSize;\nuniform vec2 screenSize;\nuniform vec4 greyoutColor;\nuniform vec4 backgroundColor;\nuniform float scalePointsOnZoom;\nuniform float maxPointSize;\nuniform float isDarkenGreyout;\nuniform float skipSelected;\nuniform float skipUnselected;\nuniform float hasImages;\nuniform float imageCount;\nuniform float imageAtlasCoordsTextureSize;\n#endif\n\nout float pointShape;\nout float isGreyedOut;\nout vec4 shapeColor;\nout vec4 imageAtlasUV;\nout float shapeSize;\nout float imageSizeVarying;\nout float overallSize;\n\nfloat calculatePointSize(float size) {\n  float pSize;\n\n  if (scalePointsOnZoom > 0.0) { \n    pSize = size * ratio * transformationMatrix[0][0];\n  } else {\n    pSize = size * ratio * min(5.0, max(1.0, transformationMatrix[0][0] * 0.01));\n  }\n\n  return min(pSize, maxPointSize * ratio);\n}\n\nvoid main() {    \n  // Check greyout status for selective rendering\n  vec4 greyoutStatus = texture(pointGreyoutStatus, (pointIndices + 0.5) / pointsTextureSize);\n  isGreyedOut = greyoutStatus.r;\n  float isSelected = (greyoutStatus.r == 0.0) ? 1.0 : 0.0;\n  \n  // Discard point based on rendering mode\n  if (skipSelected > 0.0 && isSelected > 0.0) {\n    gl_Position = vec4(2.0, 2.0, 2.0, 1.0); // Move off-screen\n    gl_PointSize = 0.0;\n    return;\n  }\n  if (skipUnselected > 0.0 && isSelected <= 0.0) {\n    gl_Position = vec4(2.0, 2.0, 2.0, 1.0); // Move off-screen\n    gl_PointSize = 0.0;\n    return;\n  }\n  \n  // Position\n  vec4 pointPosition = texture(positionsTexture, (pointIndices + 0.5) / pointsTextureSize);\n  vec2 point = pointPosition.rg;\n\n  // Transform point position to normalized device coordinates\n  // Convert from space coordinates [0, spaceSize] to normalized [-1, 1]\n  vec2 normalizedPosition = 2.0 * point / spaceSize - 1.0;\n  \n  // Apply aspect ratio correction - this is needed to map the square space to the rectangular screen\n  // The transformation matrix handles zoom/pan, but we need this to handle aspect ratio\n  normalizedPosition *= spaceSize / screenSize;\n  \n  #ifdef USE_UNIFORM_BUFFERS\n  mat3 transformMat3 = mat3(transformationMatrix);\n  vec3 finalPosition = transformMat3 * vec3(normalizedPosition, 1);\n  #else\n  vec3 finalPosition = transformationMatrix * vec3(normalizedPosition, 1);\n  #endif\n  gl_Position = vec4(finalPosition.rg, 0, 1);\n\n  // Calculate sizes for shape and image\n  float shapeSizeValue = calculatePointSize(size * sizeScale);\n  float imageSizeValue = calculatePointSize(imageSize * sizeScale);\n  \n  // Use the larger of the two sizes for the overall point size\n  float overallSizeValue = max(shapeSizeValue, imageSizeValue);\n  gl_PointSize = overallSizeValue;\n\n  // Pass size information to fragment shader\n  shapeSize = shapeSizeValue;\n  imageSizeVarying = imageSizeValue;\n  overallSize = overallSizeValue;\n\n  shapeColor = color;\n  pointShape = shape;\n\n  // Adjust alpha of selected points\n  if (isGreyedOut > 0.0) {\n    if (greyoutColor[0] != -1.0) {\n      shapeColor = greyoutColor;\n    } else {\n      // If greyoutColor is not set, make color lighter or darker based on isDarkenGreyout\n      float blendFactor = 0.65; // Controls how much to modify (0.0 = original, 1.0 = target color)\n      \n      #ifdef USE_UNIFORM_BUFFERS\n      if (isDarkenGreyout > 0.0) {\n        // Darken the color\n        shapeColor.rgb = mix(shapeColor.rgb, vec3(0.2), blendFactor);\n      } else {\n        // Lighten the color\n        shapeColor.rgb = mix(shapeColor.rgb, max(backgroundColor.rgb, vec3(0.8)), blendFactor);\n      }\n      #else\n      if (isDarkenGreyout > 0.0) {\n        // Darken the color\n        shapeColor.rgb = mix(shapeColor.rgb, vec3(0.2), blendFactor);\n      } else {\n        // Lighten the color\n        shapeColor.rgb = mix(shapeColor.rgb, max(backgroundColor.rgb, vec3(0.8)), blendFactor);\n      }\n      #endif\n    }\n  }\n\n  #ifdef USE_UNIFORM_BUFFERS\n  if (hasImages <= 0.0 || imageIndex < 0.0 || imageIndex >= imageCount) {\n    imageAtlasUV = vec4(-1.0);\n  } else {\n    // Calculate image atlas UV coordinates based on imageIndex\n    float atlasCoordIndex = imageIndex;\n    // Calculate the position in the texture grid\n    float texX = mod(atlasCoordIndex, imageAtlasCoordsTextureSize);\n    float texY = floor(atlasCoordIndex / imageAtlasCoordsTextureSize);\n    // Convert to texture coordinates (0.0 to 1.0)\n    vec2 atlasCoordTexCoord = (vec2(texX, texY) + 0.5) / imageAtlasCoordsTextureSize;\n    vec4 atlasCoords = texture(imageAtlasCoords, atlasCoordTexCoord);\n    imageAtlasUV = atlasCoords;\n  }\n  #else\n  if (hasImages <= 0.0 || imageIndex < 0.0 || imageIndex >= imageCount) {\n    imageAtlasUV = vec4(-1.0);\n  } else {\n    // Calculate image atlas UV coordinates based on imageIndex\n    float atlasCoordIndex = imageIndex;\n    // Calculate the position in the texture grid\n    float texX = mod(atlasCoordIndex, imageAtlasCoordsTextureSize);\n    float texY = floor(atlasCoordIndex / imageAtlasCoordsTextureSize);\n    // Convert to texture coordinates (0.0 to 1.0)\n    vec2 atlasCoordTexCoord = (vec2(texX, texY) + 0.5) / imageAtlasCoordsTextureSize;\n    vec4 atlasCoords = texture(imageAtlasCoords, atlasCoordTexCoord);\n    imageAtlasUV = atlasCoords;\n  }\n  #endif\n} ",topology:"point-list",vertexCount:s.pointsNumber??0,attributes:{...this.drawPointIndices&&{pointIndices:this.drawPointIndices},...this.sizeBuffer&&{size:this.sizeBuffer},...this.colorBuffer&&{color:this.colorBuffer},...this.shapeBuffer&&{shape:this.shapeBuffer},...this.imageIndicesBuffer&&{imageIndex:this.imageIndicesBuffer},...this.imageSizesBuffer&&{imageSize:this.imageSizesBuffer}},bufferLayout:[{name:"pointIndices",format:"float32x2"},{name:"size",format:"float32"},{name:"color",format:"float32x4"},{name:"shape",format:"float32"},{name:"imageIndex",format:"float32"},{name:"imageSize",format:"float32"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{drawVertexUniforms:this.drawUniformStore.getManagedUniformBuffer(i,"drawVertexUniforms"),drawFragmentUniforms:this.drawUniformStore.getManagedUniformBuffer(i,"drawFragmentUniforms")},parameters:{blend:!0,blendColorOperation:"add",blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaOperation:"add",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",depthWriteEnabled:!1,depthCompare:"always"}})),this.findPointsOnAreaSelectionVertexCoordBuffer||(this.findPointsOnAreaSelectionVertexCoordBuffer=i.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.findPointsOnAreaSelectionUniformStore||(this.findPointsOnAreaSelectionUniformStore=new vo({findPointsOnAreaSelectionUniforms:{uniformTypes:{sizeScale:"f32",spaceSize:"f32",screenSize:"vec2<f32>",ratio:"f32",transformationMatrix:"mat4x4<f32>",selection0:"vec2<f32>",selection1:"vec2<f32>",scalePointsOnZoom:"f32",maxPointSize:"f32"},defaultUniforms:{sizeScale:o.pointSizeScale??1,spaceSize:r.adjustedSpaceSize??0,screenSize:yc(r.screenSize,[0,0]),ratio:o.pixelRatio??zo.pixelRatio,transformationMatrix:r.transformationMatrix4x4,selection0:yc(null==(t=r.selectedArea)?void 0:t[0],[0,0]),selection1:yc(null==(n=r.selectedArea)?void 0:n[1],[0,0]),scalePointsOnZoom:o.scalePointsOnZoom??1?1:0,maxPointSize:r.maxPointSize??100}}})),this.findPointsOnAreaSelectionCommand||(this.findPointsOnAreaSelectionCommand=new cc(i,{fs:"#version 300 es\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D positionsTexture;\nuniform sampler2D pointSize;\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform findPointsOnAreaSelectionUniforms {\n  float sizeScale;\n  float spaceSize;\n  vec2 screenSize;\n  float ratio;\n  mat4 transformationMatrix;\n  vec2 selection0;\n  vec2 selection1;\n  float scalePointsOnZoom;\n  float maxPointSize;\n} findPointsOnAreaSelection;\n\n#define sizeScale findPointsOnAreaSelection.sizeScale\n#define spaceSize findPointsOnAreaSelection.spaceSize\n#define screenSize findPointsOnAreaSelection.screenSize\n#define ratio findPointsOnAreaSelection.ratio\n#define transformationMatrix findPointsOnAreaSelection.transformationMatrix\n#define selection0 findPointsOnAreaSelection.selection0\n#define selection1 findPointsOnAreaSelection.selection1\n#define scalePointsOnZoom findPointsOnAreaSelection.scalePointsOnZoom\n#define maxPointSize findPointsOnAreaSelection.maxPointSize\n#else\nuniform float sizeScale;\nuniform float spaceSize;\nuniform vec2 screenSize;\nuniform float ratio;\nuniform mat3 transformationMatrix;\nuniform vec2 selection0;\nuniform vec2 selection1;\nuniform float scalePointsOnZoom;\nuniform float maxPointSize;\n#endif\n\nin vec2 textureCoords;\n\nout vec4 fragColor;\n\nfloat pointSizeF(float size) {\n  float pSize;\n  // Extract top-left element from mat4 (or use mat3 conversion)\n  #ifdef USE_UNIFORM_BUFFERS\n  float scale = transformationMatrix[0][0]; // mat4 first element\n  #else\n  float scale = transformationMatrix[0][0]; // mat3 first element\n  #endif\n  if (scalePointsOnZoom > 0.0) { \n    pSize = size * ratio * scale;\n  } else {\n    pSize = size * ratio * min(5.0, max(1.0, scale * 0.01));\n  }\n  return min(pSize, maxPointSize * ratio);\n}\n\nvoid main() {\n  vec4 pointPosition = texture(positionsTexture, textureCoords);\n  vec2 p = 2.0 * pointPosition.rg / spaceSize - 1.0;\n  p *= spaceSize / screenSize;\n  #ifdef USE_UNIFORM_BUFFERS\n  // Convert mat4 to mat3 for vec3 multiplication\n  mat3 transformMat3 = mat3(transformationMatrix);\n  vec3 final = transformMat3 * vec3(p, 1);\n  #else\n  vec3 final = transformationMatrix * vec3(p, 1);\n  #endif\n\n  vec4 pSize = texture(pointSize, textureCoords);\n  float size = pSize.r * sizeScale;\n\n  float left = 2.0 * (selection0.x - 0.5 * pointSizeF(size)) / screenSize.x - 1.0;\n  float right = 2.0 * (selection1.x + 0.5 * pointSizeF(size)) / screenSize.x - 1.0;\n  float top =  2.0 * (selection0.y - 0.5 * pointSizeF(size)) / screenSize.y - 1.0;\n  float bottom =  2.0 * (selection1.y + 0.5 * pointSizeF(size)) / screenSize.y - 1.0;\n\n  fragColor = vec4(0.0, 0.0, pointPosition.r, pointPosition.g);\n  if (final.x >= left && final.x <= right && final.y >= top && final.y <= bottom) {\n    fragColor.r = 1.0;\n  }\n}\n\n",vs:fc,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.findPointsOnAreaSelectionVertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{findPointsOnAreaSelectionUniforms:this.findPointsOnAreaSelectionUniformStore.getManagedUniformBuffer(i,"findPointsOnAreaSelectionUniforms")}})),this.findPointsOnPolygonSelectionVertexCoordBuffer||(this.findPointsOnPolygonSelectionVertexCoordBuffer=i.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.findPointsOnPolygonSelectionUniformStore||(this.findPointsOnPolygonSelectionUniformStore=new vo({findPointsOnPolygonSelectionUniforms:{uniformTypes:{spaceSize:"f32",screenSize:"vec2<f32>",transformationMatrix:"mat4x4<f32>",polygonPathLength:"f32"},defaultUniforms:{spaceSize:r.adjustedSpaceSize??0,screenSize:yc(r.screenSize,[0,0]),transformationMatrix:r.transformationMatrix4x4,polygonPathLength:this.polygonPathLength}}})),this.findPointsOnPolygonSelectionCommand||(this.findPointsOnPolygonSelectionCommand=new cc(i,{fs:"#version 300 es\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D positionsTexture;\nuniform sampler2D polygonPathTexture; // Texture containing polygon path points\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform findPointsOnPolygonSelectionUniforms {\n  float spaceSize;\n  vec2 screenSize;\n  mat4 transformationMatrix;\n  float polygonPathLength;\n} findPointsOnPolygonSelection;\n\n#define spaceSize findPointsOnPolygonSelection.spaceSize\n#define screenSize findPointsOnPolygonSelection.screenSize\n#define transformationMatrix findPointsOnPolygonSelection.transformationMatrix\n#define polygonPathLength int(findPointsOnPolygonSelection.polygonPathLength)\n#else\nuniform int polygonPathLength;\nuniform float spaceSize;\nuniform vec2 screenSize;\nuniform mat3 transformationMatrix;\n#endif\n\nin vec2 textureCoords;\n\nout vec4 fragColor;\n\n// Get a point from the polygon path texture at a specific index\nvec2 getPolygonPoint(sampler2D pathTexture, int index, int pathLength) {\n  if (index >= pathLength) return vec2(0.0);\n  \n  // Calculate texture coordinates for the index\n  int textureSize = int(ceil(sqrt(float(pathLength))));\n  int x = index - (index / textureSize) * textureSize;\n  int y = index / textureSize;\n  \n  vec2 texCoord = (vec2(float(x), float(y)) + 0.5) / float(textureSize);\n  vec4 pathData = texture(pathTexture, texCoord);\n  \n  return pathData.xy;\n}\n\n// Point-in-polygon algorithm using ray casting\nbool pointInPolygon(vec2 point, sampler2D pathTexture, int pathLength) {\n  bool inside = false;\n  \n  for (int i = 0; i < 2048; i++) {\n    if (i >= pathLength) break;\n    \n    int j = int(mod(float(i + 1), float(pathLength)));\n    \n    vec2 pi = getPolygonPoint(pathTexture, i, pathLength);\n    vec2 pj = getPolygonPoint(pathTexture, j, pathLength);\n    \n    if (((pi.y > point.y) != (pj.y > point.y)) &&\n        (point.x < (pj.x - pi.x) * (point.y - pi.y) / (pj.y - pi.y) + pi.x)) {\n      inside = !inside;\n    }\n  }\n  \n  return inside;\n}\n\nvoid main() {\n  vec4 pointPosition = texture(positionsTexture, textureCoords);\n  vec2 p = 2.0 * pointPosition.rg / spaceSize - 1.0;\n  p *= spaceSize / screenSize;\n  #ifdef USE_UNIFORM_BUFFERS\n  // Convert mat4 to mat3 for vec3 multiplication\n  mat3 transformMat3 = mat3(transformationMatrix);\n  vec3 final = transformMat3 * vec3(p, 1);\n  #else\n  vec3 final = transformationMatrix * vec3(p, 1);\n  #endif\n\n  // Convert to screen coordinates for polygon check\n  vec2 screenPos = (final.xy + 1.0) * screenSize / 2.0;\n  \n  fragColor = vec4(0.0, 0.0, pointPosition.r, pointPosition.g);\n  \n  // Check if point center is inside the polygon\n  if (pointInPolygon(screenPos, polygonPathTexture, polygonPathLength)) {\n    fragColor.r = 1.0;\n  }\n} ",vs:fc,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.findPointsOnPolygonSelectionVertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{findPointsOnPolygonSelectionUniforms:this.findPointsOnPolygonSelectionUniformStore.getManagedUniformBuffer(i,"findPointsOnPolygonSelectionUniforms")}})),this.findHoveredPointUniformStore||(this.findHoveredPointUniformStore=new vo({findHoveredPointUniforms:{uniformTypes:{pointsTextureSize:"f32",sizeScale:"f32",spaceSize:"f32",screenSize:"vec2<f32>",ratio:"f32",transformationMatrix:"mat4x4<f32>",mousePosition:"vec2<f32>",scalePointsOnZoom:"f32",maxPointSize:"f32"},defaultUniforms:{pointsTextureSize:r.pointsTextureSize??0,sizeScale:o.pointSizeScale??1,spaceSize:r.adjustedSpaceSize??0,screenSize:yc(r.screenSize,[0,0]),ratio:o.pixelRatio??zo.pixelRatio,transformationMatrix:r.transformationMatrix4x4,mousePosition:yc(r.screenMousePosition,[0,0]),scalePointsOnZoom:o.scalePointsOnZoom??1?1:0,maxPointSize:r.maxPointSize??100}}})),this.findHoveredPointCommand||(this.findHoveredPointCommand=new cc(i,{fs:"#version 300 es\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nin vec4 rgba;\n\nout vec4 fragColor;\n\nvoid main() {\n  if (rgba.g <= 0.0) {\n    discard;\n  }\n  fragColor = rgba;\n}",vs:"#version 300 es\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nin vec2 pointIndices;\nin float size;\n\nuniform sampler2D positionsTexture;\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform findHoveredPointUniforms {\n  float pointsTextureSize;\n  float sizeScale;\n  float spaceSize;\n  vec2 screenSize;\n  float ratio;\n  mat4 transformationMatrix;\n  vec2 mousePosition;\n  float scalePointsOnZoom;\n  float maxPointSize;\n} findHoveredPoint;\n\n#define pointsTextureSize findHoveredPoint.pointsTextureSize\n#define sizeScale findHoveredPoint.sizeScale\n#define spaceSize findHoveredPoint.spaceSize\n#define screenSize findHoveredPoint.screenSize\n#define ratio findHoveredPoint.ratio\n#define transformationMatrix findHoveredPoint.transformationMatrix\n#define mousePosition findHoveredPoint.mousePosition\n#define scalePointsOnZoom findHoveredPoint.scalePointsOnZoom\n#define maxPointSize findHoveredPoint.maxPointSize\n#else\nuniform float pointsTextureSize;\nuniform float sizeScale;\nuniform float spaceSize;\nuniform vec2 screenSize;\nuniform float ratio;\nuniform mat3 transformationMatrix;\nuniform vec2 mousePosition;\nuniform float scalePointsOnZoom;\nuniform float maxPointSize;\n#endif\n\nout vec4 rgba;\n\nfloat calculatePointSize(float size) {\n  float pSize;\n\n  if (scalePointsOnZoom > 0.0) { \n    pSize = size * ratio * transformationMatrix[0][0];\n  } else {\n    pSize = size * ratio * min(5.0, max(1.0, transformationMatrix[0][0] * 0.01));\n  }\n\n  return min(pSize, maxPointSize * ratio);\n}\n\nfloat euclideanDistance (float x1, float x2, float y1, float y2) {\n  return sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n}\n\nvoid main() {\n  vec4 pointPosition = texture(positionsTexture, (pointIndices + 0.5) / pointsTextureSize);\n  vec2 point = pointPosition.rg;\n\n  vec2 normalizedPosition = 2.0 * point / spaceSize - 1.0;\n  normalizedPosition *= spaceSize / screenSize;\n  \n  #ifdef USE_UNIFORM_BUFFERS\n  mat3 transformMat3 = mat3(transformationMatrix);\n  vec3 finalPosition = transformMat3 * vec3(normalizedPosition, 1);\n  #else\n  vec3 finalPosition = transformationMatrix * vec3(normalizedPosition, 1);\n  #endif\n\n  float pointRadius = 0.5 * calculatePointSize(size * sizeScale);\n  vec2 pointScreenPosition = (finalPosition.xy + 1.0) * screenSize / 2.0;\n  \n  rgba = vec4(0.0);\n  gl_Position = vec4(0.5, 0.5, 0.0, 1.0);\n  \n  if (euclideanDistance(pointScreenPosition.x, mousePosition.x, pointScreenPosition.y, mousePosition.y) < pointRadius / ratio) {\n    float index = pointIndices.g * pointsTextureSize + pointIndices.r;\n    rgba = vec4(index, size, pointPosition.xy);\n    gl_Position = vec4(-0.5, -0.5, 0.0, 1.0);\n  }\n\n  gl_PointSize = 1.0;\n}",topology:"point-list",vertexCount:s.pointsNumber??0,attributes:{...this.hoveredPointIndices&&{pointIndices:this.hoveredPointIndices},...this.sizeBuffer&&{size:this.sizeBuffer}},bufferLayout:[{name:"pointIndices",format:"float32x2"},{name:"size",format:"float32"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{findHoveredPointUniforms:this.findHoveredPointUniformStore.getManagedUniformBuffer(i,"findHoveredPointUniforms")},parameters:{depthWriteEnabled:!1,depthCompare:"always",blend:!1}})),this.fillSampledPointsUniformStore||(this.fillSampledPointsUniformStore=new vo({fillSampledPointsUniforms:{uniformTypes:{pointsTextureSize:"f32",transformationMatrix:"mat4x4<f32>",spaceSize:"f32",screenSize:"vec2<f32>"},defaultUniforms:{pointsTextureSize:r.pointsTextureSize??0,transformationMatrix:r.transformationMatrix4x4,spaceSize:r.adjustedSpaceSize??0,screenSize:yc(r.screenSize,[0,0])}}})),this.fillSampledPointsFboCommand||(this.fillSampledPointsFboCommand=new cc(i,{fs:"#version 300 es\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nin vec4 rgba;\n\nout vec4 fragColor;\n\nvoid main() {\n  fragColor = rgba;\n}",vs:"#version 300 es\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nin vec2 pointIndices;\n\nuniform sampler2D positionsTexture;\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform fillSampledPointsUniforms {\n  float pointsTextureSize;\n  mat4 transformationMatrix;\n  float spaceSize;\n  vec2 screenSize;\n} fillSampledPoints;\n\n#define pointsTextureSize fillSampledPoints.pointsTextureSize\n#define transformationMatrix fillSampledPoints.transformationMatrix\n#define spaceSize fillSampledPoints.spaceSize\n#define screenSize fillSampledPoints.screenSize\n#else\nuniform float pointsTextureSize;\nuniform float spaceSize;\nuniform vec2 screenSize;\nuniform mat3 transformationMatrix;\n#endif\n\nout vec4 rgba;\n\nvoid main() {\n  vec4 pointPosition = texture(positionsTexture, (pointIndices + 0.5) / pointsTextureSize);\n  vec2 p = 2.0 * pointPosition.rg / spaceSize - 1.0;\n  p *= spaceSize / screenSize;\n  #ifdef USE_UNIFORM_BUFFERS\n  // Convert mat4 to mat3 for vec3 multiplication\n  mat3 transformMat3 = mat3(transformationMatrix);\n  vec3 final = transformMat3 * vec3(p, 1);\n  #else\n  vec3 final = transformationMatrix * vec3(p, 1);\n  #endif\n\n  vec2 pointScreenPosition = (final.xy + 1.0) * screenSize / 2.0;\n  float index = pointIndices.g * pointsTextureSize + pointIndices.r;\n  rgba = vec4(index, 1.0, pointPosition.xy);\n  float i = (pointScreenPosition.x + 0.5) / screenSize.x;\n  float j = (pointScreenPosition.y + 0.5) / screenSize.y;\n  gl_Position = vec4(2.0 * vec2(i, j) - 1.0, 0.0, 1.0);\n\n  gl_PointSize = 1.0;\n}",topology:"point-list",vertexCount:s.pointsNumber??0,attributes:{...this.sampledPointIndices&&{pointIndices:this.sampledPointIndices}},bufferLayout:[{name:"pointIndices",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{fillSampledPointsUniforms:this.fillSampledPointsUniformStore.getManagedUniformBuffer(i,"fillSampledPointsUniforms")},parameters:{depthWriteEnabled:!1,depthCompare:"always"}})),this.drawHighlightedVertexCoordBuffer||(this.drawHighlightedVertexCoordBuffer=i.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.drawHighlightedUniformStore||(this.drawHighlightedUniformStore=new vo({drawHighlightedUniforms:{uniformTypes:{size:"f32",transformationMatrix:"mat4x4<f32>",pointsTextureSize:"f32",sizeScale:"f32",spaceSize:"f32",screenSize:"vec2<f32>",scalePointsOnZoom:"f32",pointIndex:"f32",maxPointSize:"f32",color:"vec4<f32>",universalPointOpacity:"f32",greyoutOpacity:"f32",isDarkenGreyout:"f32",backgroundColor:"vec4<f32>",greyoutColor:"vec4<f32>",width:"f32"},defaultUniforms:{size:1,transformationMatrix:r.transformationMatrix4x4,pointsTextureSize:r.pointsTextureSize??0,sizeScale:o.pointSizeScale??1,spaceSize:r.adjustedSpaceSize??0,screenSize:yc(r.screenSize,[0,0]),scalePointsOnZoom:o.scalePointsOnZoom??1?1:0,pointIndex:-1,maxPointSize:r.maxPointSize??100,color:[0,0,0,1],universalPointOpacity:o.pointOpacity??1,greyoutOpacity:o.pointGreyoutOpacity??-1,isDarkenGreyout:r.isDarkenGreyout?1:0,backgroundColor:bc(r.backgroundColor,[0,0,0,1]),greyoutColor:bc(r.greyoutPointColor,[0,0,0,1]),width:.85}}})),this.drawHighlightedCommand||(this.drawHighlightedCommand=new cc(i,{fs:"#version 300 es\n#ifdef GL_ES\nprecision highp float;\n#endif\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform drawHighlightedUniforms {\n  float size;\n  mat4 transformationMatrix;\n  float pointsTextureSize;\n  float sizeScale;\n  float spaceSize;\n  vec2 screenSize;\n  float scalePointsOnZoom;\n  float pointIndex;\n  float maxPointSize;\n  vec4 color;\n  float universalPointOpacity;\n  float greyoutOpacity;\n  float isDarkenGreyout;\n  vec4 backgroundColor;\n  vec4 greyoutColor;\n  float width;\n} drawHighlighted;\n\n#define width drawHighlighted.width\n#else\nuniform float width;\n#endif\n\nin vec2 vertexPosition;\nin float pointOpacity;\nin vec3 rgbColor;\n\nout vec4 fragColor;\n\nconst float smoothing = 1.05;\n\nvoid main () {\n  float r = dot(vertexPosition, vertexPosition);\n  float opacity = smoothstep(r, r * smoothing, 1.0);\n  float stroke = smoothstep(width, width * smoothing, r);\n  fragColor = vec4(rgbColor, opacity * stroke * pointOpacity);\n}",vs:"#version 300 es\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nin vec2 vertexCoord;\n\nuniform sampler2D positionsTexture;\nuniform sampler2D pointGreyoutStatusTexture;\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform drawHighlightedUniforms {\n  float size;\n  mat4 transformationMatrix;\n  float pointsTextureSize;\n  float sizeScale;\n  float spaceSize;\n  vec2 screenSize;\n  float scalePointsOnZoom;\n  float pointIndex;\n  float maxPointSize;\n  vec4 color;\n  float universalPointOpacity;\n  float greyoutOpacity;\n  float isDarkenGreyout;\n  vec4 backgroundColor;\n  vec4 greyoutColor;\n  float width;\n} drawHighlighted;\n\n#define size drawHighlighted.size\n#define transformationMatrix drawHighlighted.transformationMatrix\n#define pointsTextureSize drawHighlighted.pointsTextureSize\n#define sizeScale drawHighlighted.sizeScale\n#define spaceSize drawHighlighted.spaceSize\n#define screenSize drawHighlighted.screenSize\n#define scalePointsOnZoom drawHighlighted.scalePointsOnZoom\n#define pointIndex drawHighlighted.pointIndex\n#define maxPointSize drawHighlighted.maxPointSize\n#define color drawHighlighted.color\n#define universalPointOpacity drawHighlighted.universalPointOpacity\n#define greyoutOpacity drawHighlighted.greyoutOpacity\n#define isDarkenGreyout drawHighlighted.isDarkenGreyout\n#define backgroundColor drawHighlighted.backgroundColor\n#define greyoutColor drawHighlighted.greyoutColor\n#else\nuniform float size;\nuniform mat3 transformationMatrix;\nuniform float pointsTextureSize;\nuniform float sizeScale;\nuniform float spaceSize;\nuniform vec2 screenSize;\nuniform float scalePointsOnZoom;\nuniform float pointIndex;\nuniform float maxPointSize;\nuniform vec4 color;\nuniform float universalPointOpacity;\nuniform float greyoutOpacity;\nuniform float isDarkenGreyout;\nuniform vec4 backgroundColor;\nuniform vec4 greyoutColor;\nuniform float width;\n#endif\nout vec2 vertexPosition;\nout float pointOpacity;\nout vec3 rgbColor;\n\nfloat calculatePointSize(float pointSize) {\n  float pSize;\n\n  if (scalePointsOnZoom > 0.0) { \n    pSize = pointSize * transformationMatrix[0][0];\n  } else {\n    pSize = pointSize * min(5.0, max(1.0, transformationMatrix[0][0] * 0.01));\n  }\n\n  return min(pSize, maxPointSize);\n}\n\nconst float relativeRingRadius = 1.3;\n\nvoid main () {\n  vertexPosition = vertexCoord;\n\n  vec2 textureCoordinates = vec2(mod(pointIndex, pointsTextureSize), floor(pointIndex / pointsTextureSize)) + 0.5;\n  vec4 pointPosition = texture(positionsTexture, textureCoordinates / pointsTextureSize);\n\n  rgbColor = color.rgb;\n  pointOpacity = color.a * universalPointOpacity;\n  vec4 greyoutStatus = texture(pointGreyoutStatusTexture, textureCoordinates / pointsTextureSize);\n  if (greyoutStatus.r > 0.0) {\n    if (greyoutColor[0] != -1.0) {\n      rgbColor = greyoutColor.rgb;\n      pointOpacity = greyoutColor.a;\n    } else {\n      // If greyoutColor is not set, make color lighter or darker based on isDarkenGreyout\n      float blendFactor = 0.65; // Controls how much to modify (0.0 = original, 1.0 = target color)\n      \n      #ifdef USE_UNIFORM_BUFFERS\n      if (isDarkenGreyout > 0.0) {\n        // Darken the color\n        rgbColor = mix(rgbColor, vec3(0.2), blendFactor);\n      } else {\n        // Lighten the color\n        rgbColor = mix(rgbColor, max(backgroundColor.rgb, vec3(0.8)), blendFactor);\n      }\n      #else\n      if (isDarkenGreyout > 0.0) {\n        // Darken the color\n        rgbColor = mix(rgbColor, vec3(0.2), blendFactor);\n      } else {\n        // Lighten the color\n        rgbColor = mix(rgbColor, max(backgroundColor.rgb, vec3(0.8)), blendFactor);\n      }\n      #endif\n    }\n\n    if (greyoutOpacity != -1.0) {\n      pointOpacity *= greyoutOpacity;\n    }\n  }\n\n  // Calculate point radius\n  float pointSize = (calculatePointSize(size * sizeScale) * relativeRingRadius) / transformationMatrix[0][0];\n  float radius = pointSize * 0.5;\n\n  // Calculate point position in screen space\n  vec2 a = pointPosition.xy;\n  vec2 b = pointPosition.xy + vec2(0.0, radius);\n  vec2 xBasis = b - a;\n  vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));\n  vec2 pointPositionInScreenSpace = a + xBasis * vertexCoord.x + yBasis * radius * vertexCoord.y;\n\n  // Transform point position to normalized device coordinates\n  vec2 p = 2.0 * pointPositionInScreenSpace / spaceSize - 1.0;\n  p *= spaceSize / screenSize;\n  #ifdef USE_UNIFORM_BUFFERS\n  mat3 transformMat3 = mat3(transformationMatrix);\n  vec3 final = transformMat3 * vec3(p, 1);\n  #else\n  vec3 final = transformationMatrix * vec3(p, 1);\n  #endif\n  \n  gl_Position = vec4(final.rg, 0, 1);\n}",topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.drawHighlightedVertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{drawHighlightedUniforms:this.drawHighlightedUniformStore.getManagedUniformBuffer(i,"drawHighlightedUniforms")},parameters:{blend:!0,blendColorOperation:"add",blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaOperation:"add",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",depthWriteEnabled:!1,depthCompare:"always"}})),this.trackPointsVertexCoordBuffer||(this.trackPointsVertexCoordBuffer=i.createBuffer({data:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),this.trackPointsUniformStore||(this.trackPointsUniformStore=new vo({trackPointsUniforms:{uniformTypes:{pointsTextureSize:"f32"},defaultUniforms:{pointsTextureSize:r.pointsTextureSize??0}}})),this.trackPointsCommand||(this.trackPointsCommand=new cc(i,{fs:"#version 300 es\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D positionsTexture;\nuniform sampler2D trackedIndices;\n\n#ifdef USE_UNIFORM_BUFFERS\nlayout(std140) uniform trackPointsUniforms {\n  float pointsTextureSize;\n} trackPoints;\n\n#define pointsTextureSize trackPoints.pointsTextureSize\n#else\nuniform float pointsTextureSize;\n#endif\n\nin vec2 textureCoords;\n\nout vec4 fragColor;\n\nvoid main() {\n  vec4 trackedPointIndices = texture(trackedIndices, textureCoords);\n  if (trackedPointIndices.r < 0.0) discard;\n  vec4 pointPosition = texture(positionsTexture, (trackedPointIndices.rg + 0.5) / pointsTextureSize);\n\n  fragColor = vec4(pointPosition.rg, 1.0, 1.0);\n}\n\n",vs:fc,topology:"triangle-strip",vertexCount:4,attributes:{vertexCoord:this.trackPointsVertexCoordBuffer},bufferLayout:[{name:"vertexCoord",format:"float32x2"}],defines:{USE_UNIFORM_BUFFERS:!0},bindings:{trackPointsUniforms:this.trackPointsUniformStore.getManagedUniformBuffer(i,"trackPointsUniforms")}}))}updateColor(){var e;const{device:t,store:{pointsTextureSize:n},data:i}=this;if(!n)return;const o=i.pointColors,r=o.byteLength;this.colorBuffer&&this.colorBuffer.byteLength===r?this.colorBuffer.write(o):(null==(e=this.colorBuffer)||e.destroy(),this.colorBuffer=t.createBuffer({data:o,usage:ai.VERTEX|ai.COPY_DST})),this.drawCommand&&this.drawCommand.setAttributes({color:this.colorBuffer})}updateGreyoutStatus(){const{device:e,store:{selectedIndices:t,pointsTextureSize:n}}=this;if(!n)return;const i=new Float32Array(n*n*4).fill(t?1:0);if(t)for(const o of t)i[4*o]=0;this.greyoutStatusTexture&&this.greyoutStatusTexture.width===n&&this.greyoutStatusTexture.height===n||(this.greyoutStatusTexture&&this.greyoutStatusTexture.destroy(),this.greyoutStatusTexture=e.createTexture({width:n,height:n,format:"rgba32float"})),this.greyoutStatusTexture.copyImageData({data:i,bytesPerRow:pc("rgba32float",n),mipLevel:0,x:0,y:0})}updatePinnedStatus(){const{device:e,store:{pointsTextureSize:t},data:n}=this;if(!t)return;const i=new Float32Array(t*t*4).fill(0);if(n.inputPinnedPoints&&void 0!==n.pointsNumber)for(const o of n.inputPinnedPoints)o>=0&&o<n.pointsNumber&&(i[4*o]=1);this.pinnedStatusTexture&&this.pinnedStatusTexture.width===t&&this.pinnedStatusTexture.height===t||(this.pinnedStatusTexture&&this.pinnedStatusTexture.destroy(),this.pinnedStatusTexture=e.createTexture({width:t,height:t,format:"rgba32float"})),this.pinnedStatusTexture.copyImageData({data:i,bytesPerRow:pc("rgba32float",t),mipLevel:0,x:0,y:0})}updateSize(){var e;const{device:t,store:{pointsTextureSize:n},data:i}=this;if(!n||void 0===i.pointsNumber||void 0===i.pointSizes)return;const o=i.pointSizes,r=o.byteLength;this.sizeBuffer&&this.sizeBuffer.byteLength===r?this.sizeBuffer.write(o):(null==(e=this.sizeBuffer)||e.destroy(),this.sizeBuffer=t.createBuffer({data:o,usage:ai.VERTEX|ai.COPY_DST})),this.drawCommand&&this.drawCommand.setAttributes({size:this.sizeBuffer});const s=new Float32Array(n*n*4);for(let a=0;a<i.pointsNumber;a++)s[4*a]=i.pointSizes[a];this.sizeTexture&&this.sizeTexture.width===n&&this.sizeTexture.height===n||(this.sizeTexture&&this.sizeTexture.destroy(),this.sizeTexture=t.createTexture({width:n,height:n,format:"rgba32float"})),this.sizeTexture.copyImageData({data:s,bytesPerRow:pc("rgba32float",n),mipLevel:0,x:0,y:0})}updateShape(){var e;const{device:t,data:n}=this;if(void 0===n.pointsNumber||void 0===n.pointShapes)return;const i=n.pointShapes,o=i.byteLength;this.shapeBuffer&&this.shapeBuffer.byteLength===o?this.shapeBuffer.write(i):(null==(e=this.shapeBuffer)||e.destroy(),this.shapeBuffer=t.createBuffer({data:i,usage:ai.VERTEX|ai.COPY_DST})),this.drawCommand&&this.drawCommand.setAttributes({shape:this.shapeBuffer})}updateImageIndices(){var e;const{device:t,data:n}=this;if(void 0===n.pointsNumber||void 0===n.pointImageIndices)return;const i=n.pointImageIndices,o=i.byteLength;this.imageIndicesBuffer&&this.imageIndicesBuffer.byteLength===o?this.imageIndicesBuffer.write(i):(null==(e=this.imageIndicesBuffer)||e.destroy(),this.imageIndicesBuffer=t.createBuffer({data:i,usage:ai.VERTEX|ai.COPY_DST})),this.drawCommand&&this.drawCommand.setAttributes({imageIndex:this.imageIndicesBuffer})}updateImageSizes(){var e;const{device:t,data:n}=this;if(void 0===n.pointsNumber||void 0===n.pointImageSizes)return;const i=n.pointImageSizes,o=i.byteLength;this.imageSizesBuffer&&this.imageSizesBuffer.byteLength===o?this.imageSizesBuffer.write(i):(null==(e=this.imageSizesBuffer)||e.destroy(),this.imageSizesBuffer=t.createBuffer({data:i,usage:ai.VERTEX|ai.COPY_DST})),this.drawCommand&&this.drawCommand.setAttributes({imageSize:this.imageSizesBuffer})}createAtlas(){var e,t,n;const{device:i,data:o,store:r}=this;if(null==(e=o.inputImageData)||!e.length)return this.imageCount=0,this.imageAtlasCoordsTextureSize=0,this.imageAtlasCoordsTexture||(this.imageAtlasCoordsTexture=i.createTexture({data:new Float32Array(4).fill(0),width:1,height:1,format:"rgba32float"})),void(this.imageAtlasTexture||(this.imageAtlasTexture=i.createTexture({data:new Uint8Array(4).fill(0),width:1,height:1,format:"rgba8unorm"})));const s=function(e,t=16384){if(null==e||!e.length)return null;let n=0;for(const c of e){const e=Math.max(c.width,c.height);e>n&&(n=e)}if(0===n)return console.warn("Invalid image dimensions: all images have zero width or height"),null;const i=n,o=Math.ceil(Math.sqrt(e.length));let r=o*n,s=1;r>t&&(s=t/r,n=Math.max(1,Math.floor(n*s)),r=Math.max(1,Math.floor(r*s)),console.warn(`🖼️  Atlas scaling required: Original size ${(i*o).toLocaleString()}px exceeds WebGL limit ${t.toLocaleString()}px. Scaling down to ${r.toLocaleString()}px (${Math.round(100*s)}% of original quality)`));const a=new Uint8Array(r*r*4).fill(0),l=new Float32Array(o*o*4).fill(-1);for(const[c,u]of e.entries()){const e=u.width,t=u.height;if(0===e||0===t)continue;const i=Math.min(1,n/Math.max(e,t)),s=Math.floor(e*i),h=Math.floor(t*i),d=c%o*n,p=Math.floor(c/o)*n;l[4*c]=d/r,l[4*c+1]=p/r,l[4*c+2]=(d+s)/r,l[4*c+3]=(p+h)/r;for(let n=0;n<h;n++)for(let i=0;i<s;i++){const o=Math.floor(i*(e/s)),l=4*(Math.floor(n*(t/h))*e+o),c=4*((p+n)*r+(d+i));a[c]=u.data[l]??0,a[c+1]=u.data[l+1]??0,a[c+2]=u.data[l+2]??0,a[c+3]=u.data[l+3]??255}}return{atlasData:a,atlasSize:r,atlasCoords:l,atlasCoordsSize:o}}(o.inputImageData,r.webglMaxTextureSize);if(!s)return void console.warn("Failed to create atlas from image data");this.imageCount=o.inputImageData.length;const{atlasData:a,atlasSize:l,atlasCoords:c,atlasCoordsSize:u}=s;this.imageAtlasCoordsTextureSize=u,null==(t=this.imageAtlasTexture)||t.destroy(),this.imageAtlasTexture=i.createTexture({width:l,height:l,format:"rgba8unorm"}),this.imageAtlasTexture.copyImageData({data:a,bytesPerRow:pc("rgba8unorm",l),rowsPerImage:l,mipLevel:0,x:0,y:0}),null==(n=this.imageAtlasCoordsTexture)||n.destroy(),this.imageAtlasCoordsTexture=i.createTexture({width:u,height:u,format:"rgba32float"}),this.imageAtlasCoordsTexture.copyImageData({data:c,bytesPerRow:pc("rgba32float",u),rowsPerImage:u,mipLevel:0,x:0,y:0})}updateSampledPointsGrid(){const{store:{screenSize:e},config:{pointSamplingDistance:t},device:n}=this;let i=t??Math.min(...e)/2;0===i&&(i=zo.pointSamplingDistance);const o=Math.ceil(e[0]/i),r=Math.ceil(e[1]/i);(!this.sampledPointsFbo||this.sampledPointsFbo.width!==o||this.sampledPointsFbo.height!==r)&&(this.sampledPointsFbo&&!this.sampledPointsFbo.destroyed&&this.sampledPointsFbo.destroy(),this.sampledPointsFbo=n.createFramebuffer({width:o,height:r,colorAttachments:["rgba32float"]}))}trackPoints(){var e;if(null==(e=this.trackedIndices)||!e.length||!this.trackPointsCommand||!this.trackPointsUniformStore||!this.trackedPositionsFbo||this.trackedPositionsFbo.destroyed||!this.currentPositionTexture||this.currentPositionTexture.destroyed||!this.trackedIndicesTexture||this.trackedIndicesTexture.destroyed)return;this.trackPointsUniformStore.setUniforms({trackPointsUniforms:{pointsTextureSize:this.store.pointsTextureSize??0}}),this.trackPointsCommand.setBindings({positionsTexture:this.currentPositionTexture,trackedIndices:this.trackedIndicesTexture});const t=this.device.beginRenderPass({framebuffer:this.trackedPositionsFbo});this.trackPointsCommand.draw(t),t.end()}draw(e){var t,n;const{data:i,config:o,store:r}=this;if(this.colorBuffer||this.updateColor(),this.sizeBuffer||this.updateSize(),this.shapeBuffer||this.updateShape(),this.imageIndicesBuffer||this.updateImageIndices(),this.imageSizesBuffer||this.updateImageSizes(),!this.drawCommand||!this.drawUniformStore||!this.currentPositionTexture||this.currentPositionTexture.destroyed||!this.greyoutStatusTexture||this.greyoutStatusTexture.destroyed||(!this.imageAtlasTexture||!this.imageAtlasCoordsTexture)&&(this.createAtlas(),!this.imageAtlasTexture||!this.imageAtlasCoordsTexture)||this.imageAtlasTexture.destroyed||this.imageAtlasCoordsTexture.destroyed||!i.pointsNumber||0===i.pointsNumber||!r.screenSize||0===r.screenSize[0]||0===r.screenSize[1])return;this.drawCommand.setVertexCount(i.pointsNumber);const s={ratio:o.pixelRatio??zo.pixelRatio,transformationMatrix:r.transformationMatrix4x4,pointsTextureSize:r.pointsTextureSize??0,sizeScale:o.pointSizeScale??1,spaceSize:r.adjustedSpaceSize??0,screenSize:yc(r.screenSize,[0,0]),greyoutColor:bc(r.greyoutPointColor,[-1,-1,-1,-1]),backgroundColor:bc(r.backgroundColor,[0,0,0,1]),scalePointsOnZoom:o.scalePointsOnZoom??1?1:0,maxPointSize:r.maxPointSize??100,isDarkenGreyout:r.isDarkenGreyout?1:0,hasImages:this.imageCount>0?1:0,imageCount:this.imageCount,imageAtlasCoordsTextureSize:this.imageAtlasCoordsTextureSize??0},a={greyoutOpacity:o.pointGreyoutOpacity??-1,pointOpacity:o.pointOpacity??1,isDarkenGreyout:r.isDarkenGreyout?1:0,backgroundColor:bc(r.backgroundColor,[0,0,0,1])};if(r.selectedIndices&&r.selectedIndices.length>0?(this.drawUniformStore.setUniforms({drawVertexUniforms:{...s,skipSelected:1,skipUnselected:0},drawFragmentUniforms:a}),this.drawCommand.setBindings({positionsTexture:this.currentPositionTexture,pointGreyoutStatus:this.greyoutStatusTexture,imageAtlasTexture:this.imageAtlasTexture,imageAtlasCoords:this.imageAtlasCoordsTexture}),this.drawCommand.draw(e),this.drawUniformStore.setUniforms({drawVertexUniforms:{...s,skipSelected:0,skipUnselected:1},drawFragmentUniforms:a}),this.drawCommand.setBindings({positionsTexture:this.currentPositionTexture,pointGreyoutStatus:this.greyoutStatusTexture,imageAtlasTexture:this.imageAtlasTexture,imageAtlasCoords:this.imageAtlasCoordsTexture}),this.drawCommand.draw(e)):(this.drawUniformStore.setUniforms({drawVertexUniforms:{...s,skipSelected:0,skipUnselected:0},drawFragmentUniforms:a}),this.drawCommand.setBindings({positionsTexture:this.currentPositionTexture,pointGreyoutStatus:this.greyoutStatusTexture,imageAtlasTexture:this.imageAtlasTexture,imageAtlasCoords:this.imageAtlasCoordsTexture}),this.drawCommand.draw(e)),o.renderHoveredPointRing&&r.hoveredPoint&&this.drawHighlightedCommand&&this.drawHighlightedUniformStore){if(!this.currentPositionTexture||this.currentPositionTexture.destroyed||!this.greyoutStatusTexture||this.greyoutStatusTexture.destroyed)return;const n=(null==(t=i.pointSizes)?void 0:t[r.hoveredPoint.index])??1;this.drawHighlightedUniformStore.setUniforms({drawHighlightedUniforms:{size:n,transformationMatrix:r.transformationMatrix4x4,pointsTextureSize:r.pointsTextureSize??0,sizeScale:o.pointSizeScale??1,spaceSize:r.adjustedSpaceSize??0,screenSize:yc(r.screenSize,[0,0]),scalePointsOnZoom:o.scalePointsOnZoom??1?1:0,pointIndex:r.hoveredPoint.index,maxPointSize:r.maxPointSize??100,color:bc(r.hoveredPointRingColor,[0,0,0,1]),universalPointOpacity:o.pointOpacity??1,greyoutOpacity:o.pointGreyoutOpacity??-1,isDarkenGreyout:r.isDarkenGreyout?1:0,backgroundColor:bc(r.backgroundColor,[0,0,0,1]),greyoutColor:bc(r.greyoutPointColor,[0,0,0,1]),width:.85}}),this.drawHighlightedCommand.setBindings({positionsTexture:this.currentPositionTexture,pointGreyoutStatusTexture:this.greyoutStatusTexture}),this.drawHighlightedCommand.draw(e)}if(r.focusedPoint&&this.drawHighlightedCommand&&this.drawHighlightedUniformStore){if(!this.currentPositionTexture||this.currentPositionTexture.destroyed||!this.greyoutStatusTexture||this.greyoutStatusTexture.destroyed)return;const t=(null==(n=i.pointSizes)?void 0:n[r.focusedPoint.index])??1;this.drawHighlightedUniformStore.setUniforms({drawHighlightedUniforms:{size:t,transformationMatrix:r.transformationMatrix4x4,pointsTextureSize:r.pointsTextureSize??0,sizeScale:o.pointSizeScale??1,spaceSize:r.adjustedSpaceSize??0,screenSize:yc(r.screenSize,[0,0]),scalePointsOnZoom:o.scalePointsOnZoom??1?1:0,pointIndex:r.focusedPoint.index,maxPointSize:r.maxPointSize??100,color:bc(r.focusedPointRingColor,[0,0,0,1]),universalPointOpacity:o.pointOpacity??1,greyoutOpacity:o.pointGreyoutOpacity??-1,isDarkenGreyout:r.isDarkenGreyout?1:0,backgroundColor:bc(r.backgroundColor,[0,0,0,1]),greyoutColor:bc(r.greyoutPointColor,[0,0,0,1]),width:.85}}),this.drawHighlightedCommand.setBindings({positionsTexture:this.currentPositionTexture,pointGreyoutStatusTexture:this.greyoutStatusTexture}),this.drawHighlightedCommand.draw(e)}}updatePosition(){if(!this.updatePositionCommand||!this.updatePositionUniformStore||!this.currentPositionFbo||this.currentPositionFbo.destroyed||!this.previousPositionTexture||this.previousPositionTexture.destroyed||!this.velocityTexture||this.velocityTexture.destroyed||!this.pinnedStatusTexture||this.pinnedStatusTexture.destroyed)return;this.updatePositionUniformStore.setUniforms({updatePositionUniforms:{friction:this.config.simulationFriction??0,spaceSize:this.store.adjustedSpaceSize??0}}),this.updatePositionCommand.setBindings({positionsTexture:this.previousPositionTexture,velocity:this.velocityTexture,pinnedStatusTexture:this.pinnedStatusTexture});const e=this.device.beginRenderPass({framebuffer:this.currentPositionFbo});this.updatePositionCommand.draw(e),e.end(),this.swapFbo(),this.isPositionsUpToDate=!1}drag(){var e;if(!this.dragPointCommand||!this.dragPointUniformStore||!this.currentPositionFbo||this.currentPositionFbo.destroyed||!this.previousPositionTexture||this.previousPositionTexture.destroyed)return;this.dragPointUniformStore.setUniforms({dragPointUniforms:{mousePos:yc(this.store.mousePosition,[0,0]),index:(null==(e=this.store.hoveredPoint)?void 0:e.index)??-1}}),this.dragPointCommand.setBindings({positionsTexture:this.previousPositionTexture});const t=this.device.beginRenderPass({framebuffer:this.currentPositionFbo});this.dragPointCommand.draw(t),t.end(),this.swapFbo(),this.isPositionsUpToDate=!1}findPointsOnAreaSelection(){var e,t;if(!this.findPointsOnAreaSelectionCommand||!this.findPointsOnAreaSelectionUniformStore||!this.selectedFbo||this.selectedFbo.destroyed||!this.currentPositionTexture||this.currentPositionTexture.destroyed||!this.sizeTexture||this.sizeTexture.destroyed)return;this.findPointsOnAreaSelectionUniformStore.setUniforms({findPointsOnAreaSelectionUniforms:{spaceSize:this.store.adjustedSpaceSize??0,screenSize:yc(this.store.screenSize,[0,0]),sizeScale:this.config.pointSizeScale??1,transformationMatrix:this.store.transformationMatrix4x4,ratio:this.config.pixelRatio??zo.pixelRatio,selection0:yc(null==(e=this.store.selectedArea)?void 0:e[0],[0,0]),selection1:yc(null==(t=this.store.selectedArea)?void 0:t[1],[0,0]),scalePointsOnZoom:this.config.scalePointsOnZoom??1?1:0,maxPointSize:this.store.maxPointSize??100}}),this.findPointsOnAreaSelectionCommand.setBindings({positionsTexture:this.currentPositionTexture,pointSize:this.sizeTexture});const n=this.device.beginRenderPass({framebuffer:this.selectedFbo});this.findPointsOnAreaSelectionCommand.draw(n),n.end()}findPointsOnPolygonSelection(){if(!this.findPointsOnPolygonSelectionCommand||!this.findPointsOnPolygonSelectionUniformStore||!this.selectedFbo||this.selectedFbo.destroyed||!this.currentPositionTexture||this.currentPositionTexture.destroyed||!this.polygonPathTexture||this.polygonPathTexture.destroyed)return;this.findPointsOnPolygonSelectionUniformStore.setUniforms({findPointsOnPolygonSelectionUniforms:{spaceSize:this.store.adjustedSpaceSize??0,screenSize:yc(this.store.screenSize,[0,0]),transformationMatrix:this.store.transformationMatrix4x4,polygonPathLength:this.polygonPathLength}}),this.findPointsOnPolygonSelectionCommand.setBindings({positionsTexture:this.currentPositionTexture,polygonPathTexture:this.polygonPathTexture});const e=this.device.beginRenderPass({framebuffer:this.selectedFbo});this.findPointsOnPolygonSelectionCommand.draw(e),e.end()}updatePolygonPath(e){const{device:t}=this;if(this.polygonPathLength=e.length,0===e.length)return this.polygonPathTexture&&!this.polygonPathTexture.destroyed&&this.polygonPathTexture.destroy(),void(this.polygonPathTexture=void 0);const n=Math.ceil(Math.sqrt(e.length)),i=new Float32Array(n*n*4);for(const[o,r]of e.entries()){const[e,t]=r;i[4*o]=e,i[4*o+1]=t,i[4*o+2]=0,i[4*o+3]=0}this.polygonPathTexture&&this.polygonPathTexture.width===n&&this.polygonPathTexture.height===n||(this.polygonPathTexture&&!this.polygonPathTexture.destroyed&&this.polygonPathTexture.destroy(),this.polygonPathTexture=t.createTexture({width:n,height:n,format:"rgba32float"})),this.polygonPathTexture.copyImageData({data:i,bytesPerRow:pc("rgba32float",n),mipLevel:0,x:0,y:0})}findHoveredPoint(){if(!this.hoveredFbo||this.hoveredFbo.destroyed||!this.findHoveredPointCommand||!this.findHoveredPointUniformStore||!this.currentPositionTexture||this.currentPositionTexture.destroyed)return;this.findHoveredPointCommand.setVertexCount(this.data.pointsNumber??0),this.findHoveredPointCommand.setAttributes({...this.hoveredPointIndices&&{pointIndices:this.hoveredPointIndices},...this.sizeBuffer&&{size:this.sizeBuffer}}),this.findHoveredPointUniformStore.setUniforms({findHoveredPointUniforms:{ratio:this.config.pixelRatio??zo.pixelRatio,sizeScale:this.config.pointSizeScale??1,pointsTextureSize:this.store.pointsTextureSize??0,transformationMatrix:this.store.transformationMatrix4x4,spaceSize:this.store.adjustedSpaceSize??0,screenSize:yc(this.store.screenSize,[0,0]),scalePointsOnZoom:this.config.scalePointsOnZoom??1?1:0,mousePosition:yc(this.store.screenMousePosition,[0,0]),maxPointSize:this.store.maxPointSize??100}}),this.findHoveredPointCommand.setBindings({positionsTexture:this.currentPositionTexture});const e=this.device.beginRenderPass({framebuffer:this.hoveredFbo,clearColor:[0,0,0,0]});this.findHoveredPointCommand.draw(e),e.end()}trackPointsByIndices(e){const{store:{pointsTextureSize:t},device:n}=this;if(this.trackedIndices=e,this.trackedPositions=void 0,this.isPositionsUpToDate=!1,null==e||!e.length||!t)return;const i=Math.ceil(Math.sqrt(e.length)),o=new Float32Array(i*i*4).fill(-1);for(const[r,s]of e.entries())void 0!==s&&(o[4*r]=s%t,o[4*r+1]=Math.floor(s/t),o[4*r+2]=0,o[4*r+3]=0);this.trackedIndicesTexture&&this.trackedIndicesTexture.width===i&&this.trackedIndicesTexture.height===i||(this.trackedIndicesTexture&&!this.trackedIndicesTexture.destroyed&&this.trackedIndicesTexture.destroy(),this.trackedIndicesTexture=n.createTexture({width:i,height:i,format:"rgba32float"})),this.trackedIndicesTexture.copyImageData({data:o,bytesPerRow:pc("rgba32float",i),mipLevel:0,x:0,y:0}),(!this.trackedPositionsFbo||this.trackedPositionsFbo.width!==i||this.trackedPositionsFbo.height!==i)&&(this.trackedPositionsFbo&&!this.trackedPositionsFbo.destroyed&&this.trackedPositionsFbo.destroy(),this.trackedPositionsFbo=n.createFramebuffer({width:i,height:i,colorAttachments:["rgba32float"]})),this.trackPoints()}getTrackedPositionsMap(){if(!this.trackedIndices)return new Map;const{config:{enableSimulation:e},store:{isSimulationRunning:t}}=this;if((!e||!t)&&this.isPositionsUpToDate&&this.trackedPositions)return this.trackedPositions;if(!this.trackedPositionsFbo||this.trackedPositionsFbo.destroyed)return new Map;const n=$r(this.device,this.trackedPositionsFbo),i=new Map;for(let o=0;o<n.length/4;o+=1){const e=n[4*o],t=n[4*o+1],r=this.trackedIndices[o];void 0!==e&&void 0!==t&&void 0!==r&&i.set(r,[e,t])}return(!e||!t)&&(this.trackedPositions=i,this.isPositionsUpToDate=!0),i}getSampledPointPositionsMap(){const e=new Map;if(!this.sampledPointsFbo||this.sampledPointsFbo.destroyed)return e;if(this.fillSampledPointsFboCommand&&this.fillSampledPointsUniformStore&&this.sampledPointsFbo){if(!this.currentPositionTexture||this.currentPositionTexture.destroyed)return e;this.fillSampledPointsFboCommand.setVertexCount(this.data.pointsNumber??0),this.fillSampledPointsUniformStore.setUniforms({fillSampledPointsUniforms:{pointsTextureSize:this.store.pointsTextureSize??0,transformationMatrix:this.store.transformationMatrix4x4,spaceSize:this.store.adjustedSpaceSize??0,screenSize:yc(this.store.screenSize,[0,0])}}),this.fillSampledPointsFboCommand.setBindings({positionsTexture:this.currentPositionTexture});const t=this.device.beginRenderPass({framebuffer:this.sampledPointsFbo,clearColor:[0,0,0,0]});this.fillSampledPointsFboCommand.draw(t),t.end()}const t=$r(this.device,this.sampledPointsFbo);for(let n=0;n<t.length/4;n++){const i=t[4*n],o=!!t[4*n+1],r=t[4*n+2],s=t[4*n+3];o&&void 0!==i&&void 0!==r&&void 0!==s&&e.set(i,[r,s])}return e}getSampledPoints(){const e=[],t=[];if(!this.sampledPointsFbo||this.sampledPointsFbo.destroyed)return{indices:e,positions:t};if(this.fillSampledPointsFboCommand&&this.fillSampledPointsUniformStore&&this.sampledPointsFbo){if(!this.currentPositionTexture||this.currentPositionTexture.destroyed)return{indices:e,positions:t};this.fillSampledPointsFboCommand.setVertexCount(this.data.pointsNumber??0),this.fillSampledPointsUniformStore.setUniforms({fillSampledPointsUniforms:{pointsTextureSize:this.store.pointsTextureSize??0,transformationMatrix:this.store.transformationMatrix4x4,spaceSize:this.store.adjustedSpaceSize??0,screenSize:yc(this.store.screenSize,[0,0])}}),this.fillSampledPointsFboCommand.setBindings({positionsTexture:this.currentPositionTexture});const n=this.device.beginRenderPass({framebuffer:this.sampledPointsFbo,clearColor:[0,0,0,0]});this.fillSampledPointsFboCommand.draw(n),n.end()}const n=$r(this.device,this.sampledPointsFbo);for(let i=0;i<n.length/4;i++){const o=n[4*i],r=!!n[4*i+1],s=n[4*i+2],a=n[4*i+3];r&&void 0!==o&&void 0!==s&&void 0!==a&&(e.push(o),t.push(s,a))}return{indices:e,positions:t}}getTrackedPositionsArray(){const e=[];if(!this.trackedIndices||!this.trackedPositionsFbo||this.trackedPositionsFbo.destroyed)return e;e.length=2*this.trackedIndices.length;const t=$r(this.device,this.trackedPositionsFbo);for(let n=0;n<t.length/4;n+=1){const i=t[4*n],o=t[4*n+1],r=this.trackedIndices[n];void 0!==i&&void 0!==o&&void 0!==r&&(e[2*n]=i,e[2*n+1]=o)}return e}destroy(){var e,t,n,i,o,r,s,a,l,c,u,h,d,p,f,m,_,g;null==(e=this.drawCommand)||e.destroy(),this.drawCommand=void 0,null==(t=this.drawHighlightedCommand)||t.destroy(),this.drawHighlightedCommand=void 0,null==(n=this.updatePositionCommand)||n.destroy(),this.updatePositionCommand=void 0,null==(i=this.dragPointCommand)||i.destroy(),this.dragPointCommand=void 0,null==(o=this.findPointsOnAreaSelectionCommand)||o.destroy(),this.findPointsOnAreaSelectionCommand=void 0,null==(r=this.findPointsOnPolygonSelectionCommand)||r.destroy(),this.findPointsOnPolygonSelectionCommand=void 0,null==(s=this.findHoveredPointCommand)||s.destroy(),this.findHoveredPointCommand=void 0,null==(a=this.fillSampledPointsFboCommand)||a.destroy(),this.fillSampledPointsFboCommand=void 0,null==(l=this.trackPointsCommand)||l.destroy(),this.trackPointsCommand=void 0,this.currentPositionFbo&&!this.currentPositionFbo.destroyed&&this.currentPositionFbo.destroy(),this.currentPositionFbo=void 0,this.previousPositionFbo&&!this.previousPositionFbo.destroyed&&this.previousPositionFbo.destroy(),this.previousPositionFbo=void 0,this.velocityFbo&&!this.velocityFbo.destroyed&&this.velocityFbo.destroy(),this.velocityFbo=void 0,this.selectedFbo&&!this.selectedFbo.destroyed&&this.selectedFbo.destroy(),this.selectedFbo=void 0,this.hoveredFbo&&!this.hoveredFbo.destroyed&&this.hoveredFbo.destroy(),this.hoveredFbo=void 0,this.trackedPositionsFbo&&!this.trackedPositionsFbo.destroyed&&this.trackedPositionsFbo.destroy(),this.trackedPositionsFbo=void 0,this.sampledPointsFbo&&!this.sampledPointsFbo.destroyed&&this.sampledPointsFbo.destroy(),this.sampledPointsFbo=void 0,this.currentPositionTexture&&!this.currentPositionTexture.destroyed&&this.currentPositionTexture.destroy(),this.currentPositionTexture=void 0,this.previousPositionTexture&&!this.previousPositionTexture.destroyed&&this.previousPositionTexture.destroy(),this.previousPositionTexture=void 0,this.velocityTexture&&!this.velocityTexture.destroyed&&this.velocityTexture.destroy(),this.velocityTexture=void 0,this.selectedTexture&&!this.selectedTexture.destroyed&&this.selectedTexture.destroy(),this.selectedTexture=void 0,this.greyoutStatusTexture&&!this.greyoutStatusTexture.destroyed&&this.greyoutStatusTexture.destroy(),this.greyoutStatusTexture=void 0,this.sizeTexture&&!this.sizeTexture.destroyed&&this.sizeTexture.destroy(),this.sizeTexture=void 0,this.trackedIndicesTexture&&!this.trackedIndicesTexture.destroyed&&this.trackedIndicesTexture.destroy(),this.trackedIndicesTexture=void 0,this.polygonPathTexture&&!this.polygonPathTexture.destroyed&&this.polygonPathTexture.destroy(),this.polygonPathTexture=void 0,this.imageAtlasTexture&&!this.imageAtlasTexture.destroyed&&this.imageAtlasTexture.destroy(),this.imageAtlasTexture=void 0,this.imageAtlasCoordsTexture&&!this.imageAtlasCoordsTexture.destroyed&&this.imageAtlasCoordsTexture.destroy(),this.imageAtlasCoordsTexture=void 0,this.pinnedStatusTexture&&!this.pinnedStatusTexture.destroyed&&this.pinnedStatusTexture.destroy(),this.pinnedStatusTexture=void 0,null==(c=this.updatePositionUniformStore)||c.destroy(),this.updatePositionUniformStore=void 0,null==(u=this.dragPointUniformStore)||u.destroy(),this.dragPointUniformStore=void 0,null==(h=this.drawUniformStore)||h.destroy(),this.drawUniformStore=void 0,null==(d=this.findPointsOnAreaSelectionUniformStore)||d.destroy(),this.findPointsOnAreaSelectionUniformStore=void 0,null==(p=this.findPointsOnPolygonSelectionUniformStore)||p.destroy(),this.findPointsOnPolygonSelectionUniformStore=void 0,null==(f=this.findHoveredPointUniformStore)||f.destroy(),this.findHoveredPointUniformStore=void 0,null==(m=this.fillSampledPointsUniformStore)||m.destroy(),this.fillSampledPointsUniformStore=void 0,null==(_=this.drawHighlightedUniformStore)||_.destroy(),this.drawHighlightedUniformStore=void 0,null==(g=this.trackPointsUniformStore)||g.destroy(),this.trackPointsUniformStore=void 0,this.colorBuffer&&!this.colorBuffer.destroyed&&this.colorBuffer.destroy(),this.colorBuffer=void 0,this.sizeBuffer&&!this.sizeBuffer.destroyed&&this.sizeBuffer.destroy(),this.sizeBuffer=void 0,this.shapeBuffer&&!this.shapeBuffer.destroyed&&this.shapeBuffer.destroy(),this.shapeBuffer=void 0,this.imageIndicesBuffer&&!this.imageIndicesBuffer.destroyed&&this.imageIndicesBuffer.destroy(),this.imageIndicesBuffer=void 0,this.imageSizesBuffer&&!this.imageSizesBuffer.destroyed&&this.imageSizesBuffer.destroy(),this.imageSizesBuffer=void 0,this.drawPointIndices&&!this.drawPointIndices.destroyed&&this.drawPointIndices.destroy(),this.drawPointIndices=void 0,this.hoveredPointIndices&&!this.hoveredPointIndices.destroyed&&this.hoveredPointIndices.destroy(),this.hoveredPointIndices=void 0,this.sampledPointIndices&&!this.sampledPointIndices.destroyed&&this.sampledPointIndices.destroy(),this.sampledPointIndices=void 0,this.updatePositionVertexCoordBuffer&&!this.updatePositionVertexCoordBuffer.destroyed&&this.updatePositionVertexCoordBuffer.destroy(),this.updatePositionVertexCoordBuffer=void 0,this.dragPointVertexCoordBuffer&&!this.dragPointVertexCoordBuffer.destroyed&&this.dragPointVertexCoordBuffer.destroy(),this.dragPointVertexCoordBuffer=void 0,this.findPointsOnAreaSelectionVertexCoordBuffer&&!this.findPointsOnAreaSelectionVertexCoordBuffer.destroyed&&this.findPointsOnAreaSelectionVertexCoordBuffer.destroy(),this.findPointsOnAreaSelectionVertexCoordBuffer=void 0,this.findPointsOnPolygonSelectionVertexCoordBuffer&&!this.findPointsOnPolygonSelectionVertexCoordBuffer.destroyed&&this.findPointsOnPolygonSelectionVertexCoordBuffer.destroy(),this.findPointsOnPolygonSelectionVertexCoordBuffer=void 0,this.drawHighlightedVertexCoordBuffer&&!this.drawHighlightedVertexCoordBuffer.destroyed&&this.drawHighlightedVertexCoordBuffer.destroy(),this.drawHighlightedVertexCoordBuffer=void 0,this.trackPointsVertexCoordBuffer&&!this.trackPointsVertexCoordBuffer.destroyed&&this.trackPointsVertexCoordBuffer.destroy(),this.trackPointsVertexCoordBuffer=void 0}swapFbo(){if(!this.currentPositionTexture||this.currentPositionTexture.destroyed||!this.previousPositionTexture||this.previousPositionTexture.destroyed||!this.currentPositionFbo||this.currentPositionFbo.destroyed||!this.previousPositionFbo||this.previousPositionFbo.destroyed)return;const e=this.previousPositionTexture,t=this.previousPositionFbo;this.previousPositionTexture=this.currentPositionTexture,this.previousPositionFbo=this.currentPositionFbo,this.currentPositionTexture=e,this.currentPositionFbo=t}rescaleInitialNodePositions(){const{config:{spaceSize:e}}=this;if(!this.data.pointPositions||!e)return;const t=this.data.pointPositions,n=t.length/2;let i=1/0,o=-1/0,r=1/0,s=-1/0;for(let p=0;p<t.length;p+=2){const e=t[p],n=t[p+1];i=Math.min(i,e),o=Math.max(o,e),r=Math.min(r,n),s=Math.max(s,n)}const a=o-i,l=s-r,c=Math.max(a,l);if(c>e)return this.scaleX=void 0,void(this.scaleY=void 0);const u=(n>e*e*.001?e*Math.max(1.2,Math.sqrt(n)/e):.1*e)/c,h=(c-a)/2*u,d=(c-l)/2*u;this.scaleX=e=>(e-i)*u+h,this.scaleY=e=>(e-r)*u+d;for(let p=0;p<n;p++)this.data.pointPositions[2*p]=this.scaleX(t[2*p]),this.data.pointPositions[2*p+1]=this.scaleY(t[2*p+1])}}var vu=typeof Float32Array<"u"?Float32Array:Array;function xu(e,t,n){var i=t[0],o=t[1],r=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=n[0],p=n[1];return e[0]=i,e[1]=o,e[2]=r,e[3]=s,e[4]=a,e[5]=l,e[6]=d*i+p*s+c,e[7]=d*o+p*a+u,e[8]=d*r+p*l+h,e}function wu(e,t,n){var i=n[0],o=n[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=o*t[3],e[4]=o*t[4],e[5]=o*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Su,Eu={exports:{}};var Tu,Cu,Iu,Au,ku,Lu={exports:{}},Ru={exports:{}},Pu={exports:{}},Du={exports:{}},Mu={exports:{}},Nu={exports:{}};const Ou=Cc(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var Bu,Fu,zu,Uu=Nu.exports;function $u(){return Bu||(Bu=1,function(e){!function(t,n,i){var o,r=256,s="random",a=i.pow(r,6),l=i.pow(2,52),c=2*l,u=255;function h(e,u,h){var g=[],y=m(f((u=1==u?{entropy:!0}:u||{}).entropy?[e,_(n)]:e??function(){try{var e;return o&&(e=o.randomBytes)?e=e(r):(e=new Uint8Array(r),(t.crypto||t.msCrypto).getRandomValues(e)),_(e)}catch{var i=t.navigator,s=i&&i.plugins;return[+new Date,t,s,t.screen,_(n)]}}(),3),g),b=new d(g),v=function(){for(var e=b.g(6),t=a,n=0;e<l;)e=(e+n)*r,t*=r,n=b.g(1);for(;e>=c;)e/=2,t/=2,n>>>=1;return(e+n)/t};return v.int32=function(){return 0|b.g(4)},v.quick=function(){return b.g(4)/4294967296},v.double=v,m(_(b.S),n),(u.pass||h||function(e,t,n,o){return o&&(o.S&&p(o,b),e.state=function(){return p(b,{})}),n?(i[s]=e,t):e})(v,y,"global"in u?u.global:this==i,u.state)}function d(e){var t,n=e.length,i=this,o=0,s=i.i=i.j=0,a=i.S=[];for(n||(e=[n++]);o<r;)a[o]=o++;for(o=0;o<r;o++)a[o]=a[s=u&s+e[o%n]+(t=a[o])],a[s]=t;(i.g=function(e){for(var t,n=0,o=i.i,s=i.j,a=i.S;e--;)t=a[o=u&o+1],n=n*r+a[u&(a[o]=a[s=u&s+t])+(a[s]=t)];return i.i=o,i.j=s,n})(r)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function f(e,t){var n,i=[],o=typeof e;if(t&&"object"==o)for(n in e)try{i.push(f(e[n],t-1))}catch{}return i.length?i:"string"==o?e:e+"\0"}function m(e,t){for(var n,i=e+"",o=0;o<i.length;)t[u&o]=u&(n^=19*t[u&o])+i.charCodeAt(o++);return _(t)}function _(e){return String.fromCharCode.apply(0,e)}if(m(i.random(),n),e.exports){e.exports=h;try{o=Ou}catch{}}else i["seed"+s]=h}(typeof self<"u"?self:Uu,[],Math)}(Nu)),Nu.exports}var Vu=function(){if(zu)return Fu;zu=1;var e=(Su||(Su=1,function(e,t){function n(e){var t=this,n=function(){var e=4022871197;return function(t){t=String(t);for(var n=0;n<t.length;n++){var i=.02519603282416938*(e+=t.charCodeAt(n));i-=e=i>>>0,e=(i*=e)>>>0,e+=4294967296*(i-=e)}return 2.3283064365386963e-10*(e>>>0)}}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function i(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var o=new n(e),r=t&&t.state,s=o.next;return s.int32=function(){return 4294967296*o.next()|0},s.double=function(){return s()+11102230246251565e-32*(2097152*s()|0)},s.quick=s,r&&("object"==typeof r&&i(r,o),s.state=function(){return i(o,{})}),s}t&&t.exports?t.exports=o:this.alea=o}(0,Eu)),Eu.exports),t=(Tu||(Tu=1,function(e,t){function n(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var i=0;i<n.length+64;i++)t.x^=0|n.charCodeAt(i),t.next()}function i(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var o=new n(e),r=t&&t.state,s=function(){return(o.next()>>>0)/4294967296};return s.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=o.next,s.quick=s,r&&("object"==typeof r&&i(r,o),s.state=function(){return i(o,{})}),s}t&&t.exports?t.exports=o:this.xor128=o}(0,Lu)),Lu.exports),n=(Cu||(Cu=1,function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var i=0;i<n.length+64;i++)t.x^=0|n.charCodeAt(i),i==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function i(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var o=new n(e),r=t&&t.state,s=function(){return(o.next()>>>0)/4294967296};return s.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=o.next,s.quick=s,r&&("object"==typeof r&&i(r,o),s.state=function(){return i(o,{})}),s}t&&t.exports?t.exports=o:this.xorwow=o}(0,Ru)),Ru.exports),i=(Iu||(Iu=1,function(e,t){function n(e){var t=this;t.next=function(){var e,n,i=t.x,o=t.i;return e=i[o],n=(e^=e>>>7)^e<<24,n^=(e=i[o+1&7])^e>>>10,n^=(e=i[o+3&7])^e>>>3,n^=(e=i[o+4&7])^e<<7,e=i[o+7&7],n^=(e^=e<<13)^e<<9,i[o]=n,t.i=o+1&7,n},function(e,t){var n,i=[];if(t===(0|t))i[0]=t;else for(t=""+t,n=0;n<t.length;++n)i[7&n]=i[7&n]<<15^t.charCodeAt(n)+i[n+1&7]<<13;for(;i.length<8;)i.push(0);for(n=0;n<8&&0===i[n];++n);for(8==n?i[7]=-1:i[n],e.x=i,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function i(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var o=new n(e),r=t&&t.state,s=function(){return(o.next()>>>0)/4294967296};return s.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=o.next,s.quick=s,r&&(r.x&&i(r,o),s.state=function(){return i(o,{})}),s}t&&t.exports?t.exports=o:this.xorshift7=o}(0,Pu)),Pu.exports),o=(Au||(Au=1,function(e,t){function n(e){var t=this;t.next=function(){var e,n,i=t.w,o=t.X,r=t.i;return t.w=i=i+1640531527|0,n=o[r+34&127],e=o[r=r+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=o[r]=n^e,t.i=r,n+(i^i>>>16)|0},function(e,t){var n,i,o,r,s,a=[],l=128;for(t===(0|t)?(i=t,t=null):(t+="\0",i=0,l=Math.max(l,t.length)),o=0,r=-32;r<l;++r)t&&(i^=t.charCodeAt((r+32)%t.length)),0===r&&(s=i),i^=i<<10,i^=i>>>15,i^=i<<4,i^=i>>>13,r>=0&&(s=s+1640531527|0,o=0==(n=a[127&r]^=i+s)?o+1:0);for(o>=128&&(a[127&(t&&t.length||0)]=-1),o=127,r=512;r>0;--r)i=a[o+34&127],n=a[o=o+1&127],i^=i<<13,n^=n<<17,i^=i>>>15,n^=n>>>12,a[o]=i^n;e.w=s,e.X=a,e.i=o}(t,e)}function i(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var o=new n(e),r=t&&t.state,s=function(){return(o.next()>>>0)/4294967296};return s.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=o.next,s.quick=s,r&&(r.X&&i(r,o),s.state=function(){return i(o,{})}),s}t&&t.exports?t.exports=o:this.xor4096=o}(0,Du)),Du.exports),r=(ku||(ku=1,function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,i=t.d,o=t.a;return e=e<<25^e>>>7^n,n=n-i|0,i=i<<24^i>>>8^o,o=o-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-i|0,t.d=i<<16^n>>>16^o,t.a=o-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var i=0;i<n.length+20;i++)t.b^=0|n.charCodeAt(i),t.next()}function i(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var o=new n(e),r=t&&t.state,s=function(){return(o.next()>>>0)/4294967296};return s.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=o.next,s.quick=s,r&&("object"==typeof r&&i(r,o),s.state=function(){return i(o,{})}),s}t&&t.exports?t.exports=o:this.tychei=o}(0,Mu)),Mu.exports),s=$u();return s.alea=e,s.xor128=t,s.xorwow=n,s.xorshift7=i,s.xor4096=o,s.tychei=r,Fu=s}();const Hu=Tc(Vu);function Gu(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Yu(i.key),i)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Wu(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,ju(e,t)}function ju(e,t){return(ju=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function Yu(e){var t=function(e){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}var qu=function(){function e(){}return e.prototype._seed=function(e,t){if(e===(e||0))return e;for(var n=""+e,i=0,o=0;o<n.length;++o)i^=0|n.charCodeAt(o);return i},e}(),Xu=function(e){function t(t,n){var i;return(i=e.call(this)||this)._rng=void 0,i.seed(t,n),i}Wu(t,e);var n=t.prototype;return n.next=function(){return this._rng()},n.seed=function(e,t){this._rng=e},n.clone=function(e,n){return new t(this._rng,n)},Gu(t,[{key:"name",get:function(){return"function"}}]),t}(qu),Ku=function(){var e=[].slice.call(arguments),t=e[0],n=void 0===t?"default":t;switch(typeof n){case"object":if(n instanceof qu)return n;break;case"function":return new Xu(n);default:return new Xu(Hu.apply(void 0,e))}throw new Error('invalid RNG "'+n+'"')},Zu=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=1),function(){return e.next()*(n-t)+t}};function Qu(e){return new Ju(e)}var Ju=function(e){var t=this;this.n=void 0,this.isInt=function(){if(Number.isInteger(t.n))return t;throw new Error("Expected number to be an integer, got "+t.n)},this.isPositive=function(){if(t.n>0)return t;throw new Error("Expected number to be positive, got "+t.n)},this.lessThan=function(e){if(t.n<e)return t;throw new Error("Expected number to be less than "+e+", got "+t.n)},this.greaterThanOrEqual=function(e){if(t.n>=e)return t;throw new Error("Expected number to be greater than or equal to "+e+", got "+t.n)},this.greaterThan=function(e){if(t.n>e)return t;throw new Error("Expected number to be greater than "+e+", got "+t.n)},this.n=e},eh=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=1),void 0===n&&(n=void 0===t?1:t,t=0),Qu(t).isInt(),Qu(n).isInt(),function(){return Math.floor(e.next()*(n-t+1)+t)}},th=function(e){return function(){return e.next()>=.5}},nh=[0,0,.6931471805599453,1.791759469228055,3.1780538303479458,4.787491742782046,6.579251212010101,8.525161361065415,10.60460290274525,12.801827480081469],ih=function(e){return nh[e]},oh=function(e){function t(){return e.apply(this,arguments)||this}Wu(t,e);var n=t.prototype;return n.next=function(){return Math.random()},n.seed=function(e,t){},n.clone=function(){return new t},Gu(t,[{key:"name",get:function(){return"default"}}]),t}(qu),rh=function(){function e(e){var t=this;this._rng=void 0,this._patch=void 0,this._cache={},this.next=function(){return t._rng.next()},this.float=function(e,n){return t.uniform(e,n)()},this.int=function(e,n){return t.uniformInt(e,n)()},this.integer=function(e,n){return t.uniformInt(e,n)()},this.bool=function(){return t.uniformBoolean()()},this.boolean=function(){return t.uniformBoolean()()},this.uniform=function(e,n){return t._memoize("uniform",Zu,e,n)},this.uniformInt=function(e,n){return t._memoize("uniformInt",eh,e,n)},this.uniformBoolean=function(){return t._memoize("uniformBoolean",th)},this.normal=function(e,n){return function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=1),function(){var i,o,r;do{r=(i=2*e.next()-1)*i+(o=2*e.next()-1)*o}while(!r||r>1);return t+n*o*Math.sqrt(-2*Math.log(r)/r)}}(t,e,n)},this.logNormal=function(e,n){return function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=1);var i=e.normal(t,n);return function(){return Math.exp(i())}}(t,e,n)},this.bernoulli=function(e){return function(e,t){return void 0===t&&(t=.5),Qu(t).greaterThanOrEqual(0).lessThan(1),function(){return Math.floor(e.next()+t)}}(t,e)},this.binomial=function(e,n){return function(e,t,n){return void 0===t&&(t=1),void 0===n&&(n=.5),Qu(t).isInt().isPositive(),Qu(n).greaterThanOrEqual(0).lessThan(1),function(){for(var i=0,o=0;i++<t;)e.next()<n&&o++;return o}}(t,e,n)},this.geometric=function(e){return function(e,t){void 0===t&&(t=.5),Qu(t).greaterThan(0).lessThan(1);var n=1/Math.log(1-t);return function(){return Math.floor(1+Math.log(e.next())*n)}}(t,e)},this.poisson=function(e){return function(e,t){if(void 0===t&&(t=1),Qu(t).isPositive(),t<10){var n=Math.exp(-t);return function(){for(var i=n,o=0,r=e.next();r>i;)r-=i,i=t*i/++o;return o}}var i=Math.sqrt(t),o=.931+2.53*i,r=.02483*o-.059,s=1.1239+1.1328/(o-3.4),a=.9277-3.6224/(o-2);return function(){for(;;){var n=void 0,l=e.next();if(l<=.86*a)return n=l/a-.43,Math.floor((2*r/(.5-Math.abs(n))+o)*n+t+.445);l>=a?n=e.next()-.5:(n=((n=l/a-.93)<0?-.5:.5)-n,l=e.next()*a);var c=.5-Math.abs(n);if(!(c<.013&&l>c)){var u=Math.floor((2*r/c+o)*n+t+.445);if(l=l*s/(r/(c*c)+o),u>=10){var h=(u+.5)*Math.log(t/u)-t-.9189385332046727+u-(.08333333333333333-(.002777777777777778-1/(1260*u*u))/(u*u))/u;if(Math.log(l*i)<=h)return u}else if(u>=0){var d,p=null!=(d=ih(u))?d:0;if(Math.log(l)<=u*Math.log(t)-t-p)return u}}}}}(t,e)},this.exponential=function(e){return function(e,t){return void 0===t&&(t=1),Qu(t).isPositive(),function(){return-Math.log(1-e.next())/t}}(t,e)},this.irwinHall=function(e){return function(e,t){return void 0===t&&(t=1),Qu(t).isInt().greaterThanOrEqual(0),function(){for(var n=0,i=0;i<t;++i)n+=e.next();return n}}(t,e)},this.bates=function(e){return function(e,t){void 0===t&&(t=1),Qu(t).isInt().isPositive();var n=e.irwinHall(t);return function(){return n()/t}}(t,e)},this.pareto=function(e){return function(e,t){void 0===t&&(t=1),Qu(t).greaterThanOrEqual(0);var n=1/t;return function(){return 1/Math.pow(1-e.next(),n)}}(t,e)},e&&e instanceof qu?this.use(e):this.use(new oh),this._cache={}}var t=e.prototype;return t.clone=function(){var t=[].slice.call(arguments);return t.length?new e(Ku.apply(void 0,t)):new e(this.rng.clone())},t.use=function(){this._rng=Ku.apply(void 0,[].slice.call(arguments))},t.patch=function(){if(this._patch)throw new Error("Math.random already patched");this._patch=Math.random,Math.random=this.uniform()},t.unpatch=function(){this._patch&&(Math.random=this._patch,delete this._patch)},t.choice=function(e){if(!Array.isArray(e))throw new Error("Random.choice expected input to be an array, got "+typeof e);var t=null==e?void 0:e.length;return t>0?e[this.uniformInt(0,t-1)()]:void 0},t._memoize=function(e,t){var n=[].slice.call(arguments,2),i=""+n.join(";"),o=this._cache[e];return(void 0===o||o.key!==i)&&(o={key:i,distribution:t.apply(void 0,[this].concat(n))},this._cache[e]=o),o.distribution},Gu(e,[{key:"rng",get:function(){return this._rng}}]),e}();new rh;const sh=.001;class ah{constructor(){this.pointsTextureSize=0,this.linksTextureSize=0,this.alpha=1,this.transform=function(){var e=new vu(9);return vu!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}(),this.screenSize=[0,0],this.mousePosition=[0,0],this.screenMousePosition=[0,0],this.selectedArea=[[0,0],[0,0]],this.isSimulationRunning=!1,this.simulationProgress=0,this.selectedIndices=null,this.maxPointSize=64,this.hoveredPoint=void 0,this.focusedPoint=void 0,this.draggingPointIndex=void 0,this.hoveredLinkIndex=void 0,this.adjustedSpaceSize=zo.spaceSize,this.isSpaceKeyPressed=!1,this.webglMaxTextureSize=16384,this.hoveredPointRingColor=[1,1,1,.7],this.focusedPointRingColor=[1,1,1,.95],this.hoveredLinkColor=[-1,-1,-1,-1],this.greyoutPointColor=[-1,-1,-1,-1],this.isDarkenGreyout=!1,this.isLinkHoveringEnabled=!1,this.alphaTarget=0,this.scalePointX=pu(),this.scalePointY=pu(),this.random=new rh,this._backgroundColor=[0,0,0,0],this.alphaDecay=e=>1-Math.pow(sh,1/e)}get backgroundColor(){return this._backgroundColor}get transformationMatrix4x4(){const e=this.transform;if(9!==e.length)throw new Error(`Transform must be a 9-element array (3x3 matrix), got ${e.length} elements`);return[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]}set backgroundColor(e){this._backgroundColor=e;const t=function(e,t,n){return.2126*e+.7152*t+.0722*n}(e[0],e[1],e[2]);document.documentElement.style.setProperty("--cosmosgl-attribution-color",t>.65?"black":"white"),document.documentElement.style.setProperty("--cosmosgl-error-message-color",t>.65?"black":"white"),this.div&&(this.div.style.backgroundColor=`rgba(${255*e[0]}, ${255*e[1]}, ${255*e[2]}, ${e[3]})`),this.isDarkenGreyout=t<.65}addRandomSeed(e){this.random=this.random.clone(e)}getRandomFloat(e,t){return this.random.float(e,t)}adjustSpaceSize(e,t){(e<=0||!isFinite(e))&&(console.error(`Invalid spaceSize value: ${e}. Using default value of ${zo.spaceSize}`),e=zo.spaceSize),e<2&&(console.warn(`spaceSize (${e}) is too small. Using minimum value of 2`),e=2),e>=t?(this.adjustedSpaceSize=Math.max(t/2,2),console.warn(`The \`spaceSize\` has been reduced to ${this.adjustedSpaceSize} due to WebGL limits`)):this.adjustedSpaceSize=e}setWebGLMaxTextureSize(e){this.webglMaxTextureSize=e}updateScreenSize(e,t){const{adjustedSpaceSize:n}=this;this.screenSize=[e,t],this.scalePointX.domain([0,n]).range([(e-n)/2,(e+n)/2]),this.scalePointY.domain([n,0]).range([(t-n)/2,(t+n)/2])}scaleX(e){return this.scalePointX(e)}scaleY(e){return this.scalePointY(e)}setHoveredPointRingColor(e){const t=Ur(e);this.hoveredPointRingColor[0]=t[0],this.hoveredPointRingColor[1]=t[1],this.hoveredPointRingColor[2]=t[2]}setFocusedPointRingColor(e){const t=Ur(e);this.focusedPointRingColor[0]=t[0],this.focusedPointRingColor[1]=t[1],this.focusedPointRingColor[2]=t[2]}setGreyoutPointColor(e){if(void 0===e)return void(this.greyoutPointColor=[-1,-1,-1,-1]);const t=Ur(e);this.greyoutPointColor[0]=t[0],this.greyoutPointColor[1]=t[1],this.greyoutPointColor[2]=t[2],this.greyoutPointColor[3]=t[3]}updateLinkHoveringEnabled(e){this.isLinkHoveringEnabled=!!(e.onLinkClick||e.onLinkMouseOver||e.onLinkMouseOut),this.isLinkHoveringEnabled||(this.hoveredLinkIndex=void 0)}setHoveredLinkColor(e){if(void 0===e)return void(this.hoveredLinkColor=[-1,-1,-1,-1]);const t=Ur(e);this.hoveredLinkColor[0]=t[0],this.hoveredLinkColor[1]=t[1],this.hoveredLinkColor[2]=t[2],this.hoveredLinkColor[3]=t[3]}setFocusedPoint(e){this.focusedPoint=void 0!==e?{index:e}:void 0}addAlpha(e){return(this.alphaTarget-this.alpha)*this.alphaDecay(e)}}const lh={passive:!1},ch={capture:!0,passive:!1};function uh(e){e.stopImmediatePropagation()}function hh(e){e.preventDefault(),e.stopImmediatePropagation()}function dh(e){var t=e.document.documentElement,n=Se(e).on("dragstart.drag",hh,ch);"onselectstart"in t?n.on("selectstart.drag",hh,ch):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function ph(e,t){var n=e.document.documentElement,i=Se(e).on("dragstart.drag",null);t&&(i.on("click.drag",hh,ch),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const fh=e=>()=>e;function mh(e,{sourceEvent:t,subject:n,target:i,identifier:o,active:r,x:s,y:a,dx:l,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:r,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}function _h(e){return!e.ctrlKey&&!e.button}function gh(){return this.parentNode}function yh(e,t){return t??{x:e.x,y:e.y}}function bh(){return navigator.maxTouchPoints||"ontouchstart"in this}mh.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};const vh=e=>()=>e;function xh(e,{sourceEvent:t,target:n,transform:i,dispatch:o}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:o}})}function wh(e,t,n){this.k=e,this.x=t,this.y=n}wh.prototype={constructor:wh,scale:function(e){return 1===e?this:new wh(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new wh(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Sh=new wh(1,0,0);function Eh(e){e.stopImmediatePropagation()}function Th(e){e.preventDefault(),e.stopImmediatePropagation()}function Ch(e){return!(e.ctrlKey&&"wheel"!==e.type||e.button)}function Ih(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function Ah(){return this.__zoom||Sh}function kh(e){return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function Lh(){return navigator.maxTouchPoints||"ontouchstart"in this}function Rh(e,t,n){var i=e.invertX(t[0][0])-n[0][0],o=e.invertX(t[1][0])-n[1][0],r=e.invertY(t[0][1])-n[0][1],s=e.invertY(t[1][1])-n[1][1];return e.translate(o>i?(i+o)/2:Math.min(0,i)||Math.max(0,o),s>r?(r+s)/2:Math.min(0,r)||Math.max(0,s))}wh.prototype;class Ph{constructor(e,t){this.eventTransform=Sh,this.behavior=function(){var e,t,n,i=Ch,o=Ih,r=Rh,s=kh,a=Lh,l=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],u=250,h=nn,d=Ce("start","zoom","end"),p=0,f=10;function m(e){e.property("__zoom",Ah).on("wheel.zoom",w,{passive:!1}).on("mousedown.zoom",S).on("dblclick.zoom",E).filter(a).on("touchstart.zoom",T).on("touchmove.zoom",C).on("touchend.zoom touchcancel.zoom",I).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function _(e,t){return(t=Math.max(l[0],Math.min(l[1],t)))===e.k?e:new wh(t,e.x,e.y)}function g(e,t,n){var i=t[0]-n[0]*e.k,o=t[1]-n[1]*e.k;return i===e.x&&o===e.y?e:new wh(e.k,i,o)}function y(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function b(e,t,n,i){e.on("start.zoom",function(){v(this,arguments).event(i).start()}).on("interrupt.zoom end.zoom",function(){v(this,arguments).event(i).end()}).tween("zoom",function(){var e=this,r=arguments,s=v(e,r).event(i),a=o.apply(e,r),l=null==n?y(a):"function"==typeof n?n.apply(e,r):n,c=Math.max(a[1][0]-a[0][0],a[1][1]-a[0][1]),u=e.__zoom,d="function"==typeof t?t.apply(e,r):t,p=h(u.invert(l).concat(c/u.k),d.invert(l).concat(c/d.k));return function(e){if(1===e)e=d;else{var t=p(e),n=c/t[2];e=new wh(n,l[0]-t[0]*n,l[1]-t[1]*n)}s.zoom(null,e)}})}function v(e,t,n){return!n&&e.__zooming||new x(e,t)}function x(e,t){this.that=e,this.args=t,this.active=0,this.sourceEvent=null,this.extent=o.apply(e,t),this.taps=0}function w(e,...t){if(i.apply(this,arguments)){var n=v(this,t).event(e),o=this.__zoom,a=Math.max(l[0],Math.min(l[1],o.k*Math.pow(2,s.apply(this,arguments)))),u=Ee(e);if(n.wheel)(n.mouse[0][0]!==u[0]||n.mouse[0][1]!==u[1])&&(n.mouse[1]=o.invert(n.mouse[0]=u)),clearTimeout(n.wheel);else{if(o.k===a)return;n.mouse=[u,o.invert(u)],et(this),n.start()}Th(e),n.wheel=setTimeout(function(){n.wheel=null,n.end()},150),n.zoom("mouse",r(g(_(o,a),n.mouse[0],n.mouse[1]),n.extent,c))}}function S(e,...t){if(!n&&i.apply(this,arguments)){var o=e.currentTarget,s=v(this,t,!0).event(e),a=Se(e.view).on("mousemove.zoom",function(e){if(Th(e),!s.moved){var t=e.clientX-u,n=e.clientY-h;s.moved=t*t+n*n>p}s.event(e).zoom("mouse",r(g(s.that.__zoom,s.mouse[0]=Ee(e,o),s.mouse[1]),s.extent,c))},!0).on("mouseup.zoom",function(e){a.on("mousemove.zoom mouseup.zoom",null),ph(e.view,s.moved),Th(e),s.event(e).end()},!0),l=Ee(e,o),u=e.clientX,h=e.clientY;dh(e.view),Eh(e),s.mouse=[l,this.__zoom.invert(l)],et(this),s.start()}}function E(e,...t){if(i.apply(this,arguments)){var n=this.__zoom,s=Ee(e.changedTouches?e.changedTouches[0]:e,this),a=n.invert(s),l=n.k*(e.shiftKey?.5:2),h=r(g(_(n,l),s,a),o.apply(this,t),c);Th(e),u>0?Se(this).transition().duration(u).call(b,h,s,e):Se(this).call(m.transform,h,s,e)}}function T(n,...o){if(i.apply(this,arguments)){var r,s,a,l,c=n.touches,u=c.length,h=v(this,o,n.changedTouches.length===u).event(n);for(Eh(n),s=0;s<u;++s)l=[l=Ee(a=c[s],this),this.__zoom.invert(l),a.identifier],h.touch0?!h.touch1&&h.touch0[2]!==l[2]&&(h.touch1=l,h.taps=0):(h.touch0=l,r=!0,h.taps=1+!!e);e&&(e=clearTimeout(e)),r&&(h.taps<2&&(t=l[0],e=setTimeout(function(){e=null},500)),et(this),h.start())}}function C(e,...t){if(this.__zooming){var n,i,o,s,a=v(this,t).event(e),l=e.changedTouches,u=l.length;for(Th(e),n=0;n<u;++n)o=Ee(i=l[n],this),a.touch0&&a.touch0[2]===i.identifier?a.touch0[0]=o:a.touch1&&a.touch1[2]===i.identifier&&(a.touch1[0]=o);if(i=a.that.__zoom,a.touch1){var h=a.touch0[0],d=a.touch0[1],p=a.touch1[0],f=a.touch1[1],m=(m=p[0]-h[0])*m+(m=p[1]-h[1])*m,y=(y=f[0]-d[0])*y+(y=f[1]-d[1])*y;i=_(i,Math.sqrt(m/y)),o=[(h[0]+p[0])/2,(h[1]+p[1])/2],s=[(d[0]+f[0])/2,(d[1]+f[1])/2]}else{if(!a.touch0)return;o=a.touch0[0],s=a.touch0[1]}a.zoom("touch",r(g(i,o,s),a.extent,c))}}function I(e,...i){if(this.__zooming){var o,r,s=v(this,i).event(e),a=e.changedTouches,l=a.length;for(Eh(e),n&&clearTimeout(n),n=setTimeout(function(){n=null},500),o=0;o<l;++o)r=a[o],s.touch0&&s.touch0[2]===r.identifier?delete s.touch0:s.touch1&&s.touch1[2]===r.identifier&&delete s.touch1;if(s.touch1&&!s.touch0&&(s.touch0=s.touch1,delete s.touch1),s.touch0)s.touch0[1]=this.__zoom.invert(s.touch0[0]);else if(s.end(),2===s.taps&&(r=Ee(r,this),Math.hypot(t[0]-r[0],t[1]-r[1])<f)){var c=Se(this).on("dblclick.zoom");c&&c.apply(this,arguments)}}}return m.transform=function(e,t,n,i){var o=e.selection?e.selection():e;o.property("__zoom",Ah),e!==o?b(e,t,n,i):o.interrupt().each(function(){v(this,arguments).event(i).start().zoom(null,"function"==typeof t?t.apply(this,arguments):t).end()})},m.scaleBy=function(e,t,n,i){m.scaleTo(e,function(){return this.__zoom.k*("function"==typeof t?t.apply(this,arguments):t)},n,i)},m.scaleTo=function(e,t,n,i){m.transform(e,function(){var e=o.apply(this,arguments),i=this.__zoom,s=null==n?y(e):"function"==typeof n?n.apply(this,arguments):n,a=i.invert(s),l="function"==typeof t?t.apply(this,arguments):t;return r(g(_(i,l),s,a),e,c)},n,i)},m.translateBy=function(e,t,n,i){m.transform(e,function(){return r(this.__zoom.translate("function"==typeof t?t.apply(this,arguments):t,"function"==typeof n?n.apply(this,arguments):n),o.apply(this,arguments),c)},null,i)},m.translateTo=function(e,t,n,i,s){m.transform(e,function(){var e=o.apply(this,arguments),s=this.__zoom,a=null==i?y(e):"function"==typeof i?i.apply(this,arguments):i;return r(Sh.translate(a[0],a[1]).scale(s.k).translate("function"==typeof t?-t.apply(this,arguments):-t,"function"==typeof n?-n.apply(this,arguments):-n),e,c)},i,s)},x.prototype={event:function(e){return e&&(this.sourceEvent=e),this},start:function(){return 1===++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(e,t){return this.mouse&&"mouse"!==e&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&"touch"!==e&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&"touch"!==e&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit("zoom"),this},end:function(){return 0===--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(e){var t=Se(this.that).datum();d.call(e,this.that,new xh(e,{sourceEvent:this.sourceEvent,target:m,transform:this.that.__zoom,dispatch:d}),t)}},m.wheelDelta=function(e){return arguments.length?(s="function"==typeof e?e:vh(+e),m):s},m.filter=function(e){return arguments.length?(i="function"==typeof e?e:vh(!!e),m):i},m.touchable=function(e){return arguments.length?(a="function"==typeof e?e:vh(!!e),m):a},m.extent=function(e){return arguments.length?(o="function"==typeof e?e:vh([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),m):o},m.scaleExtent=function(e){return arguments.length?(l[0]=+e[0],l[1]=+e[1],m):[l[0],l[1]]},m.translateExtent=function(e){return arguments.length?(c[0][0]=+e[0][0],c[1][0]=+e[1][0],c[0][1]=+e[0][1],c[1][1]=+e[1][1],m):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},m.constrain=function(e){return arguments.length?(r=e,m):r},m.duration=function(e){return arguments.length?(u=+e,m):u},m.interpolate=function(e){return arguments.length?(h=e,m):h},m.on=function(){var e=d.on.apply(d,arguments);return e===d?m:e},m.clickDistance=function(e){return arguments.length?(p=(e=+e)*e,m):Math.sqrt(p)},m.tapDistance=function(e){return arguments.length?(f=+e,m):f},m}().scaleExtent([.001,1/0]).on("start",e=>{var t,n;this.isRunning=!0;const i=!!e.sourceEvent;null==(n=null==(t=this.config)?void 0:t.onZoomStart)||n.call(t,e,i)}).on("zoom",e=>{var t,n;this.eventTransform=e.transform;const{eventTransform:{x:i,y:o,k:r},store:{transform:s,screenSize:a}}=this,l=a[0],c=a[1];if(!l||!c)return;(function(e,t,n){e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1})(s,l,c),xu(s,s,[i,o]),wu(s,s,[r,r]),xu(s,s,[l/2,c/2]),wu(s,s,[l/2,c/2]),wu(s,s,[1,-1]);const u=!!e.sourceEvent;null==(n=null==(t=this.config)?void 0:t.onZoom)||n.call(t,e,u)}).on("end",e=>{var t,n;this.isRunning=!1;const i=!!e.sourceEvent;null==(n=null==(t=this.config)?void 0:t.onZoomEnd)||n.call(t,e,i)}),this.isRunning=!1,this.store=e,this.config=t}getTransform(e,t,n=.1){if(0===e.length)return this.eventTransform;const{store:{screenSize:i}}=this,o=i[0],r=i[1],s=Fc(e.map(e=>e[0])),a=Fc(e.map(e=>e[1]));s[0]=this.store.scaleX(s[0]),s[1]=this.store.scaleX(s[1]),a[0]=this.store.scaleY(a[0]),a[1]=this.store.scaleY(a[1]),s[0]===s[1]&&(s[0]-=.5,s[1]+=.5),a[0]===a[1]&&(a[0]+=.5,a[1]-=.5);const l=o*(1-2*n)/(s[1]-s[0]),c=r*(1-2*n)/(a[0]-a[1]),u=function(e,t,n){return Math.min(Math.max(e,t),n)}(t??Math.min(l,c),...this.behavior.scaleExtent()),h=o/2-(s[1]+s[0])/2*u,d=r/2-(a[1]+a[0])/2*u;return Sh.translate(h,d).scale(u)}getDistanceToPoint(e){const{x:t,y:n,k:i}=this.eventTransform,o=this.getTransform([e],i),r=t-o.x,s=n-o.y;return Math.sqrt(r*r+s*s)}getMiddlePointTransform(e){const{store:{screenSize:t},eventTransform:{x:n,y:i,k:o}}=this,r=t[0],s=t[1],a=(s/2-i)/o,l=r/2-((r/2-n)/o+this.store.scaleX(e[0]))/2*1,c=s/2-(a+this.store.scaleY(e[1]))/2*1;return Sh.translate(l,c).scale(1)}convertScreenToSpacePosition(e){const{eventTransform:{x:t,y:n,k:i},store:{screenSize:o}}=this,r=o[0],s=o[1],a=[(e[0]-t)/i,s-(e[1]-n)/i];return a[0]-=(r-this.store.adjustedSpaceSize)/2,a[1]-=(s-this.store.adjustedSpaceSize)/2,a}convertSpaceToScreenPosition(e){return[this.eventTransform.applyX(this.store.scaleX(e[0])),this.eventTransform.applyY(this.store.scaleY(e[1]))]}convertSpaceToScreenRadius(e){const{config:{scalePointsOnZoom:t},store:{maxPointSize:n},eventTransform:{k:i}}=this;let o=2*e;return o*=t?i:Math.min(5,Math.max(1,.01*i)),Math.min(o,n)/2}}class Dh{constructor(e,t){this.isActive=!1,this.behavior=function(){var e,t,n,i,o=_h,r=gh,s=yh,a=bh,l={},c=Ce("start","drag","end"),u=0,h=0;function d(e){e.on("mousedown.drag",p).filter(a).on("touchstart.drag",_).on("touchmove.drag",g,lh).on("touchend.drag touchcancel.drag",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(s,a){if(!i&&o.call(this,s,a)){var l=b(this,r.call(this,s,a),s,a,"mouse");l&&(Se(s.view).on("mousemove.drag",f,ch).on("mouseup.drag",m,ch),dh(s.view),uh(s),n=!1,e=s.clientX,t=s.clientY,l("start",s))}}function f(i){if(hh(i),!n){var o=i.clientX-e,r=i.clientY-t;n=o*o+r*r>h}l.mouse("drag",i)}function m(e){Se(e.view).on("mousemove.drag mouseup.drag",null),ph(e.view,n),hh(e),l.mouse("end",e)}function _(e,t){if(o.call(this,e,t)){var n,i,s=e.changedTouches,a=r.call(this,e,t),l=s.length;for(n=0;n<l;++n)(i=b(this,a,e,t,s[n].identifier,s[n]))&&(uh(e),i("start",e,s[n]))}}function g(e){var t,n,i=e.changedTouches,o=i.length;for(t=0;t<o;++t)(n=l[i[t].identifier])&&(hh(e),n("drag",e,i[t]))}function y(e){var t,n,o=e.changedTouches,r=o.length;for(i&&clearTimeout(i),i=setTimeout(function(){i=null},500),t=0;t<r;++t)(n=l[o[t].identifier])&&(uh(e),n("end",e,o[t]))}function b(e,t,n,i,o,r){var a,h,p,f=c.copy(),m=Ee(r||n,t);if(null!=(p=s.call(e,new mh("beforestart",{sourceEvent:n,target:d,identifier:o,active:u,x:m[0],y:m[1],dx:0,dy:0,dispatch:f}),i)))return a=p.x-m[0]||0,h=p.y-m[1]||0,function n(r,s,c){var _,g=m;switch(r){case"start":l[o]=n,_=u++;break;case"end":delete l[o],--u;case"drag":m=Ee(c||s,t),_=u}f.call(r,e,new mh(r,{sourceEvent:s,subject:p,target:d,identifier:o,active:_,x:m[0]+a,y:m[1]+h,dx:m[0]-g[0],dy:m[1]-g[1],dispatch:f}),i)}}return d.filter=function(e){return arguments.length?(o="function"==typeof e?e:fh(!!e),d):o},d.container=function(e){return arguments.length?(r="function"==typeof e?e:fh(e),d):r},d.subject=function(e){return arguments.length?(s="function"==typeof e?e:fh(e),d):s},d.touchable=function(e){return arguments.length?(a="function"==typeof e?e:fh(!!e),d):a},d.on=function(){var e=c.on.apply(c,arguments);return e===c?d:e},d.clickDistance=function(e){return arguments.length?(h=(e=+e)*e,d):Math.sqrt(h)},d}().subject(e=>this.store.hoveredPoint&&!this.store.isSpaceKeyPressed?{x:e.x,y:e.y}:void 0).on("start",e=>{var t,n;this.store.hoveredPoint&&(this.store.draggingPointIndex=this.store.hoveredPoint.index,this.isActive=!0,null==(n=null==(t=this.config)?void 0:t.onDragStart)||n.call(t,e))}).on("drag",e=>{var t,n;null==(n=null==(t=this.config)?void 0:t.onDrag)||n.call(t,e)}).on("end",e=>{var t,n;this.isActive=!1,this.store.draggingPointIndex=void 0,null==(n=null==(t=this.config)?void 0:t.onDragEnd)||n.call(t,e)}),this.store=e,this.config=t}}class Mh{constructor(e,t,n){if(this.config=new Hr,this.graph=new Pc(this.config),this.requestAnimationFrameId=0,this.isRightClickMouse=!1,this.store=new ah,this.zoomInstance=new Ph(this.store,this.config),this.dragInstance=new Dh(this.store,this.config),this._findHoveredItemExecutionCount=0,this._isMouseOnCanvas=!1,this._isFirstRenderAfterInit=!0,this.isPointPositionsUpdateNeeded=!1,this.isPointColorUpdateNeeded=!1,this.isPointSizeUpdateNeeded=!1,this.isPointShapeUpdateNeeded=!1,this.isPointImageIndicesUpdateNeeded=!1,this.isLinksUpdateNeeded=!1,this.isLinkColorUpdateNeeded=!1,this.isLinkWidthUpdateNeeded=!1,this.isLinkArrowUpdateNeeded=!1,this.isPointClusterUpdateNeeded=!1,this.isForceManyBodyUpdateNeeded=!1,this.isForceLinkUpdateNeeded=!1,this.isForceCenterUpdateNeeded=!1,this.isPointImageSizesUpdateNeeded=!1,this._isDestroyed=!1,t&&this.config.init(t),n)this.deviceInitPromise=n;else{const e=document.createElement("canvas");this.deviceInitPromise=this.createDevice(e)}this.deviceInitPromise.then(t=>{if(this._isDestroyed)return t.destroy(),t;this.device=t;const i=this.validateDevice(t);n&&i.setProps({useDevicePixels:this.config.pixelRatio}),this.store.div=e;const o=i.canvas;o.parentNode!==this.store.div&&(o.parentNode&&o.parentNode.removeChild(o),this.store.div.appendChild(o)),this.addAttribution(),o.style.width="100%",o.style.height="100%",this.canvas=o;const r=this.canvas.clientWidth,s=this.canvas.clientHeight;this.store.adjustSpaceSize(this.config.spaceSize,this.device.limits.maxTextureDimension2D),this.store.setWebGLMaxTextureSize(this.device.limits.maxTextureDimension2D),this.store.updateScreenSize(r,s),this.canvasD3Selection=Se(this.canvas),this.canvasD3Selection.on("mouseenter.cosmos",()=>{this._isMouseOnCanvas=!0}).on("mousemove.cosmos",()=>{this._isMouseOnCanvas=!0}).on("mouseleave.cosmos",e=>{this._isMouseOnCanvas=!1,this.currentEvent=e,void 0!==this.store.hoveredPoint&&this.config.onPointMouseOut&&this.config.onPointMouseOut(e),void 0!==this.store.hoveredLinkIndex&&this.config.onLinkMouseOut&&this.config.onLinkMouseOut(e),this.isRightClickMouse=!1,this.store.hoveredPoint=void 0,this.store.hoveredLinkIndex=void 0,this.updateCanvasCursor()}),Se(document).on("keydown.cosmos",e=>{"Space"===e.code&&(this.store.isSpaceKeyPressed=!0)}).on("keyup.cosmos",e=>{"Space"===e.code&&(this.store.isSpaceKeyPressed=!1)}),this.zoomInstance.behavior.on("start.detect",e=>{this.currentEvent=e}).on("zoom.detect",e=>{!!e.sourceEvent&&this.updateMousePosition(e.sourceEvent),this.currentEvent=e}).on("end.detect",e=>{this.currentEvent=e}),this.dragInstance.behavior.on("start.detect",e=>{this.currentEvent=e,this.updateCanvasCursor()}).on("drag.detect",e=>{this.dragInstance.isActive&&this.updateMousePosition(e),this.currentEvent=e}).on("end.detect",e=>{this.currentEvent=e,this.updateCanvasCursor()}),this.canvasD3Selection.call(this.dragInstance.behavior).call(this.zoomInstance.behavior).on("click",this.onClick.bind(this)).on("mousemove",this.onMouseMove.bind(this)).on("contextmenu",this.onRightClickMouse.bind(this)),(!this.config.enableZoom||!this.config.enableDrag)&&this.updateZoomDragBehaviors(),this.setZoomLevel(this.config.initialZoomLevel??1);const a=t.gl.getParameter(xo.ALIASED_POINT_SIZE_RANGE);return this.store.maxPointSize=((null==a?void 0:a[1])??64)/this.config.pixelRatio,this.store.isSimulationRunning=this.config.enableSimulation,this.points=new bu(t,this.config,this.store,this.graph),this.lines=new yu(t,this.config,this.store,this.graph,this.points),this.config.enableSimulation&&(this.forceGravity=new _c(t,this.config,this.store,this.graph,this.points),this.forceCenter=new mc(t,this.config,this.store,this.graph,this.points),this.forceManyBody=new wc(t,this.config,this.store,this.graph,this.points),this.forceLinkIncoming=new xc(t,this.config,this.store,this.graph,this.points),this.forceLinkOutgoing=new xc(t,this.config,this.store,this.graph,this.points),this.forceMouse=new Sc(t,this.config,this.store,this.graph,this.points)),this.clusters=new Ec(t,this.config,this.store,this.graph,this.points),this.store.backgroundColor=Ur(this.config.backgroundColor),this.store.setHoveredPointRingColor(this.config.hoveredPointRingColor??zo.hoveredPointRingColor),this.store.setFocusedPointRingColor(this.config.focusedPointRingColor??zo.focusedPointRingColor),void 0!==this.config.focusedPointIndex&&this.store.setFocusedPoint(this.config.focusedPointIndex),this.store.setGreyoutPointColor(this.config.pointGreyoutColor??Bo),this.store.setHoveredLinkColor(this.config.hoveredLinkColor??zo.hoveredLinkColor),this.store.updateLinkHoveringEnabled(this.config),this.config.showFPSMonitor&&(this.fpsMonitor=new Rc(this.canvas)),void 0!==this.config.randomSeed&&this.store.addRandomSeed(this.config.randomSeed),t}).catch(e=>{throw console.error("Device initialization failed:",e),e})}get progress(){return this._isDestroyed?0:this.store.simulationProgress}get isSimulationRunning(){return!this._isDestroyed&&this.store.isSimulationRunning}get maxPointSize(){return this._isDestroyed?0:this.store.maxPointSize}setConfig(e){var t,n,i,o,r,s,a,l,c;if(this._isDestroyed||this.ensureDevice(()=>this.setConfig(e)))return;const u={...this.config};if(this.config.init(e),(u.pointDefaultColor!==this.config.pointDefaultColor||u.pointColor!==this.config.pointColor)&&(this.graph.updatePointColor(),null==(t=this.points)||t.updateColor()),(u.pointDefaultSize!==this.config.pointDefaultSize||u.pointSize!==this.config.pointSize)&&(this.graph.updatePointSize(),null==(n=this.points)||n.updateSize()),(u.linkDefaultColor!==this.config.linkDefaultColor||u.linkColor!==this.config.linkColor)&&(this.graph.updateLinkColor(),null==(i=this.lines)||i.updateColor()),(u.linkDefaultWidth!==this.config.linkDefaultWidth||u.linkWidth!==this.config.linkWidth)&&(this.graph.updateLinkWidth(),null==(o=this.lines)||o.updateWidth()),(u.linkDefaultArrows!==this.config.linkDefaultArrows||u.linkArrows!==this.config.linkArrows)&&(this.graph.updateArrows(),null==(r=this.lines)||r.updateArrow()),(u.curvedLinkSegments!==this.config.curvedLinkSegments||u.curvedLinks!==this.config.curvedLinks)&&(null==(s=this.lines)||s.updateCurveLineGeometry()),u.backgroundColor!==this.config.backgroundColor&&(this.store.backgroundColor=Ur(this.config.backgroundColor??Fo)),u.hoveredPointRingColor!==this.config.hoveredPointRingColor&&this.store.setHoveredPointRingColor(this.config.hoveredPointRingColor??zo.hoveredPointRingColor),u.focusedPointRingColor!==this.config.focusedPointRingColor&&this.store.setFocusedPointRingColor(this.config.focusedPointRingColor??zo.focusedPointRingColor),u.pointGreyoutColor!==this.config.pointGreyoutColor&&this.store.setGreyoutPointColor(this.config.pointGreyoutColor??Bo),u.hoveredLinkColor!==this.config.hoveredLinkColor&&this.store.setHoveredLinkColor(this.config.hoveredLinkColor??zo.hoveredLinkColor),u.focusedPointIndex!==this.config.focusedPointIndex&&this.store.setFocusedPoint(this.config.focusedPointIndex),u.pixelRatio!==this.config.pixelRatio&&null!=(a=this.device)&&a.canvasContext){this.device.canvasContext.setProps({useDevicePixels:this.config.pixelRatio});const e=this.device.gl.getParameter(xo.ALIASED_POINT_SIZE_RANGE);this.store.maxPointSize=((null==e?void 0:e[1])??64)/this.config.pixelRatio}u.spaceSize!==this.config.spaceSize&&(this.store.adjustSpaceSize(this.config.spaceSize,(null==(l=this.device)?void 0:l.limits.maxTextureDimension2D)??4096),this.resizeCanvas(!0),this.update(this.store.isSimulationRunning?this.store.alpha:0)),u.showFPSMonitor!==this.config.showFPSMonitor&&(this.config.showFPSMonitor?this.fpsMonitor=new Rc(this.canvas):(null==(c=this.fpsMonitor)||c.destroy(),this.fpsMonitor=void 0)),(u.enableZoom!==this.config.enableZoom||u.enableDrag!==this.config.enableDrag)&&this.updateZoomDragBehaviors(),(u.onLinkClick!==this.config.onLinkClick||u.onLinkMouseOver!==this.config.onLinkMouseOver||u.onLinkMouseOut!==this.config.onLinkMouseOut)&&this.store.updateLinkHoveringEnabled(this.config)}setPointPositions(e,t){this._isDestroyed||this.ensureDevice(()=>this.setPointPositions(e,t))||(this.graph.inputPointPositions=e,this.points.shouldSkipRescale=t,this.isPointPositionsUpdateNeeded=!0,this.isLinksUpdateNeeded=!0,this.isPointColorUpdateNeeded=!0,this.isPointSizeUpdateNeeded=!0,this.isPointShapeUpdateNeeded=!0,this.isPointImageIndicesUpdateNeeded=!0,this.isPointImageSizesUpdateNeeded=!0,this.isPointClusterUpdateNeeded=!0,this.isForceManyBodyUpdateNeeded=!0,this.isForceLinkUpdateNeeded=!0,this.isForceCenterUpdateNeeded=!0)}setPointColors(e){this._isDestroyed||this.ensureDevice(()=>this.setPointColors(e))||(this.graph.inputPointColors=e,this.isPointColorUpdateNeeded=!0)}getPointColors(){return this._isDestroyed?new Float32Array:this.graph.pointColors??new Float32Array}setPointSizes(e){this._isDestroyed||this.ensureDevice(()=>this.setPointSizes(e))||(this.graph.inputPointSizes=e,this.isPointSizeUpdateNeeded=!0)}setPointShapes(e){this._isDestroyed||this.ensureDevice(()=>this.setPointShapes(e))||(this.graph.inputPointShapes=e,this.isPointShapeUpdateNeeded=!0)}setImageData(e){var t;this._isDestroyed||this.ensureDevice(()=>this.setImageData(e))||(this.graph.inputImageData=e,null==(t=this.points)||t.createAtlas())}setPointImageIndices(e){this._isDestroyed||this.ensureDevice(()=>this.setPointImageIndices(e))||(this.graph.inputPointImageIndices=e,this.isPointImageIndicesUpdateNeeded=!0)}setPointImageSizes(e){this._isDestroyed||this.ensureDevice(()=>this.setPointImageSizes(e))||(this.graph.inputPointImageSizes=e,this.isPointImageSizesUpdateNeeded=!0)}getPointSizes(){return this._isDestroyed?new Float32Array:this.graph.pointSizes??new Float32Array}setLinks(e){this._isDestroyed||this.ensureDevice(()=>this.setLinks(e))||(this.graph.inputLinks=e,this.isLinksUpdateNeeded=!0,this.isLinkColorUpdateNeeded=!0,this.isLinkWidthUpdateNeeded=!0,this.isLinkArrowUpdateNeeded=!0,this.isForceLinkUpdateNeeded=!0)}setLinkColors(e){this._isDestroyed||this.ensureDevice(()=>this.setLinkColors(e))||(this.graph.inputLinkColors=e,this.isLinkColorUpdateNeeded=!0)}getLinkColors(){return this._isDestroyed?new Float32Array:this.graph.linkColors??new Float32Array}setLinkWidths(e){this._isDestroyed||this.ensureDevice(()=>this.setLinkWidths(e))||(this.graph.inputLinkWidths=e,this.isLinkWidthUpdateNeeded=!0)}getLinkWidths(){return this._isDestroyed?new Float32Array:this.graph.linkWidths??new Float32Array}setLinkArrows(e){this._isDestroyed||this.ensureDevice(()=>this.setLinkArrows(e))||(this.graph.linkArrowsBoolean=e,this.isLinkArrowUpdateNeeded=!0)}setLinkStrength(e){this._isDestroyed||this.ensureDevice(()=>this.setLinkStrength(e))||(this.graph.inputLinkStrength=e,this.isForceLinkUpdateNeeded=!0)}setPointClusters(e){this._isDestroyed||this.ensureDevice(()=>this.setPointClusters(e))||(this.graph.inputPointClusters=e,this.isPointClusterUpdateNeeded=!0)}setClusterPositions(e){this._isDestroyed||this.ensureDevice(()=>this.setClusterPositions(e))||(this.graph.inputClusterPositions=e,this.isPointClusterUpdateNeeded=!0)}setPointClusterStrength(e){this._isDestroyed||this.ensureDevice(()=>this.setPointClusterStrength(e))||(this.graph.inputClusterStrength=e,this.isPointClusterUpdateNeeded=!0)}setPinnedPoints(e){var t;this._isDestroyed||this.ensureDevice(()=>this.setPinnedPoints(e))||(this.graph.inputPinnedPoints=e&&e.length>0?e:void 0,null==(t=this.points)||t.updatePinnedStatus())}render(e){if(this._isDestroyed||this.ensureDevice(()=>this.render(e)))return;this.graph.update();const{fitViewOnInit:t,fitViewDelay:n,fitViewPadding:i,fitViewDuration:o,fitViewByPointsInRect:r,fitViewByPointIndices:s,initialZoomLevel:a}=this.config;if(!this.graph.pointsNumber&&!this.graph.linksNumber)return this.stopFrames(),Se(this.canvas).style("cursor",null),void(this.device&&this.device.beginRenderPass({clearColor:this.store.backgroundColor,clearDepth:1,clearStencil:0}).end());this._isFirstRenderAfterInit&&t&&void 0===a&&(this._fitViewOnInitTimeoutID=window.setTimeout(()=>{s?this.fitViewByPointIndices(s,o,i):r?this.setZoomTransformByPointPositions(r,o,void 0,i):this.fitView(o,i)},n)),this.update(e),this.startFrames(),this._isFirstRenderAfterInit=!1}zoomToPointByIndex(e,t=700,n=3,i=!0){if(this._isDestroyed||this.ensureDevice(()=>this.zoomToPointByIndex(e,t,n,i))||!this.device||!this.points||!this.canvasD3Selection)return;const{store:{screenSize:o}}=this,r=$r(this.device,this.points.currentPositionFbo);if(void 0===e)return;const s=r[4*e+0],a=r[4*e+1];if(void 0===s||void 0===a)return;const l=this.zoomInstance.getDistanceToPoint([s,a]),c=i?n:Math.max(this.getZoomLevel(),n);if(l<Math.min(o[0],o[1]))this.setZoomTransformByPointPositions([s,a],t,c);else{const e=this.zoomInstance.getTransform([[s,a]],c),n=this.zoomInstance.getMiddlePointTransform([s,a]);this.canvasD3Selection.transition().ease(Cn).duration(t/2).call(this.zoomInstance.behavior.transform,n).transition().ease(In).duration(t/2).call(this.zoomInstance.behavior.transform,e)}}zoom(e,t=0){this._isDestroyed||this.setZoomLevel(e,t)}setZoomLevel(e,t=0){this._isDestroyed||this.ensureDevice(()=>this.setZoomLevel(e,t))||this.canvasD3Selection&&(0===t?this.canvasD3Selection.call(this.zoomInstance.behavior.scaleTo,e):this.canvasD3Selection.transition().duration(t).call(this.zoomInstance.behavior.scaleTo,e))}getZoomLevel(){return this._isDestroyed?0:this.zoomInstance.eventTransform.k}getPointPositions(){if(this._isDestroyed||!this.device||!this.points)return[];if(void 0===this.graph.pointsNumber)return[];const e=[],t=$r(this.device,this.points.currentPositionFbo);e.length=2*this.graph.pointsNumber;for(let n=0;n<this.graph.pointsNumber;n+=1){const i=t[4*n+0],o=t[4*n+1];void 0!==i&&void 0!==o&&(e[2*n]=i,e[2*n+1]=o)}return e}getClusterPositions(){if(this._isDestroyed||!this.device||!this.clusters)return[];if(void 0===this.graph.pointClusters||void 0===this.clusters.clusterCount)return[];this.clusters.calculateCentermass();const e=[],t=$r(this.device,this.clusters.centermassFbo);e.length=2*this.clusters.clusterCount;for(let n=0;n<e.length/2;n+=1){const i=t[4*n+0],o=t[4*n+1],r=t[4*n+2];void 0!==i&&void 0!==o&&void 0!==r&&(e[2*n]=i/r,e[2*n+1]=o/r)}return e}fitView(e=250,t=.1){this._isDestroyed||this.ensureDevice(()=>this.fitView(e,t))||this.setZoomTransformByPointPositions(this.getPointPositions(),e,void 0,t)}fitViewByPointIndices(e,t=250,n=.1){if(this._isDestroyed||this.ensureDevice(()=>this.fitViewByPointIndices(e,t,n)))return;const i=this.getPointPositions(),o=new Array(2*e.length);for(const[r,s]of e.entries())o[2*r]=i[2*s],o[2*r+1]=i[2*s+1];this.setZoomTransformByPointPositions(o,t,void 0,n)}fitViewByPointPositions(e,t=250,n=.1){this._isDestroyed||this.ensureDevice(()=>this.fitViewByPointPositions(e,t,n))||this.setZoomTransformByPointPositions(e,t,void 0,n)}getPointsInRect(e){if(this._isDestroyed||!this.device||!this.points)return new Float32Array;const t=this.store.screenSize[1];return this.store.selectedArea=[[e[0][0],t-e[1][1]],[e[1][0],t-e[0][1]]],this.points.findPointsOnAreaSelection(),$r(this.device,this.points.selectedFbo).map((e,t)=>t%4==0&&0!==e?t/4:-1).filter(e=>-1!==e)}getPointsInRange(e){return this.getPointsInRect(e)}getPointsInPolygon(e){if(this._isDestroyed||!this.device||!this.points)return new Float32Array;if(e.length<3)return new Float32Array;const t=this.store.screenSize[1],n=e.map(([e,n])=>[e,t-n]);return this.points.updatePolygonPath(n),this.points.findPointsOnPolygonSelection(),$r(this.device,this.points.selectedFbo).map((e,t)=>t%4==0&&0!==e?t/4:-1).filter(e=>-1!==e)}selectPointsInRect(e){if(!this._isDestroyed&&!this.ensureDevice(()=>this.selectPointsInRect(e))&&this.device&&this.points){if(e){const t=this.store.screenSize[1];this.store.selectedArea=[[e[0][0],t-e[1][1]],[e[1][0],t-e[0][1]]],this.points.findPointsOnAreaSelection();const n=$r(this.device,this.points.selectedFbo);this.store.selectedIndices=n.map((e,t)=>t%4==0&&0!==e?t/4:-1).filter(e=>-1!==e)}else this.store.selectedIndices=null;this.points.updateGreyoutStatus()}}selectPointsInRange(e){return this.selectPointsInRect(e)}selectPointsInPolygon(e){if(!this._isDestroyed&&!this.ensureDevice(()=>this.selectPointsInPolygon(e))&&this.device&&this.points){if(e){if(e.length<3)return void console.warn("Polygon path requires at least 3 points to form a polygon.");const t=this.store.screenSize[1],n=e.map(([e,n])=>[e,t-n]);this.points.updatePolygonPath(n),this.points.findPointsOnPolygonSelection();const i=$r(this.device,this.points.selectedFbo);this.store.selectedIndices=i.map((e,t)=>t%4==0&&0!==e?t/4:-1).filter(e=>-1!==e)}else this.store.selectedIndices=null;this.points.updateGreyoutStatus()}}selectPointByIndex(e,t=!1){if(!this._isDestroyed&&!this.ensureDevice(()=>this.selectPointByIndex(e,t)))if(t){const t=this.graph.getAdjacentIndices(e)??[];this.selectPointsByIndices([e,...t])}else this.selectPointsByIndices([e])}selectPointsByIndices(e){this._isDestroyed||this.ensureDevice(()=>this.selectPointsByIndices(e))||this.points&&(e?0===e.length?this.store.selectedIndices=new Float32Array:this.store.selectedIndices=new Float32Array(e.filter(e=>void 0!==e)):this.store.selectedIndices=null,this.points.updateGreyoutStatus())}unselectPoints(){this._isDestroyed||this.ensureDevice(()=>this.unselectPoints())||this.points&&(this.store.selectedIndices=null,this.points.updateGreyoutStatus())}getSelectedIndices(){if(this._isDestroyed)return null;const{selectedIndices:e}=this.store;return e?Array.from(e):null}getAdjacentIndices(e){if(!this._isDestroyed)return this.graph.getAdjacentIndices(e)}spaceToScreenPosition(e){return this._isDestroyed?[0,0]:this.zoomInstance.convertSpaceToScreenPosition(e)}screenToSpacePosition(e){return this._isDestroyed?[0,0]:this.zoomInstance.convertScreenToSpacePosition(e)}spaceToScreenRadius(e){return this._isDestroyed?0:this.zoomInstance.convertSpaceToScreenRadius(e)}getPointRadiusByIndex(e){var t;if(!this._isDestroyed)return null==(t=this.graph.pointSizes)?void 0:t[e]}trackPointPositionsByIndices(e){this._isDestroyed||this.ensureDevice(()=>this.trackPointPositionsByIndices(e))||this.points&&this.points.trackPointsByIndices(e)}getTrackedPointPositionsMap(){return this._isDestroyed||!this.points?new Map:this.points.getTrackedPositionsMap()}getTrackedPointPositionsArray(){return this._isDestroyed||!this.points?[]:this.points.getTrackedPositionsArray()}getSampledPointPositionsMap(){return this._isDestroyed||!this.points?new Map:this.points.getSampledPointPositionsMap()}getSampledPoints(){return this._isDestroyed||!this.points?{indices:[],positions:[]}:this.points.getSampledPoints()}getScaleX(){if(!this._isDestroyed&&this.points)return this.points.scaleX}getScaleY(){if(!this._isDestroyed&&this.points)return this.points.scaleY}start(e=1){var t,n;this._isDestroyed||this.ensureDevice(()=>this.start(e))||this.graph.pointsNumber&&(this.store.isSimulationRunning=!0,this.store.simulationProgress=0,this.store.alpha=e,null==(n=(t=this.config).onSimulationStart)||n.call(t))}stop(){var e,t;this._isDestroyed||(this.store.isSimulationRunning=!1,this.store.simulationProgress=0,this.store.alpha=0,null==(t=(e=this.config).onSimulationEnd)||t.call(e))}pause(){var e,t;this._isDestroyed||this.ensureDevice(()=>this.pause())||(this.store.isSimulationRunning=!1,null==(t=(e=this.config).onSimulationPause)||t.call(e))}unpause(){var e,t;this._isDestroyed||this.ensureDevice(()=>this.unpause())||(this.store.isSimulationRunning=!0,null==(t=(e=this.config).onSimulationUnpause)||t.call(e))}restart(){var e,t;this._isDestroyed||this.ensureDevice(()=>this.restart())||(this.store.isSimulationRunning=!0,null==(t=(e=this.config).onSimulationRestart)||t.call(e))}step(){this._isDestroyed||this.ensureDevice(()=>this.step())||this.config.enableSimulation&&this.store.pointsTextureSize&&this.runSimulationStep(!0)}destroy(){var e,t,n,i,o,r,s,a,l,c,u,h,d;this._isDestroyed||(this._isDestroyed=!0,window.clearTimeout(this._fitViewOnInitTimeoutID),this.stopFrames(),this.canvasD3Selection&&this.canvasD3Selection.on("mouseenter.cosmos",null).on("mousemove.cosmos",null).on("mouseleave.cosmos",null).on("click",null).on("mousemove",null).on("contextmenu",null).on(".drag",null).on(".zoom",null),Se(document).on("keydown.cosmos",null).on("keyup.cosmos",null),null!=(e=this.zoomInstance)&&e.behavior&&this.zoomInstance.behavior.on("start.detect",null).on("zoom.detect",null).on("end.detect",null),null!=(t=this.dragInstance)&&t.behavior&&this.dragInstance.behavior.on("start.detect",null).on("drag.detect",null).on("end.detect",null),null==(n=this.fpsMonitor)||n.destroy(),null==(i=this.points)||i.destroy(),null==(o=this.lines)||o.destroy(),null==(r=this.clusters)||r.destroy(),null==(s=this.forceGravity)||s.destroy(),null==(a=this.forceCenter)||a.destroy(),null==(l=this.forceManyBody)||l.destroy(),null==(c=this.forceLinkIncoming)||c.destroy(),null==(u=this.forceLinkOutgoing)||u.destroy(),null==(h=this.forceMouse)||h.destroy(),this.device&&(this.device.beginRenderPass({clearColor:this.store.backgroundColor,clearDepth:1,clearStencil:0}).end(),this.device.destroy()),this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.attributionDivElement&&this.attributionDivElement.parentNode&&this.attributionDivElement.parentNode.removeChild(this.attributionDivElement),null==(d=document.getElementById("gl-bench-style"))||d.remove(),this.canvasD3Selection=void 0,this.attributionDivElement=void 0)}create(){var e,t,n,i,o;this._isDestroyed||this.ensureDevice(()=>this.create())||this.points&&this.lines&&(this.isPointPositionsUpdateNeeded&&this.points.updatePositions(),this.isPointColorUpdateNeeded&&this.points.updateColor(),this.isPointSizeUpdateNeeded&&this.points.updateSize(),this.isPointShapeUpdateNeeded&&this.points.updateShape(),this.isPointImageIndicesUpdateNeeded&&this.points.updateImageIndices(),this.isPointImageSizesUpdateNeeded&&this.points.updateImageSizes(),this.isLinksUpdateNeeded&&this.lines.updatePointsBuffer(),this.isLinkColorUpdateNeeded&&this.lines.updateColor(),this.isLinkWidthUpdateNeeded&&this.lines.updateWidth(),this.isLinkArrowUpdateNeeded&&this.lines.updateArrow(),this.isForceManyBodyUpdateNeeded&&(null==(e=this.forceManyBody)||e.create()),this.isForceLinkUpdateNeeded&&(null==(t=this.forceLinkIncoming)||t.create(vc.INCOMING),null==(n=this.forceLinkOutgoing)||n.create(vc.OUTGOING)),this.isForceCenterUpdateNeeded&&(null==(i=this.forceCenter)||i.create()),this.isPointClusterUpdateNeeded&&(null==(o=this.clusters)||o.create()),this.isPointPositionsUpdateNeeded=!1,this.isPointColorUpdateNeeded=!1,this.isPointSizeUpdateNeeded=!1,this.isPointShapeUpdateNeeded=!1,this.isPointImageIndicesUpdateNeeded=!1,this.isPointImageSizesUpdateNeeded=!1,this.isLinksUpdateNeeded=!1,this.isLinkColorUpdateNeeded=!1,this.isLinkWidthUpdateNeeded=!1,this.isLinkArrowUpdateNeeded=!1,this.isPointClusterUpdateNeeded=!1,this.isForceManyBodyUpdateNeeded=!1,this.isForceLinkUpdateNeeded=!1,this.isForceCenterUpdateNeeded=!1)}flatten(e){return e.flat()}pair(e){const t=new Array(e.length/2);for(let n=0;n<e.length/2;n++)t[n]=[e[2*n],e[2*n+1]];return t}ensureDevice(e){return!this.device&&(this.deviceInitPromise.then(()=>{this._isDestroyed||e()}).catch(e=>{console.error("Device initialization failed",e)}),!0)}validateDevice(e){const t=e.canvasContext;if(null===t||"offscreen-canvas"===t.type)throw new Error("Device must have an HTMLCanvasElement canvas context. OffscreenCanvas and compute-only devices are not supported.");return t}async createDevice(e){return await zi.createDevice({type:"webgl",adapters:[Oo],createCanvasContext:{canvas:e,useDevicePixels:this.config.pixelRatio,autoResize:!0,width:void 0,height:void 0}})}update(e=this.store.alpha){const{graph:t}=this;this.store.pointsTextureSize=Math.ceil(Math.sqrt(t.pointsNumber??0)),this.store.linksTextureSize=Math.ceil(Math.sqrt(2*(t.linksNumber??0))),this.create(),this.initPrograms(),this.store.hoveredPoint=void 0,this.store.alpha=e}runSimulationStep(e=!1){var t,n,i,o,r,s,a,l,c,u,h,d,p,f,m,_,g,y,b;const{config:{simulationGravity:v,simulationCenter:x,enableSimulation:w},store:{isSimulationRunning:S}}=this;w&&(this.isRightClickMouse&&this.config.enableRightClickRepulsion&&(null==(t=this.forceMouse)||t.run(),null==(n=this.points)||n.updatePosition()),(e||S&&!(this.zoomInstance.isRunning&&!this.config.enableSimulationDuringZoom))&&(v&&(null==(i=this.forceGravity)||i.run(),null==(o=this.points)||o.updatePosition()),x&&(null==(r=this.forceCenter)||r.run(),null==(s=this.points)||s.updatePosition()),null==(a=this.forceManyBody)||a.run(),null==(l=this.points)||l.updatePosition(),this.store.linksTextureSize&&(null==(c=this.forceLinkIncoming)||c.run(),null==(u=this.points)||u.updatePosition(),null==(h=this.forceLinkOutgoing)||h.run(),null==(d=this.points)||d.updatePosition()),(this.graph.pointClusters||this.graph.clusterPositions)&&(null==(p=this.clusters)||p.run(),null==(f=this.points)||f.updatePosition()),this.store.alpha+=this.store.addAlpha(this.config.simulationDecay??zo.simulation.decay),this.isRightClickMouse&&this.config.enableRightClickRepulsion&&(this.store.alpha=Math.max(this.store.alpha,.1)),this.store.simulationProgress=Math.sqrt(Math.min(1,sh/this.store.alpha)),null==(y=(g=this.config).onSimulationTick)||y.call(g,this.store.alpha,null==(m=this.store.hoveredPoint)?void 0:m.index,null==(_=this.store.hoveredPoint)?void 0:_.position)),null==(b=this.points)||b.trackPoints())}initPrograms(){var e,t,n,i,o,r;this._isDestroyed||!this.points||!this.lines||!this.clusters||(this.points.initPrograms(),this.lines.initPrograms(),null==(e=this.forceGravity)||e.initPrograms(),null==(t=this.forceManyBody)||t.initPrograms(),null==(n=this.forceCenter)||n.initPrograms(),null==(i=this.forceLinkIncoming)||i.initPrograms(),null==(o=this.forceLinkOutgoing)||o.initPrograms(),null==(r=this.forceMouse)||r.initPrograms(),this.clusters.initPrograms())}frame(){if(this._isDestroyed)return;const{store:{alpha:e,isSimulationRunning:t}}=this;e<sh&&t&&this.end(),this.requestAnimationFrameId=window.requestAnimationFrame(e=>{this.renderFrame(e),this._isDestroyed||this.frame()})}renderFrame(e){var t,n,i,o,r,s,a;if(!this._isDestroyed&&this.store.pointsTextureSize){if(null==(t=this.fpsMonitor)||t.begin(),this.resizeCanvas(),this.dragInstance.isActive||this.findHoveredItem(),this.runSimulationStep(!1),this.device){const e=this.store.backgroundColor??[0,0,0,1],t=this.device.beginRenderPass({clearColor:e,clearDepth:1,clearStencil:0}),{config:{renderLinks:a}}=this;!1!==a&&!!this.store.linksTextureSize&&!!this.graph.linksNumber&&this.graph.linksNumber>0&&(null==(n=this.lines)||n.draw(t)),null==(i=this.points)||i.draw(t),this.dragInstance.isActive&&(null==(o=this.points)||o.drag(),null==(r=this.points)||r.drag(),null==(s=this.points)||s.trackPoints()),t.end(),this.device.submit()}null==(a=this.fpsMonitor)||a.end(e??performance.now()),this.currentEvent=void 0}}stopFrames(){this.requestAnimationFrameId&&(window.cancelAnimationFrame(this.requestAnimationFrameId),this.requestAnimationFrameId=0)}startFrames(){this._isDestroyed||(this.stopFrames(),this.frame())}end(){var e,t;this.store.isSimulationRunning=!1,this.store.simulationProgress=1,null==(t=(e=this.config).onSimulationEnd)||t.call(e)}onClick(e){var t,n,i,o,r,s,a,l,c,u;null==(o=(i=this.config).onClick)||o.call(i,null==(t=this.store.hoveredPoint)?void 0:t.index,null==(n=this.store.hoveredPoint)?void 0:n.position,e),this.store.hoveredPoint?null==(s=(r=this.config).onPointClick)||s.call(r,this.store.hoveredPoint.index,this.store.hoveredPoint.position,e):void 0!==this.store.hoveredLinkIndex?null==(l=(a=this.config).onLinkClick)||l.call(a,this.store.hoveredLinkIndex,e):null==(u=(c=this.config).onBackgroundClick)||u.call(c,e)}updateMousePosition(e){if(!e)return;const t=e.offsetX??e.x,n=e.offsetY??e.y;void 0===t||void 0===n||(this.store.mousePosition=this.zoomInstance.convertScreenToSpacePosition([t,n]),this.store.screenMousePosition=[t,this.store.screenSize[1]-n])}onMouseMove(e){var t,n,i,o;this.currentEvent=e,this.updateMousePosition(e),this.isRightClickMouse=3===e.which,null==(o=(i=this.config).onMouseMove)||o.call(i,null==(t=this.store.hoveredPoint)?void 0:t.index,null==(n=this.store.hoveredPoint)?void 0:n.position,this.currentEvent)}onRightClickMouse(e){e.preventDefault()}resizeCanvas(e=!1){var t,n,i;if(this._isDestroyed)return;const o=this.canvas.clientWidth,r=this.canvas.clientHeight,[s,a]=this.store.screenSize;if(e||s!==o||a!==r){const{k:e}=this.zoomInstance.eventTransform,l=this.zoomInstance.convertScreenToSpacePosition([s/2,a/2]);this.store.updateScreenSize(o,r),null==(t=this.canvasD3Selection)||t.call(this.zoomInstance.behavior.transform,this.zoomInstance.getTransform([l],e)),null==(n=this.points)||n.updateSampledPointsGrid(),this.store.isLinkHoveringEnabled&&(null==(i=this.lines)||i.updateLinkIndexFbo())}}setZoomTransformByPointPositions(e,t=250,n,i){var o;this.resizeCanvas();const r=this.zoomInstance.getTransform(this.pair(e),n,i);null==(o=this.canvasD3Selection)||o.transition().ease(An).duration(t).call(this.zoomInstance.behavior.transform,r)}updateZoomDragBehaviors(){var e,t,n,i;this.config.enableDrag?null==(e=this.canvasD3Selection)||e.call(this.dragInstance.behavior):null==(t=this.canvasD3Selection)||t.call(this.dragInstance.behavior).on(".drag",null),this.config.enableZoom?null==(n=this.canvasD3Selection)||n.call(this.zoomInstance.behavior):null==(i=this.canvasD3Selection)||i.call(this.zoomInstance.behavior).on("wheel.zoom",null)}findHoveredItem(){if(!this._isDestroyed&&this._isMouseOnCanvas){if(this._findHoveredItemExecutionCount<4)return void(this._findHoveredItemExecutionCount+=1);if(this._findHoveredItemExecutionCount=0,this.findHoveredPoint(),this.graph.linksNumber&&this.store.isLinkHoveringEnabled)this.findHoveredLine();else if(void 0!==this.store.hoveredLinkIndex){const e=void 0!==this.store.hoveredLinkIndex;this.store.hoveredLinkIndex=void 0,e&&this.config.onLinkMouseOut&&this.config.onLinkMouseOut(this.currentEvent)}this.updateCanvasCursor()}}findHoveredPoint(){var e,t,n,i;if(this._isDestroyed||!this.device||!this.points)return;this.points.findHoveredPoint();let o=!1,r=!1;const s=$r(this.device,this.points.hoveredFbo,0,0,2,2),a=s[0],l=s[1],c=s[2],u=s[3];l>0?((void 0===this.store.hoveredPoint||this.store.hoveredPoint.index!==a)&&(o=!0),this.store.hoveredPoint={index:a,position:[c,u]}):(this.store.hoveredPoint&&(r=!0),this.store.hoveredPoint=void 0),o&&this.store.hoveredPoint&&(null==(t=(e=this.config).onPointMouseOver)||t.call(e,this.store.hoveredPoint.index,this.store.hoveredPoint.position,this.currentEvent)),r&&(null==(i=(n=this.config).onPointMouseOut)||i.call(n,this.currentEvent))}findHoveredLine(){var e,t,n,i,o,r;if(this._isDestroyed||!this.lines)return;if(this.store.hoveredPoint)return void(void 0!==this.store.hoveredLinkIndex&&(this.store.hoveredLinkIndex=void 0,null==(t=(e=this.config).onLinkMouseOut)||t.call(e,this.currentEvent)));this.lines.findHoveredLine();let s=!1,a=!1;if(!this.device)return;const l=$r(this.device,this.lines.hoveredLineIndexFbo)[0];l>=0?(this.store.hoveredLinkIndex!==l&&(s=!0),this.store.hoveredLinkIndex=l):(void 0!==this.store.hoveredLinkIndex&&(a=!0),this.store.hoveredLinkIndex=void 0),s&&void 0!==this.store.hoveredLinkIndex&&(null==(i=(n=this.config).onLinkMouseOver)||i.call(n,this.store.hoveredLinkIndex)),a&&(null==(r=(o=this.config).onLinkMouseOut)||r.call(o,this.currentEvent))}updateCanvasCursor(){const{hoveredPointCursor:e,hoveredLinkCursor:t}=this.config;this.dragInstance.isActive?Se(this.canvas).style("cursor","grabbing"):this.store.hoveredPoint?!this.config.enableDrag||this.store.isSpaceKeyPressed?Se(this.canvas).style("cursor",e):Se(this.canvas).style("cursor","grab"):this.store.isLinkHoveringEnabled&&void 0!==this.store.hoveredLinkIndex?Se(this.canvas).style("cursor",t):Se(this.canvas).style("cursor",null)}addAttribution(){var e;this.config.attribution&&(this.attributionDivElement=document.createElement("div"),this.attributionDivElement.style.cssText="\n      user-select: none;\n      position: absolute;\n      bottom: 0;\n      right: 0;\n      color: var(--cosmosgl-attribution-color);\n      margin: 0 0.6rem 0.6rem 0;\n      font-size: 0.7rem;\n      font-family: inherit;\n    ",this.attributionDivElement.innerHTML=function(e){return Br.sanitize(e,{ALLOWED_TAGS:["a","b","i","em","strong","span","div","p","br"],ALLOWED_ATTR:["href","target","class","id","style"],ALLOW_DATA_ATTR:!1,ALLOWED_TAGS:["a","b","i","em","strong","span","div","p","br","img"],ALLOWED_ATTR:["href","target","class","id","style","src","alt","title"]})}(this.config.attribution),null==(e=this.store.div)||e.appendChild(this.attributionDivElement))}}const Nh={};function Oh(e,t=!1){let n,i,o=Nh;function r(t){var o;n=(null==(o=e(t))?void 0:o.catch(()=>{}).finally(()=>{if(i){const{event:e}=i;i=null,r(e)}else n=null}))||null}function s(e){n?function(e){i={event:e}}(e):r(e)}return t?function(e){o!==e&&requestAnimationFrame(()=>{const e=o;o=Nh,s(e)}),o=e}:s}class Bh{constructor(e){s(this,"_filterBy"),s(this,"_requestUpdate"),s(this,"_coordinator"),s(this,"_pending"),s(this,"_enabled"),s(this,"_initialized"),s(this,"_request"),this._filterBy=e,this._requestUpdate=Oh(()=>this.requestQuery(),!0),this._coordinator=null,this._pending=Promise.resolve(),this._enabled=!0,this._initialized=!1,this._request=null}get coordinator(){return this._coordinator}set coordinator(e){this._coordinator=e}get enabled(){return this._enabled}set enabled(e){e=!!e,this._enabled!==e&&(this._enabled=e,e&&(this._initialized?this._request&&this.requestQuery(!0===this._request?void 0:this._request):this.initialize(),this._request=null))}get pending(){return this._pending}get filterBy(){return this._filterBy}get filterStable(){return!0}async prepare(){}query(e){return null}queryPending(){return this}queryResult(e){return this}queryError(e){return this}requestQuery(e){var t;if(this._enabled){const n=e||this.query(null==(t=this.filterBy)?void 0:t.predicate(this));return this._coordinator.requestQuery(this,n)}return this._request=e??!0,null}requestUpdate(){this._enabled?this._requestUpdate():this.requestQuery()}initialize(){this._enabled?this._coordinator&&(this._initialized=!0,this._pending=this.prepare().then(()=>this.requestQuery())):this._initialized=!1}destroy(){var e;this._enabled=!1,null==(e=this.coordinator)||e.disconnect(this)}update(){return this}}const Fh=Uint8Array.of(65,82,82,79,87,49),zh={NONE:0,Schema:1,DictionaryBatch:2,RecordBatch:3,Tensor:4,SparseTensor:5},Uh={Dictionary:-1,NONE:0,Null:1,Int:2,Float:3,Binary:4,Utf8:5,Bool:6,Decimal:7,Date:8,Time:9,Timestamp:10,Interval:11,List:12,Struct:13,Union:14,FixedSizeBinary:15,FixedSizeList:16,Map:17,Duration:18,LargeBinary:19,LargeUtf8:20,LargeList:21,RunEndEncoded:22,BinaryView:23,Utf8View:24,ListView:25,LargeListView:26},$h={HALF:0,SINGLE:1,DOUBLE:2},Vh={DAY:0,MILLISECOND:1},Hh={SECOND:0,MILLISECOND:1,MICROSECOND:2,NANOSECOND:3},Gh={YEAR_MONTH:0,DAY_TIME:1,MONTH_DAY_NANO:2},Wh={Sparse:0,Dense:1},jh={LZ4_FRAME:0,ZSTD:1},Yh=Uint8Array,qh=Uint16Array,Xh=Uint32Array,Kh=BigUint64Array,Zh=Int8Array,Qh=Int16Array,Jh=Int32Array,ed=BigInt64Array,td=Float32Array,nd=Float64Array;function id(e,t){const n=Math.log2(e)-3;return(t?[Zh,Qh,Jh,ed]:[Yh,qh,Xh,Kh])[n]}function od(e,t){let n=0,i=e.length;if(i<=2147483648)do{const o=n+i>>>1;e[o]<=t?n=o+1:i=o}while(n<i);else do{const o=Math.trunc((n+i)/2);e[o]<=t?n=o+1:i=o}while(n<i);return n}function rd(e,t,n){if(t(e))return e;throw new Error(n(e))}function sd(e,t,n){return t=Array.isArray(t)?t:Object.values(t),rd(e,e=>t.includes(e),n??(()=>`${e} must be one of ${t}`))}function ad(e,t){for(const[n,i]of Object.entries(e))if(i===t)return n;return"<Unknown>"}const ld=e=>`Unsupported data type: "${ad(Uh,e)}" (id ${e})`,cd=(e,t,n=!0,i=null)=>({name:e,type:t,nullable:n,metadata:i});function ud(e){return Object.hasOwn(e,"name")&&hd(e.type)}function hd(e){return"number"==typeof(null==e?void 0:e.typeId)}function dd(e,t="",n=!0){return ud(e)?e:cd(t,rd(e,hd,()=>"Data type expected."),n)}const pd=(e=32,t=!0)=>({typeId:Uh.Int,bitWidth:sd(e,[8,16,32,64]),signed:t,values:id(e,t)}),fd=()=>pd(32),md=new nd(2).buffer;function _d(e){if(e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER)throw Error(`BigInt exceeds integer number representation: ${e}`);return Number(e)}function gd(e,t){return Number(e/t)+Number(e%t)/Number(t)}new ed(md);const yd=e=>BigInt.asUintN(64,e);function bd(e,t){return BigInt.asIntN(64,e[t])}function vd(e,t){const n=t<<1;let i;return BigInt.asIntN(64,e[n+1])<0?(i=yd(~e[n])|yd(~e[n+1])<<64n,i=-(i+1n)):i=e[n]|e[n+1]<<64n,i}function xd(e,t){const n=t<<2;let i;return BigInt.asIntN(64,e[n+3])<0?(i=yd(~e[n])|yd(~e[n+1])<<64n|yd(~e[n+2])<<128n|yd(~e[n+3])<<192n,i=-(i+1n)):i=e[n]|e[n+1]<<64n|e[n+2]<<128n|e[n+3]<<192n,i}const wd=new TextDecoder("utf-8");function Sd(e){return wd.decode(e)}function Ed(e,t){return!!(e[t>>3]&1<<t%8)}function Td(e,t){const n=t+Rd(e,t),i=n-Rd(e,n),o=Ld(e,i);return(t,r,s=null)=>{if(t<o){const o=Ld(e,i+t);if(o)return r(e,n+o)}return s}}function Cd(e,t){return t}function Id(e,t){return!!Ad(e,t)}function Ad(e,t){return kd(e,t)<<24>>24}function kd(e,t){return e[t]}function Ld(e,t){return function(e,t){return e[t]|e[t+1]<<8}(e,t)<<16>>16}function Rd(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24}function Pd(e,t){return Rd(e,t)>>>0}function Dd(e,t){return _d(BigInt.asIntN(64,BigInt(Pd(e,t))+(BigInt(Pd(e,t+4))<<32n)))}function Md(e,t){let n=t+Rd(e,t);const i=Rd(e,n);return n+=4,Sd(e.subarray(n,n+i))}function Nd(e,t,n,i){if(!t)return[];const o=t+Rd(e,t);return Array.from({length:Rd(e,o)},(t,r)=>i(e,o+4+r*n))}new TextEncoder;const Od=Symbol("rowIndex");function Bd(e,t){class n{constructor(e){this[Od]=e}toJSON(){return zd(e,t,this[Od])}}const i=n.prototype;for(let o=0;o<e.length;++o){if(Object.hasOwn(i,e[o]))continue;const n=t[o];Object.defineProperty(i,e[o],{get(){return n.at(this[Od])},enumerable:!0})}return e=>new n(e)}function Fd(e,t){return n=>zd(e,t,n)}function zd(e,t,n){const i={};for(let o=0;o<e.length;++o)i[e[o]]=t[o].at(n);return i}class Ud{constructor({length:e,nullCount:t,type:n,validity:i,values:o,offsets:r,sizes:s,children:a}){this.length=e,this.nullCount=t,this.type=n,this.validity=i,this.values=o,this.offsets=r,this.sizes=s,this.children=a,t&&this.validity||(this.at=e=>this.value(e))}get[Symbol.toStringTag](){return"Batch"}at(e){return this.isValid(e)?this.value(e):null}isValid(e){return Ed(this.validity,e)}value(e){return this.values[e]}slice(e,t){const n=t-e,i=Array(n);for(let o=0;o<n;++o)i[o]=this.at(e+o);return i}*[Symbol.iterator](){for(let e=0;e<this.length;++e)yield this.at(e)}}s(Ud,"ArrayType",null);class $d extends Ud{constructor(e){super(e);const{length:t,values:n}=this;this.values=n.subarray(0,t)}slice(e,t){return this.nullCount?super.slice(e,t):this.values.subarray(e,t)}[Symbol.iterator](){return this.nullCount?super[Symbol.iterator]():this.values[Symbol.iterator]()}}class Vd extends Ud{}s(Vd,"ArrayType",nd);class Hd extends Ud{}s(Hd,"ArrayType",Array);class Gd extends Hd{value(e){return null}}class Wd extends Vd{value(e){return _d(this.values[e])}}class jd extends Vd{value(e){const t=this.values[e],n=(31744&t)>>10,i=(1023&t)/1024,o=(-1)**((32768&t)>>15);switch(n){case 31:return o*(i?Number.NaN:1/0);case 0:return o*(i?6103515625e-14*i:0)}return o*2**(n-15)*(1+i)}}class Yd extends Hd{value(e){return Ed(this.values,e)}}class qd extends Vd{constructor(e){super(e);const{scale:t}=this.type;this.scale=10**t}value(e){return this.values[e]/this.scale}}class Xd extends Ud{constructor(e){super(e);const{bitWidth:t,scale:n}=this.type;this.decimal=64===t?bd:128===t?vd:xd,this.scale=10n**BigInt(n)}}class Kd extends Xd{value(e){return gd(this.decimal(this.values,e),this.scale)}}s(Kd,"ArrayType",nd);class Zd extends Xd{value(e){return this.decimal(this.values,e)}}s(Zd,"ArrayType",Array);class Qd extends Hd{constructor(e){super(e),this.source=e}value(e){return new Date(this.source.value(e))}}class Jd extends Vd{value(e){return 864e5*this.values[e]}}const ep=Wd;class tp extends Wd{value(e){return 1e3*super.value(e)}}const np=Wd;class ip extends Wd{value(e){return gd(this.values[e],1000n)}}class op extends Wd{value(e){return gd(this.values[e],1000000n)}}class rp extends Hd{value(e){return this.values.subarray(e<<1,e+1<<1)}}class sp extends Hd{value(e){const t=this.values,n=e<<4;return Float64Array.of(Rd(t,n),Rd(t,n+4),Dd(t,n+8))}}const ap=({values:e,offsets:t},n)=>e.subarray(t[n],t[n+1]),lp=({values:e,offsets:t},n)=>e.subarray(_d(t[n]),_d(t[n+1]));class cp extends Hd{value(e){return ap(this,e)}}class up extends Hd{value(e){return lp(this,e)}}class hp extends Hd{value(e){return Sd(ap(this,e))}}class dp extends Hd{value(e){return Sd(lp(this,e))}}class pp extends Hd{value(e){const t=this.offsets;return this.children[0].slice(t[e],t[e+1])}}class fp extends Hd{value(e){const t=this.offsets;return this.children[0].slice(_d(t[e]),_d(t[e+1]))}}class mp extends Hd{value(e){const t=this.offsets[e],n=t+this.sizes[e];return this.children[0].slice(t,n)}}class _p extends Hd{value(e){const t=this.offsets[e],n=t+this.sizes[e];return this.children[0].slice(_d(t),_d(n))}}class gp extends Hd{constructor(e){super(e),this.stride=this.type.stride}}class yp extends gp{value(e){const{stride:t,values:n}=this;return n.subarray(e*t,(e+1)*t)}}class bp extends gp{value(e){const{children:t,stride:n}=this;return t[0].slice(e*n,(e+1)*n)}}function vp({children:e,offsets:t},n){const[i,o]=e[0].children,r=t[n],s=t[n+1],a=[];for(let l=r;l<s;++l)a.push([i.at(l),o.at(l)]);return a}class xp extends Hd{value(e){return vp(this,e)}}class wp extends Hd{value(e){return new Map(vp(this,e))}}class Sp extends Hd{constructor({typeIds:e,...t}){super(t),this.typeIds=e,this.typeMap=this.type.typeMap}value(e,t=e){const{typeIds:n,children:i,typeMap:o}=this;return i[o[n[e]]].at(t)}}class Ep extends Sp{value(e){return super.value(e,this.offsets[e])}}class Tp extends Hd{constructor(e,t=Fd){super(e),this.names=this.type.children.map(e=>e.name),this.factory=t(this.names,this.children)}value(e){return this.factory(e)}}class Cp extends Tp{constructor(e){super(e,Bd)}}class Ip extends Hd{value(e){const[{values:t},n]=this.children;return n.at(od(t,e))}}let Ap=class extends Hd{setDictionary(e){return this.dictionary=e,this.cache=e.cache(),this}value(e){return this.cache[this.key(e)]}key(e){return this.values[e]}};class kp extends Hd{constructor({data:e,...t}){super(t),this.data=e}view(e){const{values:t,data:n}=this,i=e<<4;let o=i+4,r=t;const s=Rd(r,i);return s>12&&(o=Rd(r,i+12),r=n[Rd(r,i+8)]),r.subarray(o,o+s)}}class Lp extends kp{value(e){return this.view(e)}}class Rp extends kp{value(e){return Sd(this.view(e))}}function Pp(e){let t=[];return{add(e){return t.push(e),this},clear:()=>t=[],done:()=>new Dp(t,e)}}class Dp{constructor(e,t=(t=>null==(t=e[0])?void 0:t.type)()){this.type=t,this.length=e.reduce((e,t)=>e+t.length,0),this.nullCount=e.reduce((e,t)=>e+t.nullCount,0),this.data=e;const n=e.length,i=new Int32Array(n+1);if(1===n){const[t]=e;i[1]=t.length,this.at=e=>t.at(e)}else for(let o=0,r=0;o<n;++o)i[o+1]=r+=e[o].length;this.offsets=i}get[Symbol.toStringTag](){return"Column"}[Symbol.iterator](){const e=this.data;return 1===e.length?e[0][Symbol.iterator]():function*(e){for(let t=0;t<e.length;++t){const n=e[t][Symbol.iterator]();for(let e=n.next();!e.done;e=n.next())yield e.value}}(e)}at(e){var t;const{data:n,offsets:i}=this,o=od(i,e)-1;return null==(t=n[o])?void 0:t.at(e-i[o])}get(e){return this.at(e)}toArray(){const{length:e,nullCount:t,data:n}=this,i=!t&&n[0]instanceof $d,o=n.length;if(i&&1===o)return n[0].values;const r=new(!o||t>0?Array:n[0].constructor.ArrayType??n[0].values.constructor)(e);return i?function(e,t){for(let n=0,i=0;n<t.length;++n){const{values:o}=t[n];e.set(o,i),i+=o.length}return e}(r,n):function(e,t){let n=-1;for(let i=0;i<t.length;++i){const o=t[i];for(let t=0;t<o.length;++t)e[++n]=o.at(t)}return e}(r,n)}cache(){return this._cache??(this._cache=this.toArray())}}let Mp=class e{constructor(e,t,n=!1){const i=e.fields.map(e=>e.name);this.schema=e,this.names=i,this.children=t,this.factory=n?Bd:Fd;const o=[];this.getFactory=e=>o[e]??(o[e]=this.factory(i,t.map(t=>t.data[e])))}get[Symbol.toStringTag](){return"Table"}get numCols(){return this.names.length}get numRows(){var e;return(null==(e=this.children[0])?void 0:e.length)??0}getChildAt(e){return this.children[e]}getChild(e){const t=this.names.findIndex(t=>t===e);return t>-1?this.children[t]:void 0}selectAt(t,n=[]){const{children:i,factory:o,schema:r}=this,{fields:s}=r;return new e({...r,fields:t.map((e,t)=>{return i=s[e],null!=(o=n[t])&&o!==i.name?{...i,name:o}:i;var i,o})},t.map(e=>i[e]),o===Bd)}select(e,t){const n=this.names,i=e.map(e=>n.indexOf(e));return this.selectAt(i,t)}toColumns(){const{children:e,names:t}=this,n={};return t.forEach((t,i)=>{var o;return n[t]=(null==(o=e[i])?void 0:o.toArray())??[]}),n}toArray(){var e;const{children:t,getFactory:n,numRows:i}=this,o=(null==(e=t[0])?void 0:e.data)??[],r=Array(i);for(let s=0,a=-1;s<o.length;++s){const e=n(s);for(let t=0;t<o[s].length;++t)r[++a]=e(t)}return r}*[Symbol.iterator](){var e;const{children:t,getFactory:n}=this,i=(null==(e=t[0])?void 0:e.data)??[];for(let o=0;o<i.length;++o){const e=n(o);for(let t=0;t<i[o].length;++t)yield e(t)}}at(e){const{children:t,getFactory:n,numRows:i}=this;if(e<0||e>=i)return null;const[{offsets:o}]=t,r=od(o,e)-1;return n(r)(e-o[r])}get(e){return this.at(e)}};function Np(e,t){return t?class extends t{constructor(t){super(new e(t))}}:e}const Op=new Map;function Bp(e,t){return{offset:Dd(e,t),metadataLength:Rd(e,t+8),bodyLength:Dd(e,t+16)}}function Fp(e,t){return Nd(e,t,24,Bp)}function zp(e,t){const n=Td(e,t);return{codec:n(4,Ad,jh.LZ4_FRAME),method:n(6,Ad,0)}}function Up(e,t,n){const i=Td(e,t),o=n<3?8:0;return{length:i(4,Dd,0),nodes:Nd(e,i(6,Cd),16,(e,t)=>({length:Dd(e,t),nullCount:Dd(e,t+8)})),regions:Nd(e,i(8,Cd),16+o,(e,t)=>({offset:Dd(e,t+o),length:Dd(e,t+o+8)})),compression:i(10,zp),variadic:Nd(e,i(12,Cd),8,Dd)}}function $p(e,t,n){const i=Td(e,t);return{id:i(4,Dd,0),data:i(6,(e,t)=>Up(e,t,n)),isDelta:i(8,Id,!1)}}function Vp(e,t,n,i){sd(n,Uh,ld);const o=Td(e,t);switch(n){case Uh.Binary:return{typeId:Uh.Binary,offsets:Jh};case Uh.Utf8:return{typeId:Uh.Utf8,offsets:Jh};case Uh.LargeBinary:return{typeId:Uh.LargeBinary,offsets:ed};case Uh.LargeUtf8:return{typeId:Uh.LargeUtf8,offsets:ed};case Uh.List:return c=i[0],{typeId:Uh.List,children:[dd(c)],offsets:Jh};case Uh.ListView:return(e=>({typeId:Uh.ListView,children:[dd(e,"value")],offsets:Jh}))(i[0]);case Uh.LargeList:return(e=>({typeId:Uh.LargeList,children:[dd(e)],offsets:ed}))(i[0]);case Uh.LargeListView:return(e=>({typeId:Uh.LargeListView,children:[dd(e,"value")],offsets:ed}))(i[0]);case Uh.Struct:return(e=>({typeId:Uh.Struct,children:Array.isArray(e)&&e.length>0&&ud(e[0])?e:Object.entries(e).map(([e,t])=>cd(e,t))}))(i);case Uh.RunEndEncoded:return a=i[0],l=i[1],{typeId:Uh.RunEndEncoded,children:[rd(dd(a,"run_ends"),e=>e.type.typeId===Uh.Int,()=>"Run-ends must have an integer type."),dd(l,"values")]};case Uh.Int:return pd(o(4,Rd,0),o(6,Id,!1));case Uh.Float:return((e=2)=>({typeId:Uh.Float,precision:sd(e,$h),values:[qh,td,nd][e]}))(o(4,Ld,$h.HALF));case Uh.Decimal:return((e,t,n=128)=>({typeId:Uh.Decimal,precision:e,scale:t,bitWidth:sd(n,[32,64,128,256]),values:32===n?Jh:Kh}))(o(4,Rd,0),o(6,Rd,0),o(8,Rd,128));case Uh.Date:return s=o(4,Ld,Vh.MILLISECOND),{typeId:Uh.Date,unit:sd(s,Vh),values:s===Vh.DAY?Jh:ed};case Uh.Time:return((e=Hh.MILLISECOND)=>{const t=(e=sd(e,Hh))===Hh.SECOND||e===Hh.MILLISECOND?32:64;return{typeId:Uh.Time,unit:e,bitWidth:t,values:32===t?Jh:ed}})(o(4,Ld,Hh.MILLISECOND));case Uh.Timestamp:return((e=Hh.MILLISECOND,t=null)=>({typeId:Uh.Timestamp,unit:sd(e,Hh),timezone:t,values:ed}))(o(4,Ld,Hh.SECOND),o(6,Md));case Uh.Interval:return((e=Gh.MONTH_DAY_NANO)=>({typeId:Uh.Interval,unit:sd(e,Gh),values:e===Gh.MONTH_DAY_NANO?void 0:Jh}))(o(4,Ld,Gh.YEAR_MONTH));case Uh.Duration:return((e=Hh.MILLISECOND)=>({typeId:Uh.Duration,unit:sd(e,Hh),values:ed}))(o(4,Ld,Hh.MILLISECOND));case Uh.FixedSizeBinary:return r=o(4,Rd,0),{typeId:Uh.FixedSizeBinary,stride:r};case Uh.FixedSizeList:return((e,t)=>({typeId:Uh.FixedSizeList,stride:t,children:[dd(e)]}))(i[0],o(4,Rd,0));case Uh.Map:return((e,t)=>({typeId:Uh.Map,keysSorted:e,children:[t],offsets:Jh}))(o(4,Id,!1),i[0]);case Uh.Union:return((e,t,n)=>(n??(n=t.map((e,t)=>t)),{typeId:Uh.Union,mode:sd(e,Wh),typeIds:n,typeMap:n.reduce((e,t,n)=>(e[t]=n,e),{}),children:t.map((e,t)=>dd(e,`_${t}`)),typeIdForValue:void 0,offsets:Jh}))(o(4,Ld,Wh.Sparse),i,Nd(e,o(6,Cd),4,Rd))}var r,s,a,l,c;return{typeId:n}}function Hp(e,t){const n=Nd(e,t,4,(e,t)=>{const n=Td(e,t);return[n(4,Md),n(6,Md)]});return n.length?new Map(n):null}function Gp(e,t,n){const i=Td(e,t);return{version:n,endianness:i(4,Ld,0),fields:i(6,Wp,[]),metadata:i(8,Hp)}}function Wp(e,t){return Nd(e,t,4,jp)}function jp(e,t){const n=Td(e,t),i=n(8,kd,Uh.NONE),o=n(10,Cd,0),r=n(12,qp);let s=Vp(e,o,i,n(14,Yp,[]));return r&&(r.dictionary=s,s=r),{name:n(4,Md),type:s,nullable:n(6,Id,!1),metadata:n(16,Hp)}}function Yp(e,t){return Nd(e,t,4,jp)}function qp(e,t){if(!t)return null;const n=Td(e,t);return((e,t,n=!1,i=-1)=>({typeId:Uh.Dictionary,id:i,dictionary:e,indices:t||fd(),ordered:n}))(null,n(6,Xp,fd()),n(8,Id,!1),n(4,Dd,0))}function Xp(e,t){return Vp(e,t,Uh.Int)}function Kp(e,t){let n=Rd(e,t)||0;if(t+=4,-1===n&&(n=Rd(e,t)||0,t+=4),0===n)return null;const i=e.subarray(t,t+=n);if(i.byteLength<n)throw new Error(`Expected to read ${n} metadata bytes, but only read ${i.byteLength}.`);const o=Td(i,0),r=o(4,Ld,0),s=o(6,kd,zh.NONE),a=o(8,Cd,0),l=o(10,Dd,0);let c;if(a){const n=s===zh.Schema?Gp:s===zh.DictionaryBatch?$p:s===zh.RecordBatch?Up:null;if(!n)throw new Error((e=>`Unsupported message type: ${e} (${ad(zh,e)})`)(s));if(c=n(i,a,r),l>0){const n=e.subarray(t,t+=l);if(n.byteLength<l)throw new Error(((e,t)=>`Expected to read ${e} bytes for message body, but only read ${t}.`)(l,n.byteLength));c.body=n}else s!==zh.Schema&&(c.body=new Uint8Array(0))}return{version:r,type:s,index:t,content:c}}function Zp(e,t){return function(e,t={}){const{schema:n={fields:[]},dictionaries:i,records:o}=e,{version:r,fields:s}=n,a=new Map,l=function(e,t,n){const i={version:t,options:e,dictionary:e=>n.get(e)};return e=>{const{length:t,nodes:n,regions:o,compression:r,variadic:s,body:a}=e;let l=-1,c=-1,u=-1;return{...i,length:t,node:()=>n[++l],buffer:e=>{const{bytes:t,length:n,offset:i}=function(e,t,n){if(n){if(0!==n.method)throw new Error(`Unknown compression method (${n.method})`);{const o=n.codec,r=null!=(i=o)&&Op.get(i)||null;if(!r)throw new Error(function(e){return`Missing compression codec "${ad(jh,e)}" (id ${e})`}(o));return function(e,{offset:t,length:n},i){if(0===n)return{bytes:new Uint8Array(0),offset:0,length:0};const o=Dd(e,t),r=e.subarray(t+8,t+n),s=-1===o?r:i.decode(r);return{bytes:s,offset:0,length:s.length}}(e,t,r)}}return{bytes:e,...t};var i}(a,o[++c],r);return e?new e(t.buffer,t.byteOffset+i,n/e.BYTES_PER_ELEMENT):t.subarray(i,i+n)},variadic:()=>s[++u],visit(e){return e.map(e=>Qp(e.type,this))}}}}(t,r,a),c=new Map;!function(e){e.fields.forEach(function e(t){var n,i,o;(e=>{const t=e.type;t.typeId===Uh.Dictionary&&c.set(t.id,t.dictionary)})(t),null==(i=null==(n=t.type.dictionary)?void 0:n.children)||i.forEach(e),null==(o=t.type.children)||o.forEach(e)})}(n);const u=new Map;for(const d of i){const{id:e,data:t,isDelta:n,body:i}=d,o=c.get(e),r=Qp(o,l({...t,body:i}));if(u.has(e)){const t=u.get(e);n||t.clear(),t.add(r)}else{if(n)throw new Error("Delta update can not be first dictionary batch.");u.set(e,Pp(o).add(r))}}u.forEach((e,t)=>a.set(t,e.done()));const h=s.map(e=>Pp(e.type));for(const d of o){const e=l(d);s.forEach((t,n)=>h[n].add(Qp(t.type,e)))}return new Mp(n,h.map(e=>e.done()),t.useProxy)}(function(e){const t=function(e){return e instanceof ArrayBuffer||"undefined"!=typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer}(e)?new Uint8Array(e):e;return t instanceof Uint8Array&&function(e){if(!e||e.length<4)return!1;for(let t=0;t<6;++t)if(Fh[t]!==e[t])return!1;return!0}(t)?function(e){const t=e.byteLength-(Fh.length+4),n=Rd(e,t),i=Td(e,t-n),o=i(4,Ld,0),r=i(8,Fp,[]),s=i(10,Fp,[]);return{schema:i(6,(e,t)=>Gp(e,t,o)),dictionaries:r.map(({offset:t})=>Kp(e,t).content),records:s.map(({offset:t})=>Kp(e,t).content),metadata:i(12,Hp)}}(t):function(e){const t=[e].flat();let n;const i=[],o=[];for(const r of t){if(!(r instanceof Uint8Array))throw new Error("IPC data batch was not a Uint8Array.");let e=0;for(;;){const t=Kp(r,e);if(null===t)break;if(e=t.index,t.content)switch(t.type){case zh.Schema:n||(n=t.content);break;case zh.RecordBatch:i.push(t.content);break;case zh.DictionaryBatch:o.push(t.content)}}}return{schema:n,dictionaries:o,records:i,metadata:null}}(t)}(e),t)}function Qp(e,t){const{typeId:n}=e,{options:i,node:o,buffer:r,variadic:s,version:a}=t,l=function(e,t={}){const{typeId:n,bitWidth:i,mode:o,precision:r,unit:s}=e,{useBigInt:a,useDate:l,useDecimalInt:c,useMap:u,useProxy:h}=t;switch(n){case Uh.Null:return Gd;case Uh.Bool:return Yd;case Uh.Int:case Uh.Time:case Uh.Duration:return a||i<64?$d:Wd;case Uh.Float:return r?$d:jd;case Uh.Date:return Np(s===Vh.DAY?Jd:ep,l&&Qd);case Uh.Timestamp:return Np(s===Hh.SECOND?tp:s===Hh.MILLISECOND?np:s===Hh.MICROSECOND?ip:op,l&&Qd);case Uh.Decimal:return 32===i?c?$d:qd:c?Zd:Kd;case Uh.Interval:return s===Gh.DAY_TIME?rp:s===Gh.YEAR_MONTH?$d:sp;case Uh.FixedSizeBinary:return yp;case Uh.Utf8:return hp;case Uh.LargeUtf8:return dp;case Uh.Binary:return cp;case Uh.LargeBinary:return up;case Uh.BinaryView:return Lp;case Uh.Utf8View:return Rp;case Uh.List:return pp;case Uh.LargeList:return fp;case Uh.Map:return u?wp:xp;case Uh.ListView:return mp;case Uh.LargeListView:return _p;case Uh.FixedSizeList:return bp;case Uh.Struct:return h?Cp:Tp;case Uh.RunEndEncoded:return Ip;case Uh.Dictionary:return Ap;case Uh.Union:return o?Ep:Sp}throw new Error(ld(n))}(e,i),c={...o(),type:e};if(n===Uh.Null)return new l({...c,nullCount:c.length});switch(n){case Uh.Bool:case Uh.Int:case Uh.Time:case Uh.Duration:case Uh.Float:case Uh.Decimal:case Uh.Date:case Uh.Timestamp:case Uh.Interval:case Uh.FixedSizeBinary:return new l({...c,validity:r(),values:r(e.values)});case Uh.Utf8:case Uh.LargeUtf8:case Uh.Binary:case Uh.LargeBinary:return new l({...c,validity:r(),offsets:r(e.offsets),values:r()});case Uh.BinaryView:case Uh.Utf8View:return new l({...c,validity:r(),values:r(),data:Array.from({length:s()},()=>r())});case Uh.List:case Uh.LargeList:case Uh.Map:return new l({...c,validity:r(),offsets:r(e.offsets),children:t.visit(e.children)});case Uh.ListView:case Uh.LargeListView:return new l({...c,validity:r(),offsets:r(e.offsets),sizes:r(e.offsets),children:t.visit(e.children)});case Uh.FixedSizeList:case Uh.Struct:return new l({...c,validity:r(),children:t.visit(e.children)});case Uh.RunEndEncoded:return new l({...c,children:t.visit(e.children)});case Uh.Dictionary:{const{id:n,indices:i}=e;return new l({...c,validity:r(),values:r(i.values)}).setDictionary(t.dictionary(n))}case Uh.Union:return a<4&&r(),new l({...c,typeIds:r(Zh),offsets:e.mode===Wh.Sparse?null:r(e.offsets),children:t.visit(e.children)});default:throw new Error(ld(n))}}function Jp(e,t={useDate:!0}){return Zp(e,t)}new Uint16Array(new Uint8Array([1,0]).buffer)[0];class ef{constructor({uri:e="ws://localhost:3000/",ipc:t}={}){s(this,"_uri"),s(this,"_queue"),s(this,"_connected"),s(this,"_request"),s(this,"_ws"),s(this,"_events"),this._uri=e,this._queue=[],this._connected=!1,this._request=null,this._ws=null;const n=this;this._events={open(){n._connected=!0,n.next()},close(){for(n._connected=!1,n._request=null,n._ws=null;n._queue.length;)n._queue.shift().reject("Socket closed")},error(e){if(n._request){const{reject:t}=n._request;n._request=null,n.next(),t(e)}else console.error("WebSocket error: ",e)},message(e){const{data:i}=e;if(n._request){const{query:e,resolve:o,reject:r}=n._request;if(n._request=null,n.next(),"string"==typeof i){const e=JSON.parse(i);e.error?r(e.error):o(e)}else if("exec"===e.type)o();else{if("arrow"!==e.type)throw new Error(`Unexpected socket data: ${i}`);o(Jp(i,t))}}}}}get connected(){return this._connected}init(){this._ws=new WebSocket(this._uri),this._ws.binaryType="arraybuffer";for(const e in this._events)this._ws.addEventListener(e,this._events[e])}enqueue(e,t,n){null==this._ws&&this.init(),this._queue.push({query:e,resolve:t,reject:n}),this._connected&&!this._request&&this.next()}next(){this._queue.length&&(this._request=this._queue.shift(),this._ws.send(JSON.stringify(this._request.query)))}query(e){return new Promise((t,n)=>this.enqueue(e,t,n))}}function tf(e){return e instanceof of}let nf;class of{constructor(e){s(this,"type"),this.type=e}clone(){const e=new this.constructor(this.type);for(const t in this)"type"!==t&&(e[t]=this[t]);return e}toString(e=nf){if(!e)throw new Error("No visitor provided and no default visitor set.");return e.toString(this)}}class rf extends of{}function sf(e){return e.split(".")}function af(e){return`"${e.replaceAll('"','""')}"`}function lf(e){return e&&function(e){return'"'===e[0]&&'"'===e[e.length-1]}(e)?e.slice(1,-1):e}const cf="COLUMN_REF",uf="COLUMN_PARAM",hf="TABLE_REF",df="LITERAL",pf="UNNEST",ff="ORDER_BY",mf="CAST",_f="CASE",gf="WHEN",yf="COLLATE",bf="UNARY",vf="UNARY_POSTFIX",xf="BINARY",wf="BETWEEN",Sf="NOT_BETWEEN",Ef="LOGICAL_OPERATOR",Tf="IN",Cf="FUNCTION",If="AGGREGATE",Af="WINDOW",kf="WINDOW_FUNCTION",Lf="WINDOW_DEF",Rf="WINDOW_FRAME",Pf="WINDOW_EXTENT_EXPR",Df="EXPRESSION",Mf="FRAGMENT",Nf="VERBATIM",Of="PARAM",Bf="WITH_CLAUSE",Ff="WINDOW_CLAUSE",zf="SELECT_CLAUSE",Uf="FROM_CLAUSE",$f="JOIN_CLAUSE",Vf="SAMPLE_CLAUSE",Hf="SELECT_QUERY",Gf="DESCRIBE_QUERY",Wf="SET_OPERATION",jf="SCALAR_SUBQUERY";class Yf extends rf{constructor(e){super(df),s(this,"value"),this.value=e}}function qf(e){switch(typeof e){case"number":return Number.isFinite(e)?`${e}`:"NULL";case"string":return`'${e.replaceAll("'","''")}'`;case"boolean":return e?"TRUE":"FALSE";default:if(null==e)return"NULL";if(e instanceof Date){const t=+e;if(Number.isNaN(t))return"NULL";const n=e.getUTCFullYear(),i=e.getUTCMonth(),o=e.getUTCDate();return t===Date.UTC(n,i,o)?`DATE '${n}-${i+1}-${o}'`:`epoch_ms(${t})`}return e instanceof RegExp?`'${e.source}'`:`${e}`}}class Xf{toString(e){if(!e)throw new Error("Node is null or undefined");if("string"!=typeof e.type)throw new Error(`Node type is not a string: ${typeof e.type}, value: ${e.type}`);if("CUSTOM"===e.type)return e.toString(this);const t=this.getVisitMethod(e.type);if("function"==typeof t)return t.call(this,e);throw new Error(`No visitor method for node type: '${e.type}'`)}getVisitMethod(e){switch(e){case If:return this.visitAggregate;case wf:return this.visitBetween;case xf:return this.visitBinary;case _f:return this.visitCase;case mf:return this.visitCast;case yf:return this.visitCollate;case uf:return this.visitColumnParam;case cf:return this.visitColumnRef;case Gf:return this.visitDescribeQuery;case Df:return this.visitExpression;case Mf:return this.visitFragment;case Uf:return this.visitFromClause;case Cf:return this.visitFunction;case Tf:return this.visitIn;case"INTERVAL":return this.visitInterval;case $f:return this.visitJoinClause;case"LIST":return this.visitList;case df:return this.visitLiteral;case Ef:return this.visitLogicalOperator;case Sf:return this.visitNotBetween;case ff:return this.visitOrderBy;case Of:return this.visitParam;case Vf:return this.visitSampleClause;case jf:return this.visitScalarSubquery;case zf:return this.visitSelectClause;case Hf:return this.visitSelectQuery;case Wf:return this.visitSetOperation;case hf:return this.visitTableRef;case bf:return this.visitUnary;case vf:return this.visitUnaryPostfix;case pf:return this.visitUnnest;case Nf:return this.visitVerbatim;case gf:return this.visitWhen;case Af:return this.visitWindow;case Ff:return this.visitWindowClause;case Lf:return this.visitWindowDef;case Pf:return this.visitWindowExtentExpr;case Rf:return this.visitWindowFrame;case kf:return this.visitWindowFunction;case Bf:return this.visitWithClause;default:throw new Error(`Unknown node type: '${e}'`)}}mapToString(e){return e.map(e=>this.toString(e))}}function Kf(e){return"string"==typeof e}function Zf(e){return Array.isArray(e)}function Qf(e){if(e){const t=e;return"function"==typeof(null==t?void 0:t.addEventListener)&&!1!==t.dynamic&&"value"in t}return!1}class Jf extends rf{constructor(e){super(Of),s(this,"param"),this.param=e}get value(){return this.param.value}}const em="CURRENT ROW",tm="UNBOUNDED";function nm(e,t,n){const{extent:i,expr:o}=t;if(!i)return"";const[r,s]=e.mapToString(i);return`(${e.toString(o)} ${n} ${r} AND ${s})`}function im(e,t,n){const i=tf(t)?e.toString(t):t;return tf(t)&&t.type===Pf?i:null!=i&&"number"!=typeof i?`${i} ${n}`:0===i?em:i&&Number.isFinite(i)?`${Math.abs(i)} ${n}`:`${tm} ${n}`}const om=new class extends Xf{visitAggregate(e){const{name:t,args:n,isDistinct:i,filter:o,order:r}=e,s=[i?"DISTINCT":"",(null==n?void 0:n.length)?this.mapToString(n).join(", "):"count"===t.toLowerCase()?"*":"",r.length?`ORDER BY ${this.mapToString(r).join(", ")}`:""].filter(e=>e).join(" ");return`${t}(${s})${o?` FILTER (WHERE ${this.toString(o)})`:""}`}visitBetween(e){return nm(this,e,"BETWEEN")}visitBinary(e){const{left:t,right:n,op:i}=e;return`(${this.toString(t)} ${i} ${this.toString(n)})`}visitCase(e){const{expr:t,_when:n,_else:i}=e;return"CASE "+(t?`${this.toString(t)} `:"")+this.mapToString(n).join(" ")+(i?` ELSE ${this.toString(i)}`:"")+" END"}visitCast(e){const{expr:t,cast:n}=e;return`(${this.toString(t)})::${n}`}visitCollate(e){const{expr:t,collation:n}=e;return`${this.toString(t)} COLLATE ${n}`}visitColumnParam(e){return this.visitColumnRef(e)}visitColumnRef(e){const{column:t,table:n}=e;return`${n?`${this.toString(n)}.`:""}${"*"===t?"*":af(t)}`}visitDescribeQuery(e){const{query:t}=e;return`DESC ${this.toString(t)}`}visitExpression(e){throw new Error(`Unexpected EXPRESSION node type. Node: ${JSON.stringify(e)}`)}visitFragment(e){const{spans:t}=e;return t.map(e=>"string"==typeof e?e:this.toString(e)).join("")}visitFromClause(e){var t;const{expr:n,alias:i,sample:o}=e,r=Gm(n)?`(${this.toString(n)})`:`${this.toString(n)}`;return`${!i||wm(n)&&(null==(t=n.table)?void 0:t.join("."))===i?`${r}`:`${r} AS ${af(i)}`}${o?` TABLESAMPLE ${this.toString(o)}`:""}`}visitFunction(e){const{name:t,args:n}=e;return`${t}(${this.mapToString(n).join(", ")})`}visitIn(e){const{expr:t,values:n}=e;return`(${this.toString(t)} IN (${this.mapToString(n).join(", ")}))`}visitInterval(e){const{steps:t,name:n}=e;return`INTERVAL ${t} ${n}`}visitJoinClause(e){const{left:t,right:n,joinVariant:i,joinType:o,condition:r,using:s,sample:a}=e,l="REGULAR"===i?"":`${i} `;let c="",u="";"CROSS"!==i&&(c="INNER"!==o?`${o} `:"",u=r?` ON ${this.toString(r)}`:s?` USING (${this.mapToString(s).join(", ")})`:"");const h=a?` USING SAMPLE ${this.toString(a)}`:"";return`${this.toString(t)} ${l}${c}JOIN ${this.toString(n)}${u}${h}`}visitList(e){const{values:t}=e;return`[${this.mapToString(t).join(", ")}]`}visitLiteral(e){const{value:t}=e;return qf(t)}visitLogicalOperator(e){const{clauses:t,op:n}=e,i=this.mapToString(t);return 0===i.length?"":1===i.length?`${i[0]}`:`(${i.join(` ${n} `)})`}visitNotBetween(e){return nm(this,e,"NOT BETWEEN")}visitOrderBy(e){const{expr:t,desc:n,nullsFirst:i}=e,o=n?" DESC":!1===n?" ASC":"",r=i?" NULLS FIRST":!1===i?" NULLS LAST":"";return`${this.toString(t)}${o}${r}`}visitParam(e){const{param:t}=e;return qf(t.value)}visitSampleClause(e){const{size:t,perc:n,method:i,seed:o}=e;return`${i?`${i} `:""}(${t}${n?"%":" ROWS"})${null!=o?` REPEATABLE (${o})`:""}`}visitScalarSubquery(e){return`(${this.toString(e.subquery)})`}visitSelectClause(e){const{expr:t,alias:n}=e;return!n||function(e,t){return e instanceof _m&&null==e.table&&e.column===t}(t,n)?this.toString(t):`${this.toString(t)} AS ${af(n)}`}visitSelectQuery(e){const{_with:t,_select:n,_distinct:i,_from:o,_sample:r,_where:s,_groupby:a,_having:l,_window:c,_qualify:u,_orderby:h,_limitPerc:d,_limit:p,_offset:f}=e,m=[];if(t.length&&m.push(`WITH ${this.mapToString(t).join(", ")}`),m.push(`SELECT${i?" DISTINCT":""} ${this.mapToString(n).join(", ")}`),o.length&&m.push(`FROM ${this.mapToString(o).join(", ")}`),r&&m.push(`USING SAMPLE ${this.toString(r)}`),s.length){const e=this.mapToString(s).filter(e=>e).join(" AND ");e&&m.push(`WHERE ${e}`)}if(a.length&&m.push(`GROUP BY ${this.mapToString(a).join(", ")}`),l.length){const e=this.mapToString(l).filter(e=>e).join(" AND ");e&&m.push(`HAVING ${e}`)}if(c.length&&m.push(`WINDOW ${this.mapToString(c).join(", ")}`),u.length){const e=this.mapToString(u).filter(e=>e).join(" AND ");e&&m.push(`QUALIFY ${e}`)}return h.length&&m.push(`ORDER BY ${this.mapToString(h).join(", ")}`),p&&m.push(`LIMIT ${this.toString(p)}${d?"%":""}`),null!=f&&m.push(`OFFSET ${this.toString(f)}`),m.join(" ")}visitSetOperation(e){const{op:t,queries:n,_with:i,_orderby:o,_limitPerc:r,_limit:s,_offset:a}=e,l=[];return i.length&&l.push(`WITH ${this.mapToString(i).join(", ")}`),l.push(n.join(` ${t} `)),o.length&&l.push(`ORDER BY ${this.mapToString(o).join(", ")}`),s&&l.push(`LIMIT ${this.toString(s)}${r?"%":""}`),a&&l.push(`OFFSET ${this.toString(a)}`),l.join(" ")}visitTableRef(e){const{table:t}=e;return t.map(e=>af(e)).join(".")}visitUnary(e){const{expr:t,op:n}=e;return`(${n} ${this.toString(t)})`}visitUnaryPostfix(e){const{expr:t,op:n}=e;return`(${this.toString(t)} ${n})`}visitUnnest(e){const{expr:t,recursive:n,maxDepth:i}=e,o=[this.toString(t)];return n&&o.push("recursive := true"),null!=i&&i>0&&o.push(`max_depth := ${i}`),`UNNEST(${o.join(", ")})`}visitVerbatim(e){const{value:t}=e;return t}visitWhen(e){const{when:t,then:n}=e;return`WHEN ${this.toString(t)} THEN ${this.toString(n)}`}visitWindow(e){const{func:t,def:n}=e;return`${this.toString(t)} OVER ${this.toString(n)}`}visitWindowClause(e){const{name:t,def:n}=e;return`${af(t)} AS ${this.toString(n)}`}visitWindowDef(e){const{name:t,partition:n,order:i,framedef:o}=e,r=t&&af(t),s=[r,(null==n?void 0:n.length)&&`PARTITION BY ${this.mapToString(n).join(", ")}`,(null==i?void 0:i.length)&&`ORDER BY ${this.mapToString(i).join(", ")}`,o&&this.toString(o)].filter(e=>e);return r&&s.length<2?r:`(${s.join(" ")})`}visitWindowExtentExpr(e){const{scope:t,expr:n}=e;return t===em?t:`${tf(n)?this.toString(n):n??tm} ${t}`}visitWindowFrame(e){const{frameType:t,exclude:n,extent:i}=e,[o,r]=tf(i)?i.value:i;return`${t} BETWEEN ${im(this,o,"PRECEDING")} AND ${im(this,r,"FOLLOWING")}${n?` ${n}`:""}`}visitWindowFunction(e){const{name:t,args:n,ignoreNulls:i,order:o}=e;return`${t}(${[this.mapToString(n).join(", "),o.length?`ORDER BY ${this.mapToString(o).join(", ")}`:"",i?"IGNORE NULLS":""].filter(e=>e).join(" ")})`}visitWithClause(e){const{name:t,query:n,materialized:i}=e,o=!0===i?"MATERIALIZED ":!1===i?"NOT MATERIALIZED ":"";return`${af(t)} AS ${o}(${this.toString(n)})`}};nf=om;class rm extends rf{constructor(e,t=[]){super(Cf),s(this,"name"),s(this,"args"),this.name=e,this.args=t}}function sm(e,...t){return new rm(e,um(t).map(Tm))}function am(e,...t){return new km(e,um(t).map(Tm))}function lm(e,t){return e.flat().filter(e=>null!=e).map(e=>t(e))}function cm(e){return lm(e,Tm)}function um(e){const t=e.length;let n=t;for(;n>0&&void 0===e[n-1];--n);return n<t?e.slice(0,n):e}class hm extends of{constructor(e,t){super(Ff),s(this,"name"),s(this,"def"),this.name=e,this.def=t}}class dm extends rf{constructor(e,t=new pm){super(Af),s(this,"func"),s(this,"def"),this.func=e,this.def=t}over(e){return new dm(this.func,this.def.over(e))}partitionby(...e){return new dm(this.func,this.def.partitionby(...e))}orderby(...e){return new dm(this.func,this.def.orderby(...e))}frame(e){return new dm(this.func,this.def.frame(e))}}class pm extends of{constructor(e,t,n,i){super(Lf),s(this,"name"),s(this,"partition"),s(this,"order"),s(this,"framedef"),this.name=e,this.partition=t,this.order=n,this.framedef=i}over(e){return fm(this,{name:e})}partitionby(...e){return fm(this,{partition:cm(e)})}orderby(...e){return fm(this,{order:cm(e)})}frame(e){return fm(this,{framedef:e})}}function fm(e,t){return new pm(t.name??e.name,t.partition??e.partition,t.order??e.order,t.framedef??e.framedef)}function mm(e){return e instanceof _m}class _m extends rf{constructor(e,t){super(e),s(this,"table"),this.table=t}get column(){return""}}class gm extends _m{constructor(e,t){super(cf,t),s(this,"name"),this.name=e}get column(){return this.name}}class ym extends _m{constructor(e,t){super(uf,t),s(this,"param"),this.param=e}get column(){return`${this.param.value}`}}function bm(e,t){const n=Am(t);return Qf(e)?new ym(new Jf(e),n):new gm(e,n)}class vm extends rf{constructor(e,t){super(Nf),s(this,"value"),s(this,"hint"),this.value=e,this.hint=t}}function xm(e){return new Yf(e)}function wm(e){return e instanceof Sm}class Sm extends rf{constructor(e){super(hf),s(this,"table"),this.table=[e].flat()}get name(){return this.table[this.table.length-1]}}function Em(...e){const t=lm(e,String);return(null==t?void 0:t.length)?new Sm(t):void 0}function Tm(e){return Kf(e)?function(e){const t=sf(e);return bm(t.pop(),Em(t))}(e):Im(e)}function Cm(e){return Kf(e)?function(e){return new vm(e,void 0)}(e):Im(e)}function Im(e){return e instanceof rf?e:Qf(e)?new Jf(e):xm(e)}function Am(e){return Kf(e)?Em(sf(e)):Zf(e)?Em(e):e}class km extends rf{constructor(e,t,n=!1,i=null,o=[]){super(If),s(this,"name"),s(this,"args"),s(this,"isDistinct"),s(this,"filter"),s(this,"order"),this.name=e,this.args=t,this.isDistinct=n,this.filter=i,this.order=cm([o])}distinct(e=!0){return new km(this.name,this.args,e,this.filter,this.order)}where(e){return Kf(e)&&(e=Cm(e)),new km(this.name,this.args,this.isDistinct,e,this.order)}argOrder(e){return new km(this.name,this.args,this.isDistinct,this.filter,e)}window(){return new dm(this)}partitionby(...e){return this.window().partitionby(...e)}orderby(...e){return this.window().orderby(...e)}frame(e){return this.window().frame(e)}}class Lm extends rf{constructor(e,t,n){super(e),s(this,"expr"),s(this,"extent"),this.expr=t,this.extent=n}toSQL(e){const{extent:t,expr:n}=this;return t?`(${n} ${e} ${t[0]} AND ${t[1]})`:""}}class Rm extends Lm{constructor(e,t){super(wf,e,t)}}class Pm extends rf{constructor(e,t,n){super(xf),s(this,"op"),s(this,"left"),s(this,"right"),this.op=e,this.left=t,this.right=n}}class Dm extends rf{constructor(e,t){super(mf),s(this,"expr"),s(this,"cast"),this.expr=e,this.cast=t}}class Mm extends rf{constructor(e){super(Mf),s(this,"spans"),this.spans=e}}class Nm extends of{}class Om extends Nm{constructor(e,t,n){super(Uf),s(this,"expr"),s(this,"alias"),s(this,"sample"),this.expr=e,this.alias=t,this.sample=n}as(e){return new Om(this.expr,e,this.sample)}}class Bm extends rf{constructor(e,t){super(Tf),s(this,"expr"),s(this,"values"),this.expr=e,this.values=t}}class Fm extends rf{constructor(e,t){super(Ef),s(this,"op"),s(this,"clauses"),this.op=e,this.clauses=t}}class zm extends Fm{constructor(e){super("AND",e)}}class Um extends Fm{constructor(e){super("OR",e)}}class $m extends of{constructor(e,t=!1,n,i){super(Vf),s(this,"size"),s(this,"perc"),s(this,"method"),s(this,"seed"),this.size=e,this.perc=t,this.method=n,this.seed=i}}class Vm extends of{constructor(e,t){super(zf),s(this,"expr"),s(this,"alias"),this.expr=e,this.alias=t}}class Hm extends of{constructor(e,t,n=null){super(Bf),s(this,"name"),s(this,"query"),s(this,"materialized"),this.name=e,this.query=t,this.materialized=n}}function Gm(e){return e instanceof jm}function Wm(e){return e instanceof Ym}class jm extends rf{constructor(e){super(e),s(this,"_with",[]),s(this,"_orderby",[]),s(this,"_limitPerc",!1),s(this,"_limit"),s(this,"_offset"),s(this,"cteFor",null)}static with(...e){return new Km(...e)}static select(...e){return(new Ym).select(...e)}static from(...e){return(new Ym).from(...e)}static union(...e){return new Xm("UNION",e.flat())}static unionByName(...e){return new Xm("UNION BY NAME",e.flat())}static unionAll(...e){return new Xm("UNION ALL",e.flat())}static unionAllByName(...e){return new Xm("UNION ALL BY NAME",e.flat())}static intersect(...e){return new Xm("INTERSECT",e.flat())}static intersectAll(...e){return new Xm("INTERSECT ALL",e.flat())}static except(...e){return new Xm("EXCEPT",e.flat())}static exceptAll(...e){return new Xm("EXCEPT ALL",e.flat())}static describe(e){return new qm(e)}get subqueries(){return[]}clone(){return this}setCteFor(e){this.cteFor=e}with(...e){const t=[],n=(e,n)=>{const i=n.clone();i.setCteFor(this),t.push(new Hm(e,i))};return e.flat().forEach(e=>{if(e instanceof Hm)t.push(e);else if(null!=e)for(const t in e)n(t,e[t])}),this._with=this._with.concat(t),this}orderby(...e){return this._orderby=this._orderby.concat(cm(e)),this}limitPercent(e){return this._limitPerc=!0,this._limit=Tm(e),this}limit(e){return this._limitPerc=!1,this._limit=Tm(e),this}offset(e){return this._offset=Tm(e),this}}class Ym extends jm{constructor(){super(Hf),s(this,"_select",[]),s(this,"_from",[]),s(this,"_where",[]),s(this,"_sample"),s(this,"_groupby",[]),s(this,"_having",[]),s(this,"_window",[]),s(this,"_qualify",[]),s(this,"_distinct",!1)}get subqueries(){const e=this.cteFor||this,t=(e instanceof Ym?e._with:[]).reduce((e,t)=>(e[t.name]=t.query,e),{}),n=[];return this._from.forEach(e=>{if(e instanceof Om){const{expr:i}=e;if(Gm(i))n.push(i);else if(wm(i)){const e=t[i.name];e&&n.push(e)}}}),n}clone(){return Object.assign(new Ym,this)}select(...e){const t=new Set,n=[],i=(e,i)=>{const o=lf(i);t.add(o),e&&n.push(new Vm(Tm(e),o))};return e.flat().forEach(e=>{if(null!=e)if(Kf(e))i(e,e);else if(mm(e))i(e,e.column);else if(Zf(e))i(e[1],e[0]);else if(tf(e))i(e,`${e}`);else for(const t in e)i(e[t],t)}),this._select=this._select.filter(e=>!t.has(e.alias)).concat(n),this}setSelect(...e){return this._select=[],this.select(...e)}distinct(e=!0){return this._distinct=!!e,this}from(...e){const t=[],n=(e,n)=>{t.push(new Om(Am(e),lf(n)))};return e.flat().forEach(e=>{if(null!=e)if(e instanceof Nm)t.push(e);else if(Kf(e))n(e,e);else if(wm(e))n(e,e.name);else if(tf(e))n(e);else if(Zf(e))n(e[1],e[0]);else for(const t in e)n(e[t],t)}),this._from=this._from.concat(t),this}setFrom(...e){return this._from=[],this.from(...e)}sample(e,t,n){let i;if("number"==typeof e){const o=e>0&&e<1,r=o?100*e:Math.floor(e);i=new $m(r,o,t,n)}else i=e;return this._sample=i??void 0,this}where(...e){return this._where=this._where.concat(lm(e,Cm)),this}setWhere(...e){return this._where=[],this.where(...e)}groupby(...e){return this._groupby=this._groupby.concat(cm(e)),this}setGroupby(...e){return this._groupby=[],this.groupby(...e)}having(...e){return this._having=this._having.concat(lm(e,Cm)),this}window(...e){const t=[];return e.flat().forEach(e=>{if(null!=e)for(const n in e)t.push(new hm(lf(n),e[n]))}),this._window=this._window.concat(t),this}qualify(...e){return this._qualify=this._qualify.concat(lm(e,Cm)),this}}class qm extends of{constructor(e){super(Gf),s(this,"query"),this.query=e}clone(){return new qm(this.query.clone())}}class Xm extends jm{constructor(e,t){super(Wf),s(this,"op"),s(this,"queries"),this.op=e,this.queries=t}setCteFor(e){super.setCteFor(e);const{queries:t,cteFor:n}=this;n&&t.forEach(e=>e.setCteFor(n))}get subqueries(){return this.queries}clone(){const{op:e,queries:t,...n}=this;return Object.assign(new Xm(e,t),n)}}class Km{constructor(...e){s(this,"_with"),this._with=e}select(...e){return jm.select(...e).with(...this._with)}from(...e){return jm.from(...e).with(...this._with)}union(...e){return jm.union(...e).with(...this._with)}unionByName(...e){return jm.unionByName(...e).with(...this._with)}unionAll(...e){return jm.unionAll(...e).with(...this._with)}unionAllByName(...e){return jm.unionAllByName(...e).with(...this._with)}intersect(...e){return jm.intersect(...e).with(...this._with)}intersectAll(...e){return jm.intersectAll(...e).with(...this._with)}except(...e){return jm.except(...e).with(...this._with)}exceptAll(...e){return jm.exceptAll(...e).with(...this._with)}}class Zm extends rf{constructor(e,t,n){super(e),s(this,"op"),s(this,"expr"),this.op=t,this.expr=n}}class Qm extends Zm{constructor(e,t){super(vf,e,t)}}function Jm(e){return am("avg",e)}function e_(e){return am("count",e)}function t_(e){return am("sum",e)}function n_(e,t){return new Dm(Tm(e),t)}function i_(e){return n_(e,"DOUBLE")}function o_(e){return sm("exp",e)}function r_(e){return sm("ln",e)}function s_(e){return sm("sign",e)}function a_(e){return sm("abs",e)}function l_(e){return sm("sqrt",e)}function c_(e){return sm("floor",e)}function u_(e,t){return new Qm(e,Tm(t))}function h_(e,t,n){return new Pm(e,Tm(t),Tm(n))}function d_(...e){return new zm(cm(e))}function p_(e){return u_("IS NOT NULL",e)}function f_(e,t){return h_("-",e,t)}function m_(e,t){return h_("*",e,t)}function __(e,t){return h_("/",e,t)}function g_(e,t){return h_("**",e,t)}function y_(e,t){return h_("<=",e,t)}function b_(e,t){return h_(">=",e,t)}function v_(e,t){return new Rm(Tm(e),null==t?void 0:t.map(Tm))}function x_(e,t){return new Bm(Tm(e),t.map(Tm))}function w_(e,...t){return new Mm(function(e,t){const n=[e[0]],i=t.length;for(let o=0,r=0;o<i;){const i=t[o];tf(i)?n[++r]=i:Qf(i)?n[++r]=new Jf(i):n[r]+=Kf(i)?i:`${xm(i)}`;const s=e[++o];tf(n[r])?n[++r]=s:n[r]+=s}return n.filter(e=>e).map(e=>Kf(e)?new vm(e):e)}(e,t))}function S_(...e){return sm("coalesce",...e)}const E_={[If]:["args","order","filter"],[wf]:["expr","extent"],[xf]:["left","right"],[_f]:["expr","_when","_else"],[mf]:["expr"],[yf]:["expr"],[uf]:["param","table"],[cf]:["table"],[Gf]:["query"],[Df]:["node"],[Mf]:["spans"],[Uf]:["expr"],[Cf]:["args"],[Tf]:["expr","values"],[$f]:["left","right","on","using","sample"],[Ef]:["clauses"],[Sf]:["expr","extent"],[ff]:["expr"],[Of]:["value"],[jf]:["subquery"],[zf]:["expr"],[Hf]:["_with","_select","_from","_where","_sample","_groupby","_having","_window","_qualify","_orderby"],[Wf]:["queries","_orderby"],[bf]:["expr"],[vf]:["expr"],[pf]:["expr"],[gf]:["when","then"],[Af]:["func","def"],[Ff]:["def"],[Lf]:["partition","order","framedef"],[Pf]:["expr"],[Rf]:["extent"],[kf]:["args"],[Bf]:["query"]};function T_(e,t){if(t.has(e))return t.get(e);if(tf(e)){const n=E_[e.type],i=(null==n?void 0:n.length)??0;if(i>0){e=e.clone();for(let o=0;o<i;++o){const i=n[o],r=e[i];if(Array.isArray(r)){const n=e[i]=r.slice(),o=r.length;for(let e=0;e<o;++e)n[e]=T_(r[e],t)}else r&&(e[i]=T_(r,t))}}}return e}function C_(e,t){if(!tf(e))return;const n=t(e);if(n)return n;const i=E_[e.type],o=(null==i?void 0:i.length)??0;for(let r=0;r<o;++r){const o=e[i[r]];if(Array.isArray(o)){const e=o.length;for(let i=0;i<e;++i)if(o[i]&&Number(C_(o[i],t))<0)return n}else if(o&&Number(C_(o,t))<0)return-1}}const I_=new RegExp(`^(${["any_value","approx_count_distinct","approx_quantile","arbitrary","arg_max","arg_max_null","arg_min","arg_min_null","array_agg","avg","bit_and","bit_or","bit_xor","bitstring_agg","bool_and","bool_or","corr","count","count_star","covar_pop","covar_samp","entropy","favg","first","fsum","geomean","kurtosis_pop","kurtosis","last","mad","max","max_by","median","min","min_by","mode","product","quantile","quantile_cont","quantile_disc","regr_avgx","regr_avgy","regr_count","regr_intercept","regr_r2","regr_sxx","regr_sxy","regr_syy","regr_slope","reservoir_quantile","skewness","stddev","stddev_pop","stddev_samp","string_agg","sum","variance","var_pop","var_samp"].join("|")})$`),A_=/(\\'|\\"|"(?:\\"|[^"])*"|'(?:\\'|[^'])*'|\w+\()/g;function k_(e){let t=0;return C_(e,e=>{switch(e.type){case Af:return-1;case If:return t|=1,-1;case Mf:case Nf:{let n=`${e}`.toLowerCase();const i=n.indexOf("(select ");return i>=0&&(n=n.slice(0,i)),n.includes(") over ")?-1:function(e){return e.split(A_).some(e=>e.endsWith("(")&&I_.test(e.slice(0,-1)))}(n)?(t|=2,-1):1}}}),t}function L_(e){const t=new Set;return C_(e,e=>{e.type===If&&t.add(e)}),Array.from(t)}function R_(e){const t={};return C_(e,e=>{e.type!==cf&&e.type!==uf||(t[`${e}`]=e)}),Object.values(t)}function P_(e,t,{replace:n=!1,temp:i=!1,view:o=!1}={}){return"CREATE"+(n?" OR REPLACE ":" ")+(i?"TEMP ":"")+(o?"VIEW":"TABLE")+(n?" ":" IF NOT EXISTS ")+e+" AS "+t}function D_(e){return e}function M_(){return{apply:D_,invert:D_,sqlApply:Tm,sqlInvert:D_}}function N_(){return{apply:e=>Number(e),invert:e=>new Date(e),sqlApply:e=>{return e instanceof Date?xm(+e):(t=e)instanceof Yf&&t.value instanceof Date?xm(Number(e.value)):sm("epoch_ms",e);var t},sqlInvert:D_}}const O_={identity:M_,linear:M_,log:function({base:e=null}={}){if(null==e||e===Math.E)return{apply:Math.log,invert:Math.exp,sqlApply:e=>r_(e),sqlInvert:e=>o_(e)};if(10===e)return{apply:Math.log10,invert:e=>Math.pow(10,e),sqlApply:e=>sm("log",e),sqlInvert:e=>g_(10,e)};{const t=+e;return{apply:e=>Math.log(e)/Math.log(t),invert:e=>Math.pow(t,e),sqlApply:e=>__(r_(e),r_(t)),sqlInvert:e=>g_(t,e)}}},symlog:function({constant:e=1}={}){const t=+e;return{apply:e=>Math.sign(e)*Math.log1p(Math.abs(e)),invert:e=>Math.sign(e)*Math.exp(Math.abs(e)-t),sqlApply:e=>m_(s_(e=Tm(e)),r_(h_("+",t,a_(e)))),sqlInvert:e=>m_(s_(e),f_(o_(a_(e)),t))}},sqrt:function(){return{apply:e=>Math.sign(e)*Math.sqrt(Math.abs(e)),invert:e=>Math.sign(e)*e*e,sqlApply:e=>m_(s_(e=Tm(e)),l_(a_(e))),sqlInvert:e=>m_(s_(e),g_(e,2))}},pow:function({exponent:e=1}={}){const t=+e;return{apply:e=>Math.sign(e)*Math.pow(Math.abs(e),t),invert:e=>Math.sign(e)*Math.pow(Math.abs(e),1/t),sqlApply:e=>m_(s_(e=Tm(e)),g_(a_(e),t)),sqlInvert:e=>m_(s_(e),g_(a_(e),__(1,t)))}},time:N_,utc:N_};function B_(e){let t=2166136261;for(let n=0,i=e.length;n<i;++n){const i=e.charCodeAt(n),o=65280&i;o&&(t=F_(t^o>>8)),t=F_(t^255&i)}return function(e){return e+=e<<13,e^=e>>>7,e+=e<<3,e^=e>>>17,4294967295&(e+=e<<5)}(t)>>>0}function F_(e){return e+(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24)}function z_(e,t,n){switch(e.name){case"count":case"count_star":return function(e,t){return S_(H_(e,t),0)}(t,e);case"sum":return H_(t,e);case"avg":return function(e,t){const n=$_(e,t),{expr:i,name:o}=V_(e,t);return __(t_(m_(n,o)),i)}(t,e);case"geomean":return function(e,t){const n=$_(e,t_(r_(t.args[0])),t),{expr:i}=V_(e,t);return o_(__(t_(n),i))}(t,e);case"arg_max":return function(e,t){const n=$_(e,t),i=$_(e,function(e){return am("max",e)}(t.args[1]),t);return am("arg_max",n,i)}(t,e);case"arg_min":return function(e,t){const n=$_(e,t),i=$_(e,function(e){return am("min",e)}(t.args[1]),t);return am("arg_min",n,i)}(t,e);case"variance":case"var_samp":return G_(t,e,n);case"var_pop":return G_(t,e,n,!1);case"stddev":case"stddev_samp":return l_(G_(t,e,n));case"stddev_pop":return l_(G_(t,e,n,!1));case"covar_samp":return W_(t,e,n);case"covar_pop":return W_(t,e,n,!1);case"corr":return j_(t,e,n);case"regr_count":return Y_(t,e).expr;case"regr_avgx":return Z_(t,e);case"regr_avgy":return Q_(t,e);case"regr_syy":return J_(t,0,e,n);case"regr_sxx":return J_(t,1,e,n);case"regr_sxy":return W_(t,e,n,null);case"regr_slope":return eg(t,e,n);case"regr_intercept":return function(e,t,n){const i=Z_(e,t);return f_(Q_(e,t),m_(eg(e,t,n),i))}(t,e,n);case"regr_r2":return g_(j_(t,e,n),2);case"max":case"min":case"bit_and":case"bit_or":case"bit_xor":case"bool_and":case"bool_or":case"product":{const n=U_(e);return t[n]=e,w_`${e.name}("${n}")`}default:return null}}function U_(e){return"pre_"+B_(`${e}`).toString(16)}function $_(e,t,n){const i=null==n?void 0:n.filter;i&&(t=t.filter?t.where(d_(i,t.filter)):t.where(i));const o=U_(t);return e[o]=t,o}function V_(e,t){const n=$_(e,e_(t.args[0]),t);return{expr:S_(t_(n),0),name:n}}function H_(e,t){return t_($_(e,t))}function G_(e,t,n,i=!0){const o=t.args[0],{expr:r}=V_(e,t),s=f_(o,n(o)),a=$_(e,t_(g_(s,2)),t),l=$_(e,t_(s),t),c=i?f_(r,1):r;return __(f_(t_(a),__(g_(t_(l),2),r)),c)}function W_(e,t,n,i=!0){const{expr:o}=Y_(e,t),r=f_(K_(e,t,n),__(m_(q_(e,1,t,n),q_(e,0,t,n)),o));return null===i?r:__(r,i?f_(o,1):o)}function j_(e,t,n){const{expr:i}=Y_(e,t),o=K_(e,t,n),r=X_(e,1,t,n),s=X_(e,0,t,n),a=q_(e,1,t,n),l=q_(e,0,t,n),c=f_(r,__(g_(a,2),i)),u=f_(s,__(g_(l,2),i));return __(f_(o,__(m_(a,l),i)),l_(m_(c,u)))}function Y_(e,t){const[n,i]=t.args,o=$_(e,function(e,t){return am("regr_count",e,t)}(n,i),t);return{expr:t_(o),name:o}}function q_(e,t,n,i){const o=n.args,r=o[t],s=o[1-t],a=t_(f_(r,i(r))).where(p_(s));return t_($_(e,a,n))}function X_(e,t,n,i){const o=n.args,r=o[t],s=o[1-t],a=t_(g_(f_(r,i(r)),2)).where(p_(s));return t_($_(e,a,n))}function K_(e,t,n){const[i,o]=t.args,r=t_(m_(f_(o,n(o)),f_(i,n(i))));return t_($_(e,r,t))}function Z_(e,t){const[n,i]=t.args,{expr:o,name:r}=Y_(e,t),s=$_(e,function(e,t){return am("regr_avgx",e,t)}(n,i),t);return __(t_(m_(s,r)),o)}function Q_(e,t){const[n,i]=t.args,{expr:o,name:r}=Y_(e,t),s=$_(e,function(e,t){return am("regr_avgy",e,t)}(n,i),t);return __(t_(m_(s,r)),o)}function J_(e,t,n,i){const{expr:o}=Y_(e,n),r=q_(e,t,n,i);return f_(X_(e,t,n,i),__(g_(r,2),o))}function eg(e,t,n){return __(W_(e,t,n,null),J_(e,1,t,n))}function tg(e,t){const n=e.subqueries;if(Wm(e)&&0===n.length)return t(e);const i=tg(n[0],t);for(let o=1;o<n.length;++o){const e=tg(n[o],t);if(void 0!==e&&e!==i)return NaN}return i}const ng={skip:!0,result:null};class ig{constructor(e,{schema:t="mosaic",enabled:n=!0}={}){s(this,"entries"),s(this,"active"),s(this,"mc"),s(this,"_schema"),s(this,"_enabled"),this.entries=new Map,this.active=null,this.mc=e,this._schema=t,this._enabled=n}set enabled(e){this._enabled!==e&&(e||this.clear(),this._enabled=e)}get enabled(){return this._enabled}set schema(e){this._schema!==e&&(this.clear(),this._schema=e)}get schema(){return this._schema}dropSchema(){return this.clear(),this.mc.exec(`DROP SCHEMA IF EXISTS "${this.schema}" CASCADE`)}clear(){this.entries.clear(),this.active=null}request(e,t,n){var i;if(!this.enabled||null==n)return null;const{entries:o,mc:r,schema:s}=this,{source:a}=n;if(!a)return null;if(this.active&&(this.active.source!==a&&this.clear(),null===(null==(i=this.active)?void 0:i.source)))return null;let{active:l}=this;if(!l){if(null==n.predicate)return null;if(this.active=l=function(e){const{source:t,meta:n}=e,i=e.predicate,o=R_(i).map(e=>e.column);let r,s;if(!n||!o)return{source:null,columns:s,predicate:r};switch(n.type){case"point":r=e=>e,s=Object.fromEntries(o.map(e=>[`${e}`,Tm(e)]));break;case"interval":{const{scales:e,bin:t,pixelSize:o=1}=n;if(!e)break;const a=e.map(e=>function(e,t,n){const{type:i,domain:o,range:r,apply:s,sqlApply:a}=function(e){const t=O_[e.type];if(!t)throw new Error(`Unrecognized scale type: ${e.type}`);return{...e,...t(e)}}(e);if(!s)return;const l=og[`${n}`.toLowerCase()]||c_,c=o.map(e=>Number(e)),u=s(Math.min(...c)),h=s(Math.max(...c)),d=("identity"===i?1:Math.abs(r[1]-r[0])/(h-u))/t,p=1===d?e=>e:e=>m_(i_(d),e),f=0===u?e=>e:e=>f_(e,i_(u));return e=>n_(l(p(f(a(e)))),"INTEGER")}(e,o,t));a.some(e=>!e)||(1===a.length?(r=e=>{var t;return e?v_("active0",null==(t=e.extent)?void 0:t.map(a[0])):[]},s={active0:a[0](i.expr)}):(r=e=>e?d_(e.clauses.map((e,t)=>{var n;return v_(`active${t}`,null==(n=e.extent)?void 0:n.map(a[t]))})):[],s=Object.fromEntries(i.clauses.map((e,t)=>[`active${t}`,a[t](e.expr)]))))}}return{source:s?t:null,columns:s,predicate:r}}(n),null===l.source)return null}if(o.has(e))return o.get(e);const c=function(e){if(!e.filterStable)return null;const t=e.query();if(!Wm(t))return null;const n=tg(t,e=>{const t=e._from[0],n=t instanceof Om&&t.expr;return wm(n)?n.name:n});if("string"!=typeof n)return null;const i=new Map,o={},r={},s=[],a=e=>{const i=e.column;return w_`(SELECT avg(${tg(t,e=>{var t;return null==(t=e._select.find(e=>e.alias===i))?void 0:t.expr})??e}) FROM "${n}")`};for(const{alias:l,expr:c}of t._select){if(k_(c)>1)return null;const e=L_(c);if(0===e.length)s.push(l),o[l]=c;else{for(const t of e){if(t.isDistinct)return null;const e=z_(t,o,a);if(!e)return null;i.set(t,e)}r[l]=T_(c,i)}}return i.size?{group:s,preagg:o,output:r}:null}(e);let u;if(c)if(t.skip(e,n))u=ng;else{const n=t.remove(a).predicate(e);u=function(e,t,n,i){const{group:o,output:r,preagg:s}=n,{columns:a}=t,l=e.setSelect({...s,...a}).groupby(Object.keys(a)),[c]=l.subqueries;c&&function(e,t){const n=new Set,i=e=>{if(!n.has(e)){if(n.add(e),Wm(e)&&e._from.length&&(e.select(t),function(e){return e._groupby.length>0||e._select.some(e=>k_(e))}(e))){const n=new Set(e._groupby.flatMap(e=>e instanceof gm?[e.name]:[]));e.groupby(t.filter(e=>!n.has(e)))}e.subqueries.forEach(i)}};i(e)}(c,Object.values(a).flatMap(e=>R_(e).map(e=>e.column)));const u=l._having,h=l._orderby;l._having=[],l._orderby=[];const d=l.toString(),p=`${i}.preagg_${(B_(d)>>>0).toString(16)}`,f=jm.select(o,r).from(p).groupby(o).having(u).orderby(h);return new rg({table:p,create:d,active:t,select:f})}(e.query(n),l,c,s),u.result=r.exec([`CREATE SCHEMA IF NOT EXISTS ${s}`,P_(u.table,u.create,{temp:!1})]),u.result.catch(e=>r.logger().error(e))}else u=null;return o.set(e,u),u}}const og={ceil:function(e){return sm("ceil",e)},round:function(e,t){return sm("round",e,t)}};class rg{constructor({table:e,create:t,active:n,select:i}){s(this,"table"),s(this,"create"),s(this,"result"),s(this,"active"),s(this,"select"),s(this,"skip"),this.table=e,this.create=t,this.result=null,this.active=n,this.select=i,this.skip=!1}query(e){return this.select.clone().where(this.active.predicate(e))}}function sg(){return{debug(){},info(){},log(){},warn(){},error(){},group(){},groupCollapsed(){},groupEnd(){}}}const ag=Object.freeze({pending:Symbol("pending"),ready:Symbol("ready"),error:Symbol("error"),done:Symbol("done")});class lg extends Promise{constructor(){let e,t;super((n,i)=>{e=n,t=i}),s(this,"_resolve"),s(this,"_reject"),s(this,"_state"),s(this,"_value"),this._resolve=e,this._reject=t,this._state=ag.pending,this._value=void 0}fulfill(e){if(void 0!==this._value){if(void 0!==e)throw Error("Promise is ready and fulfill has a provided value");this._resolve(this._value)}else{if(void 0===e)throw Error("Promise is neither ready nor has provided value");this._resolve(e)}return this._state=ag.done,this}ready(e){return this._state=ag.ready,this._value=e,this}reject(e){return this._state=ag.error,this._reject(e),this}get state(){return this._state}}function cg(e,t){let n=[],i=0;return{add(o,r){var s;"arrow"===o.request.type?(i||(s=()=>function(){const o=function(e,t){const n=[],i=new Map;for(const o of e){const{entry:{request:e}}=o,r=ug(e.query,t);if(!i.has(r)){const e=[];n.push(e),i.set(r,e)}i.get(r).push(o)}return n}(n,t);n=[],i=0;for(const n of o)hg(n,e),pg(n,t)}(),i="undefined"!=typeof requestAnimationFrame?requestAnimationFrame(s):"undefined"!=typeof setImmediate?setImmediate(s):setTimeout(s)),n.push({entry:o,priority:r,index:n.length})):e(o,r)}}}function ug(e,t){const n=`${e}`;if(Wm(e)&&!t.get(n)){if(e._where.length||e._qualify.length||e._having.length||e._orderby.length||e._distinct)return n;const t=e.clone().setSelect("*"),i=e._groupby;if(i.length){const n={};e._select.forEach(({alias:e,expr:t})=>n[e]=t),t.setGroupby(i.map(e=>mm(e)&&n[e.column]||e))}else e._select.some(e=>k_(e.expr))&&t.setGroupby("ALL");return`${t}`}return n}function hg(e,t){if(function(e){if(e.length>1){const t=`${e[0].entry.request.query}`;for(let n=1;n<e.length;++n)if(t!==`${e[n].entry.request.query}`)return!0}return!1}(e))t({request:{type:"arrow",cache:!1,query:e.query=dg(e)},result:e.result=new lg});else for(const{entry:n,priority:i}of e)t(n,i)}function dg(e){const t=e.maps=[],n=new Map;for(const r of e){const e=r.entry.request.query,i=[];t.push(i);for(const{alias:t,expr:o}of e._select){const e=`${o}`;n.has(e)||n.set(e,[`col${n.size}`,o]);const[r]=n.get(e);i.push([r,t])}}const i=e[0].entry.request.query.clone(),o=i._groupby;if(o.length){const t={};e.maps[0].forEach(([e,n])=>t[n]=e),i.setGroupby(o.map(e=>mm(e)&&t[e.column]||e))}return i.setSelect(Array.from(n.values()))}async function pg(e,t){const{maps:n,query:i,result:o}=e;if(!n)return;let r;try{r=await o}catch(a){for(const{entry:t}of e)t.result.reject(a);return}const s=i instanceof qm;e.forEach(({entry:e},i)=>{const{request:o,result:a}=e,l=n[i],c=s&&l?function(e,t){const n=new Map(t),i=[];for(const o of e)n.has(o.column_name)&&i.push({...o,column_name:n.get(o.column_name)});return i}(r,l):l?function(e,t){return e.select(t.map(e=>e[0]),t.map(e=>e[1]))}(r,l):r;o.cache&&t.set(String(o.query),c),a.fulfill(c)})}lg.prototype.constructor=Promise;const fg="undefined"!=typeof requestIdleCallback?requestIdleCallback:setTimeout;class mg{constructor(e){s(this,"queue"),this.queue=Array.from({length:e},()=>({head:null,tail:null}))}isEmpty(){return this.queue.every(e=>!e.head)}insert(e,t){const n=this.queue[t];if(!n)throw new Error(`Invalid queue priority rank: ${t}`);const i={item:e,next:null};null===n.head?n.head=n.tail=i:n.tail=n.tail.next=i}remove(e){for(const t of this.queue){let{head:n,tail:i}=t;for(let t=null,o=n;o;t=o,o=o.next)e(o.item)&&(o===n?n=o.next:t.next=o.next,o===i&&(i=t||n));t.head=n,t.tail=i}}next(){for(const e of this.queue){const{head:t}=e;if(null!==t)return e.head=t.next,e.tail===t&&(e.tail=null),t.item}}}const _g=Object.freeze({High:0,Normal:1,Low:2});class gg{constructor(e=32){s(this,"queue"),s(this,"db"),s(this,"clientCache"),s(this,"_logger"),s(this,"_logQueries"),s(this,"_consolidate"),s(this,"pendingResults"),s(this,"maxConcurrentRequests"),s(this,"pendingExec"),this.queue=new mg(3),this.db=null,this.clientCache=null,this._logger=sg(),this._logQueries=!1,this._consolidate=null,this.pendingResults=[],this.maxConcurrentRequests=e,this.pendingExec=!1}next(){if(this.queue.isEmpty()||this.pendingResults.length>this.maxConcurrentRequests||this.pendingExec)return;const e=this.queue.next();if(!e)return;const{request:t,result:n}=e;this.pendingResults.push(n),"exec"===t.type&&(this.pendingExec=!0),this.submit(t,n).finally(()=>{for(;this.pendingResults.length&&this.pendingResults[0].state!==ag.pending;){const e=this.pendingResults.shift();e.state===ag.ready?e.fulfill():e.state===ag.done&&this._logger.warn("Found resolved query in pending results.")}"exec"===t.type&&(this.pendingExec=!1),this.next()})}enqueue(e,t=_g.Normal){this.queue.insert(e,t),this.next()}async submit(e,t){try{const{query:n,type:i,cache:o=!1,options:r}=e,s=n?`${n}`:null;if(o){const e=this.clientCache.get(s);if(e){const n=await e;return this._logger.debug("Cache"),void t.ready(n)}}const a=performance.now();this._logQueries&&this._logger.debug("Query",{type:i,sql:s,...r});const l=this.db.query({type:i,sql:s,...r});o&&this.clientCache.set(s,l);const c=await l;o&&this.clientCache.set(s,c),this._logger.debug(`Request: ${(performance.now()-a).toFixed(1)}`),t.ready("exec"===i?null:c)}catch(n){t.reject(n)}}cache(e){return void 0!==e?this.clientCache=!0===e?function({max:e=1e3,ttl:t=108e5}={}){let n=new Map;function i(){const e=performance.now()-t;let i=null,o=1/0;for(const[t,r]of n){const{last:s}=r;s<o&&(i=t,o=s),e>s&&n.delete(t)}i&&n.delete(i)}return{get(e){const t=n.get(e);if(t)return t.last=performance.now(),t.value},set:(t,o)=>(n.set(t,{last:performance.now(),value:o}),n.size>e&&fg(i),o),clear(){n=new Map}}}():e||{get:()=>{},set:(e,t)=>t,clear:()=>{}}:this.clientCache}logger(e){return e?this._logger=e:this._logger}logQueries(e){return void 0!==e?this._logQueries=!!e:this._logQueries}connector(e){return e?this.db=e:this.db}consolidate(e){e&&!this._consolidate?this._consolidate=cg(this.enqueue.bind(this),this.clientCache):!e&&this._consolidate&&(this._consolidate=null)}request(e,t=_g.Normal){const n=new lg,i={request:e,result:n};return this._consolidate?this._consolidate.add(i,t):this.enqueue(i,t),n}cancel(e){const t=new Set(e);if(t.size){this.queue.remove(({result:e})=>!!t.has(e)&&(e.reject("Canceled"),!0));for(const e of this.pendingResults)t.has(e)&&e.reject("Canceled")}}clear(){this.queue.remove(({result:e})=>(e.reject("Cleared"),!0));for(const e of this.pendingResults)e.reject("Cleared");this.pendingResults=[]}}let yg;function bg(e){return e?yg=e:null==yg&&(yg=new vg),yg}class vg{constructor(e=new ef,t={}){s(this,"manager"),s(this,"preaggregator"),s(this,"clients",new Set),s(this,"filterGroups",new Map),s(this,"_logger",sg());const{logger:n=console,manager:i=new gg,cache:o=!0,consolidate:r=!0,preagg:a={}}=t;this.manager=i,this.manager.cache(o),this.manager.consolidate(r),this.databaseConnector(e),this.logger(n),this.clear(),this.preaggregator=new ig(this,a)}clear(e={}){var t,n;const{clients:i=!0,cache:o=!0}=e;this.manager.clear(),i&&(null==(t=this.filterGroups)||t.forEach(e=>e.disconnect()),this.filterGroups=new Map,null==(n=this.clients)||n.forEach(e=>this.disconnect(e)),this.clients=new Set),o&&this.manager.cache().clear()}databaseConnector(e){return e?this.manager.connector(e):this.manager.connector()}logger(e){return arguments.length&&(this._logger=e||sg(),this.manager.logger(this._logger)),this._logger}cancel(e){this.manager.cancel(e)}exec(e,t={}){const{priority:n=_g.Normal}=t;return e=Array.isArray(e)?e.filter(e=>e).join(";\n"):e,this.manager.request({type:"exec",query:e},n)}query(e,t={}){const{type:n="arrow",cache:i=!0,priority:o=_g.Normal,...r}=t;return this.manager.request({type:n,query:e,cache:i,options:r},o)}prefetch(e,t={}){return this.query(e,{...t,cache:!0,priority:_g.Low})}updateClient(e,t,n=_g.Normal){return e.queryPending(),e._pending=this.query(t,{priority:n}).then(t=>e.queryResult(t).update(),t=>{var n;null==(n=this._logger)||n.error(t),e.queryError(t)}).catch(e=>{var t;return null==(t=this._logger)?void 0:t.error(e)})}requestQuery(e,t){return this.preaggregator.clear(),t?this.updateClient(e,t):Promise.resolve(e.update())}connect(e){const{clients:t}=this;if(null==t?void 0:t.has(e))throw new Error("Client already connected.");null==t||t.add(e),e.coordinator=this,e.initialize(),function(e,t,n){var i,o;if(!t)return;let r=null==(i=e.filterGroups)?void 0:i.get(t);if(!r){const n=n=>function(e,t,n){const{preaggregator:i,filterGroups:o}=e,{clients:r}=o.get(t);for(const s of r)s.enabled&&i.request(s,t,n)}(e,t,n),i=()=>function(e,t){const{preaggregator:n,filterGroups:i}=e,{clients:o}=i.get(t),{active:r}=t;return Promise.allSettled(Array.from(o,i=>{if(!i.enabled)return i.requestQuery();const o=n.request(i,t,r),s=o?null:t.predicate(i);if((null==o?void 0:o.skip)||!o&&!s)return;const a=(null==o?void 0:o.query(r.predicate))??i.query(s);return e.updateClient(i,a)}))}(e,t);t.addEventListener("activate",n),t.addEventListener("value",i),r={selection:t,clients:new Set,disconnect(){t.removeEventListener("activate",n),t.removeEventListener("value",i)}},null==(o=e.filterGroups)||o.set(t,r)}r.clients.add(n)}(this,e.filterBy,e)}disconnect(e){const{clients:t,filterGroups:n}=this;if(!(null==t?void 0:t.has(e)))return;t.delete(e),e.coordinator=null;const i=null==n?void 0:n.get(e.filterBy);i&&i.clients.delete(e)}}class xg extends Bh{constructor({selection:e,enabled:t=!0,filterStable:n=!0,...i}){super(e),s(this,"_methods"),s(this,"_filterStable"),this.enabled=t,this._methods=i,this._filterStable=n}get filterStable(){return this._filterStable}async prepare(){var e,t;await(null==(t=(e=this._methods).prepare)?void 0:t.call(e))}query(e){var t,n;return(null==(n=(t=this._methods).query)?void 0:n.call(t,e))??null}queryResult(e){var t,n;return null==(n=(t=this._methods).queryResult)||n.call(t,e),this}queryPending(){var e,t;return null==(t=(e=this._methods).queryPending)||t.call(e),this}queryError(e){var t,n;return null==(n=(t=this._methods).queryError)||n.call(t,e),this}}class wg{constructor(){s(this,"_callbacks"),this._callbacks=new Map}addEventListener(e,t){this._callbacks.has(e)||this._callbacks.set(e,{callbacks:new Set,pending:null,queue:new Sg}),this._callbacks.get(e).callbacks.add(t)}removeEventListener(e,t){const n=this._callbacks.get(e);n&&n.callbacks.delete(t)}willEmit(e,t){return t}emitQueueFilter(e,t){return null}cancel(e){const t=this._callbacks.get(e);null==t||t.queue.clear()}async pending(e){var t;await(null==(t=this._callbacks.get(e))?void 0:t.pending)}emit(e,t){const n=this._callbacks.get(e)||{};if(n.pending)n.queue.enqueue(t,this.emitQueueFilter(e,t));else{const i=this.willEmit(e,t),{callbacks:o,queue:r}=n;if(null==o?void 0:o.size){const t=Array.from(o,e=>e(i));n.pending=Promise.allSettled(t).then(()=>{n.pending=null,r.isEmpty()||this.emit(e,r.dequeue())})}}}}class Sg{constructor(){s(this,"next",null),this.clear()}clear(){this.next=null}isEmpty(){return!this.next}enqueue(e,t){const n={value:e};if(t&&this.next){let e=this;for(;e.next;)t(e.next.value)?e=e.next:e.next=e.next.next;e.next=n}else this.next=n}dequeue(){const{next:e}=this;return this.next=(null==e?void 0:e.next)||null,null==e?void 0:e.value}}function Eg(e){return e instanceof Tg}class Tg extends wg{constructor(e){super(),s(this,"_value"),this._value=e}static value(e){return new Tg(e)}static array(e){if(e.some(e=>Eg(e))){const t=new Tg,n=()=>{t.update(e.map(e=>Eg(e)?e.value:e))};return n(),e.forEach(e=>Eg(e)?e.addEventListener("value",n):0),t}return new Tg(e)}get value(){return this._value}update(e,{force:t}={}){var n,i;return(n=this._value)!==(i=e)&&(n instanceof Date&&i instanceof Date?+n!==+i:!Array.isArray(n)||!Array.isArray(i)||function(e,t){if(e.length!==t.length)return!0;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!0;return!1}(n,i))||t?this.emit("value",e):this.cancel("value"),this}willEmit(e,t){return"value"===e&&(this._value=t),t}}function Cg(e,t){return new Ig(new Ag(e),t?[t].flat():void 0)}let Ig=class e extends Tg{constructor(e=new Ag,t=[]){if(super([]),s(this,"_resolved"),s(this,"_resolver"),s(this,"_relay"),this._resolved=this._value,this._resolver=e,this._relay=new Set,Array.isArray(t))for(const n of t)n._relay.add(this)}static intersect({cross:e=!1,empty:t=!1,include:n=[]}={}){return Cg({cross:e,empty:t},n)}static union({cross:e=!1,empty:t=!1,include:n=[]}={}){return Cg({cross:e,empty:t,union:!0},n)}static single({cross:e=!1,empty:t=!1,include:n=[]}={}){return Cg({cross:e,empty:t,single:!0},n)}static crossfilter({empty:e=!1,include:t=[]}={}){return Cg({cross:!0,empty:e},t)}clone(){const t=new e(this._resolver);return t._value=t._resolved=this._value,t}remove(e){const t=this.clone();return t._value=t._resolved=t._resolver.resolve(this._resolved,{source:e}),t._value.active={source:e},t}get resolver(){return this._resolver}get single(){return this._resolver.single}get clauses(){return super.value}get active(){return this.clauses.active}get value(){var e;return null==(e=this.active)?void 0:e.value}valueFor(e){var t;return null==(t=this.clauses.find(t=>t.source===e))?void 0:t.value}activate(e){this.emit("activate",e),this._relay.forEach(t=>t.activate(e))}update(e){return this._resolved=this._resolver.resolve(this._resolved,e,!0),this._resolved.active=e,this._relay.forEach(t=>t.update(e)),super.update(this._resolved)}reset(e){return e??(e=this._resolved),e.forEach(e=>{var t,n;return null==(n=null==(t=e.source)?void 0:t.reset)?void 0:n.call(t)}),this._resolved=this._resolved.filter(t=>!e.includes(t)),this._relay.forEach(t=>t.reset(e)),super.update(this._resolved)}willEmit(e,t){return"value"===e?(this._value=t,this.value):t}emitQueueFilter(e,t){return"value"===e?this._resolver.queueFilter(t):null}skip(e,t){return this._resolver.skip(e,t)}predicate(e=void 0,t=!1){const{clauses:n}=this,i=t?null:n.active;return this._resolver.predicate(n,i,e)}};class Ag{constructor({union:e,cross:t,single:n,empty:i}={}){s(this,"union"),s(this,"cross"),s(this,"single"),s(this,"empty"),this.union=!!e,this.cross=!!t,this.single=!!n,this.empty=!!i}resolve(e,t,n=!1){const{source:i,predicate:o}=t,r=e.filter(e=>i!==e.source),s=this.single?[]:r;return this.single&&n&&r.forEach(e=>{var t,n;return null==(n=null==(t=e.source)?void 0:t.reset)?void 0:n.call(t)}),o&&s.push(t),s}skip(e,t){var n;return null!=e&&Boolean(this.cross&&(null==(n=null==t?void 0:t.clients)?void 0:n.has(e)))}predicate(e,t,n){const{empty:i,union:o}=this;if(i&&!e.length)return[xm(!1)];if(this.skip(n,t))return;const r=e.filter(e=>!this.skip(n,e)).map(e=>e.predicate);return o&&r.length>1?function(...e){return new Um(cm(e))}(r):r}queueFilter(e){var t;if(this.cross){const n=null==(t=e.active)?void 0:t.source;return e=>{var t;return(null==(t=e.active)?void 0:t.source)!==n}}return null}}class kg{constructor({uri:e="http://localhost:3000/",ipc:t}={}){s(this,"_uri"),s(this,"_ipc"),this._uri=e,this._ipc=t}async query(e){const t=fetch(this._uri,{method:"POST",mode:"cors",credentials:"omit",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),n=await t;if(!n.ok)throw new Error(`Query failed with HTTP status ${n.status}: ${await n.text()}`);return"exec"===e.type?t:"arrow"===e.type?Jp(await n.arrayBuffer(),this._ipc):n.json()}}function Lg(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{l(i.next(e))}catch(mC){r(mC)}}function a(e){try{l(i.throw(e))}catch(mC){r(mC)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}l((i=i.apply(e,t||[])).next())})}function Rg(e){return this instanceof Rg?(this.v=e,this):new Rg(e)}function Pg(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,o=n.apply(e,t||[]),r=[];return i=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",function(e){return function(t){return Promise.resolve(t).then(e,c)}}),i[Symbol.asyncIterator]=function(){return this},i;function s(e,t){o[e]&&(i[e]=function(t){return new Promise(function(n,i){r.push([e,t,n,i])>1||a(e,t)})},t&&(i[e]=t(i[e])))}function a(e,t){try{(n=o[e](t)).value instanceof Rg?Promise.resolve(n.value.v).then(l,c):u(r[0][2],n)}catch(mC){u(r[0][3],mC)}var n}function l(e){a("next",e)}function c(e){a("throw",e)}function u(e,t){e(t),r.shift(),r.length&&a(r[0][0],r[0][1])}}function Dg(e){var t,n;return t={},i("next"),i("throw",function(e){throw e}),i("return"),t[Symbol.iterator]=function(){return this},t;function i(i,o){t[i]=e[i]?function(t){return(n=!n)?{value:Rg(e[i](t)),done:!1}:o?o(t):t}:o}}function Mg(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise(function(i,o){!function(e,t,n,i){Promise.resolve(i).then(function(t){e({value:t,done:n})},t)}(i,o,(t=e[n](t)).done,t.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Ng=new TextDecoder("utf-8"),Og=e=>Ng.decode(e),Bg=new TextEncoder,Fg=e=>Bg.encode(e),zg=e=>"boolean"==typeof e,Ug=e=>"function"==typeof e,$g=e=>null!=e&&Object(e)===e,Vg=e=>$g(e)&&Ug(e.then),Hg=e=>$g(e)&&Ug(e[Symbol.iterator]),Gg=e=>$g(e)&&Ug(e[Symbol.asyncIterator]),Wg=e=>$g(e)&&$g(e.schema),jg=e=>$g(e)&&"done"in e&&"value"in e,Yg=e=>$g(e)&&Ug(e.stat)&&(e=>"number"==typeof e)(e.fd),qg=e=>$g(e)&&Kg(e.body),Xg=e=>"_getDOMStream"in e&&"_getNodeStream"in e,Kg=e=>$g(e)&&Ug(e.cancel)&&Ug(e.getReader)&&!Xg(e),Zg=e=>$g(e)&&Ug(e.read)&&Ug(e.pipe)&&zg(e.readable)&&!Xg(e),Qg="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;function Jg(e,t,n=0,i=t.byteLength){const o=e.byteLength,r=new Uint8Array(e.buffer,e.byteOffset,o),s=new Uint8Array(t.buffer,t.byteOffset,Math.min(i,o));return r.set(s,n),e}function ey(e,t){const n=function(e){const t=e[0]?[e[0]]:[];let n,i,o,r;for(let s,a,l=0,c=0,u=e.length;++l<u;)s=t[c],a=e[l],!s||!a||s.buffer!==a.buffer||a.byteOffset<s.byteOffset?a&&(t[++c]=a):(({byteOffset:n,byteLength:o}=s),({byteOffset:i,byteLength:r}=a),n+o<i||i+r<n?a&&(t[++c]=a):t[c]=new Uint8Array(s.buffer,n,i-n+r));return t}(e),i=n.reduce((e,t)=>e+t.byteLength,0);let o,r,s,a=0,l=-1;const c=Math.min(t||Number.POSITIVE_INFINITY,i);for(const u=n.length;++l<u;){if(o=n[l],r=o.subarray(0,Math.min(o.length,c-a)),c<=a+r.length){r.length<o.length?n[l]=o.subarray(r.length):r.length===o.length&&l++,s?Jg(s,r,a):s=r;break}Jg(s||(s=new Uint8Array(c)),r,a),a+=r.length}return[s||new Uint8Array(0),n.slice(l),i-(s?s.byteLength:0)]}function ty(e,t){let n=jg(t)?t.value:t;return n instanceof e?e===Uint8Array?new e(n.buffer,n.byteOffset,n.byteLength):n:n?("string"==typeof n&&(n=Fg(n)),n instanceof ArrayBuffer||n instanceof Qg?new e(n):$g(i=n)&&Ug(i.clear)&&Ug(i.bytes)&&Ug(i.position)&&Ug(i.setPosition)&&Ug(i.capacity)&&Ug(i.getBufferIdentifier)&&Ug(i.createLong)?ty(e,n.bytes()):ArrayBuffer.isView(n)?n.byteLength<=0?new e(0):new e(n.buffer,n.byteOffset,n.byteLength/e.BYTES_PER_ELEMENT):e.from(n)):new e(0);var i}const ny=e=>ty(Int32Array,e),iy=e=>ty(BigInt64Array,e),oy=e=>ty(Uint8Array,e),ry=e=>(e.next(),e);function sy(e,t){return Pg(this,arguments,function*(){if(Vg(t))return yield Rg(yield Rg(yield*Dg(Mg(sy(e,yield Rg(t))))));const n=function(e){return Pg(this,arguments,function*(){yield yield Rg(yield Rg(e))})},i="string"==typeof t||ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof Qg?n(t):Hg(t)?function(e){return Pg(this,arguments,function*(){yield Rg(yield*Dg(Mg(ry(function*(e){let t=null;do{t=e.next(yield null==t?void 0:t.value)}while(!t.done)}(e[Symbol.iterator]())))))})}(t):Gg(t)?t:n(t);return yield Rg(yield*Dg(Mg(ry(function(t){return Pg(this,arguments,function*(){let n=null;do{n=yield Rg(t.next(yield yield Rg(ty(e,n))))}while(!n.done)})}(i[Symbol.asyncIterator]()))))),yield Rg(new e)})}const ay=e=>sy(Uint8Array,e);function ly(e,t,n){if(0!==e)for(let i=-1,o=(n=n.slice(0,t)).length;++i<o;)n[i]+=e;return n.subarray(0,t)}const cy={fromIterable:e=>uy(function*(e){let t,n,i,o,r=!1,s=[],a=0;function l(){return"peek"===i?ey(s,o)[0]:([n,s,a]=ey(s,o),n)}({cmd:i,size:o}=(yield(()=>null)())||{cmd:"read",size:0});const c=(u=e,function*(e,t){const n=function*(e){yield e},i="string"==typeof t||ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof Qg?n(t):Hg(t)?t:n(t);return yield*ry(function*(t){let n=null;do{n=t.next(yield ty(e,n))}while(!n.done)}(i[Symbol.iterator]())),new e}(Uint8Array,u))[Symbol.iterator]();var u;try{do{if(({done:t,value:n}=Number.isNaN(o-a)?c.next():c.next(o-a)),!t&&n.byteLength>0&&(s.push(n),a+=n.byteLength),t||o<=a)do{({cmd:i,size:o}=yield l())}while(o<a)}while(!t)}catch(mC){(r=!0)&&"function"==typeof c.throw&&c.throw(mC)}finally{!1===r&&"function"==typeof c.return&&c.return(null)}return null}(e)),fromAsyncIterable:e=>uy(function(e){return Pg(this,arguments,function*(){let t,n,i,o,r=!1,s=[],a=0;function l(){return"peek"===i?ey(s,o)[0]:([n,s,a]=ey(s,o),n)}({cmd:i,size:o}=(yield yield Rg((()=>null)()))||{cmd:"read",size:0});const c=ay(e)[Symbol.asyncIterator]();try{do{if(({done:t,value:n}=Number.isNaN(o-a)?yield Rg(c.next()):yield Rg(c.next(o-a))),!t&&n.byteLength>0&&(s.push(n),a+=n.byteLength),t||o<=a)do{({cmd:i,size:o}=yield yield Rg(l()))}while(o<a)}while(!t)}catch(mC){(r=!0)&&"function"==typeof c.throw&&(yield Rg(c.throw(mC)))}finally{!1===r&&"function"==typeof c.return&&(yield Rg(c.return(new Uint8Array(0))))}return yield Rg(null)})}(e)),fromDOMStream:e=>uy(function(e){return Pg(this,arguments,function*(){let t,n,i,o=!1,r=!1,s=[],a=0;function l(){return"peek"===n?ey(s,i)[0]:([t,s,a]=ey(s,i),t)}({cmd:n,size:i}=(yield yield Rg((()=>null)()))||{cmd:"read",size:0});const c=new hy(e);try{do{if(({done:o,value:t}=Number.isNaN(i-a)?yield Rg(c.read()):yield Rg(c.read(i-a))),!o&&t.byteLength>0&&(s.push(oy(t)),a+=t.byteLength),o||i<=a)do{({cmd:n,size:i}=yield yield Rg(l()))}while(i<a)}while(!o)}catch(mC){(r=!0)&&(yield Rg(c.cancel(mC)))}finally{!1===r?yield Rg(c.cancel()):e.locked&&c.releaseLock()}return yield Rg(null)})}(e)),fromNodeStream:e=>uy(function(e){return Pg(this,arguments,function*(){const t=[];let n,i,o,r="error",s=!1,a=null,l=0,c=[];function u(){return"peek"===n?ey(c,i)[0]:([o,c,l]=ey(c,i),o)}if(({cmd:n,size:i}=(yield yield Rg((()=>null)()))||{cmd:"read",size:0}),e.isTTY)return yield yield Rg(new Uint8Array(0)),yield Rg(null);try{t[0]=dy(e,"end"),t[1]=dy(e,"error");do{if(t[2]=dy(e,"readable"),[r,a]=yield Rg(Promise.race(t.map(e=>e[2]))),"error"===r)break;if((s="end"===r)||(Number.isFinite(i-l)?(o=oy(e.read(i-l)),o.byteLength<i-l&&(o=oy(e.read()))):o=oy(e.read()),o.byteLength>0&&(c.push(o),l+=o.byteLength)),s||i<=l)do{({cmd:n,size:i}=yield yield Rg(u()))}while(i<l)}while(!s)}finally{yield Rg((h=t,d="error"===r?a:null,o=c=null,new Promise((t,n)=>{for(const[i,o]of h)e.off(i,o);try{const t=e.destroy;t&&t.call(e,d),d=void 0}catch(mC){d=mC||d}finally{null!=d?n(d):t()}})))}var h,d;return yield Rg(null)})}(e)),toDOMStream(e,t){throw new Error('"toDOMStream" not available in this environment')},toNodeStream(e,t){throw new Error('"toNodeStream" not available in this environment')}},uy=e=>(e.next(),e);class hy{constructor(e){this.source=e,this.reader=null,this.reader=this.source.getReader(),this.reader.closed.catch(()=>{})}get closed(){return this.reader?this.reader.closed.catch(()=>{}):Promise.resolve()}releaseLock(){this.reader&&this.reader.releaseLock(),this.reader=null}cancel(e){return Lg(this,void 0,void 0,function*(){const{reader:t,source:n}=this;t&&(yield t.cancel(e).catch(()=>{})),n&&n.locked&&this.releaseLock()})}read(e){return Lg(this,void 0,void 0,function*(){if(0===e)return{done:null==this.reader,value:new Uint8Array(0)};const t=yield this.reader.read();return!t.done&&(t.value=oy(t)),t})}}const dy=(e,t)=>{const n=e=>i([t,e]);let i;return[t,n,new Promise(o=>(i=o)&&e.once(t,n))]};var py,fy,my,_y,gy,yy,by,vy,xy,wy,Sy,Ey;(fy=py||(py={}))[fy.V1=0]="V1",fy[fy.V2=1]="V2",fy[fy.V3=2]="V3",fy[fy.V4=3]="V4",fy[fy.V5=4]="V5",(_y=my||(my={}))[_y.Sparse=0]="Sparse",_y[_y.Dense=1]="Dense",(yy=gy||(gy={}))[yy.HALF=0]="HALF",yy[yy.SINGLE=1]="SINGLE",yy[yy.DOUBLE=2]="DOUBLE",(vy=by||(by={}))[vy.DAY=0]="DAY",vy[vy.MILLISECOND=1]="MILLISECOND",(wy=xy||(xy={}))[wy.SECOND=0]="SECOND",wy[wy.MILLISECOND=1]="MILLISECOND",wy[wy.MICROSECOND=2]="MICROSECOND",wy[wy.NANOSECOND=3]="NANOSECOND",(Ey=Sy||(Sy={}))[Ey.YEAR_MONTH=0]="YEAR_MONTH",Ey[Ey.DAY_TIME=1]="DAY_TIME",Ey[Ey.MONTH_DAY_NANO=2]="MONTH_DAY_NANO";const Ty=new Int32Array(2),Cy=new Float32Array(Ty.buffer),Iy=new Float64Array(Ty.buffer),Ay=1===new Uint16Array(new Uint8Array([1,0]).buffer)[0];var ky,Ly;(Ly=ky||(ky={}))[Ly.UTF8_BYTES=1]="UTF8_BYTES",Ly[Ly.UTF16_STRING=2]="UTF16_STRING";let Ry=class e{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new e(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return Ty[0]=this.readInt32(e),Cy[0]}readFloat64(e){return Ty[Ay?0:1]=this.readInt32(e),Ty[Ay?1:0]=this.readInt32(e+4),Iy[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,Number(BigInt.asIntN(32,t))),this.writeInt32(e+4,Number(BigInt.asIntN(32,t>>BigInt(32))))}writeUint64(e,t){this.writeUint32(e,Number(BigInt.asUintN(32,t))),this.writeUint32(e+4,Number(BigInt.asUintN(32,t>>BigInt(32))))}writeFloat32(e,t){Cy[0]=t,this.writeInt32(e,Ty[0])}writeFloat64(e,t){Iy[0]=t,this.writeInt32(e,Ty[Ay?0:1]),this.writeInt32(e+4,Ty[Ay?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+4+4)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<4;t++)e+=String.fromCharCode(this.readInt8(this.position_+4+t));return e}__offset(e,t){const n=e-this.readInt32(e);return t<this.readInt16(n)?this.readInt16(n+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const n=this.readInt32(e);e+=4;const i=this.bytes_.subarray(e,e+n);return t===ky.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(e,t){return"string"==typeof e?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+4}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(4!=e.length)throw new Error("FlatBuffers: file identifier must be length 4");for(let t=0;t<4;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+4+t))return!1;return!0}createScalarList(e,t){const n=[];for(let i=0;i<t;++i){const t=e(i);null!==t&&n.push(t)}return n}createObjList(e,t){const n=[];for(let i=0;i<t;++i){const t=e(i);null!==t&&n.push(t.unpack())}return n}},Py=class e{constructor(e){let t;this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder,t=e||1024,this.bb=Ry.allocate(t),this.space=t}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(e){this.force_defaults=e}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(t,n){t>this.minalign&&(this.minalign=t);const i=1+~(this.bb.capacity()-this.space+n)&t-1;for(;this.space<i+t+n;){const t=this.bb.capacity();this.bb=e.growByteBuffer(this.bb),this.space+=this.bb.capacity()-t}this.pad(i)}pad(e){for(let t=0;t<e;t++)this.bb.writeInt8(--this.space,0)}writeInt8(e){this.bb.writeInt8(this.space-=1,e)}writeInt16(e){this.bb.writeInt16(this.space-=2,e)}writeInt32(e){this.bb.writeInt32(this.space-=4,e)}writeInt64(e){this.bb.writeInt64(this.space-=8,e)}writeFloat32(e){this.bb.writeFloat32(this.space-=4,e)}writeFloat64(e){this.bb.writeFloat64(this.space-=8,e)}addInt8(e){this.prep(1,0),this.writeInt8(e)}addInt16(e){this.prep(2,0),this.writeInt16(e)}addInt32(e){this.prep(4,0),this.writeInt32(e)}addInt64(e){this.prep(8,0),this.writeInt64(e)}addFloat32(e){this.prep(4,0),this.writeFloat32(e)}addFloat64(e){this.prep(8,0),this.writeFloat64(e)}addFieldInt8(e,t,n){(this.force_defaults||t!=n)&&(this.addInt8(t),this.slot(e))}addFieldInt16(e,t,n){(this.force_defaults||t!=n)&&(this.addInt16(t),this.slot(e))}addFieldInt32(e,t,n){(this.force_defaults||t!=n)&&(this.addInt32(t),this.slot(e))}addFieldInt64(e,t,n){(this.force_defaults||t!==n)&&(this.addInt64(t),this.slot(e))}addFieldFloat32(e,t,n){(this.force_defaults||t!=n)&&(this.addFloat32(t),this.slot(e))}addFieldFloat64(e,t,n){(this.force_defaults||t!=n)&&(this.addFloat64(t),this.slot(e))}addFieldOffset(e,t,n){(this.force_defaults||t!=n)&&(this.addOffset(t),this.slot(e))}addFieldStruct(e,t,n){t!=n&&(this.nested(t),this.slot(e))}nested(e){if(e!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(e){null!==this.vtable&&(this.vtable[e]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(e){const t=e.capacity();if(3221225472&t)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const n=t<<1,i=Ry.allocate(n);return i.setPosition(n-t),i.bytes().set(e.bytes(),n-t),i}addOffset(e){this.prep(4,0),this.writeInt32(this.offset()-e+4)}startObject(e){this.notNested(),null==this.vtable&&(this.vtable=[]),this.vtable_in_use=e;for(let t=0;t<e;t++)this.vtable[t]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(null==this.vtable||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const e=this.offset();let t=this.vtable_in_use-1;for(;t>=0&&0==this.vtable[t];t--);const n=t+1;for(;t>=0;t--)this.addInt16(0!=this.vtable[t]?e-this.vtable[t]:0);this.addInt16(e-this.object_start);const i=2*(n+2);this.addInt16(i);let o=0;const r=this.space;e:for(t=0;t<this.vtables.length;t++){const e=this.bb.capacity()-this.vtables[t];if(i==this.bb.readInt16(e)){for(let t=2;t<i;t+=2)if(this.bb.readInt16(r+t)!=this.bb.readInt16(e+t))continue e;o=this.vtables[t];break}}return o?(this.space=this.bb.capacity()-e,this.bb.writeInt32(this.space,o-e)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-e,this.offset()-e)),this.isNested=!1,e}finish(e,t,n){const i=n?4:0;if(t){const e=t;if(this.prep(this.minalign,8+i),4!=e.length)throw new TypeError("FlatBuffers: file identifier must be length 4");for(let t=3;t>=0;t--)this.writeInt8(e.charCodeAt(t))}this.prep(this.minalign,4+i),this.addOffset(e),i&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(e,t){this.finish(e,t,!0)}requiredField(e,t){const n=this.bb.capacity()-e,i=n-this.bb.readInt32(n);if(!(t<this.bb.readInt16(i)&&0!=this.bb.readInt16(i+t)))throw new TypeError("FlatBuffers: field "+t+" must be set")}startVector(e,t,n){this.notNested(),this.vector_num_elems=t,this.prep(4,e*t),this.prep(n,e*t)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(e){if(!e)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(e))return this.string_maps.get(e);const t=this.createString(e);return this.string_maps.set(e,t),t}createString(e){if(null==e)return 0;let t;return t=e instanceof Uint8Array?e:this.text_encoder.encode(e),this.addInt8(0),this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length),this.bb.bytes().set(t,this.space),this.endVector()}createByteVector(e){return null==e?0:(this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length),this.bb.bytes().set(e,this.space),this.endVector())}createObjectOffset(e){return null===e?0:"string"==typeof e?this.createString(e):e.pack(this)}createObjectOffsetList(e){const t=[];for(let n=0;n<e.length;++n){const i=e[n];if(null===i)throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.");t.push(this.createObjectOffset(i))}return t}createStructOffsetList(e,t){return t(this,e.length),this.createObjectOffsetList(e.slice().reverse()),this.endVector()}};var Dy,My,Ny,Oy;(My=Dy||(Dy={}))[My.BUFFER=0]="BUFFER",(Oy=Ny||(Ny={}))[Oy.LZ4_FRAME=0]="LZ4_FRAME",Oy[Oy.ZSTD=1]="ZSTD";class By{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsBodyCompression(e,t){return(t||new By).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBodyCompression(e,t){return e.setPosition(e.position()+4),(t||new By).__init(e.readInt32(e.position())+e.position(),e)}codec(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt8(this.bb_pos+e):Ny.LZ4_FRAME}method(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt8(this.bb_pos+e):Dy.BUFFER}static startBodyCompression(e){e.startObject(2)}static addCodec(e,t){e.addFieldInt8(0,t,Ny.LZ4_FRAME)}static addMethod(e,t){e.addFieldInt8(1,t,Dy.BUFFER)}static endBodyCompression(e){return e.endObject()}static createBodyCompression(e,t,n){return By.startBodyCompression(e),By.addCodec(e,t),By.addMethod(e,n),By.endBodyCompression(e)}}class Fy{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}offset(){return this.bb.readInt64(this.bb_pos)}length(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createBuffer(e,t,n){return e.prep(8,16),e.writeInt64(BigInt(null!=n?n:0)),e.writeInt64(BigInt(null!=t?t:0)),e.offset()}}let zy=class{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}length(){return this.bb.readInt64(this.bb_pos)}nullCount(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createFieldNode(e,t,n){return e.prep(8,16),e.writeInt64(BigInt(null!=n?n:0)),e.writeInt64(BigInt(null!=t?t:0)),e.offset()}},Uy=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsRecordBatch(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsRecordBatch(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}length(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}nodes(e,t){const n=this.bb.__offset(this.bb_pos,6);return n?(t||new zy).__init(this.bb.__vector(this.bb_pos+n)+16*e,this.bb):null}nodesLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}buffers(e,t){const n=this.bb.__offset(this.bb_pos,8);return n?(t||new Fy).__init(this.bb.__vector(this.bb_pos+n)+16*e,this.bb):null}buffersLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}compression(e){const t=this.bb.__offset(this.bb_pos,10);return t?(e||new By).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}static startRecordBatch(e){e.startObject(4)}static addLength(e,t){e.addFieldInt64(0,t,BigInt("0"))}static addNodes(e,t){e.addFieldOffset(1,t,0)}static startNodesVector(e,t){e.startVector(16,t,8)}static addBuffers(e,t){e.addFieldOffset(2,t,0)}static startBuffersVector(e,t){e.startVector(16,t,8)}static addCompression(e,t){e.addFieldOffset(3,t,0)}static endRecordBatch(e){return e.endObject()}},$y=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDictionaryBatch(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryBatch(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}id(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}data(e){const t=this.bb.__offset(this.bb_pos,6);return t?(e||new Uy).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}isDelta(){const e=this.bb.__offset(this.bb_pos,8);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}static startDictionaryBatch(e){e.startObject(3)}static addId(e,t){e.addFieldInt64(0,t,BigInt("0"))}static addData(e,t){e.addFieldOffset(1,t,0)}static addIsDelta(e,t){e.addFieldInt8(2,+t,0)}static endDictionaryBatch(e){return e.endObject()}};var Vy,Hy,Gy,Wy;(Hy=Vy||(Vy={}))[Hy.Little=0]="Little",Hy[Hy.Big=1]="Big",(Wy=Gy||(Gy={}))[Wy.DenseArray=0]="DenseArray";class jy{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsInt(e,t){return(t||new jy).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsInt(e,t){return e.setPosition(e.position()+4),(t||new jy).__init(e.readInt32(e.position())+e.position(),e)}bitWidth(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}isSigned(){const e=this.bb.__offset(this.bb_pos,6);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}static startInt(e){e.startObject(2)}static addBitWidth(e,t){e.addFieldInt32(0,t,0)}static addIsSigned(e,t){e.addFieldInt8(1,+t,0)}static endInt(e){return e.endObject()}static createInt(e,t,n){return jy.startInt(e),jy.addBitWidth(e,t),jy.addIsSigned(e,n),jy.endInt(e)}}class Yy{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDictionaryEncoding(e,t){return(t||new Yy).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDictionaryEncoding(e,t){return e.setPosition(e.position()+4),(t||new Yy).__init(e.readInt32(e.position())+e.position(),e)}id(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}indexType(e){const t=this.bb.__offset(this.bb_pos,6);return t?(e||new jy).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}isOrdered(){const e=this.bb.__offset(this.bb_pos,8);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}dictionaryKind(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt16(this.bb_pos+e):Gy.DenseArray}static startDictionaryEncoding(e){e.startObject(4)}static addId(e,t){e.addFieldInt64(0,t,BigInt("0"))}static addIndexType(e,t){e.addFieldOffset(1,t,0)}static addIsOrdered(e,t){e.addFieldInt8(2,+t,0)}static addDictionaryKind(e,t){e.addFieldInt16(3,t,Gy.DenseArray)}static endDictionaryEncoding(e){return e.endObject()}}class qy{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsKeyValue(e,t){return(t||new qy).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsKeyValue(e,t){return e.setPosition(e.position()+4),(t||new qy).__init(e.readInt32(e.position())+e.position(),e)}key(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}value(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}static startKeyValue(e){e.startObject(2)}static addKey(e,t){e.addFieldOffset(0,t,0)}static addValue(e,t){e.addFieldOffset(1,t,0)}static endKeyValue(e){return e.endObject()}static createKeyValue(e,t,n){return qy.startKeyValue(e),qy.addKey(e,t),qy.addValue(e,n),qy.endKeyValue(e)}}let Xy=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsBinary(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBinary(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static startBinary(e){e.startObject(0)}static endBinary(e){return e.endObject()}static createBinary(t){return e.startBinary(t),e.endBinary(t)}},Ky=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsBool(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBool(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static startBool(e){e.startObject(0)}static endBool(e){return e.endObject()}static createBool(t){return e.startBool(t),e.endBool(t)}},Zy=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDate(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDate(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):by.MILLISECOND}static startDate(e){e.startObject(1)}static addUnit(e,t){e.addFieldInt16(0,t,by.MILLISECOND)}static endDate(e){return e.endObject()}static createDate(t,n){return e.startDate(t),e.addUnit(t,n),e.endDate(t)}},Qy=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDecimal(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDecimal(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}precision(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}scale(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}bitWidth(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readInt32(this.bb_pos+e):128}static startDecimal(e){e.startObject(3)}static addPrecision(e,t){e.addFieldInt32(0,t,0)}static addScale(e,t){e.addFieldInt32(1,t,0)}static addBitWidth(e,t){e.addFieldInt32(2,t,128)}static endDecimal(e){return e.endObject()}static createDecimal(t,n,i,o){return e.startDecimal(t),e.addPrecision(t,n),e.addScale(t,i),e.addBitWidth(t,o),e.endDecimal(t)}},Jy=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDuration(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDuration(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):xy.MILLISECOND}static startDuration(e){e.startObject(1)}static addUnit(e,t){e.addFieldInt16(0,t,xy.MILLISECOND)}static endDuration(e){return e.endObject()}static createDuration(t,n){return e.startDuration(t),e.addUnit(t,n),e.endDuration(t)}},eb=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFixedSizeBinary(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeBinary(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}byteWidth(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}static startFixedSizeBinary(e){e.startObject(1)}static addByteWidth(e,t){e.addFieldInt32(0,t,0)}static endFixedSizeBinary(e){return e.endObject()}static createFixedSizeBinary(t,n){return e.startFixedSizeBinary(t),e.addByteWidth(t,n),e.endFixedSizeBinary(t)}},tb=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFixedSizeList(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeList(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}listSize(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}static startFixedSizeList(e){e.startObject(1)}static addListSize(e,t){e.addFieldInt32(0,t,0)}static endFixedSizeList(e){return e.endObject()}static createFixedSizeList(t,n){return e.startFixedSizeList(t),e.addListSize(t,n),e.endFixedSizeList(t)}};class nb{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFloatingPoint(e,t){return(t||new nb).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFloatingPoint(e,t){return e.setPosition(e.position()+4),(t||new nb).__init(e.readInt32(e.position())+e.position(),e)}precision(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):gy.HALF}static startFloatingPoint(e){e.startObject(1)}static addPrecision(e,t){e.addFieldInt16(0,t,gy.HALF)}static endFloatingPoint(e){return e.endObject()}static createFloatingPoint(e,t){return nb.startFloatingPoint(e),nb.addPrecision(e,t),nb.endFloatingPoint(e)}}class ib{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsInterval(e,t){return(t||new ib).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsInterval(e,t){return e.setPosition(e.position()+4),(t||new ib).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Sy.YEAR_MONTH}static startInterval(e){e.startObject(1)}static addUnit(e,t){e.addFieldInt16(0,t,Sy.YEAR_MONTH)}static endInterval(e){return e.endObject()}static createInterval(e,t){return ib.startInterval(e),ib.addUnit(e,t),ib.endInterval(e)}}let ob=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsLargeBinary(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsLargeBinary(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static startLargeBinary(e){e.startObject(0)}static endLargeBinary(e){return e.endObject()}static createLargeBinary(t){return e.startLargeBinary(t),e.endLargeBinary(t)}},rb=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsLargeUtf8(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsLargeUtf8(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static startLargeUtf8(e){e.startObject(0)}static endLargeUtf8(e){return e.endObject()}static createLargeUtf8(t){return e.startLargeUtf8(t),e.endLargeUtf8(t)}},sb=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsList(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsList(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static startList(e){e.startObject(0)}static endList(e){return e.endObject()}static createList(t){return e.startList(t),e.endList(t)}},ab=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsMap(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMap(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}keysSorted(){const e=this.bb.__offset(this.bb_pos,4);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}static startMap(e){e.startObject(1)}static addKeysSorted(e,t){e.addFieldInt8(0,+t,0)}static endMap(e){return e.endObject()}static createMap(t,n){return e.startMap(t),e.addKeysSorted(t,n),e.endMap(t)}},lb=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsNull(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsNull(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static startNull(e){e.startObject(0)}static endNull(e){return e.endObject()}static createNull(t){return e.startNull(t),e.endNull(t)}};class cb{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsStruct_(e,t){return(t||new cb).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsStruct_(e,t){return e.setPosition(e.position()+4),(t||new cb).__init(e.readInt32(e.position())+e.position(),e)}static startStruct_(e){e.startObject(0)}static endStruct_(e){return e.endObject()}static createStruct_(e){return cb.startStruct_(e),cb.endStruct_(e)}}class ub{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsTime(e,t){return(t||new ub).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTime(e,t){return e.setPosition(e.position()+4),(t||new ub).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):xy.MILLISECOND}bitWidth(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):32}static startTime(e){e.startObject(2)}static addUnit(e,t){e.addFieldInt16(0,t,xy.MILLISECOND)}static addBitWidth(e,t){e.addFieldInt32(1,t,32)}static endTime(e){return e.endObject()}static createTime(e,t,n){return ub.startTime(e),ub.addUnit(e,t),ub.addBitWidth(e,n),ub.endTime(e)}}class hb{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsTimestamp(e,t){return(t||new hb).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTimestamp(e,t){return e.setPosition(e.position()+4),(t||new hb).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):xy.SECOND}timezone(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}static startTimestamp(e){e.startObject(2)}static addUnit(e,t){e.addFieldInt16(0,t,xy.SECOND)}static addTimezone(e,t){e.addFieldOffset(1,t,0)}static endTimestamp(e){return e.endObject()}static createTimestamp(e,t,n){return hb.startTimestamp(e),hb.addUnit(e,t),hb.addTimezone(e,n),hb.endTimestamp(e)}}class db{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsUnion(e,t){return(t||new db).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsUnion(e,t){return e.setPosition(e.position()+4),(t||new db).__init(e.readInt32(e.position())+e.position(),e)}mode(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):my.Sparse}typeIds(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb.__vector(this.bb_pos+t)+4*e):0}typeIdsLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}typeIdsArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}static startUnion(e){e.startObject(2)}static addMode(e,t){e.addFieldInt16(0,t,my.Sparse)}static addTypeIds(e,t){e.addFieldOffset(1,t,0)}static createTypeIdsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addInt32(t[n]);return e.endVector()}static startTypeIdsVector(e,t){e.startVector(4,t,4)}static endUnion(e){return e.endObject()}static createUnion(e,t,n){return db.startUnion(e),db.addMode(e,t),db.addTypeIds(e,n),db.endUnion(e)}}let pb=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsUtf8(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUtf8(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static startUtf8(e){e.startObject(0)}static endUtf8(e){return e.endObject()}static createUtf8(t){return e.startUtf8(t),e.endUtf8(t)}};var fb,mb;(mb=fb||(fb={}))[mb.NONE=0]="NONE",mb[mb.Null=1]="Null",mb[mb.Int=2]="Int",mb[mb.FloatingPoint=3]="FloatingPoint",mb[mb.Binary=4]="Binary",mb[mb.Utf8=5]="Utf8",mb[mb.Bool=6]="Bool",mb[mb.Decimal=7]="Decimal",mb[mb.Date=8]="Date",mb[mb.Time=9]="Time",mb[mb.Timestamp=10]="Timestamp",mb[mb.Interval=11]="Interval",mb[mb.List=12]="List",mb[mb.Struct_=13]="Struct_",mb[mb.Union=14]="Union",mb[mb.FixedSizeBinary=15]="FixedSizeBinary",mb[mb.FixedSizeList=16]="FixedSizeList",mb[mb.Map=17]="Map",mb[mb.Duration=18]="Duration",mb[mb.LargeBinary=19]="LargeBinary",mb[mb.LargeUtf8=20]="LargeUtf8",mb[mb.LargeList=21]="LargeList",mb[mb.RunEndEncoded=22]="RunEndEncoded";let _b=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsField(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsField(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}name(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}nullable(){const e=this.bb.__offset(this.bb_pos,6);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}typeType(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):fb.NONE}type(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__union(e,this.bb_pos+t):null}dictionary(e){const t=this.bb.__offset(this.bb_pos,12);return t?(e||new Yy).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}children(t,n){const i=this.bb.__offset(this.bb_pos,14);return i?(n||new e).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}childrenLength(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,t){const n=this.bb.__offset(this.bb_pos,16);return n?(t||new qy).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.__vector_len(this.bb_pos+e):0}static startField(e){e.startObject(7)}static addName(e,t){e.addFieldOffset(0,t,0)}static addNullable(e,t){e.addFieldInt8(1,+t,0)}static addTypeType(e,t){e.addFieldInt8(2,t,fb.NONE)}static addType(e,t){e.addFieldOffset(3,t,0)}static addDictionary(e,t){e.addFieldOffset(4,t,0)}static addChildren(e,t){e.addFieldOffset(5,t,0)}static createChildrenVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startChildrenVector(e,t){e.startVector(4,t,4)}static addCustomMetadata(e,t){e.addFieldOffset(6,t,0)}static createCustomMetadataVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startCustomMetadataVector(e,t){e.startVector(4,t,4)}static endField(e){return e.endObject()}},gb=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSchema(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSchema(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}endianness(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Vy.Little}fields(e,t){const n=this.bb.__offset(this.bb_pos,6);return n?(t||new _b).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}fieldsLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,t){const n=this.bb.__offset(this.bb_pos,8);return n?(t||new qy).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}features(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt64(this.bb.__vector(this.bb_pos+t)+8*e):BigInt(0)}featuresLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}static startSchema(e){e.startObject(4)}static addEndianness(e,t){e.addFieldInt16(0,t,Vy.Little)}static addFields(e,t){e.addFieldOffset(1,t,0)}static createFieldsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startFieldsVector(e,t){e.startVector(4,t,4)}static addCustomMetadata(e,t){e.addFieldOffset(2,t,0)}static createCustomMetadataVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startCustomMetadataVector(e,t){e.startVector(4,t,4)}static addFeatures(e,t){e.addFieldOffset(3,t,0)}static createFeaturesVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addInt64(t[n]);return e.endVector()}static startFeaturesVector(e,t){e.startVector(8,t,8)}static endSchema(e){return e.endObject()}static finishSchemaBuffer(e,t){e.finish(t)}static finishSizePrefixedSchemaBuffer(e,t){e.finish(t,void 0,!0)}static createSchema(t,n,i,o,r){return e.startSchema(t),e.addEndianness(t,n),e.addFields(t,i),e.addCustomMetadata(t,o),e.addFeatures(t,r),e.endSchema(t)}};var yb,bb,vb,xb,wb;function Sb(e){if(null===e)return"null";if(void 0===e)return"undefined";switch(typeof e){case"number":case"bigint":return`${e}`;case"string":return`"${e}"`}return"function"==typeof e[Symbol.toPrimitive]?e[Symbol.toPrimitive]("string"):ArrayBuffer.isView(e)?e instanceof BigInt64Array||e instanceof BigUint64Array?`[${[...e].map(e=>Sb(e))}]`:`[${e}]`:ArrayBuffer.isView(e)?`[${e}]`:JSON.stringify(e,(e,t)=>"bigint"==typeof t?`${t}`:t)}function Eb(e){if("bigint"==typeof e&&(e<Number.MIN_SAFE_INTEGER||e>Number.MAX_SAFE_INTEGER))throw new TypeError(`${e} is not safe to convert to a number.`);return Number(e)}function Tb(e,t){return Eb(e/t)+Eb(e%t)/Eb(t)}(bb=yb||(yb={}))[bb.NONE=0]="NONE",bb[bb.Schema=1]="Schema",bb[bb.DictionaryBatch=2]="DictionaryBatch",bb[bb.RecordBatch=3]="RecordBatch",bb[bb.Tensor=4]="Tensor",bb[bb.SparseTensor=5]="SparseTensor",function(e){e[e.NONE=0]="NONE",e[e.Null=1]="Null",e[e.Int=2]="Int",e[e.Float=3]="Float",e[e.Binary=4]="Binary",e[e.Utf8=5]="Utf8",e[e.Bool=6]="Bool",e[e.Decimal=7]="Decimal",e[e.Date=8]="Date",e[e.Time=9]="Time",e[e.Timestamp=10]="Timestamp",e[e.Interval=11]="Interval",e[e.List=12]="List",e[e.Struct=13]="Struct",e[e.Union=14]="Union",e[e.FixedSizeBinary=15]="FixedSizeBinary",e[e.FixedSizeList=16]="FixedSizeList",e[e.Map=17]="Map",e[e.Duration=18]="Duration",e[e.LargeBinary=19]="LargeBinary",e[e.LargeUtf8=20]="LargeUtf8",e[e.Dictionary=-1]="Dictionary",e[e.Int8=-2]="Int8",e[e.Int16=-3]="Int16",e[e.Int32=-4]="Int32",e[e.Int64=-5]="Int64",e[e.Uint8=-6]="Uint8",e[e.Uint16=-7]="Uint16",e[e.Uint32=-8]="Uint32",e[e.Uint64=-9]="Uint64",e[e.Float16=-10]="Float16",e[e.Float32=-11]="Float32",e[e.Float64=-12]="Float64",e[e.DateDay=-13]="DateDay",e[e.DateMillisecond=-14]="DateMillisecond",e[e.TimestampSecond=-15]="TimestampSecond",e[e.TimestampMillisecond=-16]="TimestampMillisecond",e[e.TimestampMicrosecond=-17]="TimestampMicrosecond",e[e.TimestampNanosecond=-18]="TimestampNanosecond",e[e.TimeSecond=-19]="TimeSecond",e[e.TimeMillisecond=-20]="TimeMillisecond",e[e.TimeMicrosecond=-21]="TimeMicrosecond",e[e.TimeNanosecond=-22]="TimeNanosecond",e[e.DenseUnion=-23]="DenseUnion",e[e.SparseUnion=-24]="SparseUnion",e[e.IntervalDayTime=-25]="IntervalDayTime",e[e.IntervalYearMonth=-26]="IntervalYearMonth",e[e.DurationSecond=-27]="DurationSecond",e[e.DurationMillisecond=-28]="DurationMillisecond",e[e.DurationMicrosecond=-29]="DurationMicrosecond",e[e.DurationNanosecond=-30]="DurationNanosecond"}(vb||(vb={})),(wb=xb||(xb={}))[wb.OFFSET=0]="OFFSET",wb[wb.DATA=1]="DATA",wb[wb.VALIDITY=2]="VALIDITY",wb[wb.TYPE=3]="TYPE";const Cb=Symbol.for("isArrowBigNum");function Ib(e,...t){return 0===t.length?Object.setPrototypeOf(ty(this.TypedArray,e),this.constructor.prototype):Object.setPrototypeOf(new this.TypedArray(e,...t),this.constructor.prototype)}function Ab(...e){return Ib.apply(this,e)}function kb(...e){return Ib.apply(this,e)}function Lb(...e){return Ib.apply(this,e)}Ib.prototype[Cb]=!0,Ib.prototype.toJSON=function(){return`"${Db(this)}"`},Ib.prototype.valueOf=function(e){return Pb(this,e)},Ib.prototype.toString=function(){return Db(this)},Ib.prototype[Symbol.toPrimitive]=function(e="default"){switch(e){case"number":return Pb(this);case"string":return Db(this);case"default":return function(e){return 8===e.byteLength?new e.BigIntArray(e.buffer,e.byteOffset,1)[0]:Db(e)}(this)}return Db(this)},Object.setPrototypeOf(Ab.prototype,Object.create(Int32Array.prototype)),Object.setPrototypeOf(kb.prototype,Object.create(Uint32Array.prototype)),Object.setPrototypeOf(Lb.prototype,Object.create(Uint32Array.prototype)),Object.assign(Ab.prototype,Ib.prototype,{constructor:Ab,signed:!0,TypedArray:Int32Array,BigIntArray:BigInt64Array}),Object.assign(kb.prototype,Ib.prototype,{constructor:kb,signed:!1,TypedArray:Uint32Array,BigIntArray:BigUint64Array}),Object.assign(Lb.prototype,Ib.prototype,{constructor:Lb,signed:!0,TypedArray:Uint32Array,BigIntArray:BigUint64Array});const Rb=BigInt(4294967296)*BigInt(4294967296)-BigInt(1);function Pb(e,t){const{buffer:n,byteOffset:i,byteLength:o,signed:r}=e,s=new BigUint64Array(n,i,o/8),a=r&&s.at(-1)&BigInt(1)<<BigInt(63);let l=BigInt(0),c=0;if(a){for(const e of s)l|=(e^Rb)*(BigInt(1)<<BigInt(64*c++));l*=BigInt(-1),l-=BigInt(1)}else for(const u of s)l|=u*(BigInt(1)<<BigInt(64*c++));if("number"==typeof t){const e=BigInt(Math.pow(10,t)),n=l%e;return Eb(l/e)+Eb(n)/Eb(e)}return Eb(l)}function Db(e){if(8===e.byteLength)return`${new e.BigIntArray(e.buffer,e.byteOffset,1)[0]}`;if(!e.signed)return Mb(e);let t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2);if(new Int16Array([t.at(-1)])[0]>=0)return Mb(e);t=t.slice();let n=1;for(let i=0;i<t.length;i++){const e=t[i],o=~e+n;t[i]=o,n&=0===e?1:0}return`-${Mb(t)}`}function Mb(e){let t="";const n=new Uint32Array(2);let i=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2);const o=new Uint32Array((i=new Uint16Array(i).reverse()).buffer);let r=-1;const s=i.length-1;do{for(n[0]=i[r=0];r<s;)i[r++]=n[1]=n[0]/10,n[0]=(n[0]-10*n[1]<<16)+i[r];i[r]=n[1]=n[0]/10,n[0]=n[0]-10*n[1],t=`${n[0]}${t}`}while(o[0]||o[1]||o[2]||o[3]);return null!=t?t:"0"}class Nb{static new(e,t){switch(t){case!0:return new Ab(e);case!1:return new kb(e)}switch(e.constructor){case Int8Array:case Int16Array:case Int32Array:case BigInt64Array:return new Ab(e)}return 16===e.byteLength?new Lb(e):new kb(e)}static signed(e){return new Ab(e)}static unsigned(e){return new kb(e)}static decimal(e){return new Lb(e)}constructor(e,t){return Nb.new(e,t)}}var Ob,Bb,Fb,zb,Ub,$b,Vb,Hb,Gb,Wb,jb,Yb,qb,Xb,Kb,Zb,Qb,Jb,ev,tv,nv,iv,ov;class rv{static isNull(e){return(null==e?void 0:e.typeId)===vb.Null}static isInt(e){return(null==e?void 0:e.typeId)===vb.Int}static isFloat(e){return(null==e?void 0:e.typeId)===vb.Float}static isBinary(e){return(null==e?void 0:e.typeId)===vb.Binary}static isLargeBinary(e){return(null==e?void 0:e.typeId)===vb.LargeBinary}static isUtf8(e){return(null==e?void 0:e.typeId)===vb.Utf8}static isLargeUtf8(e){return(null==e?void 0:e.typeId)===vb.LargeUtf8}static isBool(e){return(null==e?void 0:e.typeId)===vb.Bool}static isDecimal(e){return(null==e?void 0:e.typeId)===vb.Decimal}static isDate(e){return(null==e?void 0:e.typeId)===vb.Date}static isTime(e){return(null==e?void 0:e.typeId)===vb.Time}static isTimestamp(e){return(null==e?void 0:e.typeId)===vb.Timestamp}static isInterval(e){return(null==e?void 0:e.typeId)===vb.Interval}static isDuration(e){return(null==e?void 0:e.typeId)===vb.Duration}static isList(e){return(null==e?void 0:e.typeId)===vb.List}static isStruct(e){return(null==e?void 0:e.typeId)===vb.Struct}static isUnion(e){return(null==e?void 0:e.typeId)===vb.Union}static isFixedSizeBinary(e){return(null==e?void 0:e.typeId)===vb.FixedSizeBinary}static isFixedSizeList(e){return(null==e?void 0:e.typeId)===vb.FixedSizeList}static isMap(e){return(null==e?void 0:e.typeId)===vb.Map}static isDictionary(e){return(null==e?void 0:e.typeId)===vb.Dictionary}static isDenseUnion(e){return rv.isUnion(e)&&e.mode===my.Dense}static isSparseUnion(e){return rv.isUnion(e)&&e.mode===my.Sparse}constructor(e){this.typeId=e}}Ob=Symbol.toStringTag,rv[Ob]=((ov=rv.prototype).children=null,ov.ArrayType=Array,ov.OffsetArrayType=Int32Array,ov[Symbol.toStringTag]="DataType");class sv extends rv{constructor(){super(vb.Null)}toString(){return"Null"}}Bb=Symbol.toStringTag,sv[Bb]=sv.prototype[Symbol.toStringTag]="Null";class av extends rv{constructor(e,t){super(vb.Int),this.isSigned=e,this.bitWidth=t}get ArrayType(){switch(this.bitWidth){case 8:return this.isSigned?Int8Array:Uint8Array;case 16:return this.isSigned?Int16Array:Uint16Array;case 32:return this.isSigned?Int32Array:Uint32Array;case 64:return this.isSigned?BigInt64Array:BigUint64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}}Fb=Symbol.toStringTag,av[Fb]=(e=>(e.isSigned=null,e.bitWidth=null,e[Symbol.toStringTag]="Int"))(av.prototype);class lv extends av{constructor(){super(!0,8)}get ArrayType(){return Int8Array}}class cv extends av{constructor(){super(!0,16)}get ArrayType(){return Int16Array}}class uv extends av{constructor(){super(!0,32)}get ArrayType(){return Int32Array}}let hv=class extends av{constructor(){super(!0,64)}get ArrayType(){return BigInt64Array}};class dv extends av{constructor(){super(!1,8)}get ArrayType(){return Uint8Array}}class pv extends av{constructor(){super(!1,16)}get ArrayType(){return Uint16Array}}class fv extends av{constructor(){super(!1,32)}get ArrayType(){return Uint32Array}}let mv=class extends av{constructor(){super(!1,64)}get ArrayType(){return BigUint64Array}};Object.defineProperty(lv.prototype,"ArrayType",{value:Int8Array}),Object.defineProperty(cv.prototype,"ArrayType",{value:Int16Array}),Object.defineProperty(uv.prototype,"ArrayType",{value:Int32Array}),Object.defineProperty(hv.prototype,"ArrayType",{value:BigInt64Array}),Object.defineProperty(dv.prototype,"ArrayType",{value:Uint8Array}),Object.defineProperty(pv.prototype,"ArrayType",{value:Uint16Array}),Object.defineProperty(fv.prototype,"ArrayType",{value:Uint32Array}),Object.defineProperty(mv.prototype,"ArrayType",{value:BigUint64Array});class _v extends rv{constructor(e){super(vb.Float),this.precision=e}get ArrayType(){switch(this.precision){case gy.HALF:return Uint16Array;case gy.SINGLE:return Float32Array;case gy.DOUBLE:return Float64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`Float${this.precision<<5||16}`}}zb=Symbol.toStringTag,_v[zb]=(e=>(e.precision=null,e[Symbol.toStringTag]="Float"))(_v.prototype);class gv extends _v{constructor(){super(gy.SINGLE)}}class yv extends _v{constructor(){super(gy.DOUBLE)}}Object.defineProperty(gv.prototype,"ArrayType",{value:Float32Array}),Object.defineProperty(yv.prototype,"ArrayType",{value:Float64Array});class bv extends rv{constructor(){super(vb.Binary)}toString(){return"Binary"}}Ub=Symbol.toStringTag,bv[Ub]=(e=>(e.ArrayType=Uint8Array,e[Symbol.toStringTag]="Binary"))(bv.prototype);class vv extends rv{constructor(){super(vb.LargeBinary)}toString(){return"LargeBinary"}}$b=Symbol.toStringTag,vv[$b]=(e=>(e.ArrayType=Uint8Array,e.OffsetArrayType=BigInt64Array,e[Symbol.toStringTag]="LargeBinary"))(vv.prototype);class xv extends rv{constructor(){super(vb.Utf8)}toString(){return"Utf8"}}Vb=Symbol.toStringTag,xv[Vb]=(e=>(e.ArrayType=Uint8Array,e[Symbol.toStringTag]="Utf8"))(xv.prototype);class wv extends rv{constructor(){super(vb.LargeUtf8)}toString(){return"LargeUtf8"}}Hb=Symbol.toStringTag,wv[Hb]=(e=>(e.ArrayType=Uint8Array,e.OffsetArrayType=BigInt64Array,e[Symbol.toStringTag]="LargeUtf8"))(wv.prototype);class Sv extends rv{constructor(){super(vb.Bool)}toString(){return"Bool"}}Gb=Symbol.toStringTag,Sv[Gb]=(e=>(e.ArrayType=Uint8Array,e[Symbol.toStringTag]="Bool"))(Sv.prototype);class Ev extends rv{constructor(e,t,n=128){super(vb.Decimal),this.scale=e,this.precision=t,this.bitWidth=n}toString(){return`Decimal[${this.precision}e${this.scale>0?"+":""}${this.scale}]`}}Wb=Symbol.toStringTag,Ev[Wb]=(e=>(e.scale=null,e.precision=null,e.ArrayType=Uint32Array,e[Symbol.toStringTag]="Decimal"))(Ev.prototype);class Tv extends rv{constructor(e){super(vb.Date),this.unit=e}toString(){return`Date${32*(this.unit+1)}<${by[this.unit]}>`}get ArrayType(){return this.unit===by.DAY?Int32Array:BigInt64Array}}jb=Symbol.toStringTag,Tv[jb]=(e=>(e.unit=null,e[Symbol.toStringTag]="Date"))(Tv.prototype);class Cv extends rv{constructor(e,t){super(vb.Time),this.unit=e,this.bitWidth=t}toString(){return`Time${this.bitWidth}<${xy[this.unit]}>`}get ArrayType(){switch(this.bitWidth){case 32:return Int32Array;case 64:return BigInt64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}}Yb=Symbol.toStringTag,Cv[Yb]=(e=>(e.unit=null,e.bitWidth=null,e[Symbol.toStringTag]="Time"))(Cv.prototype);class Iv extends rv{constructor(e,t){super(vb.Timestamp),this.unit=e,this.timezone=t}toString(){return`Timestamp<${xy[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}}qb=Symbol.toStringTag,Iv[qb]=(e=>(e.unit=null,e.timezone=null,e.ArrayType=BigInt64Array,e[Symbol.toStringTag]="Timestamp"))(Iv.prototype);class Av extends Iv{constructor(e){super(xy.MILLISECOND,e)}}class kv extends rv{constructor(e){super(vb.Interval),this.unit=e}toString(){return`Interval<${Sy[this.unit]}>`}}Xb=Symbol.toStringTag,kv[Xb]=(e=>(e.unit=null,e.ArrayType=Int32Array,e[Symbol.toStringTag]="Interval"))(kv.prototype);class Lv extends rv{constructor(e){super(vb.Duration),this.unit=e}toString(){return`Duration<${xy[this.unit]}>`}}Kb=Symbol.toStringTag,Lv[Kb]=(e=>(e.unit=null,e.ArrayType=BigInt64Array,e[Symbol.toStringTag]="Duration"))(Lv.prototype);class Rv extends rv{constructor(e){super(vb.List),this.children=[e]}toString(){return`List<${this.valueType}>`}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}}Zb=Symbol.toStringTag,Rv[Zb]=(e=>(e.children=null,e[Symbol.toStringTag]="List"))(Rv.prototype);class Pv extends rv{constructor(e){super(vb.Struct),this.children=e}toString(){return`Struct<{${this.children.map(e=>`${e.name}:${e.type}`).join(", ")}}>`}}Qb=Symbol.toStringTag,Pv[Qb]=(e=>(e.children=null,e[Symbol.toStringTag]="Struct"))(Pv.prototype);class Dv extends rv{constructor(e,t,n){super(vb.Union),this.mode=e,this.children=n,this.typeIds=t=Int32Array.from(t),this.typeIdToChildIndex=t.reduce((e,t,n)=>(e[t]=n)&&e||e,Object.create(null))}toString(){return`${this[Symbol.toStringTag]}<${this.children.map(e=>`${e.type}`).join(" | ")}>`}}Jb=Symbol.toStringTag,Dv[Jb]=(e=>(e.mode=null,e.typeIds=null,e.children=null,e.typeIdToChildIndex=null,e.ArrayType=Int8Array,e[Symbol.toStringTag]="Union"))(Dv.prototype);class Mv extends rv{constructor(e){super(vb.FixedSizeBinary),this.byteWidth=e}toString(){return`FixedSizeBinary[${this.byteWidth}]`}}ev=Symbol.toStringTag,Mv[ev]=(e=>(e.byteWidth=null,e.ArrayType=Uint8Array,e[Symbol.toStringTag]="FixedSizeBinary"))(Mv.prototype);class Nv extends rv{constructor(e,t){super(vb.FixedSizeList),this.listSize=e,this.children=[t]}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}}tv=Symbol.toStringTag,Nv[tv]=(e=>(e.children=null,e.listSize=null,e[Symbol.toStringTag]="FixedSizeList"))(Nv.prototype);class Ov extends rv{constructor(e,t=!1){var n,i,o;if(super(vb.Map),this.children=[e],this.keysSorted=t,e&&(e.name="entries",null===(n=null==e?void 0:e.type)||void 0===n?void 0:n.children)){const t=null===(i=null==e?void 0:e.type)||void 0===i?void 0:i.children[0];t&&(t.name="key");const n=null===(o=null==e?void 0:e.type)||void 0===o?void 0:o.children[1];n&&(n.name="value")}}get keyType(){return this.children[0].type.children[0].type}get valueType(){return this.children[0].type.children[1].type}get childType(){return this.children[0].type}toString(){return`Map<{${this.children[0].type.children.map(e=>`${e.name}:${e.type}`).join(", ")}}>`}}nv=Symbol.toStringTag,Ov[nv]=(e=>(e.children=null,e.keysSorted=null,e[Symbol.toStringTag]="Map_"))(Ov.prototype);const Bv=(e=>()=>++e)(-1);class Fv extends rv{constructor(e,t,n,i){super(vb.Dictionary),this.indices=t,this.dictionary=e,this.isOrdered=i||!1,this.id=null==n?Bv():Eb(n)}get children(){return this.dictionary.children}get valueType(){return this.dictionary}get ArrayType(){return this.dictionary.ArrayType}toString(){return`Dictionary<${this.indices}, ${this.dictionary}>`}}function zv(e){const t=e;switch(e.typeId){case vb.Decimal:return e.bitWidth/32;case vb.Interval:return 1+t.unit;case vb.FixedSizeList:return t.listSize;case vb.FixedSizeBinary:return t.byteWidth;default:return 1}}iv=Symbol.toStringTag,Fv[iv]=(e=>(e.id=null,e.indices=null,e.isOrdered=null,e.dictionary=null,e[Symbol.toStringTag]="Dictionary"))(Fv.prototype);class Uv{visitMany(e,...t){return e.map((e,n)=>this.visit(e,...t.map(e=>e[n])))}visit(...e){return this.getVisitFn(e[0],!1).apply(this,e)}getVisitFn(e,t=!0){return function(e,t,n=!0){return"number"==typeof t?$v(e,t,n):"string"==typeof t&&t in vb?$v(e,vb[t],n):t&&t instanceof rv?$v(e,Vv(t),n):(null==t?void 0:t.type)&&t.type instanceof rv?$v(e,Vv(t.type),n):$v(e,vb.NONE,n)}(this,e,t)}getVisitFnByTypeId(e,t=!0){return $v(this,e,t)}visitNull(e,...t){return null}visitBool(e,...t){return null}visitInt(e,...t){return null}visitFloat(e,...t){return null}visitUtf8(e,...t){return null}visitLargeUtf8(e,...t){return null}visitBinary(e,...t){return null}visitLargeBinary(e,...t){return null}visitFixedSizeBinary(e,...t){return null}visitDate(e,...t){return null}visitTimestamp(e,...t){return null}visitTime(e,...t){return null}visitDecimal(e,...t){return null}visitList(e,...t){return null}visitStruct(e,...t){return null}visitUnion(e,...t){return null}visitDictionary(e,...t){return null}visitInterval(e,...t){return null}visitDuration(e,...t){return null}visitFixedSizeList(e,...t){return null}visitMap(e,...t){return null}}function $v(e,t,n=!0){let i=null;switch(t){case vb.Null:i=e.visitNull;break;case vb.Bool:i=e.visitBool;break;case vb.Int:i=e.visitInt;break;case vb.Int8:i=e.visitInt8||e.visitInt;break;case vb.Int16:i=e.visitInt16||e.visitInt;break;case vb.Int32:i=e.visitInt32||e.visitInt;break;case vb.Int64:i=e.visitInt64||e.visitInt;break;case vb.Uint8:i=e.visitUint8||e.visitInt;break;case vb.Uint16:i=e.visitUint16||e.visitInt;break;case vb.Uint32:i=e.visitUint32||e.visitInt;break;case vb.Uint64:i=e.visitUint64||e.visitInt;break;case vb.Float:i=e.visitFloat;break;case vb.Float16:i=e.visitFloat16||e.visitFloat;break;case vb.Float32:i=e.visitFloat32||e.visitFloat;break;case vb.Float64:i=e.visitFloat64||e.visitFloat;break;case vb.Utf8:i=e.visitUtf8;break;case vb.LargeUtf8:i=e.visitLargeUtf8;break;case vb.Binary:i=e.visitBinary;break;case vb.LargeBinary:i=e.visitLargeBinary;break;case vb.FixedSizeBinary:i=e.visitFixedSizeBinary;break;case vb.Date:i=e.visitDate;break;case vb.DateDay:i=e.visitDateDay||e.visitDate;break;case vb.DateMillisecond:i=e.visitDateMillisecond||e.visitDate;break;case vb.Timestamp:i=e.visitTimestamp;break;case vb.TimestampSecond:i=e.visitTimestampSecond||e.visitTimestamp;break;case vb.TimestampMillisecond:i=e.visitTimestampMillisecond||e.visitTimestamp;break;case vb.TimestampMicrosecond:i=e.visitTimestampMicrosecond||e.visitTimestamp;break;case vb.TimestampNanosecond:i=e.visitTimestampNanosecond||e.visitTimestamp;break;case vb.Time:i=e.visitTime;break;case vb.TimeSecond:i=e.visitTimeSecond||e.visitTime;break;case vb.TimeMillisecond:i=e.visitTimeMillisecond||e.visitTime;break;case vb.TimeMicrosecond:i=e.visitTimeMicrosecond||e.visitTime;break;case vb.TimeNanosecond:i=e.visitTimeNanosecond||e.visitTime;break;case vb.Decimal:i=e.visitDecimal;break;case vb.List:i=e.visitList;break;case vb.Struct:i=e.visitStruct;break;case vb.Union:i=e.visitUnion;break;case vb.DenseUnion:i=e.visitDenseUnion||e.visitUnion;break;case vb.SparseUnion:i=e.visitSparseUnion||e.visitUnion;break;case vb.Dictionary:i=e.visitDictionary;break;case vb.Interval:i=e.visitInterval;break;case vb.IntervalDayTime:i=e.visitIntervalDayTime||e.visitInterval;break;case vb.IntervalYearMonth:i=e.visitIntervalYearMonth||e.visitInterval;break;case vb.Duration:i=e.visitDuration;break;case vb.DurationSecond:i=e.visitDurationSecond||e.visitDuration;break;case vb.DurationMillisecond:i=e.visitDurationMillisecond||e.visitDuration;break;case vb.DurationMicrosecond:i=e.visitDurationMicrosecond||e.visitDuration;break;case vb.DurationNanosecond:i=e.visitDurationNanosecond||e.visitDuration;break;case vb.FixedSizeList:i=e.visitFixedSizeList;break;case vb.Map:i=e.visitMap}if("function"==typeof i)return i;if(!n)return()=>null;throw new Error(`Unrecognized type '${vb[t]}'`)}function Vv(e){switch(e.typeId){case vb.Null:return vb.Null;case vb.Int:{const{bitWidth:t,isSigned:n}=e;switch(t){case 8:return n?vb.Int8:vb.Uint8;case 16:return n?vb.Int16:vb.Uint16;case 32:return n?vb.Int32:vb.Uint32;case 64:return n?vb.Int64:vb.Uint64}return vb.Int}case vb.Float:switch(e.precision){case gy.HALF:return vb.Float16;case gy.SINGLE:return vb.Float32;case gy.DOUBLE:return vb.Float64}return vb.Float;case vb.Binary:return vb.Binary;case vb.LargeBinary:return vb.LargeBinary;case vb.Utf8:return vb.Utf8;case vb.LargeUtf8:return vb.LargeUtf8;case vb.Bool:return vb.Bool;case vb.Decimal:return vb.Decimal;case vb.Time:switch(e.unit){case xy.SECOND:return vb.TimeSecond;case xy.MILLISECOND:return vb.TimeMillisecond;case xy.MICROSECOND:return vb.TimeMicrosecond;case xy.NANOSECOND:return vb.TimeNanosecond}return vb.Time;case vb.Timestamp:switch(e.unit){case xy.SECOND:return vb.TimestampSecond;case xy.MILLISECOND:return vb.TimestampMillisecond;case xy.MICROSECOND:return vb.TimestampMicrosecond;case xy.NANOSECOND:return vb.TimestampNanosecond}return vb.Timestamp;case vb.Date:switch(e.unit){case by.DAY:return vb.DateDay;case by.MILLISECOND:return vb.DateMillisecond}return vb.Date;case vb.Interval:switch(e.unit){case Sy.DAY_TIME:return vb.IntervalDayTime;case Sy.YEAR_MONTH:return vb.IntervalYearMonth}return vb.Interval;case vb.Duration:switch(e.unit){case xy.SECOND:return vb.DurationSecond;case xy.MILLISECOND:return vb.DurationMillisecond;case xy.MICROSECOND:return vb.DurationMicrosecond;case xy.NANOSECOND:return vb.DurationNanosecond}return vb.Duration;case vb.Map:return vb.Map;case vb.List:return vb.List;case vb.Struct:return vb.Struct;case vb.Union:switch(e.mode){case my.Dense:return vb.DenseUnion;case my.Sparse:return vb.SparseUnion}return vb.Union;case vb.FixedSizeBinary:return vb.FixedSizeBinary;case vb.FixedSizeList:return vb.FixedSizeList;case vb.Dictionary:return vb.Dictionary}throw new Error(`Unrecognized type '${vb[e.typeId]}'`)}Uv.prototype.visitInt8=null,Uv.prototype.visitInt16=null,Uv.prototype.visitInt32=null,Uv.prototype.visitInt64=null,Uv.prototype.visitUint8=null,Uv.prototype.visitUint16=null,Uv.prototype.visitUint32=null,Uv.prototype.visitUint64=null,Uv.prototype.visitFloat16=null,Uv.prototype.visitFloat32=null,Uv.prototype.visitFloat64=null,Uv.prototype.visitDateDay=null,Uv.prototype.visitDateMillisecond=null,Uv.prototype.visitTimestampSecond=null,Uv.prototype.visitTimestampMillisecond=null,Uv.prototype.visitTimestampMicrosecond=null,Uv.prototype.visitTimestampNanosecond=null,Uv.prototype.visitTimeSecond=null,Uv.prototype.visitTimeMillisecond=null,Uv.prototype.visitTimeMicrosecond=null,Uv.prototype.visitTimeNanosecond=null,Uv.prototype.visitDenseUnion=null,Uv.prototype.visitSparseUnion=null,Uv.prototype.visitIntervalDayTime=null,Uv.prototype.visitIntervalYearMonth=null,Uv.prototype.visitDuration=null,Uv.prototype.visitDurationSecond=null,Uv.prototype.visitDurationMillisecond=null,Uv.prototype.visitDurationMicrosecond=null,Uv.prototype.visitDurationNanosecond=null;const Hv=new Float64Array(1),Gv=new Uint32Array(Hv.buffer);function Wv(e){const t=(31744&e)>>10,n=(1023&e)/1024,i=Math.pow(-1,(32768&e)>>15);switch(t){case 31:return i*(n?Number.NaN:1/0);case 0:return i*(n?6103515625e-14*n:0)}return i*Math.pow(2,t-15)*(1+n)}function jv(e){if(e!=e)return 32256;Hv[0]=e;const t=(2147483648&Gv[1])>>16&65535;let n=2146435072&Gv[1],i=0;return n>=1089470464?Gv[0]>0?n=31744:(n=(2080374784&n)>>16,i=(1048575&Gv[1])>>10):n<=1056964608?(i=1048576+(1048575&Gv[1]),i=1048576+(i<<(n>>20)-998)>>21,n=0):(n=n-1056964608>>10,i=512+(1048575&Gv[1])>>10),t|n|65535&i}class Yv extends Uv{}function qv(e){return(t,n,i)=>{if(t.setValid(n,null!=i))return e(t,n,i)}}const Xv=(e,t,n,i)=>{if(n+1<t.length){const o=Eb(t[n]),r=Eb(t[n+1]);e.set(i.subarray(0,r-o),o)}},Kv=({values:e},t,n)=>{e[t]=n},Zv=({values:e},t,n)=>{e[t]=n},Qv=({values:e},t,n)=>{e[t]=jv(n)},Jv=({values:e},t,n)=>{((e,t,n)=>{e[t]=Math.floor(n/864e5)})(e,t,n.valueOf())},ex=({values:e},t,n)=>{e[t]=BigInt(n)},tx=({stride:e,values:t},n,i)=>{t.set(i.subarray(0,e),e*n)},nx=({values:e,valueOffsets:t},n,i)=>Xv(e,t,n,i),ix=({values:e,valueOffsets:t},n,i)=>Xv(e,t,n,Fg(i)),ox=(e,t,n)=>{e.type.unit===by.DAY?Jv(e,t,n):ex(e,t,n)},rx=({values:e},t,n)=>{e[t]=BigInt(n/1e3)},sx=({values:e},t,n)=>{e[t]=BigInt(n)},ax=({values:e},t,n)=>{e[t]=BigInt(1e3*n)},lx=({values:e},t,n)=>{e[t]=BigInt(1e6*n)},cx=(e,t,n)=>{switch(e.type.unit){case xy.SECOND:return rx(e,t,n);case xy.MILLISECOND:return sx(e,t,n);case xy.MICROSECOND:return ax(e,t,n);case xy.NANOSECOND:return lx(e,t,n)}},ux=({values:e},t,n)=>{e[t]=n},hx=({values:e},t,n)=>{e[t]=n},dx=({values:e},t,n)=>{e[t]=n},px=({values:e},t,n)=>{e[t]=n},fx=(e,t,n)=>{switch(e.type.unit){case xy.SECOND:return ux(e,t,n);case xy.MILLISECOND:return hx(e,t,n);case xy.MICROSECOND:return dx(e,t,n);case xy.NANOSECOND:return px(e,t,n)}},mx=({values:e,stride:t},n,i)=>{e.set(i.subarray(0,t),t*n)},_x=(e,t,n)=>{const i=e.type.typeIdToChildIndex[e.typeIds[t]],o=e.children[i];Cx.visit(o,e.valueOffsets[t],n)},gx=(e,t,n)=>{const i=e.type.typeIdToChildIndex[e.typeIds[t]],o=e.children[i];Cx.visit(o,t,n)},yx=(e,t,n)=>{e.type.unit===Sy.DAY_TIME?bx(e,t,n):vx(e,t,n)},bx=({values:e},t,n)=>{e.set(n.subarray(0,2),2*t)},vx=({values:e},t,n)=>{e[t]=12*n[0]+n[1]%12},xx=({values:e},t,n)=>{e[t]=n},wx=({values:e},t,n)=>{e[t]=n},Sx=({values:e},t,n)=>{e[t]=n},Ex=({values:e},t,n)=>{e[t]=n},Tx=(e,t,n)=>{switch(e.type.unit){case xy.SECOND:return xx(e,t,n);case xy.MILLISECOND:return wx(e,t,n);case xy.MICROSECOND:return Sx(e,t,n);case xy.NANOSECOND:return Ex(e,t,n)}};Yv.prototype.visitBool=qv(({offset:e,values:t},n,i)=>{const o=e+n;i?t[o>>3]|=1<<o%8:t[o>>3]&=~(1<<o%8)}),Yv.prototype.visitInt=qv(Kv),Yv.prototype.visitInt8=qv(Kv),Yv.prototype.visitInt16=qv(Kv),Yv.prototype.visitInt32=qv(Kv),Yv.prototype.visitInt64=qv(Kv),Yv.prototype.visitUint8=qv(Kv),Yv.prototype.visitUint16=qv(Kv),Yv.prototype.visitUint32=qv(Kv),Yv.prototype.visitUint64=qv(Kv),Yv.prototype.visitFloat=qv((e,t,n)=>{switch(e.type.precision){case gy.HALF:return Qv(e,t,n);case gy.SINGLE:case gy.DOUBLE:return Zv(e,t,n)}}),Yv.prototype.visitFloat16=qv(Qv),Yv.prototype.visitFloat32=qv(Zv),Yv.prototype.visitFloat64=qv(Zv),Yv.prototype.visitUtf8=qv(ix),Yv.prototype.visitLargeUtf8=qv(ix),Yv.prototype.visitBinary=qv(nx),Yv.prototype.visitLargeBinary=qv(nx),Yv.prototype.visitFixedSizeBinary=qv(tx),Yv.prototype.visitDate=qv(ox),Yv.prototype.visitDateDay=qv(Jv),Yv.prototype.visitDateMillisecond=qv(ex),Yv.prototype.visitTimestamp=qv(cx),Yv.prototype.visitTimestampSecond=qv(rx),Yv.prototype.visitTimestampMillisecond=qv(sx),Yv.prototype.visitTimestampMicrosecond=qv(ax),Yv.prototype.visitTimestampNanosecond=qv(lx),Yv.prototype.visitTime=qv(fx),Yv.prototype.visitTimeSecond=qv(ux),Yv.prototype.visitTimeMillisecond=qv(hx),Yv.prototype.visitTimeMicrosecond=qv(dx),Yv.prototype.visitTimeNanosecond=qv(px),Yv.prototype.visitDecimal=qv(mx),Yv.prototype.visitList=qv((e,t,n)=>{const i=e.children[0],o=e.valueOffsets,r=Cx.getVisitFn(i);if(Array.isArray(n))for(let s=-1,a=o[t],l=o[t+1];a<l;)r(i,a++,n[++s]);else for(let s=-1,a=o[t],l=o[t+1];a<l;)r(i,a++,n.get(++s))}),Yv.prototype.visitStruct=qv((e,t,n)=>{const i=e.type.children.map(e=>Cx.getVisitFn(e.type)),o=n instanceof Map?(r=t,s=n,(e,t,n,i)=>t&&e(t,r,s.get(n.name))):n instanceof Xw?((e,t)=>(n,i,o,r)=>i&&n(i,e,t.get(r)))(t,n):Array.isArray(n)?((e,t)=>(n,i,o,r)=>i&&n(i,e,t[r]))(t,n):((e,t)=>(n,i,o,r)=>i&&n(i,e,t[o.name]))(t,n);var r,s;e.type.children.forEach((t,n)=>o(i[n],e.children[n],t,n))}),Yv.prototype.visitUnion=qv((e,t,n)=>{e.type.mode===my.Dense?_x(e,t,n):gx(e,t,n)}),Yv.prototype.visitDenseUnion=qv(_x),Yv.prototype.visitSparseUnion=qv(gx),Yv.prototype.visitDictionary=qv((e,t,n)=>{var i;null===(i=e.dictionary)||void 0===i||i.set(e.values[t],n)}),Yv.prototype.visitInterval=qv(yx),Yv.prototype.visitIntervalDayTime=qv(bx),Yv.prototype.visitIntervalYearMonth=qv(vx),Yv.prototype.visitDuration=qv(Tx),Yv.prototype.visitDurationSecond=qv(xx),Yv.prototype.visitDurationMillisecond=qv(wx),Yv.prototype.visitDurationMicrosecond=qv(Sx),Yv.prototype.visitDurationNanosecond=qv(Ex),Yv.prototype.visitFixedSizeList=qv((e,t,n)=>{const{stride:i}=e,o=e.children[0],r=Cx.getVisitFn(o);if(Array.isArray(n))for(let s=-1,a=t*i;++s<i;)r(o,a+s,n[s]);else for(let s=-1,a=t*i;++s<i;)r(o,a+s,n.get(s))}),Yv.prototype.visitMap=qv((e,t,n)=>{const i=e.children[0],{valueOffsets:o}=e,r=Cx.getVisitFn(i);let{[t]:s,[t+1]:a}=o;const l=n instanceof Map?n.entries():Object.entries(n);for(const c of l)if(r(i,s,c),++s>=a)break});const Cx=new Yv,Ix=Symbol.for("parent"),Ax=Symbol.for("rowIndex");class kx{constructor(e,t){return this[Ix]=e,this[Ax]=t,new Proxy(this,new Rx)}toArray(){return Object.values(this.toJSON())}toJSON(){const e=this[Ax],t=this[Ix],n=t.type.children,i={};for(let o=-1,r=n.length;++o<r;)i[n[o].name]=iw.visit(t.children[o],e);return i}toString(){return`{${[...this].map(([e,t])=>`${Sb(e)}: ${Sb(t)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}[Symbol.iterator](){return new Lx(this[Ix],this[Ax])}}class Lx{constructor(e,t){this.childIndex=0,this.children=e.children,this.rowIndex=t,this.childFields=e.type.children,this.numChildren=this.childFields.length}[Symbol.iterator](){return this}next(){const e=this.childIndex;return e<this.numChildren?(this.childIndex=e+1,{done:!1,value:[this.childFields[e].name,iw.visit(this.children[e],this.rowIndex)]}):{done:!0,value:null}}}Object.defineProperties(kx.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[Ix]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Ax]:{writable:!0,enumerable:!1,configurable:!1,value:-1}});class Rx{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(e){return e[Ix].type.children.map(e=>e.name)}has(e,t){return-1!==e[Ix].type.children.findIndex(e=>e.name===t)}getOwnPropertyDescriptor(e,t){if(-1!==e[Ix].type.children.findIndex(e=>e.name===t))return{writable:!0,enumerable:!0,configurable:!0}}get(e,t){if(Reflect.has(e,t))return e[t];const n=e[Ix].type.children.findIndex(e=>e.name===t);if(-1!==n){const i=iw.visit(e[Ix].children[n],e[Ax]);return Reflect.set(e,t,i),i}}set(e,t,n){const i=e[Ix].type.children.findIndex(e=>e.name===t);return-1!==i?(Cx.visit(e[Ix].children[i],e[Ax],n),Reflect.set(e,t,n)):!(!Reflect.has(e,t)&&"symbol"!=typeof t)&&Reflect.set(e,t,n)}}class Px extends Uv{}function Dx(e){return(t,n)=>t.getValid(n)?e(t,n):null}const Mx=(e,t,n)=>{if(n+1>=t.length)return null;const i=Eb(t[n]),o=Eb(t[n+1]);return e.subarray(i,o)},Nx=({values:e},t)=>((e,t)=>864e5*e[t])(e,t),Ox=({values:e},t)=>Eb(e[t]),Bx=({stride:e,values:t},n)=>t[e*n],Fx=({values:e},t)=>e[t],zx=({values:e,valueOffsets:t},n)=>Mx(e,t,n),Ux=({values:e,valueOffsets:t},n)=>{const i=Mx(e,t,n);return null!==i?Og(i):null},$x=({values:e},t)=>1e3*Eb(e[t]),Vx=({values:e},t)=>Eb(e[t]),Hx=({values:e},t)=>Tb(e[t],BigInt(1e3)),Gx=({values:e},t)=>Tb(e[t],BigInt(1e6)),Wx=({values:e},t)=>e[t],jx=({values:e},t)=>e[t],Yx=({values:e},t)=>e[t],qx=({values:e},t)=>e[t],Xx=(e,t)=>{const n=e.type.typeIdToChildIndex[e.typeIds[t]],i=e.children[n];return iw.visit(i,e.valueOffsets[t])},Kx=(e,t)=>{const n=e.type.typeIdToChildIndex[e.typeIds[t]],i=e.children[n];return iw.visit(i,t)},Zx=({values:e},t)=>e.subarray(2*t,2*(t+1)),Qx=({values:e},t)=>{const n=e[t],i=new Int32Array(2);return i[0]=Math.trunc(n/12),i[1]=Math.trunc(n%12),i},Jx=({values:e},t)=>e[t],ew=({values:e},t)=>e[t],tw=({values:e},t)=>e[t],nw=({values:e},t)=>e[t];Px.prototype.visitNull=Dx((e,t)=>null),Px.prototype.visitBool=Dx(({offset:e,values:t},n)=>{const i=e+n;return!!(t[i>>3]&1<<i%8)}),Px.prototype.visitInt=Dx(({values:e},t)=>e[t]),Px.prototype.visitInt8=Dx(Bx),Px.prototype.visitInt16=Dx(Bx),Px.prototype.visitInt32=Dx(Bx),Px.prototype.visitInt64=Dx(Fx),Px.prototype.visitUint8=Dx(Bx),Px.prototype.visitUint16=Dx(Bx),Px.prototype.visitUint32=Dx(Bx),Px.prototype.visitUint64=Dx(Fx),Px.prototype.visitFloat=Dx(({type:e,values:t},n)=>e.precision!==gy.HALF?t[n]:Wv(t[n])),Px.prototype.visitFloat16=Dx(({stride:e,values:t},n)=>Wv(t[e*n])),Px.prototype.visitFloat32=Dx(Bx),Px.prototype.visitFloat64=Dx(Bx),Px.prototype.visitUtf8=Dx(Ux),Px.prototype.visitLargeUtf8=Dx(Ux),Px.prototype.visitBinary=Dx(zx),Px.prototype.visitLargeBinary=Dx(zx),Px.prototype.visitFixedSizeBinary=Dx(({stride:e,values:t},n)=>t.subarray(e*n,e*(n+1))),Px.prototype.visitDate=Dx((e,t)=>e.type.unit===by.DAY?Nx(e,t):Ox(e,t)),Px.prototype.visitDateDay=Dx(Nx),Px.prototype.visitDateMillisecond=Dx(Ox),Px.prototype.visitTimestamp=Dx((e,t)=>{switch(e.type.unit){case xy.SECOND:return $x(e,t);case xy.MILLISECOND:return Vx(e,t);case xy.MICROSECOND:return Hx(e,t);case xy.NANOSECOND:return Gx(e,t)}}),Px.prototype.visitTimestampSecond=Dx($x),Px.prototype.visitTimestampMillisecond=Dx(Vx),Px.prototype.visitTimestampMicrosecond=Dx(Hx),Px.prototype.visitTimestampNanosecond=Dx(Gx),Px.prototype.visitTime=Dx((e,t)=>{switch(e.type.unit){case xy.SECOND:return Wx(e,t);case xy.MILLISECOND:return jx(e,t);case xy.MICROSECOND:return Yx(e,t);case xy.NANOSECOND:return qx(e,t)}}),Px.prototype.visitTimeSecond=Dx(Wx),Px.prototype.visitTimeMillisecond=Dx(jx),Px.prototype.visitTimeMicrosecond=Dx(Yx),Px.prototype.visitTimeNanosecond=Dx(qx),Px.prototype.visitDecimal=Dx(({values:e,stride:t},n)=>Nb.decimal(e.subarray(t*n,t*(n+1)))),Px.prototype.visitList=Dx((e,t)=>{const{valueOffsets:n,stride:i,children:o}=e,{[t*i]:r,[t*i+1]:s}=n,a=o[0].slice(r,s-r);return new Xw([a])}),Px.prototype.visitStruct=Dx((e,t)=>new kx(e,t)),Px.prototype.visitUnion=Dx((e,t)=>e.type.mode===my.Dense?Xx(e,t):Kx(e,t)),Px.prototype.visitDenseUnion=Dx(Xx),Px.prototype.visitSparseUnion=Dx(Kx),Px.prototype.visitDictionary=Dx((e,t)=>{var n;return null===(n=e.dictionary)||void 0===n?void 0:n.get(e.values[t])}),Px.prototype.visitInterval=Dx((e,t)=>e.type.unit===Sy.DAY_TIME?Zx(e,t):Qx(e,t)),Px.prototype.visitIntervalDayTime=Dx(Zx),Px.prototype.visitIntervalYearMonth=Dx(Qx),Px.prototype.visitDuration=Dx((e,t)=>{switch(e.type.unit){case xy.SECOND:return Jx(e,t);case xy.MILLISECOND:return ew(e,t);case xy.MICROSECOND:return tw(e,t);case xy.NANOSECOND:return nw(e,t)}}),Px.prototype.visitDurationSecond=Dx(Jx),Px.prototype.visitDurationMillisecond=Dx(ew),Px.prototype.visitDurationMicrosecond=Dx(tw),Px.prototype.visitDurationNanosecond=Dx(nw),Px.prototype.visitFixedSizeList=Dx((e,t)=>{const{stride:n,children:i}=e,o=i[0].slice(t*n,n);return new Xw([o])}),Px.prototype.visitMap=Dx((e,t)=>{const{valueOffsets:n,children:i}=e,{[t]:o,[t+1]:r}=n,s=i[0];return new lw(s.slice(o,r-o))});const iw=new Px,ow=Symbol.for("keys"),rw=Symbol.for("vals"),sw=Symbol.for("kKeysAsStrings"),aw=Symbol.for("_kKeysAsStrings");class lw{constructor(e){return this[ow]=new Xw([e.children[0]]).memoize(),this[rw]=e.children[1],new Proxy(this,new uw)}get[sw](){return this[aw]||(this[aw]=Array.from(this[ow].toArray(),String))}[Symbol.iterator](){return new cw(this[ow],this[rw])}get size(){return this[ow].length}toArray(){return Object.values(this.toJSON())}toJSON(){const e=this[ow],t=this[rw],n={};for(let i=-1,o=e.length;++i<o;)n[e.get(i)]=iw.visit(t,i);return n}toString(){return`{${[...this].map(([e,t])=>`${Sb(e)}: ${Sb(t)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}}class cw{constructor(e,t){this.keys=e,this.vals=t,this.keyIndex=0,this.numKeys=e.length}[Symbol.iterator](){return this}next(){const e=this.keyIndex;return e===this.numKeys?{done:!0,value:null}:(this.keyIndex++,{done:!1,value:[this.keys.get(e),iw.visit(this.vals,e)]})}}class uw{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(e){return e[sw]}has(e,t){return e[sw].includes(t)}getOwnPropertyDescriptor(e,t){if(-1!==e[sw].indexOf(t))return{writable:!0,enumerable:!0,configurable:!0}}get(e,t){if(Reflect.has(e,t))return e[t];const n=e[sw].indexOf(t);if(-1!==n){const i=iw.visit(Reflect.get(e,rw),n);return Reflect.set(e,t,i),i}}set(e,t,n){const i=e[sw].indexOf(t);return-1!==i?(Cx.visit(Reflect.get(e,rw),i,n),Reflect.set(e,t,n)):!!Reflect.has(e,t)&&Reflect.set(e,t,n)}}let hw;function dw(e,t,n,i){const{length:o=0}=e;let r="number"!=typeof t?0:t,s="number"!=typeof n?o:n;return r<0&&(r=(r%o+o)%o),s<0&&(s=(s%o+o)%o),s<r&&(hw=r,r=s,s=hw),s>o&&(s=o),i?i(e,r,s):[r,s]}Object.defineProperties(lw.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[ow]:{writable:!0,enumerable:!1,configurable:!1,value:null},[rw]:{writable:!0,enumerable:!1,configurable:!1,value:null},[aw]:{writable:!0,enumerable:!1,configurable:!1,value:null}});const pw=(e,t)=>e<0?t+e:e,fw=e=>e!=e;function mw(e){if("object"!=typeof e||null===e)return fw(e)?fw:t=>t===e;if(e instanceof Date){const t=e.valueOf();return e=>e instanceof Date&&e.valueOf()===t}return ArrayBuffer.isView(e)?t=>!!t&&function(e,t){let n=0;const i=e.length;if(i!==t.length)return!1;if(i>0)do{if(e[n]!==t[n])return!1}while(++n<i);return!0}(e,t):e instanceof Map?function(e){let t=-1;const n=[];for(const i of e.values())n[++t]=mw(i);return _w(n)}(e):Array.isArray(e)?function(e){const t=[];for(let n=-1,i=e.length;++n<i;)t[n]=mw(e[n]);return _w(t)}(e):e instanceof Xw?function(e){const t=[];for(let n=-1,i=e.length;++n<i;)t[n]=mw(e.get(n));return _w(t)}(e):function(e,t=!1){const n=Object.keys(e);if(!t&&0===n.length)return()=>!1;const i=[];for(let o=-1,r=n.length;++o<r;)i[o]=mw(e[n[o]]);return _w(i,n)}(e,!0)}function _w(e,t){return n=>{if(!n||"object"!=typeof n)return!1;switch(n.constructor){case Array:return function(e,t){const n=e.length;if(t.length!==n)return!1;for(let i=-1;++i<n;)if(!e[i](t[i]))return!1;return!0}(e,n);case Map:return gw(e,n,n.keys());case lw:case kx:case Object:case void 0:return gw(e,n,t||Object.keys(n))}return n instanceof Xw&&function(e,t){const n=e.length;if(t.length!==n)return!1;for(let i=-1;++i<n;)if(!e[i](t.get(i)))return!1;return!0}(e,n)}}function gw(e,t,n){const i=n[Symbol.iterator](),o=t instanceof Map?t.keys():Object.keys(t)[Symbol.iterator](),r=t instanceof Map?t.values():Object.values(t)[Symbol.iterator]();let s=0;const a=e.length;let l=r.next(),c=i.next(),u=o.next();for(;s<a&&!c.done&&!u.done&&!l.done&&c.value===u.value&&e[s](l.value);++s,c=i.next(),u=o.next(),l=r.next());return!!(s===a&&c.done&&u.done&&l.done)||(i.return&&i.return(),o.return&&o.return(),r.return&&r.return(),!1)}function yw(e,t,n,i){return!!(n&1<<i)}function bw(e,t,n,i){return(n&1<<i)>>i}function vw(e,t,n){const i=n.byteLength+7&-8;if(e>0||n.byteLength<i){const o=new Uint8Array(i);return o.set(e%8==0?n.subarray(e>>3):xw(new ww(n,e,t,null,yw)).subarray(0,i)),o}return n}function xw(e){const t=[];let n=0,i=0,o=0;for(const s of e)s&&(o|=1<<i),8===++i&&(t[n++]=o,o=i=0);(0===n||i>0)&&(t[n++]=o);const r=new Uint8Array(t.length+7&-8);return r.set(t),r}class ww{constructor(e,t,n,i,o){this.bytes=e,this.length=n,this.context=i,this.get=o,this.bit=t%8,this.byteIndex=t>>3,this.byte=e[this.byteIndex++],this.index=0}next(){return this.index<this.length?(8===this.bit&&(this.bit=0,this.byte=this.bytes[this.byteIndex++]),{value:this.get(this.context,this.index++,this.byte,this.bit++)}):{done:!0,value:null}}[Symbol.iterator](){return this}}function Sw(e,t,n){if(n-t<=0)return 0;if(n-t<8){let i=0;for(const o of new ww(e,t,n-t,e,bw))i+=o;return i}const i=n>>3<<3,o=t+(t%8==0?0:8-t%8);return Sw(e,t,o)+Sw(e,i,n)+function(e,t,n){let i=0,o=Math.trunc(t);const r=new DataView(e.buffer,e.byteOffset,e.byteLength),s=void 0===n?e.byteLength:o+n;for(;s-o>=4;)i+=Ew(r.getUint32(o)),o+=4;for(;s-o>=2;)i+=Ew(r.getUint16(o)),o+=2;for(;s-o>=1;)i+=Ew(r.getUint8(o)),o+=1;return i}(e,o>>3,i-o>>3)}function Ew(e){let t=Math.trunc(e);return t-=t>>>1&1431655765,t=(858993459&t)+(t>>>2&858993459),16843009*(t+(t>>>4)&252645135)>>>24}class Tw{get typeId(){return this.type.typeId}get ArrayType(){return this.type.ArrayType}get buffers(){return[this.valueOffsets,this.values,this.nullBitmap,this.typeIds]}get nullable(){if(0!==this._nullCount){const{type:e}=this;return rv.isSparseUnion(e)||rv.isDenseUnion(e)?this.children.some(e=>e.nullable):this.nullBitmap&&this.nullBitmap.byteLength>0}return!0}get byteLength(){let e=0;const{valueOffsets:t,values:n,nullBitmap:i,typeIds:o}=this;return t&&(e+=t.byteLength),n&&(e+=n.byteLength),i&&(e+=i.byteLength),o&&(e+=o.byteLength),this.children.reduce((e,t)=>e+t.byteLength,e)}get nullCount(){if(rv.isUnion(this.type))return this.children.reduce((e,t)=>e+t.nullCount,0);let e,t=this._nullCount;return t<=-1&&(e=this.nullBitmap)&&(this._nullCount=t=0===e.length?0:this.length-Sw(e,this.offset,this.offset+this.length)),t}constructor(e,t,n,i,o,r=[],s){let a;this.type=e,this.children=r,this.dictionary=s,this.offset=Math.floor(Math.max(t||0,0)),this.length=Math.floor(Math.max(n||0,0)),this._nullCount=Math.floor(Math.max(i||0,-1)),o instanceof Tw?(this.stride=o.stride,this.values=o.values,this.typeIds=o.typeIds,this.nullBitmap=o.nullBitmap,this.valueOffsets=o.valueOffsets):(this.stride=zv(e),o&&((a=o[0])&&(this.valueOffsets=a),(a=o[1])&&(this.values=a),(a=o[2])&&(this.nullBitmap=a),(a=o[3])&&(this.typeIds=a)))}getValid(e){const{type:t}=this;if(rv.isUnion(t)){const n=t,i=this.children[n.typeIdToChildIndex[this.typeIds[e]]],o=n.mode===my.Dense?this.valueOffsets[e]:e;return i.getValid(o)}if(this.nullable&&this.nullCount>0){const t=this.offset+e;return!!(this.nullBitmap[t>>3]&1<<t%8)}return!0}setValid(e,t){let n;const{type:i}=this;if(rv.isUnion(i)){const o=i,r=this.children[o.typeIdToChildIndex[this.typeIds[e]]],s=o.mode===my.Dense?this.valueOffsets[e]:e;n=r.getValid(s),r.setValid(s,t)}else{let{nullBitmap:i}=this;const{offset:o,length:r}=this,s=o+e,a=1<<s%8,l=s>>3;(!i||i.byteLength<=l)&&(i=new Uint8Array((o+r+63&-64)>>3).fill(255),this.nullCount>0?(i.set(vw(o,r,this.nullBitmap),0),Object.assign(this,{nullBitmap:i})):Object.assign(this,{nullBitmap:i,_nullCount:0}));const c=i[l];n=0!==(c&a),i[l]=t?c|a:c&~a}return n!==!!t&&(this._nullCount=this.nullCount+(t?-1:1)),t}clone(e=this.type,t=this.offset,n=this.length,i=this._nullCount,o=this,r=this.children){return new Tw(e,t,n,i,o,r,this.dictionary)}slice(e,t){const{stride:n,typeId:i,children:o}=this,r=+(0===this._nullCount)-1,s=16===i?n:1,a=this._sliceBuffers(e,t,n,i);return this.clone(this.type,this.offset+e,t,r,a,0===o.length||this.valueOffsets?o:this._sliceChildren(o,s*e,s*t))}_changeLengthAndBackfillNullBitmap(e){if(this.typeId===vb.Null)return this.clone(this.type,0,e,0);const{length:t,nullCount:n}=this,i=new Uint8Array((e+63&-64)>>3).fill(255,0,t>>3);i[t>>3]=(1<<t-(-8&t))-1,n>0&&i.set(vw(this.offset,t,this.nullBitmap),0);const o=this.buffers;return o[xb.VALIDITY]=i,this.clone(this.type,0,e,n+(e-t),o)}_sliceBuffers(e,t,n,i){let o;const{buffers:r}=this;return(o=r[xb.TYPE])&&(r[xb.TYPE]=o.subarray(e,e+t)),(o=r[xb.OFFSET])&&(r[xb.OFFSET]=o.subarray(e,e+t+1))||(o=r[xb.DATA])&&(r[xb.DATA]=6===i?o:o.subarray(n*e,n*(e+t))),r}_sliceChildren(e,t,n){return e.map(e=>e.slice(t,n))}}Tw.prototype.children=Object.freeze([]);class Cw extends Uv{visit(e){return this.getVisitFn(e.type).call(this,e)}visitNull(e){const{type:t,offset:n=0,length:i=0}=e;return new Tw(t,n,i,i)}visitBool(e){const{type:t,offset:n=0}=e,i=oy(e.nullBitmap),o=ty(t.ArrayType,e.data),{length:r=o.length>>3,nullCount:s=(e.nullBitmap?-1:0)}=e;return new Tw(t,n,r,s,[void 0,o,i])}visitInt(e){const{type:t,offset:n=0}=e,i=oy(e.nullBitmap),o=ty(t.ArrayType,e.data),{length:r=o.length,nullCount:s=(e.nullBitmap?-1:0)}=e;return new Tw(t,n,r,s,[void 0,o,i])}visitFloat(e){const{type:t,offset:n=0}=e,i=oy(e.nullBitmap),o=ty(t.ArrayType,e.data),{length:r=o.length,nullCount:s=(e.nullBitmap?-1:0)}=e;return new Tw(t,n,r,s,[void 0,o,i])}visitUtf8(e){const{type:t,offset:n=0}=e,i=oy(e.data),o=oy(e.nullBitmap),r=ny(e.valueOffsets),{length:s=r.length-1,nullCount:a=(e.nullBitmap?-1:0)}=e;return new Tw(t,n,s,a,[r,i,o])}visitLargeUtf8(e){const{type:t,offset:n=0}=e,i=oy(e.data),o=oy(e.nullBitmap),r=iy(e.valueOffsets),{length:s=r.length-1,nullCount:a=(e.nullBitmap?-1:0)}=e;return new Tw(t,n,s,a,[r,i,o])}visitBinary(e){const{type:t,offset:n=0}=e,i=oy(e.data),o=oy(e.nullBitmap),r=ny(e.valueOffsets),{length:s=r.length-1,nullCount:a=(e.nullBitmap?-1:0)}=e;return new Tw(t,n,s,a,[r,i,o])}visitLargeBinary(e){const{type:t,offset:n=0}=e,i=oy(e.data),o=oy(e.nullBitmap),r=iy(e.valueOffsets),{length:s=r.length-1,nullCount:a=(e.nullBitmap?-1:0)}=e;return new Tw(t,n,s,a,[r,i,o])}visitFixedSizeBinary(e){const{type:t,offset:n=0}=e,i=oy(e.nullBitmap),o=ty(t.ArrayType,e.data),{length:r=o.length/zv(t),nullCount:s=(e.nullBitmap?-1:0)}=e;return new Tw(t,n,r,s,[void 0,o,i])}visitDate(e){const{type:t,offset:n=0}=e,i=oy(e.nullBitmap),o=ty(t.ArrayType,e.data),{length:r=o.length/zv(t),nullCount:s=(e.nullBitmap?-1:0)}=e;return new Tw(t,n,r,s,[void 0,o,i])}visitTimestamp(e){const{type:t,offset:n=0}=e,i=oy(e.nullBitmap),o=ty(t.ArrayType,e.data),{length:r=o.length/zv(t),nullCount:s=(e.nullBitmap?-1:0)}=e;return new Tw(t,n,r,s,[void 0,o,i])}visitTime(e){const{type:t,offset:n=0}=e,i=oy(e.nullBitmap),o=ty(t.ArrayType,e.data),{length:r=o.length/zv(t),nullCount:s=(e.nullBitmap?-1:0)}=e;return new Tw(t,n,r,s,[void 0,o,i])}visitDecimal(e){const{type:t,offset:n=0}=e,i=oy(e.nullBitmap),o=ty(t.ArrayType,e.data),{length:r=o.length/zv(t),nullCount:s=(e.nullBitmap?-1:0)}=e;return new Tw(t,n,r,s,[void 0,o,i])}visitList(e){const{type:t,offset:n=0,child:i}=e,o=oy(e.nullBitmap),r=ny(e.valueOffsets),{length:s=r.length-1,nullCount:a=(e.nullBitmap?-1:0)}=e;return new Tw(t,n,s,a,[r,void 0,o],[i])}visitStruct(e){const{type:t,offset:n=0,children:i=[]}=e,o=oy(e.nullBitmap),{length:r=i.reduce((e,{length:t})=>Math.max(e,t),0),nullCount:s=(e.nullBitmap?-1:0)}=e;return new Tw(t,n,r,s,[void 0,void 0,o],i)}visitUnion(e){const{type:t,offset:n=0,children:i=[]}=e,o=ty(t.ArrayType,e.typeIds),{length:r=o.length,nullCount:s=-1}=e;if(rv.isSparseUnion(t))return new Tw(t,n,r,s,[void 0,void 0,void 0,o],i);const a=ny(e.valueOffsets);return new Tw(t,n,r,s,[a,void 0,void 0,o],i)}visitDictionary(e){const{type:t,offset:n=0}=e,i=oy(e.nullBitmap),o=ty(t.indices.ArrayType,e.data),{dictionary:r=new Xw([(new Cw).visit({type:t.dictionary})])}=e,{length:s=o.length,nullCount:a=(e.nullBitmap?-1:0)}=e;return new Tw(t,n,s,a,[void 0,o,i],[],r)}visitInterval(e){const{type:t,offset:n=0}=e,i=oy(e.nullBitmap),o=ty(t.ArrayType,e.data),{length:r=o.length/zv(t),nullCount:s=(e.nullBitmap?-1:0)}=e;return new Tw(t,n,r,s,[void 0,o,i])}visitDuration(e){const{type:t,offset:n=0}=e,i=oy(e.nullBitmap),o=ty(t.ArrayType,e.data),{length:r=o.length,nullCount:s=(e.nullBitmap?-1:0)}=e;return new Tw(t,n,r,s,[void 0,o,i])}visitFixedSizeList(e){const{type:t,offset:n=0,child:i=(new Cw).visit({type:t.valueType})}=e,o=oy(e.nullBitmap),{length:r=i.length/zv(t),nullCount:s=(e.nullBitmap?-1:0)}=e;return new Tw(t,n,r,s,[void 0,void 0,o],[i])}visitMap(e){const{type:t,offset:n=0,child:i=(new Cw).visit({type:t.childType})}=e,o=oy(e.nullBitmap),r=ny(e.valueOffsets),{length:s=r.length-1,nullCount:a=(e.nullBitmap?-1:0)}=e;return new Tw(t,n,s,a,[r,void 0,o],[i])}}const Iw=new Cw;function Aw(e){return Iw.visit(e)}class kw{constructor(e=0,t){this.numChunks=e,this.getChunkIterator=t,this.chunkIndex=0,this.chunkIterator=this.getChunkIterator(0)}next(){for(;this.chunkIndex<this.numChunks;){const e=this.chunkIterator.next();if(!e.done)return e;++this.chunkIndex<this.numChunks&&(this.chunkIterator=this.getChunkIterator(this.chunkIndex))}return{done:!0,value:null}}[Symbol.iterator](){return this}}function Lw(e){return e.reduce((e,t)=>e+t.nullCount,0)}function Rw(e){return e.reduce((e,t,n)=>(e[n+1]=e[n]+t.length,e),new Uint32Array(e.length+1))}function Pw(e,t,n,i){const o=[];for(let r=-1,s=e.length;++r<s;){const s=e[r],a=t[r],{length:l}=s;if(a>=i)break;if(n>=a+l)continue;if(a>=n&&a+l<=i){o.push(s);continue}const c=Math.max(0,n-a),u=Math.min(i-a,l);o.push(s.slice(c,u-c))}return 0===o.length&&o.push(e[0].slice(0,0)),o}function Dw(e,t,n,i){let o=0,r=0,s=t.length-1;do{if(o>=s-1)return n<t[s]?i(e,o,n-t[o]):null;r=o+Math.trunc(.5*(s-o)),n<t[r]?s=r:o=r}while(o<s)}function Mw(e,t){return e.getValid(t)}function Nw(e){function t(t,n,i){return e(t[n],i)}return function(e){return Dw(this.data,this._offsets,e,t)}}function Ow(e){let t;function n(n,i,o){return e(n[i],o,t)}return function(e,i){const o=this.data;t=i;const r=Dw(o,this._offsets,e,n);return t=void 0,r}}function Bw(e){let t;function n(n,i,o){let r=o,s=0,a=0;for(let l=i-1,c=n.length;++l<c;){const i=n[l];if(~(s=e(i,t,r)))return a+s;r=0,a+=i.length}return-1}return function(e,i){t=e;const o=this.data,r="number"!=typeof i?n(o,0,0):Dw(o,this._offsets,i,n);return t=void 0,r}}class Fw extends Uv{}function zw(e,t,n){if(void 0===t)return-1;if(null===t)switch(e.typeId){case vb.Union:case vb.Dictionary:break;default:return function(e,t){const{nullBitmap:n}=e;if(!n||e.nullCount<=0)return-1;let i=0;for(const o of new ww(n,e.offset+(t||0),e.length,n,yw)){if(!o)return i;++i}return-1}(e,n)}const i=iw.getVisitFn(e),o=mw(t);for(let r=(n||0)-1,s=e.length;++r<s;)if(o(i(e,r)))return r;return-1}function Uw(e,t,n){const i=iw.getVisitFn(e),o=mw(t);for(let r=(n||0)-1,s=e.length;++r<s;)if(o(i(e,r)))return r;return-1}Fw.prototype.visitNull=function(e,t){return null===t&&e.length>0?0:-1},Fw.prototype.visitBool=zw,Fw.prototype.visitInt=zw,Fw.prototype.visitInt8=zw,Fw.prototype.visitInt16=zw,Fw.prototype.visitInt32=zw,Fw.prototype.visitInt64=zw,Fw.prototype.visitUint8=zw,Fw.prototype.visitUint16=zw,Fw.prototype.visitUint32=zw,Fw.prototype.visitUint64=zw,Fw.prototype.visitFloat=zw,Fw.prototype.visitFloat16=zw,Fw.prototype.visitFloat32=zw,Fw.prototype.visitFloat64=zw,Fw.prototype.visitUtf8=zw,Fw.prototype.visitLargeUtf8=zw,Fw.prototype.visitBinary=zw,Fw.prototype.visitLargeBinary=zw,Fw.prototype.visitFixedSizeBinary=zw,Fw.prototype.visitDate=zw,Fw.prototype.visitDateDay=zw,Fw.prototype.visitDateMillisecond=zw,Fw.prototype.visitTimestamp=zw,Fw.prototype.visitTimestampSecond=zw,Fw.prototype.visitTimestampMillisecond=zw,Fw.prototype.visitTimestampMicrosecond=zw,Fw.prototype.visitTimestampNanosecond=zw,Fw.prototype.visitTime=zw,Fw.prototype.visitTimeSecond=zw,Fw.prototype.visitTimeMillisecond=zw,Fw.prototype.visitTimeMicrosecond=zw,Fw.prototype.visitTimeNanosecond=zw,Fw.prototype.visitDecimal=zw,Fw.prototype.visitList=zw,Fw.prototype.visitStruct=zw,Fw.prototype.visitUnion=zw,Fw.prototype.visitDenseUnion=Uw,Fw.prototype.visitSparseUnion=Uw,Fw.prototype.visitDictionary=zw,Fw.prototype.visitInterval=zw,Fw.prototype.visitIntervalDayTime=zw,Fw.prototype.visitIntervalYearMonth=zw,Fw.prototype.visitDuration=zw,Fw.prototype.visitDurationSecond=zw,Fw.prototype.visitDurationMillisecond=zw,Fw.prototype.visitDurationMicrosecond=zw,Fw.prototype.visitDurationNanosecond=zw,Fw.prototype.visitFixedSizeList=zw,Fw.prototype.visitMap=zw;const $w=new Fw;class Vw extends Uv{}function Hw(e){const{type:t}=e;if(0===e.nullCount&&1===e.stride&&(rv.isInt(t)&&64!==t.bitWidth||rv.isTime(t)&&64!==t.bitWidth||rv.isFloat(t)&&t.precision!==gy.HALF))return new kw(e.data.length,t=>{const n=e.data[t];return n.values.subarray(0,n.length)[Symbol.iterator]()});let n=0;return new kw(e.data.length,t=>{const i=e.data[t].length,o=e.slice(n,n+i);return n+=i,new Gw(o)})}class Gw{constructor(e){this.vector=e,this.index=0}next(){return this.index<this.vector.length?{value:this.vector.get(this.index++)}:{done:!0,value:null}}[Symbol.iterator](){return this}}Vw.prototype.visitNull=Hw,Vw.prototype.visitBool=Hw,Vw.prototype.visitInt=Hw,Vw.prototype.visitInt8=Hw,Vw.prototype.visitInt16=Hw,Vw.prototype.visitInt32=Hw,Vw.prototype.visitInt64=Hw,Vw.prototype.visitUint8=Hw,Vw.prototype.visitUint16=Hw,Vw.prototype.visitUint32=Hw,Vw.prototype.visitUint64=Hw,Vw.prototype.visitFloat=Hw,Vw.prototype.visitFloat16=Hw,Vw.prototype.visitFloat32=Hw,Vw.prototype.visitFloat64=Hw,Vw.prototype.visitUtf8=Hw,Vw.prototype.visitLargeUtf8=Hw,Vw.prototype.visitBinary=Hw,Vw.prototype.visitLargeBinary=Hw,Vw.prototype.visitFixedSizeBinary=Hw,Vw.prototype.visitDate=Hw,Vw.prototype.visitDateDay=Hw,Vw.prototype.visitDateMillisecond=Hw,Vw.prototype.visitTimestamp=Hw,Vw.prototype.visitTimestampSecond=Hw,Vw.prototype.visitTimestampMillisecond=Hw,Vw.prototype.visitTimestampMicrosecond=Hw,Vw.prototype.visitTimestampNanosecond=Hw,Vw.prototype.visitTime=Hw,Vw.prototype.visitTimeSecond=Hw,Vw.prototype.visitTimeMillisecond=Hw,Vw.prototype.visitTimeMicrosecond=Hw,Vw.prototype.visitTimeNanosecond=Hw,Vw.prototype.visitDecimal=Hw,Vw.prototype.visitList=Hw,Vw.prototype.visitStruct=Hw,Vw.prototype.visitUnion=Hw,Vw.prototype.visitDenseUnion=Hw,Vw.prototype.visitSparseUnion=Hw,Vw.prototype.visitDictionary=Hw,Vw.prototype.visitInterval=Hw,Vw.prototype.visitIntervalDayTime=Hw,Vw.prototype.visitIntervalYearMonth=Hw,Vw.prototype.visitDuration=Hw,Vw.prototype.visitDurationSecond=Hw,Vw.prototype.visitDurationMillisecond=Hw,Vw.prototype.visitDurationMicrosecond=Hw,Vw.prototype.visitDurationNanosecond=Hw,Vw.prototype.visitFixedSizeList=Hw,Vw.prototype.visitMap=Hw;const Ww=new Vw;var jw;const Yw={},qw={};class Xw{constructor(e){var t,n,i;const o=e[0]instanceof Xw?e.flatMap(e=>e.data):e;if(0===o.length||o.some(e=>!(e instanceof Tw)))throw new TypeError("Vector constructor expects an Array of Data instances.");const r=null===(t=o[0])||void 0===t?void 0:t.type;switch(o.length){case 0:this._offsets=[0];break;case 1:{const{get:e,set:t,indexOf:n}=Yw[r.typeId],i=o[0];this.isValid=e=>Mw(i,e),this.get=t=>e(i,t),this.set=(e,n)=>t(i,e,n),this.indexOf=e=>n(i,e),this._offsets=[0,i.length];break}default:Object.setPrototypeOf(this,qw[r.typeId]),this._offsets=Rw(o)}this.data=o,this.type=r,this.stride=zv(r),this.numChildren=null!==(i=null===(n=r.children)||void 0===n?void 0:n.length)&&void 0!==i?i:0,this.length=this._offsets.at(-1)}get byteLength(){return this.data.reduce((e,t)=>e+t.byteLength,0)}get nullable(){return this.data.some(e=>e.nullable)}get nullCount(){return Lw(this.data)}get ArrayType(){return this.type.ArrayType}get[Symbol.toStringTag](){return`${this.VectorName}<${this.type[Symbol.toStringTag]}>`}get VectorName(){return`${vb[this.type.typeId]}Vector`}isValid(e){return!1}get(e){return null}at(e){return this.get(pw(e,this.length))}set(e,t){}indexOf(e,t){return-1}includes(e,t){return this.indexOf(e,t)>-1}[Symbol.iterator](){return Ww.visit(this)}concat(...e){return new Xw(this.data.concat(e.flatMap(e=>e.data).flat(Number.POSITIVE_INFINITY)))}slice(e,t){return new Xw(dw(this,e,t,({data:e,_offsets:t},n,i)=>Pw(e,t,n,i)))}toJSON(){return[...this]}toArray(){const{type:e,data:t,length:n,stride:i,ArrayType:o}=this;switch(e.typeId){case vb.Int:case vb.Float:case vb.Decimal:case vb.Time:case vb.Timestamp:switch(t.length){case 0:return new o;case 1:return t[0].values.subarray(0,n*i);default:return t.reduce((e,{values:t,length:n})=>(e.array.set(t.subarray(0,n*i),e.offset),e.offset+=n*i,e),{array:new o(n*i),offset:0}).array}}return[...this]}toString(){return`[${[...this].join(",")}]`}getChild(e){var t;return this.getChildAt(null===(t=this.type.children)||void 0===t?void 0:t.findIndex(t=>t.name===e))}getChildAt(e){return e>-1&&e<this.numChildren?new Xw(this.data.map(({children:t})=>t[e])):null}get isMemoized(){return!!rv.isDictionary(this.type)&&this.data[0].dictionary.isMemoized}memoize(){if(rv.isDictionary(this.type)){const e=new Kw(this.data[0].dictionary),t=this.data.map(t=>{const n=t.clone();return n.dictionary=e,n});return new Xw(t)}return new Kw(this)}unmemoize(){if(rv.isDictionary(this.type)&&this.isMemoized){const e=this.data[0].dictionary.unmemoize(),t=this.data.map(t=>{const n=t.clone();return n.dictionary=e,n});return new Xw(t)}return this}}jw=Symbol.toStringTag,Xw[jw]=(e=>{e.type=rv.prototype,e.data=[],e.length=0,e.stride=1,e.numChildren=0,e._offsets=new Uint32Array([0]),e[Symbol.isConcatSpreadable]=!0;const t=Object.keys(vb).map(e=>vb[e]).filter(e=>"number"==typeof e&&e!==vb.NONE);for(const n of t){const t=iw.getVisitFnByTypeId(n),i=Cx.getVisitFnByTypeId(n),o=$w.getVisitFnByTypeId(n);Yw[n]={get:t,set:i,indexOf:o},qw[n]=Object.create(e,{isValid:{value:Nw(Mw)},get:{value:Nw(iw.getVisitFnByTypeId(n))},set:{value:Ow(Cx.getVisitFnByTypeId(n))},indexOf:{value:Bw($w.getVisitFnByTypeId(n))}})}return"Vector"})(Xw.prototype);class Kw extends Xw{constructor(e){super(e.data);const t=this.get,n=this.set,i=this.slice,o=new Array(this.length);Object.defineProperty(this,"get",{value(e){const n=o[e];if(void 0!==n)return n;const i=t.call(this,e);return o[e]=i,i}}),Object.defineProperty(this,"set",{value(e,t){n.call(this,e,t),o[e]=t}}),Object.defineProperty(this,"slice",{value:(e,t)=>new Kw(i.call(this,e,t))}),Object.defineProperty(this,"isMemoized",{value:!0}),Object.defineProperty(this,"unmemoize",{value:()=>new Xw(this.data)}),Object.defineProperty(this,"memoize",{value:()=>this})}}function Zw(e){if(e){if(e instanceof Tw)return new Xw([e]);if(e instanceof Xw)return new Xw(e.data);if(e.type instanceof rv)return new Xw([Aw(e)]);if(Array.isArray(e))return new Xw(e.flatMap(e=>{return(t=e)instanceof Tw?[t]:t instanceof Xw?t.data:Zw(t).data;var t}));if(ArrayBuffer.isView(e)){e instanceof DataView&&(e=new Uint8Array(e.buffer));const t={offset:0,length:e.length,nullCount:-1,data:e};if(e instanceof Int8Array)return new Xw([Aw(Object.assign(Object.assign({},t),{type:new lv}))]);if(e instanceof Int16Array)return new Xw([Aw(Object.assign(Object.assign({},t),{type:new cv}))]);if(e instanceof Int32Array)return new Xw([Aw(Object.assign(Object.assign({},t),{type:new uv}))]);if(e instanceof BigInt64Array)return new Xw([Aw(Object.assign(Object.assign({},t),{type:new hv}))]);if(e instanceof Uint8Array||e instanceof Uint8ClampedArray)return new Xw([Aw(Object.assign(Object.assign({},t),{type:new dv}))]);if(e instanceof Uint16Array)return new Xw([Aw(Object.assign(Object.assign({},t),{type:new pv}))]);if(e instanceof Uint32Array)return new Xw([Aw(Object.assign(Object.assign({},t),{type:new fv}))]);if(e instanceof BigUint64Array)return new Xw([Aw(Object.assign(Object.assign({},t),{type:new mv}))]);if(e instanceof Float32Array)return new Xw([Aw(Object.assign(Object.assign({},t),{type:new gv}))]);if(e instanceof Float64Array)return new Xw([Aw(Object.assign(Object.assign({},t),{type:new yv}))]);throw new Error("Unrecognized input")}}throw new Error("Unrecognized input")}function Qw(e,t){const n=Math.ceil(e)*t-1;return(n-n%64+64||64)/t}function Jw(e,t=0){return e.length>=t?e.subarray(0,t):Jg(new e.constructor(t),e,0)}class eS{constructor(e,t=0,n=1){this.length=Math.ceil(t/n),this.buffer=new e(this.length),this.stride=n,this.BYTES_PER_ELEMENT=e.BYTES_PER_ELEMENT,this.ArrayType=e}get byteLength(){return Math.ceil(this.length*this.stride)*this.BYTES_PER_ELEMENT}get reservedLength(){return this.buffer.length/this.stride}get reservedByteLength(){return this.buffer.byteLength}set(e,t){return this}append(e){return this.set(this.length,e)}reserve(e){if(e>0){this.length+=e;const t=this.stride,n=this.length*t,i=this.buffer.length;n>=i&&this._resize(Qw(0===i?1*n:2*n,this.BYTES_PER_ELEMENT))}return this}flush(e=this.length){e=Qw(e*this.stride,this.BYTES_PER_ELEMENT);const t=Jw(this.buffer,e);return this.clear(),t}clear(){return this.length=0,this.buffer=new this.ArrayType,this}_resize(e){return this.buffer=Jw(this.buffer,e)}}class tS extends eS{last(){return this.get(this.length-1)}get(e){return this.buffer[e]}set(e,t){return this.reserve(e-this.length+1),this.buffer[e*this.stride]=t,this}}class nS extends tS{constructor(){super(Uint8Array,0,1/8),this.numValid=0}get numInvalid(){return this.length-this.numValid}get(e){return this.buffer[e>>3]>>e%8&1}set(e,t){const{buffer:n}=this.reserve(e-this.length+1),i=e>>3,o=e%8,r=n[i]>>o&1;return t?0===r&&(n[i]|=1<<o,++this.numValid):1===r&&(n[i]&=~(1<<o),--this.numValid),this}clear(){return this.numValid=0,super.clear()}}class iS extends tS{constructor(e){super(e.OffsetArrayType,1,1)}append(e){return this.set(this.length-1,e)}set(e,t){const n=this.length-1,i=this.reserve(e-n+1).buffer;return n<e++&&n>=0&&i.fill(i[n],n,e),i[e]=i[e-1]+t,this}flush(e=this.length-1){return e>this.length&&this.set(e-1,this.BYTES_PER_ELEMENT>4?BigInt(0):0),super.flush(e+1)}}let oS=class{static throughNode(e){throw new Error('"throughNode" not available in this environment')}static throughDOM(e){throw new Error('"throughDOM" not available in this environment')}constructor({type:e,nullValues:t}){this.length=0,this.finished=!1,this.type=e,this.children=[],this.nullValues=t,this.stride=zv(e),this._nulls=new nS,t&&t.length>0&&(this._isValid=function(e){if(!e||e.length<=0)return function(e){return!0};let t="";const n=e.filter(e=>e==e);return n.length>0&&(t=`\n    switch (x) {${n.map(e=>`\n        case ${function(e){return"bigint"!=typeof e?Sb(e):`${Sb(e)}n`}(e)}:`).join("")}\n            return false;\n    }`),e.length!==n.length&&(t=`if (x !== x) return false;\n${t}`),new Function("x",`${t}\nreturn true;`)}(t))}toVector(){return new Xw([this.flush()])}get ArrayType(){return this.type.ArrayType}get nullCount(){return this._nulls.numInvalid}get numChildren(){return this.children.length}get byteLength(){let e=0;const{_offsets:t,_values:n,_nulls:i,_typeIds:o,children:r}=this;return t&&(e+=t.byteLength),n&&(e+=n.byteLength),i&&(e+=i.byteLength),o&&(e+=o.byteLength),r.reduce((e,t)=>e+t.byteLength,e)}get reservedLength(){return this._nulls.reservedLength}get reservedByteLength(){let e=0;return this._offsets&&(e+=this._offsets.reservedByteLength),this._values&&(e+=this._values.reservedByteLength),this._nulls&&(e+=this._nulls.reservedByteLength),this._typeIds&&(e+=this._typeIds.reservedByteLength),this.children.reduce((e,t)=>e+t.reservedByteLength,e)}get valueOffsets(){return this._offsets?this._offsets.buffer:null}get values(){return this._values?this._values.buffer:null}get nullBitmap(){return this._nulls?this._nulls.buffer:null}get typeIds(){return this._typeIds?this._typeIds.buffer:null}append(e){return this.set(this.length,e)}isValid(e){return this._isValid(e)}set(e,t){return this.setValid(e,this.isValid(t))&&this.setValue(e,t),this}setValue(e,t){this._setValue(this,e,t)}setValid(e,t){return this.length=this._nulls.set(e,+t).length,t}addChild(e,t=`${this.numChildren}`){throw new Error(`Cannot append children to non-nested type "${this.type}"`)}getChildAt(e){return this.children[e]||null}flush(){let e,t,n,i;const{type:o,length:r,nullCount:s,_typeIds:a,_offsets:l,_values:c,_nulls:u}=this;(t=null==a?void 0:a.flush(r))?i=null==l?void 0:l.flush(r):e=(i=null==l?void 0:l.flush(r))?null==c?void 0:c.flush(l.last()):null==c?void 0:c.flush(r),s>0&&(n=null==u?void 0:u.flush(r));const h=this.children.map(e=>e.flush());return this.clear(),Aw({type:o,length:r,nullCount:s,children:h,child:h[0],data:e,typeIds:t,nullBitmap:n,valueOffsets:i})}finish(){this.finished=!0;for(const e of this.children)e.finish();return this}clear(){var e,t,n,i;this.length=0,null===(e=this._nulls)||void 0===e||e.clear(),null===(t=this._values)||void 0===t||t.clear(),null===(n=this._offsets)||void 0===n||n.clear(),null===(i=this._typeIds)||void 0===i||i.clear();for(const o of this.children)o.clear();return this}};oS.prototype.length=1,oS.prototype.stride=1,oS.prototype.children=null,oS.prototype.finished=!1,oS.prototype.nullValues=null,oS.prototype._isValid=()=>!0;class rS extends oS{constructor(e){super(e),this._values=new tS(this.ArrayType,0,this.stride)}setValue(e,t){const n=this._values;return n.reserve(e-n.length+1),super.setValue(e,t)}}class sS extends oS{constructor(e){super(e),this._pendingLength=0,this._offsets=new iS(e.type)}setValue(e,t){const n=this._pending||(this._pending=new Map),i=n.get(e);i&&(this._pendingLength-=i.length),this._pendingLength+=t instanceof lw?t[ow].length:t.length,n.set(e,t)}setValid(e,t){return!!super.setValid(e,t)||((this._pending||(this._pending=new Map)).set(e,void 0),!1)}clear(){return this._pendingLength=0,this._pending=void 0,super.clear()}flush(){return this._flush(),super.flush()}finish(){return this._flush(),super.finish()}_flush(){const e=this._pending,t=this._pendingLength;return this._pendingLength=0,this._pending=void 0,e&&e.size>0&&this._flushPending(e,t),this}}class aS{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}offset(){return this.bb.readInt64(this.bb_pos)}metaDataLength(){return this.bb.readInt32(this.bb_pos+8)}bodyLength(){return this.bb.readInt64(this.bb_pos+16)}static sizeOf(){return 24}static createBlock(e,t,n,i){return e.prep(8,24),e.writeInt64(BigInt(null!=i?i:0)),e.pad(4),e.writeInt32(n),e.writeInt64(BigInt(null!=t?t:0)),e.offset()}}class lS{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFooter(e,t){return(t||new lS).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFooter(e,t){return e.setPosition(e.position()+4),(t||new lS).__init(e.readInt32(e.position())+e.position(),e)}version(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):py.V1}schema(e){const t=this.bb.__offset(this.bb_pos,6);return t?(e||new gb).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}dictionaries(e,t){const n=this.bb.__offset(this.bb_pos,8);return n?(t||new aS).__init(this.bb.__vector(this.bb_pos+n)+24*e,this.bb):null}dictionariesLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}recordBatches(e,t){const n=this.bb.__offset(this.bb_pos,10);return n?(t||new aS).__init(this.bb.__vector(this.bb_pos+n)+24*e,this.bb):null}recordBatchesLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,t){const n=this.bb.__offset(this.bb_pos,12);return n?(t||new qy).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFooter(e){e.startObject(5)}static addVersion(e,t){e.addFieldInt16(0,t,py.V1)}static addSchema(e,t){e.addFieldOffset(1,t,0)}static addDictionaries(e,t){e.addFieldOffset(2,t,0)}static startDictionariesVector(e,t){e.startVector(24,t,8)}static addRecordBatches(e,t){e.addFieldOffset(3,t,0)}static startRecordBatchesVector(e,t){e.startVector(24,t,8)}static addCustomMetadata(e,t){e.addFieldOffset(4,t,0)}static createCustomMetadataVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startCustomMetadataVector(e,t){e.startVector(4,t,4)}static endFooter(e){return e.endObject()}static finishFooterBuffer(e,t){e.finish(t)}static finishSizePrefixedFooterBuffer(e,t){e.finish(t,void 0,!0)}}class cS{constructor(e=[],t,n,i=py.V5){this.fields=e||[],this.metadata=t||new Map,n||(n=dS(this.fields)),this.dictionaries=n,this.metadataVersion=i}get[Symbol.toStringTag](){return"Schema"}get names(){return this.fields.map(e=>e.name)}toString(){return`Schema<{ ${this.fields.map((e,t)=>`${t}: ${e}`).join(", ")} }>`}select(e){const t=new Set(e),n=this.fields.filter(e=>t.has(e.name));return new cS(n,this.metadata)}selectAt(e){const t=e.map(e=>this.fields[e]).filter(Boolean);return new cS(t,this.metadata)}assign(...e){const t=e[0]instanceof cS?e[0]:Array.isArray(e[0])?new cS(e[0]):new cS(e),n=[...this.fields],i=hS(hS(new Map,this.metadata),t.metadata),o=t.fields.filter(e=>{const t=n.findIndex(t=>t.name===e.name);return!~t||(n[t]=e.clone({metadata:hS(hS(new Map,n[t].metadata),e.metadata)}))&&!1}),r=dS(o,new Map);return new cS([...n,...o],i,new Map([...this.dictionaries,...r]))}}cS.prototype.fields=null,cS.prototype.metadata=null,cS.prototype.dictionaries=null;class uS{static new(...e){let[t,n,i,o]=e;return e[0]&&"object"==typeof e[0]&&(({name:t}=e[0]),void 0===n&&(n=e[0].type),void 0===i&&(i=e[0].nullable),void 0===o&&(o=e[0].metadata)),new uS(`${t}`,n,i,o)}constructor(e,t,n=!1,i){this.name=e,this.type=t,this.nullable=n,this.metadata=i||new Map}get typeId(){return this.type.typeId}get[Symbol.toStringTag](){return"Field"}toString(){return`${this.name}: ${this.type}`}clone(...e){let[t,n,i,o]=e;return e[0]&&"object"==typeof e[0]?({name:t=this.name,type:n=this.type,nullable:i=this.nullable,metadata:o=this.metadata}=e[0]):[t=this.name,n=this.type,i=this.nullable,o=this.metadata]=e,uS.new(t,n,i,o)}}function hS(e,t){return new Map([...e||new Map,...t||new Map])}function dS(e,t=new Map){for(let n=-1,i=e.length;++n<i;){const i=e[n].type;if(rv.isDictionary(i))if(t.has(i.id)){if(t.get(i.id)!==i.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}else t.set(i.id,i.dictionary);i.children&&i.children.length>0&&dS(i.children,t)}return t}uS.prototype.type=null,uS.prototype.name=null,uS.prototype.nullable=null,uS.prototype.metadata=null;var pS=Py,fS=Ry;class mS{static decode(e){e=new fS(oy(e));const t=lS.getRootAsFooter(e),n=cS.decode(t.schema(),new Map,t.version());return new _S(n,t)}static encode(e){const t=new pS,n=cS.encode(t,e.schema);lS.startRecordBatchesVector(t,e.numRecordBatches);for(const r of[...e.recordBatches()].slice().reverse())gS.encode(t,r);const i=t.endVector();lS.startDictionariesVector(t,e.numDictionaries);for(const r of[...e.dictionaryBatches()].slice().reverse())gS.encode(t,r);const o=t.endVector();return lS.startFooter(t),lS.addSchema(t,n),lS.addVersion(t,py.V5),lS.addRecordBatches(t,i),lS.addDictionaries(t,o),lS.finishFooterBuffer(t,lS.endFooter(t)),t.asUint8Array()}get numRecordBatches(){return this._recordBatches.length}get numDictionaries(){return this._dictionaryBatches.length}constructor(e,t=py.V5,n,i){this.schema=e,this.version=t,n&&(this._recordBatches=n),i&&(this._dictionaryBatches=i)}*recordBatches(){for(let e,t=-1,n=this.numRecordBatches;++t<n;)(e=this.getRecordBatch(t))&&(yield e)}*dictionaryBatches(){for(let e,t=-1,n=this.numDictionaries;++t<n;)(e=this.getDictionaryBatch(t))&&(yield e)}getRecordBatch(e){return e>=0&&e<this.numRecordBatches&&this._recordBatches[e]||null}getDictionaryBatch(e){return e>=0&&e<this.numDictionaries&&this._dictionaryBatches[e]||null}}class _S extends mS{get numRecordBatches(){return this._footer.recordBatchesLength()}get numDictionaries(){return this._footer.dictionariesLength()}constructor(e,t){super(e,t.version()),this._footer=t}getRecordBatch(e){if(e>=0&&e<this.numRecordBatches){const t=this._footer.recordBatches(e);if(t)return gS.decode(t)}return null}getDictionaryBatch(e){if(e>=0&&e<this.numDictionaries){const t=this._footer.dictionaries(e);if(t)return gS.decode(t)}return null}}class gS{static decode(e){return new gS(e.metaDataLength(),e.bodyLength(),e.offset())}static encode(e,t){const{metaDataLength:n}=t,i=BigInt(t.offset),o=BigInt(t.bodyLength);return aS.createBlock(e,i,n,o)}constructor(e,t,n){this.metaDataLength=e,this.offset=Eb(n),this.bodyLength=Eb(t)}}const yS=Object.freeze({done:!0,value:void 0});class bS{constructor(e){this._json=e}get schema(){return this._json.schema}get batches(){return this._json.batches||[]}get dictionaries(){return this._json.dictionaries||[]}}class vS{tee(){return this._getDOMStream().tee()}pipe(e,t){return this._getNodeStream().pipe(e,t)}pipeTo(e,t){return this._getDOMStream().pipeTo(e,t)}pipeThrough(e,t){return this._getDOMStream().pipeThrough(e,t)}_getDOMStream(){return this._DOMStream||(this._DOMStream=this.toDOMStream())}_getNodeStream(){return this._nodeStream||(this._nodeStream=this.toNodeStream())}}class xS extends vS{constructor(){super(),this._values=[],this.resolvers=[],this._closedPromise=new Promise(e=>this._closedPromiseResolve=e)}get closed(){return this._closedPromise}cancel(e){return Lg(this,void 0,void 0,function*(){yield this.return(e)})}write(e){this._ensureOpen()&&(this.resolvers.length<=0?this._values.push(e):this.resolvers.shift().resolve({done:!1,value:e}))}abort(e){this._closedPromiseResolve&&(this.resolvers.length<=0?this._error={error:e}:this.resolvers.shift().reject({done:!0,value:e}))}close(){if(this._closedPromiseResolve){const{resolvers:e}=this;for(;e.length>0;)e.shift().resolve(yS);this._closedPromiseResolve(),this._closedPromiseResolve=void 0}}[Symbol.asyncIterator](){return this}toDOMStream(e){return cy.toDOMStream(this._closedPromiseResolve||this._error?this:this._values,e)}toNodeStream(e){return cy.toNodeStream(this._closedPromiseResolve||this._error?this:this._values,e)}throw(e){return Lg(this,void 0,void 0,function*(){return yield this.abort(e),yS})}return(e){return Lg(this,void 0,void 0,function*(){return yield this.close(),yS})}read(e){return Lg(this,void 0,void 0,function*(){return(yield this.next(e,"read")).value})}peek(e){return Lg(this,void 0,void 0,function*(){return(yield this.next(e,"peek")).value})}next(...e){return this._values.length>0?Promise.resolve({done:!1,value:this._values.shift()}):this._error?Promise.reject({done:!0,value:this._error.error}):this._closedPromiseResolve?new Promise((e,t)=>{this.resolvers.push({resolve:e,reject:t})}):Promise.resolve(yS)}_ensureOpen(){if(this._closedPromiseResolve)return!0;throw new Error("AsyncQueue is closed")}}class wS extends xS{write(e){if((e=oy(e)).byteLength>0)return super.write(e)}toString(e=!1){return e?Og(this.toUint8Array(!0)):this.toUint8Array(!1).then(Og)}toUint8Array(e=!1){return e?ey(this._values)[0]:(()=>Lg(this,void 0,void 0,function*(){var e,t,n,i;const o=[];let r=0;try{for(var s,a=!0,l=Mg(this);!(e=(s=yield l.next()).done);a=!0){i=s.value,a=!1;const e=i;o.push(e),r+=e.byteLength}}catch(c){t={error:c}}finally{try{a||e||!(n=l.return)||(yield n.call(l))}finally{if(t)throw t.error}}return ey(o,r)[0]}))()}}class SS{constructor(e){e&&(this.source=new TS(cy.fromIterable(e)))}[Symbol.iterator](){return this}next(e){return this.source.next(e)}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}peek(e){return this.source.peek(e)}read(e){return this.source.read(e)}}class ES{constructor(e){e instanceof ES?this.source=e.source:e instanceof wS?this.source=new CS(cy.fromAsyncIterable(e)):Zg(e)?this.source=new CS(cy.fromNodeStream(e)):Kg(e)?this.source=new CS(cy.fromDOMStream(e)):qg(e)?this.source=new CS(cy.fromDOMStream(e.body)):Hg(e)?this.source=new CS(cy.fromIterable(e)):(Vg(e)||Gg(e))&&(this.source=new CS(cy.fromAsyncIterable(e)))}[Symbol.asyncIterator](){return this}next(e){return this.source.next(e)}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}get closed(){return this.source.closed}cancel(e){return this.source.cancel(e)}peek(e){return this.source.peek(e)}read(e){return this.source.read(e)}}class TS{constructor(e){this.source=e}cancel(e){this.return(e)}peek(e){return this.next(e,"peek").value}read(e){return this.next(e,"read").value}next(e,t="read"){return this.source.next({cmd:t,size:e})}throw(e){return Object.create(this.source.throw&&this.source.throw(e)||yS)}return(e){return Object.create(this.source.return&&this.source.return(e)||yS)}}class CS{constructor(e){this.source=e,this._closedPromise=new Promise(e=>this._closedPromiseResolve=e)}cancel(e){return Lg(this,void 0,void 0,function*(){yield this.return(e)})}get closed(){return this._closedPromise}read(e){return Lg(this,void 0,void 0,function*(){return(yield this.next(e,"read")).value})}peek(e){return Lg(this,void 0,void 0,function*(){return(yield this.next(e,"peek")).value})}next(e){return Lg(this,arguments,void 0,function*(e,t="read"){return yield this.source.next({cmd:t,size:e})})}throw(e){return Lg(this,void 0,void 0,function*(){const t=this.source.throw&&(yield this.source.throw(e))||yS;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(t)})}return(e){return Lg(this,void 0,void 0,function*(){const t=this.source.return&&(yield this.source.return(e))||yS;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(t)})}}class IS extends SS{constructor(e,t){super(),this.position=0,this.buffer=oy(e),this.size=void 0===t?this.buffer.byteLength:t}readInt32(e){const{buffer:t,byteOffset:n}=this.readAt(e,4);return new DataView(t,n).getInt32(0,!0)}seek(e){return this.position=Math.min(e,this.size),e<this.size}read(e){const{buffer:t,size:n,position:i}=this;return t&&i<n?("number"!=typeof e&&(e=Number.POSITIVE_INFINITY),this.position=Math.min(n,i+Math.min(n-i,e)),t.subarray(i,this.position)):null}readAt(e,t){const n=this.buffer,i=Math.min(this.size,e+t);return n?n.subarray(e,i):new Uint8Array(t)}close(){this.buffer&&(this.buffer=null)}throw(e){return this.close(),{done:!0,value:e}}return(e){return this.close(),{done:!0,value:e}}}class AS extends ES{constructor(e,t){super(),this.position=0,this._handle=e,"number"==typeof t?this.size=t:this._pending=(()=>Lg(this,void 0,void 0,function*(){this.size=(yield e.stat()).size,delete this._pending}))()}readInt32(e){return Lg(this,void 0,void 0,function*(){const{buffer:t,byteOffset:n}=yield this.readAt(e,4);return new DataView(t,n).getInt32(0,!0)})}seek(e){return Lg(this,void 0,void 0,function*(){return this._pending&&(yield this._pending),this.position=Math.min(e,this.size),e<this.size})}read(e){return Lg(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:t,size:n,position:i}=this;if(t&&i<n){"number"!=typeof e&&(e=Number.POSITIVE_INFINITY);let o=i,r=0,s=0;const a=Math.min(n,o+Math.min(n-o,e)),l=new Uint8Array(Math.max(0,(this.position=a)-o));for(;(o+=s)<a&&(r+=s)<l.byteLength;)({bytesRead:s}=yield t.read(l,r,l.byteLength-r,o));return l}return null})}readAt(e,t){return Lg(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:n,size:i}=this;if(n&&e+t<i){const o=Math.min(i,e+t),r=new Uint8Array(o-e);return(yield n.read(r,0,t,e)).buffer}return new Uint8Array(t)})}close(){return Lg(this,void 0,void 0,function*(){const e=this._handle;this._handle=null,e&&(yield e.close())})}throw(e){return Lg(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:e}})}return(e){return Lg(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:e}})}}function kS(e){return e<0&&(e=4294967295+e+1),`0x${e.toString(16)}`}const LS=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8];class RS{constructor(e){this.buffer=e}high(){return this.buffer[1]}low(){return this.buffer[0]}_times(e){const t=new Uint32Array([this.buffer[1]>>>16,65535&this.buffer[1],this.buffer[0]>>>16,65535&this.buffer[0]]),n=new Uint32Array([e.buffer[1]>>>16,65535&e.buffer[1],e.buffer[0]>>>16,65535&e.buffer[0]]);let i=t[3]*n[3];this.buffer[0]=65535&i;let o=i>>>16;return i=t[2]*n[3],o+=i,i=t[3]*n[2]>>>0,o+=i,this.buffer[0]+=o<<16,this.buffer[1]=o>>>0<i?65536:0,this.buffer[1]+=o>>>16,this.buffer[1]+=t[1]*n[3]+t[2]*n[2]+t[3]*n[1],this.buffer[1]+=t[0]*n[3]+t[1]*n[2]+t[2]*n[1]+t[3]*n[0]<<16,this}_plus(e){const t=this.buffer[0]+e.buffer[0]>>>0;this.buffer[1]+=e.buffer[1],t<this.buffer[0]>>>0&&++this.buffer[1],this.buffer[0]=t}lessThan(e){return this.buffer[1]<e.buffer[1]||this.buffer[1]===e.buffer[1]&&this.buffer[0]<e.buffer[0]}equals(e){return this.buffer[1]===e.buffer[1]&&this.buffer[0]==e.buffer[0]}greaterThan(e){return e.lessThan(this)}hex(){return`${kS(this.buffer[1])} ${kS(this.buffer[0])}`}}class PS extends RS{times(e){return this._times(e),this}plus(e){return this._plus(e),this}static from(e,t=new Uint32Array(2)){return PS.fromString("string"==typeof e?e:e.toString(),t)}static fromNumber(e,t=new Uint32Array(2)){return PS.fromString(e.toString(),t)}static fromString(e,t=new Uint32Array(2)){const n=e.length,i=new PS(t);for(let o=0;o<n;){const t=8<n-o?8:n-o,r=new PS(new Uint32Array([Number.parseInt(e.slice(o,o+t),10),0])),s=new PS(new Uint32Array([LS[t],0]));i.times(s),i.plus(r),o+=t}return i}static convertArray(e){const t=new Uint32Array(2*e.length);for(let n=-1,i=e.length;++n<i;)PS.from(e[n],new Uint32Array(t.buffer,t.byteOffset+2*n*4,2));return t}static multiply(e,t){return new PS(new Uint32Array(e.buffer)).times(t)}static add(e,t){return new PS(new Uint32Array(e.buffer)).plus(t)}}class DS extends RS{negate(){return this.buffer[0]=1+~this.buffer[0],this.buffer[1]=~this.buffer[1],0==this.buffer[0]&&++this.buffer[1],this}times(e){return this._times(e),this}plus(e){return this._plus(e),this}lessThan(e){const t=0|this.buffer[1],n=0|e.buffer[1];return t<n||t===n&&this.buffer[0]<e.buffer[0]}static from(e,t=new Uint32Array(2)){return DS.fromString("string"==typeof e?e:e.toString(),t)}static fromNumber(e,t=new Uint32Array(2)){return DS.fromString(e.toString(),t)}static fromString(e,t=new Uint32Array(2)){const n=e.startsWith("-"),i=e.length,o=new DS(t);for(let r=n?1:0;r<i;){const t=8<i-r?8:i-r,n=new DS(new Uint32Array([Number.parseInt(e.slice(r,r+t),10),0])),s=new DS(new Uint32Array([LS[t],0]));o.times(s),o.plus(n),r+=t}return n?o.negate():o}static convertArray(e){const t=new Uint32Array(2*e.length);for(let n=-1,i=e.length;++n<i;)DS.from(e[n],new Uint32Array(t.buffer,t.byteOffset+2*n*4,2));return t}static multiply(e,t){return new DS(new Uint32Array(e.buffer)).times(t)}static add(e,t){return new DS(new Uint32Array(e.buffer)).plus(t)}}class MS{constructor(e){this.buffer=e}high(){return new DS(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2))}low(){return new DS(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset,2))}negate(){return this.buffer[0]=1+~this.buffer[0],this.buffer[1]=~this.buffer[1],this.buffer[2]=~this.buffer[2],this.buffer[3]=~this.buffer[3],0==this.buffer[0]&&++this.buffer[1],0==this.buffer[1]&&++this.buffer[2],0==this.buffer[2]&&++this.buffer[3],this}times(e){const t=new PS(new Uint32Array([this.buffer[3],0])),n=new PS(new Uint32Array([this.buffer[2],0])),i=new PS(new Uint32Array([this.buffer[1],0])),o=new PS(new Uint32Array([this.buffer[0],0])),r=new PS(new Uint32Array([e.buffer[3],0])),s=new PS(new Uint32Array([e.buffer[2],0])),a=new PS(new Uint32Array([e.buffer[1],0])),l=new PS(new Uint32Array([e.buffer[0],0]));let c=PS.multiply(o,l);this.buffer[0]=c.low();const u=new PS(new Uint32Array([c.high(),0]));return c=PS.multiply(i,l),u.plus(c),c=PS.multiply(o,a),u.plus(c),this.buffer[1]=u.low(),this.buffer[3]=u.lessThan(c)?1:0,this.buffer[2]=u.high(),new PS(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2)).plus(PS.multiply(n,l)).plus(PS.multiply(i,a)).plus(PS.multiply(o,s)),this.buffer[3]+=PS.multiply(t,l).plus(PS.multiply(n,a)).plus(PS.multiply(i,s)).plus(PS.multiply(o,r)).low(),this}plus(e){const t=new Uint32Array(4);return t[3]=this.buffer[3]+e.buffer[3]>>>0,t[2]=this.buffer[2]+e.buffer[2]>>>0,t[1]=this.buffer[1]+e.buffer[1]>>>0,t[0]=this.buffer[0]+e.buffer[0]>>>0,t[0]<this.buffer[0]>>>0&&++t[1],t[1]<this.buffer[1]>>>0&&++t[2],t[2]<this.buffer[2]>>>0&&++t[3],this.buffer[3]=t[3],this.buffer[2]=t[2],this.buffer[1]=t[1],this.buffer[0]=t[0],this}hex(){return`${kS(this.buffer[3])} ${kS(this.buffer[2])} ${kS(this.buffer[1])} ${kS(this.buffer[0])}`}static multiply(e,t){return new MS(new Uint32Array(e.buffer)).times(t)}static add(e,t){return new MS(new Uint32Array(e.buffer)).plus(t)}static from(e,t=new Uint32Array(4)){return MS.fromString("string"==typeof e?e:e.toString(),t)}static fromNumber(e,t=new Uint32Array(4)){return MS.fromString(e.toString(),t)}static fromString(e,t=new Uint32Array(4)){const n=e.startsWith("-"),i=e.length,o=new MS(t);for(let r=n?1:0;r<i;){const t=8<i-r?8:i-r,n=new MS(new Uint32Array([Number.parseInt(e.slice(r,r+t),10),0,0,0])),s=new MS(new Uint32Array([LS[t],0,0,0]));o.times(s),o.plus(n),r+=t}return n?o.negate():o}static convertArray(e){const t=new Uint32Array(4*e.length);for(let n=-1,i=e.length;++n<i;)MS.from(e[n],new Uint32Array(t.buffer,t.byteOffset+16*n,4));return t}}class NS extends Uv{constructor(e,t,n,i,o=py.V5){super(),this.nodesIndex=-1,this.buffersIndex=-1,this.bytes=e,this.nodes=t,this.buffers=n,this.dictionaries=i,this.metadataVersion=o}visit(e){return super.visit(e instanceof uS?e.type:e)}visitNull(e,{length:t}=this.nextFieldNode()){return Aw({type:e,length:t})}visitBool(e,{length:t,nullCount:n}=this.nextFieldNode()){return Aw({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),data:this.readData(e)})}visitInt(e,{length:t,nullCount:n}=this.nextFieldNode()){return Aw({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),data:this.readData(e)})}visitFloat(e,{length:t,nullCount:n}=this.nextFieldNode()){return Aw({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),data:this.readData(e)})}visitUtf8(e,{length:t,nullCount:n}=this.nextFieldNode()){return Aw({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitLargeUtf8(e,{length:t,nullCount:n}=this.nextFieldNode()){return Aw({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitBinary(e,{length:t,nullCount:n}=this.nextFieldNode()){return Aw({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitLargeBinary(e,{length:t,nullCount:n}=this.nextFieldNode()){return Aw({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitFixedSizeBinary(e,{length:t,nullCount:n}=this.nextFieldNode()){return Aw({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),data:this.readData(e)})}visitDate(e,{length:t,nullCount:n}=this.nextFieldNode()){return Aw({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),data:this.readData(e)})}visitTimestamp(e,{length:t,nullCount:n}=this.nextFieldNode()){return Aw({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),data:this.readData(e)})}visitTime(e,{length:t,nullCount:n}=this.nextFieldNode()){return Aw({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),data:this.readData(e)})}visitDecimal(e,{length:t,nullCount:n}=this.nextFieldNode()){return Aw({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),data:this.readData(e)})}visitList(e,{length:t,nullCount:n}=this.nextFieldNode()){return Aw({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),valueOffsets:this.readOffsets(e),child:this.visit(e.children[0])})}visitStruct(e,{length:t,nullCount:n}=this.nextFieldNode()){return Aw({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),children:this.visitMany(e.children)})}visitUnion(e,{length:t,nullCount:n}=this.nextFieldNode()){return this.metadataVersion<py.V5&&this.readNullBitmap(e,n),e.mode===my.Sparse?this.visitSparseUnion(e,{length:t,nullCount:n}):this.visitDenseUnion(e,{length:t,nullCount:n})}visitDenseUnion(e,{length:t,nullCount:n}=this.nextFieldNode()){return Aw({type:e,length:t,nullCount:n,typeIds:this.readTypeIds(e),valueOffsets:this.readOffsets(e),children:this.visitMany(e.children)})}visitSparseUnion(e,{length:t,nullCount:n}=this.nextFieldNode()){return Aw({type:e,length:t,nullCount:n,typeIds:this.readTypeIds(e),children:this.visitMany(e.children)})}visitDictionary(e,{length:t,nullCount:n}=this.nextFieldNode()){return Aw({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),data:this.readData(e.indices),dictionary:this.readDictionary(e)})}visitInterval(e,{length:t,nullCount:n}=this.nextFieldNode()){return Aw({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),data:this.readData(e)})}visitDuration(e,{length:t,nullCount:n}=this.nextFieldNode()){return Aw({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),data:this.readData(e)})}visitFixedSizeList(e,{length:t,nullCount:n}=this.nextFieldNode()){return Aw({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),child:this.visit(e.children[0])})}visitMap(e,{length:t,nullCount:n}=this.nextFieldNode()){return Aw({type:e,length:t,nullCount:n,nullBitmap:this.readNullBitmap(e,n),valueOffsets:this.readOffsets(e),child:this.visit(e.children[0])})}nextFieldNode(){return this.nodes[++this.nodesIndex]}nextBufferRange(){return this.buffers[++this.buffersIndex]}readNullBitmap(e,t,n=this.nextBufferRange()){return t>0&&this.readData(e,n)||new Uint8Array(0)}readOffsets(e,t){return this.readData(e,t)}readTypeIds(e,t){return this.readData(e,t)}readData(e,{length:t,offset:n}=this.nextBufferRange()){return this.bytes.subarray(n,n+t)}readDictionary(e){return this.dictionaries.get(e.id)}}class OS extends NS{constructor(e,t,n,i,o){super(new Uint8Array(0),t,n,i,o),this.sources=e}readNullBitmap(e,t,{offset:n}=this.nextBufferRange()){return t<=0?new Uint8Array(0):xw(this.sources[n])}readOffsets(e,{offset:t}=this.nextBufferRange()){return ty(Uint8Array,ty(e.OffsetArrayType,this.sources[t]))}readTypeIds(e,{offset:t}=this.nextBufferRange()){return ty(Uint8Array,ty(e.ArrayType,this.sources[t]))}readData(e,{offset:t}=this.nextBufferRange()){const{sources:n}=this;return rv.isTimestamp(e)||(rv.isInt(e)||rv.isTime(e))&&64===e.bitWidth||rv.isDuration(e)||rv.isDate(e)&&e.unit===by.MILLISECOND?ty(Uint8Array,DS.convertArray(n[t])):rv.isDecimal(e)?ty(Uint8Array,MS.convertArray(n[t])):rv.isBinary(e)||rv.isLargeBinary(e)||rv.isFixedSizeBinary(e)?function(e){const t=e.join(""),n=new Uint8Array(t.length/2);for(let i=0;i<t.length;i+=2)n[i>>1]=Number.parseInt(t.slice(i,i+2),16);return n}(n[t]):rv.isBool(e)?xw(n[t]):rv.isUtf8(e)||rv.isLargeUtf8(e)?Fg(n[t].join("")):ty(Uint8Array,ty(e.ArrayType,n[t].map(e=>+e)))}}class BS extends sS{constructor(e){super(e),this._values=new eS(Uint8Array)}get byteLength(){let e=this._pendingLength+4*this.length;return this._offsets&&(e+=this._offsets.byteLength),this._values&&(e+=this._values.byteLength),this._nulls&&(e+=this._nulls.byteLength),e}setValue(e,t){return super.setValue(e,oy(t))}_flushPending(e,t){const n=this._offsets,i=this._values.reserve(t).buffer;let o=0;for(const[r,s]of e)if(void 0===s)n.set(r,0);else{const e=s.length;i.set(s,o),n.set(r,e),o+=e}}}class FS extends sS{constructor(e){super(e),this._values=new eS(Uint8Array)}get byteLength(){let e=this._pendingLength+4*this.length;return this._offsets&&(e+=this._offsets.byteLength),this._values&&(e+=this._values.byteLength),this._nulls&&(e+=this._nulls.byteLength),e}setValue(e,t){return super.setValue(e,oy(t))}_flushPending(e,t){const n=this._offsets,i=this._values.reserve(t).buffer;let o=0;for(const[r,s]of e)if(void 0===s)n.set(r,BigInt(0));else{const e=s.length;i.set(s,o),n.set(r,BigInt(e)),o+=e}}}class zS extends oS{constructor(e){super(e),this._values=new nS}setValue(e,t){this._values.set(e,+t)}}class US extends rS{}US.prototype._setValue=ox;class $S extends US{}$S.prototype._setValue=Jv;class VS extends US{}VS.prototype._setValue=ex;class HS extends rS{}HS.prototype._setValue=mx;class GS extends oS{constructor({type:e,nullValues:t,dictionaryHashFunction:n}){super({type:new Fv(e.dictionary,e.indices,e.id,e.isOrdered)}),this._nulls=null,this._dictionaryOffset=0,this._keysToIndices=Object.create(null),this.indices=YE({type:this.type.indices,nullValues:t}),this.dictionary=YE({type:this.type.dictionary,nullValues:null}),"function"==typeof n&&(this.valueToKey=n)}get values(){return this.indices.values}get nullCount(){return this.indices.nullCount}get nullBitmap(){return this.indices.nullBitmap}get byteLength(){return this.indices.byteLength+this.dictionary.byteLength}get reservedLength(){return this.indices.reservedLength+this.dictionary.reservedLength}get reservedByteLength(){return this.indices.reservedByteLength+this.dictionary.reservedByteLength}isValid(e){return this.indices.isValid(e)}setValid(e,t){const n=this.indices;return t=n.setValid(e,t),this.length=n.length,t}setValue(e,t){const n=this._keysToIndices,i=this.valueToKey(t);let o=n[i];return void 0===o&&(n[i]=o=this._dictionaryOffset+this.dictionary.append(t).length-1),this.indices.setValue(e,o)}flush(){const e=this.type,t=this._dictionary,n=this.dictionary.toVector(),i=this.indices.flush().clone(e);return i.dictionary=t?t.concat(n):n,this.finished||(this._dictionaryOffset+=n.length),this._dictionary=i.dictionary,this.clear(),i}finish(){return this.indices.finish(),this.dictionary.finish(),this._dictionaryOffset=0,this._keysToIndices=Object.create(null),super.finish()}clear(){return this.indices.clear(),this.dictionary.clear(),super.clear()}valueToKey(e){return"string"==typeof e?e:`${e}`}}class WS extends rS{}WS.prototype._setValue=tx;class jS extends oS{setValue(e,t){const[n]=this.children,i=e*this.stride;for(let o=-1,r=t.length;++o<r;)n.set(i+o,t[o])}addChild(e,t="0"){if(this.numChildren>0)throw new Error("FixedSizeListBuilder can only have one child.");const n=this.children.push(e);return this.type=new Nv(this.type.listSize,new uS(t,e.type,!0)),n}}class YS extends rS{setValue(e,t){this._values.set(e,t)}}class qS extends YS{setValue(e,t){super.setValue(e,jv(t))}}class XS extends YS{}class KS extends YS{}class ZS extends rS{}ZS.prototype._setValue=yx;class QS extends ZS{}QS.prototype._setValue=bx;class JS extends ZS{}JS.prototype._setValue=vx;class eE extends rS{}eE.prototype._setValue=Tx;class tE extends eE{}tE.prototype._setValue=xx;class nE extends eE{}nE.prototype._setValue=wx;class iE extends eE{}iE.prototype._setValue=Sx;class oE extends eE{}oE.prototype._setValue=Ex;class rE extends rS{setValue(e,t){this._values.set(e,t)}}class sE extends rE{}class aE extends rE{}class lE extends rE{}class cE extends rE{}class uE extends rE{}class hE extends rE{}class dE extends rE{}class pE extends rE{}class fE extends sS{constructor(e){super(e),this._offsets=new iS(e.type)}addChild(e,t="0"){if(this.numChildren>0)throw new Error("ListBuilder can only have one child.");return this.children[this.numChildren]=e,this.type=new Rv(new uS(t,e.type,!0)),this.numChildren-1}_flushPending(e){const t=this._offsets,[n]=this.children;for(const[i,o]of e)if(void 0===o)t.set(i,0);else{const e=o,r=e.length,s=t.set(i,r).buffer[i];for(let t=-1;++t<r;)n.set(s+t,e[t])}}}class mE extends sS{set(e,t){return super.set(e,t)}setValue(e,t){const n=t instanceof Map?t:new Map(Object.entries(t)),i=this._pending||(this._pending=new Map),o=i.get(e);o&&(this._pendingLength-=o.size),this._pendingLength+=n.size,i.set(e,n)}addChild(e,t=`${this.numChildren}`){if(this.numChildren>0)throw new Error("ListBuilder can only have one child.");return this.children[this.numChildren]=e,this.type=new Ov(new uS(t,e.type,!0),this.type.keysSorted),this.numChildren-1}_flushPending(e){const t=this._offsets,[n]=this.children;for(const[i,o]of e)if(void 0===o)t.set(i,0);else{let{[i]:e,[i+1]:r}=t.set(i,o.size).buffer;for(const t of o.entries())if(n.set(e,t),++e>=r)break}}}class _E extends oS{setValue(e,t){}setValid(e,t){return this.length=Math.max(e+1,this.length),t}}class gE extends oS{setValue(e,t){const{children:n,type:i}=this;switch(Array.isArray(t)||t.constructor){case!0:return i.children.forEach((i,o)=>n[o].set(e,t[o]));case Map:return i.children.forEach((i,o)=>n[o].set(e,t.get(i.name)));default:return i.children.forEach((i,o)=>n[o].set(e,t[i.name]))}}setValid(e,t){return super.setValid(e,t)||this.children.forEach(n=>n.setValid(e,t)),t}addChild(e,t=`${this.numChildren}`){const n=this.children.push(e);return this.type=new Pv([...this.type.children,new uS(t,e.type,!0)]),n}}class yE extends rS{}yE.prototype._setValue=cx;class bE extends yE{}bE.prototype._setValue=rx;class vE extends yE{}vE.prototype._setValue=sx;class xE extends yE{}xE.prototype._setValue=ax;class wE extends yE{}wE.prototype._setValue=lx;class SE extends rS{}SE.prototype._setValue=fx;class EE extends SE{}EE.prototype._setValue=ux;class TE extends SE{}TE.prototype._setValue=hx;class CE extends SE{}CE.prototype._setValue=dx;class IE extends SE{}IE.prototype._setValue=px;class AE extends oS{constructor(e){super(e),this._typeIds=new tS(Int8Array,0,1),"function"==typeof e.valueToChildTypeId&&(this._valueToChildTypeId=e.valueToChildTypeId)}get typeIdToChildIndex(){return this.type.typeIdToChildIndex}append(e,t){return this.set(this.length,e,t)}set(e,t,n){return void 0===n&&(n=this._valueToChildTypeId(this,t,e)),this.setValue(e,t,n),this}setValue(e,t,n){this._typeIds.set(e,n);const i=this.type.typeIdToChildIndex[n],o=this.children[i];null==o||o.set(e,t)}addChild(e,t=`${this.children.length}`){const n=this.children.push(e),{type:{children:i,mode:o,typeIds:r}}=this,s=[...i,new uS(t,e.type)];return this.type=new Dv(o,[...r,n],s),n}_valueToChildTypeId(e,t,n){throw new Error("Cannot map UnionBuilder value to child typeId. Pass the `childTypeId` as the second argument to unionBuilder.append(), or supply a `valueToChildTypeId` function as part of the UnionBuilder constructor options.")}}class kE extends AE{}class LE extends AE{constructor(e){super(e),this._offsets=new tS(Int32Array)}setValue(e,t,n){const i=this._typeIds.set(e,n).buffer[e],o=this.getChildAt(this.type.typeIdToChildIndex[i]),r=this._offsets.set(e,o.length).buffer[e];null==o||o.set(r,t)}}class RE extends sS{constructor(e){super(e),this._values=new eS(Uint8Array)}get byteLength(){let e=this._pendingLength+4*this.length;return this._offsets&&(e+=this._offsets.byteLength),this._values&&(e+=this._values.byteLength),this._nulls&&(e+=this._nulls.byteLength),e}setValue(e,t){return super.setValue(e,Fg(t))}_flushPending(e,t){}}RE.prototype._flushPending=BS.prototype._flushPending;class PE extends sS{constructor(e){super(e),this._values=new eS(Uint8Array)}get byteLength(){let e=this._pendingLength+4*this.length;return this._offsets&&(e+=this._offsets.byteLength),this._values&&(e+=this._values.byteLength),this._nulls&&(e+=this._nulls.byteLength),e}setValue(e,t){return super.setValue(e,Fg(t))}_flushPending(e,t){}}PE.prototype._flushPending=FS.prototype._flushPending;const DE=new class extends Uv{visitNull(){return _E}visitBool(){return zS}visitInt(){return rE}visitInt8(){return sE}visitInt16(){return aE}visitInt32(){return lE}visitInt64(){return cE}visitUint8(){return uE}visitUint16(){return hE}visitUint32(){return dE}visitUint64(){return pE}visitFloat(){return YS}visitFloat16(){return qS}visitFloat32(){return XS}visitFloat64(){return KS}visitUtf8(){return RE}visitLargeUtf8(){return PE}visitBinary(){return BS}visitLargeBinary(){return FS}visitFixedSizeBinary(){return WS}visitDate(){return US}visitDateDay(){return $S}visitDateMillisecond(){return VS}visitTimestamp(){return yE}visitTimestampSecond(){return bE}visitTimestampMillisecond(){return vE}visitTimestampMicrosecond(){return xE}visitTimestampNanosecond(){return wE}visitTime(){return SE}visitTimeSecond(){return EE}visitTimeMillisecond(){return TE}visitTimeMicrosecond(){return CE}visitTimeNanosecond(){return IE}visitDecimal(){return HS}visitList(){return fE}visitStruct(){return gE}visitUnion(){return AE}visitDenseUnion(){return LE}visitSparseUnion(){return kE}visitDictionary(){return GS}visitInterval(){return ZS}visitIntervalDayTime(){return QS}visitIntervalYearMonth(){return JS}visitDuration(){return eE}visitDurationSecond(){return tE}visitDurationMillisecond(){return nE}visitDurationMicrosecond(){return iE}visitDurationNanosecond(){return oE}visitFixedSizeList(){return jS}visitMap(){return mE}};class ME extends Uv{compareSchemas(e,t){return e===t||t instanceof e.constructor&&this.compareManyFields(e.fields,t.fields)}compareManyFields(e,t){return e===t||Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every((e,n)=>this.compareFields(e,t[n]))}compareFields(e,t){return e===t||t instanceof e.constructor&&e.name===t.name&&e.nullable===t.nullable&&this.visit(e.type,t.type)}}function NE(e,t){return t instanceof e.constructor}function OE(e,t){return e===t||NE(e,t)}function BE(e,t){return e===t||NE(e,t)&&e.bitWidth===t.bitWidth&&e.isSigned===t.isSigned}function FE(e,t){return e===t||NE(e,t)&&e.precision===t.precision}function zE(e,t){return e===t||NE(e,t)&&e.unit===t.unit}function UE(e,t){return e===t||NE(e,t)&&e.unit===t.unit&&e.timezone===t.timezone}function $E(e,t){return e===t||NE(e,t)&&e.unit===t.unit&&e.bitWidth===t.bitWidth}function VE(e,t){return e===t||NE(e,t)&&e.mode===t.mode&&e.typeIds.every((e,n)=>e===t.typeIds[n])&&WE.compareManyFields(e.children,t.children)}function HE(e,t){return e===t||NE(e,t)&&e.unit===t.unit}function GE(e,t){return e===t||NE(e,t)&&e.unit===t.unit}ME.prototype.visitNull=OE,ME.prototype.visitBool=OE,ME.prototype.visitInt=BE,ME.prototype.visitInt8=BE,ME.prototype.visitInt16=BE,ME.prototype.visitInt32=BE,ME.prototype.visitInt64=BE,ME.prototype.visitUint8=BE,ME.prototype.visitUint16=BE,ME.prototype.visitUint32=BE,ME.prototype.visitUint64=BE,ME.prototype.visitFloat=FE,ME.prototype.visitFloat16=FE,ME.prototype.visitFloat32=FE,ME.prototype.visitFloat64=FE,ME.prototype.visitUtf8=OE,ME.prototype.visitLargeUtf8=OE,ME.prototype.visitBinary=OE,ME.prototype.visitLargeBinary=OE,ME.prototype.visitFixedSizeBinary=function(e,t){return e===t||NE(e,t)&&e.byteWidth===t.byteWidth},ME.prototype.visitDate=zE,ME.prototype.visitDateDay=zE,ME.prototype.visitDateMillisecond=zE,ME.prototype.visitTimestamp=UE,ME.prototype.visitTimestampSecond=UE,ME.prototype.visitTimestampMillisecond=UE,ME.prototype.visitTimestampMicrosecond=UE,ME.prototype.visitTimestampNanosecond=UE,ME.prototype.visitTime=$E,ME.prototype.visitTimeSecond=$E,ME.prototype.visitTimeMillisecond=$E,ME.prototype.visitTimeMicrosecond=$E,ME.prototype.visitTimeNanosecond=$E,ME.prototype.visitDecimal=OE,ME.prototype.visitList=function(e,t){return e===t||NE(e,t)&&e.children.length===t.children.length&&WE.compareManyFields(e.children,t.children)},ME.prototype.visitStruct=function(e,t){return e===t||NE(e,t)&&e.children.length===t.children.length&&WE.compareManyFields(e.children,t.children)},ME.prototype.visitUnion=VE,ME.prototype.visitDenseUnion=VE,ME.prototype.visitSparseUnion=VE,ME.prototype.visitDictionary=function(e,t){return e===t||NE(e,t)&&e.id===t.id&&e.isOrdered===t.isOrdered&&WE.visit(e.indices,t.indices)&&WE.visit(e.dictionary,t.dictionary)},ME.prototype.visitInterval=HE,ME.prototype.visitIntervalDayTime=HE,ME.prototype.visitIntervalYearMonth=HE,ME.prototype.visitDuration=GE,ME.prototype.visitDurationSecond=GE,ME.prototype.visitDurationMillisecond=GE,ME.prototype.visitDurationMicrosecond=GE,ME.prototype.visitDurationNanosecond=GE,ME.prototype.visitFixedSizeList=function(e,t){return e===t||NE(e,t)&&e.listSize===t.listSize&&e.children.length===t.children.length&&WE.compareManyFields(e.children,t.children)},ME.prototype.visitMap=function(e,t){return e===t||NE(e,t)&&e.keysSorted===t.keysSorted&&e.children.length===t.children.length&&WE.compareManyFields(e.children,t.children)};const WE=new ME;function jE(e,t){return WE.compareSchemas(e,t)}function YE(e){const t=e.type,n=new(DE.getVisitFn(t)())(e);if(t.children&&t.children.length>0){const i=e.children||[],o={nullValues:e.nullValues},r=Array.isArray(i)?(e,t)=>i[t]||o:({name:e})=>i[e]||o;for(const[e,s]of t.children.entries()){const{type:t}=s,i=r(s,e);n.children.push(YE(Object.assign(Object.assign({},i),{type:t})))}}return n}function qE(e,t){if(e instanceof Tw||e instanceof Xw||e.type instanceof rv||ArrayBuffer.isView(e))return Zw(e);const n=[...KE({type:XE(e),nullValues:[null]})(e)],i=1===n.length?n[0]:n.reduce((e,t)=>e.concat(t));return rv.isDictionary(i.type)?i.memoize():i}function XE(e){if(0===e.length)return new sv;let t=0,n=0,i=0,o=0,r=0,s=0,a=0,l=0;for(const c of e){if(null!=c){switch(typeof c){case"bigint":++s;continue;case"boolean":++a;continue;case"number":++o;continue;case"string":++r;continue;case"object":Array.isArray(c)?++n:"[object Date]"===Object.prototype.toString.call(c)?++l:++i;continue}throw new TypeError("Unable to infer Vector type from input values, explicit type declaration expected.")}++t}if(o+t===e.length)return new yv;if(r+t===e.length)return new Fv(new xv,new uv);if(s+t===e.length)return new hv;if(a+t===e.length)return new Sv;if(l+t===e.length)return new Av;if(n+t===e.length){const t=e,n=XE(t[t.findIndex(e=>null!=e)]);if(t.every(e=>{return null==e||(t=n,i=XE(e),WE.visit(t,i));var t,i}))return new Rv(new uS("",n,!0))}else if(i+t===e.length){const t=new Map;for(const n of e)for(const e of Object.keys(n))t.has(e)||null==n[e]||t.set(e,new uS(e,XE([n[e]]),!0));return new Pv([...t.values()])}throw new TypeError("Unable to infer Vector type from input values, explicit type declaration expected.")}function KE(e){const{queueingStrategy:t="count"}=e,{highWaterMark:n=("bytes"!==t?Number.POSITIVE_INFINITY:Math.pow(2,14))}=e,i="bytes"!==t?"length":"byteLength";return function*(t){let o=0;const r=YE(e);for(const e of t)r.append(e)[i]>=n&&++o&&(yield r.toVector());(r.finish().length>0||0===o)&&(yield r.toVector())}}function ZE(e,t){return function(e,t){const n=[...e.fields],i=[],o={numBatches:t.reduce((e,t)=>Math.max(e,t.length),0)};let r=0,s=0,a=-1;const l=t.length;let c,u=[];for(;o.numBatches-- >0;){for(s=Number.POSITIVE_INFINITY,a=-1;++a<l;)u[a]=c=t[a].shift(),s=Math.min(s,c?c.length:s);Number.isFinite(s)&&(u=QE(n,s,u,t,o),s>0&&(i[r++]=Aw({type:new Pv(n),length:s,nullCount:0,children:u.slice()})))}return[e=e.assign(n),i.map(t=>new iT(e,t))]}(e,t.map(e=>e.data.concat()))}function QE(e,t,n,i,o){var r;const s=(t+63&-64)>>3;for(let a=-1,l=i.length;++a<l;){const l=n[a],c=null==l?void 0:l.length;if(c>=t)c===t?n[a]=l:(n[a]=l.slice(0,t),o.numBatches=Math.max(o.numBatches,i[a].unshift(l.slice(t,c-t))));else{const i=e[a];e[a]=i.clone({nullable:!0}),n[a]=null!==(r=null==l?void 0:l._changeLengthAndBackfillNullBitmap(t))&&void 0!==r?r:Aw({type:i.type,length:t,nullCount:t,nullBitmap:new Uint8Array(s)})}}return n}var JE,eT;class tT{constructor(...e){var t,n;if(0===e.length)return this.batches=[],this.schema=new cS([]),this._offsets=[0],this;let i,o;e[0]instanceof cS&&(i=e.shift()),e.at(-1)instanceof Uint32Array&&(o=e.pop());const r=e=>{if(e){if(e instanceof iT)return[e];if(e instanceof tT)return e.batches;if(e instanceof Tw){if(e.type instanceof Pv)return[new iT(new cS(e.type.children),e)]}else{if(Array.isArray(e))return e.flatMap(e=>r(e));if("function"==typeof e[Symbol.iterator])return[...e].flatMap(e=>r(e));if("object"==typeof e){const t=Object.keys(e),n=t.map(t=>new Xw([e[t]])),o=null!=i?i:new cS(t.map((e,t)=>new uS(String(e),n[t].type,n[t].nullable))),[,r]=ZE(o,n);return 0===r.length?[new iT(e)]:r}}}return[]},s=e.flatMap(e=>r(e));if(i=null!==(n=null!=i?i:null===(t=s[0])||void 0===t?void 0:t.schema)&&void 0!==n?n:new cS([]),!(i instanceof cS))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");for(const a of s){if(!(a instanceof iT))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");if(!jE(i,a.schema))throw new TypeError("Table and inner RecordBatch schemas must be equivalent.")}this.schema=i,this.batches=s,this._offsets=null!=o?o:Rw(this.data)}get data(){return this.batches.map(({data:e})=>e)}get numCols(){return this.schema.fields.length}get numRows(){return this.data.reduce((e,t)=>e+t.length,0)}get nullCount(){return-1===this._nullCount&&(this._nullCount=Lw(this.data)),this._nullCount}isValid(e){return!1}get(e){return null}at(e){return this.get(pw(e,this.numRows))}set(e,t){}indexOf(e,t){return-1}[Symbol.iterator](){return this.batches.length>0?Ww.visit(new Xw(this.data)):new Array(0)[Symbol.iterator]()}toArray(){return[...this]}toString(){return`[\n  ${this.toArray().join(",\n  ")}\n]`}concat(...e){const t=this.schema,n=this.data.concat(e.flatMap(({data:e})=>e));return new tT(t,n.map(e=>new iT(t,e)))}slice(e,t){const n=this.schema;[e,t]=dw({length:this.numRows},e,t);const i=Pw(this.data,this._offsets,e,t);return new tT(n,i.map(e=>new iT(n,e)))}getChild(e){return this.getChildAt(this.schema.fields.findIndex(t=>t.name===e))}getChildAt(e){if(e>-1&&e<this.schema.fields.length){const t=this.data.map(t=>t.children[e]);if(0===t.length){const{type:n}=this.schema.fields[e],i=Aw({type:n,length:0,nullCount:0});t.push(i._changeLengthAndBackfillNullBitmap(this.numRows))}return new Xw(t)}return null}setChild(e,t){var n;return this.setChildAt(null===(n=this.schema.fields)||void 0===n?void 0:n.findIndex(t=>t.name===e),t)}setChildAt(e,t){let n=this.schema,i=[...this.batches];if(e>-1&&e<this.numCols){t||(t=new Xw([Aw({type:new sv,length:this.numRows})]));const o=n.fields.slice(),r=o[e].clone({type:t.type}),s=this.schema.fields.map((e,t)=>this.getChildAt(t));[o[e],s[e]]=[r,t],[n,i]=ZE(n,s)}return new tT(n,i)}select(e){const t=this.schema.fields.reduce((e,t,n)=>e.set(t.name,n),new Map);return this.selectAt(e.map(e=>t.get(e)).filter(e=>e>-1))}selectAt(e){const t=this.schema.selectAt(e),n=this.batches.map(t=>t.selectAt(e));return new tT(t,n)}assign(e){const t=this.schema.fields,[n,i]=e.schema.fields.reduce((e,n,i)=>{const[o,r]=e,s=t.findIndex(e=>e.name===n.name);return~s?r[s]=i:o.push(i),e},[[],[]]),o=this.schema.assign(e.schema),r=[...t.map((e,t)=>[t,i[t]]).map(([t,n])=>void 0===n?this.getChildAt(t):e.getChildAt(n)),...n.map(t=>e.getChildAt(t))].filter(Boolean);return new tT(...ZE(o,r))}}function nT(e){const t={},n=Object.entries(e);for(const[i,o]of n)t[i]=qE(o);return new tT(t)}JE=Symbol.toStringTag,tT[JE]=(e=>(e.schema=null,e.batches=[],e._offsets=new Uint32Array([0]),e._nullCount=-1,e[Symbol.isConcatSpreadable]=!0,e.isValid=Nw(Mw),e.get=Nw(iw.getVisitFn(vb.Struct)),e.set=Ow(Cx.getVisitFn(vb.Struct)),e.indexOf=Bw($w.getVisitFn(vb.Struct)),"Table"))(tT.prototype);let iT=class e{constructor(...e){switch(e.length){case 2:if([this.schema]=e,!(this.schema instanceof cS))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");if([,this.data=Aw({nullCount:0,type:new Pv(this.schema.fields),children:this.schema.fields.map(e=>Aw({type:e.type,nullCount:0}))})]=e,!(this.data instanceof Tw))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");[this.schema,this.data]=oT(this.schema,this.data.children);break;case 1:{const[t]=e,{fields:n,children:i,length:o}=Object.keys(t).reduce((e,n,i)=>(e.children[i]=t[n],e.length=Math.max(e.length,t[n].length),e.fields[i]=uS.new({name:n,type:t[n].type,nullable:!0}),e),{length:0,fields:new Array,children:new Array}),r=new cS(n),s=Aw({type:new Pv(n),length:o,children:i,nullCount:0});[this.schema,this.data]=oT(r,s.children,o);break}default:throw new TypeError("RecordBatch constructor expects an Object mapping names to child Data, or a [Schema, Data] pair.")}}get dictionaries(){return this._dictionaries||(this._dictionaries=rT(this.schema.fields,this.data.children))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.length}get nullCount(){return this.data.nullCount}isValid(e){return this.data.getValid(e)}get(e){return iw.visit(this.data,e)}at(e){return this.get(pw(e,this.numRows))}set(e,t){return Cx.visit(this.data,e,t)}indexOf(e,t){return $w.visit(this.data,e,t)}[Symbol.iterator](){return Ww.visit(new Xw([this.data]))}toArray(){return[...this]}concat(...e){return new tT(this.schema,[this,...e])}slice(t,n){const[i]=new Xw([this.data]).slice(t,n).data;return new e(this.schema,i)}getChild(e){var t;return this.getChildAt(null===(t=this.schema.fields)||void 0===t?void 0:t.findIndex(t=>t.name===e))}getChildAt(e){return e>-1&&e<this.schema.fields.length?new Xw([this.data.children[e]]):null}setChild(e,t){var n;return this.setChildAt(null===(n=this.schema.fields)||void 0===n?void 0:n.findIndex(t=>t.name===e),t)}setChildAt(t,n){let i=this.schema,o=this.data;if(t>-1&&t<this.numCols){n||(n=new Xw([Aw({type:new sv,length:this.numRows})]));const e=i.fields.slice(),r=o.children.slice(),s=e[t].clone({type:n.type});[e[t],r[t]]=[s,n.data[0]],i=new cS(e,new Map(this.schema.metadata)),o=Aw({type:new Pv(e),children:r})}return new e(i,o)}select(t){const n=this.schema.select(t),i=new Pv(n.fields),o=[];for(const e of t){const t=this.schema.fields.findIndex(t=>t.name===e);~t&&(o[t]=this.data.children[t])}return new e(n,Aw({type:i,length:this.numRows,children:o}))}selectAt(t){const n=this.schema.selectAt(t),i=t.map(e=>this.data.children[e]).filter(Boolean),o=Aw({type:new Pv(n.fields),length:this.numRows,children:i});return new e(n,o)}};function oT(e,t,n=t.reduce((e,t)=>Math.max(e,t.length),0)){var i;const o=[...e.fields],r=[...t],s=(n+63&-64)>>3;for(const[a,l]of e.fields.entries()){const e=t[a];e&&e.length===n||(o[a]=l.clone({nullable:!0}),r[a]=null!==(i=null==e?void 0:e._changeLengthAndBackfillNullBitmap(n))&&void 0!==i?i:Aw({type:l.type,length:n,nullCount:n,nullBitmap:new Uint8Array(s)}))}return[e.assign(o),Aw({type:new Pv(o),length:n,children:r})]}function rT(e,t,n=new Map){var i,o;if((null!==(i=null==e?void 0:e.length)&&void 0!==i?i:0)>0&&(null==e?void 0:e.length)===(null==t?void 0:t.length))for(let r=-1,s=e.length;++r<s;){const{type:i}=e[r],s=t[r];for(const e of[s,...(null===(o=null==s?void 0:s.dictionary)||void 0===o?void 0:o.data)||[]])rT(i.children,null==e?void 0:e.children,n);if(rv.isDictionary(i)){const{id:e}=i;if(n.has(e)){if(n.get(e)!==s.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}else(null==s?void 0:s.dictionary)&&n.set(e,s.dictionary)}}return n}eT=Symbol.toStringTag,iT[eT]=(e=>(e._nullCount=-1,e[Symbol.isConcatSpreadable]=!0,"RecordBatch"))(iT.prototype);class sT extends iT{constructor(e){const t=e.fields.map(e=>Aw({type:e.type}));super(e,Aw({type:new Pv(e.fields),nullCount:0,children:t}))}}let aT=class e{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsMessage(t,n){return(n||new e).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMessage(t,n){return t.setPosition(t.position()+4),(n||new e).__init(t.readInt32(t.position())+t.position(),t)}version(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):py.V1}headerType(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):yb.NONE}header(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__union(e,this.bb_pos+t):null}bodyLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}customMetadata(e,t){const n=this.bb.__offset(this.bb_pos,12);return n?(t||new qy).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}static startMessage(e){e.startObject(5)}static addVersion(e,t){e.addFieldInt16(0,t,py.V1)}static addHeaderType(e,t){e.addFieldInt8(1,t,yb.NONE)}static addHeader(e,t){e.addFieldOffset(2,t,0)}static addBodyLength(e,t){e.addFieldInt64(3,t,BigInt("0"))}static addCustomMetadata(e,t){e.addFieldOffset(4,t,0)}static createCustomMetadataVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startCustomMetadataVector(e,t){e.startVector(4,t,4)}static endMessage(e){return e.endObject()}static finishMessageBuffer(e,t){e.finish(t)}static finishSizePrefixedMessageBuffer(e,t){e.finish(t,void 0,!0)}static createMessage(t,n,i,o,r,s){return e.startMessage(t),e.addVersion(t,n),e.addHeaderType(t,i),e.addHeader(t,o),e.addBodyLength(t,r),e.addCustomMetadata(t,s),e.endMessage(t)}};const lT=new class extends Uv{visit(e,t){return null==e||null==t?void 0:super.visit(e,t)}visitNull(e,t){return lb.startNull(t),lb.endNull(t)}visitInt(e,t){return jy.startInt(t),jy.addBitWidth(t,e.bitWidth),jy.addIsSigned(t,e.isSigned),jy.endInt(t)}visitFloat(e,t){return nb.startFloatingPoint(t),nb.addPrecision(t,e.precision),nb.endFloatingPoint(t)}visitBinary(e,t){return Xy.startBinary(t),Xy.endBinary(t)}visitLargeBinary(e,t){return ob.startLargeBinary(t),ob.endLargeBinary(t)}visitBool(e,t){return Ky.startBool(t),Ky.endBool(t)}visitUtf8(e,t){return pb.startUtf8(t),pb.endUtf8(t)}visitLargeUtf8(e,t){return rb.startLargeUtf8(t),rb.endLargeUtf8(t)}visitDecimal(e,t){return Qy.startDecimal(t),Qy.addScale(t,e.scale),Qy.addPrecision(t,e.precision),Qy.addBitWidth(t,e.bitWidth),Qy.endDecimal(t)}visitDate(e,t){return Zy.startDate(t),Zy.addUnit(t,e.unit),Zy.endDate(t)}visitTime(e,t){return ub.startTime(t),ub.addUnit(t,e.unit),ub.addBitWidth(t,e.bitWidth),ub.endTime(t)}visitTimestamp(e,t){const n=e.timezone&&t.createString(e.timezone)||void 0;return hb.startTimestamp(t),hb.addUnit(t,e.unit),void 0!==n&&hb.addTimezone(t,n),hb.endTimestamp(t)}visitInterval(e,t){return ib.startInterval(t),ib.addUnit(t,e.unit),ib.endInterval(t)}visitDuration(e,t){return Jy.startDuration(t),Jy.addUnit(t,e.unit),Jy.endDuration(t)}visitList(e,t){return sb.startList(t),sb.endList(t)}visitStruct(e,t){return cb.startStruct_(t),cb.endStruct_(t)}visitUnion(e,t){db.startTypeIdsVector(t,e.typeIds.length);const n=db.createTypeIdsVector(t,e.typeIds);return db.startUnion(t),db.addMode(t,e.mode),db.addTypeIds(t,n),db.endUnion(t)}visitDictionary(e,t){const n=this.visit(e.indices,t);return Yy.startDictionaryEncoding(t),Yy.addId(t,BigInt(e.id)),Yy.addIsOrdered(t,e.isOrdered),void 0!==n&&Yy.addIndexType(t,n),Yy.endDictionaryEncoding(t)}visitFixedSizeBinary(e,t){return eb.startFixedSizeBinary(t),eb.addByteWidth(t,e.byteWidth),eb.endFixedSizeBinary(t)}visitFixedSizeList(e,t){return tb.startFixedSizeList(t),tb.addListSize(t,e.listSize),tb.endFixedSizeList(t)}visitMap(e,t){return ab.startMap(t),ab.addKeysSorted(t,e.keysSorted),ab.endMap(t)}};function cT(e){return new bT(e.count,hT(e.columns),dT(e.columns))}function uT(e,t){return(e.children||[]).filter(Boolean).map(e=>uS.fromJSON(e,t))}function hT(e){return(e||[]).reduce((e,t)=>{return[...e,new wT(t.count,(n=t.VALIDITY,(n||[]).reduce((e,t)=>e+ +(0===t),0))),...hT(t.children)];var n},[])}function dT(e,t=[]){for(let n=-1,i=(e||[]).length;++n<i;){const i=e[n];i.VALIDITY&&t.push(new xT(t.length,i.VALIDITY.length)),i.TYPE_ID&&t.push(new xT(t.length,i.TYPE_ID.length)),i.OFFSET&&t.push(new xT(t.length,i.OFFSET.length)),i.DATA&&t.push(new xT(t.length,i.DATA.length)),t=dT(i.children,t)}return t}function pT(e=[]){return new Map(e.map(({key:e,value:t})=>[e,t]))}function fT(e){return new av(e.isSigned,e.bitWidth)}function mT(e,t){const n=e.type.name;switch(n){case"NONE":case"null":return new sv;case"binary":return new bv;case"largebinary":return new vv;case"utf8":return new xv;case"largeutf8":return new wv;case"bool":return new Sv;case"list":return new Rv((t||[])[0]);case"struct":case"struct_":return new Pv(t||[])}switch(n){case"int":{const t=e.type;return new av(t.isSigned,t.bitWidth)}case"floatingpoint":{const t=e.type;return new _v(gy[t.precision])}case"decimal":{const t=e.type;return new Ev(t.scale,t.precision,t.bitWidth)}case"date":{const t=e.type;return new Tv(by[t.unit])}case"time":{const t=e.type;return new Cv(xy[t.unit],t.bitWidth)}case"timestamp":{const t=e.type;return new Iv(xy[t.unit],t.timezone)}case"interval":{const t=e.type;return new kv(Sy[t.unit])}case"duration":{const t=e.type;return new Lv(xy[t.unit])}case"union":{const n=e.type,[i,...o]=(n.mode+"").toLowerCase(),r=i.toUpperCase()+o.join("");return new Dv(my[r],n.typeIds||[],t||[])}case"fixedsizebinary":{const t=e.type;return new Mv(t.byteWidth)}case"fixedsizelist":{const n=e.type;return new Nv(n.listSize,(t||[])[0])}case"map":{const n=e.type;return new Ov((t||[])[0],n.keysSorted)}}throw new Error(`Unrecognized type: "${n}"`)}var _T=Py,gT=Ry;class yT{static fromJSON(e,t){const n=new yT(0,py.V5,t);return n._createHeader=function(e,t){return()=>{switch(t){case yb.Schema:return cS.fromJSON(e);case yb.RecordBatch:return bT.fromJSON(e);case yb.DictionaryBatch:return vT.fromJSON(e)}throw new Error(`Unrecognized Message type: { name: ${yb[t]}, type: ${t} }`)}}(e,t),n}static decode(e){e=new gT(oy(e));const t=aT.getRootAsMessage(e),n=t.bodyLength(),i=t.version(),o=t.headerType(),r=new yT(n,i,o);return r._createHeader=function(e,t){return()=>{switch(t){case yb.Schema:return cS.decode(e.header(new gb),new Map,e.version());case yb.RecordBatch:return bT.decode(e.header(new Uy),e.version());case yb.DictionaryBatch:return vT.decode(e.header(new $y),e.version())}throw new Error(`Unrecognized Message type: { name: ${yb[t]}, type: ${t} }`)}}(t,o),r}static encode(e){const t=new _T;let n=-1;return e.isSchema()?n=cS.encode(t,e.header()):e.isRecordBatch()?n=bT.encode(t,e.header()):e.isDictionaryBatch()&&(n=vT.encode(t,e.header())),aT.startMessage(t),aT.addVersion(t,py.V5),aT.addHeader(t,n),aT.addHeaderType(t,e.headerType),aT.addBodyLength(t,BigInt(e.bodyLength)),aT.finishMessageBuffer(t,aT.endMessage(t)),t.asUint8Array()}static from(e,t=0){if(e instanceof cS)return new yT(0,py.V5,yb.Schema,e);if(e instanceof bT)return new yT(t,py.V5,yb.RecordBatch,e);if(e instanceof vT)return new yT(t,py.V5,yb.DictionaryBatch,e);throw new Error(`Unrecognized Message header: ${e}`)}get type(){return this.headerType}get version(){return this._version}get headerType(){return this._headerType}get bodyLength(){return this._bodyLength}header(){return this._createHeader()}isSchema(){return this.headerType===yb.Schema}isRecordBatch(){return this.headerType===yb.RecordBatch}isDictionaryBatch(){return this.headerType===yb.DictionaryBatch}constructor(e,t,n,i){this._version=t,this._headerType=n,this.body=new Uint8Array(0),i&&(this._createHeader=()=>i),this._bodyLength=Eb(e)}}class bT{get nodes(){return this._nodes}get length(){return this._length}get buffers(){return this._buffers}constructor(e,t,n){this._nodes=t,this._buffers=n,this._length=Eb(e)}}class vT{get id(){return this._id}get data(){return this._data}get isDelta(){return this._isDelta}get length(){return this.data.length}get nodes(){return this.data.nodes}get buffers(){return this.data.buffers}constructor(e,t,n=!1){this._data=e,this._isDelta=n,this._id=Eb(t)}}class xT{constructor(e,t){this.offset=Eb(e),this.length=Eb(t)}}class wT{constructor(e,t){this.length=Eb(e),this.nullCount=Eb(t)}}function ST(e,t){const n=[];for(let i,o=-1,r=-1,s=e.childrenLength();++o<s;)(i=e.children(o))&&(n[++r]=uS.decode(i,t));return n}function ET(e){const t=new Map;if(e)for(let n,i,o=-1,r=Math.trunc(e.customMetadataLength());++o<r;)(n=e.customMetadata(o))&&null!=(i=n.key())&&t.set(i,n.value());return t}function TT(e){return new av(e.isSigned(),e.bitWidth())}function CT(e,t){const n=e.typeType();switch(n){case fb.NONE:case fb.Null:return new sv;case fb.Binary:return new bv;case fb.LargeBinary:return new vv;case fb.Utf8:return new xv;case fb.LargeUtf8:return new wv;case fb.Bool:return new Sv;case fb.List:return new Rv((t||[])[0]);case fb.Struct_:return new Pv(t||[])}switch(n){case fb.Int:{const t=e.type(new jy);return new av(t.isSigned(),t.bitWidth())}case fb.FloatingPoint:{const t=e.type(new nb);return new _v(t.precision())}case fb.Decimal:{const t=e.type(new Qy);return new Ev(t.scale(),t.precision(),t.bitWidth())}case fb.Date:{const t=e.type(new Zy);return new Tv(t.unit())}case fb.Time:{const t=e.type(new ub);return new Cv(t.unit(),t.bitWidth())}case fb.Timestamp:{const t=e.type(new hb);return new Iv(t.unit(),t.timezone())}case fb.Interval:{const t=e.type(new ib);return new kv(t.unit())}case fb.Duration:{const t=e.type(new Jy);return new Lv(t.unit())}case fb.Union:{const n=e.type(new db);return new Dv(n.mode(),n.typeIdsArray()||[],t||[])}case fb.FixedSizeBinary:{const t=e.type(new eb);return new Mv(t.byteWidth())}case fb.FixedSizeList:{const n=e.type(new tb);return new Nv(n.listSize(),(t||[])[0])}case fb.Map:{const n=e.type(new ab);return new Ov((t||[])[0],n.keysSorted())}}throw new Error(`Unrecognized type: "${fb[n]}" (${n})`)}uS.encode=function(e,t){let n=-1,i=-1,o=-1;const r=t.type;let s=t.typeId;rv.isDictionary(r)?(s=r.dictionary.typeId,o=lT.visit(r,e),i=lT.visit(r.dictionary,e)):i=lT.visit(r,e);const a=(r.children||[]).map(t=>uS.encode(e,t)),l=_b.createChildrenVector(e,a),c=t.metadata&&t.metadata.size>0?_b.createCustomMetadataVector(e,[...t.metadata].map(([t,n])=>{const i=e.createString(`${t}`),o=e.createString(`${n}`);return qy.startKeyValue(e),qy.addKey(e,i),qy.addValue(e,o),qy.endKeyValue(e)})):-1;return t.name&&(n=e.createString(t.name)),_b.startField(e),_b.addType(e,i),_b.addTypeType(e,s),_b.addChildren(e,l),_b.addNullable(e,!!t.nullable),-1!==n&&_b.addName(e,n),-1!==o&&_b.addDictionary(e,o),-1!==c&&_b.addCustomMetadata(e,c),_b.endField(e)},uS.decode=function(e,t){let n,i,o,r,s,a;return t&&(a=e.dictionary())?t.has(n=Eb(a.id()))?(r=(r=a.indexType())?TT(r):new uv,s=new Fv(t.get(n),r,n,a.isOrdered()),i=new uS(e.name(),s,e.nullable(),ET(e))):(r=(r=a.indexType())?TT(r):new uv,t.set(n,o=CT(e,ST(e,t))),s=new Fv(o,r,n,a.isOrdered()),i=new uS(e.name(),s,e.nullable(),ET(e))):(o=CT(e,ST(e,t)),i=new uS(e.name(),o,e.nullable(),ET(e))),i||null},uS.fromJSON=function(e,t){let n,i,o,r,s,a;return t&&(r=e.dictionary)?t.has(n=r.id)?(i=(i=r.indexType)?fT(i):new uv,a=new Fv(t.get(n),i,n,r.isOrdered),o=new uS(e.name,a,e.nullable,pT(e.metadata))):(i=(i=r.indexType)?fT(i):new uv,t.set(n,s=mT(e,uT(e,t))),a=new Fv(s,i,n,r.isOrdered),o=new uS(e.name,a,e.nullable,pT(e.metadata))):(s=mT(e,uT(e,t)),o=new uS(e.name,s,e.nullable,pT(e.metadata))),o||null},cS.encode=function(e,t){const n=t.fields.map(t=>uS.encode(e,t));gb.startFieldsVector(e,n.length);const i=gb.createFieldsVector(e,n),o=t.metadata&&t.metadata.size>0?gb.createCustomMetadataVector(e,[...t.metadata].map(([t,n])=>{const i=e.createString(`${t}`),o=e.createString(`${n}`);return qy.startKeyValue(e),qy.addKey(e,i),qy.addValue(e,o),qy.endKeyValue(e)})):-1;return gb.startSchema(e),gb.addFields(e,i),gb.addEndianness(e,IT?Vy.Little:Vy.Big),-1!==o&&gb.addCustomMetadata(e,o),gb.endSchema(e)},cS.decode=function(e,t=new Map,n=py.V5){const i=function(e,t){const n=[];for(let i,o=-1,r=-1,s=e.fieldsLength();++o<s;)(i=e.fields(o))&&(n[++r]=uS.decode(i,t));return n}(e,t);return new cS(i,ET(e),t,n)},cS.fromJSON=function(e,t=new Map){return new cS(function(e,t){return(e.fields||[]).filter(Boolean).map(e=>uS.fromJSON(e,t))}(e,t),pT(e.metadata),t)},bT.encode=function(e,t){const n=t.nodes||[],i=t.buffers||[];Uy.startNodesVector(e,n.length);for(const s of n.slice().reverse())wT.encode(e,s);const o=e.endVector();Uy.startBuffersVector(e,i.length);for(const s of i.slice().reverse())xT.encode(e,s);const r=e.endVector();return Uy.startRecordBatch(e),Uy.addLength(e,BigInt(t.length)),Uy.addNodes(e,o),Uy.addBuffers(e,r),Uy.endRecordBatch(e)},bT.decode=function(e,t=py.V5){if(null!==e.compression())throw new Error("Record batch compression not implemented");return new bT(e.length(),function(e){const t=[];for(let n,i=-1,o=-1,r=e.nodesLength();++i<r;)(n=e.nodes(i))&&(t[++o]=wT.decode(n));return t}(e),function(e,t){const n=[];for(let i,o=-1,r=-1,s=e.buffersLength();++o<s;)(i=e.buffers(o))&&(t<py.V4&&(i.bb_pos+=8*(o+1)),n[++r]=xT.decode(i));return n}(e,t))},bT.fromJSON=cT,vT.encode=function(e,t){const n=bT.encode(e,t.data);return $y.startDictionaryBatch(e),$y.addId(e,BigInt(t.id)),$y.addIsDelta(e,t.isDelta),$y.addData(e,n),$y.endDictionaryBatch(e)},vT.decode=function(e,t=py.V5){return new vT(bT.decode(e.data(),t),e.id(),e.isDelta())},vT.fromJSON=function(e){return new vT(cT(e.data),e.id,e.isDelta)},wT.encode=function(e,t){return zy.createFieldNode(e,BigInt(t.length),BigInt(t.nullCount))},wT.decode=function(e){return new wT(e.length(),e.nullCount())},xT.encode=function(e,t){return Fy.createBuffer(e,BigInt(t.offset),BigInt(t.length))},xT.decode=function(e){return new xT(e.offset(),e.length())};const IT=(()=>{const e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]})(),AT=e=>`Expected ${yb[e]} Message in stream, but was null or length 0.`,kT=e=>`Header pointer of flatbuffer-encoded ${yb[e]} Message is null or length 0.`,LT=(e,t)=>`Expected to read ${e} metadata bytes, but only read ${t}.`,RT=(e,t)=>`Expected to read ${e} bytes for message body, but only read ${t}.`;class PT{constructor(e){this.source=e instanceof SS?e:new SS(e)}[Symbol.iterator](){return this}next(){let e;return(e=this.readMetadataLength()).done||-1===e.value&&(e=this.readMetadataLength()).done||(e=this.readMetadata(e.value)).done?yS:e}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}readMessage(e){let t;if((t=this.next()).done)return null;if(null!=e&&t.value.headerType!==e)throw new Error(AT(e));return t.value}readMessageBody(e){if(e<=0)return new Uint8Array(0);const t=oy(this.source.read(e));if(t.byteLength<e)throw new Error(RT(e,t.byteLength));return t.byteOffset%8==0&&t.byteOffset+t.byteLength<=t.buffer.byteLength?t:t.slice()}readSchema(e=!1){const t=yb.Schema,n=this.readMessage(t),i=null==n?void 0:n.header();if(e&&!i)throw new Error(kT(t));return i}readMetadataLength(){const e=this.source.read(NT),t=e&&new Ry(e),n=(null==t?void 0:t.readInt32(0))||0;return{done:0===n,value:n}}readMetadata(e){const t=this.source.read(e);if(!t)return yS;if(t.byteLength<e)throw new Error(LT(e,t.byteLength));return{done:!1,value:yT.decode(t)}}}class DT{constructor(e,t){this.source=e instanceof ES?e:Yg(e)?new AS(e,t):new ES(e)}[Symbol.asyncIterator](){return this}next(){return Lg(this,void 0,void 0,function*(){let e;return(e=yield this.readMetadataLength()).done||-1===e.value&&(e=yield this.readMetadataLength()).done||(e=yield this.readMetadata(e.value)).done?yS:e})}throw(e){return Lg(this,void 0,void 0,function*(){return yield this.source.throw(e)})}return(e){return Lg(this,void 0,void 0,function*(){return yield this.source.return(e)})}readMessage(e){return Lg(this,void 0,void 0,function*(){let t;if((t=yield this.next()).done)return null;if(null!=e&&t.value.headerType!==e)throw new Error(AT(e));return t.value})}readMessageBody(e){return Lg(this,void 0,void 0,function*(){if(e<=0)return new Uint8Array(0);const t=oy(yield this.source.read(e));if(t.byteLength<e)throw new Error(RT(e,t.byteLength));return t.byteOffset%8==0&&t.byteOffset+t.byteLength<=t.buffer.byteLength?t:t.slice()})}readSchema(){return Lg(this,arguments,void 0,function*(e=!1){const t=yb.Schema,n=yield this.readMessage(t),i=null==n?void 0:n.header();if(e&&!i)throw new Error(kT(t));return i})}readMetadataLength(){return Lg(this,void 0,void 0,function*(){const e=yield this.source.read(NT),t=e&&new Ry(e),n=(null==t?void 0:t.readInt32(0))||0;return{done:0===n,value:n}})}readMetadata(e){return Lg(this,void 0,void 0,function*(){const t=yield this.source.read(e);if(!t)return yS;if(t.byteLength<e)throw new Error(LT(e,t.byteLength));return{done:!1,value:yT.decode(t)}})}}class MT extends PT{constructor(e){super(new Uint8Array(0)),this._schema=!1,this._body=[],this._batchIndex=0,this._dictionaryIndex=0,this._json=e instanceof bS?e:new bS(e)}next(){const{_json:e}=this;if(!this._schema)return this._schema=!0,{done:!1,value:yT.fromJSON(e.schema,yb.Schema)};if(this._dictionaryIndex<e.dictionaries.length){const t=e.dictionaries[this._dictionaryIndex++];return this._body=t.data.columns,{done:!1,value:yT.fromJSON(t,yb.DictionaryBatch)}}if(this._batchIndex<e.batches.length){const t=e.batches[this._batchIndex++];return this._body=t.columns,{done:!1,value:yT.fromJSON(t,yb.RecordBatch)}}return this._body=[],yS}readMessageBody(e){return function e(t){return(t||[]).reduce((t,n)=>[...t,...n.VALIDITY&&[n.VALIDITY]||[],...n.TYPE_ID&&[n.TYPE_ID]||[],...n.OFFSET&&[n.OFFSET]||[],...n.DATA&&[n.DATA]||[],...e(n.children)],[])}(this._body)}readMessage(e){let t;if((t=this.next()).done)return null;if(null!=e&&t.value.headerType!==e)throw new Error(AT(e));return t.value}readSchema(){const e=yb.Schema,t=this.readMessage(e),n=null==t?void 0:t.header();if(!t||!n)throw new Error(kT(e));return n}}const NT=4,OT=new Uint8Array(6);for(let H$=0;H$<6;H$+=1)OT[H$]="ARROW1".codePointAt(H$);function BT(e,t=0){for(let n=-1,i=OT.length;++n<i;)if(OT[n]!==e[t+n])return!1;return!0}const FT=OT.length,zT=FT+NT,UT=2*FT+NT;class $T extends vS{constructor(e){super(),this._impl=e}get closed(){return this._impl.closed}get schema(){return this._impl.schema}get autoDestroy(){return this._impl.autoDestroy}get dictionaries(){return this._impl.dictionaries}get numDictionaries(){return this._impl.numDictionaries}get numRecordBatches(){return this._impl.numRecordBatches}get footer(){return this._impl.isFile()?this._impl.footer:null}isSync(){return this._impl.isSync()}isAsync(){return this._impl.isAsync()}isFile(){return this._impl.isFile()}isStream(){return this._impl.isStream()}next(){return this._impl.next()}throw(e){return this._impl.throw(e)}return(e){return this._impl.return(e)}cancel(){return this._impl.cancel()}reset(e){return this._impl.reset(e),this._DOMStream=void 0,this._nodeStream=void 0,this}open(e){const t=this._impl.open(e);return Vg(t)?t.then(()=>this):this}readRecordBatch(e){return this._impl.isFile()?this._impl.readRecordBatch(e):null}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}toDOMStream(){return cy.toDOMStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this})}toNodeStream(){return cy.toNodeStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this},{objectMode:!0})}static throughNode(e){throw new Error('"throughNode" not available in this environment')}static throughDOM(e,t){throw new Error('"throughDOM" not available in this environment')}static from(e){return e instanceof $T?e:Wg(e)?function(e){return new VT(new ZT(e))}(e):Yg(e)?function(e){return Lg(this,void 0,void 0,function*(){const{size:t}=yield e.stat(),n=new AS(e,t);return t>=UT&&BT(yield n.readAt(0,FT+7&-8))?new WT(new KT(n)):new HT(new qT(n))})}(e):Vg(e)?(()=>Lg(this,void 0,void 0,function*(){return yield $T.from(yield e)}))():qg(e)||Kg(e)||Zg(e)||Gg(e)?function(e){return Lg(this,void 0,void 0,function*(){const t=yield e.peek(FT+7&-8);return t&&t.byteLength>=4?BT(t)?new GT(new XT(yield e.read())):new HT(new qT(e)):new HT(new qT(function(){return Pg(this,arguments,function*(){})}()))})}(new ES(e)):function(e){const t=e.peek(FT+7&-8);return t&&t.byteLength>=4?BT(t)?new GT(new XT(e.read())):new VT(new YT(e)):new VT(new YT(function*(){}()))}(new SS(e))}static readAll(e){return e instanceof $T?e.isSync()?JT(e):eC(e):Wg(e)||ArrayBuffer.isView(e)||Hg(e)||jg(e)?JT(e):eC(e)}}class VT extends $T{constructor(e){super(e),this._impl=e}readAll(){return[...this]}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return Pg(this,arguments,function*(){yield Rg(yield*Dg(Mg(this[Symbol.iterator]())))})}}class HT extends $T{constructor(e){super(e),this._impl=e}readAll(){return Lg(this,void 0,void 0,function*(){var e,t,n,i;const o=new Array;try{for(var r,s=!0,a=Mg(this);!(e=(r=yield a.next()).done);s=!0){i=r.value,s=!1;const e=i;o.push(e)}}catch(l){t={error:l}}finally{try{s||e||!(n=a.return)||(yield n.call(a))}finally{if(t)throw t.error}}return o})}[Symbol.iterator](){throw new Error("AsyncRecordBatchStreamReader is not Iterable")}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}}class GT extends VT{constructor(e){super(e),this._impl=e}}class WT extends HT{constructor(e){super(e),this._impl=e}}class jT{get numDictionaries(){return this._dictionaryIndex}get numRecordBatches(){return this._recordBatchIndex}constructor(e=new Map){this.closed=!1,this.autoDestroy=!0,this._dictionaryIndex=0,this._recordBatchIndex=0,this.dictionaries=e}isSync(){return!1}isAsync(){return!1}isFile(){return!1}isStream(){return!1}reset(e){return this._dictionaryIndex=0,this._recordBatchIndex=0,this.schema=e,this.dictionaries=new Map,this}_loadRecordBatch(e,t){const n=this._loadVectors(e,t,this.schema.fields),i=Aw({type:new Pv(this.schema.fields),length:e.length,children:n});return new iT(this.schema,i)}_loadDictionaryBatch(e,t){const{id:n,isDelta:i}=e,{dictionaries:o,schema:r}=this,s=o.get(n),a=r.dictionaries.get(n),l=this._loadVectors(e.data,t,[a]);return(s&&i?s.concat(new Xw(l)):new Xw(l)).memoize()}_loadVectors(e,t,n){return new NS(t,e.nodes,e.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(n)}}class YT extends jT{constructor(e,t){super(t),this._reader=Wg(e)?new MT(this._handle=e):new PT(this._handle=e)}isSync(){return!0}isStream(){return!0}[Symbol.iterator](){return this}cancel(){!this.closed&&(this.closed=!0)&&(this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}open(e){return this.closed||(this.autoDestroy=QT(this,e),this.schema||(this.schema=this._reader.readSchema())||this.cancel()),this}throw(e){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.throw(e):yS}return(e){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.return(e):yS}next(){if(this.closed)return yS;let e;const{_reader:t}=this;for(;e=this._readNextMessageAndValidate();)if(e.isSchema())this.reset(e.header());else{if(e.isRecordBatch()){this._recordBatchIndex++;const n=e.header(),i=t.readMessageBody(e.bodyLength);return{done:!1,value:this._loadRecordBatch(n,i)}}if(e.isDictionaryBatch()){this._dictionaryIndex++;const n=e.header(),i=t.readMessageBody(e.bodyLength),o=this._loadDictionaryBatch(n,i);this.dictionaries.set(n.id,o)}}return this.schema&&0===this._recordBatchIndex?(this._recordBatchIndex++,{done:!1,value:new sT(this.schema)}):this.return()}_readNextMessageAndValidate(e){return this._reader.readMessage(e)}}class qT extends jT{constructor(e,t){super(t),this._reader=new DT(this._handle=e)}isAsync(){return!0}isStream(){return!0}[Symbol.asyncIterator](){return this}cancel(){return Lg(this,void 0,void 0,function*(){!this.closed&&(this.closed=!0)&&(yield this.reset()._reader.return(),this._reader=null,this.dictionaries=null)})}open(e){return Lg(this,void 0,void 0,function*(){return this.closed||(this.autoDestroy=QT(this,e),this.schema||(this.schema=yield this._reader.readSchema())||(yield this.cancel())),this})}throw(e){return Lg(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.throw(e):yS})}return(e){return Lg(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.return(e):yS})}next(){return Lg(this,void 0,void 0,function*(){if(this.closed)return yS;let e;const{_reader:t}=this;for(;e=yield this._readNextMessageAndValidate();)if(e.isSchema())yield this.reset(e.header());else{if(e.isRecordBatch()){this._recordBatchIndex++;const n=e.header(),i=yield t.readMessageBody(e.bodyLength);return{done:!1,value:this._loadRecordBatch(n,i)}}if(e.isDictionaryBatch()){this._dictionaryIndex++;const n=e.header(),i=yield t.readMessageBody(e.bodyLength),o=this._loadDictionaryBatch(n,i);this.dictionaries.set(n.id,o)}}return this.schema&&0===this._recordBatchIndex?(this._recordBatchIndex++,{done:!1,value:new sT(this.schema)}):yield this.return()})}_readNextMessageAndValidate(e){return Lg(this,void 0,void 0,function*(){return yield this._reader.readMessage(e)})}}class XT extends YT{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(e,t){super(e instanceof IS?e:new IS(e),t)}isSync(){return!0}isFile(){return!0}open(e){if(!this.closed&&!this._footer){this.schema=(this._footer=this._readFooter()).schema;for(const e of this._footer.dictionaryBatches())e&&this._readDictionaryBatch(this._dictionaryIndex++)}return super.open(e)}readRecordBatch(e){var t;if(this.closed)return null;this._footer||this.open();const n=null===(t=this._footer)||void 0===t?void 0:t.getRecordBatch(e);if(n&&this._handle.seek(n.offset)){const e=this._reader.readMessage(yb.RecordBatch);if(null==e?void 0:e.isRecordBatch()){const t=e.header(),n=this._reader.readMessageBody(e.bodyLength);return this._loadRecordBatch(t,n)}}return null}_readDictionaryBatch(e){var t;const n=null===(t=this._footer)||void 0===t?void 0:t.getDictionaryBatch(e);if(n&&this._handle.seek(n.offset)){const e=this._reader.readMessage(yb.DictionaryBatch);if(null==e?void 0:e.isDictionaryBatch()){const t=e.header(),n=this._reader.readMessageBody(e.bodyLength),i=this._loadDictionaryBatch(t,n);this.dictionaries.set(t.id,i)}}}_readFooter(){const{_handle:e}=this,t=e.size-zT,n=e.readInt32(t),i=e.readAt(t-n,n);return mS.decode(i)}_readNextMessageAndValidate(e){var t;if(this._footer||this.open(),this._footer&&this._recordBatchIndex<this.numRecordBatches){const n=null===(t=this._footer)||void 0===t?void 0:t.getRecordBatch(this._recordBatchIndex);if(n&&this._handle.seek(n.offset))return this._reader.readMessage(e)}return null}}class KT extends qT{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(e,...t){const n="number"!=typeof t[0]?t.shift():void 0,i=t[0]instanceof Map?t.shift():void 0;super(e instanceof AS?e:new AS(e,n),i)}isFile(){return!0}isAsync(){return!0}open(e){const t=Object.create(null,{open:{get:()=>super.open}});return Lg(this,void 0,void 0,function*(){if(!this.closed&&!this._footer){this.schema=(this._footer=yield this._readFooter()).schema;for(const e of this._footer.dictionaryBatches())e&&(yield this._readDictionaryBatch(this._dictionaryIndex++))}return yield t.open.call(this,e)})}readRecordBatch(e){return Lg(this,void 0,void 0,function*(){var t;if(this.closed)return null;this._footer||(yield this.open());const n=null===(t=this._footer)||void 0===t?void 0:t.getRecordBatch(e);if(n&&(yield this._handle.seek(n.offset))){const e=yield this._reader.readMessage(yb.RecordBatch);if(null==e?void 0:e.isRecordBatch()){const t=e.header(),n=yield this._reader.readMessageBody(e.bodyLength);return this._loadRecordBatch(t,n)}}return null})}_readDictionaryBatch(e){return Lg(this,void 0,void 0,function*(){var t;const n=null===(t=this._footer)||void 0===t?void 0:t.getDictionaryBatch(e);if(n&&(yield this._handle.seek(n.offset))){const e=yield this._reader.readMessage(yb.DictionaryBatch);if(null==e?void 0:e.isDictionaryBatch()){const t=e.header(),n=yield this._reader.readMessageBody(e.bodyLength),i=this._loadDictionaryBatch(t,n);this.dictionaries.set(t.id,i)}}})}_readFooter(){return Lg(this,void 0,void 0,function*(){const{_handle:e}=this;e._pending&&(yield e._pending);const t=e.size-zT,n=yield e.readInt32(t),i=yield e.readAt(t-n,n);return mS.decode(i)})}_readNextMessageAndValidate(e){return Lg(this,void 0,void 0,function*(){if(this._footer||(yield this.open()),this._footer&&this._recordBatchIndex<this.numRecordBatches){const t=this._footer.getRecordBatch(this._recordBatchIndex);if(t&&(yield this._handle.seek(t.offset)))return yield this._reader.readMessage(e)}return null})}}class ZT extends YT{constructor(e,t){super(e,t)}_loadVectors(e,t,n){return new OS(t,e.nodes,e.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(n)}}function QT(e,t){return t&&"boolean"==typeof t.autoDestroy?t.autoDestroy:e.autoDestroy}function*JT(e){const t=$T.from(e);try{if(!t.open({autoDestroy:!1}).closed)do{yield t}while(!t.reset().open().closed)}finally{t.cancel()}}function eC(e){return Pg(this,arguments,function*(){const t=yield Rg($T.from(e));try{if(!(yield Rg(t.open({autoDestroy:!1}))).closed)do{yield yield Rg(t)}while(!(yield Rg(t.reset().open())).closed)}finally{yield Rg(t.cancel())}})}class tC extends Uv{static assemble(...e){const t=e=>e.flatMap(e=>Array.isArray(e)?t(e):e instanceof iT?e.data.children:e.data),n=new tC;return n.visitMany(t(e)),n}constructor(){super(),this._byteLength=0,this._nodes=[],this._buffers=[],this._bufferRegions=[]}visit(e){if(e instanceof Xw)return this.visitMany(e.data),this;const{type:t}=e;if(!rv.isDictionary(t)){const{length:n}=e;if(n>2147483647)throw new RangeError("Cannot write arrays larger than 2^31 - 1 in length");if(rv.isUnion(t))this.nodes.push(new wT(n,0));else{const{nullCount:i}=e;rv.isNull(t)||nC.call(this,i<=0?new Uint8Array(0):vw(e.offset,n,e.nullBitmap)),this.nodes.push(new wT(n,i))}}return super.visit(e)}visitNull(e){return this}visitDictionary(e){return this.visit(e.clone(e.type.indices))}get nodes(){return this._nodes}get buffers(){return this._buffers}get byteLength(){return this._byteLength}get bufferRegions(){return this._bufferRegions}}function nC(e){const t=e.byteLength+7&-8;return this.buffers.push(e),this.bufferRegions.push(new xT(this._byteLength,t)),this._byteLength+=t,this}function iC(e){return nC.call(this,e.values.subarray(0,e.length*e.stride))}function oC(e){const{length:t,values:n,valueOffsets:i}=e,o=Eb(i[0]),r=Eb(i[t]),s=Math.min(r-o,n.byteLength-o);return nC.call(this,ly(-o,t+1,i)),nC.call(this,n.subarray(o,o+s)),this}function rC(e){const{length:t,valueOffsets:n}=e;if(n){const{0:i,[t]:o}=n;return nC.call(this,ly(-i,t+1,n)),this.visit(e.children[0].slice(i,o-i))}return this.visit(e.children[0])}function sC(e){return this.visitMany(e.type.children.map((t,n)=>e.children[n]).filter(Boolean))[0]}tC.prototype.visitBool=function(e){let t;return e.nullCount>=e.length?nC.call(this,new Uint8Array(0)):(t=e.values)instanceof Uint8Array?nC.call(this,vw(e.offset,e.length,t)):nC.call(this,xw(e.values))},tC.prototype.visitInt=iC,tC.prototype.visitFloat=iC,tC.prototype.visitUtf8=oC,tC.prototype.visitLargeUtf8=oC,tC.prototype.visitBinary=oC,tC.prototype.visitLargeBinary=oC,tC.prototype.visitFixedSizeBinary=iC,tC.prototype.visitDate=iC,tC.prototype.visitTimestamp=iC,tC.prototype.visitTime=iC,tC.prototype.visitDecimal=iC,tC.prototype.visitList=rC,tC.prototype.visitStruct=sC,tC.prototype.visitUnion=function(e){var t;const{type:n,length:i,typeIds:o,valueOffsets:r}=e;if(nC.call(this,o),n.mode===my.Sparse)return sC.call(this,e);if(n.mode===my.Dense){if(e.offset<=0)return nC.call(this,r),sC.call(this,e);{const s=new Int32Array(i),a=Object.create(null),l=Object.create(null);for(let e,n,c=-1;++c<i;)void 0!==(e=o[c])&&(void 0===(n=a[e])&&(n=a[e]=r[c]),s[c]=r[c]-n,l[e]=(null!==(t=l[e])&&void 0!==t?t:0)+1);nC.call(this,s),this.visitMany(e.children.map((e,t)=>{const o=n.typeIds[t],r=a[o],s=l[o];return e.slice(r,Math.min(i,s))}))}}return this},tC.prototype.visitInterval=iC,tC.prototype.visitDuration=iC,tC.prototype.visitFixedSizeList=rC,tC.prototype.visitMap=rC;class aC extends vS{static throughNode(e){throw new Error('"throughNode" not available in this environment')}static throughDOM(e,t){throw new Error('"throughDOM" not available in this environment')}constructor(e){super(),this._position=0,this._started=!1,this._sink=new wS,this._schema=null,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,$g(e)||(e={autoDestroy:!0,writeLegacyIpcFormat:!1}),this._autoDestroy="boolean"!=typeof e.autoDestroy||e.autoDestroy,this._writeLegacyIpcFormat="boolean"==typeof e.writeLegacyIpcFormat&&e.writeLegacyIpcFormat}toString(e=!1){return this._sink.toString(e)}toUint8Array(e=!1){return this._sink.toUint8Array(e)}writeAll(e){return Vg(e)?e.then(e=>this.writeAll(e)):Gg(e)?hC(this,e):uC(this,e)}get closed(){return this._sink.closed}[Symbol.asyncIterator](){return this._sink[Symbol.asyncIterator]()}toDOMStream(e){return this._sink.toDOMStream(e)}toNodeStream(e){return this._sink.toNodeStream(e)}close(){return this.reset()._sink.close()}abort(e){return this.reset()._sink.abort(e)}finish(){return this._autoDestroy?this.close():this.reset(this._sink,this._schema),this}reset(e=this._sink,t=null){var n;return e===this._sink||e instanceof wS?this._sink=e:(this._sink=new wS,e&&$g(n=e)&&Ug(n.abort)&&Ug(n.getWriter)&&!Xg(n)?this.toDOMStream({type:"bytes"}).pipeTo(e):e&&(e=>$g(e)&&Ug(e.end)&&Ug(e.write)&&zg(e.writable)&&!Xg(e))(e)&&this.toNodeStream({objectMode:!1}).pipe(e)),this._started&&this._schema&&this._writeFooter(this._schema),this._started=!1,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,t&&jE(t,this._schema)||(null==t?(this._position=0,this._schema=null):(this._started=!0,this._schema=t,this._writeSchema(t))),this}write(e){let t=null;if(!this._sink)throw new Error("RecordBatchWriter is closed");if(null==e)return this.finish()&&void 0;if(e instanceof tT&&!(t=e.schema))return this.finish()&&void 0;if(e instanceof iT&&!(t=e.schema))return this.finish()&&void 0;if(t&&!jE(t,this._schema)){if(this._started&&this._autoDestroy)return this.close();this.reset(this._sink,t)}e instanceof iT?e instanceof sT||this._writeRecordBatch(e):e instanceof tT?this.writeAll(e.batches):Hg(e)&&this.writeAll(e)}_writeMessage(e,t=8){const n=t-1,i=yT.encode(e),o=i.byteLength,r=this._writeLegacyIpcFormat?4:8,s=o+r+n&~n,a=s-o-r;return e.headerType===yb.RecordBatch?this._recordBatchBlocks.push(new gS(s,e.bodyLength,this._position)):e.headerType===yb.DictionaryBatch&&this._dictionaryBlocks.push(new gS(s,e.bodyLength,this._position)),this._writeLegacyIpcFormat||this._write(Int32Array.of(-1)),this._write(Int32Array.of(s-r)),o>0&&this._write(i),this._writePadding(a)}_write(e){if(this._started){const t=oy(e);t&&t.byteLength>0&&(this._sink.write(t),this._position+=t.byteLength)}return this}_writeSchema(e){return this._writeMessage(yT.from(e))}_writeFooter(e){return this._writeLegacyIpcFormat?this._write(Int32Array.of(0)):this._write(Int32Array.of(-1,0))}_writeMagic(){return this._write(OT)}_writePadding(e){return e>0?this._write(new Uint8Array(e)):this}_writeRecordBatch(e){const{byteLength:t,nodes:n,bufferRegions:i,buffers:o}=tC.assemble(e),r=new bT(e.numRows,n,i),s=yT.from(r,t);return this._writeDictionaries(e)._writeMessage(s)._writeBodyBuffers(o)}_writeDictionaryBatch(e,t,n=!1){const{byteLength:i,nodes:o,bufferRegions:r,buffers:s}=tC.assemble(new Xw([e])),a=new bT(e.length,o,r),l=new vT(a,t,n),c=yT.from(l,i);return this._writeMessage(c)._writeBodyBuffers(s)}_writeBodyBuffers(e){let t,n,i;for(let o=-1,r=e.length;++o<r;)(t=e[o])&&(n=t.byteLength)>0&&(this._write(t),(i=(n+7&-8)-n)>0&&this._writePadding(i));return this}_writeDictionaries(e){var t,n;for(const[i,o]of e.dictionaries){const e=null!==(t=null==o?void 0:o.data)&&void 0!==t?t:[],r=this._seenDictionaries.get(i),s=null!==(n=this._dictionaryDeltaOffsets.get(i))&&void 0!==n?n:0;if(r&&r.data[0]===e[0]){if(s<e.length)for(const t of e.slice(s))this._writeDictionaryBatch(t,i,!0)}else for(const[t,n]of e.entries())this._writeDictionaryBatch(n,i,t>0);this._seenDictionaries.set(i,o),this._dictionaryDeltaOffsets.set(i,e.length)}return this}}class lC extends aC{static writeAll(e,t){const n=new lC(t);return Vg(e)?e.then(e=>n.writeAll(e)):Gg(e)?hC(n,e):uC(n,e)}}class cC extends aC{static writeAll(e){const t=new cC;return Vg(e)?e.then(e=>t.writeAll(e)):Gg(e)?hC(t,e):uC(t,e)}constructor(){super(),this._autoDestroy=!0}_writeSchema(e){return this._writeMagic()._writePadding(2)}_writeDictionaryBatch(e,t,n=!1){if(!n&&this._seenDictionaries.has(t))throw new Error("The Arrow File format does not support replacement dictionaries. ");return super._writeDictionaryBatch(e,t,n)}_writeFooter(e){const t=mS.encode(new mS(e,py.V5,this._recordBatchBlocks,this._dictionaryBlocks));return super._writeFooter(e)._write(t)._write(Int32Array.of(t.byteLength))._writeMagic()}}function uC(e,t){let n=t;t instanceof tT&&(n=t.batches,e.reset(void 0,t.schema));for(const i of n)e.write(i);return e.finish()}function hC(e,t){return Lg(this,void 0,void 0,function*(){var n,i,o,r,s,a,l;try{for(n=!0,i=Mg(t);!(r=(o=yield i.next()).done);n=!0){l=o.value,n=!1;const t=l;e.write(t)}}catch(c){s={error:c}}finally{try{n||r||!(a=i.return)||(yield a.call(i))}finally{if(s)throw s.error}}return e.finish()})}function dC(e){const t=$T.from(e);return Vg(t)?t.then(e=>dC(e)):t.isAsync()?t.readAll().then(e=>new tT(e)):new tT(t.readAll())}function pC(e,t="stream"){return("stream"===t?lC:cC).writeAll(e).toUint8Array(!0)}var fC,mC,_C,gC,yC,bC,vC,xC=Object.create,wC=Object.defineProperty,SC=Object.getOwnPropertyDescriptor,EC=Object.getOwnPropertyNames,TC=Object.getPrototypeOf,CC=Object.prototype.hasOwnProperty,IC=(fC=(e,t)=>{t.exports=Worker},()=>(mC||fC(mC={exports:{}},mC),mC.exports)),AC=((_C=AC||{})[_C.UNDEFINED=0]="UNDEFINED",_C[_C.AUTOMATIC=1]="AUTOMATIC",_C[_C.READ_ONLY=2]="READ_ONLY",_C[_C.READ_WRITE=3]="READ_WRITE",_C),kC=(e=>(e[e.IDENTIFIER=0]="IDENTIFIER",e[e.NUMERIC_CONSTANT=1]="NUMERIC_CONSTANT",e[e.STRING_CONSTANT=2]="STRING_CONSTANT",e[e.OPERATOR=3]="OPERATOR",e[e.KEYWORD=4]="KEYWORD",e[e.COMMENT=5]="COMMENT",e))(kC||{}),LC=((gC=LC||{})[gC.NONE=0]="NONE",gC[gC.DEBUG=1]="DEBUG",gC[gC.INFO=2]="INFO",gC[gC.WARNING=3]="WARNING",gC[gC.ERROR=4]="ERROR",gC),RC=(e=>(e[e.NONE=0]="NONE",e[e.CONNECT=1]="CONNECT",e[e.DISCONNECT=2]="DISCONNECT",e[e.OPEN=3]="OPEN",e[e.QUERY=4]="QUERY",e[e.INSTANTIATE=5]="INSTANTIATE",e))(RC||{}),PC=(e=>(e[e.NONE=0]="NONE",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR",e[e.START=3]="START",e[e.RUN=4]="RUN",e[e.CAPTURE=5]="CAPTURE",e))(PC||{}),DC=(e=>(e[e.NONE=0]="NONE",e[e.WEB_WORKER=1]="WEB_WORKER",e[e.NODE_WORKER=2]="NODE_WORKER",e[e.BINDINGS=3]="BINDINGS",e[e.ASYNC_DUCKDB=4]="ASYNC_DUCKDB",e))(DC||{}),MC=class{log(e){}},NC=class{constructor(e=2){this.level=e}log(e){e.level,this.level}},OC=((yC=OC||{})[yC.SUCCESS=0]="SUCCESS",yC[yC.MAX_ARROW_ERROR=255]="MAX_ARROW_ERROR",yC[yC.DUCKDB_WASM_RETRY=256]="DUCKDB_WASM_RETRY",yC),BC=class{constructor(e,t){this._bindings=e,this._conn=t}get bindings(){return this._bindings}async close(){return this._bindings.disconnect(this._conn)}useUnsafe(e){return e(this._bindings,this._conn)}async query(e){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:e});let t=await this._bindings.runQuery(this._conn,e),n=$T.from(t);return console.assert(n.isSync(),"Reader is not sync"),console.assert(n.isFile(),"Reader is not file"),new tT(n)}async send(e,t=!1){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:e});let n=await this._bindings.startPendingQuery(this._conn,e,t);for(;null==n;)n=await this._bindings.pollPendingQuery(this._conn);let i=new FC(this._bindings,this._conn,n),o=await $T.from(i);return console.assert(o.isAsync()),console.assert(o.isStream()),o}async cancelSent(){return await this._bindings.cancelPendingQuery(this._conn)}async getTableNames(e){return await this._bindings.getTableNames(this._conn,e)}async prepare(e){let t=await this._bindings.createPrepared(this._conn,e);return new zC(this._bindings,this._conn,t)}async insertArrowTable(e,t){let n=pC(e,"stream");await this.insertArrowFromIPCStream(n,t)}async insertArrowFromIPCStream(e,t){await this._bindings.insertArrowFromIPCStream(this._conn,e,t)}async insertCSVFromPath(e,t){await this._bindings.insertCSVFromPath(this._conn,e,t)}async insertJSONFromPath(e,t){await this._bindings.insertJSONFromPath(this._conn,e,t)}},FC=class{constructor(e,t,n){this.db=e,this.conn=t,this.header=n,this._first=!0,this._depleted=!1,this._inFlight=null}async next(){if(this._first)return this._first=!1,{done:!1,value:this.header};if(this._depleted)return{done:!0,value:null};let e=null;for(null!=this._inFlight&&(e=await this._inFlight,this._inFlight=null);null==e;)e=await this.db.fetchQueryResults(this.conn);return this._depleted=0==e.length,this._depleted||(this._inFlight=this.db.fetchQueryResults(this.conn)),{done:this._depleted,value:e}}[Symbol.asyncIterator](){return this}},zC=class{constructor(e,t,n){this.bindings=e,this.connectionId=t,this.statementId=n}async close(){await this.bindings.closePrepared(this.connectionId,this.statementId)}async query(...e){let t=await this.bindings.runPrepared(this.connectionId,this.statementId,e),n=$T.from(t);return console.assert(n.isSync()),console.assert(n.isFile()),new tT(n)}async send(...e){let t=await this.bindings.sendPrepared(this.connectionId,this.statementId,e),n=new FC(this.bindings,this.connectionId,t),i=await $T.from(n);return console.assert(i.isAsync()),console.assert(i.isStream()),i}},UC=((vC=UC||{}).CANCEL_PENDING_QUERY="CANCEL_PENDING_QUERY",vC.CLOSE_PREPARED="CLOSE_PREPARED",vC.COLLECT_FILE_STATISTICS="COLLECT_FILE_STATISTICS",vC.REGISTER_OPFS_FILE_NAME="REGISTER_OPFS_FILE_NAME",vC.CONNECT="CONNECT",vC.COPY_FILE_TO_BUFFER="COPY_FILE_TO_BUFFER",vC.COPY_FILE_TO_PATH="COPY_FILE_TO_PATH",vC.CREATE_PREPARED="CREATE_PREPARED",vC.DISCONNECT="DISCONNECT",vC.DROP_FILE="DROP_FILE",vC.DROP_FILES="DROP_FILES",vC.EXPORT_FILE_STATISTICS="EXPORT_FILE_STATISTICS",vC.FETCH_QUERY_RESULTS="FETCH_QUERY_RESULTS",vC.FLUSH_FILES="FLUSH_FILES",vC.GET_FEATURE_FLAGS="GET_FEATURE_FLAGS",vC.GET_TABLE_NAMES="GET_TABLE_NAMES",vC.GET_VERSION="GET_VERSION",vC.GLOB_FILE_INFOS="GLOB_FILE_INFOS",vC.INSERT_ARROW_FROM_IPC_STREAM="INSERT_ARROW_FROM_IPC_STREAM",vC.INSERT_CSV_FROM_PATH="IMPORT_CSV_FROM_PATH",vC.INSERT_JSON_FROM_PATH="IMPORT_JSON_FROM_PATH",vC.INSTANTIATE="INSTANTIATE",vC.OPEN="OPEN",vC.PING="PING",vC.POLL_PENDING_QUERY="POLL_PENDING_QUERY",vC.REGISTER_FILE_BUFFER="REGISTER_FILE_BUFFER",vC.REGISTER_FILE_HANDLE="REGISTER_FILE_HANDLE",vC.REGISTER_FILE_URL="REGISTER_FILE_URL",vC.RESET="RESET",vC.RUN_PREPARED="RUN_PREPARED",vC.RUN_QUERY="RUN_QUERY",vC.SEND_PREPARED="SEND_PREPARED",vC.START_PENDING_QUERY="START_PENDING_QUERY",vC.TOKENIZE="TOKENIZE",vC),$C=((bC=$C||{}).CONNECTION_INFO="CONNECTION_INFO",bC.ERROR="ERROR",bC.FEATURE_FLAGS="FEATURE_FLAGS",bC.FILE_BUFFER="FILE_BUFFER",bC.FILE_INFOS="FILE_INFOS",bC.FILE_SIZE="FILE_SIZE",bC.FILE_STATISTICS="FILE_STATISTICS",bC.INSTANTIATE_PROGRESS="INSTANTIATE_PROGRESS",bC.LOG="LOG",bC.PROGRESS_UPDATE="PROGRESS_UPDATE",bC.OK="OK",bC.PREPARED_STATEMENT_ID="PREPARED_STATEMENT_ID",bC.QUERY_PLAN="QUERY_PLAN",bC.QUERY_RESULT="QUERY_RESULT",bC.QUERY_RESULT_CHUNK="QUERY_RESULT_CHUNK",bC.QUERY_RESULT_HEADER="QUERY_RESULT_HEADER",bC.QUERY_RESULT_HEADER_OR_NULL="QUERY_RESULT_HEADER_OR_NULL",bC.REGISTERED_FILE="REGISTERED_FILE",bC.SCRIPT_TOKENS="SCRIPT_TOKENS",bC.SUCCESS="SUCCESS",bC.TABLE_NAMES="TABLE_NAMES",bC.VERSION_STRING="VERSION_STRING",bC),VC=class{constructor(e,t){this.promiseResolver=()=>{},this.promiseRejecter=()=>{},this.type=e,this.data=t,this.promise=new Promise((e,t)=>{this.promiseResolver=e,this.promiseRejecter=t})}};function HC(e){switch(e.typeId){case vb.Binary:return{sqlType:"binary"};case vb.Bool:return{sqlType:"bool"};case vb.Date:return{sqlType:"date"};case vb.DateDay:return{sqlType:"date32[d]"};case vb.DateMillisecond:return{sqlType:"date64[ms]"};case vb.Decimal:{let t=e;return{sqlType:"decimal",precision:t.precision,scale:t.scale}}case vb.Float:return{sqlType:"float"};case vb.Float16:return{sqlType:"float16"};case vb.Float32:return{sqlType:"float32"};case vb.Float64:return{sqlType:"float64"};case vb.Int:return{sqlType:"int32"};case vb.Int16:return{sqlType:"int16"};case vb.Int32:return{sqlType:"int32"};case vb.Int64:return{sqlType:"int64"};case vb.Uint16:return{sqlType:"uint16"};case vb.Uint32:return{sqlType:"uint32"};case vb.Uint64:return{sqlType:"uint64"};case vb.Uint8:return{sqlType:"uint8"};case vb.IntervalDayTime:return{sqlType:"interval[dt]"};case vb.IntervalYearMonth:return{sqlType:"interval[m]"};case vb.List:return{sqlType:"list",valueType:HC(e.valueType)};case vb.FixedSizeBinary:return{sqlType:"fixedsizebinary",byteWidth:e.byteWidth};case vb.Null:return{sqlType:"null"};case vb.Utf8:return{sqlType:"utf8"};case vb.Struct:return{sqlType:"struct",fields:e.children.map(e=>GC(e.name,e.type))};case vb.Map:{let t=e;return{sqlType:"map",keyType:HC(t.keyType),valueType:HC(t.valueType)}}case vb.Time:return{sqlType:"time[s]"};case vb.TimeMicrosecond:return{sqlType:"time[us]"};case vb.TimeMillisecond:return{sqlType:"time[ms]"};case vb.TimeNanosecond:return{sqlType:"time[ns]"};case vb.TimeSecond:return{sqlType:"time[s]"};case vb.Timestamp:return{sqlType:"timestamp",timezone:e.timezone||void 0};case vb.TimestampSecond:return{sqlType:"timestamp[s]",timezone:e.timezone||void 0};case vb.TimestampMicrosecond:return{sqlType:"timestamp[us]",timezone:e.timezone||void 0};case vb.TimestampNanosecond:return{sqlType:"timestamp[ns]",timezone:e.timezone||void 0};case vb.TimestampMillisecond:return{sqlType:"timestamp[ms]",timezone:e.timezone||void 0}}throw new Error("unsupported arrow type: ".concat(e.toString()))}function GC(e,t){let n=HC(t);return n.name=e,n}var WC=new TextEncoder,jC=class{constructor(e,t=null){this._onInstantiationProgress=[],this._onExecutionProgress=[],this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{},this._nextMessageId=0,this._pendingRequests=new Map,this._logger=e,this._onMessageHandler=this.onMessage.bind(this),this._onErrorHandler=this.onError.bind(this),this._onCloseHandler=this.onClose.bind(this),null!=t&&this.attach(t)}get logger(){return this._logger}attach(e){this._worker=e,this._worker.addEventListener("message",this._onMessageHandler),this._worker.addEventListener("error",this._onErrorHandler),this._worker.addEventListener("close",this._onCloseHandler),this._workerShutdownPromise=new Promise((e,t)=>{this._workerShutdownResolver=e})}detach(){this._worker&&(this._worker.removeEventListener("message",this._onMessageHandler),this._worker.removeEventListener("error",this._onErrorHandler),this._worker.removeEventListener("close",this._onCloseHandler),this._worker=null,this._workerShutdownResolver(null),this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async terminate(){this._worker&&(this._worker.terminate(),this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async postTask(e,t=[]){if(!this._worker)return void console.error("cannot send a message since the worker is not set!");let n=this._nextMessageId++;return this._pendingRequests.set(n,e),this._worker.postMessage({messageId:n,type:e.type,data:e.data},t),await e.promise}onMessage(e){var t;let n=e.data;switch(n.type){case"PROGRESS_UPDATE":for(let e of this._onExecutionProgress)e(n.data);return;case"LOG":return void this._logger.log(n.data);case"INSTANTIATE_PROGRESS":for(let e of this._onInstantiationProgress)e(n.data);return}let i=this._pendingRequests.get(n.requestId);if(i){if(this._pendingRequests.delete(n.requestId),"ERROR"==n.type){let e=new Error(n.data.message);return e.name=n.data.name,null!=(t=Object.getOwnPropertyDescriptor(e,"stack"))&&t.writable&&(e.stack=n.data.stack),void i.promiseRejecter(e)}switch(i.type){case"CLOSE_PREPARED":case"COLLECT_FILE_STATISTICS":case"REGISTER_OPFS_FILE_NAME":case"COPY_FILE_TO_PATH":case"DISCONNECT":case"DROP_FILE":case"DROP_FILES":case"FLUSH_FILES":case"INSERT_ARROW_FROM_IPC_STREAM":case"IMPORT_CSV_FROM_PATH":case"IMPORT_JSON_FROM_PATH":case"OPEN":case"PING":case"REGISTER_FILE_BUFFER":case"REGISTER_FILE_HANDLE":case"REGISTER_FILE_URL":case"RESET":if("OK"==n.type)return void i.promiseResolver(n.data);break;case"INSTANTIATE":if(this._onInstantiationProgress=[],"OK"==n.type)return void i.promiseResolver(n.data);break;case"GLOB_FILE_INFOS":if("FILE_INFOS"==n.type)return void i.promiseResolver(n.data);break;case"GET_VERSION":if("VERSION_STRING"==n.type)return void i.promiseResolver(n.data);break;case"GET_FEATURE_FLAGS":if("FEATURE_FLAGS"==n.type)return void i.promiseResolver(n.data);break;case"GET_TABLE_NAMES":if("TABLE_NAMES"==n.type)return void i.promiseResolver(n.data);break;case"TOKENIZE":if("SCRIPT_TOKENS"==n.type)return void i.promiseResolver(n.data);break;case"COPY_FILE_TO_BUFFER":if("FILE_BUFFER"==n.type)return void i.promiseResolver(n.data);break;case"EXPORT_FILE_STATISTICS":if("FILE_STATISTICS"==n.type)return void i.promiseResolver(n.data);break;case"CONNECT":if("CONNECTION_INFO"==n.type)return void i.promiseResolver(n.data);break;case"RUN_PREPARED":case"RUN_QUERY":if("QUERY_RESULT"==n.type)return void i.promiseResolver(n.data);break;case"SEND_PREPARED":if("QUERY_RESULT_HEADER"==n.type)return void i.promiseResolver(n.data);break;case"START_PENDING_QUERY":case"POLL_PENDING_QUERY":if("QUERY_RESULT_HEADER_OR_NULL"==n.type)return void i.promiseResolver(n.data);break;case"CANCEL_PENDING_QUERY":if(this._onInstantiationProgress=[],"SUCCESS"==n.type)return void i.promiseResolver(n.data);break;case"FETCH_QUERY_RESULTS":if("QUERY_RESULT_CHUNK"==n.type)return void i.promiseResolver(n.data);break;case"CREATE_PREPARED":if("PREPARED_STATEMENT_ID"==n.type)return void i.promiseResolver(n.data)}i.promiseRejecter(new Error("unexpected response type: ".concat(n.type.toString())))}else console.warn("unassociated response: [".concat(n.requestId,", ").concat(n.type.toString(),"]"))}onError(e){console.error(e),console.error("error in duckdb worker: ".concat(e.message)),this._pendingRequests.clear()}onClose(){this._workerShutdownResolver(null),0==this._pendingRequests.size?this._pendingRequests.clear():console.warn("worker terminated with ".concat(this._pendingRequests.size," pending requests"))}async reset(){let e=new VC("RESET",null);return await this.postTask(e)}async ping(){let e=new VC("PING",null);await this.postTask(e)}async dropFile(e){let t=new VC("DROP_FILE",e);return await this.postTask(t)}async dropFiles(){let e=new VC("DROP_FILES",null);return await this.postTask(e)}async flushFiles(){let e=new VC("FLUSH_FILES",null);return await this.postTask(e)}async instantiate(e,t=null,n=e=>{}){this._onInstantiationProgress.push(n);let i=new VC("INSTANTIATE",[e,t]);return await this.postTask(i)}async getVersion(){let e=new VC("GET_VERSION",null);return await this.postTask(e)}async getFeatureFlags(){let e=new VC("GET_FEATURE_FLAGS",null);return await this.postTask(e)}async open(e){let t=new VC("OPEN",e);await this.postTask(t)}async tokenize(e){let t=new VC("TOKENIZE",e);return await this.postTask(t)}async connectInternal(){let e=new VC("CONNECT",null);return await this.postTask(e)}async connect(){let e=await this.connectInternal();return new BC(this,e)}async disconnect(e){let t=new VC("DISCONNECT",e);await this.postTask(t)}async runQuery(e,t){let n=new VC("RUN_QUERY",[e,t]);return await this.postTask(n)}async startPendingQuery(e,t,n=!1){let i=new VC("START_PENDING_QUERY",[e,t,n]);return await this.postTask(i)}async pollPendingQuery(e){let t=new VC("POLL_PENDING_QUERY",e);return await this.postTask(t)}async cancelPendingQuery(e){let t=new VC("CANCEL_PENDING_QUERY",e);return await this.postTask(t)}async fetchQueryResults(e){let t=new VC("FETCH_QUERY_RESULTS",e);return await this.postTask(t)}async getTableNames(e,t){let n=new VC("GET_TABLE_NAMES",[e,t]);return await this.postTask(n)}async createPrepared(e,t){let n=new VC("CREATE_PREPARED",[e,t]);return await this.postTask(n)}async closePrepared(e,t){let n=new VC("CLOSE_PREPARED",[e,t]);await this.postTask(n)}async runPrepared(e,t,n){let i=new VC("RUN_PREPARED",[e,t,n]);return await this.postTask(i)}async sendPrepared(e,t,n){let i=new VC("SEND_PREPARED",[e,t,n]);return await this.postTask(i)}async globFiles(e){let t=new VC("GLOB_FILE_INFOS",e);return await this.postTask(t)}async registerFileText(e,t){let n=WC.encode(t);await this.registerFileBuffer(e,n)}async registerFileURL(e,t,n,i){void 0===t&&(t=e);let o=new VC("REGISTER_FILE_URL",[e,t,n,i]);await this.postTask(o)}async registerEmptyFileBuffer(e){}async registerFileBuffer(e,t){let n=new VC("REGISTER_FILE_BUFFER",[e,t]);await this.postTask(n,[t.buffer])}async registerFileHandle(e,t,n,i){let o=new VC("REGISTER_FILE_HANDLE",[e,t,n,i]);await this.postTask(o,[])}async registerOPFSFileName(e){let t=new VC("REGISTER_OPFS_FILE_NAME",[e]);await this.postTask(t,[])}async collectFileStatistics(e,t){let n=new VC("COLLECT_FILE_STATISTICS",[e,t]);await this.postTask(n,[])}async exportFileStatistics(e){let t=new VC("EXPORT_FILE_STATISTICS",e);return await this.postTask(t,[])}async copyFileToBuffer(e){let t=new VC("COPY_FILE_TO_BUFFER",e);return await this.postTask(t)}async copyFileToPath(e,t){let n=new VC("COPY_FILE_TO_PATH",[e,t]);await this.postTask(n)}async insertArrowFromIPCStream(e,t,n){if(0==t.length)return;let i=new VC("INSERT_ARROW_FROM_IPC_STREAM",[e,t,n]);await this.postTask(i,[t.buffer])}async insertCSVFromPath(e,t,n){if(void 0!==n.columns){let e=[];for(let t in n.columns){let i=n.columns[t];e.push(GC(t,i))}n.columnsFlat=e,delete n.columns}let i=new VC("IMPORT_CSV_FROM_PATH",[e,t,n]);await this.postTask(i)}async insertJSONFromPath(e,t,n){if(void 0!==n.columns){let e=[];for(let t in n.columns){let i=n.columns[t];e.push(GC(t,i))}n.columnsFlat=e,delete n.columns}let i=new VC("IMPORT_JSON_FROM_PATH",[e,t,n]);await this.postTask(i)}};new TextDecoder;var YC=(e=>(e[e.BUFFER=0]="BUFFER",e[e.NODE_FS=1]="NODE_FS",e[e.BROWSER_FILEREADER=2]="BROWSER_FILEREADER",e[e.BROWSER_FSACCESS=3]="BROWSER_FSACCESS",e[e.HTTP=4]="HTTP",e[e.S3=5]="S3",e))(YC||{}),qC={name:"@duckdb/duckdb-wasm",version:"1.30.0"},XC=qC.name,KC=qC.version,ZC=qC.version.split(".");ZC[0],ZC[1],ZC[2];var QC=null,JC=null,eI=null,tI=null,nI=null;((e,t,n)=>{n=null!=e?xC(TC(e)):{},((e,t,n,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let o of EC(t))!CC.call(e,o)&&undefined!==o&&wC(e,o,{get:()=>t[o],enumerable:!(i=SC(t,o))||i.enumerable})})(e&&e.__esModule?n:wC(n,"default",{value:e,enumerable:!0}),e)})(IC());class iI{constructor(e={}){s(this,"_ipc"),s(this,"_options"),s(this,"_db"),s(this,"_con"),s(this,"_config"),s(this,"_loadPromise");const{ipc:t,duckdb:n,connection:i,config:o,...r}=e;this._ipc=t,this._options=r,this._db=n,this._con=i,this._config=o}async getDuckDB(){return this._db||await oI(this),this._db}async getConnection(){return this._con||await oI(this),this._con}async query(e){const{type:t,sql:n}=e,i=await this.getConnection(),o=await function(e,t){return new Promise((n,i)=>{e.useUnsafe(async(e,o)=>{try{const i=await e.runQuery(o,t);n(i)}catch(r){i(r)}})})}(i,n);return"exec"===t?void 0:"arrow"===t?Jp(o,this._ipc):Jp(o).toArray()}}function oI(e){return e._loadPromise||(e._loadPromise=(e._db?Promise.resolve(e._db):async function({log:e=!1}={}){const t=function(){let e="https://cdn.jsdelivr.net/npm/".concat(XC,"@").concat(KC,"/dist/");return{mvp:{mainModule:"".concat(e,"duckdb-mvp.wasm"),mainWorker:"".concat(e,"duckdb-browser-mvp.worker.js")},eh:{mainModule:"".concat(e,"duckdb-eh.wasm"),mainWorker:"".concat(e,"duckdb-browser-eh.worker.js")}}}(),n=await async function(e){let t=await async function(){return null==QC&&(QC=typeof BigInt64Array<"u"),null==JC&&(JC=await(async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,6,64,25,11,11])))()),null==eI&&(eI=await(async e=>{try{return typeof MessageChannel<"u"&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(e)}catch(t){return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))),null==tI&&(tI=await(async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])))()),null==nI&&(nI=await(async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,3,1,0,1,10,14,1,12,0,65,0,65,0,65,0,252,10,0,0,11])))()),{bigInt64Array:QC,crossOriginIsolated:typeof navigator>"u"||globalThis.crossOriginIsolated||!1,wasmExceptions:JC,wasmSIMD:tI,wasmThreads:eI,wasmBulkMemory:nI}}();if(t.wasmExceptions){if(t.wasmSIMD&&t.wasmThreads&&t.crossOriginIsolated&&e.coi)return{mainModule:e.coi.mainModule,mainWorker:e.coi.mainWorker,pthreadWorker:e.coi.pthreadWorker};if(e.eh)return{mainModule:e.eh.mainModule,mainWorker:e.eh.mainWorker,pthreadWorker:null}}return{mainModule:e.mvp.mainModule,mainWorker:e.mvp.mainWorker,pthreadWorker:null}}(t),i=URL.createObjectURL(new Blob([`importScripts("${n.mainWorker}");`],{type:"text/javascript"})),o=new Worker(i),r=e?new NC:new MC,s=new jC(r,o);return await s.instantiate(n.mainModule,n.pthreadWorker),URL.revokeObjectURL(i),s}(e._options).then(t=>e._db=t)).then(t=>null!=e._config?t.open(e._config).then(()=>t):t).then(e=>e.connect()).then(t=>e._con=t)),e._loadPromise}const rI=(e,t,n="info")=>{if(window.cosmographDisableLogging)return;let i,o;switch(n){case"ok":i="#54AE47",o="✅ ";break;case"info":i="#4196f8",o="ℹ️ ";break;case"warn":i="#FFA500",o="⚠️ ";break;case"util":i="#666666",o="⚙️ ";break;case"error":i="#FF0000",o="🚫 "}};var sI={};const aI=(e,t,n=new Set)=>{if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;if(n.has(e))return!0;n.add(e);for(let i=0;i<e.length;i++)if(!aI(e[i],t[i],n))return!1;return!0}if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return!1;if(e===t)return!0;if(Object.keys(e).length!==Object.keys(t).length)return!1;if(n.has(e))return!0;n.add(e);for(const i in e)if(!aI(e[i],t[i],n))return!1;return!0}return e===t},lI=e=>{if(!e)return[];const t=e.numRows,n=e.schema.fields,i=new Array(t);for(let o=0;o<t;o++){const t={};for(let i=0;i<n.length;i++){const r=e.getChildAt(i);r&&(t[n[i].name]=r.get(o))}i[o]=t}return i},cI=()=>{let e;try{e=!!sI.DEBUG}catch(t){e=!1}return e},uI=(e,t)=>[Math.round(e),Math.round(t)],hI=e=>`'${String(e).replace(/'/g,"''")}'`,dI=e=>2===(null==e?void 0:e.typeId)||3===(null==e?void 0:e.typeId)||7===(null==e?void 0:e.typeId),pI=e=>5===(null==e?void 0:e.typeId),fI=e=>6===(null==e?void 0:e.typeId)||20===(null==e?void 0:e.typeId),mI=e=>12===(null==e?void 0:e.typeId)||13===(null==e?void 0:e.typeId),_I=e=>"string"==typeof e?/(\[\]|list)/i.test(e):mI(e??void 0),gI=()=>Math.random().toString(36).substring(2,9);var yI=Object.create,bI=Object.defineProperty,vI=Object.getOwnPropertyDescriptor,xI=Object.getOwnPropertyNames,wI=Object.getPrototypeOf,SI=Object.prototype.hasOwnProperty,EI=((e,t)=>()=>(t||((t={exports:{}}).exports=Worker),t.exports))(),TI=(e=>(e[e.UNDEFINED=0]="UNDEFINED",e[e.AUTOMATIC=1]="AUTOMATIC",e[e.READ_ONLY=2]="READ_ONLY",e[e.READ_WRITE=3]="READ_WRITE",e))(TI||{}),CI=(e=>(e[e.IDENTIFIER=0]="IDENTIFIER",e[e.NUMERIC_CONSTANT=1]="NUMERIC_CONSTANT",e[e.STRING_CONSTANT=2]="STRING_CONSTANT",e[e.OPERATOR=3]="OPERATOR",e[e.KEYWORD=4]="KEYWORD",e[e.COMMENT=5]="COMMENT",e))(CI||{}),II=(e=>(e[e.NONE=0]="NONE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARNING=3]="WARNING",e[e.ERROR=4]="ERROR",e))(II||{}),AI=(e=>(e[e.NONE=0]="NONE",e[e.CONNECT=1]="CONNECT",e[e.DISCONNECT=2]="DISCONNECT",e[e.OPEN=3]="OPEN",e[e.QUERY=4]="QUERY",e[e.INSTANTIATE=5]="INSTANTIATE",e))(AI||{}),kI=(e=>(e[e.NONE=0]="NONE",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR",e[e.START=3]="START",e[e.RUN=4]="RUN",e[e.CAPTURE=5]="CAPTURE",e))(kI||{}),LI=(e=>(e[e.NONE=0]="NONE",e[e.WEB_WORKER=1]="WEB_WORKER",e[e.NODE_WORKER=2]="NODE_WORKER",e[e.BINDINGS=3]="BINDINGS",e[e.ASYNC_DUCKDB=4]="ASYNC_DUCKDB",e))(LI||{}),RI=class{log(e){}},PI=(e=>(e[e.SUCCESS=0]="SUCCESS",e[e.MAX_ARROW_ERROR=255]="MAX_ARROW_ERROR",e[e.DUCKDB_WASM_RETRY=256]="DUCKDB_WASM_RETRY",e))(PI||{}),DI=class{constructor(e,t){this._bindings=e,this._conn=t}get bindings(){return this._bindings}async close(){return this._bindings.disconnect(this._conn)}useUnsafe(e){return e(this._bindings,this._conn)}async query(e){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:e});let t=await this._bindings.runQuery(this._conn,e),n=$T.from(t);return console.assert(n.isSync(),"Reader is not sync"),console.assert(n.isFile(),"Reader is not file"),new tT(n)}async send(e,t=!1){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:e});let n=await this._bindings.startPendingQuery(this._conn,e,t);for(;null==n;)n=await this._bindings.pollPendingQuery(this._conn);let i=new MI(this._bindings,this._conn,n),o=await $T.from(i);return console.assert(o.isAsync()),console.assert(o.isStream()),o}async cancelSent(){return await this._bindings.cancelPendingQuery(this._conn)}async getTableNames(e){return await this._bindings.getTableNames(this._conn,e)}async prepare(e){let t=await this._bindings.createPrepared(this._conn,e);return new NI(this._bindings,this._conn,t)}async insertArrowTable(e,t){let n=pC(e,"stream");await this.insertArrowFromIPCStream(n,t)}async insertArrowFromIPCStream(e,t){await this._bindings.insertArrowFromIPCStream(this._conn,e,t)}async insertCSVFromPath(e,t){await this._bindings.insertCSVFromPath(this._conn,e,t)}async insertJSONFromPath(e,t){await this._bindings.insertJSONFromPath(this._conn,e,t)}},MI=class{constructor(e,t,n){this.db=e,this.conn=t,this.header=n,this._first=!0,this._depleted=!1,this._inFlight=null}async next(){if(this._first)return this._first=!1,{done:!1,value:this.header};if(this._depleted)return{done:!0,value:null};let e=null;for(null!=this._inFlight&&(e=await this._inFlight,this._inFlight=null);null==e;)e=await this.db.fetchQueryResults(this.conn);return this._depleted=0==e.length,this._depleted||(this._inFlight=this.db.fetchQueryResults(this.conn)),{done:this._depleted,value:e}}[Symbol.asyncIterator](){return this}},NI=class{constructor(e,t,n){this.bindings=e,this.connectionId=t,this.statementId=n}async close(){await this.bindings.closePrepared(this.connectionId,this.statementId)}async query(...e){let t=await this.bindings.runPrepared(this.connectionId,this.statementId,e),n=$T.from(t);return console.assert(n.isSync()),console.assert(n.isFile()),new tT(n)}async send(...e){let t=await this.bindings.sendPrepared(this.connectionId,this.statementId,e),n=new MI(this.bindings,this.connectionId,t),i=await $T.from(n);return console.assert(i.isAsync()),console.assert(i.isStream()),i}},OI=(e=>(e.CANCEL_PENDING_QUERY="CANCEL_PENDING_QUERY",e.CLOSE_PREPARED="CLOSE_PREPARED",e.COLLECT_FILE_STATISTICS="COLLECT_FILE_STATISTICS",e.REGISTER_OPFS_FILE_NAME="REGISTER_OPFS_FILE_NAME",e.CONNECT="CONNECT",e.COPY_FILE_TO_BUFFER="COPY_FILE_TO_BUFFER",e.COPY_FILE_TO_PATH="COPY_FILE_TO_PATH",e.CREATE_PREPARED="CREATE_PREPARED",e.DISCONNECT="DISCONNECT",e.DROP_FILE="DROP_FILE",e.DROP_FILES="DROP_FILES",e.EXPORT_FILE_STATISTICS="EXPORT_FILE_STATISTICS",e.FETCH_QUERY_RESULTS="FETCH_QUERY_RESULTS",e.FLUSH_FILES="FLUSH_FILES",e.GET_FEATURE_FLAGS="GET_FEATURE_FLAGS",e.GET_TABLE_NAMES="GET_TABLE_NAMES",e.GET_VERSION="GET_VERSION",e.GLOB_FILE_INFOS="GLOB_FILE_INFOS",e.INSERT_ARROW_FROM_IPC_STREAM="INSERT_ARROW_FROM_IPC_STREAM",e.INSERT_CSV_FROM_PATH="IMPORT_CSV_FROM_PATH",e.INSERT_JSON_FROM_PATH="IMPORT_JSON_FROM_PATH",e.INSTANTIATE="INSTANTIATE",e.OPEN="OPEN",e.PING="PING",e.POLL_PENDING_QUERY="POLL_PENDING_QUERY",e.REGISTER_FILE_BUFFER="REGISTER_FILE_BUFFER",e.REGISTER_FILE_HANDLE="REGISTER_FILE_HANDLE",e.REGISTER_FILE_URL="REGISTER_FILE_URL",e.RESET="RESET",e.RUN_PREPARED="RUN_PREPARED",e.RUN_QUERY="RUN_QUERY",e.SEND_PREPARED="SEND_PREPARED",e.START_PENDING_QUERY="START_PENDING_QUERY",e.TOKENIZE="TOKENIZE",e))(OI||{}),BI=(e=>(e.CONNECTION_INFO="CONNECTION_INFO",e.ERROR="ERROR",e.FEATURE_FLAGS="FEATURE_FLAGS",e.FILE_BUFFER="FILE_BUFFER",e.FILE_INFOS="FILE_INFOS",e.FILE_SIZE="FILE_SIZE",e.FILE_STATISTICS="FILE_STATISTICS",e.INSTANTIATE_PROGRESS="INSTANTIATE_PROGRESS",e.LOG="LOG",e.PROGRESS_UPDATE="PROGRESS_UPDATE",e.OK="OK",e.PREPARED_STATEMENT_ID="PREPARED_STATEMENT_ID",e.QUERY_PLAN="QUERY_PLAN",e.QUERY_RESULT="QUERY_RESULT",e.QUERY_RESULT_CHUNK="QUERY_RESULT_CHUNK",e.QUERY_RESULT_HEADER="QUERY_RESULT_HEADER",e.QUERY_RESULT_HEADER_OR_NULL="QUERY_RESULT_HEADER_OR_NULL",e.REGISTERED_FILE="REGISTERED_FILE",e.SCRIPT_TOKENS="SCRIPT_TOKENS",e.SUCCESS="SUCCESS",e.TABLE_NAMES="TABLE_NAMES",e.VERSION_STRING="VERSION_STRING",e))(BI||{}),FI=class{constructor(e,t){this.promiseResolver=()=>{},this.promiseRejecter=()=>{},this.type=e,this.data=t,this.promise=new Promise((e,t)=>{this.promiseResolver=e,this.promiseRejecter=t})}};function zI(e){switch(e.typeId){case vb.Binary:return{sqlType:"binary"};case vb.Bool:return{sqlType:"bool"};case vb.Date:return{sqlType:"date"};case vb.DateDay:return{sqlType:"date32[d]"};case vb.DateMillisecond:return{sqlType:"date64[ms]"};case vb.Decimal:{let t=e;return{sqlType:"decimal",precision:t.precision,scale:t.scale}}case vb.Float:return{sqlType:"float"};case vb.Float16:return{sqlType:"float16"};case vb.Float32:return{sqlType:"float32"};case vb.Float64:return{sqlType:"float64"};case vb.Int:return{sqlType:"int32"};case vb.Int16:return{sqlType:"int16"};case vb.Int32:return{sqlType:"int32"};case vb.Int64:return{sqlType:"int64"};case vb.Uint16:return{sqlType:"uint16"};case vb.Uint32:return{sqlType:"uint32"};case vb.Uint64:return{sqlType:"uint64"};case vb.Uint8:return{sqlType:"uint8"};case vb.IntervalDayTime:return{sqlType:"interval[dt]"};case vb.IntervalYearMonth:return{sqlType:"interval[m]"};case vb.List:return{sqlType:"list",valueType:zI(e.valueType)};case vb.FixedSizeBinary:return{sqlType:"fixedsizebinary",byteWidth:e.byteWidth};case vb.Null:return{sqlType:"null"};case vb.Utf8:return{sqlType:"utf8"};case vb.Struct:return{sqlType:"struct",fields:e.children.map(e=>UI(e.name,e.type))};case vb.Map:{let t=e;return{sqlType:"map",keyType:zI(t.keyType),valueType:zI(t.valueType)}}case vb.Time:return{sqlType:"time[s]"};case vb.TimeMicrosecond:return{sqlType:"time[us]"};case vb.TimeMillisecond:return{sqlType:"time[ms]"};case vb.TimeNanosecond:return{sqlType:"time[ns]"};case vb.TimeSecond:return{sqlType:"time[s]"};case vb.Timestamp:return{sqlType:"timestamp",timezone:e.timezone||void 0};case vb.TimestampSecond:return{sqlType:"timestamp[s]",timezone:e.timezone||void 0};case vb.TimestampMicrosecond:return{sqlType:"timestamp[us]",timezone:e.timezone||void 0};case vb.TimestampNanosecond:return{sqlType:"timestamp[ns]",timezone:e.timezone||void 0};case vb.TimestampMillisecond:return{sqlType:"timestamp[ms]",timezone:e.timezone||void 0}}throw new Error("unsupported arrow type: ".concat(e.toString()))}function UI(e,t){let n=zI(t);return n.name=e,n}var $I=new TextEncoder,VI=class{constructor(e,t=null){this._onInstantiationProgress=[],this._onExecutionProgress=[],this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{},this._nextMessageId=0,this._pendingRequests=new Map,this._logger=e,this._onMessageHandler=this.onMessage.bind(this),this._onErrorHandler=this.onError.bind(this),this._onCloseHandler=this.onClose.bind(this),null!=t&&this.attach(t)}get logger(){return this._logger}attach(e){this._worker=e,this._worker.addEventListener("message",this._onMessageHandler),this._worker.addEventListener("error",this._onErrorHandler),this._worker.addEventListener("close",this._onCloseHandler),this._workerShutdownPromise=new Promise((e,t)=>{this._workerShutdownResolver=e})}detach(){this._worker&&(this._worker.removeEventListener("message",this._onMessageHandler),this._worker.removeEventListener("error",this._onErrorHandler),this._worker.removeEventListener("close",this._onCloseHandler),this._worker=null,this._workerShutdownResolver(null),this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async terminate(){this._worker&&(this._worker.terminate(),this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async postTask(e,t=[]){if(!this._worker)return void console.error("cannot send a message since the worker is not set!");let n=this._nextMessageId++;return this._pendingRequests.set(n,e),this._worker.postMessage({messageId:n,type:e.type,data:e.data},t),await e.promise}onMessage(e){var t;let n=e.data;switch(n.type){case"PROGRESS_UPDATE":for(let e of this._onExecutionProgress)e(n.data);return;case"LOG":return void this._logger.log(n.data);case"INSTANTIATE_PROGRESS":for(let e of this._onInstantiationProgress)e(n.data);return}let i=this._pendingRequests.get(n.requestId);if(i){if(this._pendingRequests.delete(n.requestId),"ERROR"==n.type){let e=new Error(n.data.message);return e.name=n.data.name,null!=(t=Object.getOwnPropertyDescriptor(e,"stack"))&&t.writable&&(e.stack=n.data.stack),void i.promiseRejecter(e)}switch(i.type){case"CLOSE_PREPARED":case"COLLECT_FILE_STATISTICS":case"REGISTER_OPFS_FILE_NAME":case"COPY_FILE_TO_PATH":case"DISCONNECT":case"DROP_FILE":case"DROP_FILES":case"FLUSH_FILES":case"INSERT_ARROW_FROM_IPC_STREAM":case"IMPORT_CSV_FROM_PATH":case"IMPORT_JSON_FROM_PATH":case"OPEN":case"PING":case"REGISTER_FILE_BUFFER":case"REGISTER_FILE_HANDLE":case"REGISTER_FILE_URL":case"RESET":if("OK"==n.type)return void i.promiseResolver(n.data);break;case"INSTANTIATE":if(this._onInstantiationProgress=[],"OK"==n.type)return void i.promiseResolver(n.data);break;case"GLOB_FILE_INFOS":if("FILE_INFOS"==n.type)return void i.promiseResolver(n.data);break;case"GET_VERSION":if("VERSION_STRING"==n.type)return void i.promiseResolver(n.data);break;case"GET_FEATURE_FLAGS":if("FEATURE_FLAGS"==n.type)return void i.promiseResolver(n.data);break;case"GET_TABLE_NAMES":if("TABLE_NAMES"==n.type)return void i.promiseResolver(n.data);break;case"TOKENIZE":if("SCRIPT_TOKENS"==n.type)return void i.promiseResolver(n.data);break;case"COPY_FILE_TO_BUFFER":if("FILE_BUFFER"==n.type)return void i.promiseResolver(n.data);break;case"EXPORT_FILE_STATISTICS":if("FILE_STATISTICS"==n.type)return void i.promiseResolver(n.data);break;case"CONNECT":if("CONNECTION_INFO"==n.type)return void i.promiseResolver(n.data);break;case"RUN_PREPARED":case"RUN_QUERY":if("QUERY_RESULT"==n.type)return void i.promiseResolver(n.data);break;case"SEND_PREPARED":if("QUERY_RESULT_HEADER"==n.type)return void i.promiseResolver(n.data);break;case"START_PENDING_QUERY":case"POLL_PENDING_QUERY":if("QUERY_RESULT_HEADER_OR_NULL"==n.type)return void i.promiseResolver(n.data);break;case"CANCEL_PENDING_QUERY":if(this._onInstantiationProgress=[],"SUCCESS"==n.type)return void i.promiseResolver(n.data);break;case"FETCH_QUERY_RESULTS":if("QUERY_RESULT_CHUNK"==n.type)return void i.promiseResolver(n.data);break;case"CREATE_PREPARED":if("PREPARED_STATEMENT_ID"==n.type)return void i.promiseResolver(n.data)}i.promiseRejecter(new Error("unexpected response type: ".concat(n.type.toString())))}else console.warn("unassociated response: [".concat(n.requestId,", ").concat(n.type.toString(),"]"))}onError(e){console.error(e),console.error("error in duckdb worker: ".concat(e.message)),this._pendingRequests.clear()}onClose(){this._workerShutdownResolver(null),0==this._pendingRequests.size?this._pendingRequests.clear():console.warn("worker terminated with ".concat(this._pendingRequests.size," pending requests"))}async reset(){let e=new FI("RESET",null);return await this.postTask(e)}async ping(){let e=new FI("PING",null);await this.postTask(e)}async dropFile(e){let t=new FI("DROP_FILE",e);return await this.postTask(t)}async dropFiles(){let e=new FI("DROP_FILES",null);return await this.postTask(e)}async flushFiles(){let e=new FI("FLUSH_FILES",null);return await this.postTask(e)}async instantiate(e,t=null,n=e=>{}){this._onInstantiationProgress.push(n);let i=new FI("INSTANTIATE",[e,t]);return await this.postTask(i)}async getVersion(){let e=new FI("GET_VERSION",null);return await this.postTask(e)}async getFeatureFlags(){let e=new FI("GET_FEATURE_FLAGS",null);return await this.postTask(e)}async open(e){let t=new FI("OPEN",e);await this.postTask(t)}async tokenize(e){let t=new FI("TOKENIZE",e);return await this.postTask(t)}async connectInternal(){let e=new FI("CONNECT",null);return await this.postTask(e)}async connect(){let e=await this.connectInternal();return new DI(this,e)}async disconnect(e){let t=new FI("DISCONNECT",e);await this.postTask(t)}async runQuery(e,t){let n=new FI("RUN_QUERY",[e,t]);return await this.postTask(n)}async startPendingQuery(e,t,n=!1){let i=new FI("START_PENDING_QUERY",[e,t,n]);return await this.postTask(i)}async pollPendingQuery(e){let t=new FI("POLL_PENDING_QUERY",e);return await this.postTask(t)}async cancelPendingQuery(e){let t=new FI("CANCEL_PENDING_QUERY",e);return await this.postTask(t)}async fetchQueryResults(e){let t=new FI("FETCH_QUERY_RESULTS",e);return await this.postTask(t)}async getTableNames(e,t){let n=new FI("GET_TABLE_NAMES",[e,t]);return await this.postTask(n)}async createPrepared(e,t){let n=new FI("CREATE_PREPARED",[e,t]);return await this.postTask(n)}async closePrepared(e,t){let n=new FI("CLOSE_PREPARED",[e,t]);await this.postTask(n)}async runPrepared(e,t,n){let i=new FI("RUN_PREPARED",[e,t,n]);return await this.postTask(i)}async sendPrepared(e,t,n){let i=new FI("SEND_PREPARED",[e,t,n]);return await this.postTask(i)}async globFiles(e){let t=new FI("GLOB_FILE_INFOS",e);return await this.postTask(t)}async registerFileText(e,t){let n=$I.encode(t);await this.registerFileBuffer(e,n)}async registerFileURL(e,t,n,i){void 0===t&&(t=e);let o=new FI("REGISTER_FILE_URL",[e,t,n,i]);await this.postTask(o)}async registerEmptyFileBuffer(e){}async registerFileBuffer(e,t){let n=new FI("REGISTER_FILE_BUFFER",[e,t]);await this.postTask(n,[t.buffer])}async registerFileHandle(e,t,n,i){let o=new FI("REGISTER_FILE_HANDLE",[e,t,n,i]);await this.postTask(o,[])}async registerOPFSFileName(e){let t=new FI("REGISTER_OPFS_FILE_NAME",[e]);await this.postTask(t,[])}async collectFileStatistics(e,t){let n=new FI("COLLECT_FILE_STATISTICS",[e,t]);await this.postTask(n,[])}async exportFileStatistics(e){let t=new FI("EXPORT_FILE_STATISTICS",e);return await this.postTask(t,[])}async copyFileToBuffer(e){let t=new FI("COPY_FILE_TO_BUFFER",e);return await this.postTask(t)}async copyFileToPath(e,t){let n=new FI("COPY_FILE_TO_PATH",[e,t]);await this.postTask(n)}async insertArrowFromIPCStream(e,t,n){if(0==t.length)return;let i=new FI("INSERT_ARROW_FROM_IPC_STREAM",[e,t,n]);await this.postTask(i,[t.buffer])}async insertCSVFromPath(e,t,n){if(void 0!==n.columns){let e=[];for(let t in n.columns){let i=n.columns[t];e.push(UI(t,i))}n.columnsFlat=e,delete n.columns}let i=new FI("IMPORT_CSV_FROM_PATH",[e,t,n]);await this.postTask(i)}async insertJSONFromPath(e,t,n){if(void 0!==n.columns){let e=[];for(let t in n.columns){let i=n.columns[t];e.push(UI(t,i))}n.columnsFlat=e,delete n.columns}let i=new FI("IMPORT_JSON_FROM_PATH",[e,t,n]);await this.postTask(i)}};new TextDecoder;var HI=(e=>(e[e.BUFFER=0]="BUFFER",e[e.NODE_FS=1]="NODE_FS",e[e.BROWSER_FILEREADER=2]="BROWSER_FILEREADER",e[e.BROWSER_FSACCESS=3]="BROWSER_FSACCESS",e[e.HTTP=4]="HTTP",e[e.S3=5]="S3",e))(HI||{}),GI={name:"@duckdb/duckdb-wasm",version:"1.29.1-dev260.0"},WI=GI.name,jI=GI.version,YI=GI.version.split(".");YI[0],YI[1],YI[2];var qI,XI,KI,ZI,QI=null,JI=null,eA=null,tA=null,nA=null;((e,t,n)=>{n=null!=e?yI(wI(e)):{},((e,t,n,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let o of xI(t))!SI.call(e,o)&&undefined!==o&&bI(e,o,{get:()=>t[o],enumerable:!(i=vI(t,o))||i.enumerable})})(e&&e.__esModule?n:bI(n,"default",{value:e,enumerable:!0}),e)})(EI()),(ZI=qI||(qI={})).RawPoints="temp_cosmograph_raw_points",ZI.RawLinks="temp_cosmograph_raw_links",ZI.PreparedPoints="temp_cosmograph_prepared_points",ZI.PreparedLinks="temp_cosmograph_prepared_links",ZI.Points="cosmograph_points",ZI.Links="cosmograph_links",function(e){e.Id="id",e.Idx="idx",e.Sequence="points_idx_seq",e.Source="source",e.SourceIdx="sourceidx",e.Target="target",e.TargetIdx="targetidx"}(XI||(XI={})),function(e){e.Parquet="parquet",e.Arrow="arrow",e.CSV="csv",e.JSON="json"}(KI||(KI={}));const iA=cI(),oA=function(){let e="https://cdn.jsdelivr.net/npm/".concat(WI,"@").concat(jI,"/dist/");return{mvp:{mainModule:"".concat(e,"duckdb-mvp.wasm"),mainWorker:"".concat(e,"duckdb-browser-mvp.worker.js")},eh:{mainModule:"".concat(e,"duckdb-eh.wasm"),mainWorker:"".concat(e,"duckdb-browser-eh.worker.js")}}}();let rA=(e=class{constructor(){s(this,"_db"),s(this,"_connection"),s(this,"logTable",async(e,t=!1)=>{var n;if(!iA)return;const i=`SELECT COUNT(*) as count FROM ${e}`,o=await this.query(i);if(!o)return;const r=null==(n=o.getChild("count"))?void 0:n.get(0),s=`SELECT * FROM ${e} ${t?"":"LIMIT 10"}`,a=await this.query(s);if(!a)return;const l=lI(a);console.groupCollapsed(`Table: ${e} | ${r} rows ${t?"":"(showing first 10)"}`),console.table(l),console.groupEnd()})}static async getInstance(){return e._initPromise=(async()=>{const t=new e;return await t._init(),t})(),e._instance=await e._initPromise,e._instance}async _init(){const e=await async function(e){let t=await async function(){return null==QI&&(QI=typeof BigInt64Array<"u"),null==JI&&(JI=await(async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,6,64,25,11,11])))()),null==eA&&(eA=await(async e=>{try{return typeof MessageChannel<"u"&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(e)}catch(t){return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))),null==tA&&(tA=await(async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])))()),null==nA&&(nA=await(async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,3,1,0,1,10,14,1,12,0,65,0,65,0,65,0,252,10,0,0,11])))()),{bigInt64Array:QI,crossOriginIsolated:typeof navigator>"u"||globalThis.crossOriginIsolated||!1,wasmExceptions:JI,wasmSIMD:tA,wasmThreads:eA,wasmBulkMemory:nA}}();if(t.wasmExceptions){if(t.wasmSIMD&&t.wasmThreads&&t.crossOriginIsolated&&e.coi)return{mainModule:e.coi.mainModule,mainWorker:e.coi.mainWorker,pthreadWorker:e.coi.pthreadWorker};if(e.eh)return{mainModule:e.eh.mainModule,mainWorker:e.eh.mainWorker,pthreadWorker:null}}return{mainModule:e.mvp.mainModule,mainWorker:e.mvp.mainWorker,pthreadWorker:null}}(oA),t=URL.createObjectURL(new Blob([`importScripts("${e.mainWorker}");`],{type:"text/javascript"})),n=new Worker(t),i=new RI;this._db=new VI(i,n),await this._db.instantiate(e.mainModule,e.pthreadWorker),this._connection=await this._db.connect(),await this._connection.query("\n      SET max_expression_depth TO 20000000;\n      SET memory_limit = '10GB';\n    ".trim()),URL.revokeObjectURL(t)}get connection(){if(!this._connection)throw new Error("Cosmograph: DuckDB-Wasm connection is not initialized");return this._connection}get db(){if(!this._db)throw new Error("Cosmograph: DuckDB-Wasm is not initialized");return this._db}async destroy(){await this.connection.close(),await this.db.terminate(),e._instance=void 0,e._initPromise=void 0}async dropTable(e){await this.query(`DROP TABLE IF EXISTS "${e}"`)}async query(e){let t;iA&&(t=performance.now());try{return await this.connection.query(e)}catch(n){globalThis.__lastDuckdbError=String(n),console.warn(`Couldn't query internal DuckDB instance: ${n}`)}finally{iA&&void 0!==t&&(performance.now()-t).toFixed(1)}}async exec(e){await this.query(e)}async send(e,t){iA&&console.time("query");try{const n=await this.connection.send(e);let i;for(;!(i=await n.next()).done;){const e=i.value;for(let n=0;n<e.numRows;n++){const i=e.getChildAt(n);t&&t(i)}}}catch(n){console.warn(`Couldn't query internal DuckDB instance: ${n}`)}iA&&console.timeEnd("query")}async uploadData(e,t,n=!1,i,o){if(Array.isArray(e)&&e.length>0&&e[0]&&"object"==typeof e[0])return await this.uploadObject(e,t,n);if(e instanceof Uint8Array||e instanceof ArrayBuffer||e instanceof tT)return await this._uploadArrow(e,t,n);if("string"==typeof e||e instanceof File){const s=e=>e.endsWith(".arrow")?KI.Arrow:e.endsWith(".parquet")||e.endsWith(".pq")?KI.Parquet:e.endsWith(".csv")||e.endsWith(".tsv")?KI.CSV:e.endsWith(".json")?KI.JSON:"unknown",a=e instanceof File?e.name:e,l=s(a);"unknown"===l&&console.warn(`Unknown file type: ${a}`);try{switch(l){case KI.Arrow:return await this._uploadArrow(e,t,n);case KI.Parquet:return await this._uploadParquet(e,t,n);case KI.CSV:return await this._uploadCSV(e,t,n,i,o);case KI.JSON:return await this._uploadJSON(e,t,n);default:throw new Error("Unsupported file type")}}catch(r){return console.warn(`uploadData: ${r}`),{error:r}}}return{error:"Could not upload data"}}async uploadArrow(e,t){return await this._uploadArrow(e,t)}async exportTableToArrow(e){try{const t=[],n=await this.connection.send(`SELECT * FROM ${e}`);let i;for(;!(i=await n.next()).done;){const e=i.value;e&&e.numRows&&t.push(e)}return t.length?new tT(t):void 0}catch(mC){throw console.warn(`exportTableToArrow: Failed to export table "${e}":`,mC),mC}}async exportTableToArrowBuffer(e){const t=await this.exportTableToArrow(e);return t?pC(t):void 0}async exportTableToPq(e){var t,n;const i=`${e}.${KI.Parquet}`;try{return await this.connection.query(`COPY ${e} TO '${i}' (FORMAT PARQUET)`),await(null==(t=this._db)?void 0:t.copyFileToBuffer(i))}catch(gC){console.error(`Failed to export table "${e}" to file "${i}":`,gC)}finally{await(null==(n=this._db)?void 0:n.registerEmptyFileBuffer(i))}}async exportTableToCSV(e){var t,n;const i=`${e}.${KI.CSV}`;try{return await this.connection.query(`COPY ${e} TO '${i}' (HEADER, DELIMITER ',')`),await(null==(t=this._db)?void 0:t.copyFileToBuffer(i))}catch(gC){console.error(`Failed to export table "${e}" to file "${i}":`,gC)}finally{await(null==(n=this._db)?void 0:n.registerEmptyFileBuffer(i))}}async uploadObject(e,t,n=!1){if(0===e.length)return{};try{const i=`t_${t}`;await this.query(`DROP TABLE IF EXISTS "${i}"`);const o=function(e){const t=qE(e),n=new iT(new cS(t.type.children),t.data[0]);return new tT(n)}(e);return await this.connection.insertArrowTable(o,{name:i}),await this._handleTableInsertion(i,t,n),await this.logTable(t),{}}catch(i){throw new Error(`Failed to upload Object: ${i}`)}}async _uploadCSV(e,t,n=!1,i,o){const r=`t_${t}`;let s=null;try{let a;if(e instanceof File){const t=await e.text();s=e.name,await this.db.registerFileText(s,t),a=s}else a=e;const l=`\n        CREATE TABLE ${r} AS SELECT * FROM read_csv_auto(\n          '${a}',\n          SAMPLE_SIZE=-1,\n          allow_quoted_nulls=true,\n          ignore_errors=true\n          ${i?`, timestampformat='${i}'`:""}\n          ${o?`, types=${JSON.stringify(o)}`:""}\n        )`.trim();return await this.query(l),await this._handleTableInsertion(r,t,n),await this.logTable(t),{}}catch(a){throw new Error(`Failed to upload CSV: ${a}`)}finally{s&&await this.db.dropFile(s)}}async _uploadParquet(e,t,n=!1){const i=`t_${t}`;let o=null;try{let r;e instanceof File?(o=e.name,await this.db.registerFileHandle(o,e,HI.BROWSER_FILEREADER,!0),r=o):r=e;const s=`CREATE TABLE ${i} AS SELECT * FROM read_parquet('${r}')`;return await this.query(s),await this._handleTableInsertion(i,t,n),await this.logTable(t),{}}catch(r){const e=r instanceof Error?r.message:String(r);throw new Error(`Failed to upload Parquet: ${e}`)}finally{o&&await this.db.dropFile(o)}}async _uploadArrow(e,t,n=!1){try{let i;const o=`t_${t}`;if(await this.query(`DROP TABLE IF EXISTS "${o}"`),e instanceof File)i=await e.arrayBuffer(),i=new Uint8Array(i);else if("string"==typeof e){const t=await fetch(e);t.ok||console.warn(`Failed to fetch file: ${t.statusText}`),i=await t.arrayBuffer(),i=new Uint8Array(i)}else i=e;const r=e instanceof tT?e:dC(i);return await this.connection.insertArrowTable(r,{name:o}),await this._handleTableInsertion(o,t,n),await this.logTable(t),{}}catch(i){const e=i instanceof Error?i.message:String(i);throw new Error(`Failed to upload Arrow: ${e}`)}}async _uploadJSON(e,t,n=!1){const i=`t_${t}`;await this.query(`DROP TABLE IF EXISTS "${i}"`);try{if(e instanceof File){const t=await e.text();await this.db.registerFileText("json",t)}else{const t=await fetch(e);t.ok||console.warn(`Failed to fetch file: ${t.statusText}`);const n=await t.text();await this.db.registerFileText("json",n)}return await this.connection.insertJSONFromPath("json",{name:i}),await this._handleTableInsertion(i,t,n),await this.logTable(t),{}}catch(o){const e=o instanceof Error?o.message:String(o);throw new Error(`Failed to upload JSON: ${e}`)}finally{await this.db.dropFile("json")}}async _handleTableInsertion(e,t,n){n?(await this.query(`INSERT INTO "${t}" SELECT * FROM "${e}"`),await this.query(`DROP TABLE IF EXISTS "${e}"`)):(await this.query(`DROP TABLE IF EXISTS "${t}"`),await this.query(`ALTER TABLE "${e}" RENAME TO "${t}"`))}},s(e,"_instance"),s(e,"_initPromise"),e);const sA=cI();let aA=class e{constructor(e,t){if(s(this,"_coordinator"),s(this,"_internalDB"),!e)return;const n=new vg;n.databaseConnector(e),sA?n.manager.logQueries(!0):n.logger(null),this._coordinator=n,this._internalDB=t}static async create(t){let n,i;try{if(t)"string"==typeof t?(n=new kg({uri:t}),rI(0,0,"ok")):(n=new iI(t),rI(0,0,"ok"));else{const e=Date.now();i=await rA.getInstance(),n=new iI({duckdb:i.db,connection:i.connection});const t=Date.now();rI((t-e).toFixed(),0,"ok")}}catch(o){return void rI(0,0,"error")}return new e(n,i)}get internalDB(){return this._internalDB}connect(e){var t,n;(null==(t=this._coordinator)?void 0:t.clients.has(e))||null==(n=this._coordinator)||n.connect(e)}disconnect(e){var t,n;(null==(t=this._coordinator)?void 0:t.clients.has(e))&&(null==(n=this._coordinator)||n.disconnect(e))}clearCache(){var e;null==(e=this._coordinator)||e.clear({cache:!0,clients:!1})}async destroy(){var e;null==(e=this._coordinator)||e.clear(),this._coordinator=void 0}query(e,t={}){const{cache:n=!1,...i}=t;return this._coordinator.query(e,{cache:n,...i})}};var lA="http://www.w3.org/1999/xhtml";const cA={svg:"http://www.w3.org/2000/svg",xhtml:lA,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function uA(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),cA.hasOwnProperty(t)?{space:cA[t],local:e}:e}function hA(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===lA&&t.documentElement.namespaceURI===lA?t.createElement(e):t.createElementNS(n,e)}}function dA(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function pA(e){var t=uA(e);return(t.local?dA:hA)(t)}function fA(){}function mA(e){return null==e?fA:function(){return this.querySelector(e)}}function _A(){return[]}function gA(e){return null==e?_A:function(){return this.querySelectorAll(e)}}function yA(e){return function(){return this.matches(e)}}function bA(e){return function(t){return t.matches(e)}}var vA=Array.prototype.find;function xA(){return this.firstElementChild}var wA=Array.prototype.filter;function SA(){return Array.from(this.children)}function EA(e){return new Array(e.length)}function TA(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function CA(e,t,n,i,o,r){for(var s,a=0,l=t.length,c=r.length;a<c;++a)(s=t[a])?(s.__data__=r[a],i[a]=s):n[a]=new TA(e,r[a]);for(;a<l;++a)(s=t[a])&&(o[a]=s)}function IA(e,t,n,i,o,r,s){var a,l,c,u=new Map,h=t.length,d=r.length,p=new Array(h);for(a=0;a<h;++a)(l=t[a])&&(p[a]=c=s.call(l,l.__data__,a,t)+"",u.has(c)?o[a]=l:u.set(c,l));for(a=0;a<d;++a)c=s.call(e,r[a],a,r)+"",(l=u.get(c))?(i[a]=l,l.__data__=r[a],u.delete(c)):n[a]=new TA(e,r[a]);for(a=0;a<h;++a)(l=t[a])&&u.get(p[a])===l&&(o[a]=l)}function AA(e){return e.__data__}function kA(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function LA(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function RA(e){return function(){this.removeAttribute(e)}}function PA(e){return function(){this.removeAttributeNS(e.space,e.local)}}function DA(e,t){return function(){this.setAttribute(e,t)}}function MA(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function NA(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function OA(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function BA(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function FA(e){return function(){this.style.removeProperty(e)}}function zA(e,t,n){return function(){this.style.setProperty(e,t,n)}}function UA(e,t,n){return function(){var i=t.apply(this,arguments);null==i?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function $A(e,t){return e.style.getPropertyValue(t)||BA(e).getComputedStyle(e,null).getPropertyValue(t)}function VA(e){return function(){delete this[e]}}function HA(e,t){return function(){this[e]=t}}function GA(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function WA(e){return e.trim().split(/^|\s+/)}function jA(e){return e.classList||new YA(e)}function YA(e){this._node=e,this._names=WA(e.getAttribute("class")||"")}function qA(e,t){for(var n=jA(e),i=-1,o=t.length;++i<o;)n.add(t[i])}function XA(e,t){for(var n=jA(e),i=-1,o=t.length;++i<o;)n.remove(t[i])}function KA(e){return function(){qA(this,e)}}function ZA(e){return function(){XA(this,e)}}function QA(e,t){return function(){(t.apply(this,arguments)?qA:XA)(this,e)}}function JA(){this.textContent=""}function ek(e){return function(){this.textContent=e}}function tk(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function nk(){this.innerHTML=""}function ik(e){return function(){this.innerHTML=e}}function ok(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function rk(){this.nextSibling&&this.parentNode.appendChild(this)}function sk(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ak(){return null}function lk(){var e=this.parentNode;e&&e.removeChild(this)}function ck(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function uk(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function hk(e){return function(){var t=this.__on;if(t){for(var n,i=0,o=-1,r=t.length;i<r;++i)n=t[i],e.type&&n.type!==e.type||n.name!==e.name?t[++o]=n:this.removeEventListener(n.type,n.listener,n.options);++o?t.length=o:delete this.__on}}}function dk(e,t,n){return function(){var i,o=this.__on,r=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(o)for(var s=0,a=o.length;s<a;++s)if((i=o[s]).type===e.type&&i.name===e.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=r,i.options=n),void(i.value=t);this.addEventListener(e.type,r,n),i={type:e.type,name:e.name,value:t,listener:r,options:n},o?o.push(i):this.__on=[i]}}function pk(e,t,n){var i=BA(e),o=i.CustomEvent;"function"==typeof o?o=new o(t,n):(o=i.document.createEvent("Event"),n?(o.initEvent(t,n.bubbles,n.cancelable),o.detail=n.detail):o.initEvent(t,!1,!1)),e.dispatchEvent(o)}function fk(e,t){return function(){return pk(this,e,t)}}function mk(e,t){return function(){return pk(this,e,t.apply(this,arguments))}}TA.prototype={constructor:TA,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}},YA.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var _k=[null];function gk(e,t){this._groups=e,this._parents=t}function yk(){return new gk([[document.documentElement]],_k)}function bk(e){return"string"==typeof e?new gk([[document.querySelector(e)]],[document.documentElement]):new gk([[e]],_k)}function vk(e,t){if(e=function(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,[(i=i.matrixTransform(t.getScreenCTM().inverse())).x,i.y]}if(t.getBoundingClientRect){var o=t.getBoundingClientRect();return[e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop]}}return[e.pageX,e.pageY]}gk.prototype=yk.prototype={constructor:gk,select:function(e){"function"!=typeof e&&(e=mA(e));for(var t=this._groups,n=t.length,i=new Array(n),o=0;o<n;++o)for(var r,s,a=t[o],l=a.length,c=i[o]=new Array(l),u=0;u<l;++u)(r=a[u])&&(s=e.call(r,r.__data__,u,a))&&("__data__"in r&&(s.__data__=r.__data__),c[u]=s);return new gk(i,this._parents)},selectAll:function(e){e="function"==typeof e?function(e){return function(){return null==(t=e.apply(this,arguments))?[]:Array.isArray(t)?t:Array.from(t);var t}}(e):gA(e);for(var t=this._groups,n=t.length,i=[],o=[],r=0;r<n;++r)for(var s,a=t[r],l=a.length,c=0;c<l;++c)(s=a[c])&&(i.push(e.call(s,s.__data__,c,a)),o.push(s));return new gk(i,o)},selectChild:function(e){return this.select(null==e?xA:function(e){return function(){return vA.call(this.children,e)}}("function"==typeof e?e:bA(e)))},selectChildren:function(e){return this.selectAll(null==e?SA:function(e){return function(){return wA.call(this.children,e)}}("function"==typeof e?e:bA(e)))},filter:function(e){"function"!=typeof e&&(e=yA(e));for(var t=this._groups,n=t.length,i=new Array(n),o=0;o<n;++o)for(var r,s=t[o],a=s.length,l=i[o]=[],c=0;c<a;++c)(r=s[c])&&e.call(r,r.__data__,c,s)&&l.push(r);return new gk(i,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,AA);var n,i=t?IA:CA,o=this._parents,r=this._groups;"function"!=typeof e&&(n=e,e=function(){return n});for(var s=r.length,a=new Array(s),l=new Array(s),c=new Array(s),u=0;u<s;++u){var h=o[u],d=r[u],p=d.length,f=kA(e.call(h,h&&h.__data__,u,o)),m=f.length,_=l[u]=new Array(m),g=a[u]=new Array(m);i(h,d,_,g,c[u]=new Array(p),f,t);for(var y,b,v=0,x=0;v<m;++v)if(y=_[v]){for(v>=x&&(x=v+1);!(b=g[x])&&++x<m;);y._next=b||null}}return(a=new gk(a,o))._enter=l,a._exit=c,a},enter:function(){return new gk(this._enter||this._groups.map(EA),this._parents)},exit:function(){return new gk(this._exit||this._groups.map(EA),this._parents)},join:function(e,t,n){var i=this.enter(),o=this,r=this.exit();return"function"==typeof e?(i=e(i))&&(i=i.selection()):i=i.append(e+""),null!=t&&(o=t(o))&&(o=o.selection()),null==n?r.remove():n(r),i&&o?i.merge(o).order():o},merge:function(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,o=n.length,r=i.length,s=Math.min(o,r),a=new Array(o),l=0;l<s;++l)for(var c,u=n[l],h=i[l],d=u.length,p=a[l]=new Array(d),f=0;f<d;++f)(c=u[f]||h[f])&&(p[f]=c);for(;l<o;++l)a[l]=n[l];return new gk(a,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i,o=e[t],r=o.length-1,s=o[r];--r>=0;)(i=o[r])&&(s&&4^i.compareDocumentPosition(s)&&s.parentNode.insertBefore(i,s),s=i);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=LA);for(var n=this._groups,i=n.length,o=new Array(i),r=0;r<i;++r){for(var s,a=n[r],l=a.length,c=o[r]=new Array(l),u=0;u<l;++u)(s=a[u])&&(c[u]=s);c.sort(t)}return new gk(o,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],o=0,r=i.length;o<r;++o){var s=i[o];if(s)return s}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var o,r=t[n],s=0,a=r.length;s<a;++s)(o=r[s])&&e.call(o,o.__data__,s,r);return this},attr:function(e,t){var n=uA(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==t?n.local?PA:RA:"function"==typeof t?n.local?OA:NA:n.local?MA:DA)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?FA:"function"==typeof t?UA:zA)(e,t,null==n?"":n)):$A(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?VA:"function"==typeof t?GA:HA)(e,t)):this.node()[e]},classed:function(e,t){var n=WA(e+"");if(arguments.length<2){for(var i=jA(this.node()),o=-1,r=n.length;++o<r;)if(!i.contains(n[o]))return!1;return!0}return this.each(("function"==typeof t?QA:t?KA:ZA)(n,t))},text:function(e){return arguments.length?this.each(null==e?JA:("function"==typeof e?tk:ek)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?nk:("function"==typeof e?ok:ik)(e)):this.node().innerHTML},raise:function(){return this.each(rk)},lower:function(){return this.each(sk)},append:function(e){var t="function"==typeof e?e:pA(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var n="function"==typeof e?e:pA(e),i=null==t?ak:"function"==typeof t?t:mA(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})},remove:function(){return this.each(lk)},clone:function(e){return this.select(e?uk:ck)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var i,o,r=function(e){return e.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}(e+""),s=r.length;if(!(arguments.length<2)){for(a=t?dk:hk,i=0;i<s;++i)this.each(a(r[i],t,n));return this}var a=this.node().__on;if(a)for(var l,c=0,u=a.length;c<u;++c)for(i=0,l=a[c];i<s;++i)if((o=r[i]).type===l.type&&o.name===l.name)return l.value},dispatch:function(e,t){return this.each(("function"==typeof t?mk:fk)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i,o=e[t],r=0,s=o.length;r<s;++r)(i=o[r])&&(yield i)}};var xk={value:()=>{}};function wk(){for(var e,t=0,n=arguments.length,i={};t<n;++t){if(!(e=arguments[t]+"")||e in i||/[\s.]/.test(e))throw new Error("illegal type: "+e);i[e]=[]}return new Sk(i)}function Sk(e){this._=e}function Ek(e,t){for(var n,i=0,o=e.length;i<o;++i)if((n=e[i]).name===t)return n.value}function Tk(e,t,n){for(var i=0,o=e.length;i<o;++i)if(e[i].name===t){e[i]=xk,e=e.slice(0,i).concat(e.slice(i+1));break}return null!=n&&e.push({name:t,value:n}),e}Sk.prototype=wk.prototype={constructor:Sk,on:function(e,t){var n,i,o=this._,r=(i=o,(e+"").trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");if(n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),e&&!i.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:t}})),s=-1,a=r.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++s<a;)if(n=(e=r[s]).type)o[n]=Tk(o[n],e.name,t);else if(null==t)for(n in o)o[n]=Tk(o[n],e.name,null);return this}for(;++s<a;)if((n=(e=r[s]).type)&&(n=Ek(o[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Sk(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,i,o=new Array(n),r=0;r<n;++r)o[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(r=0,n=(i=this._[e]).length;r<n;++r)i[r].value.apply(t,o)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],o=0,r=i.length;o<r;++o)i[o].value.apply(t,n)}};var Ck,Ik,Ak=0,kk=0,Lk=0,Rk=0,Pk=0,Dk=0,Mk="object"==typeof performance&&performance.now?performance:Date,Nk="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Ok(){return Pk||(Nk(Bk),Pk=Mk.now()+Dk)}function Bk(){Pk=0}function Fk(){this._call=this._time=this._next=null}function zk(e,t,n){var i=new Fk;return i.restart(e,t,n),i}function Uk(){Pk=(Rk=Mk.now())+Dk,Ak=kk=0;try{!function(){Ok(),++Ak;for(var e,t=Ck;t;)(e=Pk-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Ak}()}finally{Ak=0,function(){for(var e,t,n=Ck,i=1/0;n;)n._call?(i>n._time&&(i=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:Ck=t);Ik=e,Vk(i)}(),Pk=0}}function $k(){var e=Mk.now(),t=e-Rk;t>1e3&&(Dk-=t,Rk=e)}function Vk(e){Ak||(kk&&(kk=clearTimeout(kk)),e-Pk>24?(e<1/0&&(kk=setTimeout(Uk,e-Mk.now()-Dk)),Lk&&(Lk=clearInterval(Lk))):(Lk||(Rk=Mk.now(),Lk=setInterval($k,1e3)),Ak=1,Nk(Uk)))}function Hk(e,t,n){var i=new Fk;return t=null==t?0:+t,i.restart(n=>{i.stop(),e(n+t)},t,n),i}Fk.prototype=zk.prototype={constructor:Fk,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?Ok():+n)+(null==t?0:+t),this._next||Ik===this||(Ik?Ik._next=this:Ck=this,Ik=this),this._call=e,this._time=n,Vk()},stop:function(){this._call&&(this._call=null,this._time=1/0,Vk())}};var Gk=wk("start","end","cancel","interrupt"),Wk=[];function jk(e,t,n,i,o,r){var s=e.__transition;if(s){if(n in s)return}else e.__transition={};!function(e,t,n){var i,o=e.__transition;function r(l){var c,u,h,d;if(1!==n.state)return a();for(c in o)if((d=o[c]).name===n.name){if(3===d.state)return Hk(r);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",e,e.__data__,d.index,d.group),delete o[c]):+c<t&&(d.state=6,d.timer.stop(),d.on.call("cancel",e,e.__data__,d.index,d.group),delete o[c])}if(Hk(function(){3===n.state&&(n.state=4,n.timer.restart(s,n.delay,n.time),s(l))}),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,i=new Array(h=n.tween.length),c=0,u=-1;c<h;++c)(d=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(i[++u]=d);i.length=u+1}}function s(t){for(var o=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(a),n.state=5,1),r=-1,s=i.length;++r<s;)i[r].call(e,o);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),a())}function a(){for(var i in n.state=6,n.timer.stop(),delete o[t],o)return;delete e.__transition}o[t]=n,n.timer=zk(function(e){n.state=1,n.timer.restart(r,n.delay,n.time),n.delay<=e&&r(e-n.delay)},0,n.time)}(e,n,{name:t,index:i,group:o,on:Gk,tween:Wk,time:r.time,delay:r.delay,duration:r.duration,ease:r.ease,timer:null,state:0})}function Yk(e,t){var n=Xk(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function qk(e,t){var n=Xk(e,t);if(n.state>3)throw new Error("too late; already running");return n}function Xk(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Kk(e,t){var n,i,o,r=e.__transition,s=!0;if(r){for(o in t=null==t?null:t+"",r)(n=r[o]).name===t?(i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete r[o]):s=!1;s&&delete e.__transition}}function Zk(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Qk(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function Jk(){}var eL=.7,tL=1/eL,nL="\\s*([+-]?\\d+)\\s*",iL="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",oL="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",rL=/^#([0-9a-f]{3,8})$/,sL=new RegExp(`^rgb\\(${nL},${nL},${nL}\\)$`),aL=new RegExp(`^rgb\\(${oL},${oL},${oL}\\)$`),lL=new RegExp(`^rgba\\(${nL},${nL},${nL},${iL}\\)$`),cL=new RegExp(`^rgba\\(${oL},${oL},${oL},${iL}\\)$`),uL=new RegExp(`^hsl\\(${iL},${oL},${oL}\\)$`),hL=new RegExp(`^hsla\\(${iL},${oL},${oL},${iL}\\)$`),dL={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function pL(){return this.rgb().formatHex()}function fL(){return this.rgb().formatRgb()}function mL(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=rL.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?_L(t):3===n?new vL(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?gL(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?gL(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=sL.exec(e))?new vL(t[1],t[2],t[3],1):(t=aL.exec(e))?new vL(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=lL.exec(e))?gL(t[1],t[2],t[3],t[4]):(t=cL.exec(e))?gL(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=uL.exec(e))?CL(t[1],t[2]/100,t[3]/100,1):(t=hL.exec(e))?CL(t[1],t[2]/100,t[3]/100,t[4]):dL.hasOwnProperty(e)?_L(dL[e]):"transparent"===e?new vL(NaN,NaN,NaN,0):null}function _L(e){return new vL(e>>16&255,e>>8&255,255&e,1)}function gL(e,t,n,i){return i<=0&&(e=t=n=NaN),new vL(e,t,n,i)}function yL(e){return e instanceof Jk||(e=mL(e)),e?new vL((e=e.rgb()).r,e.g,e.b,e.opacity):new vL}function bL(e,t,n,i){return 1===arguments.length?yL(e):new vL(e,t,n,null==i?1:i)}function vL(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}function xL(){return`#${TL(this.r)}${TL(this.g)}${TL(this.b)}`}function wL(){const e=SL(this.opacity);return`${1===e?"rgb(":"rgba("}${EL(this.r)}, ${EL(this.g)}, ${EL(this.b)}${1===e?")":`, ${e})`}`}function SL(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function EL(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function TL(e){return((e=EL(e))<16?"0":"")+e.toString(16)}function CL(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new AL(e,t,n,i)}function IL(e){if(e instanceof AL)return new AL(e.h,e.s,e.l,e.opacity);if(e instanceof Jk||(e=mL(e)),!e)return new AL;if(e instanceof AL)return e;var t=(e=e.rgb()).r/255,n=e.g/255,i=e.b/255,o=Math.min(t,n,i),r=Math.max(t,n,i),s=NaN,a=r-o,l=(r+o)/2;return a?(s=t===r?(n-i)/a+6*(n<i):n===r?(i-t)/a+2:(t-n)/a+4,a/=l<.5?r+o:2-r-o,s*=60):a=l>0&&l<1?0:s,new AL(s,a,l,e.opacity)}function AL(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function kL(e){return(e=(e||0)%360)<0?e+360:e}function LL(e){return Math.max(0,Math.min(1,e||0))}function RL(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}Zk(Jk,mL,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:pL,formatHex:pL,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return IL(this).formatHsl()},formatRgb:fL,toString:fL}),Zk(vL,bL,Qk(Jk,{brighter(e){return e=null==e?tL:Math.pow(tL,e),new vL(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?eL:Math.pow(eL,e),new vL(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new vL(EL(this.r),EL(this.g),EL(this.b),SL(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:xL,formatHex:xL,formatHex8:function(){return`#${TL(this.r)}${TL(this.g)}${TL(this.b)}${TL(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:wL,toString:wL})),Zk(AL,function(e,t,n,i){return 1===arguments.length?IL(e):new AL(e,t,n,null==i?1:i)},Qk(Jk,{brighter(e){return e=null==e?tL:Math.pow(tL,e),new AL(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?eL:Math.pow(eL,e),new AL(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,o=2*n-i;return new vL(RL(e>=240?e-240:e+120,o,i),RL(e,o,i),RL(e<120?e+240:e-120,o,i),this.opacity)},clamp(){return new AL(kL(this.h),LL(this.s),LL(this.l),SL(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=SL(this.opacity);return`${1===e?"hsl(":"hsla("}${kL(this.h)}, ${100*LL(this.s)}%, ${100*LL(this.l)}%${1===e?")":`, ${e})`}`}}));const PL=Math.PI/180,DL=180/Math.PI;var ML=-.14861,NL=1.78277,OL=-.29227,BL=-.90649,FL=1.97294,zL=FL*BL,UL=FL*NL,$L=NL*OL-BL*ML;function VL(e,t,n,i){return 1===arguments.length?function(e){if(e instanceof HL)return new HL(e.h,e.s,e.l,e.opacity);e instanceof vL||(e=yL(e));var t=e.r/255,n=e.g/255,i=e.b/255,o=($L*i+zL*t-UL*n)/($L+zL-UL),r=i-o,s=(FL*(n-o)-OL*r)/BL,a=Math.sqrt(s*s+r*r)/(FL*o*(1-o)),l=a?Math.atan2(s,r)*DL-120:NaN;return new HL(l<0?l+360:l,a,o,e.opacity)}(e):new HL(e,t,n,null==i?1:i)}function HL(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}Zk(HL,VL,Qk(Jk,{brighter(e){return e=null==e?tL:Math.pow(tL,e),new HL(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?eL:Math.pow(eL,e),new HL(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=isNaN(this.h)?0:(this.h+120)*PL,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),i=Math.cos(e),o=Math.sin(e);return new vL(255*(t+n*(ML*i+NL*o)),255*(t+n*(OL*i+BL*o)),255*(t+n*(FL*i)),this.opacity)}}));const GL=e=>()=>e;function WL(e,t){return function(n){return e+n*t}}function jL(e,t){var n=t-e;return n?WL(e,n):GL(isNaN(e)?t:e)}const YL=function e(t){var n=function(e){return 1===(e=+e)?jL:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}(t,n,e):GL(isNaN(t)?n:t)}}(t);function i(e,t){var i=n((e=bL(e)).r,(t=bL(t)).r),o=n(e.g,t.g),r=n(e.b,t.b),s=jL(e.opacity,t.opacity);return function(t){return e.r=i(t),e.g=o(t),e.b=r(t),e.opacity=s(t),e+""}}return i.gamma=e,i}(1);function qL(e,t){t||(t=[]);var n,i=e?Math.min(t.length,e.length):0,o=t.slice();return function(r){for(n=0;n<i;++n)o[n]=e[n]*(1-r)+t[n]*r;return o}}function XL(e,t){var n,i=t?t.length:0,o=e?Math.min(i,e.length):0,r=new Array(o),s=new Array(i);for(n=0;n<o;++n)r[n]=nR(e[n],t[n]);for(;n<i;++n)s[n]=t[n];return function(e){for(n=0;n<o;++n)s[n]=r[n](e);return s}}function KL(e,t){var n=new Date;return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function ZL(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function QL(e,t){var n,i={},o={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?i[n]=nR(e[n],t[n]):o[n]=t[n];return function(e){for(n in i)o[n]=i[n](e);return o}}var JL=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,eR=new RegExp(JL.source,"g");function tR(e,t){var n,i,o,r=JL.lastIndex=eR.lastIndex=0,s=-1,a=[],l=[];for(e+="",t+="";(n=JL.exec(e))&&(i=eR.exec(t));)(o=i.index)>r&&(o=t.slice(r,o),a[s]?a[s]+=o:a[++s]=o),(n=n[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,l.push({i:s,x:ZL(n,i)})),r=eR.lastIndex;return r<t.length&&(o=t.slice(r),a[s]?a[s]+=o:a[++s]=o),a.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,i=0;i<t;++i)a[(n=l[i]).i]=n.x(e);return a.join("")})}function nR(e,t){var n,i,o=typeof t;return null==t||"boolean"===o?GL(t):("number"===o?ZL:"string"===o?(n=mL(t))?(t=n,YL):tR:t instanceof mL?YL:t instanceof Date?KL:(i=t,!ArrayBuffer.isView(i)||i instanceof DataView?Array.isArray(t)?XL:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?QL:ZL:qL))(e,t)}function iR(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var oR,rR=180/Math.PI,sR={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function aR(e,t,n,i,o,r){var s,a,l;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(l=e*n+t*i)&&(n-=e*l,i-=t*l),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,l/=a),e*i<t*n&&(e=-e,t=-t,l=-l,s=-s),{translateX:o,translateY:r,rotate:Math.atan2(t,e)*rR,skewX:Math.atan(l)*rR,scaleX:s,scaleY:a}}function lR(e,t,n,i){function o(e){return e.length?e.pop()+" ":""}return function(r,s){var a=[],l=[];return r=e(r),s=e(s),function(e,i,o,r,s,a){if(e!==o||i!==r){var l=s.push("translate(",null,t,null,n);a.push({i:l-4,x:ZL(e,o)},{i:l-2,x:ZL(i,r)})}else(o||r)&&s.push("translate("+o+t+r+n)}(r.translateX,r.translateY,s.translateX,s.translateY,a,l),function(e,t,n,r){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),r.push({i:n.push(o(n)+"rotate(",null,i)-2,x:ZL(e,t)})):t&&n.push(o(n)+"rotate("+t+i)}(r.rotate,s.rotate,a,l),function(e,t,n,r){e!==t?r.push({i:n.push(o(n)+"skewX(",null,i)-2,x:ZL(e,t)}):t&&n.push(o(n)+"skewX("+t+i)}(r.skewX,s.skewX,a,l),function(e,t,n,i,r,s){if(e!==n||t!==i){var a=r.push(o(r)+"scale(",null,",",null,")");s.push({i:a-4,x:ZL(e,n)},{i:a-2,x:ZL(t,i)})}else 1===n&&1===i||r.push(o(r)+"scale("+n+","+i+")")}(r.scaleX,r.scaleY,s.scaleX,s.scaleY,a,l),r=s=null,function(e){for(var t,n=-1,i=l.length;++n<i;)a[(t=l[n]).i]=t.x(e);return a.join("")}}}var cR=lR(function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?sR:aR(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),uR=lR(function(e){return null==e?sR:(oR||(oR=document.createElementNS("http://www.w3.org/2000/svg","g")),oR.setAttribute("transform",e),(e=oR.transform.baseVal.consolidate())?aR((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):sR)},", ",")",")");function hR(e){return function t(n){function i(t,i){var o=e((t=VL(t)).h,(i=VL(i)).h),r=jL(t.s,i.s),s=jL(t.l,i.l),a=jL(t.opacity,i.opacity);return function(e){return t.h=o(e),t.s=r(e),t.l=s(Math.pow(e,n)),t.opacity=a(e),t+""}}return n=+n,i.gamma=t,i}(1)}const dR=hR(function(e,t){var n=t-e;return n?WL(e,n>180||n<-180?n-360*Math.round(n/360):n):GL(isNaN(e)?t:e)});function pR(e,t){void 0===t&&(t=e,e=nR);for(var n=0,i=t.length-1,o=t[0],r=new Array(i<0?0:i);n<i;)r[n]=e(o,o=t[++n]);return function(e){var t=Math.max(0,Math.min(i-1,Math.floor(e*=i)));return r[t](e-t)}}function fR(e,t){var n,i;return function(){var o=qk(this,e),r=o.tween;if(r!==n)for(var s=0,a=(i=n=r).length;s<a;++s)if(i[s].name===t){(i=i.slice()).splice(s,1);break}o.tween=i}}function mR(e,t,n){var i,o;if("function"!=typeof n)throw new Error;return function(){var r=qk(this,e),s=r.tween;if(s!==i){o=(i=s).slice();for(var a={name:t,value:n},l=0,c=o.length;l<c;++l)if(o[l].name===t){o[l]=a;break}l===c&&o.push(a)}r.tween=o}}function _R(e,t,n){var i=e._id;return e.each(function(){var e=qk(this,i);(e.value||(e.value={}))[t]=n.apply(this,arguments)}),function(e){return Xk(e,i).value[t]}}function gR(e,t){var n;return("number"==typeof t?ZL:t instanceof mL?YL:(n=mL(t))?(t=n,YL):tR)(e,t)}function yR(e){return function(){this.removeAttribute(e)}}function bR(e){return function(){this.removeAttributeNS(e.space,e.local)}}function vR(e,t,n){var i,o,r=n+"";return function(){var s=this.getAttribute(e);return s===r?null:s===i?o:o=t(i=s,n)}}function xR(e,t,n){var i,o,r=n+"";return function(){var s=this.getAttributeNS(e.space,e.local);return s===r?null:s===i?o:o=t(i=s,n)}}function wR(e,t,n){var i,o,r;return function(){var s,a,l=n(this);if(null!=l)return(s=this.getAttribute(e))===(a=l+"")?null:s===i&&a===o?r:(o=a,r=t(i=s,l));this.removeAttribute(e)}}function SR(e,t,n){var i,o,r;return function(){var s,a,l=n(this);if(null!=l)return(s=this.getAttributeNS(e.space,e.local))===(a=l+"")?null:s===i&&a===o?r:(o=a,r=t(i=s,l));this.removeAttributeNS(e.space,e.local)}}function ER(e,t){var n,i;function o(){var o=t.apply(this,arguments);return o!==i&&(n=(i=o)&&function(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}(e,o)),n}return o._value=t,o}function TR(e,t){var n,i;function o(){var o=t.apply(this,arguments);return o!==i&&(n=(i=o)&&function(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}(e,o)),n}return o._value=t,o}function CR(e,t){return function(){Yk(this,e).delay=+t.apply(this,arguments)}}function IR(e,t){return t=+t,function(){Yk(this,e).delay=t}}function AR(e,t){return function(){qk(this,e).duration=+t.apply(this,arguments)}}function kR(e,t){return t=+t,function(){qk(this,e).duration=t}}hR(jL);var LR=yk.prototype.constructor;function RR(e){return function(){this.style.removeProperty(e)}}var PR=0;function DR(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function MR(){return++PR}var NR=yk.prototype;DR.prototype={constructor:DR,select:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=mA(e));for(var i=this._groups,o=i.length,r=new Array(o),s=0;s<o;++s)for(var a,l,c=i[s],u=c.length,h=r[s]=new Array(u),d=0;d<u;++d)(a=c[d])&&(l=e.call(a,a.__data__,d,c))&&("__data__"in a&&(l.__data__=a.__data__),h[d]=l,jk(h[d],t,n,d,h,Xk(a,n)));return new DR(r,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=gA(e));for(var i=this._groups,o=i.length,r=[],s=[],a=0;a<o;++a)for(var l,c=i[a],u=c.length,h=0;h<u;++h)if(l=c[h]){for(var d,p=e.call(l,l.__data__,h,c),f=Xk(l,n),m=0,_=p.length;m<_;++m)(d=p[m])&&jk(d,t,n,m,p,f);r.push(p),s.push(l)}return new DR(r,s,t,n)},selectChild:NR.selectChild,selectChildren:NR.selectChildren,filter:function(e){"function"!=typeof e&&(e=yA(e));for(var t=this._groups,n=t.length,i=new Array(n),o=0;o<n;++o)for(var r,s=t[o],a=s.length,l=i[o]=[],c=0;c<a;++c)(r=s[c])&&e.call(r,r.__data__,c,s)&&l.push(r);return new DR(i,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,o=n.length,r=Math.min(i,o),s=new Array(i),a=0;a<r;++a)for(var l,c=t[a],u=n[a],h=c.length,d=s[a]=new Array(h),p=0;p<h;++p)(l=c[p]||u[p])&&(d[p]=l);for(;a<i;++a)s[a]=t[a];return new DR(s,this._parents,this._name,this._id)},selection:function(){return new LR(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=MR(),i=this._groups,o=i.length,r=0;r<o;++r)for(var s,a=i[r],l=a.length,c=0;c<l;++c)if(s=a[c]){var u=Xk(s,t);jk(s,e,n,c,a,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new DR(i,this._parents,e,n)},call:NR.call,nodes:NR.nodes,node:NR.node,size:NR.size,empty:NR.empty,each:NR.each,on:function(e,t){var n=this._id;return arguments.length<2?Xk(this.node(),n).on.on(e):this.each(function(e,t,n){var i,o,r=function(e){return(e+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e})}(t)?Yk:qk;return function(){var s=r(this,e),a=s.on;a!==i&&(o=(i=a).copy()).on(t,n),s.on=o}}(n,e,t))},attr:function(e,t){var n=uA(e),i="transform"===n?uR:gR;return this.attrTween(e,"function"==typeof t?(n.local?SR:wR)(n,i,_R(this,"attr."+e,t)):null==t?(n.local?bR:yR)(n):(n.local?xR:vR)(n,i,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;var i=uA(e);return this.tween(n,(i.local?ER:TR)(i,t))},style:function(e,t,n){var i="transform"==(e+="")?cR:gR;return null==t?this.styleTween(e,function(e,t){var n,i,o;return function(){var r=$A(this,e),s=(this.style.removeProperty(e),$A(this,e));return r===s?null:r===n&&s===i?o:o=t(n=r,i=s)}}(e,i)).on("end.style."+e,RR(e)):"function"==typeof t?this.styleTween(e,function(e,t,n){var i,o,r;return function(){var s=$A(this,e),a=n(this),l=a+"";return null==a&&(this.style.removeProperty(e),l=a=$A(this,e)),s===l?null:s===i&&l===o?r:(o=l,r=t(i=s,a))}}(e,i,_R(this,"style."+e,t))).each(function(e,t){var n,i,o,r,s="style."+t,a="end."+s;return function(){var l=qk(this,e),c=l.on,u=null==l.value[s]?r||(r=RR(t)):void 0;c===n&&o===u||(i=(n=c).copy()).on(a,o=u),l.on=i}}(this._id,e)):this.styleTween(e,function(e,t,n){var i,o,r=n+"";return function(){var s=$A(this,e);return s===r?null:s===i?o:o=t(i=s,n)}}(e,i,t),n).on("end.style."+e,null)},styleTween:function(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==t)return this.tween(i,null);if("function"!=typeof t)throw new Error;return this.tween(i,function(e,t,n){var i,o;function r(){var r=t.apply(this,arguments);return r!==o&&(i=(o=r)&&function(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}(e,r,n)),i}return r._value=t,r}(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"==typeof e?function(e){return function(){var t=e(this);this.textContent=null==t?"":t}}(_R(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,function(e){var t,n;function i(){var i=e.apply(this,arguments);return i!==n&&(t=(n=i)&&function(e){return function(t){this.textContent=e.call(this,t)}}(i)),t}return i._value=e,i}(e))},remove:function(){return this.on("end.remove",(e=this._id,function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}));var e},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var i,o=Xk(this.node(),n).tween,r=0,s=o.length;r<s;++r)if((i=o[r]).name===e)return i.value;return null}return this.each((null==t?fR:mR)(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?CR:IR)(t,e)):Xk(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?AR:kR)(t,e)):Xk(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(function(e,t){if("function"!=typeof t)throw new Error;return function(){qk(this,e).ease=t}}(t,e)):Xk(this.node(),t).ease},easeVarying:function(e){if("function"!=typeof e)throw new Error;return this.each(function(e,t){return function(){var n=t.apply(this,arguments);if("function"!=typeof n)throw new Error;qk(this,e).ease=n}}(this._id,e))},end:function(){var e,t,n=this,i=n._id,o=n.size();return new Promise(function(r,s){var a={value:s},l={value:function(){0===--o&&r()}};n.each(function(){var n=qk(this,i),o=n.on;o!==e&&((t=(e=o).copy())._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),n.on=t}),0===o&&r()})},[Symbol.iterator]:NR[Symbol.iterator]};var OR={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function BR(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}yk.prototype.interrupt=function(e){return this.each(function(){Kk(this,e)})},yk.prototype.transition=function(e){var t,n;e instanceof DR?(t=e._id,e=e._name):(t=MR(),(n=OR).time=Ok(),e=null==e?null:e+"");for(var i=this._groups,o=i.length,r=0;r<o;++r)for(var s,a=i[r],l=a.length,c=0;c<l;++c)(s=a[c])&&jk(s,e,t,c,a,n||BR(s,t));return new DR(i,this._parents,e,t)};var FR,zR,UR=[],$R=function(){return UR.some(function(e){return e.activeTargets.length>0})},VR="ResizeObserver loop completed with undelivered notifications.";(zR=FR||(FR={})).BORDER_BOX="border-box",zR.CONTENT_BOX="content-box",zR.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box";var HR,GR=function(e){return Object.freeze(e)},WR=function(){return function(e,t){this.inlineSize=e,this.blockSize=t,GR(this)}}(),jR=function(){function e(e,t,n,i){return this.x=e,this.y=t,this.width=n,this.height=i,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,GR(this)}return e.prototype.toJSON=function(){var e=this;return{x:e.x,y:e.y,top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.width,height:e.height}},e.fromRect=function(t){return new e(t.x,t.y,t.width,t.height)},e}(),YR=function(e){return e instanceof SVGElement&&"getBBox"in e},qR=function(e){if(YR(e)){var t=e.getBBox(),n=t.width,i=t.height;return!n&&!i}var o=e,r=o.offsetWidth,s=o.offsetHeight;return!(r||s||e.getClientRects().length)},XR=function(e){var t;if(e instanceof Element)return!0;var n=null===(t=null==e?void 0:e.ownerDocument)||void 0===t?void 0:t.defaultView;return!!(n&&e instanceof n.Element)},KR="undefined"!=typeof window?window:{},ZR=new WeakMap,QR=/auto|scroll/,JR=/^tb|vertical/,eP=/msie|trident/i.test(KR.navigator&&KR.navigator.userAgent),tP=function(e){return parseFloat(e||"0")},nP=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=!1),new WR((n?t:e)||0,(n?e:t)||0)},iP=GR({devicePixelContentBoxSize:nP(),borderBoxSize:nP(),contentBoxSize:nP(),contentRect:new jR(0,0,0,0)}),oP=function(e,t){if(void 0===t&&(t=!1),ZR.has(e)&&!t)return ZR.get(e);if(qR(e))return ZR.set(e,iP),iP;var n=getComputedStyle(e),i=YR(e)&&e.ownerSVGElement&&e.getBBox(),o=!eP&&"border-box"===n.boxSizing,r=JR.test(n.writingMode||""),s=!i&&QR.test(n.overflowY||""),a=!i&&QR.test(n.overflowX||""),l=i?0:tP(n.paddingTop),c=i?0:tP(n.paddingRight),u=i?0:tP(n.paddingBottom),h=i?0:tP(n.paddingLeft),d=i?0:tP(n.borderTopWidth),p=i?0:tP(n.borderRightWidth),f=i?0:tP(n.borderBottomWidth),m=h+c,_=l+u,g=(i?0:tP(n.borderLeftWidth))+p,y=d+f,b=a?e.offsetHeight-y-e.clientHeight:0,v=s?e.offsetWidth-g-e.clientWidth:0,x=o?m+g:0,w=o?_+y:0,S=i?i.width:tP(n.width)-x-v,E=i?i.height:tP(n.height)-w-b,T=S+m+v+g,C=E+_+b+y,I=GR({devicePixelContentBoxSize:nP(Math.round(S*devicePixelRatio),Math.round(E*devicePixelRatio),r),borderBoxSize:nP(T,C,r),contentBoxSize:nP(S,E,r),contentRect:new jR(h,l,S,E)});return ZR.set(e,I),I},rP=function(e,t,n){var i=oP(e,n),o=i.borderBoxSize,r=i.contentBoxSize,s=i.devicePixelContentBoxSize;switch(t){case FR.DEVICE_PIXEL_CONTENT_BOX:return s;case FR.BORDER_BOX:return o;default:return r}},sP=function(){return function(e){var t=oP(e);this.target=e,this.contentRect=t.contentRect,this.borderBoxSize=GR([t.borderBoxSize]),this.contentBoxSize=GR([t.contentBoxSize]),this.devicePixelContentBoxSize=GR([t.devicePixelContentBoxSize])}}(),aP=function(e){if(qR(e))return 1/0;for(var t=0,n=e.parentNode;n;)t+=1,n=n.parentNode;return t},lP=function(){var e=1/0,t=[];UR.forEach(function(n){if(0!==n.activeTargets.length){var i=[];n.activeTargets.forEach(function(t){var n=new sP(t.target),o=aP(t.target);i.push(n),t.lastReportedSize=rP(t.target,t.observedBox),o<e&&(e=o)}),t.push(function(){n.callback.call(n.observer,i,n.observer)}),n.activeTargets.splice(0,n.activeTargets.length)}});for(var n=0,i=t;n<i.length;n++)(0,i[n])();return e},cP=function(e){UR.forEach(function(t){t.activeTargets.splice(0,t.activeTargets.length),t.skippedTargets.splice(0,t.skippedTargets.length),t.observationTargets.forEach(function(n){n.isActive()&&(aP(n.target)>e?t.activeTargets.push(n):t.skippedTargets.push(n))})})},uP=[],hP=0,dP={attributes:!0,characterData:!0,childList:!0,subtree:!0},pP=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],fP=function(e){return void 0===e&&(e=0),Date.now()+e},mP=!1,_P=new(function(){function e(){var e=this;this.stopped=!0,this.listener=function(){return e.schedule()}}return e.prototype.run=function(e){var t=this;if(void 0===e&&(e=250),!mP){mP=!0;var n,i=fP(e);n=function(){var n=!1;try{n=function(){var e,t=0;for(cP(t);$R();)t=lP(),cP(t);return UR.some(function(e){return e.skippedTargets.length>0})&&("function"==typeof ErrorEvent?e=new ErrorEvent("error",{message:VR}):((e=document.createEvent("Event")).initEvent("error",!1,!1),e.message=VR),window.dispatchEvent(e)),t>0}()}finally{if(mP=!1,e=i-fP(),!hP)return;n?t.run(1e3):e>0?t.run(e):t.start()}},function(e){if(!HR){var t=0,n=document.createTextNode("");new MutationObserver(function(){return uP.splice(0).forEach(function(e){return e()})}).observe(n,{characterData:!0}),HR=function(){n.textContent="".concat(t?t--:t++)}}uP.push(e),HR()}(function(){requestAnimationFrame(n)})}},e.prototype.schedule=function(){this.stop(),this.run()},e.prototype.observe=function(){var e=this,t=function(){return e.observer&&e.observer.observe(document.body,dP)};document.body?t():KR.addEventListener("DOMContentLoaded",t)},e.prototype.start=function(){var e=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),pP.forEach(function(t){return KR.addEventListener(t,e.listener,!0)}))},e.prototype.stop=function(){var e=this;this.stopped||(this.observer&&this.observer.disconnect(),pP.forEach(function(t){return KR.removeEventListener(t,e.listener,!0)}),this.stopped=!0)},e}()),gP=function(e){!hP&&e>0&&_P.start(),!(hP+=e)&&_P.stop()},yP=function(){function e(e,t){this.target=e,this.observedBox=t||FR.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return e.prototype.isActive=function(){var e,t=rP(this.target,this.observedBox,!0);return e=this.target,YR(e)||function(e){switch(e.tagName){case"INPUT":if("image"!==e.type)break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1}(e)||"inline"!==getComputedStyle(e).display||(this.lastReportedSize=t),this.lastReportedSize.inlineSize!==t.inlineSize||this.lastReportedSize.blockSize!==t.blockSize},e}(),bP=function(){return function(e,t){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=e,this.callback=t}}(),vP=new WeakMap,xP=function(e,t){for(var n=0;n<e.length;n+=1)if(e[n].target===t)return n;return-1},wP=function(){function e(){}return e.connect=function(e,t){var n=new bP(e,t);vP.set(e,n)},e.observe=function(e,t,n){var i=vP.get(e),o=0===i.observationTargets.length;xP(i.observationTargets,t)<0&&(o&&UR.push(i),i.observationTargets.push(new yP(t,n&&n.box)),gP(1),_P.schedule())},e.unobserve=function(e,t){var n=vP.get(e),i=xP(n.observationTargets,t),o=1===n.observationTargets.length;i>=0&&(o&&UR.splice(UR.indexOf(n),1),n.observationTargets.splice(i,1),gP(-1))},e.disconnect=function(e){var t=this,n=vP.get(e);n.observationTargets.slice().forEach(function(n){return t.unobserve(e,n.target)}),n.activeTargets.splice(0,n.activeTargets.length)},e}(),SP=function(){function e(e){if(0===arguments.length)throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if("function"!=typeof e)throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");wP.connect(this,e)}return e.prototype.observe=function(e,t){if(0===arguments.length)throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!XR(e))throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");wP.observe(this,e,t)},e.prototype.unobserve=function(e){if(0===arguments.length)throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!XR(e))throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");wP.unobserve(this,e)},e.prototype.disconnect=function(){wP.disconnect(this)},e.toString=function(){return"function ResizeObserver () { [polyfill code] }"},e}();function EP(e){return e}var TP=1e-6;function CP(e){return"translate("+e+",0)"}function IP(e){return t=>+e(t)}function AP(e,t){return t=Math.max(0,e.bandwidth()-2*t)/2,e.round()&&(t=Math.round(t)),n=>+e(n)+t}function kP(){return!this.__axis}function LP(e,t){var n=[],i=null,o=null,r=6,s=6,a=3,l="undefined"!=typeof window&&window.devicePixelRatio>1?0:.5,c=CP;function u(e){var u=null==i?t.ticks?t.ticks.apply(t,n):t.domain():i,h=null==o?t.tickFormat?t.tickFormat.apply(t,n):EP:o,d=Math.max(r,0)+a,p=t.range(),f=+p[0]+l,m=+p[p.length-1]+l,_=(t.bandwidth?AP:IP)(t.copy(),l),g=e.selection?e.selection():e,y=g.selectAll(".domain").data([null]),b=g.selectAll(".tick").data(u,t).order(),v=b.exit(),x=b.enter().append("g").attr("class","tick"),w=b.select("line"),S=b.select("text");y=y.merge(y.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),b=b.merge(x),w=w.merge(x.append("line").attr("stroke","currentColor").attr("y2",1*r)),S=S.merge(x.append("text").attr("fill","currentColor").attr("y",1*d).attr("dy","0.71em")),e!==g&&(y=y.transition(e),b=b.transition(e),w=w.transition(e),S=S.transition(e),v=v.transition(e).attr("opacity",TP).attr("transform",function(e){return isFinite(e=_(e))?c(e+l):this.getAttribute("transform")}),x.attr("opacity",TP).attr("transform",function(e){var t=this.parentNode.__axis;return c((t&&isFinite(t=t(e))?t:_(e))+l)})),v.remove(),y.attr("d",s?"M"+f+","+1*s+"V"+l+"H"+m+"V"+1*s:"M"+f+","+l+"H"+m),b.attr("opacity",1).attr("transform",function(e){return c(_(e)+l)}),w.attr("y2",1*r),S.attr("y",1*d).text(h),g.filter(kP).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor","middle"),g.each(function(){this.__axis=_})}return u.scale=function(e){return arguments.length?(t=e,u):t},u.ticks=function(){return n=Array.from(arguments),u},u.tickArguments=function(e){return arguments.length?(n=null==e?[]:Array.from(e),u):n.slice()},u.tickValues=function(e){return arguments.length?(i=null==e?null:Array.from(e),u):i&&i.slice()},u.tickFormat=function(e){return arguments.length?(o=e,u):o},u.tickSize=function(e){return arguments.length?(r=s=+e,u):r},u.tickSizeInner=function(e){return arguments.length?(r=+e,u):r},u.tickSizeOuter=function(e){return arguments.length?(s=+e,u):s},u.tickPadding=function(e){return arguments.length?(a=+e,u):a},u.offset=function(e){return arguments.length?(l=+e,u):l},u}function RP(e){return LP(0,e)}const PP={capture:!0,passive:!1};function DP(e){e.preventDefault(),e.stopImmediatePropagation()}const MP=e=>()=>e;function NP(e,{sourceEvent:t,target:n,selection:i,mode:o,dispatch:r}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},selection:{value:i,enumerable:!0,configurable:!0},mode:{value:o,enumerable:!0,configurable:!0},_:{value:r}})}function OP(e){e.preventDefault(),e.stopImmediatePropagation()}var BP={name:"drag"},FP={name:"space"},zP={name:"handle"},UP={name:"center"};const{abs:$P,max:VP,min:HP}=Math;function GP(e){return[+e[0],+e[1]]}function WP(e){return[GP(e[0]),GP(e[1])]}var jP={name:"x",handles:["w","e"].map(eD),input:function(e,t){return null==e?null:[[+e[0],t[0][1]],[+e[1],t[1][1]]]},output:function(e){return e&&[e[0][0],e[1][0]]}},YP={},qP={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(eD),input:function(e){return null==e?null:WP(e)},output:function(e){return e}},XP={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},KP={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},ZP={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},QP={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},JP={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function eD(e){return{type:e}}function tD(e){return!e.ctrlKey&&!e.button}function nD(){var e=this.ownerSVGElement||this;return e.hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]}function iD(){return navigator.maxTouchPoints||"ontouchstart"in this}function oD(e){for(;!e.__brush;)if(!(e=e.parentNode))return;return e.__brush}function rD(){return sD(jP)}function sD(e){var t,n=nD,i=tD,o=iD,r=!0,s=wk("start","brush","end"),a=6;function l(t){var n=t.property("__brush",m).selectAll(".overlay").data([eD("overlay")]);n.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",XP.overlay).merge(n).each(function(){var e=oD(this).extent;bk(this).attr("x",e[0][0]).attr("y",e[0][1]).attr("width",e[1][0]-e[0][0]).attr("height",e[1][1]-e[0][1])}),t.selectAll(".selection").data([eD("selection")]).enter().append("rect").attr("class","selection").attr("cursor",XP.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var i=t.selectAll(".handle").data(e.handles,function(e){return e.type});i.exit().remove(),i.enter().append("rect").attr("class",function(e){return"handle handle--"+e.type}).attr("cursor",function(e){return XP[e.type]}),t.each(c).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",d).filter(o).on("touchstart.brush",d).on("touchmove.brush",p).on("touchend.brush touchcancel.brush",f).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function c(){var e=bk(this),t=oD(this).selection;t?(e.selectAll(".selection").style("display",null).attr("x",t[0][0]).attr("y",t[0][1]).attr("width",t[1][0]-t[0][0]).attr("height",t[1][1]-t[0][1]),e.selectAll(".handle").style("display",null).attr("x",function(e){return"e"===e.type[e.type.length-1]?t[1][0]-a/2:t[0][0]-a/2}).attr("y",function(e){return"s"===e.type[0]?t[1][1]-a/2:t[0][1]-a/2}).attr("width",function(e){return"n"===e.type||"s"===e.type?t[1][0]-t[0][0]+a:a}).attr("height",function(e){return"e"===e.type||"w"===e.type?t[1][1]-t[0][1]+a:a})):e.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function u(e,t,n){var i=e.__brush.emitter;return!i||n&&i.clean?new h(e,t,n):i}function h(e,t,n){this.that=e,this.args=t,this.state=e.__brush,this.active=0,this.clean=n}function d(n){if((!t||n.touches)&&i.apply(this,arguments)){var o,s,a,l,h,d,p,f,m,_,g,y=this,b=n.target.__data__.type,v="selection"===(r&&n.metaKey?b="overlay":b)?BP:r&&n.altKey?UP:zP,x=e===YP?null:QP[b],w=e===jP?null:JP[b],S=oD(y),E=S.extent,T=S.selection,C=E[0][0],I=E[0][1],A=E[1][0],k=E[1][1],L=0,R=0,P=x&&w&&r&&n.shiftKey,D=Array.from(n.touches||[n],e=>{const t=e.identifier;return(e=vk(e,y)).point0=e.slice(),e.identifier=t,e});Kk(y);var M=u(y,arguments,!0).beforestart();if("overlay"===b){T&&(m=!0);const t=[D[0],D[1]||D[0]];S.selection=T=[[o=e===YP?C:HP(t[0][0],t[1][0]),a=e===jP?I:HP(t[0][1],t[1][1])],[h=e===YP?A:VP(t[0][0],t[1][0]),p=e===jP?k:VP(t[0][1],t[1][1])]],D.length>1&&z(n)}else o=T[0][0],a=T[0][1],h=T[1][0],p=T[1][1];s=o,l=a,d=h,f=p;var N=bk(y).attr("pointer-events","none"),O=N.selectAll(".overlay").attr("cursor",XP[b]);if(n.touches)M.moved=F,M.ended=U;else{var B=bk(n.view).on("mousemove.brush",F,!0).on("mouseup.brush",U,!0);r&&B.on("keydown.brush",function(e){switch(e.keyCode){case 16:P=x&&w;break;case 18:v===zP&&(x&&(h=d-L*x,o=s+L*x),w&&(p=f-R*w,a=l+R*w),v=UP,z(e));break;case 32:v!==zP&&v!==UP||(x<0?h=d-L:x>0&&(o=s-L),w<0?p=f-R:w>0&&(a=l-R),v=FP,O.attr("cursor",XP.selection),z(e));break;default:return}OP(e)},!0).on("keyup.brush",function(e){switch(e.keyCode){case 16:P&&(_=g=P=!1,z(e));break;case 18:v===UP&&(x<0?h=d:x>0&&(o=s),w<0?p=f:w>0&&(a=l),v=zP,z(e));break;case 32:v===FP&&(e.altKey?(x&&(h=d-L*x,o=s+L*x),w&&(p=f-R*w,a=l+R*w),v=UP):(x<0?h=d:x>0&&(o=s),w<0?p=f:w>0&&(a=l),v=zP),O.attr("cursor",XP[b]),z(e));break;default:return}OP(e)},!0),function(e){var t=e.document.documentElement,n=bk(e).on("dragstart.drag",DP,PP);"onselectstart"in t?n.on("selectstart.drag",DP,PP):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}(n.view)}c.call(y),M.start(n,v.name)}function F(e){for(const t of e.changedTouches||[e])for(const e of D)e.identifier===t.identifier&&(e.cur=vk(t,y));if(P&&!_&&!g&&1===D.length){const e=D[0];$P(e.cur[0]-e[0])>$P(e.cur[1]-e[1])?g=!0:_=!0}for(const t of D)t.cur&&(t[0]=t.cur[0],t[1]=t.cur[1]);m=!0,OP(e),z(e)}function z(e){const t=D[0],n=t.point0;var i;switch(L=t[0]-n[0],R=t[1]-n[1],v){case FP:case BP:x&&(L=VP(C-o,HP(A-h,L)),s=o+L,d=h+L),w&&(R=VP(I-a,HP(k-p,R)),l=a+R,f=p+R);break;case zP:D[1]?(x&&(s=VP(C,HP(A,D[0][0])),d=VP(C,HP(A,D[1][0])),x=1),w&&(l=VP(I,HP(k,D[0][1])),f=VP(I,HP(k,D[1][1])),w=1)):(x<0?(L=VP(C-o,HP(A-o,L)),s=o+L,d=h):x>0&&(L=VP(C-h,HP(A-h,L)),s=o,d=h+L),w<0?(R=VP(I-a,HP(k-a,R)),l=a+R,f=p):w>0&&(R=VP(I-p,HP(k-p,R)),l=a,f=p+R));break;case UP:x&&(s=VP(C,HP(A,o-L*x)),d=VP(C,HP(A,h+L*x))),w&&(l=VP(I,HP(k,a-R*w)),f=VP(I,HP(k,p+R*w)))}d<s&&(x*=-1,i=o,o=h,h=i,i=s,s=d,d=i,b in KP&&O.attr("cursor",XP[b=KP[b]])),f<l&&(w*=-1,i=a,a=p,p=i,i=l,l=f,f=i,b in ZP&&O.attr("cursor",XP[b=ZP[b]])),S.selection&&(T=S.selection),_&&(s=T[0][0],d=T[1][0]),g&&(l=T[0][1],f=T[1][1]),T[0][0]===s&&T[0][1]===l&&T[1][0]===d&&T[1][1]===f||(S.selection=[[s,l],[d,f]],c.call(y),M.brush(e,v.name))}function U(e){if(function(e){e.stopImmediatePropagation()}(e),e.touches){if(e.touches.length)return;t&&clearTimeout(t),t=setTimeout(function(){t=null},500)}else!function(e,t){var n=e.document.documentElement,i=bk(e).on("dragstart.drag",null);t&&(i.on("click.drag",DP,PP),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}(e.view,m),B.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);N.attr("pointer-events","all"),O.attr("cursor",XP.overlay),S.selection&&(T=S.selection),function(e){return e[0][0]===e[1][0]||e[0][1]===e[1][1]}(T)&&(S.selection=null,c.call(y)),M.end(e,v.name)}}function p(e){u(this,arguments).moved(e)}function f(e){u(this,arguments).ended(e)}function m(){var t=this.__brush||{selection:null};return t.extent=WP(n.apply(this,arguments)),t.dim=e,t}return l.move=function(t,n,i){t.tween?t.on("start.brush",function(e){u(this,arguments).beforestart().start(e)}).on("interrupt.brush end.brush",function(e){u(this,arguments).end(e)}).tween("brush",function(){var t=this,i=t.__brush,o=u(t,arguments),r=i.selection,s=e.input("function"==typeof n?n.apply(this,arguments):n,i.extent),a=nR(r,s);function l(e){i.selection=1===e&&null===s?null:a(e),c.call(t),o.brush()}return null!==r&&null!==s?l:l(1)}):t.each(function(){var t=this,o=arguments,r=t.__brush,s=e.input("function"==typeof n?n.apply(t,o):n,r.extent),a=u(t,o).beforestart();Kk(t),r.selection=null===s?null:s,c.call(t),a.start(i).brush(i).end(i)})},l.clear=function(e,t){l.move(e,null,t)},h.prototype={beforestart:function(){return 1===++this.active&&(this.state.emitter=this,this.starting=!0),this},start:function(e,t){return this.starting?(this.starting=!1,this.emit("start",e,t)):this.emit("brush",e),this},brush:function(e,t){return this.emit("brush",e,t),this},end:function(e,t){return 0===--this.active&&(delete this.state.emitter,this.emit("end",e,t)),this},emit:function(t,n,i){var o=bk(this.that).datum();s.call(t,this.that,new NP(t,{sourceEvent:n,target:l,selection:e.output(this.state.selection),mode:i,dispatch:s}),o)}},l.extent=function(e){return arguments.length?(n="function"==typeof e?e:MP(WP(e)),l):n},l.filter=function(e){return arguments.length?(i="function"==typeof e?e:MP(!!e),l):i},l.touchable=function(e){return arguments.length?(o="function"==typeof e?e:MP(!!e),l):o},l.handleSize=function(e){return arguments.length?(a=+e,l):a},l.keyModifiers=function(e){return arguments.length?(r=!!e,l):r},l.on=function(){var e=s.on.apply(s,arguments);return e===s?l:e},l}function aD(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function lD(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function cD(e){let t,n,i;function o(e,i,o=0,r=e.length){if(o<r){if(0!==t(i,i))return r;do{const t=o+r>>>1;n(e[t],i)<0?o=t+1:r=t}while(o<r)}return o}return 2!==e.length?(t=aD,n=(t,n)=>aD(e(t),n),i=(t,n)=>e(t)-n):(t=e===aD||e===lD?e:uD,n=e,i=e),{left:o,center:function(e,t,n=0,r=e.length){const s=o(e,t,n,r-1);return s>n&&i(e[s-1],t)>-i(e[s],t)?s-1:s},right:function(e,i,o=0,r=e.length){if(o<r){if(0!==t(i,i))return r;do{const t=o+r>>>1;n(e[t],i)<=0?o=t+1:r=t}while(o<r)}return o}}}function uD(){return 0}const hD=cD(aD).right;cD(function(e){return null===e?NaN:+e}).center;const dD=(pD=function(e){const t=Math.floor(e);if(t===e)return function(e){const t=2*e+1;return(n,i,o,r,s)=>{if(!((r-=s)>=o))return;let a=e*i[o];const l=s*e;for(let e=o,t=o+l;e<t;e+=s)a+=i[Math.min(r,e)];for(let e=o,c=r;e<=c;e+=s)a+=i[Math.min(r,e+l)],n[e]=a/t,a-=i[Math.max(o,e-l)]}}(e);const n=e-t,i=2*e+1;return(e,o,r,s,a)=>{if(!((s-=a)>=r))return;let l=t*o[r];const c=a*t,u=c+a;for(let t=r,n=r+c;t<n;t+=a)l+=o[Math.min(s,t)];for(let t=r,h=s;t<=h;t+=a)l+=o[Math.min(s,t+c)],e[t]=(l+n*(o[Math.max(r,t-u)]+o[Math.min(s,t+u)]))/i,l-=o[Math.max(r,t-c)]}},function(e,t,n=t){if(!((t=+t)>=0))throw new RangeError("invalid rx");if(!((n=+n)>=0))throw new RangeError("invalid ry");let{data:i,width:o,height:r}=e;if(!((o=Math.floor(o))>=0))throw new RangeError("invalid width");if(!((r=Math.floor(void 0!==r?r:i.length/o))>=0))throw new RangeError("invalid height");if(!o||!r||!t&&!n)return e;const s=t&&pD(t),a=n&&pD(n),l=i.slice();return s&&a?(fD(s,l,i,o,r),fD(s,i,l,o,r),fD(s,l,i,o,r),mD(a,i,l,o,r),mD(a,l,i,o,r),mD(a,i,l,o,r)):s?(fD(s,i,l,o,r),fD(s,l,i,o,r),fD(s,i,l,o,r)):a&&(mD(a,i,l,o,r),mD(a,l,i,o,r),mD(a,i,l,o,r)),e});var pD;function fD(e,t,n,i,o){for(let r=0,s=i*o;r<s;)e(t,n,r,r+=i,1)}function mD(e,t,n,i,o){for(let r=0,s=i*o;r<i;++r)e(t,n,r,r+s,i)}function _D(e,t){let n,i;if(void 0===t)for(const o of e)null!=o&&(void 0===n?o>=o&&(n=i=o):(n>o&&(n=o),i<o&&(i=o)));else{let o=-1;for(let r of e)null!=(r=t(r,++o,e))&&(void 0===n?r>=r&&(n=i=r):(n>r&&(n=r),i<r&&(i=r)))}return[n,i]}class gD extends Map{constructor(e,t=bD){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),null!=e)for(const[n,i]of e)this.set(n,i)}get(e){return super.get(yD(this,e))}has(e){return super.has(yD(this,e))}set(e,t){return super.set(function({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):(e.set(i,n),n)}(this,e),t)}delete(e){return super.delete(function({_intern:e,_key:t},n){const i=t(n);return e.has(i)&&(n=e.get(i),e.delete(i)),n}(this,e))}}function yD({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):n}function bD(e){return null!==e&&"object"==typeof e?e.valueOf():e}function vD(e,t){return(null==e||!(e>=e))-(null==t||!(t>=t))||(e<t?-1:e>t?1:0)}const xD=Math.sqrt(50),wD=Math.sqrt(10),SD=Math.sqrt(2);function ED(e,t,n){const i=(t-e)/Math.max(0,n),o=Math.floor(Math.log10(i)),r=i/Math.pow(10,o),s=r>=xD?10:r>=wD?5:r>=SD?2:1;let a,l,c;return o<0?(c=Math.pow(10,-o)/s,a=Math.round(e*c),l=Math.round(t*c),a/c<e&&++a,l/c>t&&--l,c=-c):(c=Math.pow(10,o)*s,a=Math.round(e/c),l=Math.round(t/c),a*c<e&&++a,l*c>t&&--l),l<a&&.5<=n&&n<2?ED(e,t,2*n):[a,l,c]}function TD(e,t,n){if(!((n=+n)>0))return[];if((e=+e)===(t=+t))return[e];const i=t<e,[o,r,s]=i?ED(t,e,n):ED(e,t,n);if(!(r>=o))return[];const a=r-o+1,l=new Array(a);if(i)if(s<0)for(let c=0;c<a;++c)l[c]=(r-c)/-s;else for(let c=0;c<a;++c)l[c]=(r-c)*s;else if(s<0)for(let c=0;c<a;++c)l[c]=(o+c)/-s;else for(let c=0;c<a;++c)l[c]=(o+c)*s;return l}function CD(e,t,n){return ED(e=+e,t=+t,n=+n)[2]}function ID(e,t,n){n=+n;const i=(t=+t)<(e=+e),o=i?CD(t,e,n):CD(e,t,n);return(i?-1:1)*(o<0?1/-o:o)}function AD(e,t,n){let i;for(;;){const o=CD(e,t,n);if(o===i||0===o||!isFinite(o))return[e,t];o>0?(e=Math.floor(e/o)*o,t=Math.ceil(t/o)*o):o<0&&(e=Math.ceil(e*o)/o,t=Math.floor(t*o)/o),i=o}}function kD(e){return Math.max(1,Math.ceil(Math.log(function(e){let t=0;for(let n of e)null!=n&&(n=+n)>=n&&++t;return t}(e))/Math.LN2)+1)}function LD(e,t){let n;for(const i of e)null!=i&&(n<i||void 0===n&&i>=i)&&(n=i);return n}function RD(e,t){let n;for(const i of e)null!=i&&(n>i||void 0===n&&i>=i)&&(n=i);return n}function PD(e,t,n=0,i=1/0,o){if(t=Math.floor(t),n=Math.floor(Math.max(0,n)),i=Math.floor(Math.min(e.length-1,i)),!(n<=t&&t<=i))return e;for(o=void 0===o?vD:function(e=aD){if(e===aD)return vD;if("function"!=typeof e)throw new TypeError("compare is not a function");return(t,n)=>{const i=e(t,n);return i||0===i?i:(0===e(n,n))-(0===e(t,t))}}(o);i>n;){if(i-n>600){const r=i-n+1,s=t-n+1,a=Math.log(r),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(r-l)/r)*(s-r/2<0?-1:1);PD(e,t,Math.max(n,Math.floor(t-s*l/r+c)),Math.min(i,Math.floor(t+(r-s)*l/r+c)),o)}const r=e[t];let s=n,a=i;for(DD(e,n,t),o(e[i],r)>0&&DD(e,n,i);s<a;){for(DD(e,s,a),++s,--a;o(e[s],r)<0;)++s;for(;o(e[a],r)>0;)--a}0===o(e[n],r)?DD(e,n,a):(++a,DD(e,a,i)),a<=t&&(n=a+1),t<=a&&(i=a-1)}return e}function DD(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function MD(e,t,n){if((i=(e=Float64Array.from(function*(e){for(let t of e)null!=t&&(t=+t)>=t&&(yield t)}(e))).length)&&!isNaN(t=+t)){if(t<=0||i<2)return RD(e);if(t>=1)return LD(e);var i,o=(i-1)*t,r=Math.floor(o),s=LD(PD(e,r).subarray(0,r+1));return s+(RD(e.subarray(r+1))-s)*(o-r)}}function ND(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function OD(e,t){switch(arguments.length){case 0:break;case 1:"function"==typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"==typeof t?this.interpolator(t):this.range(t)}return this}const BD=Symbol("implicit");function FD(){var e=new gD,t=[],n=[],i=BD;function o(o){let r=e.get(o);if(void 0===r){if(i!==BD)return i;e.set(o,r=t.push(o)-1)}return n[r%n.length]}return o.domain=function(n){if(!arguments.length)return t.slice();t=[],e=new gD;for(const i of n)e.has(i)||e.set(i,t.push(i)-1);return o},o.range=function(e){return arguments.length?(n=Array.from(e),o):n.slice()},o.unknown=function(e){return arguments.length?(i=e,o):i},o.copy=function(){return FD(t,n).unknown(i)},ND.apply(o,arguments),o}function zD(e){return+e}var UD=[0,1];function $D(e){return e}function VD(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function HD(e,t,n){var i=e[0],o=e[1],r=t[0],s=t[1];return o<i?(i=VD(o,i),r=n(s,r)):(i=VD(i,o),r=n(r,s)),function(e){return r(i(e))}}function GD(e,t,n){var i=Math.min(e.length,t.length)-1,o=new Array(i),r=new Array(i),s=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<i;)o[s]=VD(e[s],e[s+1]),r[s]=n(t[s],t[s+1]);return function(t){var n=hD(e,t,1,i)-1;return r[n](o[n](t))}}function WD(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function jD(){var e,t,n,i,o,r,s=UD,a=UD,l=nR,c=$D;function u(){var e=Math.min(s.length,a.length);return c!==$D&&(c=function(e,t){var n;return e>t&&(n=e,e=t,t=n),function(n){return Math.max(e,Math.min(t,n))}}(s[0],s[e-1])),i=e>2?GD:HD,o=r=null,h}function h(t){return null==t||isNaN(t=+t)?n:(o||(o=i(s.map(e),a,l)))(e(c(t)))}return h.invert=function(n){return c(t((r||(r=i(a,s.map(e),ZL)))(n)))},h.domain=function(e){return arguments.length?(s=Array.from(e,zD),u()):s.slice()},h.range=function(e){return arguments.length?(a=Array.from(e),u()):a.slice()},h.rangeRound=function(e){return a=Array.from(e),l=iR,u()},h.clamp=function(e){return arguments.length?(c=!!e||$D,u()):c!==$D},h.interpolate=function(e){return arguments.length?(l=e,u()):l},h.unknown=function(e){return arguments.length?(n=e,h):n},function(n,i){return e=n,t=i,u()}}function YD(){return jD()($D,$D)}function qD(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function XD(e){return(e=qD(Math.abs(e)))?e[1]:NaN}var KD,ZD=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function QD(e){if(!(t=ZD.exec(e)))throw new Error("invalid format: "+e);var t;return new JD({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function JD(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function eM(e,t){var n=qD(e,t);if(!n)return e+"";var i=n[0],o=n[1];return o<0?"0."+new Array(-o).join("0")+i:i.length>o+1?i.slice(0,o+1)+"."+i.slice(o+1):i+new Array(o-i.length+2).join("0")}QD.prototype=JD.prototype,JD.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const tM={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>eM(100*e,t),r:eM,s:function(e,t){var n=qD(e,t);if(!n)return e+"";var i=n[0],o=n[1],r=o-(KD=3*Math.max(-8,Math.min(8,Math.floor(o/3))))+1,s=i.length;return r===s?i:r>s?i+new Array(r-s+1).join("0"):r>0?i.slice(0,r)+"."+i.slice(r):"0."+new Array(1-r).join("0")+qD(e,Math.max(0,t+r-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function nM(e){return e}var iM,oM,rM,sM=Array.prototype.map,aM=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function lM(e){var t=e.domain;return e.ticks=function(e){var n=t();return TD(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var i=t();return function(e,t,n,i){var o,r=ID(e,t,n);switch((i=QD(null==i?",f":i)).type){case"s":var s=Math.max(Math.abs(e),Math.abs(t));return null!=i.precision||isNaN(o=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(XD(t)/3)))-XD(Math.abs(e)))}(r,s))||(i.precision=o),rM(i,s);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(o=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,XD(t)-XD(e))+1}(r,Math.max(Math.abs(e),Math.abs(t))))||(i.precision=o-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(o=function(e){return Math.max(0,-XD(Math.abs(e)))}(r))||(i.precision=o-2*("%"===i.type))}return oM(i)}(i[0],i[i.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var i,o,r=t(),s=0,a=r.length-1,l=r[s],c=r[a],u=10;for(c<l&&(o=l,l=c,c=o,o=s,s=a,a=o);u-- >0;){if((o=CD(l,c,n))===i)return r[s]=l,r[a]=c,t(r);if(o>0)l=Math.floor(l/o)*o,c=Math.ceil(c/o)*o;else{if(!(o<0))break;l=Math.ceil(l*o)/o,c=Math.floor(c*o)/o}i=o}return e},e}function cM(){var e=YD();return e.copy=function(){return WD(e,cM())},ND.apply(e,arguments),lM(e)}function uM(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function hM(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function dM(){var e=function(e){var t=1,n=e(uM(t),hM(t));return n.constant=function(n){return arguments.length?e(uM(t=+n),hM(t)):t},lM(n)}(jD());return e.copy=function(){return WD(e,dM()).constant(e.constant())},ND.apply(e,arguments)}function pM(){var e,t=0,n=1,i=1,o=[.5],r=[0,1];function s(t){return null!=t&&t<=t?r[hD(o,t,0,i)]:e}function a(){var e=-1;for(o=new Array(i);++e<i;)o[e]=((e+1)*n-(e-i)*t)/(i+1);return s}return s.domain=function(e){return arguments.length?([t,n]=e,t=+t,n=+n,a()):[t,n]},s.range=function(e){return arguments.length?(i=(r=Array.from(e)).length-1,a()):r.slice()},s.invertExtent=function(e){var s=r.indexOf(e);return s<0?[NaN,NaN]:s<1?[t,o[0]]:s>=i?[o[i-1],n]:[o[s-1],o[s]]},s.unknown=function(t){return arguments.length?(e=t,s):s},s.thresholds=function(){return o.slice()},s.copy=function(){return pM().domain([t,n]).range(r).unknown(e)},ND.apply(lM(s),arguments)}iM=function(e){var t,n,i=void 0===e.grouping||void 0===e.thousands?nM:(t=sM.call(e.grouping,Number),n=e.thousands+"",function(e,i){for(var o=e.length,r=[],s=0,a=t[0],l=0;o>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),r.push(e.substring(o-=a,o+a)),!((l+=a+1)>i));)a=t[s=(s+1)%t.length];return r.reverse().join(n)}),o=void 0===e.currency?"":e.currency[0]+"",r=void 0===e.currency?"":e.currency[1]+"",s=void 0===e.decimal?".":e.decimal+"",a=void 0===e.numerals?nM:function(e){return function(t){return t.replace(/[0-9]/g,function(t){return e[+t]})}}(sM.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"−":e.minus+"",u=void 0===e.nan?"NaN":e.nan+"";function h(e){var t=(e=QD(e)).fill,n=e.align,h=e.sign,d=e.symbol,p=e.zero,f=e.width,m=e.comma,_=e.precision,g=e.trim,y=e.type;"n"===y?(m=!0,y="g"):tM[y]||(void 0===_&&(_=12),g=!0,y="g"),(p||"0"===t&&"="===n)&&(p=!0,t="0",n="=");var b="$"===d?o:"#"===d&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",v="$"===d?r:/[%p]/.test(y)?l:"",x=tM[y],w=/[defgprs%]/.test(y);function S(e){var o,r,l,d=b,S=v;if("c"===y)S=x(e)+S,e="";else{var E=(e=+e)<0||1/e<0;if(e=isNaN(e)?u:x(Math.abs(e),_),g&&(e=function(e){e:for(var t,n=e.length,i=1,o=-1;i<n;++i)switch(e[i]){case".":o=t=i;break;case"0":0===o&&(o=i),t=i;break;default:if(!+e[i])break e;o>0&&(o=0)}return o>0?e.slice(0,o)+e.slice(t+1):e}(e)),E&&0===+e&&"+"!==h&&(E=!1),d=(E?"("===h?h:c:"-"===h||"("===h?"":h)+d,S=("s"===y?aM[8+KD/3]:"")+S+(E&&"("===h?")":""),w)for(o=-1,r=e.length;++o<r;)if(48>(l=e.charCodeAt(o))||l>57){S=(46===l?s+e.slice(o+1):e.slice(o))+S,e=e.slice(0,o);break}}m&&!p&&(e=i(e,1/0));var T=d.length+e.length+S.length,C=T<f?new Array(f-T+1).join(t):"";switch(m&&p&&(e=i(C+e,C.length?f-S.length:1/0),C=""),n){case"<":e=d+e+S+C;break;case"=":e=d+C+e+S;break;case"^":e=C.slice(0,T=C.length>>1)+d+e+S+C.slice(T);break;default:e=C+d+e+S}return a(e)}return _=void 0===_?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,_)):Math.max(0,Math.min(20,_)),S.toString=function(){return e+""},S}return{format:h,formatPrefix:function(e,t){var n=h(((e=QD(e)).type="f",e)),i=3*Math.max(-8,Math.min(8,Math.floor(XD(t)/3))),o=Math.pow(10,-i),r=aM[8+i/3];return function(e){return n(o*e)+r}}}}({thousands:",",grouping:[3],currency:["$",""]}),oM=iM.format,rM=iM.formatPrefix;const fM=new Date,mM=new Date;function _M(e,t,n,i){function o(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return o.floor=t=>(e(t=new Date(+t)),t),o.ceil=n=>(e(n=new Date(n-1)),t(n,1),e(n),n),o.round=e=>{const t=o(e),n=o.ceil(e);return e-t<n-e?t:n},o.offset=(e,n)=>(t(e=new Date(+e),null==n?1:Math.floor(n)),e),o.range=(n,i,r)=>{const s=[];if(n=o.ceil(n),r=null==r?1:Math.floor(r),!(n<i&&r>0))return s;let a;do{s.push(a=new Date(+n)),t(n,r),e(n)}while(a<n&&n<i);return s},o.filter=n=>_M(t=>{if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)},(e,i)=>{if(e>=e)if(i<0)for(;++i<=0;)for(;t(e,-1),!n(e););else for(;--i>=0;)for(;t(e,1),!n(e););}),n&&(o.count=(t,i)=>(fM.setTime(+t),mM.setTime(+i),e(fM),e(mM),Math.floor(n(fM,mM))),o.every=e=>(e=Math.floor(e),isFinite(e)&&e>0?e>1?o.filter(i?t=>i(t)%e===0:t=>o.count(0,t)%e===0):o:null)),o}const gM=_M(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);gM.every=e=>(e=Math.floor(e),isFinite(e)&&e>0?e>1?_M(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):gM:null),gM.range;const yM=1e3,bM=6e4,vM=36e5,xM=864e5,wM=6048e5,SM=31536e6,EM=_M(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*yM)},(e,t)=>(t-e)/yM,e=>e.getUTCSeconds());EM.range;const TM=_M(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*yM)},(e,t)=>{e.setTime(+e+t*bM)},(e,t)=>(t-e)/bM,e=>e.getMinutes());TM.range,_M(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*bM)},(e,t)=>(t-e)/bM,e=>e.getUTCMinutes()).range;const CM=_M(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*yM-e.getMinutes()*bM)},(e,t)=>{e.setTime(+e+t*vM)},(e,t)=>(t-e)/vM,e=>e.getHours());CM.range,_M(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*vM)},(e,t)=>(t-e)/vM,e=>e.getUTCHours()).range;const IM=_M(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*bM)/xM,e=>e.getDate()-1);IM.range;const AM=_M(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/xM,e=>e.getUTCDate()-1);function kM(e){return _M(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(e,t)=>{e.setDate(e.getDate()+7*t)},(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*bM)/wM)}AM.range,_M(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/xM,e=>Math.floor(e/xM)).range;const LM=kM(0),RM=kM(1),PM=kM(2),DM=kM(3),MM=kM(4),NM=kM(5),OM=kM(6);function BM(e){return _M(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+7*t)},(e,t)=>(t-e)/wM)}LM.range,RM.range,PM.range,DM.range,MM.range,NM.range,OM.range;const FM=BM(0),zM=BM(1),UM=BM(2),$M=BM(3),VM=BM(4),HM=BM(5),GM=BM(6);FM.range,zM.range,UM.range,$M.range,VM.range,HM.range,GM.range;const WM=_M(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear()),e=>e.getMonth());WM.range,_M(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear()),e=>e.getUTCMonth()).range;const jM=_M(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());jM.every=e=>isFinite(e=Math.floor(e))&&e>0?_M(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)}):null,jM.range;const YM=_M(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());YM.every=e=>isFinite(e=Math.floor(e))&&e>0?_M(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)}):null,YM.range;const[qM,XM]=function(e){const t=[[EM,1,yM],[EM,5,5e3],[EM,15,15e3],[EM,30,3e4],[TM,1,bM],[TM,5,3e5],[TM,15,9e5],[TM,30,18e5],[CM,1,vM],[CM,3,108e5],[CM,6,216e5],[CM,12,432e5],[IM,1,xM],[IM,2,1728e5],[LM,1,wM],[WM,1,2592e6],[WM,3,7776e6],[e,1,SM]];function n(n,i,o){const r=Math.abs(i-n)/o,s=cD(([,,e])=>e).right(t,r);if(s===t.length)return e.every(ID(n/SM,i/SM,o));if(0===s)return gM.every(Math.max(ID(n,i,o),1));const[a,l]=t[r/t[s-1][2]<t[s][2]/r?s-1:s];return a.every(l)}return[function(e,t,i){const o=t<e;o&&([e,t]=[t,e]);const r=i&&"function"==typeof i.range?i:n(e,t,i),s=r?r.range(e,+t+1):[];return o?s.reverse():s},n]}(jM);function KM(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function ZM(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function QM(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}var JM,eN,tN={"-":"",_:" ",0:"0"},nN=/^\s*\d+/,iN=/^%/,oN=/[\\^$*+?|[\]().{}]/g;function rN(e,t,n){var i=e<0?"-":"",o=(i?-e:e)+"",r=o.length;return i+(r<n?new Array(n-r+1).join(t)+o:o)}function sN(e){return e.replace(oN,"\\$&")}function aN(e){return new RegExp("^(?:"+e.map(sN).join("|")+")","i")}function lN(e){return new Map(e.map((e,t)=>[e.toLowerCase(),t]))}function cN(e,t,n){var i=nN.exec(t.slice(n,n+1));return i?(e.w=+i[0],n+i[0].length):-1}function uN(e,t,n){var i=nN.exec(t.slice(n,n+1));return i?(e.u=+i[0],n+i[0].length):-1}function hN(e,t,n){var i=nN.exec(t.slice(n,n+2));return i?(e.U=+i[0],n+i[0].length):-1}function dN(e,t,n){var i=nN.exec(t.slice(n,n+2));return i?(e.V=+i[0],n+i[0].length):-1}function pN(e,t,n){var i=nN.exec(t.slice(n,n+2));return i?(e.W=+i[0],n+i[0].length):-1}function fN(e,t,n){var i=nN.exec(t.slice(n,n+4));return i?(e.y=+i[0],n+i[0].length):-1}function mN(e,t,n){var i=nN.exec(t.slice(n,n+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function _N(e,t,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function gN(e,t,n){var i=nN.exec(t.slice(n,n+1));return i?(e.q=3*i[0]-3,n+i[0].length):-1}function yN(e,t,n){var i=nN.exec(t.slice(n,n+2));return i?(e.m=i[0]-1,n+i[0].length):-1}function bN(e,t,n){var i=nN.exec(t.slice(n,n+2));return i?(e.d=+i[0],n+i[0].length):-1}function vN(e,t,n){var i=nN.exec(t.slice(n,n+3));return i?(e.m=0,e.d=+i[0],n+i[0].length):-1}function xN(e,t,n){var i=nN.exec(t.slice(n,n+2));return i?(e.H=+i[0],n+i[0].length):-1}function wN(e,t,n){var i=nN.exec(t.slice(n,n+2));return i?(e.M=+i[0],n+i[0].length):-1}function SN(e,t,n){var i=nN.exec(t.slice(n,n+2));return i?(e.S=+i[0],n+i[0].length):-1}function EN(e,t,n){var i=nN.exec(t.slice(n,n+3));return i?(e.L=+i[0],n+i[0].length):-1}function TN(e,t,n){var i=nN.exec(t.slice(n,n+6));return i?(e.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function CN(e,t,n){var i=iN.exec(t.slice(n,n+1));return i?n+i[0].length:-1}function IN(e,t,n){var i=nN.exec(t.slice(n));return i?(e.Q=+i[0],n+i[0].length):-1}function AN(e,t,n){var i=nN.exec(t.slice(n));return i?(e.s=+i[0],n+i[0].length):-1}function kN(e,t){return rN(e.getDate(),t,2)}function LN(e,t){return rN(e.getHours(),t,2)}function RN(e,t){return rN(e.getHours()%12||12,t,2)}function PN(e,t){return rN(1+IM.count(jM(e),e),t,3)}function DN(e,t){return rN(e.getMilliseconds(),t,3)}function MN(e,t){return DN(e,t)+"000"}function NN(e,t){return rN(e.getMonth()+1,t,2)}function ON(e,t){return rN(e.getMinutes(),t,2)}function BN(e,t){return rN(e.getSeconds(),t,2)}function FN(e){var t=e.getDay();return 0===t?7:t}function zN(e,t){return rN(LM.count(jM(e)-1,e),t,2)}function UN(e){var t=e.getDay();return t>=4||0===t?MM(e):MM.ceil(e)}function $N(e,t){return e=UN(e),rN(MM.count(jM(e),e)+(4===jM(e).getDay()),t,2)}function VN(e){return e.getDay()}function HN(e,t){return rN(RM.count(jM(e)-1,e),t,2)}function GN(e,t){return rN(e.getFullYear()%100,t,2)}function WN(e,t){return rN((e=UN(e)).getFullYear()%100,t,2)}function jN(e,t){return rN(e.getFullYear()%1e4,t,4)}function YN(e,t){var n=e.getDay();return rN((e=n>=4||0===n?MM(e):MM.ceil(e)).getFullYear()%1e4,t,4)}function qN(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+rN(t/60|0,"0",2)+rN(t%60,"0",2)}function XN(e,t){return rN(e.getUTCDate(),t,2)}function KN(e,t){return rN(e.getUTCHours(),t,2)}function ZN(e,t){return rN(e.getUTCHours()%12||12,t,2)}function QN(e,t){return rN(1+AM.count(YM(e),e),t,3)}function JN(e,t){return rN(e.getUTCMilliseconds(),t,3)}function eO(e,t){return JN(e,t)+"000"}function tO(e,t){return rN(e.getUTCMonth()+1,t,2)}function nO(e,t){return rN(e.getUTCMinutes(),t,2)}function iO(e,t){return rN(e.getUTCSeconds(),t,2)}function oO(e){var t=e.getUTCDay();return 0===t?7:t}function rO(e,t){return rN(FM.count(YM(e)-1,e),t,2)}function sO(e){var t=e.getUTCDay();return t>=4||0===t?VM(e):VM.ceil(e)}function aO(e,t){return e=sO(e),rN(VM.count(YM(e),e)+(4===YM(e).getUTCDay()),t,2)}function lO(e){return e.getUTCDay()}function cO(e,t){return rN(zM.count(YM(e)-1,e),t,2)}function uO(e,t){return rN(e.getUTCFullYear()%100,t,2)}function hO(e,t){return rN((e=sO(e)).getUTCFullYear()%100,t,2)}function dO(e,t){return rN(e.getUTCFullYear()%1e4,t,4)}function pO(e,t){var n=e.getUTCDay();return rN((e=n>=4||0===n?VM(e):VM.ceil(e)).getUTCFullYear()%1e4,t,4)}function fO(){return"+0000"}function mO(){return"%"}function _O(e){return+e}function gO(e){return Math.floor(+e/1e3)}function yO(e){return new Date(e)}function bO(e){return e instanceof Date?+e:+new Date(+e)}function vO(e,t,n,i,o,r,s,a,l,c){var u=YD(),h=u.invert,d=u.domain,p=c(".%L"),f=c(":%S"),m=c("%I:%M"),_=c("%I %p"),g=c("%a %d"),y=c("%b %d"),b=c("%B"),v=c("%Y");function x(e){return(l(e)<e?p:a(e)<e?f:s(e)<e?m:r(e)<e?_:i(e)<e?o(e)<e?g:y:n(e)<e?b:v)(e)}return u.invert=function(e){return new Date(h(e))},u.domain=function(e){return arguments.length?d(Array.from(e,bO)):d().map(yO)},u.ticks=function(t){var n=d();return e(n[0],n[n.length-1],null==t?10:t)},u.tickFormat=function(e,t){return null==t?x:c(t)},u.nice=function(e){var n=d();return e&&"function"==typeof e.range||(e=t(n[0],n[n.length-1],null==e?10:e)),e?d(function(e,t){var n,i=0,o=(e=e.slice()).length-1,r=e[i],s=e[o];return s<r&&(n=i,i=o,o=n,n=r,r=s,s=n),e[i]=t.floor(r),e[o]=t.ceil(s),e}(n,e)):u},u.copy=function(){return WD(u,vO(e,t,n,i,o,r,s,a,l,c))},u}function xO(){return ND.apply(vO(qM,XM,jM,WM,LM,IM,CM,TM,EM,eN).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function wO(){var e=lM(function(){var e,t,n,i,o,r=0,s=1,a=$D,l=!1;function c(t){return null==t||isNaN(t=+t)?o:a(0===n?.5:(t=(i(t)-e)*n,l?Math.max(0,Math.min(1,t)):t))}function u(e){return function(t){var n,i;return arguments.length?([n,i]=t,a=e(n,i),c):[a(0),a(1)]}}return c.domain=function(o){return arguments.length?([r,s]=o,e=i(r=+r),t=i(s=+s),n=e===t?0:1/(t-e),c):[r,s]},c.clamp=function(e){return arguments.length?(l=!!e,c):l},c.interpolator=function(e){return arguments.length?(a=e,c):a},c.range=u(nR),c.rangeRound=u(iR),c.unknown=function(e){return arguments.length?(o=e,c):o},function(o){return i=o,e=o(r),t=o(s),n=e===t?0:1/(t-e),c}}()($D));return e.copy=function(){return t=e,wO().domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown());var t},OD.apply(e,arguments)}JM=function(e){var t=e.dateTime,n=e.date,i=e.time,o=e.periods,r=e.days,s=e.shortDays,a=e.months,l=e.shortMonths,c=aN(o),u=lN(o),h=aN(r),d=lN(r),p=aN(s),f=lN(s),m=aN(a),_=lN(a),g=aN(l),y=lN(l),b={a:function(e){return s[e.getDay()]},A:function(e){return r[e.getDay()]},b:function(e){return l[e.getMonth()]},B:function(e){return a[e.getMonth()]},c:null,d:kN,e:kN,f:MN,g:WN,G:YN,H:LN,I:RN,j:PN,L:DN,m:NN,M:ON,p:function(e){return o[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:_O,s:gO,S:BN,u:FN,U:zN,V:$N,w:VN,W:HN,x:null,X:null,y:GN,Y:jN,Z:qN,"%":mO},v={a:function(e){return s[e.getUTCDay()]},A:function(e){return r[e.getUTCDay()]},b:function(e){return l[e.getUTCMonth()]},B:function(e){return a[e.getUTCMonth()]},c:null,d:XN,e:XN,f:eO,g:hO,G:pO,H:KN,I:ZN,j:QN,L:JN,m:tO,M:nO,p:function(e){return o[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:_O,s:gO,S:iO,u:oO,U:rO,V:aO,w:lO,W:cO,x:null,X:null,y:uO,Y:dO,Z:fO,"%":mO},x={a:function(e,t,n){var i=p.exec(t.slice(n));return i?(e.w=f.get(i[0].toLowerCase()),n+i[0].length):-1},A:function(e,t,n){var i=h.exec(t.slice(n));return i?(e.w=d.get(i[0].toLowerCase()),n+i[0].length):-1},b:function(e,t,n){var i=g.exec(t.slice(n));return i?(e.m=y.get(i[0].toLowerCase()),n+i[0].length):-1},B:function(e,t,n){var i=m.exec(t.slice(n));return i?(e.m=_.get(i[0].toLowerCase()),n+i[0].length):-1},c:function(e,n,i){return E(e,t,n,i)},d:bN,e:bN,f:TN,g:mN,G:fN,H:xN,I:xN,j:vN,L:EN,m:yN,M:wN,p:function(e,t,n){var i=c.exec(t.slice(n));return i?(e.p=u.get(i[0].toLowerCase()),n+i[0].length):-1},q:gN,Q:IN,s:AN,S:SN,u:uN,U:hN,V:dN,w:cN,W:pN,x:function(e,t,i){return E(e,n,t,i)},X:function(e,t,n){return E(e,i,t,n)},y:mN,Y:fN,Z:_N,"%":CN};function w(e,t){return function(n){var i,o,r,s=[],a=-1,l=0,c=e.length;for(n instanceof Date||(n=new Date(+n));++a<c;)37===e.charCodeAt(a)&&(s.push(e.slice(l,a)),null!=(o=tN[i=e.charAt(++a)])?i=e.charAt(++a):o="e"===i?" ":"0",(r=t[i])&&(i=r(n,o)),s.push(i),l=a+1);return s.push(e.slice(l,a)),s.join("")}}function S(e,t){return function(n){var i,o,r=QM(1900,void 0,1);if(E(r,e,n+="",0)!=n.length)return null;if("Q"in r)return new Date(r.Q);if("s"in r)return new Date(1e3*r.s+("L"in r?r.L:0));if(t&&!("Z"in r)&&(r.Z=0),"p"in r&&(r.H=r.H%12+12*r.p),void 0===r.m&&(r.m="q"in r?r.q:0),"V"in r){if(r.V<1||r.V>53)return null;"w"in r||(r.w=1),"Z"in r?(o=(i=ZM(QM(r.y,0,1))).getUTCDay(),i=o>4||0===o?zM.ceil(i):zM(i),i=AM.offset(i,7*(r.V-1)),r.y=i.getUTCFullYear(),r.m=i.getUTCMonth(),r.d=i.getUTCDate()+(r.w+6)%7):(o=(i=KM(QM(r.y,0,1))).getDay(),i=o>4||0===o?RM.ceil(i):RM(i),i=IM.offset(i,7*(r.V-1)),r.y=i.getFullYear(),r.m=i.getMonth(),r.d=i.getDate()+(r.w+6)%7)}else("W"in r||"U"in r)&&("w"in r||(r.w="u"in r?r.u%7:"W"in r?1:0),o="Z"in r?ZM(QM(r.y,0,1)).getUTCDay():KM(QM(r.y,0,1)).getDay(),r.m=0,r.d="W"in r?(r.w+6)%7+7*r.W-(o+5)%7:r.w+7*r.U-(o+6)%7);return"Z"in r?(r.H+=r.Z/100|0,r.M+=r.Z%100,ZM(r)):KM(r)}}function E(e,t,n,i){for(var o,r,s=0,a=t.length,l=n.length;s<a;){if(i>=l)return-1;if(37===(o=t.charCodeAt(s++))){if(o=t.charAt(s++),!(r=x[o in tN?t.charAt(s++):o])||(i=r(e,n,i))<0)return-1}else if(o!=n.charCodeAt(i++))return-1}return i}return b.x=w(n,b),b.X=w(i,b),b.c=w(t,b),v.x=w(n,v),v.X=w(i,v),v.c=w(t,v),{format:function(e){var t=w(e+="",b);return t.toString=function(){return e},t},parse:function(e){var t=S(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=w(e+="",v);return t.toString=function(){return e},t},utcParse:function(e){var t=S(e+="",!0);return t.toString=function(){return e},t}}}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),eN=JM.format,JM.parse,JM.utcFormat,JM.utcParse;const SO={allowSelection:!0,showAnimationControls:!1,animationSpeed:50,padding:{top:1,left:5,bottom:1,right:5},axisTickHeight:16,selectionRadius:3,selectionPadding:8,barCount:250,barRadius:1,barPadding:.1,barTopMargin:20,minBarHeight:1,dataStep:void 0,tickStep:void 0,stickySelection:!0,formatter:void 0,onBrush:void 0,onBarHover:void 0,onAnimationPlay:void 0,onAnimationPause:void 0,onAnimationTick:void 0,noDataMessage:"No timeline data",loadingMessage:"Data loading..."},EO=e=>"Function"!==e.constructor.name&&"Object"!==e.constructor.name,TO=e=>(e=>e instanceof Object)(e)&&!(e=>Array.isArray(e))(e)&&!(e=>"function"==typeof e)(e)&&!EO(e),CO=(e,t=new Map)=>{if("object"!=typeof e||null===e)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof Array){const n=[];t.set(e,n);for(const i of e)n.push(t.has(i)?t.get(i):CO(i,t));return e}if(EO(e))return e;if(e instanceof Object){const n={};t.set(e,n);const i=e;return Object.keys(e).reduce((e,n)=>(e[n]=t.has(i[n])?t.get(i[n]):CO(i[n],t),e),n),n}return e},IO=(e,t,n=new Map)=>{const i=EO(e)?e:CO(e);return e===t?e:n.has(t)?n.get(t):(n.set(t,i),Object.keys(t).forEach(o=>{TO(e[o])&&TO(t[o])?i[o]=IO(e[o],t[o],n):EO(t)?i[o]=t:i[o]=CO(t[o])}),i)},AO=(e,t="",n,i)=>{if(!e)return"0";let o,r;n?(o=e,r=n):Math.abs(e)>=7e11?(o=e/1e12,r="T"):Math.abs(e)>=2e8?(o=e/1e9,r="B"):Math.abs(e)>=1e6?(o=e/1e6,r="M"):Math.abs(e)>=1e3?(o=e/1e3,r="K"):(o=e,r="");const s=Math.abs(o);void 0===i&&(i=Number.isInteger(s)?0:s<.1?3:s<1?2:s<10?1:0);let a=s>0&&s<.5/Math.pow(10,i);if(a){let e=i;for(;a&&e<8;)e++,a=s<.5/Math.pow(10,e);if(a)return`~${t??""}0`;i=e}let l=e<0?"-":"";return t&&(l+=t),`${l}${oM(`.${i}~f`)(s)}${r}`};function kO(e,t,n){if(!e)return[];const[i,o]=e,r=Math.abs(+o-+i),s=Number.isFinite(r)&&t>1?r/(t-1):1,a=n??s;if(0===a)return[];const l=Array.from({length:t},(e,t)=>+i+t*a);return l[t-1]=+o,l}function LO(e,t,n,i=!1,o=!0){const r=Array.from({length:t.length-1},(e,n)=>[t[n],t[n+1]]),s=n&&i?r.filter(([e,t])=>{const[i,o]=n;return!(e<+i||t>=+o&&!(t>+i&&e<+o))}):r,a=function(e,t,n=t,i=[]){if(!e.length||!t.length||!n.length)return new Array(t.length).fill(0);const o=new Array(t.length).fill(0),r=new Map;for(const[l,c]of n){r.has(l)||r.set(l,new Map);for(let e=0;e<t.length;e++){const[n,i]=t[e];if(l===n&&c===i){r.get(l).set(c,e);break}}}const s=i.length>0?i[i.length-1]:t[t.length-1][1],a=[...n].sort((e,t)=>e[0]-t[0]);for(const l of e){let e=0,t=a.length-1;for(;e<=t;){const n=Math.floor((e+t)/2),[i,c]=a[n];if(l>=i&&(c===s?l<=c:l<c)){const e=r.get(i);if(e){const t=e.get(c);void 0!==t&&o[t]++}break}l<i?t=n-1:e=n+1}}return o}(e,r,s,t);return r.map(([e,t],n)=>({rangeStart:o?e:new Date(e),rangeEnd:o?t:new Date(t),count:a[n]??0}))}const RO=eN(".%L"),PO=eN(":%S"),DO=eN("%I:%M"),MO=eN("%I %p"),NO=eN("%a %d"),OO=eN("%d %b"),BO=eN("%b %Y"),FO=eN("%Y"),zO=36e5,UO=24*zO,$O=7*UO,VO=30*UO,HO=365*UO,GO=(e,t=null,n=!1)=>{if(n)return AO(e);const i=new Date(e),o=null!==t?t:Date.now()-i.getTime();return(o<1e3?RO:o<6e4?PO:o<zO?DO:o<UO?MO:o<VO?o<$O?NO:OO:o>20*HO?FO:BO)(i)};!function(){try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode('@keyframes style_module_fadeIn__ffac87fd{0%{opacity:0}to{opacity:.2}}.style_module_displayState__6ae19b84{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--cosmograph-ui-text);display:flex;justify-content:center;align-items:center;min-width:100px;opacity:.2;font-size:calc(var(--cosmograph-ui-font-size) + 1px);letter-spacing:-.02em;font-weight:200;user-select:none;-webkit-user-select:none;animation:style_module_fadeIn__ffac87fd .3s ease-in-out}:root{--cosmograph-timeline-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-timeline-selection-opacity: .5;--cosmograph-timeline-bar-color: var(--cosmograph-ui-element-color);--cosmograph-timeline-highlighted-bar-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-timeline-font-family: var(--cosmograph-ui-font-family);--cosmograph-timeline-font-size: var(--cosmograph-ui-tick-font-size);--cosmograph-timeline-background: var(--cosmograph-ui-background);--cosmograph-timeline-text-color: var(--cosmograph-ui-text);--cosmograph-timeline-axis-color: var(--cosmograph-ui-text)}.style_module_timeline__736434f7{position:relative;display:flex;background:var(--cosmograph-timeline-background);width:100%;min-height:25px;overflow:hidden}.style_module_timelineSvg__b916ad04{position:relative;width:100%;height:100%}.style_module_selection__ebee57f8{fill:var(--cosmograph-timeline-selection-color);fill-opacity:var(--cosmograph-timeline-selection-opacity);stroke:none}.style_module_axisTick__5865631d{color:var(--cosmograph-timeline-axis-color);font:var(--cosmograph-timeline-font-family);font-size:var(--cosmograph-timeline-font-size);user-select:none;-webkit-user-select:none;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum";alignment-baseline:text-before-edge}.style_module_axisLine__992b502d{opacity:.2;color:var(--cosmograph-timeline-axis-color)}.style_module_bar__114fa79f{fill:var(--cosmograph-timeline-bar-color);transform:scaleY(-1);opacity:0}.style_module_animationControl__ee52cd66{color:var(--cosmograph-timeline-axis-color);width:6%;max-width:30px;min-width:20px;cursor:pointer;display:none;align-items:center;user-select:none;-webkit-user-select:none;opacity:.5;position:relative;justify-content:center}.style_module_animationControl__ee52cd66>svg{width:50%;max-height:20px;padding-right:2px}.style_module_hidden__a73fe81a{display:none}.style_module_disabled__eb988570{opacity:.2;pointer-events:none}.style_module_highlightedBar__c2fc9bdc{fill:var(--cosmograph-timeline-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-search-font-family: var(--cosmograph-ui-font-family);--cosmograph-search-font-size: 14px;--cosmograph-search-list-font-size: 13.5px;--cosmograph-search-text-color: var(--cosmograph-ui-text);--cosmograph-search-background: transparent;--cosmograph-search-list-background: rgba(0, 0, 0, .2);--cosmograph-search-list-match-background: rgba(255, 255, 255, .2);--cosmograph-search-list-match-color: var(--cosmograph-ui-text)}.style_module_searchInput__d7830601:hover{filter:brightness(1.2) contrast(1)}.style_module_searchInput__d7830601{width:100%;background:transparent;color:var(--cosmograph-search-text-color);border:none;border-bottom:.5px solid var(--cosmograph-search-text-color);padding:4px 20px 5px 2px;font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:opacity .2s ease-out}.style_module_searchInput__d7830601::selection{background:var(--cosmograph-search-list-match-background)}.style_module_searchInput__d7830601:focus{outline:none}.style_module_searchSuggestions__b0d3f71e{color:#fff;width:100%;padding:0;margin:0;background:transparent;overflow-y:auto;flex:1;min-height:0}.style_module_searchSuggestions__b0d3f71e li{padding:5px 10px;cursor:pointer;-webkit-user-select:none;user-select:none;display:block;font-weight:500;font-size:var(--cosmograph-search-list-font-size);max-width:100%;overflow:hidden}.style_module_searchSuggestions__b0d3f71e li>div{white-space:nowrap;font-weight:200;overflow:hidden;text-overflow:ellipsis;width:100%}.style_module_searchSuggestions__b0d3f71e li:hover{background:#ffffff1a}.style_module_searchSuggestions__b0d3f71e mark{background:var(--cosmograph-search-list-match-background);color:var(--cosmograph-search-list-match-color);border-radius:2px}.style_module_clearButton__5ebb41de{position:absolute;right:0;top:0;height:100%;background:none;border:none;color:var(--cosmograph-search-text-color);font-weight:300;cursor:pointer;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d{opacity:.7}.style_module_placeholderWrapper__72d5eb0e{z-index:1;color:var(--cosmograph-search-text-color);font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);position:absolute;top:0;left:0;width:100%;bottom:0;display:flex;line-height:1.25;align-items:center;transition:transform .3s ease-out,opacity .3s ease-out}.style_module_placeholderWrapper__72d5eb0e.style_module_hidden__acfb8431{transform:translate(-30px);pointer-events:none;opacity:0}.style_module_searchInput__d7830601:disabled,.style_module_searchInput__d7830601.style_module_disabled__62c35dc5{opacity:.2;cursor:not-allowed;pointer-events:none}.style_module_disabled__62c35dc5 .style_module_clearButton__5ebb41de{display:none}.style_module_disabled__62c35dc5 .style_module_placeholderWrapper__72d5eb0e{opacity:.3;cursor:not-allowed}.style_module_searchInputWrapper__1edbcb22{position:relative;display:flex;width:100%}.style_module_noResults__363397c3{opacity:.3!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none}.style_module_noResults__363397c3:hover{background:none}.style_module_loading__296e0212{opacity:.7!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none;-webkit-user-select:none;user-select:none}.style_module_dropdownContainer__d98287da{position:absolute;top:100%;left:0;width:100%;background:var(--cosmograph-search-list-background);border-radius:4px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);opacity:0;transform:translateY(-10px);transition:opacity .2s ease-out,transform .2s ease-out;pointer-events:none;overflow:hidden;z-index:10;display:flex;flex-direction:column;padding-bottom:2px}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b{top:auto;bottom:100%;transform:translateY(10px)}.style_module_dropdownContainer__d98287da.style_module_visible__5be7493d{opacity:1;transform:translateY(0);pointer-events:auto}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b.style_module_visible__5be7493d{opacity:1;transform:translateY(-2px);pointer-events:auto}.style_module_footerContainer__73e7a066{flex-shrink:0}:root{--cosmograph-scrollbar-background: rgba(255, 255, 255, .1);--cosmograph-ui-background: rgb(45, 49, 58);--cosmograph-ui-text: #ffffffc7;--cosmograph-ui-tick-font-size: 11px;--cosmograph-ui-font-size: 12px;--cosmograph-ui-font-family: inherit;--cosmograph-ui-element-color: #5C616A;--cosmograph-ui-highlighted-element-color: white;--cosmograph-ui-selection-control-color: #8d949ea8;-webkit-font-smoothing:antialiased!important;text-rendering:optimizeLegibility!important}.style_module_cosmograph-ui__5acb97f1{background:var(--cosmograph-ui-background);color:var(--cosmograph-ui-text)}.style_module_scrollbar__f1516254 *::-webkit-scrollbar{width:5px;height:5px;border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-track{border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-corner{background:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-button{display:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-thumb{background-color:var(--cosmograph-scrollbar-background);transition:background-color .5s;border-radius:20px;border:3px solid var(--cosmograph-scrollbar-background)}@-moz-document url-prefix(){.style_module_scrollbar__f1516254 *{scrollbar-width:thin;scrollbar-color:var(--cosmograph-scrollbar-background) transparent;scrollbar-track-color:transparent;scrollbar-face-color:var(--cosmograph-scrollbar-background)}}:root{--cosmograph-histogram-background: var(--cosmograph-ui-background);--cosmograph-histogram-text-color: var(--cosmograph-ui-text);--cosmograph-histogram-axis-color: var(--cosmograph-ui-text);--cosmograph-histogram-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-histogram-selection-opacity: .5;--cosmograph-histogram-bar-color: var(--cosmograph-ui-element-color);--cosmograph-histogram-highlighted-bar-color: var( --cosmograph-ui-highlighted-element-color);--cosmograph-histogram-font-family: var(--cosmograph-ui-font-family);--cosmograph-histogram-font-size: var(--cosmograph-ui-tick-font-size)}.style_module_histogram__9d8a77ea{position:relative;display:flex;min-height:25px;background:var(--cosmograph-histogram-background);width:100%}.style_module_histogramSvg__ccccb628{position:relative;width:100%;height:100%}.style_module_selection__7db96137{fill:var(--cosmograph-histogram-selection-color);fill-opacity:var(--cosmograph-histogram-selection-opacity);stroke:none}.style_module_axisTick__898e1f39{color:var(--cosmograph-histogram-axis-color);font-family:var(--cosmograph-histogram-font-family);font-size:var(--cosmograph-histogram-font-size);user-select:none;-webkit-user-select:none;alignment-baseline:text-before-edge;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum"}.style_module_bar__3c9ab488{fill:var(--cosmograph-histogram-bar-color);transform:scaleY(-1)}.style_module_highlightedBar__b193a8de{fill:var(--cosmograph-histogram-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-bars-font-color: var(--cosmograph-ui-text);--cosmograph-bars-font-family: var(--cosmograph-ui-font-family);--cosmograph-bars-font-size: var(--cosmograph-ui-font-size);--cosmograph-bars-ui-font-size: 11.5px;--cosmograph-bars-background: var(--cosmograph-ui-element-color);--cosmograph-bars-bar-height: 20px;--cosmograph-bars-bar-bottom-margin: 2px;--cosmograph-bars-highlighted-color: var( --cosmograph-ui-highlighted-element-color)}.style_module_bars__25497ded{position:relative;width:100%;min-height:100px;user-select:none;flex-direction:column;-webkit-user-select:none}.style_module_bars__25497ded .scroll-container{position:relative;width:100%;overflow-y:hidden;overflow-x:hidden}.style_module_bars__25497ded .bars-container{position:relative;width:calc(100% - 1px);font-family:var(--cosmograph-bars-font-family)}.style_module_bars__25497ded .highlighted-bars-container{position:absolute;top:0;left:0;pointer-events:none}.style_module_bars__25497ded .row{height:var(--cosmograph-bars-bar-height);display:flex;align-items:center;margin-bottom:var(--cosmograph-bars-bar-bottom-margin);width:100%;transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row:hover{filter:brightness(1.15) contrast(1.05);transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row.unselected:hover{filter:brightness(.95) contrast(1.15);transition:filter .05s linear}.style_module_bars__25497ded .unselected{opacity:.85;filter:brightness(.8) contrast(1.1)}.style_module_bars__25497ded .selected{filter:brightness(1.05) contrast(1.05)}.style_module_bars__25497ded .selected>.info>.label{font-weight:600;filter:brightness(1.1) contrast(1.05)}.style_module_bars__25497ded .unselected>.info>.label{font-weight:300}.style_module_bars__25497ded .bar{height:100%;background-color:var(--cosmograph-bars-background);opacity:.8;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .bar-highlighted{height:100%;background-color:var(--cosmograph-bars-highlighted-color);opacity:.2;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .info{display:flex;justify-content:space-between;width:100%;padding:0 4px;position:absolute;font-size:var(--cosmograph-bars-font-size);font-feature-settings:"tnum";color:var(--cosmograph-bars-font-color);gap:2px}.style_module_bars__25497ded .label{min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:opacity .05s linear}.style_module_bars__25497ded .count{flex-shrink:0;font-weight:300;opacity:.8;transition:opacity .05s linear}.style_module_bars__25497ded .show-more{cursor:pointer;padding-top:2px;display:flex;font-weight:300;color:var(--cosmograph-bars-font-color);font-size:11px;justify-content:space-between;opacity:.6;font-size:var(--cosmograph-bars-ui-font-size);pointer-events:none;transition:opacity .1s linear}.style_module_bars__25497ded .show-more:hover{opacity:1;text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .show-more>span{pointer-events:all}.style_module_bars__25497ded .show-more-count{padding-right:5px;pointer-events:all;font-feature-settings:"tnum"}.style_module_bars__25497ded .unselected>.info>.label,.style_module_bars__25497ded .unselected>.info>.count{opacity:.5}.style_module_bars__25497ded .unselected:hover>.info>.label,.style_module_bars__25497ded .unselected:hover>.info>.count{opacity:1}.style_module_bars__25497ded .search-input{background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,.3);font-size:13px!important;color:var(--cosmograph-bars-font-color);line-height:1.5;padding:2px;width:100%;position:relative;transition:border-bottom-color .2s}.style_module_bars__25497ded .search-input::placeholder{color:var(--cosmograph-bars-font-color)!important;opacity:.4;font-weight:300;font-family:inherit}.style_module_bars__25497ded .search-container{position:relative;width:100%;margin-bottom:4px;display:none;z-index:1}.style_module_bars__25497ded .clear-button{position:absolute;right:0;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--cosmograph-bars-font-color);font-weight:300;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_bars__25497ded .clear-button.visible:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_bars__25497ded .clear-button.visible{opacity:.7}.style_module_bars__25497ded .clear-button svg{width:10px;height:10px;fill:currentColor}.style_module_bars__25497ded .sorting-block{visibility:hidden;margin-top:1px;display:flex;justify-content:space-between}.style_module_bars__25497ded .buttons-container{margin-top:4px;font-size:var(--cosmograph-bars-ui-font-size);display:flex;gap:4px;line-height:1.25}.style_module_bars__25497ded .buttons-container>div{transition:opacity .05s linear,filter .05s linear;padding:1px 5px;background:var(--cosmograph-bars-background);border-radius:4px;opacity:.9;display:flex;cursor:pointer;align-items:center}.style_module_bars__25497ded .buttons-container>div:hover{filter:brightness(1.2)}.style_module_bars__25497ded .reset-text{transition:opacity .05s linear,filter .05s linear;display:flex;font-size:var(--cosmograph-bars-ui-font-size);align-items:end;padding-right:4px;cursor:pointer;font-weight:300}.style_module_bars__25497ded .reset-text:hover{text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .reset-text.unselected{pointer-events:none;cursor:default;opacity:.7}.style_module_bars__25497ded :scope.reset-text:hover:not(.unselected){filter:brightness(1.5);opacity:1}:root{--cosmograph-size-legend-form-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-family: inherit;--cosmograph-size-legend-font-size: var(--cosmograph-ui-font-size);--cosmograph-size-legend-sublabel-font-size: 10px;--cosmograph-size-legend-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-size-legend-line-radius: 2px;--cosmograph-size-legend-line-width: 30px;--cosmograph-size-legend-hide-transform: translateY(100%);--cosmograph-size-legend-show-transform: translateX(0)}.style_module_container__d2889234{display:flex;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;overflow:hidden;min-height:25px}.style_module_legend__75c167f2{width:auto;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-size-legend-font-size);font-family:var(--cosmograph-size-legend-font-family);user-select:none;-webkit-user-select:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.04em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__91eae57a{opacity:1;transform:var(--cosmograph-size-legend-show-transform)}.style_module_disabled__d51f7a10{opacity:0;transform:var(--cosmograph-size-legend-hide-transform);pointer-events:none;display:none!important;min-height:0}@starting-style{.style_module_container__d2889234.style_module_enabled__91eae57a,.style_module_legend__75c167f2.style_module_enabled__91eae57a{opacity:0;transform:var(--cosmograph-size-legend-hide-transform)}}.style_module_legend__75c167f2 .circle{background-color:var(--cosmograph-size-legend-form-color);border-radius:50%;transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2 .line{background-color:var(--cosmograph-size-legend-form-color);border-radius:var(--cosmograph-size-legend-line-radius);width:var(--cosmograph-size-legend-line-width);transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2.style_module_events__894316a8{pointer-events:auto;cursor:pointer}.style_module_legend__75c167f2 .legend-content{display:flex;align-items:end;justify-content:center;gap:.75rem}.style_module_legend__75c167f2 .legend-content>div{transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__75c167f2 .labels-wrapper{white-space:nowrap}.style_module_legend__75c167f2 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-size-legend-items-margin)}.style_module_legend__75c167f2 .name{align-items:center;text-align:center;justify-content:center;display:flex;color:var(--cosmograph-size-legend-font-color);overflow:hidden;width:100%;margin-top:3px;word-break:break-all;white-space:pre-line;transition:color .15s ease-in-out;letter-spacing:-.02em}.style_module_legend__75c167f2 .label{color:var(--cosmograph-size-legend-font-color);overflow:hidden;transition:color .15s ease-in-out;text-overflow:ellipsis;font-feature-settings:"tnum"}.style_module_legend__75c167f2 .sublabel{padding-top:1px;font-size:var(--cosmograph-size-legend-sublabel-font-size);opacity:.5;line-height:1;min-width:10px;transition:color .15s ease-in-out}.style_module_hovered__1206707f .label,.style_module_hovered__1206707f .sublabel{color:var(--cosmograph-size-legend-hover-color);cursor:pointer}.style_module_hovered__1206707f .circle,.style_module_hovered__1206707f .line{background-color:var(--cosmograph-size-legend-hover-color);cursor:pointer}:root{--cosmograph-color-legend-range-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-range-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-range-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-label-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-sublabel-font-size: 10px;--cosmograph-color-legend-range-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-range-gradient-height: 6px;--cosmograph-color-legend-range-gradient-radius: 8px;--cosmograph-color-legend-range-gradient-top-margin: 6px;--cosmograph-color-legend-hide-transform: translateY(100%);--cosmograph-color-legend-show-transform: translateX(0)}.style_module_container__05cc807d{display:flex;min-width:150px;min-height:25px;width:100%;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_legend__a3e235e4{width:100%;font-weight:300;letter-spacing:-.04em;display:flex;flex-direction:column;font-size:var(--cosmograph-color-legend-range-font-size);font-family:var(--cosmograph-color-legend-range-font-family);user-select:none;-webkit-user-select:none;pointer-events:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__b3120e27{opacity:1;transform:var(--cosmograph-color-legend-show-transform);pointer-events:auto}.style_module_disabled__c2dc158c{opacity:0;transform:var(--cosmograph-color-legend-hide-transform);pointer-events:none;display:none;min-height:0}@starting-style{.style_module_container__05cc807d.style_module_enabled__b3120e27,.style_module_legend__a3e235e4.style_module_enabled__b3120e27{opacity:0;transform:var(--cosmograph-color-legend-hide-transform)}}.style_module_legend__a3e235e4 .legend-content{display:flex;align-items:end;justify-content:space-between}.style_module_hovered__dfd7bb2c .label,.style_module_hovered__dfd7bb2c .sublabel{color:var(--cosmograph-size-legend-hover-color)!important;cursor:pointer}.style_module_legend__a3e235e4 .extent{white-space:nowrap;transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__a3e235e4 .gradient{width:100%;margin-top:var(--cosmograph-color-legend-range-gradient-top-margin);height:var(--cosmograph-color-legend-range-gradient-height);border-radius:var(--cosmograph-color-legend-range-gradient-radius)}.style_module_legend__a3e235e4 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-color-legend-range-items-margin)}.style_module_legend__a3e235e4 .name{align-items:center;text-align:center;justify-content:space-around;display:flex;color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;width:100%;word-break:break-word;text-wrap:balance;white-space:pre-line;transition:color .15s ease-in-out;margin:0 4px;letter-spacing:-.02em;line-height:1.25}.style_module_legend__a3e235e4 .label{color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;max-width:150px;text-overflow:ellipsis;font-size:var(--cosmograph-color-legend-range-label-font-size);transition:color .15s ease-in-out;line-height:1;font-feature-settings:"tnum"}.style_module_legend__a3e235e4 .sublabel{padding-top:1px;color:var(--cosmograph-color-legend-range-font-color);opacity:.55;font-size:var(--cosmograph-color-legend-range-sublabel-font-size);line-height:1;transition:color .15s ease-in-out}:root{--cosmograph-color-legend-type-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-type-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-type-font-size: 11px;--cosmograph-color-legend-type-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-type-others-color: #bab0ab;--cosmograph-color-legend-type-bullet-size: 8px;--cosmograph-color-legend-type-bullet-radius: 1rem;--cosmograph-color-legend-type-items-margin: 4px;--cosmograph-color-legend-type-hide-transform: translateY(125%);--cosmograph-color-legend-type-show-transform: translateX(0)}.style_module_enabled__277b2403{opacity:1;transform:var(--cosmograph-color-legend-type-show-transform)}.style_module_disabled__7a587f96{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform);display:none!important;min-height:0}.style_module_wrapper__ea8ca7f4{position:relative;max-width:100%;width:fit-content;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_typeLegend__15bf4b2f{position:relative;width:fit-content;max-width:100%;min-height:25px;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.015em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_typeLegend__15bf4b2f .reverted{flex-direction:row-reverse}.style_module_typeLegend__15bf4b2f .scroll-container{width:100%;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-color-legend-type-font-size);font-family:var(--cosmograph-color-legend-type-font-family);user-select:none;-webkit-user-select:none;line-height:normal;overflow-x:hidden;overflow-y:auto;will-change:transform}@starting-style{.style_module_typeLegend__15bf4b2f.style_module_enabled__277b2403,.style_module_wrapper__ea8ca7f4.style_module_enabled__277b2403{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform)}}.style_module_typeLegend__15bf4b2f .legend-item{display:flex;align-items:center;position:absolute;margin-bottom:var(--cosmograph-color-legend-type-items-margin);pointer-events:none;width:100%;padding-left:1px;font-weight:300;transition:filter .1s ease-in-out,opacity .1s ease-in-out;min-height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px + var(--cosmograph-color-legend-type-items-margin));height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px);box-sizing:border-box}.style_module_typeLegend__15bf4b2f .unknown{background-color:var(--cosmograph-color-legend-type-unknown-color)}.style_module_typeLegend__15bf4b2f .others{background-color:var(--cosmograph-color-legend-type-others-color)}.style_module_typeLegend__15bf4b2f .bullet{height:var(--cosmograph-color-legend-type-bullet-size);width:var(--cosmograph-color-legend-type-bullet-size);min-height:var(--cosmograph-color-legend-type-bullet-size);min-width:var(--cosmograph-color-legend-type-bullet-size);border-radius:var(--cosmograph-color-legend-type-bullet-radius);pointer-events:all;margin-right:5px}.style_module_typeLegend__15bf4b2f .label{color:var(--cosmograph-color-legend-type-font-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - var(--cosmograph-color-legend-type-bullet-size) - 5px);pointer-events:all;transition:.05s linear color}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.bullet{margin-right:0}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.label{margin-right:5px}.style_module_typeLegend__15bf4b2f .show-more{cursor:pointer;padding-top:4px;display:none;font-weight:300;color:var(--cosmograph-color-legend-type-font-color);font-size:11px;opacity:.6;pointer-events:all;justify-content:space-between;transition:opacity .1s linear;font-feature-settings:"tnum"}.style_module_typeLegend__15bf4b2f .show-more:hover{opacity:1}.style_module_hovered__c0993502 .label,.style_module_hovered__c0993502 .sublabel{color:var(--cosmograph-color-legend-type-hover-color)!important;cursor:pointer}.style_module_selected__36e1dd81{filter:brightness(1)}.style_module_selected__36e1dd81>.style_module_label__afecc7a3{filter:brightness(1.2)}.style_module_unselected__4826cfb7{filter:brightness(.5)}.style_module_typeLegend__15bf4b2f .name{font-size:calc(var(--cosmograph-color-legend-type-font-size) + 1px);font-family:var(--cosmograph-color-legend-type-font-family);color:var(--cosmograph-color-legend-type-font-color);transition:color .15s ease-in-out,opacity .3s ease-in-out,max-height .3s ease-in-out,transform .3s ease-in-out;margin-bottom:4px;margin-top:2px;margin-left:1px;letter-spacing:-.02em;line-height:1.25;overflow:hidden;width:100%;white-space:nowrap;text-overflow:ellipsis;pointer-events:all;-webkit-user-select:none!important;user-select:none!important;max-height:100px;opacity:1;transform:translateY(0)}.style_module_typeLegend__15bf4b2f .name.hidden{opacity:0;max-height:0;margin-bottom:0;margin-top:0;transform:translateY(-10px)}:root{--cosmograph-button-color: var(--cosmograph-ui-text);--cosmograph-button-background: var(--cosmograph-ui-element-color);--cosmograph-button-border-radius: 2px}.style_module_button__e95a1138{background:var(--cosmograph-button-background);color:var(--cosmograph-button-color);border-radius:var(--cosmograph-button-border-radius);display:none;align-items:center;justify-content:center;width:25px;height:25px;margin:3px;padding:5px;cursor:pointer;filter:brightness(.95) contrast(.9);transition:filter .1s}.style_module_button__e95a1138:hover{filter:brightness(1.2) contrast(1)}')),document.head.appendChild(e)}}catch(_C){console.error("vite-plugin-css-injected-by-js",_C)}}();var WO=Object.defineProperty,jO=(e,t,n)=>((e,t,n)=>t in e?WO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);const YO={noDataMessage:"No data",loadingMessage:"Data loading...",disableStateMessages:!1,allowPointerEvents:!1};let qO=class{constructor(e,t){jO(this,"_displayStateDiv"),jO(this,"_displayStateTimeout",null),jO(this,"_displayStateConfig"),jO(this,"_displayStateContainerNode"),this._displayStateContainerNode=e,this._displayStateConfig={...YO,...t},"static"===getComputedStyle(e).position&&(e.style.position="relative"),this._displayStateDiv=this._createDisplayStateElement(),this._displayStateContainerNode.appendChild(this._displayStateDiv)}static extractConfig(e,t){return{noDataMessage:e.noDataMessage??t.noDataMessage,loadingMessage:e.loadingMessage??t.loadingMessage,disableStateMessages:e.disableStateMessages??t.disableStateMessages,allowPointerEvents:e.allowPointerEvents??t.allowPointerEvents}}_createDisplayStateElement(){const e=document.createElement("div");return e.classList.add("style_module_displayState__6ae19b84"),!1===this._displayStateConfig.allowPointerEvents&&(!1===this._displayStateConfig.noDataMessage?this._displayStateContainerNode.style.pointerEvents="none":this._displayStateContainerNode.style.pointerEvents=""),!this._displayStateConfig.disableStateMessages&&!1!==this._displayStateConfig.noDataMessage&&(e.textContent="string"==typeof this._displayStateConfig.noDataMessage?this._displayStateConfig.noDataMessage:YO.noDataMessage),e}setLoadingState(){this._displayStateConfig.disableStateMessages||!1===this._displayStateConfig.loadingMessage?this._displayStateDiv.textContent="":this._displayStateDiv.textContent="string"==typeof this._displayStateConfig.loadingMessage?this._displayStateConfig.loadingMessage:YO.loadingMessage}showState(e){this._resetDisplayStateTimeout(),this._displayStateConfig.disableStateMessages?this._displayStateDiv.textContent="":e?this._displayStateDiv.textContent=e:!1!==this._displayStateConfig.noDataMessage?this._displayStateDiv.textContent="string"==typeof this._displayStateConfig.noDataMessage?this._displayStateConfig.noDataMessage:YO.noDataMessage:this._displayStateDiv.textContent="",!1===this._displayStateConfig.allowPointerEvents&&(this._displayStateContainerNode.style.pointerEvents="none"),"flex"!==this._displayStateDiv.style.display&&(this._displayStateTimeout=setTimeout(()=>{this._displayStateDiv.style.display="flex"},150))}hideState(){this._resetDisplayStateTimeout(),this._displayStateDiv.style.display="none",this._displayStateContainerNode.style.pointerEvents=""}setDisplayStateConfig(e){this._displayStateConfig={...this._displayStateConfig,...e}}_resetDisplayStateTimeout(){this._displayStateTimeout&&(clearTimeout(this._displayStateTimeout),this._displayStateTimeout=null)}destroy(){var e,t;this._resetDisplayStateTimeout(),null==(t=null==(e=this._displayStateDiv)?void 0:e.parentNode)||t.removeChild(this._displayStateDiv)}};const XO="style_module_bar__114fa79f",KO="style_module_bars__097b45e0",ZO="style_module_hidden__a73fe81a",QO="style_module_disabled__eb988570",JO="style_module_highlightedBar__c2fc9bdc",eB="style_module_playAnimation__c1180703",tB="style_module_pauseAnimation__d6cfd97b";!function(){try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode('@keyframes style_module_fadeIn__ffac87fd{0%{opacity:0}to{opacity:.2}}.style_module_displayState__6ae19b84{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--cosmograph-ui-text);display:flex;justify-content:center;align-items:center;min-width:100px;opacity:.2;font-size:calc(var(--cosmograph-ui-font-size) + 1px);letter-spacing:-.02em;font-weight:200;user-select:none;-webkit-user-select:none;animation:style_module_fadeIn__ffac87fd .3s ease-in-out}:root{--cosmograph-timeline-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-timeline-selection-opacity: .5;--cosmograph-timeline-bar-color: var(--cosmograph-ui-element-color);--cosmograph-timeline-highlighted-bar-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-timeline-font-family: var(--cosmograph-ui-font-family);--cosmograph-timeline-font-size: var(--cosmograph-ui-tick-font-size);--cosmograph-timeline-background: var(--cosmograph-ui-background);--cosmograph-timeline-text-color: var(--cosmograph-ui-text);--cosmograph-timeline-axis-color: var(--cosmograph-ui-text)}.style_module_timeline__736434f7{position:relative;display:flex;background:var(--cosmograph-timeline-background);width:100%;min-height:25px;overflow:hidden}.style_module_timelineSvg__b916ad04{position:relative;width:100%;height:100%}.style_module_selection__ebee57f8{fill:var(--cosmograph-timeline-selection-color);fill-opacity:var(--cosmograph-timeline-selection-opacity);stroke:none}.style_module_axisTick__5865631d{color:var(--cosmograph-timeline-axis-color);font:var(--cosmograph-timeline-font-family);font-size:var(--cosmograph-timeline-font-size);user-select:none;-webkit-user-select:none;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum";alignment-baseline:text-before-edge}.style_module_axisLine__992b502d{opacity:.2;color:var(--cosmograph-timeline-axis-color)}.style_module_bar__114fa79f{fill:var(--cosmograph-timeline-bar-color);transform:scaleY(-1);opacity:0}.style_module_animationControl__ee52cd66{color:var(--cosmograph-timeline-axis-color);width:6%;max-width:30px;min-width:20px;cursor:pointer;display:none;align-items:center;user-select:none;-webkit-user-select:none;opacity:.5;position:relative;justify-content:center}.style_module_animationControl__ee52cd66>svg{width:50%;max-height:20px;padding-right:2px}.style_module_hidden__a73fe81a{display:none}.style_module_disabled__eb988570{opacity:.2;pointer-events:none}.style_module_highlightedBar__c2fc9bdc{fill:var(--cosmograph-timeline-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-search-font-family: var(--cosmograph-ui-font-family);--cosmograph-search-font-size: 14px;--cosmograph-search-list-font-size: 13.5px;--cosmograph-search-text-color: var(--cosmograph-ui-text);--cosmograph-search-background: transparent;--cosmograph-search-list-background: rgba(0, 0, 0, .2);--cosmograph-search-list-match-background: rgba(255, 255, 255, .2);--cosmograph-search-list-match-color: var(--cosmograph-ui-text)}.style_module_searchInput__d7830601:hover{filter:brightness(1.2) contrast(1)}.style_module_searchInput__d7830601{width:100%;background:transparent;color:var(--cosmograph-search-text-color);border:none;border-bottom:.5px solid var(--cosmograph-search-text-color);padding:4px 20px 5px 2px;font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:opacity .2s ease-out}.style_module_searchInput__d7830601::selection{background:var(--cosmograph-search-list-match-background)}.style_module_searchInput__d7830601:focus{outline:none}.style_module_searchSuggestions__b0d3f71e{color:#fff;width:100%;padding:0;margin:0;background:transparent;overflow-y:auto;flex:1;min-height:0}.style_module_searchSuggestions__b0d3f71e li{padding:5px 10px;cursor:pointer;-webkit-user-select:none;user-select:none;display:block;font-weight:500;font-size:var(--cosmograph-search-list-font-size);max-width:100%;overflow:hidden}.style_module_searchSuggestions__b0d3f71e li>div{white-space:nowrap;font-weight:200;overflow:hidden;text-overflow:ellipsis;width:100%}.style_module_searchSuggestions__b0d3f71e li:hover{background:#ffffff1a}.style_module_searchSuggestions__b0d3f71e mark{background:var(--cosmograph-search-list-match-background);color:var(--cosmograph-search-list-match-color);border-radius:2px}.style_module_clearButton__5ebb41de{position:absolute;right:0;top:0;height:100%;background:none;border:none;color:var(--cosmograph-search-text-color);font-weight:300;cursor:pointer;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d{opacity:.7}.style_module_placeholderWrapper__72d5eb0e{z-index:1;color:var(--cosmograph-search-text-color);font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);position:absolute;top:0;left:0;width:100%;bottom:0;display:flex;line-height:1.25;align-items:center;transition:transform .3s ease-out,opacity .3s ease-out}.style_module_placeholderWrapper__72d5eb0e.style_module_hidden__acfb8431{transform:translate(-30px);pointer-events:none;opacity:0}.style_module_searchInput__d7830601:disabled,.style_module_searchInput__d7830601.style_module_disabled__62c35dc5{opacity:.2;cursor:not-allowed;pointer-events:none}.style_module_disabled__62c35dc5 .style_module_clearButton__5ebb41de{display:none}.style_module_disabled__62c35dc5 .style_module_placeholderWrapper__72d5eb0e{opacity:.3;cursor:not-allowed}.style_module_searchInputWrapper__1edbcb22{position:relative;display:flex;width:100%}.style_module_noResults__363397c3{opacity:.3!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none}.style_module_noResults__363397c3:hover{background:none}.style_module_loading__296e0212{opacity:.7!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none;-webkit-user-select:none;user-select:none}.style_module_dropdownContainer__d98287da{position:absolute;top:100%;left:0;width:100%;background:var(--cosmograph-search-list-background);border-radius:4px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);opacity:0;transform:translateY(-10px);transition:opacity .2s ease-out,transform .2s ease-out;pointer-events:none;overflow:hidden;z-index:10;display:flex;flex-direction:column;padding-bottom:2px}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b{top:auto;bottom:100%;transform:translateY(10px)}.style_module_dropdownContainer__d98287da.style_module_visible__5be7493d{opacity:1;transform:translateY(0);pointer-events:auto}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b.style_module_visible__5be7493d{opacity:1;transform:translateY(-2px);pointer-events:auto}.style_module_footerContainer__73e7a066{flex-shrink:0}:root{--cosmograph-scrollbar-background: rgba(255, 255, 255, .1);--cosmograph-ui-background: rgb(45, 49, 58);--cosmograph-ui-text: #ffffffc7;--cosmograph-ui-tick-font-size: 11px;--cosmograph-ui-font-size: 12px;--cosmograph-ui-font-family: inherit;--cosmograph-ui-element-color: #5C616A;--cosmograph-ui-highlighted-element-color: white;--cosmograph-ui-selection-control-color: #8d949ea8;-webkit-font-smoothing:antialiased!important;text-rendering:optimizeLegibility!important}.style_module_cosmograph-ui__5acb97f1{background:var(--cosmograph-ui-background);color:var(--cosmograph-ui-text)}.style_module_scrollbar__f1516254 *::-webkit-scrollbar{width:5px;height:5px;border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-track{border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-corner{background:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-button{display:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-thumb{background-color:var(--cosmograph-scrollbar-background);transition:background-color .5s;border-radius:20px;border:3px solid var(--cosmograph-scrollbar-background)}@-moz-document url-prefix(){.style_module_scrollbar__f1516254 *{scrollbar-width:thin;scrollbar-color:var(--cosmograph-scrollbar-background) transparent;scrollbar-track-color:transparent;scrollbar-face-color:var(--cosmograph-scrollbar-background)}}:root{--cosmograph-histogram-background: var(--cosmograph-ui-background);--cosmograph-histogram-text-color: var(--cosmograph-ui-text);--cosmograph-histogram-axis-color: var(--cosmograph-ui-text);--cosmograph-histogram-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-histogram-selection-opacity: .5;--cosmograph-histogram-bar-color: var(--cosmograph-ui-element-color);--cosmograph-histogram-highlighted-bar-color: var( --cosmograph-ui-highlighted-element-color);--cosmograph-histogram-font-family: var(--cosmograph-ui-font-family);--cosmograph-histogram-font-size: var(--cosmograph-ui-tick-font-size)}.style_module_histogram__9d8a77ea{position:relative;display:flex;min-height:25px;background:var(--cosmograph-histogram-background);width:100%}.style_module_histogramSvg__ccccb628{position:relative;width:100%;height:100%}.style_module_selection__7db96137{fill:var(--cosmograph-histogram-selection-color);fill-opacity:var(--cosmograph-histogram-selection-opacity);stroke:none}.style_module_axisTick__898e1f39{color:var(--cosmograph-histogram-axis-color);font-family:var(--cosmograph-histogram-font-family);font-size:var(--cosmograph-histogram-font-size);user-select:none;-webkit-user-select:none;alignment-baseline:text-before-edge;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum"}.style_module_bar__3c9ab488{fill:var(--cosmograph-histogram-bar-color);transform:scaleY(-1)}.style_module_highlightedBar__b193a8de{fill:var(--cosmograph-histogram-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-bars-font-color: var(--cosmograph-ui-text);--cosmograph-bars-font-family: var(--cosmograph-ui-font-family);--cosmograph-bars-font-size: var(--cosmograph-ui-font-size);--cosmograph-bars-ui-font-size: 11.5px;--cosmograph-bars-background: var(--cosmograph-ui-element-color);--cosmograph-bars-bar-height: 20px;--cosmograph-bars-bar-bottom-margin: 2px;--cosmograph-bars-highlighted-color: var( --cosmograph-ui-highlighted-element-color)}.style_module_bars__25497ded{position:relative;width:100%;min-height:100px;user-select:none;flex-direction:column;-webkit-user-select:none}.style_module_bars__25497ded .scroll-container{position:relative;width:100%;overflow-y:hidden;overflow-x:hidden}.style_module_bars__25497ded .bars-container{position:relative;width:calc(100% - 1px);font-family:var(--cosmograph-bars-font-family)}.style_module_bars__25497ded .highlighted-bars-container{position:absolute;top:0;left:0;pointer-events:none}.style_module_bars__25497ded .row{height:var(--cosmograph-bars-bar-height);display:flex;align-items:center;margin-bottom:var(--cosmograph-bars-bar-bottom-margin);width:100%;transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row:hover{filter:brightness(1.15) contrast(1.05);transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row.unselected:hover{filter:brightness(.95) contrast(1.15);transition:filter .05s linear}.style_module_bars__25497ded .unselected{opacity:.85;filter:brightness(.8) contrast(1.1)}.style_module_bars__25497ded .selected{filter:brightness(1.05) contrast(1.05)}.style_module_bars__25497ded .selected>.info>.label{font-weight:600;filter:brightness(1.1) contrast(1.05)}.style_module_bars__25497ded .unselected>.info>.label{font-weight:300}.style_module_bars__25497ded .bar{height:100%;background-color:var(--cosmograph-bars-background);opacity:.8;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .bar-highlighted{height:100%;background-color:var(--cosmograph-bars-highlighted-color);opacity:.2;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .info{display:flex;justify-content:space-between;width:100%;padding:0 4px;position:absolute;font-size:var(--cosmograph-bars-font-size);font-feature-settings:"tnum";color:var(--cosmograph-bars-font-color);gap:2px}.style_module_bars__25497ded .label{min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:opacity .05s linear}.style_module_bars__25497ded .count{flex-shrink:0;font-weight:300;opacity:.8;transition:opacity .05s linear}.style_module_bars__25497ded .show-more{cursor:pointer;padding-top:2px;display:flex;font-weight:300;color:var(--cosmograph-bars-font-color);font-size:11px;justify-content:space-between;opacity:.6;font-size:var(--cosmograph-bars-ui-font-size);pointer-events:none;transition:opacity .1s linear}.style_module_bars__25497ded .show-more:hover{opacity:1;text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .show-more>span{pointer-events:all}.style_module_bars__25497ded .show-more-count{padding-right:5px;pointer-events:all;font-feature-settings:"tnum"}.style_module_bars__25497ded .unselected>.info>.label,.style_module_bars__25497ded .unselected>.info>.count{opacity:.5}.style_module_bars__25497ded .unselected:hover>.info>.label,.style_module_bars__25497ded .unselected:hover>.info>.count{opacity:1}.style_module_bars__25497ded .search-input{background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,.3);font-size:13px!important;color:var(--cosmograph-bars-font-color);line-height:1.5;padding:2px;width:100%;position:relative;transition:border-bottom-color .2s}.style_module_bars__25497ded .search-input::placeholder{color:var(--cosmograph-bars-font-color)!important;opacity:.4;font-weight:300;font-family:inherit}.style_module_bars__25497ded .search-container{position:relative;width:100%;margin-bottom:4px;display:none;z-index:1}.style_module_bars__25497ded .clear-button{position:absolute;right:0;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--cosmograph-bars-font-color);font-weight:300;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_bars__25497ded .clear-button.visible:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_bars__25497ded .clear-button.visible{opacity:.7}.style_module_bars__25497ded .clear-button svg{width:10px;height:10px;fill:currentColor}.style_module_bars__25497ded .sorting-block{visibility:hidden;margin-top:1px;display:flex;justify-content:space-between}.style_module_bars__25497ded .buttons-container{margin-top:4px;font-size:var(--cosmograph-bars-ui-font-size);display:flex;gap:4px;line-height:1.25}.style_module_bars__25497ded .buttons-container>div{transition:opacity .05s linear,filter .05s linear;padding:1px 5px;background:var(--cosmograph-bars-background);border-radius:4px;opacity:.9;display:flex;cursor:pointer;align-items:center}.style_module_bars__25497ded .buttons-container>div:hover{filter:brightness(1.2)}.style_module_bars__25497ded .reset-text{transition:opacity .05s linear,filter .05s linear;display:flex;font-size:var(--cosmograph-bars-ui-font-size);align-items:end;padding-right:4px;cursor:pointer;font-weight:300}.style_module_bars__25497ded .reset-text:hover{text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .reset-text.unselected{pointer-events:none;cursor:default;opacity:.7}.style_module_bars__25497ded :scope.reset-text:hover:not(.unselected){filter:brightness(1.5);opacity:1}:root{--cosmograph-size-legend-form-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-family: inherit;--cosmograph-size-legend-font-size: var(--cosmograph-ui-font-size);--cosmograph-size-legend-sublabel-font-size: 10px;--cosmograph-size-legend-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-size-legend-line-radius: 2px;--cosmograph-size-legend-line-width: 30px;--cosmograph-size-legend-hide-transform: translateY(100%);--cosmograph-size-legend-show-transform: translateX(0)}.style_module_container__d2889234{display:flex;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;overflow:hidden;min-height:25px}.style_module_legend__75c167f2{width:auto;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-size-legend-font-size);font-family:var(--cosmograph-size-legend-font-family);user-select:none;-webkit-user-select:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.04em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__91eae57a{opacity:1;transform:var(--cosmograph-size-legend-show-transform)}.style_module_disabled__d51f7a10{opacity:0;transform:var(--cosmograph-size-legend-hide-transform);pointer-events:none;display:none!important;min-height:0}@starting-style{.style_module_container__d2889234.style_module_enabled__91eae57a,.style_module_legend__75c167f2.style_module_enabled__91eae57a{opacity:0;transform:var(--cosmograph-size-legend-hide-transform)}}.style_module_legend__75c167f2 .circle{background-color:var(--cosmograph-size-legend-form-color);border-radius:50%;transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2 .line{background-color:var(--cosmograph-size-legend-form-color);border-radius:var(--cosmograph-size-legend-line-radius);width:var(--cosmograph-size-legend-line-width);transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2.style_module_events__894316a8{pointer-events:auto;cursor:pointer}.style_module_legend__75c167f2 .legend-content{display:flex;align-items:end;justify-content:center;gap:.75rem}.style_module_legend__75c167f2 .legend-content>div{transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__75c167f2 .labels-wrapper{white-space:nowrap}.style_module_legend__75c167f2 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-size-legend-items-margin)}.style_module_legend__75c167f2 .name{align-items:center;text-align:center;justify-content:center;display:flex;color:var(--cosmograph-size-legend-font-color);overflow:hidden;width:100%;margin-top:3px;word-break:break-all;white-space:pre-line;transition:color .15s ease-in-out;letter-spacing:-.02em}.style_module_legend__75c167f2 .label{color:var(--cosmograph-size-legend-font-color);overflow:hidden;transition:color .15s ease-in-out;text-overflow:ellipsis;font-feature-settings:"tnum"}.style_module_legend__75c167f2 .sublabel{padding-top:1px;font-size:var(--cosmograph-size-legend-sublabel-font-size);opacity:.5;line-height:1;min-width:10px;transition:color .15s ease-in-out}.style_module_hovered__1206707f .label,.style_module_hovered__1206707f .sublabel{color:var(--cosmograph-size-legend-hover-color);cursor:pointer}.style_module_hovered__1206707f .circle,.style_module_hovered__1206707f .line{background-color:var(--cosmograph-size-legend-hover-color);cursor:pointer}:root{--cosmograph-color-legend-range-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-range-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-range-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-label-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-sublabel-font-size: 10px;--cosmograph-color-legend-range-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-range-gradient-height: 6px;--cosmograph-color-legend-range-gradient-radius: 8px;--cosmograph-color-legend-range-gradient-top-margin: 6px;--cosmograph-color-legend-hide-transform: translateY(100%);--cosmograph-color-legend-show-transform: translateX(0)}.style_module_container__05cc807d{display:flex;min-width:150px;min-height:25px;width:100%;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_legend__a3e235e4{width:100%;font-weight:300;letter-spacing:-.04em;display:flex;flex-direction:column;font-size:var(--cosmograph-color-legend-range-font-size);font-family:var(--cosmograph-color-legend-range-font-family);user-select:none;-webkit-user-select:none;pointer-events:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__b3120e27{opacity:1;transform:var(--cosmograph-color-legend-show-transform);pointer-events:auto}.style_module_disabled__c2dc158c{opacity:0;transform:var(--cosmograph-color-legend-hide-transform);pointer-events:none;display:none;min-height:0}@starting-style{.style_module_container__05cc807d.style_module_enabled__b3120e27,.style_module_legend__a3e235e4.style_module_enabled__b3120e27{opacity:0;transform:var(--cosmograph-color-legend-hide-transform)}}.style_module_legend__a3e235e4 .legend-content{display:flex;align-items:end;justify-content:space-between}.style_module_hovered__dfd7bb2c .label,.style_module_hovered__dfd7bb2c .sublabel{color:var(--cosmograph-size-legend-hover-color)!important;cursor:pointer}.style_module_legend__a3e235e4 .extent{white-space:nowrap;transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__a3e235e4 .gradient{width:100%;margin-top:var(--cosmograph-color-legend-range-gradient-top-margin);height:var(--cosmograph-color-legend-range-gradient-height);border-radius:var(--cosmograph-color-legend-range-gradient-radius)}.style_module_legend__a3e235e4 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-color-legend-range-items-margin)}.style_module_legend__a3e235e4 .name{align-items:center;text-align:center;justify-content:space-around;display:flex;color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;width:100%;word-break:break-word;text-wrap:balance;white-space:pre-line;transition:color .15s ease-in-out;margin:0 4px;letter-spacing:-.02em;line-height:1.25}.style_module_legend__a3e235e4 .label{color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;max-width:150px;text-overflow:ellipsis;font-size:var(--cosmograph-color-legend-range-label-font-size);transition:color .15s ease-in-out;line-height:1;font-feature-settings:"tnum"}.style_module_legend__a3e235e4 .sublabel{padding-top:1px;color:var(--cosmograph-color-legend-range-font-color);opacity:.55;font-size:var(--cosmograph-color-legend-range-sublabel-font-size);line-height:1;transition:color .15s ease-in-out}:root{--cosmograph-color-legend-type-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-type-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-type-font-size: 11px;--cosmograph-color-legend-type-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-type-others-color: #bab0ab;--cosmograph-color-legend-type-bullet-size: 8px;--cosmograph-color-legend-type-bullet-radius: 1rem;--cosmograph-color-legend-type-items-margin: 4px;--cosmograph-color-legend-type-hide-transform: translateY(125%);--cosmograph-color-legend-type-show-transform: translateX(0)}.style_module_enabled__277b2403{opacity:1;transform:var(--cosmograph-color-legend-type-show-transform)}.style_module_disabled__7a587f96{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform);display:none!important;min-height:0}.style_module_wrapper__ea8ca7f4{position:relative;max-width:100%;width:fit-content;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_typeLegend__15bf4b2f{position:relative;width:fit-content;max-width:100%;min-height:25px;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.015em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_typeLegend__15bf4b2f .reverted{flex-direction:row-reverse}.style_module_typeLegend__15bf4b2f .scroll-container{width:100%;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-color-legend-type-font-size);font-family:var(--cosmograph-color-legend-type-font-family);user-select:none;-webkit-user-select:none;line-height:normal;overflow-x:hidden;overflow-y:auto;will-change:transform}@starting-style{.style_module_typeLegend__15bf4b2f.style_module_enabled__277b2403,.style_module_wrapper__ea8ca7f4.style_module_enabled__277b2403{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform)}}.style_module_typeLegend__15bf4b2f .legend-item{display:flex;align-items:center;position:absolute;margin-bottom:var(--cosmograph-color-legend-type-items-margin);pointer-events:none;width:100%;padding-left:1px;font-weight:300;transition:filter .1s ease-in-out,opacity .1s ease-in-out;min-height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px + var(--cosmograph-color-legend-type-items-margin));height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px);box-sizing:border-box}.style_module_typeLegend__15bf4b2f .unknown{background-color:var(--cosmograph-color-legend-type-unknown-color)}.style_module_typeLegend__15bf4b2f .others{background-color:var(--cosmograph-color-legend-type-others-color)}.style_module_typeLegend__15bf4b2f .bullet{height:var(--cosmograph-color-legend-type-bullet-size);width:var(--cosmograph-color-legend-type-bullet-size);min-height:var(--cosmograph-color-legend-type-bullet-size);min-width:var(--cosmograph-color-legend-type-bullet-size);border-radius:var(--cosmograph-color-legend-type-bullet-radius);pointer-events:all;margin-right:5px}.style_module_typeLegend__15bf4b2f .label{color:var(--cosmograph-color-legend-type-font-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - var(--cosmograph-color-legend-type-bullet-size) - 5px);pointer-events:all;transition:.05s linear color}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.bullet{margin-right:0}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.label{margin-right:5px}.style_module_typeLegend__15bf4b2f .show-more{cursor:pointer;padding-top:4px;display:none;font-weight:300;color:var(--cosmograph-color-legend-type-font-color);font-size:11px;opacity:.6;pointer-events:all;justify-content:space-between;transition:opacity .1s linear;font-feature-settings:"tnum"}.style_module_typeLegend__15bf4b2f .show-more:hover{opacity:1}.style_module_hovered__c0993502 .label,.style_module_hovered__c0993502 .sublabel{color:var(--cosmograph-color-legend-type-hover-color)!important;cursor:pointer}.style_module_selected__36e1dd81{filter:brightness(1)}.style_module_selected__36e1dd81>.style_module_label__afecc7a3{filter:brightness(1.2)}.style_module_unselected__4826cfb7{filter:brightness(.5)}.style_module_typeLegend__15bf4b2f .name{font-size:calc(var(--cosmograph-color-legend-type-font-size) + 1px);font-family:var(--cosmograph-color-legend-type-font-family);color:var(--cosmograph-color-legend-type-font-color);transition:color .15s ease-in-out,opacity .3s ease-in-out,max-height .3s ease-in-out,transform .3s ease-in-out;margin-bottom:4px;margin-top:2px;margin-left:1px;letter-spacing:-.02em;line-height:1.25;overflow:hidden;width:100%;white-space:nowrap;text-overflow:ellipsis;pointer-events:all;-webkit-user-select:none!important;user-select:none!important;max-height:100px;opacity:1;transform:translateY(0)}.style_module_typeLegend__15bf4b2f .name.hidden{opacity:0;max-height:0;margin-bottom:0;margin-top:0;transform:translateY(-10px)}:root{--cosmograph-button-color: var(--cosmograph-ui-text);--cosmograph-button-background: var(--cosmograph-ui-element-color);--cosmograph-button-border-radius: 2px}.style_module_button__e95a1138{background:var(--cosmograph-button-background);color:var(--cosmograph-button-color);border-radius:var(--cosmograph-button-border-radius);display:none;align-items:center;justify-content:center;width:25px;height:25px;margin:3px;padding:5px;cursor:pointer;filter:brightness(.95) contrast(.9);transition:filter .1s}.style_module_button__e95a1138:hover{filter:brightness(1.2) contrast(1)}')),document.head.appendChild(e)}}catch(_C){console.error("vite-plugin-css-injected-by-js",_C)}}();var nB=Object.defineProperty,iB=(e,t,n)=>((e,t,n)=>t in e?nB(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class oB extends qO{constructor(e,t){const n=IO(SO,t??{});super(e,qO.extractConfig(n,SO)),iB(this,"_config"),iB(this,"_animationInterval"),iB(this,"_isAnimationRunning",!1),iB(this,"_svgParser",new DOMParser),iB(this,"_svg"),iB(this,"_animationControlDiv"),iB(this,"_playButtonSvg"),iB(this,"_pauseButtonSvg"),iB(this,"_containerNode"),iB(this,"_axisGroup"),iB(this,"_barsGroup"),iB(this,"_brushGroup"),iB(this,"_highlightedBarsGroup"),iB(this,"_resizeObserver"),iB(this,"_height",0),iB(this,"_width",0),iB(this,"_timelineWidth",0),iB(this,"_timelineHeight",0),iB(this,"_barWidth",0),iB(this,"_maxCount",0),iB(this,"_barsData",[]),iB(this,"_highlightedBarsData",[]),iB(this,"_highlightedData"),iB(this,"_timeData"),iB(this,"_extent"),iB(this,"_bandIntervals",[]),iB(this,"_currentSelection"),iB(this,"_currentSelectionInPixels"),iB(this,"_isNumericTimeline",!1),iB(this,"_firstRender",!0),iB(this,"_yScale",dM()),iB(this,"_timeScale",xO()),iB(this,"_numScale",cM()),iB(this,"_activeAxisScale",this._timeScale),iB(this,"_timeAxis",RP(this._timeScale)),iB(this,"_numAxis",RP(this._numScale)),iB(this,"_brushInstance"),iB(this,"_toggleAnimation",e=>{e.preventDefault(),this._isAnimationRunning?this.pauseAnimation():this.playAnimation()}),iB(this,"_disableAnimation",()=>{var e,t;this.pauseAnimation(),null==(e=this._animationControlDiv)||e.removeEventListener("click",this._toggleAnimation),null==(t=this._animationControlDiv)||t.remove()}),iB(this,"playAnimation",()=>{var e,t,n,i;clearInterval(this._animationInterval),this._currentSelectionInPixels&&(this._animationInterval=setInterval(this._animateSelection,this._config.animationSpeed??0),this._isAnimationRunning=!0,null==(t=(e=this._config).onAnimationPlay)||t.call(e,this._isAnimationRunning,this._currentSelection),null==(n=this._pauseButtonSvg)||n.classList.remove(ZO),null==(i=this._playButtonSvg)||i.classList.add(ZO))}),iB(this,"pauseAnimation",()=>{var e,t,n,i;clearInterval(this._animationInterval),this._isAnimationRunning=!1,null==(t=(e=this._config).onAnimationPause)||t.call(e,this._isAnimationRunning,this._currentSelection),null==(n=this._pauseButtonSvg)||n.classList.add(ZO),null==(i=this._playButtonSvg)||i.classList.remove(ZO)}),iB(this,"stopAnimation",()=>{var e,t;this.pauseAnimation(),this.setSelection(void 0),null==(t=(e=this._config).onBrush)||t.call(e,void 0)}),iB(this,"_animateSelection",()=>{var e,t,n,i;const o=this._currentSelectionInPixels;o&&void 0!==o[0]&&void 0!==o[1]&&(this._setSelectionInPixels([o[0]+this._barWidth,o[1]+this._barWidth]),null==(t=(e=this._config).onAnimationTick)||t.call(e,this._currentSelection),(o[1]===(null==(n=this._currentSelectionInPixels)?void 0:n[1])||void 0===(null==(i=this._currentSelectionInPixels)?void 0:i[1]))&&this.stopAnimation())}),iB(this,"destroy",()=>{super.destroy(),this._resizeObserver.disconnect(),this._containerNode.innerHTML="",clearInterval(this._animationInterval)}),this._config=n,this._containerNode=e,this._containerNode.classList.add("style_module_timeline__736434f7"),this._animationControlDiv=document.createElement("div"),this._animationControlDiv.classList.add("style_module_animationControl__ee52cd66"),this._containerNode.appendChild(this._animationControlDiv),this._initializeSVG(),this._initializeGroups(),this._initAnimationControls(),this._resizeObserver=new SP(()=>{this.resize()}),this._resizeObserver.observe(this._containerNode)}_initializeSVG(){this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._svg.classList.add("style_module_timelineSvg__b916ad04"),this._containerNode.appendChild(this._svg)}async _initAnimationControls(){await(async()=>{var e,t;if(!this._animationControlDiv.firstChild){const n=this._svgParser.parseFromString('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg>',"image/svg+xml").firstChild,i=this._svgParser.parseFromString('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M48 64C21.5 64 0 85.5 0 112V400c0 26.5 21.5 48 48 48H80c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48H48zm192 0c-26.5 0-48 21.5-48 48V400c0 26.5 21.5 48 48 48h32c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48H240z"/></svg>',"image/svg+xml").firstChild;this._pauseButtonSvg=null==(e=this._animationControlDiv)?void 0:e.appendChild(i),this._playButtonSvg=null==(t=this._animationControlDiv)?void 0:t.appendChild(n)}})().then(()=>{var e,t,n,i,o;this._isAnimationRunning?(null==(n=this._playButtonSvg)||n.classList.add(eB,ZO),null==(i=this._pauseButtonSvg)||i.classList.add(tB)):(null==(e=this._playButtonSvg)||e.classList.add(eB),null==(t=this._pauseButtonSvg)||t.classList.add(tB,ZO)),this._currentSelection||null==(o=this._animationControlDiv)||o.classList.add(QO),this._animationControlDiv.addEventListener("click",this._toggleAnimation)})}setLoadingState(){super.setLoadingState()}_initializeGroups(){this._axisGroup=bk(this._svg).append("g").attr("class","style_module_axis__5ff3086c"),this._barsGroup=bk(this._svg).append("g").attr("class",KO),this._highlightedBarsGroup=bk(this._svg).append("g").attr("class",KO),this._brushGroup=bk(this._svg).append("g").attr("class","style_module_brush__39277182")}get _barPadding(){return this._barWidth*(this._config.barPadding??0)}getCurrentSelection(){return this._currentSelection}getCurrentSelectionInPixels(){return this._currentSelectionInPixels}getBarWidth(){return this._barWidth-this._barPadding}getConfig(){return this._config}getIsAnimationRunning(){return this._isAnimationRunning}setConfig(e){var t,n,i,o;const r=JSON.parse(JSON.stringify(this._config));this._config=IO(SO,e??{}),this.setDisplayStateConfig(qO.extractConfig(this._config,SO)),r.formatter!==this._config.formatter&&this._checkFormatter(),null!=(t=this._config)&&t.showAnimationControls?null!=(n=this._animationControlDiv)&&n.isConnected||this._initAnimationControls():this._animationControlDiv&&this._disableAnimation(),this._config.allowSelection||this._disableBrush(),((null==(i=this._config)?void 0:i.dataStep)!==r.dataStep||(null==(o=this._config)?void 0:o.barCount)!==r.barCount)&&(this._updateTimelineData(this._timeData),this._updateTimelineData(this._highlightedData,!0)),this.resize()}_checkFormatter(){this._config.formatter?(this._timeAxis.tickFormat(e=>this._config.formatter(e)),this._numAxis.tickFormat(e=>this._config.formatter(e))):this._extent&&(this._timeAxis.tickFormat(e=>GO(e,+this._extent[1]-+this._extent[0],this._isNumericTimeline)),this._numAxis.tickFormat(e=>GO(e,+this._extent[1]-+this._extent[0],this._isNumericTimeline)))}_parseData(e){if(null==e||!e.length)return[];const t=new Float64Array(e.length);let n=0;for(let i=0;i<e.length;i++){const o=e[i];let r;r=o instanceof Date?o.getTime():o,r&&!isNaN(r)&&(t[n++]=this._normalizeTimeToMilliseconds(r))}return Array.from(t.subarray(0,n))}setTimeData(e,t){if(this._highlightedBarsData=[],this._timeData=[],this._currentSelection=void 0,t&&t[1]<=t[0])return;if(this._brushCurrentSelection(),e&&e.length>1){const t=e[0],n=t instanceof Date&&!isNaN(t.getTime()),i="number"==typeof t&&new Date(t).getFullYear()>1970;this._isNumericTimeline=!n&&!i}const n=this._parseData(e),i=t||_D(n),o=i[0]<i[1]&&n.length>1;bk(this._animationControlDiv).style("display",o?"flex":"none"),o?(this.hideState(),this._timeData=n,this._extent=i,this._firstRender=!0):(this.showState("Empty or invalid timeline data"),this.render()),this._updateTimelineData(this._timeData),this._updateScales(),this.render()}setHighlightedData(e){this._highlightedBarsData=[],this._timeData&&(this._highlightedData=this._parseData(e),this._updateTimelineData(this._highlightedData,!0),this._updateBars(!0))}_updateTimelineData(e=[],t=!1){const n=t?"_highlightedBarsData":"_barsData";if(!this._extent)return void(this[n]=[]);if(!e.length)return void(this[n]=LO([],this._bandIntervals,this._currentSelection,t));t||this._generateBandIntervals();const i=LO(e,this._bandIntervals,this._currentSelection,t);this[n]=i,t||(this._maxCount=Math.max(...i.map(e=>e.count)))}_generateBandIntervals(){if(!this._extent)return;const{barCount:e=30,dataStep:t}=this._config;this._bandIntervals=kO(this._extent,e,t)}setSelection(e,t=!1){var n,i,o,r,s,a,l;const c=this._currentSelection;if(e&&this._extent){const t=[Math.max(+this._extent[0],Math.min(+e[0],+this._extent[1])),Math.min(+this._extent[1],Math.max(+e[1],+this._extent[0]))];if(t[0]<t[1]){if(this._config.stickySelection){const e=t.map(this._activeAxisScale);this._mapSelection(e)}else this._currentSelection=t;null==(n=this._animationControlDiv)||n.classList.remove(QO)}else this._currentSelection=void 0,null==(i=this._animationControlDiv)||i.classList.add(QO)}else this._currentSelection=void 0,null==(o=this._animationControlDiv)||o.classList.add(QO);!t&&((null==c?void 0:c[0])!==(null==(r=this._currentSelection)?void 0:r[0])||(null==c?void 0:c[1])!==(null==(s=this._currentSelection)?void 0:s[1]))&&(null==(l=(a=this._config).onBrush)||l.call(a,this._currentSelection,!0)),this._brushCurrentSelection()}_setSelectionInPixels(e){var t,n,i,o,r;if(e){const i=[Math.max(0,Math.min(e[0],this._timelineWidth)),Math.min(this._timelineWidth,Math.max(e[1],0))];i[0]<i[1]?(this._currentSelection=i.map(e=>this._activeAxisScale.invert(e)),null==(t=this._animationControlDiv)||t.classList.remove(QO)):(this._currentSelection=void 0,null==(n=this._animationControlDiv)||n.classList.add(QO))}else this._currentSelection=void 0,null==(i=this._animationControlDiv)||i.classList.add(QO);null==(r=(o=this._config).onBrush)||r.call(o,this._currentSelection),this._brushCurrentSelection()}updateDimensions(){var e,t,n,i;const{height:o,width:r}=(e=>{const t=getComputedStyle(e);let n=e.clientWidth,i=e.clientHeight;return i-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),n-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),{height:i,width:n}})(this._containerNode),{offsetWidth:s}=this._animationControlDiv;this._width=r,this._height=o,this._timelineWidth=this._width-((null==(e=this._config.padding)?void 0:e.left)??0)-((null==(t=this._config.padding)?void 0:t.right)??0)-s,this._timelineHeight=this._height-((null==(n=this._config.padding)?void 0:n.top)??0)-((null==(i=this._config.padding)?void 0:i.bottom)??0)}resize(){var e,t;this.updateDimensions();const n=(null==(e=this._config.padding)?void 0:e.top)??0,i=(null==(t=this._config.padding)?void 0:t.bottom)??0;this._timelineHeight>n+i&&(this._updateScales(),this._checkLastTickPosition(),this._currentSelection&&this.setSelection(this._currentSelection,!0),this.render())}render(){this._timelineHeight<=0||this._timelineWidth<=0?this._axisGroup.style("display","none"):(this._firstRender&&(this.updateDimensions(),this._updateScales(),this._checkLastTickPosition()),this._updateBrush(),this._updateBars(),this._updateBars(!0),this._updateAxis(),this._firstRender&&(this._firstRender=!1))}_updateAxis(){if(!this._timeData||!this._timeData.length)return void this._axisGroup.style("display","none");const{padding:e,axisTickHeight:t,selectionPadding:n}=this._config;this._axisGroup.style("transform",`translate(${((null==e?void 0:e.left)??0)+1}px, ${((null==e?void 0:e.top)??0)+(t??0)+1+(n??0)/2}px)`).call(this._isNumericTimeline?this._numAxis:this._timeAxis).call(e=>e.select(".domain").remove()),this._axisGroup.selectAll(".tick").select("text").attr("class","style_module_axisTick__5865631d").attr("y",0).attr("dy",-(t??0)).attr("dx","5px"),this._axisGroup.selectAll("line").attr("class","style_module_axisLine__992b502d").attr("y2",-(t??0))}_updateBrush(){if(!this._config.allowSelection||this._timelineHeight<0||this._timelineWidth<0)return void this._brushGroup.selectAll("*").remove();const{selectionPadding:e,padding:t,selectionRadius:n}=this._config,i=this._timelineHeight-(e??0),o=[[0,(e??0)/2],[this._timelineWidth,i+(e??0)/2]];this._brushInstance=rD().extent(o),this._brushInstance.on("end",({selection:e,sourceEvent:t})=>{var n,i,o,r,s,a;t&&(e?(this._config.stickySelection?this._mapSelection(e):this._currentSelection=e.map(e=>this._activeAxisScale.invert(e)),null==(n=this._animationControlDiv)||n.classList.remove(QO),null==(o=(i=this._config).onBrush)||o.call(i,this._currentSelection)):(this._currentSelection=void 0,null==(s=(r=this._config).onBrush)||s.call(r,void 0),null==(a=this._animationControlDiv)||a.classList.add(QO)),this._brushCurrentSelection())}),this._brushGroup.style("transform",`translate(${(null==t?void 0:t.left)??0}px, ${(null==t?void 0:t.top)??0}px)`).call(this._brushInstance).call(this._brushInstance.move,this._currentSelectionInPixels||null),this._brushGroup.select("rect.selection").classed("style_module_selection__ebee57f8",!0).attr("rx",n??0).attr("ry",n??0)}_updateBars(e=!1){const{padding:t,selectionPadding:n}=this._config,i=e?this._highlightedBarsGroup:this._barsGroup;if(!this._timeData||!this._timeData.length)return void i.selectAll("rect").remove();i.style("transform",`translate(${(null==t?void 0:t.left)??0}px, ${((null==t?void 0:t.top)??0)-(n??0)/2}px)`);const o=e?.5:1,r=this._createBars(i,e);!e&&this._config.onBarHover&&r.on("mouseover",e=>{var t,n;return null==(n=(t=this._config).onBarHover)?void 0:n.call(t,e)}),this._animateBars(r,e,o)}_createBars(e,t){return this._activeAxisScale&&this._yScale&&this._barsData.length?e.selectAll(`.${t?JO:XO}`).data(t?this._highlightedBarsData:this._barsData).join("rect").attr("class",t?JO:XO).attr("x",e=>this._activeAxisScale(e.rangeStart)+this._barPadding/2).attr("width",this.getBarWidth()).attr("rx",this._config.barRadius??0).attr("ry",this._config.barRadius??0).attr("y",-this._timelineHeight):(e.selectAll("rect").remove(),e.selectAll("rect"))}_animateBars(e,t,n){e.transition().duration(this._isAnimationRunning?0:300).attr("height",e=>t&&0===e.count?0:this._yScale(e.count)).style("opacity",e=>this._yScale(e.count)===(this._config.minBarHeight??0)?.4:n)}_updateScales(){if(!this._extent||!this._barsData.length||this._timelineHeight<0||this._timelineWidth<0)return void this._axisGroup.style("display","none");this._checkFormatter(),this._axisGroup.style("display","inherit");const e=this._barsData[this._barsData.length-1],t=Math.floor(this._timelineWidth/100),n=this._barsData.map(e=>e.rangeStart);let i;if(n.length>t){const e=Math.ceil(n.length/t);i=n.filter((t,n)=>n%e===0)}else i=n;(this._isNumericTimeline?this._numAxis:this._timeAxis).tickValues(i);const o=Math.max(0,this._maxCount),r=Math.max(0,this._config.minBarHeight??0),s=Math.max(0,this._timelineHeight-(this._config.barTopMargin??0)-(this._config.selectionPadding??0));this._yScale.range([r,s]).domain([0,o]).clamp(!0);const a=[this._extent[0],e.rangeEnd],l=[0,this._timelineWidth],c=this._isNumericTimeline?this._numScale:this._timeScale;c.domain(a),c.range(l),c.clamp(!0),this._activeAxisScale=c;const u=this._barsData[0],h=this._activeAxisScale(u.rangeEnd)-this._activeAxisScale(u.rangeStart);this._barWidth=h}_disableBrush(){var e,t;null==(e=this._brushInstance)||e.clear(this._brushGroup),this._currentSelectionInPixels=void 0,this._currentSelection=void 0,this.pauseAnimation(),this._brushGroup.selectAll("*").remove(),this._config.showAnimationControls&&(null==(t=this._animationControlDiv)||t.classList.add(QO))}_mapSelection(e){if(!this._barsData.length)return;const t=this._activeAxisScale.invert(e[0]),n=this._activeAxisScale.invert(e[1]),i=this._getClosestRange(+t),o=this._getClosestRange(+n,!0);i&&o&&i.rangeStart<=o.rangeEnd&&e[1]-e[0]>this.getBarWidth()/2?this._currentSelection=[i.rangeStart,o.rangeEnd]:this._currentSelection=void 0}_getClosestRange(e,t){return this._barsData.reduce((n,i)=>{const o=t?n.rangeEnd:n.rangeStart,r=t?i.rangeEnd:i.rangeStart;return Math.abs(+r-+e)<Math.abs(+o-+e)?i:n})}_checkLastTickPosition(){var e;const t=this._axisGroup.selectAll(".tick:last-of-type").nodes();if(null!=t&&t.length){const n=t[0],i=null==n?void 0:n.getBoundingClientRect().right,o=null==(e=this._svg)?void 0:e.getBoundingClientRect().right;n.style.display=i>=o?"none":"inherit"}}_brushCurrentSelection(){var e;this._currentSelection?(this._currentSelectionInPixels=this._currentSelection.map(this._activeAxisScale),this._brushInstance&&!this._firstRender&&this._brushGroup.call(this._brushInstance.move,this._currentSelectionInPixels)):(this._currentSelectionInPixels=void 0,null==(e=this._brushInstance)||e.clear(this._brushGroup))}_normalizeTimeToMilliseconds(e){if(e<1e13)return e;const t=10**(Math.floor(Math.log10(e))-12);return Math.round(e/t*1e3)/1e3}}const rB={debounceTime:300,suggestionsLimit:50,maxVisibleItems:10,minSearchLength:2,highlightMatch:!0,disabled:!1,openListUpwards:!1,placeholderRenderer:"Search...",suggestionRenderer:e=>String(e),selectedSuggestionRenderer:e=>String(e),inputClassName:void 0,suggestionListClassName:void 0,searchFn:async()=>[],onEnter:()=>{},onInput:()=>{},onSelect:()=>{},onClear:()=>{},noResultsText:"No results found",footerComponent:void 0},sB="style_module_visible__5be7493d",aB="style_module_hidden__acfb8431",lB="style_module_disabled__62c35dc5",cB="style_module_upwards__e0b4831b";!function(){try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode('@keyframes style_module_fadeIn__ffac87fd{0%{opacity:0}to{opacity:.2}}.style_module_displayState__6ae19b84{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--cosmograph-ui-text);display:flex;justify-content:center;align-items:center;min-width:100px;opacity:.2;font-size:calc(var(--cosmograph-ui-font-size) + 1px);letter-spacing:-.02em;font-weight:200;user-select:none;-webkit-user-select:none;animation:style_module_fadeIn__ffac87fd .3s ease-in-out}:root{--cosmograph-timeline-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-timeline-selection-opacity: .5;--cosmograph-timeline-bar-color: var(--cosmograph-ui-element-color);--cosmograph-timeline-highlighted-bar-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-timeline-font-family: var(--cosmograph-ui-font-family);--cosmograph-timeline-font-size: var(--cosmograph-ui-tick-font-size);--cosmograph-timeline-background: var(--cosmograph-ui-background);--cosmograph-timeline-text-color: var(--cosmograph-ui-text);--cosmograph-timeline-axis-color: var(--cosmograph-ui-text)}.style_module_timeline__736434f7{position:relative;display:flex;background:var(--cosmograph-timeline-background);width:100%;min-height:25px;overflow:hidden}.style_module_timelineSvg__b916ad04{position:relative;width:100%;height:100%}.style_module_selection__ebee57f8{fill:var(--cosmograph-timeline-selection-color);fill-opacity:var(--cosmograph-timeline-selection-opacity);stroke:none}.style_module_axisTick__5865631d{color:var(--cosmograph-timeline-axis-color);font:var(--cosmograph-timeline-font-family);font-size:var(--cosmograph-timeline-font-size);user-select:none;-webkit-user-select:none;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum";alignment-baseline:text-before-edge}.style_module_axisLine__992b502d{opacity:.2;color:var(--cosmograph-timeline-axis-color)}.style_module_bar__114fa79f{fill:var(--cosmograph-timeline-bar-color);transform:scaleY(-1);opacity:0}.style_module_animationControl__ee52cd66{color:var(--cosmograph-timeline-axis-color);width:6%;max-width:30px;min-width:20px;cursor:pointer;display:none;align-items:center;user-select:none;-webkit-user-select:none;opacity:.5;position:relative;justify-content:center}.style_module_animationControl__ee52cd66>svg{width:50%;max-height:20px;padding-right:2px}.style_module_hidden__a73fe81a{display:none}.style_module_disabled__eb988570{opacity:.2;pointer-events:none}.style_module_highlightedBar__c2fc9bdc{fill:var(--cosmograph-timeline-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-search-font-family: var(--cosmograph-ui-font-family);--cosmograph-search-font-size: 14px;--cosmograph-search-list-font-size: 13.5px;--cosmograph-search-text-color: var(--cosmograph-ui-text);--cosmograph-search-background: transparent;--cosmograph-search-list-background: rgba(0, 0, 0, .2);--cosmograph-search-list-match-background: rgba(255, 255, 255, .2);--cosmograph-search-list-match-color: var(--cosmograph-ui-text)}.style_module_searchInput__d7830601:hover{filter:brightness(1.2) contrast(1)}.style_module_searchInput__d7830601{width:100%;background:transparent;color:var(--cosmograph-search-text-color);border:none;border-bottom:.5px solid var(--cosmograph-search-text-color);padding:4px 20px 5px 2px;font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:opacity .2s ease-out}.style_module_searchInput__d7830601::selection{background:var(--cosmograph-search-list-match-background)}.style_module_searchInput__d7830601:focus{outline:none}.style_module_searchSuggestions__b0d3f71e{color:#fff;width:100%;padding:0;margin:0;background:transparent;overflow-y:auto;flex:1;min-height:0}.style_module_searchSuggestions__b0d3f71e li{padding:5px 10px;cursor:pointer;-webkit-user-select:none;user-select:none;display:block;font-weight:500;font-size:var(--cosmograph-search-list-font-size);max-width:100%;overflow:hidden}.style_module_searchSuggestions__b0d3f71e li>div{white-space:nowrap;font-weight:200;overflow:hidden;text-overflow:ellipsis;width:100%}.style_module_searchSuggestions__b0d3f71e li:hover{background:#ffffff1a}.style_module_searchSuggestions__b0d3f71e mark{background:var(--cosmograph-search-list-match-background);color:var(--cosmograph-search-list-match-color);border-radius:2px}.style_module_clearButton__5ebb41de{position:absolute;right:0;top:0;height:100%;background:none;border:none;color:var(--cosmograph-search-text-color);font-weight:300;cursor:pointer;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d{opacity:.7}.style_module_placeholderWrapper__72d5eb0e{z-index:1;color:var(--cosmograph-search-text-color);font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);position:absolute;top:0;left:0;width:100%;bottom:0;display:flex;line-height:1.25;align-items:center;transition:transform .3s ease-out,opacity .3s ease-out}.style_module_placeholderWrapper__72d5eb0e.style_module_hidden__acfb8431{transform:translate(-30px);pointer-events:none;opacity:0}.style_module_searchInput__d7830601:disabled,.style_module_searchInput__d7830601.style_module_disabled__62c35dc5{opacity:.2;cursor:not-allowed;pointer-events:none}.style_module_disabled__62c35dc5 .style_module_clearButton__5ebb41de{display:none}.style_module_disabled__62c35dc5 .style_module_placeholderWrapper__72d5eb0e{opacity:.3;cursor:not-allowed}.style_module_searchInputWrapper__1edbcb22{position:relative;display:flex;width:100%}.style_module_noResults__363397c3{opacity:.3!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none}.style_module_noResults__363397c3:hover{background:none}.style_module_loading__296e0212{opacity:.7!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none;-webkit-user-select:none;user-select:none}.style_module_dropdownContainer__d98287da{position:absolute;top:100%;left:0;width:100%;background:var(--cosmograph-search-list-background);border-radius:4px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);opacity:0;transform:translateY(-10px);transition:opacity .2s ease-out,transform .2s ease-out;pointer-events:none;overflow:hidden;z-index:10;display:flex;flex-direction:column;padding-bottom:2px}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b{top:auto;bottom:100%;transform:translateY(10px)}.style_module_dropdownContainer__d98287da.style_module_visible__5be7493d{opacity:1;transform:translateY(0);pointer-events:auto}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b.style_module_visible__5be7493d{opacity:1;transform:translateY(-2px);pointer-events:auto}.style_module_footerContainer__73e7a066{flex-shrink:0}:root{--cosmograph-scrollbar-background: rgba(255, 255, 255, .1);--cosmograph-ui-background: rgb(45, 49, 58);--cosmograph-ui-text: #ffffffc7;--cosmograph-ui-tick-font-size: 11px;--cosmograph-ui-font-size: 12px;--cosmograph-ui-font-family: inherit;--cosmograph-ui-element-color: #5C616A;--cosmograph-ui-highlighted-element-color: white;--cosmograph-ui-selection-control-color: #8d949ea8;-webkit-font-smoothing:antialiased!important;text-rendering:optimizeLegibility!important}.style_module_cosmograph-ui__5acb97f1{background:var(--cosmograph-ui-background);color:var(--cosmograph-ui-text)}.style_module_scrollbar__f1516254 *::-webkit-scrollbar{width:5px;height:5px;border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-track{border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-corner{background:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-button{display:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-thumb{background-color:var(--cosmograph-scrollbar-background);transition:background-color .5s;border-radius:20px;border:3px solid var(--cosmograph-scrollbar-background)}@-moz-document url-prefix(){.style_module_scrollbar__f1516254 *{scrollbar-width:thin;scrollbar-color:var(--cosmograph-scrollbar-background) transparent;scrollbar-track-color:transparent;scrollbar-face-color:var(--cosmograph-scrollbar-background)}}:root{--cosmograph-histogram-background: var(--cosmograph-ui-background);--cosmograph-histogram-text-color: var(--cosmograph-ui-text);--cosmograph-histogram-axis-color: var(--cosmograph-ui-text);--cosmograph-histogram-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-histogram-selection-opacity: .5;--cosmograph-histogram-bar-color: var(--cosmograph-ui-element-color);--cosmograph-histogram-highlighted-bar-color: var( --cosmograph-ui-highlighted-element-color);--cosmograph-histogram-font-family: var(--cosmograph-ui-font-family);--cosmograph-histogram-font-size: var(--cosmograph-ui-tick-font-size)}.style_module_histogram__9d8a77ea{position:relative;display:flex;min-height:25px;background:var(--cosmograph-histogram-background);width:100%}.style_module_histogramSvg__ccccb628{position:relative;width:100%;height:100%}.style_module_selection__7db96137{fill:var(--cosmograph-histogram-selection-color);fill-opacity:var(--cosmograph-histogram-selection-opacity);stroke:none}.style_module_axisTick__898e1f39{color:var(--cosmograph-histogram-axis-color);font-family:var(--cosmograph-histogram-font-family);font-size:var(--cosmograph-histogram-font-size);user-select:none;-webkit-user-select:none;alignment-baseline:text-before-edge;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum"}.style_module_bar__3c9ab488{fill:var(--cosmograph-histogram-bar-color);transform:scaleY(-1)}.style_module_highlightedBar__b193a8de{fill:var(--cosmograph-histogram-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-bars-font-color: var(--cosmograph-ui-text);--cosmograph-bars-font-family: var(--cosmograph-ui-font-family);--cosmograph-bars-font-size: var(--cosmograph-ui-font-size);--cosmograph-bars-ui-font-size: 11.5px;--cosmograph-bars-background: var(--cosmograph-ui-element-color);--cosmograph-bars-bar-height: 20px;--cosmograph-bars-bar-bottom-margin: 2px;--cosmograph-bars-highlighted-color: var( --cosmograph-ui-highlighted-element-color)}.style_module_bars__25497ded{position:relative;width:100%;min-height:100px;user-select:none;flex-direction:column;-webkit-user-select:none}.style_module_bars__25497ded .scroll-container{position:relative;width:100%;overflow-y:hidden;overflow-x:hidden}.style_module_bars__25497ded .bars-container{position:relative;width:calc(100% - 1px);font-family:var(--cosmograph-bars-font-family)}.style_module_bars__25497ded .highlighted-bars-container{position:absolute;top:0;left:0;pointer-events:none}.style_module_bars__25497ded .row{height:var(--cosmograph-bars-bar-height);display:flex;align-items:center;margin-bottom:var(--cosmograph-bars-bar-bottom-margin);width:100%;transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row:hover{filter:brightness(1.15) contrast(1.05);transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row.unselected:hover{filter:brightness(.95) contrast(1.15);transition:filter .05s linear}.style_module_bars__25497ded .unselected{opacity:.85;filter:brightness(.8) contrast(1.1)}.style_module_bars__25497ded .selected{filter:brightness(1.05) contrast(1.05)}.style_module_bars__25497ded .selected>.info>.label{font-weight:600;filter:brightness(1.1) contrast(1.05)}.style_module_bars__25497ded .unselected>.info>.label{font-weight:300}.style_module_bars__25497ded .bar{height:100%;background-color:var(--cosmograph-bars-background);opacity:.8;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .bar-highlighted{height:100%;background-color:var(--cosmograph-bars-highlighted-color);opacity:.2;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .info{display:flex;justify-content:space-between;width:100%;padding:0 4px;position:absolute;font-size:var(--cosmograph-bars-font-size);font-feature-settings:"tnum";color:var(--cosmograph-bars-font-color);gap:2px}.style_module_bars__25497ded .label{min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:opacity .05s linear}.style_module_bars__25497ded .count{flex-shrink:0;font-weight:300;opacity:.8;transition:opacity .05s linear}.style_module_bars__25497ded .show-more{cursor:pointer;padding-top:2px;display:flex;font-weight:300;color:var(--cosmograph-bars-font-color);font-size:11px;justify-content:space-between;opacity:.6;font-size:var(--cosmograph-bars-ui-font-size);pointer-events:none;transition:opacity .1s linear}.style_module_bars__25497ded .show-more:hover{opacity:1;text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .show-more>span{pointer-events:all}.style_module_bars__25497ded .show-more-count{padding-right:5px;pointer-events:all;font-feature-settings:"tnum"}.style_module_bars__25497ded .unselected>.info>.label,.style_module_bars__25497ded .unselected>.info>.count{opacity:.5}.style_module_bars__25497ded .unselected:hover>.info>.label,.style_module_bars__25497ded .unselected:hover>.info>.count{opacity:1}.style_module_bars__25497ded .search-input{background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,.3);font-size:13px!important;color:var(--cosmograph-bars-font-color);line-height:1.5;padding:2px;width:100%;position:relative;transition:border-bottom-color .2s}.style_module_bars__25497ded .search-input::placeholder{color:var(--cosmograph-bars-font-color)!important;opacity:.4;font-weight:300;font-family:inherit}.style_module_bars__25497ded .search-container{position:relative;width:100%;margin-bottom:4px;display:none;z-index:1}.style_module_bars__25497ded .clear-button{position:absolute;right:0;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--cosmograph-bars-font-color);font-weight:300;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_bars__25497ded .clear-button.visible:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_bars__25497ded .clear-button.visible{opacity:.7}.style_module_bars__25497ded .clear-button svg{width:10px;height:10px;fill:currentColor}.style_module_bars__25497ded .sorting-block{visibility:hidden;margin-top:1px;display:flex;justify-content:space-between}.style_module_bars__25497ded .buttons-container{margin-top:4px;font-size:var(--cosmograph-bars-ui-font-size);display:flex;gap:4px;line-height:1.25}.style_module_bars__25497ded .buttons-container>div{transition:opacity .05s linear,filter .05s linear;padding:1px 5px;background:var(--cosmograph-bars-background);border-radius:4px;opacity:.9;display:flex;cursor:pointer;align-items:center}.style_module_bars__25497ded .buttons-container>div:hover{filter:brightness(1.2)}.style_module_bars__25497ded .reset-text{transition:opacity .05s linear,filter .05s linear;display:flex;font-size:var(--cosmograph-bars-ui-font-size);align-items:end;padding-right:4px;cursor:pointer;font-weight:300}.style_module_bars__25497ded .reset-text:hover{text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .reset-text.unselected{pointer-events:none;cursor:default;opacity:.7}.style_module_bars__25497ded :scope.reset-text:hover:not(.unselected){filter:brightness(1.5);opacity:1}:root{--cosmograph-size-legend-form-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-family: inherit;--cosmograph-size-legend-font-size: var(--cosmograph-ui-font-size);--cosmograph-size-legend-sublabel-font-size: 10px;--cosmograph-size-legend-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-size-legend-line-radius: 2px;--cosmograph-size-legend-line-width: 30px;--cosmograph-size-legend-hide-transform: translateY(100%);--cosmograph-size-legend-show-transform: translateX(0)}.style_module_container__d2889234{display:flex;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;overflow:hidden;min-height:25px}.style_module_legend__75c167f2{width:auto;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-size-legend-font-size);font-family:var(--cosmograph-size-legend-font-family);user-select:none;-webkit-user-select:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.04em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__91eae57a{opacity:1;transform:var(--cosmograph-size-legend-show-transform)}.style_module_disabled__d51f7a10{opacity:0;transform:var(--cosmograph-size-legend-hide-transform);pointer-events:none;display:none!important;min-height:0}@starting-style{.style_module_container__d2889234.style_module_enabled__91eae57a,.style_module_legend__75c167f2.style_module_enabled__91eae57a{opacity:0;transform:var(--cosmograph-size-legend-hide-transform)}}.style_module_legend__75c167f2 .circle{background-color:var(--cosmograph-size-legend-form-color);border-radius:50%;transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2 .line{background-color:var(--cosmograph-size-legend-form-color);border-radius:var(--cosmograph-size-legend-line-radius);width:var(--cosmograph-size-legend-line-width);transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2.style_module_events__894316a8{pointer-events:auto;cursor:pointer}.style_module_legend__75c167f2 .legend-content{display:flex;align-items:end;justify-content:center;gap:.75rem}.style_module_legend__75c167f2 .legend-content>div{transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__75c167f2 .labels-wrapper{white-space:nowrap}.style_module_legend__75c167f2 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-size-legend-items-margin)}.style_module_legend__75c167f2 .name{align-items:center;text-align:center;justify-content:center;display:flex;color:var(--cosmograph-size-legend-font-color);overflow:hidden;width:100%;margin-top:3px;word-break:break-all;white-space:pre-line;transition:color .15s ease-in-out;letter-spacing:-.02em}.style_module_legend__75c167f2 .label{color:var(--cosmograph-size-legend-font-color);overflow:hidden;transition:color .15s ease-in-out;text-overflow:ellipsis;font-feature-settings:"tnum"}.style_module_legend__75c167f2 .sublabel{padding-top:1px;font-size:var(--cosmograph-size-legend-sublabel-font-size);opacity:.5;line-height:1;min-width:10px;transition:color .15s ease-in-out}.style_module_hovered__1206707f .label,.style_module_hovered__1206707f .sublabel{color:var(--cosmograph-size-legend-hover-color);cursor:pointer}.style_module_hovered__1206707f .circle,.style_module_hovered__1206707f .line{background-color:var(--cosmograph-size-legend-hover-color);cursor:pointer}:root{--cosmograph-color-legend-range-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-range-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-range-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-label-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-sublabel-font-size: 10px;--cosmograph-color-legend-range-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-range-gradient-height: 6px;--cosmograph-color-legend-range-gradient-radius: 8px;--cosmograph-color-legend-range-gradient-top-margin: 6px;--cosmograph-color-legend-hide-transform: translateY(100%);--cosmograph-color-legend-show-transform: translateX(0)}.style_module_container__05cc807d{display:flex;min-width:150px;min-height:25px;width:100%;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_legend__a3e235e4{width:100%;font-weight:300;letter-spacing:-.04em;display:flex;flex-direction:column;font-size:var(--cosmograph-color-legend-range-font-size);font-family:var(--cosmograph-color-legend-range-font-family);user-select:none;-webkit-user-select:none;pointer-events:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__b3120e27{opacity:1;transform:var(--cosmograph-color-legend-show-transform);pointer-events:auto}.style_module_disabled__c2dc158c{opacity:0;transform:var(--cosmograph-color-legend-hide-transform);pointer-events:none;display:none;min-height:0}@starting-style{.style_module_container__05cc807d.style_module_enabled__b3120e27,.style_module_legend__a3e235e4.style_module_enabled__b3120e27{opacity:0;transform:var(--cosmograph-color-legend-hide-transform)}}.style_module_legend__a3e235e4 .legend-content{display:flex;align-items:end;justify-content:space-between}.style_module_hovered__dfd7bb2c .label,.style_module_hovered__dfd7bb2c .sublabel{color:var(--cosmograph-size-legend-hover-color)!important;cursor:pointer}.style_module_legend__a3e235e4 .extent{white-space:nowrap;transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__a3e235e4 .gradient{width:100%;margin-top:var(--cosmograph-color-legend-range-gradient-top-margin);height:var(--cosmograph-color-legend-range-gradient-height);border-radius:var(--cosmograph-color-legend-range-gradient-radius)}.style_module_legend__a3e235e4 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-color-legend-range-items-margin)}.style_module_legend__a3e235e4 .name{align-items:center;text-align:center;justify-content:space-around;display:flex;color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;width:100%;word-break:break-word;text-wrap:balance;white-space:pre-line;transition:color .15s ease-in-out;margin:0 4px;letter-spacing:-.02em;line-height:1.25}.style_module_legend__a3e235e4 .label{color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;max-width:150px;text-overflow:ellipsis;font-size:var(--cosmograph-color-legend-range-label-font-size);transition:color .15s ease-in-out;line-height:1;font-feature-settings:"tnum"}.style_module_legend__a3e235e4 .sublabel{padding-top:1px;color:var(--cosmograph-color-legend-range-font-color);opacity:.55;font-size:var(--cosmograph-color-legend-range-sublabel-font-size);line-height:1;transition:color .15s ease-in-out}:root{--cosmograph-color-legend-type-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-type-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-type-font-size: 11px;--cosmograph-color-legend-type-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-type-others-color: #bab0ab;--cosmograph-color-legend-type-bullet-size: 8px;--cosmograph-color-legend-type-bullet-radius: 1rem;--cosmograph-color-legend-type-items-margin: 4px;--cosmograph-color-legend-type-hide-transform: translateY(125%);--cosmograph-color-legend-type-show-transform: translateX(0)}.style_module_enabled__277b2403{opacity:1;transform:var(--cosmograph-color-legend-type-show-transform)}.style_module_disabled__7a587f96{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform);display:none!important;min-height:0}.style_module_wrapper__ea8ca7f4{position:relative;max-width:100%;width:fit-content;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_typeLegend__15bf4b2f{position:relative;width:fit-content;max-width:100%;min-height:25px;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.015em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_typeLegend__15bf4b2f .reverted{flex-direction:row-reverse}.style_module_typeLegend__15bf4b2f .scroll-container{width:100%;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-color-legend-type-font-size);font-family:var(--cosmograph-color-legend-type-font-family);user-select:none;-webkit-user-select:none;line-height:normal;overflow-x:hidden;overflow-y:auto;will-change:transform}@starting-style{.style_module_typeLegend__15bf4b2f.style_module_enabled__277b2403,.style_module_wrapper__ea8ca7f4.style_module_enabled__277b2403{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform)}}.style_module_typeLegend__15bf4b2f .legend-item{display:flex;align-items:center;position:absolute;margin-bottom:var(--cosmograph-color-legend-type-items-margin);pointer-events:none;width:100%;padding-left:1px;font-weight:300;transition:filter .1s ease-in-out,opacity .1s ease-in-out;min-height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px + var(--cosmograph-color-legend-type-items-margin));height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px);box-sizing:border-box}.style_module_typeLegend__15bf4b2f .unknown{background-color:var(--cosmograph-color-legend-type-unknown-color)}.style_module_typeLegend__15bf4b2f .others{background-color:var(--cosmograph-color-legend-type-others-color)}.style_module_typeLegend__15bf4b2f .bullet{height:var(--cosmograph-color-legend-type-bullet-size);width:var(--cosmograph-color-legend-type-bullet-size);min-height:var(--cosmograph-color-legend-type-bullet-size);min-width:var(--cosmograph-color-legend-type-bullet-size);border-radius:var(--cosmograph-color-legend-type-bullet-radius);pointer-events:all;margin-right:5px}.style_module_typeLegend__15bf4b2f .label{color:var(--cosmograph-color-legend-type-font-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - var(--cosmograph-color-legend-type-bullet-size) - 5px);pointer-events:all;transition:.05s linear color}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.bullet{margin-right:0}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.label{margin-right:5px}.style_module_typeLegend__15bf4b2f .show-more{cursor:pointer;padding-top:4px;display:none;font-weight:300;color:var(--cosmograph-color-legend-type-font-color);font-size:11px;opacity:.6;pointer-events:all;justify-content:space-between;transition:opacity .1s linear;font-feature-settings:"tnum"}.style_module_typeLegend__15bf4b2f .show-more:hover{opacity:1}.style_module_hovered__c0993502 .label,.style_module_hovered__c0993502 .sublabel{color:var(--cosmograph-color-legend-type-hover-color)!important;cursor:pointer}.style_module_selected__36e1dd81{filter:brightness(1)}.style_module_selected__36e1dd81>.style_module_label__afecc7a3{filter:brightness(1.2)}.style_module_unselected__4826cfb7{filter:brightness(.5)}.style_module_typeLegend__15bf4b2f .name{font-size:calc(var(--cosmograph-color-legend-type-font-size) + 1px);font-family:var(--cosmograph-color-legend-type-font-family);color:var(--cosmograph-color-legend-type-font-color);transition:color .15s ease-in-out,opacity .3s ease-in-out,max-height .3s ease-in-out,transform .3s ease-in-out;margin-bottom:4px;margin-top:2px;margin-left:1px;letter-spacing:-.02em;line-height:1.25;overflow:hidden;width:100%;white-space:nowrap;text-overflow:ellipsis;pointer-events:all;-webkit-user-select:none!important;user-select:none!important;max-height:100px;opacity:1;transform:translateY(0)}.style_module_typeLegend__15bf4b2f .name.hidden{opacity:0;max-height:0;margin-bottom:0;margin-top:0;transform:translateY(-10px)}:root{--cosmograph-button-color: var(--cosmograph-ui-text);--cosmograph-button-background: var(--cosmograph-ui-element-color);--cosmograph-button-border-radius: 2px}.style_module_button__e95a1138{background:var(--cosmograph-button-background);color:var(--cosmograph-button-color);border-radius:var(--cosmograph-button-border-radius);display:none;align-items:center;justify-content:center;width:25px;height:25px;margin:3px;padding:5px;cursor:pointer;filter:brightness(.95) contrast(.9);transition:filter .1s}.style_module_button__e95a1138:hover{filter:brightness(1.2) contrast(1)}')),document.head.appendChild(e)}}catch(_C){console.error("vite-plugin-css-injected-by-js",_C)}}();const uB="style_module_scrollbar__f1516254";!function(){try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode('@keyframes style_module_fadeIn__ffac87fd{0%{opacity:0}to{opacity:.2}}.style_module_displayState__6ae19b84{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--cosmograph-ui-text);display:flex;justify-content:center;align-items:center;min-width:100px;opacity:.2;font-size:calc(var(--cosmograph-ui-font-size) + 1px);letter-spacing:-.02em;font-weight:200;user-select:none;-webkit-user-select:none;animation:style_module_fadeIn__ffac87fd .3s ease-in-out}:root{--cosmograph-timeline-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-timeline-selection-opacity: .5;--cosmograph-timeline-bar-color: var(--cosmograph-ui-element-color);--cosmograph-timeline-highlighted-bar-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-timeline-font-family: var(--cosmograph-ui-font-family);--cosmograph-timeline-font-size: var(--cosmograph-ui-tick-font-size);--cosmograph-timeline-background: var(--cosmograph-ui-background);--cosmograph-timeline-text-color: var(--cosmograph-ui-text);--cosmograph-timeline-axis-color: var(--cosmograph-ui-text)}.style_module_timeline__736434f7{position:relative;display:flex;background:var(--cosmograph-timeline-background);width:100%;min-height:25px;overflow:hidden}.style_module_timelineSvg__b916ad04{position:relative;width:100%;height:100%}.style_module_selection__ebee57f8{fill:var(--cosmograph-timeline-selection-color);fill-opacity:var(--cosmograph-timeline-selection-opacity);stroke:none}.style_module_axisTick__5865631d{color:var(--cosmograph-timeline-axis-color);font:var(--cosmograph-timeline-font-family);font-size:var(--cosmograph-timeline-font-size);user-select:none;-webkit-user-select:none;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum";alignment-baseline:text-before-edge}.style_module_axisLine__992b502d{opacity:.2;color:var(--cosmograph-timeline-axis-color)}.style_module_bar__114fa79f{fill:var(--cosmograph-timeline-bar-color);transform:scaleY(-1);opacity:0}.style_module_animationControl__ee52cd66{color:var(--cosmograph-timeline-axis-color);width:6%;max-width:30px;min-width:20px;cursor:pointer;display:none;align-items:center;user-select:none;-webkit-user-select:none;opacity:.5;position:relative;justify-content:center}.style_module_animationControl__ee52cd66>svg{width:50%;max-height:20px;padding-right:2px}.style_module_hidden__a73fe81a{display:none}.style_module_disabled__eb988570{opacity:.2;pointer-events:none}.style_module_highlightedBar__c2fc9bdc{fill:var(--cosmograph-timeline-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-search-font-family: var(--cosmograph-ui-font-family);--cosmograph-search-font-size: 14px;--cosmograph-search-list-font-size: 13.5px;--cosmograph-search-text-color: var(--cosmograph-ui-text);--cosmograph-search-background: transparent;--cosmograph-search-list-background: rgba(0, 0, 0, .2);--cosmograph-search-list-match-background: rgba(255, 255, 255, .2);--cosmograph-search-list-match-color: var(--cosmograph-ui-text)}.style_module_searchInput__d7830601:hover{filter:brightness(1.2) contrast(1)}.style_module_searchInput__d7830601{width:100%;background:transparent;color:var(--cosmograph-search-text-color);border:none;border-bottom:.5px solid var(--cosmograph-search-text-color);padding:4px 20px 5px 2px;font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:opacity .2s ease-out}.style_module_searchInput__d7830601::selection{background:var(--cosmograph-search-list-match-background)}.style_module_searchInput__d7830601:focus{outline:none}.style_module_searchSuggestions__b0d3f71e{color:#fff;width:100%;padding:0;margin:0;background:transparent;overflow-y:auto;flex:1;min-height:0}.style_module_searchSuggestions__b0d3f71e li{padding:5px 10px;cursor:pointer;-webkit-user-select:none;user-select:none;display:block;font-weight:500;font-size:var(--cosmograph-search-list-font-size);max-width:100%;overflow:hidden}.style_module_searchSuggestions__b0d3f71e li>div{white-space:nowrap;font-weight:200;overflow:hidden;text-overflow:ellipsis;width:100%}.style_module_searchSuggestions__b0d3f71e li:hover{background:#ffffff1a}.style_module_searchSuggestions__b0d3f71e mark{background:var(--cosmograph-search-list-match-background);color:var(--cosmograph-search-list-match-color);border-radius:2px}.style_module_clearButton__5ebb41de{position:absolute;right:0;top:0;height:100%;background:none;border:none;color:var(--cosmograph-search-text-color);font-weight:300;cursor:pointer;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d{opacity:.7}.style_module_placeholderWrapper__72d5eb0e{z-index:1;color:var(--cosmograph-search-text-color);font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);position:absolute;top:0;left:0;width:100%;bottom:0;display:flex;line-height:1.25;align-items:center;transition:transform .3s ease-out,opacity .3s ease-out}.style_module_placeholderWrapper__72d5eb0e.style_module_hidden__acfb8431{transform:translate(-30px);pointer-events:none;opacity:0}.style_module_searchInput__d7830601:disabled,.style_module_searchInput__d7830601.style_module_disabled__62c35dc5{opacity:.2;cursor:not-allowed;pointer-events:none}.style_module_disabled__62c35dc5 .style_module_clearButton__5ebb41de{display:none}.style_module_disabled__62c35dc5 .style_module_placeholderWrapper__72d5eb0e{opacity:.3;cursor:not-allowed}.style_module_searchInputWrapper__1edbcb22{position:relative;display:flex;width:100%}.style_module_noResults__363397c3{opacity:.3!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none}.style_module_noResults__363397c3:hover{background:none}.style_module_loading__296e0212{opacity:.7!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none;-webkit-user-select:none;user-select:none}.style_module_dropdownContainer__d98287da{position:absolute;top:100%;left:0;width:100%;background:var(--cosmograph-search-list-background);border-radius:4px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);opacity:0;transform:translateY(-10px);transition:opacity .2s ease-out,transform .2s ease-out;pointer-events:none;overflow:hidden;z-index:10;display:flex;flex-direction:column;padding-bottom:2px}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b{top:auto;bottom:100%;transform:translateY(10px)}.style_module_dropdownContainer__d98287da.style_module_visible__5be7493d{opacity:1;transform:translateY(0);pointer-events:auto}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b.style_module_visible__5be7493d{opacity:1;transform:translateY(-2px);pointer-events:auto}.style_module_footerContainer__73e7a066{flex-shrink:0}:root{--cosmograph-scrollbar-background: rgba(255, 255, 255, .1);--cosmograph-ui-background: rgb(45, 49, 58);--cosmograph-ui-text: #ffffffc7;--cosmograph-ui-tick-font-size: 11px;--cosmograph-ui-font-size: 12px;--cosmograph-ui-font-family: inherit;--cosmograph-ui-element-color: #5C616A;--cosmograph-ui-highlighted-element-color: white;--cosmograph-ui-selection-control-color: #8d949ea8;-webkit-font-smoothing:antialiased!important;text-rendering:optimizeLegibility!important}.style_module_cosmograph-ui__5acb97f1{background:var(--cosmograph-ui-background);color:var(--cosmograph-ui-text)}.style_module_scrollbar__f1516254 *::-webkit-scrollbar{width:5px;height:5px;border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-track{border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-corner{background:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-button{display:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-thumb{background-color:var(--cosmograph-scrollbar-background);transition:background-color .5s;border-radius:20px;border:3px solid var(--cosmograph-scrollbar-background)}@-moz-document url-prefix(){.style_module_scrollbar__f1516254 *{scrollbar-width:thin;scrollbar-color:var(--cosmograph-scrollbar-background) transparent;scrollbar-track-color:transparent;scrollbar-face-color:var(--cosmograph-scrollbar-background)}}:root{--cosmograph-histogram-background: var(--cosmograph-ui-background);--cosmograph-histogram-text-color: var(--cosmograph-ui-text);--cosmograph-histogram-axis-color: var(--cosmograph-ui-text);--cosmograph-histogram-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-histogram-selection-opacity: .5;--cosmograph-histogram-bar-color: var(--cosmograph-ui-element-color);--cosmograph-histogram-highlighted-bar-color: var( --cosmograph-ui-highlighted-element-color);--cosmograph-histogram-font-family: var(--cosmograph-ui-font-family);--cosmograph-histogram-font-size: var(--cosmograph-ui-tick-font-size)}.style_module_histogram__9d8a77ea{position:relative;display:flex;min-height:25px;background:var(--cosmograph-histogram-background);width:100%}.style_module_histogramSvg__ccccb628{position:relative;width:100%;height:100%}.style_module_selection__7db96137{fill:var(--cosmograph-histogram-selection-color);fill-opacity:var(--cosmograph-histogram-selection-opacity);stroke:none}.style_module_axisTick__898e1f39{color:var(--cosmograph-histogram-axis-color);font-family:var(--cosmograph-histogram-font-family);font-size:var(--cosmograph-histogram-font-size);user-select:none;-webkit-user-select:none;alignment-baseline:text-before-edge;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum"}.style_module_bar__3c9ab488{fill:var(--cosmograph-histogram-bar-color);transform:scaleY(-1)}.style_module_highlightedBar__b193a8de{fill:var(--cosmograph-histogram-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-bars-font-color: var(--cosmograph-ui-text);--cosmograph-bars-font-family: var(--cosmograph-ui-font-family);--cosmograph-bars-font-size: var(--cosmograph-ui-font-size);--cosmograph-bars-ui-font-size: 11.5px;--cosmograph-bars-background: var(--cosmograph-ui-element-color);--cosmograph-bars-bar-height: 20px;--cosmograph-bars-bar-bottom-margin: 2px;--cosmograph-bars-highlighted-color: var( --cosmograph-ui-highlighted-element-color)}.style_module_bars__25497ded{position:relative;width:100%;min-height:100px;user-select:none;flex-direction:column;-webkit-user-select:none}.style_module_bars__25497ded .scroll-container{position:relative;width:100%;overflow-y:hidden;overflow-x:hidden}.style_module_bars__25497ded .bars-container{position:relative;width:calc(100% - 1px);font-family:var(--cosmograph-bars-font-family)}.style_module_bars__25497ded .highlighted-bars-container{position:absolute;top:0;left:0;pointer-events:none}.style_module_bars__25497ded .row{height:var(--cosmograph-bars-bar-height);display:flex;align-items:center;margin-bottom:var(--cosmograph-bars-bar-bottom-margin);width:100%;transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row:hover{filter:brightness(1.15) contrast(1.05);transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row.unselected:hover{filter:brightness(.95) contrast(1.15);transition:filter .05s linear}.style_module_bars__25497ded .unselected{opacity:.85;filter:brightness(.8) contrast(1.1)}.style_module_bars__25497ded .selected{filter:brightness(1.05) contrast(1.05)}.style_module_bars__25497ded .selected>.info>.label{font-weight:600;filter:brightness(1.1) contrast(1.05)}.style_module_bars__25497ded .unselected>.info>.label{font-weight:300}.style_module_bars__25497ded .bar{height:100%;background-color:var(--cosmograph-bars-background);opacity:.8;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .bar-highlighted{height:100%;background-color:var(--cosmograph-bars-highlighted-color);opacity:.2;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .info{display:flex;justify-content:space-between;width:100%;padding:0 4px;position:absolute;font-size:var(--cosmograph-bars-font-size);font-feature-settings:"tnum";color:var(--cosmograph-bars-font-color);gap:2px}.style_module_bars__25497ded .label{min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:opacity .05s linear}.style_module_bars__25497ded .count{flex-shrink:0;font-weight:300;opacity:.8;transition:opacity .05s linear}.style_module_bars__25497ded .show-more{cursor:pointer;padding-top:2px;display:flex;font-weight:300;color:var(--cosmograph-bars-font-color);font-size:11px;justify-content:space-between;opacity:.6;font-size:var(--cosmograph-bars-ui-font-size);pointer-events:none;transition:opacity .1s linear}.style_module_bars__25497ded .show-more:hover{opacity:1;text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .show-more>span{pointer-events:all}.style_module_bars__25497ded .show-more-count{padding-right:5px;pointer-events:all;font-feature-settings:"tnum"}.style_module_bars__25497ded .unselected>.info>.label,.style_module_bars__25497ded .unselected>.info>.count{opacity:.5}.style_module_bars__25497ded .unselected:hover>.info>.label,.style_module_bars__25497ded .unselected:hover>.info>.count{opacity:1}.style_module_bars__25497ded .search-input{background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,.3);font-size:13px!important;color:var(--cosmograph-bars-font-color);line-height:1.5;padding:2px;width:100%;position:relative;transition:border-bottom-color .2s}.style_module_bars__25497ded .search-input::placeholder{color:var(--cosmograph-bars-font-color)!important;opacity:.4;font-weight:300;font-family:inherit}.style_module_bars__25497ded .search-container{position:relative;width:100%;margin-bottom:4px;display:none;z-index:1}.style_module_bars__25497ded .clear-button{position:absolute;right:0;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--cosmograph-bars-font-color);font-weight:300;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_bars__25497ded .clear-button.visible:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_bars__25497ded .clear-button.visible{opacity:.7}.style_module_bars__25497ded .clear-button svg{width:10px;height:10px;fill:currentColor}.style_module_bars__25497ded .sorting-block{visibility:hidden;margin-top:1px;display:flex;justify-content:space-between}.style_module_bars__25497ded .buttons-container{margin-top:4px;font-size:var(--cosmograph-bars-ui-font-size);display:flex;gap:4px;line-height:1.25}.style_module_bars__25497ded .buttons-container>div{transition:opacity .05s linear,filter .05s linear;padding:1px 5px;background:var(--cosmograph-bars-background);border-radius:4px;opacity:.9;display:flex;cursor:pointer;align-items:center}.style_module_bars__25497ded .buttons-container>div:hover{filter:brightness(1.2)}.style_module_bars__25497ded .reset-text{transition:opacity .05s linear,filter .05s linear;display:flex;font-size:var(--cosmograph-bars-ui-font-size);align-items:end;padding-right:4px;cursor:pointer;font-weight:300}.style_module_bars__25497ded .reset-text:hover{text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .reset-text.unselected{pointer-events:none;cursor:default;opacity:.7}.style_module_bars__25497ded :scope.reset-text:hover:not(.unselected){filter:brightness(1.5);opacity:1}:root{--cosmograph-size-legend-form-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-family: inherit;--cosmograph-size-legend-font-size: var(--cosmograph-ui-font-size);--cosmograph-size-legend-sublabel-font-size: 10px;--cosmograph-size-legend-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-size-legend-line-radius: 2px;--cosmograph-size-legend-line-width: 30px;--cosmograph-size-legend-hide-transform: translateY(100%);--cosmograph-size-legend-show-transform: translateX(0)}.style_module_container__d2889234{display:flex;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;overflow:hidden;min-height:25px}.style_module_legend__75c167f2{width:auto;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-size-legend-font-size);font-family:var(--cosmograph-size-legend-font-family);user-select:none;-webkit-user-select:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.04em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__91eae57a{opacity:1;transform:var(--cosmograph-size-legend-show-transform)}.style_module_disabled__d51f7a10{opacity:0;transform:var(--cosmograph-size-legend-hide-transform);pointer-events:none;display:none!important;min-height:0}@starting-style{.style_module_container__d2889234.style_module_enabled__91eae57a,.style_module_legend__75c167f2.style_module_enabled__91eae57a{opacity:0;transform:var(--cosmograph-size-legend-hide-transform)}}.style_module_legend__75c167f2 .circle{background-color:var(--cosmograph-size-legend-form-color);border-radius:50%;transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2 .line{background-color:var(--cosmograph-size-legend-form-color);border-radius:var(--cosmograph-size-legend-line-radius);width:var(--cosmograph-size-legend-line-width);transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2.style_module_events__894316a8{pointer-events:auto;cursor:pointer}.style_module_legend__75c167f2 .legend-content{display:flex;align-items:end;justify-content:center;gap:.75rem}.style_module_legend__75c167f2 .legend-content>div{transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__75c167f2 .labels-wrapper{white-space:nowrap}.style_module_legend__75c167f2 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-size-legend-items-margin)}.style_module_legend__75c167f2 .name{align-items:center;text-align:center;justify-content:center;display:flex;color:var(--cosmograph-size-legend-font-color);overflow:hidden;width:100%;margin-top:3px;word-break:break-all;white-space:pre-line;transition:color .15s ease-in-out;letter-spacing:-.02em}.style_module_legend__75c167f2 .label{color:var(--cosmograph-size-legend-font-color);overflow:hidden;transition:color .15s ease-in-out;text-overflow:ellipsis;font-feature-settings:"tnum"}.style_module_legend__75c167f2 .sublabel{padding-top:1px;font-size:var(--cosmograph-size-legend-sublabel-font-size);opacity:.5;line-height:1;min-width:10px;transition:color .15s ease-in-out}.style_module_hovered__1206707f .label,.style_module_hovered__1206707f .sublabel{color:var(--cosmograph-size-legend-hover-color);cursor:pointer}.style_module_hovered__1206707f .circle,.style_module_hovered__1206707f .line{background-color:var(--cosmograph-size-legend-hover-color);cursor:pointer}:root{--cosmograph-color-legend-range-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-range-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-range-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-label-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-sublabel-font-size: 10px;--cosmograph-color-legend-range-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-range-gradient-height: 6px;--cosmograph-color-legend-range-gradient-radius: 8px;--cosmograph-color-legend-range-gradient-top-margin: 6px;--cosmograph-color-legend-hide-transform: translateY(100%);--cosmograph-color-legend-show-transform: translateX(0)}.style_module_container__05cc807d{display:flex;min-width:150px;min-height:25px;width:100%;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_legend__a3e235e4{width:100%;font-weight:300;letter-spacing:-.04em;display:flex;flex-direction:column;font-size:var(--cosmograph-color-legend-range-font-size);font-family:var(--cosmograph-color-legend-range-font-family);user-select:none;-webkit-user-select:none;pointer-events:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__b3120e27{opacity:1;transform:var(--cosmograph-color-legend-show-transform);pointer-events:auto}.style_module_disabled__c2dc158c{opacity:0;transform:var(--cosmograph-color-legend-hide-transform);pointer-events:none;display:none;min-height:0}@starting-style{.style_module_container__05cc807d.style_module_enabled__b3120e27,.style_module_legend__a3e235e4.style_module_enabled__b3120e27{opacity:0;transform:var(--cosmograph-color-legend-hide-transform)}}.style_module_legend__a3e235e4 .legend-content{display:flex;align-items:end;justify-content:space-between}.style_module_hovered__dfd7bb2c .label,.style_module_hovered__dfd7bb2c .sublabel{color:var(--cosmograph-size-legend-hover-color)!important;cursor:pointer}.style_module_legend__a3e235e4 .extent{white-space:nowrap;transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__a3e235e4 .gradient{width:100%;margin-top:var(--cosmograph-color-legend-range-gradient-top-margin);height:var(--cosmograph-color-legend-range-gradient-height);border-radius:var(--cosmograph-color-legend-range-gradient-radius)}.style_module_legend__a3e235e4 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-color-legend-range-items-margin)}.style_module_legend__a3e235e4 .name{align-items:center;text-align:center;justify-content:space-around;display:flex;color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;width:100%;word-break:break-word;text-wrap:balance;white-space:pre-line;transition:color .15s ease-in-out;margin:0 4px;letter-spacing:-.02em;line-height:1.25}.style_module_legend__a3e235e4 .label{color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;max-width:150px;text-overflow:ellipsis;font-size:var(--cosmograph-color-legend-range-label-font-size);transition:color .15s ease-in-out;line-height:1;font-feature-settings:"tnum"}.style_module_legend__a3e235e4 .sublabel{padding-top:1px;color:var(--cosmograph-color-legend-range-font-color);opacity:.55;font-size:var(--cosmograph-color-legend-range-sublabel-font-size);line-height:1;transition:color .15s ease-in-out}:root{--cosmograph-color-legend-type-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-type-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-type-font-size: 11px;--cosmograph-color-legend-type-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-type-others-color: #bab0ab;--cosmograph-color-legend-type-bullet-size: 8px;--cosmograph-color-legend-type-bullet-radius: 1rem;--cosmograph-color-legend-type-items-margin: 4px;--cosmograph-color-legend-type-hide-transform: translateY(125%);--cosmograph-color-legend-type-show-transform: translateX(0)}.style_module_enabled__277b2403{opacity:1;transform:var(--cosmograph-color-legend-type-show-transform)}.style_module_disabled__7a587f96{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform);display:none!important;min-height:0}.style_module_wrapper__ea8ca7f4{position:relative;max-width:100%;width:fit-content;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_typeLegend__15bf4b2f{position:relative;width:fit-content;max-width:100%;min-height:25px;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.015em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_typeLegend__15bf4b2f .reverted{flex-direction:row-reverse}.style_module_typeLegend__15bf4b2f .scroll-container{width:100%;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-color-legend-type-font-size);font-family:var(--cosmograph-color-legend-type-font-family);user-select:none;-webkit-user-select:none;line-height:normal;overflow-x:hidden;overflow-y:auto;will-change:transform}@starting-style{.style_module_typeLegend__15bf4b2f.style_module_enabled__277b2403,.style_module_wrapper__ea8ca7f4.style_module_enabled__277b2403{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform)}}.style_module_typeLegend__15bf4b2f .legend-item{display:flex;align-items:center;position:absolute;margin-bottom:var(--cosmograph-color-legend-type-items-margin);pointer-events:none;width:100%;padding-left:1px;font-weight:300;transition:filter .1s ease-in-out,opacity .1s ease-in-out;min-height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px + var(--cosmograph-color-legend-type-items-margin));height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px);box-sizing:border-box}.style_module_typeLegend__15bf4b2f .unknown{background-color:var(--cosmograph-color-legend-type-unknown-color)}.style_module_typeLegend__15bf4b2f .others{background-color:var(--cosmograph-color-legend-type-others-color)}.style_module_typeLegend__15bf4b2f .bullet{height:var(--cosmograph-color-legend-type-bullet-size);width:var(--cosmograph-color-legend-type-bullet-size);min-height:var(--cosmograph-color-legend-type-bullet-size);min-width:var(--cosmograph-color-legend-type-bullet-size);border-radius:var(--cosmograph-color-legend-type-bullet-radius);pointer-events:all;margin-right:5px}.style_module_typeLegend__15bf4b2f .label{color:var(--cosmograph-color-legend-type-font-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - var(--cosmograph-color-legend-type-bullet-size) - 5px);pointer-events:all;transition:.05s linear color}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.bullet{margin-right:0}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.label{margin-right:5px}.style_module_typeLegend__15bf4b2f .show-more{cursor:pointer;padding-top:4px;display:none;font-weight:300;color:var(--cosmograph-color-legend-type-font-color);font-size:11px;opacity:.6;pointer-events:all;justify-content:space-between;transition:opacity .1s linear;font-feature-settings:"tnum"}.style_module_typeLegend__15bf4b2f .show-more:hover{opacity:1}.style_module_hovered__c0993502 .label,.style_module_hovered__c0993502 .sublabel{color:var(--cosmograph-color-legend-type-hover-color)!important;cursor:pointer}.style_module_selected__36e1dd81{filter:brightness(1)}.style_module_selected__36e1dd81>.style_module_label__afecc7a3{filter:brightness(1.2)}.style_module_unselected__4826cfb7{filter:brightness(.5)}.style_module_typeLegend__15bf4b2f .name{font-size:calc(var(--cosmograph-color-legend-type-font-size) + 1px);font-family:var(--cosmograph-color-legend-type-font-family);color:var(--cosmograph-color-legend-type-font-color);transition:color .15s ease-in-out,opacity .3s ease-in-out,max-height .3s ease-in-out,transform .3s ease-in-out;margin-bottom:4px;margin-top:2px;margin-left:1px;letter-spacing:-.02em;line-height:1.25;overflow:hidden;width:100%;white-space:nowrap;text-overflow:ellipsis;pointer-events:all;-webkit-user-select:none!important;user-select:none!important;max-height:100px;opacity:1;transform:translateY(0)}.style_module_typeLegend__15bf4b2f .name.hidden{opacity:0;max-height:0;margin-bottom:0;margin-top:0;transform:translateY(-10px)}:root{--cosmograph-button-color: var(--cosmograph-ui-text);--cosmograph-button-background: var(--cosmograph-ui-element-color);--cosmograph-button-border-radius: 2px}.style_module_button__e95a1138{background:var(--cosmograph-button-background);color:var(--cosmograph-button-color);border-radius:var(--cosmograph-button-border-radius);display:none;align-items:center;justify-content:center;width:25px;height:25px;margin:3px;padding:5px;cursor:pointer;filter:brightness(.95) contrast(.9);transition:filter .1s}.style_module_button__e95a1138:hover{filter:brightness(1.2) contrast(1)}')),document.head.appendChild(e)}}catch(_C){console.error("vite-plugin-css-injected-by-js",_C)}}();var hB=Object.defineProperty,dB=(e,t,n)=>((e,t,n)=>t in e?hB(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);let pB=class{constructor(e,t){dB(this,"_container"),dB(this,"_inputElement"),dB(this,"_suggestionList"),dB(this,"_dropdownContainer"),dB(this,"_footerContainer",null),dB(this,"_clearButton"),dB(this,"_config"),dB(this,"_debounceTimeout"),dB(this,"_placeholderElement",null),dB(this,"_handleFocus"),dB(this,"_handleBlur"),dB(this,"_handleClearClick"),dB(this,"_handleMouseDown"),this._container=e,this._container.classList.add(uB),this._config=IO(rB,t??{});const n=document.createElement("div");n.className="style_module_searchInputWrapper__1edbcb22",this._container.appendChild(n),this._inputElement=document.createElement("input"),this._inputElement.className=this._config.inputClassName??"style_module_searchInput__d7830601",n.appendChild(this._inputElement),this._createPlaceholderElement(),this._handleFocus=()=>this._updatePlaceholderVisibility(),this._handleBlur=()=>this._updatePlaceholderVisibility(),this._handleClearClick=()=>this.clearInput(),this._inputElement.addEventListener("focus",this._handleFocus),this._inputElement.addEventListener("blur",this._handleBlur),this._clearButton=document.createElement("button"),this._clearButton.className="style_module_clearButton__5ebb41de",this._clearButton.innerHTML="×",this._clearButton.addEventListener("click",this._handleClearClick),n.appendChild(this._clearButton),this._dropdownContainer=document.createElement("div"),this._dropdownContainer.className="style_module_dropdownContainer__d98287da",this._config.openListUpwards&&this._dropdownContainer.classList.add(cB),n.appendChild(this._dropdownContainer),this._suggestionList=document.createElement("ul"),this._suggestionList.classList.add(this._config.suggestionListClassName??"style_module_searchSuggestions__b0d3f71e"),this._dropdownContainer.appendChild(this._suggestionList),this._footerContainer=document.createElement("div"),this._footerContainer.className="style_module_footerContainer__73e7a066",this._dropdownContainer.appendChild(this._footerContainer),this._handleKeyDown=this._handleKeyDown.bind(this),this._handleInput=this._handleInput.bind(this),this._inputElement.addEventListener("input",this._handleInput),this._inputElement.addEventListener("keydown",this._handleKeyDown),this._config.disabled&&this.setDisabled(!0)}get suggestionList(){return this._suggestionList}get dropdownContainer(){return this._dropdownContainer}_handleInput(e){if(this._config.disabled)return;const t=this._inputElement.value;t?this._clearButton.classList.add(sB):this._clearButton.classList.remove(sB),this._updatePlaceholderVisibility(),this._debounceTimeout&&window.clearTimeout(this._debounceTimeout),t.length>=(this._config.minSearchLength??0)&&this._renderLoading(),this._debounceTimeout=window.setTimeout(async()=>{const n=await this._performSearch(t);this._config.onInput&&this._config.onInput(t,n,e),this._renderSuggestions(n)},this._config.debounceTime??300)}async _handleKeyDown(e){if(!this._config.disabled&&"Enter"===e.key){const e=this._inputElement.value;this._renderLoading();const t=await this._performSearch(e);this._config.onEnter&&this._config.onEnter(e,t),this._renderSuggestions(t)}}_createPlaceholderElement(){var e;if(this._config.placeholderRenderer){const t=this._config.placeholderRenderer;t instanceof HTMLElement?(this._placeholderElement=document.createElement("div"),this._placeholderElement.className="style_module_placeholderWrapper__72d5eb0e",this._handleMouseDown=e=>{if(this._config.disabled)return void e.preventDefault();let t=e.target;for(;t&&t!==this._placeholderElement;){if("true"===t.dataset.ignoreFocus)return void e.preventDefault();t=t.parentElement}},this._placeholderElement.addEventListener("mousedown",this._handleMouseDown),this._placeholderElement.appendChild(t),null==(e=this._inputElement.parentNode)||e.insertBefore(this._placeholderElement,this._inputElement)):this._inputElement.placeholder=t}this._updatePlaceholderVisibility()}_updatePlaceholderVisibility(){this._placeholderElement&&(this._inputElement.value||document.activeElement===this._inputElement?this._placeholderElement.classList.add(aB):this._placeholderElement.classList.remove(aB))}_createSuggestionElement(e){var t,n;const i=document.createElement("li"),o=document.createElement("div"),r=(null==(n=(t=this._config).suggestionRenderer)?void 0:n.call(t,e,this._inputElement.value))??String(e);return"string"==typeof r?(o.title=r,o.innerHTML=this._config.highlightMatch?this.getHighlightedMatch(r):r):o.appendChild(r),i.appendChild(o),i}_renderSuggestions(e){this._suggestionList.innerHTML="";const t=this._config.maxVisibleItems&&e.length>this._config.maxVisibleItems;if(this._suggestionList.style.overflowY=t?"auto":"",e.length>0){const t=this._createSuggestionElement(e[0]);this._suggestionList.appendChild(t);const n=t.offsetHeight;if(this._suggestionList.removeChild(t),this._config.maxVisibleItems&&n>0){const e=n*this._config.maxVisibleItems,t=.6*window.innerHeight;this._suggestionList.style.maxHeight=`${Math.min(e,t)}px`}}const n=this._inputElement.value.length>=(this._config.minSearchLength??0);if(e.forEach(e=>{const t=this._createSuggestionElement(e);t.addEventListener("click",()=>this._handleSuggestionClick(e)),this._suggestionList.appendChild(t)}),0===e.length&&this._config.noResultsText&&n){const e=document.createElement("li");e.className="style_module_noResults__363397c3",e.textContent=this._config.noResultsText,this._suggestionList.appendChild(e)}this._footerContainer&&(this._footerContainer.innerHTML="",this._config.footerComponent&&n&&e.length>0&&this._footerContainer.appendChild(this._config.footerComponent)),e.length>0||this._config.noResultsText&&n?this._dropdownContainer.classList.add(sB):this._dropdownContainer.classList.remove(sB)}_renderLoading(){if(!(this._inputElement.value.length>=(this._config.minSearchLength??0)))return;this._suggestionList.innerHTML="";const e=document.createElement("li");e.className="style_module_loading__296e0212",e.textContent="Searching…",this._suggestionList.appendChild(e),this._footerContainer&&(this._footerContainer.innerHTML=""),this._dropdownContainer.classList.add(sB)}_handleSuggestionClick(e){var t,n;this._config.disabled||(this._config.onSelect&&this._config.onSelect(e),this._inputElement.value=(null==(n=(t=this._config).selectedSuggestionRenderer)?void 0:n.call(t,e,this._inputElement.value))??String(e),this._updatePlaceholderVisibility(),this._clearButton.classList.add(sB),this._suggestionList.innerHTML="",this._footerContainer&&(this._footerContainer.innerHTML=""),this._dropdownContainer.classList.remove(sB))}async _performSearch(e){let t=[];return this._config.searchFn&&e.length>=(this._config.minSearchLength??0)&&(t=await this._config.searchFn(e,this._config.suggestionsLimit)),t}getHighlightedMatch(e){if(!this._config.highlightMatch||!this._inputElement.value)return e;const t=this._inputElement.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),n=new RegExp(`(${t})`,"gi");return e.replace(n,"<mark>$1</mark>")}setDisabled(e){var t;e?(this._inputElement.disabled=!0,this._inputElement.value="",null==(t=this._placeholderElement)||t.classList.remove(aB),this._clearButton.classList.remove(sB),this._container.classList.add(lB),this._dropdownContainer.classList.remove(sB)):(this._inputElement.disabled=!1,this._container.classList.remove(lB)),this._config.disabled=e}isDisabled(){return!!this._config.disabled}setConfig(e){const t=this._config.openListUpwards;this._config=IO(rB,e??{}),this.setDisabled(!!this._config.disabled),t!==this._config.openListUpwards&&(this._config.openListUpwards?this._dropdownContainer.classList.add(cB):this._dropdownContainer.classList.remove(cB))}destroy(){var e;this._inputElement.removeEventListener("input",this._handleInput),this._inputElement.removeEventListener("keydown",this._handleKeyDown),this._inputElement.removeEventListener("focus",this._handleFocus),this._inputElement.removeEventListener("blur",this._handleBlur),this._clearButton.removeEventListener("click",this._handleClearClick),this._placeholderElement&&this._handleMouseDown&&(null==(e=this._placeholderElement)||e.removeEventListener("mousedown",this._handleMouseDown)),this._container.innerHTML=""}clearInput(){if(this._config.disabled)return;const e=!!this._inputElement.value;this._inputElement.value="",this._suggestionList.innerHTML="",this._footerContainer&&(this._footerContainer.innerHTML=""),this._dropdownContainer.classList.remove(sB),this._clearButton.classList.remove(sB),this._updatePlaceholderVisibility(),e&&this._config.onClear&&this._config.onClear()}hideSuggestions(){this._suggestionList.innerHTML="",this._footerContainer&&(this._footerContainer.innerHTML=""),this._dropdownContainer.classList.remove(sB)}focus(){this._inputElement.focus()}blur(){this._inputElement.blur()}};const fB=30,mB={padding:{top:5,left:5,bottom:1,right:5},barPadding:.1,minBarHeight:2,selectionRadius:3,selectionPadding:8,barCount:fB,dataStep:void 0,barRadius:1,barTopMargin:7,labelSideMargin:3,formatter:AO,allowSelection:!0,stickySelection:!0,onBrush:void 0,onBarHover:void 0,noDataMessage:"No histogram data",loadingMessage:"Data loading..."},_B="style_module_bar__3c9ab488",gB="style_module_highlightedBar__b193a8de",yB="style_module_bars__cf3a511f";!function(){try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode('@keyframes style_module_fadeIn__ffac87fd{0%{opacity:0}to{opacity:.2}}.style_module_displayState__6ae19b84{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--cosmograph-ui-text);display:flex;justify-content:center;align-items:center;min-width:100px;opacity:.2;font-size:calc(var(--cosmograph-ui-font-size) + 1px);letter-spacing:-.02em;font-weight:200;user-select:none;-webkit-user-select:none;animation:style_module_fadeIn__ffac87fd .3s ease-in-out}:root{--cosmograph-timeline-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-timeline-selection-opacity: .5;--cosmograph-timeline-bar-color: var(--cosmograph-ui-element-color);--cosmograph-timeline-highlighted-bar-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-timeline-font-family: var(--cosmograph-ui-font-family);--cosmograph-timeline-font-size: var(--cosmograph-ui-tick-font-size);--cosmograph-timeline-background: var(--cosmograph-ui-background);--cosmograph-timeline-text-color: var(--cosmograph-ui-text);--cosmograph-timeline-axis-color: var(--cosmograph-ui-text)}.style_module_timeline__736434f7{position:relative;display:flex;background:var(--cosmograph-timeline-background);width:100%;min-height:25px;overflow:hidden}.style_module_timelineSvg__b916ad04{position:relative;width:100%;height:100%}.style_module_selection__ebee57f8{fill:var(--cosmograph-timeline-selection-color);fill-opacity:var(--cosmograph-timeline-selection-opacity);stroke:none}.style_module_axisTick__5865631d{color:var(--cosmograph-timeline-axis-color);font:var(--cosmograph-timeline-font-family);font-size:var(--cosmograph-timeline-font-size);user-select:none;-webkit-user-select:none;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum";alignment-baseline:text-before-edge}.style_module_axisLine__992b502d{opacity:.2;color:var(--cosmograph-timeline-axis-color)}.style_module_bar__114fa79f{fill:var(--cosmograph-timeline-bar-color);transform:scaleY(-1);opacity:0}.style_module_animationControl__ee52cd66{color:var(--cosmograph-timeline-axis-color);width:6%;max-width:30px;min-width:20px;cursor:pointer;display:none;align-items:center;user-select:none;-webkit-user-select:none;opacity:.5;position:relative;justify-content:center}.style_module_animationControl__ee52cd66>svg{width:50%;max-height:20px;padding-right:2px}.style_module_hidden__a73fe81a{display:none}.style_module_disabled__eb988570{opacity:.2;pointer-events:none}.style_module_highlightedBar__c2fc9bdc{fill:var(--cosmograph-timeline-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-search-font-family: var(--cosmograph-ui-font-family);--cosmograph-search-font-size: 14px;--cosmograph-search-list-font-size: 13.5px;--cosmograph-search-text-color: var(--cosmograph-ui-text);--cosmograph-search-background: transparent;--cosmograph-search-list-background: rgba(0, 0, 0, .2);--cosmograph-search-list-match-background: rgba(255, 255, 255, .2);--cosmograph-search-list-match-color: var(--cosmograph-ui-text)}.style_module_searchInput__d7830601:hover{filter:brightness(1.2) contrast(1)}.style_module_searchInput__d7830601{width:100%;background:transparent;color:var(--cosmograph-search-text-color);border:none;border-bottom:.5px solid var(--cosmograph-search-text-color);padding:4px 20px 5px 2px;font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:opacity .2s ease-out}.style_module_searchInput__d7830601::selection{background:var(--cosmograph-search-list-match-background)}.style_module_searchInput__d7830601:focus{outline:none}.style_module_searchSuggestions__b0d3f71e{color:#fff;width:100%;padding:0;margin:0;background:transparent;overflow-y:auto;flex:1;min-height:0}.style_module_searchSuggestions__b0d3f71e li{padding:5px 10px;cursor:pointer;-webkit-user-select:none;user-select:none;display:block;font-weight:500;font-size:var(--cosmograph-search-list-font-size);max-width:100%;overflow:hidden}.style_module_searchSuggestions__b0d3f71e li>div{white-space:nowrap;font-weight:200;overflow:hidden;text-overflow:ellipsis;width:100%}.style_module_searchSuggestions__b0d3f71e li:hover{background:#ffffff1a}.style_module_searchSuggestions__b0d3f71e mark{background:var(--cosmograph-search-list-match-background);color:var(--cosmograph-search-list-match-color);border-radius:2px}.style_module_clearButton__5ebb41de{position:absolute;right:0;top:0;height:100%;background:none;border:none;color:var(--cosmograph-search-text-color);font-weight:300;cursor:pointer;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d{opacity:.7}.style_module_placeholderWrapper__72d5eb0e{z-index:1;color:var(--cosmograph-search-text-color);font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);position:absolute;top:0;left:0;width:100%;bottom:0;display:flex;line-height:1.25;align-items:center;transition:transform .3s ease-out,opacity .3s ease-out}.style_module_placeholderWrapper__72d5eb0e.style_module_hidden__acfb8431{transform:translate(-30px);pointer-events:none;opacity:0}.style_module_searchInput__d7830601:disabled,.style_module_searchInput__d7830601.style_module_disabled__62c35dc5{opacity:.2;cursor:not-allowed;pointer-events:none}.style_module_disabled__62c35dc5 .style_module_clearButton__5ebb41de{display:none}.style_module_disabled__62c35dc5 .style_module_placeholderWrapper__72d5eb0e{opacity:.3;cursor:not-allowed}.style_module_searchInputWrapper__1edbcb22{position:relative;display:flex;width:100%}.style_module_noResults__363397c3{opacity:.3!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none}.style_module_noResults__363397c3:hover{background:none}.style_module_loading__296e0212{opacity:.7!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none;-webkit-user-select:none;user-select:none}.style_module_dropdownContainer__d98287da{position:absolute;top:100%;left:0;width:100%;background:var(--cosmograph-search-list-background);border-radius:4px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);opacity:0;transform:translateY(-10px);transition:opacity .2s ease-out,transform .2s ease-out;pointer-events:none;overflow:hidden;z-index:10;display:flex;flex-direction:column;padding-bottom:2px}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b{top:auto;bottom:100%;transform:translateY(10px)}.style_module_dropdownContainer__d98287da.style_module_visible__5be7493d{opacity:1;transform:translateY(0);pointer-events:auto}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b.style_module_visible__5be7493d{opacity:1;transform:translateY(-2px);pointer-events:auto}.style_module_footerContainer__73e7a066{flex-shrink:0}:root{--cosmograph-scrollbar-background: rgba(255, 255, 255, .1);--cosmograph-ui-background: rgb(45, 49, 58);--cosmograph-ui-text: #ffffffc7;--cosmograph-ui-tick-font-size: 11px;--cosmograph-ui-font-size: 12px;--cosmograph-ui-font-family: inherit;--cosmograph-ui-element-color: #5C616A;--cosmograph-ui-highlighted-element-color: white;--cosmograph-ui-selection-control-color: #8d949ea8;-webkit-font-smoothing:antialiased!important;text-rendering:optimizeLegibility!important}.style_module_cosmograph-ui__5acb97f1{background:var(--cosmograph-ui-background);color:var(--cosmograph-ui-text)}.style_module_scrollbar__f1516254 *::-webkit-scrollbar{width:5px;height:5px;border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-track{border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-corner{background:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-button{display:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-thumb{background-color:var(--cosmograph-scrollbar-background);transition:background-color .5s;border-radius:20px;border:3px solid var(--cosmograph-scrollbar-background)}@-moz-document url-prefix(){.style_module_scrollbar__f1516254 *{scrollbar-width:thin;scrollbar-color:var(--cosmograph-scrollbar-background) transparent;scrollbar-track-color:transparent;scrollbar-face-color:var(--cosmograph-scrollbar-background)}}:root{--cosmograph-histogram-background: var(--cosmograph-ui-background);--cosmograph-histogram-text-color: var(--cosmograph-ui-text);--cosmograph-histogram-axis-color: var(--cosmograph-ui-text);--cosmograph-histogram-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-histogram-selection-opacity: .5;--cosmograph-histogram-bar-color: var(--cosmograph-ui-element-color);--cosmograph-histogram-highlighted-bar-color: var( --cosmograph-ui-highlighted-element-color);--cosmograph-histogram-font-family: var(--cosmograph-ui-font-family);--cosmograph-histogram-font-size: var(--cosmograph-ui-tick-font-size)}.style_module_histogram__9d8a77ea{position:relative;display:flex;min-height:25px;background:var(--cosmograph-histogram-background);width:100%}.style_module_histogramSvg__ccccb628{position:relative;width:100%;height:100%}.style_module_selection__7db96137{fill:var(--cosmograph-histogram-selection-color);fill-opacity:var(--cosmograph-histogram-selection-opacity);stroke:none}.style_module_axisTick__898e1f39{color:var(--cosmograph-histogram-axis-color);font-family:var(--cosmograph-histogram-font-family);font-size:var(--cosmograph-histogram-font-size);user-select:none;-webkit-user-select:none;alignment-baseline:text-before-edge;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum"}.style_module_bar__3c9ab488{fill:var(--cosmograph-histogram-bar-color);transform:scaleY(-1)}.style_module_highlightedBar__b193a8de{fill:var(--cosmograph-histogram-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-bars-font-color: var(--cosmograph-ui-text);--cosmograph-bars-font-family: var(--cosmograph-ui-font-family);--cosmograph-bars-font-size: var(--cosmograph-ui-font-size);--cosmograph-bars-ui-font-size: 11.5px;--cosmograph-bars-background: var(--cosmograph-ui-element-color);--cosmograph-bars-bar-height: 20px;--cosmograph-bars-bar-bottom-margin: 2px;--cosmograph-bars-highlighted-color: var( --cosmograph-ui-highlighted-element-color)}.style_module_bars__25497ded{position:relative;width:100%;min-height:100px;user-select:none;flex-direction:column;-webkit-user-select:none}.style_module_bars__25497ded .scroll-container{position:relative;width:100%;overflow-y:hidden;overflow-x:hidden}.style_module_bars__25497ded .bars-container{position:relative;width:calc(100% - 1px);font-family:var(--cosmograph-bars-font-family)}.style_module_bars__25497ded .highlighted-bars-container{position:absolute;top:0;left:0;pointer-events:none}.style_module_bars__25497ded .row{height:var(--cosmograph-bars-bar-height);display:flex;align-items:center;margin-bottom:var(--cosmograph-bars-bar-bottom-margin);width:100%;transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row:hover{filter:brightness(1.15) contrast(1.05);transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row.unselected:hover{filter:brightness(.95) contrast(1.15);transition:filter .05s linear}.style_module_bars__25497ded .unselected{opacity:.85;filter:brightness(.8) contrast(1.1)}.style_module_bars__25497ded .selected{filter:brightness(1.05) contrast(1.05)}.style_module_bars__25497ded .selected>.info>.label{font-weight:600;filter:brightness(1.1) contrast(1.05)}.style_module_bars__25497ded .unselected>.info>.label{font-weight:300}.style_module_bars__25497ded .bar{height:100%;background-color:var(--cosmograph-bars-background);opacity:.8;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .bar-highlighted{height:100%;background-color:var(--cosmograph-bars-highlighted-color);opacity:.2;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .info{display:flex;justify-content:space-between;width:100%;padding:0 4px;position:absolute;font-size:var(--cosmograph-bars-font-size);font-feature-settings:"tnum";color:var(--cosmograph-bars-font-color);gap:2px}.style_module_bars__25497ded .label{min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:opacity .05s linear}.style_module_bars__25497ded .count{flex-shrink:0;font-weight:300;opacity:.8;transition:opacity .05s linear}.style_module_bars__25497ded .show-more{cursor:pointer;padding-top:2px;display:flex;font-weight:300;color:var(--cosmograph-bars-font-color);font-size:11px;justify-content:space-between;opacity:.6;font-size:var(--cosmograph-bars-ui-font-size);pointer-events:none;transition:opacity .1s linear}.style_module_bars__25497ded .show-more:hover{opacity:1;text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .show-more>span{pointer-events:all}.style_module_bars__25497ded .show-more-count{padding-right:5px;pointer-events:all;font-feature-settings:"tnum"}.style_module_bars__25497ded .unselected>.info>.label,.style_module_bars__25497ded .unselected>.info>.count{opacity:.5}.style_module_bars__25497ded .unselected:hover>.info>.label,.style_module_bars__25497ded .unselected:hover>.info>.count{opacity:1}.style_module_bars__25497ded .search-input{background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,.3);font-size:13px!important;color:var(--cosmograph-bars-font-color);line-height:1.5;padding:2px;width:100%;position:relative;transition:border-bottom-color .2s}.style_module_bars__25497ded .search-input::placeholder{color:var(--cosmograph-bars-font-color)!important;opacity:.4;font-weight:300;font-family:inherit}.style_module_bars__25497ded .search-container{position:relative;width:100%;margin-bottom:4px;display:none;z-index:1}.style_module_bars__25497ded .clear-button{position:absolute;right:0;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--cosmograph-bars-font-color);font-weight:300;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_bars__25497ded .clear-button.visible:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_bars__25497ded .clear-button.visible{opacity:.7}.style_module_bars__25497ded .clear-button svg{width:10px;height:10px;fill:currentColor}.style_module_bars__25497ded .sorting-block{visibility:hidden;margin-top:1px;display:flex;justify-content:space-between}.style_module_bars__25497ded .buttons-container{margin-top:4px;font-size:var(--cosmograph-bars-ui-font-size);display:flex;gap:4px;line-height:1.25}.style_module_bars__25497ded .buttons-container>div{transition:opacity .05s linear,filter .05s linear;padding:1px 5px;background:var(--cosmograph-bars-background);border-radius:4px;opacity:.9;display:flex;cursor:pointer;align-items:center}.style_module_bars__25497ded .buttons-container>div:hover{filter:brightness(1.2)}.style_module_bars__25497ded .reset-text{transition:opacity .05s linear,filter .05s linear;display:flex;font-size:var(--cosmograph-bars-ui-font-size);align-items:end;padding-right:4px;cursor:pointer;font-weight:300}.style_module_bars__25497ded .reset-text:hover{text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .reset-text.unselected{pointer-events:none;cursor:default;opacity:.7}.style_module_bars__25497ded :scope.reset-text:hover:not(.unselected){filter:brightness(1.5);opacity:1}:root{--cosmograph-size-legend-form-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-family: inherit;--cosmograph-size-legend-font-size: var(--cosmograph-ui-font-size);--cosmograph-size-legend-sublabel-font-size: 10px;--cosmograph-size-legend-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-size-legend-line-radius: 2px;--cosmograph-size-legend-line-width: 30px;--cosmograph-size-legend-hide-transform: translateY(100%);--cosmograph-size-legend-show-transform: translateX(0)}.style_module_container__d2889234{display:flex;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;overflow:hidden;min-height:25px}.style_module_legend__75c167f2{width:auto;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-size-legend-font-size);font-family:var(--cosmograph-size-legend-font-family);user-select:none;-webkit-user-select:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.04em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__91eae57a{opacity:1;transform:var(--cosmograph-size-legend-show-transform)}.style_module_disabled__d51f7a10{opacity:0;transform:var(--cosmograph-size-legend-hide-transform);pointer-events:none;display:none!important;min-height:0}@starting-style{.style_module_container__d2889234.style_module_enabled__91eae57a,.style_module_legend__75c167f2.style_module_enabled__91eae57a{opacity:0;transform:var(--cosmograph-size-legend-hide-transform)}}.style_module_legend__75c167f2 .circle{background-color:var(--cosmograph-size-legend-form-color);border-radius:50%;transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2 .line{background-color:var(--cosmograph-size-legend-form-color);border-radius:var(--cosmograph-size-legend-line-radius);width:var(--cosmograph-size-legend-line-width);transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2.style_module_events__894316a8{pointer-events:auto;cursor:pointer}.style_module_legend__75c167f2 .legend-content{display:flex;align-items:end;justify-content:center;gap:.75rem}.style_module_legend__75c167f2 .legend-content>div{transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__75c167f2 .labels-wrapper{white-space:nowrap}.style_module_legend__75c167f2 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-size-legend-items-margin)}.style_module_legend__75c167f2 .name{align-items:center;text-align:center;justify-content:center;display:flex;color:var(--cosmograph-size-legend-font-color);overflow:hidden;width:100%;margin-top:3px;word-break:break-all;white-space:pre-line;transition:color .15s ease-in-out;letter-spacing:-.02em}.style_module_legend__75c167f2 .label{color:var(--cosmograph-size-legend-font-color);overflow:hidden;transition:color .15s ease-in-out;text-overflow:ellipsis;font-feature-settings:"tnum"}.style_module_legend__75c167f2 .sublabel{padding-top:1px;font-size:var(--cosmograph-size-legend-sublabel-font-size);opacity:.5;line-height:1;min-width:10px;transition:color .15s ease-in-out}.style_module_hovered__1206707f .label,.style_module_hovered__1206707f .sublabel{color:var(--cosmograph-size-legend-hover-color);cursor:pointer}.style_module_hovered__1206707f .circle,.style_module_hovered__1206707f .line{background-color:var(--cosmograph-size-legend-hover-color);cursor:pointer}:root{--cosmograph-color-legend-range-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-range-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-range-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-label-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-sublabel-font-size: 10px;--cosmograph-color-legend-range-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-range-gradient-height: 6px;--cosmograph-color-legend-range-gradient-radius: 8px;--cosmograph-color-legend-range-gradient-top-margin: 6px;--cosmograph-color-legend-hide-transform: translateY(100%);--cosmograph-color-legend-show-transform: translateX(0)}.style_module_container__05cc807d{display:flex;min-width:150px;min-height:25px;width:100%;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_legend__a3e235e4{width:100%;font-weight:300;letter-spacing:-.04em;display:flex;flex-direction:column;font-size:var(--cosmograph-color-legend-range-font-size);font-family:var(--cosmograph-color-legend-range-font-family);user-select:none;-webkit-user-select:none;pointer-events:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__b3120e27{opacity:1;transform:var(--cosmograph-color-legend-show-transform);pointer-events:auto}.style_module_disabled__c2dc158c{opacity:0;transform:var(--cosmograph-color-legend-hide-transform);pointer-events:none;display:none;min-height:0}@starting-style{.style_module_container__05cc807d.style_module_enabled__b3120e27,.style_module_legend__a3e235e4.style_module_enabled__b3120e27{opacity:0;transform:var(--cosmograph-color-legend-hide-transform)}}.style_module_legend__a3e235e4 .legend-content{display:flex;align-items:end;justify-content:space-between}.style_module_hovered__dfd7bb2c .label,.style_module_hovered__dfd7bb2c .sublabel{color:var(--cosmograph-size-legend-hover-color)!important;cursor:pointer}.style_module_legend__a3e235e4 .extent{white-space:nowrap;transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__a3e235e4 .gradient{width:100%;margin-top:var(--cosmograph-color-legend-range-gradient-top-margin);height:var(--cosmograph-color-legend-range-gradient-height);border-radius:var(--cosmograph-color-legend-range-gradient-radius)}.style_module_legend__a3e235e4 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-color-legend-range-items-margin)}.style_module_legend__a3e235e4 .name{align-items:center;text-align:center;justify-content:space-around;display:flex;color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;width:100%;word-break:break-word;text-wrap:balance;white-space:pre-line;transition:color .15s ease-in-out;margin:0 4px;letter-spacing:-.02em;line-height:1.25}.style_module_legend__a3e235e4 .label{color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;max-width:150px;text-overflow:ellipsis;font-size:var(--cosmograph-color-legend-range-label-font-size);transition:color .15s ease-in-out;line-height:1;font-feature-settings:"tnum"}.style_module_legend__a3e235e4 .sublabel{padding-top:1px;color:var(--cosmograph-color-legend-range-font-color);opacity:.55;font-size:var(--cosmograph-color-legend-range-sublabel-font-size);line-height:1;transition:color .15s ease-in-out}:root{--cosmograph-color-legend-type-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-type-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-type-font-size: 11px;--cosmograph-color-legend-type-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-type-others-color: #bab0ab;--cosmograph-color-legend-type-bullet-size: 8px;--cosmograph-color-legend-type-bullet-radius: 1rem;--cosmograph-color-legend-type-items-margin: 4px;--cosmograph-color-legend-type-hide-transform: translateY(125%);--cosmograph-color-legend-type-show-transform: translateX(0)}.style_module_enabled__277b2403{opacity:1;transform:var(--cosmograph-color-legend-type-show-transform)}.style_module_disabled__7a587f96{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform);display:none!important;min-height:0}.style_module_wrapper__ea8ca7f4{position:relative;max-width:100%;width:fit-content;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_typeLegend__15bf4b2f{position:relative;width:fit-content;max-width:100%;min-height:25px;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.015em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_typeLegend__15bf4b2f .reverted{flex-direction:row-reverse}.style_module_typeLegend__15bf4b2f .scroll-container{width:100%;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-color-legend-type-font-size);font-family:var(--cosmograph-color-legend-type-font-family);user-select:none;-webkit-user-select:none;line-height:normal;overflow-x:hidden;overflow-y:auto;will-change:transform}@starting-style{.style_module_typeLegend__15bf4b2f.style_module_enabled__277b2403,.style_module_wrapper__ea8ca7f4.style_module_enabled__277b2403{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform)}}.style_module_typeLegend__15bf4b2f .legend-item{display:flex;align-items:center;position:absolute;margin-bottom:var(--cosmograph-color-legend-type-items-margin);pointer-events:none;width:100%;padding-left:1px;font-weight:300;transition:filter .1s ease-in-out,opacity .1s ease-in-out;min-height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px + var(--cosmograph-color-legend-type-items-margin));height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px);box-sizing:border-box}.style_module_typeLegend__15bf4b2f .unknown{background-color:var(--cosmograph-color-legend-type-unknown-color)}.style_module_typeLegend__15bf4b2f .others{background-color:var(--cosmograph-color-legend-type-others-color)}.style_module_typeLegend__15bf4b2f .bullet{height:var(--cosmograph-color-legend-type-bullet-size);width:var(--cosmograph-color-legend-type-bullet-size);min-height:var(--cosmograph-color-legend-type-bullet-size);min-width:var(--cosmograph-color-legend-type-bullet-size);border-radius:var(--cosmograph-color-legend-type-bullet-radius);pointer-events:all;margin-right:5px}.style_module_typeLegend__15bf4b2f .label{color:var(--cosmograph-color-legend-type-font-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - var(--cosmograph-color-legend-type-bullet-size) - 5px);pointer-events:all;transition:.05s linear color}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.bullet{margin-right:0}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.label{margin-right:5px}.style_module_typeLegend__15bf4b2f .show-more{cursor:pointer;padding-top:4px;display:none;font-weight:300;color:var(--cosmograph-color-legend-type-font-color);font-size:11px;opacity:.6;pointer-events:all;justify-content:space-between;transition:opacity .1s linear;font-feature-settings:"tnum"}.style_module_typeLegend__15bf4b2f .show-more:hover{opacity:1}.style_module_hovered__c0993502 .label,.style_module_hovered__c0993502 .sublabel{color:var(--cosmograph-color-legend-type-hover-color)!important;cursor:pointer}.style_module_selected__36e1dd81{filter:brightness(1)}.style_module_selected__36e1dd81>.style_module_label__afecc7a3{filter:brightness(1.2)}.style_module_unselected__4826cfb7{filter:brightness(.5)}.style_module_typeLegend__15bf4b2f .name{font-size:calc(var(--cosmograph-color-legend-type-font-size) + 1px);font-family:var(--cosmograph-color-legend-type-font-family);color:var(--cosmograph-color-legend-type-font-color);transition:color .15s ease-in-out,opacity .3s ease-in-out,max-height .3s ease-in-out,transform .3s ease-in-out;margin-bottom:4px;margin-top:2px;margin-left:1px;letter-spacing:-.02em;line-height:1.25;overflow:hidden;width:100%;white-space:nowrap;text-overflow:ellipsis;pointer-events:all;-webkit-user-select:none!important;user-select:none!important;max-height:100px;opacity:1;transform:translateY(0)}.style_module_typeLegend__15bf4b2f .name.hidden{opacity:0;max-height:0;margin-bottom:0;margin-top:0;transform:translateY(-10px)}:root{--cosmograph-button-color: var(--cosmograph-ui-text);--cosmograph-button-background: var(--cosmograph-ui-element-color);--cosmograph-button-border-radius: 2px}.style_module_button__e95a1138{background:var(--cosmograph-button-background);color:var(--cosmograph-button-color);border-radius:var(--cosmograph-button-border-radius);display:none;align-items:center;justify-content:center;width:25px;height:25px;margin:3px;padding:5px;cursor:pointer;filter:brightness(.95) contrast(.9);transition:filter .1s}.style_module_button__e95a1138:hover{filter:brightness(1.2) contrast(1)}')),document.head.appendChild(e)}}catch(_C){console.error("vite-plugin-css-injected-by-js",_C)}}();var bB=Object.defineProperty,vB=(e,t,n)=>((e,t,n)=>t in e?bB(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);let xB=class extends qO{constructor(e,t){const n=IO(mB,t??{});super(e,qO.extractConfig(n,mB)),vB(this,"_config"),vB(this,"_containerNode"),vB(this,"_resizeObserver"),vB(this,"_svg"),vB(this,"_axisGroup"),vB(this,"_barsGroup"),vB(this,"_highlightedBarsGroup"),vB(this,"_brushGroup"),vB(this,"_firstRender",!0),vB(this,"_height"),vB(this,"_width"),vB(this,"_histogramWidth"),vB(this,"_histogramHeight"),vB(this,"_barWidth",0),vB(this,"_maxCount",0),vB(this,"_extent"),vB(this,"_barsData",[]),vB(this,"_highlightedBarsData",[]),vB(this,"_histogramData"),vB(this,"_highlightedData"),vB(this,"_bandIntervals",[]),vB(this,"_currentSelection"),vB(this,"_currentSelectionInPixels"),vB(this,"_yScale",dM()),vB(this,"_xScale",cM()),vB(this,"_axis",RP(this._xScale)),vB(this,"_brushInstance"),this._config=n,this._containerNode=e,this._containerNode.classList.add("style_module_histogram__9d8a77ea"),this._width=e.offsetWidth,this._height=e.offsetHeight,this._histogramWidth=this._width-this._config.padding.left-this._config.padding.right,this._histogramHeight=this._height-this._config.padding.top-this._config.padding.bottom,this._initializeSVG(),this._initializeGroups(),this._resizeObserver=new SP(()=>this.resize()),this._resizeObserver.observe(this._containerNode)}_initializeSVG(){this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._svg.classList.add("style_module_histogramSvg__ccccb628"),this._containerNode.appendChild(this._svg)}setLoadingState(){super.setLoadingState()}_initializeGroups(){this._axisGroup=bk(this._svg).append("g").attr("class","style_module_axis__e37d2f53"),this._barsGroup=bk(this._svg).append("g").attr("class",yB),this._highlightedBarsGroup=bk(this._svg).append("g").attr("class",yB),this._brushGroup=bk(this._svg).append("g").attr("class","style_module_brush__5a0c1368")}get _barPadding(){return this._barWidth*(this._config.barPadding??0)}get _formatter(){return this._config.formatter??AO}getCurrentSelection(){return this._currentSelection}getCurrentSelectionInPixels(){return this._currentSelectionInPixels??[]}getBarWidth(){return this._barWidth-this._barPadding}getConfig(){return this._config}setConfig(e){const t=JSON.parse(JSON.stringify(this._config));this._config=IO(mB,e??{}),this.setDisplayStateConfig(qO.extractConfig(this._config,mB)),this._config.allowSelection||this._disableBrush(),(this._config.dataStep!==t.dataStep||this._config.barCount!==t.barCount)&&(this._updateHistogramData(this._histogramData),this._updateHistogramData(this._highlightedData,!0)),this._axis.tickFormat(e=>this._formatter(e)),this.resize()}setSelection(e,t=!1){var n,i,o,r;const s=this._currentSelection;if(e&&this._extent){const t=[Math.max(this._extent[0],Math.min(e[0],this._extent[1])),Math.min(this._extent[1],Math.max(e[1],this._extent[0]))];if(t[0]<t[1])if(this._config.stickySelection){const e=t.map(this._xScale);this._mapSelection(e)}else this._currentSelection=t;else this._currentSelection=void 0}else this._currentSelection=void 0;!t&&((null==s?void 0:s[0])!==(null==(n=this._currentSelection)?void 0:n[0])||(null==s?void 0:s[1])!==(null==(i=this._currentSelection)?void 0:i[1]))&&(null==(r=(o=this._config).onBrush)||r.call(o,this._currentSelection,!0)),this._brushCurrentSelection()}resize(){const{offsetWidth:e,offsetHeight:t}=this._containerNode;this._width=e,this._height=t,this._histogramWidth=this._width-this._config.padding.left-this._config.padding.right,this._histogramHeight=this._height-this._config.padding.top-this._config.padding.bottom,this._histogramHeight>this._config.padding.top+this._config.padding.bottom&&(this._updateScales(),this._currentSelection&&this.setSelection(this._currentSelection,!0),this._firstRender||this.render())}render(){this._updateBrush(),this._updateBars(),this._updateBars(!0),this._updateAxis(),this._firstRender&&(this._firstRender=!1)}destroy(){super.destroy(),this._resizeObserver.disconnect(),this._containerNode.innerHTML=""}_parseData(e){if(null==e||!e.length)return[];const t=new Float64Array(e.length);let n=0;for(let i=0;i<e.length;i++){const o=e[i];"number"==typeof o&&!isNaN(o)&&(t[n++]=o)}return Array.from(t.subarray(0,n))}setHistogramData(e,t){if(t&&t[1]<=t[0])return;this._histogramData=[],this._highlightedBarsData=[],this._currentSelection=void 0,this._brushCurrentSelection();const n=this._parseData(e),i=t||_D(n),o=i[0]<i[1];o&&n.length>1?(this.hideState(),this._histogramData=n,this._extent=i,this._firstRender=!0):this.showState(o?void 0:"Empty or invalid histogram data"),this._updateHistogramData(this._histogramData),this._updateScales(),this.render()}setHighlightedData(e){this._histogramData&&(this._highlightedData=this._parseData(e),this._highlightedBarsData=[],this._updateHistogramData(this._highlightedData,!0),this._updateBars(!0))}_updateAxis(){this._histogramData&&this._histogramData.length?(this._axisGroup.style("transform",`translate(${this._config.padding.left}px, ${this._config.padding.top-(this._config.selectionPadding??0)/2+1}px)`).call(this._axis).call(e=>e.select(".domain").remove()),this._axisGroup.selectAll(".tick").select("text").attr("class","style_module_axisTick__898e1f39").attr("y",0).attr("dy",-2).attr("dx",this._config.labelSideMargin??0),this._axisGroup.selectAll(".tick:last-of-type text").attr("dx",-(this._config.labelSideMargin??0)).style("text-anchor","end"),this._axisGroup.selectAll("line").attr("y2",this._histogramHeight).attr("y1",0).attr("opacity",.1)):this._axisGroup.style("display","none")}_updateBrush(){if(!this._config.allowSelection||this._histogramHeight<0||this._histogramWidth<0)return void this._brushGroup.selectAll("*").remove();const e=this._config.selectionPadding??0,t=this._histogramHeight-e,n=[[0,e/2],[this._histogramWidth,t+e/2]];this._brushInstance=rD().extent(n),this._brushInstance.on("end",({selection:e,sourceEvent:t})=>{var n,i,o,r;t&&(e?(this._config.stickySelection?this._mapSelection(e):this._currentSelection=e.map(e=>this._xScale.invert(e)),null==(i=(n=this._config).onBrush)||i.call(n,this._currentSelection)):(this._currentSelection=void 0,null==(r=(o=this._config).onBrush)||r.call(o,void 0)),this._brushCurrentSelection())}),this._brushGroup.style("transform",`translate(${this._config.padding.left}px, ${this._config.padding.top}px)`).call(this._brushInstance).call(this._brushInstance.move,this._currentSelectionInPixels||null),this._brushGroup.select("rect.selection").classed("style_module_selection__7db96137",!0).attr("rx",this._config.selectionRadius??0).attr("ry",this._config.selectionRadius??0)}_updateBars(e=!1){const t=e?this._highlightedBarsGroup:this._barsGroup;if(!this._histogramData||!this._histogramData.length)return void t.selectAll("rect").remove();t.style("transform",`translate(${this._config.padding.left}px, ${this._config.padding.top-(this._config.selectionPadding??0)/2}px)`);const n=e?.5:1,i=this._createBars(t,e);!e&&this._config.onBarHover&&i.on("mouseover",this._config.onBarHover),this._animateBars(i,e,n)}_createBars(e,t){return e.selectAll(`.${t?gB:_B}`).data(t?this._highlightedBarsData:this._barsData).join("rect").attr("class",t?gB:_B).attr("x",e=>this._xScale(e.rangeStart)+this._barPadding/2).attr("width",this.getBarWidth()).attr("rx",this._config.barRadius??0).attr("ry",this._config.barRadius??0).attr("y",-this._histogramHeight)}_animateBars(e,t,n){e.transition().duration(300).attr("height",e=>t&&0===e.count?0:this._yScale(e.count)).style("opacity",e=>this._yScale(e.count)===this._config.minBarHeight?.4:n)}_updateScales(){if(!this._extent||!this._barsData.length||this._histogramHeight<0||this._histogramWidth<0)this._axisGroup.style("display","none");else{this._axisGroup.style("display","inherit");const e=this._barsData[this._barsData.length-1],t=this._config.dataStep?[this._extent[0],e.rangeEnd]:this._extent;this._xScale.domain(t).range([0,this._histogramWidth]).clamp(!0),this._yScale.range([this._config.minBarHeight??0,this._histogramHeight-(this._config.barTopMargin??0)-(this._config.selectionPadding??0)]).domain([0,this._maxCount]).clamp(!0),this._axis.tickValues(t),this._barWidth=this._xScale(e.rangeEnd)-this._xScale(e.rangeStart)}}_updateHistogramData(e,t=!1){const n=t?"_highlightedBarsData":"_barsData";if(!this._extent)return void(this[n]=[]);if(null==e||!e.length)return void(this[n]=LO([],this._bandIntervals,this._currentSelection,t));t||this._generateBandIntervals();const i=LO(e,this._bandIntervals,this._currentSelection,t);this[n]=i,t||(this._maxCount=Math.max(...i.map(e=>e.count)))}_generateBandIntervals(){if(!this._extent)return;const{barCount:e=fB,dataStep:t}=this._config;this._bandIntervals=kO(this._extent,e,t)}_disableBrush(){this._currentSelection=void 0,this._brushCurrentSelection(),this._brushGroup.selectAll("*").remove()}_mapSelection(e){if(!this._barsData.length)return;const t=this._xScale.invert(e[0]),n=this._xScale.invert(e[1]),i=this._getClosestRange(t),o=this._getClosestRange(n,!0);i&&o&&i.rangeStart<=o.rangeEnd&&e[1]-e[0]>this.getBarWidth()/2?this._currentSelection=[i.rangeStart,o.rangeEnd]:this._currentSelection=void 0}_getClosestRange(e,t){return this._barsData.reduce((n,i)=>{const o=t?n.rangeEnd:n.rangeStart,r=t?i.rangeEnd:i.rangeStart;return Math.abs(r-e)<Math.abs(o-e)?i:n})}_brushCurrentSelection(){var e;this._currentSelection?(this._currentSelectionInPixels=this._currentSelection.map(this._xScale),this._brushInstance&&!this._firstRender&&this._brushGroup.call(this._brushInstance.move,this._currentSelectionInPixels)):(this._currentSelectionInPixels=void 0,null==(e=this._brushInstance)||e.clear(this._brushGroup))}};const wB={maxDisplayedItems:10,showSortingBlock:!0,showSearch:!0,sort:"count",sortAscending:!1,showTotalWhenFiltered:!1,countFormatter:AO,expanded:!1,onClick:void 0,onBarHover:void 0,noDataMessage:"No bars data",loadingMessage:"Data loading...",allowPointerEvents:!0};!function(){try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode('@keyframes style_module_fadeIn__ffac87fd{0%{opacity:0}to{opacity:.2}}.style_module_displayState__6ae19b84{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--cosmograph-ui-text);display:flex;justify-content:center;align-items:center;min-width:100px;opacity:.2;font-size:calc(var(--cosmograph-ui-font-size) + 1px);letter-spacing:-.02em;font-weight:200;user-select:none;-webkit-user-select:none;animation:style_module_fadeIn__ffac87fd .3s ease-in-out}:root{--cosmograph-timeline-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-timeline-selection-opacity: .5;--cosmograph-timeline-bar-color: var(--cosmograph-ui-element-color);--cosmograph-timeline-highlighted-bar-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-timeline-font-family: var(--cosmograph-ui-font-family);--cosmograph-timeline-font-size: var(--cosmograph-ui-tick-font-size);--cosmograph-timeline-background: var(--cosmograph-ui-background);--cosmograph-timeline-text-color: var(--cosmograph-ui-text);--cosmograph-timeline-axis-color: var(--cosmograph-ui-text)}.style_module_timeline__736434f7{position:relative;display:flex;background:var(--cosmograph-timeline-background);width:100%;min-height:25px;overflow:hidden}.style_module_timelineSvg__b916ad04{position:relative;width:100%;height:100%}.style_module_selection__ebee57f8{fill:var(--cosmograph-timeline-selection-color);fill-opacity:var(--cosmograph-timeline-selection-opacity);stroke:none}.style_module_axisTick__5865631d{color:var(--cosmograph-timeline-axis-color);font:var(--cosmograph-timeline-font-family);font-size:var(--cosmograph-timeline-font-size);user-select:none;-webkit-user-select:none;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum";alignment-baseline:text-before-edge}.style_module_axisLine__992b502d{opacity:.2;color:var(--cosmograph-timeline-axis-color)}.style_module_bar__114fa79f{fill:var(--cosmograph-timeline-bar-color);transform:scaleY(-1);opacity:0}.style_module_animationControl__ee52cd66{color:var(--cosmograph-timeline-axis-color);width:6%;max-width:30px;min-width:20px;cursor:pointer;display:none;align-items:center;user-select:none;-webkit-user-select:none;opacity:.5;position:relative;justify-content:center}.style_module_animationControl__ee52cd66>svg{width:50%;max-height:20px;padding-right:2px}.style_module_hidden__a73fe81a{display:none}.style_module_disabled__eb988570{opacity:.2;pointer-events:none}.style_module_highlightedBar__c2fc9bdc{fill:var(--cosmograph-timeline-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-search-font-family: var(--cosmograph-ui-font-family);--cosmograph-search-font-size: 14px;--cosmograph-search-list-font-size: 13.5px;--cosmograph-search-text-color: var(--cosmograph-ui-text);--cosmograph-search-background: transparent;--cosmograph-search-list-background: rgba(0, 0, 0, .2);--cosmograph-search-list-match-background: rgba(255, 255, 255, .2);--cosmograph-search-list-match-color: var(--cosmograph-ui-text)}.style_module_searchInput__d7830601:hover{filter:brightness(1.2) contrast(1)}.style_module_searchInput__d7830601{width:100%;background:transparent;color:var(--cosmograph-search-text-color);border:none;border-bottom:.5px solid var(--cosmograph-search-text-color);padding:4px 20px 5px 2px;font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:opacity .2s ease-out}.style_module_searchInput__d7830601::selection{background:var(--cosmograph-search-list-match-background)}.style_module_searchInput__d7830601:focus{outline:none}.style_module_searchSuggestions__b0d3f71e{color:#fff;width:100%;padding:0;margin:0;background:transparent;overflow-y:auto;flex:1;min-height:0}.style_module_searchSuggestions__b0d3f71e li{padding:5px 10px;cursor:pointer;-webkit-user-select:none;user-select:none;display:block;font-weight:500;font-size:var(--cosmograph-search-list-font-size);max-width:100%;overflow:hidden}.style_module_searchSuggestions__b0d3f71e li>div{white-space:nowrap;font-weight:200;overflow:hidden;text-overflow:ellipsis;width:100%}.style_module_searchSuggestions__b0d3f71e li:hover{background:#ffffff1a}.style_module_searchSuggestions__b0d3f71e mark{background:var(--cosmograph-search-list-match-background);color:var(--cosmograph-search-list-match-color);border-radius:2px}.style_module_clearButton__5ebb41de{position:absolute;right:0;top:0;height:100%;background:none;border:none;color:var(--cosmograph-search-text-color);font-weight:300;cursor:pointer;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d{opacity:.7}.style_module_placeholderWrapper__72d5eb0e{z-index:1;color:var(--cosmograph-search-text-color);font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);position:absolute;top:0;left:0;width:100%;bottom:0;display:flex;line-height:1.25;align-items:center;transition:transform .3s ease-out,opacity .3s ease-out}.style_module_placeholderWrapper__72d5eb0e.style_module_hidden__acfb8431{transform:translate(-30px);pointer-events:none;opacity:0}.style_module_searchInput__d7830601:disabled,.style_module_searchInput__d7830601.style_module_disabled__62c35dc5{opacity:.2;cursor:not-allowed;pointer-events:none}.style_module_disabled__62c35dc5 .style_module_clearButton__5ebb41de{display:none}.style_module_disabled__62c35dc5 .style_module_placeholderWrapper__72d5eb0e{opacity:.3;cursor:not-allowed}.style_module_searchInputWrapper__1edbcb22{position:relative;display:flex;width:100%}.style_module_noResults__363397c3{opacity:.3!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none}.style_module_noResults__363397c3:hover{background:none}.style_module_loading__296e0212{opacity:.7!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none;-webkit-user-select:none;user-select:none}.style_module_dropdownContainer__d98287da{position:absolute;top:100%;left:0;width:100%;background:var(--cosmograph-search-list-background);border-radius:4px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);opacity:0;transform:translateY(-10px);transition:opacity .2s ease-out,transform .2s ease-out;pointer-events:none;overflow:hidden;z-index:10;display:flex;flex-direction:column;padding-bottom:2px}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b{top:auto;bottom:100%;transform:translateY(10px)}.style_module_dropdownContainer__d98287da.style_module_visible__5be7493d{opacity:1;transform:translateY(0);pointer-events:auto}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b.style_module_visible__5be7493d{opacity:1;transform:translateY(-2px);pointer-events:auto}.style_module_footerContainer__73e7a066{flex-shrink:0}:root{--cosmograph-scrollbar-background: rgba(255, 255, 255, .1);--cosmograph-ui-background: rgb(45, 49, 58);--cosmograph-ui-text: #ffffffc7;--cosmograph-ui-tick-font-size: 11px;--cosmograph-ui-font-size: 12px;--cosmograph-ui-font-family: inherit;--cosmograph-ui-element-color: #5C616A;--cosmograph-ui-highlighted-element-color: white;--cosmograph-ui-selection-control-color: #8d949ea8;-webkit-font-smoothing:antialiased!important;text-rendering:optimizeLegibility!important}.style_module_cosmograph-ui__5acb97f1{background:var(--cosmograph-ui-background);color:var(--cosmograph-ui-text)}.style_module_scrollbar__f1516254 *::-webkit-scrollbar{width:5px;height:5px;border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-track{border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-corner{background:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-button{display:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-thumb{background-color:var(--cosmograph-scrollbar-background);transition:background-color .5s;border-radius:20px;border:3px solid var(--cosmograph-scrollbar-background)}@-moz-document url-prefix(){.style_module_scrollbar__f1516254 *{scrollbar-width:thin;scrollbar-color:var(--cosmograph-scrollbar-background) transparent;scrollbar-track-color:transparent;scrollbar-face-color:var(--cosmograph-scrollbar-background)}}:root{--cosmograph-histogram-background: var(--cosmograph-ui-background);--cosmograph-histogram-text-color: var(--cosmograph-ui-text);--cosmograph-histogram-axis-color: var(--cosmograph-ui-text);--cosmograph-histogram-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-histogram-selection-opacity: .5;--cosmograph-histogram-bar-color: var(--cosmograph-ui-element-color);--cosmograph-histogram-highlighted-bar-color: var( --cosmograph-ui-highlighted-element-color);--cosmograph-histogram-font-family: var(--cosmograph-ui-font-family);--cosmograph-histogram-font-size: var(--cosmograph-ui-tick-font-size)}.style_module_histogram__9d8a77ea{position:relative;display:flex;min-height:25px;background:var(--cosmograph-histogram-background);width:100%}.style_module_histogramSvg__ccccb628{position:relative;width:100%;height:100%}.style_module_selection__7db96137{fill:var(--cosmograph-histogram-selection-color);fill-opacity:var(--cosmograph-histogram-selection-opacity);stroke:none}.style_module_axisTick__898e1f39{color:var(--cosmograph-histogram-axis-color);font-family:var(--cosmograph-histogram-font-family);font-size:var(--cosmograph-histogram-font-size);user-select:none;-webkit-user-select:none;alignment-baseline:text-before-edge;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum"}.style_module_bar__3c9ab488{fill:var(--cosmograph-histogram-bar-color);transform:scaleY(-1)}.style_module_highlightedBar__b193a8de{fill:var(--cosmograph-histogram-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-bars-font-color: var(--cosmograph-ui-text);--cosmograph-bars-font-family: var(--cosmograph-ui-font-family);--cosmograph-bars-font-size: var(--cosmograph-ui-font-size);--cosmograph-bars-ui-font-size: 11.5px;--cosmograph-bars-background: var(--cosmograph-ui-element-color);--cosmograph-bars-bar-height: 20px;--cosmograph-bars-bar-bottom-margin: 2px;--cosmograph-bars-highlighted-color: var( --cosmograph-ui-highlighted-element-color)}.style_module_bars__25497ded{position:relative;width:100%;min-height:100px;user-select:none;flex-direction:column;-webkit-user-select:none}.style_module_bars__25497ded .scroll-container{position:relative;width:100%;overflow-y:hidden;overflow-x:hidden}.style_module_bars__25497ded .bars-container{position:relative;width:calc(100% - 1px);font-family:var(--cosmograph-bars-font-family)}.style_module_bars__25497ded .highlighted-bars-container{position:absolute;top:0;left:0;pointer-events:none}.style_module_bars__25497ded .row{height:var(--cosmograph-bars-bar-height);display:flex;align-items:center;margin-bottom:var(--cosmograph-bars-bar-bottom-margin);width:100%;transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row:hover{filter:brightness(1.15) contrast(1.05);transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row.unselected:hover{filter:brightness(.95) contrast(1.15);transition:filter .05s linear}.style_module_bars__25497ded .unselected{opacity:.85;filter:brightness(.8) contrast(1.1)}.style_module_bars__25497ded .selected{filter:brightness(1.05) contrast(1.05)}.style_module_bars__25497ded .selected>.info>.label{font-weight:600;filter:brightness(1.1) contrast(1.05)}.style_module_bars__25497ded .unselected>.info>.label{font-weight:300}.style_module_bars__25497ded .bar{height:100%;background-color:var(--cosmograph-bars-background);opacity:.8;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .bar-highlighted{height:100%;background-color:var(--cosmograph-bars-highlighted-color);opacity:.2;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .info{display:flex;justify-content:space-between;width:100%;padding:0 4px;position:absolute;font-size:var(--cosmograph-bars-font-size);font-feature-settings:"tnum";color:var(--cosmograph-bars-font-color);gap:2px}.style_module_bars__25497ded .label{min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:opacity .05s linear}.style_module_bars__25497ded .count{flex-shrink:0;font-weight:300;opacity:.8;transition:opacity .05s linear}.style_module_bars__25497ded .show-more{cursor:pointer;padding-top:2px;display:flex;font-weight:300;color:var(--cosmograph-bars-font-color);font-size:11px;justify-content:space-between;opacity:.6;font-size:var(--cosmograph-bars-ui-font-size);pointer-events:none;transition:opacity .1s linear}.style_module_bars__25497ded .show-more:hover{opacity:1;text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .show-more>span{pointer-events:all}.style_module_bars__25497ded .show-more-count{padding-right:5px;pointer-events:all;font-feature-settings:"tnum"}.style_module_bars__25497ded .unselected>.info>.label,.style_module_bars__25497ded .unselected>.info>.count{opacity:.5}.style_module_bars__25497ded .unselected:hover>.info>.label,.style_module_bars__25497ded .unselected:hover>.info>.count{opacity:1}.style_module_bars__25497ded .search-input{background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,.3);font-size:13px!important;color:var(--cosmograph-bars-font-color);line-height:1.5;padding:2px;width:100%;position:relative;transition:border-bottom-color .2s}.style_module_bars__25497ded .search-input::placeholder{color:var(--cosmograph-bars-font-color)!important;opacity:.4;font-weight:300;font-family:inherit}.style_module_bars__25497ded .search-container{position:relative;width:100%;margin-bottom:4px;display:none;z-index:1}.style_module_bars__25497ded .clear-button{position:absolute;right:0;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--cosmograph-bars-font-color);font-weight:300;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_bars__25497ded .clear-button.visible:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_bars__25497ded .clear-button.visible{opacity:.7}.style_module_bars__25497ded .clear-button svg{width:10px;height:10px;fill:currentColor}.style_module_bars__25497ded .sorting-block{visibility:hidden;margin-top:1px;display:flex;justify-content:space-between}.style_module_bars__25497ded .buttons-container{margin-top:4px;font-size:var(--cosmograph-bars-ui-font-size);display:flex;gap:4px;line-height:1.25}.style_module_bars__25497ded .buttons-container>div{transition:opacity .05s linear,filter .05s linear;padding:1px 5px;background:var(--cosmograph-bars-background);border-radius:4px;opacity:.9;display:flex;cursor:pointer;align-items:center}.style_module_bars__25497ded .buttons-container>div:hover{filter:brightness(1.2)}.style_module_bars__25497ded .reset-text{transition:opacity .05s linear,filter .05s linear;display:flex;font-size:var(--cosmograph-bars-ui-font-size);align-items:end;padding-right:4px;cursor:pointer;font-weight:300}.style_module_bars__25497ded .reset-text:hover{text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .reset-text.unselected{pointer-events:none;cursor:default;opacity:.7}.style_module_bars__25497ded :scope.reset-text:hover:not(.unselected){filter:brightness(1.5);opacity:1}:root{--cosmograph-size-legend-form-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-family: inherit;--cosmograph-size-legend-font-size: var(--cosmograph-ui-font-size);--cosmograph-size-legend-sublabel-font-size: 10px;--cosmograph-size-legend-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-size-legend-line-radius: 2px;--cosmograph-size-legend-line-width: 30px;--cosmograph-size-legend-hide-transform: translateY(100%);--cosmograph-size-legend-show-transform: translateX(0)}.style_module_container__d2889234{display:flex;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;overflow:hidden;min-height:25px}.style_module_legend__75c167f2{width:auto;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-size-legend-font-size);font-family:var(--cosmograph-size-legend-font-family);user-select:none;-webkit-user-select:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.04em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__91eae57a{opacity:1;transform:var(--cosmograph-size-legend-show-transform)}.style_module_disabled__d51f7a10{opacity:0;transform:var(--cosmograph-size-legend-hide-transform);pointer-events:none;display:none!important;min-height:0}@starting-style{.style_module_container__d2889234.style_module_enabled__91eae57a,.style_module_legend__75c167f2.style_module_enabled__91eae57a{opacity:0;transform:var(--cosmograph-size-legend-hide-transform)}}.style_module_legend__75c167f2 .circle{background-color:var(--cosmograph-size-legend-form-color);border-radius:50%;transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2 .line{background-color:var(--cosmograph-size-legend-form-color);border-radius:var(--cosmograph-size-legend-line-radius);width:var(--cosmograph-size-legend-line-width);transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2.style_module_events__894316a8{pointer-events:auto;cursor:pointer}.style_module_legend__75c167f2 .legend-content{display:flex;align-items:end;justify-content:center;gap:.75rem}.style_module_legend__75c167f2 .legend-content>div{transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__75c167f2 .labels-wrapper{white-space:nowrap}.style_module_legend__75c167f2 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-size-legend-items-margin)}.style_module_legend__75c167f2 .name{align-items:center;text-align:center;justify-content:center;display:flex;color:var(--cosmograph-size-legend-font-color);overflow:hidden;width:100%;margin-top:3px;word-break:break-all;white-space:pre-line;transition:color .15s ease-in-out;letter-spacing:-.02em}.style_module_legend__75c167f2 .label{color:var(--cosmograph-size-legend-font-color);overflow:hidden;transition:color .15s ease-in-out;text-overflow:ellipsis;font-feature-settings:"tnum"}.style_module_legend__75c167f2 .sublabel{padding-top:1px;font-size:var(--cosmograph-size-legend-sublabel-font-size);opacity:.5;line-height:1;min-width:10px;transition:color .15s ease-in-out}.style_module_hovered__1206707f .label,.style_module_hovered__1206707f .sublabel{color:var(--cosmograph-size-legend-hover-color);cursor:pointer}.style_module_hovered__1206707f .circle,.style_module_hovered__1206707f .line{background-color:var(--cosmograph-size-legend-hover-color);cursor:pointer}:root{--cosmograph-color-legend-range-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-range-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-range-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-label-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-sublabel-font-size: 10px;--cosmograph-color-legend-range-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-range-gradient-height: 6px;--cosmograph-color-legend-range-gradient-radius: 8px;--cosmograph-color-legend-range-gradient-top-margin: 6px;--cosmograph-color-legend-hide-transform: translateY(100%);--cosmograph-color-legend-show-transform: translateX(0)}.style_module_container__05cc807d{display:flex;min-width:150px;min-height:25px;width:100%;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_legend__a3e235e4{width:100%;font-weight:300;letter-spacing:-.04em;display:flex;flex-direction:column;font-size:var(--cosmograph-color-legend-range-font-size);font-family:var(--cosmograph-color-legend-range-font-family);user-select:none;-webkit-user-select:none;pointer-events:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__b3120e27{opacity:1;transform:var(--cosmograph-color-legend-show-transform);pointer-events:auto}.style_module_disabled__c2dc158c{opacity:0;transform:var(--cosmograph-color-legend-hide-transform);pointer-events:none;display:none;min-height:0}@starting-style{.style_module_container__05cc807d.style_module_enabled__b3120e27,.style_module_legend__a3e235e4.style_module_enabled__b3120e27{opacity:0;transform:var(--cosmograph-color-legend-hide-transform)}}.style_module_legend__a3e235e4 .legend-content{display:flex;align-items:end;justify-content:space-between}.style_module_hovered__dfd7bb2c .label,.style_module_hovered__dfd7bb2c .sublabel{color:var(--cosmograph-size-legend-hover-color)!important;cursor:pointer}.style_module_legend__a3e235e4 .extent{white-space:nowrap;transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__a3e235e4 .gradient{width:100%;margin-top:var(--cosmograph-color-legend-range-gradient-top-margin);height:var(--cosmograph-color-legend-range-gradient-height);border-radius:var(--cosmograph-color-legend-range-gradient-radius)}.style_module_legend__a3e235e4 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-color-legend-range-items-margin)}.style_module_legend__a3e235e4 .name{align-items:center;text-align:center;justify-content:space-around;display:flex;color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;width:100%;word-break:break-word;text-wrap:balance;white-space:pre-line;transition:color .15s ease-in-out;margin:0 4px;letter-spacing:-.02em;line-height:1.25}.style_module_legend__a3e235e4 .label{color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;max-width:150px;text-overflow:ellipsis;font-size:var(--cosmograph-color-legend-range-label-font-size);transition:color .15s ease-in-out;line-height:1;font-feature-settings:"tnum"}.style_module_legend__a3e235e4 .sublabel{padding-top:1px;color:var(--cosmograph-color-legend-range-font-color);opacity:.55;font-size:var(--cosmograph-color-legend-range-sublabel-font-size);line-height:1;transition:color .15s ease-in-out}:root{--cosmograph-color-legend-type-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-type-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-type-font-size: 11px;--cosmograph-color-legend-type-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-type-others-color: #bab0ab;--cosmograph-color-legend-type-bullet-size: 8px;--cosmograph-color-legend-type-bullet-radius: 1rem;--cosmograph-color-legend-type-items-margin: 4px;--cosmograph-color-legend-type-hide-transform: translateY(125%);--cosmograph-color-legend-type-show-transform: translateX(0)}.style_module_enabled__277b2403{opacity:1;transform:var(--cosmograph-color-legend-type-show-transform)}.style_module_disabled__7a587f96{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform);display:none!important;min-height:0}.style_module_wrapper__ea8ca7f4{position:relative;max-width:100%;width:fit-content;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_typeLegend__15bf4b2f{position:relative;width:fit-content;max-width:100%;min-height:25px;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.015em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_typeLegend__15bf4b2f .reverted{flex-direction:row-reverse}.style_module_typeLegend__15bf4b2f .scroll-container{width:100%;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-color-legend-type-font-size);font-family:var(--cosmograph-color-legend-type-font-family);user-select:none;-webkit-user-select:none;line-height:normal;overflow-x:hidden;overflow-y:auto;will-change:transform}@starting-style{.style_module_typeLegend__15bf4b2f.style_module_enabled__277b2403,.style_module_wrapper__ea8ca7f4.style_module_enabled__277b2403{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform)}}.style_module_typeLegend__15bf4b2f .legend-item{display:flex;align-items:center;position:absolute;margin-bottom:var(--cosmograph-color-legend-type-items-margin);pointer-events:none;width:100%;padding-left:1px;font-weight:300;transition:filter .1s ease-in-out,opacity .1s ease-in-out;min-height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px + var(--cosmograph-color-legend-type-items-margin));height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px);box-sizing:border-box}.style_module_typeLegend__15bf4b2f .unknown{background-color:var(--cosmograph-color-legend-type-unknown-color)}.style_module_typeLegend__15bf4b2f .others{background-color:var(--cosmograph-color-legend-type-others-color)}.style_module_typeLegend__15bf4b2f .bullet{height:var(--cosmograph-color-legend-type-bullet-size);width:var(--cosmograph-color-legend-type-bullet-size);min-height:var(--cosmograph-color-legend-type-bullet-size);min-width:var(--cosmograph-color-legend-type-bullet-size);border-radius:var(--cosmograph-color-legend-type-bullet-radius);pointer-events:all;margin-right:5px}.style_module_typeLegend__15bf4b2f .label{color:var(--cosmograph-color-legend-type-font-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - var(--cosmograph-color-legend-type-bullet-size) - 5px);pointer-events:all;transition:.05s linear color}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.bullet{margin-right:0}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.label{margin-right:5px}.style_module_typeLegend__15bf4b2f .show-more{cursor:pointer;padding-top:4px;display:none;font-weight:300;color:var(--cosmograph-color-legend-type-font-color);font-size:11px;opacity:.6;pointer-events:all;justify-content:space-between;transition:opacity .1s linear;font-feature-settings:"tnum"}.style_module_typeLegend__15bf4b2f .show-more:hover{opacity:1}.style_module_hovered__c0993502 .label,.style_module_hovered__c0993502 .sublabel{color:var(--cosmograph-color-legend-type-hover-color)!important;cursor:pointer}.style_module_selected__36e1dd81{filter:brightness(1)}.style_module_selected__36e1dd81>.style_module_label__afecc7a3{filter:brightness(1.2)}.style_module_unselected__4826cfb7{filter:brightness(.5)}.style_module_typeLegend__15bf4b2f .name{font-size:calc(var(--cosmograph-color-legend-type-font-size) + 1px);font-family:var(--cosmograph-color-legend-type-font-family);color:var(--cosmograph-color-legend-type-font-color);transition:color .15s ease-in-out,opacity .3s ease-in-out,max-height .3s ease-in-out,transform .3s ease-in-out;margin-bottom:4px;margin-top:2px;margin-left:1px;letter-spacing:-.02em;line-height:1.25;overflow:hidden;width:100%;white-space:nowrap;text-overflow:ellipsis;pointer-events:all;-webkit-user-select:none!important;user-select:none!important;max-height:100px;opacity:1;transform:translateY(0)}.style_module_typeLegend__15bf4b2f .name.hidden{opacity:0;max-height:0;margin-bottom:0;margin-top:0;transform:translateY(-10px)}:root{--cosmograph-button-color: var(--cosmograph-ui-text);--cosmograph-button-background: var(--cosmograph-ui-element-color);--cosmograph-button-border-radius: 2px}.style_module_button__e95a1138{background:var(--cosmograph-button-background);color:var(--cosmograph-button-color);border-radius:var(--cosmograph-button-border-radius);display:none;align-items:center;justify-content:center;width:25px;height:25px;margin:3px;padding:5px;cursor:pointer;filter:brightness(.95) contrast(.9);transition:filter .1s}.style_module_button__e95a1138:hover{filter:brightness(1.2) contrast(1)}')),document.head.appendChild(e)}}catch(_C){console.error("vite-plugin-css-injected-by-js",_C)}}();var SB=Object.defineProperty,EB=(e,t,n)=>((e,t,n)=>t in e?SB(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);let TB=class extends qO{constructor(e,t){const n=IO(wB,t??{});super(e,qO.extractConfig(n,wB)),EB(this,"_data",[]),EB(this,"_originalData",[]),EB(this,"_config"),EB(this,"_container"),EB(this,"_searchContainer"),EB(this,"_searchInput"),EB(this,"_clearButton"),EB(this,"_scrollContainer"),EB(this,"_barsContainer"),EB(this,"_highlightedBarsContainer"),EB(this,"_showMoreButton"),EB(this,"_showMoreCount"),EB(this,"_sortingBlock"),EB(this,"_uniqueValues",new Set),EB(this,"_countMap",new Int32Array(0)),EB(this,"_visibleItemsCount",0),EB(this,"_hiddenItemsSum",0),EB(this,"_itemHeight",0),EB(this,"_itemMargin",0),EB(this,"_startIndex",0),EB(this,"_endIndex",0),EB(this,"_maxCount",0),EB(this,"_selectedItem"),EB(this,"_isExpanded",!1),EB(this,"_sortingHandlers"),EB(this,"_highlightedCounts"),EB(this,"_isFilteringActive",!1),EB(this,"_updateVisibleItems",()=>{const e=this._itemHeight+this._itemMargin;this._startIndex=Math.floor(this._scrollContainer.scrollTop/e),this._endIndex=Math.min(this._startIndex+this._visibleItemsCount+1,this._data.length),this._renderItems()}),EB(this,"_handleShowMoreCount",()=>{var e,t,n,i,o,r;const s=this._data.length-this._maxDisplayedItems,a=(null==(t=(e=this._config).countFormatter)?void 0:t.call(e,this._hiddenItemsSum))??this._hiddenItemsSum.toString();if(this._isFilteringActive&&this._config.showTotalWhenFiltered){const e=this._data.slice(this._maxDisplayedItems).reduce((e,t)=>e+t.count,0),t=(null==(i=(n=this._config).countFormatter)?void 0:i.call(n,e))??e.toString();this._showMoreCount.textContent=`${a} / ${t}`}else this._showMoreCount.textContent=a;this._showMoreButton.firstChild.textContent=`${(null==(r=(o=this._config).countFormatter)?void 0:r.call(o,s))??s.toString()} more`}),EB(this,"_handleScroll",()=>{this._updateVisibleItems()}),EB(this,"_handleSort",()=>{"alphabetical"===this._config.sort?this.sortAlphabetically(this._config.sortAscending):this.sortByCount(this._config.sortAscending)}),EB(this,"_handleSearch",()=>{const e=this._searchInput.value.toLowerCase();this._clearButton.classList[e?"add":"remove"]("visible"),this._data=this._originalData.filter(t=>String(t.label).toLowerCase().includes(e)),this._handleSort()}),EB(this,"_clearSearch",()=>{this._searchInput.value="",this._handleSearch()}),EB(this,"_handleShowMore",()=>{this._isExpanded=!this._isExpanded,this._isExpanded?(this._scrollContainer.style.overflowY="auto",this._showMoreButton.firstChild.textContent="show less",this._showMoreCount.textContent=""):(this._scrollContainer.style.overflowY="hidden",this._scrollContainer.scrollTop=0,this._handleShowMoreCount())}),this._config=n,this._container=e,this._container.classList.add("style_module_bars__25497ded"),this._container.classList.add(uB),this._scrollContainer=document.createElement("div"),this._scrollContainer.classList.add("scroll-container"),this._barsContainer=document.createElement("div"),this._barsContainer.classList.add("bars-container"),this._highlightedBarsContainer=document.createElement("div"),this._highlightedBarsContainer.classList.add("bars-container","highlighted-bars-container"),this._scrollContainer.appendChild(this._barsContainer),this._scrollContainer.appendChild(this._highlightedBarsContainer),this._showMoreButton=this._createShowMoreButton(),this._sortingBlock=this._createSortingBlock(),this._searchContainer=this._createSearch(),this._container.appendChild(this._searchContainer),this._container.appendChild(this._scrollContainer),this._container.appendChild(this._showMoreButton),this._container.appendChild(this._sortingBlock),this._scrollContainer.addEventListener("scroll",this._handleScroll,{passive:!0})}get _maxDisplayedItems(){return this._config.maxDisplayedItems??10}_createSearch(){const e=document.createElement("div");return e.classList.add("search-container"),this._clearButton=document.createElement("button"),this._clearButton.classList.add("clear-button"),this._clearButton.innerHTML="×",this._clearButton.addEventListener("click",this._clearSearch),this._searchInput=document.createElement("input"),this._searchInput.classList.add("search-input"),this._searchInput.placeholder="Search...",this._searchInput.addEventListener("input",this._handleSearch),e.appendChild(this._searchInput),e.appendChild(this._clearButton),e}_updateButtonState(e,t){e.classList.add("selected"),e.classList.remove("unselected"),t.classList.add("unselected"),t.classList.remove("selected")}_updateArrowText(e,t,n){e.textContent=`${t?"↑":"↓"}${n}`}_createSortingHandlers(e,t,n,i){return{alpha:()=>{"alphabetical"===this._config.sort&&(n=!n,this._updateArrowText(e,n,"ABC")),this._config.sort="alphabetical",this._config.sortAscending=n,this._updateButtonState(e,t),this._handleSort()},numeric:()=>{"count"===this._config.sort&&(i=!i,this._updateArrowText(t,i,"123")),this._config.sort="count",this._config.sortAscending=i,this._updateButtonState(t,e),this._handleSort()},reset:()=>{var e,t;null==(t=(e=this._config).onClick)||t.call(e,void 0),this.setSelectedItem(void 0)}}}_createSortingBlock(){const e=document.createElement("div"),t=document.createElement("div"),[n,i]=[document.createElement("div"),document.createElement("div")],o=document.createElement("div");e.classList.add("sorting-block"),t.classList.add("buttons-container"),o.classList.add("reset-text","unselected");const r="alphabetical"!==this._config.sort||this._config.sortAscending,s="count"!==this._config.sort||this._config.sortAscending;return this._updateArrowText(n,r??!1,"ABC"),this._updateArrowText(i,s??!1,"123"),o.textContent="reset selection",this._config.sort&&this._updateButtonState("alphabetical"===this._config.sort?n:i,"alphabetical"===this._config.sort?i:n),this._sortingHandlers=this._createSortingHandlers(n,i,r??!1,s??!1),n.addEventListener("click",this._sortingHandlers.alpha),i.addEventListener("click",this._sortingHandlers.numeric),o.addEventListener("click",this._sortingHandlers.reset),t.append(n,i),e.append(t,o),e}_createShowMoreButton(){const e=document.createElement("div");e.classList.add("show-more"),e.addEventListener("click",this._handleShowMore);const t=document.createElement("span");return this._showMoreCount=document.createElement("span"),this._showMoreCount.classList.add("show-more-count"),e.appendChild(t),e.appendChild(this._showMoreCount),e}_calculateVisibleItems(){const e=this._itemHeight+this._itemMargin;this._visibleItemsCount=Math.ceil(this._scrollContainer.clientHeight/e)}_createBarElement(e,t=!1,n){var i,o,r,s,a,l,c;if(t){const t=document.createElement("div");t.classList.add("bar-highlighted"),t.dataset.label=e.label,t.style.position="absolute";const i=n/e.count*(e.count/this._maxCount)*100;return t.style.width=`${i}%`,t}const u=document.createElement("div");if(u.classList.add("row"),u.style.position="absolute",null!=(i=this._config)&&i.onClick&&(u.style.cursor="pointer",u.addEventListener("click",()=>{var t,n;return null==(n=(t=this._config).onClick)?void 0:n.call(t,e)})),this._selectedItem){const t=this._container.querySelector(".reset-text");null==t||t.classList.remove("unselected"),null==t||t.classList.add("selected"),u.classList.add(this._selectedItem.label===e.label?"selected":"unselected")}const h=e.count/this._maxCount*100,d=document.createElement("div");d.classList.add("bar"),d.style.width=`${h}%`;const p=document.createElement("div");p.classList.add("info");const f=document.createElement("div");f.classList.add("label"),f.textContent=e.label,f.title=e.label;const m=document.createElement("div");if(m.classList.add("count"),this._isFilteringActive&&void 0!==n){const t=(null==(r=(o=this._config).countFormatter)?void 0:r.call(o,n))??n.toString();if(this._config.showTotalWhenFiltered){const n=(null==(a=(s=this._config).countFormatter)?void 0:a.call(s,e.count))??e.count.toString();m.textContent=`${t} / ${n}`}else m.textContent=t}else m.textContent=(null==(c=(l=this._config).countFormatter)?void 0:c.call(l,e.count))??e.count.toString();return p.append(f,m),u.append(d,p),u}_renderItems(){this._renderItemsToContainer(this._barsContainer,!1),this._renderItemsToContainer(this._highlightedBarsContainer,!0)}_renderItemsToContainer(e,t){var n;const i=this._itemHeight+this._itemMargin;if(t){if(!this._highlightedCounts)return void e.replaceChildren();const t=new Map;for(const i of Array.from(e.children)){const e=i;e.classList.contains("bar-highlighted")&&e.dataset.label&&t.set(e.dataset.label,e)}const n=new Set;for(let o=this._startIndex;o<this._endIndex;o++){const r=this._data[o];if(!r)continue;const s=this._highlightedCounts.get(r.label)||0;if(s>0){n.add(r.label);const a=t.get(r.label);if(a){const e=s/r.count*(r.count/this._maxCount)*100;a.style.width=`${e}%`,a.style.top=o*i+"px"}else{const t=this._createBarElement(r,!0,s);t.style.top=o*i+"px",t.style.height=`${this._itemHeight}px`,e.appendChild(t)}}}for(const[e,i]of t)n.has(e)||i.remove()}else{const t=document.createDocumentFragment();for(let e=this._startIndex;e<this._endIndex;e++){const o=this._data[e];if(!o)continue;const r=(null==(n=this._highlightedCounts)?void 0:n.get(o.label))||0,s=this._createBarElement(o,!1,r);s.style.top=e*i+"px",s.style.height=`${this._itemHeight}px`,t.appendChild(s)}e.replaceChildren(t)}}_updateContainerHeights(e){const t=Math.min(this._originalData.length,this._maxDisplayedItems)*e;this._scrollContainer.style.height=`${t}px`;const n=this._data.length*e+"px";this._barsContainer.style.height=n,this._highlightedBarsContainer.style.height=n}_updateShowMoreButton(){if(this._originalData.length>this._maxDisplayedItems){const e=this._data.length>this._maxDisplayedItems;this._showMoreButton.style.visibility=e?"visible":"hidden",this._showMoreButton.style.display="flex"}else this._showMoreButton.style.display="none"}_updateUIElements(e=wB.showSortingBlock,t=wB.showSearch){this._originalData.length?this._data.length?(this._sortingBlock.style.visibility=e?"visible":"hidden",this._searchContainer.style.display=t?"block":"none",this.hideState(),this._scrollContainer.style.visibility="visible"):(this._sortingBlock.style.visibility=e?"visible":"hidden",this._searchContainer.style.display=t?"block":"none",this._scrollContainer.style.visibility="visible",this.showState(this._searchInput.value.length?"No results found":void 0)):(this._sortingBlock.style.visibility="hidden",this._searchContainer.style.display="none",this._scrollContainer.style.visibility="hidden",this._showMoreButton.style.display="none",this.showState())}_render(){this._maxCount=Math.max(...this._data.map(e=>e.count),1),this._calculateItemDimensions();const{showSortingBlock:e,showSearch:t}=this._config,n=this._itemHeight+this._itemMargin;this._updateContainerHeights(n),this._updateShowMoreButton(),this._updateUIElements(e,t),this._calculateVisibleItems(),this._updateVisibleItems()}_calculateItemDimensions(){if(!this._data.length)return;const e=this._createBarElement(this._data[0]);this._barsContainer.appendChild(e);const t=window.getComputedStyle(e);this._itemHeight=e.offsetHeight,this._itemMargin=parseFloat(t.marginTop)+parseFloat(t.marginBottom),this._barsContainer.removeChild(e)}_calcHiddenSum(){if(this._data.length>this._maxDisplayedItems){const e=this._data.slice(this._maxDisplayedItems);this._isFilteringActive?this._hiddenItemsSum=e.reduce((e,t)=>{var n;return e+((null==(n=this._highlightedCounts)?void 0:n.get(t.label))||0)},0):this._hiddenItemsSum=e.reduce((e,t)=>e+t.count,0)}else this._hiddenItemsSum=0;this._handleShowMoreCount()}getConfig(){return this._config}setConfig(e){this._config=IO(wB,e??{}),this.setDisplayStateConfig(qO.extractConfig(this._config,wB)),this._isExpanded=(null==e?void 0:e.expanded)??!1,this._calcHiddenSum(),this._render()}setData(e=[]){var t,n;this._clearSearch(),this._uniqueValues=new Set(e),this._countMap=new Int32Array(this._uniqueValues.size);const i=new Map([...this._uniqueValues].map((e,t)=>[e,t]));e.forEach(e=>{const t=i.get(e);void 0!==t&&this._countMap[t]++}),this._data=[...this._uniqueValues].map((e,t)=>({label:e,count:this._countMap[t]||0})),this._originalData=[...this._data],!this._originalData.length&&this._selectedItem&&(this.setSelectedItem(void 0),null==(n=(t=this._config).onClick)||n.call(t,void 0)),this._searchContainer.style.display=this._originalData.length?"block":"none",this._handleSort()}sortByCount(e=!1){this._data.sort((t,n)=>e?t.count-n.count:n.count-t.count),this._calcHiddenSum(),this._render()}sortAlphabetically(e=!0){this._data.sort((t,n)=>e?t.label.toString().localeCompare(n.label):n.label.toString().localeCompare(t.label)),this._calcHiddenSum(),this._render()}destroy(){this._scrollContainer.removeEventListener("scroll",this._handleScroll),this._searchInput.removeEventListener("input",this._handleSearch),this._clearButton.removeEventListener("click",this._clearSearch),this._showMoreButton.removeEventListener("click",this._handleShowMore);const e=this._sortingBlock.querySelector("div:first-child"),t=this._sortingBlock.querySelector("div:nth-child(2)"),n=this._sortingBlock.querySelector(".reset-text");null==e||e.removeEventListener("click",this._sortingHandlers.alpha),null==t||t.removeEventListener("click",this._sortingHandlers.numeric),null==n||n.removeEventListener("click",this._sortingHandlers.reset),this._container.innerHTML="",this._data=[],this._originalData=[],this._uniqueValues.clear(),this._countMap=new Int32Array(0),this._hiddenItemsSum=0,this._highlightedCounts=void 0,this._isFilteringActive=!1,super.destroy()}resetList(){this._scrollContainer.scrollTop=0,this._searchInput.value="",this._selectedItem=void 0,this._highlightedCounts=void 0,this._isFilteringActive=!1,this._data=[...this._originalData],this._updateVisibleItems()}getSelectedItem(){return this._selectedItem}setSelectedItem(e){if(!e){const e=this._container.querySelector(".reset-text");null==e||e.classList.remove("selected"),null==e||e.classList.add("unselected")}this._selectedItem=e,this._updateVisibleItems()}setHighlightedData(e){if(null==e)this._highlightedCounts=void 0,this._isFilteringActive=!1;else{this._highlightedCounts=new Map;for(const n of e)this._highlightedCounts.set(n,(this._highlightedCounts.get(n)||0)+1);const t=this._originalData.reduce((e,t)=>e+t.count,0);this._isFilteringActive=e.length<t}this._calcHiddenSum(),this._renderItems()}setLoadingState(){super.setLoadingState()}};const CB={hidden:!1,label:void 0,labelFormatter:AO,extent:void 0,extentLabels:void 0,enableEvents:!0,form:"point",showSublabels:!1,minSubLabel:"min",maxSubLabel:"max",sizeMultiplier:void 0,onClick:void 0,onMinClick:void 0,onMaxClick:void 0,onHover:void 0,noDataMessage:"No legend data",loadingMessage:"Data loading..."},IB="style_module_enabled__91eae57a",AB="style_module_disabled__d51f7a10";!function(){try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode('@keyframes style_module_fadeIn__ffac87fd{0%{opacity:0}to{opacity:.2}}.style_module_displayState__6ae19b84{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--cosmograph-ui-text);display:flex;justify-content:center;align-items:center;min-width:100px;opacity:.2;font-size:calc(var(--cosmograph-ui-font-size) + 1px);letter-spacing:-.02em;font-weight:200;user-select:none;-webkit-user-select:none;animation:style_module_fadeIn__ffac87fd .3s ease-in-out}:root{--cosmograph-timeline-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-timeline-selection-opacity: .5;--cosmograph-timeline-bar-color: var(--cosmograph-ui-element-color);--cosmograph-timeline-highlighted-bar-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-timeline-font-family: var(--cosmograph-ui-font-family);--cosmograph-timeline-font-size: var(--cosmograph-ui-tick-font-size);--cosmograph-timeline-background: var(--cosmograph-ui-background);--cosmograph-timeline-text-color: var(--cosmograph-ui-text);--cosmograph-timeline-axis-color: var(--cosmograph-ui-text)}.style_module_timeline__736434f7{position:relative;display:flex;background:var(--cosmograph-timeline-background);width:100%;min-height:25px;overflow:hidden}.style_module_timelineSvg__b916ad04{position:relative;width:100%;height:100%}.style_module_selection__ebee57f8{fill:var(--cosmograph-timeline-selection-color);fill-opacity:var(--cosmograph-timeline-selection-opacity);stroke:none}.style_module_axisTick__5865631d{color:var(--cosmograph-timeline-axis-color);font:var(--cosmograph-timeline-font-family);font-size:var(--cosmograph-timeline-font-size);user-select:none;-webkit-user-select:none;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum";alignment-baseline:text-before-edge}.style_module_axisLine__992b502d{opacity:.2;color:var(--cosmograph-timeline-axis-color)}.style_module_bar__114fa79f{fill:var(--cosmograph-timeline-bar-color);transform:scaleY(-1);opacity:0}.style_module_animationControl__ee52cd66{color:var(--cosmograph-timeline-axis-color);width:6%;max-width:30px;min-width:20px;cursor:pointer;display:none;align-items:center;user-select:none;-webkit-user-select:none;opacity:.5;position:relative;justify-content:center}.style_module_animationControl__ee52cd66>svg{width:50%;max-height:20px;padding-right:2px}.style_module_hidden__a73fe81a{display:none}.style_module_disabled__eb988570{opacity:.2;pointer-events:none}.style_module_highlightedBar__c2fc9bdc{fill:var(--cosmograph-timeline-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-search-font-family: var(--cosmograph-ui-font-family);--cosmograph-search-font-size: 14px;--cosmograph-search-list-font-size: 13.5px;--cosmograph-search-text-color: var(--cosmograph-ui-text);--cosmograph-search-background: transparent;--cosmograph-search-list-background: rgba(0, 0, 0, .2);--cosmograph-search-list-match-background: rgba(255, 255, 255, .2);--cosmograph-search-list-match-color: var(--cosmograph-ui-text)}.style_module_searchInput__d7830601:hover{filter:brightness(1.2) contrast(1)}.style_module_searchInput__d7830601{width:100%;background:transparent;color:var(--cosmograph-search-text-color);border:none;border-bottom:.5px solid var(--cosmograph-search-text-color);padding:4px 20px 5px 2px;font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:opacity .2s ease-out}.style_module_searchInput__d7830601::selection{background:var(--cosmograph-search-list-match-background)}.style_module_searchInput__d7830601:focus{outline:none}.style_module_searchSuggestions__b0d3f71e{color:#fff;width:100%;padding:0;margin:0;background:transparent;overflow-y:auto;flex:1;min-height:0}.style_module_searchSuggestions__b0d3f71e li{padding:5px 10px;cursor:pointer;-webkit-user-select:none;user-select:none;display:block;font-weight:500;font-size:var(--cosmograph-search-list-font-size);max-width:100%;overflow:hidden}.style_module_searchSuggestions__b0d3f71e li>div{white-space:nowrap;font-weight:200;overflow:hidden;text-overflow:ellipsis;width:100%}.style_module_searchSuggestions__b0d3f71e li:hover{background:#ffffff1a}.style_module_searchSuggestions__b0d3f71e mark{background:var(--cosmograph-search-list-match-background);color:var(--cosmograph-search-list-match-color);border-radius:2px}.style_module_clearButton__5ebb41de{position:absolute;right:0;top:0;height:100%;background:none;border:none;color:var(--cosmograph-search-text-color);font-weight:300;cursor:pointer;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d{opacity:.7}.style_module_placeholderWrapper__72d5eb0e{z-index:1;color:var(--cosmograph-search-text-color);font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);position:absolute;top:0;left:0;width:100%;bottom:0;display:flex;line-height:1.25;align-items:center;transition:transform .3s ease-out,opacity .3s ease-out}.style_module_placeholderWrapper__72d5eb0e.style_module_hidden__acfb8431{transform:translate(-30px);pointer-events:none;opacity:0}.style_module_searchInput__d7830601:disabled,.style_module_searchInput__d7830601.style_module_disabled__62c35dc5{opacity:.2;cursor:not-allowed;pointer-events:none}.style_module_disabled__62c35dc5 .style_module_clearButton__5ebb41de{display:none}.style_module_disabled__62c35dc5 .style_module_placeholderWrapper__72d5eb0e{opacity:.3;cursor:not-allowed}.style_module_searchInputWrapper__1edbcb22{position:relative;display:flex;width:100%}.style_module_noResults__363397c3{opacity:.3!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none}.style_module_noResults__363397c3:hover{background:none}.style_module_loading__296e0212{opacity:.7!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none;-webkit-user-select:none;user-select:none}.style_module_dropdownContainer__d98287da{position:absolute;top:100%;left:0;width:100%;background:var(--cosmograph-search-list-background);border-radius:4px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);opacity:0;transform:translateY(-10px);transition:opacity .2s ease-out,transform .2s ease-out;pointer-events:none;overflow:hidden;z-index:10;display:flex;flex-direction:column;padding-bottom:2px}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b{top:auto;bottom:100%;transform:translateY(10px)}.style_module_dropdownContainer__d98287da.style_module_visible__5be7493d{opacity:1;transform:translateY(0);pointer-events:auto}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b.style_module_visible__5be7493d{opacity:1;transform:translateY(-2px);pointer-events:auto}.style_module_footerContainer__73e7a066{flex-shrink:0}:root{--cosmograph-scrollbar-background: rgba(255, 255, 255, .1);--cosmograph-ui-background: rgb(45, 49, 58);--cosmograph-ui-text: #ffffffc7;--cosmograph-ui-tick-font-size: 11px;--cosmograph-ui-font-size: 12px;--cosmograph-ui-font-family: inherit;--cosmograph-ui-element-color: #5C616A;--cosmograph-ui-highlighted-element-color: white;--cosmograph-ui-selection-control-color: #8d949ea8;-webkit-font-smoothing:antialiased!important;text-rendering:optimizeLegibility!important}.style_module_cosmograph-ui__5acb97f1{background:var(--cosmograph-ui-background);color:var(--cosmograph-ui-text)}.style_module_scrollbar__f1516254 *::-webkit-scrollbar{width:5px;height:5px;border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-track{border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-corner{background:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-button{display:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-thumb{background-color:var(--cosmograph-scrollbar-background);transition:background-color .5s;border-radius:20px;border:3px solid var(--cosmograph-scrollbar-background)}@-moz-document url-prefix(){.style_module_scrollbar__f1516254 *{scrollbar-width:thin;scrollbar-color:var(--cosmograph-scrollbar-background) transparent;scrollbar-track-color:transparent;scrollbar-face-color:var(--cosmograph-scrollbar-background)}}:root{--cosmograph-histogram-background: var(--cosmograph-ui-background);--cosmograph-histogram-text-color: var(--cosmograph-ui-text);--cosmograph-histogram-axis-color: var(--cosmograph-ui-text);--cosmograph-histogram-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-histogram-selection-opacity: .5;--cosmograph-histogram-bar-color: var(--cosmograph-ui-element-color);--cosmograph-histogram-highlighted-bar-color: var( --cosmograph-ui-highlighted-element-color);--cosmograph-histogram-font-family: var(--cosmograph-ui-font-family);--cosmograph-histogram-font-size: var(--cosmograph-ui-tick-font-size)}.style_module_histogram__9d8a77ea{position:relative;display:flex;min-height:25px;background:var(--cosmograph-histogram-background);width:100%}.style_module_histogramSvg__ccccb628{position:relative;width:100%;height:100%}.style_module_selection__7db96137{fill:var(--cosmograph-histogram-selection-color);fill-opacity:var(--cosmograph-histogram-selection-opacity);stroke:none}.style_module_axisTick__898e1f39{color:var(--cosmograph-histogram-axis-color);font-family:var(--cosmograph-histogram-font-family);font-size:var(--cosmograph-histogram-font-size);user-select:none;-webkit-user-select:none;alignment-baseline:text-before-edge;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum"}.style_module_bar__3c9ab488{fill:var(--cosmograph-histogram-bar-color);transform:scaleY(-1)}.style_module_highlightedBar__b193a8de{fill:var(--cosmograph-histogram-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-bars-font-color: var(--cosmograph-ui-text);--cosmograph-bars-font-family: var(--cosmograph-ui-font-family);--cosmograph-bars-font-size: var(--cosmograph-ui-font-size);--cosmograph-bars-ui-font-size: 11.5px;--cosmograph-bars-background: var(--cosmograph-ui-element-color);--cosmograph-bars-bar-height: 20px;--cosmograph-bars-bar-bottom-margin: 2px;--cosmograph-bars-highlighted-color: var( --cosmograph-ui-highlighted-element-color)}.style_module_bars__25497ded{position:relative;width:100%;min-height:100px;user-select:none;flex-direction:column;-webkit-user-select:none}.style_module_bars__25497ded .scroll-container{position:relative;width:100%;overflow-y:hidden;overflow-x:hidden}.style_module_bars__25497ded .bars-container{position:relative;width:calc(100% - 1px);font-family:var(--cosmograph-bars-font-family)}.style_module_bars__25497ded .highlighted-bars-container{position:absolute;top:0;left:0;pointer-events:none}.style_module_bars__25497ded .row{height:var(--cosmograph-bars-bar-height);display:flex;align-items:center;margin-bottom:var(--cosmograph-bars-bar-bottom-margin);width:100%;transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row:hover{filter:brightness(1.15) contrast(1.05);transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row.unselected:hover{filter:brightness(.95) contrast(1.15);transition:filter .05s linear}.style_module_bars__25497ded .unselected{opacity:.85;filter:brightness(.8) contrast(1.1)}.style_module_bars__25497ded .selected{filter:brightness(1.05) contrast(1.05)}.style_module_bars__25497ded .selected>.info>.label{font-weight:600;filter:brightness(1.1) contrast(1.05)}.style_module_bars__25497ded .unselected>.info>.label{font-weight:300}.style_module_bars__25497ded .bar{height:100%;background-color:var(--cosmograph-bars-background);opacity:.8;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .bar-highlighted{height:100%;background-color:var(--cosmograph-bars-highlighted-color);opacity:.2;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .info{display:flex;justify-content:space-between;width:100%;padding:0 4px;position:absolute;font-size:var(--cosmograph-bars-font-size);font-feature-settings:"tnum";color:var(--cosmograph-bars-font-color);gap:2px}.style_module_bars__25497ded .label{min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:opacity .05s linear}.style_module_bars__25497ded .count{flex-shrink:0;font-weight:300;opacity:.8;transition:opacity .05s linear}.style_module_bars__25497ded .show-more{cursor:pointer;padding-top:2px;display:flex;font-weight:300;color:var(--cosmograph-bars-font-color);font-size:11px;justify-content:space-between;opacity:.6;font-size:var(--cosmograph-bars-ui-font-size);pointer-events:none;transition:opacity .1s linear}.style_module_bars__25497ded .show-more:hover{opacity:1;text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .show-more>span{pointer-events:all}.style_module_bars__25497ded .show-more-count{padding-right:5px;pointer-events:all;font-feature-settings:"tnum"}.style_module_bars__25497ded .unselected>.info>.label,.style_module_bars__25497ded .unselected>.info>.count{opacity:.5}.style_module_bars__25497ded .unselected:hover>.info>.label,.style_module_bars__25497ded .unselected:hover>.info>.count{opacity:1}.style_module_bars__25497ded .search-input{background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,.3);font-size:13px!important;color:var(--cosmograph-bars-font-color);line-height:1.5;padding:2px;width:100%;position:relative;transition:border-bottom-color .2s}.style_module_bars__25497ded .search-input::placeholder{color:var(--cosmograph-bars-font-color)!important;opacity:.4;font-weight:300;font-family:inherit}.style_module_bars__25497ded .search-container{position:relative;width:100%;margin-bottom:4px;display:none;z-index:1}.style_module_bars__25497ded .clear-button{position:absolute;right:0;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--cosmograph-bars-font-color);font-weight:300;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_bars__25497ded .clear-button.visible:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_bars__25497ded .clear-button.visible{opacity:.7}.style_module_bars__25497ded .clear-button svg{width:10px;height:10px;fill:currentColor}.style_module_bars__25497ded .sorting-block{visibility:hidden;margin-top:1px;display:flex;justify-content:space-between}.style_module_bars__25497ded .buttons-container{margin-top:4px;font-size:var(--cosmograph-bars-ui-font-size);display:flex;gap:4px;line-height:1.25}.style_module_bars__25497ded .buttons-container>div{transition:opacity .05s linear,filter .05s linear;padding:1px 5px;background:var(--cosmograph-bars-background);border-radius:4px;opacity:.9;display:flex;cursor:pointer;align-items:center}.style_module_bars__25497ded .buttons-container>div:hover{filter:brightness(1.2)}.style_module_bars__25497ded .reset-text{transition:opacity .05s linear,filter .05s linear;display:flex;font-size:var(--cosmograph-bars-ui-font-size);align-items:end;padding-right:4px;cursor:pointer;font-weight:300}.style_module_bars__25497ded .reset-text:hover{text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .reset-text.unselected{pointer-events:none;cursor:default;opacity:.7}.style_module_bars__25497ded :scope.reset-text:hover:not(.unselected){filter:brightness(1.5);opacity:1}:root{--cosmograph-size-legend-form-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-family: inherit;--cosmograph-size-legend-font-size: var(--cosmograph-ui-font-size);--cosmograph-size-legend-sublabel-font-size: 10px;--cosmograph-size-legend-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-size-legend-line-radius: 2px;--cosmograph-size-legend-line-width: 30px;--cosmograph-size-legend-hide-transform: translateY(100%);--cosmograph-size-legend-show-transform: translateX(0)}.style_module_container__d2889234{display:flex;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;overflow:hidden;min-height:25px}.style_module_legend__75c167f2{width:auto;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-size-legend-font-size);font-family:var(--cosmograph-size-legend-font-family);user-select:none;-webkit-user-select:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.04em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__91eae57a{opacity:1;transform:var(--cosmograph-size-legend-show-transform)}.style_module_disabled__d51f7a10{opacity:0;transform:var(--cosmograph-size-legend-hide-transform);pointer-events:none;display:none!important;min-height:0}@starting-style{.style_module_container__d2889234.style_module_enabled__91eae57a,.style_module_legend__75c167f2.style_module_enabled__91eae57a{opacity:0;transform:var(--cosmograph-size-legend-hide-transform)}}.style_module_legend__75c167f2 .circle{background-color:var(--cosmograph-size-legend-form-color);border-radius:50%;transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2 .line{background-color:var(--cosmograph-size-legend-form-color);border-radius:var(--cosmograph-size-legend-line-radius);width:var(--cosmograph-size-legend-line-width);transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2.style_module_events__894316a8{pointer-events:auto;cursor:pointer}.style_module_legend__75c167f2 .legend-content{display:flex;align-items:end;justify-content:center;gap:.75rem}.style_module_legend__75c167f2 .legend-content>div{transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__75c167f2 .labels-wrapper{white-space:nowrap}.style_module_legend__75c167f2 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-size-legend-items-margin)}.style_module_legend__75c167f2 .name{align-items:center;text-align:center;justify-content:center;display:flex;color:var(--cosmograph-size-legend-font-color);overflow:hidden;width:100%;margin-top:3px;word-break:break-all;white-space:pre-line;transition:color .15s ease-in-out;letter-spacing:-.02em}.style_module_legend__75c167f2 .label{color:var(--cosmograph-size-legend-font-color);overflow:hidden;transition:color .15s ease-in-out;text-overflow:ellipsis;font-feature-settings:"tnum"}.style_module_legend__75c167f2 .sublabel{padding-top:1px;font-size:var(--cosmograph-size-legend-sublabel-font-size);opacity:.5;line-height:1;min-width:10px;transition:color .15s ease-in-out}.style_module_hovered__1206707f .label,.style_module_hovered__1206707f .sublabel{color:var(--cosmograph-size-legend-hover-color);cursor:pointer}.style_module_hovered__1206707f .circle,.style_module_hovered__1206707f .line{background-color:var(--cosmograph-size-legend-hover-color);cursor:pointer}:root{--cosmograph-color-legend-range-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-range-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-range-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-label-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-sublabel-font-size: 10px;--cosmograph-color-legend-range-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-range-gradient-height: 6px;--cosmograph-color-legend-range-gradient-radius: 8px;--cosmograph-color-legend-range-gradient-top-margin: 6px;--cosmograph-color-legend-hide-transform: translateY(100%);--cosmograph-color-legend-show-transform: translateX(0)}.style_module_container__05cc807d{display:flex;min-width:150px;min-height:25px;width:100%;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_legend__a3e235e4{width:100%;font-weight:300;letter-spacing:-.04em;display:flex;flex-direction:column;font-size:var(--cosmograph-color-legend-range-font-size);font-family:var(--cosmograph-color-legend-range-font-family);user-select:none;-webkit-user-select:none;pointer-events:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__b3120e27{opacity:1;transform:var(--cosmograph-color-legend-show-transform);pointer-events:auto}.style_module_disabled__c2dc158c{opacity:0;transform:var(--cosmograph-color-legend-hide-transform);pointer-events:none;display:none;min-height:0}@starting-style{.style_module_container__05cc807d.style_module_enabled__b3120e27,.style_module_legend__a3e235e4.style_module_enabled__b3120e27{opacity:0;transform:var(--cosmograph-color-legend-hide-transform)}}.style_module_legend__a3e235e4 .legend-content{display:flex;align-items:end;justify-content:space-between}.style_module_hovered__dfd7bb2c .label,.style_module_hovered__dfd7bb2c .sublabel{color:var(--cosmograph-size-legend-hover-color)!important;cursor:pointer}.style_module_legend__a3e235e4 .extent{white-space:nowrap;transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__a3e235e4 .gradient{width:100%;margin-top:var(--cosmograph-color-legend-range-gradient-top-margin);height:var(--cosmograph-color-legend-range-gradient-height);border-radius:var(--cosmograph-color-legend-range-gradient-radius)}.style_module_legend__a3e235e4 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-color-legend-range-items-margin)}.style_module_legend__a3e235e4 .name{align-items:center;text-align:center;justify-content:space-around;display:flex;color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;width:100%;word-break:break-word;text-wrap:balance;white-space:pre-line;transition:color .15s ease-in-out;margin:0 4px;letter-spacing:-.02em;line-height:1.25}.style_module_legend__a3e235e4 .label{color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;max-width:150px;text-overflow:ellipsis;font-size:var(--cosmograph-color-legend-range-label-font-size);transition:color .15s ease-in-out;line-height:1;font-feature-settings:"tnum"}.style_module_legend__a3e235e4 .sublabel{padding-top:1px;color:var(--cosmograph-color-legend-range-font-color);opacity:.55;font-size:var(--cosmograph-color-legend-range-sublabel-font-size);line-height:1;transition:color .15s ease-in-out}:root{--cosmograph-color-legend-type-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-type-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-type-font-size: 11px;--cosmograph-color-legend-type-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-type-others-color: #bab0ab;--cosmograph-color-legend-type-bullet-size: 8px;--cosmograph-color-legend-type-bullet-radius: 1rem;--cosmograph-color-legend-type-items-margin: 4px;--cosmograph-color-legend-type-hide-transform: translateY(125%);--cosmograph-color-legend-type-show-transform: translateX(0)}.style_module_enabled__277b2403{opacity:1;transform:var(--cosmograph-color-legend-type-show-transform)}.style_module_disabled__7a587f96{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform);display:none!important;min-height:0}.style_module_wrapper__ea8ca7f4{position:relative;max-width:100%;width:fit-content;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_typeLegend__15bf4b2f{position:relative;width:fit-content;max-width:100%;min-height:25px;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.015em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_typeLegend__15bf4b2f .reverted{flex-direction:row-reverse}.style_module_typeLegend__15bf4b2f .scroll-container{width:100%;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-color-legend-type-font-size);font-family:var(--cosmograph-color-legend-type-font-family);user-select:none;-webkit-user-select:none;line-height:normal;overflow-x:hidden;overflow-y:auto;will-change:transform}@starting-style{.style_module_typeLegend__15bf4b2f.style_module_enabled__277b2403,.style_module_wrapper__ea8ca7f4.style_module_enabled__277b2403{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform)}}.style_module_typeLegend__15bf4b2f .legend-item{display:flex;align-items:center;position:absolute;margin-bottom:var(--cosmograph-color-legend-type-items-margin);pointer-events:none;width:100%;padding-left:1px;font-weight:300;transition:filter .1s ease-in-out,opacity .1s ease-in-out;min-height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px + var(--cosmograph-color-legend-type-items-margin));height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px);box-sizing:border-box}.style_module_typeLegend__15bf4b2f .unknown{background-color:var(--cosmograph-color-legend-type-unknown-color)}.style_module_typeLegend__15bf4b2f .others{background-color:var(--cosmograph-color-legend-type-others-color)}.style_module_typeLegend__15bf4b2f .bullet{height:var(--cosmograph-color-legend-type-bullet-size);width:var(--cosmograph-color-legend-type-bullet-size);min-height:var(--cosmograph-color-legend-type-bullet-size);min-width:var(--cosmograph-color-legend-type-bullet-size);border-radius:var(--cosmograph-color-legend-type-bullet-radius);pointer-events:all;margin-right:5px}.style_module_typeLegend__15bf4b2f .label{color:var(--cosmograph-color-legend-type-font-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - var(--cosmograph-color-legend-type-bullet-size) - 5px);pointer-events:all;transition:.05s linear color}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.bullet{margin-right:0}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.label{margin-right:5px}.style_module_typeLegend__15bf4b2f .show-more{cursor:pointer;padding-top:4px;display:none;font-weight:300;color:var(--cosmograph-color-legend-type-font-color);font-size:11px;opacity:.6;pointer-events:all;justify-content:space-between;transition:opacity .1s linear;font-feature-settings:"tnum"}.style_module_typeLegend__15bf4b2f .show-more:hover{opacity:1}.style_module_hovered__c0993502 .label,.style_module_hovered__c0993502 .sublabel{color:var(--cosmograph-color-legend-type-hover-color)!important;cursor:pointer}.style_module_selected__36e1dd81{filter:brightness(1)}.style_module_selected__36e1dd81>.style_module_label__afecc7a3{filter:brightness(1.2)}.style_module_unselected__4826cfb7{filter:brightness(.5)}.style_module_typeLegend__15bf4b2f .name{font-size:calc(var(--cosmograph-color-legend-type-font-size) + 1px);font-family:var(--cosmograph-color-legend-type-font-family);color:var(--cosmograph-color-legend-type-font-color);transition:color .15s ease-in-out,opacity .3s ease-in-out,max-height .3s ease-in-out,transform .3s ease-in-out;margin-bottom:4px;margin-top:2px;margin-left:1px;letter-spacing:-.02em;line-height:1.25;overflow:hidden;width:100%;white-space:nowrap;text-overflow:ellipsis;pointer-events:all;-webkit-user-select:none!important;user-select:none!important;max-height:100px;opacity:1;transform:translateY(0)}.style_module_typeLegend__15bf4b2f .name.hidden{opacity:0;max-height:0;margin-bottom:0;margin-top:0;transform:translateY(-10px)}:root{--cosmograph-button-color: var(--cosmograph-ui-text);--cosmograph-button-background: var(--cosmograph-ui-element-color);--cosmograph-button-border-radius: 2px}.style_module_button__e95a1138{background:var(--cosmograph-button-background);color:var(--cosmograph-button-color);border-radius:var(--cosmograph-button-border-radius);display:none;align-items:center;justify-content:center;width:25px;height:25px;margin:3px;padding:5px;cursor:pointer;filter:brightness(.95) contrast(.9);transition:filter .1s}.style_module_button__e95a1138:hover{filter:brightness(1.2) contrast(1)}')),document.head.appendChild(e)}}catch(_C){console.error("vite-plugin-css-injected-by-js",_C)}}();var kB=Object.defineProperty,LB=(e,t,n)=>((e,t,n)=>t in e?kB(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);let RB=class extends qO{constructor(e,t){const n=IO(CB,t??{});super(e,qO.extractConfig(n,CB)),LB(this,"_config"),LB(this,"_containerNode"),LB(this,"_legend"),LB(this,"_sizeElements",null),LB(this,"_isHidden",!1),LB(this,"_handleClick",e=>{var t,n;this._config.enableEvents&&(null==(n=(t=this._config).onClick)||n.call(t,e))}),LB(this,"_handleHover",e=>{var t,n;this._config.enableEvents&&(null==(n=(t=this._config).onHover)||n.call(t,e))}),LB(this,"_handleSizeElementHover",e=>{var t,n,i,o;if(!this._config.enableEvents||!this._config.extent||!this._sizeElements)return;const r=e.currentTarget;if(!r)return;const s=r.classList.contains("min")?"min":"max",a="mouseenter"===e.type,l="min"===s?0:this._config.extent.length-1,c=null==(t=this._config.extent)?void 0:t[l],u=null==(n=this._config.extentLabels)?void 0:n[l];r.classList.toggle("style_module_hovered__1206707f",a),null==(o=(i=this._config).onHover)||o.call(i,{target:r,type:s,size:c,value:u})}),LB(this,"_handleSizeElementClick",e=>{var t,n;if(!this._config.enableEvents)return;const i=e.currentTarget.className.includes("min")?"min":"max",o="min"===i?this._config.onMinClick:this._config.onMaxClick;if(o){const r=(null==(t=this._config.extent)?void 0:t["min"===i?0:1])??void 0;o(r,(null==(n=this._config.extentLabels)?void 0:n["min"===i?0:1])??r,e)}}),this._config=n,this._containerNode=e,this._containerNode.classList.add("style_module_container__d2889234"),this._createElements()}hide(){this._isHidden||(this._isHidden=!0,this._containerNode.classList.remove(IB),this._containerNode.classList.add(AB))}show(){this._isHidden&&(this._isHidden=!1,this._containerNode.classList.remove(AB),this._containerNode.classList.add(IB))}setConfig(e){this._config=IO(CB,e??{}),this.setDisplayStateConfig(qO.extractConfig(this._config,CB)),this._updateLegend()}setLoadingState(){super.setLoadingState()}destroy(){this._legend&&(this._legend.removeEventListener("click",this._handleClick),this._legend.removeEventListener("mouseover",this._handleHover),this._sizeElements&&["min","max"].forEach(e=>{const t=this._sizeElements[e];t.removeEventListener("click",this._handleSizeElementClick),t.removeEventListener("mouseenter",this._handleSizeElementHover),t.removeEventListener("mouseleave",this._handleSizeElementHover)}),this._containerNode.removeChild(this._legend),super.destroy())}get sizeElements(){return this._sizeElements}get config(){return this._config}get isHidden(){return this._isHidden}_createElements(){this._legend=this._createLegendElement(),this._containerNode.appendChild(this._legend),this._isHidden||this.show()}_createLegendElement(){const e=document.createElement("div");e.classList.add("style_module_legend__75c167f2");const t=document.createElement("div");t.className="legend-content",this._sizeElements={min:this._createSizeElement("min"),max:this._createSizeElement("max")},t.appendChild(this._sizeElements.min),t.appendChild(this._sizeElements.max),e.appendChild(t);const n=document.createElement("div");return n.className="name",e.appendChild(n),e}_createSizeElement(e){const t=document.createElement("div");t.classList.add(e);const n=document.createElement("div");t.appendChild(n);const i=document.createElement("div");return i.className="label",t.appendChild(i),t.addEventListener("click",this._handleSizeElementClick),t.addEventListener("mouseenter",this._handleSizeElementHover),t.addEventListener("mouseleave",this._handleSizeElementHover),t}_updateLegend(){const{extent:e,extentLabels:t}=this._config,{noDataMessage:n,loadingMessage:i}=this._displayStateConfig,o=!e&&!1===n&&!1===i;if(this._config.hidden||o?this.hide():this.show(),null!=e&&e.every(Number.isFinite)&&null!=t&&t.every(Number.isFinite)){this.hideState();const e=this._legend.querySelector(".name");e&&(e.textContent=this._config.label??""),this._sizeElements&&(t[0]===t[1]?(this._updateSizeElement("min"),this._sizeElements.min.style.display="block",this._sizeElements.max.style.display="none"):(this._updateSizeElement("min"),this._updateSizeElement("max"),this._sizeElements.min.style.display="block",this._sizeElements.max.style.display="block")),this._legend.classList.remove(AB),this._legend.classList.add(IB)}else this.showState(),this._legend.classList.remove(IB),this._legend.classList.add(AB)}_updateSizeElement(e){var t,n;if(!this._sizeElements)return;const i=this._sizeElements[e];i.style.pointerEvents=this._config.enableEvents?"auto":"none";const o=(null==(t=this._config.extent)?void 0:t["min"===e?0:1])??1,r=(null==(n=this._config.extentLabels)?void 0:n["min"===e?0:1])??o,s=i.querySelector("div");"point"===this._config.form?(s.classList.remove("line"),s.classList.add("circle"),s.style.height=s.style.width=o*(this._config.sizeMultiplier??1)+"px"):(s.style.width="",s.classList.remove("circle"),s.classList.add("line"),s.style.height=o*(this._config.sizeMultiplier??1)+"px"),i.querySelector(".label").textContent=this._formatLabel(r),this._updateSublabel(i,e)}_updateSublabel(e,t){let n=e.querySelector(".sublabel");this._config.showSublabels?(n||(n=document.createElement("div"),n.className="sublabel",e.appendChild(n)),n.textContent="min"===t?this._config.minSubLabel??"min":this._config.maxSubLabel??"max"):n&&n.remove()}_formatLabel(e){return this._config.labelFormatter?this._config.labelFormatter(e):e.toString()}};const PB={hidden:!1,label:void 0,labelFormatter:AO,extent:void 0,extentLabels:void 0,enableEvents:!0,showSublabels:!1,minSubLabel:"min",maxSubLabel:"max",discreteColors:!1,onClick:void 0,onHover:void 0,onMaxClick:void 0,onMinClick:void 0,noDataMessage:"No legend data",loadingMessage:"Data loading..."},DB="style_module_enabled__b3120e27",MB="style_module_disabled__c2dc158c";!function(){try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode('@keyframes style_module_fadeIn__ffac87fd{0%{opacity:0}to{opacity:.2}}.style_module_displayState__6ae19b84{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--cosmograph-ui-text);display:flex;justify-content:center;align-items:center;min-width:100px;opacity:.2;font-size:calc(var(--cosmograph-ui-font-size) + 1px);letter-spacing:-.02em;font-weight:200;user-select:none;-webkit-user-select:none;animation:style_module_fadeIn__ffac87fd .3s ease-in-out}:root{--cosmograph-timeline-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-timeline-selection-opacity: .5;--cosmograph-timeline-bar-color: var(--cosmograph-ui-element-color);--cosmograph-timeline-highlighted-bar-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-timeline-font-family: var(--cosmograph-ui-font-family);--cosmograph-timeline-font-size: var(--cosmograph-ui-tick-font-size);--cosmograph-timeline-background: var(--cosmograph-ui-background);--cosmograph-timeline-text-color: var(--cosmograph-ui-text);--cosmograph-timeline-axis-color: var(--cosmograph-ui-text)}.style_module_timeline__736434f7{position:relative;display:flex;background:var(--cosmograph-timeline-background);width:100%;min-height:25px;overflow:hidden}.style_module_timelineSvg__b916ad04{position:relative;width:100%;height:100%}.style_module_selection__ebee57f8{fill:var(--cosmograph-timeline-selection-color);fill-opacity:var(--cosmograph-timeline-selection-opacity);stroke:none}.style_module_axisTick__5865631d{color:var(--cosmograph-timeline-axis-color);font:var(--cosmograph-timeline-font-family);font-size:var(--cosmograph-timeline-font-size);user-select:none;-webkit-user-select:none;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum";alignment-baseline:text-before-edge}.style_module_axisLine__992b502d{opacity:.2;color:var(--cosmograph-timeline-axis-color)}.style_module_bar__114fa79f{fill:var(--cosmograph-timeline-bar-color);transform:scaleY(-1);opacity:0}.style_module_animationControl__ee52cd66{color:var(--cosmograph-timeline-axis-color);width:6%;max-width:30px;min-width:20px;cursor:pointer;display:none;align-items:center;user-select:none;-webkit-user-select:none;opacity:.5;position:relative;justify-content:center}.style_module_animationControl__ee52cd66>svg{width:50%;max-height:20px;padding-right:2px}.style_module_hidden__a73fe81a{display:none}.style_module_disabled__eb988570{opacity:.2;pointer-events:none}.style_module_highlightedBar__c2fc9bdc{fill:var(--cosmograph-timeline-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-search-font-family: var(--cosmograph-ui-font-family);--cosmograph-search-font-size: 14px;--cosmograph-search-list-font-size: 13.5px;--cosmograph-search-text-color: var(--cosmograph-ui-text);--cosmograph-search-background: transparent;--cosmograph-search-list-background: rgba(0, 0, 0, .2);--cosmograph-search-list-match-background: rgba(255, 255, 255, .2);--cosmograph-search-list-match-color: var(--cosmograph-ui-text)}.style_module_searchInput__d7830601:hover{filter:brightness(1.2) contrast(1)}.style_module_searchInput__d7830601{width:100%;background:transparent;color:var(--cosmograph-search-text-color);border:none;border-bottom:.5px solid var(--cosmograph-search-text-color);padding:4px 20px 5px 2px;font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:opacity .2s ease-out}.style_module_searchInput__d7830601::selection{background:var(--cosmograph-search-list-match-background)}.style_module_searchInput__d7830601:focus{outline:none}.style_module_searchSuggestions__b0d3f71e{color:#fff;width:100%;padding:0;margin:0;background:transparent;overflow-y:auto;flex:1;min-height:0}.style_module_searchSuggestions__b0d3f71e li{padding:5px 10px;cursor:pointer;-webkit-user-select:none;user-select:none;display:block;font-weight:500;font-size:var(--cosmograph-search-list-font-size);max-width:100%;overflow:hidden}.style_module_searchSuggestions__b0d3f71e li>div{white-space:nowrap;font-weight:200;overflow:hidden;text-overflow:ellipsis;width:100%}.style_module_searchSuggestions__b0d3f71e li:hover{background:#ffffff1a}.style_module_searchSuggestions__b0d3f71e mark{background:var(--cosmograph-search-list-match-background);color:var(--cosmograph-search-list-match-color);border-radius:2px}.style_module_clearButton__5ebb41de{position:absolute;right:0;top:0;height:100%;background:none;border:none;color:var(--cosmograph-search-text-color);font-weight:300;cursor:pointer;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d{opacity:.7}.style_module_placeholderWrapper__72d5eb0e{z-index:1;color:var(--cosmograph-search-text-color);font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);position:absolute;top:0;left:0;width:100%;bottom:0;display:flex;line-height:1.25;align-items:center;transition:transform .3s ease-out,opacity .3s ease-out}.style_module_placeholderWrapper__72d5eb0e.style_module_hidden__acfb8431{transform:translate(-30px);pointer-events:none;opacity:0}.style_module_searchInput__d7830601:disabled,.style_module_searchInput__d7830601.style_module_disabled__62c35dc5{opacity:.2;cursor:not-allowed;pointer-events:none}.style_module_disabled__62c35dc5 .style_module_clearButton__5ebb41de{display:none}.style_module_disabled__62c35dc5 .style_module_placeholderWrapper__72d5eb0e{opacity:.3;cursor:not-allowed}.style_module_searchInputWrapper__1edbcb22{position:relative;display:flex;width:100%}.style_module_noResults__363397c3{opacity:.3!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none}.style_module_noResults__363397c3:hover{background:none}.style_module_loading__296e0212{opacity:.7!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none;-webkit-user-select:none;user-select:none}.style_module_dropdownContainer__d98287da{position:absolute;top:100%;left:0;width:100%;background:var(--cosmograph-search-list-background);border-radius:4px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);opacity:0;transform:translateY(-10px);transition:opacity .2s ease-out,transform .2s ease-out;pointer-events:none;overflow:hidden;z-index:10;display:flex;flex-direction:column;padding-bottom:2px}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b{top:auto;bottom:100%;transform:translateY(10px)}.style_module_dropdownContainer__d98287da.style_module_visible__5be7493d{opacity:1;transform:translateY(0);pointer-events:auto}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b.style_module_visible__5be7493d{opacity:1;transform:translateY(-2px);pointer-events:auto}.style_module_footerContainer__73e7a066{flex-shrink:0}:root{--cosmograph-scrollbar-background: rgba(255, 255, 255, .1);--cosmograph-ui-background: rgb(45, 49, 58);--cosmograph-ui-text: #ffffffc7;--cosmograph-ui-tick-font-size: 11px;--cosmograph-ui-font-size: 12px;--cosmograph-ui-font-family: inherit;--cosmograph-ui-element-color: #5C616A;--cosmograph-ui-highlighted-element-color: white;--cosmograph-ui-selection-control-color: #8d949ea8;-webkit-font-smoothing:antialiased!important;text-rendering:optimizeLegibility!important}.style_module_cosmograph-ui__5acb97f1{background:var(--cosmograph-ui-background);color:var(--cosmograph-ui-text)}.style_module_scrollbar__f1516254 *::-webkit-scrollbar{width:5px;height:5px;border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-track{border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-corner{background:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-button{display:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-thumb{background-color:var(--cosmograph-scrollbar-background);transition:background-color .5s;border-radius:20px;border:3px solid var(--cosmograph-scrollbar-background)}@-moz-document url-prefix(){.style_module_scrollbar__f1516254 *{scrollbar-width:thin;scrollbar-color:var(--cosmograph-scrollbar-background) transparent;scrollbar-track-color:transparent;scrollbar-face-color:var(--cosmograph-scrollbar-background)}}:root{--cosmograph-histogram-background: var(--cosmograph-ui-background);--cosmograph-histogram-text-color: var(--cosmograph-ui-text);--cosmograph-histogram-axis-color: var(--cosmograph-ui-text);--cosmograph-histogram-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-histogram-selection-opacity: .5;--cosmograph-histogram-bar-color: var(--cosmograph-ui-element-color);--cosmograph-histogram-highlighted-bar-color: var( --cosmograph-ui-highlighted-element-color);--cosmograph-histogram-font-family: var(--cosmograph-ui-font-family);--cosmograph-histogram-font-size: var(--cosmograph-ui-tick-font-size)}.style_module_histogram__9d8a77ea{position:relative;display:flex;min-height:25px;background:var(--cosmograph-histogram-background);width:100%}.style_module_histogramSvg__ccccb628{position:relative;width:100%;height:100%}.style_module_selection__7db96137{fill:var(--cosmograph-histogram-selection-color);fill-opacity:var(--cosmograph-histogram-selection-opacity);stroke:none}.style_module_axisTick__898e1f39{color:var(--cosmograph-histogram-axis-color);font-family:var(--cosmograph-histogram-font-family);font-size:var(--cosmograph-histogram-font-size);user-select:none;-webkit-user-select:none;alignment-baseline:text-before-edge;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum"}.style_module_bar__3c9ab488{fill:var(--cosmograph-histogram-bar-color);transform:scaleY(-1)}.style_module_highlightedBar__b193a8de{fill:var(--cosmograph-histogram-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-bars-font-color: var(--cosmograph-ui-text);--cosmograph-bars-font-family: var(--cosmograph-ui-font-family);--cosmograph-bars-font-size: var(--cosmograph-ui-font-size);--cosmograph-bars-ui-font-size: 11.5px;--cosmograph-bars-background: var(--cosmograph-ui-element-color);--cosmograph-bars-bar-height: 20px;--cosmograph-bars-bar-bottom-margin: 2px;--cosmograph-bars-highlighted-color: var( --cosmograph-ui-highlighted-element-color)}.style_module_bars__25497ded{position:relative;width:100%;min-height:100px;user-select:none;flex-direction:column;-webkit-user-select:none}.style_module_bars__25497ded .scroll-container{position:relative;width:100%;overflow-y:hidden;overflow-x:hidden}.style_module_bars__25497ded .bars-container{position:relative;width:calc(100% - 1px);font-family:var(--cosmograph-bars-font-family)}.style_module_bars__25497ded .highlighted-bars-container{position:absolute;top:0;left:0;pointer-events:none}.style_module_bars__25497ded .row{height:var(--cosmograph-bars-bar-height);display:flex;align-items:center;margin-bottom:var(--cosmograph-bars-bar-bottom-margin);width:100%;transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row:hover{filter:brightness(1.15) contrast(1.05);transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row.unselected:hover{filter:brightness(.95) contrast(1.15);transition:filter .05s linear}.style_module_bars__25497ded .unselected{opacity:.85;filter:brightness(.8) contrast(1.1)}.style_module_bars__25497ded .selected{filter:brightness(1.05) contrast(1.05)}.style_module_bars__25497ded .selected>.info>.label{font-weight:600;filter:brightness(1.1) contrast(1.05)}.style_module_bars__25497ded .unselected>.info>.label{font-weight:300}.style_module_bars__25497ded .bar{height:100%;background-color:var(--cosmograph-bars-background);opacity:.8;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .bar-highlighted{height:100%;background-color:var(--cosmograph-bars-highlighted-color);opacity:.2;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .info{display:flex;justify-content:space-between;width:100%;padding:0 4px;position:absolute;font-size:var(--cosmograph-bars-font-size);font-feature-settings:"tnum";color:var(--cosmograph-bars-font-color);gap:2px}.style_module_bars__25497ded .label{min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:opacity .05s linear}.style_module_bars__25497ded .count{flex-shrink:0;font-weight:300;opacity:.8;transition:opacity .05s linear}.style_module_bars__25497ded .show-more{cursor:pointer;padding-top:2px;display:flex;font-weight:300;color:var(--cosmograph-bars-font-color);font-size:11px;justify-content:space-between;opacity:.6;font-size:var(--cosmograph-bars-ui-font-size);pointer-events:none;transition:opacity .1s linear}.style_module_bars__25497ded .show-more:hover{opacity:1;text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .show-more>span{pointer-events:all}.style_module_bars__25497ded .show-more-count{padding-right:5px;pointer-events:all;font-feature-settings:"tnum"}.style_module_bars__25497ded .unselected>.info>.label,.style_module_bars__25497ded .unselected>.info>.count{opacity:.5}.style_module_bars__25497ded .unselected:hover>.info>.label,.style_module_bars__25497ded .unselected:hover>.info>.count{opacity:1}.style_module_bars__25497ded .search-input{background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,.3);font-size:13px!important;color:var(--cosmograph-bars-font-color);line-height:1.5;padding:2px;width:100%;position:relative;transition:border-bottom-color .2s}.style_module_bars__25497ded .search-input::placeholder{color:var(--cosmograph-bars-font-color)!important;opacity:.4;font-weight:300;font-family:inherit}.style_module_bars__25497ded .search-container{position:relative;width:100%;margin-bottom:4px;display:none;z-index:1}.style_module_bars__25497ded .clear-button{position:absolute;right:0;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--cosmograph-bars-font-color);font-weight:300;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_bars__25497ded .clear-button.visible:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_bars__25497ded .clear-button.visible{opacity:.7}.style_module_bars__25497ded .clear-button svg{width:10px;height:10px;fill:currentColor}.style_module_bars__25497ded .sorting-block{visibility:hidden;margin-top:1px;display:flex;justify-content:space-between}.style_module_bars__25497ded .buttons-container{margin-top:4px;font-size:var(--cosmograph-bars-ui-font-size);display:flex;gap:4px;line-height:1.25}.style_module_bars__25497ded .buttons-container>div{transition:opacity .05s linear,filter .05s linear;padding:1px 5px;background:var(--cosmograph-bars-background);border-radius:4px;opacity:.9;display:flex;cursor:pointer;align-items:center}.style_module_bars__25497ded .buttons-container>div:hover{filter:brightness(1.2)}.style_module_bars__25497ded .reset-text{transition:opacity .05s linear,filter .05s linear;display:flex;font-size:var(--cosmograph-bars-ui-font-size);align-items:end;padding-right:4px;cursor:pointer;font-weight:300}.style_module_bars__25497ded .reset-text:hover{text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .reset-text.unselected{pointer-events:none;cursor:default;opacity:.7}.style_module_bars__25497ded :scope.reset-text:hover:not(.unselected){filter:brightness(1.5);opacity:1}:root{--cosmograph-size-legend-form-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-family: inherit;--cosmograph-size-legend-font-size: var(--cosmograph-ui-font-size);--cosmograph-size-legend-sublabel-font-size: 10px;--cosmograph-size-legend-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-size-legend-line-radius: 2px;--cosmograph-size-legend-line-width: 30px;--cosmograph-size-legend-hide-transform: translateY(100%);--cosmograph-size-legend-show-transform: translateX(0)}.style_module_container__d2889234{display:flex;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;overflow:hidden;min-height:25px}.style_module_legend__75c167f2{width:auto;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-size-legend-font-size);font-family:var(--cosmograph-size-legend-font-family);user-select:none;-webkit-user-select:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.04em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__91eae57a{opacity:1;transform:var(--cosmograph-size-legend-show-transform)}.style_module_disabled__d51f7a10{opacity:0;transform:var(--cosmograph-size-legend-hide-transform);pointer-events:none;display:none!important;min-height:0}@starting-style{.style_module_container__d2889234.style_module_enabled__91eae57a,.style_module_legend__75c167f2.style_module_enabled__91eae57a{opacity:0;transform:var(--cosmograph-size-legend-hide-transform)}}.style_module_legend__75c167f2 .circle{background-color:var(--cosmograph-size-legend-form-color);border-radius:50%;transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2 .line{background-color:var(--cosmograph-size-legend-form-color);border-radius:var(--cosmograph-size-legend-line-radius);width:var(--cosmograph-size-legend-line-width);transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2.style_module_events__894316a8{pointer-events:auto;cursor:pointer}.style_module_legend__75c167f2 .legend-content{display:flex;align-items:end;justify-content:center;gap:.75rem}.style_module_legend__75c167f2 .legend-content>div{transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__75c167f2 .labels-wrapper{white-space:nowrap}.style_module_legend__75c167f2 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-size-legend-items-margin)}.style_module_legend__75c167f2 .name{align-items:center;text-align:center;justify-content:center;display:flex;color:var(--cosmograph-size-legend-font-color);overflow:hidden;width:100%;margin-top:3px;word-break:break-all;white-space:pre-line;transition:color .15s ease-in-out;letter-spacing:-.02em}.style_module_legend__75c167f2 .label{color:var(--cosmograph-size-legend-font-color);overflow:hidden;transition:color .15s ease-in-out;text-overflow:ellipsis;font-feature-settings:"tnum"}.style_module_legend__75c167f2 .sublabel{padding-top:1px;font-size:var(--cosmograph-size-legend-sublabel-font-size);opacity:.5;line-height:1;min-width:10px;transition:color .15s ease-in-out}.style_module_hovered__1206707f .label,.style_module_hovered__1206707f .sublabel{color:var(--cosmograph-size-legend-hover-color);cursor:pointer}.style_module_hovered__1206707f .circle,.style_module_hovered__1206707f .line{background-color:var(--cosmograph-size-legend-hover-color);cursor:pointer}:root{--cosmograph-color-legend-range-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-range-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-range-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-label-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-sublabel-font-size: 10px;--cosmograph-color-legend-range-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-range-gradient-height: 6px;--cosmograph-color-legend-range-gradient-radius: 8px;--cosmograph-color-legend-range-gradient-top-margin: 6px;--cosmograph-color-legend-hide-transform: translateY(100%);--cosmograph-color-legend-show-transform: translateX(0)}.style_module_container__05cc807d{display:flex;min-width:150px;min-height:25px;width:100%;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_legend__a3e235e4{width:100%;font-weight:300;letter-spacing:-.04em;display:flex;flex-direction:column;font-size:var(--cosmograph-color-legend-range-font-size);font-family:var(--cosmograph-color-legend-range-font-family);user-select:none;-webkit-user-select:none;pointer-events:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__b3120e27{opacity:1;transform:var(--cosmograph-color-legend-show-transform);pointer-events:auto}.style_module_disabled__c2dc158c{opacity:0;transform:var(--cosmograph-color-legend-hide-transform);pointer-events:none;display:none;min-height:0}@starting-style{.style_module_container__05cc807d.style_module_enabled__b3120e27,.style_module_legend__a3e235e4.style_module_enabled__b3120e27{opacity:0;transform:var(--cosmograph-color-legend-hide-transform)}}.style_module_legend__a3e235e4 .legend-content{display:flex;align-items:end;justify-content:space-between}.style_module_hovered__dfd7bb2c .label,.style_module_hovered__dfd7bb2c .sublabel{color:var(--cosmograph-size-legend-hover-color)!important;cursor:pointer}.style_module_legend__a3e235e4 .extent{white-space:nowrap;transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__a3e235e4 .gradient{width:100%;margin-top:var(--cosmograph-color-legend-range-gradient-top-margin);height:var(--cosmograph-color-legend-range-gradient-height);border-radius:var(--cosmograph-color-legend-range-gradient-radius)}.style_module_legend__a3e235e4 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-color-legend-range-items-margin)}.style_module_legend__a3e235e4 .name{align-items:center;text-align:center;justify-content:space-around;display:flex;color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;width:100%;word-break:break-word;text-wrap:balance;white-space:pre-line;transition:color .15s ease-in-out;margin:0 4px;letter-spacing:-.02em;line-height:1.25}.style_module_legend__a3e235e4 .label{color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;max-width:150px;text-overflow:ellipsis;font-size:var(--cosmograph-color-legend-range-label-font-size);transition:color .15s ease-in-out;line-height:1;font-feature-settings:"tnum"}.style_module_legend__a3e235e4 .sublabel{padding-top:1px;color:var(--cosmograph-color-legend-range-font-color);opacity:.55;font-size:var(--cosmograph-color-legend-range-sublabel-font-size);line-height:1;transition:color .15s ease-in-out}:root{--cosmograph-color-legend-type-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-type-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-type-font-size: 11px;--cosmograph-color-legend-type-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-type-others-color: #bab0ab;--cosmograph-color-legend-type-bullet-size: 8px;--cosmograph-color-legend-type-bullet-radius: 1rem;--cosmograph-color-legend-type-items-margin: 4px;--cosmograph-color-legend-type-hide-transform: translateY(125%);--cosmograph-color-legend-type-show-transform: translateX(0)}.style_module_enabled__277b2403{opacity:1;transform:var(--cosmograph-color-legend-type-show-transform)}.style_module_disabled__7a587f96{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform);display:none!important;min-height:0}.style_module_wrapper__ea8ca7f4{position:relative;max-width:100%;width:fit-content;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_typeLegend__15bf4b2f{position:relative;width:fit-content;max-width:100%;min-height:25px;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.015em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_typeLegend__15bf4b2f .reverted{flex-direction:row-reverse}.style_module_typeLegend__15bf4b2f .scroll-container{width:100%;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-color-legend-type-font-size);font-family:var(--cosmograph-color-legend-type-font-family);user-select:none;-webkit-user-select:none;line-height:normal;overflow-x:hidden;overflow-y:auto;will-change:transform}@starting-style{.style_module_typeLegend__15bf4b2f.style_module_enabled__277b2403,.style_module_wrapper__ea8ca7f4.style_module_enabled__277b2403{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform)}}.style_module_typeLegend__15bf4b2f .legend-item{display:flex;align-items:center;position:absolute;margin-bottom:var(--cosmograph-color-legend-type-items-margin);pointer-events:none;width:100%;padding-left:1px;font-weight:300;transition:filter .1s ease-in-out,opacity .1s ease-in-out;min-height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px + var(--cosmograph-color-legend-type-items-margin));height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px);box-sizing:border-box}.style_module_typeLegend__15bf4b2f .unknown{background-color:var(--cosmograph-color-legend-type-unknown-color)}.style_module_typeLegend__15bf4b2f .others{background-color:var(--cosmograph-color-legend-type-others-color)}.style_module_typeLegend__15bf4b2f .bullet{height:var(--cosmograph-color-legend-type-bullet-size);width:var(--cosmograph-color-legend-type-bullet-size);min-height:var(--cosmograph-color-legend-type-bullet-size);min-width:var(--cosmograph-color-legend-type-bullet-size);border-radius:var(--cosmograph-color-legend-type-bullet-radius);pointer-events:all;margin-right:5px}.style_module_typeLegend__15bf4b2f .label{color:var(--cosmograph-color-legend-type-font-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - var(--cosmograph-color-legend-type-bullet-size) - 5px);pointer-events:all;transition:.05s linear color}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.bullet{margin-right:0}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.label{margin-right:5px}.style_module_typeLegend__15bf4b2f .show-more{cursor:pointer;padding-top:4px;display:none;font-weight:300;color:var(--cosmograph-color-legend-type-font-color);font-size:11px;opacity:.6;pointer-events:all;justify-content:space-between;transition:opacity .1s linear;font-feature-settings:"tnum"}.style_module_typeLegend__15bf4b2f .show-more:hover{opacity:1}.style_module_hovered__c0993502 .label,.style_module_hovered__c0993502 .sublabel{color:var(--cosmograph-color-legend-type-hover-color)!important;cursor:pointer}.style_module_selected__36e1dd81{filter:brightness(1)}.style_module_selected__36e1dd81>.style_module_label__afecc7a3{filter:brightness(1.2)}.style_module_unselected__4826cfb7{filter:brightness(.5)}.style_module_typeLegend__15bf4b2f .name{font-size:calc(var(--cosmograph-color-legend-type-font-size) + 1px);font-family:var(--cosmograph-color-legend-type-font-family);color:var(--cosmograph-color-legend-type-font-color);transition:color .15s ease-in-out,opacity .3s ease-in-out,max-height .3s ease-in-out,transform .3s ease-in-out;margin-bottom:4px;margin-top:2px;margin-left:1px;letter-spacing:-.02em;line-height:1.25;overflow:hidden;width:100%;white-space:nowrap;text-overflow:ellipsis;pointer-events:all;-webkit-user-select:none!important;user-select:none!important;max-height:100px;opacity:1;transform:translateY(0)}.style_module_typeLegend__15bf4b2f .name.hidden{opacity:0;max-height:0;margin-bottom:0;margin-top:0;transform:translateY(-10px)}:root{--cosmograph-button-color: var(--cosmograph-ui-text);--cosmograph-button-background: var(--cosmograph-ui-element-color);--cosmograph-button-border-radius: 2px}.style_module_button__e95a1138{background:var(--cosmograph-button-background);color:var(--cosmograph-button-color);border-radius:var(--cosmograph-button-border-radius);display:none;align-items:center;justify-content:center;width:25px;height:25px;margin:3px;padding:5px;cursor:pointer;filter:brightness(.95) contrast(.9);transition:filter .1s}.style_module_button__e95a1138:hover{filter:brightness(1.2) contrast(1)}')),document.head.appendChild(e)}}catch(_C){console.error("vite-plugin-css-injected-by-js",_C)}}();var NB=Object.defineProperty,OB=(e,t,n)=>((e,t,n)=>t in e?NB(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);let BB=class extends qO{constructor(e,t){const n=IO(PB,t??{});super(e,qO.extractConfig(n,PB)),OB(this,"_config"),OB(this,"_containerNode"),OB(this,"_legend"),OB(this,"_legendElements"),OB(this,"_gradientElement"),OB(this,"_extentElements",null),OB(this,"_isHidden",!1),OB(this,"_handleClick",e=>{var t,n;this._config.enableEvents&&(null==(n=(t=this._config).onClick)||n.call(t,e))}),OB(this,"_handleHover",e=>{var t,n;this._config.enableEvents&&(null==(n=(t=this._config).onHover)||n.call(t,e))}),OB(this,"_handleColorElementClick",e=>{var t,n;if(!this._config.enableEvents)return;const i=e.currentTarget.className.includes("min")?"min":"max",o="min"===i?this._config.onMinClick:this._config.onMaxClick;if(o){const r="min"===i?0:1;o(null==(t=this._config.extent)?void 0:t["min"===i?0:this._config.extent.length-1],null==(n=this._config.extentLabels)?void 0:n[r],e)}}),OB(this,"_handleColorElementHover",e=>{var t,n,i,o;if(!this._config.enableEvents||!this._config.extent)return;const r=e.currentTarget;if(!r)return;const s=r.classList.contains("min")?"min":"max",a="mouseenter"===e.type,l="min"===s?0:this._config.extent.length-1,c=null==(t=this._config.extent)?void 0:t[l],u=null==(n=this._config.extentLabels)?void 0:n[l];r.classList.toggle("style_module_hovered__dfd7bb2c",a),null==(o=(i=this._config).onHover)||o.call(i,{target:r,type:s,color:c,value:u})}),this._config=n,this._containerNode=e,this._containerNode.classList.add("style_module_container__05cc807d"),this._createElements()}get extentElements(){return this._extentElements}get config(){return this._config}hide(){this._isHidden||(this._isHidden=!0,this._containerNode.classList.remove(DB),this._containerNode.classList.add(MB))}show(){this._isHidden&&(this._isHidden=!1,this._containerNode.classList.remove(MB),this._containerNode.classList.add(DB))}setConfig(e){this._config=IO(PB,e??{}),this.setDisplayStateConfig(qO.extractConfig(this._config,PB)),this._updateLegend()}destroy(){this._legend&&(this._legend.removeEventListener("click",this._handleClick),this._legend.removeEventListener("mouseover",this._handleHover),this._extentElements&&["min","max"].forEach(e=>{const t=this._extentElements[e];t.removeEventListener("click",this._handleColorElementClick),t.removeEventListener("mouseenter",this._handleColorElementHover),t.removeEventListener("mouseleave",this._handleColorElementHover)}),this._containerNode.removeChild(this._legend),super.destroy())}setLoadingState(){super.setLoadingState()}_createElements(){this._legend=document.createElement("div"),this._legend.classList.add("style_module_legend__a3e235e4"),this._legendElements=this._createLegend(),this._gradientElement=this._createGradientElement(),this._legend.appendChild(this._legendElements),this._legend.appendChild(this._gradientElement),this._containerNode.appendChild(this._legend),this._isHidden||this.show()}_createLegend(){const e=document.createElement("div");e.classList.add("legend-content");const t=document.createElement("div");return t.classList.add("name"),this._extentElements={min:this._createLabelExtent("min"),max:this._createLabelExtent("max")},e.appendChild(this._extentElements.min),e.appendChild(t),e.appendChild(this._extentElements.max),e}_createLabelExtent(e){const t=document.createElement("div");t.classList.add("extent"),t.classList.add(e);const n=document.createElement("div");return n.classList.add("label"),t.appendChild(n),t.addEventListener("click",this._handleColorElementClick),t.addEventListener("mouseenter",this._handleColorElementHover),t.addEventListener("mouseleave",this._handleColorElementHover),t}_createGradientElement(){const e=document.createElement("div");return e.classList.add("gradient"),e}_updateLegend(){var e,t,n;const{noDataMessage:i,loadingMessage:o}=this._displayStateConfig,r=!this._config.extent&&!1===i&&!1===o;if(this._config.hidden||r?this.hide():this.show(),this._config.extent){this.hideState();const i=this._legendElements.querySelector(".name");i&&(i.textContent=this._config.label??"");const o=(null==(e=this._config.extentLabels)?void 0:e[0])===(null==(t=this._config.extentLabels)?void 0:t[1]);if(this._extentElements)if(o){if(this._extentElements.min.style.display="none",this._extentElements.max.style.display="none",i&&void 0!==(null==(n=this._config.extentLabels)?void 0:n[0])){const e=this._formatLabel(this._config.extentLabels[0]),t=i.textContent?`${e}\n${i.textContent}`:e;i.textContent=t}}else this._updateLabelWrapper("min"),this._updateLabelWrapper("max"),this._extentElements.min.style.display="block",this._extentElements.max.style.display="block";this._updateGradient(),this._legend.classList.remove(MB),this._legend.classList.add(DB)}else this.showState(),this._legend.classList.remove(DB),this._legend.classList.add(MB)}_updateGradient(){if(!this._config.extent)return;const e=this._config.extent.map(e=>this._getColor(e)).filter((e,t,n)=>0===t||e!==n[t-1]);if(1===e.length)return this._gradientElement.style.backgroundImage="none",void(this._gradientElement.style.backgroundColor=e[0]);if(this._config.discreteColors){const t=100/e.length,n=e.map((e,n)=>`${e} ${n*t}% ${(n+1)*t}%`);this._gradientElement.style.backgroundImage=`linear-gradient(to right, ${n.join(", ")})`}else{const e=this._config.extent.map((e,t)=>`${this._getColor(e)} ${t/(this._config.extent.length-1)*100}%`).join(", ");this._gradientElement.style.backgroundImage=`linear-gradient(to right, ${e})`}}_updateLabelWrapper(e){var t;const n=this._legendElements.querySelector(".extent:"+("min"===e?"first-child":"last-child"));if(!n)return;const i="min"===e?0:1,o=null==(t=this._config.extentLabels)?void 0:t[i],r=n.querySelector(".label");r&&void 0!==o&&(r.textContent=this._formatLabel(o)),this._updateSublabel(n,e)}_updateSublabel(e,t){let n=e.querySelector(".sublabel");this._config.showSublabels?(n||(n=document.createElement("div"),n.classList.add("sublabel"),e.appendChild(n)),n.textContent="min"===t?this._config.minSubLabel??"min":this._config.maxSubLabel??"max"):n&&n.remove()}_formatLabel(e){return"string"==typeof e?e:this._config.labelFormatter?this._config.labelFormatter(e):e.toString()}_getColor(e){return Array.isArray(e)?`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`:e}};const FB=15,zB={hidden:!1,label:void 0,items:[],labelFormatter:void 0,enableEvents:!0,expanded:!1,maxDisplayedItems:15,alignRight:!1,onClick:void 0,onHover:void 0,noDataMessage:"No legend data",loadingMessage:"Data loading..."},UB="style_module_enabled__277b2403",$B="style_module_disabled__7a587f96",VB="style_module_hovered__c0993502";!function(){try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode('@keyframes style_module_fadeIn__ffac87fd{0%{opacity:0}to{opacity:.2}}.style_module_displayState__6ae19b84{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--cosmograph-ui-text);display:flex;justify-content:center;align-items:center;min-width:100px;opacity:.2;font-size:calc(var(--cosmograph-ui-font-size) + 1px);letter-spacing:-.02em;font-weight:200;user-select:none;-webkit-user-select:none;animation:style_module_fadeIn__ffac87fd .3s ease-in-out}:root{--cosmograph-timeline-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-timeline-selection-opacity: .5;--cosmograph-timeline-bar-color: var(--cosmograph-ui-element-color);--cosmograph-timeline-highlighted-bar-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-timeline-font-family: var(--cosmograph-ui-font-family);--cosmograph-timeline-font-size: var(--cosmograph-ui-tick-font-size);--cosmograph-timeline-background: var(--cosmograph-ui-background);--cosmograph-timeline-text-color: var(--cosmograph-ui-text);--cosmograph-timeline-axis-color: var(--cosmograph-ui-text)}.style_module_timeline__736434f7{position:relative;display:flex;background:var(--cosmograph-timeline-background);width:100%;min-height:25px;overflow:hidden}.style_module_timelineSvg__b916ad04{position:relative;width:100%;height:100%}.style_module_selection__ebee57f8{fill:var(--cosmograph-timeline-selection-color);fill-opacity:var(--cosmograph-timeline-selection-opacity);stroke:none}.style_module_axisTick__5865631d{color:var(--cosmograph-timeline-axis-color);font:var(--cosmograph-timeline-font-family);font-size:var(--cosmograph-timeline-font-size);user-select:none;-webkit-user-select:none;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum";alignment-baseline:text-before-edge}.style_module_axisLine__992b502d{opacity:.2;color:var(--cosmograph-timeline-axis-color)}.style_module_bar__114fa79f{fill:var(--cosmograph-timeline-bar-color);transform:scaleY(-1);opacity:0}.style_module_animationControl__ee52cd66{color:var(--cosmograph-timeline-axis-color);width:6%;max-width:30px;min-width:20px;cursor:pointer;display:none;align-items:center;user-select:none;-webkit-user-select:none;opacity:.5;position:relative;justify-content:center}.style_module_animationControl__ee52cd66>svg{width:50%;max-height:20px;padding-right:2px}.style_module_hidden__a73fe81a{display:none}.style_module_disabled__eb988570{opacity:.2;pointer-events:none}.style_module_highlightedBar__c2fc9bdc{fill:var(--cosmograph-timeline-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-search-font-family: var(--cosmograph-ui-font-family);--cosmograph-search-font-size: 14px;--cosmograph-search-list-font-size: 13.5px;--cosmograph-search-text-color: var(--cosmograph-ui-text);--cosmograph-search-background: transparent;--cosmograph-search-list-background: rgba(0, 0, 0, .2);--cosmograph-search-list-match-background: rgba(255, 255, 255, .2);--cosmograph-search-list-match-color: var(--cosmograph-ui-text)}.style_module_searchInput__d7830601:hover{filter:brightness(1.2) contrast(1)}.style_module_searchInput__d7830601{width:100%;background:transparent;color:var(--cosmograph-search-text-color);border:none;border-bottom:.5px solid var(--cosmograph-search-text-color);padding:4px 20px 5px 2px;font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:opacity .2s ease-out}.style_module_searchInput__d7830601::selection{background:var(--cosmograph-search-list-match-background)}.style_module_searchInput__d7830601:focus{outline:none}.style_module_searchSuggestions__b0d3f71e{color:#fff;width:100%;padding:0;margin:0;background:transparent;overflow-y:auto;flex:1;min-height:0}.style_module_searchSuggestions__b0d3f71e li{padding:5px 10px;cursor:pointer;-webkit-user-select:none;user-select:none;display:block;font-weight:500;font-size:var(--cosmograph-search-list-font-size);max-width:100%;overflow:hidden}.style_module_searchSuggestions__b0d3f71e li>div{white-space:nowrap;font-weight:200;overflow:hidden;text-overflow:ellipsis;width:100%}.style_module_searchSuggestions__b0d3f71e li:hover{background:#ffffff1a}.style_module_searchSuggestions__b0d3f71e mark{background:var(--cosmograph-search-list-match-background);color:var(--cosmograph-search-list-match-color);border-radius:2px}.style_module_clearButton__5ebb41de{position:absolute;right:0;top:0;height:100%;background:none;border:none;color:var(--cosmograph-search-text-color);font-weight:300;cursor:pointer;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d{opacity:.7}.style_module_placeholderWrapper__72d5eb0e{z-index:1;color:var(--cosmograph-search-text-color);font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);position:absolute;top:0;left:0;width:100%;bottom:0;display:flex;line-height:1.25;align-items:center;transition:transform .3s ease-out,opacity .3s ease-out}.style_module_placeholderWrapper__72d5eb0e.style_module_hidden__acfb8431{transform:translate(-30px);pointer-events:none;opacity:0}.style_module_searchInput__d7830601:disabled,.style_module_searchInput__d7830601.style_module_disabled__62c35dc5{opacity:.2;cursor:not-allowed;pointer-events:none}.style_module_disabled__62c35dc5 .style_module_clearButton__5ebb41de{display:none}.style_module_disabled__62c35dc5 .style_module_placeholderWrapper__72d5eb0e{opacity:.3;cursor:not-allowed}.style_module_searchInputWrapper__1edbcb22{position:relative;display:flex;width:100%}.style_module_noResults__363397c3{opacity:.3!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none}.style_module_noResults__363397c3:hover{background:none}.style_module_loading__296e0212{opacity:.7!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none;-webkit-user-select:none;user-select:none}.style_module_dropdownContainer__d98287da{position:absolute;top:100%;left:0;width:100%;background:var(--cosmograph-search-list-background);border-radius:4px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);opacity:0;transform:translateY(-10px);transition:opacity .2s ease-out,transform .2s ease-out;pointer-events:none;overflow:hidden;z-index:10;display:flex;flex-direction:column;padding-bottom:2px}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b{top:auto;bottom:100%;transform:translateY(10px)}.style_module_dropdownContainer__d98287da.style_module_visible__5be7493d{opacity:1;transform:translateY(0);pointer-events:auto}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b.style_module_visible__5be7493d{opacity:1;transform:translateY(-2px);pointer-events:auto}.style_module_footerContainer__73e7a066{flex-shrink:0}:root{--cosmograph-scrollbar-background: rgba(255, 255, 255, .1);--cosmograph-ui-background: rgb(45, 49, 58);--cosmograph-ui-text: #ffffffc7;--cosmograph-ui-tick-font-size: 11px;--cosmograph-ui-font-size: 12px;--cosmograph-ui-font-family: inherit;--cosmograph-ui-element-color: #5C616A;--cosmograph-ui-highlighted-element-color: white;--cosmograph-ui-selection-control-color: #8d949ea8;-webkit-font-smoothing:antialiased!important;text-rendering:optimizeLegibility!important}.style_module_cosmograph-ui__5acb97f1{background:var(--cosmograph-ui-background);color:var(--cosmograph-ui-text)}.style_module_scrollbar__f1516254 *::-webkit-scrollbar{width:5px;height:5px;border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-track{border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-corner{background:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-button{display:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-thumb{background-color:var(--cosmograph-scrollbar-background);transition:background-color .5s;border-radius:20px;border:3px solid var(--cosmograph-scrollbar-background)}@-moz-document url-prefix(){.style_module_scrollbar__f1516254 *{scrollbar-width:thin;scrollbar-color:var(--cosmograph-scrollbar-background) transparent;scrollbar-track-color:transparent;scrollbar-face-color:var(--cosmograph-scrollbar-background)}}:root{--cosmograph-histogram-background: var(--cosmograph-ui-background);--cosmograph-histogram-text-color: var(--cosmograph-ui-text);--cosmograph-histogram-axis-color: var(--cosmograph-ui-text);--cosmograph-histogram-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-histogram-selection-opacity: .5;--cosmograph-histogram-bar-color: var(--cosmograph-ui-element-color);--cosmograph-histogram-highlighted-bar-color: var( --cosmograph-ui-highlighted-element-color);--cosmograph-histogram-font-family: var(--cosmograph-ui-font-family);--cosmograph-histogram-font-size: var(--cosmograph-ui-tick-font-size)}.style_module_histogram__9d8a77ea{position:relative;display:flex;min-height:25px;background:var(--cosmograph-histogram-background);width:100%}.style_module_histogramSvg__ccccb628{position:relative;width:100%;height:100%}.style_module_selection__7db96137{fill:var(--cosmograph-histogram-selection-color);fill-opacity:var(--cosmograph-histogram-selection-opacity);stroke:none}.style_module_axisTick__898e1f39{color:var(--cosmograph-histogram-axis-color);font-family:var(--cosmograph-histogram-font-family);font-size:var(--cosmograph-histogram-font-size);user-select:none;-webkit-user-select:none;alignment-baseline:text-before-edge;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum"}.style_module_bar__3c9ab488{fill:var(--cosmograph-histogram-bar-color);transform:scaleY(-1)}.style_module_highlightedBar__b193a8de{fill:var(--cosmograph-histogram-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-bars-font-color: var(--cosmograph-ui-text);--cosmograph-bars-font-family: var(--cosmograph-ui-font-family);--cosmograph-bars-font-size: var(--cosmograph-ui-font-size);--cosmograph-bars-ui-font-size: 11.5px;--cosmograph-bars-background: var(--cosmograph-ui-element-color);--cosmograph-bars-bar-height: 20px;--cosmograph-bars-bar-bottom-margin: 2px;--cosmograph-bars-highlighted-color: var( --cosmograph-ui-highlighted-element-color)}.style_module_bars__25497ded{position:relative;width:100%;min-height:100px;user-select:none;flex-direction:column;-webkit-user-select:none}.style_module_bars__25497ded .scroll-container{position:relative;width:100%;overflow-y:hidden;overflow-x:hidden}.style_module_bars__25497ded .bars-container{position:relative;width:calc(100% - 1px);font-family:var(--cosmograph-bars-font-family)}.style_module_bars__25497ded .highlighted-bars-container{position:absolute;top:0;left:0;pointer-events:none}.style_module_bars__25497ded .row{height:var(--cosmograph-bars-bar-height);display:flex;align-items:center;margin-bottom:var(--cosmograph-bars-bar-bottom-margin);width:100%;transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row:hover{filter:brightness(1.15) contrast(1.05);transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row.unselected:hover{filter:brightness(.95) contrast(1.15);transition:filter .05s linear}.style_module_bars__25497ded .unselected{opacity:.85;filter:brightness(.8) contrast(1.1)}.style_module_bars__25497ded .selected{filter:brightness(1.05) contrast(1.05)}.style_module_bars__25497ded .selected>.info>.label{font-weight:600;filter:brightness(1.1) contrast(1.05)}.style_module_bars__25497ded .unselected>.info>.label{font-weight:300}.style_module_bars__25497ded .bar{height:100%;background-color:var(--cosmograph-bars-background);opacity:.8;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .bar-highlighted{height:100%;background-color:var(--cosmograph-bars-highlighted-color);opacity:.2;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .info{display:flex;justify-content:space-between;width:100%;padding:0 4px;position:absolute;font-size:var(--cosmograph-bars-font-size);font-feature-settings:"tnum";color:var(--cosmograph-bars-font-color);gap:2px}.style_module_bars__25497ded .label{min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:opacity .05s linear}.style_module_bars__25497ded .count{flex-shrink:0;font-weight:300;opacity:.8;transition:opacity .05s linear}.style_module_bars__25497ded .show-more{cursor:pointer;padding-top:2px;display:flex;font-weight:300;color:var(--cosmograph-bars-font-color);font-size:11px;justify-content:space-between;opacity:.6;font-size:var(--cosmograph-bars-ui-font-size);pointer-events:none;transition:opacity .1s linear}.style_module_bars__25497ded .show-more:hover{opacity:1;text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .show-more>span{pointer-events:all}.style_module_bars__25497ded .show-more-count{padding-right:5px;pointer-events:all;font-feature-settings:"tnum"}.style_module_bars__25497ded .unselected>.info>.label,.style_module_bars__25497ded .unselected>.info>.count{opacity:.5}.style_module_bars__25497ded .unselected:hover>.info>.label,.style_module_bars__25497ded .unselected:hover>.info>.count{opacity:1}.style_module_bars__25497ded .search-input{background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,.3);font-size:13px!important;color:var(--cosmograph-bars-font-color);line-height:1.5;padding:2px;width:100%;position:relative;transition:border-bottom-color .2s}.style_module_bars__25497ded .search-input::placeholder{color:var(--cosmograph-bars-font-color)!important;opacity:.4;font-weight:300;font-family:inherit}.style_module_bars__25497ded .search-container{position:relative;width:100%;margin-bottom:4px;display:none;z-index:1}.style_module_bars__25497ded .clear-button{position:absolute;right:0;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--cosmograph-bars-font-color);font-weight:300;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_bars__25497ded .clear-button.visible:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_bars__25497ded .clear-button.visible{opacity:.7}.style_module_bars__25497ded .clear-button svg{width:10px;height:10px;fill:currentColor}.style_module_bars__25497ded .sorting-block{visibility:hidden;margin-top:1px;display:flex;justify-content:space-between}.style_module_bars__25497ded .buttons-container{margin-top:4px;font-size:var(--cosmograph-bars-ui-font-size);display:flex;gap:4px;line-height:1.25}.style_module_bars__25497ded .buttons-container>div{transition:opacity .05s linear,filter .05s linear;padding:1px 5px;background:var(--cosmograph-bars-background);border-radius:4px;opacity:.9;display:flex;cursor:pointer;align-items:center}.style_module_bars__25497ded .buttons-container>div:hover{filter:brightness(1.2)}.style_module_bars__25497ded .reset-text{transition:opacity .05s linear,filter .05s linear;display:flex;font-size:var(--cosmograph-bars-ui-font-size);align-items:end;padding-right:4px;cursor:pointer;font-weight:300}.style_module_bars__25497ded .reset-text:hover{text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .reset-text.unselected{pointer-events:none;cursor:default;opacity:.7}.style_module_bars__25497ded :scope.reset-text:hover:not(.unselected){filter:brightness(1.5);opacity:1}:root{--cosmograph-size-legend-form-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-family: inherit;--cosmograph-size-legend-font-size: var(--cosmograph-ui-font-size);--cosmograph-size-legend-sublabel-font-size: 10px;--cosmograph-size-legend-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-size-legend-line-radius: 2px;--cosmograph-size-legend-line-width: 30px;--cosmograph-size-legend-hide-transform: translateY(100%);--cosmograph-size-legend-show-transform: translateX(0)}.style_module_container__d2889234{display:flex;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;overflow:hidden;min-height:25px}.style_module_legend__75c167f2{width:auto;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-size-legend-font-size);font-family:var(--cosmograph-size-legend-font-family);user-select:none;-webkit-user-select:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.04em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__91eae57a{opacity:1;transform:var(--cosmograph-size-legend-show-transform)}.style_module_disabled__d51f7a10{opacity:0;transform:var(--cosmograph-size-legend-hide-transform);pointer-events:none;display:none!important;min-height:0}@starting-style{.style_module_container__d2889234.style_module_enabled__91eae57a,.style_module_legend__75c167f2.style_module_enabled__91eae57a{opacity:0;transform:var(--cosmograph-size-legend-hide-transform)}}.style_module_legend__75c167f2 .circle{background-color:var(--cosmograph-size-legend-form-color);border-radius:50%;transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2 .line{background-color:var(--cosmograph-size-legend-form-color);border-radius:var(--cosmograph-size-legend-line-radius);width:var(--cosmograph-size-legend-line-width);transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2.style_module_events__894316a8{pointer-events:auto;cursor:pointer}.style_module_legend__75c167f2 .legend-content{display:flex;align-items:end;justify-content:center;gap:.75rem}.style_module_legend__75c167f2 .legend-content>div{transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__75c167f2 .labels-wrapper{white-space:nowrap}.style_module_legend__75c167f2 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-size-legend-items-margin)}.style_module_legend__75c167f2 .name{align-items:center;text-align:center;justify-content:center;display:flex;color:var(--cosmograph-size-legend-font-color);overflow:hidden;width:100%;margin-top:3px;word-break:break-all;white-space:pre-line;transition:color .15s ease-in-out;letter-spacing:-.02em}.style_module_legend__75c167f2 .label{color:var(--cosmograph-size-legend-font-color);overflow:hidden;transition:color .15s ease-in-out;text-overflow:ellipsis;font-feature-settings:"tnum"}.style_module_legend__75c167f2 .sublabel{padding-top:1px;font-size:var(--cosmograph-size-legend-sublabel-font-size);opacity:.5;line-height:1;min-width:10px;transition:color .15s ease-in-out}.style_module_hovered__1206707f .label,.style_module_hovered__1206707f .sublabel{color:var(--cosmograph-size-legend-hover-color);cursor:pointer}.style_module_hovered__1206707f .circle,.style_module_hovered__1206707f .line{background-color:var(--cosmograph-size-legend-hover-color);cursor:pointer}:root{--cosmograph-color-legend-range-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-range-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-range-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-label-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-sublabel-font-size: 10px;--cosmograph-color-legend-range-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-range-gradient-height: 6px;--cosmograph-color-legend-range-gradient-radius: 8px;--cosmograph-color-legend-range-gradient-top-margin: 6px;--cosmograph-color-legend-hide-transform: translateY(100%);--cosmograph-color-legend-show-transform: translateX(0)}.style_module_container__05cc807d{display:flex;min-width:150px;min-height:25px;width:100%;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_legend__a3e235e4{width:100%;font-weight:300;letter-spacing:-.04em;display:flex;flex-direction:column;font-size:var(--cosmograph-color-legend-range-font-size);font-family:var(--cosmograph-color-legend-range-font-family);user-select:none;-webkit-user-select:none;pointer-events:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__b3120e27{opacity:1;transform:var(--cosmograph-color-legend-show-transform);pointer-events:auto}.style_module_disabled__c2dc158c{opacity:0;transform:var(--cosmograph-color-legend-hide-transform);pointer-events:none;display:none;min-height:0}@starting-style{.style_module_container__05cc807d.style_module_enabled__b3120e27,.style_module_legend__a3e235e4.style_module_enabled__b3120e27{opacity:0;transform:var(--cosmograph-color-legend-hide-transform)}}.style_module_legend__a3e235e4 .legend-content{display:flex;align-items:end;justify-content:space-between}.style_module_hovered__dfd7bb2c .label,.style_module_hovered__dfd7bb2c .sublabel{color:var(--cosmograph-size-legend-hover-color)!important;cursor:pointer}.style_module_legend__a3e235e4 .extent{white-space:nowrap;transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__a3e235e4 .gradient{width:100%;margin-top:var(--cosmograph-color-legend-range-gradient-top-margin);height:var(--cosmograph-color-legend-range-gradient-height);border-radius:var(--cosmograph-color-legend-range-gradient-radius)}.style_module_legend__a3e235e4 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-color-legend-range-items-margin)}.style_module_legend__a3e235e4 .name{align-items:center;text-align:center;justify-content:space-around;display:flex;color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;width:100%;word-break:break-word;text-wrap:balance;white-space:pre-line;transition:color .15s ease-in-out;margin:0 4px;letter-spacing:-.02em;line-height:1.25}.style_module_legend__a3e235e4 .label{color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;max-width:150px;text-overflow:ellipsis;font-size:var(--cosmograph-color-legend-range-label-font-size);transition:color .15s ease-in-out;line-height:1;font-feature-settings:"tnum"}.style_module_legend__a3e235e4 .sublabel{padding-top:1px;color:var(--cosmograph-color-legend-range-font-color);opacity:.55;font-size:var(--cosmograph-color-legend-range-sublabel-font-size);line-height:1;transition:color .15s ease-in-out}:root{--cosmograph-color-legend-type-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-type-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-type-font-size: 11px;--cosmograph-color-legend-type-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-type-others-color: #bab0ab;--cosmograph-color-legend-type-bullet-size: 8px;--cosmograph-color-legend-type-bullet-radius: 1rem;--cosmograph-color-legend-type-items-margin: 4px;--cosmograph-color-legend-type-hide-transform: translateY(125%);--cosmograph-color-legend-type-show-transform: translateX(0)}.style_module_enabled__277b2403{opacity:1;transform:var(--cosmograph-color-legend-type-show-transform)}.style_module_disabled__7a587f96{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform);display:none!important;min-height:0}.style_module_wrapper__ea8ca7f4{position:relative;max-width:100%;width:fit-content;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_typeLegend__15bf4b2f{position:relative;width:fit-content;max-width:100%;min-height:25px;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.015em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_typeLegend__15bf4b2f .reverted{flex-direction:row-reverse}.style_module_typeLegend__15bf4b2f .scroll-container{width:100%;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-color-legend-type-font-size);font-family:var(--cosmograph-color-legend-type-font-family);user-select:none;-webkit-user-select:none;line-height:normal;overflow-x:hidden;overflow-y:auto;will-change:transform}@starting-style{.style_module_typeLegend__15bf4b2f.style_module_enabled__277b2403,.style_module_wrapper__ea8ca7f4.style_module_enabled__277b2403{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform)}}.style_module_typeLegend__15bf4b2f .legend-item{display:flex;align-items:center;position:absolute;margin-bottom:var(--cosmograph-color-legend-type-items-margin);pointer-events:none;width:100%;padding-left:1px;font-weight:300;transition:filter .1s ease-in-out,opacity .1s ease-in-out;min-height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px + var(--cosmograph-color-legend-type-items-margin));height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px);box-sizing:border-box}.style_module_typeLegend__15bf4b2f .unknown{background-color:var(--cosmograph-color-legend-type-unknown-color)}.style_module_typeLegend__15bf4b2f .others{background-color:var(--cosmograph-color-legend-type-others-color)}.style_module_typeLegend__15bf4b2f .bullet{height:var(--cosmograph-color-legend-type-bullet-size);width:var(--cosmograph-color-legend-type-bullet-size);min-height:var(--cosmograph-color-legend-type-bullet-size);min-width:var(--cosmograph-color-legend-type-bullet-size);border-radius:var(--cosmograph-color-legend-type-bullet-radius);pointer-events:all;margin-right:5px}.style_module_typeLegend__15bf4b2f .label{color:var(--cosmograph-color-legend-type-font-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - var(--cosmograph-color-legend-type-bullet-size) - 5px);pointer-events:all;transition:.05s linear color}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.bullet{margin-right:0}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.label{margin-right:5px}.style_module_typeLegend__15bf4b2f .show-more{cursor:pointer;padding-top:4px;display:none;font-weight:300;color:var(--cosmograph-color-legend-type-font-color);font-size:11px;opacity:.6;pointer-events:all;justify-content:space-between;transition:opacity .1s linear;font-feature-settings:"tnum"}.style_module_typeLegend__15bf4b2f .show-more:hover{opacity:1}.style_module_hovered__c0993502 .label,.style_module_hovered__c0993502 .sublabel{color:var(--cosmograph-color-legend-type-hover-color)!important;cursor:pointer}.style_module_selected__36e1dd81{filter:brightness(1)}.style_module_selected__36e1dd81>.style_module_label__afecc7a3{filter:brightness(1.2)}.style_module_unselected__4826cfb7{filter:brightness(.5)}.style_module_typeLegend__15bf4b2f .name{font-size:calc(var(--cosmograph-color-legend-type-font-size) + 1px);font-family:var(--cosmograph-color-legend-type-font-family);color:var(--cosmograph-color-legend-type-font-color);transition:color .15s ease-in-out,opacity .3s ease-in-out,max-height .3s ease-in-out,transform .3s ease-in-out;margin-bottom:4px;margin-top:2px;margin-left:1px;letter-spacing:-.02em;line-height:1.25;overflow:hidden;width:100%;white-space:nowrap;text-overflow:ellipsis;pointer-events:all;-webkit-user-select:none!important;user-select:none!important;max-height:100px;opacity:1;transform:translateY(0)}.style_module_typeLegend__15bf4b2f .name.hidden{opacity:0;max-height:0;margin-bottom:0;margin-top:0;transform:translateY(-10px)}:root{--cosmograph-button-color: var(--cosmograph-ui-text);--cosmograph-button-background: var(--cosmograph-ui-element-color);--cosmograph-button-border-radius: 2px}.style_module_button__e95a1138{background:var(--cosmograph-button-background);color:var(--cosmograph-button-color);border-radius:var(--cosmograph-button-border-radius);display:none;align-items:center;justify-content:center;width:25px;height:25px;margin:3px;padding:5px;cursor:pointer;filter:brightness(.95) contrast(.9);transition:filter .1s}.style_module_button__e95a1138:hover{filter:brightness(1.2) contrast(1)}')),document.head.appendChild(e)}}catch(_C){console.error("vite-plugin-css-injected-by-js",_C)}}();var HB=Object.defineProperty,GB=(e,t,n)=>((e,t,n)=>t in e?HB(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class WB extends qO{constructor(e,t){const n=IO(zB,t??{});super(e,qO.extractConfig(n,zB)),GB(this,"_containerNode"),GB(this,"_config"),GB(this,"_scrollContainer"),GB(this,"_legendItems"),GB(this,"_showMoreButton"),GB(this,"_wrapper"),GB(this,"_itemHeight",0),GB(this,"_itemMargin",0),GB(this,"_visibleItemsCount",0),GB(this,"_startIndex",0),GB(this,"_endIndex",0),GB(this,"_listItems",[]),GB(this,"_selectedItem"),GB(this,"_isExpanded",!1),GB(this,"_isHidden",!1),GB(this,"_calculatedWidth",0),GB(this,"_maxMeasuredWidth",0),GB(this,"_maxMeasuredCharLength",0),GB(this,"_label"),GB(this,"_handleShowMore",()=>{var e,t;this._isExpanded=!this._isExpanded,this._isExpanded?(this._containerNode.style.pointerEvents="all",this._scrollContainer.style.overflowY="auto",this._showMoreButton.firstChild.textContent="show less"):(this._containerNode.style.pointerEvents="none",this._scrollContainer.style.overflowY="hidden",this._scrollContainer.scrollTop=0,this._handleShowMoreCount()),null==(t=(e=this._config).onShowMoreClick)||t.call(e,this._isExpanded),this._calculateOptimalWidth(),this._updateVisibleItems()}),GB(this,"_handleShowMoreCount",()=>{const{maxDisplayedItems:e=FB}=this._config,t=this._listItems.length-e;this._showMoreButton.firstChild.textContent=`${t} more...`}),GB(this,"_handleScroll",()=>{requestAnimationFrame(()=>{this._updateVisibleItems()})}),this._config=n,this._containerNode=e,this._containerNode.classList.add("style_module_typeLegend__15bf4b2f"),this._containerNode.classList.add(uB),this._createElements()}get config(){return this._config}get legendItems(){return this._legendItems}get isExpanded(){return this._isExpanded}setConfig(e){const t=this._isExpanded;this._config=IO(zB,e??{}),this.setDisplayStateConfig(qO.extractConfig(this._config,zB)),this._isExpanded=(null==e?void 0:e.expanded)??t,this._updateLegend()}setSelectedItem(e){this._selectedItem=e,this._updateVisibleItems()}resetList(){this._scrollContainer.scrollTop=0,this._selectedItem=void 0,this._updateVisibleItems()}getConfig(){return this._config}show(){this._isHidden&&(this._isHidden=!1,this._containerNode.classList.remove($B),this._containerNode.classList.add(UB))}hide(){this._isHidden||(this._isHidden=!0,this._containerNode.classList.remove(UB),this._containerNode.classList.add($B))}destroy(){this._scrollContainer.removeEventListener("scroll",this._handleScroll),this._containerNode.innerHTML="",super.destroy()}setLoadingState(){super.setLoadingState()}_updateLegend(){const{maxDisplayedItems:e=FB,items:t}=this._config,{noDataMessage:n,loadingMessage:i}=this._displayStateConfig,o=!(null!=t&&t.length)&&!1===n&&!1===i;if(this._config.hidden||o?this.hide():this.show(),null!=t&&t.length){this.hideState(),this._wrapper.classList.remove($B),this._wrapper.classList.add(UB);const n=this._config.label;this._label.textContent=n??"",this._label.title=n??"",n?this._label.classList.remove("hidden"):this._label.classList.add("hidden"),this._listItems=t;const i=this._listItems.length;this._calculateItemDimensions(),this._calculateOptimalWidth(),this._visibleItemsCount=e>i?i:e;const o=this._itemHeight+this._itemMargin,r=Math.ceil(this._visibleItemsCount*o-this._itemMargin);this._scrollContainer.style.height=`${r}px`,this._legendItems.style.height=`${Math.ceil(this._listItems.length*o)}px`,this._scrollContainer.style.overflowY=this._isExpanded?"auto":"hidden",this._containerNode.style.pointerEvents=this._isExpanded?"all":"none",this._updateVisibleItems(),this._showMoreButton.style.display=this._listItems.length>e?"block":"none"}else this.showState(),this._wrapper.classList.remove(UB),this._wrapper.classList.add($B)}_updateVisibleItems(){const e=this._itemHeight+this._itemMargin,t=this._scrollContainer.scrollTop;this._startIndex=Math.max(0,Math.floor(t/e)-3);const n=this._isExpanded?Math.ceil(this._scrollContainer.clientHeight/e+6):this._visibleItemsCount;this._endIndex=Math.min(this._startIndex+n,this._listItems.length);const i=document.createDocumentFragment();for(let o=this._startIndex;o<this._endIndex;o++){const t=this._listItems[o];if(t){const n=this._createLegendItem(t);n.style.position="absolute",n.style.top=o*e+"px",i.appendChild(n)}}this._legendItems.innerHTML="",this._legendItems.appendChild(i),this._updateShowMoreButton()}_createElements(){this._wrapper=document.createElement("div"),this._wrapper.classList.add("style_module_wrapper__ea8ca7f4"),this._label=document.createElement("div"),this._label.classList.add("name"),this._wrapper.appendChild(this._label),this._scrollContainer=document.createElement("div"),this._scrollContainer.classList.add("scroll-container"),this._scrollContainer.addEventListener("scroll",this._handleScroll,{passive:!0}),this._legendItems=document.createElement("div"),this._legendItems.className="legend-items",this._scrollContainer.appendChild(this._legendItems),this._showMoreButton=this._createShowMoreButton(),this._wrapper.appendChild(this._scrollContainer),this._wrapper.appendChild(this._showMoreButton),this._containerNode.appendChild(this._wrapper),this._isHidden||this.show()}_createShowMoreButton(){const e=document.createElement("div");e.classList.add("show-more"),e.addEventListener("click",this._handleShowMore);const t=document.createElement("span");return e.appendChild(t),e}_updateShowMoreButton(){this._isExpanded?this._showMoreButton.firstChild.textContent="show less":this._handleShowMoreCount()}_calculateItemDimensions(){const e=this._createLegendItem({label:"Sample",color:"#000000"});e.style.visibility="hidden",e.style.position="absolute",this._legendItems.appendChild(e);const t=window.getComputedStyle(e);this._itemHeight=e.offsetHeight,this._itemMargin=parseFloat(t.marginTop)+parseFloat(t.marginBottom),this._legendItems.removeChild(e)}_createLegendItem(e){const t=document.createElement("div");t.classList.add("legend-item"),t.title=e.label,this._config.alignRight&&t.classList.add("reverted"),this._selectedItem&&t.classList.add(this._selectedItem.label===e.label?"style_module_selected__36e1dd81":"style_module_unselected__4826cfb7"),this._config.enableEvents&&(this._config.onClick&&(t.style.cursor="pointer",t.addEventListener("click",t=>this._config.onClick(t,e))),this._config.onHover&&(t.addEventListener("mouseenter",n=>{t.classList.add(VB),this._config.onHover(n,e)}),t.addEventListener("mouseleave",n=>{t.classList.remove(VB),this._config.onHover(n,e)})));const n=document.createElement("div");n.className="bullet",n.style.backgroundColor=e.color;const i=document.createElement("div");return i.className="label",i.style.whiteSpace="nowrap",i.textContent=e.label,t.appendChild(n),t.appendChild(i),t}_calculateOptimalWidth(){var e;if(!this._listItems.length)return;let t=0;for(const c of this._listItems)c.label&&c.label.length>t&&(t=c.label.length);if(this._listItems.length>(this._config.maxDisplayedItems||FB)){const e=this._listItems.length-(this._config.maxDisplayedItems||FB);t=Math.max(t,`${e} more...`.length,9)}if(t<=this._maxMeasuredCharLength)return void(this._maxMeasuredWidth&&this._applyCalculatedWidth(this._maxMeasuredWidth));this._maxMeasuredCharLength=t;const n=getComputedStyle(this._containerNode).getPropertyValue("--cosmograph-color-legend-type-font-size")||"11px",i=getComputedStyle(this._containerNode).getPropertyValue("--cosmograph-color-legend-type-font-family")||"inherit",o=document.createElement("canvas").getContext("2d");o.font=`300 ${n} ${i}`;let r=0;if(this._listItems.forEach(e=>{const t=o.measureText(e.label).width;t>r&&(r=t)}),this._listItems.length>(this._config.maxDisplayedItems||FB)){const e=this._listItems.length-(this._config.maxDisplayedItems||FB);r=Math.max(r,o.measureText(`${e} more...`).width,o.measureText("show less").width)}const s=13+r+10,a=(null==(e=this._containerNode.parentElement)?void 0:e.offsetWidth)||0,l=a>0?Math.min(a-20,s):s;this._calculatedWidth=Math.max(100,l),this._maxMeasuredWidth=this._calculatedWidth,this._applyCalculatedWidth(this._calculatedWidth)}_applyCalculatedWidth(e){this._containerNode.style.minWidth=`${e}px`,this._wrapper.style.minWidth=`${e}px`}}const jB={onClick:void 0,iconSvg:void 0,description:void 0};!function(){try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode('@keyframes style_module_fadeIn__ffac87fd{0%{opacity:0}to{opacity:.2}}.style_module_displayState__6ae19b84{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--cosmograph-ui-text);display:flex;justify-content:center;align-items:center;min-width:100px;opacity:.2;font-size:calc(var(--cosmograph-ui-font-size) + 1px);letter-spacing:-.02em;font-weight:200;user-select:none;-webkit-user-select:none;animation:style_module_fadeIn__ffac87fd .3s ease-in-out}:root{--cosmograph-timeline-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-timeline-selection-opacity: .5;--cosmograph-timeline-bar-color: var(--cosmograph-ui-element-color);--cosmograph-timeline-highlighted-bar-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-timeline-font-family: var(--cosmograph-ui-font-family);--cosmograph-timeline-font-size: var(--cosmograph-ui-tick-font-size);--cosmograph-timeline-background: var(--cosmograph-ui-background);--cosmograph-timeline-text-color: var(--cosmograph-ui-text);--cosmograph-timeline-axis-color: var(--cosmograph-ui-text)}.style_module_timeline__736434f7{position:relative;display:flex;background:var(--cosmograph-timeline-background);width:100%;min-height:25px;overflow:hidden}.style_module_timelineSvg__b916ad04{position:relative;width:100%;height:100%}.style_module_selection__ebee57f8{fill:var(--cosmograph-timeline-selection-color);fill-opacity:var(--cosmograph-timeline-selection-opacity);stroke:none}.style_module_axisTick__5865631d{color:var(--cosmograph-timeline-axis-color);font:var(--cosmograph-timeline-font-family);font-size:var(--cosmograph-timeline-font-size);user-select:none;-webkit-user-select:none;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum";alignment-baseline:text-before-edge}.style_module_axisLine__992b502d{opacity:.2;color:var(--cosmograph-timeline-axis-color)}.style_module_bar__114fa79f{fill:var(--cosmograph-timeline-bar-color);transform:scaleY(-1);opacity:0}.style_module_animationControl__ee52cd66{color:var(--cosmograph-timeline-axis-color);width:6%;max-width:30px;min-width:20px;cursor:pointer;display:none;align-items:center;user-select:none;-webkit-user-select:none;opacity:.5;position:relative;justify-content:center}.style_module_animationControl__ee52cd66>svg{width:50%;max-height:20px;padding-right:2px}.style_module_hidden__a73fe81a{display:none}.style_module_disabled__eb988570{opacity:.2;pointer-events:none}.style_module_highlightedBar__c2fc9bdc{fill:var(--cosmograph-timeline-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-search-font-family: var(--cosmograph-ui-font-family);--cosmograph-search-font-size: 14px;--cosmograph-search-list-font-size: 13.5px;--cosmograph-search-text-color: var(--cosmograph-ui-text);--cosmograph-search-background: transparent;--cosmograph-search-list-background: rgba(0, 0, 0, .2);--cosmograph-search-list-match-background: rgba(255, 255, 255, .2);--cosmograph-search-list-match-color: var(--cosmograph-ui-text)}.style_module_searchInput__d7830601:hover{filter:brightness(1.2) contrast(1)}.style_module_searchInput__d7830601{width:100%;background:transparent;color:var(--cosmograph-search-text-color);border:none;border-bottom:.5px solid var(--cosmograph-search-text-color);padding:4px 20px 5px 2px;font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:opacity .2s ease-out}.style_module_searchInput__d7830601::selection{background:var(--cosmograph-search-list-match-background)}.style_module_searchInput__d7830601:focus{outline:none}.style_module_searchSuggestions__b0d3f71e{color:#fff;width:100%;padding:0;margin:0;background:transparent;overflow-y:auto;flex:1;min-height:0}.style_module_searchSuggestions__b0d3f71e li{padding:5px 10px;cursor:pointer;-webkit-user-select:none;user-select:none;display:block;font-weight:500;font-size:var(--cosmograph-search-list-font-size);max-width:100%;overflow:hidden}.style_module_searchSuggestions__b0d3f71e li>div{white-space:nowrap;font-weight:200;overflow:hidden;text-overflow:ellipsis;width:100%}.style_module_searchSuggestions__b0d3f71e li:hover{background:#ffffff1a}.style_module_searchSuggestions__b0d3f71e mark{background:var(--cosmograph-search-list-match-background);color:var(--cosmograph-search-list-match-color);border-radius:2px}.style_module_clearButton__5ebb41de{position:absolute;right:0;top:0;height:100%;background:none;border:none;color:var(--cosmograph-search-text-color);font-weight:300;cursor:pointer;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_clearButton__5ebb41de.style_module_visible__5be7493d{opacity:.7}.style_module_placeholderWrapper__72d5eb0e{z-index:1;color:var(--cosmograph-search-text-color);font-family:var(--cosmograph-search-font-family);font-size:var(--cosmograph-search-font-size);position:absolute;top:0;left:0;width:100%;bottom:0;display:flex;line-height:1.25;align-items:center;transition:transform .3s ease-out,opacity .3s ease-out}.style_module_placeholderWrapper__72d5eb0e.style_module_hidden__acfb8431{transform:translate(-30px);pointer-events:none;opacity:0}.style_module_searchInput__d7830601:disabled,.style_module_searchInput__d7830601.style_module_disabled__62c35dc5{opacity:.2;cursor:not-allowed;pointer-events:none}.style_module_disabled__62c35dc5 .style_module_clearButton__5ebb41de{display:none}.style_module_disabled__62c35dc5 .style_module_placeholderWrapper__72d5eb0e{opacity:.3;cursor:not-allowed}.style_module_searchInputWrapper__1edbcb22{position:relative;display:flex;width:100%}.style_module_noResults__363397c3{opacity:.3!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none}.style_module_noResults__363397c3:hover{background:none}.style_module_loading__296e0212{opacity:.7!important;cursor:default;font-weight:300!important;padding:6px!important;text-align:center;pointer-events:none;-webkit-user-select:none;user-select:none}.style_module_dropdownContainer__d98287da{position:absolute;top:100%;left:0;width:100%;background:var(--cosmograph-search-list-background);border-radius:4px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);opacity:0;transform:translateY(-10px);transition:opacity .2s ease-out,transform .2s ease-out;pointer-events:none;overflow:hidden;z-index:10;display:flex;flex-direction:column;padding-bottom:2px}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b{top:auto;bottom:100%;transform:translateY(10px)}.style_module_dropdownContainer__d98287da.style_module_visible__5be7493d{opacity:1;transform:translateY(0);pointer-events:auto}.style_module_dropdownContainer__d98287da.style_module_upwards__e0b4831b.style_module_visible__5be7493d{opacity:1;transform:translateY(-2px);pointer-events:auto}.style_module_footerContainer__73e7a066{flex-shrink:0}:root{--cosmograph-scrollbar-background: rgba(255, 255, 255, .1);--cosmograph-ui-background: rgb(45, 49, 58);--cosmograph-ui-text: #ffffffc7;--cosmograph-ui-tick-font-size: 11px;--cosmograph-ui-font-size: 12px;--cosmograph-ui-font-family: inherit;--cosmograph-ui-element-color: #5C616A;--cosmograph-ui-highlighted-element-color: white;--cosmograph-ui-selection-control-color: #8d949ea8;-webkit-font-smoothing:antialiased!important;text-rendering:optimizeLegibility!important}.style_module_cosmograph-ui__5acb97f1{background:var(--cosmograph-ui-background);color:var(--cosmograph-ui-text)}.style_module_scrollbar__f1516254 *::-webkit-scrollbar{width:5px;height:5px;border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-track{border-radius:.3rem}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-corner{background:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-button{display:none!important}.style_module_scrollbar__f1516254 *::-webkit-scrollbar-thumb{background-color:var(--cosmograph-scrollbar-background);transition:background-color .5s;border-radius:20px;border:3px solid var(--cosmograph-scrollbar-background)}@-moz-document url-prefix(){.style_module_scrollbar__f1516254 *{scrollbar-width:thin;scrollbar-color:var(--cosmograph-scrollbar-background) transparent;scrollbar-track-color:transparent;scrollbar-face-color:var(--cosmograph-scrollbar-background)}}:root{--cosmograph-histogram-background: var(--cosmograph-ui-background);--cosmograph-histogram-text-color: var(--cosmograph-ui-text);--cosmograph-histogram-axis-color: var(--cosmograph-ui-text);--cosmograph-histogram-selection-color: var(--cosmograph-ui-selection-control-color);--cosmograph-histogram-selection-opacity: .5;--cosmograph-histogram-bar-color: var(--cosmograph-ui-element-color);--cosmograph-histogram-highlighted-bar-color: var( --cosmograph-ui-highlighted-element-color);--cosmograph-histogram-font-family: var(--cosmograph-ui-font-family);--cosmograph-histogram-font-size: var(--cosmograph-ui-tick-font-size)}.style_module_histogram__9d8a77ea{position:relative;display:flex;min-height:25px;background:var(--cosmograph-histogram-background);width:100%}.style_module_histogramSvg__ccccb628{position:relative;width:100%;height:100%}.style_module_selection__7db96137{fill:var(--cosmograph-histogram-selection-color);fill-opacity:var(--cosmograph-histogram-selection-opacity);stroke:none}.style_module_axisTick__898e1f39{color:var(--cosmograph-histogram-axis-color);font-family:var(--cosmograph-histogram-font-family);font-size:var(--cosmograph-histogram-font-size);user-select:none;-webkit-user-select:none;alignment-baseline:text-before-edge;opacity:1;font-weight:300;text-anchor:initial;font-feature-settings:"tnum"}.style_module_bar__3c9ab488{fill:var(--cosmograph-histogram-bar-color);transform:scaleY(-1)}.style_module_highlightedBar__b193a8de{fill:var(--cosmograph-histogram-highlighted-bar-color);transform:scaleY(-1);pointer-events:none}:root{--cosmograph-bars-font-color: var(--cosmograph-ui-text);--cosmograph-bars-font-family: var(--cosmograph-ui-font-family);--cosmograph-bars-font-size: var(--cosmograph-ui-font-size);--cosmograph-bars-ui-font-size: 11.5px;--cosmograph-bars-background: var(--cosmograph-ui-element-color);--cosmograph-bars-bar-height: 20px;--cosmograph-bars-bar-bottom-margin: 2px;--cosmograph-bars-highlighted-color: var( --cosmograph-ui-highlighted-element-color)}.style_module_bars__25497ded{position:relative;width:100%;min-height:100px;user-select:none;flex-direction:column;-webkit-user-select:none}.style_module_bars__25497ded .scroll-container{position:relative;width:100%;overflow-y:hidden;overflow-x:hidden}.style_module_bars__25497ded .bars-container{position:relative;width:calc(100% - 1px);font-family:var(--cosmograph-bars-font-family)}.style_module_bars__25497ded .highlighted-bars-container{position:absolute;top:0;left:0;pointer-events:none}.style_module_bars__25497ded .row{height:var(--cosmograph-bars-bar-height);display:flex;align-items:center;margin-bottom:var(--cosmograph-bars-bar-bottom-margin);width:100%;transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row:hover{filter:brightness(1.15) contrast(1.05);transition:opacity .1s linear,filter .1s linear}.style_module_bars__25497ded .row.unselected:hover{filter:brightness(.95) contrast(1.15);transition:filter .05s linear}.style_module_bars__25497ded .unselected{opacity:.85;filter:brightness(.8) contrast(1.1)}.style_module_bars__25497ded .selected{filter:brightness(1.05) contrast(1.05)}.style_module_bars__25497ded .selected>.info>.label{font-weight:600;filter:brightness(1.1) contrast(1.05)}.style_module_bars__25497ded .unselected>.info>.label{font-weight:300}.style_module_bars__25497ded .bar{height:100%;background-color:var(--cosmograph-bars-background);opacity:.8;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .bar-highlighted{height:100%;background-color:var(--cosmograph-bars-highlighted-color);opacity:.2;transition:opacity .3s ease,width .3s ease}.style_module_bars__25497ded .info{display:flex;justify-content:space-between;width:100%;padding:0 4px;position:absolute;font-size:var(--cosmograph-bars-font-size);font-feature-settings:"tnum";color:var(--cosmograph-bars-font-color);gap:2px}.style_module_bars__25497ded .label{min-width:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:opacity .05s linear}.style_module_bars__25497ded .count{flex-shrink:0;font-weight:300;opacity:.8;transition:opacity .05s linear}.style_module_bars__25497ded .show-more{cursor:pointer;padding-top:2px;display:flex;font-weight:300;color:var(--cosmograph-bars-font-color);font-size:11px;justify-content:space-between;opacity:.6;font-size:var(--cosmograph-bars-ui-font-size);pointer-events:none;transition:opacity .1s linear}.style_module_bars__25497ded .show-more:hover{opacity:1;text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .show-more>span{pointer-events:all}.style_module_bars__25497ded .show-more-count{padding-right:5px;pointer-events:all;font-feature-settings:"tnum"}.style_module_bars__25497ded .unselected>.info>.label,.style_module_bars__25497ded .unselected>.info>.count{opacity:.5}.style_module_bars__25497ded .unselected:hover>.info>.label,.style_module_bars__25497ded .unselected:hover>.info>.count{opacity:1}.style_module_bars__25497ded .search-input{background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,.3);font-size:13px!important;color:var(--cosmograph-bars-font-color);line-height:1.5;padding:2px;width:100%;position:relative;transition:border-bottom-color .2s}.style_module_bars__25497ded .search-input::placeholder{color:var(--cosmograph-bars-font-color)!important;opacity:.4;font-weight:300;font-family:inherit}.style_module_bars__25497ded .search-container{position:relative;width:100%;margin-bottom:4px;display:none;z-index:1}.style_module_bars__25497ded .clear-button{position:absolute;right:0;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--cosmograph-bars-font-color);font-weight:300;font-size:16px;padding:0 4px;opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .2s ease-out}.style_module_bars__25497ded .clear-button.visible:hover{transition:opacity .1s ease-in-out;opacity:1}.style_module_bars__25497ded .clear-button.visible{opacity:.7}.style_module_bars__25497ded .clear-button svg{width:10px;height:10px;fill:currentColor}.style_module_bars__25497ded .sorting-block{visibility:hidden;margin-top:1px;display:flex;justify-content:space-between}.style_module_bars__25497ded .buttons-container{margin-top:4px;font-size:var(--cosmograph-bars-ui-font-size);display:flex;gap:4px;line-height:1.25}.style_module_bars__25497ded .buttons-container>div{transition:opacity .05s linear,filter .05s linear;padding:1px 5px;background:var(--cosmograph-bars-background);border-radius:4px;opacity:.9;display:flex;cursor:pointer;align-items:center}.style_module_bars__25497ded .buttons-container>div:hover{filter:brightness(1.2)}.style_module_bars__25497ded .reset-text{transition:opacity .05s linear,filter .05s linear;display:flex;font-size:var(--cosmograph-bars-ui-font-size);align-items:end;padding-right:4px;cursor:pointer;font-weight:300}.style_module_bars__25497ded .reset-text:hover{text-decoration:underline;text-underline-offset:1.5px;text-decoration-thickness:.25px}.style_module_bars__25497ded .reset-text.unselected{pointer-events:none;cursor:default;opacity:.7}.style_module_bars__25497ded :scope.reset-text:hover:not(.unselected){filter:brightness(1.5);opacity:1}:root{--cosmograph-size-legend-form-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-color: var(--cosmograph-ui-text);--cosmograph-size-legend-font-family: inherit;--cosmograph-size-legend-font-size: var(--cosmograph-ui-font-size);--cosmograph-size-legend-sublabel-font-size: 10px;--cosmograph-size-legend-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-size-legend-line-radius: 2px;--cosmograph-size-legend-line-width: 30px;--cosmograph-size-legend-hide-transform: translateY(100%);--cosmograph-size-legend-show-transform: translateX(0)}.style_module_container__d2889234{display:flex;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;overflow:hidden;min-height:25px}.style_module_legend__75c167f2{width:auto;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-size-legend-font-size);font-family:var(--cosmograph-size-legend-font-family);user-select:none;-webkit-user-select:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.04em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__91eae57a{opacity:1;transform:var(--cosmograph-size-legend-show-transform)}.style_module_disabled__d51f7a10{opacity:0;transform:var(--cosmograph-size-legend-hide-transform);pointer-events:none;display:none!important;min-height:0}@starting-style{.style_module_container__d2889234.style_module_enabled__91eae57a,.style_module_legend__75c167f2.style_module_enabled__91eae57a{opacity:0;transform:var(--cosmograph-size-legend-hide-transform)}}.style_module_legend__75c167f2 .circle{background-color:var(--cosmograph-size-legend-form-color);border-radius:50%;transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2 .line{background-color:var(--cosmograph-size-legend-form-color);border-radius:var(--cosmograph-size-legend-line-radius);width:var(--cosmograph-size-legend-line-width);transition:background-color .15s ease-in-out;display:inline-block}.style_module_legend__75c167f2.style_module_events__894316a8{pointer-events:auto;cursor:pointer}.style_module_legend__75c167f2 .legend-content{display:flex;align-items:end;justify-content:center;gap:.75rem}.style_module_legend__75c167f2 .legend-content>div{transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__75c167f2 .labels-wrapper{white-space:nowrap}.style_module_legend__75c167f2 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-size-legend-items-margin)}.style_module_legend__75c167f2 .name{align-items:center;text-align:center;justify-content:center;display:flex;color:var(--cosmograph-size-legend-font-color);overflow:hidden;width:100%;margin-top:3px;word-break:break-all;white-space:pre-line;transition:color .15s ease-in-out;letter-spacing:-.02em}.style_module_legend__75c167f2 .label{color:var(--cosmograph-size-legend-font-color);overflow:hidden;transition:color .15s ease-in-out;text-overflow:ellipsis;font-feature-settings:"tnum"}.style_module_legend__75c167f2 .sublabel{padding-top:1px;font-size:var(--cosmograph-size-legend-sublabel-font-size);opacity:.5;line-height:1;min-width:10px;transition:color .15s ease-in-out}.style_module_hovered__1206707f .label,.style_module_hovered__1206707f .sublabel{color:var(--cosmograph-size-legend-hover-color);cursor:pointer}.style_module_hovered__1206707f .circle,.style_module_hovered__1206707f .line{background-color:var(--cosmograph-size-legend-hover-color);cursor:pointer}:root{--cosmograph-color-legend-range-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-range-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-range-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-label-font-size: var(--cosmograph-ui-font-size);--cosmograph-color-legend-range-sublabel-font-size: 10px;--cosmograph-color-legend-range-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-range-gradient-height: 6px;--cosmograph-color-legend-range-gradient-radius: 8px;--cosmograph-color-legend-range-gradient-top-margin: 6px;--cosmograph-color-legend-hide-transform: translateY(100%);--cosmograph-color-legend-show-transform: translateX(0)}.style_module_container__05cc807d{display:flex;min-width:150px;min-height:25px;width:100%;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_legend__a3e235e4{width:100%;font-weight:300;letter-spacing:-.04em;display:flex;flex-direction:column;font-size:var(--cosmograph-color-legend-range-font-size);font-family:var(--cosmograph-color-legend-range-font-family);user-select:none;-webkit-user-select:none;pointer-events:none;cursor:default;text-align:center;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_enabled__b3120e27{opacity:1;transform:var(--cosmograph-color-legend-show-transform);pointer-events:auto}.style_module_disabled__c2dc158c{opacity:0;transform:var(--cosmograph-color-legend-hide-transform);pointer-events:none;display:none;min-height:0}@starting-style{.style_module_container__05cc807d.style_module_enabled__b3120e27,.style_module_legend__a3e235e4.style_module_enabled__b3120e27{opacity:0;transform:var(--cosmograph-color-legend-hide-transform)}}.style_module_legend__a3e235e4 .legend-content{display:flex;align-items:end;justify-content:space-between}.style_module_hovered__dfd7bb2c .label,.style_module_hovered__dfd7bb2c .sublabel{color:var(--cosmograph-size-legend-hover-color)!important;cursor:pointer}.style_module_legend__a3e235e4 .extent{white-space:nowrap;transition:filter .1s ease-in-out,opacity .1s ease-in-out}.style_module_legend__a3e235e4 .gradient{width:100%;margin-top:var(--cosmograph-color-legend-range-gradient-top-margin);height:var(--cosmograph-color-legend-range-gradient-height);border-radius:var(--cosmograph-color-legend-range-gradient-radius)}.style_module_legend__a3e235e4 .legend-item{display:flex;align-items:center;margin-top:var(--cosmograph-color-legend-range-items-margin)}.style_module_legend__a3e235e4 .name{align-items:center;text-align:center;justify-content:space-around;display:flex;color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;width:100%;word-break:break-word;text-wrap:balance;white-space:pre-line;transition:color .15s ease-in-out;margin:0 4px;letter-spacing:-.02em;line-height:1.25}.style_module_legend__a3e235e4 .label{color:var(--cosmograph-color-legend-range-font-color);overflow:hidden;max-width:150px;text-overflow:ellipsis;font-size:var(--cosmograph-color-legend-range-label-font-size);transition:color .15s ease-in-out;line-height:1;font-feature-settings:"tnum"}.style_module_legend__a3e235e4 .sublabel{padding-top:1px;color:var(--cosmograph-color-legend-range-font-color);opacity:.55;font-size:var(--cosmograph-color-legend-range-sublabel-font-size);line-height:1;transition:color .15s ease-in-out}:root{--cosmograph-color-legend-type-font-color: var(--cosmograph-ui-text);--cosmograph-color-legend-type-font-family: var(--cosmograph-ui-font-family);--cosmograph-color-legend-type-font-size: 11px;--cosmograph-color-legend-type-hover-color: var(--cosmograph-ui-highlighted-element-color);--cosmograph-color-legend-type-others-color: #bab0ab;--cosmograph-color-legend-type-bullet-size: 8px;--cosmograph-color-legend-type-bullet-radius: 1rem;--cosmograph-color-legend-type-items-margin: 4px;--cosmograph-color-legend-type-hide-transform: translateY(125%);--cosmograph-color-legend-type-show-transform: translateX(0)}.style_module_enabled__277b2403{opacity:1;transform:var(--cosmograph-color-legend-type-show-transform)}.style_module_disabled__7a587f96{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform);display:none!important;min-height:0}.style_module_wrapper__ea8ca7f4{position:relative;max-width:100%;width:fit-content;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out}.style_module_typeLegend__15bf4b2f{position:relative;width:fit-content;max-width:100%;min-height:25px;transition:opacity .3s ease-in-out,transform .3s ease-in-out,display .3s allow-discrete,min-height .3s ease-in-out;font-weight:300;letter-spacing:-.015em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased}.style_module_typeLegend__15bf4b2f .reverted{flex-direction:row-reverse}.style_module_typeLegend__15bf4b2f .scroll-container{width:100%;display:flex;flex-direction:column;position:relative;font-size:var(--cosmograph-color-legend-type-font-size);font-family:var(--cosmograph-color-legend-type-font-family);user-select:none;-webkit-user-select:none;line-height:normal;overflow-x:hidden;overflow-y:auto;will-change:transform}@starting-style{.style_module_typeLegend__15bf4b2f.style_module_enabled__277b2403,.style_module_wrapper__ea8ca7f4.style_module_enabled__277b2403{opacity:0;transform:var(--cosmograph-color-legend-type-hide-transform)}}.style_module_typeLegend__15bf4b2f .legend-item{display:flex;align-items:center;position:absolute;margin-bottom:var(--cosmograph-color-legend-type-items-margin);pointer-events:none;width:100%;padding-left:1px;font-weight:300;transition:filter .1s ease-in-out,opacity .1s ease-in-out;min-height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px + var(--cosmograph-color-legend-type-items-margin));height:calc(var(--cosmograph-color-legend-type-bullet-size) + 2px);box-sizing:border-box}.style_module_typeLegend__15bf4b2f .unknown{background-color:var(--cosmograph-color-legend-type-unknown-color)}.style_module_typeLegend__15bf4b2f .others{background-color:var(--cosmograph-color-legend-type-others-color)}.style_module_typeLegend__15bf4b2f .bullet{height:var(--cosmograph-color-legend-type-bullet-size);width:var(--cosmograph-color-legend-type-bullet-size);min-height:var(--cosmograph-color-legend-type-bullet-size);min-width:var(--cosmograph-color-legend-type-bullet-size);border-radius:var(--cosmograph-color-legend-type-bullet-radius);pointer-events:all;margin-right:5px}.style_module_typeLegend__15bf4b2f .label{color:var(--cosmograph-color-legend-type-font-color);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - var(--cosmograph-color-legend-type-bullet-size) - 5px);pointer-events:all;transition:.05s linear color}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.bullet{margin-right:0}.style_module_typeLegend__15bf4b2f .legend-item.reverted>.label{margin-right:5px}.style_module_typeLegend__15bf4b2f .show-more{cursor:pointer;padding-top:4px;display:none;font-weight:300;color:var(--cosmograph-color-legend-type-font-color);font-size:11px;opacity:.6;pointer-events:all;justify-content:space-between;transition:opacity .1s linear;font-feature-settings:"tnum"}.style_module_typeLegend__15bf4b2f .show-more:hover{opacity:1}.style_module_hovered__c0993502 .label,.style_module_hovered__c0993502 .sublabel{color:var(--cosmograph-color-legend-type-hover-color)!important;cursor:pointer}.style_module_selected__36e1dd81{filter:brightness(1)}.style_module_selected__36e1dd81>.style_module_label__afecc7a3{filter:brightness(1.2)}.style_module_unselected__4826cfb7{filter:brightness(.5)}.style_module_typeLegend__15bf4b2f .name{font-size:calc(var(--cosmograph-color-legend-type-font-size) + 1px);font-family:var(--cosmograph-color-legend-type-font-family);color:var(--cosmograph-color-legend-type-font-color);transition:color .15s ease-in-out,opacity .3s ease-in-out,max-height .3s ease-in-out,transform .3s ease-in-out;margin-bottom:4px;margin-top:2px;margin-left:1px;letter-spacing:-.02em;line-height:1.25;overflow:hidden;width:100%;white-space:nowrap;text-overflow:ellipsis;pointer-events:all;-webkit-user-select:none!important;user-select:none!important;max-height:100px;opacity:1;transform:translateY(0)}.style_module_typeLegend__15bf4b2f .name.hidden{opacity:0;max-height:0;margin-bottom:0;margin-top:0;transform:translateY(-10px)}:root{--cosmograph-button-color: var(--cosmograph-ui-text);--cosmograph-button-background: var(--cosmograph-ui-element-color);--cosmograph-button-border-radius: 2px}.style_module_button__e95a1138{background:var(--cosmograph-button-background);color:var(--cosmograph-button-color);border-radius:var(--cosmograph-button-border-radius);display:none;align-items:center;justify-content:center;width:25px;height:25px;margin:3px;padding:5px;cursor:pointer;filter:brightness(.95) contrast(.9);transition:filter .1s}.style_module_button__e95a1138:hover{filter:brightness(1.2) contrast(1)}')),document.head.appendChild(e)}}catch(_C){console.error("vite-plugin-css-injected-by-js",_C)}}();var YB=Object.defineProperty,qB=(e,t,n)=>((e,t,n)=>t in e?YB(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);let XB=class{constructor(e,t){qB(this,"_container"),qB(this,"config"),qB(this,"_handleClick",()=>{var e,t;null==(t=(e=this.config).onClick)||t.call(e)}),this._container=e,this._container.classList.add("style_module_button__e95a1138"),this.setConfig(t??{}),this._container.addEventListener("click",this._handleClick)}get element(){return this._container}setConfig(e){this.config=IO(jB,e),this._container.title=this.config.description??"",this._container.innerHTML=this.config.iconSvg??""}show(){this._container.style.display="block"}hide(){this._container.style.display="none"}destroy(){this._container.removeEventListener("click",this._handleClick),this._container.innerHTML=""}};const KB={PointColor:"pointColorBy",PointColorMap:"pointColorByMap",PointColorFn:"pointColorByFn",PointColorPalette:"pointColorPalette",PointColorStrategy:"pointColorStrategy",PointSize:"pointSizeBy",PointSizeStrategy:"pointSizeStrategy",PointSizeRange:"pointSizeRange",PointSizeFn:"pointSizeByFn",PointLabel:"pointLabelBy",PointLabelWeight:"pointLabelWeightBy",PointX:"pointXBy",PointY:"pointYBy",PointCluster:"pointClusterBy",PointClusterFn:"pointClusterByFn",PointClusterStrength:"pointClusterStrengthBy",PointIncludeColumns:"pointIncludeColumns"},ZB={LinkColor:"linkColorBy",LinkColorFn:"linkColorByFn",LinkColorPalette:"linkColorPalette",LinkColorStrategy:"linkColorStrategy",LinkWidth:"linkWidthBy",LinkWidthRange:"linkWidthRange",LinkWidthFn:"linkWidthByFn",LinkWidthStrategy:"linkWidthStrategy",LinkArrow:"linkArrowBy",LinkArrowFn:"linkArrowByFn",LinkStrength:"linkStrengthBy",LinkStrengthFn:"linkStrengthByFn",LinkStrengthRange:"linkStrengthRange",LinkIncludeColumns:"linkIncludeColumns"},QB=Object.values(KB),JB=Object.values(ZB),eF=Object.values({ClusterPositionsMap:"clusterPositionsMap"}),tF=Object.values({Points:"points",PointId:"pointIdBy",PointIndex:"pointIndexBy"}),nF=Object.values({Links:"links",LinkSource:"linkSourceBy",LinkSourceIndex:"linkSourceIndexBy",LinkTarget:"linkTargetBy",LinkTargetIndex:"linkTargetIndexBy"}),iF=[...JB].filter(e=>e!==ZB.LinkIncludeColumns).concat("linkDefaultColor","linkDefaultWidth"),oF=[...QB].filter(e=>e!==KB.PointLabel&&e!==KB.PointLabelWeight&&e!==KB.PointIncludeColumns).concat("pointDefaultColor","pointDefaultSize"),rF=[...Object.values({ShowLabels:"showLabels",ShowDynamicLabels:"showDynamicLabels",ShowTopLabels:"showTopLabels",ShowTopLabelsLimit:"showTopLabelsLimit",ShowLabelsFor:"showLabelsFor",ShowClusterLabels:"showClusterLabels",PointLabelClassName:"pointLabelClassName",PointLabelFn:"pointLabelFn",PointLabelWeightFn:"pointLabelWeightFn",PointLabelColor:"pointLabelColor",PointLabelFontSize:"pointLabelFontSize",ClusterLabelFontSize:"clusterLabelFontSize",ClusterLabelClassName:"clusterLabelClassName",ScaleClusterLabels:"scaleClusterLabels",UsePointColorStrategyForClusterLabels:"usePointColorStrategyForClusterLabels",StaticLabelWeight:"staticLabelWeight",DynamicLabelWeight:"dynamicLabelWeight",LabelMargin:"labelMargin",LabelPadding:"labelPadding",CustomLabels:"customLabels"}),KB.PointLabel,KB.PointLabelWeight],sF=.95,aF=.05,lF=[2,9],cF=[1,9],uF=["rgba(43, 85, 168, 0.85)","rgba(153, 82, 213, 0.85)","rgba(240, 105, 180, 0.85)","rgba(255, 149, 131, 0.85)","rgba(254, 224, 139, 0.85)"],hF=["#206176","#38657e","#506987","#686d90","#807098","#9874a1","#af78a9","#c77cb2","#df7fba","#f783c3","#FFB4D3","#f6c0d8"],dF="rgb(45, 49, 58)",pF="rgba(205, 207, 213, 0.9)",fF=pF,mF=16,_F={showLabels:!0,showTopLabels:!0,showDynamicLabels:!0,showHoveredPointLabel:!1,scaleClusterLabels:!0,usePointColorStrategyForClusterLabels:!1,showTopLabelsLimit:30,staticLabelWeight:.8,dynamicLabelWeight:.7,pointGreyoutOpacity:.3,labelMargin:5,pointSamplingDistance:170,labelPadding:[6.5,4.5,6.5,4.5],preservePointPositionsOnDataUpdate:!1,backgroundColor:dF,hoveredPointLabelClassName:"color: white; background: #333841;",pointLabelFontSize:13,clusterLabelFontSize:16,clusterLabelClassName:"background: none; font-weight: 300; opacity: 0.9;",pointSizeRange:lF,linkWidthRange:cF,linkStrengthRange:[.2,1],pointColorPalette:uF,linkColorPalette:hF,pointDefaultColor:fF,linkDefaultColor:pF,unknownColor:pF,hoveredLinkWidthIncrease:0,simulationRepulsion:.5,simulationFriction:.5,simulationLinkSpring:.4,simulationLinkDistance:20,resetSelectionOnEmptyCanvasClick:!0},gF=e=>e===KB.PointLabel?"":e===KB.PointLabelWeight||e===KB.PointX||e===KB.PointY||e===KB.PointCluster?0:e===KB.PointClusterStrength?1:(e===ZB.LinkStrength||e!==ZB.LinkArrow)&&0,yF=async(e,t)=>{const n=await e.query("SHOW ALL TABLES"),i=null==n?void 0:n.toArray();if(!(null==i?void 0:i.length))return!1;const[o,r]=t.includes(".")?t.split("."):["main",t];return void 0!==i.find(e=>e.name===r&&e.schema===o)},bF=async(e,t)=>{const n=await e.query(`PRAGMA table_info(${t})`);return n?n.toArray().map(({name:e,type:t})=>({name:e,type:t})):[]},vF=async(e,t)=>await yF(e,t)?(await e.query(`SUMMARIZE ${t}`)).toArray():[],xF=async(e,t)=>{const n=await bF(e,t);return n?n.map(e=>e.name):[]},wF=async(e,t,n,i)=>{const o=await xF(e,t);if(!o.length)return null==i||i.push(...n),!1;const r=new Set(o),s=n.filter(e=>!r.has(e));return null==i||i.push(...s),0===s.length},SF=(e,t,n=4)=>{if(e.size>=t.length/n)return new Float32Array(0);const i=new Float32Array(t.length-e.size*n);let o=0;for(let r=0;r<t.length;r+=n)e.has(r/n)||(i.set(t.subarray(r,r+n),o),o+=n);return i},EF=e=>{const t=new Map;for(const n of e)t.set(n,(t.get(n)||0)+1);return Array.from(t.entries()).sort((e,t)=>t[1]-e[1]).map(e=>e[0])},TF=(e,t,n)=>e.length?e.reduce((e,i,o)=>(n(i,t)&&e.push(o),e),[]):[],CF=(e,t)=>{const n=MD(e,aF),i=MD(e,sF);if(n===i){const[n,i]=_D(e);return t?t(n,i):[n,i]}return t?t(n,i):[n,i]},IF=(e,t,n)=>{if(!e.length)return n;const i=t?CF(e):_D(e);if(void 0===i[0]||void 0===i[1])return n;if(!n)return i;if(!t)return n;const[o,r]=n,[s,a]=i,l=Math.max(o,s),c=Math.min(r,a);return!Number.isFinite(l)||!Number.isFinite(c)||l>=c?n:[l,c]},AF=async(e,t,n)=>await e.query(`SELECT ${(null==n?void 0:n.map(e=>`"${e}"`).join(", "))??"*"} FROM ${t}`),kF=async(e,t,n,i)=>{var o;const r=i.map(e=>"string"==typeof e?`${hI(e)}`:e),s=`SELECT "${n.pointIndexBy}" FROM ${t} WHERE "${n.pointIdBy}" IN (${r})`,a=await e.query(s);return a?(null==(o=a.getChildAt(0))?void 0:o.toArray())??[]:void 0},LF=async(e,t,n,i)=>{var o;const r=i.join(", "),s=`SELECT "${n.pointIdBy}" FROM ${t} WHERE "${n.pointIndexBy}" IN (${r})`,a=await e.query(s);return a?(null==(o=a.getChildAt(0))?void 0:o.toArray())??[]:void 0},RF=(e,t=8192,n=t/2,i=t/8)=>Array.from({length:2*e},()=>{const e=n+i*Math.sqrt(-2*Math.log(Math.random()))*Math.cos(2*Math.PI*Math.random());return Math.max(1,Math.min(t-1,e))}),PF=async(e,t)=>{var n,i;const o=await e.query(t);if(!o)return;const r=(null==(n=o.getChildAt(0))?void 0:n.toArray())??[],s=(null==(i=o.getChildAt(1))?void 0:i.toArray())??[];return[...new Set([...r,...s])]},DF=async(e,t,n)=>await e.query(`SELECT ${(null==n?void 0:n.map(e=>`"${e}"`).join(", "))??"*"} FROM ${t}`),MF=[null,void 0,"null","","undefined","nan"],NF=e=>MF.includes("string"==typeof e?e.toLowerCase():e),OF=e=>{const t=MD(e,aF),n=MD(e,sF),[i,o]=_D(e),r=t===n?i:t,s=t===n?o:n;return r===s?[r,s+1e-6]:[r,s]},BF=(e,t,n)=>{const i=new Set(e);for(const r of i)NF(r)&&i.delete(r);const o=FD().domain(Array.from(i)).range(t);return e=>NF(e)?n:o(e)},FF=(e,t,n,i=!0)=>{const o=i?OF(e):_D(e);return wO(pR(dR.gamma(1.5),t)).domain(o).unknown(n).clamp(!0)},zF=(e,t,n,i=!0)=>{const o=i?OF(e):_D(e);return pM().domain(o).range(t).unknown(n)},UF=(e,t)=>{if(!e)return t;if("string"==typeof e)return e;const[n,i,o]=e.map(e=>Math.round(255*e));return`rgb(${n}, ${i}, ${o})`},$F=(e,t,n=!1)=>{let i;if(n){const t=MD(e,aF),n=MD(e,sF);i=t===n?_D(e):[t,n]}else i=_D(e);return i[0]===i[1]&&(i[1]=i[1]+1e-6),dM().range(t).domain(i).clamp(!0)};let VF=class{constructor(){s(this,"_colorStore"),this._colorStore=new Map}getColor(e){if(this._colorStore.has(e))return this._colorStore.get(e);{const t=bL(e),n=[t.r/255,t.g/255,t.b/255,t.opacity];return this._colorStore.set(e,n),n}}clearCache(){this._colorStore.clear()}};const HF=(e,t,n)=>{const i=new Float32Array(e.length);for(let o=0;o<e.length;o++){const r=e.get(o);i[o]=n?n(r,o):r??t}return i},GF=(e,t,n)=>{const i=new Float32Array(4*e.length),o=new VF;for(let r=0;r<e.length;r++){const s=e.get(r),a=n?n(s,r):s??t;let[l,c,u,h]=Array.isArray(a)?a:o.getColor(a);(isNaN(l)||isNaN(c)||isNaN(u)||isNaN(h))&&([l,c,u,h]=Array.isArray(t)?t:o.getColor(t));const d=4*r;i[d]=l,i[d+1]=c,i[d+2]=u,i[d+3]=h}return o.clearCache(),i};var WF;!function(e){e.Categorical="categorical",e.Continuous="continuous",e.Map="map",e.Degree="degree",e.PreciseDegree="preciseDegree",e.LinkDirection="linkDirection",e.Direct="direct",e.Single="single"}(WF||(WF={}));const jF=(e,t,n,i)=>{const o=UF(t.unknownColor,pF),r=t.pointColorPalette??uF;return{[WF.Degree]:()=>FF(n,r,o),[WF.PreciseDegree]:()=>FF(n,r,o,!1),[WF.LinkDirection]:()=>zF(n,r,o,!1),[WF.Map]:()=>e=>t.pointColorByMap?t.pointColorByMap[e]??o:o,[WF.Categorical]:()=>{let e;if(dI(i)&&(e=zF(n,r,o)),pI(i)||fI(i)){const t=EF(n);e=BF(t,r,o)}return e},[WF.Continuous]:()=>{let e;if(dI(i)&&(e=FF(n,r,o)),pI(i)||fI(i)){e=((e,t,n)=>{const i=Array.from(new Set(e)),o=function(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e(i/(t-1));return n}(pR(dR.gamma(2.2),t),i.length);return BF(i,o.reverse(),n)})(EF(n),r,o)}return e},[WF.Direct]:()=>t.pointColorByFn,[WF.Single]:()=>()=>t.pointDefaultColor}[e]()};var YF;!function(e){e.Sum="sum",e.Average="average",e.Count="count",e.Categorical="categorical",e.Direct="direct",e.Single="single"}(YF||(YF={}));const qF=(e,t,n,i)=>{const o=UF(t.unknownColor,pF),r=t.linkColorPalette??hF;return{[YF.Sum]:()=>FF(n,r,o),[YF.Average]:()=>FF(n,r,o),[YF.Count]:()=>FF(n,r,o),[YF.Categorical]:()=>{let e;if(dI(i)&&(e=zF(n,r,o)),pI(i)||fI(i)){const t=EF(n);e=BF(t,r,o)}return e},[YF.Direct]:()=>t.linkColorByFn,[YF.Single]:()=>()=>t.linkDefaultColor}[e]()};var XF;!function(e){e.Degree="degree",e.PreciseDegree="preciseDegree",e.Auto="auto",e.Direct="direct",e.Single="single"}(XF||(XF={}));const KF=(e,t,n)=>({[XF.Degree]:()=>$F(n,t.pointSizeRange??lF,!0),[XF.PreciseDegree]:()=>$F(n,t.pointSizeRange??lF),[XF.Auto]:()=>$F(n,t.pointSizeRange??lF,!0),[XF.Direct]:()=>t.pointSizeByFn,[XF.Single]:()=>()=>t.pointDefaultSize}[e]());var ZF;!function(e){e.Sum="sum",e.Average="average",e.Count="count",e.Direct="direct",e.Single="single"}(ZF||(ZF={}));const QF=(e,t,n)=>{const i=()=>$F(n,t.linkWidthRange??cF,!0);return{[ZF.Sum]:i,[ZF.Average]:i,[ZF.Count]:i,[ZF.Direct]:()=>t.linkWidthByFn??i(),[ZF.Single]:()=>()=>t.linkDefaultWidth}[e]()};class JF{constructor(e){s(this,"_"),s(this,"config",_F),s(this,"_rawConfig",{}),s(this,"_cosmosConfig",{}),s(this,"_configUpdatePromise",null),s(this,"_cosmosInitPromise",null),s(this,"_cosmosInitResolved",null),s(this,"_currentPointColorStrategy",WF.Direct),s(this,"_currentLinkColorStrategy",YF.Direct),s(this,"_currentPointSizeStrategy",XF.Direct),s(this,"_currentLinkWidthStrategy",ZF.Direct),s(this,"_currentPointColorFn"),s(this,"_currentPointSizeFn"),s(this,"_currentLinkColorFn"),s(this,"_currentLinkWidthFn"),s(this,"_clusterMapping",new Map),s(this,"_clusterIndexToNameMapping",new Map),s(this,"_preservedPointPositions",new Map),s(this,"resetCosmographConfig",()=>{this.config=_F}),s(this,"_checkPointEvents",()=>!(void 0===this.config.onClick&&!this.config.selectPointOnClick&&!this.config.focusPointOnClick)),this._=e,this._cosmosInitPromise=new Promise(e=>{this._cosmosInitResolved=e})}get activePointColorStrategy(){return this._currentPointColorStrategy}get activeLinkColorStrategy(){return this._currentLinkColorStrategy}get activePointSizeStrategy(){return this._currentPointSizeStrategy}get activeLinkWidthStrategy(){return this._currentLinkWidthStrategy}get activePointColorFn(){return this._currentPointColorFn}get activePointSizeFn(){return this._currentPointSizeFn}get activeLinkColorFn(){return this._currentLinkColorFn}get activeLinkWidthFn(){return this._currentLinkWidthFn}get clusterMapping(){return this._clusterMapping}get clusterIndexToNameMapping(){return this._clusterIndexToNameMapping}get cosmosConfig(){return this._cosmosConfig}async configUpdated(){await this._configUpdatePromise}async cosmosInitialized(){await this._cosmosInitPromise}setConfig(e){this._configUpdatePromise=(async()=>{var t,n,i;try{await this._.dbReady();const n=this.config;if(n.points&&!(null==e?void 0:e.points)&&!this._.public.stats.pointsCount)return void this._.public.reset();this.config=IO(_F,e??{}),this._rawConfig=e??{},this._controlBackgroundColor(n,this.config),this._.rectangularSelection.updateSelectionClassName(),window.cosmographDisableLogging=this.config.disableLogging??!1,this._cosmosConfig=this._createCosmosConfig(),null==(t=this._.cosmos)||t.setConfig(this._cosmosConfig),await this._processConfigUpdate(n),this._handleScaleChangeEvents(n,this.config)}finally{this._configUpdatePromise=null,null==(i=(n=this.config).onConfigUpdated)||i.call(n)}})()}async _processConfigUpdate(e){var t,n;const i=this._detectPointsChanged(e),o=this._detectLinksChanged(e),r=this._detectVisualLinkChanges(e),s=this._detectVisualPointChanges(e),a=this._detectClusterChanges(e),l=this._detectLabelChanges(e);if((i||o)&&await this._.dataManager.updateGraphData(i,o))return await this._rebuildGraph(!i&&o,o),void(this._cosmosInitResolved&&(this._cosmosInitResolved(),this._cosmosInitResolved=null));(r||s||a)&&this._.cosmos&&(await this._updateGraphProperties(e,s,this._.public.stats.linksCount>0&&r),this._.cosmos.render((null==(t=this._.cosmos)?void 0:t.isSimulationRunning)?void 0:0)),l&&(null==(n=this._.labels)||n.update()),!this.config.preservePointPositionsOnDataUpdate&&this._preservedPointPositions.size&&this._preservedPointPositions.clear()}async _rebuildGraph(e,t){var n,i,o;try{e?await this._updateGraphProperties(void 0,!1):(this._.dispatchEvent(new CustomEvent("reset")),await this._.initializeCosmos(),this._.initializeLabels(),await this._updateGraphProperties(void 0,!0,t)),this._.updateMessage(null);const r=!this._.public.isSimulationAvailable||!this._.pointsHaveLayout;null==(n=this._.cosmos)||n.render(r?void 0:0),this._.updateStats(),this._.dispatchEvent(new CustomEvent("graphRebuilt")),null==(o=(i=this.config).onGraphRebuilt)||o.call(i,this._.public.stats),this.config.points&&rI((this._.public.stats.pointsCount,this._.public.stats.linksCount))}catch(r){rI(0,0,"error"),this._.updateMessage(`🚨 ${r}`)}}async _updateGraphProperties(e,t=!0,n=!0){n&&await this.updateLinkProperties(e),t&&await this.updatePointProperties(e),this._updateClusterProperties(e)}async updatePointProperties(e,t=!1){var n,i,o;const{_:{dbCoordinator:r,config:s,public:{pointsTableName:a}}}=this,l=[s.pointXBy,s.pointYBy,s.pointColorBy,s.pointSizeBy,s.pointClusterBy,s.pointIndexBy,s.pointClusterStrengthBy].filter(Boolean),c=await xF(r,a),u=new Set(c),h=l.filter(e=>u.has(e)),d=await AF(r,a,h);let p=!1;(null==d?void 0:d.numRows)?(p=await this._handlePointPositions(e,d,t),p&&(null==(n=this._.cosmos)||n.graph.update()),this._handlePointColors(e,d),this._handlePointSizes(e,d),await this._handlePointClusterProps(e,d),p?null==(i=this._.labels)||i.update():null==(o=this._.labels)||o.render()):await this._.public.reset(!1)}async updateLinkProperties(e){const{dbCoordinator:t,cosmos:n,config:i,public:{linksTableName:o,stats:r}}=this._;if(!r.linksCount&&!(await yF(t,o)))return;const s=[i.linkColorBy,i.linkWidthBy,i.linkStrengthBy,i.linkArrowBy,i.linkSourceIndexBy,i.linkTargetIndexBy].filter(Boolean),a=await xF(t,o),l=new Set(a),c=s.filter(e=>l.has(e)),u=await DF(t,o,c);if(u){if(u.numRows!==(null==n?void 0:n.graph.linksNumber)){const e=((e,t)=>{if(!t.linkSourceIndexBy||!t.linkTargetIndexBy)return new Float32Array(0);const n=e.getChild(t.linkSourceIndexBy),i=e.getChild(t.linkTargetIndexBy),o=e.numRows,r=new Float32Array(2*o);for(let s=0,a=0;s<o;s++,a+=2)r[a]=(null==n?void 0:n.get(s))??0,r[a+1]=(null==i?void 0:i.get(s))??0;return r})(u,this.config);null==n||n.setLinks(e),this._.linkAggregationManager.buildCountCache(u),this._.linkAggregationManager.clearColorSumCache(),this._.linkAggregationManager.clearWidthSumCache()}this._handleLinkColors(e,u),this._handleLinkWidths(e,u),this._handleLinkStrengths(e,u),this._handleLinkArrows(e,u)}}_updateClusterProperties(e){const{config:t,_:{cosmos:n}}=this;if(!e||(null==e?void 0:e.clusterPositionsMap)!==t.clusterPositionsMap)if(t.clusterPositionsMap&&this._clusterMapping.size>0){const e=((e,t)=>{const n=[];return t.forEach((t,i)=>{if(e&&t in e){const o=e[t];if(o){const[e,t]=o;n[2*i]=e,n[2*i+1]=t}else n[2*i]=void 0,n[2*i+1]=void 0}else n[2*i]=void 0,n[2*i+1]=void 0}),n})(t.clusterPositionsMap,Array.from(this._clusterMapping.keys()));null==n||n.setClusterPositions(e)}else null==n||n.setClusterPositions([])}async _handlePointPositions(e,t,n=!1){const{config:i,_:{cosmos:o}}=this;if((null==o?void 0:o.graph.pointsNumber)&&e&&e.pointXBy===i.pointXBy&&e.pointYBy===i.pointYBy)return!1;let r=[];if(i.pointXBy||i.pointYBy){if(!(await this._.dataValidator.validatePointPositions()))return!1;r=((e,t)=>{if(!(null==t?void 0:t.pointXBy)||!(null==t?void 0:t.pointYBy))return[];const n=e.getChild(t.pointXBy),i=e.getChild(t.pointYBy),o=e.numRows,r=new Array(2*o);for(let s=0;s<o;s++)r[2*s]=null==n?void 0:n.get(s),r[2*s+1]=null==i?void 0:i.get(s);return r})(t,i)}else r=n?((e,t)=>{const n=null==e?void 0:e.getPointPositions(),i=e.getScaleX(),o=e.getScaleY();if(null==n?void 0:n.length){const r=t-n.length/2;let s=RF(r,e.config.spaceSize);return i&&o&&(s=s.map((e,t)=>t%2==0?i(e):o(e))),n.concat(s)}return RF(t,e.config.spaceSize)})(o,t.numRows):RF(t.numRows,i.spaceSize);return i.preservePointPositionsOnDataUpdate&&this._preservedPointPositions.size>0&&((e,t)=>{const n=e.length/2;for(let i=0;i<n;i++){const n=t.get(i);n&&(e[2*i]=n[0],e[2*i+1]=n[1])}t.clear()})(r,this._preservedPointPositions),null==o||o.setPointPositions(new Float32Array(r),!n&&void 0),!0}_handlePointColors(e,t){const{config:n,_:{cosmos:i}}=this,o=[KB.PointColor,KB.PointColorStrategy,KB.PointColorPalette,KB.PointColorFn,KB.PointColorMap,"pointDefaultColor"];if(e&&!this._hasConfigChanged(e,n,o))return;let r=new Float32Array;const s=n.pointColorBy?t.getChild(n.pointColorBy):void 0;if(this._currentPointColorStrategy=function(e={},t){const{pointColorStrategy:n,pointColorBy:i,pointColorByFn:o,pointColorByMap:r,linkSourceBy:s,linkTargetBy:a}=e;if(n&&Object.values(WF).includes(n))return n;if(o)return WF.Direct;if(i){if(r)return WF.Map;if(dI(t))return WF.Continuous;if(pI(t)||fI(t))return WF.Categorical}return!i&&s&&a?WF.Degree:WF.Single}(this._rawConfig,null==s?void 0:s.type),this._currentPointColorFn=void 0,this._currentPointColorStrategy===WF.Degree||this._currentPointColorStrategy===WF.PreciseDegree){const e=this._.public.pointDegrees;e&&(this._currentPointColorFn=jF(this._currentPointColorStrategy,n,e),r=GF(qE(e),n.unknownColor,this._currentPointColorFn))}else if(this._currentPointColorStrategy===WF.LinkDirection){const e=this._.public.pointDirections;e&&(this._currentPointColorFn=jF(this._currentPointColorStrategy,n,e),r=GF(qE(e),n.unknownColor,this._currentPointColorFn))}else s?(this._currentPointColorFn=jF(this._currentPointColorStrategy,n,s.toArray(),null==s?void 0:s.type),r=GF(s,n.unknownColor,this._currentPointColorFn)):n.pointColorBy&&rI(n.pointColorBy,0,"warn");null==i||i.setPointColors(r),this._.dispatchEvent(new CustomEvent("pointColorUpdated"))}_handlePointSizes(e,t){const{config:n,_:{cosmos:i}}=this,o=[KB.PointSize,KB.PointSizeStrategy,KB.PointSizeRange,KB.PointSizeFn,"pointDefaultSize"];if(e&&!this._hasConfigChanged(e,n,o))return;let r=new Float32Array;const s=n.pointSizeBy?t.getChild(n.pointSizeBy):void 0;if(this._currentPointSizeStrategy=function(e,t){const{pointSizeStrategy:n,pointSizeBy:i,pointDefaultSize:o,pointSizeByFn:r,linkSourceBy:s,linkTargetBy:a}=e;return n&&Object.values(XF).includes(n)?n:r?XF.Direct:i&&dI(t)?XF.Auto:!o&&!i&&s&&a?XF.Degree:XF.Single}(this._rawConfig,null==s?void 0:s.type),this._currentPointSizeFn=void 0,this._currentPointSizeStrategy===XF.Degree||this._currentPointSizeStrategy===XF.PreciseDegree){const e=null==i?void 0:i.graph.degree;e&&(this._currentPointSizeFn=KF(this._currentPointSizeStrategy,n,e),r=HF(qE(e),n.pointDefaultSize,this._currentPointSizeFn))}else s?(this._currentPointSizeFn=KF(this._currentPointSizeStrategy,n,s.toArray()),r=HF(s,n.pointDefaultSize,this._currentPointSizeFn)):n.pointSizeBy&&rI(n.pointSizeBy,0,"warn");null==i||i.setPointSizes(r),this._.dispatchEvent(new CustomEvent("pointSizeUpdated"))}async _handlePointClusterProps(e,t){const{config:n,_:{cosmos:i}}=this;if(!e||e.pointClusterStrengthBy!==n.pointClusterStrengthBy){const e=n.pointClusterStrengthBy?t.getChild(n.pointClusterStrengthBy):void 0;let o=new Float32Array;e&&(o=HF(e,gF(KB.PointClusterStrength))),null==i||i.setPointClusterStrength(o)}const o=[KB.PointCluster,KB.PointClusterFn];if(e&&!this._hasConfigChanged(e,n,o))return;const r=n.pointClusterBy?t.getChild(n.pointClusterBy):void 0;if(r){let e=Array.from(r.toArray());n.pointClusterByFn&&(e=e.map(n.pointClusterByFn));const t=new Map;for(const n of e){const e=String(n);t.set(e,(t.get(e)??0)+1)}this._clusterMapping.clear(),this._clusterIndexToNameMapping.clear();let o=0;for(const n of t.keys()){const e=t.get(n);this._clusterMapping.set(n,{index:o,count:e}),this._clusterIndexToNameMapping.set(o,{name:n,count:e}),o++}const s=e.map(e=>{var t;return void 0===e||null==(t=this._clusterMapping.get(String(e)))?void 0:t.index});null==i||i.setPointClusters(s)}else this._clusterMapping.clear(),this._clusterIndexToNameMapping.clear(),null==i||i.setPointClusters([]);this._.dispatchEvent(new CustomEvent("clustersUpdated"))}_handleLinkColors(e,t){const{config:n,_:{cosmos:i}}=this,o=[ZB.LinkColor,ZB.LinkColorStrategy,ZB.LinkColorPalette,ZB.LinkColorFn,"linkDefaultColor"];if(e&&e.linkColorBy!==n.linkColorBy&&this._.linkAggregationManager.clearColorSumCache(),e&&!this._hasConfigChanged(e,n,o))return;let r=new Float32Array;const s=n.linkColorBy?t.getChild(n.linkColorBy)??void 0:void 0;if(this._currentLinkColorStrategy=function(e={},t){const{linkColorStrategy:n,linkColorBy:i,linkColorByFn:o,linkSourceBy:r,linkTargetBy:s}=e;if(n&&Object.values(YF).includes(n))return n;if(o)return YF.Direct;if(i){if(dI(t))return YF.Sum;if(pI(t)||fI(t))return YF.Categorical}return!i&&r&&s?YF.Count:YF.Single}(this._rawConfig,null==s?void 0:s.type),this._currentLinkColorFn=void 0,this._currentLinkColorStrategy!==YF.Sum&&this._currentLinkColorStrategy!==YF.Average||!s||this._.linkAggregationManager.colorSumCache||this._.linkAggregationManager.buildColorSumCache(t,s),[YF.Count,YF.Sum,YF.Average].includes(this._currentLinkColorStrategy)){const e=this._.linkAggregationManager.aggregateFromCache(t,this._currentLinkColorStrategy,!0);e&&(this._currentLinkColorFn=qF(this._currentLinkColorStrategy,n,e),r=GF(qE(e),n.unknownColor,this._currentLinkColorFn))}else s?(this._currentLinkColorFn=qF(this._currentLinkColorStrategy,n,s.toArray(),null==s?void 0:s.type),r=GF(s,n.unknownColor,this._currentLinkColorFn)):n.linkColorBy&&rI(n.linkColorBy,0,"warn");null==i||i.setLinkColors(r),this._.dispatchEvent(new CustomEvent("linkColorUpdated"))}_handleLinkWidths(e,t){const{config:n,_:{cosmos:i}}=this,o=[ZB.LinkWidth,ZB.LinkWidthRange,ZB.LinkWidthStrategy,ZB.LinkWidthFn,"linkDefaultWidth"];if(e&&e.linkWidthBy!==n.linkWidthBy&&this._.linkAggregationManager.clearWidthSumCache(),e&&!this._hasConfigChanged(e,n,o))return;let r=new Float32Array;const s=n.linkWidthBy?t.getChild(n.linkWidthBy):void 0;if(this._currentLinkWidthStrategy=function(e,t){const{linkWidthStrategy:n,linkWidthBy:i,linkWidthByFn:o,linkSourceBy:r,linkTargetBy:s}=e;return n&&Object.values(ZF).includes(n)?n:o?ZF.Direct:i&&dI(t)?ZF.Sum:!i&&r&&s?ZF.Count:ZF.Single}(this._rawConfig,null==s?void 0:s.type),this._currentLinkWidthFn=void 0,this._currentLinkWidthStrategy!==ZF.Sum&&this._currentLinkWidthStrategy!==ZF.Average||!s||this._.linkAggregationManager.widthSumCache||this._.linkAggregationManager.buildWidthSumCache(t,s),[ZF.Count,ZF.Sum,ZF.Average].includes(this._currentLinkWidthStrategy)){const e=this._.linkAggregationManager.aggregateFromCache(t,this._currentLinkWidthStrategy,!1);e&&(this._currentLinkWidthFn=QF(this._currentLinkWidthStrategy,this.config,e),r=HF(qE(e),this.config.linkDefaultWidth,this._currentLinkWidthFn))}else s?(this._currentLinkWidthFn=QF(this._currentLinkWidthStrategy,this.config,s.toArray()),r=HF(s,n.linkDefaultWidth,this._currentLinkWidthFn)):n.linkWidthBy&&rI(n.linkWidthBy,0,"warn");null==i||i.setLinkWidths(r),this._.dispatchEvent(new CustomEvent("linkWidthUpdated"))}_handleLinkStrengths(e,t){const{config:n,_:{cosmos:i}}=this,o=[ZB.LinkStrength,ZB.LinkStrengthRange,ZB.LinkStrengthFn];if(e&&!this._hasConfigChanged(e,n,o))return;let r=new Float32Array;const s=n.linkStrengthBy?t.getChild(n.linkStrengthBy):void 0;if(s){const e=n.linkStrengthByFn??$F(s.toArray(),n.linkStrengthRange);r=HF(s,gF(ZB.LinkStrength),e)}else n.linkStrengthBy&&rI(n.linkStrengthBy,0,"warn");null==i||i.setLinkStrength(r)}_handleLinkArrows(e,t){const{config:n,_:{cosmos:i}}=this,o=[ZB.LinkArrow,ZB.LinkArrowFn,"linkDefaultArrows"];if(e&&!this._hasConfigChanged(e,n,o))return;let r=[];const s=n.linkArrowBy?t.getChild(n.linkArrowBy):void 0;s?r=((e,t,n)=>{const i=new Array(e.length);for(let o=0;o<e.length;o++){const r=e.get(o);i[o]=n?n(r,o):r??t}return i})(s,n.linkDefaultArrows,n.linkArrowByFn):n.linkArrowBy&&rI(n.linkArrowBy,0,"warn"),null==i||i.setLinkArrows(r)}_handleScaleChangeEvents(e,t){(null==e?void 0:e.pointSizeScale)===t.pointSizeScale&&(null==e?void 0:e.scalePointsOnZoom)===t.scalePointsOnZoom||this._.dispatchEvent(new CustomEvent("pointSizeScaleUpdated")),(null==e?void 0:e.linkWidthScale)===t.linkWidthScale&&(null==e?void 0:e.scaleLinksOnZoom)===t.scaleLinksOnZoom||this._.dispatchEvent(new CustomEvent("linkWidthScaleUpdated"))}_hasConfigChanged(e,t,n){return n.some(n=>!aI(e[n],t[n]))}_detectPointsChanged(e){return this._hasConfigChanged(e,this.config,tF)}_detectLinksChanged(e){return this._hasConfigChanged(e,this.config,nF)}_detectLabelChanges(e){return this._hasConfigChanged(e,this.config,rF)}_detectVisualLinkChanges(e){return this._hasConfigChanged(e,this.config,iF)}_detectVisualPointChanges(e){return this._hasConfigChanged(e,this.config,oF)}_detectClusterChanges(e){return this._hasConfigChanged(e,this.config,eF)}_controlBackgroundColor(e,t){var n,i;if((null==e?void 0:e.backgroundColor)===t.backgroundColor)return;const o=(e=>{var t,n;if(!e)return;if("string"==typeof e)return null==(t=mL(e))?void 0:t.formatHex();const[i,o,r,s]=e;return null==(n=mL(`rgba(${i}, ${o}, ${r}, ${s})`))?void 0:n.formatHex()})(t.backgroundColor),r=o&&(e=>{const t=(e=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt((t[1]||0).toString(),16),g:parseInt((t[2]||0).toString(),16),b:parseInt((t[3]||0).toString(),16)}:{r:0,g:0,b:0}})(e);return(.2126*t.r+.7152*t.g+.0722*t.b)/255})(o)>.65?"#000000":"#ffffff";null==(n=this._.containerElement)||n.style.setProperty("--cosmograph-text-color",r),null==(i=this._.cosmosElement)||i.style.setProperty("backgroundColor",o??dF)}_createCosmosConfig(){var e;const t={...this.config,hoveredPointCursor:this._checkPointEvents()?(null==(e=this.config)?void 0:e.hoveredPointCursor)??"pointer":"auto"};return delete t.enableSimulation,delete t.attribution,this._.eventManager.attachCosmosEvents(t),t}updatePreservedPointPositions(e){this._preservedPointPositions=e}clearCosmosBuffers(e){const{_:{cosmos:t}}=this;e||(null==t||t.setPointPositions(new Float32Array),null==t||t.setPointColors(new Float32Array),null==t||t.setPointSizes(new Float32Array),null==t||t.setPointClusters([]),null==t||t.setPointClusterStrength(new Float32Array),null==t||t.setClusterPositions([])),null==t||t.setLinks(new Float32Array),null==t||t.setLinkColors(new Float32Array),null==t||t.setLinkWidths(new Float32Array),null==t||t.setLinkStrength(new Float32Array),null==t||t.setLinkArrows([])}}let ez=class{constructor(e){s(this,"_"),s(this,"_linksSelection",Ig.crossfilter()),s(this,"_pointsSelection",Ig.crossfilter()),s(this,"_onLinksFiltered"),s(this,"_onPointsFiltered"),s(this,"_crossfilter",{links:new Set,points:new Set,intersection:new Set}),this._=e,this._onLinksFiltered=e=>this._handleCrossfiltering(e,"links"),this._onPointsFiltered=e=>this._handleCrossfiltering(e,"points")}get filtered(){return this._crossfilter}get pointsSelection(){return this._pointsSelection}get linksSelection(){return this._linksSelection}get onLinksFiltered(){return this._onLinksFiltered}get onPointsFiltered(){return this._onPointsFiltered}get isFilteringActive(){return this._linksSelection.clauses.length>0||this._pointsSelection.clauses.length>0}_handleCrossfiltering(e,t){var n,i;const{config:o,cosmos:r,labels:s}=this._;this._getSetForCrossfilter(e,t),this._getIntersection(),this.isFilteringActive?null==r||r.selectPointsByIndices(Array.from(this._crossfilter.intersection)):null==r||r.unselectPoints();const a=this._.public.getSelectedLinkIndices(),l=null==r?void 0:r.getSelectedIndices();"points"===t&&(null==(n=o.onPointsFiltered)||n.call(o,e,l,a)),"links"===t&&(null==(i=o.onLinksFiltered)||i.call(o,e,l,a)),null==s||s.update(),this._.dispatchEvent(new CustomEvent("dataFiltered"))}_getSetForCrossfilter(e,t){var n;const{config:i}=this._;let o;if("links"===t)o=((e,t)=>{if(!t.linkSourceIndexBy||!t.linkTargetIndexBy)return new Set;const n=e.getChild(t.linkSourceIndexBy),i=e.getChild(t.linkTargetIndexBy);if(!n||!i)return new Set;const o=new Set;for(let r=0;r<n.length;r++)o.add(n.get(r)),o.add(i.get(r));return o})(e,i);else{const t=null==(n=e.getChild(i.pointIndexBy))?void 0:n.toArray();o=new Set(t)}this._crossfilter[t]=o}_getIntersection(){const{links:e,points:t}=this._crossfilter,n=t.values();let i=new Set;if(this._linksSelection.clauses.length&&this._pointsSelection.clauses.length)for(const o of n)e.has(o)&&i.add(o);else i=this._linksSelection.clauses.length?e:t;this._crossfilter.intersection=i}},tz=class{constructor(e){s(this,"_"),s(this,"_dataUploadPromise",null),this._=e}get dataUploadPromise(){return this._dataUploadPromise}async dataReady(){var e;await this._.dbReady(),(null==(e=this._.dbCoordinator)?void 0:e.internalDB)&&this._dataUploadPromise&&await this._dataUploadPromise}async updateGraphData(e,t){let n=!1;return this._dataUploadPromise&&(rI(0,0,"info"),await this._dataUploadPromise),!!this._.dbCoordinator&&(this._dataUploadPromise=(async()=>{var i,o,r,s,a;(null==(i=this._.cosmos)?void 0:i.isSimulationRunning)&&(null==(o=this._.cosmos)||o.stop()),null==(r=this._.dbCoordinator)||r.clearCache();try{if(e){const{pointsOk:e}=await this._uploadAndValidateGraphData(t);n=e}else if(t){const{linksOk:t}=await this._uploadAndValidateLinksData();n=e?n&&t:t}}finally{this._dataUploadPromise=null,this._.dispatchEvent(new CustomEvent("dataUploaded")),null==(a=null==(s=this._.config)?void 0:s.onGraphDataUpdated)||a.call(s)}})(),await this._dataUploadPromise,n)}async _addPreparedData(e,t){var n;const{_:{dbCoordinator:i,public:{linksTableName:o,isSimulationRunning:r,activePointColorStrategy:s,activePointSizeStrategy:a}}}=this;if(i&&(null==i?void 0:i.internalDB)){if(e&&(await this._uploadPoints(e,!0),await this._.configManager.updatePointProperties(void 0,!0)),t){const e=await yF(i,o);await this._uploadLinks(t,e),await this._.configManager.updateLinkProperties(void 0),s!==WF.Degree&&s!==WF.LinkDirection&&a!==XF.Degree||await this._.configManager.updatePointProperties(void 0,!0)}null==(n=this._.cosmos)||n.render(r?this._.config.simulationImpulse:0),this._triggerGraphUpdated()}}async addPoints(e){const{_:{dbCoordinator:t,public:{stats:n}}}=this,{pointIndexBy:i,pointIdBy:o}=this._.config;if(t&&(null==t?void 0:t.internalDB)){const r=n.pointsCount,s=await xF(t,qI.Points),a=[];for(const t of e){if(void 0===t.id)continue;const e={};for(const n of s)if(n===i)e[n]=BigInt(r+a.length);else if(n===o)e[n]=t.id;else if(void 0!==t[n])e[n]=t[n];else{const t=Object.values(KB).find(e=>this._.config[e]===n);e[n]=t?gF(t):null}a.push(e)}this._preservePointPositionsIfEnabled(),a.length&&await this._addPreparedData(a,void 0)}}async addLinks(e){const{_:{dbCoordinator:t,config:n}}=this;if(!(null==t?void 0:t.internalDB))return;const{linkSourceBy:i,linkTargetBy:o,linkSourceIndexBy:r,linkTargetIndexBy:s}=n;if(!(i&&o&&r&&s))return;const a=e.filter(e=>null!=e.source&&null!=e.target),l=[...new Set(a.flatMap(e=>[e.source,e.target]).map(String))];if(!l.length)return;const c=await kF(t,qI.Points,n,l);if(!c)return;const u=new Map(l.map((e,t)=>[e,c[t]]));let h=await yF(t,qI.Links)?await xF(t,qI.Links):[];h.length||(h=[i,o,r,s,...n.linkColorBy?[n.linkColorBy]:[],...n.linkWidthBy?[n.linkWidthBy]:[],...n.linkArrowBy?[n.linkArrowBy]:[],...n.linkStrengthBy?[n.linkStrengthBy]:[],...Array.isArray(n.linkIncludeColumns)?n.linkIncludeColumns:[]]);const d=[];for(const p of a){const e=String(p.source),t=String(p.target),a=u.get(e),l=u.get(t);if(void 0===a||void 0===l)continue;const c={};for(const u of h)if(u===i)c[u]=p.source;else if(u===o)c[u]=p.target;else if(u===r)c[u]=BigInt(a);else if(u===s)c[u]=BigInt(l);else if(u in p&&void 0!==p[u])c[u]=p[u];else{const e=Object.values(ZB).find(e=>n[e]===u);c[u]=e?gF(e):null}d.push(c)}d.length&&await this._addPreparedData(void 0,d)}async removePointsByIndices(e,t=!0){var n;const{_:{dbCoordinator:i,public:{pointsTableName:o,linksTableName:r,stats:s,isSimulationRunning:a}}}=this;if(!i||s.pointsCount<=1)return;const l=[...new Set(e)];if(!(l.length>=s.pointsCount)&&(null==i?void 0:i.internalDB)){const e=`${l.join(", ")}`;await i.internalDB.query(`DELETE FROM ${o} WHERE "${this._.config.pointIndexBy}" IN (${e})`),this._removePointsInCosmos(l),t&&s.linksCount&&(await i.internalDB.query(`DELETE FROM ${r} WHERE "${this._.config.linkSourceIndexBy}" IN (${e})\n          OR "${this._.config.linkTargetIndexBy}" IN (${e})`),await this._.configManager.updateLinkProperties(void 0)),null==(n=this._.cosmos)||n.render(a?this._.config.simulationImpulse:0),this._triggerGraphUpdated()}}async removePointsByIds(e){const t=await kF(this._.dbCoordinator,this._.public.pointsTableName,this._.config,e);t&&await this.removePointsByIndices(t)}async removeLinksByPointIdPairs(e){await this._removeLinks(e,!1)}async removeLinksByPointIndicesPairs(e){await this._removeLinks(e,!0)}async _uploadData(e,t){let n={pointsError:!1,linksError:!1};if(!this._.dbCoordinator||!this._.dbCoordinator.internalDB)return n;try{n=await this._executeUpload(e,t)}catch(i){rI(0,0,"error")}return n}async _uploadPoints(e,t=!1){var n,i;const o=await(null==(i=null==(n=this._.dbCoordinator)?void 0:n.internalDB)?void 0:i.uploadData(e,qI.Points,t));return!!(null==o?void 0:o.error)}async _uploadLinks(e,t=!1){var n,i;const o=await(null==(i=null==(n=this._.dbCoordinator)?void 0:n.internalDB)?void 0:i.uploadData(e,qI.Links,t));return!!(null==o?void 0:o.error)}async _executeUpload(e,t){rI();const n={pointsError:!1,linksError:!1};return await this._.dbReady(),this._.updateMessage("🌀 Loading data..."),e&&(n.pointsError=await this._uploadPoints(e)),t&&(n.linksError=await this._uploadLinks(t)),this._.updateMessage(n.pointsError?"🚨 Points data is empty or invalid.":null),n}_preservePointPositionsIfEnabled(){var e;const{config:t,public:{stats:n}}=this._;if(t.pointIdBy&&n.pointsCount&&t.preservePointPositionsOnDataUpdate){const t=null==(e=this._.cosmos)?void 0:e.getPointPositions();if(t&&t.length){const e=((e,t)=>new Map(Array.from({length:t},(t,n)=>[n,[e[2*n],e[2*n+1]]])))(t,n.pointsCount);this._.configManager.updatePreservedPointPositions(e)}}}async _uploadAndValidateGraphData(e){const{_:{config:t}}=this;if(!t.points){await this._.public.reset(!1);const e="Points source data is not provided in `points`.";return rI(0,0,"error"),this._.updateMessage(`🚨 ${e}`),{pointsOk:!1,linksOk:!1}}this._preservePointPositionsIfEnabled();const{pointsError:n,linksError:i}=await this._uploadData(t.points,t.links);if(await this._.updateSummary(),n){const e="Failed to upload points data: The data is invalid or empty.";return rI(0,0,"error"),this._.updateMessage(`🚨 ${e}`),{pointsOk:!1,linksOk:!1}}try{const o=!n&&await this._.dataValidator.validatePoints();if(!o)return{pointsOk:o,linksOk:!1};const r=e&&!i&&await this._.dataValidator.validateLinks();return t.links&&!r&&rI(0,0,"warn"),{pointsOk:o,linksOk:r}}catch(o){return rI(0,0,"error"),{pointsOk:!1,linksOk:!1}}}async _uploadAndValidateLinksData(){let e=!1;if(0===this._.public.stats.pointsCount)return{linksOk:e};if(this._.configManager.clearCosmosBuffers(!0),!this._.config.links)return await this._.dropLocalTables(!0),{linksOk:e};const{linksError:t}=await this._uploadData(void 0,this._.config.links);return await this._.updateSummary(),e=!t&&await this._.dataValidator.validateLinks(),e||await this._.dropLocalTables(!0),{linksOk:e}}_removePointsInCosmos(e){var t,n,i,o,r,s,a,l,c,u,h,d,p,f,m,_,g,y,b,v;if(!e.length)return;const x=new Set(e);if(null==(n=null==(t=this._.cosmos)?void 0:t.graph.pointPositions)?void 0:n.length){const e=SF(x,null==(i=this._.cosmos)?void 0:i.graph.pointPositions,2);null==(o=this._.cosmos)||o.setPointPositions(e,!1)}if(null==(s=null==(r=this._.cosmos)?void 0:r.graph.pointColors)?void 0:s.length){const e=SF(x,null==(a=this._.cosmos)?void 0:a.graph.pointColors,4);null==(l=this._.cosmos)||l.setPointColors(e)}if(null==(u=null==(c=this._.cosmos)?void 0:c.graph.pointSizes)?void 0:u.length){const e=SF(x,null==(h=this._.cosmos)?void 0:h.graph.pointSizes,1);null==(d=this._.cosmos)||d.setPointSizes(e)}if(null==(f=null==(p=this._.cosmos)?void 0:p.graph.pointClusters)?void 0:f.length){const e=null==(m=this._.cosmos)?void 0:m.graph.pointClusters.filter((e,t)=>!x.has(t));null==(_=this._.cosmos)||_.setPointClusters(e)}if(null==(y=null==(g=this._.cosmos)?void 0:g.graph.clusterStrength)?void 0:y.length){const e=SF(x,null==(b=this._.cosmos)?void 0:b.graph.clusterStrength,1);null==(v=this._.cosmos)||v.setPointClusterStrength(e)}}async _removeLinks(e,t){var n;const{_:{dbCoordinator:i,public:{linksTableName:o,stats:r,isSimulationRunning:s,activePointColorStrategy:a,activePointSizeStrategy:l}}}=this;if(!(null==i?void 0:i.internalDB)||!r.linksCount)return;const c=t?this._.config.linkSourceIndexBy:this._.config.linkSourceBy,u=t?this._.config.linkTargetIndexBy:this._.config.linkTargetBy,h=e=>t?e.toString():`'${e}'`,d=`\n      DELETE FROM ${o}\n      WHERE ${e.map(([e,t])=>`((${c} = ${h(e)} AND ${u} = ${h(t)}) OR\n        (${c} = ${h(t)} AND ${u} = ${h(e)}))`).join(" OR ")}\n    `;await i.internalDB.query(d),await this._.configManager.updateLinkProperties(void 0),a!==WF.Degree&&a!==WF.LinkDirection&&l!==XF.Degree||await this._.configManager.updatePointProperties(void 0,!0),null==(n=this._.cosmos)||n.render(s?this._.config.simulationImpulse:0),this._triggerGraphUpdated()}_triggerGraphUpdated(){var e,t;this._.dbCoordinator.clearCache(),this._.updateStats(),null==(t=(e=this._.config).onGraphRebuilt)||t.call(e,this._.public.stats),this._.dispatchEvent(new CustomEvent("dataUploaded")),this._.dispatchEvent(new CustomEvent("graphRebuilt"))}};const nz=()=>globalThis.__lastDuckdbError;let iz=class{constructor(e){s(this,"_"),this._=e}async validatePoints(){const{config:e,dbCoordinator:t,public:{pointsTableName:n}}=this._,i=tF.slice(1),o=e=>{throw rI(0,0,"error"),this._.updateMessage(`🚨 ${e}`),new Error(e)};if(!(await yF(t,n))){const e=nz();return o(e?`Failed to get points data: ${e}`:`Failed to get points data. Table "${n}" does not exist`)}const r=this._getMissingProperties(e,i);if(r.length)return o(`Failed to get points data.\n\nMissing required properties: ${this._formatMissingProps(r)}.`);const{exists:s,missingColumns:a}=await this._validateColumns(e,n,i);if(!s)return o(`Failed to get points data.\n\nMissing provided columns for required properties: ${this._formatMissingColumns(a,i)}.`);const l=(await bF(t,n)).find(t=>t.name===e.pointIndexBy);return"VARCHAR"!==(null==l?void 0:l.type)||o(`The column specified for \`pointIndexBy\` (${e.pointIndexBy}) cannot be of type VARCHAR. Please use an integer-based column.`)}async validateLinks(){const{config:e,dbCoordinator:t,public:{linksTableName:n}}=this._,i=nF.slice(1),o=e=>{throw rI(0,0,"error"),this._.updateMessage(`🚨 ${e}`),new Error(e)};if(!e.links){const e="Found links-related properties but links data is not provided. Rendering points only.";return rI(0,0,"warn"),this._.updateMessage(`⚠️ ${e}`),!1}if(!(await yF(t,n))){const e=nz();if(e)return o(`Failed to get links data: ${e}`);const t=`Failed to get links data. Table "${n}" does not exist`;return rI(0,0,"error"),this._.updateMessage(`🚨 ${t}`),!1}const r=this._getMissingProperties(e,i);if(r.length)return o(`Failed to get links data. \n\nMissing required properties: ${this._formatMissingProps(r)}.`);const{exists:s,missingColumns:a}=await this._validateColumns(e,n,i);return!!s||o(`Failed to get links data. \n\nMissing provided columns for required properties: ${this._formatMissingColumns(a,i)}.`)}async validatePointPositions(){const{config:e,config:{pointXBy:t,pointYBy:n},public:{pointsTableName:i}}=this._;if(Boolean(t)!==Boolean(n)){const e=`Couldn't render points: Only one of \`${KB.PointX}\` or \`${KB.PointY}\` provided.`;throw rI(0,0,"error"),this._.updateMessage(`🚨 ${e}`),new Error(e)}if(t&&n){const{exists:t,missingColumns:n}=await this._validateColumns(e,i,[KB.PointX,KB.PointY]);if(!t){const e=`Couldn't render points: Failed to get provided point positions, missing columns for positions: ${this._formatMissingProps(n)}.`;throw rI(0,0,"error"),this._.updateMessage(`🚨 ${e}`),new Error(e)}}return!0}async _validateColumns(e,t,n){const i=n.map(t=>e[t]),o=[];return{exists:await wF(this._.dbCoordinator,t,i,o),missingColumns:o}}_getMissingProperties(e,t){return t.filter(t=>void 0===e[t])}_formatMissingProps(e){return e.map(e=>`"${e}"`).join(", ")}_formatMissingColumns(e,t){return e.map(n=>`"${n}" (${t[e.indexOf(n)]})`).join(", ")}},oz=class{constructor(e){s(this,"_"),s(this,"_hoveredPointIndex"),this._=e}attachCosmosEvents(e={}){e.onSimulationStart=this.onSimulationStart.bind(this),e.onSimulationTick=this.onSimulationTick.bind(this),e.onSimulationEnd=this.onSimulationEnd.bind(this),e.onSimulationPause=this.onSimulationPause.bind(this),e.onSimulationUnpause=this.onSimulationUnpause.bind(this),e.onClick=this.onClick.bind(this),e.onPointMouseOver=this.onPointMouseOver.bind(this),e.onPointMouseOut=this.onPointMouseOut.bind(this),e.onMouseMove=this.onMouseMove.bind(this),e.onZoomStart=this.onZoomStart.bind(this),e.onZoom=this.onZoom.bind(this),e.onZoomEnd=this.onZoomEnd.bind(this),e.onDrag=this.onDrag.bind(this),e.onDragEnd=this.onDragEnd.bind(this),e.onLinkClick=this.onLinkClick.bind(this),e.onLinkMouseOver=this.onLinkMouseOver.bind(this),e.onLinkMouseOut=this.onLinkMouseOut.bind(this)}getLabelEvents(){return{onLabelClick:this.onLabelClick.bind(this),onHoveredLabelClick:this.onHoveredLabelClick.bind(this)}}onClick(...e){var t;const{config:n}=this._;n.selectPointOnClick?this._handlePointClick(e[0],e[2]):e[0]||this._.public.selectPoint(void 0),null==(t=n.onClick)||t.call(n,...e)}async onLabelClick(e,t){var n,i,o;const{public:{pointsTableName:r},config:s,dbCoordinator:a,configManager:l}=this._;if("string"==typeof t.id&&t.id.startsWith("cluster-")){const o=t.id.slice(8),r=Number(o);if(!Number.isNaN(r)){const o=(null==(n=l.clusterIndexToNameMapping.get(r))?void 0:n.name)??t.id;s.selectClusterOnLabelClick&&await this._handleClusterClick(o,e),null==(i=s.onClusterLabelClick)||i.call(s,r,o,e)}return}if(!a)return;const c=await kF(a,r,s,[t.id]);c&&void 0!==c[0]&&(s.selectPointOnLabelClick&&this._handlePointClick(c[0],e,s.selectPointOnLabelClick,!0),null==(o=s.onLabelClick)||o.call(s,c[0],t.id,e))}async onHoveredLabelClick(e){var t;const{public:{pointsTableName:n},config:i,dbCoordinator:o}=this._;if(void 0===this._hoveredPointIndex||!o)return;const r=await LF(o,n,i,[this._hoveredPointIndex]);r&&r[0]&&(i.selectPointOnLabelClick&&this._handlePointClick(this._hoveredPointIndex,e,i.selectPointOnLabelClick,!0),null==(t=i.onLabelClick)||t.call(i,this._hoveredPointIndex,r[0],e))}onRectSelect(e,t=!1,n=!0){var i,o;n?this._.public.unselectPointsInRect(e):this._.public.selectPointsInRect(e,t),null==(o=(i=this._.config).onRectSelected)||o.call(i,e),this._.dispatchEvent(new CustomEvent("rectSelected"))}onPolygonSelect(e,t=!1,n=!0){var i,o;n?this._.public.unselectPointsInPolygon(e):this._.public.selectPointsInPolygon(e,t),null==(o=(i=this._.config).onPolygonSelected)||o.call(i,e),this._.dispatchEvent(new CustomEvent("polygonSelected"))}onPointMouseOver(...e){var t,n;const[i]=e;null==(n=(t=this._.config).onPointMouseOver)||n.call(t,...e),this._hoveredPointIndex=i,this._renderCurrentHoveredLabel()}onPointMouseOut(...e){var t,n;null==(n=(t=this._.config).onPointMouseOut)||n.call(t,...e),this._hoveredPointIndex=void 0,this._renderCurrentHoveredLabel()}onLinkMouseOver(...e){var t,n;null==(n=(t=this._.config).onLinkMouseOver)||n.call(t,...e)}onLinkMouseOut(...e){var t,n;null==(n=(t=this._.config).onLinkMouseOut)||n.call(t,...e)}onLinkClick(...e){var t,n;null==(n=(t=this._.config).onLinkClick)||n.call(t,...e)}onMouseMove(...e){var t,n;null==(n=(t=this._.config).onMouseMove)||n.call(t,...e)}onZoomStart(...e){var t,n,i;null==(n=(t=this._.config).onZoomStart)||n.call(t,...e),null==(i=this._.labels)||i.render()}onDrag(...e){var t,n,i;null==(n=(t=this._.config).onDrag)||n.call(t,...e),null==(i=this._.labels)||i.updatePositions(),this._renderCurrentHoveredLabel(),this._.dispatchEvent(new CustomEvent("onDrag"))}onDragEnd(...e){var t,n,i;null==(n=(t=this._.config).onDragEnd)||n.call(t,...e),null==(i=this._.labels)||i.update(),this._renderCurrentHoveredLabel()}async onZoom(...e){var t,n,i,o;null==(n=(t=this._.config).onZoom)||n.call(t,...e),null==(i=this._.labels)||i.setZooming(!0,!!e[0].sourceEvent),await(null==(o=this._.labels)?void 0:o.render()),this._renderCurrentHoveredLabel(),this._.dispatchEvent(new CustomEvent("onZoom")),this._.dispatchEvent(new CustomEvent("pointSizeScaleUpdated")),this._.dispatchEvent(new CustomEvent("linkWidthScaleUpdated"))}onZoomEnd(...e){var t,n,i;null==(n=(t=this._.config).onZoomEnd)||n.call(t,...e),null==(i=this._.labels)||i.setZooming(!1,!!e[0].sourceEvent),this._.dispatchEvent(new CustomEvent("zoomEnded"))}onSimulationStart(...e){var t,n;null==(n=(t=this._.config).onSimulationStart)||n.call(t,...e)}onSimulationTick(...e){var t,n,i;null==(n=(t=this._.config).onSimulationTick)||n.call(t,...e),null==(i=this._.labels)||i.updatePositions(),this._.dispatchEvent(new CustomEvent("onSimulationTick"))}onSimulationEnd(...e){var t,n;null==(n=(t=this._.config).onSimulationEnd)||n.call(t,...e),this._.dispatchEvent(new CustomEvent("onSimulationEnd"))}onSimulationPause(...e){var t,n,i;null==(n=(t=this._.config).onSimulationPause)||n.call(t,...e),null==(i=this._.labels)||i.render()}onSimulationUnpause(...e){var t,n,i,o;null==(n=(t=this._.config).onSimulationUnpause)||n.call(t,...e),null==(o=(i=this._.config).onSimulationRestart)||o.call(i,...e)}_handlePointClick(e,t,n,i=!1){const{config:o}=this._,{shiftKey:r,altKey:s}=t;if(s)this._.public.unselectPoint(e);else{const t=!0===n||"single"!==n&&void 0;this._.public.selectPoint(e,r,t)}(i?o.focusPointOnLabelClick??o.selectPointOnLabelClick:o.focusPointOnClick??o.selectPointOnClick)&&!s&&this._.public.setFocusedPoint(e)}async _handleClusterClick(e,t){const{config:n}=this._,{pointClusterBy:i}=n;if(!i)return;const o=await this._.public.getPointIndicesByExactValues(i,[e]);if(!o||!o.length)return;const{shiftKey:r,altKey:s}=t;s?this._.public.unselectPointsByIndices(o):this._.public.selectPoints(o,r)}_renderCurrentHoveredLabel(){var e,t,n;if(void 0===this._hoveredPointIndex)return void(null==(e=this._.labels)||e.renderHoveredLabel());const i=this._.public.getPointPositionByIndex(this._hoveredPointIndex);i?null==(t=this._.labels)||t.renderHoveredLabel(this._hoveredPointIndex,i):null==(n=this._.labels)||n.renderHoveredLabel()}};const rz=(e,t)=>0x100000000n*BigInt(e)+BigInt(t),sz=e=>{const t=Number(e%0x100000000n);return{sourceIdx:Number(e/0x100000000n),targetIdx:t}};let az=class{constructor(e){s(this,"_"),s(this,"_countCache",null),s(this,"_colorSumCache",null),s(this,"_widthSumCache",null),s(this,"_colorSumCacheColumn",null),s(this,"_widthSumCacheColumn",null),this._=e}get countCache(){return this._countCache}get colorSumCache(){return this._colorSumCache}get widthSumCache(){return this._widthSumCache}buildCountCache(e){const t=this._getIndexColumns(e);if(!t)return void(this._countCache=null);const{sourceIdxColumn:n,targetIdxColumn:i,numRows:o}=t,r=new Map;for(let s=0;s<o;s++){const e=n.get(s),t=i.get(s),o=rz(e,t);r.set(o,(r.get(o)??0)+1)}this._countCache=r}buildColorSumCache(e,t){const{config:n}=this._;this._buildSumCacheForType(e,t,n.linkColorBy,!0)}buildWidthSumCache(e,t){const{config:n}=this._;this._buildSumCacheForType(e,t,n.linkWidthBy,!1)}_buildSumCacheForType(e,t,n,i){const o=n??null;if(!o)return void(i?(this._colorSumCache=null,this._colorSumCacheColumn=null):(this._widthSumCache=null,this._widthSumCacheColumn=null));const r=i?this._widthSumCache:this._colorSumCache;if(o===(i?this._widthSumCacheColumn:this._colorSumCacheColumn)&&r)return void(i?(this._colorSumCache=r,this._colorSumCacheColumn=o):(this._widthSumCache=r,this._widthSumCacheColumn=o));const s=i?this._colorSumCache:this._widthSumCache;if(o===(i?this._colorSumCacheColumn:this._widthSumCacheColumn)&&s)return;const a=this._buildSumCache(e,t);i?(this._colorSumCache=a,this._colorSumCacheColumn=a?o:null):(this._widthSumCache=a,this._widthSumCacheColumn=a?o:null)}_buildSumCache(e,t){if(!t)return null;const n=this._getIndexColumns(e);if(!n)return null;const{sourceIdxColumn:i,targetIdxColumn:o,numRows:r}=n,s=new Map;for(let a=0;a<r;a++){const e=i.get(a),n=o.get(a),r=rz(e,n),l=t.get(a);s.set(r,(s.get(r)??0)+l)}return s}_getIndexColumns(e){const{config:t}=this._;if(!t.linkSourceIndexBy||!t.linkTargetIndexBy)return null;const n=e.getChild(t.linkSourceIndexBy),i=e.getChild(t.linkTargetIndexBy);return n&&i?{sourceIdxColumn:n,targetIdxColumn:i,numRows:e.numRows}:null}aggregateFromCache(e,t,n=!0){const{config:i}=this._;if(!i.linkSourceIndexBy||!i.linkTargetIndexBy)return;const o=e.getChild(i.linkSourceIndexBy),r=e.getChild(i.linkTargetIndexBy);if(!o||!r)return;if(!this._countCache)return;const s=n?this._colorSumCache:this._widthSumCache,a=e.numRows,l=new Array(a);for(let c=0;c<a;c++){const e=o.get(c),n=r.get(c),i=rz(e,n),a=this._countCache.get(i)??0;if("count"===t)l[c]=a;else if("sum"===t)l[c]=(null==s?void 0:s.get(i))??0;else{const e=(null==s?void 0:s.get(i))??0;l[c]=a>0?e/a:0}}return l}getKeysByValueCondition(e,t){if(!e)return[];const n=[];for(const[i,o]of e)t(o)&&n.push(i);return n}getIndicesSetFromKeys(e){if(!e)return[];const t=new Set;for(const n of e){const{sourceIdx:e,targetIdx:i}=sz(n);t.add(e),t.add(i)}return Array.from(t)}getIndicesByValueCondition(e,t){const n=this.getKeysByValueCondition(e,t);return this.getIndicesSetFromKeys(n)}getIndicesByAverageCondition(e,t,n){if(!e||!t)return[];const i=[];for(const[o,r]of e){const e=t.get(o)??0;n(r>0?e/r:0)&&i.push(o)}return this.getIndicesSetFromKeys(i)}clear(){this._countCache=null,this._colorSumCache=null,this._widthSumCache=null,this._colorSumCacheColumn=null,this._widthSumCacheColumn=null}clearColorSumCache(){this._colorSumCache=null,this._colorSumCacheColumn=null}clearWidthSumCache(){this._widthSumCache=null,this._widthSumCacheColumn=null}};const lz="css-label--labels-container",cz="css-label--labels-container-hidden",uz="css-label--label",hz="css-label--hidden",dz=`\n  :root {\n    --css-label-background-color: #1e2428;\n    --css-label-brightness: brightness(150%);\n  }\n\n  .${lz} {\n    transition: opacity 100ms;\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    top: 0%;\n    pointer-events: none;\n    opacity: 1;\n  }\n\n  .${cz} {\n    opacity: 0;\n\n    div {\n      pointer-events: none;\n    }\n  }\n`,pz=`\n  .${uz} {\n    position: absolute;\n    top: 0;\n    left: 0;\n\n    cursor: pointer;\n    \n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n\n    filter: var(--css-label-brightness);\n    pointer-events: none;\n    background-color: var(--css-label-background-color);\n    font-weight: 700;\n    border-radius: 6px;\n    \n    transition: opacity 600ms;\n    opacity: 1;\n  }\n\n  /* We use "important" here because the users may pass their own label class, overriding the opacity */\n  .${hz} {\n    opacity: 0 !important;\n  }\n`,fz=e=>{const t=document.createElement("style");t.innerHTML=e;const n=document.head.getElementsByTagName("style")[0];return n?document.head.insertBefore(t,n):document.head.appendChild(t),t};let mz,_z;class gz{constructor(e,t,n){this.element=document.createElement("div"),this.fontWidthHeightRatio=.6,this._x=0,this._y=0,this._estimatedWidth=0,this._estimatedHeight=0,this._visible=!1,this._prevVisible=!1,this._weight=0,this._needsMeasureUpdate=!0,this._customFontSize=14,this._customColor=void 0,this._customOpacity=void 0,this._shouldBeShown=!1,this._text="",this._customPadding={left:9,top:6,right:9,bottom:6},n||mz||(mz=fz(pz)),this._container=e,this._updateClasses(),t&&this.setText(t),this.resetFontSize(),this.resetPadding()}setText(e){this._text!==e&&(this._text=e,this.element.innerHTML=e,this._needsMeasureUpdate=!0)}setPosition(e,t){this._x=e,this._y=t}setStyle(e){if(this._customStyle!==e&&(this._customStyle=e,this.element.style.cssText=this._customStyle,this._customColor&&(this.element.style.color=this._customColor),this._customOpacity&&(this.element.style.opacity=String(this._customOpacity)),this._customPointerEvents&&(this.element.style.pointerEvents=this._customPointerEvents),this._customFontSize&&(this.element.style.fontSize=`${this._customFontSize}px`),this._customPadding)){const{top:e,right:t,bottom:n,left:i}=this._customPadding;this.element.style.padding=`${e}px ${t}px ${n}px ${i}px`}}setClassName(e){this._customClassName!==e&&(this._customClassName=e,this._updateClasses())}setFontSize(e=14){this._customFontSize!==e&&(this.element.style.fontSize=`${e}px`,this._customFontSize=e,this._needsMeasureUpdate=!0)}resetFontSize(){14!==this._customFontSize&&(this.element.style.fontSize="14px",this._customFontSize=14,this._needsMeasureUpdate=!0)}setColor(e){this._customColor!==e&&(this.element.style.color=e,this._customColor=e)}resetColor(){this.element.style.removeProperty("color"),this._customColor=void 0}setOpacity(e){this._customOpacity!==e&&(this.element.style.opacity=String(e),this._customOpacity=e)}resetOpacity(){this.element.style.removeProperty("opacity"),this._customOpacity=void 0}setPointerEvents(e){this._customPointerEvents!==e&&(this.element.style.pointerEvents=`${e}`,this._customPointerEvents=e)}resetPointerEvents(){this.element.style.removeProperty("pointer-events"),this._customPointerEvents=void 0}setPadding(e={left:9,top:6,right:9,bottom:6}){this._customPadding.left===e.left&&this._customPadding.top===e.top&&this._customPadding.right===e.right&&this._customPadding.bottom===e.bottom||(this._customPadding=e,this.element.style.padding=`${e.top}px ${e.right}px ${e.bottom}px ${e.left}px`,this._needsMeasureUpdate=!0)}resetPadding(){if(9===this._customPadding.left&&6===this._customPadding.top&&9===this._customPadding.right&&6===this._customPadding.bottom)return;const e={left:9,top:6,right:9,bottom:6};this.element.style.padding=`${e.top}px ${e.right}px ${e.bottom}px ${e.left}px`,this._customPadding=e,this._needsMeasureUpdate=!0}setForceShow(e){this._shouldBeShown=e}getForceShow(){return this._shouldBeShown}draw(){const e=this.getVisibility();e!==this._prevVisible&&(!1===this._prevVisible?this._container.appendChild(this.element):this._container.removeChild(this.element),this._updateClasses(),this._prevVisible=e),e&&(this.element.style.transform=`\n        translate(-50%, -100%)\n        translate3d(${this._x}px, ${this._y}px, 0)\n      `)}overlaps(e){return this._measureText(),e._measureText(),function(e,t){const[n,i,o,r]=[e.x,e.y+e.height,e.x+e.width,e.y],[s,a,l,c]=[t.x,t.y+t.height,t.x+t.width,t.y];return!(i<c||a<r||o<s||l<n)}({height:this._estimatedHeight,width:this._estimatedWidth,x:this._x,y:this._y},{height:e._estimatedHeight,width:e._estimatedWidth,x:e._x,y:e._y})}setVisibility(e=!0){this._visible=e}getVisibility(){return this._visible}isOnScreen(){return this._x>0&&this._y>0&&this._x<this._container.offsetWidth&&this._y<this._container.offsetHeight}setWeight(e){this._weight=e}getWeight(){return this._weight}raise(){this._container.appendChild(this.element)}destroy(){this.element.remove()}_updateClasses(){this.getVisibility()?window.requestAnimationFrame(()=>{this.element.className=`${uz} ${this._customClassName||""}`}):this.element.className=`${uz} ${this._customClassName||""} ${hz}`}_measureText(){if(this._needsMeasureUpdate){const{left:e,top:t,right:n,bottom:i}=this._customPadding;this._estimatedWidth=this._customFontSize*this.fontWidthHeightRatio*this.element.innerHTML.length+e+n,this._estimatedHeight=this._customFontSize+t+i,this._needsMeasureUpdate=!1}}}class yz{constructor(e,t){this._cssLabels=new Map,this._elementToData=new Map,(null==t?void 0:t.dontInjectStyles)||_z||(_z=fz(dz)),this._container=e,e.addEventListener("click",this._onClick.bind(this)),this._container.className=lz,(null==t?void 0:t.onLabelClick)&&(this._onClickCallback=t.onLabelClick),(null==t?void 0:t.pointerEvents)&&(this._pointerEvents=t.pointerEvents),(null==t?void 0:t.dontInjectStyles)&&(this._dontInjectStyles=t.dontInjectStyles),(null==t?void 0:t.padding)&&(this._padding=t.padding),(null==t?void 0:t.fontSize)&&(this._fontSize=t.fontSize),(null==t?void 0:t.dispatchWheelEventElement)&&(this._dispatchWheelEventElement=t.dispatchWheelEventElement,this._container.addEventListener("wheel",this._onWheel.bind(this)))}setLabels(e){const t=new Map(this._cssLabels);e.forEach(e=>{const{x:n,y:i,fontSize:o,color:r,text:s,weight:a,opacity:l,shouldBeShown:c,style:u,className:h,padding:d}=e;if(this._cssLabels.get(e.id))t.delete(e.id);else{const t=new gz(this._container,e.text,this._dontInjectStyles);this._cssLabels.set(e.id,t),this._elementToData.set(t.element,e)}const p=this._cssLabels.get(e.id);p&&(p.setText(s),p.setPosition(n,i),void 0!==u&&p.setStyle(u),void 0!==a&&p.setWeight(a),void 0!==r&&p.setColor(r),void 0!==o?p.setFontSize(o):void 0!==this._fontSize?p.setFontSize(this._fontSize):p.resetFontSize(),void 0!==d?p.setPadding(d):void 0!==this._padding?p.setPadding(this._padding):p.resetPadding(),void 0!==this._pointerEvents&&p.setPointerEvents(this._pointerEvents),void 0!==l&&p.setOpacity(l),void 0!==c&&p.setForceShow(c),void 0!==h&&p.setClassName(h))});for(const[n]of t){const e=this._cssLabels.get(n);e&&(this._elementToData.delete(e.element),e.destroy()),this._cssLabels.delete(n)}}draw(e=!0){e&&this._intersectLabels(),this._cssLabels.forEach(e=>e.draw())}show(){this._container.className=lz}hide(){this._container.className=`${lz} ${cz}`}destroy(){this._container.removeEventListener("click",this._onClick.bind(this)),this._container.removeEventListener("wheel",this._onWheel.bind(this)),this._cssLabels.forEach(e=>e.destroy())}_onClick(e){var t;const n=this._elementToData.get(e.target);n&&(null===(t=this._onClickCallback)||void 0===t||t.call(this,e,n))}_onWheel(e){var t;e.preventDefault();const n=new WheelEvent("wheel",e);null===(t=this._dispatchWheelEventElement)||void 0===t||t.dispatchEvent(n)}_intersectLabels(){const e=Array.from(this._cssLabels.values());e.forEach(e=>e.setVisibility(e.isOnScreen()));for(let t=0;t<e.length;t+=1){const n=e[t];if(n.getVisibility())for(let i=t+1;i<e.length;i+=1){const t=e[i];t.getVisibility()&&(n.overlaps(t)&&(t.getWeight()>n.getWeight()?n.setVisibility(!t.getForceShow()&&n.getForceShow()):t.setVisibility(!n.getForceShow()&&t.getForceShow())))}}}}const bz=async(e,t,n,i,o)=>{if(!n.pointIdBy||!n.pointIndexBy||!n.pointLabelBy)return{indices:null,ids:null,labels:null,weights:null};let r=`SELECT ${[...new Set([n.pointLabelBy,n.pointIndexBy,n.pointIdBy,...o?[o]:[]])].map(e=>`"${e}"`).join(", ")} FROM ${t}`;i&&(r+=` ${i}`),o&&(r+=` ORDER BY "${o}" DESC`),r+=` LIMIT ${n.showTopLabelsLimit}`;const s=await e.query(r,{cache:!0});if(!s)return{indices:null,ids:null,labels:null,weights:null};const a=s.getChild(n.pointIdBy),l=s.getChild(n.pointIndexBy);let c=s.getChild(n.pointLabelBy),u=null;o&&(u=s.getChild(o));const h=n.pointLabelFn,d=n.pointLabelWeightFn,p=Boolean(c)&&"function"==typeof h,f=Boolean(u)&&"function"==typeof d;if(n.pointLabelFn&&!p&&rI(0,0,"warn"),n.pointLabelWeightFn&&!f&&rI(0,0,"warn"),p||f){const e=p?c.toArray():null,t=f?u.toArray():null,n=Math.max((null==e?void 0:e.length)??0,(null==t?void 0:t.length)??0);for(let i=0;i<n;i++){const n=null==l?void 0:l.get(i);p&&e&&h&&(e[i]=h(e[i],n)),f&&t&&d&&(t[i]=d(t[i],n))}e&&(c=qE(e)),t&&(u=qE(t))}return{indices:l,ids:a,labels:c,weights:u}},vz=async(e,t,n,i,o)=>bz(e,t,n,`WHERE ${n.pointIndexBy} IN (${i.join(", ")})`,o);var xz=[],wz=[];function Sz(e,t){if(e&&"undefined"!=typeof document){var n,i=!0===t.prepend?"prepend":"append",o=!0===t.singleTag,r="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(o){var s=xz.indexOf(r);-1===s&&(s=xz.push(r)-1,wz[s]={}),n=wz[s]&&wz[s][i]?wz[s][i]:wz[s][i]=a()}else n=a();65279===e.charCodeAt(0)&&(e=e.substring(1)),n.styleSheet?n.styleSheet.cssText+=e:n.appendChild(document.createTextNode(e))}function a(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var n=Object.keys(t.attributes),o=0;o<n.length;o++)e.setAttribute(n[o],t.attributes[n[o]]);var s="prepend"===i?"afterbegin":"beforeend";return r.insertAdjacentElement(s,e),e}}var Ez={cosmographStaticLabel:"style_module_cosmographStaticLabel__2e27a4a3",cosmographDynamicLabel:"style_module_cosmographDynamicLabel__2e27a4a3",cosmographLabel:"style_module_cosmographLabel__2e27a4a3 style_module_cosmographLabelBase__2e27a4a3",cosmographLabelHovered:"style_module_cosmographLabelHovered__2e27a4a3 style_module_cosmographLabelBase__2e27a4a3",cosmographLabelInteractive:"style_module_cosmographLabelInteractive__2e27a4a3",cosmographLabelHidden:"style_module_cosmographLabelHidden__2e27a4a3 style_module_cosmographLabelBase__2e27a4a3",cosmographCustomLabel:"style_module_cosmographCustomLabel__2e27a4a3 style_module_cosmographLabelBase__2e27a4a3",cosmographClusterLabel:"style_module_cosmographClusterLabel__2e27a4a3 style_module_cosmographLabelBase__2e27a4a3"};Sz(".style_module_cosmographDynamicLabel__2e27a4a3,.style_module_cosmographStaticLabel__2e27a4a3{opacity:1}.style_module_cosmographLabelBase__2e27a4a3{-webkit-font-smoothing:antialiased!important;background-color:#24272fe0;cursor:default;font-weight:400!important;line-height:1!important;max-width:350px;overflow:hidden;text-overflow:ellipsis;text-rendering:optimizeLegibility!important;transition:opacity .25s;white-space:nowrap}.style_module_cosmographLabelHovered__2e27a4a3{z-index:1}.style_module_cosmographLabelInteractive__2e27a4a3{cursor:pointer;pointer-events:all}.style_module_cosmographLabelHidden__2e27a4a3{opacity:.1}.style_module_cosmographClusterLabel__2e27a4a3{background:#3f4562a1;font-weight:500!important;opacity:.9;text-shadow:-1px -1px 0 #3f4562a1,-1px -1px 5px #00000026,1px -1px 0 #3f4562a1,1px -1px 5px #00000026,-1px 1px 0 #3f4562a1,-1px 1px 5px #00000026,1px 1px 0 #3f4562a1,1px 1px 5px #00000026}",{});let Tz=class{constructor(e,t){var n;s(this,"_"),s(this,"_onHoveredLabelClick"),s(this,"_hoveredCssLabel"),s(this,"_cssLabelsRenderer"),s(this,"_focusedLabel"),s(this,"_staticLabelsMap",new Map),s(this,"_dynamicLabelsMap",new Map),s(this,"_validLabelAccessor",!1),s(this,"_validLabelWeightAccessor",!1),s(this,"_labelDataMap",new Map),s(this,"_customLabelsMap",new Map),s(this,"_columnNames",""),s(this,"_cachedTrackedPointsPositions"),s(this,"_lastTrackedPointsQueryTime",0),s(this,"_isZooming",!1),s(this,"_isManualZooming",!1),s(this,"_clustersFontScale"),s(this,"_clustersWeightScale"),s(this,"_updateClustersFontScaleHandler"),s(this,"_minDegree"),s(this,"_maxDegree"),s(this,"_degreeRange"),s(this,"_degreeSummaryCalculated",!1),s(this,"labelsContainer",document.createElement("div")),s(this,"_checkLabelEvents",()=>this._hasPointLabelEvents()?"all":"none"),this._=e;const i=this._.eventManager.getLabelEvents();null==(n=e.containerElement)||n.appendChild(this.labelsContainer),this._cssLabelsRenderer=new yz(this.labelsContainer,{dispatchWheelEventElement:t,onLabelClick:i.onLabelClick}),this._onHoveredLabelClick=i.onHoveredLabelClick,this._hoveredCssLabel=new gz(this.labelsContainer),this._hoveredCssLabel.setPointerEvents(this._checkLabelEvents()),this._hoveredCssLabel.element.addEventListener("click",this._onHoveredLabelClick,{passive:!0}),this._updateClustersFontScaleHandler=()=>this._updateClustersFontScale(),this._.addEventListener("clustersUpdated",this._updateClustersFontScaleHandler)}get _labelWeightAccessor(){const{pointLabelWeightBy:e,pointSizeBy:t}=this._.config;return e||t}async render(){const{customLabels:e,showClusterLabels:t}=this._.config;this._.cosmos&&this._.config&&((this._validLabelAccessor||e||t)&&!this._isZooming?await this._updateLabels():this._isZooming&&this._populateLabelDataMap(this._isManualZooming),this._renderLabels())}async update(){if(this._degreeSummaryCalculated=!1,!this._.cosmos||!this._.dbCoordinator)return;const{config:e,public:{pointsTableName:t}}=this._,{pointLabelBy:n,customLabels:i,showClusterLabels:o}=e;await this._.configManager.configUpdated();const r=this._columnNames;this._columnNames=`${n||""}-${this._labelWeightAccessor||""}`,this.setCustomLabels(i);let s=!1;if(n){if(r!==this._columnNames){const e=[];await wF(this._.dbCoordinator,t,[n,this._labelWeightAccessor].filter(Boolean),e),this._validLabelAccessor=!e.includes(n),this._validLabelWeightAccessor=!!this._labelWeightAccessor&&!e.includes(this._labelWeightAccessor),this._validLabelAccessor&&!this._validLabelWeightAccessor&&(s=!0)}this._validLabelAccessor?(s&&this._calculateDegreeSummary(),await this._updateStaticLabels(),await this.render()):(rI(0,0,"warn"),this.clear())}else this._customLabelsMap.size>0||o?await this.render():this.clear()}updatePositions(){var e,t;const n=null==(e=this._.cosmos)?void 0:e.getPointPositions(),i=null==(t=this._.cosmos)?void 0:t.getClusterPositions();n&&this._labelDataMap.forEach(e=>{const t=e.index,i=n[2*t],o=n[2*t+1];void 0!==i&&void 0!==o&&(e.position=[i,o])}),i&&this._labelDataMap.forEach((e,t)=>{var n;if(null==(n=t.startsWith)?void 0:n.call(t,"cluster-")){const t=e.index,n=i[2*t],o=i[2*t+1];void 0!==n&&void 0!==o&&(e.position=[n,o])}}),this._renderLabels()}async _updateLabels(){var e,t,n,i;const{config:o,cosmosInitialized:r,dbCoordinator:s,public:{pointsTableName:a,focusedPointIndex:l}}=this._,{showDynamicLabels:c,pointLabelBy:u,showLabels:h}=o;if(this._dynamicLabelsMap.clear(),this._validLabelAccessor&&u&&h&&s)if(c&&await this._updateDynamicLabels(),l){if(!this._focusedLabel||this._focusedLabel&&this._focusedLabel[0]!==l){const c=await vz(s,a,o,[l]);if(this._focusedLabel=[null==(e=c.indices)?void 0:e.get(0),null==(t=c.ids)?void 0:t.get(0),null==(n=c.labels)?void 0:n.get(0)],r){const e=Array.from(this._staticLabelsMap.keys()).concat(l);null==(i=this._.cosmos)||i.trackPointPositionsByIndices(e)}}}else this._focusedLabel=void 0;this._populateLabelDataMap()}async _updateDynamicLabels(){const{config:e,dbCoordinator:t,public:{pointsTableName:n}}=this._,i=this._.public.getSampledPointPositionsMap();if(!(null==i?void 0:i.size))return;const o=Array.from(i.keys()),r=await vz(t,n,e,o);this._setLabels(this._dynamicLabelsMap,r)}async _updateStaticLabels(){var e;const{config:t,dbCoordinator:n,public:{pointsTableName:i,focusedPointIndex:o}}=this._,{pointLabelBy:r,showTopLabels:s,showLabelsFor:a,showLabels:l}=t;if(this._staticLabelsMap.clear(),!l||!n||!r)return;const c=[];(null==a?void 0:a.length)&&c.push((async(e,t,n,i)=>{const o=(n.showLabelsFor??[]).map(e=>`'${e}'`).join(", ");return bz(e,t,n,`WHERE ${n.pointIdBy} IN (${o})`,i)})(n,i,t,this._validLabelWeightAccessor?this._labelWeightAccessor:void 0).then(e=>this._setLabels(this._staticLabelsMap,e))),s&&c.push(this._getTopLabels().then(e=>this._setLabels(this._staticLabelsMap,e))),c.length&&await Promise.all(c);const u=Array.from(this._staticLabelsMap.keys());o&&u.push(o),u.length&&(null==(e=this._.cosmos)||e.trackPointPositionsByIndices(u))}async _getTopLabels(){const{config:e,dbCoordinator:t,public:{pointsTableName:n}}=this._;if(!t)return;const i=this._.public.getSelectedPointIndices();if(null==i?void 0:i.length)return await vz(t,n,e,i,this._validLabelWeightAccessor?this._labelWeightAccessor:void 0);if(this._labelWeightAccessor&&this._validLabelWeightAccessor)return await(async(e,t,n)=>bz(e,t,n))(t,n,e);this._labelWeightAccessor&&!this._validLabelWeightAccessor&&rI(this._labelWeightAccessor,0,"warn");const o=this._findTopIndicesByDegree();return o.length?await vz(t,n,e,o,this._validLabelWeightAccessor?this._labelWeightAccessor:void 0):void 0}_setLabels(e,t){var n;if(!(null==t?void 0:t.indices)||!t.labels||!t.ids)return;const i=t.indices.length;for(let o=0;o<i;o++)e.set(t.indices.get(o),[t.ids.get(o),t.labels.get(o),null==(n=t.weights)?void 0:n.get(o)])}_findTopIndicesByDegree(){const{showTopLabelsLimit:e=100}=this._.config,{pointDegrees:t}=this._.public;if(!t)return[];const n=new Set(this._.public.getSelectedPointIndices()),i=[];if(n.size>0){const o=Array.from(n).sort((e,n)=>(t[n]||0)-(t[e]||0)).slice(0,e);i.push(...o)}if(i.length<e){const o=e-i.length,r=[];for(let e=0;e<t.length;e++)!n.has(e)&&t[e]&&(r.length<o?(r.push({index:e,degree:t[e]??0}),r.length===o&&r.sort((e,t)=>t.degree-e.degree)):t[e]>r[o-1].degree&&(r[o-1]={index:e,degree:t[e]},r.sort((e,t)=>t.degree-e.degree)));i.push(...r.map(e=>e.index))}return i}_populateLabelDataMap(e=!1){const{showLabels:t,staticLabelWeight:n,dynamicLabelWeight:i,showDynamicLabels:o,showTopLabels:r,showLabelsFor:s,pointLabelBy:a}=this._.config;if(e&&t||this._labelDataMap.clear(),!t)return;const l=this._.crossfilter.isFilteringActive;if((!this._.config.showClusterLabels||l)&&this._validLabelAccessor&&a&&t){const t=this._getTrackedPositions(e);if(t&&((r||(null==s?void 0:s.length))&&this._addLabelsToDataMap(this._staticLabelsMap,t,Ez.cosmographStaticLabel,n),this._addFocusedLabelToDataMap(t)),!e&&o){const e=this._.public.getSampledPointPositionsMap();e&&this._addLabelsToDataMap(this._dynamicLabelsMap,e,Ez.cosmographDynamicLabel,i)}}this._addClusterLabelsToDataMap(),this._addCustomLabelsToDataMap()}_getTrackedPositions(e){var t;const n=Date.now();if(e&&this._cachedTrackedPointsPositions&&n-this._lastTrackedPointsQueryTime<1e3)return this._cachedTrackedPointsPositions;const i=null==(t=this._.cosmos)?void 0:t.getTrackedPointPositionsMap();return this._cachedTrackedPointsPositions=i,this._lastTrackedPointsQueryTime=n,i}_addLabelsToDataMap(e,t,n,i){e.size&&t.forEach((t,o)=>{const r=e.get(o);if(r){const[e,s,a]=r;this._labelDataMap.set(e,{index:o,text:s,position:t,className:n,weight:a??i})}})}_updateClustersFontScale(){const{config:e}=this._;if(!e.pointClusterBy)return;const t=_D(Array.from(this._.configManager.clusterIndexToNameMapping.values()).map(({count:e})=>e)),n=e.clusterLabelFontSize??mF,i=Math.max(10,Math.floor(.7*n)),o=Math.ceil(1.5*n);this._clustersFontScale=cM().domain(t).range([i,o]),this._clustersWeightScale=cM().domain(t).range([1100,1e4])}_addClusterLabelsToDataMap(){var e,t,n,i,o;const{config:{showClusterLabels:r,clusterLabelFontSize:s=mF,scaleClusterLabels:a,usePointColorStrategyForClusterLabels:l,pointDefaultColor:c}}=this._;if(!r||this._.crossfilter.isFilteringActive)return;const u=null==(e=this._.cosmos)?void 0:e.getClusterPositions();if(u)for(let h=0;h<u.length;h+=2){const e=Number(u[h]),r=Number(u[h+1]),d=h/2,p=this._.configManager.clusterIndexToNameMapping.get(d);if(!p)continue;const f=a?null==(t=this._clustersFontScale)?void 0:t.call(this,(null==p?void 0:p.count)??0):s,m=UF(c,fF),_=l?null==(i=(n=this._.configManager).activePointColorFn)?void 0:i.call(n,null==p?void 0:p.name):void 0,g=_?"string"==typeof _?_:UF(_,m):void 0,{text:y,maxWidth:b}=this._getClusterLabelText((null==p?void 0:p.name)??`Cluster ${d}`,f);this._labelDataMap.set(`cluster-${d}`,{text:y,position:[e,r],className:Ez.cosmographClusterLabel,index:d,fontSize:f,color:l?g:"white",weight:(null==(o=this._clustersWeightScale)?void 0:o.call(this,(null==p?void 0:p.count)??0))??5e3,padding:this._getClusterPadding(f),maxWidth:b})}}_addCustomLabelsToDataMap(){const{staticLabelWeight:e,pointLabelColor:t}=this._.config;this._customLabelsMap.forEach((n,i)=>{this._labelDataMap.set(i,{index:0,text:n.text,position:n.position,className:n.className??Ez.cosmographCustomLabel,color:t??(n.className?void 0:"white"),weight:e})})}_addFocusedLabelToDataMap(e){if(!this._focusedLabel)return;const[t,n,i]=this._focusedLabel,o=e.get(t);o&&this._labelDataMap.set(n,{index:t,text:i,position:o,className:Ez.cosmographStaticLabel,weight:1e4})}_normalizeWeight(e,t,n){var i,o;if(n)return 1e3;if(this._validLabelWeightAccessor&&void 0!==e){const t=null==(o=null==(i=this._.summary)?void 0:i.pointsSummary)?void 0:o.find(e=>e.column_name===this._labelWeightAccessor);if(t){const{min:n,max:i}=t,o=i-n;return o>0?(e-n)/o*100:50}}const r=this._.public.pointDegrees;if(this._degreeSummaryCalculated&&r&&void 0!==r[t]){const e=r[t]??this._minDegree??0;return(this._degreeRange??0)>0?(e-(this._minDegree??0))/this._degreeRange*100:50}return 1}_calculateDegreeSummary(){const e=this._.public.pointDegrees;if(e&&!this._degreeSummaryCalculated){this._minDegree=1/0,this._maxDegree=-1/0;for(let t=0;t<e.length;t++){const n=e[t];void 0!==n&&(this._maxDegree=Math.max(this._maxDegree,n),this._minDegree=Math.min(this._minDegree,n))}this._minDegree===1/0&&(this._minDegree=0),this._maxDegree===-1/0&&(this._maxDegree=this._minDegree),this._degreeRange=this._maxDegree-this._minDegree,this._degreeSummaryCalculated=!0}}_renderLabels(){var e,t;const{public:{crossfilter:n}}=this._,{pointLabelClassName:i,clusterLabelClassName:o,labelMargin:r,pointLabelColor:s,pointLabelFontSize:a,clusterLabelFontSize:l=mF,labelPadding:c}=this._.config,u=n.intersection,h=this._.crossfilter.isFilteringActive,d=Ez.cosmographLabelHidden,p=Array.from(this._labelDataMap.entries()).map(([e,t])=>{var n;const{index:p,text:f,position:m,className:_,weight:g,color:y,fontSize:b,padding:v,maxWidth:x}=t,w=e.startsWith("custom-"),S=e.startsWith("cluster-"),E=S?Ez.cosmographClusterLabel:Ez.cosmographLabel,[T,C]=this._.public.spaceToScreenPosition(m),I=this._.public.getPointScreenRadiusByIndex(p),A=(null==(n=this._focusedLabel)?void 0:n[0])===p,k=!!h&&u.has(p),L=!h||k,R=S?o:i;let P;if(P="function"==typeof R?R(f,p,e)??"":R??"",S&&x){const e=`max-width: ${x}px;`;P=P.includes(":")?`${P} ${e}`:e}const D=P.includes(":");let M,N=D?`${L?E:d} ${_}`:`${L?E:d} ${P} ${_}`;return(S?this._hasClusterLabelEvents():this._hasPointLabelEvents())&&(N+=` ${Ez.cosmographLabelInteractive}`),M=w?C:S?C+l/2+r:C-I/2-r,{id:e,text:f,x:T,y:M,padding:S?v:this._getPaddingObject(c),weight:S?g:this._normalizeWeight(g,p,k),shouldBeShown:A,fontSize:b??a,color:w?y:y??(void 0!==i?void 0:s??this._getLabelColorByIndex(p)),style:D?P:"",className:N}});null==(e=this._cssLabelsRenderer)||e.setLabels(p),null==(t=this._cssLabelsRenderer)||t.draw(!0)}async renderHoveredLabel(e,t){var n,i;if(!this._.cosmos)return;const{config:o,dbCoordinator:r,public:{pointsTableName:s}}=this._,{pointLabelBy:a,showHoveredPointLabel:l,hoveredPointLabelClassName:c,labelMargin:u,pointLabelFontSize:h,labelPadding:d}=o;if(this._hoveredCssLabel.setPointerEvents(this._checkLabelEvents()),!(r&&l&&a&&void 0!==e&&t&&this._validLabelAccessor))return this._hoveredCssLabel.setVisibility(!1),void this._hoveredCssLabel.draw();const p=await vz(r,s,o,[e]);if(!p)return;const f=null==(n=p.ids)?void 0:n.get(0),m=(null==(i=p.labels)?void 0:i.get(0))??"",[_,g]=this._.public.spaceToScreenPosition(t),y=this._.public.getPointScreenRadiusByIndex(e);let b,v;b="function"==typeof c?c(m,e,f)??"":c??"";const x=b.includes(":");v=x?Ez.cosmographLabelHovered:[Ez.cosmographLabelHovered,b].join(" "),"all"===this._checkLabelEvents()&&(v+=` ${Ez.cosmographLabelInteractive}`),this._hoveredCssLabel.setText(m),this._hoveredCssLabel.setVisibility(!0),this._hoveredCssLabel.setPosition(_,g-y/2-u),this._hoveredCssLabel.setClassName(v),this._hoveredCssLabel.setStyle(x?b:""),this._hoveredCssLabel.setFontSize(h),this._hoveredCssLabel.setPadding(this._getPaddingObject(d)),c||this._hoveredCssLabel.setColor(this._getLabelColorByIndex(e)),this._hoveredCssLabel.draw()}setCustomLabels(e){const{rescaleXFn:t,rescaleYFn:n}=this._.public;this._customLabelsMap.clear(),e&&e.forEach((e,i)=>{const o={...e};t&&n&&void 0!==o.position[0]&&void 0!==o.position[1]&&(o.position=[t(o.position[0]),n(o.position[1])]),this._customLabelsMap.set(`custom-${i}`,o)})}setZooming(e,t=!0){const n=this._isZooming;this._isZooming=e,this._isManualZooming=t,n&&!e&&this.render().catch(console.error)}destroy(){var e,t,n,i;this.clear(),null==(e=this._hoveredCssLabel)||e.element.removeEventListener("click",this._onHoveredLabelClick,{passive:!0}),null==(t=this._hoveredCssLabel)||t.destroy(),null==(n=this._cssLabelsRenderer)||n.destroy(),null==(i=this._.containerElement)||i.removeChild(this.labelsContainer)}clear(){var e,t,n;this._cachedTrackedPointsPositions=void 0,this._lastTrackedPointsQueryTime=0,this._isZooming=!1,this._degreeSummaryCalculated=!1,this._minDegree=void 0,this._maxDegree=void 0,this._degreeRange=void 0,this._labelDataMap.size&&(this._customLabelsMap.clear(),this._staticLabelsMap.clear(),this._dynamicLabelsMap.clear(),this._labelDataMap.clear(),null==(e=this._cssLabelsRenderer)||e.setLabels([]),null==(t=this._cssLabelsRenderer)||t.draw(),null==(n=this._hoveredCssLabel)||n.destroy())}_getLabelColorByIndex(e){var t;const n=((e,t)=>e?[e[4*t]??0,e[4*t+1]??0,e[4*t+2]??0,e[4*t+3]??0]:void 0)(null==(t=this._.cosmos)?void 0:t.graph.pointColors,e)??this._.config.pointDefaultColor,i=UF(this._.config.pointDefaultColor,fF);return UF(n,i)}_hasPointLabelEvents(){const{onLabelClick:e,selectPointOnLabelClick:t,focusPointOnLabelClick:n}=this._.config;return void 0!==e||Boolean(t)||Boolean(n)}_hasClusterLabelEvents(){const{onClusterLabelClick:e,selectClusterOnLabelClick:t}=this._.config;return void 0!==e||Boolean(t)}_getPaddingObject(e){if(e&&!(e.length<4))return{left:e[0]??0,top:e[1]??0,right:e[2]??0,bottom:e[3]??0}}_getClusterPadding(e){const{scaleClusterLabels:t,clusterLabelFontSize:n=mF}=this._.config,i=this._getPaddingObject(this._.config.labelPadding);if(!t||!e)return i;const o=e/n;return{left:i.left*o,top:i.top*o,right:i.right*o,bottom:i.bottom*o}}_getClusterLabelText(e,t){const{scaleClusterLabels:n,clusterLabelFontSize:i=mF}=this._.config;if(!n||!t)return{text:e,maxWidth:350};const o=t/i,r=Math.max(350,Math.min(900,500*o)),s=.6*t,a=Math.floor(r/s);return e.length*s>r?{text:`${e.substring(0,Math.max(3,a-3))}...`,maxWidth:r}:{text:e,maxWidth:r}}};Sz(".style_module_rectSelect__6c3b1fe5{height:100%;left:0;position:absolute;top:0;width:100%}",{});let Cz=class{constructor(e){var t;s(this,"_"),s(this,"_svg"),s(this,"_onSelectCallback"),s(this,"_brush",sD(qP).keyModifiers(!1).on("end",e=>{var t;if(!e.sourceEvent)return;const{shiftKey:n,altKey:i}=e.sourceEvent,o=e.selection;null==(t=this._onSelectCallback)||t.call(this,o,n,i)})),this._=e,this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._svg.classList.add("style_module_rectSelect__6c3b1fe5"),null==(t=this._.containerElement)||t.appendChild(this._svg),this._onSelectCallback=this._.eventManager.onRectSelect,bk(this._svg).select(".brush-group").remove(),this._brush.extent([[0,0],[this._svg.clientWidth,this._svg.clientHeight]]),bk(this._svg).append("g").attr("class","brush-group").call(this._brush),this.updateSelectionClassName(),bk(this._svg).style("display","none")}updateSelectionClassName(){const e=`selection ${this._.config.rectangularSelectorClassName??""}`;bk(this._svg).select(".brush-group").selectAll(".selection").attr("class",e)}enable(){bk(this._svg).style("display",null),this._brush.extent([[0,0],[this._svg.clientWidth,this._svg.clientHeight]]),bk(this._svg).select(".brush-group").call(this._brush)}disable(){bk(this._svg).style("display","none"),bk(this._svg).select(".brush-group").call(this._brush.clear)}destroy(){bk(this._svg).select(".brush-group").remove(),this._svg.remove()}};Sz(".style_module_polygonalSelect__f21ae84d{height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}",{});let Iz=class{constructor(e){s(this,"_"),s(this,"_canvas"),s(this,"_ctx"),s(this,"_isDrawing",!1),s(this,"_points",[]),s(this,"_onSelectCallback"),s(this,"_resizeObserver"),s(this,"_startDrawing",e=>{this._isDrawing=!0,this._points=[];const t=this._canvas.getBoundingClientRect();this._points.push({x:e.clientX-t.left,y:e.clientY-t.top});const n=window.devicePixelRatio||1;this._ctx.clearRect(0,0,this._canvas.width/n,this._canvas.height/n)}),s(this,"_draw",e=>{if(!this._isDrawing)return;const t=this._canvas.getBoundingClientRect();this._points.push({x:e.clientX-t.left,y:e.clientY-t.top});const n=window.devicePixelRatio||1;this._ctx.clearRect(0,0,this._canvas.width/n,this._canvas.height/n),this._ctx.beginPath(),this._points.length>0&&this._points[0]&&this._ctx.moveTo(this._points[0].x,this._points[0].y);for(let i=1;i<this._points.length;i++){const e=this._points[i];e&&this._ctx.lineTo(e.x,e.y)}this._ctx.strokeStyle=this._.config.polygonalSelectorStrokeColor||"#ffffff",this._ctx.lineWidth=this._.config.polygonalSelectorLineWidth||2,this._ctx.stroke()}),s(this,"_stopDrawing",e=>{var t;if(!this._isDrawing)return;if(this._isDrawing=!1,this._points.length>2){this._ctx.closePath(),this._ctx.stroke();const n=this._points.map(e=>[e.x,e.y]),i=n[0],o=n[n.length-1];i&&o&&(i[0]!==o[0]||i[1]!==o[1])&&n.push(i),null==(t=this._onSelectCallback)||t.call(this,n,e.shiftKey,e.altKey)}const n=window.devicePixelRatio||1;this._ctx.clearRect(0,0,this._canvas.width/n,this._canvas.height/n)}),this._=e,this._onSelectCallback=this._.eventManager.onPolygonSelect,this._initializeCanvas(),this._resizeObserver=new ResizeObserver(()=>this._resizeCanvas()),this._resizeObserver.observe(this._.containerElement)}_initializeCanvas(){const e=this._.containerElement;if(!e)return void console.error("Container element is undefined");this._canvas=document.createElement("canvas"),this._canvas.classList.add("style_module_polygonalSelect__f21ae84d"),e.appendChild(this._canvas);const t=this._canvas.getContext("2d");if(!t)return void console.error("Failed to get canvas context");this._ctx=t;const n=window.devicePixelRatio||1;this._canvas.width=e.clientWidth*n,this._canvas.height=e.clientHeight*n,this._canvas.style.width=`${e.clientWidth}px`,this._canvas.style.height=`${e.clientHeight}px`,this._ctx.scale(n,n)}enable(){this._canvas.style.display="block",this._canvas.style.pointerEvents="auto",this._canvas.style.cursor="crosshair",this._canvas.addEventListener("mousedown",this._startDrawing),this._canvas.addEventListener("mousemove",this._draw),this._canvas.addEventListener("mouseup",this._stopDrawing)}disable(){if(this._canvas.style.display="none",this._canvas.style.pointerEvents="none",this._canvas.style.cursor="default",this._canvas.removeEventListener("mousedown",this._startDrawing),this._canvas.removeEventListener("mousemove",this._draw),this._canvas.removeEventListener("mouseup",this._stopDrawing),this._ctx){const e=window.devicePixelRatio||1;this._ctx.clearRect(0,0,this._canvas.width/e,this._canvas.height/e)}}destroy(){var e;null==(e=this._resizeObserver)||e.disconnect(),this.disable(),this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas)}_resizeCanvas(){const{width:e,height:t}=this._.containerElement.getBoundingClientRect(),n=window.devicePixelRatio||1;this._canvas.width=e*n,this._canvas.height=t*n,this._canvas.style.width=`${e}px`,this._canvas.style.height=`${t}px`,this._ctx.scale(n,n)}};const Az=new WeakMap;function kz(e){return Az.get(e)}let Lz=(t=class{constructor(e){s(this,"_id"),s(this,"_isActive",!0),s(this,"_client"),s(this,"_selection"),s(this,"_config"),s(this,"_currentData"),s(this,"_isArrayColumn",!1),this._config=e,this._client=this._createClient();const t=`${this.fieldsToQuery.join(",")}-${gI()}`;this._id=e.id?`${e.id}-${t}`:t}static getOrCreateClient(e){if(e.id){const n=t._clientRegistry.get(e.id);if(n)return n._config=e,n._isArrayColumn=!1,n._currentData&&n._detectArrayColumn(),n}const n=new t(e);return e.id&&t._clientRegistry.set(e.id,n),n}get selection(){return this._selection}get tableName(){return this._config.getTableName()}get accessor(){return this._config.getAccessor()}get id(){return this._id}get active(){return this._client.enabled}get currentData(){return this._currentData}get fieldsToQuery(){const e=this._config.includeFields?this._config.includeFields():[];return this._isActive?[...new Set([...this.accessor?[bm(this.accessor)]:[],...e].filter(Boolean))]:["*"]}setActive(e){this._isActive=e}async getCurrentData(){const e=await this._config.coordinator.query(jm.from(this.tableName).select(this.fieldsToQuery));return this._currentData=e,this._detectArrayColumn(),e}_detectArrayColumn(){var e;try{const t=this.accessor,n=t?null==(e=this._currentData)?void 0:e.getChild(t):void 0;this._isArrayColumn=!(!n||!(mI(n.type)||n.length>0&&Array.isArray(n.get(0))))}catch{this._isArrayColumn=!1}}applyFilter(e){var t;null==(t=this.selection)||t.update({source:this,predicate:e??null,value:e??null})}applyRangeFilter(e){this.accessor&&this.applyFilter(e?v_(bm(this.accessor),e):void 0)}applyExactFilter(e){if(void 0===e)return void this.applyFilter(void 0);if("null"===e)return void this.applyFilter((t=bm(this.accessor),u_("IS NULL",t)));var t;const n=this._isArrayColumn?w_`list_contains(${bm(this.accessor)}, ${xm(e)})`:h_("=",bm(this.accessor),xm(e));this.applyFilter(n)}applyInFilter(e){if(this.accessor)if(e&&e.length>0){const t=(Array.isArray(e)?e:Array.from(e)).map(e=>xm(e));this.applyFilter(x_(bm(this.accessor),t))}else this.applyFilter(void 0)}applyLessOrEqFilter(e){this.accessor&&this.applyFilter(void 0!==e?y_(bm(this.accessor),xm(e)):void 0)}applyGreaterOrEqFilter(e){this.accessor&&this.applyFilter(void 0!==e?b_(bm(this.accessor),xm(e)):void 0)}resetFilter(){var e,t;this.selection&&(null==(t=null==(e=this.selection)?void 0:e.clauses)?void 0:t.filter(e=>e.source.id===this.id).length)>0&&this.selection.update({source:this,predicate:null,value:null})}update(){this._client.update()}destroy(){this.resetFilter(),this._client.destroy(),this._config.id&&t._clientRegistry.delete(this._config.id)}regenerateClient(){this.destroy(),this._client=this._createClient()}_createClient(){return this._selection=this._config.getSelection(),function(e){const{coordinator:t=bg(),...n}=e,i=new xg(n);return t.connect(i),i}({coordinator:this._config.coordinator,selection:this.selection,query:e=>{var t;return this._isActive&&(null==(t=this.selection)?void 0:t.clauses.active)?jm.from(this.tableName).select(this.fieldsToQuery).where(e??[]):null},queryResult:e=>{var t,n;const i=e;this._currentData=i,null==(n=(t=this._config).onFiltered)||n.call(t,i)}})}reset(){this.resetFilter()}},s(t,"_clientRegistry",new Map),t),Rz=class{constructor(e,t,n){s(this,"_dataUpdatedHandler"),s(this,"_dataFilteredHandler"),s(this,"_resetSelectionsHandler"),s(this,"_internalApi"),s(this,"_isValidAccessor",!1),s(this,"_currentData"),s(this,"_client"),s(this,"_uiComponent"),s(this,"_config"),s(this,"_targetElement"),s(this,"_abortController",new AbortController),s(this,"_readyPromise"),s(this,"_isInitialLoad",!0),this._internalApi=kz(e),this._targetElement=t,this._config=this._mergeWithDefaultConfig(n),this._dataUpdatedHandler=async()=>await this.fetchData(),this._dataFilteredHandler=()=>this.onDataFiltered(),this._resetSelectionsHandler=()=>this._onResetSelections(),this._internalApi.addEventListener("dataUploaded",this._dataUpdatedHandler),this._internalApi.addEventListener("dataFiltered",this._dataFilteredHandler),this._internalApi.addEventListener("resetSelections",this._resetSelectionsHandler),this._readyPromise=this._initialize()}onInitialize(){}onResetClientSelections(){}getCurrentData(){return null}async shouldUpdateComponentData(){return!1}get useLinksData(){return this._config.useLinksData??!1}get pointAccessors(){const{pointIdBy:e,pointIndexBy:t}=this._internalApi.config;return e&&t?[e,t]:[]}get linkAccessors(){const{linkSourceIndexBy:e,linkTargetIndexBy:t}=this._internalApi.config;return e&&t?[e,t]:[]}get selection(){return this.useLinksData?this._internalApi.crossfilter.linksSelection:this._internalApi.crossfilter.pointsSelection}get tableName(){return this.useLinksData?this._internalApi.public.linksTableName:this._internalApi.public.pointsTableName}async _initialize(){await((e,t)=>{const{signal:n}=t;return e.reduce((e,t)=>e.then(async()=>{var e;if(!n.aborted)try{await t()}catch(i){(e=i)&&(e.message||String(e)),n.aborted}}),Promise.resolve()).then(()=>{})})([async()=>{await this._internalApi.dbReady();const e=await this._getGlobalDisplayStateSettings(this._config);this._config={...this._config,...e}},async()=>{this._uiComponent=this.createUIComponent(this._targetElement),await this._internalApi.configManager.cosmosInitialized()},()=>this._createClient(),()=>this.fetchData(),()=>this.setConfig(this._config),()=>this.onConfigUpdate(),()=>Promise.resolve(this.onInitialize())],this._abortController)}async _getGlobalDisplayStateSettings(e){await this._internalApi.dbReady();const{componentsDisplayStateMode:t}=this._internalApi.config;let{disableStateMessages:n,noDataMessage:i}=e;return!1===t?n=!0:"loading"===t&&(i=!1),{disableStateMessages:n,noDataMessage:i,loadingMessage:e.loadingMessage}}async setConfig(e){var t;const n=this._config,i=this.accessor;this._config=this._mergeWithDefaultConfig(e),this._config={...this._config,...await this._getGlobalDisplayStateSettings(this._config)};const o=await this.shouldUpdateComponentData();this._config.useLinksData!==n.useLinksData&&(null==(t=this._client)||t.regenerateClient()),(o||this._config.useLinksData!==n.useLinksData||this._config.useQuantiles!==n.useQuantiles||this.accessor!==i)&&(await this.fetchData(),this.onResetClientSelections()),await this.onConfigUpdate(n)}async fetchData(){var e,t,n,i,o;const{dbCoordinator:r,dataManager:s}=this._internalApi;if(!r||!this.accessor)return;await s.dataReady(),null==(t=null==(e=this._uiComponent)?void 0:e.setLoadingState)||t.call(e);const a=!this.accessor||await yF(r,this.tableName);if(this._isValidAccessor=!this.accessor||a&&await wF(r,this.tableName,[this.accessor]),this._isInitialLoad||null==(n=this._client)||n.resetFilter(),null==(i=this._client)||i.setActive(this._isValidAccessor),this._isValidAccessor){const e=await this.getCurrentData();this._currentData=null!==e?e:await(null==(o=this._client)?void 0:o.getCurrentData())}else this._currentData=void 0;this._isInitialLoad&&(this._isInitialLoad=!1)}ready(){return this._readyPromise}checkReady(e){return!!this._uiComponent||(this.ready().then(e),!1)}async _createClient(){if(await this._internalApi.dbReady(),!this._internalApi.dbCoordinator)return;const e={coordinator:this._internalApi.dbCoordinator,getTableName:()=>this.tableName,getSelection:()=>this.selection,getAccessor:()=>this.accessor,includeFields:()=>this.useLinksData?this.linkAccessors:this.pointAccessors,onFiltered:this._handleSelectionUpdate.bind(this),id:this._config.id||this.constructor.name+this.accessor+gI()};this._client=Lz.getOrCreateClient(e)}_handleSelectionUpdate(e){var t,n,i,o;if(!this.accessor)return;const r=this._internalApi.crossfilter;if(this.useLinksData){const i=r.linksSelection.active;(null==(t=null==i?void 0:i.source)?void 0:t.id)===(null==(n=this._client)?void 0:n.id)&&r.onLinksFiltered(e)}else{const t=r.pointsSelection.active;(null==(i=null==t?void 0:t.source)?void 0:i.id)===(null==(o=this._client)?void 0:o.id)&&r.onPointsFiltered(e)}}_onResetSelections(){var e;null==(e=this._client)||e.resetFilter(),this.onResetClientSelections()}_mergeWithDefaultConfig(e){return IO(this.defaultConfig,e??{})}remove(){var e,t;this._abortController.abort(),null==(e=this._uiComponent)||e.destroy(),this._config.preserveSelectionOnUnmount||null==(t=this._client)||t.resetFilter(),this._internalApi.removeEventListener("dataUploaded",this._dataUpdatedHandler),this._internalApi.removeEventListener("dataFiltered",this._dataFilteredHandler),this._internalApi.removeEventListener("resetSelections",this._resetSelectionsHandler),this._isInitialLoad=!0}},Pz=(n=class extends Rz{static isInclusiveComponent(e){return n._inclusiveComponentIds.has(e)}static register(e){n._inclusiveComponentIds.add(e)}static unregister(e){n._inclusiveComponentIds.delete(e)}onInitialize(){var e;(null==(e=this._client)?void 0:e.id)&&n.register(this._client.id)}onDataFiltered(){var e;const{pointsSelection:t,linksSelection:i}=this._internalApi.crossfilter,o=t.active,r=i.active,s=!((null==o?void 0:o.predicate)||t.clauses.length||(null==r?void 0:r.predicate)||i.clauses.length),a=e=>{var t,i,o;return void 0!==(null==e?void 0:e.predicate)&&(null==(t=null==e?void 0:e.source)?void 0:t.id)===(null==(i=this._client)?void 0:i.id)&&!n.isInclusiveComponent(null==(o=null==e?void 0:e.source)?void 0:o.id)};(a(o)||a(r)||s)&&(null==(e=this._client)||e.resetFilter(),this.onResetClientSelections()),this.updateCrossfilteredData()}updateCrossfilteredData(){var e,t;const{crossfilter:n}=this._internalApi;if(!this._currentData||!this._isValidAccessor||!this.accessor)return;const i=n.filtered.intersection;if(n.isFilteringActive){const e=this._filterByIdx(this._currentData,i);this.updateHighlightedData(e)}else{const n=null==(t=null==(e=this._currentData)?void 0:e.getChild(this.accessor))?void 0:t.toArray();this.updateHighlightedData(n)}}_filterByIdx(e,t){var n,i;const{config:o}=this._internalApi;if(!this.accessor||!t.size)return[];const r=e.getChild(this.accessor);if(!r)return[];const s=this.useLinksData?o.linkSourceIndexBy:o.pointIndexBy,a=null==(n=e.getChild(s))?void 0:n.toArray();if(!a)return[];const l=this.useLinksData?null==(i=e.getChild(o.linkTargetIndexBy))?void 0:i.toArray():void 0,c=r.toArray(),u=t,h=[];for(let d=0,p=c.length;d<p;++d){const e=a[d];if(u.has(e)||void 0!==l&&u.has(l[d])){const e=c[d];Array.isArray(e)?h.push(...e):h.push(e)}}return h}remove(){var e;(null==(e=this._client)?void 0:e.id)&&n.unregister(this._client.id),super.remove()}},s(n,"_inclusiveComponentIds",new Set),n),Dz=class{constructor(e){s(this,"_internalApi"),s(this,"_pointSelectionClient"),this._internalApi=e;const t={coordinator:this._internalApi.dbCoordinator,getSelection:()=>this._internalApi.crossfilter.pointsSelection,getTableName:()=>this._internalApi.public.pointsTableName,getAccessor:()=>this._internalApi.config.pointIndexBy,onFiltered:e=>this._onPointsFiltered(e),id:"pointsSelectionClient"};this._pointSelectionClient=new Lz(t),this._pointSelectionClient.setActive(!0),Pz.register(this._pointSelectionClient.id)}_onPointsFiltered(e){this._internalApi.crossfilter.onPointsFiltered(e)}selectPoints(e){void 0===e?this._pointSelectionClient.resetFilter():this._pointSelectionClient.applyInFilter(e)}get id(){return this._pointSelectionClient.id}destroy(){Pz.unregister(this._pointSelectionClient.id)}};function Mz(e,t,n){this.k=e,this.x=t,this.y=n}Mz.prototype={constructor:Mz,scale:function(e){return 1===e?this:new Mz(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new Mz(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},Mz.prototype;const Nz=Bz(e=>{const t=Oz(e);return e=>null==e?"":"number"==typeof e?t(e):e instanceof Date?function(e,t){if(e instanceof Date||(e=new Date(+e)),isNaN(+e))return t;const n=e.getUTCHours(),i=e.getUTCMinutes(),o=e.getUTCSeconds(),r=e.getUTCMilliseconds();return`${s=e.getUTCFullYear(),s<0?`-${Fz(-s,6)}`:s>9999?`+${Fz(s,6)}`:Fz(s,4)}-${Fz(e.getUTCMonth()+1,2)}-${Fz(e.getUTCDate(),2)}${n||i||o||r?`T${Fz(n,2)}:${Fz(i,2)}${o||r?`:${Fz(o,2)}${r?`.${Fz(r,3)}`:""}`:""}Z`:""}`;var s}(e,"Invalid Date"):`${e}`}),Oz=Bz(e=>t=>0===t?"0":t.toLocaleString(e));function Bz(e){let t,n=null;return(i="en")=>i===n?t:t=e(n=i)}function Fz(e,t){return`${e}`.padStart(t,"0")}Nz(),Oz();let zz=class{constructor(e){s(this,"_id"),s(this,"_component"),s(this,"_container"),s(this,"_isDestroyed",!1),s(this,"_errorMessage"),s(this,"_internalApi"),s(this,"_marks",[]),this._id=e.id||`mosaic-component-${gI()}`,this._internalApi=e.internalApi}get id(){return this._id}get errorMessage(){return this._errorMessage}async mount(e,t){if(this._isDestroyed)return this._errorMessage=`Cannot mount component: component ${this._id} has been destroyed`,void rI(this._id,0,"warn");this._component&&(rI(this._id,0,"warn"),await this._unmount()),this._errorMessage=void 0;try{const n=await this._resolveElement(e);if(!n)return this._errorMessage="Component did not resolve to an HTMLElement",void rI((this._id,this._errorMessage),0,"warn");const i=null==n?void 0:n.value;if(i&&!(await this._validatePlot(i)))return this._abortMount(t,this._errorMessage||"Chart references columns not available in dataset");i&&(this._attachErrorInterceptors(i,t),this._connectPlot(i),this._marks=i.marks?[...i.marks]:[]),this._component=e,this._container=t,t.innerHTML="",t.appendChild(n)}catch(n){this._abortMount(t,n instanceof Error?n.message:String(n))}}_abortMount(e,t){this._errorMessage=t,this._marks=[],this._showError(e),rI(this._id,0,"warn")}async _resolveElement(e){if(e instanceof HTMLElement)return e}async _validatePlot(e){var t,n;if(!this._internalApi.dbCoordinator||!(null==(t=null==e?void 0:e.marks)?void 0:t.length))return!0;for(const i of e.marks){const e=i.sourceTable(),t=null==(n=i.channels)?void 0:n.map(e=>{var t;return null==(t=null==e?void 0:e.field)?void 0:t.column}).filter(e=>"string"==typeof e);if(!e||!(null==t?void 0:t.length))continue;const o=[];if(!(await wF(this._internalApi.dbCoordinator,e,t,o)))return this._errorMessage=`Missing columns for table "${e}"${o.length?`: ${[...new Set(o)].join(", ")}`:""}`,!1}return!0}_attachErrorInterceptors(e,t){var n,i;if(null==(n=null==e?void 0:e.marks)?void 0:n.length)for(const o of e.marks){if(!o)continue;const n=null==(i=o.queryError)?void 0:i.bind(o);o.queryError=i=>this._handleQueryError(i,e,t)?o:(null==n?void 0:n(i))??o}}_connectPlot(e){var t,n;if((null==(t=null==e?void 0:e.marks)?void 0:t.length)&&this._internalApi.dbCoordinator)for(const o of e.marks)if(o&&o.coordinator!==this._internalApi.dbCoordinator)try{null==(n=o.coordinator)||n.disconnect(o),this._internalApi.dbCoordinator.connect(o),o.queryPending()}catch(i){rI(this._id,0,"warn")}}_handleQueryError(e,t,n){var i;const o=e instanceof Error?e.message:String(e);return!!/no such column|cannot find column/i.test(o)&&(this._errorMessage="Mosaic query failed because required columns are missing.",this._cleanupSelections(),null==(i=null==t?void 0:t.marks)||i.forEach(e=>{var t,n;e&&(e.enabled=!1,null==(n=null==(t=e.coordinator)?void 0:t.disconnect)||n.call(t,e))}),this._component=void 0,this._marks=[],this._showError(n),rI(this._id,0,"warn"),!0)}_cleanupSelections(){if(!this._marks.length)return;const e=new Set(this._marks.flatMap(e=>{var t;return(null==(t=null==e?void 0:e.plot)?void 0:t.interactors)||[]}).filter(e=>(null==e?void 0:e.mark)&&this._marks.includes(e.mark)));e.size&&[this._internalApi.crossfilter.pointsSelection,this._internalApi.crossfilter.linksSelection].filter(Boolean).forEach(t=>{t.clauses.filter(t=>e.has(null==t?void 0:t.source)).forEach(e=>{t.update({source:e.source,predicate:null,value:null})})})}async _unmount(){this._container&&(this._cleanupSelections(),this._container.innerHTML="",this._component=void 0,this._container=void 0,this._errorMessage=void 0,this._marks=[],rI(this._id,0,"ok"))}async destroy(){this._isDestroyed||(await this._unmount(),this._isDestroyed=!0,rI(this._id,0,"ok"))}_showError(e){e&&(e.innerHTML=`\n      <div style="padding: 15px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; color: #856404; font-size: 13px;">\n        <strong>Chart Error: ${this._id}</strong>\n        <p style="margin: 5px 0 0 0;">This chart cannot be displayed. Check configuration, it may reference columns that don't exist in your data.</p>\n      </div>\n    `)}};"function"==typeof bg&&bg({connect:()=>{},disconnect:()=>{}});let Uz=class{constructor(e){s(this,"_internalApi"),s(this,"_components",new Map),this._internalApi=e}get components(){return this._components}async addComponent(e,t,n){const i=new zz({...n,internalApi:this._internalApi});if(this._components.has(i.id)){const e=this._components.get(i.id);rI(i.id,0,"warn"),await e.destroy()}return await i.mount(e,t),this._components.set(i.id,i),i.errorMessage?rI((i.id,i.errorMessage),0,"warn"):rI(i.id,0,"ok"),i}async removeComponent(e){const t=this._components.get(e);return!!t&&(await t.destroy(),this._components.delete(e),!0)}async destroyAll(){const e=Array.from(this._components.values()).map(e=>e.destroy());await Promise.all(e),this._components.clear()}};var $z="style_module_messageError__8ee622df",Vz="style_module_spinner__8ee622df";Sz(".style_module_cosmograph__8ee622df{--cosmograph-text-color:#fff;-webkit-font-smoothing:antialiased!important;display:flex;height:100%;overflow:hidden;position:relative;text-rendering:optimizeLegibility!important;width:100%}.style_module_popupContainer__8ee622df{height:100%;pointer-events:none;position:absolute;width:100%;z-index:1}.style_module_attribution__8ee622df{bottom:0;color:var(--cosmograph-text-color);cursor:pointer;line-height:0;margin:0 .6rem .6rem 0;opacity:.7;position:absolute;right:0;user-select:none;-webkit-user-select:none;z-index:1}.style_module_message__8ee622df{color:var(--cosmograph-text-color);font-size:14px;font-weight:300;left:50%;max-width:300px;opacity:.6;position:absolute;text-align:center;top:50%;transform:translate(-50%,-50%);z-index:1000}.style_module_messageError__8ee622df{max-width:min(800px,90vw);text-align:left}.style_module_messagePre__8ee622df{white-space:pre-wrap}.style_module_message__8ee622df>br{display:none}@keyframes style_module_spin__8ee622df{to{transform:rotate(1turn)}}@keyframes style_module_fadeIn__8ee622df{0%{opacity:0}to{opacity:1}}.style_module_spinner__8ee622df{animation:style_module_fadeIn__8ee622df .3s ease forwards,style_module_spin__8ee622df 1s linear infinite;border:4px solid hsla(0,0%,100%,.3);border-radius:50%;border-top:4px solid var(--cosmograph-text-color);display:block;height:30px;margin:0 auto;opacity:0;width:30px}",{});class Hz{constructor(e,t,n){s(this,"_internalApi"),s(this,"_eventTarget",new EventTarget),s(this,"_dbReadinessPromise",null),s(this,"_labels"),s(this,"_cosmos"),s(this,"_cosmosInitialized",!1),s(this,"_dbCoordinator"),s(this,"_dataValidator"),s(this,"_configManager"),s(this,"_dataManager"),s(this,"_eventManager"),s(this,"_crossfilter"),s(this,"_linkAggregationManager"),s(this,"_rectangularSelection"),s(this,"_polygonalSelection"),s(this,"_pointSelectionClient"),s(this,"_mosaicComponentManager"),s(this,"_containerElement"),s(this,"_popupElement"),s(this,"_attributionDivElement"),s(this,"_cosmosElement"),s(this,"_messageDivElement"),s(this,"_focusedPointIndex"),s(this,"_enableSimulation",!0),s(this,"_pointsHaveLayout",!1),s(this,"_isDestroyed",!1),s(this,"_summary",{}),s(this,"_stats",{pointsCount:0,linksCount:0,pointsSummary:void 0,linksSummary:void 0}),s(this,"_initializeLabels",()=>{this._labels&&this._labels.destroy();const e=this._cosmosElement.querySelector("canvas");e&&(this._labels=new Tz(this._internalApi,e))}),s(this,"_initializeClients",async()=>{this._pointSelectionClient=new Dz(this._internalApi),this._mosaicComponentManager=new Uz(this._internalApi)}),s(this,"_dropLocalTables",async e=>{var t,n;this._dbCoordinator&&(e||await(null==(t=this._dbCoordinator.internalDB)?void 0:t.dropTable(qI.Points)),await(null==(n=this._dbCoordinator.internalDB)?void 0:n.dropTable(qI.Links)))}),window.cosmographDisableLogging=t.disableLogging??!1,this._containerElement=e,this._internalApi=this._initializeInternalApi(this),function(e,t){Az.set(e,t)}(this,this._internalApi),rI(),this._initializeDB(n),this._dataValidator=new iz(this._internalApi),this._eventManager=new oz(this._internalApi),this._linkAggregationManager=new az(this._internalApi),this._configManager=new JF(this._internalApi),this._dataManager=new tz(this._internalApi),this._crossfilter=new ez(this._internalApi),this._rectangularSelection=new Cz(this._internalApi),this._polygonalSelection=new Iz(this._internalApi),void 0!==t.statusIndicatorMode&&(this._configManager.config.statusIndicatorMode=t.statusIndicatorMode),this._initializeHTMLElements(),this.setConfig(t)}_initializeInternalApi(e){return{get public(){return e},get labels(){return e._labels},get cosmos(){return e._cosmos},get summary(){return e._summary},get eventManager(){return e._eventManager},get configManager(){return e._configManager},get dataManager(){return e._dataManager},get dataValidator(){return e._dataValidator},get linkAggregationManager(){return e._linkAggregationManager},get rectangularSelection(){return e._rectangularSelection},get polygonalSelection(){return e._polygonalSelection},get crossfilter(){return e._crossfilter},get selectionClient(){return e._pointSelectionClient},get dbCoordinator(){return e._dbCoordinator},get containerElement(){return e._containerElement},get cosmosElement(){return e._cosmosElement},get popupElement(){return e._popupElement},get config(){return e._configManager.config},get cosmosInitialized(){return e._cosmosInitialized},get pointsHaveLayout(){return e._pointsHaveLayout},dropLocalTables:async t=>await e._dropLocalTables(t),updateMessage:t=>e._updateMessage(t),initializeLabels:()=>e._initializeLabels(),initializeCosmos:()=>e._initializeCosmos(),updateStats:()=>e._updateStats(),updateSummary:async()=>e._updateSummary(),dbReady:async()=>e._dbReady(),addEventListener:(t,n)=>{e._eventTarget.addEventListener(t,n,{passive:!0})},removeEventListener:(t,n)=>{e._eventTarget.removeEventListener(t,n,{passive:!0})},dispatchEvent:t=>e._eventTarget.dispatchEvent(t)}}_initializeDB(e){this._dbReadinessPromise=aA.create(e).then(async t=>{if(this._ensureAlive())if(this._dbCoordinator=t,t)this._updateMessage("👩🏻‍🚀 Cosmograph is ready, load your data!",!0),await this._initializeClients();else{const t=e?"🚨 Couldn't create coordinator for specified DuckDB connection. Please check your external DuckDB instance configuration and try to initialize Cosmograph again.":"🚨 Failed to fetch DuckDB-Wasm bundles. Please try to initialize Cosmograph again.";this._updateMessage(t)}else this.destroy()}).catch(e=>{throw this._isDestroyed||rI(0,0,"error"),e})}_initializeHTMLElements(){var e,t;this._containerElement.classList.add("style_module_cosmograph__8ee622df"),null==(e=this._containerElement)||e.style.setProperty("--cosmograph-text-color","#ffffff"),this._popupElement=document.createElement("div"),this._popupElement.classList.add("style_module_popupContainer__8ee622df"),this._cosmosElement=document.createElement("div"),this._cosmosElement.style.width="100%",this._cosmosElement.style.height="100%",null==(t=this._cosmosElement)||t.style.setProperty("backgroundColor",dF),this._containerElement.appendChild(this._cosmosElement),this._containerElement.appendChild(this._popupElement),this._addAttribution(),this._addMessageElement()}_addAttribution(){var e;this._attributionDivElement=document.createElement("div"),this._attributionDivElement.classList.add("style_module_attribution__8ee622df"),this._attributionDivElement.onclick=()=>{var e;return null==(e=window.open("https://cosmograph.app/","_blank"))?void 0:e.focus()};const t=(new DOMParser).parseFromString('<svg fill="currentColor" height="11" viewBox="0 0 163 11" width="163" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path d="m2.45674 8-1.925002-5.379h.924002l1.617 4.73h.154l1.617-4.73h.924l-1.925 5.379z"/><path d="m7.02243 8v-5.379h.869v5.379zm.44-6.215c-.19067 0-.352-.06233-.484-.187-.12467-.12467-.187-.28233-.187-.473 0-.198.06233-.359333.187-.484.132-.124667.29333-.187.484-.187.19066 0 .34833.062333.473.187.12466.124667.187.286.187.484 0 .19067-.06234.34833-.187.473-.12467.12467-.28234.187-.473.187z"/><path d="m11.8857 8.154c-.6673 0-1.232-.154-1.694-.462-.45465-.308-.72965-.79567-.82499-1.463l.82499-.187c.0587.352.1687.63067.33.836.1613.198.3593.341.594.429.242.08067.4987.121.77.121.4033 0 .7223-.08067.957-.242s.352-.37767.352-.649c0-.27867-.1137-.473-.341-.583-.22-.11733-.5243-.21267-.913-.286l-.451-.077c-.3447-.05867-.66-.15033-.946-.275s-.5133-.29333-.68199-.506c-.16866-.21267-.25299-.48033-.25299-.803 0-.484.18699-.86167.56098-1.133.374-.27133.869-.407 1.485-.407.6087 0 1.1.13933 1.474.418.3813.27133.627.65633.737 1.155l-.814.209c-.066-.38867-.2237-.66-.473-.814-.2493-.16133-.5573-.242-.924-.242s-.6563.06967-.869.209c-.2127.132-.319.33-.319.594 0 .25667.099.44733.297.572.2053.11733.4767.20533.814.264l.451.077c.3813.066.7223.15767 1.023.275.308.11.55.27133.726.484.1833.21267.275.49133.275.836 0 .528-.198.935-.594 1.221-.3887.286-.913.429-1.573.429z"/><path d="m17.5765 8.099c-.3887 0-.748-.08433-1.078-.253-.3227-.16867-.5793-.418-.77-.748-.1833-.33733-.275-.74433-.275-1.221v-3.256h.869v3.19c0 .53533.132.924.396 1.166.2713.242.6343.363 1.089.363.5133 0 .935-.16867 1.265-.506s.495-.83967.495-1.507v-2.706h.869v5.379h-.847v-.913h-.154c-.1173.25667-.319.49133-.605.704-.286.20533-.704.308-1.254.308z"/><path d="m23.9048 8.154c-.374 0-.715-.066-1.023-.198s-.55-.32267-.726-.572-.264-.55367-.264-.913c0-.36667.088-.66733.264-.902.176-.242.418-.42167.726-.539.308-.12467.6527-.187 1.034-.187h1.815v-.396c0-.38133-.1136-.682-.341-.902-.22-.22-.55-.33-.99-.33-.4326 0-.77.10633-1.012.319-.242.20533-.407.484-.495.836l-.814-.264c.088-.30067.2274-.572.418-.814.1907-.24933.4437-.44733.759-.594.3227-.154.7077-.231 1.155-.231.6894 0 1.2247.17967 1.606.539.3814.352.572.85067.572 1.496v2.431c0 .22.1027.33.308.33h.495v.737h-.759c-.242 0-.4363-.066-.583-.198-.1466-.13933-.22-.32267-.22-.55v-.055h-.132c-.0806.13933-.1906.286-.33.44-.132.14667-.3153.26767-.55.363-.2346.10267-.539.154-.913.154zm.099-.748c.5134 0 .9277-.15033 1.243-.451.3227-.308.484-.737.484-1.287v-.121h-1.782c-.3446 0-.6306.077-.858.231-.22.14667-.33.37033-.33.671s.1137.53533.341.704c.2347.16867.5354.253.902.253z"/><path d="m28.582 8v-7.7h.869v7.7z"/><path d="m31.2783 8v-5.379h.869v5.379zm.44-6.215c-.1907 0-.352-.06233-.484-.187-.1247-.12467-.187-.28233-.187-.473 0-.198.0623-.359333.187-.484.132-.124667.2933-.187.484-.187s.3483.062333.473.187.187.286.187.484c0 .19067-.0623.34833-.187.473s-.2823.187-.473.187z"/><path d="m33.7326 8v-1.122l3.421-3.377v-.121h-3.311v-.759h4.224v1.122l-3.432 3.377v.132h3.52v.748z"/><path d="m41.9601 8.154c-.5427 0-1.0194-.11367-1.43-.341-.4107-.23467-.7297-.561-.957-.979-.2274-.418-.341-.902-.341-1.452v-.132c0-.55733.1136-1.045.341-1.463.2273-.418.5426-.74067.946-.968.4033-.23467.8653-.352 1.386-.352.506 0 .9533.11 1.342.33.3886.21267.693.52067.913.924s.33.87633.33 1.419v.396h-4.389c.022.57933.209 1.034.561 1.364.352.32267.792.484 1.32.484.462 0 .8176-.10633 1.067-.319.2493-.21267.44-.46567.572-.759l.748.363c-.11.22733-.264.45467-.462.682-.1907.22733-.4437.418-.759.572-.308.154-.704.231-1.188.231zm-1.848-3.333h3.498c-.0294-.49867-.2017-.88733-.517-1.166-.308-.27867-.704-.418-1.188-.418-.4914 0-.8947.13933-1.21.418-.3154.27867-.5097.66733-.583 1.166z"/><path d="m48.2828 8.154c-.462 0-.8873-.11-1.276-.33-.3886-.22-.6966-.539-.924-.957-.2273-.418-.341-.913-.341-1.485v-.143c0-.572.1137-1.06333.341-1.474.2274-.418.5317-.737.913-.957.3887-.22733.8177-.341 1.287-.341.374 0 .6894.05133.946.154.264.09533.4767.22.638.374.1614.14667.286.30433.374.473h.154v-3.168h.869v7.7h-.847v-.891h-.154c-.1466.27133-.374.51333-.682.726s-.7406.319-1.298.319zm.231-.77c.5574 0 1.0084-.176 1.353-.528.352-.35933.528-.858.528-1.496v-.099c0-.638-.176-1.133-.528-1.485-.3446-.35933-.7956-.539-1.353-.539-.55 0-1.0046.17967-1.364.539-.352.352-.528.847-.528 1.485v.099c0 .638.176 1.13667.528 1.496.3594.352.814.528 1.364.528z"/><path d="m58.8911 8.154c-.5573 0-.9936-.10633-1.309-.319-.308-.21267-.5316-.45467-.671-.726h-.154v.891h-.847v-7.7h.869v3.168h.154c.088-.16867.2127-.32633.374-.473.1614-.154.3704-.27867.627-.374.264-.10267.583-.154.957-.154.4694 0 .8947.11367 1.276.341.3887.22.6967.539.924.957.2274.41067.341.902.341 1.474v.143c0 .572-.1173 1.067-.352 1.485-.2273.418-.5353.737-.924.957-.3813.22-.803.33-1.265.33zm-.231-.77c.5574 0 1.0084-.176 1.353-.528.352-.35933.528-.858.528-1.496v-.099c0-.638-.176-1.133-.528-1.485-.3446-.35933-.7956-.539-1.353-.539-.55 0-1.0046.17967-1.364.539-.352.352-.528.847-.528 1.485v.099c0 .638.176 1.13667.528 1.496.3594.352.814.528 1.364.528z"/><path d="m63.6382 10.2v-.77h3.08c.2127 0 .319-.11.319-.33v-1.958h-.154c-.0733.154-.187.308-.341.462-.1466.14667-.341.26767-.583.363-.242.088-.5463.132-.913.132-.3886 0-.748-.08433-1.078-.253-.3226-.16867-.5793-.418-.77-.748-.1833-.33-.275-.73333-.275-1.21v-3.267h.869v3.201c0 .528.132.913.396 1.155.2714.242.6344.363 1.089.363.5134 0 .935-.16867 1.265-.506s.495-.83967.495-1.507v-2.706h.869v6.633c0 .29333-.0843.52433-.253.693-.1613.1687-.3996.253-.715.253z"/><path d="m75.2998 8.154c-.9167 0-1.6464-.264-2.189-.792-.5427-.53533-.814-1.31267-.814-2.332v-1.76c0-1.01933.2713-1.793.814-2.321.5426-.535333 1.2723-.803 2.189-.803.9093 0 1.606.253 2.09.759.4913.506.737 1.199.737 2.079v.055h-.913v-.088c0-.57933-.1577-1.05233-.473-1.419-.308-.374-.7884-.561-1.441-.561-.6527 0-1.1624.20167-1.529.605-.3667.396-.55.95333-.55 1.672v1.804c0 .71867.1833 1.27967.55 1.683.3666.396.8763.594 1.529.594.6526 0 1.133-.18333 1.441-.55.3153-.374.473-.85067.473-1.43v-.176h.913v.143c0 .88-.2457 1.573-.737 2.079-.484.506-1.1807.759-2.09.759z"/><path d="m82.0934 8.154c-.5427 0-1.023-.11367-1.441-.341-.4107-.22733-.7333-.54633-.968-.957-.2273-.418-.341-.90933-.341-1.474v-.143c0-.55733.1137-1.045.341-1.463.2347-.418.5573-.74067.968-.968.418-.22733.8983-.341 1.441-.341s1.0193.11367 1.43.341c.418.22733.7407.55.968.968.2347.418.352.90567.352 1.463v.143c0 .56467-.1173 1.056-.352 1.474-.2273.41067-.55.72967-.968.957-.4107.22733-.8873.341-1.43.341zm0-.781c.572 0 1.0267-.17967 1.364-.539.3447-.36667.517-.858.517-1.474v-.099c0-.616-.1723-1.10367-.517-1.463-.3373-.36667-.792-.55-1.364-.55-.5647 0-1.0193.18333-1.364.55-.3447.35933-.517.847-.517 1.463v.099c0 .616.1723 1.10733.517 1.474.3447.35933.7993.539 1.364.539z"/><path d="m88.5742 8.154c-.6673 0-1.232-.154-1.694-.462-.4547-.308-.7297-.79567-.825-1.463l.825-.187c.0587.352.1687.63067.33.836.1613.198.3593.341.594.429.242.08067.4987.121.77.121.4033 0 .7223-.08067.957-.242s.352-.37767.352-.649c0-.27867-.1137-.473-.341-.583-.22-.11733-.5243-.21267-.913-.286l-.451-.077c-.3447-.05867-.66-.15033-.946-.275s-.5133-.29333-.682-.506-.253-.48033-.253-.803c0-.484.187-.86167.561-1.133s.869-.407 1.485-.407c.6087 0 1.1.13933 1.474.418.3813.27133.627.65633.737 1.155l-.814.209c-.066-.38867-.2237-.66-.473-.814-.2493-.16133-.5573-.242-.924-.242s-.6563.06967-.869.209c-.2127.132-.319.33-.319.594 0 .25667.099.44733.297.572.2053.11733.4767.20533.814.264l.451.077c.3813.066.7223.15767 1.023.275.308.11.55.27133.726.484.1833.21267.275.49133.275.836 0 .528-.198.935-.594 1.221-.3887.286-.913.429-1.573.429z"/><path d="m92.208 8v-5.379h.847v.671h.154c.1026-.19067.2713-.36667.506-.528.2346-.16133.5646-.242.99-.242.418 0 .7553.09167 1.012.275.264.18333.4546.407.572.671h.154c.1246-.264.3116-.48767.561-.671.2566-.18333.6123-.275 1.067-.275.3593 0 .6746.07333.946.22.2713.14667.484.35933.638.638.1613.27133.242.59767.242.979v3.641h-.869v-3.564c0-.35933-.1064-.64167-.319-.847-.2054-.21267-.495-.319-.869-.319-.396 0-.7224.12833-.979.385-.2494.25667-.374.627-.374 1.111v3.234h-.869v-3.564c0-.35933-.1064-.64167-.319-.847-.2054-.21267-.495-.319-.869-.319-.396 0-.7224.12833-.979.385-.2494.25667-.374.627-.374 1.111v3.234z"/><path d="m104.158 8.154c-.543 0-1.023-.11367-1.441-.341-.411-.22733-.733-.54633-.968-.957-.227-.418-.341-.90933-.341-1.474v-.143c0-.55733.114-1.045.341-1.463.235-.418.557-.74067.968-.968.418-.22733.898-.341 1.441-.341s1.019.11367 1.43.341c.418.22733.741.55.968.968.235.418.352.90567.352 1.463v.143c0 .56467-.117 1.056-.352 1.474-.227.41067-.55.72967-.968.957-.411.22733-.887.341-1.43.341zm0-.781c.572 0 1.027-.17967 1.364-.539.345-.36667.517-.858.517-1.474v-.099c0-.616-.172-1.10367-.517-1.463-.337-.36667-.792-.55-1.364-.55-.565 0-1.019.18333-1.364.55-.345.35933-.517.847-.517 1.463v.099c0 .616.172 1.10733.517 1.474.345.35933.799.539 1.364.539z"/><path d="m108.208 5.338v-.154c0-.56467.113-1.04867.341-1.452.227-.40333.535-.715.924-.935.388-.22.814-.33 1.276-.33.564 0 .997.11 1.298.33.308.21267.535.451.682.715h.154v-.891h.825v6.633c0 .29333-.081.52433-.242.693-.162.1687-.396.253-.704.253h-3.652v-.77h3.421c.22 0 .33-.11.33-.33v-2.046h-.154c-.088.16133-.213.319-.374.473-.162.154-.371.28233-.627.385-.257.09533-.576.143-.957.143-.462 0-.888-.11-1.276-.33-.389-.22-.697-.53167-.924-.935-.228-.41067-.341-.89467-.341-1.452zm2.772 1.947c.557 0 1.008-.176 1.353-.528.352-.352.528-.836.528-1.452v-.088c0-.62333-.176-1.10733-.528-1.452-.345-.352-.796-.528-1.353-.528-.55 0-1.005.176-1.364.528-.352.34467-.528.82867-.528 1.452v.088c0 .616.176 1.1.528 1.452.359.352.814.528 1.364.528z"/><path d="m115.529 8v-5.379h.847v.66h.154c.096-.23467.242-.407.44-.517s.459-.165.781-.165h.638v.792h-.693c-.388 0-.704.11-.946.33-.234.21267-.352.54633-.352 1.001v3.278z"/><path d="m121.143 8.154c-.374 0-.715-.066-1.023-.198s-.55-.32267-.726-.572-.264-.55367-.264-.913c0-.36667.088-.66733.264-.902.176-.242.418-.42167.726-.539.308-.12467.653-.187 1.034-.187h1.815v-.396c0-.38133-.114-.682-.341-.902-.22-.22-.55-.33-.99-.33-.433 0-.77.10633-1.012.319-.242.20533-.407.484-.495.836l-.814-.264c.088-.30067.227-.572.418-.814.191-.24933.444-.44733.759-.594.323-.154.708-.231 1.155-.231.689 0 1.225.17967 1.606.539.381.352.572.85067.572 1.496v2.431c0 .22.103.33.308.33h.495v.737h-.759c-.242 0-.436-.066-.583-.198-.147-.13933-.22-.32267-.22-.55v-.055h-.132c-.081.13933-.191.286-.33.44-.132.14667-.315.26767-.55.363-.235.10267-.539.154-.913.154zm.099-.748c.513 0 .928-.15033 1.243-.451.323-.308.484-.737.484-1.287v-.121h-1.782c-.345 0-.631.077-.858.231-.22.14667-.33.37033-.33.671s.114.53533.341.704c.235.16867.535.253.902.253z"/><path d="m125.82 10.2v-7.579h.847v.891h.154c.14-.27133.363-.51333.671-.726.316-.21267.752-.319 1.309-.319.462 0 .884.11367 1.265.341.389.22.697.53533.924.946.235.41067.352.90567.352 1.485v.143c0 .572-.113 1.067-.341 1.485-.227.418-.535.737-.924.957-.381.22-.806.33-1.276.33-.374 0-.693-.05133-.957-.154-.256-.09533-.465-.22-.627-.374-.161-.154-.286-.31167-.374-.473h-.154v3.047zm2.75-2.816c.558 0 1.009-.176 1.353-.528.352-.35933.528-.858.528-1.496v-.099c0-.638-.176-1.133-.528-1.485-.344-.35933-.795-.539-1.353-.539-.55 0-1.004.17967-1.364.539-.352.352-.528.847-.528 1.485v.099c0 .638.176 1.13667.528 1.496.36.352.814.528 1.364.528z"/><path d="m132.899 8v-7.7h.869v3.179h.154c.074-.16133.184-.31167.33-.451.154-.14667.349-.26767.583-.363.242-.09533.547-.143.913-.143.404 0 .763.088 1.078.264.323.16867.58.418.77.748.191.32267.286.726.286 1.21v3.256h-.869v-3.19c0-.53533-.135-.924-.407-1.166-.264-.242-.623-.363-1.078-.363-.52 0-.946.16867-1.276.506-.322.33733-.484.83967-.484 1.507v2.706z"/><path d="m140.118 8.154c-.212 0-.392-.06967-.539-.209-.139-.13933-.209-.319-.209-.539s.07-.39967.209-.539c.147-.13933.327-.209.539-.209.22 0 .4.06967.539.209.14.13933.209.319.209.539s-.069.39967-.209.539c-.139.13933-.319.209-.539.209z"/><path d="m144.078 8.154c-.374 0-.715-.066-1.023-.198s-.55-.32267-.726-.572-.264-.55367-.264-.913c0-.36667.088-.66733.264-.902.176-.242.418-.42167.726-.539.308-.12467.652-.187 1.034-.187h1.815v-.396c0-.38133-.114-.682-.341-.902-.22-.22-.55-.33-.99-.33-.433 0-.77.10633-1.012.319-.242.20533-.407.484-.495.836l-.814-.264c.088-.30067.227-.572.418-.814.19-.24933.443-.44733.759-.594.322-.154.707-.231 1.155-.231.689 0 1.224.17967 1.606.539.381.352.572.85067.572 1.496v2.431c0 .22.102.33.308.33h.495v.737h-.759c-.242 0-.437-.066-.583-.198-.147-.13933-.22-.32267-.22-.55v-.055h-.132c-.081.13933-.191.286-.33.44-.132.14667-.316.26767-.55.363-.235.10267-.539.154-.913.154zm.099-.748c.513 0 .927-.15033 1.243-.451.322-.308.484-.737.484-1.287v-.121h-1.782c-.345 0-.631.077-.858.231-.22.14667-.33.37033-.33.671s.113.53533.341.704c.234.16867.535.253.902.253z"/><path d="m148.755 10.2v-7.579h.847v.891h.154c.139-.27133.363-.51333.671-.726.315-.21267.752-.319 1.309-.319.462 0 .884.11367 1.265.341.389.22.697.53533.924.946.235.41067.352.90567.352 1.485v.143c0 .572-.114 1.067-.341 1.485s-.535.737-.924.957c-.381.22-.807.33-1.276.33-.374 0-.693-.05133-.957-.154-.257-.09533-.466-.22-.627-.374s-.286-.31167-.374-.473h-.154v3.047zm2.75-2.816c.557 0 1.008-.176 1.353-.528.352-.35933.528-.858.528-1.496v-.099c0-.638-.176-1.133-.528-1.485-.345-.35933-.796-.539-1.353-.539-.55 0-1.005.17967-1.364.539-.352.352-.528.847-.528 1.485v.099c0 .638.176 1.13667.528 1.496.359.352.814.528 1.364.528z"/><path d="m155.834 10.2v-7.579h.847v.891h.154c.139-.27133.363-.51333.671-.726.315-.21267.752-.319 1.309-.319.462 0 .884.11367 1.265.341.389.22.697.53533.924.946.235.41067.352.90567.352 1.485v.143c0 .572-.114 1.067-.341 1.485s-.535.737-.924.957c-.381.22-.807.33-1.276.33-.374 0-.693-.05133-.957-.154-.257-.09533-.466-.22-.627-.374s-.286-.31167-.374-.473h-.154v3.047zm2.75-2.816c.557 0 1.008-.176 1.353-.528.352-.35933.528-.858.528-1.496v-.099c0-.638-.176-1.133-.528-1.485-.345-.35933-.796-.539-1.353-.539-.55 0-1.005.17967-1.364.539-.352.352-.528.847-.528 1.485v.099c0 .638.176 1.13667.528 1.496.359.352.814.528 1.364.528z"/><path d="m71.6368 9.375h90.3682v.55h-90.3682z"/></g></svg>',"image/svg+xml").firstChild;null==(e=this._attributionDivElement)||e.appendChild(t),this._containerElement.appendChild(this._attributionDivElement)}_addMessageElement(){this._messageDivElement=document.createElement("div"),this._messageDivElement.classList.add("style_module_message__8ee622df"),this._containerElement.appendChild(this._messageDivElement),this._updateMessage("🚀 Initializing Cosmograph...")}async _initializeCosmos(){const{_config:e}=this;this._cosmos&&(this._cosmos.destroy(),this._cosmosInitialized=!1),this._pointsHaveLayout=await(async(e,t,n)=>{if(!(null==n?void 0:n.pointXBy)||!(null==n?void 0:n.pointYBy))return!1;const i=await xF(e,t);return i.includes(n.pointXBy)&&i.includes(n.pointYBy)})(this._dbCoordinator,this.pointsTableName,e),this._enableSimulation=e.enableSimulation??(!!e.links||!this._pointsHaveLayout),this._configManager.cosmosConfig.enableSimulation=this._enableSimulation,this._cosmos=new Mh(this._cosmosElement,this._configManager.cosmosConfig),this._cosmosInitialized=!0}_ensureAlive(){return!this._isDestroyed&&!!this._containerElement.isConnected}_updateMessage(e,t){if(!this._messageDivElement)return;const n=this._configManager.config.statusIndicatorMode??"spinner";if(!1===n||"spinner"===n&&t||null===e)this._messageDivElement.style.display="none";else if(this._messageDivElement.style.display="block","spinner"===n){const t=e.startsWith("🚨");if(this._messageDivElement.classList.toggle($z,t),t){if(this._messageDivElement.innerText!==e||this._messageDivElement.querySelector(`.${Vz}`)){this._messageDivElement.innerHTML="";const t=document.createElement("div");t.classList.add("style_module_messagePre__8ee622df"),t.innerText=e,this._messageDivElement.appendChild(t)}}else if(!this._messageDivElement.querySelector(`.${Vz}`)){this._messageDivElement.innerHTML="";const e=document.createElement("div");e.classList.add(Vz),this._messageDivElement.appendChild(e)}}else this._messageDivElement.classList.remove($z),(this._messageDivElement.textContent!==e||this._messageDivElement.querySelector(`.${Vz}`))&&(this._messageDivElement.innerHTML="",this._messageDivElement.innerText=e)}async _updateSummary(){this._dbCoordinator&&(this._summary={pointsSummary:await vF(this._dbCoordinator,this.pointsTableName),linksSummary:this._config.links?await vF(this._dbCoordinator,this.linksTableName):void 0})}_updateStats(){var e,t;const{pointsSummary:n,linksSummary:i}=this._summary;this._stats={pointsCount:(null==(e=this._cosmos)?void 0:e.graph.pointsNumber)??0,linksCount:(null==(t=this._cosmos)?void 0:t.graph.linksNumber)??0,pointsSummary:n,linksSummary:i}}async _dbReady(){return this._dbReadinessPromise?await this._dbReadinessPromise:new Promise((e,t)=>{const n=setTimeout(()=>{t(new Error("Cosmograph: Database initialization timeout"))},3e4),i=()=>{this._dbReadinessPromise?(clearTimeout(n),this._dbReadinessPromise.then(e).catch(t)):setTimeout(i,10)};i()})}async dataUploaded(){return await this._dataManager.dataReady()}get _config(){return this._configManager.config}get stats(){return this._stats}get crossfilter(){return this._crossfilter.filtered}get maxPointSize(){var e;return(null==(e=this._cosmos)?void 0:e.maxPointSize)??0}get progress(){var e;return null==(e=this._cosmos)?void 0:e.progress}get isSimulationRunning(){var e;return null==(e=this._cosmos)?void 0:e.isSimulationRunning}get isSimulationAvailable(){return this._enableSimulation}get pointDegrees(){var e;return null==(e=this._cosmos)?void 0:e.graph.degree}get pointDirections(){var e,t;return null==(t=null==(e=this._cosmos)?void 0:e.graph.inDegree)?void 0:t.map((e,t)=>{var n,i;const o=null==(i=null==(n=this._cosmos)?void 0:n.graph.outDegree)?void 0:i[t],r=null!==e&&0!==e,s=null!==o&&0!==o;return r&&s?1:s?0:r?2:3})}get rescaleXFn(){var e;return null==(e=this._cosmos)?void 0:e.getScaleX()}get rescaleYFn(){var e;return null==(e=this._cosmos)?void 0:e.getScaleY()}get focusedPointIndex(){return this._config.focusedPointIndex??this._focusedPointIndex}get clusterMapping(){return this._configManager.clusterMapping}get activePointColorStrategy(){return this._configManager.activePointColorStrategy}get activePointSizeStrategy(){return this._configManager.activePointSizeStrategy}get activeLinkColorStrategy(){return this._configManager.activeLinkColorStrategy}get activeLinkWidthStrategy(){return this._configManager.activeLinkWidthStrategy}get linksTableName(){var e;return(null==(e=this._dbCoordinator)?void 0:e.internalDB)||"string"!=typeof this._config.links?qI.Links:this._config.links}get pointsTableName(){var e;return(null==(e=this._dbCoordinator)?void 0:e.internalDB)||"string"!=typeof this._config.points?qI.Points:this._config.points}async getConfig(){return await this._configManager.configUpdated(),this._configManager.config}async getActivePointColorFn(){return await this._configManager.configUpdated(),this._configManager.activePointColorFn}async getActivePointSizeFn(){return await this._configManager.configUpdated(),this._configManager.activePointSizeFn}async getActiveLinkColorFn(){return await this._configManager.configUpdated(),this._configManager.activeLinkColorFn}async getActiveLinkWidthFn(){return await this._configManager.configUpdated(),this._configManager.activeLinkWidthFn}setConfig(e){return this._configManager.setConfig(e),this._configManager.configUpdated()}captureScreenshot(e="cosmograph-screenshot.png"){var t;const n=null==(t=this._cosmosElement)?void 0:t.querySelector("canvas");if(!n)return;const i=document.createElement("a");i.download=e,i.href=n.toDataURL("image/png"),i.click()}getPointPositions(){var e;return null==(e=this._cosmos)?void 0:e.getPointPositions()}getClusterPositions(){var e;return null==(e=this._cosmos)?void 0:e.getClusterPositions()}getPointColors(){var e,t;return null==(t=null==(e=this._cosmos)?void 0:e.getPointColors)?void 0:t.call(e)}getPointSizes(){var e,t;return null==(t=null==(e=this._cosmos)?void 0:e.getPointSizes)?void 0:t.call(e)}getLinkColors(){var e,t;return null==(t=null==(e=this._cosmos)?void 0:e.getLinkColors)?void 0:t.call(e)}getLinkWidths(){var e,t;return null==(t=null==(e=this._cosmos)?void 0:e.getLinkWidths)?void 0:t.call(e)}setPointShapes(e){var t;null==(t=this._cosmos)||t.setPointShapes(new Float32Array(e))}setPointImageIndices(e){var t;null==(t=this._cosmos)||t.setPointImageIndices(new Float32Array(e))}setPointImageSizes(e){var t;null==(t=this._cosmos)||t.setPointImageSizes(new Float32Array(e))}setImageData(e){var t;null==(t=this._cosmos)||t.setImageData([e])}getPointPositionByIndex(e){var t;const n=null==(t=this._cosmos)?void 0:t.getPointPositions();if(!n||!n.length)return;const i=n[2*e],o=n[2*e+1];return null==i||null==o?void 0:[i,o]}activateRectSelection(){this._rectangularSelection.enable(),this._polygonalSelection.disable()}deactivateRectSelection(){this._rectangularSelection.disable()}activatePolygonalSelection(){this._polygonalSelection.enable(),this._rectangularSelection.disable()}deactivatePolygonalSelection(){this._polygonalSelection.disable()}getSelectedPointIndices(){var e;return(null==(e=this._cosmos)?void 0:e.getSelectedIndices())??void 0}getSelectedLinkIndices(){var e,t;const n=null==(e=this._cosmos)?void 0:e.getSelectedIndices();if(!n||0===n.length)return;const i=null==(t=this._cosmos)?void 0:t.graph.sourceIndexToTargetIndices;if(!i)return;const o=new Set(n),r=new Set;for(let s=0;s<n.length;s++){const e=i[n[s]];if(e)for(let t=0;t<e.length;t++){const[n,i]=e[t];o.has(n)&&r.add(i)}}return r.size?Array.from(r):void 0}selectPointsInRect(e,t=!1){if(!this._cosmos||!e)return;const n=this._cosmos.getPointsInRect(e);this.selectPoints(Array.from(n),t)}selectPointsInPolygon(e,t=!1){if(!this._cosmos||!e.length)return;const n=this._cosmos.getPointsInPolygon(e);this.selectPoints(Array.from(n),t)}unselectPointsInRect(e){if(!this._cosmos||!e)return;const t=this._cosmos.getPointsInRect(e);this.unselectPointsByIndices(Array.from(t))}unselectPointsInPolygon(e){if(!this._cosmos||!e.length)return;const t=this._cosmos.getPointsInPolygon(e);this.unselectPointsByIndices(Array.from(t))}selectPoints(e,t=!1){var n,i;this._cosmos&&((null==e?void 0:e.length)?(t&&(e=[...this._cosmos.getSelectedIndices()||[],...e]),null==(n=this._pointSelectionClient)||n.selectPoints(e)):null==(i=this._pointSelectionClient)||i.selectPoints(void 0))}selectPoint(e,t=!1,n=!0===this._config.selectPointOnClick){var i,o;if(this._cosmos&&(void 0!==e||!t))if(void 0!==e){let o=[e];if(t&&(o=[...this._cosmos.getSelectedIndices()||[],e]),n){const t=this._cosmos.getAdjacentIndices(e);o=[...o,...t]}null==(i=this._pointSelectionClient)||i.selectPoints(o)}else this._config.resetSelectionOnEmptyCanvasClick&&(null==(o=this._pointSelectionClient)||o.selectPoints(void 0))}unselectPoint(e,t=!0===this._config.selectPointOnClick){var n;if(!this._cosmos||void 0===e)return;const i=this._cosmos.getSelectedIndices()||[];if(0===i.length||!i.includes(e))return;let o=i.filter(t=>t!==e);if(t){const t=this._cosmos.getAdjacentIndices(e);o=o.filter(e=>!t.includes(e))}this._focusedPointIndex&&!o.includes(this._focusedPointIndex)&&this.setFocusedPoint(void 0),null==(n=this._pointSelectionClient)||n.selectPoints(o.length?o:void 0)}unselectPointsByIndices(e){var t;if(!this._cosmos)return;const n=this._cosmos.getSelectedIndices()||[];if(0===n.length)return;const i=n.filter(t=>!e.includes(t));this._focusedPointIndex&&!i.includes(this._focusedPointIndex)&&this.setFocusedPoint(void 0),null==(t=this._pointSelectionClient)||t.selectPoints(i.length?i:void 0)}unselectAllPoints(){var e;this._cosmos&&(this.focusedPointIndex&&this.setFocusedPoint(void 0),null==(e=this._pointSelectionClient)||e.selectPoints(void 0),this._internalApi.dispatchEvent(new CustomEvent("resetSelections")))}setFocusedPoint(e){var t,n;this._focusedPointIndex=this._config.focusedPointIndex??e,this._cosmos&&!this._config.focusedPointIndex&&(null==(t=this._cosmos)||t.setConfig({focusedPointIndex:this._focusedPointIndex}),null==(n=this._labels)||n.render())}setPinnedPoints(e){var t;null==(t=this._cosmos)||t.setPinnedPoints(e)}start(e){var t;!1!==this._enableSimulation&&this._cosmos&&(null==(t=this._cosmos)||t.start(e),this._internalApi.dispatchEvent(new CustomEvent("onSimulationStart")))}pause(){var e;!1!==this._enableSimulation&&this._cosmos&&(null==(e=this._cosmos)||e.pause(),this._internalApi.dispatchEvent(new CustomEvent("onSimulationPause")))}unpause(){var e;!1!==this._enableSimulation&&this._cosmos&&(null==(e=this._cosmos)||e.unpause(),this._internalApi.dispatchEvent(new CustomEvent("onSimulationStart")))}restart(){this.unpause()}stop(){var e;!1!==this._enableSimulation&&this._cosmos&&(null==(e=this._cosmos)||e.stop(),this._internalApi.dispatchEvent(new CustomEvent("onSimulationPause")))}step(){var e;null==(e=this._cosmos)||e.step()}setZoomLevel(e,t=0){var n;null==(n=this._cosmos)||n.setZoomLevel(e,t)}getZoomLevel(){var e;return null==(e=this._cosmos)?void 0:e.getZoomLevel()}zoomToPoint(e,t=this._config.fitViewDuration,n,i){var o;null==(o=this._cosmos)||o.zoomToPointByIndex(e,t,n,i)}fitView(e=this._config.fitViewDuration,t=this._config.fitViewPadding){var n;null==(n=this._cosmos)||n.fitView(e,t)}fitViewByIndices(e,t=this._config.fitViewDuration,n=this._config.fitViewPadding){var i;null==(i=this._cosmos)||i.fitViewByPointIndices(e,t,n)}fitViewByCoordinates(e,t=this._config.fitViewDuration,n=this._config.fitViewPadding){var i;null==(i=this._cosmos)||i.fitViewByPointPositions(e,t,n)}getConnectedPointIndices(e){var t;return null==(t=this._cosmos)?void 0:t.getAdjacentIndices(e)}getPointDegrees(e){var t,n;if(this._cosmos)return{inDegree:(null==(t=this._cosmos.graph.inDegree)?void 0:t[e])??0,outDegree:(null==(n=this._cosmos.graph.outDegree)?void 0:n[e])??0}}spaceToScreenPosition(e){var t;return null==(t=this._cosmos)?void 0:t.spaceToScreenPosition(e)}screenToSpacePosition(e){var t;return null==(t=this._cosmos)?void 0:t.spaceToScreenPosition(e)}spaceToScreenRadius(e){var t;return null==(t=this._cosmos)?void 0:t.spaceToScreenRadius(e)}getPointRadiusByIndex(e){var t;return null==(t=this._cosmos)?void 0:t.getPointRadiusByIndex(e)}getPointScreenRadiusByIndex(e){var t,n;const i=(null==(t=this._cosmos)?void 0:t.config.pointSizeScale)??1,o=null==(n=this._cosmos)?void 0:n.getPointRadiusByIndex(e);if(!o)return 0;const r=o*i,{scalePointsOnZoom:s}=this._config,a=this.getZoomLevel(),l=this.maxPointSize;return s?Math.min(r*a,l):r}trackPointPositionsByIndices(e){var t;null==(t=this._cosmos)||t.trackPointPositionsByIndices(e)}getTrackedPointPositionsArray(){var e,t;return null==(t=null==(e=this._cosmos)?void 0:e.getTrackedPointPositionsArray)?void 0:t.call(e)}getTrackedPointPositionsMap(){var e,t;return null==(t=null==(e=this._cosmos)?void 0:e.getTrackedPointPositionsMap)?void 0:t.call(e)}getSampledPoints(){var e,t;return null==(t=null==(e=this._cosmos)?void 0:e.getSampledPoints)?void 0:t.call(e)}getSampledPointPositionsMap(){var e;if(this._cosmosInitialized)return null==(e=this._cosmos)?void 0:e.getSampledPointPositionsMap()}getActiveSelectionSourceId(){const e=this._crossfilter.pointsSelection.active,t=null==e?void 0:e.source;return null==t?void 0:t.id}get pointsSelection(){return this._crossfilter.pointsSelection}get linksSelection(){return this._crossfilter.linksSelection}async getPointIndicesByIds(e){if(this._dbCoordinator&&this.stats.pointsCount&&e.length)return await kF(this._dbCoordinator,this.pointsTableName,this._config,e)}async getPointIdsByIndices(e){if(this._dbCoordinator&&this.stats.pointsCount&&e.length)return await LF(this._dbCoordinator,this.pointsTableName,this._config,e)}async getPointsByIndices(e){if(this._dbCoordinator&&this.stats.pointsCount&&e.length)return await(async(e,t,n,i)=>{const o=i.join(", ");return await e.query(`SELECT * FROM ${t} WHERE "${n}" IN (${o})`)})(this._dbCoordinator,this.pointsTableName,this._config.pointIndexBy,e)}async getPointIndicesByExactValues(e,t){if(this._dbCoordinator&&this.stats.pointsCount)return t.length?await(async(e,t,n,i,o)=>{var r;const s=o.map(e=>"string"==typeof e?`${hI(e)}`:e),a=`SELECT "${n.pointIndexBy}" FROM ${t} WHERE "${i}" IN (${s.join(", ")})`,l=await e.query(a);return l?(null==(r=l.getChildAt(0))?void 0:r.toArray())??[]:void 0})(this._dbCoordinator,this.pointsTableName,this._config,e,t):[]}async getPointIndicesByNumericValue(e,t,n){if(this._dbCoordinator&&this.stats.pointsCount)return t?await(async(e,t,n,i,o,r)=>{var s;const a=r?">=":"<=",l=`SELECT "${n.pointIndexBy}" FROM ${t} WHERE "${i}" ${a} ${o}`,c=await e.query(l);if(c)return(null==(s=c.getChildAt(0))?void 0:s.toArray())??[]})(this._dbCoordinator,this.pointsTableName,this._config,e,t,n):[]}async getPointIndicesByLinksExactValues(e,t){if(this._dbCoordinator&&this.stats.linksCount)return t.length?await(async(e,t,n,i,o)=>{const r=o.map(e=>"string"==typeof e?`${hI(e)}`:e),s=`SELECT "${n.linkSourceIndexBy}", "${n.linkTargetIndexBy}" FROM ${t} WHERE "${i}" IN (${r.join(", ")})`;return PF(e,s)})(this._dbCoordinator,this.linksTableName,this._config,e,t):[]}async getPointIndicesByLinksNumericValue(e,t,n){if(this._dbCoordinator&&this.stats.linksCount)return t?await(async(e,t,n,i,o,r)=>{const s=r?">=":"<=",a=`SELECT "${n.linkSourceIndexBy}", "${n.linkTargetIndexBy}" FROM ${t} WHERE "${i}" ${s} ${o}`;return PF(e,a)})(this._dbCoordinator,this.linksTableName,this._config,e,t,n):[]}async getLinksByPointIds(e){if(this._dbCoordinator&&this.stats.linksCount&&e.length)return await(async(e,t,n,i)=>{const o=i.map(e=>"string"==typeof e?`${hI(e)}`:e);return await e.query(`SELECT * FROM ${t} WHERE "${n.linkSourceBy}" IN (${o}) OR "${n.linkTargetBy}" IN (${o})`)})(this._dbCoordinator,this.pointsTableName,this._config,e)}async getLinksByPointIndices(e){if(this._dbCoordinator&&this.stats.linksCount&&e.length)return await(async(e,t,n,i)=>{const o=i.join(", ");return await e.query(`SELECT * FROM ${t} WHERE "${n.linkSourceIndexBy}" IN (${o}) OR "${n.linkTargetIndexBy}" IN (${o})`)})(this._dbCoordinator,this.pointsTableName,this._config,e)}async getLinksData(){if(this._dbCoordinator&&this.stats.linksCount)return await DF(this._dbCoordinator,this.linksTableName)}async getPointsData(){if(this._dbCoordinator&&this.stats.pointsCount)return await AF(this._dbCoordinator,this.pointsTableName)}convertCosmographDataToObject(e){return lI(e)}flattenPositions(e){var t;return null==(t=this._cosmos)?void 0:t.flatten(e)}pair(e){var t;return null==(t=this._cosmos)?void 0:t.pair(e)}async addPoints(e){await this._dataManager.addPoints(e)}async addLinks(e){await this._dataManager.addLinks(e)}async removePointsByIndices(e,t=!0){await this._dataManager.removePointsByIndices(e,t)}async removePointsByIds(e){await this._dataManager.removePointsByIds(e)}async removeLinksByPointIdPairs(e){await this._dataManager.removeLinksByPointIdPairs(e)}async removeLinksByPointIndicesPairs(e){await this._dataManager.removeLinksByPointIndicesPairs(e)}async addMosaicComponent(e,t,n){if(await this._dataManager.dataReady(),this._ensureAlive()){if(this._mosaicComponentManager)return await this._mosaicComponentManager.addComponent(e,t,n);rI(0,0,"error")}}async removeMosaicComponent(e){return this._mosaicComponentManager?await this._mosaicComponentManager.removeComponent(e):(rI(0,0,"error"),!1)}getMosaicComponents(){var e;return null==(e=this._mosaicComponentManager)?void 0:e.components}async reset(e=!0){var t,n,i,o,r;e&&(this._configManager.resetCosmographConfig(),this._messageDivElement.innerText="👩🏻‍🚀 Cosmograph is ready, load your data!",this._messageDivElement.style.display="block"),null==(t=this._labels)||t.clear(),this._configManager.clearCosmosBuffers(),null==(n=this._cosmos)||n.render(),await this._dropLocalTables(),null==(i=this._dbCoordinator)||i.clearCache(),this._linkAggregationManager.clear(),this._stats={pointsCount:0,linksCount:0,pointsSummary:void 0,linksSummary:void 0},await(null==(o=this._mosaicComponentManager)?void 0:o.destroyAll()),null==(r=this._pointSelectionClient)||r.destroy(),this._pointSelectionClient=void 0,this._internalApi.dispatchEvent(new CustomEvent("reset")),this._internalApi.dispatchEvent(new CustomEvent("dataUploaded"))}async destroy(){var e,t,n,i,o;rI(0,0,"warn"),this._isDestroyed?rI(0,0,"warn"):(this._isDestroyed=!0,this._internalApi.dispatchEvent(new CustomEvent("reset")),null==(e=this._labels)||e.destroy(),null==(t=this._cosmos)||t.destroy(),this._cosmos=void 0,await this._dropLocalTables(),await(null==(n=this._dbCoordinator)?void 0:n.destroy()),this._dbCoordinator=void 0,this._linkAggregationManager.clear(),this._containerElement.innerHTML="",this._rectangularSelection.destroy(),this._polygonalSelection.destroy(),await(null==(i=this._mosaicComponentManager)?void 0:i.destroyAll()),this._mosaicComponentManager=void 0,null==(o=this._pointSelectionClient)||o.destroy(),this._pointSelectionClient=void 0,delete window.cosmographDisableLogging)}}const Gz=cI(),Wz=async(e,t)=>{const n=await e.query(`DESCRIBE ${t}`);return new Map((null==n?void 0:n.toArray().map(e=>[e.column_name,e.column_type]))??[])},jz=(e,t)=>({existing:[...new Set(e.filter(e=>t.has(e.name)).map(e=>e.name))],missing:e.filter(e=>!t.has(e.name))}),Yz=async(e,t)=>{var n,i,o,r;const s=await Wz(e,qI.RawPoints),{missing:a}=jz((e=>{const{pointIdBy:t,linkSourceBy:n,linkTargetsBy:i}=e;return t?[{prop:"pointIdBy",name:t}]:n&&i?[{prop:"linkSourceBy",name:n},...i.map(e=>({prop:"linkTargetBy",name:e}))]:[{prop:"pointIdBy",name:t??"undefined"}]})(t),s);if(a.length>0)return{missingRequiredColumns:a,missingOptionalColumns:[],processedFully:!0,pointsAdded:!1};const{existing:l,missing:c}=jz((e=>{const{pointSizeBy:t,pointColorBy:n,pointClusterBy:i,pointClusterStrengthBy:o,pointLabelBy:r,pointLabelWeightBy:s,pointXBy:a,pointYBy:l,pointIncludeColumns:c=[]}=e;return[...t?[{prop:"pointSizeBy",name:t}]:[],...n?[{prop:"pointColorBy",name:n}]:[],...i?[{prop:"pointClusterBy",name:i}]:[],...o?[{prop:"pointClusterStrengthBy",name:o}]:[],...r?[{prop:"pointLabelBy",name:r}]:[],...s?[{prop:"pointLabelWeightBy",name:s}]:[],...[...new Set(c)].map(e=>({prop:"pointIncludeColumns",name:e})),...a&&l?[{prop:"pointXBy",name:a},{prop:"pointYBy",name:l}]:[]]})(t),s),u=l.filter(e=>e!==XI.Id);if(await e.exec(`\n    BEGIN;\n    DROP SEQUENCE IF EXISTS ${XI.Sequence} CASCADE;\n    CREATE SEQUENCE ${XI.Sequence} MINVALUE 0;\n    CREATE TABLE ${qI.PreparedPoints} (\n      ${XI.Id} VARCHAR,\n      ${XI.Idx} INT DEFAULT nextval('${XI.Sequence}')\n    );\n    COMMIT;\n  `),u.length>0){const t=u.map(e=>`ALTER TABLE ${qI.PreparedPoints} ADD COLUMN IF NOT EXISTS "${e}" ${s.get(e)};`).join("\n");await e.exec(t)}const{pointIdBy:h,linkSourceBy:d,linkTargetsBy:p}=t,f=d&&p?[d,...p]:[h],m=null==(i=null==(n=await e.query(`SELECT COUNT(*) as cnt FROM ${qI.RawPoints}`))?void 0:n.getChild("cnt"))?void 0:i.get(0);let _=!0;if(1===f.length&&m>25e4)try{await(async(e,t,n,i)=>{let o=0;for(;o<i;)await e.exec(`\n      CREATE TEMP TABLE chunk_temp AS \n      SELECT "${t}" AS ${XI.Id}, ${n.map(e=>`"${e}"`).join(", ")}\n      FROM ${qI.RawPoints}\n      WHERE "${t}" IS NOT NULL\n      LIMIT 250000\n    `),await e.exec(`INSERT INTO ${qI.PreparedPoints} (${[`"${XI.Id}"`,...n.map(e=>`"${e}"`)].join(", ")}) SELECT * FROM chunk_temp`),await e.exec(`DELETE FROM ${qI.RawPoints} WHERE "${t}" IN (SELECT ${XI.Id} FROM chunk_temp)`),await e.exec("DROP TABLE chunk_temp"),o+=25e4})(e,f[0],u,m),(null==(r=null==(o=await e.query(`SELECT COUNT(*) as cnt FROM ${qI.RawPoints}`))?void 0:o.getChild("cnt"))?void 0:r.get(0))>0&&(_=!1)}catch(Hn){console.warn("processLargeDatasetInChunks failed:",Hn),_=!1}else{const t=`\n      INSERT INTO ${qI.PreparedPoints} (${[XI.Id,...u].map(e=>`"${e}"`).join(", ")})\n      SELECT DISTINCT ON (${XI.Id}) combined_points.*\n      FROM (\n        ${f.map(e=>`\n          SELECT "${e}" AS ${XI.Id}${u.length>0?`, ${u.map(e=>`"${e}"`).join(", ")}`:""}\n          FROM ${qI.RawPoints}\n          WHERE "${e}" IS NOT NULL\n        `).join(" UNION ALL ")}\n      ) AS combined_points\n    `;await e.exec(t)}return Gz&&await e.logTable(qI.PreparedPoints),{missingRequiredColumns:[],missingOptionalColumns:c,processedFully:_,pointsAdded:!1}},qz=async(e,t)=>{var n;const{linkSourceBy:i=XI.Source,linkTargetsBy:o=[XI.Target],linkIncludeColumns:r=[],linkColorBy:s,linkWidthBy:a,linkArrowBy:l,linkStrengthBy:c}=t;if(!(null==o?void 0:o.length))return{missingRequiredColumns:[],missingOptionalColumns:[],processedFully:!0,pointsAdded:!1};const u=await Wz(e,qI.RawLinks),h=[{prop:"linkSourceBy",name:i},...o.map(e=>({prop:"linkTargetsBy",name:e}))],{missing:d}=jz(h,u);if(d.length>0)return{missingRequiredColumns:d,missingOptionalColumns:[],processedFully:!0,pointsAdded:!1};const p=[...s?[{prop:"linkColorBy",name:s}]:[],...a?[{prop:"linkWidthBy",name:a}]:[],...l?[{prop:"linkArrowBy",name:l}]:[],...c?[{prop:"linkStrengthBy",name:c}]:[],...r.map(e=>({prop:"linkIncludeColumns",name:e}))],{existing:f,missing:m}=jz(p,u),_=[XI.SourceIdx,XI.TargetIdx,XI.Source,XI.Target],g=f.filter(e=>!_.includes(e));if(await e.exec(`\n    CREATE TABLE IF NOT EXISTS ${qI.PreparedLinks} (\n      ${XI.SourceIdx} INTEGER,\n      ${XI.TargetIdx} INTEGER,\n      ${XI.Source} VARCHAR,\n      ${XI.Target} VARCHAR\n    );\n  `.trim()),g.length>0){const t=g.map(e=>`ALTER TABLE ${qI.PreparedLinks} ADD COLUMN IF NOT EXISTS "${e}" ${u.get(e)||"VARCHAR"};`).join("\n");await e.exec(t)}await e.exec(`\n    CREATE TEMP TABLE temp_points AS\n    SELECT ${XI.Id}, ${XI.Idx}\n    FROM ${qI.PreparedPoints}\n  `.trim());let y=!1;if(t.createMissingPoints){const t=[i,...o].map(e=>`\n    SELECT DISTINCT "${e}"::text as ${XI.Id}\n    FROM ${qI.RawLinks}\n    WHERE "${e}" IS NOT NULL\n  `).join(" UNION "),r=await e.query(`\n    SELECT COUNT(*) as cnt\n    FROM (${t}) all_ids\n    WHERE ${XI.Id} NOT IN (SELECT ${XI.Id} FROM temp_points)\n  `.trim()),s=(null==(n=null==r?void 0:r.getChild("cnt"))?void 0:n.get(0))||0;y=s>0,s>0&&(await e.exec(`\n      CREATE TEMP TABLE missing_ids AS\n      SELECT DISTINCT ${XI.Id}\n      FROM (${t}) all_ids\n      WHERE ${XI.Id} NOT IN (SELECT ${XI.Id} FROM temp_points)\n    `.trim()),await e.exec(`\n      CREATE TEMP TABLE missing_ids_with_idx AS\n      SELECT ${XI.Id},\n             ROW_NUMBER() OVER (ORDER BY ${XI.Id}) + (SELECT COALESCE(MAX(${XI.Idx}), 0) FROM ${qI.PreparedPoints}) as ${XI.Idx}\n      FROM missing_ids\n    `.trim()),await e.exec(`\n      INSERT INTO ${qI.PreparedPoints} (${XI.Id}, ${XI.Idx})\n      SELECT ${XI.Id}, ${XI.Idx} FROM missing_ids_with_idx\n    `.trim()),await e.exec("DROP TABLE temp_points"),await e.exec(`\n      CREATE TEMP TABLE temp_points AS\n      SELECT ${XI.Id}, ${XI.Idx}\n      FROM ${qI.PreparedPoints}\n    `.trim()),await e.exec("DROP TABLE missing_ids"),await e.exec("DROP TABLE missing_ids_with_idx"))}const b=[XI.SourceIdx,XI.TargetIdx,XI.Source,XI.Target,...g];for(const v of o){const t=`\n      INSERT INTO ${qI.PreparedLinks} (${b.map(e=>`"${e}"`).join(", ")})\n      SELECT DISTINCT\n        sp.${XI.Idx} AS ${XI.SourceIdx},\n        tp.${XI.Idx} AS ${XI.TargetIdx},\n        d."${i}" AS ${XI.Source},\n        d."${v}" AS ${XI.Target}\n        ${g.length>0?`, ${g.map(e=>`d."${e}"`).join(", ")}`:""}\n      FROM ${qI.RawLinks} d\n      INNER JOIN temp_points sp ON sp.${XI.Id} = d."${i}"::text\n      INNER JOIN temp_points tp ON tp.${XI.Id} = d."${v}"::text\n    `;await e.exec(t.trim())}return await e.exec("DROP TABLE temp_points"),Gz&&await(null==e?void 0:e.logTable(qI.PreparedLinks)),{missingRequiredColumns:[],missingOptionalColumns:m,processedFully:!0,pointsAdded:y}};let Xz,Kz=null;const Zz=async(e,t,n=!1)=>{switch(e){case KI.Parquet:return await Xz.exportTableToPq(t)??new Uint8Array;case KI.Arrow:return n?await Xz.exportTableToArrow(t)??new tT:await Xz.exportTableToArrowBuffer(t)??new Uint8Array;case KI.CSV:return await Xz.exportTableToCSV(t)??new Uint8Array;default:throw new Error(`Unsupported format: ${e}`)}},Qz=async(e,t,n,i,o,r,s,a=!1)=>{const{ok:l,processedFully:c,pointsAdded:u}=await(async(e,t,n,i)=>{try{let o;if(o=Array.isArray(e)?await Xz.uploadObject(e,t):await Xz.uploadData(e,t,!1,i.csvParseTimeFormat,i.csvColumnTypesMap),null==o?void 0:o.error)return rI(o.error,0,"error"),{ok:!1,processedFully:!0,pointsAdded:!1};"pointIdBy"in i&&(void 0!==i.pointIdBy||i.linkSourceBy||i.linkTargetsBy||(rI(0,0,"warn"),await Xz.query(`ALTER TABLE ${t} ADD COLUMN ${XI.Id} INTEGER; UPDATE ${t} SET ${XI.Id} = rowid;`),await Xz.logTable(t),i.pointIdBy=XI.Id));const{missingRequiredColumns:r,missingOptionalColumns:s,processedFully:a,pointsAdded:l}=await n(Xz,i);return r.length>0?(rI(r.map(e=>`'${e.name}' (\`${e.prop}\`)`).join(", "),0,"error"),{ok:!1,processedFully:a,pointsAdded:l??!1}):s.length>0?(rI(s.map(e=>`'${e.name}' (\`${e.prop}\`)`).join(", "),0,"warn"),{ok:!0,processedFully:a,pointsAdded:l??!1}):{ok:!0,processedFully:a,pointsAdded:l??!1}}catch(o){return console.warn(`loadTable: ${o}`),{ok:!1,processedFully:!0,pointsAdded:!1}}})(e,t,i,o);if(!l)return void rI(0,0,"error");await Xz.dropTable(t);const h=await Zz(r,n,a),d=await Xz.query(`SUMMARIZE ${n}`);return h instanceof Uint8Array&&h.length||h instanceof tT&&h.numRows?{data:s(h),summary:null==d?void 0:d.toArray(),processedFully:c,pointsAdded:u}:void rI(h instanceof Uint8Array?h.length:h instanceof tT&&h.numRows,0,"warn")},Jz=async(e,t,n)=>(async e=>Kz||(rI(0,0,"util"),Kz=(async()=>{try{const t=await e();return t&&rI(0,0,"util"),t}catch(t){return void rI(0,0,"error")}finally{Kz=null}})(),Kz))(()=>(async(t,n,i,o,r,s=!1)=>{let a,l;await(async()=>{Xz=await rA.getInstance()})(),await Xz.query(`DROP TABLE IF EXISTS ${qI.PreparedPoints}`),await Xz.query(`DROP TABLE IF EXISTS ${qI.PreparedLinks}`);let c=!0,u=!0;try{if(!t.points||void 0!==t.points.pointIdBy&&(void 0!==t.points.linkSourceBy||void 0!==t.points.linkTargetsBy))return void rI(0,0,"error");const h=await Qz(n,qI.RawPoints,qI.PreparedPoints,Yz,t.points,o,r,s);if(!h)return void rI(0,0,"error");let d=h.data;a=h.summary,c=h.processedFully;const p={...t};let f;if(i&&t.links)if(t.links.linkSourceBy&&t.links.linkTargetsBy)try{const e=await Qz(i,qI.RawLinks,qI.PreparedLinks,qz,t.links,o,r,s);if(e){if(f=e.data,l=e.summary,u=e.processedFully,e.pointsAdded){const e=await Zz(o,qI.PreparedPoints,s),t=await Xz.query(`SUMMARIZE ${qI.PreparedPoints}`);(e instanceof Uint8Array&&e.length||e instanceof tT&&e.numRows)&&(d=r(e),a=null==t?void 0:t.toArray())}}else rI(0,0,"error")}catch(e){rI(0,0,"error")}else rI(0,0,"error");!f&&t.links&&(p.links=void 0,rI(0,0,"warn"));const m=(e=>{const t={...Object.fromEntries(Object.entries(e.points).filter(([e,t])=>"outputFilename"!==e&&"linkTargetsBy"!==e&&"linkSourceBy"!==e&&void 0!==t)),pointIdBy:XI.Id,pointIndexBy:XI.Idx};return e.links?{...t,...Object.fromEntries(Object.entries(e.links).filter(([e,t])=>"linkTargetsBy"!==e&&"outputFilename"!==e&&void 0!==t)),linkSourceBy:XI.Source,linkSourceIndexBy:XI.SourceIdx,linkTargetBy:XI.Target,linkTargetIndexBy:XI.TargetIdx}:t})(p);return{points:d,links:f,pointsSummary:a,linksSummary:l,cosmographConfig:m,pointsProcessedFully:c,linksProcessedFully:u}}catch(e){return void console.warn("_prepareCosmographData:",e)}finally{await Xz.destroy()}})(e,t,n,KI.Arrow,e=>e,!0)),eU={highlightSelectedData:!0,showAnimationControls:!0,useLinksData:!1,useQuantiles:!1};let tU=class extends Pz{constructor(){super(...arguments),s(this,"_dataExtent"),s(this,"_visualExtent")}getCurrentSelection(){if(this.checkReady(()=>this.getCurrentSelection()))return this._uiComponent.getCurrentSelection()}getCurrentSelectionInPixels(){if(this.checkReady(()=>this.getCurrentSelectionInPixels()))return this._uiComponent.getCurrentSelectionInPixels()}getBarWidth(){if(this.checkReady(()=>this.getBarWidth()))return this._uiComponent.getBarWidth()}setSelection(e){var t,n,i;this.checkReady(()=>this.setSelection(e))&&(this._uiComponent.setSelection(e,!0),null==(t=this._client)||t.applyRangeFilter(e),null==(i=(n=this._config).onSelection)||i.call(n,e,!0))}getIsAnimationRunning(){return!!this.checkReady(()=>this.getIsAnimationRunning())&&this._uiComponent.getIsAnimationRunning()}playAnimation(){this.checkReady(()=>this.playAnimation())&&this._uiComponent.playAnimation()}pauseAnimation(){this.checkReady(()=>this.pauseAnimation())&&this._uiComponent.pauseAnimation()}stopAnimation(){this.checkReady(()=>this.stopAnimation())&&this._uiComponent.stopAnimation()}get defaultConfig(){return eU}get accessor(){return this._config.accessor??eU.accessor}async fetchData(){var e,t;if(await super.fetchData(),this._currentData){const n=null==(t=null==(e=this._currentData)?void 0:e.getChild(this.accessor))?void 0:t.toArray(),i=null==n?void 0:n.map(e=>e instanceof Date?e.getTime():e);this._dataExtent=(null==i?void 0:i.length)?_D(i):void 0;const o=IF(i??[],this._config.useQuantiles,this._config.customExtent);this._visualExtent=o,this._uiComponent.setTimeData(n,o),this.updateCrossfilteredData()}else this._uiComponent.setTimeData(void 0),this.updateHighlightedData(void 0);this._uiComponent.pauseAnimation()}createUIComponent(e){return new oB(e,this.createComponentConfig(this._config))}createComponentConfig(e){return{...e,formatter:t=>{const n="number"==typeof t?t:t.getTime(),i=((null==e?void 0:e.formatter)??AO)(n);if(!this._config.useQuantiles||!this._dataExtent||!this._visualExtent)return i;const[o,r]=this._visualExtent,[s,a]=this._dataExtent;return n===o&&o>s?`< ${i}`:n===r&&r<a?`> ${i}`:i},onBrush:(e,t)=>{var n,i,o,r;let s=e;if(e&&this._config.useQuantiles&&this._visualExtent&&this._dataExtent){const t=e.map(e=>e instanceof Date?e.getTime():e),[n,i]=t,[o,r]=this._visualExtent,[a,l]=this._dataExtent,c=n===o?a:n,u=i===r?l:i;s=e[0]instanceof Date?[new Date(c),new Date(u)]:[c,u]}const a=null==(n=this._currentData)?void 0:n.getChild(this.accessor),l=s?dI(null==a?void 0:a.type)?null==s?void 0:s.map(e=>+e):s.map(e=>new Date(e)):void 0;null==(i=this._client)||i.applyRangeFilter(l),null==(r=(o=this._config).onSelection)||r.call(o,s,t)},onBarHover:e=>{var t,n;null==(n=(t=this._config).onBarHover)||n.call(t,e)},onAnimationPlay:(e,t)=>{var n,i;null==(i=(n=this._config).onAnimationPlay)||i.call(n,e,t)},onAnimationPause:(e,t)=>{var n,i;null==(i=(n=this._config).onAnimationPause)||i.call(n,e,t)},onAnimationTick:e=>{var t,n;null==(n=(t=this._config).onAnimationTick)||n.call(t,e)}}}onResetClientSelections(){this.setSelection()}updateHighlightedData(e){const{highlightSelectedData:t}=this._config;t&&this._uiComponent.setHighlightedData(e)}async onConfigUpdate(){this._uiComponent.setConfig(this.createComponentConfig(this._config))}};const nU={highlightSelectedData:!0,useLinksData:!1,useQuantiles:!1};class iU extends Pz{constructor(){super(...arguments),s(this,"_dataExtent"),s(this,"_visualExtent")}getCurrentSelection(){if(this.checkReady(()=>this.getCurrentSelection()))return this._uiComponent.getCurrentSelection()}getCurrentSelectionInPixels(){if(this.checkReady(()=>this.getCurrentSelectionInPixels()))return this._uiComponent.getCurrentSelectionInPixels()}getBarWidth(){if(this.checkReady(()=>this.getBarWidth()))return this._uiComponent.getBarWidth()}setSelection(e){var t,n,i;this.checkReady(()=>this.setSelection(e))&&(this._uiComponent.setSelection(e,!0),null==(t=this._client)||t.applyRangeFilter(e),null==(i=(n=this._config).onSelection)||i.call(n,e,!0))}get defaultConfig(){return nU}get accessor(){return this._config.accessor??nU.accessor}async fetchData(){var e,t;if(await super.fetchData(),this._currentData){const n=null==(t=null==(e=this._currentData)?void 0:e.getChild(this.accessor))?void 0:t.toArray();this._dataExtent=(null==n?void 0:n.length)?_D(n):void 0;const i=IF(n??[],this._config.useQuantiles,this._config.customExtent);this._visualExtent=i,this._uiComponent.setHistogramData(n,i),this.updateCrossfilteredData()}else this._uiComponent.setHistogramData(void 0),this.updateHighlightedData(void 0)}createUIComponent(e){return new xB(e,this.createComponentConfig(this._config))}createComponentConfig(e){return{...e,formatter:t=>{const n=((null==e?void 0:e.formatter)??AO)(t);if(!this._config.useQuantiles||!this._dataExtent||!this._visualExtent)return n;const[i,o]=this._visualExtent,[r,s]=this._dataExtent;return t===i&&i>r?`< ${n}`:t===o&&o<s?`> ${n}`:n},onBrush:(e,t)=>{var n,i,o;let r=e;if(e&&this._config.useQuantiles&&this._visualExtent&&this._dataExtent){const[t,n]=e,[i,o]=this._visualExtent,[s,a]=this._dataExtent;r=[t===i?s:t,n===o?a:n]}null==(n=this._client)||n.applyRangeFilter(r),null==(o=(i=this._config).onSelection)||o.call(i,r,t)},onBarHover:e=>{var t,n;null==(n=(t=this._config).onBarHover)||n.call(t,e)}}}updateHighlightedData(e){const{highlightSelectedData:t}=this._config;t&&this._uiComponent.setHighlightedData(e)}onResetClientSelections(){this.setSelection()}async onConfigUpdate(){this._uiComponent.setConfig(this.createComponentConfig(this._config))}}let oU=(i=class extends Rz{constructor(){super(...arguments),s(this,"selected")}checkCurrentSelection(){this.selected&&this.setSelectedItem(this.selected)}onSelect(e){var t,n,o;this.compareSelectedItem(e)?(null==(t=this._client)||t.resetFilter(),this.onResetClientSelections(),i._activeComponentId=null):(i._activeComponentId!==(null==(n=this._client)?void 0:n.id)&&(this._internalApi.public.unselectAllPoints(),this._internalApi.dispatchEvent(new CustomEvent("resetSelections"))),i._activeComponentId=(null==(o=this._client)?void 0:o.id)||null,this.selected=e,this.setSelectedItem(e),this.accessor&&this.applyFilter(e))}onResetClientSelections(){this.selected=void 0,this.setSelectedItem(void 0)}onDataFiltered(){var e,t;(null==(e=this._client)?void 0:e.id)!==i._activeComponentId&&(this.selected=void 0,this.setSelectedItem(void 0),null==(t=this._client)||t.resetFilter())}},s(i,"_activeComponentId",null),i);const rU={suggestionsLimit:50,placeholderText:"Search...",showAccessorsMenu:!0,suggestionTruncationLength:50,accessor:"id",suggestionFieldsPalette:["#fbb4aebf","#b3cde3bf","#ccebc5bf","#decbe4bf","#fed9a6bf","#ffffccbf","#e5d8bdbf","#fddaecbf"],showFooter:!1};var sU="style_module_searchContainer__1bed75df",aU="style_module_accessorButton__1bed75df",lU="style_module_upwards__1bed75df",cU="style_module_visible__1bed75df",uU="style_module_placeholderInput__1bed75df",hU="style_module_disabled__1bed75df",dU="style_module_separator__1bed75df";Sz(".style_module_searchContainer__1bed75df{align-items:center;display:flex;gap:6px;position:relative;width:100%}.style_module_accessorButton__1bed75df{align-items:center;backdrop-filter:blur(8px);background:var(--cosmograph-search-accessors-background);border-radius:4px;cursor:pointer;display:flex;flex-shrink:0;font-size:13px;font-weight:300;line-height:1;max-width:100px;overflow:hidden;padding:2.5px 5px;text-overflow:ellipsis;white-space:nowrap}.style_module_accessorsMenuPlaceholder__1bed75df{font-size:11.5px;font-weight:600;letter-spacing:.07em;line-height:2;opacity:.9;padding-bottom:0;padding-left:10px;padding-top:4px;pointer-events:none;text-transform:uppercase;user-select:none}.style_module_accessorsMenu__1bed75df{backdrop-filter:blur(8px);background:var(--cosmograph-search-list-background);border-radius:4px;color:#fff;left:0;margin:2px 0 0;min-width:100%;opacity:0;overflow:hidden;padding:0 0 2px;pointer-events:none;position:absolute;right:0;top:100%;transform:translateY(-10px);transition:opacity .2s ease-out,transform .2s ease-out;width:100%}.style_module_accessorsMenu__1bed75df.style_module_upwards__1bed75df{bottom:100%;top:auto;transform:translateY(10px)}.style_module_accessorsMenu__1bed75df.style_module_visible__1bed75df{opacity:1;pointer-events:auto;transform:translateY(0)}.style_module_accessorsMenu__1bed75df.style_module_upwards__1bed75df.style_module_visible__1bed75df{opacity:1;pointer-events:auto;transform:translateY(-7px)}.style_module_accessorsMenu__1bed75df li{cursor:pointer;display:block;font-size:var(--cosmograph-search-list-font-size,13.5px);font-weight:500;line-height:normal;max-width:100%;opacity:0;padding:5px 10px;transform:translateY(5px);transition:opacity .2s ease-out,transform .2s ease-out;user-select:none}.style_module_accessorsMenu__1bed75df.style_module_visible__1bed75df li{opacity:1;transform:translateY(0)}.style_module_accessorsMenu__1bed75df li:hover{background:hsla(0,0%,100%,.1)}.style_module_accessorsMenu__1bed75df li>div{font-weight:200;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:100%}.style_module_placeholderInput__1bed75df{align-items:center;cursor:text;display:flex;font-weight:300;min-width:0;opacity:.7;width:100%}.style_module_placeholderInput__1bed75df.style_module_disabled__1bed75df{cursor:not-allowed;opacity:.5;pointer-events:none}.style_module_searchResult__1bed75df{align-items:center;display:flex;flex-wrap:wrap}.style_module_searchResultMultiField__1bed75df{text-wrap:initial;align-items:center;color:hsla(0,0%,100%,.8);display:inline-block;font-size:var(--cosmograph-search-list-font-size,13.5px);font-weight:300;line-height:normal;margin-right:8px;max-width:100%;overflow-wrap:anywhere;word-break:normal}.style_module_searchResultMultiField__1bed75df span{text-wrap:balance;display:inline;font-size:calc(var(--cosmograph-search-list-font-size)*.95);hyphens:auto;line-height:1.25;overflow-wrap:anywhere;white-space:normal;word-break:break-all}.style_module_searchResultMultiField__1bed75df .style_module_separator__1bed75df{display:inline;opacity:.5}.style_module_searchResultMultiField__1bed75df b{font-size:calc(var(--cosmograph-search-list-font-size)*.9);font-weight:600;letter-spacing:.015em;opacity:.7;text-transform:uppercase;white-space:pre}.style_module_selectAllContainer__1bed75df{align-items:center;display:flex;gap:4px;justify-content:start;line-height:1;margin:.25rem .5rem .15rem;padding:.2rem 0;width:100%}.style_module_selectAllButton__1bed75df{align-items:center;backdrop-filter:blur(4px);background:var(--cosmograph-search-select-all-background,hsla(0,0%,100%,.1));border:none;border-radius:4px;color:var(--cosmograph-search-select-all-color,hsla(0,0%,100%,.75));cursor:pointer;font-size:var(--cosmograph-search-list-font-size,13.5px);font-weight:300;margin:0!important;padding:2px 8px;text-align:center;transition:background-color .2s ease,border-color .2s ease}.style_module_selectAllButton__1bed75df:hover{background:var(--cosmograph-search-select-all-hover-background,hsla(0,0%,100%,.15))}.style_module_resultsCounter__1bed75df{color:hsla(0,0%,100%,.4);font-size:12px;font-weight:400;user-select:none;white-space:nowrap}.style_module_selectAllContainer__1bed75df .style_module_separator__1bed75df{color:hsla(0,0%,100%,.4);opacity:.7;user-select:none}",{}),Sz(":root{--cosmograph-search-accessors-background:#8791a159}",{});let pU=(o=class extends oU{constructor(){super(...arguments),s(this,"_isDataFetched",!1),s(this,"_accessorsMenu",null),s(this,"_placeholderElement",null),s(this,"_accessorButton",null),s(this,"_clickOutsideHandler",e=>this._handleClickOutside(e)),s(this,"_enterFilterActive",!1),s(this,"_currentSearchInput",""),s(this,"_currentSearchResults",[]),s(this,"_totalResultsCount",0),s(this,"_resultsCounter",null),s(this,"_arrayColumnsCache",new Set),s(this,"_selectedSearchField",rU.accessor)}get defaultConfig(){return rU}get accessor(){return this._config.accessor??rU.accessor}_isAllFieldsSelected(){return this._selectedSearchField===o.ALL_FIELDS_TOKEN}_getSelectedFieldLabel(){return this._isAllFieldsSelected()?o.ALL_FIELDS_LABEL:this.accessor}_syncSelectedSearchFieldWithConfig(){this._isAllFieldsSelected()||(this._selectedSearchField=this.accessor)}_getAutoSuggestionFields(){const{config:e}=this._internalApi,t=this._internalApi.summary.pointsSummary;if(!t||0===t.length)return;const n={};for(const i of t){const t=String(i.column_name);t!==e.pointIndexBy&&(n[t]=t)}if(this._config.suggestionFields)for(const[i,o]of Object.entries(this._config.suggestionFields))void 0!==n[i]&&(n[i]=o);return n}_getEffectiveSuggestionFields(){return this._isAllFieldsSelected()?this._getAutoSuggestionFields():this._config.suggestionFields}_getAllFields(){return Object.keys(this._getAutoSuggestionFields()??{})}_valueAccessor(e,t=this.accessor){const n=e[t];return null==n?"null":String(n)}_indexAccessor(e){const{config:t}=this._internalApi;return Number(e[t.pointIndexBy])}_calculateDisabledState(){return!this._isDataFetched||("boolean"==typeof this._config.disabled?this._config.disabled:!this._isDataFetched)}async fetchData(){if(!this._internalApi.dbCoordinator)return;await this._internalApi.dataManager.dataReady(),this._isDataFetched=!0,this._syncSelectedSearchFieldWithConfig();const e=this._calculateDisabledState();this._uiComponent.setDisabled(e),this._findPlaceholderElement(),this._updatePlaceholderDisabledState(),this._config.showAccessorsMenu&&(await this._updateAccessorsMenu(),this._updateAccessorButton()),this._detectArrayColumns(),this._client&&this.accessor&&await this._client.getCurrentData()}_detectArrayColumns(){this._arrayColumnsCache.clear();for(const e of this._internalApi.summary.pointsSummary??[])_I(String(e.column_type??""))&&this._arrayColumnsCache.add(String(e.column_name))}_isArrayColumn(e){return this._arrayColumnsCache.has(e)}applyFilter(e){var t,n,i;const{config:o}=this._internalApi;if(e)if(this._getEffectiveSuggestionFields()){const n=this._indexAccessor(e);null==(t=this._client)||t.applyFilter(x_(bm(o.pointIndexBy),[n])),this._internalApi.public.zoomToPoint(n),(o.focusPointOnClick??o.selectPointOnClick)&&this._internalApi.public.setFocusedPoint(n)}else null==(n=this._client)||n.applyExactFilter(this._valueAccessor(e));else null==(i=this._client)||i.resetFilter()}setSelectedItem(e){e||this._uiComponent.clearInput()}compareSelectedItem(e){var t;return!(e||!this.selected)||(null==(t=this.selected)?void 0:t.id)===(null==e?void 0:e.id)}createUIComponent(e){return new pB(e,this.createComponentConfig({...this._config}))}onResetClientSelections(){this._uiComponent.clearInput()}async onConfigUpdate(){const e=this._config.openListUpwards;this._uiComponent.setConfig(this.createComponentConfig({...this._config})),this._updatePlaceholderDisabledState(),this._syncSelectedSearchFieldWithConfig(),this._config.showAccessorsMenu&&this._accessorsMenu&&e!==this._config.openListUpwards&&(this._config.openListUpwards?this._accessorsMenu.classList.add(lU):this._accessorsMenu.classList.remove(lU)),this._config.showAccessorsMenu&&this._updateAccessorButton(),this._uiComponent.clearInput(),this.onResetClientSelections()}async _getSuggestions(e){if(this._internalApi.dbCoordinator)return await this._internalApi.dataManager.dataReady(),this._syncSelectedSearchFieldWithConfig(),this._isAllFieldsSelected()?this._getAllFieldsSuggestions(e):this._getSingleFieldSuggestions(e)}async _executeQuery(e){var t;return await(null==(t=this._internalApi.dbCoordinator)?void 0:t.query(e))}_buildOrderByClause(e,t){return this._isNullSearch(t)?`"${this.accessor}"`:`\n      CASE WHEN ${e} = LOWER('${t}') THEN 0 ELSE 1 END,\n      CASE WHEN ${e} LIKE LOWER('${t}%') THEN 0 ELSE 1 END,\n      STRPOS(${e}, LOWER('${t}'))\n    `}_isNullSearch(e){return"null"===e.toLowerCase().trim()}_buildFieldUtilities(e){const t=e=>this._isArrayColumn(e)?`LOWER(array_to_string("${e}", ', '))`:`LOWER(CAST("${e}" AS VARCHAR))`;return{fieldCast:t,fieldMatchCondition:n=>this._isNullSearch(e)?`"${n}" IS NULL`:this._isArrayColumn(n)?`EXISTS(\n          SELECT 1 FROM UNNEST("${n}") AS element\n          WHERE LOWER(CAST(element AS VARCHAR)) LIKE LOWER('%${e}%')\n        )`:`${t(n)} LIKE LOWER('%${e}%')`}}_buildSingleFieldWhereCondition(e){const{fieldMatchCondition:t}=this._buildFieldUtilities(e);return t(this.accessor)}_buildAllFieldsWhereCondition(e){const t=this._getAllFields();if(0===t.length)return this._buildSingleFieldWhereCondition(e);const{fieldMatchCondition:n}=this._buildFieldUtilities(e);return t.map(n).join(" OR ")}_truncateAroundMatch(e,t,n){if(0===n||e.length<=n)return e;const i=e.toLowerCase(),o=t.toLowerCase(),r=i.indexOf(o);if(-1===r)return e.length>n?`${e.substring(0,n)}...`:e;const s=r+t.length,a=Math.floor(n/2);let l=Math.max(0,r-a),c=Math.min(e.length,s+a);0===l?c=Math.min(e.length,l+n):c===e.length&&(l=Math.max(0,c-n));let u=e.substring(l,c);return l>0&&(u=`...${u}`),c<e.length&&(u=`${u}...`),u}async _getSingleFieldSuggestions(e){const{fieldCast:t}=this._buildFieldUtilities(e),n=this._config.suggestionsLimit??rU.suggestionsLimit,i=this._buildSingleFieldWhereCondition(e);if(!this._getEffectiveSuggestionFields()){if(this._isNullSearch(e)){const e=`\n          SELECT 'null' AS "${this.accessor}",\n                 'null' AS id,\n                 1 AS total_count\n          FROM (SELECT 1) AS dummy\n          WHERE EXISTS (\n            SELECT 1 FROM ${this.tableName}\n            WHERE "${this.accessor}" IS NULL\n            LIMIT 1\n          )\n          LIMIT 1\n        `;return this._executeQuery(e)}if(this._isArrayColumn(this.accessor)){const t=`\n          WITH values AS (\n            SELECT DISTINCT CAST(u.value AS VARCHAR) AS value\n            FROM ${this.tableName} t,\n                 UNNEST(t."${this.accessor}") AS u(value)\n            WHERE LOWER(CAST(u.value AS VARCHAR)) LIKE LOWER('%${e}%')\n          ),\n          ranked AS (\n            SELECT value,\n                   LOWER(value) AS lower_value,\n                   COUNT(*) OVER() AS total_count\n            FROM values\n          )\n          SELECT value AS "${this.accessor}",\n                 value AS id,\n                 total_count\n          FROM ranked\n          ORDER BY ${this._buildOrderByClause("lower_value",e)},\n                   value\n          LIMIT ${n}\n        `;return this._executeQuery(t)}const t=`\n        WITH values AS (\n          SELECT DISTINCT CAST("${this.accessor}" AS VARCHAR) AS value\n          FROM ${this.tableName}\n          WHERE ${i}\n        ),\n        ranked AS (\n          SELECT value,\n                 LOWER(value) AS lower_value,\n                 COUNT(*) OVER() AS total_count\n          FROM values\n        )\n        SELECT value AS "${this.accessor}",\n               value AS id,\n               total_count\n        FROM ranked\n        ORDER BY ${this._buildOrderByClause("lower_value",e)},\n                 value\n        LIMIT ${n}\n      `;return this._executeQuery(t)}if(this._isNullSearch(e)){const t=`\n        SELECT *,\n               COUNT(*) OVER() AS total_count\n        FROM ${this.tableName}\n        WHERE ${i}\n        ORDER BY ${this._buildOrderByClause("",e)}\n        LIMIT ${n}\n      `;return this._executeQuery(t)}const o=`\n      SELECT *,\n             COUNT(*) OVER() AS total_count\n      FROM (\n        SELECT *,\n               ${t(this.accessor)} AS lower_value\n        FROM ${this.tableName}\n        WHERE ${i}\n      ) t\n      ORDER BY ${this._buildOrderByClause("lower_value",e)}\n      LIMIT ${n}\n    `;return this._executeQuery(o)}async _getAllFieldsSuggestions(e){const t=this._getAllFields(),n=this._config.suggestionsLimit??rU.suggestionsLimit,i=this._buildAllFieldsWhereCondition(e),{fieldCast:o,fieldMatchCondition:r}=this._buildFieldUtilities(e);if(0===t.length)return this._getSingleFieldSuggestions(e);const s=t.map(e=>`WHEN ${r(e)} THEN '${e}'`).join(" ");if(this._isNullSearch(e)){const e=`\n        SELECT *,\n               COUNT(*) OVER() AS total_count,\n               'null' AS matched_value,\n               CASE ${s} END AS matched_field\n        FROM ${this.tableName}\n        WHERE ${i}\n        ORDER BY "${this.accessor}"\n        LIMIT ${n}\n      `;return this._executeQuery(e)}const a=`\n      SELECT *,\n             COUNT(*) OVER() AS total_count\n      FROM (\n        SELECT *,\n               CASE ${s} END AS matched_field,\n               CASE ${t.map(e=>`WHEN ${r(e)} THEN ${o(e)}`).join(" ")} END AS matched_value\n        FROM ${this.tableName}\n        WHERE ${i}\n      ) t\n      ORDER BY ${this._buildOrderByClause("matched_value",e)}\n      LIMIT ${n}\n    `;return this._executeQuery(a)}async _getSearchItems(e){var t,n;if(!this._isDataFetched||0===(null==(t=this._internalApi.summary.pointsSummary)?void 0:t.length))return this._currentSearchResults=[],this._totalResultsCount=0,this._updateResultsCounter(),[];const i=await this._getSuggestions(e),o=(null==i?void 0:i.toArray())??[];this._currentSearchResults=o;const r=null==(n=o[0])?void 0:n.total_count;return this._totalResultsCount="number"==typeof r?r:o.length,this._updateResultsCounter(),this._currentSearchResults}_createAccessorButton(){const e=document.createElement("div");return e.classList.add(aU),e.dataset.ignoreFocus="true",e.textContent=this._getSelectedFieldLabel(),e.onclick=()=>{this._accessorsMenu&&(this._accessorsMenu.classList.contains(cU)?this._accessorsMenu.classList.remove(cU):this._accessorsMenu.classList.add(cU))},e}_createFooter(){const e=document.createElement("div");e.classList.add("style_module_selectAllContainer__1bed75df");const t=document.createElement("button");t.classList.add("style_module_selectAllButton__1bed75df"),t.textContent="select found results",t.onclick=async e=>{e.stopPropagation(),await this._handleSelectAllClick()},this._resultsCounter=document.createElement("span"),this._resultsCounter.classList.add("style_module_resultsCounter__1bed75df"),this._resultsCounter.textContent=this._getResultsCountText(),e.appendChild(t);const n=document.createElement("span");return n.classList.add(dU),n.textContent=" · ",e.appendChild(n),e.appendChild(this._resultsCounter),e}_getResultsCountText(){const e=this._totalResultsCount,t=this._currentSearchResults.length,n=(e,t,n=`${t}s`)=>1===e?t:n;return e===t?`${AO(e)} ${n(e,"result")} found`:`${AO(t)} of ${AO(e)} ${n(e,"result")} shown`}_updateResultsCounter(){this._resultsCounter&&(this._resultsCounter.textContent=this._getResultsCountText())}async _handleSelectAllClick(){var e,t,n;if(0!==this._currentSearchResults.length&&this._currentSearchInput)try{const{config:i}=this._internalApi,o=i.pointIndexBy,r=this._isAllFieldsSelected()?this._buildAllFieldsWhereCondition(this._currentSearchInput):this._buildSingleFieldWhereCondition(this._currentSearchInput),s=`\n        SELECT DISTINCT "${o}" as point_index\n        FROM ${this.tableName}\n        WHERE ${r}\n      `,a=await this._executeQuery(s),l=((null==a?void 0:a.toArray())??[]).map(e=>e.point_index);null==(e=this._client)||e.applyFilter(x_(bm(this._internalApi.config.pointIndexBy),l)),this._enterFilterActive=!0,null==(n=(t=this._config).onSelectAll)||n.call(t,l),this._uiComponent.hideSuggestions()}catch(mC){this._uiComponent.hideSuggestions()}}_createAccessorsMenu(){const e=document.createElement("ul");return e.dataset.ignoreFocus="true",e.classList.add("style_module_accessorsMenu__1bed75df"),this._config.openListUpwards&&e.classList.add(lU),e}_handleClickOutside(e){var t;this._accessorsMenu&&this._accessorsMenu.classList.contains(cU)&&!(null==(t=this._accessorButton)?void 0:t.contains(e.target))&&!this._accessorsMenu.contains(e.target)&&this._accessorsMenu.classList.remove(cU)}_createPlaceholderElement(){if(!this._placeholderElement){this._placeholderElement=document.createElement("div"),this._placeholderElement.classList.add(sU),this._config.showAccessorsMenu&&(this._accessorsMenu=this._createAccessorsMenu(),this._accessorButton=this._createAccessorButton(),this._placeholderElement.appendChild(this._accessorButton),this._placeholderElement.appendChild(this._accessorsMenu),document.addEventListener("click",this._clickOutsideHandler));const e=document.createElement("div");e.classList.add(uU),e.innerHTML=this._config.placeholderText??"Search...",this._calculateDisabledState()&&e.classList.add(hU),e.onclick=()=>{this._calculateDisabledState()||this._uiComponent.focus()},this._placeholderElement.appendChild(e)}return this._placeholderElement}_updateAccessorButton(){if(this._accessorButton){const e=this._getSelectedFieldLabel();this._accessorButton.textContent=e,this._accessorButton.title=e}}_findPlaceholderElement(){if(!this._placeholderElement){const e=`.${sU}`,t=document.querySelector(e);if(!t)return;this._placeholderElement=t,this._accessorButton=t.querySelector(`.${aU}`),this._config.showAccessorsMenu&&!this._accessorsMenu&&(this._accessorsMenu=this._createAccessorsMenu(),this._placeholderElement.appendChild(this._accessorsMenu))}}_updatePlaceholderDisabledState(){if(!this._placeholderElement)return;const e=this._placeholderElement.querySelector(`.${uU}`);e&&(this._calculateDisabledState()?e.classList.add(hU):e.classList.remove(hU))}async _updateAccessorsMenu(){var e;if(!this._config.showAccessorsMenu||!this._accessorsMenu)return;const{config:t}=this._internalApi;if(!this._internalApi.summary.pointsSummary)return;this._config.openListUpwards?this._accessorsMenu.classList.add(lU):this._accessorsMenu.classList.remove(lU);const n=null==(e=this._internalApi.summary.pointsSummary)?void 0:e.map(e=>String(e.column_name)).filter(e=>e!==t.pointIndexBy);this._accessorsMenu.innerHTML="";const i=document.createElement("div");i.classList.add("style_module_accessorsMenuPlaceholder__1bed75df"),i.textContent="Select field to search",this._accessorsMenu.appendChild(i),this._accessorsMenu.appendChild(this._createAccessorItem(o.ALL_FIELDS_TOKEN,o.ALL_FIELDS_LABEL)),n.forEach(e=>{const t=this._createAccessorItem(e);this._accessorsMenu.appendChild(t)})}_createAccessorItem(e,t){const n=document.createElement("li"),i=document.createElement("div"),o=t??e;return i.textContent=o,i.title=o,i.onclick=t=>this._handleAccessorClick(e,t),n.onclick=t=>this._handleAccessorClick(e,t),n.appendChild(i),n}async _handleAccessorClick(e,t){t.stopPropagation(),e===o.ALL_FIELDS_TOKEN?this._isAllFieldsSelected()||(this._selectedSearchField=o.ALL_FIELDS_TOKEN,this._updateAccessorButton(),this._uiComponent.clearInput(),await this.onConfigUpdate()):(this._config.accessor!==e||this._isAllFieldsSelected())&&(this._selectedSearchField=e,this._config.accessor=e,this._updateAccessorButton(),this._uiComponent.clearInput(),await this.onConfigUpdate(),this._client&&await this._client.getCurrentData()),this._accessorsMenu&&this._accessorsMenu.classList.remove(cU)}_renderSuggestionField(e,t,n,i,o){const r=void 0!==t[n]&&null!==t[n],s=(null===t[n]||void 0===t[n])&&this._isNullSearch(this._currentSearchInput);if(r||s){const r=o[n];let s=this._valueAccessor(t,n);const a=this._config.suggestionTruncationLength??rU.suggestionTruncationLength;if(a>0&&this._currentSearchInput&&s.length>a&&(s=this._truncateAroundMatch(s,this._currentSearchInput,a)),i>0){const t=document.createElement("div");t.classList.add(dU),t.innerHTML=" · ",e.appendChild(t)}const l=document.createElement("span"),c=document.createElement("b");c.textContent=`${r}: `,l.appendChild(c);const u=document.createElement("span");let h;if(i>0&&this._config.suggestionFieldsPalette&&this._config.suggestionFieldsPalette.length>0){const e=(i-1)%this._config.suggestionFieldsPalette.length;h=this._config.suggestionFieldsPalette[e],l.style.color=h??"inherit"}if(this._isAllFieldsSelected()?this._currentSearchInput&&(this._isNullSearch(this._currentSearchInput)?"null"===s.toLowerCase():s.toLowerCase().includes(this._currentSearchInput.toLowerCase())):n===this.accessor){const e=this._uiComponent.getHighlightedMatch(s);u.innerHTML=h?e.replace(/<mark[^>]*>/g,`<mark style="color: ${h}">`):e}else u.textContent=s;l.appendChild(u),e.appendChild(l)}}_renderSuggestion(e){const t=this._getEffectiveSuggestionFields();if(!t){let t=this._valueAccessor(e);const n=this._config.suggestionTruncationLength??rU.suggestionTruncationLength;return n>0&&this._currentSearchInput&&t.length>n&&(t=this._truncateAroundMatch(t,this._currentSearchInput,n)),t}const n=document.createElement("div");n.classList.add("style_module_searchResult__1bed75df");const i={...t};let o=Object.keys(i);i[this.accessor]?o[0]!==this.accessor&&(o=o.filter(e=>e!==this.accessor),o.unshift(this.accessor)):(i[this.accessor]=this.accessor,o.unshift(this.accessor));const r=document.createElement("span");return r.classList.add("style_module_searchResultMultiField__1bed75df"),o.forEach((t,n)=>{this._renderSuggestionField(r,e,t,n,i)}),n.appendChild(r),n}createComponentConfig(e){return{...e,onEnter:async(...e)=>{var t,n,i;const[,o]=e;Array.isArray(o)&&o.length>0?await this._handleSelectAllClick():(null==(t=this._client)||t.resetFilter(),this._enterFilterActive=!1),this._uiComponent.hideSuggestions(),Array.isArray(o)&&o.splice(0,o.length),null==(i=(n=this._config).onEnter)||i.call(n,...e)},onInput:(...e)=>{var t,n;const[i]=e;this._currentSearchInput=i,null==(n=(t=this._config).onInput)||n.call(t,...e)},onSelect:(...e)=>{var t,n;this._enterFilterActive=!1,this.onSelect(e[0]),null==(n=(t=this._config).onSelect)||n.call(t,e[0])},onClear:()=>{var e,t;this._enterFilterActive=!1,this.onSelect(void 0),null==(t=(e=this._config).onClear)||t.call(e)},disabled:this._calculateDisabledState(),searchFn:async(...e)=>await this._getSearchItems(e[0]),suggestionRenderer:e=>this._renderSuggestion(e),selectedSuggestionRenderer:e=>{let t=this._valueAccessor(e);const n=this._config.suggestionTruncationLength??rU.suggestionTruncationLength;return n>0&&this._currentSearchInput&&t.length>n&&(t=this._truncateAroundMatch(t,this._currentSearchInput,n)),t},placeholderRenderer:this._createPlaceholderElement(),footerComponent:this._config.showFooter?this._createFooter():void 0}}remove(){document.removeEventListener("click",this._clickOutsideHandler),this._accessorButton&&(this._accessorButton.onclick=null),this._uiComponent.destroy(),this._accessorsMenu=null,this._placeholderElement=null,this._accessorButton=null,this._resultsCounter=null,this._currentSearchResults=[],this._totalResultsCount=0,super.remove()}onDataFiltered(){this._enterFilterActive||super.onDataFiltered()}hideSuggestions(){this.checkReady(()=>this.hideSuggestions())&&this._uiComponent.hideSuggestions()}clearInput(){this.checkReady(()=>this.clearInput())&&this._uiComponent.clearInput()}focus(){this.checkReady(()=>this.focus())&&this._uiComponent.focus()}blur(){this.checkReady(()=>this.blur())&&this._uiComponent.blur()}},s(o,"ALL_FIELDS_TOKEN","__all_fields__"),s(o,"ALL_FIELDS_LABEL","all fields"),o);const fU={useLinksData:!1,selectOnClick:!0,highlightSelectedData:!0};let mU=class extends Pz{setSelectedItem(e){var t;this.checkReady(()=>this.setSelectedItem(e))&&(this._uiComponent.setSelectedItem(e),e||null==(t=this._client)||t.resetFilter())}get defaultConfig(){return fU}get accessor(){return this._config.accessor}onResetClientSelections(){this.setSelectedItem(void 0)}async fetchData(){var e,t;if(await super.fetchData(),this._currentData){this._uiComponent.resetList();const n=this.accessor?((e,t)=>{if(!(null==e?void 0:e.length))return[];const n=[],i=t;for(let o=0;o<e.length;o++){const t=e[o];if(Array.isArray(t))for(let e=0;e<t.length;e++){const o=t[e];null!=o&&n.push(i?i(o):o)}else null!=t&&n.push(i?i(t):t)}return n})(null==(t=null==(e=this._currentData)?void 0:e.getChild(this.accessor))?void 0:t.toArray(),String):[];this._uiComponent.setData(n),this.updateCrossfilteredData()}else this._uiComponent.setData(void 0),this.updateHighlightedData(void 0)}createUIComponent(e){return new TB(e,this.createComponentConfig(this._config))}createComponentConfig(e){return{...e,onClick:e=>{var t,n,i,o,r,s,a,l,c;const u=this._uiComponent.getSelectedItem();e&&(null==u?void 0:u.label)===e.label?(null==(t=this._client)||t.resetFilter(),this.setSelectedItem(void 0),null==(i=(n=this._config).onClick)||i.call(n,void 0)):e?(null==(o=this._client)||o.applyExactFilter(e.label),this.setSelectedItem(e),null==(s=(r=this._config).onClick)||s.call(r,e)):(null==(a=this._client)||a.resetFilter(),this.setSelectedItem(void 0),null==(c=(l=this._config).onClick)||c.call(l,void 0))},onBarHover:e=>{var t,n;null==(n=(t=this._config).onBarHover)||n.call(t,e)}}}async onConfigUpdate(){this._uiComponent.setConfig(this.createComponentConfig(this._config))}updateHighlightedData(e){const{highlightSelectedData:t}=this._config;if(t)if(this._internalApi.crossfilter.isFilteringActive)if(e&&e.length>0){const t=e.map(e=>String(e));this._uiComponent.setHighlightedData(t)}else this._uiComponent.setHighlightedData([]);else this._uiComponent.setHighlightedData(void 0)}};const{entries:_U,setPrototypeOf:gU,isFrozen:yU,getPrototypeOf:bU,getOwnPropertyDescriptor:vU}=Object;let{freeze:xU,seal:wU,create:SU}=Object,{apply:EU,construct:TU}="undefined"!=typeof Reflect&&Reflect;xU||(xU=function(e){return e}),wU||(wU=function(e){return e}),EU||(EU=function(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return e.apply(t,i)}),TU||(TU=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return new e(...n)});const CU=$U(Array.prototype.forEach),IU=$U(Array.prototype.lastIndexOf),AU=$U(Array.prototype.pop),kU=$U(Array.prototype.push),LU=$U(Array.prototype.splice),RU=$U(String.prototype.toLowerCase),PU=$U(String.prototype.toString),DU=$U(String.prototype.match),MU=$U(String.prototype.replace),NU=$U(String.prototype.indexOf),OU=$U(String.prototype.trim),BU=$U(Object.prototype.hasOwnProperty),FU=$U(RegExp.prototype.test),zU=(UU=TypeError,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return TU(UU,t)});var UU;function $U(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return EU(e,t,i)}}function VU(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:RU;gU&&gU(e,null);let i=t.length;for(;i--;){let o=t[i];if("string"==typeof o){const e=n(o);e!==o&&(yU(t)||(t[i]=e),o=e)}e[o]=!0}return e}function HU(e){for(let t=0;t<e.length;t++)BU(e,t)||(e[t]=null);return e}function GU(e){const t=SU(null);for(const[n,i]of _U(e))BU(e,n)&&(Array.isArray(i)?t[n]=HU(i):i&&"object"==typeof i&&i.constructor===Object?t[n]=GU(i):t[n]=i);return t}function WU(e,t){for(;null!==e;){const n=vU(e,t);if(n){if(n.get)return $U(n.get);if("function"==typeof n.value)return $U(n.value)}e=bU(e)}return function(){return null}}const jU=xU(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),YU=xU(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),qU=xU(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),XU=xU(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),KU=xU(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),ZU=xU(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),QU=xU(["#text"]),JU=xU(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),e$=xU(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),t$=xU(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),n$=xU(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),i$=wU(/\{\{[\w\W]*|[\w\W]*\}\}/gm),o$=wU(/<%[\w\W]*|[\w\W]*%>/gm),r$=wU(/\$\{[\w\W]*/gm),s$=wU(/^data-[\-\w.\u00B7-\uFFFF]+$/),a$=wU(/^aria-[\-\w]+$/),l$=wU(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),c$=wU(/^(?:\w+script|data):/i),u$=wU(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),h$=wU(/^html$/i),d$=wU(/^[a-z][.\w]*(-[.\w]+)+$/i);var p$=Object.freeze({__proto__:null,ARIA_ATTR:a$,ATTR_WHITESPACE:u$,CUSTOM_ELEMENT:d$,DATA_ATTR:s$,DOCTYPE_NAME:h$,ERB_EXPR:o$,IS_ALLOWED_URI:l$,IS_SCRIPT_OR_DATA:c$,MUSTACHE_EXPR:i$,TMPLIT_EXPR:r$});var f$=function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"undefined"==typeof window?null:window;const n=t=>e(t);if(n.version="3.3.1",n.removed=[],!t||!t.document||9!==t.document.nodeType||!t.Element)return n.isSupported=!1,n;let{document:i}=t;const o=i,r=o.currentScript,{DocumentFragment:s,HTMLTemplateElement:a,Node:l,Element:c,NodeFilter:u,NamedNodeMap:h=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:d,DOMParser:p,trustedTypes:f}=t,m=c.prototype,_=WU(m,"cloneNode"),g=WU(m,"remove"),y=WU(m,"nextSibling"),b=WU(m,"childNodes"),v=WU(m,"parentNode");if("function"==typeof a){const e=i.createElement("template");e.content&&e.content.ownerDocument&&(i=e.content.ownerDocument)}let x,w="";const{implementation:S,createNodeIterator:E,createDocumentFragment:T,getElementsByTagName:C}=i,{importNode:I}=o;let A={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};n.isSupported="function"==typeof _U&&"function"==typeof v&&S&&void 0!==S.createHTMLDocument;const{MUSTACHE_EXPR:k,ERB_EXPR:L,TMPLIT_EXPR:R,DATA_ATTR:P,ARIA_ATTR:D,IS_SCRIPT_OR_DATA:M,ATTR_WHITESPACE:N,CUSTOM_ELEMENT:O}=p$;let{IS_ALLOWED_URI:B}=p$,F=null;const z=VU({},[...jU,...YU,...qU,...KU,...QU]);let U=null;const $=VU({},[...JU,...e$,...t$,...n$]);let V=Object.seal(SU(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),H=null,G=null;const W=Object.seal(SU(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let j=!0,Y=!0,q=!1,X=!0,K=!1,Z=!0,Q=!1,J=!1,ee=!1,te=!1,ne=!1,ie=!1,oe=!0,re=!1,se=!0,ae=!1,le={},ce=null;const ue=VU({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let he=null;const de=VU({},["audio","video","img","source","image","track"]);let pe=null;const fe=VU({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),me="http://www.w3.org/1998/Math/MathML",_e="http://www.w3.org/2000/svg",ge="http://www.w3.org/1999/xhtml";let ye=ge,be=!1,ve=null;const xe=VU({},[me,_e,ge],PU);let we=VU({},["mi","mo","mn","ms","mtext"]),Se=VU({},["annotation-xml"]);const Ee=VU({},["title","style","font","a","script"]);let Te=null;const Ce=["application/xhtml+xml","text/html"];let Ie=null,Ae=null;const ke=i.createElement("form"),Le=function(e){return e instanceof RegExp||e instanceof Function},Re=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!Ae||Ae!==e){if(e&&"object"==typeof e||(e={}),e=GU(e),Te=-1===Ce.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,Ie="application/xhtml+xml"===Te?PU:RU,F=BU(e,"ALLOWED_TAGS")?VU({},e.ALLOWED_TAGS,Ie):z,U=BU(e,"ALLOWED_ATTR")?VU({},e.ALLOWED_ATTR,Ie):$,ve=BU(e,"ALLOWED_NAMESPACES")?VU({},e.ALLOWED_NAMESPACES,PU):xe,pe=BU(e,"ADD_URI_SAFE_ATTR")?VU(GU(fe),e.ADD_URI_SAFE_ATTR,Ie):fe,he=BU(e,"ADD_DATA_URI_TAGS")?VU(GU(de),e.ADD_DATA_URI_TAGS,Ie):de,ce=BU(e,"FORBID_CONTENTS")?VU({},e.FORBID_CONTENTS,Ie):ue,H=BU(e,"FORBID_TAGS")?VU({},e.FORBID_TAGS,Ie):GU({}),G=BU(e,"FORBID_ATTR")?VU({},e.FORBID_ATTR,Ie):GU({}),le=!!BU(e,"USE_PROFILES")&&e.USE_PROFILES,j=!1!==e.ALLOW_ARIA_ATTR,Y=!1!==e.ALLOW_DATA_ATTR,q=e.ALLOW_UNKNOWN_PROTOCOLS||!1,X=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,K=e.SAFE_FOR_TEMPLATES||!1,Z=!1!==e.SAFE_FOR_XML,Q=e.WHOLE_DOCUMENT||!1,te=e.RETURN_DOM||!1,ne=e.RETURN_DOM_FRAGMENT||!1,ie=e.RETURN_TRUSTED_TYPE||!1,ee=e.FORCE_BODY||!1,oe=!1!==e.SANITIZE_DOM,re=e.SANITIZE_NAMED_PROPS||!1,se=!1!==e.KEEP_CONTENT,ae=e.IN_PLACE||!1,B=e.ALLOWED_URI_REGEXP||l$,ye=e.NAMESPACE||ge,we=e.MATHML_TEXT_INTEGRATION_POINTS||we,Se=e.HTML_INTEGRATION_POINTS||Se,V=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&Le(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(V.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&Le(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(V.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(V.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),K&&(Y=!1),ne&&(te=!0),le&&(F=VU({},QU),U=[],!0===le.html&&(VU(F,jU),VU(U,JU)),!0===le.svg&&(VU(F,YU),VU(U,e$),VU(U,n$)),!0===le.svgFilters&&(VU(F,qU),VU(U,e$),VU(U,n$)),!0===le.mathMl&&(VU(F,KU),VU(U,t$),VU(U,n$))),e.ADD_TAGS&&("function"==typeof e.ADD_TAGS?W.tagCheck=e.ADD_TAGS:(F===z&&(F=GU(F)),VU(F,e.ADD_TAGS,Ie))),e.ADD_ATTR&&("function"==typeof e.ADD_ATTR?W.attributeCheck=e.ADD_ATTR:(U===$&&(U=GU(U)),VU(U,e.ADD_ATTR,Ie))),e.ADD_URI_SAFE_ATTR&&VU(pe,e.ADD_URI_SAFE_ATTR,Ie),e.FORBID_CONTENTS&&(ce===ue&&(ce=GU(ce)),VU(ce,e.FORBID_CONTENTS,Ie)),e.ADD_FORBID_CONTENTS&&(ce===ue&&(ce=GU(ce)),VU(ce,e.ADD_FORBID_CONTENTS,Ie)),se&&(F["#text"]=!0),Q&&VU(F,["html","head","body"]),F.table&&(VU(F,["tbody"]),delete H.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw zU('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw zU('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');x=e.TRUSTED_TYPES_POLICY,w=x.createHTML("")}else void 0===x&&(x=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let n=null;const i="data-tt-policy-suffix";t&&t.hasAttribute(i)&&(n=t.getAttribute(i));const o="dompurify"+(n?"#"+n:"");try{return e.createPolicy(o,{createHTML:e=>e,createScriptURL:e=>e})}catch(r){return console.warn("TrustedTypes policy "+o+" could not be created."),null}}(f,r)),null!==x&&"string"==typeof w&&(w=x.createHTML(""));xU&&xU(e),Ae=e}},Pe=VU({},[...YU,...qU,...XU]),De=VU({},[...KU,...ZU]),Me=function(e){kU(n.removed,{element:e});try{v(e).removeChild(e)}catch(t){g(e)}},Ne=function(e,t){try{kU(n.removed,{attribute:t.getAttributeNode(e),from:t})}catch(i){kU(n.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if(te||ne)try{Me(t)}catch(i){}else try{t.setAttribute(e,"")}catch(i){}},Oe=function(e){let t=null,n=null;if(ee)e="<remove></remove>"+e;else{const t=DU(e,/^[\r\n\t ]+/);n=t&&t[0]}"application/xhtml+xml"===Te&&ye===ge&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const o=x?x.createHTML(e):e;if(ye===ge)try{t=(new p).parseFromString(o,Te)}catch(s){}if(!t||!t.documentElement){t=S.createDocument(ye,"template",null);try{t.documentElement.innerHTML=be?w:o}catch(s){}}const r=t.body||t.documentElement;return e&&n&&r.insertBefore(i.createTextNode(n),r.childNodes[0]||null),ye===ge?C.call(t,Q?"html":"body")[0]:Q?t.documentElement:r},Be=function(e){return E.call(e.ownerDocument||e,e,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},Fe=function(e){return e instanceof d&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof h)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},ze=function(e){return"function"==typeof l&&e instanceof l};function Ue(e,t,i){CU(e,e=>{e.call(n,t,i,Ae)})}const $e=function(e){let t=null;if(Ue(A.beforeSanitizeElements,e,null),Fe(e))return Me(e),!0;const i=Ie(e.nodeName);if(Ue(A.uponSanitizeElement,e,{tagName:i,allowedTags:F}),Z&&e.hasChildNodes()&&!ze(e.firstElementChild)&&FU(/<[/\w!]/g,e.innerHTML)&&FU(/<[/\w!]/g,e.textContent))return Me(e),!0;if(7===e.nodeType)return Me(e),!0;if(Z&&8===e.nodeType&&FU(/<[/\w]/g,e.data))return Me(e),!0;if(!(W.tagCheck instanceof Function&&W.tagCheck(i))&&(!F[i]||H[i])){if(!H[i]&&He(i)){if(V.tagNameCheck instanceof RegExp&&FU(V.tagNameCheck,i))return!1;if(V.tagNameCheck instanceof Function&&V.tagNameCheck(i))return!1}if(se&&!ce[i]){const t=v(e)||e.parentNode,n=b(e)||e.childNodes;if(n&&t)for(let i=n.length-1;i>=0;--i){const o=_(n[i],!0);o.__removalCount=(e.__removalCount||0)+1,t.insertBefore(o,y(e))}}return Me(e),!0}return e instanceof c&&!function(e){let t=v(e);t&&t.tagName||(t={namespaceURI:ye,tagName:"template"});const n=RU(e.tagName),i=RU(t.tagName);return!!ve[e.namespaceURI]&&(e.namespaceURI===_e?t.namespaceURI===ge?"svg"===n:t.namespaceURI===me?"svg"===n&&("annotation-xml"===i||we[i]):Boolean(Pe[n]):e.namespaceURI===me?t.namespaceURI===ge?"math"===n:t.namespaceURI===_e?"math"===n&&Se[i]:Boolean(De[n]):e.namespaceURI===ge?!(t.namespaceURI===_e&&!Se[i])&&!(t.namespaceURI===me&&!we[i])&&!De[n]&&(Ee[n]||!Pe[n]):!("application/xhtml+xml"!==Te||!ve[e.namespaceURI]))}(e)?(Me(e),!0):"noscript"!==i&&"noembed"!==i&&"noframes"!==i||!FU(/<\/no(script|embed|frames)/i,e.innerHTML)?(K&&3===e.nodeType&&(t=e.textContent,CU([k,L,R],e=>{t=MU(t,e," ")}),e.textContent!==t&&(kU(n.removed,{element:e.cloneNode()}),e.textContent=t)),Ue(A.afterSanitizeElements,e,null),!1):(Me(e),!0)},Ve=function(e,t,n){if(oe&&("id"===t||"name"===t)&&(n in i||n in ke))return!1;if(Y&&!G[t]&&FU(P,t));else if(j&&FU(D,t));else if(W.attributeCheck instanceof Function&&W.attributeCheck(t,e));else if(!U[t]||G[t]){if(!(He(e)&&(V.tagNameCheck instanceof RegExp&&FU(V.tagNameCheck,e)||V.tagNameCheck instanceof Function&&V.tagNameCheck(e))&&(V.attributeNameCheck instanceof RegExp&&FU(V.attributeNameCheck,t)||V.attributeNameCheck instanceof Function&&V.attributeNameCheck(t,e))||"is"===t&&V.allowCustomizedBuiltInElements&&(V.tagNameCheck instanceof RegExp&&FU(V.tagNameCheck,n)||V.tagNameCheck instanceof Function&&V.tagNameCheck(n))))return!1}else if(pe[t]);else if(FU(B,MU(n,N,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==NU(n,"data:")||!he[e])if(q&&!FU(M,MU(n,N,"")));else if(n)return!1;return!0},He=function(e){return"annotation-xml"!==e&&DU(e,O)},Ge=function(e){Ue(A.beforeSanitizeAttributes,e,null);const{attributes:t}=e;if(!t||Fe(e))return;const i={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:U,forceKeepAttr:void 0};let o=t.length;for(;o--;){const s=t[o],{name:a,namespaceURI:l,value:c}=s,u=Ie(a),h=c;let d="value"===a?h:OU(h);if(i.attrName=u,i.attrValue=d,i.keepAttr=!0,i.forceKeepAttr=void 0,Ue(A.uponSanitizeAttribute,e,i),d=i.attrValue,!re||"id"!==u&&"name"!==u||(Ne(a,e),d="user-content-"+d),Z&&FU(/((--!?|])>)|<\/(style|title|textarea)/i,d)){Ne(a,e);continue}if("attributename"===u&&DU(d,"href")){Ne(a,e);continue}if(i.forceKeepAttr)continue;if(!i.keepAttr){Ne(a,e);continue}if(!X&&FU(/\/>/i,d)){Ne(a,e);continue}K&&CU([k,L,R],e=>{d=MU(d,e," ")});const p=Ie(e.nodeName);if(Ve(p,u,d)){if(x&&"object"==typeof f&&"function"==typeof f.getAttributeType)if(l);else switch(f.getAttributeType(p,u)){case"TrustedHTML":d=x.createHTML(d);break;case"TrustedScriptURL":d=x.createScriptURL(d)}if(d!==h)try{l?e.setAttributeNS(l,a,d):e.setAttribute(a,d),Fe(e)?Me(e):AU(n.removed)}catch(r){Ne(a,e)}}else Ne(a,e)}Ue(A.afterSanitizeAttributes,e,null)},We=function e(t){let n=null;const i=Be(t);for(Ue(A.beforeSanitizeShadowDOM,t,null);n=i.nextNode();)Ue(A.uponSanitizeShadowNode,n,null),$e(n),Ge(n),n.content instanceof s&&e(n.content);Ue(A.afterSanitizeShadowDOM,t,null)};return n.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=null,r=null,a=null,c=null;if(be=!e,be&&(e="\x3c!--\x3e"),"string"!=typeof e&&!ze(e)){if("function"!=typeof e.toString)throw zU("toString is not a function");if("string"!=typeof(e=e.toString()))throw zU("dirty is not a string, aborting")}if(!n.isSupported)return e;if(J||Re(t),n.removed=[],"string"==typeof e&&(ae=!1),ae){if(e.nodeName){const t=Ie(e.nodeName);if(!F[t]||H[t])throw zU("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof l)i=Oe("\x3c!----\x3e"),r=i.ownerDocument.importNode(e,!0),1===r.nodeType&&"BODY"===r.nodeName||"HTML"===r.nodeName?i=r:i.appendChild(r);else{if(!te&&!K&&!Q&&-1===e.indexOf("<"))return x&&ie?x.createHTML(e):e;if(i=Oe(e),!i)return te?null:ie?w:""}i&&ee&&Me(i.firstChild);const u=Be(ae?e:i);for(;a=u.nextNode();)$e(a),Ge(a),a.content instanceof s&&We(a.content);if(ae)return e;if(te){if(ne)for(c=T.call(i.ownerDocument);i.firstChild;)c.appendChild(i.firstChild);else c=i;return(U.shadowroot||U.shadowrootmode)&&(c=I.call(o,c,!0)),c}let h=Q?i.outerHTML:i.innerHTML;return Q&&F["!doctype"]&&i.ownerDocument&&i.ownerDocument.doctype&&i.ownerDocument.doctype.name&&FU(h$,i.ownerDocument.doctype.name)&&(h="<!DOCTYPE "+i.ownerDocument.doctype.name+">\n"+h),K&&CU([k,L,R],e=>{h=MU(h,e," ")}),x&&ie?x.createHTML(h):h},n.setConfig=function(){Re(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),J=!0},n.clearConfig=function(){Ae=null,J=!1},n.isValidAttribute=function(e,t,n){Ae||Re({});const i=Ie(e),o=Ie(t);return Ve(i,o,n)},n.addHook=function(e,t){"function"==typeof t&&kU(A[e],t)},n.removeHook=function(e,t){if(void 0!==t){const n=IU(A[e],t);return-1===n?void 0:LU(A[e],n,1)[0]}return AU(A[e])},n.removeHooks=function(e){A[e]=[]},n.removeAllHooks=function(){A={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},n}();const m$={content:"",bindTo:void 0,placement:"top",offset:[0,8],hidden:!0};var _$="style_module_visible__d19738e9";Sz(".style_module_popup__d19738e9{box-shadow:0 2px 8px rgba(0,0,0,.15);opacity:0;pointer-events:auto;position:absolute;transition:opacity .15s ease,visibility .15s ease;visibility:hidden;z-index:1}.style_module_visible__d19738e9{opacity:1;transition:opacity .4s ease,visibility .4s ease;visibility:visible}",{});let g$=class{constructor(e,t){s(this,"_internalApi"),s(this,"_config"),s(this,"_popupContent"),s(this,"_popupElement"),s(this,"_isVisible",!1),s(this,"_lastBindId"),s(this,"_lastBindIndex"),s(this,"_initialize",()=>{this._popupElement=this._internalApi.popupElement,this._initializePopupContent(),requestAnimationFrame(()=>this.setConfig(this._config)),this._internalApi.addEventListener("onSimulationTick",this._render),this._internalApi.addEventListener("onZoom",this._render),this._internalApi.addEventListener("onDrag",this._render),this._internalApi.addEventListener("reset",this._reset),this._internalApi.addEventListener("graphRebuilt",this._reset)}),s(this,"_initializePopupContent",()=>{this._popupContent||(this._popupContent=document.createElement("div"),this._popupContent.classList.add("style_module_popup__d19738e9"),this._popupElement.appendChild(this._popupContent))}),s(this,"_updatePosition",()=>{const{bindTo:e}=this._config;this._internalApi.cosmosInitialized&&void 0!==e&&("number"==typeof e?this._showOnPointIndex(e):"string"==typeof e?this._showOnPointId(e):Array.isArray(e)&&this._showAt(e))}),s(this,"_render",()=>{this._isVisible&&this._updatePosition()}),s(this,"_removePopupContent",()=>{var e;this._isVisible=!1,null==(e=this._popupContent)||e.remove(),this._popupContent=void 0}),s(this,"_reset",()=>{this._lastBindId=void 0,this._lastBindIndex=void 0,this._render()}),s(this,"remove",()=>{this._lastBindId=void 0,this._lastBindIndex=void 0,this._internalApi.removeEventListener("onSimulationTick",this._render),this._internalApi.removeEventListener("onZoom",this._render),this._internalApi.removeEventListener("onDrag",this._render),this._internalApi.removeEventListener("reset",this._reset),this._internalApi.removeEventListener("graphRebuilt",this._reset),this.hide(),this._popupContent&&this._popupContent.addEventListener("transitionend",()=>this._removePopupContent(),{once:!0})}),this._internalApi=kz(e),this._config={...m$,...t},this._initialize()}_showAt(e){var t,n;const i=f$.sanitize(this._config.content??"",{USE_PROFILES:{html:!0}});if(!this._popupContent)return;this._popupContent.innerHTML=i,this._popupContent.style.display="block";const{placement:o="bottom",offset:r=[0,8]}=this._config,s=null==(t=this._popupContent)?void 0:t.offsetWidth,a=null==(n=this._popupContent)?void 0:n.offsetHeight,l=this._internalApi.public.spaceToScreenPosition(e);if(!l)return this._removePopupContent();const[c,u]=l,h=c-s/2+r[0],d="bottom"===o?u+r[1]:u-a-r[1];this._popupContent.style.left=`${h}px`,this._popupContent.style.top=`${d}px`,this._popupContent.style.display="block"}_showOnPointIndex(e){const{placement:t}=this._config;this._internalApi.configManager.configUpdated().then(async()=>{const n=this._internalApi.public.getPointPositionByIndex(e);if(!n)return this._removePopupContent();const[i,o]=n;if(null==i||null==o)return this._removePopupContent();const r=this._internalApi.public.getPointScreenRadiusByIndex(e)/2/this._internalApi.public.getZoomLevel(),s=o+("bottom"===t?-r:r);this._showAt([i,s])})}_showOnPointId(e){this._lastBindId!==e||void 0===this._lastBindIndex?this._internalApi.configManager.cosmosInitialized().then(async()=>{const t=await this._internalApi.public.getPointIndicesByIds([e]);if(!t||void 0===t[0])return this._removePopupContent();const n=t[0];this._lastBindId=e,this._lastBindIndex=n,this._showOnPointIndex(n)}):this._showOnPointIndex(this._lastBindIndex)}setConfig(e){this._config={...this._config,...e},this._config.hidden||this._updatePosition(),void 0!==(null==e?void 0:e.hidden)&&(this._config.hidden?this.hide():this._config.hidden||this.show())}hide(){var e;this._isVisible&&(this._isVisible=!1,null==(e=this._popupContent)||e.classList.remove(_$))}show(){var e;this._isVisible||(this._isVisible=!0,null==(e=this._popupContent)||e.classList.add(_$))}};const y$={useLinksData:!1,hideWhenSizeMoreThan:120,selectOnClick:!0,useQuantiles:!0,minSubLabel:"and less",maxSubLabel:"and more"};var b$="style_module_selected__91af67ac",v$="style_module_unselected__91af67ac";Sz(".style_module_selected__91af67ac{filter:brightness(1.2)}.style_module_unselected__91af67ac{filter:brightness(.5);opacity:.7}",{});class x$ extends oU{constructor(){super(...arguments),s(this,"_uiComponentConfig",{}),s(this,"_extent"),s(this,"_manuallyHidden",!1),s(this,"_originalMaxValue",0),s(this,"_pointSizeScaleUpdateHandler"),s(this,"_linkWidthScaleUpdateHandler"),s(this,"_pointSizeUpdateHandler"),s(this,"_linkWidthUpdateHandler"),s(this,"_currentSizeAccessor"),s(this,"_currentExtent"),s(this,"_remapValues",async e=>{const t=await this._getMappingFunction();return t?e.map(e=>+t(e)):e}),s(this,"_getExtentAndRange",async()=>{const e=await this._calculateExtent();return!e||isNaN(null==e?void 0:e[0])||isNaN(null==e?void 0:e[1])?{extent:void 0,range:void 0}:{extent:e,range:await this._calculateRange(e)}}),s(this,"_onSizeScaleUpdated",async()=>{await this._updateLegend()}),s(this,"_onSizeUpdated",async()=>{var e;await this._internalApi.configManager.configUpdated(),this._currentExtent=this._uiComponentConfig.extentLabels,this._currentSizeAccessor!==this.accessor?await this.fetchData():await this._updateExtents(),await this._updateLegend(),aI(this._currentExtent,this._uiComponentConfig.extentLabels)||(null==(e=this._client)||e.resetFilter(),this.onResetClientSelections())})}get _isLinkAggregateStrategy(){const e=this._internalApi.public.activeLinkWidthStrategy;return!!this._config.useLinksData&&[ZF.Count,ZF.Sum,ZF.Average].includes(e)}get _isPointDegreeStrategy(){const e=this._internalApi.public.activePointSizeStrategy;return!this._config.useLinksData&&[XF.Degree,XF.PreciseDegree].includes(e)}get domain(){var e;const t=null==(e=this._currentData)?void 0:e.toArray()[0];return this._currentData?[t.min,t.max]:void 0}get defaultConfig(){return y$}get accessor(){const{linkWidthBy:e,pointSizeBy:t,pointIndexBy:n}=this._internalApi.config,i=this._isPointDegreeStrategy?n:t,o=e;return this._config.useLinksData?o:i}get _hasClickableEvents(){const{onClick:e,onMaxClick:t,onMinClick:n,overrideExtent:i}=this._config;return!i||void 0!==e||void 0!==t||void 0!==n}onInitialize(){this._pointSizeScaleUpdateHandler=async()=>{this._config.useLinksData||await this._onSizeScaleUpdated()},this._linkWidthScaleUpdateHandler=async()=>{this._config.useLinksData&&await this._onSizeScaleUpdated()},this._pointSizeUpdateHandler=async()=>{this._config.useLinksData||await this._onSizeUpdated()},this._linkWidthUpdateHandler=async()=>{this._config.useLinksData&&await this._onSizeUpdated()},this._internalApi.addEventListener("pointSizeScaleUpdated",this._pointSizeScaleUpdateHandler),this._internalApi.addEventListener("linkWidthScaleUpdated",this._linkWidthScaleUpdateHandler),this._internalApi.addEventListener("pointSizeUpdated",this._pointSizeUpdateHandler),this._internalApi.addEventListener("linkWidthUpdated",this._linkWidthUpdateHandler)}createUIComponent(e){return new RB(e,this.createComponentConfig(this._config))}createComponentConfig(e){return{...e,onClick:e=>{var t,n;null==(n=(t=this._config).onClick)||n.call(t,e)},onHover:e=>{var t,n;null==(n=(t=this._config).onHover)||n.call(t,e)},onMaxClick:(e,t,n)=>{var i,o;null==(o=(i=this._config).onMaxClick)||o.call(i,e,t,n),this._hasClickableEvents&&this.onSelect("max")},onMinClick:(e,t,n)=>{var i,o;null==(o=(i=this._config).onMinClick)||o.call(i,e,t,n),this._hasClickableEvents&&this.onSelect("min")}}}compareSelectedItem(e){return this.selected===e}setSelectedItem(e){var t;if(null==(t=this._uiComponent)?void 0:t.sizeElements)if(e){const t=e,n="min"===e?"max":"min";this._uiComponent.sizeElements[t].classList.remove(v$),this._uiComponent.sizeElements[t].classList.add(b$),this._uiComponent.sizeElements[n].classList.remove(b$),this._uiComponent.sizeElements[n].classList.add(v$)}else this._uiComponent.sizeElements.min.classList.remove(b$,v$),this._uiComponent.sizeElements.max.classList.remove(b$,v$)}_filterPointsByDegree(e,t){if(!this._isPointDegreeStrategy)return;const{public:{pointDegrees:n}}=this._internalApi;return void 0!==e&&(null==n?void 0:n.length)?TF(n,e,t):void 0}applyFilter(e){var t,n,i,o,r,s,a,l,c,u,h,d;if("min"===e)if(this._isPointDegreeStrategy){const e=this._filterPointsByDegree(null==(t=this._extent)?void 0:t[0],(e,t)=>e<=t);null==(n=this._client)||n.applyInFilter(e)}else if(this._isLinkAggregateStrategy){const e=this._createLinkAggregatePredicate(null==(i=this._extent)?void 0:i[0],"min");null==(o=this._client)||o.applyFilter(e)}else null==(s=this._client)||s.applyLessOrEqFilter(null==(r=this._extent)?void 0:r[0]);else if(this._isPointDegreeStrategy){const e=this._filterPointsByDegree(null==(a=this._extent)?void 0:a[1],(e,t)=>e>=t);null==(l=this._client)||l.applyInFilter(e)}else if(this._isLinkAggregateStrategy){const e=this._createLinkAggregatePredicate(null==(c=this._extent)?void 0:c[1],"max");null==(u=this._client)||u.applyFilter(e)}else null==(d=this._client)||d.applyGreaterOrEqFilter(null==(h=this._extent)?void 0:h[1])}async getCurrentData(){await this._internalApi.configManager.configUpdated();const{summary:{linksSummary:e,pointsSummary:t}}=this._internalApi,n=this._config.useLinksData?e:t,i=null==n?void 0:n.find(e=>e.column_name===this.accessor);if(i)return this._config.useQuantiles?await this._getQuantiledExtentDataForColumn():nT({min:[Number(i.min)],max:[Number(i.max)]})}async fetchData(){var e;this._currentSizeAccessor=this.accessor,this.onResetClientSelections();const{public:{activeLinkWidthStrategy:t}}=this._internalApi;this._config.useLinksData&&t===ZF.Count?(this._isValidAccessor=!0,this._currentData=void 0,null==(e=this._client)||e.setActive(!0)):await super.fetchData(),await this._updateExtents(),void 0===this._uiComponentConfig.extent&&this._uiComponent.showState()}async onConfigUpdate(){this._manuallyHidden=!!this._config.hidden,await this._updateLegend()}async shouldUpdateComponentData(){return!this._currentSizeAccessor||(await this._internalApi.configManager.configUpdated(),this._currentSizeAccessor!==this.accessor)}_getPointsDegreeExtent(){const{public:{activePointSizeStrategy:e,pointDegrees:t}}=this._internalApi;if(!(null==t?void 0:t.length))return[0,0];if(e===XF.Degree)return CF(t,uI);const[n,i]=_D(t);return uI(n,i)}async _getQuantiledExtentDataForColumn(){const e=`\n        SELECT \n          quantile("${this.accessor}", 0.05) as min,\n          quantile("${this.accessor}", 0.95) as max\n        FROM ${this.tableName}\n      `;return await this._internalApi.dbCoordinator.query(e)}_calculateExtent(){const{public:{activeLinkWidthStrategy:e}}=this._internalApi,t=e===ZF.Count;if(!this._config.useLinksData)return this._isPointDegreeStrategy?this._getPointsDegreeExtent():this.domain;if(this._isLinkAggregateStrategy){if(!t&&!this.accessor)return;const{linkAggregationManager:{countCache:n,widthSumCache:i}}=this._internalApi;if(!n||0===n.size)return this.domain;const o=Array.from(n.entries(),([n,o])=>{if(t)return o;if(e===ZF.Sum)return(null==i?void 0:i.get(n))??0;{const e=(null==i?void 0:i.get(n))??0;return o>0?e/o:0}});return CF(o,t?uI:void 0)}return this.domain}async _calculateRange(e){const{config:t,public:{activePointSizeStrategy:n}}=this._internalApi;return this._config.useLinksData||t.pointSizeByFn&&n!==XF.Auto&&!this._isPointDegreeStrategy?await this._remapValues(e):n===XF.Direct?e:t.pointSizeRange||lF}async _updateExtents(){const{public:{activePointSizeStrategy:e,activeLinkWidthStrategy:t}}=this._internalApi;if(!this._isValidAccessor||!this.useLinksData&&e===XF.Single||this.useLinksData&&t===ZF.Single)this._uiComponentConfig.extent=void 0;else if(this._config.overrideExtent)this._uiComponentConfig.extent=this._config.overrideExtent,this._uiComponentConfig.extentLabels=this._config.overrideExtent;else{const{extent:e,range:t}=await this._getExtentAndRange();(e||e&&this._isPointDegreeStrategy&&(0!==e[0]||0!==e[1]))&&t?(this._originalMaxValue=e[1],this._extent=e,this._uiComponentConfig.extent=t[0]<0?[0,t[1]]:t,this._uiComponentConfig.extentLabels=this._config.extentLabels??[e[0],e[1]]):this._uiComponentConfig.extent=void 0}}async _updateLegend(){await this._updateSizeMultiplier(),this._updateLegendVisibility(),this._checkEvents(),this._updateLabels(),this._uiComponentConfig.form=this._config.useLinksData?"line":"point",this._uiComponent.setConfig(this.createComponentConfig({...this._config,...this._uiComponentConfig}))}_updateLabels(){const{showSublabels:e,useQuantiles:t}=this._config,{public:{activePointSizeStrategy:n}}=this._internalApi,i=this._getLabelValue();this._uiComponentConfig.label=i,this._uiComponentConfig.showSublabels=e??(this._isPointDegreeStrategy?n===XF.Degree:t)}_checkEvents(){const{enableEvents:e,overrideExtent:t,onHover:n}=this._config;let i=e??!0;t&&(i=e??(this._hasClickableEvents||void 0!==n)),this._uiComponentConfig.enableEvents=i}_updateLegendVisibility(){const{extent:e,sizeMultiplier:t}=this._uiComponentConfig,{hideWhenSizeMoreThan:n}=this._config;let i=this._manuallyHidden;if(!i&&e){const o=t?t*e[1]:e[1];n&&n<o&&(i=!0)}this._uiComponentConfig.hidden=i}async _updateSizeMultiplier(){const{config:e}=this._internalApi,t=this._internalApi.public.getZoomLevel()??1,n=this._config.useLinksData?e.scaleLinksOnZoom:e.scalePointsOnZoom,i=this._config.useLinksData?e.linkWidthScale??1:e.pointSizeScale??1;this._uiComponentConfig.sizeMultiplier=n?i*t:i,n&&await this._updateMaxLabel()}async _updateMaxLabel(){const{config:e,public:{maxPointSize:t}}=this._internalApi,{extentLabels:n,sizeMultiplier:i}=this._uiComponentConfig;if(e.pointSizeByFn&&n&&!this._uiComponent.isHidden&&i){const e=await this._calcVisibleMaxLabel(t/i,n[0],this._originalMaxValue);this._uiComponentConfig.extentLabels=[n[0],e]}}async _calcVisibleMaxLabel(e,t,n){const i=await this._getMappingFunction();if(i){const o=e/i(1),r=Math.min(Math.abs(n),Math.max(Math.abs(t),Math.abs(o))),s=Math.sign(n)*r;let a=0;const l=Math.abs(s);return l>0&&(a=l<.001?6:l<.01?4:l<.1?3:l<1?2:l<10?1:0),Number(s.toFixed(a))}return 0}_getLabelValue(){const{useLinksData:e,overrideExtent:t}=this._config,{public:{activeLinkWidthStrategy:n}}=this._internalApi;if(this._isLinkAggregateStrategy)return n===ZF.Count?"count":n===ZF.Sum?`sum by ${this.accessor}`:n===ZF.Average?`average by ${this.accessor}`:this.accessor;if(!t&&!e&&this._isPointDegreeStrategy)return"connections count";const i=this._config.labelResolver;return i&&"function"==typeof i?i(this.accessor):i??this.accessor}async _getMappingFunction(){return this._config.useLinksData?await this._internalApi.public.getActiveLinkWidthFn():await this._internalApi.public.getActivePointSizeFn()}_createLinkAggregatePredicate(e,t){if(void 0===e)return;const{public:{activeLinkWidthStrategy:n}}=this._internalApi,{linkSourceIndexBy:i,linkTargetIndexBy:o,linkWidthBy:r}=this._internalApi.config;if(!i||!o)return;let s,a;switch(n){case ZF.Count:s=e_();break;case ZF.Sum:if(!r)return;s=t_(r);break;case ZF.Average:if(!r)return;s=Jm(r);break;default:return}a="min"===t?y_(s,xm(e)):b_(s,xm(e));const l=jm.from(this.tableName).select(i,o).groupby(i,o).having(a);return w_`(${bm(i)}, ${bm(o)}) IN (${l})`}hide(){this._manuallyHidden=!0,this.checkReady(()=>this.hide())&&this._uiComponent.hide()}show(){this._manuallyHidden=!1,this.checkReady(()=>this.show())&&this._uiComponent.show()}remove(){this._internalApi.removeEventListener("pointSizeScaleUpdated",this._pointSizeScaleUpdateHandler),this._internalApi.removeEventListener("linkWidthScaleUpdated",this._linkWidthScaleUpdateHandler),this._internalApi.removeEventListener("pointSizeUpdated",this._pointSizeUpdateHandler),this._internalApi.removeEventListener("linkWidthUpdated",this._linkWidthUpdateHandler),super.remove()}}const w$={useLinksData:!1,selectOnClick:!0,steps:10,overrideColors:void 0,useQuantiles:!0,useDiscreteColors:!1,minSubLabel:"and less",maxSubLabel:"and more"};var S$="style_module_selected__12a865d0",E$="style_module_unselected__12a865d0";Sz(".style_module_selected__12a865d0{filter:brightness(1.2)}.style_module_unselected__12a865d0{filter:brightness(.5);opacity:.7}",{});class T$ extends oU{constructor(){super(...arguments),s(this,"_uiComponentConfig",{}),s(this,"_linkColorUpdateHandler"),s(this,"_pointColorUpdateHandler"),s(this,"_extent"),s(this,"_currentColorAccessor"),s(this,"_currentExtent"),s(this,"_remapValues",async e=>{if(!e)return;const[t,n]=e,i=await this._getMappingFunction();return i?Array.from({length:this._config.steps},(e,o)=>{const r=t+o/(this._config.steps-1)*(n-t);return i(r)}):void 0}),s(this,"_getExtentAndRange",async()=>{const e=await this._calculateExtent();return!e||isNaN(null==e?void 0:e[0])||isNaN(null==e?void 0:e[1])?{extent:void 0,range:void 0}:{extent:e,range:await this._calculateRange(e)}})}get _isLinkAggregateStrategy(){const e=this._internalApi.public.activeLinkColorStrategy;return!!this._config.useLinksData&&[YF.Count,YF.Sum,YF.Average].includes(e)}get _isPointDegreeStrategy(){const e=this._internalApi.public.activePointColorStrategy;return!this._config.useLinksData&&[WF.Degree,WF.PreciseDegree].includes(e)}get domain(){var e;const t=null==(e=this._currentData)?void 0:e.toArray()[0];return this._currentData?[t.min,t.max]:void 0}get defaultConfig(){return w$}get accessor(){const{linkColorBy:e,pointColorBy:t,pointIndexBy:n}=this._internalApi.config,i=this._isPointDegreeStrategy?n:t,o=e;return this._config.useLinksData?o:i}get _hasClickableEvents(){const{onClick:e,onMaxClick:t,onMinClick:n,overrideColors:i}=this._config;return!i||void 0!==e||void 0!==t||void 0!==n}onInitialize(){this._linkColorUpdateHandler=async()=>{this._config.useLinksData&&await this._onColorUpdated()},this._pointColorUpdateHandler=async()=>{this._config.useLinksData||await this._onColorUpdated()},this._internalApi.addEventListener("pointColorUpdated",this._pointColorUpdateHandler),this._internalApi.addEventListener("linkColorUpdated",this._linkColorUpdateHandler)}createUIComponent(e){return new BB(e,this.createComponentConfig(this._config))}createComponentConfig(e){return{...e,onClick:e=>{var t,n;null==(n=(t=this._config).onClick)||n.call(t,e)},onHover:e=>{var t,n;null==(n=(t=this._config).onHover)||n.call(t,e)},onMaxClick:(e,t,n)=>{var i,o;null==(o=(i=this._config).onMaxClick)||o.call(i,e,t,n),this._hasClickableEvents&&this.onSelect("max")},onMinClick:(e,t,n)=>{var i,o;null==(o=(i=this._config).onMinClick)||o.call(i,e,t,n),this._hasClickableEvents&&this.onSelect("min")}}}compareSelectedItem(e){return this.selected===e}setSelectedItem(e){var t,n,i,o,r,s;if(e){const r=e,s="min"===e?"max":"min";null==(t=this._uiComponent.extentElements)||t[r].classList.remove(E$),null==(n=this._uiComponent.extentElements)||n[r].classList.add(S$),null==(i=this._uiComponent.extentElements)||i[s].classList.remove(S$),null==(o=this._uiComponent.extentElements)||o[s].classList.add(E$)}else null==(r=this._uiComponent.extentElements)||r.min.classList.remove(S$,E$),null==(s=this._uiComponent.extentElements)||s.max.classList.remove(S$,E$)}_filterPointsByDegree(e,t){if(!this._isPointDegreeStrategy)return;const{public:{pointDegrees:n}}=this._internalApi;return void 0!==e&&(null==n?void 0:n.length)?TF(n,e,t):void 0}applyFilter(e){var t,n,i,o,r,s,a,l,c,u,h,d;if("min"===e)if(this._isPointDegreeStrategy){const e=this._filterPointsByDegree(null==(t=this._extent)?void 0:t[0],(e,t)=>e<=t);null==(n=this._client)||n.applyInFilter(e)}else if(this._isLinkAggregateStrategy){const e=this._createLinkAggregatePredicate(null==(i=this._extent)?void 0:i[0],"min");null==(o=this._client)||o.applyFilter(e)}else null==(s=this._client)||s.applyLessOrEqFilter(null==(r=this._extent)?void 0:r[0]);else if(this._isPointDegreeStrategy){const e=this._filterPointsByDegree(null==(a=this._extent)?void 0:a[1],(e,t)=>e>=t);null==(l=this._client)||l.applyInFilter(e)}else if(this._isLinkAggregateStrategy){const e=this._createLinkAggregatePredicate(null==(c=this._extent)?void 0:c[1],"max");null==(u=this._client)||u.applyFilter(e)}else null==(d=this._client)||d.applyGreaterOrEqFilter(null==(h=this._extent)?void 0:h[1])}async getCurrentData(){await this._internalApi.configManager.configUpdated();const{summary:{linksSummary:e,pointsSummary:t}}=this._internalApi,n=this._config.useLinksData?e:t,i=null==n?void 0:n.find(e=>e.column_name===this.accessor);if(i)return this._config.useQuantiles?await this._getQuantiledExtentDataForColumn():nT({min:[Number(i.min)],max:[Number(i.max)]})}async fetchData(){var e;this._currentColorAccessor=null==(e=this.accessor)?void 0:e.toString(),this.onResetClientSelections(),await super.fetchData(),await this._updateExtents(),void 0===this._uiComponentConfig.extent&&this._uiComponent.showState()}async onConfigUpdate(){await this._updateLegend()}async shouldUpdateComponentData(){return!this._currentColorAccessor||(await this._internalApi.configManager.configUpdated(),this._currentColorAccessor!==this.accessor)}_createLinkAggregatePredicate(e,t){if(void 0===e)return;const{public:{activeLinkColorStrategy:n}}=this._internalApi,{linkSourceIndexBy:i,linkTargetIndexBy:o,linkColorBy:r}=this._internalApi.config;if(!i||!o)return;let s,a;switch(n){case YF.Count:s=e_();break;case YF.Sum:if(!r)return;s=t_(r);break;case YF.Average:if(!r)return;s=Jm(r);break;default:return}a="min"===t?y_(s,xm(e)):b_(s,xm(e));const l=jm.from(this.tableName).select(i,o).groupby(i,o).having(a);return w_`(${bm(i)}, ${bm(o)}) IN (${l})`}async _onColorUpdated(){var e;await this._internalApi.configManager.configUpdated(),this._currentExtent=this._uiComponentConfig.extentLabels,this._currentColorAccessor!==this.accessor?await this.fetchData():await this._updateExtents(),await this._updateLegend(),aI(this._currentExtent,this._uiComponentConfig.extentLabels)||(null==(e=this._client)||e.resetFilter(),this.onResetClientSelections())}_getPointsDegreeExtent(){const{public:{activePointColorStrategy:e,pointDegrees:t}}=this._internalApi;if(!(null==t?void 0:t.length))return[0,0];if(e===WF.Degree)return CF(t,uI);const[n,i]=_D(t);return uI(n,i)}async _getQuantiledExtentDataForColumn(){const e=`\n        SELECT \n          quantile("${this.accessor}", 0.05) as min,\n          quantile("${this.accessor}", 0.95) as max\n        FROM ${this.tableName}\n      `;return await this._internalApi.dbCoordinator.query(e)}_calculateExtent(){const{public:{activeLinkColorStrategy:e}}=this._internalApi,t=e===YF.Count;if(!this._config.useLinksData)return this._isPointDegreeStrategy?this._getPointsDegreeExtent():this.domain;if(this._isLinkAggregateStrategy){if(!this.accessor)return;const{linkAggregationManager:{countCache:n,colorSumCache:i}}=this._internalApi;if(!n||0===n.size)return this.domain;const o=Array.from(n.entries(),([n,o])=>{if(t)return o;if(e===YF.Sum)return(null==i?void 0:i.get(n))??0;{const e=(null==i?void 0:i.get(n))??0;return o>0?e/o:0}});return CF(o,t?uI:void 0)}return this.domain}async _calculateRange(e){const{public:{activePointColorStrategy:t}}=this._internalApi;if(this._config.useLinksData||t!==WF.Map&&t!==WF.LinkDirection)return await this._remapValues(e);this._uiComponent.showState()}async _getMappingFunction(){return this._config.useLinksData?await this._internalApi.public.getActiveLinkColorFn():await this._internalApi.public.getActivePointColorFn()}async _updateExtents(){const{public:{activePointColorStrategy:e,activeLinkColorStrategy:t}}=this._internalApi;if(!this._isValidAccessor||!this.useLinksData&&e===WF.Single||this.useLinksData&&t===YF.Single)this._uiComponentConfig.extent=void 0;else if(this._config.overrideColors)this._uiComponentConfig.extent=this._config.overrideColors,this._uiComponentConfig.extentLabels=this._config.extentLabels;else{const{extent:e,range:t}=await this._getExtentAndRange();e||e&&this._isPointDegreeStrategy&&(0!==e[0]||0!==e[1])?(this._extent=e,this._uiComponentConfig.extent=t,this._uiComponentConfig.extentLabels=this._config.extentLabels??[e[0],e[1]]):this._uiComponentConfig.extent=void 0}}_checkEvents(){const{enableEvents:e,overrideColors:t,onHover:n}=this._config;let i=e??!0;t&&(i=e??(this._hasClickableEvents||void 0!==n)),this._uiComponentConfig.enableEvents=i}_updateLabels(){const{showSublabels:e,useQuantiles:t}=this._config,{public:{activePointColorStrategy:n}}=this._internalApi;this._uiComponentConfig.label=this._getLabelValue(),this._uiComponentConfig.showSublabels=e??(this._isPointDegreeStrategy?n===WF.Degree:t)}async _updateLegend(){const{public:{activePointColorStrategy:e,activeLinkColorStrategy:t}}=this._internalApi,{overrideColors:n,useDiscreteColors:i}=this._config,o=this._config.useLinksData?t===YF.Categorical:e===WF.Categorical;this._uiComponentConfig.discreteColors=n?i:o,this._checkEvents(),this._updateLabels(),this._uiComponent.setConfig(this.createComponentConfig({...this._config,...this._uiComponentConfig}))}_getLabelValue(){const{useLinksData:e,overrideColors:t}=this._config,{public:{activeLinkColorStrategy:n}}=this._internalApi;if(this._isLinkAggregateStrategy)return n===YF.Count?"count":n===YF.Sum?`sum by ${this.accessor}`:n===YF.Average?`average by ${this.accessor}`:this.accessor;if(!t&&!e&&this._isPointDegreeStrategy)return"connections count";const i=this._config.labelResolver;return i&&"function"==typeof i?i(this.accessor):i??this.accessor}hide(){this.checkReady(()=>this.hide())&&this._uiComponent.hide()}show(){this.checkReady(()=>this.show())&&this._uiComponent.show()}remove(){this._internalApi.removeEventListener("pointColorUpdated",this._pointColorUpdateHandler),this._internalApi.removeEventListener("linkColorUpdated",this._linkColorUpdateHandler),super.remove()}}const C$={0:"source",1:"source+target",2:"target",3:"not linked"},I$=Object.fromEntries(Object.entries(C$).map(([e,t])=>[t,e])),A$={useLinksData:!1,selectOnClick:!0,hideUnknown:!0,resetSelectionOnCollapse:!0,showLabel:!1};class k$ extends oU{constructor(){super(...arguments),s(this,"_uiComponentConfig",{}),s(this,"_linkColorUpdateHandler"),s(this,"_pointColorUpdateHandler"),s(this,"_currentColorAccessor"),s(this,"_fetchDataPromise",null),s(this,"_onColorUpdated",async()=>{this._fetchDataPromise&&await this._fetchDataPromise,await this._internalApi.configManager.configUpdated(),this._currentColorAccessor!==this.accessor?await this.fetchData():await this._updateItems(),await this._updateLegend()})}get _summary(){const{summary:{linksSummary:e,pointsSummary:t}}=this._internalApi;return this._config.useLinksData?e:t}get _isLinkDirectionStrategy(){return!this.useLinksData&&this._internalApi.public.activePointColorStrategy===WF.LinkDirection}get defaultConfig(){return A$}get accessor(){const{linkColorBy:e,pointColorBy:t,pointIndexBy:n}=this._internalApi.config;return this._config.useLinksData?e:this._isLinkDirectionStrategy?n:t}get _hasClickableEvents(){const{onClick:e,overrideItems:t}=this._config;return!t||void 0!==e}onInitialize(){this._linkColorUpdateHandler=async()=>{this._config.useLinksData&&await this._onColorUpdated()},this._pointColorUpdateHandler=async()=>{this._config.useLinksData||await this._onColorUpdated()},this._internalApi.addEventListener("pointColorUpdated",this._pointColorUpdateHandler),this._internalApi.addEventListener("linkColorUpdated",this._linkColorUpdateHandler)}createUIComponent(e){return new WB(e,this.createComponentConfig(this._config))}createComponentConfig(e){return{...e,onClick:(e,t)=>{var n,i;null==(i=(n=this._config).onClick)||i.call(n,e,t),this._hasClickableEvents&&this.onSelect(t)},onHover:(e,t)=>{var n,i;null==(i=(n=this._config).onHover)||i.call(n,e,t)},onShowMoreClick:e=>{var t,n;null==(n=(t=this._config).onShowMoreClick)||n.call(t,e),this._config.resetSelectionOnCollapse&&this.selected&&!e&&this.onSelect(void 0)}}}compareSelectedItem(e){var t;return(null==(t=this.selected)?void 0:t.label)===(null==e?void 0:e.label)}setSelectedItem(e){this._uiComponent.setSelectedItem(e)}applyFilter(e){var t,n;if(this._isLinkDirectionStrategy){if(!e)return;const n=Number(I$[e.label]),i=this._internalApi.public.pointDirections;if(!i)return;const o=TF(i,n,(e,t)=>e===t);null==(t=this._client)||t.applyInFilter(o)}else null==(n=this._client)||n.applyExactFilter(null==e?void 0:e.label)}async fetchData(){return this._fetchDataPromise&&await this._fetchDataPromise,this._fetchDataPromise=(async()=>{var e;try{this._currentColorAccessor=null==(e=this.accessor)?void 0:e.toString(),await super.fetchData(),await this._updateItems(),this.onResetClientSelections()}finally{this._fetchDataPromise=null}})(),this._fetchDataPromise}async onConfigUpdate(){await this._updateLegend()}async getCurrentData(){var e;if(await this._internalApi.configManager.configUpdated(),(null==(e=this._summary)?void 0:e.find(e=>e.column_name===this.accessor))&&this._summary)return await this._getDistinctValues(this._summary)}async shouldUpdateComponentData(){return!this._currentColorAccessor||(await this._internalApi.configManager.configUpdated(),this._currentColorAccessor!==this.accessor)}async _getDistinctValues(e){var t;const{public:{activePointColorStrategy:n}}=this._internalApi;let i="DESC";!this.useLinksData&&[WF.Continuous,WF.Categorical].includes(n)&&(i=this._config.sortOrder??"DESC");const o=`ORDER BY "${this._config.sortBy??"count"}" ${i}`,r=null==(t=e.find(e=>e.column_name===this.accessor))?void 0:t.column_type;return await this._internalApi.dbCoordinator.query((e=>"VARCHAR"===e?`SELECT "${this.accessor}", COUNT(*) as count \n                FROM ${this.tableName}\n                GROUP BY "${this.accessor}"\n                ${o}`:`SELECT DISTINCT "${this.accessor}"\n                FROM ${this.tableName}\n                ORDER BY "${this.accessor}" ${this._config.sortOrder||i}`)(r))}_checkEvents(){const{enableEvents:e,overrideItems:t,onHover:n}=this._config;let i=e??!0;t&&(i=e??(this._hasClickableEvents||void 0!==n)),this._uiComponentConfig.enableEvents=i}async _updateLegend(){this._checkEvents();const e=this.accessor;if(this._config.showLabel){const t=this._config.labelResolver,n="function"==typeof t?t(e):t;this._uiComponentConfig.label=n??e}else this._uiComponentConfig.label=void 0;this._uiComponent.setConfig(this.createComponentConfig({...this._config,...this._uiComponentConfig}))}async _updateItems(){var e,t;const{activePointColorStrategy:n,activeLinkColorStrategy:i}=this._internalApi.public,{overrideItems:o}=this._config;if(o)this._uiComponentConfig.items=o;else{if(!this.useLinksData&&n===WF.LinkDirection){const e=this._internalApi.public.pointDirections;if(e){const t=Array.from(new Set(e)).map(String);this._uiComponentConfig.items=await this._createLegendItems(t)}return}const o=[WF.Degree,WF.PreciseDegree,WF.Single,WF.Direct].includes(n),r=[YF.Direct,YF.Single].includes(i);if(!this.accessor||!this.useLinksData&&o||this.useLinksData&&r)return this._uiComponentConfig.items=void 0,void this._uiComponent.showState();if(null==(e=this._currentData)?void 0:e.numRows){const e=null==(t=this._currentData.getChildAt(0))?void 0:t.toArray();if(e)return void(this._uiComponentConfig.items=await this._createLegendItems(e))}this._uiComponentConfig.items=void 0}}async _createLegendItems(e){const{public:{activePointColorStrategy:t},config:n}=this._internalApi,i=await this._getMappingFunction();if(i){const o=UF(null==n?void 0:n.unknownColor,pF),r=e=>({color:UF(i(e),o),label:String(e)});if(!this.useLinksData&&t===WF.LinkDirection)return Array.from(e,e=>({color:UF(i(e),o),label:C$[e]}));if(this.useLinksData||t!==WF.Map)return Array.from(e,r);{const t=new Set(Object.keys(n.pointColorByMap??{}));return[...Array.from(e.filter(e=>t.has(e)),r),...this._config.hideUnknown?[]:Array.from(e.filter(e=>!t.has(e)),r)]}}return[]}async _getMappingFunction(){return this._config.useLinksData?await this._internalApi.public.getActiveLinkColorFn():await this._internalApi.public.getActivePointColorFn()}show(){this.checkReady(()=>this.show())&&this._uiComponent.show()}hide(){this.checkReady(()=>this.hide())&&this._uiComponent.hide()}remove(){this._internalApi.removeEventListener("pointColorUpdated",this._pointColorUpdateHandler),this._internalApi.removeEventListener("linkColorUpdated",this._linkColorUpdateHandler),super.remove()}}const L$={onClick:void 0,iconSvg:'\n<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n  <path d="m21 21-6-6m6 6v-4.8m0 4.8h-4.8"/>\n  <path d="M3 16.2V21m0 0h4.8M3 21l6-6"/>\n  <path d="M21 7.8V3m0 0h-4.8M21 3l-6 6"/>\n  <path d="M3 7.8V3m0 0h4.8M3 3l6 6"/>\n</svg>\n',duration:250,padding:.1,description:"Fit view"};let R$=class{constructor(e,t,n={}){s(this,"_internalApi"),s(this,"_config"),s(this,"_uiButtonConfig"),s(this,"_fitViewButton"),s(this,"_handleClick",()=>{var e,t;null==(t=(e=this._config).onClick)||t.call(e),this._internalApi.public.fitView(this._config.duration,this._config.padding)}),s(this,"_show",()=>{this._fitViewButton.show()}),this._internalApi=kz(e),this._fitViewButton=new XB(t),this._internalApi.addEventListener("graphRebuilt",this._show),this.setConfig(n)}setConfig(e={}){this._config=IO(L$,e),this._uiButtonConfig={...this._config,onClick:this._handleClick},this._fitViewButton.setConfig(this._uiButtonConfig)}remove(){this._fitViewButton.destroy(),this._internalApi.removeEventListener("graphRebuilt",this._show)}};const P$='\n<svg width="100%" height="100%" viewBox="0 0 15 18" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\n  <path d="M15 9L-8.15666e-07 17.6603L-5.85621e-08 0.339745L15 9Z"/>\n</svg>',D$={onClick:void 0,iconSvg:P$,description:"Play/Pause"};let M$=class{constructor(e,t,n={}){s(this,"_internalApi"),s(this,"_config",D$),s(this,"_playPauseButton"),s(this,"_update",()=>{this._internalApi.cosmos&&(!1===this._internalApi.cosmos.config.enableSimulation?this._playPauseButton.hide():this._playPauseButton.show(),this._config.iconSvg=this._internalApi.public.isSimulationRunning?'\n<svg width="100%" height="100%" viewBox="0 0 14 18" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M4.91659 0.666656H0.333252V17.3333H4.91659V0.666656ZM13.6666 0.666656H9.08325V17.3333H13.6666V0.666656Z"/>\n</svg>\n':P$,this._playPauseButton.setConfig(this._config))}),this._internalApi=kz(e),this._playPauseButton=new XB(t,{iconSvg:P$}),this._internalApi.addEventListener("onSimulationEnd",this._update),this._internalApi.addEventListener("onSimulationStart",this._update),this._internalApi.addEventListener("onSimulationPause",this._update),this._internalApi.addEventListener("graphRebuilt",this._update),this.setConfig(n)}setConfig(e={}){this._config=IO(D$,e),this._config.onClick=()=>{var t;if(null==(t=null==e?void 0:e.onClick)||t.call(e),0!==this._internalApi.public.progress||this._internalApi.public.isSimulationRunning)if(this._internalApi.public.isSimulationRunning)this._internalApi.public.pause();else{if(1===this._internalApi.public.progress)return void this._internalApi.public.start();this._internalApi.public.unpause()}else this._internalApi.public.start()},this._update()}remove(){this._playPauseButton.destroy(),this._internalApi.removeEventListener("onSimulationEnd",this._update),this._internalApi.removeEventListener("onSimulationStart",this._update),this._internalApi.removeEventListener("onSimulationPause",this._update),this._internalApi.removeEventListener("graphRebuilt",this._update)}};const N$={onClick:void 0,iconSvg:'\n<svg width="100%" height="100%" viewBox="0 0 96 96" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-miterlimit:2;">\n    <style type="text/css">\n        .st0{fill:none;fill-rule:nonzero;stroke:currentColor;stroke-width:8px;}\n    </style>\n    <g>\n        <path d="M92.8,71.003L92.8,83.2L75.058,83.2" class="st0"/>\n        <path d="M65.014,83.2L34.968,83.2" class="st0"/>\n        <path d="M24.994,83.2L4,83.2L4,71.003" class="st0"/>\n        <path d="M4,60.954L4,35.036" class="st0"/>\n        <path d="M4,25.06L4,11.8L24.994,11.8" class="st0"/>\n        <path d="M34.968,11.8L65.014,11.8" class="st0"/>\n        <path d="M75.058,11.8L92.8,11.8L92.8,25.06" class="st0"/>\n        <path d="M92.8,35.036L92.8,60.954" class="st0"/>\n    </g>\n</svg>\n',description:"Rectangle selection"};class O${constructor(e,t,n={}){s(this,"_internalApi"),s(this,"_config"),s(this,"_selectRectButton"),s(this,"_rectSelectedHandler"),s(this,"_show",()=>{this._selectRectButton.show()}),this._internalApi=kz(e),this._config=IO(N$,n),this._config.onClick=()=>{var e;null==(e=null==n?void 0:n.onClick)||e.call(n),this._internalApi.public.activateRectSelection()},this._selectRectButton=new XB(t,this._config),this._rectSelectedHandler=()=>{this._internalApi.public.deactivateRectSelection()},this._internalApi.addEventListener("graphRebuilt",this._show),this._internalApi.addEventListener("rectSelected",this._rectSelectedHandler)}setConfig(e={}){this._config=IO(N$,e)}remove(){this._selectRectButton.destroy(),this._internalApi.removeEventListener("graphRebuilt",this._show),this._internalApi.removeEventListener("rectSelected",this._rectSelectedHandler)}}const B$={onClick:void 0,iconSvg:'\n<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" transform="scale(1.15)"><path fill="currentColor" fill-rule="evenodd" d="M21.72.226a1 1 0 0 1 .587.936l-.336 13.583a1 1 0 0 1-.685.924l-8.893 2.948a2.6 2.6 0 0 1-.028.692a2.93 2.93 0 0 1 1.429 1.495c.342.792.33 1.645.198 2.267a1 1 0 0 1-1.956-.417c.07-.328.06-.739-.078-1.056c-.098-.226-.27-.444-.655-.565l-.064.05c-.667.512-1.545.8-2.475.8s-1.808-.288-2.476-.8c-.668-.511-1.165-1.289-1.165-2.224s.497-1.712 1.165-2.224q.232-.178.495-.318L1.782 5.237a1 1 0 0 1 1.092-1.394l11.694 2.146L20.63.402a1 1 0 0 1 1.09-.176m-1.73 13.766l-8.53 2.828a3 3 0 0 0-.22-.185c-.668-.511-1.546-.799-2.476-.799H8.76L4.39 6.154l10.308 1.892a1 1 0 0 0 .859-.248l4.692-4.326zm-12.485 4.23c-.288.22-.382.455-.382.637s.094.416.382.637c.288.22.73.386 1.259.386s.97-.165 1.259-.386c.288-.22.382-.455.382-.637s-.094-.416-.382-.637c-.289-.22-.73-.386-1.26-.386s-.97.165-1.258.386" clip-rule="evenodd"/></svg>\n',description:"Polygonal selection"};class F${constructor(e,t,n={}){s(this,"_internalApi"),s(this,"_config"),s(this,"_selectPolygonButton"),s(this,"_polygonSelectedHandler"),s(this,"_show",()=>{this._selectPolygonButton.show()}),this._internalApi=kz(e),this._config=IO(B$,n),this._config.onClick=()=>{var e;null==(e=null==n?void 0:n.onClick)||e.call(n),this._internalApi.public.activatePolygonalSelection()},this._selectPolygonButton=new XB(t,this._config),this._polygonSelectedHandler=()=>{this._internalApi.public.deactivatePolygonalSelection()},this._internalApi.addEventListener("graphRebuilt",this._show),this._internalApi.addEventListener("polygonSelected",this._polygonSelectedHandler)}setConfig(e={}){this._config=IO(B$,e)}remove(){this._selectPolygonButton.destroy(),this._internalApi.removeEventListener("graphRebuilt",this._show),this._internalApi.removeEventListener("polygonSelected",this._polygonSelectedHandler)}}const z$={onZoomInClick:void 0,onZoomOutClick:void 0,zoomInIconSvg:'\n<svg width="100%" height="100%" viewBox="0 0 24 24" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">\n  <path d="M4 12H20M12 4V20" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',zoomOutIconSvg:'\n<svg width="100%" height="100%" viewBox="0 0 24 24" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">\n  <path d="M4 12H20" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',duration:250,zoomIncrement:1.4};var U$="style_module_zoomButton__738b35dc";Sz(".style_module_zoomButtons__738b35dc{height:50px;margin:3px;width:25px}.style_module_zoomButton__738b35dc{height:50%;margin:0;width:100%}.style_module_zoomInButton__738b35dc{border-radius:2px 2px 0 0}.style_module_zoomOutButton__738b35dc{border-radius:0 0 2px 2px}",{});class $${constructor(e,t,n){s(this,"_internalApi"),s(this,"_config"),s(this,"_zoomInButtonConfig"),s(this,"_zoomOutButtonConfig"),s(this,"_zoomInButton"),s(this,"_zoomOutButton"),s(this,"_zoomInButtonDiv"),s(this,"_zoomOutButtonDiv"),s(this,"_show",()=>{this._zoomInButton.show(),this._zoomOutButton.show()}),this._internalApi=kz(e),t.classList.add("style_module_zoomButtons__738b35dc"),this._zoomInButtonDiv=document.createElement("div"),this._zoomInButtonDiv.classList.add(U$,"style_module_zoomInButton__738b35dc"),this._zoomOutButtonDiv=document.createElement("div"),this._zoomOutButtonDiv.classList.add(U$,"style_module_zoomOutButton__738b35dc"),t.appendChild(this._zoomInButtonDiv),t.appendChild(this._zoomOutButtonDiv),this._zoomInButton=new XB(this._zoomInButtonDiv),this._zoomOutButton=new XB(this._zoomOutButtonDiv),this._internalApi.addEventListener("graphRebuilt",this._show),this.setConfig(n??{})}setConfig(e){this._config=IO(z$,e??{}),this._zoomInButtonConfig={onClick:()=>{var e,t;const n=this._internalApi.public.getZoomLevel();if(n){const e=this._config.zoomIncrement??z$.zoomIncrement;this._internalApi.public.setZoomLevel(n*e,this._config.duration)}null==(t=(e=this._config).onZoomInClick)||t.call(e)},iconSvg:this._config.zoomInIconSvg},this._zoomOutButtonConfig={onClick:()=>{var e,t;const n=this._internalApi.public.getZoomLevel();if(n){const e=this._config.zoomIncrement??z$.zoomIncrement;this._internalApi.public.setZoomLevel(n/e,this._config.duration)}null==(t=(e=this._config).onZoomOutClick)||t.call(e)},iconSvg:this._config.zoomOutIconSvg},this._zoomInButton.setConfig(this._zoomInButtonConfig),this._zoomOutButton.setConfig(this._zoomOutButtonConfig)}remove(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._internalApi.removeEventListener("graphRebuilt",this._show)}}class V${constructor(e,t,n={}){s(this,"_button"),this._button=new XB(t,n)}setConfig(e={}){this._button.setConfig(e)}remove(){this._button.destroy()}show(){this._button.show()}hide(){this._button.hide()}}export{ai as $,qi as A,ni as B,_o as C,Wi as D,io as E,ui as F,Ki as G,Bn as H,hi as I,Fn as J,eo as K,T$ as L,ri as M,Oi as N,ho as O,so as P,oi as Q,Ri as T,zn as U,c as _,TD as a,dD as b,iU as c,mU as d,_D as e,k$ as f,a as g,tU as h,V$ as i,R$ as j,M$ as k,O$ as l,LD as m,AD as n,pU as o,F$ as p,$$ as q,Jz as r,g$ as s,kD as t,Lo as u,Po as v,Di as w,x$ as x,Mi as y,Hz as z};
