const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PathMapMapLibre-T4Z0ZoUt.js","assets/index-CdwYueSG.js","assets/BasemapLayer-DAxIlO26.js","assets/useMapViewStore-COYDTQJ4.js","assets/index-BaK1kOPF.js","assets/index-DUfCykEc.css","assets/BasemapLayer-B1CfjdFi.css"])))=>i.map(i=>d[i]);
import{r as m,aD as xs,d as xe,bd as hs,be as Ft,bf as ms,bg as us,j as e,c as z,B as rt,bh as ps,x as it,q as P,bi as It,R as ge,bj as At,bk as Dt,bl as Ht,bm as me,bn as Xe,$ as Qe,bo as fs,bp as gs,bq as ys,m as de,a7 as oe,w as js,br as bs,bs as ie,bt as pt,bu as Ns,bv as vs,bw as ws,bx as ks,by as Cs,bz as Ze,bA as Ss,a3 as _s,E as Ot,bB as Ms,bC as Ts,bD as Ps,bE as Bs,ac as $t,ad as Ut,A as qe,bF as Ls,ae as Rs,bG as Es,bH as lt}from"./index-CdwYueSG.js";import{p as zs,d as Fs,e as Vt,g as Is,b as As}from"./primitives-BiOSQYsZ.js";import{u as Ds,r as Hs,a as Os,b as $s,c as Us,d as Vs,i as Ws}from"./consumer-registry-DhVehOm2.js";import{D as Me,R as Ae,P as Te,g as Gs}from"./badge-colors-BNUqIXCA.js";import{g as Wt,e as Se,a as Gt}from"./chat-utils-B3hkabuB.js";import{P as Qt,d as qt,a as Qs,b as qs}from"./payload-decoders-C2OKjW7M.js";import{A as ue,S as De,i as He,C as ye,a as Ks,g as ft}from"./SignalIndicator-B7F9Dvpc.js";import{a as Ys,A as Kt}from"./arrow-up-DSinL38e.js";import{C as ct}from"./chevron-right-Clx_OSXY.js";import{f as Xs,r as Zs}from"./usePipelineStore-DPGbI6IX.js";import{M as Oe}from"./map-pin-BTzarosW.js";import{C as Js}from"./circle-question-mark-Bdu9dBju.js";import{T as Je}from"./triangle-alert-DaComX7z.js";import{D as ee}from"./DataBox-D9AB1NGO.js";import{L as en}from"./layers-BiC-Ns73.js";import{H as Yt}from"./hash-L59YOER_.js";import{A as tn}from"./activity-B7U7wJdR.js";import{C as sn}from"./circle-check-D1pZScos.js";import{D as nn}from"./database-BZ4a6Qd1.js";import{H as an,D as et,Z as gt,u as rn}from"./useMapViewStore-COYDTQJ4.js";import{S as Ee}from"./shield-C_TDkZ-m.js";import{C as Xt}from"./TimeRangeStepper-DCz-TWVT.js";function ke(t,a,s){let n=s.initialDeps??[],r,i=!0;function l(){var c,o,h;let d;s.key&&((c=s.debug)!=null&&c.call(s))&&(d=Date.now());const g=t();if(!(g.length!==n.length||g.some((x,v)=>n[v]!==x)))return r;n=g;let y;if(s.key&&((o=s.debug)!=null&&o.call(s))&&(y=Date.now()),r=a(...g),s.key&&((h=s.debug)!=null&&h.call(s))){const x=Math.round((Date.now()-d)*100)/100,v=Math.round((Date.now()-y)*100)/100,p=v/16,w=(j,b)=>{for(j=String(j);j.length<b;)j=" "+j;return j};console.info(`%c⏱ ${w(v,5)} /${w(x,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*p,120))}deg 100% 31%);`,s==null?void 0:s.key)}return s!=null&&s.onChange&&!(i&&s.skipInitialOnChange)&&s.onChange(r),i=!1,r}return l.updateDeps=c=>{n=c},l}function yt(t,a){if(t===void 0)throw new Error("Unexpected undefined");return t}const ln=(t,a)=>Math.abs(t-a)<1.01,cn=(t,a,s)=>{let n;return function(...r){t.clearTimeout(n),n=t.setTimeout(()=>a.apply(this,r),s)}},jt=t=>{const{offsetWidth:a,offsetHeight:s}=t;return{width:a,height:s}},on=t=>t,dn=t=>{const a=Math.max(t.startIndex-t.overscan,0),s=Math.min(t.endIndex+t.overscan,t.count-1),n=[];for(let r=a;r<=s;r++)n.push(r);return n},xn=(t,a)=>{const s=t.scrollElement;if(!s)return;const n=t.targetWindow;if(!n)return;const r=l=>{const{width:c,height:o}=l;a({width:Math.round(c),height:Math.round(o)})};if(r(jt(s)),!n.ResizeObserver)return()=>{};const i=new n.ResizeObserver(l=>{const c=()=>{const o=l[0];if(o!=null&&o.borderBoxSize){const h=o.borderBoxSize[0];if(h){r({width:h.inlineSize,height:h.blockSize});return}}r(jt(s))};t.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(c):c()});return i.observe(s,{box:"border-box"}),()=>{i.unobserve(s)}},bt={passive:!0},Nt=typeof window>"u"?!0:"onscrollend"in window,hn=(t,a)=>{const s=t.scrollElement;if(!s)return;const n=t.targetWindow;if(!n)return;let r=0;const i=t.options.useScrollendEvent&&Nt?()=>{}:cn(n,()=>{a(r,!1)},t.options.isScrollingResetDelay),l=d=>()=>{const{horizontal:g,isRtl:u}=t.options;r=g?s.scrollLeft*(u&&-1||1):s.scrollTop,i(),a(r,d)},c=l(!0),o=l(!1);s.addEventListener("scroll",c,bt);const h=t.options.useScrollendEvent&&Nt;return h&&s.addEventListener("scrollend",o,bt),()=>{s.removeEventListener("scroll",c),h&&s.removeEventListener("scrollend",o)}},mn=(t,a,s)=>{if(a!=null&&a.borderBoxSize){const n=a.borderBoxSize[0];if(n)return Math.round(n[s.options.horizontal?"inlineSize":"blockSize"])}return t[s.options.horizontal?"offsetWidth":"offsetHeight"]},un=(t,{adjustments:a=0,behavior:s},n)=>{var r,i;const l=t+a;(i=(r=n.scrollElement)==null?void 0:r.scrollTo)==null||i.call(r,{[n.options.horizontal?"left":"top"]:l,behavior:s})};class pn{constructor(a){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.currentScrollToIndex=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let s=null;const n=()=>s||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:s=new this.targetWindow.ResizeObserver(r=>{r.forEach(i=>{const l=()=>{this._measureElement(i.target,i)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(l):l()})}));return{disconnect:()=>{var r;(r=n())==null||r.disconnect(),s=null},observe:r=>{var i;return(i=n())==null?void 0:i.observe(r,{box:"border-box"})},unobserve:r=>{var i;return(i=n())==null?void 0:i.unobserve(r)}}})(),this.range=null,this.setOptions=s=>{Object.entries(s).forEach(([n,r])=>{typeof r>"u"&&delete s[n]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:on,rangeExtractor:dn,onChange:()=>{},measureElement:mn,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...s}},this.notify=s=>{var n,r;(r=(n=this.options).onChange)==null||r.call(n,this,s)},this.maybeNotify=ke(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),s=>{this.notify(s)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(s=>s()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var s;const n=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==n){if(this.cleanup(),!n){this.maybeNotify();return}this.scrollElement=n,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((s=this.scrollElement)==null?void 0:s.window)??null,this.elementsCache.forEach(r=>{this.observer.observe(r)}),this.unsubs.push(this.options.observeElementRect(this,r=>{this.scrollRect=r,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(r,i)=>{this.scrollAdjustments=0,this.scrollDirection=i?this.getScrollOffset()<r?"forward":"backward":null,this.scrollOffset=r,this.isScrolling=i,this.maybeNotify()})),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0})}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(s,n)=>{const r=new Map,i=new Map;for(let l=n-1;l>=0;l--){const c=s[l];if(r.has(c.lane))continue;const o=i.get(c.lane);if(o==null||c.end>o.end?i.set(c.lane,c):c.end<o.end&&r.set(c.lane,!0),r.size===this.options.lanes)break}return i.size===this.options.lanes?Array.from(i.values()).sort((l,c)=>l.end===c.end?l.index-c.index:l.end-c.end)[0]:void 0},this.getMeasurementOptions=ke(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(s,n,r,i,l,c)=>(this.prevLanes!==void 0&&this.prevLanes!==c&&(this.lanesChangedFlag=!0),this.prevLanes=c,this.pendingMeasuredCacheIndexes=[],{count:s,paddingStart:n,scrollMargin:r,getItemKey:i,enabled:l,lanes:c}),{key:!1}),this.getMeasurements=ke(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:s,paddingStart:n,scrollMargin:r,getItemKey:i,enabled:l,lanes:c},o)=>{if(!l)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>s)for(const u of this.laneAssignments.keys())u>=s&&this.laneAssignments.delete(u);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),this.measurementsCache.length===0&&!this.lanesSettling&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(u=>{this.itemSizeCache.set(u.key,u.size)}));const h=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===s&&(this.lanesSettling=!1);const d=this.measurementsCache.slice(0,h),g=new Array(c).fill(void 0);for(let u=0;u<h;u++){const y=d[u];y&&(g[y.lane]=u)}for(let u=h;u<s;u++){const y=i(u),x=this.laneAssignments.get(u);let v,p;if(x!==void 0&&this.options.lanes>1){v=x;const f=g[v],T=f!==void 0?d[f]:void 0;p=T?T.end+this.options.gap:n+r}else{const f=this.options.lanes===1?d[u-1]:this.getFurthestMeasurement(d,u);p=f?f.end+this.options.gap:n+r,v=f?f.lane:u%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(u,v)}const w=o.get(y),j=typeof w=="number"?w:this.options.estimateSize(u),b=p+j;d[u]={index:u,start:p,size:j,end:b,key:y,lane:v},g[v]=u}return this.measurementsCache=d,d},{key:!1,debug:()=>this.options.debug}),this.calculateRange=ke(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(s,n,r,i)=>this.range=s.length>0&&n>0?fn({measurements:s,outerSize:n,scrollOffset:r,lanes:i}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=ke(()=>{let s=null,n=null;const r=this.calculateRange();return r&&(s=r.startIndex,n=r.endIndex),this.maybeNotify.updateDeps([this.isScrolling,s,n]),[this.options.rangeExtractor,this.options.overscan,this.options.count,s,n]},(s,n,r,i,l)=>i===null||l===null?[]:s({startIndex:i,endIndex:l,overscan:n,count:r}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=s=>{const n=this.options.indexAttribute,r=s.getAttribute(n);return r?parseInt(r,10):(console.warn(`Missing attribute name '${n}={index}' on measured element.`),-1)},this._measureElement=(s,n)=>{const r=this.indexFromElement(s),i=this.measurementsCache[r];if(!i)return;const l=i.key,c=this.elementsCache.get(l);c!==s&&(c&&this.observer.unobserve(c),this.observer.observe(s),this.elementsCache.set(l,s)),s.isConnected&&this.resizeItem(r,this.options.measureElement(s,n,this))},this.resizeItem=(s,n)=>{const r=this.measurementsCache[s];if(!r)return;const i=this.itemSizeCache.get(r.key)??r.size,l=n-i;l!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(r,l,this):r.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=l,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(r.index),this.itemSizeCache=new Map(this.itemSizeCache.set(r.key,n)),this.notify(!1))},this.measureElement=s=>{if(!s){this.elementsCache.forEach((n,r)=>{n.isConnected||(this.observer.unobserve(n),this.elementsCache.delete(r))});return}this._measureElement(s,void 0)},this.getVirtualItems=ke(()=>[this.getVirtualIndexes(),this.getMeasurements()],(s,n)=>{const r=[];for(let i=0,l=s.length;i<l;i++){const c=s[i],o=n[c];r.push(o)}return r},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=s=>{const n=this.getMeasurements();if(n.length!==0)return yt(n[Zt(0,n.length-1,r=>yt(n[r]).start,s)])},this.getMaxScrollOffset=()=>{if(!this.scrollElement)return 0;if("scrollHeight"in this.scrollElement)return this.options.horizontal?this.scrollElement.scrollWidth-this.scrollElement.clientWidth:this.scrollElement.scrollHeight-this.scrollElement.clientHeight;{const s=this.scrollElement.document.documentElement;return this.options.horizontal?s.scrollWidth-this.scrollElement.innerWidth:s.scrollHeight-this.scrollElement.innerHeight}},this.getOffsetForAlignment=(s,n,r=0)=>{if(!this.scrollElement)return 0;const i=this.getSize(),l=this.getScrollOffset();n==="auto"&&(n=s>=l+i?"end":"start"),n==="center"?s+=(r-i)/2:n==="end"&&(s-=i);const c=this.getMaxScrollOffset();return Math.max(Math.min(c,s),0)},this.getOffsetForIndex=(s,n="auto")=>{s=Math.max(0,Math.min(s,this.options.count-1));const r=this.measurementsCache[s];if(!r)return;const i=this.getSize(),l=this.getScrollOffset();if(n==="auto")if(r.end>=l+i-this.options.scrollPaddingEnd)n="end";else if(r.start<=l+this.options.scrollPaddingStart)n="start";else return[l,n];if(n==="end"&&s===this.options.count-1)return[this.getMaxScrollOffset(),n];const c=n==="end"?r.end+this.options.scrollPaddingEnd:r.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(c,n,r.size),n]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(s,{align:n="start",behavior:r}={})=>{r==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(s,n),{adjustments:void 0,behavior:r})},this.scrollToIndex=(s,{align:n="auto",behavior:r}={})=>{r==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),s=Math.max(0,Math.min(s,this.options.count-1)),this.currentScrollToIndex=s;let i=0;const l=10,c=h=>{if(!this.targetWindow)return;const d=this.getOffsetForIndex(s,h);if(!d){console.warn("Failed to get offset for index:",s);return}const[g,u]=d;this._scrollToOffset(g,{adjustments:void 0,behavior:r}),this.targetWindow.requestAnimationFrame(()=>{const y=()=>{if(this.currentScrollToIndex!==s)return;const x=this.getScrollOffset(),v=this.getOffsetForIndex(s,u);if(!v){console.warn("Failed to get offset for index:",s);return}ln(v[0],x)||o(u)};this.isDynamicMode()?this.targetWindow.requestAnimationFrame(y):y()})},o=h=>{this.targetWindow&&this.currentScrollToIndex===s&&(i++,i<l?this.targetWindow.requestAnimationFrame(()=>c(h)):console.warn(`Failed to scroll to index ${s} after ${l} attempts.`))};c(n)},this.scrollBy=(s,{behavior:n}={})=>{n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+s,{adjustments:void 0,behavior:n})},this.getTotalSize=()=>{var s;const n=this.getMeasurements();let r;if(n.length===0)r=this.options.paddingStart;else if(this.options.lanes===1)r=((s=n[n.length-1])==null?void 0:s.end)??0;else{const i=Array(this.options.lanes).fill(null);let l=n.length-1;for(;l>=0&&i.some(c=>c===null);){const c=n[l];i[c.lane]===null&&(i[c.lane]=c.end),l--}r=Math.max(...i.filter(c=>c!==null))}return Math.max(r-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(s,{adjustments:n,behavior:r})=>{this.options.scrollToFn(s,{behavior:r,adjustments:n},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(a)}}const Zt=(t,a,s,n)=>{for(;t<=a;){const r=(t+a)/2|0,i=s(r);if(i<n)t=r+1;else if(i>n)a=r-1;else return r}return t>0?t-1:0};function fn({measurements:t,outerSize:a,scrollOffset:s,lanes:n}){const r=t.length-1,i=o=>t[o].start;if(t.length<=n)return{startIndex:0,endIndex:r};let l=Zt(0,r,i,s),c=l;if(n===1)for(;c<r&&t[c].end<s+a;)c++;else if(n>1){const o=Array(n).fill(0);for(;c<r&&o.some(d=>d<s+a);){const d=t[c];o[d.lane]=d.end,c++}const h=Array(n).fill(s+a);for(;l>=0&&h.some(d=>d>=s);){const d=t[l];h[d.lane]=d.start,l--}l=Math.max(0,l-l%n),c=Math.min(r,c+(n-1-c%n))}return{startIndex:l,endIndex:c}}const vt=typeof document<"u"?m.useLayoutEffect:m.useEffect;function gn({useFlushSync:t=!0,...a}){const s=m.useReducer(()=>({}),{})[1],n={...a,onChange:(i,l)=>{var c;t&&l?xs.flushSync(s):s(),(c=a.onChange)==null||c.call(a,i,l)}},[r]=m.useState(()=>new pn(n));return r.setOptions(n),vt(()=>r._didMount(),[]),vt(()=>r._willUpdate()),r}function yn(t){return gn({observeElementRect:xn,observeElementOffset:hn,scrollToFn:un,...t})}/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jn=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],bn=xe("chevron-up",jn);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nn=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Br=xe("circle-x",Nn);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vn=[["path",{d:"m15 10 5 5-5 5",key:"qqa56n"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]],wn=xe("corner-down-right",vn);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kn=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],ot=xe("lock",kn);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cn=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Jt=xe("message-circle-question-mark",Cn);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sn=[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]],_n=xe("reply",Sn);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mn=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],Tn=xe("route",Mn);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pn=[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]],wt=xe("stethoscope",Pn);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bn=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],kt=xe("trophy",Bn);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ln=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],ze=xe("user",Ln);function Rn(t){t.values.forEach(a=>a.stop())}function tt(t,a){[...a].reverse().forEach(n=>{const r=t.getVariant(n);r&&Ft(t,r),t.variantChildren&&t.variantChildren.forEach(i=>{tt(i,a)})})}function En(t,a){if(Array.isArray(a))return tt(t,a);if(typeof a=="string")return tt(t,[a]);Ft(t,a)}function zn(){const t=new Set,a={subscribe(s){return t.add(s),()=>void t.delete(s)},start(s,n){const r=[];return t.forEach(i=>{r.push(hs(i,s,{transitionOverride:n}))}),Promise.all(r)},set(s){return t.forEach(n=>{En(n,s)})},stop(){t.forEach(s=>{Rn(s)})},mount(){return()=>{a.stop()}}};return a}function Fn(){const t=ms(zn);return us(t.mount,[]),t}function In({"aria-label":t="Page navigation",className:a,...s}){return e.jsx("nav",{"aria-label":t,...s,className:z("flex gap-x-2",a)})}function An({onClick:t,disabled:a=!1,className:s,children:n="Previous"}){return e.jsx("span",{className:z("grow basis-0",s),children:e.jsxs(rt,{plain:!0,onClick:t,disabled:a,"aria-label":"Previous page",className:z("gap-1",a&&"invisible"),children:[e.jsx("svg",{className:"size-4 stroke-current",viewBox:"0 0 16 16",fill:"none","aria-hidden":"true",children:e.jsx("path",{d:"M2.75 8H13.25M2.75 8L5.25 5.5M2.75 8L5.25 10.5",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})}),n]})})}function Dn({onClick:t,disabled:a=!1,className:s,children:n="Next"}){return e.jsx("span",{className:z("flex grow basis-0 justify-end",s),children:e.jsxs(rt,{plain:!0,onClick:t,disabled:a,"aria-label":"Next page",className:z("gap-1",a&&"invisible"),children:[n,e.jsx("svg",{className:"size-4 stroke-current",viewBox:"0 0 16 16",fill:"none","aria-hidden":"true",children:e.jsx("path",{d:"M13.25 8L2.75 8M13.25 8L10.75 10.5M13.25 8L10.75 5.5",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})})]})})}function Hn({className:t,...a}){return e.jsx("span",{...a,className:z("hidden items-baseline gap-x-2 sm:flex",t)})}function On({page:t,current:a=!1,onClick:s,className:n,children:r}){return e.jsx(rt,{plain:!a,outline:a,onClick:()=>s==null?void 0:s(t),"aria-label":`Page ${t}`,"aria-current":a?"page":void 0,className:z("min-w-[2.25rem] before:absolute before:-inset-px before:rounded-lg",a&&"before:bg-subtle-fill",n),children:r??t})}function $n({className:t,...a}){return e.jsx("span",{"aria-hidden":"true",...a,className:z("w-[2.25rem] select-none text-center text-sm text-fg-muted",t),children:"…"})}function Un(t,a,s=1){if(a<=7)return Array.from({length:a},(o,h)=>h+1);const n=Math.max(t-s,1),r=Math.min(t+s,a),i=n>2,l=r<a-1;if(!i&&l){const o=3+2*s;return[...Array.from({length:o},(d,g)=>g+1),"gap",a]}if(i&&!l){const o=3+2*s;return[1,"gap",...Array.from({length:o},(d,g)=>a-o+g+1)]}return[1,"gap",...Array.from({length:r-n+1},(o,h)=>n+h),"gap",a]}const Lr=ps(t=>({requestedHash:null,requestChannel:a=>t({requestedHash:a}),clearRequest:()=>t({requestedHash:null})})),Vn={rx:{icon:Kt,label:"Rx",badgeColor:Me.rx,avatarBg:"bg-sys-green/15",avatarText:"text-sys-green"},forward:{icon:ue,label:"Fwd",badgeColor:Me.forward,avatarBg:"bg-sys-cyan/15",avatarText:"text-sys-cyan"},duplicate:{icon:it,label:"Dupe",badgeColor:Me.duplicate,avatarBg:"bg-fg-muted/15",avatarText:"text-fg-secondary"},tx:{icon:Ys,label:"Tx",badgeColor:Me.tx,avatarBg:"bg-sys-indigo/15",avatarText:"text-sys-indigo"},dropped:{icon:wn,label:"Drop",badgeColor:Me.dropped,avatarBg:"bg-sys-amber/15",avatarText:"text-sys-amber"}},Ct={sm:"w-3.5 h-3.5",md:"w-4 h-4",lg:"w-5 h-5"},Wn={sm:"w-8 h-8",md:"w-9 h-9",lg:"w-10 h-10"};function Gn(t){return t.packet_origin==="tx_local"?"tx":t.packet_origin==="tx_forward"?"forward":t.is_duplicate?"duplicate":t.transmitted?"forward":t.drop_reason?"dropped":"rx"}function Qn({packet:t,showLabel:a=!0,variant:s="avatar",size:n="sm"}){const r=Gn(t),i=Vn[r],l=i.icon;return s==="avatar"?e.jsx("div",{className:z("flex items-center justify-center rounded-full flex-shrink-0",i.avatarBg,Wn[n]),children:e.jsx(l,{className:z(Ct[n],i.avatarText)})}):e.jsxs(P,{color:i.badgeColor,children:[e.jsx(l,{className:Ct[n]}),a&&i.label]})}const es=m.memo(Qn);function qn({path:t,localHash:a,className:s}){if(!t||t.length===0)return e.jsx("span",{className:z("text-fg-muted text-xs",s),children:"—"});const n=a?(a.startsWith("0x")?a.slice(2,4):a.slice(0,2)).toUpperCase():null;return e.jsx("span",{className:z("flex items-center gap-0.5 type-data-xs overflow-hidden",s),children:t.map((r,i)=>{const l=i===t.length-1,c=n&&r.toUpperCase()===n;return e.jsxs("span",{className:"flex items-center flex-shrink-0",children:[c?e.jsx("span",{className:"px-1 py-0.5 rounded bg-sys-amber/20 text-sys-amber text-[9px] font-medium",children:"You"}):e.jsx("span",{className:"px-1 py-0.5 rounded bg-subtle-fill-hover text-fg-secondary",children:r.toUpperCase()}),!l&&e.jsx(ct,{className:"w-2.5 h-2.5 text-fg-muted mx-0.5 flex-shrink-0"})]},`${r}-${i}`)})})}const ts=m.memo(qn);function ss({channelName:t,onClick:a,active:s,compact:n,className:r}){const i=t.startsWith("#")?t:`#${t}`,l=z("inline-flex items-center flex-shrink-0","font-medium",n?"px-1.5 h-4 leading-4 rounded text-[10px]":"px-2 h-5 leading-5 rounded text-xs",s?"bg-sys-blue/20 text-sys-blue":"bg-sys-blue/10 text-sys-blue",a&&!s&&"hover:bg-sys-blue/20 cursor-pointer",r);return a?e.jsx("button",{type:"button",onClick:a,className:l,children:i}):e.jsx("span",{className:l,children:i})}function $e(t){return{"--data-box-accent":me[t]}}function ns(t){const a=t.payload_type_name||Dt(t.payload_type??t.type),s=t.route_type_name||Ht(t.route_type??t.route),n=Te[a]??"zinc",r=Ae[s]??"zinc";return{payloadType:a,routeType:s,payloadColor:n,routeColor:r}}function Ue(t){if(!t)return[];if(Array.isArray(t))return t;try{const a=JSON.parse(t);return Array.isArray(a)?a:[]}catch{return[]}}function as(t,a){if(a){const s=a(t);return{name:s.name,isCompanion:s.isCompanion,isRepeater:s.isRepeater}}return{name:null,isCompanion:!1,isRepeater:!1}}function Kn({packet:t,onClick:a,localHash:s,neighbors:n,resolveSource:r,isFlashing:i=!1,isTraceHighlighted:l,onTraceHover:c,traceTag:o,onViewTraceReport:h,dupeGroupPosition:d,isDupeGroupHovered:g=!1,onDupeGroupHover:u,dupeCount:y,getDecodedContent:x,onChannelClick:v}){const p=y?!1:It(t.is_duplicate),w=d!==void 0,{payloadType:j,routeType:b,payloadColor:f,routeColor:T}=ns(t),N=t.packet_origin==="tx_local",D=j==="TRACE",O=Ue(t.original_path),U=Ue(t.forwarded_path),X=U.length>0?U:O,H=t.src_hash?(t.src_hash.startsWith("0x")?t.src_hash.slice(2,6):t.src_hash.slice(0,4)).toUpperCase():null,{name:Z,isRepeater:A}=as(t,r);let R=null,F=null,se=null,J=null;if(j==="GRP_TXT"&&x){const $=x(t);$!=null&&$.decrypted&&(F=$.senderName,se=$.channelName,J=$.channelHash,$.text&&(R=$.text))}else if(j==="TXT_MSG"&&t.raw_packet)try{const $=Qt.fromHex(t.raw_packet);if($.success&&$.packet){const ce=qt($.packet.payload);ce&&!ce.encrypted&&(R=ce.text)}}catch{}const C=F||(A?null:Z),Q=!!C,ae=!Q&&A&&!!Z,B=!Q&&!ae&&j==="GRP_TXT"&&!R,S=t.payload_length??t.length??0;t.lbt_attempts;const te=m.useCallback(()=>{D&&o&&h?h(o):a(t)},[D,o,h,a,t]),W=m.useCallback(()=>{D&&o&&c&&c(o),w&&u&&t.packet_hash&&u(t.packet_hash)},[D,o,c,w,u,t.packet_hash]),q=m.useCallback(()=>{c&&c(null),u&&u(null)},[c,u]),L=me[f]||me.zinc,M=g,le=()=>{const $={pointerEvents:"none"};return d==="first"?{...$,borderTop:`2px solid ${L}`,borderLeft:`2px solid ${L}`,borderRight:`2px solid ${L}`,borderBottom:"none",borderRadius:"8px 8px 0 0",inset:"-2px -2px 0 -2px"}:d==="middle"?{...$,borderTop:"none",borderLeft:`2px solid ${L}`,borderRight:`2px solid ${L}`,borderBottom:"none",borderRadius:0,inset:"0 -2px"}:d==="last"?{...$,borderTop:"none",borderLeft:`2px solid ${L}`,borderRight:`2px solid ${L}`,borderBottom:`2px solid ${L}`,borderRadius:"0 0 8px 8px",inset:"0 -2px -2px -2px"}:{...$,border:`2px solid ${L}`,borderRadius:"8px",inset:"-2px"}};return e.jsxs("div",{onClick:te,onMouseEnter:W,onMouseLeave:q,className:z("group relative cursor-pointer","hover:bg-subtle-fill",p&&!g&&"opacity-40",i&&"flash-row",N&&"bg-sys-indigo/5",l&&"bg-sys-teal/10"),children:[e.jsx("div",{className:z("absolute pointer-events-none transition-opacity duration-75",w?M?"opacity-100":"opacity-0":"opacity-0 group-hover:opacity-100"),style:le()}),e.jsxs("div",{className:"relative flex items-center gap-2 min-[600px]:gap-3 px-2 py-2 min-[600px]:px-3 min-[600px]:py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[e.jsx("div",{className:"relative flex-shrink-0",children:Q?e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-1 ring-edge-subtle",style:{backgroundColor:Wt(Se(C).cleanName)},children:Se(C).emoji?e.jsx("span",{className:"text-base leading-none",children:Se(C).emoji}):e.jsx("span",{className:"text-white text-[10px] font-bold tracking-tighter",children:Gt(C)})}):ae?e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-[1.5px] ring-sys-blue",children:e.jsx(ge,{className:"size-5 text-sys-blue"})}):B?e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-zinc-500/20 ring-1 ring-edge-subtle",children:e.jsx(Jt,{className:"size-4 text-fg-muted"})}):e.jsx(es,{packet:t,variant:"avatar",size:"sm"})}),e.jsx("div",{className:"min-w-0",children:Q?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-semibold text-[13px] text-fg-primary font-sans truncate max-w-[90px]",children:C}),H&&e.jsx("div",{className:"hidden min-[900px]:block text-[9px] text-fg-muted truncate",children:H})]}):ae?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-semibold text-[13px] text-fg-primary font-sans truncate max-w-[90px]",children:Z}),H&&e.jsx("div",{className:"hidden min-[900px]:block text-[9px] text-fg-muted truncate",children:H})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold text-[13px] text-fg-primary font-sans truncate",children:H||"—"}),Z&&e.jsx("div",{className:"hidden min-[900px]:block text-[9px] text-fg-muted truncate max-w-[70px]",children:Z})]})})]}),e.jsxs("div",{className:"flex-1 flex items-center gap-1 min-[600px]:gap-1.5 min-[900px]:gap-2 min-w-0",children:[e.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:$e(f),children:j}),y&&y>1&&e.jsxs("span",{className:"data-box data-box-compact flex-shrink-0",children:["×",y]}),e.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:$e(T),children:b}),e.jsxs("span",{className:"hidden min-[520px]:inline type-data-xs text-fg-muted flex-shrink-0",children:[S,"B"]}),e.jsx("div",{className:"flex-1 min-w-0 overflow-hidden",children:R||se?e.jsxs("span",{className:"text-[11px] text-fg-secondary truncate block flex items-center gap-1",children:[se&&e.jsx(ss,{channelName:se,compact:!0,onClick:v&&J?$=>{$.stopPropagation(),v(J)}:void 0}),R&&e.jsx("span",{className:"italic truncate",children:R})]}):e.jsx(ts,{path:X,localHash:s})})]}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[e.jsx("span",{className:"data-box data-box-compact",children:At(t.timestamp)}),e.jsx(De,{rssi:t.rssi,snr:t.snr,compact:!0,showValues:!0,validated:He(t)})]})]})]})}function Yn({packet:t,onClick:a,localHash:s,neighbors:n,resolveSource:r,isFlashing:i=!1,isTraceHighlighted:l,traceTag:c,onViewTraceReport:o,dupeGroupPosition:h,isDupeGroupHovered:d=!1,onDupeGroupHover:g,dupeCount:u,getDecodedContent:y,onChannelClick:x}){const{payloadType:v,routeType:p,payloadColor:w,routeColor:j}=ns(t),b=t.packet_origin==="tx_local",f=v==="TRACE",T=u?!1:It(t.is_duplicate),N=Ue(t.original_path),D=Ue(t.forwarded_path),O=D.length>0?D:N,U=t._hopCount??O.length,X=t.src_hash?(t.src_hash.startsWith("0x")?t.src_hash.slice(2,6):t.src_hash.slice(0,4)).toUpperCase():null,{name:H,isRepeater:Z}=as(t,r);let A=null,R=null,F=null,se=null;if(v==="GRP_TXT"&&y){const L=y(t);L!=null&&L.decrypted&&(R=L.senderName,F=L.channelName,se=L.channelHash,L.text&&(A=L.text))}else if(v==="TXT_MSG"&&t.raw_packet)try{const L=Qt.fromHex(t.raw_packet);if(L.success&&L.packet){const M=qt(L.packet.payload);M&&!M.encrypted&&(A=M.text)}}catch{}const J=R||(Z?null:H),C=!!J,Q=!C&&Z&&!!H,ae=!C&&!Q&&v==="GRP_TXT"&&!A,B=t.payload_length??t.length??0,S=t.lbt_attempts??0,te=()=>{f&&c&&o?o(c):a(t)},W=me[w]||me.zinc,q=()=>{if(!h)return{opacity:0};const L=d?1:.4,M=d?"3px":"2px";return h==="first"?{backgroundColor:W,opacity:L,width:M,top:"6px",bottom:0,borderRadius:"0 9999px 0 0"}:h==="middle"?{backgroundColor:W,opacity:L,width:M,top:0,bottom:0,borderRadius:0}:h==="last"?{backgroundColor:W,opacity:L,width:M,top:0,bottom:"6px",borderRadius:"0 0 9999px 0"}:{backgroundColor:W,opacity:L,width:M,top:"6px",bottom:"6px",borderRadius:"9999px"}};return e.jsxs("div",{onClick:te,className:z("relative pl-3 pr-2.5 py-2 cursor-pointer","active:bg-subtle-fill-hover",T&&"opacity-40",i&&"flash-row",b&&"bg-sys-indigo/5",l&&"bg-sys-teal/10"),children:[e.jsx("div",{className:"absolute left-0 transition-all",style:q()}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"relative flex-shrink-0 mt-0.5",children:C?e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-1 ring-edge-subtle",style:{backgroundColor:Wt(Se(J).cleanName)},children:Se(J).emoji?e.jsx("span",{className:"text-base leading-none",children:Se(J).emoji}):e.jsx("span",{className:"text-white text-[10px] font-bold tracking-tighter",children:Gt(J)})}):Q?e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ring-[1.5px] ring-sys-blue",children:e.jsx(ge,{className:"size-5 text-sys-blue"})}):ae?e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-zinc-500/20 ring-1 ring-edge-subtle",children:e.jsx(Jt,{className:"size-4 text-fg-muted"})}):e.jsx(es,{packet:t,variant:"avatar",size:"sm"})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[C?e.jsx("span",{className:"font-medium text-[14px] text-fg-primary tracking-tight truncate min-w-0",children:J}):Q?e.jsx("span",{className:"font-medium text-[14px] text-fg-primary tracking-tight truncate min-w-0",children:H}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold text-[14px] text-fg-primary tracking-tight flex-shrink-0",children:X||"—"}),H&&e.jsx("span",{className:"text-[12px] text-fg-muted truncate min-w-0",children:H})]}),e.jsx("div",{className:"flex-1"}),e.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:$e(w),children:v}),e.jsx("span",{className:"data-box data-box-compact data-box-outlined flex-shrink-0",style:$e(j),children:p}),u&&u>1&&e.jsxs("span",{className:"data-box data-box-compact flex-shrink-0",children:["×",u]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("span",{className:"type-data-xs text-fg-muted w-[28px] text-right",children:t.rssi}),e.jsx(De,{rssi:t.rssi,compact:!0,showValues:!1,validated:He(t)})]})]}),e.jsxs("div",{className:"flex items-center gap-1 type-data-xs text-fg-muted",children:[e.jsx("span",{className:"data-box data-box-compact flex-shrink-0",children:At(t.timestamp)}),B>0&&e.jsxs("span",{children:[B,"B"]}),S>0&&e.jsxs("span",{className:S>1?"text-sys-amber/60":void 0,children:["LBT:",S]}),t.snr!=null&&e.jsxs("span",{children:[t.snr.toFixed(0),"dB"]}),A||F?e.jsxs("span",{className:"text-[11px] text-fg-secondary truncate flex items-center gap-1 min-w-0",children:[F&&e.jsx(ss,{channelName:F,compact:!0,onClick:x&&se?L=>{L.stopPropagation(),x(se)}:void 0}),A&&e.jsx("span",{className:"italic truncate",children:A})]}):U>0?e.jsx(ts,{path:O,localHash:s}):null]})]})]})]})}const Xn=m.memo(Kn),Zn=m.memo(Yn);function Jn(t,a,s,n,r=!1){const i=t.toUpperCase(),l=[],c=s&&Xe(i,s);c&&l.push(s);for(const y of Object.keys(a))Xe(i,y)&&l.push(y);if(r&&c&&s&&l.length===1)return{matches:l,probability:1,bestMatch:s};if(r&&c&&l.length>1){const y=l.filter(x=>x!==s);if(y.length===1)return{matches:l,probability:1,bestMatch:y[0]}}const o=l.length>0?1/l.length:0,h=[...l].sort();let d=null,g=-1;if(h.length===1)d=h[0];else if(h.length>1&&n){for(const y of h){const x=n.get(y),v=x?typeof x=="number"?x:x.combinedScore:0;v>g&&(g=v,d=y)}d||(d=h[0])}else h.length>0&&(d=h[0]);let u=o;if(l.length>1&&n&&g>0){let y=0;for(const x of l){const v=n.get(x);y+=v?typeof v=="number"?v:v.combinedScore:0}y>0&&(u=Math.min(.95,g/y))}return{matches:l,probability:u,bestMatch:d}}function ea(t,a,s,n){const i=(s-t)*Math.PI/180,l=(n-a)*Math.PI/180,c=Math.sin(i/2)*Math.sin(i/2)+Math.cos(t*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 6371e3*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))}function ta(t){return t<100?1:t<500?.9:t<1e3?.7:t<5e3?.5:t<1e4?.3:.1}const sa=m.lazy(()=>fs(()=>import("./PathMapMapLibre-T4Z0ZoUt.js"),__vite__mapDeps([0,1,2,3,4,5,6])));function na(t,a,s,n,r=!1,i,l,c){const o=Xs(a);let h;l&&(h=Zs(l,t,{position:c,isLastHop:r}).confidence);const{matches:d,probability:g}=Jn(t,o,n,i,r),u=d.length,y=[],x=t.toUpperCase(),v=s&&s.latitude!==void 0&&s.longitude!==void 0&&(s.latitude!==0||s.longitude!==0);for(const w of d){if(n&&Xe(x,n)&&w===n&&v&&s){y.push({hash:w,name:s.name||"Local Node",latitude:s.latitude,longitude:s.longitude,probability:r?1:g,isLocal:!0});continue}const j=o[w];j!=null&&j.latitude&&(j!=null&&j.longitude)&&!(j.latitude===0&&j.longitude===0)&&y.push({hash:w,name:j.node_name||j.name||"Unknown",latitude:j.latitude,longitude:j.longitude,probability:g,isLocal:!1,isDirectNeighbor:j.zero_hop===!0})}const p=y.length;if(p===1)y[0].probability=h??1;else if(p>1)if(h!==void 0&&h>0){const w=y[0];w.probability=h;const j=1-h,b=p-1;y.slice(1).forEach(f=>{f.probability=j/b})}else{let w=0;const j=y.map(b=>{if(b.isLocal)return{candidate:b,score:1};const f=i==null?void 0:i.get(b.hash);let T=.5;if(v&&s){const D=ea(s.latitude,s.longitude,b.latitude,b.longitude);T=ta(D)}let N;return f?N=T*.3+f.hopConsistencyScore*.3+f.frequencyScore*.4:(N=T,b.isDirectNeighbor&&(N=Math.max(N,.8))),w+=N,{candidate:b,score:N}});if(w>0)j.forEach(({candidate:b,score:f})=>{b.probability=Math.min(.95,f/w)});else{const b=1/p;y.forEach(f=>f.probability=b)}}return{candidates:y,totalMatches:u}}function aa(t,a,s,n,r,i){if(!t||t.length===0)return{hops:[],overallConfidence:0,hasValidPath:!1};const l=t.length-1,c=t.map((d,g)=>{const u=g===l,y=t.length-g,{candidates:x,totalMatches:v}=na(d,a,s,n,u,r,i,y),p=x.length>0?Math.max(...x.map(w=>w.probability)):0;return{prefix:d,candidates:x,confidence:p,totalMatches:v}}),o=c.reduce((d,g)=>g.confidence===0?0:d*g.confidence,1),h=c.some(d=>d.candidates.length>0);return{hops:c,overallConfidence:o,hasValidPath:h}}function ra(t){return`${(t*100).toFixed(0)}%`}function ia(t){return t>=1?"text-sys-green":t>=.5?"text-sys-indigo":t>=.25?"text-signal-poor":t>0?"text-sys-red":"text-fg-muted"}function la(t,a,s){let n;return a===0?n=s.muted:t>=1?n=s.success:t>=.5?n=s.secondary:t>=.25?n=s.poor:t>0?n=s.danger:n=s.muted,{color:n}}class ca extends m.Component{constructor(a){super(a),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?e.jsxs("div",{className:"h-[200px] flex items-center justify-center text-fg-muted",children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),"Map failed to load"]}):this.props.children}}function Ve({path:t,neighbors:a,localNode:s,localHash:n,srcHash:r,dstHash:i,neighborAffinity:l,prefixLookup:c,hubNodes:o,traceSnr:h,advertiserSource:d}){const[g,u]=m.useState(null),y=m.useMemo(()=>{if(!d)return null;const b=d.nodeType==="wardrive";return{prefix:d.prefix||"??",candidates:[{hash:d.publicKey||d.prefix||"source",name:d.name,latitude:d.latitude,longitude:d.longitude,probability:1,isLocal:!1,isWardrive:b}],confidence:1,totalMatches:1,isSource:!0}},[d]),x=m.useMemo(()=>{if(d||!r)return null;const b=Qe(r),f=a[r];if((f==null?void 0:f.latitude)&&(f==null?void 0:f.longitude)&&!(f.latitude===0&&f.longitude===0))return{prefix:b,candidates:[{hash:r,name:f.node_name||f.name||"Source",latitude:f.latitude,longitude:f.longitude,probability:1,isLocal:!1,isDirectNeighbor:f.zero_hop===!0}],confidence:1,totalMatches:1,isSource:!0};const N=(f==null?void 0:f.node_name)||(f==null?void 0:f.name)||r.slice(0,8);return{prefix:b,candidates:[{hash:r,name:N,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isSource:!0}},[d,r,a]),v=m.useMemo(()=>{const b=i!=null&&i.startsWith("0x")?i.slice(2):i;if((!b||b==="00"||b==="0000000000000000")&&s&&n){const U=Qe(n),X=s.latitude!==0||s.longitude!==0;return{prefix:U,candidates:[{hash:n,name:s.name||"Local Node",latitude:X?s.latitude:0,longitude:X?s.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}if(!i)return null;const T=Qe(i);if(n&&i===n&&s){const U=s.latitude!==0||s.longitude!==0;return{prefix:T,candidates:[{hash:i,name:s.name||"Local Node",latitude:U?s.latitude:0,longitude:U?s.longitude:0,probability:1,isLocal:!0}],confidence:1,totalMatches:1,isDestination:!0}}const N=a[i];if((N==null?void 0:N.latitude)&&(N==null?void 0:N.longitude)&&!(N.latitude===0&&N.longitude===0))return{prefix:T,candidates:[{hash:i,name:N.node_name||N.name||"Destination",latitude:N.latitude,longitude:N.longitude,probability:1,isLocal:!1,isDirectNeighbor:N.zero_hop===!0}],confidence:1,totalMatches:1,isDestination:!0};const O=(N==null?void 0:N.node_name)||(N==null?void 0:N.name)||i.slice(0,8);return{prefix:T,candidates:[{hash:i,name:O,latitude:0,longitude:0,probability:1,isLocal:!1}],confidence:1,totalMatches:1,isDestination:!0}},[i,a,s,n]),p=m.useMemo(()=>aa(t,a,s,n,l,c),[t,a,s,n,l,c]),w=m.useMemo(()=>{const b=[];y?b.push(y):x&&b.push(x),b.push(...p.hops),v&&b.push(v);const f=b.reduce((N,D)=>D.confidence===0?0:N*D.confidence,1),T=b.some(N=>N.candidates.some(D=>D.latitude!==0||D.longitude!==0));return{hops:b,overallConfidence:f,hasValidPath:T}},[y,x,p,v]),j=m.useMemo(()=>{const b=getComputedStyle(document.documentElement);return{success:b.getPropertyValue("--sys-green").trim()||"#39D98A",secondary:b.getPropertyValue("--sys-indigo").trim()||"#F9D26F",poor:b.getPropertyValue("--signal-poor").trim()||"#FF8A5C",danger:b.getPropertyValue("--sys-red").trim()||"#FF5C7A",muted:b.getPropertyValue("--text-muted").trim()||"#767688"}},[]);return w.hasValidPath?e.jsxs("div",{className:"h-full flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-fg-muted",children:"Path Confidence:"}),e.jsx("span",{className:ia(w.overallConfidence),children:ra(w.overallConfidence)}),e.jsx("button",{className:"text-fg-muted hover:text-fg-secondary transition-colors",title:"Confidence is calculated based on how many known nodes match each path prefix. Multiple matches reduce confidence due to collision probability.",children:e.jsx(Js,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-sys-green"}),e.jsx("span",{className:"text-fg-muted",children:"Exact"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-sys-indigo"}),e.jsx("span",{className:"text-fg-muted",children:"Multi"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-fg-muted"}),e.jsx("span",{className:"text-fg-muted",children:"Unknown"})]})]})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:e.jsx(ca,{children:e.jsx(m.Suspense,{fallback:e.jsx("div",{className:"h-full bg-elevated flex items-center justify-center text-fg-muted text-sm",children:"Loading map..."}),children:e.jsx(sa,{resolvedPath:w,localNode:s,hubNodes:o,hoveredHopIndex:g,onHoverHop:u,traceSnr:h})})})}),e.jsx("div",{className:"flex flex-wrap items-center gap-1.5",children:w.hops.map((b,f)=>{var U,X,H;const T=b.isSource===!0,N=b.isDestination===!0,D=g===f;let O;return T?O=`Source: ${((U=b.candidates[0])==null?void 0:U.name)||"Unknown"}`:N?O=`Destination: ${((X=b.candidates[0])==null?void 0:X.name)||"Unknown"}`:b.totalMatches===0?O="No matching nodes found":b.totalMatches===1?O=`Exact match: ${((H=b.candidates[0])==null?void 0:H.name)||"Unknown"}`:O=`${b.totalMatches} possible matches (${(b.confidence*100).toFixed(0)}% confidence)`,e.jsxs("div",{className:z("flex items-center gap-1 px-1.5 py-0.5 rounded type-data-xs cursor-pointer transition-all",D?"bg-sys-blue/20 ring-1 ring-sys-blue/50":"bg-elevated hover:bg-subtle",T&&"border border-sys-green/30",N&&"border border-sys-blue/30"),title:O,onMouseEnter:()=>u(f),onMouseLeave:()=>u(null),children:[T&&e.jsx("span",{className:"text-sys-green text-[8px] mr-0.5",children:"SRC"}),N&&e.jsx("span",{className:"text-sys-blue text-[8px] mr-0.5",children:"DST"}),e.jsx("span",{style:la(b.confidence,b.totalMatches,j),children:b.prefix}),!T&&!N&&b.totalMatches>1&&e.jsxs("span",{className:"text-fg-muted",children:["×",b.totalMatches]}),!T&&!N&&b.totalMatches===0&&e.jsx("span",{className:"text-fg-muted",children:"?"})]},f)})})]}):e.jsxs("div",{className:"flex items-center justify-center text-fg-muted text-xs py-4",children:[e.jsx(Oe,{className:"w-3.5 h-3.5 mr-1.5 opacity-50"}),"No location data available for path nodes"]})}const Ke=16;function We(t){return t.match(/.{1,2}/g)||[]}function je(t){return t!==null&&t.startsWith("payload:")}const _e={hexRestOpacity:15,cardRestBg:"color-mix(in srgb, var(--elevated) 60%, var(--body))",cardRestShadow:`
    inset 0 0 0 1px color-mix(in srgb, var(--fg-primary) 6%, transparent),
    inset 0 1px 0 color-mix(in srgb, white 3%, transparent),
    0 1px 2px color-mix(in srgb, black 5%, transparent)
  `,selectionBorderWidth:2},st={type:"tween",duration:.25,ease:[.25,.1,.25,1]};function oa(t,a){return t?`inset 0 0 0 ${_e.selectionBorderWidth}px ${me[a]}`:_e.cardRestShadow}function da(t,a){return t?a:`color-mix(in srgb, ${a} ${_e.hexRestOpacity}%, transparent)`}function xa({segments:t,selectedSegment:a,onSegmentClick:s}){const[n,r]=m.useState(null),[i,l]=m.useState(null),c=t.some(d=>d.id!==void 0)&&s,o=[];for(const d of t){const g=We(d.hex);for(const u of g)o.push({byte:u.toUpperCase(),color:d.color,id:d.id})}const h=[];for(let d=0;d<o.length;d+=Ke)h.push(o.slice(d,d+Ke));return e.jsx("div",{className:"space-y-1",children:h.map((d,g)=>{const u=d.length<Ke;return e.jsx("div",{className:"flex rounded-md overflow-hidden",children:d.map(({byte:y,color:x,id:v},p)=>{const w=p===d.length-1,j=u&&w,b=me[x],N=(v?n===v:i===x)||!!(v&&a===v);return e.jsx("span",{className:`w-[1.75rem] text-xs text-center py-0.5 font-mono select-text ${c?"cursor-pointer":""}`,style:{backgroundColor:da(N,b),color:N?"rgba(255,255,255,0.95)":b,transition:N?"none":"background-color 0.15s ease-out, color 0.15s ease-out",touchAction:"manipulation",...j?{borderRadius:"0 0.375rem 0.375rem 0"}:{}},onMouseEnter:()=>{v?r(v):l(x)},onMouseLeave:()=>{r(null),l(null)},onClick:()=>v&&(s==null?void 0:s(v)),onTouchStart:()=>{v?r(v):l(x)},onTouchEnd:()=>{r(null),l(null)},children:y},p)})},g)})})}function ha({rawHex:t,hexSegments:a,selectedSegment:s,onSegmentClick:n}){const[r,i]=m.useState(!1),l=m.useCallback(async()=>{try{await navigator.clipboard.writeText(t.toUpperCase()),i(!0),setTimeout(()=>i(!1),2e3)}catch(c){console.error("Failed to copy:",c)}},[t]);return e.jsxs("div",{className:"bg-black rounded-2xl p-6 relative",children:[e.jsx(xa,{segments:a,selectedSegment:s,onSegmentClick:n}),e.jsx("button",{onClick:l,className:"absolute bottom-3 right-3 flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg bg-subtle-fill-hover hover:bg-subtle-fill-strong text-fg-muted hover:text-fg-secondary transition-all text-xs font-sans",title:"Copy raw packet hex",children:r?e.jsxs(e.Fragment,{children:[e.jsx(js,{className:"w-3.5 h-3.5 text-sys-green"}),e.jsx("span",{className:"text-sys-green",children:"Copied"})]}):e.jsxs(e.Fragment,{children:[e.jsx(it,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Copy"})]})})]})}function ma(t,a){const s=[];let n=0;const r=a.slice(0,64);s.push({id:"payload:publicKey",title:"Public Key",color:"pink",hex:r,startByte:n,endByte:n+31,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:t.publicKey.toUpperCase()}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Ed25519 public key (32 bytes)"})]})}),n+=32;const i=a.slice(64,72);s.push({id:"payload:timestamp",title:"Timestamp",color:"orange",hex:i,startByte:n,endByte:n+3,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",copy:!0,children:i.toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:[t.timestamp," (",ie(t.timestamp),")"]})]})}),n+=4;const l=a.slice(72,200);s.push({id:"payload:signature",title:"Signature",color:"teal",hex:l,startByte:n,endByte:n+63,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:t.signature.toUpperCase()}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Ed25519 signature (64 bytes)"})]})}),n+=64;const c=a.slice(200,202);if(s.push({id:"payload:flags",title:"Flags",color:"blue",hex:c,startByte:n,endByte:n,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(ee,{size:"standard",copy:!0,children:["0x",t.flags.toString(16).padStart(2,"0").toUpperCase()]}),e.jsx("p",{className:"text-xs text-fg-primary mt-1",children:t.flagsDescription}),e.jsxs("p",{className:"text-xs text-fg-muted",children:["Node Type: ",t.nodeType]})]})}),n+=1,t.latitude!==void 0){const o=a.slice(n*2,n*2+8);s.push({id:"payload:latitude",title:"Latitude",color:"green",hex:o,startByte:n,endByte:n+3,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",copy:!0,children:o.toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:[t.latitude.toFixed(6),"°"]})]})}),n+=4}if(t.longitude!==void 0){const o=a.slice(n*2,n*2+8);s.push({id:"payload:longitude",title:"Longitude",color:"indigo",hex:o,startByte:n,endByte:n+3,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",copy:!0,children:o.toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:[t.longitude.toFixed(6),"°"]})]})}),n+=4}if(t.name){const o=a.slice(n*2),h=o.length/2;s.push({id:"payload:name",title:"Name",color:"amber",hex:o,startByte:n,endByte:n+h-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",copy:!0,children:o.toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:['"',t.name,'"']})]})})}return s}function ua(t,a){return[{id:"payload:crc",title:"CRC",color:"green",hex:a.slice(0,8),startByte:0,endByte:3,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(ee,{size:"standard",copy:!0,children:["0x",t.crc]}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"CRC32 of acknowledged packet"})]})}]}function pa(t,a){const s=[];s.push({id:"payload:channelHash",title:"Channel Hash",color:"blue",hex:a.slice(0,2),startByte:0,endByte:0,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(ee,{size:"standard",copy:!0,children:["0x",t.channelHash]}),t.channelName&&e.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:["Channel: ",t.channelName]})]})}),t.macHex&&s.push({id:"payload:mac",title:"MAC",color:"indigo",hex:a.slice(2,6),startByte:1,endByte:2,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",copy:!0,children:t.macHex.toUpperCase()}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Truncated HMAC-SHA256"})]})});const n=a.slice(6);return n&&s.push({id:"payload:ciphertext",title:t.decrypted?"Message":"Ciphertext",color:t.decrypted?"green":"zinc",hex:n,startByte:3,endByte:3+n.length/2-1,decoded:t.decrypted?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-fg-primary",children:['"',t.text,'"']}),t.senderName&&e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:["From: ",t.senderName]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:n.toUpperCase()}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"AES-128-ECB encrypted"})]})}),s}function fa(t,a){const s=[];s.push({id:"payload:channelHash",title:"Channel Hash",color:"blue",hex:a.slice(0,2),startByte:0,endByte:0,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(ee,{size:"standard",copy:!0,children:["0x",t.channelHash]}),t.channelName&&e.jsxs("p",{className:"text-xs text-fg-primary mt-1",children:["Channel: ",t.channelName]})]})}),t.macHex&&s.push({id:"payload:mac",title:"MAC",color:"indigo",hex:a.slice(2,6),startByte:1,endByte:2,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",copy:!0,children:t.macHex.toUpperCase()}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Truncated HMAC-SHA256"})]})});const n=a.slice(6);return n&&s.push({id:"payload:ciphertext",title:t.decrypted?"Decrypted Data":"Encrypted Data",color:t.decrypted?"green":"zinc",hex:n,startByte:3,endByte:3+n.length/2-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:(t.decryptedHex||n).toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[t.dataLength," bytes",t.decrypted?"":" (AES-128-ECB encrypted)"]})]})}),s}function ga(t,a){const s=[];if(s.push({id:"payload:pathLength",title:"Path Length",color:"blue",hex:a.slice(0,2),startByte:0,endByte:0,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",children:t.pathLength}),e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[t.pathLength," hop",t.pathLength!==1?"s":""]})]})}),t.path.length>0){const n=a.slice(2,2+t.pathLength*2);s.push({id:"payload:path",title:"Path Hops",color:"amber",hex:n,startByte:1,endByte:t.pathLength,decoded:e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex flex-wrap items-center gap-1",children:t.path.map((r,i)=>e.jsxs("span",{className:"flex items-center gap-1",children:[i>0&&e.jsx(ue,{className:"w-3 h-3 text-fg-muted"}),e.jsx(P,{color:"amber",className:"font-mono",children:r})]},i))})})})}if(t.extraType!=null){const n=1+t.pathLength;s.push({id:"payload:extraType",title:"Extra Type",color:"indigo",hex:a.slice(n*2,n*2+2),startByte:n,endByte:n,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",children:t.extraTypeName??`0x${t.extraType.toString(16).padStart(2,"0")}`}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Bundled payload type"})]})})}if(t.extraData){const n=1+t.pathLength+1,r=a.slice(n*2);r&&s.push({id:"payload:extraData",title:"Extra Data",color:"indigo",hex:r,startByte:n,endByte:n+r.length/2-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:r.toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[r.length/2," bytes"]})]})})}return s}function ya(t,a){const s=[];s.push({id:"payload:crc",title:"Trace Tag",color:"blue",hex:a.slice(0,8),startByte:0,endByte:3,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(ee,{size:"standard",copy:!0,children:["0x",t.traceTag]}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Unique trace request identifier"})]})}),s.push({id:"payload:mac",title:"Auth Code",color:"indigo",hex:a.slice(8,16),startByte:4,endByte:7,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",copy:!0,children:t.authCode}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Authentication/verification code"})]})}),s.push({id:"payload:flags",title:"Flags",color:"amber",hex:a.slice(16,18),startByte:8,endByte:8,decoded:e.jsxs(e.Fragment,{children:[e.jsxs(ee,{size:"standard",copy:!0,children:["0x",t.flags.toString(16).toUpperCase().padStart(2,"0")]}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:t.flags===0?"No flags set":`Flags: ${t.flags.toString(2).padStart(8,"0")}b`})]})});const n=a.slice(18);return n&&s.push({id:"payload:path",title:"Target Path",color:"indigo",hex:n,startByte:9,endByte:9+n.length/2-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-wrap items-center gap-1",children:t.pathHashes.map((r,i)=>{const l=t.snrValues[i],c=l!==void 0?Gs(l):"zinc";return e.jsxs("span",{className:"flex items-center gap-1",children:[i>0&&e.jsx(ue,{className:"w-3 h-3 text-fg-muted"}),e.jsx(P,{color:"indigo",className:"font-mono",children:r}),l!==void 0&&e.jsxs(P,{color:c,className:"font-mono",children:[l>=0?"+":"",Number.isInteger(l)?l:l.toFixed(1),"dB"]})]},i)})}),e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[t.pathHashes.length," target ",t.pathHashes.length===1?"hop":"hops",t.snrValues.length>0&&` • ${t.snrValues.length} SNR ${t.snrValues.length===1?"value":"values"} collected`,t.isComplete&&" • ✓ Complete"]})]})}),s}function ja(t,a){const s=[];s.push({id:"payload:msgId",title:"Message ID",color:"blue",hex:a.slice(0,4),startByte:0,endByte:1,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",copy:!0,children:t.messageId.toUpperCase()}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"Unique message identifier"})]})}),s.push({id:"payload:partNum",title:"Part Number",color:"amber",hex:a.slice(4,6),startByte:2,endByte:2,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",copy:!0,children:t.partNumber}),e.jsx("p",{className:"text-xs text-fg-muted mt-1",children:"0-indexed part number"})]})}),s.push({id:"payload:totalParts",title:"Total Parts",color:"orange",hex:a.slice(6,8),startByte:3,endByte:3,decoded:e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:"standard",copy:!0,children:t.totalParts}),e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:["Part ",t.partNumber+1," of ",t.totalParts]})]})});const n=a.slice(8);return n&&s.push({id:"payload:partData",title:"Part Data",color:"cyan",hex:n,startByte:4,endByte:4+n.length/2-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:n.toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[n.length/2," bytes"]})]})}),s}function ba(t,a){switch(t.type){case"advert":return ma(t,a);case"ack":return ua(t,a);case"grp_txt":return pa(t,a);case"grp_data":return fa(t,a);case"path":return ga(t,a);case"trace":return ya(t,a);case"multipart":return ja(t,a);default:return[{id:"payload:ciphertext",title:"Raw Data",color:"zinc",hex:a,startByte:0,endByte:a.length/2-1,decoded:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-fg-secondary break-all p-2 rounded bg-body/50 font-mono",children:a.toUpperCase()}),e.jsxs("p",{className:"text-xs text-fg-muted mt-1",children:[a.length/2," bytes"]})]})}]}}function Na(t){return t.map(a=>({id:a.id,hex:a.hex,color:a.color}))}function va({bits:t,field:a,value:s,binary:n}){const r=()=>{if(a==="Payload Type"){const i=Te[s]||"zinc";return e.jsx(P,{color:i,children:s})}if(a==="Route Type"){const i=Ae[s]||"zinc";return e.jsx(P,{color:i,children:s})}return e.jsx("span",{className:"text-sm text-fg-primary",children:s})};return e.jsxs("tr",{children:[e.jsx("td",{className:"py-1.5 text-xs text-fg-muted tabular-nums",children:t}),e.jsx("td",{className:"py-1.5 text-sm text-fg-secondary",children:a}),e.jsx("td",{className:"py-1.5",children:r()}),e.jsx("td",{className:"py-1.5 type-data-xs text-sys-cyan",children:n})]})}function St({id:t,title:a,color:s,hexBytes:n,startByte:r,endByte:i,isSelected:l,children:c}){const o=n?We(n):[];return e.jsxs(de.div,{layout:"position",layoutId:t,transition:st,className:"w-full min-w-0 overflow-hidden rounded-xl p-4 sm:p-5 space-y-4",style:{backgroundColor:_e.cardRestBg,boxShadow:oa(l,s)},children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-0.5 min-w-0",children:[e.jsx(P,{color:s,children:a}),o.length>0&&o.length<=16&&o.map((h,d)=>e.jsx(P,{color:s,className:"font-mono",children:h.toUpperCase()},d))]}),e.jsxs("span",{className:"type-data-xs text-fg-muted flex-shrink-0",children:["Bytes ",r,"-",i]})]}),e.jsx("div",{className:"min-w-0 overflow-hidden",children:c})]})}function wa({advert:t,timestamp:a}){const s=a?ie(a):ie(t.timestamp);return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-indigo/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-indigo) 0%, var(--sys-blue) 100%)"},children:e.jsx(ge,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:t.name||"Unknown Node"}),e.jsx("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:t.nodeType})]})]}),e.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),e.jsxs("div",{className:"px-4 py-3 space-y-2",children:[t.latitude!==void 0&&t.longitude!==void 0&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Oe,{className:"w-4 h-4 text-sys-indigo flex-shrink-0"}),e.jsxs("span",{className:"text-sm text-fg-secondary font-mono",children:[t.latitude.toFixed(5),"°, ",t.longitude.toFixed(5),"°"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"w-4 h-4 text-sys-indigo flex-shrink-0"}),e.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:s})]})]})]})})}function ka({decoded:t,timestamp:a}){const s=a?ie(a):"Unknown";return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-teal/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-teal) 0%, var(--sys-cyan) 100%)"},children:e.jsx(nn,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:t.channelName||"Channel Data"}),e.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:[t.dataLength," bytes • ",t.decrypted?"Decrypted":"Encrypted"]})]})]}),e.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),e.jsxs("div",{className:"px-4 py-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Yt,{className:"w-4 h-4 text-sys-teal flex-shrink-0"}),e.jsxs("span",{className:"text-sm text-fg-secondary font-sans",children:["Channel: ",e.jsxs("span",{className:"font-mono",children:["0x",t.channelHash]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"w-4 h-4 text-sys-teal flex-shrink-0"}),e.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:s})]}),t.decrypted&&t.decryptedHex&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-edge-subtle",children:[e.jsx("p",{className:"type-micro text-fg-muted mb-1 font-sans",children:"Decrypted Data"}),e.jsx("div",{className:"max-w-full overflow-x-auto",children:e.jsx(ee,{size:"compact",copy:!0,className:"inline-block",children:e.jsx("span",{className:"break-all text-xs",children:t.decryptedHex.toUpperCase()})})})]})]})]})})}function Ca({decoded:t,timestamp:a,isLoading:s=!1,onDecrypted:n}){const r=a?ie(a):"Unknown",[i,l]=m.useState(""),[c,o]=m.useState(!1),[h,d]=m.useState(null),[g,u]=m.useState(!1),y=m.useCallback(async()=>{if(!(!i.trim()||!t.ciphertextHex||!t.macHex)){o(!0),d(null);try{const x=parseInt(t.channelHash,16),v=pt(t.macHex),p=pt(t.ciphertextHex),w=await Ns(i.trim(),x,v,p);if(w.success){const j=w.result.plaintext,b=new TextDecoder("utf-8",{fatal:!1}).decode(j.slice(5)),f=b.indexOf(": "),T={...t,channelName:w.result.channelName,decrypted:!0,timestamp:j[0]|j[1]<<8|j[2]<<16|j[3]<<24,flags:j[4],senderName:f>0?b.slice(0,f):void 0,text:f>0?b.slice(f+2):b};n==null||n(T),l(""),u(!1)}else d(w.error)}catch(x){d(x instanceof Error?x.message:"Unknown error")}finally{o(!1)}}},[i,t,n]);return s?e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-xl p-4 sm:p-5",style:{backgroundColor:"color-mix(in srgb, var(--elevated) 60%, var(--body))",boxShadow:`
              inset 0 0 0 1px color-mix(in srgb, var(--fg-primary) 6%, transparent),
              inset 0 1px 0 color-mix(in srgb, white 3%, transparent),
              0 1px 2px color-mix(in srgb, black 5%, transparent)
            `},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 h-[15px]",children:[e.jsx("div",{className:"h-2.5 w-12 rounded bg-subtle-fill-hover animate-pulse"}),e.jsx("div",{className:"h-2.5 w-16 rounded bg-subtle-fill-hover animate-pulse"})]}),e.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tl-md",style:{background:"color-mix(in srgb, var(--sys-blue) 30%, transparent)"},children:e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("div",{className:"h-3.5 w-48 rounded bg-subtle-fill-strong animate-pulse"}),e.jsx("div",{className:"h-3.5 w-32 rounded bg-subtle-fill-strong animate-pulse"})]})})]})}):t.decrypted?e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-xl p-4 sm:p-5",style:{backgroundColor:"color-mix(in srgb, var(--elevated) 60%, var(--body))",boxShadow:`
              inset 0 0 0 1px color-mix(in srgb, var(--fg-primary) 6%, transparent),
              inset 0 1px 0 color-mix(in srgb, white 3%, transparent),
              0 1px 2px color-mix(in srgb, black 5%, transparent)
            `},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.senderName&&e.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:["From ",e.jsx("span",{className:"text-fg-secondary font-medium",children:t.senderName})]}),t.channelName&&e.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:["in ",e.jsx("span",{className:"text-sys-cyan font-medium",children:t.channelName})]})]}),e.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tl-md",style:{background:"linear-gradient(135deg, var(--sys-blue) 0%, color-mix(in srgb, var(--sys-blue) 85%, var(--sys-cyan)) 100%)"},children:e.jsx("p",{className:"text-sm text-white font-sans leading-relaxed whitespace-pre-wrap break-words",children:t.text})})]})}):e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-zinc-500/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--zinc-500) 0%, color-mix(in srgb, var(--zinc-500) 70%, black) 100%)"},children:e.jsx(ot,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:t.isPublicHashChannel?"Public Hash Channel":"Encrypted Message"}),e.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:["Channel hash: ",e.jsxs("span",{className:"font-mono",children:["0x",t.channelHash]})]})]})]}),e.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"w-4 h-4 text-zinc-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:r})]}),t.ciphertextHex&&t.macHex&&e.jsx("div",{className:"space-y-2",children:g?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:i,onChange:x=>l(x.target.value),placeholder:"Channel name (e.g. south-bay)",className:"flex-1 px-3 py-1.5 text-sm rounded-lg bg-subtle-fill-strong border border-edge-subtle text-fg-primary placeholder:text-fg-muted focus:outline-none focus:border-zinc-500",onKeyDown:x=>x.key==="Enter"&&y(),disabled:c}),e.jsx("button",{onClick:y,disabled:c||!i.trim(),className:"px-3 py-1.5 text-sm font-medium rounded-lg bg-zinc-600 hover:bg-zinc-500 text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:c?"Testing...":"Try"}),e.jsx("button",{onClick:()=>{u(!1),d(null),l("")},className:"px-2 py-1.5 text-sm rounded-lg hover:bg-subtle-fill-strong text-fg-muted transition-colors",children:"×"})]}),h&&e.jsx("p",{className:"text-xs text-sys-red",children:h})]}):e.jsx("button",{onClick:()=>u(!0),className:"text-xs text-zinc-400 hover:text-zinc-300 underline underline-offset-2 transition-colors",children:"Know the channel name? Try to decrypt"})}),!g&&e.jsx("p",{className:"text-xs text-fg-muted",children:t.isPublicHashChannel?"Public hash channel message. Key not in common channel list.":"Unknown hash channel. Channel name required for decryption."})]})]})})}function Sa({decoded:t,timestamp:a}){const s=a?ie(a):"Unknown";return e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:"linear-gradient(135deg, var(--sys-green) 0%, var(--sys-teal) 100%)"},children:e.jsx(sn,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-fg-primary font-sans",children:"Acknowledgment"}),e.jsxs("p",{className:"text-xs text-fg-muted font-sans mt-0.5",children:["CRC: ",e.jsxs("span",{className:"font-mono text-sys-green",children:["0x",t.crc]})," · ",s]})]})]})}function _a({decoded:t,timestamp:a}){const s=a?ie(a):"Unknown",n=t.path.length;return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-amber/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-amber) 0%, var(--sys-orange) 100%)"},children:e.jsx(Tn,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:"Path Response"}),e.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:[n," ",n===1?"hop":"hops"]})]})]}),e.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),e.jsxs("div",{className:"px-4 py-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"w-4 h-4 text-sys-amber flex-shrink-0"}),e.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:s})]}),t.path.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-edge-subtle",children:e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:t.path.map((r,i)=>e.jsxs("div",{className:"flex items-center gap-2",children:[i>0&&e.jsx(ue,{className:"w-4 h-4 text-sys-amber"}),e.jsx(P,{color:"amber",className:"font-mono",children:r})]},i))})})]})]})})}function Ma({decoded:t,timestamp:a}){const s=a?ie(a):"Unknown",n=t.pathHashes.length,r=t.snrValues.length,i=l=>l>=7?"green":l>=0?"yellow":l>=-5?"orange":"red";return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-blue/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-blue) 0%, var(--sys-indigo) 100%)"},children:e.jsx(tn,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:["Trace ",t.isComplete?"Complete":"In Progress"]}),e.jsxs("p",{className:"text-sm text-fg-muted mt-0.5",children:["Tag: 0x",t.traceTag.slice(0,8),t.isComplete&&" • ✓"]})]})]}),e.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"w-4 h-4 text-sys-blue flex-shrink-0"}),e.jsx("span",{className:"text-sm text-fg-secondary",children:s})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-fg-muted",children:[e.jsxs("span",{children:[n," target ",n===1?"hop":"hops"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[r," SNR ",r===1?"sample":"samples"]}),t.authCode!==0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Auth: ",t.authCode]})]})]}),t.pathHashes.length>0&&e.jsx("div",{className:"flex flex-wrap items-center gap-2 pt-1",children:t.pathHashes.map((l,c)=>{const o=t.snrValues[c],h=o!==void 0?i(o):"zinc",d=o!==void 0;return e.jsxs("div",{className:"flex items-center gap-2",children:[c>0&&e.jsx(ue,{className:"w-4 h-4 text-sys-blue flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(P,{color:d?"blue":"zinc",className:"font-mono",children:l}),d&&e.jsxs(P,{color:h,className:"font-mono",children:[o>=0?"+":"",Number.isInteger(o)?o:o.toFixed(1),"dB"]})]})]},c)})})]})]})})}function Ta({decoded:t,timestamp:a}){const s=a?ie(a):"Unknown";return t.encrypted?e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:"linear-gradient(135deg, var(--sys-indigo) 0%, var(--sys-blue) 100%)"},children:e.jsx(ot,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-fg-primary font-sans",children:"Encrypted Message"}),e.jsxs("p",{className:"text-xs text-fg-muted font-sans mt-0.5",children:[t.srcHash," → ",t.destHash," · ",s]})]})]}):e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5 px-1",children:[e.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:[e.jsx("span",{className:"font-mono text-fg-secondary",children:t.srcHash})," → ",e.jsx("span",{className:"font-mono text-fg-secondary",children:t.destHash})]}),e.jsxs("span",{className:"text-[11px] text-fg-muted font-sans",children:["· ",s]})]}),e.jsx("div",{className:"inline-block max-w-[85%] px-3.5 py-2 rounded-2xl rounded-tr-md ml-auto",style:{background:"linear-gradient(135deg, var(--sys-green) 0%, var(--sys-teal) 100%)"},children:e.jsx("p",{className:"text-sm text-white font-sans leading-relaxed whitespace-pre-wrap break-words",children:t.text})})]})}function Pa({decoded:t,timestamp:a}){const s=a?ie(a):"Unknown",n=(t.partNumber+1)/t.totalParts*100;return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-sys-yellow/10",style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[e.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, var(--sys-yellow) 0%, var(--sys-amber) 100%)"},children:e.jsx(en,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-fg-primary font-sans truncate leading-tight",children:"Multipart Segment"}),e.jsxs("p",{className:"text-sm text-fg-muted font-sans mt-0.5",children:["Part ",t.partNumber+1," of ",t.totalParts]})]})]}),e.jsx("div",{className:"mx-4 border-t border-edge-subtle"}),e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.jsx("div",{children:e.jsx("div",{className:"h-2 bg-subtle-fill-strong rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${n}%`,background:"linear-gradient(90deg, var(--sys-yellow), var(--sys-amber))"}})})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Yt,{className:"w-4 h-4 text-sys-yellow flex-shrink-0"}),e.jsxs("span",{className:"text-sm text-fg-secondary font-sans",children:["Message ID: ",e.jsx("span",{className:"font-mono",children:t.messageId})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"w-4 h-4 text-sys-yellow flex-shrink-0"}),e.jsx("span",{className:"text-sm text-fg-secondary font-sans",children:s})]})]})]})})}function Ba({decoded:t,timestamp:a,payloadType:s}){const n=a?ie(a):"Unknown",i=(()=>{switch(s){case oe.REQ:return{icon:vs,gradient:"var(--sys-orange), var(--sys-red)",bg:"rgba(249, 115, 22, 0.15)",label:"Request"};case oe.RESPONSE:return{icon:_n,gradient:"var(--sys-green), var(--sys-teal)",bg:"rgba(34, 197, 94, 0.15)",label:"Response"};case oe.ANON_REQ:return{icon:ot,gradient:"var(--sys-indigo), var(--sys-pink)",bg:"rgba(91, 91, 214, 0.15)",label:"Anonymous Request"};default:return{icon:Ks,gradient:"var(--sys-gray), var(--sys-slate)",bg:"rgba(107, 114, 128, 0.15)",label:t.payloadTypeName}}})(),l=i.icon;return e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-md",style:{background:`linear-gradient(135deg, ${i.gradient})`},children:e.jsx(l,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-fg-primary font-sans",children:i.label}),e.jsxs("p",{className:"text-xs text-fg-muted font-sans mt-0.5",children:[t.length," bytes · ",n]})]})]})}function La({pathHex:t}){if(!t)return null;const a=We(t);return e.jsx("div",{className:"flex flex-wrap items-center gap-2 py-2",children:a.map((s,n)=>e.jsxs("div",{className:"flex items-center gap-2",children:[n>0&&e.jsx(ue,{className:"w-4 h-4 text-sys-amber flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ee,{size:"compact",copy:!0,children:s.toUpperCase()}),e.jsx("span",{className:"text-xs text-fg-muted font-sans tabular-nums w-4 text-left",children:n+1})]})]},n))})}function Ra({decoded:t,payloadType:a}){const s=bs[a]||`TYPE_${a}`;switch(t.type){case"advert":{const n=t.nodeType==="chat"?"companion":t.nodeType.replace("_"," "),r=t.latitude!==void 0&&t.longitude!==void 0&&!(t.latitude===0&&t.longitude===0);return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Role:"})," ",n]}),t.name&&e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Name:"})," ",t.name]}),r&&e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Location:"})," ",t.latitude.toFixed(4),"°, ",t.longitude.toFixed(4),"°"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Time:"})," ",ie(t.timestamp)]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Flags:"})," ",t.flagsDescription]})]})}case"ack":return e.jsx("div",{className:"text-xs text-fg-primary space-y-0.5",children:e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"CRC:"})," 0x",t.crc]})});case"path":return e.jsx("div",{className:"text-xs text-fg-primary space-y-1",children:e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Path:"})," ",t.pathString||"(empty)"]})});case"trace":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Tag:"})," 0x",t.traceTag]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Target Path:"})," ",t.pathString||"(empty)"]}),t.snrValues.length>0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"SNR:"})," ",t.snrValues.map(n=>`${n>=0?"+":""}${Number.isInteger(n)?n:n.toFixed(1)}dB`).join(" → ")]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Status:"})," ",t.isComplete?"✓ Complete":`In progress (${t.snrValues.length}/${t.pathHashes.length})`]})]});case"txt_msg":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Dest:"})," ",t.destHash]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Src:"})," ",t.srcHash]}),t.encrypted?e.jsx("p",{className:"text-fg-muted italic",children:"Encrypted content"}):e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Text:"})," ",t.text]})]});case"grp_txt":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Channel:"})," ",t.channelName?e.jsx("span",{className:"text-sys-green",children:t.channelName}):t.isPublicHashChannel?e.jsx("span",{className:"text-sys-indigo",children:"Public Hash Channel"}):e.jsxs("span",{className:"font-mono",children:["0x",t.channelHash]})]}),t.decrypted?e.jsxs(e.Fragment,{children:[t.senderName&&e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"From:"})," ",t.senderName]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Text:"})," ",t.text]})]}):t.isPublicHashChannel?e.jsx("p",{className:"text-fg-muted italic",children:"Encrypted (public hash channel)"}):e.jsx("p",{className:"text-fg-muted italic",children:"Encrypted (unknown channel)"})]});case"grp_data":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Channel:"})," ",t.channelName?e.jsx("span",{className:"text-sys-teal",children:t.channelName}):e.jsxs("span",{className:"font-mono",children:["0x",t.channelHash]})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Data:"})," ",t.dataLength," bytes ",t.decrypted?"(decrypted)":"(encrypted)"]})]});case"multipart":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Part:"})," ",t.partNumber+1,"/",t.totalParts]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Message ID:"})," ",t.messageId]})]});case"control":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Control:"})," ",t.subtypeName]}),t.dataLength>0&&e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Data:"})," ",t.dataLength," bytes"]})]});case"req":case"response":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Dest:"})," ",t.destHash]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Src:"})," ",t.srcHash]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Ciphertext:"})," ",t.ciphertextLength," bytes"]})]});case"anon_req":return e.jsxs("div",{className:"text-xs text-fg-primary space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Dest:"})," ",t.destHash]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Pub Key:"})," ",e.jsxs("span",{className:"font-mono break-all",children:[t.senderPublicKey.slice(0,16),"…"]})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-fg-muted",children:"Ciphertext:"})," ",t.ciphertextLength," bytes"]})]});default:return e.jsxs("p",{className:"text-xs text-fg-secondary",children:[s," (","length"in t?t.length:0," bytes)"]})}}function Ea({packet:t,decodedGrpTxt:a}){var H,Z;const s=t.raw_packet||"",n=s.length/2,r=gs(),[i,l]=m.useState(null),[c,o]=m.useState(null),[h,d]=m.useState(!1),[g,u]=m.useState(null),y=m.useCallback(A=>{u(R=>R===A?null:A)},[]),x=m.useMemo(()=>zs(s),[s]),v=(H=x==null?void 0:x.packet)==null?void 0:H.payloadType,p=(x==null?void 0:x.payloadHex)||"",w=(Z=x==null?void 0:x.packet)==null?void 0:Z.payload,j=v===oe.GRP_TXT,b=v===oe.GRP_DATA,f=j&&!a&&(!r||h);if(m.useEffect(()=>{if(l(null),d(!1),a||!j||!w||w.length<4)return;if(!r){d(!0);return}d(!0);let A=!1;return Qs(w).then(R=>{A||(l(R),d(!1))}),()=>{A=!0}},[p,j,r,a]),m.useEffect(()=>{if(o(null),!b||!w||w.length<4||!r)return;let A=!1;return qs(w).then(R=>{A||o(R)}),()=>{A=!0}},[p,b,r]),!x||s.length===0)return e.jsx("div",{className:"p-4 text-center text-fg-muted",children:e.jsx("p",{className:"text-sm",children:"No raw packet data available"})});const{packet:T}=x;let N=x.decoded;a&&x.decoded.type==="grp_txt"?N=a:i&&x.decoded.type==="grp_txt"?N=i:c&&x.decoded.type==="grp_data"&&(N=c);const D=()=>{switch(N.type){case"advert":return e.jsx(wa,{advert:N,timestamp:t.timestamp});case"grp_data":return e.jsx(ka,{decoded:N,timestamp:t.timestamp});case"grp_txt":return e.jsx(Ca,{decoded:N,timestamp:t.timestamp,isLoading:f,onDecrypted:l});case"ack":return e.jsx(Sa,{decoded:N,timestamp:t.timestamp});case"path":return e.jsx(_a,{decoded:N,timestamp:t.timestamp});case"trace":return e.jsx(Ma,{decoded:N,timestamp:t.timestamp});case"txt_msg":return e.jsx(Ta,{decoded:N,timestamp:t.timestamp});case"multipart":return e.jsx(Pa,{decoded:N,timestamp:t.timestamp});case"generic":return T.payloadType===oe.REQ||T.payloadType===oe.RESPONSE||T.payloadType===oe.ANON_REQ?e.jsx(Ba,{decoded:N,timestamp:t.timestamp,payloadType:T.payloadType}):null;default:return null}},O=m.useMemo(()=>ba(N,x.payloadHex),[N,x.payloadHex]),U=g==="payload"||je(g),X=m.useMemo(()=>{const A=[{id:"header",hex:x.headerHex,color:"red"},...x.transportCodesHex?[{id:"transportCodes",hex:x.transportCodesHex,color:"indigo"}]:[],{id:"pathLength",hex:x.pathLengthHex,color:"green"},...x.pathDataHex?[{id:"pathData",hex:x.pathDataHex,color:"amber"}]:[]];return U?[...A,...Na(O)]:[...A,{id:"payload",hex:x.payloadHex,color:"cyan"}]},[x,U,O]);return e.jsxs("div",{className:"font-mono space-y-2 min-w-0 overflow-hidden",children:[D(),e.jsx(ha,{rawHex:s,hexSegments:X,selectedSegment:g,onSegmentClick:y}),e.jsx(ys,{children:e.jsx(de.div,{layout:!0,transition:st,className:"space-y-2 min-w-0",children:(()=>{var C,Q,ae,B;const R=[{id:"header",title:"Header",color:"red",startByte:0,endByte:0,hexBytes:`0x${x.headerHex.toUpperCase()}`,condition:!0,content:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"type-micro text-fg-muted border-b border-edge-subtle font-sans",children:[e.jsx("th",{className:"py-1 font-medium",children:"Bits"}),e.jsx("th",{className:"py-1 font-medium",children:"Field"}),e.jsx("th",{className:"py-1 font-medium",children:"Value"}),e.jsx("th",{className:"py-1 font-medium",children:"Binary"})]})}),e.jsx("tbody",{children:x.headerFields.map(S=>e.jsx(va,{...S},S.bits))})]})},{id:"transportCodes",title:"Transport Codes",color:"indigo",startByte:1,endByte:4,hexBytes:((C=x.transportCodesHex)==null?void 0:C.toUpperCase())||"",condition:!!x.transportCodesHex,content:e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-fg-muted",children:"Two 16-bit transport codes for encrypted routing"}),e.jsxs("div",{className:"mt-1 text-xs text-fg-secondary",children:["Code 1: 0x",(Q=x.transportCodesHex)==null?void 0:Q.slice(0,4).toUpperCase()," | Code 2: 0x",(ae=x.transportCodesHex)==null?void 0:ae.slice(4,8).toUpperCase()]})]})},{id:"pathLength",title:"Path Length",color:"green",startByte:x.transportCodesHex?5:1,endByte:x.transportCodesHex?5:1,hexBytes:`0x${x.pathLengthHex.toUpperCase()}`,condition:!0,content:e.jsxs("p",{className:"text-xs text-fg-muted pt-1",children:[T.pathLen," bytes showing route taken (increases as packet floods)"]})},{id:"pathData",title:"Path Data",color:"amber",startByte:x.transportCodesHex?6:2,endByte:(x.transportCodesHex?5:1)+T.pathLen,hexBytes:((B=x.pathDataHex)==null?void 0:B.toUpperCase())||"",condition:T.pathLen>0,content:e.jsxs("div",{className:"space-y-3",children:[e.jsx(La,{pathHex:x.pathDataHex}),e.jsx("p",{className:"text-xs text-fg-muted",children:"Historical route taken (bytes are added as packet floods through network)"})]})},{id:"payload",title:"Payload",color:"cyan",startByte:x.payloadStartByte,endByte:n-1,hexBytes:x.payloadHex.toUpperCase(),condition:!0,content:e.jsxs(e.Fragment,{children:[!je(g)&&e.jsxs("div",{className:"p-3 rounded-lg bg-black",children:[e.jsx("p",{className:"type-micro text-fg-muted mb-1.5 font-sans",children:"Decoded"}),e.jsx(Ra,{decoded:N,payloadType:T.payloadType})]}),!je(g)&&O.length>0&&e.jsx("p",{className:"type-micro text-fg-muted mt-3 font-sans",children:"Click a field below to highlight its bytes"}),je(g)&&e.jsx("p",{className:"type-micro text-fg-muted font-sans",children:"↑ Selected field above • Other fields below ↓"})]})}].filter(S=>S.condition),F=je(g)?O.find(S=>S.id===g):null,se=je(g)?[...R].sort((S,te)=>S.id==="payload"?-1:te.id==="payload"?1:0):[...R].sort((S,te)=>S.id===g?-1:te.id===g?1:0),J=je(g)?O.filter(S=>S.id!==g):[];return e.jsxs(e.Fragment,{children:[F&&e.jsx(St,{id:`subfield-${F.id}`,title:F.title,color:F.color,startByte:x.payloadStartByte+F.startByte,endByte:x.payloadStartByte+F.endByte,hexBytes:F.hex.toUpperCase(),isSelected:!0,children:F.decoded},F.id),se.map(S=>e.jsx(St,{id:`section-${S.id}`,title:S.title,color:S.color,startByte:S.startByte,endByte:S.endByte,hexBytes:S.hexBytes,isSelected:S.id===g,children:S.content},S.id)),J.map(S=>e.jsxs(de.div,{layout:"position",layoutId:`subfield-${S.id}`,transition:st,className:"w-full min-w-0 overflow-hidden rounded-xl p-4 sm:p-5 space-y-4",style:{backgroundColor:_e.cardRestBg,boxShadow:_e.cardRestShadow},children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-0.5 min-w-0",children:[e.jsx(P,{color:S.color,children:S.title}),S.hex.length<=32&&We(S.hex).map((te,W)=>e.jsx(P,{color:S.color,className:"font-mono",children:te.toUpperCase()},W))]}),e.jsxs("span",{className:"type-data-xs text-fg-muted flex-shrink-0",children:["Bytes ",x.payloadStartByte+S.startByte,"-",x.payloadStartByte+S.endByte]})]}),e.jsx("div",{className:"min-w-0 overflow-hidden p-3 rounded-lg bg-black",children:S.decoded})]},S.id))]})})()})})]})}const _t=m.memo(Ea);function Mt(t){if(!t)return[];if(Array.isArray(t))return t;try{const a=JSON.parse(t);return Array.isArray(a)?a:[]}catch{return[]}}function nt(t){return t?(t.startsWith("0x")?t.slice(2):t).slice(0,2).toUpperCase():""}function za(t,a,s){const n=t.toUpperCase();if(s){let r=null,i=0;if(s.forEach((l,c)=>{if(nt(c)===n){const o=l.combinedScore??0;o>i&&(i=o,r=c)}}),r&&a[r])return{hash:r,info:a[r],confidence:i}}for(const[r,i]of Object.entries(a))if(nt(r)===n)return{hash:r,info:i,confidence:void 0};return null}function at({hop:t,compact:a=!1,index:s=0,highlightIndex:n=-1,isTrace:r=!1}){var c;const i=s===n,l=Fn();return m.useEffect(()=>{i&&r&&l.start({boxShadow:["0 0 0 0px rgba(113, 156, 223, 0)","0 0 0 2px rgba(113, 156, 223, 0.5)","0 0 0 2px rgba(113, 156, 223, 0.5)","0 0 0 0px rgba(113, 156, 223, 0)"],transition:{duration:.5,times:[0,.2,.7,1],ease:"easeInOut"}})},[i,r,l]),e.jsxs(de.div,{className:z("flex items-center gap-1.5",a?"flex-row":"flex-col"),animate:{scale:i?1.05:1,opacity:i?1:.85},transition:{duration:.3,ease:"easeInOut"},children:[e.jsxs(de.div,{className:z("flex items-center gap-1.5 px-2.5 py-1 rounded-md","font-mono text-xs font-semibold",t.isLocal?"bg-sys-amber/20 text-sys-amber ring-1 ring-sys-amber/30":"bg-elevated/50 text-fg-primary ring-1 ring-edge-strong/50"),animate:l,initial:{boxShadow:"0 0 0 0px rgba(113, 156, 223, 0)"},children:[t.isLocal&&e.jsx(an,{className:"w-3 h-3"}),e.jsx("span",{children:t.prefix}),t.confidence!==void 0&&t.confidence<.9&&e.jsxs("span",{className:"text-[9px] opacity-70",children:[(t.confidence*100).toFixed(0),"%"]})]}),!a&&((c=t.neighborInfo)==null?void 0:c.name)&&e.jsx("span",{className:"text-xs text-fg-muted truncate max-w-[80px]",children:t.neighborInfo.name})]})}function Fa({snr:t,sf:a}){const s=Cs(t,a),r=ks()[s]||"#6b7280",i=Number.isInteger(t)?t.toString():t.toFixed(1);return e.jsxs(P,{customColor:r,compact:!0,className:"font-mono",children:[t>=0?"+":"",i,"dB"]})}function Ia({hops:t,compact:a,isTrace:s=!1,sf:n}){const[r,i]=m.useState(-1);return m.useEffect(()=>{if(t.length===0)return;const l=setTimeout(()=>{i(0)},400),c=setInterval(()=>{i(o=>{const h=o+1;return h>=t.length?(clearInterval(c),-1):h})},s?500:600);return()=>{clearTimeout(l),clearInterval(c)}},[t.length,s]),e.jsx("div",{className:"p-6",style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:"4px 8px"},children:t.map((l,c)=>{const o=c%2===0,h=c===t.length-1;return e.jsxs("div",{className:"contents",children:[e.jsx("div",{className:z("flex items-center","justify-end"),children:o&&e.jsx(at,{hop:l,compact:a,index:c,highlightIndex:r,isTrace:s})}),e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[28px]",children:!h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px flex-1 bg-border-strong/40 min-h-[8px]"}),l.snr!==void 0&&e.jsx(Fa,{snr:l.snr,sf:n}),e.jsx("svg",{className:"w-3 h-3 text-fg-muted flex-shrink-0",viewBox:"0 0 12 12",fill:"none",children:e.jsx("path",{d:"M6 2v8M3 7l3 3 3-3",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]})}),e.jsx("div",{className:z("flex items-center","justify-start"),children:!o&&e.jsx(at,{hop:l,compact:a,index:c,highlightIndex:r,isTrace:s})})]},`${l.prefix}-${c}`)})})}function Aa({packet:t,neighbors:a,localHash:s,neighborAffinity:n,ghostPrefixes:r,direction:i="horizontal",compact:l=!1,traceSnr:c,overridePath:o}){const h=c!==void 0&&c.length>0,d=ws(),g=Mt(t.original_path),u=Mt(t.forwarded_path),y=o??(u.length>0?u:g),x=nt(s),v=m.useMemo(()=>y.map((w,j)=>{const b=w.toUpperCase(),f=b===x,T=(r==null?void 0:r.has(b))??!1,N=za(b,a,n);return{prefix:b,fullHash:N==null?void 0:N.hash,neighborInfo:N==null?void 0:N.info,isLocal:f,isGhost:T,confidence:N==null?void 0:N.confidence,snr:c==null?void 0:c[j]}}),[y,a,n,x,r,c]);if(v.length===0)return e.jsxs("div",{className:"flex items-center gap-2 text-fg-muted text-xs",children:[e.jsx(ge,{className:"w-4 h-4 opacity-50"}),e.jsx("span",{children:"Direct / No path data"})]});if(i==="flowchart")return e.jsx(Ia,{hops:v,compact:l,isTrace:h,sf:d});const p=i==="horizontal"?ue:Kt;return e.jsx("div",{className:z("flex gap-1.5",i==="horizontal"?"flex-row flex-wrap items-center":"flex-col items-start"),children:v.map((w,j)=>e.jsxs("div",{className:z("flex items-center gap-1.5",i==="vertical"&&"flex-col"),children:[e.jsx(at,{hop:w,compact:l}),j<v.length-1&&e.jsx(p,{className:"w-3 h-3 text-fg-muted flex-shrink-0"})]},`${w.prefix}-${j}`))})}const Ce=m.memo(Aa);function ne(t,a){if(t!=null)return typeof t=="boolean"?String(t):typeof t=="number"&&a?`${t} ${a}`:String(t)}const V=()=>"blue",Da=[{fn:"id",group:"identity",fmt:"int",read:t=>ne(t.id),color:V},{fn:"packet_hash",group:"identity",fmt:"hex<sha256>",read:t=>t.packet_hash||void 0,color:V},{fn:"timestamp",group:"identity",fmt:"epoch<s>",read:t=>t.timestamp?String(t.timestamp):void 0,color:V,annotate:t=>t.timestamp>0?Ze(t.timestamp):void 0},{fn:"type",group:"classification",fmt:"enum<payload_type>",read:t=>ne(t.type??t.payload_type),color:V},{fn:"route",group:"classification",fmt:"enum<route_type>",read:t=>ne(t.route??t.route_type),color:V},{fn:"rssi",group:"signal",fmt:"int<dBm>",read:t=>ne(t.rssi,"dBm"),color:V},{fn:"snr",group:"signal",fmt:"float<dB>",read:t=>ne(t.snr,"dB"),color:V},{fn:"path_length",group:"size",fmt:"int<hops>",read:t=>{if(t.path_length!=null)return t.path_length===0?"zero-hop":`${t.path_length} hops`},color:V},{fn:"payload_length",group:"size",fmt:"int<B>",read:t=>ne(t.payload_length,"B"),color:V},{fn:"airtime",group:"size",fmt:"float<ms>",read:t=>ne(t.airtime_ms,"ms"),color:V},{fn:"src_hash",group:"addressing",fmt:"hex<2>",read:t=>t.src_hash??void 0,color:V},{fn:"dst_hash",group:"addressing",fmt:"hex<2>",read:t=>t.dst_hash??void 0,color:V},{fn:"path_hash",group:"addressing",fmt:"hex[]|hex",read:t=>Array.isArray(t.path_hash)?`[${t.path_hash.join(", ")}]`:ne(t.path_hash),color:V,renderValue:t=>Array.isArray(t.path_hash)?Ye(t.path_hash):null},{fn:"score",group:"addressing",fmt:"int",read:t=>ne(t.score),color:V},{fn:"original_path",group:"paths",fmt:"hex[]",read:t=>Array.isArray(t.original_path)?`[${t.original_path.join(", ")}]`:void 0,color:V,renderValue:t=>Array.isArray(t.original_path)&&t.original_path.length>0?Ye(t.original_path,t.src_hash||void 0,t.dst_hash||void 0,!0):null},{fn:"forwarded_path",group:"paths",fmt:"hex[]",read:t=>Array.isArray(t.forwarded_path)?`[${t.forwarded_path.join(", ")}]`:void 0,color:V,renderValue:t=>Array.isArray(t.forwarded_path)&&t.forwarded_path.length>0?Ye(t.forwarded_path):null},{fn:"transmitted",group:"status",fmt:"bool",read:t=>ne(t.transmitted),color:V},{fn:"is_duplicate",group:"status",fmt:"bool",read:t=>ne(t.is_duplicate),color:V},{fn:"drop_reason",group:"status",fmt:"string|null",read:t=>t.drop_reason??void 0,color:V},{fn:"tx_delay",group:"status",fmt:"int<ms>",read:t=>ne(t.tx_delay_ms,"ms"),color:V},{fn:"origin",group:"status",fmt:"enum<rx|tx_local|tx_forward>",read:t=>t.packet_origin??void 0,color:V},{fn:"duplicates",group:"status",fmt:"PacketDuplicate[]",read:t=>t.duplicates!=null&&t.duplicates.length>0?`${t.duplicates.length}`:ne(t.duplicates),color:V},{fn:"lbt_attempts",group:"lbt",fmt:"int",read:t=>ne(t.lbt_attempts),color:V},{fn:"lbt_backoff",group:"lbt",fmt:"json<float[]>",read:t=>ne(t.lbt_backoff_delays_ms),color:V},{fn:"lbt_busy",group:"lbt",fmt:"bool|int",read:t=>ne(t.lbt_channel_busy),color:V}];function Ye(t,a,s,n){const r=t.length>0,i=a||n,l=s||n;return e.jsxs("span",{className:"inline-flex items-center gap-1 flex-wrap",children:[i&&e.jsxs(e.Fragment,{children:[a?e.jsx("span",{className:"inline-block border border-edge-subtle rounded px-1.5 py-0.5 font-mono text-[11px] text-sys-blue",children:a}):e.jsx("span",{className:"inline-block border border-edge-subtle/50 rounded px-1.5 py-0.5 font-mono text-[11px] text-fg-muted/30",children:"XX"}),(r||l)&&e.jsx("span",{className:"text-fg-muted/40 text-[10px]",children:"→"})]}),t.map((c,o)=>e.jsxs(m.Fragment,{children:[o>0&&e.jsx("span",{className:"text-fg-muted/40 text-[10px]",children:"→"}),e.jsx("span",{className:"inline-block border border-edge-subtle rounded px-1.5 py-0.5 font-mono text-[11px] text-sys-blue",children:c})]},o)),l&&e.jsxs(e.Fragment,{children:[r&&e.jsx("span",{className:"text-fg-muted/40 text-[10px]",children:"→"}),s?e.jsx("span",{className:"inline-block border border-edge-subtle rounded px-1.5 py-0.5 font-mono text-[11px] text-sys-blue",children:s}):e.jsx("span",{className:"inline-block border border-edge-subtle/50 rounded px-1.5 py-0.5 font-mono text-[11px] text-fg-muted/30",children:"XX"})]})]})}let Fe=null;function Ha(){if(!Fe){Fe=new Map;for(const t of Da)Fe.set(t.fn,t)}return Fe}function Tt(t,a){var l;const s=Ha().get(a);if(!s)return null;const n=s.read(t);if(n===void 0)return null;const r=s.color(t),i=(l=s.annotate)==null?void 0:l.call(s,t);return i?{text:n,color:r,annotation:i}:{text:n,color:r}}function Pt(t){if(!t)return[];if(Array.isArray(t))return t;try{const a=JSON.parse(t);return Array.isArray(a)?a:[]}catch{return[]}}function Bt({packets:t,selectedIndex:a,onSelect:s,compact:n=!1}){if(t.length<=1)return null;const r=a>0,i=a<t.length-1;return e.jsxs("div",{className:z("flex items-center gap-1",n?"gap-0.5":"gap-1"),children:[e.jsx("button",{onClick:()=>r&&s(a-1),disabled:!r,className:z("p-0.5 radius-badge transition-base",r?"text-fg-muted hover:text-fg-primary hover-bg":"text-fg-muted cursor-not-allowed"),"aria-label":"Previous observation",children:e.jsx(Xt,{className:n?"size-3":"size-4"})}),e.jsx("div",{className:"flex items-center gap-0.5",children:t.map((l,c)=>{const o=c===a,d=new Date(l.timestamp*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});return e.jsx(Ls,{color:o?"cyan":"zinc",filled:o,compact:n,onClick:()=>s(c),title:`Observation ${c+1} at ${d}`,className:z("transition-all duration-150",!o&&"opacity-60 hover:opacity-100"),children:n?e.jsx("span",{className:"tabular-nums",children:c+1}):e.jsxs("span",{className:"tabular-nums text-xs",children:["#",c+1,l.rssi!=null&&e.jsx("span",{className:"ml-1 opacity-70",children:l.rssi})]})},`${l.timestamp}_${c}`)})}),e.jsx("button",{onClick:()=>i&&s(a+1),disabled:!i,className:z("p-0.5 radius-badge transition-base",i?"text-fg-muted hover:text-fg-primary hover-bg":"text-fg-muted cursor-not-allowed"),"aria-label":"Next observation",children:e.jsx(ct,{className:n?"size-3":"size-4"})}),e.jsxs("span",{className:z("text-fg-muted ml-1",n?"text-[9px]":"text-xs"),children:[e.jsx(it,{className:"inline size-3 mr-0.5 opacity-50"}),t.length]})]})}function Ie({icon:t,label:a,disabled:s=!1}){return e.jsx(de.div,{className:"flex items-center gap-1 text-xs",title:a,animate:{opacity:s?.25:.6},transition:{duration:.15,ease:[.4,0,.2,1]},children:e.jsx("span",{className:z("flex items-center justify-center size-5 radius-badge border-control transition-base",s?"bg-subtle-fill border-edge-subtle":"bg-subtle-fill"),children:t})})}function Oa({hasDuplicates:t,hasPrev:a,hasNext:s,canPrevDupe:n,canNextDupe:r}){return e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(Ie,{icon:e.jsx(bn,{className:"size-3"}),label:"Previous packet (↑)",disabled:!a}),e.jsx(Ie,{icon:e.jsx(Rs,{className:"size-3"}),label:"Next packet (↓)",disabled:!s})]}),t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-3 bg-subtle-fill-strong"}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(Ie,{icon:e.jsx(Xt,{className:"size-3"}),label:"Previous observation (←)",disabled:!n}),e.jsx(Ie,{icon:e.jsx(ct,{className:"size-3"}),label:"Next observation (→)",disabled:!r})]})]})]})}function $a({packets:t,initialIndex:a=0,onClose:s,onNavigatePrev:n,onNavigateNext:r,hasPrev:i=!1,hasNext:l=!1,resolveSource:c}){var ve;const[o,h]=m.useState(a),d=t[o]??t[0],g=t.length>1,[u,y]=m.useState(null),[x,v]=m.useState(!1);m.useEffect(()=>{if(!d._stripped){y(null);return}let K=!1;v(!0);const Y=d.packet_hash;if(!Y){v(!1);return}return Ss(Y).then(re=>{K||(re.success&&re.data&&(y(re.data),(re.data.type??re.data.payload_type)===oe.GRP_TXT&&re.data.raw_packet&&_s.getState().queueDecryption([re.data])),v(!1))}).catch(()=>{K||v(!1)}),()=>{K=!0}},[d]);const p=u??d,w=o>0,j=o<t.length-1,b=m.useCallback(K=>{h(Math.max(0,Math.min(K,t.length-1)))},[t.length]);m.useEffect(()=>{const K=Y=>{if(!(Y.target instanceof HTMLInputElement||Y.target instanceof HTMLTextAreaElement))switch(Y.key){case"ArrowUp":Y.preventDefault(),n==null||n();break;case"ArrowDown":Y.preventDefault(),r==null||r();break;case"ArrowLeft":Y.preventDefault(),w&&h(re=>re-1);break;case"ArrowRight":Y.preventDefault(),j&&h(re=>re+1);break}};return window.addEventListener("keydown",K),()=>window.removeEventListener("keydown",K)},[n,r,w,j]);const f=Ot(),T=Ms(),N=Ts(),D=Ps(),O=m.useMemo(()=>new Set(D.map(K=>K.prefix.toUpperCase())),[D]),U=p.payload_type_name||Dt(p.payload_type??p.type),X=p.route_type_name||Ht(p.route_type??p.route),H=p.payload_length??p.length??0,Z=Pt(p.original_path),A=Pt(p.forwarded_path),R=Z.length>0||A.length>0,F=A.length>0?A:Z,se=m.useMemo(()=>{var K;if((K=f==null?void 0:f.config)!=null&&K.repeater)return{latitude:f.config.repeater.latitude,longitude:f.config.repeater.longitude,name:f.config.node_name||"Local Node"}},[f]),J=(f==null?void 0:f.neighbors)??{},C=N.size>0?N:void 0,Q=p.raw_packet&&p.raw_packet.length>0,ae=d._stripped&&x,B=m.useMemo(()=>c?c(p):null,[c,p]),S=Bs(p.packet_hash),te=m.useMemo(()=>{if((p.payload_type??p.type)!==oe.GRP_TXT||!(S!=null&&S.decoded))return null;const Y=S.decoded;return{type:"grp_txt",channelHash:Y.channelHash,channelName:Y.channelName,text:Y.text??"",decrypted:Y.decrypted,senderName:Y.senderName,timestamp:Y.timestamp,flags:Y.flags,macCorrupted:Y.macCorrupted}},[p,S]),W=m.useMemo(()=>Fs(p,te),[p,te]),q=W.kind==="trace"?W.data:null,L=W.kind==="trace"?W.snrValues:void 0,M=W.kind==="advert"?W.data:null,le=W.kind==="advert"?W.sourceNode:void 0,$=W.kind==="grp_txt"?W.wardriveSourceNode??void 0:void 0,ce=K=>!K||K===0?"Unknown":new Date(K*1e3).toLocaleString(),Pe=(p.payload_type??p.type)===oe.ADVERT&&(le!==void 0||R),Be=$!==void 0,Ne=le??$,Le=Te[U]??"zinc",Ge=me[Le]||me.zinc;return e.jsxs($t,{open:!0,onClose:s,size:"5xl",motionPlus:!0,className:"sm:h-[85vh] sm:max-h-[800px] md:h-[80vh] md:max-h-[900px]",children:[e.jsxs("div",{className:"sm:hidden",children:[e.jsx("div",{className:"flex justify-center pt-2 pb-1",children:e.jsx("div",{className:"w-9 h-1 rounded-full bg-fg-muted","aria-hidden":"true"})}),e.jsxs("div",{className:"flex items-center justify-between px-3 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(P,{color:Te[U]??"zinc",className:"!text-[9px] !px-1.5 !py-0",children:U}),e.jsx(P,{color:Ae[X]??"zinc",className:"!text-[9px] !px-1.5 !py-0",children:X}),e.jsxs(P,{color:"zinc",className:"!text-[9px] !px-1.5 !py-0",children:[H,"B"]})]}),e.jsx("button",{onClick:s,className:"px-3 py-1.5 text-[15px] font-medium text-sys-blue active:text-sys-blue/80 transition-base flex-shrink-0 radius-inner active:bg-subtle-fill",children:"Done"})]}),g&&e.jsx("div",{className:"px-3 pb-2",children:e.jsx(Bt,{packets:t,selectedIndex:o,onSelect:b,compact:!0})})]}),e.jsx("div",{className:"hidden sm:block px-6 pt-5 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{color:Te[U]??"zinc",children:U}),e.jsx(P,{color:Ae[X]??"zinc",children:X}),e.jsxs(P,{color:"zinc",children:[H,"B"]}),g&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-4 bg-subtle-fill-strong"}),e.jsx(Bt,{packets:t,selectedIndex:o,onSelect:b})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Oa,{hasDuplicates:g,hasPrev:i,hasNext:l,canPrevDupe:w,canNextDupe:j}),e.jsx("button",{onClick:s,className:"p-1.5 -m-1.5 text-fg-muted hover:text-fg-primary transition-base radius-inner hover:bg-elevated flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})}),e.jsx("div",{className:"sm:hidden h-[2px]",style:{backgroundColor:Ge,opacity:.6}}),e.jsxs(Ut,{className:"p-0 overflow-hidden flex-1 flex flex-col min-h-0",children:[e.jsx("div",{className:"md:hidden flex-1 overflow-y-auto overflow-x-hidden",children:e.jsxs("div",{className:"p-2 space-y-2",children:[(p.rssi!=null||p.snr!=null)&&e.jsxs("div",{className:"relative flex items-center justify-between px-2 py-1.5 radius-inner bg-subtle-fill",children:[e.jsx(qe,{mode:"popLayout",initial:!1,children:e.jsxs(de.div,{className:"flex items-center gap-3",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[e.jsx(De,{rssi:p.rssi,snr:p.snr,compact:!0,showValues:!0,validated:He(p)}),e.jsx("span",{className:"text-[11px] text-fg-muted",children:ft(p.rssi)})]},o)}),F.length>0&&e.jsxs("span",{className:"type-data-xs text-fg-muted",children:[F.length," hop",F.length!==1?"s":""]})]}),(R&&F.length>0||Pe||Be)&&e.jsx("div",{className:"overflow-hidden radius-inset",children:e.jsx("div",{className:"aspect-[4/3] w-full",children:e.jsx(Ve,{path:F,neighbors:J,localNode:se,localHash:f==null?void 0:f.local_hash,srcHash:p.src_hash,dstHash:p.dst_hash,neighborAffinity:C,hubNodes:[...T],traceSnr:L,advertiserSource:Ne})})}),q&&q.pathHashes.length>0&&e.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[e.jsx("div",{className:"px-3 py-2 space-y-1.5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Trace Route"}),e.jsx("div",{className:"flex items-center gap-1.5",children:e.jsx(P,{color:q.isComplete?"green":"amber",compact:!0,children:q.isComplete?"Complete":"In Progress"})})]})}),e.jsx(Ce,{packet:p,neighbors:J,localHash:f==null?void 0:f.local_hash,neighborAffinity:C,ghostPrefixes:O,direction:"flowchart",compact:!0,overridePath:q.pathHashes,traceSnr:q.snrValues})]}),R&&!q&&e.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Path"}),e.jsxs(P,{color:"zinc",compact:!0,children:[F.length," hop",F.length!==1?"s":""]})]}),e.jsx(Ce,{packet:p,neighbors:J,localHash:f==null?void 0:f.local_hash,neighborAffinity:C,ghostPrefixes:O,direction:"flowchart",compact:!0,traceSnr:L})]}),B&&(B.name||B.hash)&&!M&&e.jsxs("div",{className:"radius-inset bg-subtle-fill overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-edge-subtle",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Source"}),e.jsx(P,{color:B.isRepeater?"blue":B.isCompanion?"violet":B.type==="room_server"?"lime":"zinc",compact:!0,children:B.type==="room_server"?"room server":B.type})]}),e.jsxs("div",{className:"p-3 space-y-1.5",children:[B.name&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"type-label text-fg-primary truncate",children:B.name}),!B.confident&&e.jsx("span",{className:"text-[9px] text-fg-muted/60 italic",children:"ambiguous"})]}),B.hash&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsxs("span",{className:"type-data-xs text-fg-muted truncate font-mono",children:[B.hash.startsWith("0x")?B.hash.slice(2,10):B.hash.slice(0,8),"…"]})]})]})]}),M&&e.jsxs("div",{className:"radius-inset bg-subtle-fill overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-edge-subtle",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Advertiser Info"}),e.jsx(P,{color:"lime",compact:!0,children:M.nodeType})]}),e.jsxs("div",{className:"p-3 space-y-2",children:[M.name&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"type-label text-fg-primary truncate",children:M.name})]}),M.latitude&&M.longitude&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsxs("span",{className:"type-data-xs text-fg-secondary",children:[M.latitude.toFixed(5),", ",M.longitude.toFixed(5)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsxs("span",{className:"type-data-xs text-fg-muted truncate",children:[M.publicKey.slice(0,16),"...",M.publicKey.slice(-8)]})]}),M.timestamp>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"text-xs text-fg-muted",children:ce(M.timestamp)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-3.5 h-3.5 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"text-xs text-fg-muted",children:M.flagsDescription||`Flags: 0x${M.flags.toString(16).padStart(2,"0")}`})]})]})]}),ae?e.jsx("div",{className:"pt-1 px-3 py-6 text-center",children:e.jsx("span",{className:"text-xs text-fg-muted animate-pulse",children:"Loading packet details…"})}):Q?e.jsx("div",{className:"pt-1",children:e.jsx(_t,{packet:p,decodedGrpTxt:te})}):null]})}),e.jsxs("div",{className:"hidden md:grid md:grid-cols-2 flex-1 overflow-hidden",children:[e.jsx("div",{className:"overflow-y-auto overflow-x-hidden scrollbar-none p-4 border-r border-edge-subtle",children:ae?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("span",{className:"text-sm text-fg-muted animate-pulse",children:"Loading packet details…"})}):Q?e.jsx(_t,{packet:p,decodedGrpTxt:te}):null}),e.jsxs("div",{className:"grid overflow-hidden",style:{gridTemplateRows:"minmax(280px, 1fr) auto"},children:[e.jsx("div",{className:"overflow-hidden p-2",children:R&&F.length>0||Pe||Be?e.jsx("div",{className:"h-full w-full",children:e.jsx(Ve,{path:F,neighbors:J,localNode:se,localHash:f==null?void 0:f.local_hash,srcHash:p.src_hash,dstHash:p.dst_hash,neighborAffinity:C,hubNodes:[...T],traceSnr:L,advertiserSource:Ne})}):e.jsxs("div",{className:"h-full w-full flex flex-col items-center justify-center text-center px-4",children:[e.jsx(ge,{className:"w-8 h-8 text-fg-muted/50 mb-2"}),e.jsx("span",{className:"text-sm text-fg-muted",children:"Direct Reception"}),e.jsx("span",{className:"text-xs text-fg-muted/70 mt-1",children:"Zero-hop packet — received directly from sender"})]})}),e.jsxs("div",{className:"overflow-y-auto max-h-[200px] p-2 space-y-2",children:[!q&&F.length<=1&&(p.rssi!=null||p.snr!=null)&&e.jsx("div",{className:"surface-base radius-inset p-4",children:e.jsxs("dl",{className:"text-xs grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-fg-muted mb-1",children:"Signal"}),e.jsx(qe,{mode:"popLayout",initial:!1,children:e.jsxs(de.dd,{className:"flex items-center gap-2",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[e.jsx(De,{rssi:p.rssi,snr:p.snr,validated:He(p)}),e.jsx("span",{className:"font-medium text-fg-primary",children:ft(p.rssi)})]},o)})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-fg-muted mb-1",children:"RF"}),e.jsx(qe,{mode:"popLayout",initial:!1,children:e.jsxs(de.dd,{className:"type-data text-fg-secondary",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.15,ease:[.4,0,.2,1]},children:[(ve=Tt(p,"rssi"))==null?void 0:ve.text,(()=>{const K=Tt(p,"snr");return K?` · ${K.text}`:null})()]},o)})]})]})}),B&&(B.name||B.hash)&&!M&&e.jsxs("div",{className:"radius-inset bg-subtle-fill overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-edge-subtle",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Source"}),e.jsx(P,{color:B.isRepeater?"blue":B.isCompanion?"violet":B.type==="room_server"?"lime":"zinc",compact:!0,children:B.type==="room_server"?"room server":B.type})]}),e.jsxs("div",{className:"p-4 space-y-2",children:[B.name&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"type-label text-fg-primary truncate",children:B.name}),!B.confident&&e.jsx("span",{className:"text-[10px] text-fg-muted/60 italic",children:"ambiguous"})]}),B.hash&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsxs("span",{className:"text-[11px] font-mono text-fg-muted truncate",children:[B.hash.startsWith("0x")?B.hash.slice(2,10):B.hash.slice(0,8),"…"]})]})]})]}),M&&e.jsxs("div",{className:"radius-inset bg-subtle-fill overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-edge-subtle",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Advertiser"}),e.jsx(P,{color:"lime",compact:!0,children:M.nodeType})]}),e.jsxs("div",{className:"p-4 space-y-2.5",children:[M.name&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"type-label text-fg-primary truncate",children:M.name})]}),M.latitude&&M.longitude&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsxs("span",{className:"type-data-xs text-fg-secondary",children:[M.latitude.toFixed(5),", ",M.longitude.toFixed(5)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsxs("span",{className:"text-[11px] font-mono text-fg-muted truncate",children:[M.publicKey.slice(0,16),"...",M.publicKey.slice(-8)]})]}),M.timestamp>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"text-xs text-fg-muted",children:ce(M.timestamp)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"text-[11px] text-fg-muted",children:M.flagsDescription||`Flags: 0x${M.flags.toString(16).padStart(2,"0")}`})]})]})]}),q&&q.pathHashes.length>0&&e.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Trace Route"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(P,{color:q.isComplete?"green":"amber",compact:!0,children:q.isComplete?"Complete":"In Progress"}),e.jsxs(P,{color:"teal",compact:!0,children:[q.pathHashes.length,"h"]})]})]}),e.jsx(Ce,{packet:p,neighbors:J,localHash:f==null?void 0:f.local_hash,neighborAffinity:C,ghostPrefixes:O,direction:"flowchart",compact:!0,overridePath:q.pathHashes,traceSnr:q.snrValues})]}),R&&!q&&e.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Path"}),e.jsxs(P,{color:"zinc",compact:!0,children:[F.length,"h"]})]}),e.jsx(Ce,{packet:p,neighbors:J,localHash:f==null?void 0:f.local_hash,neighborAffinity:C,ghostPrefixes:O,direction:"flowchart",compact:!0,traceSnr:L})]})]})]})]})]})]})}const Ua=m.memo($a);function Lt({label:t,numericValue:a,unit:s,icon:n,subtext:r,showSign:i=!1}){return e.jsxs("div",{className:"radius-inner p-3 sm:radius-inset sm:p-4 bg-subtle-fill ring-1 ring-inset ring-edge-subtle",children:[e.jsx("div",{className:"mb-1.5 sm:mb-2",children:e.jsx("span",{className:"text-xs sm:type-micro text-fg-muted",children:t})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(et,{value:a,format:{minimumFractionDigits:1,maximumFractionDigits:1,signDisplay:i?"always":"auto"},className:"type-data-hero tracking-tight text-fg-primary"}),e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(n,{className:"w-[14px] h-[14px] text-fg-muted"}),s&&e.jsx("span",{className:"text-xs font-medium leading-tight text-fg-muted",children:s})]})]}),r&&e.jsx("p",{className:"mt-1.5 sm:mt-2 type-data-xs sm:text-[11px] text-fg-muted/80 truncate",children:r})]})}function Va({snr:t}){const a=t>=5?"bg-sys-teal":t>=0?"bg-sys-green":t>=-5?"bg-sys-amber":t>=-10?"bg-sys-orange":"bg-sys-red";return e.jsx("span",{className:z("w-1.5 h-1.5 rounded-full flex-shrink-0",a),title:`SNR: ${t.toFixed(1)} dB`})}function Rt({fromPrefix:t,toPrefix:a,fromName:s,toName:n,snr:r,maxSnr:i,isWeakest:l,isStrongest:c,index:o=0}){const d=Math.max(i+5,15),g=Math.max(0,Math.min(100,(r- -20)/(d- -20)*100)),u="bg-[#0074BE]",y=r>=5?"bg-sys-teal":r>=0?"bg-sys-green":r>=-5?"bg-sys-amber":r>=-10?"bg-sys-orange":"bg-sys-red",x=.3+o*.15;return e.jsxs("div",{className:"relative p-3 pl-5 radius-inner bg-subtle-fill ring-1 ring-inset ring-edge-subtle",children:[e.jsx("span",{className:z("absolute left-0 top-1/2 -translate-y-1/2 h-4 w-0.5 rounded-full",y)}),e.jsx("span",{className:"absolute -top-0.5 -right-0.5",children:e.jsx(Va,{snr:r})}),e.jsxs("div",{className:"sm:hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("span",{className:"text-[13px] font-medium text-fg-secondary truncate",children:s||t}),e.jsx(ue,{className:"w-3 h-3 text-fg-muted flex-shrink-0"}),e.jsx("span",{className:"text-[13px] font-semibold text-fg-primary truncate",children:n||a})]}),e.jsxs("div",{className:"flex items-center gap-1.5 ml-2 flex-shrink-0",children:[l&&e.jsx(P,{color:"red",compact:!0,children:"Low"}),c&&!l&&e.jsxs(P,{color:"amber",compact:!0,children:[e.jsx(kt,{className:"w-2.5 h-2.5"}),"Best"]}),e.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[12px] font-mono font-bold tabular-nums bg-subtle-fill-hover text-fg-primary ring-1 ring-inset ring-edge-subtle",children:[r>=0?"+":"−",Math.abs(r).toFixed(1)]})]})]}),e.jsx("div",{className:"h-1.5 bg-subtle-fill-strong rounded-full overflow-hidden",children:e.jsx(de.div,{className:z("h-full rounded-full",u),initial:{width:0},animate:{width:`${g}%`},transition:{duration:1.5,delay:x,ease:[.25,.1,.25,1]}})})]}),e.jsxs("div",{className:"hidden sm:block",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx("code",{className:"type-data-xs text-fg-muted",children:t}),s&&e.jsx("span",{className:"text-xs text-fg-secondary truncate max-w-[100px]",children:s})]}),e.jsx(ue,{className:"w-3 h-3 text-fg-muted/40 flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx("code",{className:"font-mono text-xs font-semibold text-fg-primary",children:a}),n&&e.jsx("span",{className:"text-xs text-fg-secondary truncate max-w-[100px]",children:n})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[l&&e.jsx(P,{color:"red",compact:!0,children:"Bottleneck"}),c&&!l&&e.jsxs(P,{color:"amber",compact:!0,children:[e.jsx(kt,{className:"w-3 h-3"}),"Strongest"]}),e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-sm font-mono font-semibold tabular-nums bg-subtle-fill-hover text-fg-primary ring-1 ring-inset ring-edge-subtle",children:[r>=0?"+":"−",Math.abs(r).toFixed(1)]})]})]}),e.jsx("div",{className:"h-1.5 bg-elevated rounded-full overflow-hidden",children:e.jsx(de.div,{className:z("h-full rounded-full",u),initial:{width:0},animate:{width:`${g}%`},transition:{duration:1.5,delay:x,ease:[.25,.1,.25,1]}})})]})]})}function fe(t,a){if(t==="You")return"You";const s=t.toUpperCase();for(const[n,r]of Object.entries(a))if((n.startsWith("0x")?n.slice(2,4):n.slice(0,2)).toUpperCase()===s)return r.name||r.node_name||void 0}function Wa({report:t,onClose:a}){var h,d;const s=Ot(),n=(s==null?void 0:s.neighbors)??{},r=(h=s==null?void 0:s.config)!=null&&h.repeater?{latitude:s.config.repeater.latitude,longitude:s.config.repeater.longitude,name:s.config.node_name||"Local Node"}:void 0,i=(d=t.bestObservation)==null?void 0:d.decoded.snrValues,l=t.linkQuality?t.linkQuality.avgSnr>=5?"excellent":t.linkQuality.avgSnr>=0?"good":t.linkQuality.avgSnr>=-5?"fair":"poor":"unknown",o={excellent:"var(--signal-excellent)",good:"var(--signal-good)",fair:"var(--signal-fair)",poor:"var(--signal-poor)",unknown:"var(--fg-muted)"}[l];return e.jsxs($t,{open:!0,onClose:a,size:"5xl",motionPlus:!0,children:[e.jsxs("div",{className:"sm:hidden",children:[e.jsx("div",{className:"flex justify-center pt-2 pb-1",children:e.jsx("div",{className:"w-9 h-1 rounded-full bg-fg-primary/30","aria-hidden":"true"})}),e.jsxs("div",{className:"flex items-center justify-between px-4 pb-2",children:[e.jsx("h2",{className:"font-semibold text-[17px] text-fg-primary",children:"Trace Report"}),e.jsx("button",{onClick:a,className:"text-[17px] font-medium text-sys-blue active:text-sys-blue/80",children:"Done"})]})]}),e.jsx("div",{className:"sm:hidden h-[2px]",style:{backgroundColor:o,opacity:.6}}),e.jsx("div",{className:"hidden sm:block px-6 pt-5 pb-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[e.jsx("h2",{className:"type-micro",children:"Trace Report"}),e.jsxs(P,{color:l==="excellent"||l==="good"?"green":l==="fair"?"amber":"red",children:[e.jsx(wt,{className:"w-3 h-3 mr-1"}),l==="excellent"?"Excellent":l==="good"?"Good":l==="fair"?"Fair":"Poor"]})]}),e.jsx("p",{className:"mt-1 text-xs sm:text-sm font-mono text-fg-muted tabular-nums",children:t.traceTag})]}),e.jsx("button",{onClick:a,className:"p-1.5 -m-1.5 text-fg-muted hover:text-fg-primary transition-base radius-inner hover:bg-elevated flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsxs("div",{className:"hidden sm:flex flex-wrap items-center gap-1.5 sm:gap-2 px-4 sm:px-6 pb-3 sm:pb-4 border-b border-edge-subtle",children:[e.jsxs(P,{color:"teal",children:[e.jsx("span",{className:"font-mono tabular-nums",children:t.targetHopCount}),e.jsxs("span",{className:"ml-1",children:["hop",t.targetHopCount!==1?"s":""]})]}),e.jsxs(P,{color:"zinc",children:[e.jsx("span",{className:"font-mono tabular-nums",children:t.observationCount}),e.jsx("span",{className:"ml-1",children:"obs"})]}),t.linkQuality&&e.jsxs(P,{color:"indigo",children:[e.jsx("span",{className:"font-mono tabular-nums",children:t.linkQuality.avgSnr.toFixed(1)}),e.jsx("span",{className:"ml-1",children:"dB avg"})]}),e.jsx("span",{className:"type-data-xs text-fg-muted",children:Es(t.duration)}),t.linkQuality&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-fg-muted/40",children:"•"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-xs font-medium bg-sys-red/15 text-sys-red ring-1 ring-inset ring-sys-red/25",children:[e.jsx("span",{className:"opacity-70",children:"Min"}),e.jsx("span",{className:"font-mono tabular-nums",children:t.linkQuality.minSnr.toFixed(1)})]}),e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-xs font-medium bg-sys-teal/15 text-sys-teal ring-1 ring-inset ring-sys-teal/25",children:[e.jsx("span",{className:"opacity-70",children:"Max"}),e.jsx("span",{className:"font-mono tabular-nums",children:t.linkQuality.maxSnr.toFixed(1)})]})]})]})]}),e.jsxs(Ut,{className:"p-0 overflow-hidden",children:[e.jsx("div",{className:"md:hidden h-[75vh] max-h-[calc(100vh-80px)] overflow-y-auto overflow-x-hidden",children:e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[t.linkQuality&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"radius-inner bg-subtle-fill ring-1 ring-inset ring-edge-subtle p-2.5 text-center",children:[e.jsx(et,{value:Math.abs(t.linkQuality.minSnr),format:{maximumFractionDigits:0,signDisplay:"never"},prefix:t.linkQuality.minSnr<0?"-":"",className:"text-[20px] font-bold font-mono tabular-nums flex items-center justify-center text-fg-primary"}),e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[e.jsx(Je,{className:"w-2.5 h-2.5 text-fg-muted"}),e.jsx("span",{className:"text-xs text-fg-muted",children:"Min dB"})]})]}),e.jsxs("div",{className:"radius-inner bg-subtle-fill ring-1 ring-inset ring-edge-subtle p-2.5 text-center",children:[e.jsx(et,{value:t.linkQuality.maxSnr,format:{maximumFractionDigits:0,signDisplay:"always"},className:"text-[20px] font-bold font-mono text-fg-primary tabular-nums flex items-center justify-center"}),e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[e.jsx(gt,{className:"w-2.5 h-2.5 text-fg-muted"}),e.jsx("span",{className:"text-xs text-fg-muted",children:"Max dB"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(P,{color:l==="excellent"||l==="good"?"green":l==="fair"?"amber":"red",compact:!0,children:[e.jsx(wt,{className:"w-2.5 h-2.5 mr-0.5"}),l==="excellent"?"Excellent":l==="good"?"Good":l==="fair"?"Fair":"Poor"]}),e.jsxs(P,{color:"teal",compact:!0,children:[t.targetHopCount," hops"]}),e.jsxs(P,{color:"zinc",compact:!0,children:[t.observationCount," obs"]}),e.jsx("span",{className:"type-data-xs text-fg-muted ml-auto",children:t.traceTag.slice(0,8)})]}),t.targetPath.length>0&&e.jsx("div",{className:"overflow-hidden radius-inset",children:e.jsx("div",{className:"aspect-[4/3] w-full",children:e.jsx(Ve,{path:t.targetPath,neighbors:n,localNode:r,localHash:s==null?void 0:s.local_hash,srcHash:t.srcHash,dstHash:t.dstHash,traceSnr:i})})}),e.jsxs("div",{className:"radius-inset bg-body overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-edge-subtle",children:[e.jsx("span",{className:"text-[11px] font-medium text-fg-secondary",children:"Route Path"}),t.linkQuality&&e.jsxs("span",{className:"type-data-xs text-fg-muted",children:["SNR ",t.linkQuality.minSnr.toFixed(1)," → ",t.linkQuality.maxSnr.toFixed(1)," dB"]})]}),t.bestObservation?e.jsx(Ce,{packet:t.bestObservation.packet,neighbors:n,localHash:s==null?void 0:s.local_hash,direction:"flowchart",compact:!0,overridePath:t.targetPath,traceSnr:t.bestObservation.decoded.snrValues}):e.jsx("div",{className:"p-6 text-center text-fg-muted text-xs",children:"No path data available"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"type-micro text-fg-muted mb-2",children:["Link Quality · ",t.hopStats.length," hops"]}),e.jsx("div",{className:"space-y-1.5",children:t.hopStats.length>0?t.hopStats.map((g,u)=>{var p,w,j;const y=u<t.targetPath.length-1?t.targetPath[u+1]:"You",x=fe(g.prefix,n),v=fe(y,n);return e.jsx(Rt,{fromPrefix:g.prefix,toPrefix:y,fromName:x,toName:v,snr:g.snr,maxSnr:((p=t.linkQuality)==null?void 0:p.maxSnr)??10,isWeakest:((w=t.linkQuality)==null?void 0:w.weakestLinkPosition)===u,isStrongest:((j=t.linkQuality)==null?void 0:j.strongestLinkPosition)===u,index:u},`${g.prefix}-${u}`)}):e.jsx("div",{className:"text-xs text-fg-muted py-6 text-center",children:"No link data collected"})})]}),e.jsx("div",{className:"pt-1 pb-2 text-center",children:e.jsxs("span",{className:"text-xs text-fg-muted",children:["Traced ",Ze(t.firstSeen)]})})]})}),e.jsxs("div",{className:"hidden md:flex md:flex-row h-[70vh] max-h-[calc(100vh-200px)] overflow-hidden",children:[e.jsx("div",{className:"w-1/2 flex flex-col min-w-0 min-h-0 overflow-hidden border-r border-edge-subtle",children:e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[t.linkQuality&&(()=>{const g=t.targetPath[t.linkQuality.weakestLinkPosition],u=t.targetPath[t.linkQuality.weakestLinkPosition+1]||"You",y=fe(g,n),x=fe(u,n),v=t.targetPath[t.linkQuality.strongestLinkPosition],p=t.targetPath[t.linkQuality.strongestLinkPosition+1]||"You",w=fe(v,n),j=fe(p,n);return e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(Lt,{label:"Weakest Link",numericValue:t.linkQuality.minSnr,unit:"dB",icon:Je,subtext:`${y||g} → ${x||u}`}),e.jsx(Lt,{label:"Best Link",numericValue:t.linkQuality.maxSnr,showSign:!0,unit:"dB",icon:gt,subtext:`${w||v} → ${j||p}`})]})})(),e.jsxs("div",{children:[e.jsx("h3",{className:"type-micro text-fg-muted mb-3",children:"Link Details"}),e.jsx("div",{className:"space-y-2",children:t.hopStats.length>0?t.hopStats.map((g,u)=>{var p,w,j;const y=u<t.targetPath.length-1?t.targetPath[u+1]:"You",x=fe(g.prefix,n),v=fe(y,n);return e.jsx(Rt,{fromPrefix:g.prefix,toPrefix:y,fromName:x,toName:v,snr:g.snr,maxSnr:((p=t.linkQuality)==null?void 0:p.maxSnr)??10,isWeakest:((w=t.linkQuality)==null?void 0:w.weakestLinkPosition)===u,isStrongest:((j=t.linkQuality)==null?void 0:j.strongestLinkPosition)===u,index:u},`${g.prefix}-${u}`)}):e.jsx("div",{className:"text-xs text-fg-muted py-8 text-center",children:"No link data collected"})})]}),e.jsxs("div",{className:"pt-2 text-center",children:[e.jsx("span",{className:"text-xs text-fg-muted",children:"Traced "}),e.jsx("span",{className:"type-data-xs text-fg-muted",children:Ze(t.firstSeen)})]})]})}),e.jsxs("div",{className:"w-1/2 min-w-0 overflow-y-auto p-3 space-y-2",children:[t.targetPath.length>0&&e.jsx("div",{className:"overflow-hidden",children:e.jsx("div",{className:"aspect-square w-full",children:e.jsx(Ve,{path:t.targetPath,neighbors:n,localNode:r,localHash:s==null?void 0:s.local_hash,srcHash:t.srcHash,dstHash:t.dstHash,traceSnr:i})})}),e.jsxs("div",{className:"radius-inset bg-black overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("span",{className:"type-micro text-fg-muted",children:"Trace Route"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(P,{color:t.isComplete?"green":"amber",compact:!0,children:t.isComplete?"Complete":`${t.maxHopsObserved}/${t.targetHopCount}`}),e.jsxs(P,{color:"teal",compact:!0,children:[t.targetHopCount," hop",t.targetHopCount!==1?"s":""]})]})]}),t.linkQuality&&t.bestObservation&&e.jsxs("div",{className:"flex items-center gap-4 px-4 pb-2 type-data-xs text-fg-muted",children:[e.jsxs("span",{children:[e.jsx("span",{className:"opacity-60",children:"Tag"})," ",e.jsx("code",{className:"text-sys-teal tabular-nums",children:t.traceTag.slice(0,8)})]}),e.jsxs("span",{children:[e.jsx("span",{className:"opacity-60",children:"SNR"})," ",e.jsxs("code",{className:"text-sys-indigo tabular-nums",children:[t.linkQuality.minSnr.toFixed(1),"–",t.linkQuality.maxSnr.toFixed(1)]}),e.jsx("span",{className:"opacity-60",children:" dB"})]})]}),t.bestObservation?e.jsx(Ce,{packet:t.bestObservation.packet,neighbors:n,localHash:s==null?void 0:s.local_hash,direction:"flowchart",compact:!0,overridePath:t.targetPath,traceSnr:t.bestObservation.decoded.snrValues}):e.jsx("div",{className:"p-8 text-center text-fg-muted text-xs",children:"No path data available"})]})]})]})]})]})}const Ga=m.memo(Wa),rs=[{target:"PacketList",fn:"type",minStage:1},{target:"PacketList",fn:"route",minStage:1},{target:"PacketList",fn:"rssi",minStage:1},{target:"PacketList",fn:"snr",minStage:1},{target:"PacketList",fn:"path",minStage:1,when:Os},{target:"PacketList",fn:"src_hash",minStage:1,when:$s},{target:"PacketList",fn:"text",minStage:1,when:Us},{target:"PacketList",fn:"ack",minStage:1,when:Vs},{target:"PacketList",fn:"decrypt",minStage:2,when:Ws},{target:"PacketList",fn:"duplicates",minStage:1}];Hs(rs);const Qa=48,qa=72,Ka=100,Ya=5,Xa=600,is="(min-width: 640px)";let he=null;function Za(t){return typeof window>"u"?()=>{}:(he||(he=window.matchMedia(is)),he.addEventListener("change",t),()=>he==null?void 0:he.removeEventListener("change",t))}function Ja(){return typeof window>"u"?!0:(he||(he=window.matchMedia(is)),he.matches)}function er(){return m.useSyncExternalStore(Za,Ja,()=>!0)}function tr(t,a,s){const[n,r]=m.useState(1),i=s?Math.ceil(t/a):1;m.useEffect(()=>{n>i&&i>0&&queueMicrotask(()=>r(1))},[i,n]);const l=m.useCallback(o=>r(Math.max(1,Math.min(o,i))),[i]),c=m.useMemo(()=>Un(n,i),[n,i]);return{currentPage:n,totalPages:i,goToPage:l,pageRange:c}}function sr(t,a){const[s,n]=m.useState(null),r=m.useRef(0);return m.useEffect(()=>{var d,g;if(!a||!t.length)return;const i=((d=t[0])==null?void 0:d.timestamp)??0,l=i>r.current&&r.current>0;if(r.current=i,!l)return;const c=(g=t[0])==null?void 0:g.packet_hash;if(!c)return;const o=requestAnimationFrame(()=>n(c)),h=setTimeout(()=>n(null),600);return()=>{cancelAnimationFrame(o),clearTimeout(h)}},[t,a]),s}function nr(t){if(!t||t.length<6)return null;const a=t,s=parseInt(a.slice(0,2),16);if(isNaN(s))return null;const n=s&3;let r=2;if((n===0||n===3)&&(r=10),r+2>a.length)return null;const i=parseInt(a.slice(r,r+2),16);if(isNaN(i)||(r+=2+i*2,r>=a.length))return null;const l=a.slice(r);return l.length>=38?l.slice(0,38):l}function ar(t){if(t.length<=1)return t;const a=new Map,s=new Map,n=new Map;for(let l=0;l<t.length;l++){const{packet:c}=t[l],o=c.payload_type??c.type;if(o!==lt.GRP_TXT)continue;const h=c._payloadHexPrefix??nr(c.raw_packet);if(h){const y=a.get(h);if(y!==void 0){n.set(l,y);continue}a.set(h,l)}const d=c.payload_length??c.length??0,g=Math.floor((c.timestamp??0)/60),u=`${o}:${d}:${g}`;if(!h){const y=s.get(u);if(y!==void 0){n.set(l,y);continue}}s.has(u)||s.set(u,l)}if(n.size===0)return t;const r=new Map;for(const[l,c]of n)r.set(c,(r.get(c)??0)+t[l].dupeCount);const i=[];for(let l=0;l<t.length;l++){if(n.has(l))continue;const c=r.get(l)??0;i.push(c>0?{packet:t[l].packet,dupeCount:t[l].dupeCount+c}:t[l])}return i}function rr(t){const a=new Map;for(const s of t)if((s.payload_type??s.type)===lt.TRACE&&s.packet_hash){const r=s._traceTag??(s.payload?Vt(s.payload):null);r&&a.set(s.packet_hash,r)}return a}function ir(t){if(t.length===0)return[];const a=[];let s=0;for(;s<t.length;){const n=t[s],r=n.packet_hash;let i=1;if(r)for(;s+i<t.length&&t[s+i].packet_hash===r;)i++;a.push({packet:n,dupeCount:i}),s+=i}return a}function lr(t){const a=new Map;if(t.length===0)return a;for(let s=0;s<t.length;s++){const n=t[s].packet_hash;if(!n)continue;const r=t[s-1],i=t[s+1],l=(r==null?void 0:r.packet_hash)===n,c=(i==null?void 0:i.packet_hash)===n;(l||c)&&(l&&c?a.set(s,"middle"):l?a.set(s,"last"):c&&a.set(s,"first"))}return a}function Et({message:t}){return e.jsxs("div",{className:"flex flex-col items-center justify-center py-14 text-center",children:[e.jsx(ge,{className:"size-6 text-fg-muted mb-2"}),e.jsx("p",{className:"text-sm text-fg-primary",children:t}),e.jsx("p",{className:"text-xs text-fg-muted",children:"Packets will appear here"})]})}function zt(){return e.jsx("div",{className:"py-14 text-center text-sm text-fg-muted",children:"Loading packets…"})}function cr({showPagination:t,currentPage:a,perPage:s,displayCount:n,totalCount:r,action:i}){const l=t?(a-1)*s+1:1,c=t?Math.min(a*s,r):n;return e.jsxs("div",{className:"flex items-center justify-between gap-4 border-t border-edge-subtle px-4 py-3 text-xs text-fg-muted sm:px-6",children:[e.jsxs("span",{children:["Showing"," ",e.jsx("span",{className:"font-medium text-fg-secondary",children:t?`${l}–${c}`:n})," ","of"," ",e.jsx("span",{className:"font-medium text-fg-secondary",children:r})," ","packets"]}),i]})}function Rr({packets:t,allPackets:a,localHash:s,neighbors:n,loading:r=!1,maxPackets:i,perPage:l=50,showPagination:c=!1,onPacketSelect:o,flashNewest:h=!1,emptyMessage:d="No packets found",className:g,footerAction:u,hideDupes:y=!1,getDecodedContent:x,onChannelClick:v,resolveSource:p,virtualized:w=!0}){Ds(rs);const[j,b]=m.useState(null),[f,T]=m.useState(null),[N,D]=m.useState({traceTag:null,dupeGroup:null}),O=m.useRef(null),U=rn(k=>k.setModalMapOpen);m.useEffect(()=>(U(!!j),()=>U(!1)),[j,U]),m.useLayoutEffect(()=>{D({traceTag:null,dupeGroup:null})},[t]);const X=a??t,H=m.useMemo(()=>i&&i>0&&!y?t.slice(0,i):t,[t,i,y]),Z=m.useMemo(()=>{if(!y)return null;const k=ir(H),_=ar(k);return i&&i>0?_.slice(0,i):_},[H,y,i]),A=Z?Z.length:H.length,{currentPage:R,totalPages:F,goToPage:se,pageRange:J}=tr(A,l,c),C=m.useMemo(()=>{if(y||!c)return H;const k=(R-1)*l;return H.slice(k,k+l)},[H,c,R,l,y]),Q=m.useMemo(()=>{if(!Z)return null;if(!c)return Z;const k=(R-1)*l;return Z.slice(k,k+l)},[Z,c,R,l]),ae=m.useMemo(()=>rr(C),[C]),B=m.useMemo(()=>lr(C),[C]),S=sr(t,h),te=er(),W=m.useMemo(()=>y&&Q?Q:C,[y,Q,C]),q=w&&W.length>Ka,L=te?Qa:qa,M=yn({count:q?W.length:0,getScrollElement:()=>O.current,estimateSize:()=>L,overscan:Ya}),le=m.useCallback((k,_)=>{var we,Re;const E=k.packet_hash;if(!E)return[k];let I=_;for(;I>0&&((we=C[I-1])==null?void 0:we.packet_hash)===E;)I--;let G=_;for(;G<C.length-1&&((Re=C[G+1])==null?void 0:Re.packet_hash)===E;)G++;return I===G?[k]:C.slice(I,G+1)},[C]),$=m.useCallback(k=>{var I,G;const _=(I=C[k])==null?void 0:I.packet_hash;if(!_)return k;let E=k;for(;E>0&&((G=C[E-1])==null?void 0:G.packet_hash)===_;)E--;return E},[C]),ce=m.useCallback(k=>{var I,G;const _=(I=C[k])==null?void 0:I.packet_hash;if(!_)return k;let E=k;for(;E<C.length-1&&((G=C[E+1])==null?void 0:G.packet_hash)===_;)E++;return E},[C]),be=m.useCallback((k,_)=>{if(o){o(k);return}if(_!==void 0){const E=le(k,_),I=E.indexOf(k);b({packets:E,initialIndex:I>=0?I:0,rowIndex:_})}else b({packets:[k],initialIndex:0,rowIndex:0})},[o,le]),dt=m.useCallback(()=>{if(!j)return;const _=$(j.rowIndex)-1;if(_<0)return;const E=C[_];if(!E)return;const I=le(E,_);b({packets:I,initialIndex:0,rowIndex:_})},[j,C,$,le]),Pe=m.useCallback(()=>{if(!j)return;const _=ce(j.rowIndex)+1;if(_>=C.length)return;const E=C[_];if(!E)return;const I=le(E,_);b({packets:I,initialIndex:0,rowIndex:_})},[j,C,ce,le]),xt=m.useMemo(()=>j?$(j.rowIndex)>0:!1,[j,$]),Be=m.useMemo(()=>j?ce(j.rowIndex)<C.length-1:!1,[j,ce,C.length]),Ne=m.useCallback(k=>D(_=>({..._,traceTag:k})),[]),Le=m.useCallback(k=>D(_=>({..._,dupeGroup:k})),[]),Ge=m.useCallback(()=>{D({traceTag:null,dupeGroup:null})},[]),ve=m.useCallback(k=>{const _=X.filter(G=>(G.payload_type??G.type)===lt.TRACE&&G.payload&&Vt(G.payload)===k);if(_.length===0)return;const I=Is(_).get(k);I!=null&&I.length&&T(As(k,I))},[X]),K=m.useCallback(k=>{const _=X.find(E=>E.packet_hash===k);_&&(T(null),be(_))},[X,be]),Y=m.useCallback((k,_,E)=>{const I=te?Xn:Zn;if(E){const{packet:pe,dupeCount:cs}=k,ut=pe.packet_hash?ae.get(pe.packet_hash):void 0,os=N.traceTag!==null&&ut===N.traceTag;return e.jsx(I,{packet:pe,onClick:ds=>be(ds,_),localHash:s,neighbors:n,resolveSource:p,isFlashing:h&&S===pe.packet_hash,traceTag:ut,isTraceHighlighted:os,onTraceHover:Ne,onViewTraceReport:ve,dupeCount:cs,getDecodedContent:x,onChannelClick:v},`${pe.packet_hash}_${pe.timestamp}_${_}`)}const G=k,we=G.packet_hash?ae.get(G.packet_hash):void 0,Re=N.traceTag!==null&&we===N.traceTag,mt=B.get(_),ls=mt!==void 0&&N.dupeGroup!==null&&G.packet_hash===N.dupeGroup;return e.jsx(I,{packet:G,onClick:pe=>be(pe,_),localHash:s,neighbors:n,resolveSource:p,isFlashing:h&&S===G.packet_hash,traceTag:we,isTraceHighlighted:Re,onTraceHover:Ne,onViewTraceReport:ve,dupeGroupPosition:mt,isDupeGroupHovered:ls,onDupeGroupHover:Le,getDecodedContent:x,onChannelClick:v},`${G.packet_hash}_${G.timestamp}_${_}`)},[te,ae,N.traceTag,N.dupeGroup,be,s,n,p,h,S,Ne,ve,B,Le,x,v]),re=()=>{if(r&&t.length===0)return e.jsx(zt,{});if(C.length===0)return e.jsx(Et,{message:d});const k=y&&Q!==null;return(k?Q:C).map((E,I)=>Y(E,I,k))},ht=()=>{if(r&&t.length===0)return e.jsx(zt,{});if(W.length===0)return e.jsx(Et,{message:d});const k=y&&Q!==null,_=M.getVirtualItems();return e.jsx("div",{style:{height:`${M.getTotalSize()}px`,width:"100%",position:"relative"},children:_.map(E=>{const I=W[E.index];return e.jsx("div",{"data-index":E.index,ref:M.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${E.start}px)`},children:Y(I,E.index,k)},E.key)})})};return e.jsxs("div",{className:z("flex flex-col",g),onMouseLeave:Ge,children:[q?e.jsx("div",{ref:O,className:"divide-y divide-edge-subtle overflow-auto",style:{maxHeight:Xa},children:ht()}):e.jsx("div",{className:"divide-y divide-edge-subtle py-1",children:re()}),c&&F>1&&e.jsx("nav",{className:"border-t border-edge-subtle px-4 py-3",children:e.jsxs(In,{className:"justify-center",children:[e.jsx(An,{onClick:()=>se(R-1),disabled:R===1}),e.jsx(Hn,{children:J.map((k,_)=>k==="gap"?e.jsx($n,{},`gap-${_}`):e.jsx(On,{page:k,current:k===R,onClick:se},k))}),e.jsx(Dn,{onClick:()=>se(R+1),disabled:R===F})]})}),e.jsx(cr,{showPagination:c,currentPage:R,perPage:l,displayCount:Q?Q.length:C.length,totalCount:c?A:t.length,action:u}),!o&&j&&e.jsx(Ua,{packets:j.packets,initialIndex:j.initialIndex,onClose:()=>b(null),onNavigatePrev:dt,onNavigateNext:Pe,hasPrev:xt,hasNext:Be,resolveSource:p}),f&&e.jsx(Ga,{report:f,onClose:()=>T(null),onViewPacket:K})]})}export{ss as C,Rr as P,wt as S,kt as T,Br as a,yn as b,Gn as g,Lr as u};
