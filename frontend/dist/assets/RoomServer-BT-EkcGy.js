import{j as e,W as t,c as s,Z as a,M as n,r as l}from"./vendor-react-j_fHog8x.js";import{P as i,b as r,B as c,a as o}from"./PageLayout-BbUr5VN7.js";import{R as d,C as m}from"./Grid-OFJ4oe0a.js";import{c as x,cl as u,b2 as p,R as h,O as g,aj as f,f as j,K as v,cv as y,N as b,e as N,I as k,cw as w,B as C,cx as _,cy as S,cz as R,cA as M,cB as D,cC as A,cD as E,cE as T,n as L,cF as F,cp as I,aA as P}from"./index-Bo5Q3JFr.js";import{L as $,a as B,b as K}from"./listbox-AxrWwIvz.js";import{S as q,C as z,e as H,g as U,a as O}from"./ChatBubble-DEaiQ4EE.js";import{T as V}from"./trash-2-r51Oxtu8.js";import{C as G}from"./Card-3yWPa65P.js";import{U as J}from"./users-DFtI5iRp.js";import{I as W}from"./info-B5_4nBpR.js";import"./maplibre-gl-b91ci4Kr.js";import"./vendor-core-CDNU4oKM.js";import"./config-CTM8_93T.js";const Y=x("repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]),Q=x("terminal",[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]]),X=x("user-x",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);function Z({disabled:a,className:n,children:l}){return e.jsx(t,{disabled:a,className:s("flex flex-col gap-1.5",n),children:l})}function ee({required:t,className:n,children:l,...i}){return e.jsxs(a,{className:s("text-sm font-medium text-text-primary select-none","data-[disabled]:opacity-50",n),...i,children:[l,t&&e.jsx("span",{className:"text-accent-danger ml-0.5","aria-hidden":"true",children:"*"})]})}function te({className:t,children:a,...l}){return e.jsx(n,{className:s("text-xs text-text-muted","data-[disabled]:opacity-50",t),...l,children:a})}function se({icon:t,title:a,description:n,onClick:l,accent:i}){return e.jsxs("button",{onClick:l,className:s("flex flex-col items-center gap-3 p-6 rounded-2xl text-center","ring-1 ring-border-subtle hover:ring-2 transition-all duration-150","w-full max-w-[260px]","primary"===i?"hover:ring-accent-primary hover:bg-accent-primary/5":"hover:ring-accent-secondary hover:bg-accent-secondary/5"),children:[e.jsx("div",{className:s("p-3 rounded-xl","primary"===i?"bg-accent-primary/10 text-accent-primary":"bg-accent-secondary/10 text-accent-secondary"),children:t}),e.jsx("p",{className:"type-body-sm font-medium text-text-primary",children:a}),e.jsx("p",{className:"type-data-xs text-text-muted leading-relaxed",children:n})]})}function ae({onCreateRoom:t}){return e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx(p,{className:"w-12 h-12 text-text-muted opacity-30 mb-4"}),e.jsx("p",{className:"type-subheading text-text-secondary mb-1",children:"Add a Room Server"}),e.jsx("p",{className:"type-body-sm text-text-muted mb-8",children:"Choose how this device should operate."}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4",children:[e.jsx(se,{icon:e.jsx(Y,{className:"w-6 h-6"}),title:"Repeater + Room Server",description:"Keep forwarding packets and add group messaging.",onClick:()=>t("hybrid"),accent:"primary"}),e.jsx(se,{icon:e.jsx(h,{className:"w-6 h-6"}),title:"Dedicated Room Server",description:"Stop repeating. Focus entirely on room server duties.",onClick:()=>t("dedicated"),accent:"secondary"})]})]})}function ne({rooms:t,selected:a,onSelect:n}){return t.length<=1?null:t.length<=3?e.jsx("div",{className:"flex items-center gap-0.5 p-0.5 rounded-lg bg-subtle-fill",children:t.map(t=>e.jsx("button",{onClick:()=>n(t.room_name),className:s("px-3 py-1 rounded-md text-sm font-medium transition-all duration-150",t.room_name===a?"bg-bg-surface text-text-primary shadow-sm":"text-text-muted hover:text-text-secondary"),children:t.room_name},t.room_name))}):e.jsx($,{value:a??"",onChange:n,children:t.map(t=>e.jsx(B,{value:t.room_name,children:e.jsx(K,{children:t.room_name})},t.room_name))})}const le=e=>"server"===e.author_pubkey||"system"===e.author_pubkey;function ie({messages:t,onDelete:s,terminalMode:a,serverName:n}){const i=l.useRef(null),[r,c]=l.useState(!1),o=l.useMemo(()=>[...t].sort((e,t)=>e.post_timestamp-t.post_timestamp),[t]);l.useEffect(()=>{!r&&i.current&&(i.current.scrollTop=0)},[o.length,r]);const d=l.useCallback(()=>{i.current&&c(i.current.scrollTop<-100)},[]),m=l.useCallback(()=>{i.current&&i.current.scrollTo({top:0,behavior:"smooth"}),c(!1)},[]);return 0===o.length?e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center py-12 min-h-0"+(a?" font-mono":""),children:a?e.jsx("p",{className:"text-[#4af626]/40 text-sm font-mono",children:"> no messages in buffer_"}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-10 h-10 text-text-muted opacity-20 mb-2"}),e.jsx("p",{className:"type-data-sm text-text-muted",children:"No messages yet"})]})}):a?e.jsxs("div",{className:"relative flex-1 min-h-0",children:[e.jsx("div",{ref:i,onScroll:d,className:"h-full overflow-y-auto scroll-smooth p-4 font-mono text-sm leading-relaxed flex flex-col-reverse",children:e.jsx("div",{children:o.map(t=>{const a=le(t),l=new Date(1e3*t.post_timestamp).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),i=a?"SYS":t.author_name||t.author_prefix,r=a||null!=n&&(t.author_name??"").toLowerCase()===n.toLowerCase();return e.jsxs("div",{className:"group flex items-start gap-0 -mx-4 px-4 py-px hover:bg-[#1a1f2e] hover:shadow-[inset_2px_0_0_#3b82f6]",children:[e.jsxs("span",{className:"text-[#666] select-none shrink-0",children:["[",l,"]"]}),e.jsxs("span",{className:"mx-1.5 shrink-0 "+(r?"text-[#3b82f6]":"text-[#4af626]"),children:["<",i,">"]}),e.jsx("span",{className:a?"text-[#888] italic":"text-[#ccc]",children:t.message_text}),e.jsx("button",{onClick:()=>s(t.id),className:"opacity-0 group-hover:opacity-100 ml-auto pl-2 text-[#666] hover:text-[#E5484D] shrink-0",title:"Delete",children:"×"})]},t.id)})})}),r&&e.jsxs("button",{onClick:m,className:"absolute bottom-3 left-1/2 -translate-x-1/2 flex items-center gap-1.5 px-3 py-1 font-mono text-xs bg-[#1a1a1a] border border-[#333] text-[#4af626] hover:bg-[#222] transition-colors duration-150",children:[e.jsx(g,{className:"w-3 h-3"}),"↓ scroll"]})]}):e.jsxs("div",{className:"relative flex-1 min-h-0",children:[e.jsx("div",{ref:i,onScroll:d,className:"h-full overflow-y-auto scroll-smooth flex flex-col-reverse",children:e.jsx("div",{className:"space-y-3 p-4",children:o.map(t=>le(t)?e.jsx(q,{text:t.message_text},t.id):e.jsx(z,{senderName:t.author_name||t.author_prefix,text:t.message_text,timestamp:t.post_timestamp,bubbleAccessory:e.jsx("button",{onClick:()=>s(t.id),className:"opacity-0 group-hover:opacity-100 transition-opacity duration-150 p-1 text-text-muted hover:text-accent-danger flex-shrink-0",title:"Delete message",children:e.jsx(V,{className:"w-3.5 h-3.5"})})},t.id))})}),r&&e.jsxs("button",{onClick:m,className:"absolute bottom-3 left-1/2 -translate-x-1/2 flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-bg-surface/90 backdrop-blur-sm ring-1 ring-border-subtle shadow-md text-text-secondary hover:text-text-primary transition-colors duration-150",children:[e.jsx(g,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"type-data-xs",children:"New messages"})]})]})}function re({roomName:t,onSend:s,disabled:a,terminalMode:n}){const[i,r]=l.useState(""),[c,o]=l.useState(!1),d=l.useRef(null),m=l.useCallback(async()=>{var e;const t=i.trim();if(!t||c)return;o(!0);const a=await s(t);o(!1),a&&(r(""),null==(e=d.current)||e.focus())},[i,c,s]),x=l.useCallback(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),m())},[m]);return n?e.jsxs("div",{className:"flex items-center gap-0 px-4 py-2 border-t card-terminal-divider font-mono text-sm",children:[e.jsx("span",{className:"text-[#4af626] select-none shrink-0 mr-1.5",children:">"}),e.jsx("input",{ref:d,type:"text",value:i,onChange:e=>r(e.target.value),onKeyDown:x,placeholder:"type message...",disabled:a||c,className:"flex-1 bg-transparent text-[#ccc] placeholder:text-[#444] outline-none font-mono caret-[#4af626]"}),e.jsx("button",{onClick:m,disabled:!i.trim()||c||a,className:"text-[#4af626] disabled:text-[#333] hover:text-[#7fff7f] transition-colors duration-100 px-1 font-mono text-xs",title:"Send",children:"[↵]"})]}):e.jsxs("div",{className:"flex items-center gap-2 p-3 border-t border-border-subtle",children:[e.jsx("input",{ref:d,type:"text",value:i,onChange:e=>r(e.target.value),onKeyDown:x,placeholder:`Message ${t}…`,disabled:a||c,className:"flex-1 surface-input radius-inner px-3 py-2 type-body-sm text-text-primary placeholder:text-text-muted outline-none ring-focus"}),e.jsx("button",{onClick:m,disabled:!i.trim()||c||a,className:"p-2 rounded-lg text-accent-primary hover:bg-accent-primary/10 disabled:opacity-30 disabled:hover:bg-transparent transition-colors duration-150",title:"Send message",children:e.jsx(f,{className:"w-4.5 h-4.5"})})]})}function ce({pubkey:t,className:s}){const[a,n]=l.useState(!1),i=l.useCallback(()=>{navigator.clipboard.writeText(t),n(!0),setTimeout(()=>n(!1),1500)},[t]);return e.jsxs("button",{onClick:i,title:a?"Copied!":"Copy public key",className:`inline-flex items-center gap-1 font-mono text-[10px] leading-tight text-text-muted hover:text-text-secondary transition-colors duration-150 cursor-copy ${s??""}`,children:[e.jsx("span",{className:"truncate min-w-0",children:t.slice(0,8)}),a&&e.jsx(j,{className:"w-2.5 h-2.5 text-accent-success flex-shrink-0"})]})}const oe=l.memo(function({client:t,resolvedName:a,onRemove:n}){const l=t.name||a,i=0===t.unsynced_count,r=t.last_activity?new Date(1e3*t.last_activity).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never",{emoji:c,cleanName:o}=l?H(l):{emoji:null,cleanName:t.pubkey_prefix},d=l?U(o):void 0,m=l?O(l):t.pubkey_prefix.slice(0,2).toUpperCase();return e.jsxs("div",{className:"group flex items-center gap-3 px-3 py-2.5 radius-inner row-hover transition-base",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("div",{className:s("w-8 h-8 rounded-full flex items-center justify-center",!d&&"bg-accent-primary/12"),style:d?{backgroundColor:d}:void 0,children:c?e.jsx("span",{className:"text-base leading-none",children:c}):e.jsx("span",{className:s("leading-none",d?"text-white text-[11px] font-bold tracking-tight":"text-accent-primary font-mono text-[11px]"),children:m})}),e.jsx("span",{className:"absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 rounded-full ring-2 ring-bg-surface "+(i?"bg-accent-success":"bg-accent-secondary")})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[l?e.jsx("p",{className:"text-[13px] font-medium leading-tight text-text-primary truncate",children:l}):e.jsx("p",{className:"font-mono text-[13px] leading-tight text-text-primary truncate",children:t.pubkey_prefix}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[l&&e.jsx(ce,{pubkey:t.pubkey}),l&&e.jsx("span",{className:"text-[10px] text-text-muted/40",children:"·"}),e.jsxs("span",{className:"text-[10px] leading-tight text-text-muted truncate",children:[!i&&e.jsxs("span",{className:"text-accent-secondary",children:[t.unsynced_count," unsynced · "]}),r]})]})]}),e.jsx("button",{onClick:()=>n(t.pubkey),className:"opacity-0 group-hover:opacity-100 transition-opacity duration-150 p-1.5 -mr-1 rounded-md text-text-muted hover:text-accent-danger hover:bg-accent-danger/8",title:"Remove client",children:e.jsx(X,{className:"w-3.5 h-3.5"})})]})});function de({clients:t,onRemove:s,messages:a,terminalMode:n}){const i=l.useMemo(()=>{const e=new Map;if(!a)return e;for(let t=a.length-1;t>=0;t--){const s=a[t];s.author_name&&s.author_pubkey&&"server"!==s.author_pubkey&&"system"!==s.author_pubkey&&e.set(s.author_pubkey,s.author_name)}return e},[a]);return 0===t.length?n?e.jsx("p",{className:"text-[#666] font-mono text-sm text-center py-4",children:"no clients connected"}):e.jsx("p",{className:"type-data-xs text-text-muted text-center py-4",children:"No clients connected"}):n?e.jsx("div",{className:"font-mono text-sm",children:t.map(t=>{const a=t.name||i.get(t.pubkey),n=0===t.unsynced_count,l=t.pubkey_prefix;return e.jsxs("div",{className:"group flex items-center gap-0 -mx-0 px-4 py-0.5 hover:bg-[#1a1f2e] hover:shadow-[inset_2px_0_0_#3b82f6]",children:[e.jsx("span",{className:n?"text-[#4af626]":"text-[#f59e0b]",children:"●"}),e.jsx("span",{className:"text-[#4af626] ml-2 shrink-0",children:a||l}),a&&e.jsxs("span",{className:"text-[#666] ml-1.5 shrink-0",children:["[",l,"]"]}),!n&&e.jsxs("span",{className:"text-[#f59e0b] ml-1.5",children:[t.unsynced_count,"unsync"]}),e.jsx("button",{onClick:()=>s(t.pubkey),className:"opacity-0 group-hover:opacity-100 ml-auto pl-2 text-[#666] hover:text-[#E5484D] shrink-0",title:"Remove",children:"×"})]},t.pubkey)})}):e.jsx("div",{className:"space-y-0.5",children:t.map(t=>e.jsx(oe,{client:t,resolvedName:i.get(t.pubkey),onRemove:s},t.pubkey))})}function me({open:t,onClose:s,mode:a,identity:n,repeaterConfig:i,onCreate:r,onUpdate:c,onDelete:o,onSendAdvert:d}){var m,x,u,p,h,g,j,_,S;const R="edit"===a&&n,M=`${t}-${(null==n?void 0:n.name)??""}-${a}`,[D,A]=l.useState(""),[E,T]=l.useState(""),[L,F]=l.useState(""),[I,P]=l.useState(""),[$,B]=l.useState(""),[K,q]=l.useState(!1),[z,H]=l.useState(!1),[U,O]=l.useState(!1),[G,J]=l.useState(null),[W,Y]=l.useState(M);if(M!==W)if(Y(M),J(null),q(!1),H(!1),O(!1),R)A((null==(m=n.settings)?void 0:m.node_name)??n.name),T((null==(x=n.settings)?void 0:x.admin_password)??""),F((null==(u=n.settings)?void 0:u.guest_password)??""),P((null==(h=null==(p=n.settings)?void 0:p.latitude)?void 0:h.toString())??""),B((null==(j=null==(g=n.settings)?void 0:g.longitude)?void 0:j.toString())??"");else{const e=i;A((null==e?void 0:e.node_name)??""),T(""),F(""),P(null!=(null==(_=null==e?void 0:e.repeater)?void 0:_.latitude)?e.repeater.latitude.toString():""),B(null!=(null==(S=null==e?void 0:e.repeater)?void 0:S.longitude)?e.repeater.longitude.toString():"")}const Q=l.useCallback(()=>{const e={};return D&&(e.node_name=D),E&&(e.admin_password=E),L&&(e.guest_password=L),""!==I&&(e.latitude=parseFloat(I)),""!==$&&(e.longitude=parseFloat($)),e},[D,E,L,I,$]),X=l.useCallback(async()=>{if(!D.trim())return void J("Room name is required");q(!0),J(null);const e=R?n.name:function(e){if(!e)return"";const t=e.trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"");return t?`${t}-room`:""}(D);let t;t=R?await c({name:n.name,settings:Q()}):await r({name:e,type:"room_server",settings:Q()}),q(!1),t?s():J("Failed to save. Check that the name is unique and passwords differ.")},[D,R,n,Q,r,c,s]),se=l.useCallback(async()=>{if(!R)return;H(!0);const e=await o(n.name);H(!1),e&&s()},[R,n,o,s]),ae=l.useCallback(async()=>{R&&(O(!0),await d(n.name),O(!1))},[R,n,d]);return e.jsxs(v,{open:t,onClose:s,size:"md",children:[e.jsx(y,{title:R?"Edit Room Server":"Create Room Server"}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-4",children:[R&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{color:n.registered?"green":"red",children:n.registered?"Active":"Inactive"}),n.identity_key&&e.jsxs("span",{className:"type-data-xs text-text-muted truncate",title:n.identity_key,children:["Key: ",n.identity_key.slice(0,16),"…"]})]}),e.jsxs(Z,{children:[e.jsx(ee,{children:"Room Name"}),e.jsx(te,{children:"Visible to MeshCore clients on the mesh"}),e.jsx(k,{value:D,onChange:e=>A(e.target.value),placeholder:"My Room"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Admin Password"}),e.jsx(k,{type:"password",value:E,onChange:e=>T(e.target.value),placeholder:"••••••"})]}),e.jsxs(Z,{children:[e.jsx(ee,{children:"Guest Password"}),e.jsx(k,{type:"password",value:L,onChange:e=>F(e.target.value),placeholder:"••••••"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Latitude"}),e.jsx(k,{type:"number",step:"any",value:I,onChange:e=>P(e.target.value),placeholder:"0.0"})]}),e.jsxs(Z,{children:[e.jsx(ee,{children:"Longitude"}),e.jsx(k,{type:"number",step:"any",value:$,onChange:e=>B(e.target.value),placeholder:"0.0"})]})]}),G&&e.jsx("p",{className:"type-data-xs text-accent-danger",children:G})]})}),e.jsxs(w,{children:[R&&e.jsxs("div",{className:"flex items-center gap-2 mr-auto",children:[e.jsxs(C,{color:"danger",plain:!0,onClick:se,disabled:z,children:[e.jsx(V,{"data-slot":"icon"}),z?"Deleting…":"Delete"]}),e.jsxs(C,{color:"primary",plain:!0,onClick:ae,disabled:U,children:[e.jsx(f,{"data-slot":"icon"}),U?"Sending…":"Send Advert"]})]}),e.jsx(C,{plain:!0,onClick:s,children:"Cancel"}),e.jsx(C,{color:"primary",onClick:X,disabled:K,children:K?"Saving…":R?"Save Changes":"Create"})]})]})}const xe="#000000",ue="#4af626";function pe({state:t}){return e.jsxs("svg",{className:"c64-wifi-overlay",viewBox:"0 0 24 24",fill:"none",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 20h.01",stroke:"idle"===t?xe:ue,className:"sending"===t?"c64-wifi-arc c64-wifi-arc-0":"sent"===t?"c64-wifi-blink":void 0}),e.jsx("path",{d:"M8.5 16.429a5 5 0 0 1 7 0",stroke:"idle"===t?xe:ue,className:"sending"===t?"c64-wifi-arc c64-wifi-arc-1":"sent"===t?"c64-wifi-blink":void 0}),e.jsx("path",{d:"M5 12.859a10 10 0 0 1 14 0",stroke:"idle"===t?xe:ue,className:"sending"===t?"c64-wifi-arc c64-wifi-arc-2":"sent"===t?"c64-wifi-blink":void 0}),e.jsx("path",{d:"M2 8.82a15 15 0 0 1 20 0",stroke:"idle"===t?xe:ue,className:"sending"===t?"c64-wifi-arc c64-wifi-arc-3":"sent"===t?"c64-wifi-blink":void 0})]})}function he({name:t,onSend:s}){const[a,n]=l.useState("idle"),i="sending"===a,r=l.useRef(),c=l.useCallback(async()=>{if("sending"===a)return;n("sending");const e=await s(t);n(e?"sent":"idle"),e&&(r.current=setTimeout(()=>n("idle"),2e3))},[t,s,a]);return l.useEffect(()=>()=>clearTimeout(r.current),[]),e.jsxs("div",{className:"c64-button-group",children:[e.jsx("button",{onClick:c,disabled:i,className:"c64-key",title:"Send room server advert",children:e.jsx("div",{className:"c64-key-well",children:e.jsxs("div",{className:"c64-key-btn-wrap",children:[e.jsx("img",{src:i?"/assets/red-btn-down.svg":"/assets/red-btn-up.svg",alt:"",className:"c64-key-img",draggable:!1}),e.jsx(pe,{state:a})]})})}),e.jsx("div",{className:"c64-key-well c64-advertise-pill",children:e.jsx("div",{className:"c64-pill-face",children:e.jsx("span",{className:"c64-pill-text"+("sent"===a?" c64-pill-text-blink":""),children:"ADVERTISE"})})})]})}function ge({name:t,onSend:s,terminalMode:a}){const[n,i]=l.useState("idle"),r=l.useRef(),c=l.useCallback(async()=>{if("sending"===n)return;i("sending");const e=await s(t);i(e?"sent":"idle"),e&&(r.current=setTimeout(()=>i("idle"),2e3))},[t,s,n]);return l.useEffect(()=>()=>clearTimeout(r.current),[]),a?e.jsxs("button",{className:"btn-terminal",onClick:c,disabled:"sending"===n,children:["idle"===n&&"[ send_advert ]","sending"===n&&"[ broadcasting... ]","sent"===n&&"[ sent ✓ ]"]}):e.jsxs(C,{color:"sent"===n?"success":"primary",className:"w-full",onClick:c,disabled:"sending"===n,children:[e.jsx(f,{"data-slot":"icon"}),"idle"===n&&"Send Advert","sending"===n&&"Broadcasting…","sent"===n&&"Advert Sent"]})}function fe(){var t,s,a;const n=_(),x=S(),h=R(),g=M(),f=D(),j=A(),v=E(),y=T(),b=L(),{selectRoom:k,postMessage:w,deleteMessage:$,clearMessages:B,createRoom:K,updateRoom:q,deleteRoom:z,sendAdvert:H,markAsRead:U,startActivePolling:O}=F.getState(),[Y,X]=l.useState(!1),[Z,ee]=l.useState("create"),[te,se]=l.useState("hybrid"),[le,ce]=l.useState(!1);l.useEffect(()=>{U()},[x,U]),l.useEffect(()=>O(),[O]);const oe=l.useCallback(async e=>!!x&&w({room_name:x,message:e,author_pubkey:"server"}),[x,w]),xe=l.useCallback(async e=>{F.setState(t=>({clients:t.clients.filter(t=>t.pubkey!==e)})),await async function(e){return u("/api/acl_remove_client",{method:"POST",body:JSON.stringify(e)})}({public_key:e})},[]),ue=l.useCallback((e="hybrid")=>{se(e),ee("create"),X(!0)},[]),pe=l.useCallback(()=>{ee("edit"),X(!0)},[]),fe=h?e.jsxs("span",{className:"type-data-sm text-text-muted",children:[h.total_messages," messages · ",h.total_clients," clients",g&&e.jsxs(e.Fragment,{children:[" · ",e.jsx(N,{color:g.registered?"green":"red",className:"ml-0.5",children:g.registered?"Active":"Inactive"})]})]}):void 0,je=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{rooms:n,selected:x,onSelect:k}),n.length>0&&e.jsx(C,{plain:!0,onClick:pe,title:"Manage room server",children:e.jsx(I,{"data-slot":"icon"})})]});return 0!==n.length||0!==v.length||y?e.jsxs(i,{children:[e.jsx(r,{title:"Room Server",icon:e.jsx(p,{}),subtitle:fe,controls:je}),e.jsx(c,{children:e.jsxs(d,{template:"hero-tall",className:"!h-[calc(100vh-11rem)] !min-h-[400px]",children:[e.jsx(m,{span:12,lg:8,className:"h-full",children:e.jsxs(o,{noPadding:!0,className:"flex flex-col h-full overflow-hidden"+(le?" card-terminal":""),children:[le?e.jsxs("div",{className:"card-terminal-header",children:[e.jsxs("span",{className:"text-[#4af626]",children:[">"," messages"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ce(e=>!e),className:"text-[#4af626] hover:text-[#7fff7f] text-xs",title:"Exit terminal mode",children:"[tui]"}),f.length>0&&e.jsx("button",{onClick:B,className:"text-[#666] hover:text-[#E5484D] text-xs",title:"Clear all messages",children:"[clr]"})]})]}):e.jsx(G,{listHeader:!0,icon:e.jsx(p,{className:"icon-sm"}),title:"Messages",actions:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(C,{plain:!0,onClick:()=>ce(e=>!e),title:"Terminal mode",children:e.jsx(Q,{"data-slot":"icon",className:"!w-4 !h-4"})}),f.length>0&&e.jsx(C,{plain:!0,color:"danger",onClick:B,title:"Clear all messages",children:e.jsx(V,{"data-slot":"icon",className:"!w-4 !h-4"})})]})}),e.jsx(ie,{messages:f,onDelete:$,terminalMode:le,serverName:(null==(t=null==g?void 0:g.settings)?void 0:t.node_name)??x??void 0}),x&&e.jsx(re,{roomName:x,onSend:oe,disabled:!(null==g?void 0:g.registered),terminalMode:le})]})}),e.jsx(m,{span:12,lg:4,className:"h-full",children:e.jsxs("div",{className:"flex flex-col h-full"+(le?" gap-3":""),children:[le&&g&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx(he,{name:g.name,onSend:H})}),e.jsxs(o,{compact:!0,className:"flex-1 min-h-0 flex flex-col overflow-hidden"+(le?" card-terminal":""),children:[le?e.jsxs("div",{className:"card-terminal-header",children:[e.jsxs("span",{className:"text-[#4af626]",children:[">"," clients"]}),j.length>0&&e.jsxs("span",{className:"text-[#666]",children:["[",j.length,"]"]})]}):e.jsx(G,{listHeader:!0,icon:e.jsx(J,{className:"icon-sm"}),title:"Clients",actions:j.length>0?e.jsx("span",{className:"type-data-xs text-text-muted",children:j.length}):void 0}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto",children:e.jsx(de,{clients:j,onRemove:xe,messages:f,terminalMode:le})}),le?e.jsxs("div",{className:"flex-shrink-0 border-t card-terminal-divider px-4 py-3 font-mono text-sm",children:[e.jsxs("div",{className:"card-terminal-section mb-2",children:[">"," room_info"]}),g?e.jsxs("div",{className:"space-y-1",children:[(null==(s=g.settings)?void 0:s.node_name)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[#666]",children:"node"}),e.jsx("span",{className:"text-[#ccc]",children:g.settings.node_name})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[#666]",children:"status"}),e.jsx("span",{className:g.registered?"text-[#4af626]":"text-[#E5484D]",children:g.registered?"[active]":"[inactive]"})]})]}):e.jsx("span",{className:"text-[#666]",children:"no identity configured"})]}):e.jsxs("div",{className:"flex-shrink-0 border-t border-border-subtle px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(W,{className:"w-4 h-4 text-text-muted"}),e.jsx("span",{className:"text-sm font-medium text-text-secondary",children:"Room Info"})]}),g?e.jsxs("div",{className:"space-y-2 px-1",children:[(null==(a=g.settings)?void 0:a.node_name)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"type-data-xs text-text-muted",children:"Node"}),e.jsx("span",{className:"type-data-sm text-text-primary",children:g.settings.node_name})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"type-data-xs text-text-muted",children:"Status"}),e.jsx(N,{color:g.registered?"green":"red",children:g.registered?"Active":"Inactive"})]}),e.jsx("div",{className:"pt-3",children:e.jsx(ge,{name:g.name,onSend:H})})]}):e.jsx("p",{className:"type-data-xs text-text-muted text-center py-3",children:"No identity configured"})]})]})]})})]})}),e.jsx(me,{open:Y,onClose:()=>X(!1),mode:Z,identity:g,repeaterConfig:null==b?void 0:b.config,onCreate:K,onUpdate:q,onDelete:z,onSendAdvert:H})]}):e.jsxs(i,{children:[e.jsx(r,{title:"Room Server",icon:e.jsx(p,{})}),e.jsx(ae,{onCreateRoom:e=>ue(e)}),e.jsx(me,{open:Y,onClose:()=>X(!1),mode:"create",repeaterConfig:null==b?void 0:b.config,onCreate:async e=>{const t=await K(e);return t&&"dedicated"===te&&(await P.getState().setMode("monitor"),P.getState().clearModeMutation()),t},onUpdate:q,onDelete:z,onSendAdvert:H})]})}export{fe as default};
