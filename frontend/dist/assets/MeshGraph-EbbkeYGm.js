var oa=Object.defineProperty;var la=(s,n,l)=>n in s?oa(s,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[n]=l;var vt=(s,n,l)=>la(s,typeof n!="symbol"?n+"":n,l);import{r as u,j as e,m as Zs,W as ca,Z as da}from"./vendor-react-CHg3w57L.js";import{r as ua}from"./cosmograph-RBQGoH9-.js";import{b1 as bn,b2 as ma,aF as ha,aB as xa,b3 as pa,b4 as ga,b5 as fa,b6 as ba,b7 as va,b8 as ya,b9 as ja,p as Na,aR as wa,ba as Ca,bb as F,Z as $,h as X,J as L,bc as Sa,bd as ka,be as La,B as Vt,av as Vs}from"./index-B4woLUMa.js";import{u as Ra,r as Da,f as Ks,g as Ea,e as Fa}from"./consumer-registry-CWCmZQuW.js";import{c as Ma,D as Ta,s as Kt}from"./DeepAnalysisModal-Bv12uRie.js";import{D as Aa}from"./DataBox-CbYpEKKd.js";import{h as St,c as vn}from"./geo-utils-BP1zBK9h.js";import{b as Ha,A as at,m as We}from"./vendor-motion-CXybMqb1.js";import{aK as Ia,aL as yn,b as Oa,X as it,W as Us,ah as Ba,aM as Pa,aN as za,aO as jn,a4 as Xs,au as Ys,m as Ga,P as $a,aP as _a,R as Zt,aQ as yt,aR as qs,aB as Qs,aS as Js,aT as en,C as nt,D as zt,ar as Wa,L as tn,ak as Za,a as Va,o as Ka,E as Ua,aU as Xa}from"./vendor-icons-rRVc_l7g.js";import{N as Ya,a as qa}from"./badge-colors-BNUqIXCA.js";import{e as Qa,f as sn,g as Ja}from"./meshcore-tx-constants-DgpFTAmf.js";import"./vendor-core-CgllfypI.js";import"./vendor-charts-DuSK2RSZ.js";import"./vendor-fonts-CgDm-k6O.js";function ei(s,n=1e3){const[l,r]=u.useState(s),i=u.useRef(Date.now()),o=u.useRef(null);return u.useEffect(()=>{const m=Date.now(),a=n-(m-i.current);return a<=0?(r(s),i.current=m):(o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{r(s),i.current=Date.now()},a)),()=>{o.current&&clearTimeout(o.current)}},[s,n]),l}function ti(s){if(s==null)return"";const n=String(s);return n.includes(",")||n.includes('"')||n.includes(`
`)?`"${n.replace(/"/g,'""')}"`:n}function kt(s,n){const l=[s.join(",")];for(const r of n)l.push(r.map(ti).join(","));return l.join(`
`)}function Fe(s){return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function Nn(s){return!s||s<=0?"":new Date(s*1e3).toISOString()}function Gt(s,n){const r=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);return`${s}-${r}.${n}`}const si=["hash","prefix","name","nodeClass","communityId","degree","inDegree","outDegree","betweenness","pathDiversity","packetCount","lastSeen","activityLevel","recencyScore","avgRssi","avgSnr","isZeroHop","prefixConfidence","hasCollision","collisionCandidates","isLocal","isHub","isGateway","isBackbone","isMobile","isGhost","isInLoop","latitude","longitude","contactType"];function ni(s){var n,l;return[s.hash,s.prefix,s.name??"",s.nodeClass,s.communityId,s.degree,s.inDegree,s.outDegree,s.betweenness.toFixed(6),s.pathDiversity,s.packetCount,Nn(s.lastSeen),s.activityLevel,s.recencyScore.toFixed(4),((n=s.avgRssi)==null?void 0:n.toFixed(1))??"",((l=s.avgSnr)==null?void 0:l.toFixed(1))??"",s.isZeroHop,s.prefixConfidence.toFixed(4),s.hasCollision,s.collisionCandidates,s.isLocal,s.isHub,s.isGateway,s.isBackbone,s.isMobile,s.isGhost,s.isInLoop,s.latitude??"",s.longitude??"",s.contactType??""]}function nn(s,n){const l=[];for(const r of s.nodeMetrics.values())!n&&r.isGhost||l.push(ni(r));return kt(si,l)}function ai(s,n){const l=[];for(const r of s.nodeMetrics.values())!n&&r.isGhost||l.push({hash:r.hash,prefix:r.prefix,name:r.name,nodeClass:r.nodeClass,communityId:r.communityId,degree:r.degree,inDegree:r.inDegree,outDegree:r.outDegree,betweenness:r.betweenness,pathDiversity:r.pathDiversity,packetCount:r.packetCount,lastSeen:r.lastSeen,activityLevel:r.activityLevel,recencyScore:r.recencyScore,avgRssi:r.avgRssi,avgSnr:r.avgSnr,isZeroHop:r.isZeroHop,prefixConfidence:r.prefixConfidence,hasCollision:r.hasCollision,isLocal:r.isLocal,isHub:r.isHub,isGateway:r.isGateway,isBackbone:r.isBackbone,isMobile:r.isMobile,isGhost:r.isGhost,isInLoop:r.isInLoop,latitude:r.latitude,longitude:r.longitude,contactType:r.contactType});return l}const ii=["fromHash","toHash","key","packetCount","certainCount","avgConfidence","strength","forwardCount","reverseCount","symmetryRatio","dominantDirection","floodCount","directCount","isDirectPathEdge","isZeroHop","isLoopEdge","isCertain","avgRssi","avgSnr","avgRecency","hopDistanceFromLocal","edgeBetweenness","isBackbone"];function ri(s,n,l){var r,i;return[s.fromHash,s.toHash,s.key,s.packetCount,s.certainCount,s.avgConfidence.toFixed(4),s.strength.toFixed(4),s.forwardCount,s.reverseCount,s.symmetryRatio.toFixed(4),s.dominantDirection,s.floodCount,s.directCount,s.isDirectPathEdge,s.isZeroHop??!1,s.isLoopEdge??!1,s.isCertain,((r=s.avgRssi)==null?void 0:r.toFixed(1))??"",((i=s.avgSnr)==null?void 0:i.toFixed(1))??"",s.avgRecency.toFixed(4),s.hopDistanceFromLocal,(n.get(s.key)??0).toFixed(6),l.has(s.key)]}function oi(s,n){const l=n?s.edges:s.validatedEdges,r=new Set(s.backboneEdges),i=l.map(o=>ri(o,s.edgeBetweenness,r));return kt(ii,i)}function li(s,n){const l=n?s.edges:s.validatedEdges,r=new Set(s.backboneEdges);return l.map(i=>({fromHash:i.fromHash,toHash:i.toHash,key:i.key,packetCount:i.packetCount,certainCount:i.certainCount,avgConfidence:i.avgConfidence,strength:i.strength,forwardCount:i.forwardCount,reverseCount:i.reverseCount,symmetryRatio:i.symmetryRatio,dominantDirection:i.dominantDirection,floodCount:i.floodCount,directCount:i.directCount,isDirectPathEdge:i.isDirectPathEdge,isZeroHop:i.isZeroHop??!1,isLoopEdge:i.isLoopEdge??!1,isCertain:i.isCertain,avgRssi:i.avgRssi??null,avgSnr:i.avgSnr??null,avgRecency:i.avgRecency,hopDistanceFromLocal:i.hopDistanceFromLocal,edgeBetweenness:s.edgeBetweenness.get(i.key)??0,isBackbone:r.has(i.key)}))}const ci=["pathKey","hops","hopCount","healthScore","weakestLinkKey","weakestLinkConfidence","avgEdgeCertainty","observationTrend","alternatePathsCount","estimatedLatencyMs","observationCount","routeType","lastSeen","involvesHub"];function di(s){return[s.pathKey,s.hops.join(">"),s.hops.length,s.healthScore.toFixed(4),s.weakestLinkKey??"",s.weakestLinkConfidence.toFixed(4),s.avgEdgeCertainty.toFixed(4),s.observationTrend.toFixed(4),s.alternatePathsCount,s.estimatedLatencyMs.toFixed(0),s.observationCount,s.routeType,Nn(s.lastSeen),s.involvesHub]}function ui(s){const n=s.pathHealth.map(di);return kt(ci,n)}const mi=["nodeHash","nodePrefix","nodeName","networkRole","floodFactor","directFactor","floodSlots","directSlots","trafficIntensity","directNeighborCount","collisionRisk","confidence","adjustment","dataConfidence","observationSymmetry","rationale"];function hi(s,n,l){const r=l.get(s);return[s,(r==null?void 0:r.prefix)??"",(r==null?void 0:r.name)??"",n.networkRole,n.floodFactor.toFixed(2),n.directFactor.toFixed(2),n.floodSlots,n.directSlots,n.trafficIntensity.toFixed(4),n.directNeighborCount,n.collisionRisk.toFixed(4),n.confidence.toFixed(4),n.adjustment,n.dataConfidence,n.observationSymmetry.toFixed(4),n.rationale]}function xi(s){const n=[];for(const[l,r]of s.txDelayRecommendations)n.push(hi(l,r,s.nodeMetrics));return kt(mi,n)}function pi(s,n){var o,m;const l=new Set(s.backboneEdges),i=['<?xml version="1.0" encoding="UTF-8"?>','<gexf xmlns="http://gexf.net/1.3" version="1.3">',`  <meta lastmodifieddate="${new Date().toISOString()}">`,`    <creator>pymc_console v${bn}</creator>`,"    <description>MeshCore LoRa Mesh Network Topology</description>","  </meta>",'  <graph defaultedgetype="directed" mode="static">',"","    <!-- Node Attributes -->",'    <attributes class="node">','      <attribute id="n0" title="prefix" type="string"/>','      <attribute id="n1" title="name" type="string"/>','      <attribute id="n2" title="nodeClass" type="string"/>','      <attribute id="n3" title="communityId" type="integer"/>','      <attribute id="n4" title="degree" type="integer"/>','      <attribute id="n5" title="betweenness" type="float"/>','      <attribute id="n6" title="packetCount" type="integer"/>','      <attribute id="n7" title="activityLevel" type="string"/>','      <attribute id="n8" title="isHub" type="boolean"/>','      <attribute id="n9" title="isGateway" type="boolean"/>','      <attribute id="n10" title="isBackbone" type="boolean"/>','      <attribute id="n11" title="isMobile" type="boolean"/>','      <attribute id="n12" title="isGhost" type="boolean"/>','      <attribute id="n13" title="isZeroHop" type="boolean"/>','      <attribute id="n14" title="prefixConfidence" type="float"/>','      <attribute id="n15" title="avgRssi" type="float"/>','      <attribute id="n16" title="avgSnr" type="float"/>',"    </attributes>","","    <!-- Edge Attributes -->",'    <attributes class="edge">','      <attribute id="e0" title="packetCount" type="integer"/>','      <attribute id="e1" title="certainCount" type="integer"/>','      <attribute id="e2" title="confidence" type="float"/>','      <attribute id="e3" title="symmetryRatio" type="float"/>','      <attribute id="e4" title="dominantDirection" type="string"/>','      <attribute id="e5" title="isBackbone" type="boolean"/>','      <attribute id="e6" title="isLoopEdge" type="boolean"/>','      <attribute id="e7" title="isDirectPath" type="boolean"/>','      <attribute id="e8" title="isZeroHop" type="boolean"/>','      <attribute id="e9" title="edgeBetweenness" type="float"/>','      <attribute id="e10" title="floodCount" type="integer"/>','      <attribute id="e11" title="directCount" type="integer"/>',"    </attributes>","","    <nodes>"];for(const a of s.nodeMetrics.values()){if(!n&&a.isGhost)continue;const x=Fe(a.name??a.prefix);i.push(`      <node id="${Fe(a.hash)}" label="${x}">`),i.push("        <attvalues>"),i.push(`          <attvalue for="n0" value="${Fe(a.prefix)}"/>`),i.push(`          <attvalue for="n1" value="${Fe(a.name??"")}"/>`),i.push(`          <attvalue for="n2" value="${a.nodeClass}"/>`),i.push(`          <attvalue for="n3" value="${a.communityId}"/>`),i.push(`          <attvalue for="n4" value="${a.degree}"/>`),i.push(`          <attvalue for="n5" value="${a.betweenness}"/>`),i.push(`          <attvalue for="n6" value="${a.packetCount}"/>`),i.push(`          <attvalue for="n7" value="${a.activityLevel}"/>`),i.push(`          <attvalue for="n8" value="${a.isHub}"/>`),i.push(`          <attvalue for="n9" value="${a.isGateway}"/>`),i.push(`          <attvalue for="n10" value="${a.isBackbone}"/>`),i.push(`          <attvalue for="n11" value="${a.isMobile}"/>`),i.push(`          <attvalue for="n12" value="${a.isGhost}"/>`),i.push(`          <attvalue for="n13" value="${a.isZeroHop}"/>`),i.push(`          <attvalue for="n14" value="${a.prefixConfidence}"/>`),a.avgRssi!=null&&i.push(`          <attvalue for="n15" value="${a.avgRssi}"/>`),a.avgSnr!=null&&i.push(`          <attvalue for="n16" value="${a.avgSnr}"/>`),i.push("        </attvalues>"),a.latitude!=null&&a.longitude!=null&&(a.latitude!==0||a.longitude!==0)&&i.push(`        <viz:position x="${a.longitude}" y="${a.latitude}" z="0.0"/>`),i.push("      </node>")}i.push("    </nodes>"),i.push(""),i.push("    <edges>");for(const a of s.validatedEdges){const x=s.nodeMetrics;if(!n&&((o=x.get(a.fromHash))!=null&&o.isGhost||(m=x.get(a.toHash))!=null&&m.isGhost))continue;const p=s.edgeBetweenness.get(a.key)??0;i.push(`      <edge id="${Fe(a.key)}" source="${Fe(a.fromHash)}" target="${Fe(a.toHash)}" weight="${a.strength}">`),i.push("        <attvalues>"),i.push(`          <attvalue for="e0" value="${a.packetCount}"/>`),i.push(`          <attvalue for="e1" value="${a.certainCount}"/>`),i.push(`          <attvalue for="e2" value="${a.avgConfidence}"/>`),i.push(`          <attvalue for="e3" value="${a.symmetryRatio}"/>`),i.push(`          <attvalue for="e4" value="${a.dominantDirection}"/>`),i.push(`          <attvalue for="e5" value="${l.has(a.key)}"/>`),i.push(`          <attvalue for="e6" value="${a.isLoopEdge??!1}"/>`),i.push(`          <attvalue for="e7" value="${a.isDirectPathEdge}"/>`),i.push(`          <attvalue for="e8" value="${a.isZeroHop??!1}"/>`),i.push(`          <attvalue for="e9" value="${p}"/>`),i.push(`          <attvalue for="e10" value="${a.floodCount}"/>`),i.push(`          <attvalue for="e11" value="${a.directCount}"/>`),i.push("        </attvalues>"),i.push("      </edge>")}return i.push("    </edges>"),i.push("  </graph>"),i.push("</gexf>"),i.join(`
`)}function gi(s,n,l){const r={meta:{exportedAt:new Date().toISOString(),pymcConsoleVersion:bn,nodeCount:s.nodeMetrics.size,edgeCount:s.validatedEdges.length,communityCount:s.communityCount,loopCount:s.loops.length,backboneEdgeCount:s.backboneEdges.length,hubNodes:s.hubNodes.length,gatewayNodes:s.gatewayNodes.length,mobileNodes:s.mobileNodes.length,ghostNodes:s.discoveredNodes.filter(i=>i.isLikelyReal).length},nodes:ai(s,n),edges:li(s,l),pathHealth:s.pathHealth.map(i=>({pathKey:i.pathKey,hops:i.hops,healthScore:i.healthScore,weakestLinkKey:i.weakestLinkKey,weakestLinkConfidence:i.weakestLinkConfidence,avgEdgeCertainty:i.avgEdgeCertainty,observationTrend:i.observationTrend,alternatePathsCount:i.alternatePathsCount,estimatedLatencyMs:i.estimatedLatencyMs,observationCount:i.observationCount,routeType:i.routeType,lastSeen:i.lastSeen,involvesHub:i.involvesHub})),txDelayRecommendations:Array.from(s.txDelayRecommendations.entries()).map(([i,o])=>{var m,a;return{nodeHash:i,nodePrefix:((m=s.nodeMetrics.get(i))==null?void 0:m.prefix)??"",nodeName:((a=s.nodeMetrics.get(i))==null?void 0:a.name)??null,networkRole:o.networkRole,floodFactor:o.floodFactor,directFactor:o.directFactor,floodSlots:o.floodSlots,directSlots:o.directSlots,trafficIntensity:o.trafficIntensity,collisionRisk:o.collisionRisk,confidence:o.confidence,adjustment:o.adjustment,dataConfidence:o.dataConfidence,rationale:o.rationale}}),loops:s.loops.map(i=>({id:i.id,nodes:i.nodes,edgeKeys:i.edgeKeys,size:i.size,avgCertainCount:i.avgCertainCount,minCertainCount:i.minCertainCount,includesLocal:i.includesLocal,strength:i.strength})),disambiguationStats:{totalPrefixes:s.disambiguationStats.totalPrefixes,unambiguousPrefixes:s.disambiguationStats.unambiguousPrefixes,collisionPrefixes:s.disambiguationStats.collisionPrefixes,collisionRate:s.disambiguationStats.collisionRate,avgConfidence:s.disambiguationStats.avgConfidence},viterbiStats:{totalPaths:s.viterbiStats.totalPaths,pathsWithGhosts:s.viterbiStats.pathsWithGhosts,avgPathConfidence:s.viterbiStats.avgPathConfidence,tracePacketsProcessed:s.viterbiStats.tracePacketsProcessed,pathPacketsProcessed:s.viterbiStats.pathPacketsProcessed,distantEdgesDiscovered:s.viterbiStats.distantEdgesDiscovered,duplicateGroupsFound:s.viterbiStats.duplicateGroupsFound,echolocationEdgesInferred:s.viterbiStats.echolocationEdgesInferred}};return JSON.stringify(r,null,2)}function fi(s,n){const l=n.includeGhosts??!0,r=n.includeWeakEdges??!1;switch(n.format){case"csv":{let i,o;switch(n.dataset){case"nodes":i=nn(s,l),o="mesh-nodes";break;case"edges":i=oi(s,r),o="mesh-edges";break;case"pathHealth":i=ui(s),o="mesh-path-health";break;case"txDelay":i=xi(s),o="mesh-tx-delay";break;case"full":default:i=nn(s,l),o="mesh-nodes";break}return{content:i,filename:Gt(o,"csv"),mimeType:"text/csv"}}case"gexf":return{content:pi(s,l),filename:Gt("mesh-topology","gexf"),mimeType:"application/xml"};case"json":default:return{content:gi(s,l,r),filename:Gt("mesh-topology","json"),mimeType:"application/json"}}}function bi(s){const n=new Blob([s.content],{type:s.mimeType}),l=URL.createObjectURL(n),r=document.createElement("a");r.href=l,r.download=s.filename,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(l)}function vi(s,n){const l=fi(s,n);bi(l)}const yi=1e-7,ji=10;function Ni(s,n,l=1){const r=n.length,i=new Map;for(let x=0;x<r;x++)i.set(n[x],x);const o=Array.from({length:r},()=>[]),m=new Array(r).fill(0);let a=0;for(const x of s){const p=i.get(x.fromHash),b=i.get(x.toHash);if(p===void 0||b===void 0||p===b)continue;const v=Math.max(.01,(x.certainCount+1)*x.avgConfidence*x.strength),h=l===1?v:Math.pow(v,l);o[p].push({j:b,w:h}),o[b].push({j:p,w:h}),m[p]+=h,m[b]+=h,a+=h}return{graph:{n:r,adjList:o,totalWeight:a,degree:m},hashToIdx:i}}function wi(s,n,l=1){const{n:r,adjList:i,totalWeight:o,degree:m}=s;if(o===0)return!1;const a=2*o,x=new Float64Array(r);for(let v=0;v<r;v++)x[n[v]]+=m[v];let p=!1,b=!0;for(;b;){b=!1;for(let v=0;v<r;v++){const h=n[v],d=m[v];if(d===0)continue;const f=new Map;for(const{j:P,w:A}of i[v]){const _=n[P];f.set(_,(f.get(_)??0)+A)}const y=f.get(h)??0,C=x[h]-d,D=-y/o+l*(d*C)/(a*o);let w=h,I=0;for(const[P,A]of f){if(P===h)continue;const _=A/o-l*(d*x[P])/(a*o),T=D+_;T>I+yi&&(I=T,w=P)}w!==h&&(x[h]-=d,x[w]+=d,n[v]=w,b=!0,p=!0)}}return p}function Ci(s,n){const{n:l,adjList:r}=s,i=new Set;for(let d=0;d<l;d++)i.add(n[d]);const o=Array.from(i).sort((d,f)=>d-f),m=new Map;for(let d=0;d<o.length;d++)m.set(o[d],d);const a=o.length,x=new Int32Array(l);for(let d=0;d<l;d++)x[d]=m.get(n[d]);const p=new Map,b=new Float64Array(a);let v=0;for(let d=0;d<l;d++){const f=x[d];for(const{j:y,w:C}of r[d]){const D=x[y];if(f===D)continue;const w=f<=D?`${f}-${D}`:`${D}-${f}`;p.set(w,(p.get(w)??0)+C)}}const h=Array.from({length:a},()=>[]);for(const[d,f]of p){const[y,C]=d.split("-").map(Number),D=f/2;h[y].push({j:C,w:D}),h[C].push({j:y,w:D}),b[y]+=D,b[C]+=D,v+=D}return{newGraph:{n:a,adjList:h,totalWeight:v,degree:Array.from(b)},mapping:x}}function Si(s,n,l=1){const{n:r,adjList:i,totalWeight:o,degree:m}=s;if(o===0)return 0;const a=2*o;let x=0;for(let p=0;p<r;p++)for(const{j:b,w:v}of i[p])n[p]===n[b]&&(x+=v-l*(m[p]*m[b])/a);return x/a}function an(s,n,l){const r=(l==null?void 0:l.resolution)??1,i=(l==null?void 0:l.kWeight)??1,o=n.length;if(o===0)return{communities:new Map,numCommunities:0,modularity:0,passes:0};if(o===1)return{communities:new Map([[n[0],0]]),numCommunities:1,modularity:0,passes:0};const{graph:m}=Ni(s,n,i);let a=m,x=new Int32Array(o);for(let w=0;w<o;w++)x[w]=w;const p=[];let b=0;for(;b<ji&&wi(a,x,r);){b++;const{newGraph:I,mapping:P}=Ci(a,x);if(p.push(P),I.n>=a.n)break;a=I,x=new Int32Array(I.n);for(let A=0;A<I.n;A++)x[A]=A}const v=new Int32Array(o);for(let w=0;w<o;w++)v[w]=w;for(const w of p)for(let I=0;I<o;I++)v[I]=w[v[I]];for(let w=0;w<o;w++)v[w]=x[v[w]];const h=new Set;for(let w=0;w<o;w++)h.add(v[w]);const d=Array.from(h).sort((w,I)=>w-I),f=new Map;for(let w=0;w<d.length;w++)f.set(d[w],w);const y=new Map;for(let w=0;w<o;w++)y.set(n[w],f.get(v[w]));const C=new Int32Array(o);for(let w=0;w<o;w++)C[w]=f.get(v[w]);const D=Si(m,C,r);return{communities:y,numCommunities:d.length,modularity:D,passes:b}}const ki=299792458,wn=915,Li=6,Ri=-174,Cn=2.15,Sn=2.15,rn={7:-124,8:-127,9:-130,10:-133,11:-135.5,12:-137},Di={62.5:3,125:0,250:-3,500:-6},Ei={5:0,6:-.6,7:-1.1,8:-1.5},jt={EXCELLENT:20,GOOD:10,FAIR:3,MARGINAL:0},Nt={ANOMALOUS_GOOD:15,BETTER:5,EXPECTED_LOWER:-5,WORSE:-20};function kn(s,n){if(s<=0)return 0;const l=n*1e6;return 20*Math.log10(s)+20*Math.log10(l)+20*Math.log10(4*Math.PI/ki)}function Ut(s,n,l=5){const r=rn[s]??rn[12],i=Di[n]??0,o=Ei[l]??0;return r+i+o}function Ln(s,n=Li){return Ri+10*Math.log10(s)+n}function Rn(s){return s>=jt.EXCELLENT?"excellent":s>=jt.GOOD?"good":s>=jt.FAIR?"fair":s>=jt.MARGINAL?"marginal":"critical"}function Dn(s){return s>=Nt.ANOMALOUS_GOOD?"anomalous-good":s>=Nt.BETTER?"better":s>=Nt.EXPECTED_LOWER?"expected":s>=Nt.WORSE?"worse":"anomalous-bad"}function Fi(s,n,l,r,i){const o=r.tx_power??22,m=r.spreading_factor??12,a=r.coding_rate??5,x=r.frequency??0,p=x>1e5?x/1e6:x||wn,b=r.bandwidth??0,v=b>1e3?b/1e3:b||125,h=(i==null?void 0:i.sensitivityOverrideDbm)??Ut(m,v,a);let d=null,f=null;n&&l&&St(n.latitude??void 0,n.longitude??void 0)&&St(l.latitude??void 0,l.longitude??void 0)&&(d=vn(n.latitude,n.longitude,l.latitude,l.longitude),f=d/1e3);let y=null,C=null;d!=null&&d>0&&(y=kn(d,p),C=o+Cn+Sn-y);const D=s.avgRssi??null,w=s.avgSnr??null;let I=null,P=null;D!=null&&C!=null&&(I=D-C,P=Dn(I));let A=null,_=null;D!=null&&(A=D-h,_=Rn(A));const T=D!=null,V=P==="anomalous-good"||P==="anomalous-bad";return{edgeKey:s.key,fromHash:s.fromHash,toHash:s.toHash,distanceM:d,distanceKm:f,fsplDb:y,theoreticalRxPowerDbm:C,observedRssiDbm:D,observedSnrDb:w,deviationDb:I,deviationClass:P,marginDb:A,marginClass:_,sensitivityDbm:h,txPowerDbm:o,frequencyMhz:p,spreadingFactor:m,bandwidthKhz:v,noiseFloorDbm:null,isZeroHop:s.isZeroHop??!1,isTraceEstimated:!1,hasData:T,isAnomalous:V}}function Mi(s,n,l,r,i=22,o){var ee,le;const m=s.traceQuality;if(!m)return null;let a=null;if(m.forward!=null&&m.reverse!=null?a=Math.min(m.forward.mean,m.reverse.mean):a=((ee=m.forward)==null?void 0:ee.mean)??((le=m.reverse)==null?void 0:le.mean)??null,a==null)return null;const x=r.spreading_factor??12,p=r.coding_rate??5,b=r.bandwidth??0,v=b>1e3?b/1e3:b||125,h=v*1e3,d=r.frequency??0,f=d>1e5?d/1e6:d||wn,y=(o==null?void 0:o.sensitivityOverrideDbm)??Ut(x,v,p),C=(o==null?void 0:o.observedNoiseFloorDbm)??Ln(h),D=C+a;let w=null,I=null;n&&l&&St(n.latitude??void 0,n.longitude??void 0)&&St(l.latitude??void 0,l.longitude??void 0)&&(w=vn(n.latitude,n.longitude,l.latitude,l.longitude),I=w/1e3);let P=null,A=null;w!=null&&w>0&&(P=kn(w,f),A=i+Cn+Sn-P);let _=null,T=null;A!=null&&(_=D-A,T=Dn(_));const V=D-y,oe=Rn(V);return{edgeKey:s.key,fromHash:s.fromHash,toHash:s.toHash,distanceM:w,distanceKm:I,fsplDb:P,theoreticalRxPowerDbm:A,observedRssiDbm:D,observedSnrDb:a,deviationDb:_,deviationClass:T,marginDb:V,marginClass:oe,sensitivityDbm:y,noiseFloorDbm:C,txPowerDbm:i,frequencyMhz:f,spreadingFactor:x,bandwidthKhz:v,isZeroHop:!1,isTraceEstimated:!0,hasData:!0,isAnomalous:T==="anomalous-good"||T==="anomalous-bad"}}function Ti(s,n,l){const r=[],i=s.nodeMetrics,o=new Set,m=n.tx_power??22;for(const a of s.edges){if(!a.isZeroHop)continue;const x=i.get(a.fromHash),p=i.get(a.toHash);r.push(Fi(a,x,p,n,l)),o.add(a.key)}for(const a of s.edges){if(o.has(a.key)||!a.traceQuality)continue;const x=i.get(a.fromHash),p=i.get(a.toHash),b=Mi(a,x,p,n,m,l);b&&(r.push(b),o.add(a.key))}return r}function Ai(s){const n={"anomalous-good":0,better:0,expected:0,worse:0,"anomalous-bad":0},l={excellent:0,good:0,fair:0,marginal:0,critical:0};let r=0,i=0,o=null,m=null,a=0,x=0;for(const p of s)p.hasData&&(p.marginDb!=null&&(r+=p.marginDb,i++,(!o||p.marginDb<(o.marginDb??1/0))&&(o=p),(!m||p.marginDb>(m.marginDb??-1/0))&&(m=p)),p.marginClass&&l[p.marginClass]++,p.deviationDb!=null&&p.deviationClass?(n[p.deviationClass]++,x++):a++);return{totalEdges:s.length,analyzedEdges:x,rssiOnlyEdges:a,avgMarginDb:i>0?r/i:null,worstMargin:o,bestMargin:m,deviationCounts:n,marginCounts:l,anomalousCount:n["anomalous-good"]+n["anomalous-bad"]}}const Hi={"anomalous-good":"#2DD4BF",better:"#34D399",expected:"#9CA3AF",worse:"#FB923C","anomalous-bad":"#EF4444"},Xt={excellent:"#34D399",good:"#A3E635",fair:"#FBBF24",marginal:"#FB923C",critical:"#EF4444"};function Ii(s,n="margin"){return s.hasData?n==="deviation"?s.deviationClass?Hi[s.deviationClass]:"#505058":s.marginClass?Xt[s.marginClass]:"#505058":"#505058"}function Oi(s,n=.5,l=4){if(s.marginDb==null)return n;const r=Math.max(0,Math.min(1,s.marginDb/40));return n+r*(l-n)}const Bi=.15,Pi=200;let zi=0;function he(){return`ta-${++zi}-${Date.now()}`}function Gi(s){var p,b;const n=new Set;for(const v of s.edges)n.add(v.key);const l=new Map,r=new Map,i=new Map,o=new Set;for(const[v,h]of s.nodeMetrics)l.set(v,h.betweenness),r.set(v,h.communityId),i.set(v,h.nodeClass),o.add(v);const m=new Set;for(const v of s.discoveredNodes)v.isLikelyReal&&m.add(v.prefix);const a=new Map,x=new Map;for(const v of s.edges)(p=v.traceQuality)!=null&&p.composite&&a.set(v.key,v.traceQuality.composite.mean),((b=v.traceQuality)==null?void 0:b.asymmetryDb)!=null&&x.set(v.key,v.traceQuality.asymmetryDb);return{timestamp:Date.now(),edgeKeys:n,betweenness:l,communities:r,nodeClasses:i,ghostPrefixes:m,nodeHashes:o,traceSnr:a,traceAsymmetry:x}}function $i(s,n,l){const r=Date.now(),i=[],o=h=>(l==null?void 0:l.get(h))??null;for(const h of n.edgeKeys)if(!s.edgeKeys.has(h)){const[d,f]=h.split("-"),y=o(d)??(d==null?void 0:d.slice(0,6)),C=o(f)??(f==null?void 0:f.slice(0,6));i.push({id:he(),detectedAt:r,category:"edge-appeared",severity:"info",description:`New edge: ${y} ↔ ${C}`,edgeKey:h})}for(const h of s.edgeKeys)if(!n.edgeKeys.has(h)){const[d,f]=h.split("-"),y=o(d)??(d==null?void 0:d.slice(0,6)),C=o(f)??(f==null?void 0:f.slice(0,6));i.push({id:he(),detectedAt:r,category:"edge-disappeared",severity:"warning",description:`Edge lost: ${y} ↔ ${C}`,edgeKey:h})}for(const h of n.nodeHashes)if(!s.nodeHashes.has(h)){const d=o(h);i.push({id:he(),detectedAt:r,category:"node-appeared",severity:"info",description:`Node appeared: ${d??h.slice(0,8)}`,nodeHash:h,nodeName:d??void 0})}for(const h of s.nodeHashes)if(!n.nodeHashes.has(h)){const d=o(h);i.push({id:he(),detectedAt:r,category:"node-disappeared",severity:"warning",description:`Node dropped: ${d??h.slice(0,8)}`,nodeHash:h,nodeName:d??void 0})}for(const h of n.ghostPrefixes)s.ghostPrefixes.has(h)||i.push({id:he(),detectedAt:r,category:"ghost-appeared",severity:"info",description:`Ghost node discovered: ${h.toUpperCase()}`});for(const h of s.ghostPrefixes)n.ghostPrefixes.has(h)||i.push({id:he(),detectedAt:r,category:"ghost-disappeared",severity:"info",description:`Ghost node resolved: ${h.toUpperCase()}`});const m=3;for(const[h,d]of n.traceSnr){const f=s.traceSnr.get(h);if(f===void 0)continue;const y=f-d;y>=m&&i.push({id:he(),detectedAt:r,category:"snr-degradation",severity:y>=6?"critical":"warning",description:`SNR dropped ${y.toFixed(1)} dB on edge ${h.slice(0,13)}`,edgeKey:h,previousValue:f,currentValue:d})}const a=4;for(const[h,d]of n.traceAsymmetry){const f=s.traceAsymmetry.get(h);if(f===void 0)continue;const y=d-f;y>=a&&i.push({id:he(),detectedAt:r,category:"asymmetry-shift",severity:y>=8?"critical":"warning",description:`Asymmetry grew ${y.toFixed(1)} dB on edge ${h.slice(0,13)}`,edgeKey:h,previousValue:f,currentValue:d})}for(const[h,d]of n.betweenness){const f=s.betweenness.get(h);if(f===void 0)continue;const y=Math.abs(d-f);if(y>=Bi){const C=o(h),D=d>f?"increased":"decreased";i.push({id:he(),detectedAt:r,category:"betweenness-shift",severity:y>=.3?"critical":"warning",description:`${C??h.slice(0,8)} betweenness ${D}: ${f.toFixed(3)} → ${d.toFixed(3)}`,nodeHash:h,nodeName:C??void 0,previousValue:f,currentValue:d})}}for(const[h,d]of n.communities){const f=s.communities.get(h);if(f!==void 0&&d!==f){const y=o(h);i.push({id:he(),detectedAt:r,category:"community-change",severity:"info",description:`${y??h.slice(0,8)} moved: community #${f} → #${d}`,nodeHash:h,nodeName:y??void 0,previousValue:f,currentValue:d})}}for(const[h,d]of n.nodeClasses){const f=s.nodeClasses.get(h);if(f!==void 0&&d!==f){const y=o(h),C=on(d)>on(f);i.push({id:he(),detectedAt:r,category:"class-change",severity:C?"warning":"info",description:`${y??h.slice(0,8)} ${C?"promoted":"changed"}: ${f} → ${d}`,nodeHash:h,nodeName:y??void 0,previousValue:f,currentValue:d})}}const x={},p={},b=["edge-appeared","edge-disappeared","ghost-appeared","ghost-disappeared","betweenness-shift","community-change","class-change","node-appeared","node-disappeared","snr-degradation","asymmetry-shift"],v=["info","warning","critical"];for(const h of b)x[h]=0;for(const h of v)p[h]=0;for(const h of i)x[h.category]++,p[h.severity]++;return i.sort((h,d)=>d.detectedAt-h.detectedAt),{anomalies:i,categoryCounts:x,severityCounts:p,totalCount:i.length,timestamp:r}}function on(s){return{standard:0,ghost:1,mobile:2,neighbor:3,backbone:4,gateway:5,hub:6,local:7}[s]??0}class _i{constructor(n=Pi){vt(this,"prevSnapshot",null);vt(this,"log",[]);vt(this,"maxLog");this.maxLog=n}update(n,l){const r=Gi(n);if(!this.prevSnapshot)return this.prevSnapshot=r,{anomalies:[],categoryCounts:Vi(),severityCounts:Ki(),totalCount:0,timestamp:Date.now()};const i=$i(this.prevSnapshot,r,l);this.prevSnapshot=r;try{Zi(i.anomalies,n)}catch(o){console.warn("[TopologyAnomalyTracker] Enrichment failed, anomalies logged without detail:",o)}return this.log.unshift(...i.anomalies),this.log.length>this.maxLog&&(this.log.length=this.maxLog),i}getLog(){return this.log}getFiltered(n){const l=Date.now();return this.log.filter(r=>!(n.category&&r.category!==n.category||n.severity&&r.severity!==n.severity||n.nodeHash&&r.nodeHash!==n.nodeHash||n.maxAge&&l-r.detectedAt>n.maxAge))}clear(){this.log=[],this.prevSnapshot=null}}function Wi(s){return{nodeClass:s.nodeClass,degree:s.degree,betweenness:s.betweenness,activityLevel:s.activityLevel,isZeroHop:s.isZeroHop,avgRssi:s.avgRssi,avgSnr:s.avgSnr,communityId:s.communityId,packetCount:s.packetCount,connectionCount:s.degree}}function Zi(s,n){var o,m,a;const l=n.edgeMap,r=n.nodeMetrics,i=new Set(n.backboneEdges??[]);for(const x of s){if(x.edgeKey&&(x.category==="edge-appeared"||x.category==="edge-disappeared")){const p=l==null?void 0:l.get(x.edgeKey),b=x.edgeKey.split("-"),v=b[0],h=b[1],d=v?r==null?void 0:r.get(v):void 0,f=h?r==null?void 0:r.get(h):void 0;p?x.edgeDetail={fromName:(d==null?void 0:d.name)??null,toName:(f==null?void 0:f.name)??null,fromClass:(d==null?void 0:d.nodeClass)??null,toClass:(f==null?void 0:f.nodeClass)??null,packetCount:p.packetCount,confidence:p.avgConfidence,symmetryRatio:p.symmetryRatio,isBackbone:i.has(x.edgeKey),isLoop:p.isLoopEdge??!1,isZeroHop:p.isZeroHop??!1,isDirectPath:p.isDirectPathEdge,avgRssi:p.avgRssi??null,avgSnr:p.avgSnr??null,fromBetweenness:(d==null?void 0:d.betweenness)??null,toBetweenness:(f==null?void 0:f.betweenness)??null,traceCompositeSnr:((m=(o=p.traceQuality)==null?void 0:o.composite)==null?void 0:m.mean)??null,traceAsymmetryDb:((a=p.traceQuality)==null?void 0:a.asymmetryDb)??null}:x.edgeDetail={fromName:(d==null?void 0:d.name)??null,toName:(f==null?void 0:f.name)??null,fromClass:(d==null?void 0:d.nodeClass)??null,toClass:(f==null?void 0:f.nodeClass)??null,packetCount:0,confidence:0,symmetryRatio:0,isBackbone:!1,isLoop:!1,isZeroHop:!1,isDirectPath:!1,avgRssi:null,avgSnr:null,fromBetweenness:(d==null?void 0:d.betweenness)??null,toBetweenness:(f==null?void 0:f.betweenness)??null,traceCompositeSnr:null,traceAsymmetryDb:null}}if(x.nodeHash){const p=r==null?void 0:r.get(x.nodeHash);p&&(x.nodeDetail=Wi(p))}}}function Vi(){return{"edge-appeared":0,"edge-disappeared":0,"ghost-appeared":0,"ghost-disappeared":0,"betweenness-shift":0,"community-change":0,"class-change":0,"node-appeared":0,"node-disappeared":0,"snr-degradation":0,"asymmetry-shift":0}}function Ki(){return{info:0,warning:0,critical:0}}const En=24,Ui=3;function Xi(s,n,l,r){var m;const i=[],o=n.replace(/^0x/i,"").slice(0,2).toLowerCase();for(const a of s){if(a.transmitted||a.rssi==null||a.snr==null||a.rssi===0&&a.snr===0)continue;const x=((m=a.src_hash)==null?void 0:m.replace(/^0x/i,""))??"";if(x.slice(0,2).toLowerCase()!==o&&x!==n.replace(/^0x/i,""))continue;const b=a.original_path??a.forwarded_path??[],v=ma(b,r),h=(v==null?void 0:v.effectiveLength)??0,d=a.route??a.route_type;let f=!1;d!=null&&ha(d)?f=h<=1:f=h===0,f&&i.push({timestamp:a.timestamp*1e3,rssi:a.rssi,snr:a.snr})}if(i.sort((a,x)=>a.timestamp-x.timestamp),i.length>0&&i[0].timestamp<4102444800)for(const a of i)a.timestamp*=1e3;return i}function Yi(s,n=En){if(s.length===0)return[];const l=s[0].timestamp,i=s[s.length-1].timestamp-l;if(i<=0){const x=s.reduce((b,v)=>b+v.rssi,0)/s.length,p=s.reduce((b,v)=>b+v.snr,0)/s.length;return[{timestamp:l,avgRssi:x,avgSnr:p,minRssi:Math.min(...s.map(b=>b.rssi)),maxRssi:Math.max(...s.map(b=>b.rssi)),minSnr:Math.min(...s.map(b=>b.snr)),maxSnr:Math.max(...s.map(b=>b.snr)),count:s.length}]}const o=i/n,m=[];for(let x=0;x<n;x++)m.push({timestamp:l+(x+.5)*o,avgRssi:0,avgSnr:0,minRssi:1/0,maxRssi:-1/0,minSnr:1/0,maxSnr:-1/0,count:0});for(const x of s){const p=Math.min(n-1,Math.floor((x.timestamp-l)/o)),b=m[p];b.avgRssi+=x.rssi,b.avgSnr+=x.snr,b.minRssi=Math.min(b.minRssi,x.rssi),b.maxRssi=Math.max(b.maxRssi,x.rssi),b.minSnr=Math.min(b.minSnr,x.snr),b.maxSnr=Math.max(b.maxSnr,x.snr),b.count++}const a=[];for(const x of m)x.count>0&&(x.avgRssi/=x.count,x.avgSnr/=x.count,a.push(x));return a}function ln(s){if(s.length<2)return 0;const n=s.length;let l=0,r=0,i=0,o=0;for(let a=0;a<n;a++)l+=a,r+=s[a],i+=a*s[a],o+=a*a;const m=n*o-l*l;return m===0?0:(n*i-l*r)/m}function qi(s,n,l,r,i=En){const o=Xi(s,n,l,r);if(o.length<Ui)return null;const m=Yi(o,i);if(m.length<2)return null;let a=0,x=0,p=1/0,b=-1/0,v=1/0,h=-1/0;for(const D of o)a+=D.rssi,x+=D.snr,p=Math.min(p,D.rssi),b=Math.max(b,D.rssi),v=Math.min(v,D.snr),h=Math.max(h,D.snr);const d=ln(m.map(D=>D.avgRssi)),f=ln(m.map(D=>D.avgSnr)),y=o[0].timestamp,C=o[o.length-1].timestamp;return{buckets:m,totalSamples:o.length,rssiRange:[p,b],snrRange:[v,h],avgRssi:a/o.length,avgSnr:x/o.length,rssiTrend:d,snrTrend:f,timeSpanMs:C-y}}const J={observationTrend:.3,edgeCertainty:.25,redundancy:.15,signalMargin:.15,traceSnrTrend:.15},$t={critical:.75,high:.55,moderate:.35},Qi=-137,Ji=5;function er(s,n,l){if(s.observationCount<Ji)return null;const r=[];let i=0;s.observationTrend<0&&(i=Math.abs(s.observationTrend),r.push({name:"Declining usage",description:s.observationTrend<-.3?"Traffic rapidly declining":"Traffic gradually declining",score:i,weight:J.observationTrend}));const o=1-Math.min(1,s.avgEdgeCertainty);o>.3&&r.push({name:"Weak link certainty",description:s.weakestLinkKey?`Weakest: ${s.weakestLinkConfidence<.3?"very low":"low"} confidence`:`Average certainty: ${(s.avgEdgeCertainty*100).toFixed(0)}%`,score:o,weight:J.edgeCertainty});let m=0;s.alternatePathsCount===0?(m=1,r.push({name:"No alternate paths",description:"Single route to destination — no failover available",score:m,weight:J.redundancy})):s.alternatePathsCount===1&&(m=.5,r.push({name:"Limited redundancy",description:"Only 1 alternate path available",score:m,weight:J.redundancy}));let a=0;if(s.weakestLinkKey){const h=n.get(s.weakestLinkKey),d=(h==null?void 0:h.avgRssi)??null,f=s.weakestLinkTraceSnr;if(d!=null){const y=d-l;y<3?(a=1,r.push({name:"Signal near sensitivity",description:`Weakest link: ${y.toFixed(1)} dB margin (< 3 dB)`,score:a,weight:J.signalMargin})):y<10&&(a=1-(y-3)/7,r.push({name:"Low signal margin",description:`Weakest link: ${y.toFixed(1)} dB margin`,score:a,weight:J.signalMargin}))}else f!=null&&f<5&&(a=f<-5?1:f<0?.7:.4,r.push({name:"Low trace SNR",description:`Weakest link trace SNR: ${f.toFixed(1)} dB`,score:a,weight:J.signalMargin}))}let x=0;if(s.weakestLinkKey){const h=n.get(s.weakestLinkKey),d=h==null?void 0:h.traceQuality;d!=null&&d.composite&&(d.composite.mean<0?(x=.8,r.push({name:"Trace SNR negative",description:`Composite trace SNR: ${d.composite.mean.toFixed(1)} dB (negative)`,score:x,weight:J.traceSnrTrend})):d.composite.stdDev>4?(x=.6,r.push({name:"Unstable trace SNR",description:`High variance: σ=${d.composite.stdDev.toFixed(1)} dB`,score:x,weight:J.traceSnrTrend})):d.asymmetryDb!=null&&d.asymmetryDb>8&&(x=.5,r.push({name:"High SNR asymmetry",description:`Bidirectional asymmetry: ${d.asymmetryDb.toFixed(1)} dB`,score:x,weight:J.traceSnrTrend})))}const p=i*J.observationTrend+o*J.edgeCertainty+m*J.redundancy+a*J.signalMargin+x*J.traceSnrTrend;if(p<$t.moderate)return null;let b,v;return p>=$t.critical?(b="critical",v="imminent"):p>=$t.high?(b="high",v="near-term"):(b="moderate",v="watch"),{pathKey:s.pathKey,hops:s.hops,riskScore:Math.round(p*100)/100,riskLevel:b,factors:r,weakestEdgeKey:s.weakestLinkKey,healthScore:s.healthScore,observationTrend:s.observationTrend,alternatePathsCount:s.alternatePathsCount,urgency:v}}function tr(s,n,l=Qi){const r=new Map;for(const m of n)r.set(m.key,m);const i=n.filter(m=>m.avgRssi!=null).length,o=[];for(const m of s){const a=er(m,r,l);a&&o.push(a)}return o.sort((m,a)=>a.riskScore-m.riskScore),{atRiskPaths:o,criticalCount:o.filter(m=>m.riskLevel==="critical").length,highCount:o.filter(m=>m.riskLevel==="high").length,moderateCount:o.filter(m=>m.riskLevel==="moderate").length,edgesAnalyzed:n.length,edgesWithSignal:i}}let sr=100;function cn(){return++sr}const Fn="meshgraph-panel-";function dn(s){try{const n=localStorage.getItem(Fn+s);return n?JSON.parse(n):null}catch{return null}}function nr(s,n){try{localStorage.setItem(Fn+s,JSON.stringify(n))}catch{}}function ar(s,n,l,r,i){return{x:Math.max(8,Math.min(s,Math.max(8,r-l-8))),y:Math.max(8,Math.min(n,Math.max(8,i-36)))}}function wt({id:s,title:n,icon:l,open:r,onClose:i,defaultPosition:o,defaultSize:m,minSize:a={width:180,height:120},maxSize:x,autoHeight:p=!1,headerActions:b,children:v}){const h=Ha(),d=u.useRef(null),f=u.useRef(null),y=u.useMemo(()=>{const H=dn(s);return H?{x:H.x,y:H.y,w:H.w,h:p?m.height:H.h,minimized:H.minimized}:{x:o.x,y:o.y,w:m.width,h:m.height,minimized:!1}},[s]),[C,D]=u.useState({w:y.w,h:y.h}),[w,I]=u.useState(y.minimized),[P,A]=u.useState(()=>cn()),[_,T]=u.useState({x:y.x,y:y.y});u.useLayoutEffect(()=>{const H=d.current;if(!r||!H)return;const de=H.getBoundingClientRect();if(de.width<1||de.height<1)return;const K=dn(s),xe=(K==null?void 0:K.x)??y.x,Me=(K==null?void 0:K.y)??y.y,ue=(K==null?void 0:K.w)??C.w,Te=ar(xe,Me,ue,de.width,de.height);T(Te)},[r,s]);const[V,oe]=u.useState(!1),ee=u.useRef({startX:0,startY:0,startW:0,startH:0,edge:""}),le=u.useRef(),rt=u.useCallback(()=>{le.current&&clearTimeout(le.current),le.current=setTimeout(()=>{const H=f.current;if(!H)return;const de=window.getComputedStyle(H),K=new DOMMatrix(de.transform);nr(s,{x:K.m41,y:K.m42,w:C.w,h:C.h,minimized:w})},300)},[s,C.w,C.h,w]);u.useEffect(()=>{rt()},[C,w,rt]);const ne=u.useCallback(()=>{A(cn())},[]),Ce=u.useCallback(()=>{I(H=>!H)},[]),ce=u.useCallback((H,de)=>{H.preventDefault(),H.stopPropagation(),oe(!0),ee.current={startX:H.clientX,startY:H.clientY,startW:C.w,startH:C.h,edge:de},ne();const K=Me=>{const{startX:ue,startY:Te,startW:Ze,startH:Ve,edge:Se}=ee.current,Lt=Me.clientX-ue,ot=Me.clientY-Te;let Ae=Ze,ke=Ve;(Se==="e"||Se==="se")&&(Ae=Math.max(a.width,Ze+Lt),x&&(Ae=Math.min(x.width,Ae))),(Se==="s"||Se==="se")&&(ke=Math.max(a.height,Ve+ot),x&&(ke=Math.min(x.height,ke))),D({w:Ae,h:ke})},xe=()=>{oe(!1),window.removeEventListener("pointermove",K),window.removeEventListener("pointerup",xe)};window.addEventListener("pointermove",K),window.addEventListener("pointerup",xe)},[C,a,x,ne]);return e.jsx("div",{ref:d,className:"absolute inset-0 pointer-events-none",style:{zIndex:P},children:e.jsx(at,{children:r&&e.jsxs(We.div,{ref:f,drag:!V,dragControls:h,dragConstraints:d,dragElastic:.05,dragMomentum:!1,dragListener:!1,initial:{opacity:0,scale:.96,x:_.x,y:_.y},animate:{opacity:1,scale:1,x:_.x,y:_.y},exit:{opacity:0,scale:.96},transition:{duration:.15},onPointerDown:ne,className:"absolute top-0 left-0 pointer-events-auto",style:{width:C.w,touchAction:"none"},children:[e.jsxs("div",{className:"surface-elevated radius-inset shadow-xl overflow-hidden flex flex-col",style:{maxHeight:w?void 0:p?"80vh":C.h},children:[e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1.5 border-b border-edge-subtle cursor-grab active:cursor-grabbing select-none shrink-0",onPointerDown:H=>{ne(),h.start(H)},children:[e.jsx(Ia,{className:"w-3 h-3 text-fg-muted/50 shrink-0"}),l&&e.jsx("span",{className:"text-fg-muted shrink-0 [&>svg]:w-3 [&>svg]:h-3",children:l}),e.jsx("span",{className:"text-[11px] font-medium text-fg-primary flex-1 truncate",children:n}),b,e.jsx("button",{onClick:Ce,className:"p-0.5 radius-badge hover-bg transition-base",title:w?"Expand":"Minimize",children:w?e.jsx(yn,{className:"w-2.5 h-2.5 text-fg-muted"}):e.jsx(Oa,{className:"w-2.5 h-2.5 text-fg-muted"})}),e.jsx("button",{onClick:i,className:"p-0.5 radius-badge hover-bg transition-base",title:"Close",children:e.jsx(it,{className:"w-2.5 h-2.5 text-fg-muted"})})]}),e.jsx(at,{initial:!1,children:!w&&e.jsx(We.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.15},className:"overflow-hidden",children:e.jsx("div",{className:"overflow-y-auto",style:{maxHeight:p?"70vh":void 0},children:v})})})]}),!w&&!p&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute top-0 -right-1 w-2 h-full cursor-ew-resize",onPointerDown:H=>ce(H,"e")}),e.jsx("div",{className:"absolute -bottom-1 left-0 w-full h-2 cursor-ns-resize",onPointerDown:H=>ce(H,"s")}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 cursor-nwse-resize",onPointerDown:H=>ce(H,"se"),children:e.jsxs("svg",{className:"w-full h-full text-fg-muted/30",viewBox:"0 0 12 12",children:[e.jsx("path",{d:"M10 2 L10 10 L2 10",fill:"none",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M7 5 L7 7 L5 7",fill:"none",stroke:"currentColor",strokeWidth:"1"})]})})]})]})})})}const Mn=[{target:"Graph",fn:"topology.edges",minStage:2,when:Ks},{target:"Graph",fn:"topology.edges",minStage:2,when:Ea},{target:"Graph",fn:"nodeMetrics",minStage:2},{target:"Graph",fn:"ghostNodes",minStage:2,when:Ks},{target:"Graph",fn:"_advertNodeType",minStage:1,when:Fa},{target:"Graph",fn:"pathHealth",minStage:2}];Da(Mn);const ir=400,Ct=800,$e={critical:[F.red,F.red],poor:[F.orange,F.orange],fair:[F.amber,F.amber],good:[F.green,F.green],excellent:[F.blue,F.blue]};function rr(s,n){if(s==null)return null;const l=Math.max(0,s),r=l>0?(Math.log10(l)+4)/4.5:0,i=Math.round(Math.max(0,Math.min(100,r*100)));let o,m;i<10?(o="critical",m="Partition risk"):i<30?(o="poor",m="Weak connectivity"):i<55?(o="fair",m="Moderate resilience"):i<80?(o="good",m="Well connected"):(o="excellent",m="Highly resilient");const[a,x]=$e[o];return{score:i,grade:o,label:m,color:n?a:x}}const un=5,_t=28,mn=6,or=6,lr={active:1,recent:.85,stale:.45,inactive:.25},cr=[F.purple,F.green,F.amber,F.red,F.blue,F.pink,F.teal,F.orange],dr=[F.purple,F.green,F.amber,F.red,F.blue,F.pink,F.teal,F.orange];function _e(s,n,l){const r=(o,m)=>parseInt(o.slice(1+m*2,3+m*2),16),i=o=>Math.round(r(s,o)*l+r(n,o)*(1-l));return`#${[0,1,2].map(o=>i(o).toString(16).padStart(2,"0")).join("")}`}const Tn={zeroHop:_e(F.amber,$[500],.55),directPath:_e(F.teal,$[500],.55),loop:_e(F.purple,$[500],.55),backbone:$[300],standard:$[500],standardDim:$[600],ghost:$[600]},An={zeroHop:_e(F.amber,$[700],.5),directPath:_e(F.teal,$[700],.5),loop:_e(F.purple,$[700],.5),backbone:$[700],standard:$[400],standardDim:$[300],ghost:$[400]},E={simulationDecay:2e4,simulationGravity:.05,simulationCenter:.05,simulationRepulsion:5,simulationRepulsionTheta:.4,simulationLinkSpring:.05,simulationLinkDistance:78,simulationFriction:.72,simulationRepulsionFromMouse:0,pointSizeScale:.4,pointOpacity:1,pointGreyoutOpacity:.1,linkWidthScale:.06,linkOpacity:.95,linkGreyoutOpacity:.1,curvedLinks:!1,curvedLinkWeight:.8,linkDefaultArrows:!0,linkArrowsSizeScale:1.7,scalePointsOnZoom:!0,scaleLinksOnZoom:!0,renderLinks:!0,renderHoveredPointRing:!0,fitViewPadding:.15,spaceSize:4096};function ur(s){if(typeof document>"u")return s?$[950]:"#EFF0F1";const n=getComputedStyle(document.documentElement).getPropertyValue("--bg-body").trim();return n.startsWith("#")?n:s?$[950]:"#EFF0F1"}function mr(s){if(typeof document>"u")return s?$[400]:$[500];const n=getComputedStyle(document.documentElement).getPropertyValue("--text-secondary").trim();return n.startsWith("#")?n:s?$[400]:$[500]}const Hn={local:F.amber,hub:F.purple,gateway:F.blue,backbone:F.green,neighbor:F.pink,mobile:F.orange,ghost:$[400],standard:$[300]},In={local:F.amber,hub:F.purple,gateway:F.blue,backbone:F.green,neighbor:F.pink,mobile:F.orange,ghost:$[500],standard:$[600]},hr={local:"Your repeater — the home node running this dashboard",hub:"≥10% of last-hop traffic — dominant forwarder for your local node",gateway:"7-10% of last-hop traffic — significant relay node",backbone:"High betweenness centrality — critical path node connecting clusters",neighbor:"Zero-hop direct RF contact — no intermediate forwarders",mobile:"High path volatility — node appears and disappears frequently",ghost:"Unresolved prefix inferred by Viterbi HMM from path patterns",standard:"<7% of traffic — normal mesh participant"};function hn(s){const n=s.replace("#","");return[parseInt(n.slice(0,2),16),parseInt(n.slice(2,4),16),parseInt(n.slice(4,6),16)]}function Wt(s,n,l){const[r,i,o]=hn(s),[m,a,x]=hn(n),p=Math.max(0,Math.min(1,l)),b=Math.round(r*p+m*(1-p)),v=Math.round(i*p+a*(1-p)),h=Math.round(o*p+x*(1-p));return`#${b.toString(16).padStart(2,"0")}${v.toString(16).padStart(2,"0")}${h.toString(16).padStart(2,"0")}`}function xr(s,n){return s.isZeroHop?"zero-hop":s.isDirectPathEdge?"direct-path":s.isLoopEdge?"loop":n.has(s.key)?"backbone":"standard"}function xn(s,n,l){const r=l?Tn:An;switch(s){case"zero-hop":return r.zeroHop;case"direct-path":return r.directPath;case"loop":return r.loop;case"backbone":return r.backbone;case"ghost":return r.ghost;case"standard":default:return n>=.7?r.standard:r.standardDim}}const pr={"zero-hop":"Zero-Hop (Direct RF)","direct-path":"Direct Path (Unicast)",loop:"Redundant Loop",backbone:"Backbone",standard:"Standard",ghost:"Ghost (Inferred)"},gr={"zero-hop":"Direct radio contact — no intermediate forwarders in path","direct-path":"Unicast-routed edge — verified via DIRECT route type packets",loop:"Redundant path — alternate route between the same endpoints exists",backbone:"High betweenness centrality — critical traffic flow edge",standard:"Normal mesh edge with moderate-to-high confidence",ghost:"Inferred connection from Viterbi HMM ghost node analysis"};function fr(s){const n=s.rssiTrend<-.1,l=s.snrTrend<-.1,r=s.rssiTrend>.1,i=s.snrTrend>.1,o=s.rssiRange[1]-s.rssiRange[0],m=s.snrRange[1]-s.snrRange[0];return n&&l?{text:"Both RSSI and SNR declining — possible antenna degradation or increasing distance",color:"#EF4444"}:l&&!n?{text:"SNR declining while RSSI stable — likely RF interference or noise floor increase",color:"#F97316"}:n&&!l?{text:"RSSI declining while SNR stable — possible path obstruction or power change",color:"#F97316"}:r&&i?{text:"Signal improving — conditions favorable or antenna adjustment working",color:"#34D399"}:o>15||m>10?{text:"High signal variance — intermittent obstruction or multipath fading",color:"#FBBF24"}:{text:"Signal stable — no significant degradation detected",color:"#9CA3AF"}}const br=u.memo(function({timeline:n}){const l=n.buckets;if(l.length<2)return null;const r=200,i=36,o=1,[m,a]=n.rssiRange,x=Math.max(1,a-m),[p,b]=n.snrRange,v=Math.max(1,b-p),h=(r-o*2)/(l.length-1),d=l.map((A,_)=>{const T=o+_*h,V=o+(1-(A.avgRssi-m)/x)*(i-o*2);return`${T.toFixed(1)},${V.toFixed(1)}`}).join(" "),f=l.map((A,_)=>{const T=o+_*h,V=o+(1-(A.avgSnr-p)/v)*(i-o*2);return`${T.toFixed(1)},${V.toFixed(1)}`}).join(" "),y=n.rssiTrend>.1?"↑":n.rssiTrend<-.1?"↓":"→",C=n.snrTrend>.1?"↑":n.snrTrend<-.1?"↓":"→",D=n.rssiTrend>.1?"#34D399":n.rssiTrend<-.1?"#EF4444":"#9CA3AF",w=n.snrTrend>.1?"#34D399":n.snrTrend<-.1?"#EF4444":"#9CA3AF",I=(n.timeSpanMs/36e5).toFixed(1),P=fr(n);return e.jsxs("div",{className:"mt-2 pt-2 border-t border-edge-subtle/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx(L,{content:e.jsxs("div",{className:"max-w-xs space-y-1.5",children:[e.jsx("div",{className:"font-semibold text-fg-primary",children:"Signal Quality Over Time"}),e.jsx("div",{className:"text-fg-secondary text-[11px]",children:"Tracks RSSI (signal power) and SNR (signal-to-noise ratio) for zero-hop packets received directly from this neighbor. Reveals weather effects, interference, and antenna degradation."}),e.jsxs("div",{className:"pt-1 border-t border-edge-subtle/30 space-y-0.5 font-mono text-[10px]",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-fg-muted",children:"Samples"}),e.jsx("span",{className:"text-fg-primary tabular-nums",children:n.totalSamples})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-fg-muted",children:"Time span"}),e.jsxs("span",{className:"text-fg-primary tabular-nums",children:[I,"h"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-fg-muted",children:"Avg RSSI"}),e.jsxs("span",{className:"text-fg-primary tabular-nums",children:[n.avgRssi.toFixed(1)," dBm"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-fg-muted",children:"Avg SNR"}),e.jsxs("span",{className:"text-fg-primary tabular-nums",children:[n.avgSnr.toFixed(1)," dB"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-fg-muted",children:"RSSI trend"}),e.jsxs("span",{className:"tabular-nums",style:{color:D},children:[n.rssiTrend>0?"+":"",n.rssiTrend.toFixed(3)," dBm/bucket"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-fg-muted",children:"SNR trend"}),e.jsxs("span",{className:"tabular-nums",style:{color:w},children:[n.snrTrend>0?"+":"",n.snrTrend.toFixed(3)," dB/bucket"]})]})]}),e.jsxs("div",{className:"text-[10px] text-fg-muted italic",children:["Trend is linear regression slope across ",l.length," time buckets. ↑ = improving, ↓ = degrading, → = stable."]})]}),children:e.jsx("span",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Signal Timeline"})}),e.jsxs("span",{className:"text-[9px] text-fg-muted tabular-nums",children:[n.totalSamples," samples · ",I,"h"]})]}),e.jsxs("svg",{viewBox:`0 0 ${r} ${i}`,className:"w-full h-9",preserveAspectRatio:"none",children:[e.jsx("polyline",{points:d,fill:"none",stroke:"#60A5FA",strokeWidth:"1.5",strokeLinejoin:"round",strokeLinecap:"round",opacity:"0.8"}),e.jsx("polyline",{points:f,fill:"none",stroke:"#34D399",strokeWidth:"1",strokeLinejoin:"round",strokeLinecap:"round",opacity:"0.5",strokeDasharray:"3 2"})]}),e.jsxs("div",{className:"flex items-center justify-between text-[9px] mt-0.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx("span",{className:"w-2.5 h-[1.5px] bg-[#60A5FA] rounded-full inline-block"}),e.jsx("span",{className:"text-fg-muted",children:"RSSI"}),e.jsx("span",{className:"tabular-nums",style:{color:D},children:y})]}),e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx("span",{className:"w-2.5 h-[1px] bg-[#34D399] rounded-full inline-block opacity-50",style:{borderTop:"1px dashed #34D399"}}),e.jsx("span",{className:"text-fg-muted",children:"SNR"}),e.jsx("span",{className:"tabular-nums",style:{color:w},children:C})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-fg-muted tabular-nums",children:[e.jsxs("span",{children:[m.toFixed(0),"…",a.toFixed(0)," dBm"]}),e.jsxs("span",{children:[p.toFixed(0),"…",b.toFixed(0)," dB"]})]})]}),e.jsx("div",{className:"mt-1 text-[9px] leading-tight",style:{color:P.color},children:P.text})]})}),pn=u.memo(function({edge:n,onClose:l}){const[r,i]=u.useState(null);return u.useEffect(()=>{if(!n.isZeroHop&&n.edgeType!=="zero-hop"){i(null);return}const o=Vs.getState().packets,m=Vs.getState().cachedLocalHash??void 0,a=qi(o,n.source,n.target,m);i(a)},[n.source,n.target,n.isZeroHop,n.edgeType]),e.jsxs(We.div,{variants:Kt,initial:"hidden",animate:"visible",exit:"exit",className:"absolute inset-x-3 bottom-3 z-20 surface-elevated radius-inset shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5 border-b border-edge-subtle/50",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(Xa,{className:"size-3.5 text-fg-muted shrink-0"}),e.jsxs("span",{className:"text-sm font-semibold text-fg-primary truncate",children:[n.fromName??n.source.slice(0,6)," → ",n.toName??n.target.slice(0,6)]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsx(X,{color:"zinc",compact:!0,children:pr[n.edgeType]}),n.isBackbone&&e.jsx(X,{color:"emerald",compact:!0,children:"BONE"}),n.isLoopEdge&&e.jsx(X,{color:"indigo",compact:!0,children:"LOOP"}),n.isGhost&&e.jsx(X,{color:"zinc",compact:!0,children:"GHOST"})]})]}),e.jsx(Vt,{plain:!0,onClick:l,title:"Close",className:"shrink-0",children:e.jsx(it,{className:"size-4"})})]}),e.jsxs("div",{className:"p-3 font-mono text-[11px]",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx(L,{content:"Average disambiguation confidence across all observations of this edge",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Confidence"})}),e.jsxs("div",{className:"text-fg-primary tabular-nums",children:[(n.confidence*100).toFixed(0),"%"]})]}),e.jsxs("div",{children:[e.jsx(L,{content:"Observations where both endpoints had high-confidence disambiguation",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Certain"})}),e.jsx("div",{className:"text-fg-primary tabular-nums",children:n.certainCount.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx(L,{content:"Total packets observed traversing this edge",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Packets"})}),e.jsx("div",{className:"text-fg-primary tabular-nums",children:n.packetCount.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx(L,{content:"Combined certainCount × confidence metric for edge ranking",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Strength"})}),e.jsx("div",{className:"text-fg-primary tabular-nums",children:n.strength.toFixed(2)})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3 mt-2",children:[e.jsxs("div",{children:[e.jsx(L,{content:"Bidirectional balance (min/max) — 0 = one-way traffic, 1 = perfectly balanced",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Symmetry"})}),e.jsx("div",{className:"text-fg-primary tabular-nums",children:n.symmetryRatio.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx(L,{content:"Dominant traffic flow direction between these nodes",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Direction"})}),e.jsx("div",{className:"text-fg-primary capitalize",children:n.dominantDirection})]}),e.jsxs("div",{children:[e.jsx(L,{content:"Forward (A→B) vs reverse (B→A) observation counts",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Fwd / Rev"})}),e.jsxs("div",{className:"text-fg-primary tabular-nums",children:[n.forwardCount," / ",n.reverseCount]})]}),e.jsxs("div",{children:[e.jsx(L,{content:"Routing method — broadcast flood vs unicast direct routing",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Flood / Direct"})}),e.jsxs("div",{className:"text-fg-primary tabular-nums",children:[n.floodCount," / ",n.directCount]})]})]}),(n.avgRssi!=null||n.avgSnr!=null)&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-2 pt-2 border-t border-edge-subtle/50",children:[n.avgRssi!=null&&e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] text-fg-muted uppercase",children:"RSSI"}),e.jsxs("div",{className:"text-fg-primary tabular-nums",children:[n.avgRssi.toFixed(1)," dBm"]})]}),n.avgSnr!=null&&e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] text-fg-muted uppercase",children:"SNR"}),e.jsxs("div",{className:"text-fg-primary tabular-nums",children:[n.avgSnr.toFixed(1)," dB"]})]})]}),n.linkBudget&&e.jsxs("div",{className:"grid grid-cols-4 gap-3 mt-2 pt-2 border-t border-edge-subtle/50",children:[n.linkBudget.distanceKm!=null&&e.jsxs("div",{children:[e.jsx(L,{content:"Haversine distance between endpoint locations",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Distance"})}),e.jsxs("div",{className:"text-fg-primary tabular-nums",children:[n.linkBudget.distanceKm.toFixed(2)," km"]})]}),n.linkBudget.fsplDb!=null&&e.jsxs("div",{children:[e.jsx(L,{content:"Free Space Path Loss — theoretical signal attenuation over this distance at configured frequency",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"FSPL"})}),e.jsxs("div",{className:"text-fg-primary tabular-nums",children:[n.linkBudget.fsplDb.toFixed(1)," dB"]})]}),n.linkBudget.marginDb!=null&&e.jsxs("div",{children:[e.jsx(L,{content:"Link margin — observed RSSI minus receiver sensitivity. Positive = signal headroom above minimum.",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Margin"})}),e.jsxs("div",{className:"text-fg-primary tabular-nums",style:{color:n.linkBudget.marginClass?Xt[n.linkBudget.marginClass]:void 0},children:[n.linkBudget.marginDb>0?"+":"",n.linkBudget.marginDb.toFixed(1)," dB"]})]}),n.linkBudget.deviationDb!=null&&e.jsxs("div",{children:[e.jsx(L,{content:"Deviation from theoretical FSPL — positive means better signal than free-space prediction",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"vs Theory"})}),e.jsxs("div",{className:"text-fg-primary tabular-nums",children:[n.linkBudget.deviationDb>0?"+":"",n.linkBudget.deviationDb.toFixed(1)," dB"]})]})]}),r&&e.jsx(br,{timeline:r})]})]})}),gn=u.memo(function({node:n,onClose:l,egoMetrics:r,onExpandEgo:i,neighbors:o,onSelectNeighbor:m,txDelayRec:a}){const[x,p]=u.useState(!1),[b,v]=u.useState(!1);return e.jsxs(We.div,{variants:Kt,initial:"hidden",animate:"visible",exit:"exit",className:"absolute inset-x-3 bottom-3 z-20 surface-elevated radius-inset shadow-xl max-h-[60vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5 border-b border-edge-subtle/50",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"size-2 shrink-0 rounded-full",style:{backgroundColor:(La()?Hn:In)[n.nodeClass]}}),e.jsx("code",{className:"text-sm font-semibold text-fg-primary shrink-0",children:n.prefix}),n.name&&e.jsx("span",{className:"text-sm text-fg-secondary truncate",children:n.name}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[n.isLocal&&e.jsx(X,{color:"yellow",compact:!0,children:"LOCAL"}),n.isHub&&e.jsx(X,{color:"violet",compact:!0,children:"HUB"}),n.isGateway&&e.jsx(X,{color:"sky",compact:!0,children:"GW"}),n.isBackbone&&e.jsx(X,{color:"emerald",compact:!0,children:"BONE"}),n.isMobile&&e.jsx(X,{color:"orange",compact:!0,children:"MOB"}),n.isZeroHop&&e.jsx(X,{color:"amber",compact:!0,children:"RF"}),n.isGhost&&e.jsx(X,{color:"zinc",compact:!0,children:"GHOST"}),n.isInLoop&&e.jsx(X,{color:"indigo",compact:!0,children:"LOOP"})]})]}),e.jsx(Vt,{plain:!0,onClick:l,title:"Close",className:"shrink-0",children:e.jsx(it,{className:"size-4"})})]}),e.jsxs("div",{className:"p-3 font-mono text-[11px]",children:[e.jsx(Aa,{copy:!0,size:"compact",truncate:[10,6],className:"w-full mb-3",children:n.hash}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx(L,{content:"Total connections (edges) to this node",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Degree"})}),e.jsx("div",{className:"text-fg-primary tabular-nums",children:n.degree})]}),e.jsxs("div",{children:[e.jsx(L,{content:"Inbound vs outbound edge count — indicates traffic directionality",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"In / Out"})}),e.jsxs("div",{className:"text-fg-primary tabular-nums",children:[n.inDegree," / ",n.outDegree]})]}),e.jsxs("div",{children:[e.jsx(L,{content:"Betweenness centrality (0–1) — how often this node lies on shortest paths. High value = critical relay.",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Between."})}),e.jsx("div",{className:"text-fg-primary tabular-nums",children:n.betweenness.toFixed(3)})]}),e.jsxs("div",{children:[e.jsx(L,{content:"Total packets observed involving this node",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Packets"})}),e.jsx("div",{className:"text-fg-primary tabular-nums",children:n.packetCount.toLocaleString()})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3 mt-2",children:[e.jsxs("div",{children:[e.jsx(L,{content:"Number of topology edges connected to this node",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Edges"})}),e.jsx("div",{className:"text-fg-primary tabular-nums",children:n.edgeCount})]}),e.jsxs("div",{children:[e.jsx(L,{content:"Community cluster assignment from graph partitioning algorithm",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Community"})}),e.jsxs("div",{className:"text-fg-primary tabular-nums",children:["#",n.communityId]})]}),e.jsxs("div",{children:[e.jsx(L,{content:"Prefix disambiguation confidence — how certain the 2-char prefix→node mapping is (multi-factor scoring)",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Confidence"})}),e.jsxs("div",{className:"text-fg-primary tabular-nums",children:[(n.prefixConfidence*100).toFixed(0),"%"]})]}),e.jsxs("div",{children:[e.jsx(L,{content:"Recency level — active (<1h), recent (<6h), stale (<24h), inactive (>24h)",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Activity"})}),e.jsx("div",{className:"text-fg-primary capitalize",children:n.activityLevel})]})]}),(n.avgRssi!=null||n.avgSnr!=null)&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-2 pt-2 border-t border-edge-subtle/50",children:[n.avgRssi!=null&&e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] text-fg-muted uppercase",children:"RSSI"}),e.jsxs("div",{className:"text-fg-primary tabular-nums",children:[n.avgRssi.toFixed(1)," dBm"]})]}),n.avgSnr!=null&&e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] text-fg-muted uppercase",children:"SNR"}),e.jsxs("div",{className:"text-fg-primary tabular-nums",children:[n.avgSnr.toFixed(1)," dB"]})]})]}),r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-2 pt-2 border-t border-edge-subtle/50",children:[e.jsxs("div",{children:[e.jsx(L,{content:"Number of direct 1-hop neighbors in the topology",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Ego Size"})}),e.jsx("div",{className:"text-fg-primary tabular-nums",children:r.neighborCount})]}),e.jsxs("div",{children:[e.jsx(L,{content:"Local clustering coefficient — how interconnected this node's neighbors are (0 = none, 1 = fully connected)",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Clustering"})}),e.jsx("div",{className:"text-fg-primary tabular-nums",children:r.clusteringCoeff.toFixed(3)})]}),e.jsxs("div",{children:[e.jsx(L,{content:"Average betweenness centrality of this node's direct neighbors",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Avg Nbr Btw."})}),e.jsx("div",{className:"text-fg-primary tabular-nums",children:r.avgNeighborBetweenness.toFixed(3)})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-2",children:[e.jsxs("div",{children:[e.jsx(L,{content:"Average disambiguation confidence across all connected edges",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Edge Conf."})}),e.jsxs("div",{className:"text-fg-primary tabular-nums",children:[(r.avgEdgeConfidence*100).toFixed(0),"%"]})]}),r.avgRssi!=null&&e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] text-fg-muted uppercase",children:"Avg RSSI"}),e.jsxs("div",{className:"text-fg-primary tabular-nums",children:[r.avgRssi.toFixed(1)," dBm"]})]}),r.avgSnr!=null&&e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] text-fg-muted uppercase",children:"Avg SNR"}),e.jsxs("div",{className:"text-fg-primary tabular-nums",children:[r.avgSnr.toFixed(1)," dB"]})]})]})]}),a&&!a.insufficientData&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-edge-subtle/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx(L,{content:"RF-grounded TX delay recommendation from centralized topology engine. Anchored to MeshCore firmware defaults with observer bias correction.",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase tracking-wide cursor-help",children:"TX Delay Recommendation"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[a.networkRole&&e.jsx(X,{color:Ya[a.networkRole],compact:!0,children:a.networkRole}),a.dataConfidence&&e.jsx(X,{color:qa[a.dataConfidence],compact:!0,children:a.dataConfidence})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(L,{content:`Flood TX delay factor (firmware default: ×${Qa})`,children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Flood"})}),e.jsx("div",{className:"text-fg-primary tabular-nums text-sys-amber",children:sn(a.floodFactor)})]}),e.jsxs("div",{children:[e.jsx(L,{content:`Direct TX delay factor (firmware default: ×${Ja})`,children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Direct"})}),e.jsx("div",{className:"text-fg-primary tabular-nums text-sys-amber",children:sn(a.directFactor)})]})]}),a.rationale&&e.jsx("div",{className:"mt-1 text-[9px] text-fg-muted leading-snug",children:a.rationale}),a.observationSymmetry!=null&&a.observationSymmetry<.6&&e.jsxs("div",{className:"mt-1 text-[9px] text-sys-amber/70 leading-snug",children:["⚠ Low observation symmetry (",(a.observationSymmetry*100).toFixed(0),"%) — recommendation damped toward firmware defaults"]}),e.jsxs("button",{onClick:async()=>{const h=`set txdelay ${a.floodFactor.toFixed(1)}
set direct.txdelay ${a.directFactor.toFixed(1)}`;try{await navigator.clipboard.writeText(h)}catch{}v(!0),setTimeout(()=>v(!1),1500)},className:"mt-1.5 flex items-center gap-1 text-[9px] text-sys-blue hover:text-sys-blue/80 transition-base",children:[b?e.jsx(Va,{className:"w-3 h-3 text-sys-green"}):e.jsx(Ka,{className:"w-3 h-3"}),b?"Copied!":"Copy CLI commands"]})]}),i&&e.jsx("div",{className:"mt-2 pt-2 border-t border-edge-subtle/50",children:e.jsxs("button",{onClick:i,className:"flex items-center gap-1.5 text-[10px] text-sys-blue hover:text-sys-blue/80 transition-base",children:[e.jsx(Ua,{className:"w-3 h-3"}),"Expand 2-hop neighborhood"]})}),o&&o.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-edge-subtle/50",children:[e.jsxs("button",{onClick:()=>p(h=>!h),className:"flex items-center justify-between w-full text-[9px] text-fg-muted uppercase tracking-wide cursor-pointer hover:text-fg-secondary transition-base",children:[e.jsxs("span",{children:["Neighbors (",o.length,")"]}),e.jsx(nt,{className:`w-3 h-3 transition-transform ${x?"rotate-180":""}`})]}),x&&e.jsx("div",{className:"mt-1.5 max-h-32 overflow-y-auto space-y-0.5",children:o.map(h=>e.jsxs("button",{onClick:()=>m==null?void 0:m(h.hash),className:"w-full flex items-center gap-2 px-1.5 py-1 radius-badge hover-bg transition-base text-left group",children:[e.jsx("code",{className:"text-[10px] text-sys-blue shrink-0 tabular-nums",children:h.prefix}),e.jsx("span",{className:"text-[10px] text-fg-secondary truncate flex-1",children:h.name||"—"}),h.avgSnr!=null&&e.jsxs("span",{className:"text-[9px] text-fg-muted tabular-nums shrink-0",children:[h.avgSnr.toFixed(0)," dB"]}),h.avgRssi!=null&&e.jsx("span",{className:"text-[9px] text-fg-muted tabular-nums shrink-0",children:h.avgRssi.toFixed(0)}),e.jsxs("span",{className:"text-[9px] text-fg-muted/60 tabular-nums shrink-0",children:[(h.edgeConfidence*100).toFixed(0),"%"]})]},h.hash))})]})]})]})}),fn=u.memo(function({metrics:n,onClose:l}){const r=Object.entries(n.communities).sort(([,o],[,m])=>m-o),i=Object.entries(n.nodeClasses).sort(([,o],[,m])=>m-o);return e.jsxs(We.div,{variants:Kt,initial:"hidden",animate:"visible",exit:"exit",className:"absolute inset-x-3 bottom-3 z-20 surface-elevated radius-inset shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5 border-b border-edge-subtle/50",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(jn,{className:"size-3.5 text-fg-muted shrink-0"}),e.jsx("span",{className:"text-sm font-semibold text-fg-primary",children:"Subgraph Analysis"}),e.jsxs(X,{color:"violet",compact:!0,children:[n.nodeCount," nodes"]})]}),e.jsx(Vt,{plain:!0,onClick:l,title:"Close",className:"shrink-0",children:e.jsx(it,{className:"size-4"})})]}),e.jsxs("div",{className:"p-3 font-mono text-[11px]",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] text-fg-muted uppercase",children:"Nodes"}),e.jsx("div",{className:"text-fg-primary tabular-nums",children:n.nodeCount})]}),e.jsxs("div",{children:[e.jsx(L,{content:"Edges where both endpoints are within the lasso selection",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Internal Edges"})}),e.jsx("div",{className:"text-fg-primary tabular-nums",children:n.edgeCount})]}),e.jsxs("div",{children:[e.jsx(L,{content:"Mean betweenness centrality of selected nodes",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Avg Between."})}),e.jsx("div",{className:"text-fg-primary tabular-nums",children:n.avgBetweenness.toFixed(3)})]}),e.jsxs("div",{children:[e.jsx(L,{content:"Mean edge disambiguation confidence for internal edges",children:e.jsx("div",{className:"text-[9px] text-fg-muted uppercase cursor-help",children:"Avg Confidence"})}),e.jsxs("div",{className:"text-fg-primary tabular-nums",children:[(n.avgConfidence*100).toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-2 pt-2 border-t border-edge-subtle/50",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] text-fg-muted uppercase mb-1",children:"Communities"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:r.map(([o,m])=>e.jsxs("span",{className:"text-fg-secondary",children:["#",o,"×",m]},o))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] text-fg-muted uppercase mb-1",children:"Node Types"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:i.map(([o,m])=>e.jsxs("span",{className:"text-fg-secondary capitalize",children:[o,"×",m]},o))})]})]}),n.nodeCount>1&&e.jsx("div",{className:"mt-2 pt-2 border-t border-edge-subtle/50",children:e.jsxs("div",{className:"text-[9px] text-fg-muted flex items-center gap-1 flex-wrap",children:[e.jsx(L,{content:"Fraction of possible edges that exist — 2E / N(N-1)",children:e.jsxs("span",{className:"cursor-help",children:["Density: ",(2*n.edgeCount/(n.nodeCount*(n.nodeCount-1))*100).toFixed(1),"%"]})}),e.jsx("span",{children:"·"}),e.jsx(L,{content:"Mean connections per node — 2E / N",children:e.jsxs("span",{className:"cursor-help",children:["Avg Degree: ",(2*n.edgeCount/n.nodeCount).toFixed(1)]})}),n.avgPathHealth!=null&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"·"}),e.jsx(L,{content:"Average health score of paths within the selection",children:e.jsxs("span",{className:"cursor-help",children:["Path Health: ",(n.avgPathHealth*100).toFixed(0),"%"]})})]})]})})]})]})});function vr(){return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-6 text-center px-8",children:[e.jsx("div",{className:"p-4 radius-pill bg-subtle-fill",children:e.jsx(Za,{className:"w-8 h-8 text-fg-muted"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"type-subheading text-fg-primary",children:"No Topology Data"}),e.jsx("p",{className:"type-body text-fg-muted max-w-sm",children:"The mesh topology will appear here once packets are received and processed."})]}),e.jsxs("div",{className:"flex items-center gap-2 type-data-xs text-fg-muted",children:[e.jsx(Zt,{className:"w-4 h-4 animate-pulse"}),e.jsx("span",{children:"Waiting for mesh traffic..."})]})]})}const Z=u.memo(function({label:n,value:l,onChange:r,min:i,max:o,step:m}){const[a,x]=u.useState(!1),[p,b]=u.useState(""),v=u.useRef(null),h=u.useCallback(()=>{const f=parseFloat(p);isNaN(f)||r(Math.min(o,Math.max(i,Math.round(f/m)*m))),x(!1)},[p,r,i,o,m]),d=u.useCallback(()=>{b(l.toFixed(2)),x(!0),setTimeout(()=>{var f;return(f=v.current)==null?void 0:f.select()},0)},[l]);return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-fg-muted",children:n}),a?e.jsx("input",{ref:v,type:"number",value:p,onChange:f=>b(f.target.value),onBlur:h,onKeyDown:f=>{f.key==="Enter"&&h(),f.key==="Escape"&&x(!1)},min:i,max:o,step:m,className:"w-14 text-right text-[10px] text-fg-secondary tabular-nums bg-subtle-fill radius-badge px-1 py-0.5 border border-edge-subtle focus:outline-none focus:border-sys-blue"}):e.jsx("button",{onClick:d,className:"text-[10px] text-fg-secondary tabular-nums hover:text-sys-blue cursor-text transition-colors",title:"Click to type a value",children:l.toFixed(2)})]}),e.jsx("input",{type:"range",min:i,max:o,step:m,value:l,onChange:f=>r(parseFloat(f.target.value)),className:"w-full h-1 bg-subtle-fill rounded appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:bg-sys-blue [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer"})]})}),Ge=u.memo(function({label:n,checked:l,onChange:r}){return e.jsxs(ca,{className:"flex items-center justify-between",children:[e.jsx(da,{className:"text-[10px] text-fg-muted cursor-pointer select-none",children:n}),e.jsx(ka,{enabled:l,onChange:r,size:"sm"})]})});function Hr(){var Es,Fs,Ms,Ts,As,Hs,Is,Os,Bs,Ps,zs,Gs,$s,_s,Ws;Ra(Mn);const s=xa(),[n,l]=u.useState(!1),[r,i]=u.useState(!1),o=u.useRef(!1);u.useEffect(()=>{!s||o.current||(o.current=!0,i(!0))},[s]);const m=u.useCallback(()=>{i(!1),l(!0)},[]),a=pa(),x=ga(),p=ei(x,2e3),b=fa(),v=ba(),h=va(),d=ya(),f=ja(),y=Na(),C=wa(),D=C?Hn:In,w=C?cr:dr,I=u.useMemo(()=>ur(C),[C]),P=u.useMemo(()=>mr(C),[C]),[A,_]=u.useState(!0),[T,V]=u.useState(null),[oe,ee]=u.useState(null),[le,rt]=u.useState(!1),[ne,Ce]=u.useState(""),[ce,H]=u.useState(!1),[de,K]=u.useState(!1),[xe,Me]=u.useState("simulation"),[ue,Te]=u.useState(!0),[Ze,Ve]=u.useState(!1),[Se,Lt]=u.useState(!0),[ot,Ae]=u.useState(!1),[ke,On]=u.useState(!1),[ye,Yt]=u.useState(new Set),[je,Bn]=u.useState(!1),[be,Pn]=u.useState("spectral"),[lt,qt]=u.useState(1),[ct,Qt]=u.useState(1),[He,Jt]=u.useState(!1),[dt,Le]=u.useState(null),[es,Rt]=u.useState(!1),[Re,zn]=u.useState(!1),[Ke,Ue]=u.useState(null),[Xe,Dt]=u.useState(null),[Ie,Et]=u.useState(null),[Ye,Ft]=u.useState(null),[Oe,qe]=u.useState(null),Be=Ca(),[ts,ss]=u.useState(!1),[Pe,ns]=u.useState([]),[Mt,as]=u.useState(0),[Gn,is]=u.useState(null),Tt=u.useRef(new _i),At=u.useRef(null),W=u.useRef(null),[Ht,rs]=u.useState(null),[os,ls]=u.useState(null),[cs,ds]=u.useState({}),[O,us]=u.useState({simulationDecay:E.simulationDecay,simulationGravity:E.simulationGravity,simulationCenter:E.simulationCenter,simulationRepulsion:E.simulationRepulsion,simulationRepulsionTheta:E.simulationRepulsionTheta,simulationLinkSpring:E.simulationLinkSpring,simulationLinkDistance:E.simulationLinkDistance,simulationFriction:E.simulationFriction,simulationRepulsionFromMouse:E.simulationRepulsionFromMouse,pointSizeScale:E.pointSizeScale,pointOpacity:E.pointOpacity,pointGreyoutOpacity:E.pointGreyoutOpacity,linkWidthScale:E.linkWidthScale,linkOpacity:E.linkOpacity,linkGreyoutOpacity:E.linkGreyoutOpacity,curvedLinks:E.curvedLinks,curvedLinkWeight:E.curvedLinkWeight,linkDefaultArrows:E.linkDefaultArrows,linkArrowsSizeScale:E.linkArrowsSizeScale,scalePointsOnZoom:E.scalePointsOnZoom,scaleLinksOnZoom:E.scaleLinksOnZoom,renderLinks:E.renderLinks,renderHoveredPointRing:E.renderHoveredPointRing,spaceSize:E.spaceSize}),z=u.useCallback((t,c)=>{us(g=>({...g,[t]:c}))},[]),$n=u.useCallback(()=>{us({simulationDecay:E.simulationDecay,simulationGravity:E.simulationGravity,simulationCenter:E.simulationCenter,simulationRepulsion:E.simulationRepulsion,simulationRepulsionTheta:E.simulationRepulsionTheta,simulationLinkSpring:E.simulationLinkSpring,simulationLinkDistance:E.simulationLinkDistance,simulationFriction:E.simulationFriction,simulationRepulsionFromMouse:E.simulationRepulsionFromMouse,pointSizeScale:E.pointSizeScale,pointOpacity:E.pointOpacity,pointGreyoutOpacity:E.pointGreyoutOpacity,linkWidthScale:E.linkWidthScale,linkOpacity:E.linkOpacity,linkGreyoutOpacity:E.linkGreyoutOpacity,curvedLinks:E.curvedLinks,curvedLinkWeight:E.curvedLinkWeight,linkDefaultArrows:E.linkDefaultArrows,linkArrowsSizeScale:E.linkArrowsSizeScale,scalePointsOnZoom:E.scalePointsOnZoom,scaleLinksOnZoom:E.scaleLinksOnZoom,renderLinks:E.renderLinks,renderHoveredPointRing:E.renderHoveredPointRing,spaceSize:E.spaceSize})},[]);u.useEffect(()=>()=>{var t;try{(t=W.current)==null||t.destroy()}catch{}W.current=null},[]),u.useEffect(()=>{const t=c=>{var g,N;if(!(c.target instanceof HTMLInputElement||c.target instanceof HTMLSelectElement))switch(c.key.toLowerCase()){case"f":!c.metaKey&&!c.ctrlKey&&(c.preventDefault(),(g=W.current)==null||g.fitView(Ct));break;case"escape":ce?(H(!1),Ce("")):T&&(V(null),(N=W.current)==null||N.unselectAllPoints());break;case"/":ce||(c.preventDefault(),H(!0),setTimeout(()=>{var j;return(j=At.current)==null?void 0:j.focus()},50));break;case" ":c.preventDefault(),W.current&&(A?W.current.pause():W.current.start(),_(j=>!j));break;case"l":Te(j=>!j);break}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[ce,T,A]);const It=u.useMemo(()=>new Set((a==null?void 0:a.backboneEdges)??[]),[a==null?void 0:a.backboneEdges]),ut=u.useMemo(()=>({resolution:lt,kWeight:ct}),[lt,ct]),De=u.useMemo(()=>{if(be!=="louvain")return null;const t=a==null?void 0:a.edges;if(!t||t.length===0||!p||p.size<3)return null;const c=Array.from(p.keys());return an(t,c,ut).communities},[be,a==null?void 0:a.edges,p,ut]),pe=u.useMemo(()=>{var j;if(!p||p.size===0||!n)return[];const t=[],c=(y==null?void 0:y.node_name)??((j=y==null?void 0:y.config)==null?void 0:j.node_name)??null,g=C?"#171717":"#EFF0F1";let N=1;for(const M of p.values())M.degree>N&&(N=M.degree);for(const M of p.values()){const S=M,R=S.degree>0?Math.log10(S.degree+1)/Math.log10(N+1):0,q=un+Math.min(1,R)*(_t-un),Q=S.betweenness*mn,ie=S.isLocal?_t:Math.min(_t+mn,q+Q),re=(De==null?void 0:De.get(S.hash))??S.communityId,B=je&&re>=0?w[re%w.length]:D[S.nodeClass],k=lr[S.activityLevel]??1,G=S.isLocal?D.local:k<1?Wt(B,g,k):B,st=S.isLocal?c??S.name:S.name;t.push({id:S.hash,label:st?`${S.prefix} ${st}`:S.prefix,color:G,size:ie,nodeClass:S.nodeClass,name:st,prefix:S.prefix,packetCount:S.packetCount,isLocal:S.isLocal,isHub:S.isHub,isGateway:S.isGateway,isBackbone:S.isBackbone,isMobile:S.isMobile,isZeroHop:S.isZeroHop,isGhost:S.isGhost,degree:S.degree,betweenness:S.betweenness,communityId:(De==null?void 0:De.get(S.hash))??S.communityId,activityLevel:S.activityLevel,prefixConfidence:S.prefixConfidence,hasCollision:S.hasCollision,inDegree:S.inDegree,outDegree:S.outDegree,isInLoop:S.isInLoop,avgRssi:S.avgRssi,avgSnr:S.avgSnr})}for(const M of b){const S=`ghost-${M.prefix}`;if(t.some(q=>q.id===S))continue;const R=Wt(D.ghost,g,.6);t.push({id:S,label:`? ${M.prefix.toUpperCase()}`,color:R,size:or,nodeClass:"ghost",name:null,prefix:M.prefix,packetCount:M.observationCount,isLocal:!1,isHub:!1,isGateway:!1,isBackbone:!1,isMobile:!1,isZeroHop:!1,isGhost:!0,degree:M.commonNeighbors.size,betweenness:0,communityId:-1,activityLevel:"active",prefixConfidence:M.confidence,hasCollision:!1,inDegree:0,outDegree:0,isInLoop:!1,avgRssi:null,avgSnr:null})}return t},[p,n,y==null?void 0:y.node_name,(Es=y==null?void 0:y.config)==null?void 0:Es.node_name,D,C,b,w,je,be,De]),Qe=u.useMemo(()=>new Set(pe.map(t=>t.id)),[pe]),mt=u.useMemo(()=>{const t=new Map;if(!p)return t;for(const c of p.values())t.set(c.hash,c.name);return t},[p]),Ee=u.useMemo(()=>{const t=(a==null?void 0:a.edges)??[];if(!t.length||!n)return[];const c=[],g=(a==null?void 0:a.edgeBetweenness)??new Map;for(const j of t){if(!Qe.has(j.fromHash)||!Qe.has(j.toHash))continue;const M=xr(j,It),S=xn(M,j.avgConfidence,C),R=g.get(j.key)??0,q=R>0?.5+R*4:.5+Math.min(1,j.certainCount/50)*2;c.push({source:j.fromHash,target:j.toHash,color:S,width:q,key:j.key,packetCount:j.packetCount,certainCount:j.certainCount,confidence:j.avgConfidence,symmetryRatio:j.symmetryRatio,dominantDirection:j.dominantDirection,isBackbone:It.has(j.key),isLoopEdge:j.isLoopEdge??!1,isDirectPath:j.isDirectPathEdge,isZeroHop:j.isZeroHop??!1,isGhost:!1,forwardCount:j.forwardCount,reverseCount:j.reverseCount,floodCount:j.floodCount,directCount:j.directCount,avgRssi:j.avgRssi??null,avgSnr:j.avgSnr??null,strength:j.strength,fromName:mt.get(j.fromHash)??null,toName:mt.get(j.toHash)??null,edgeType:M})}const N=C?Tn:An;for(const j of b){const M=`ghost-${j.prefix}`;if(Qe.has(M))for(const S of j.commonNeighbors)Qe.has(S)&&c.push({source:M,target:S,color:N.ghost,width:.4,key:`ghost-${j.prefix}-${S}`,packetCount:j.observationCount,certainCount:0,confidence:j.confidence,symmetryRatio:0,dominantDirection:"balanced",isBackbone:!1,isLoopEdge:!1,isDirectPath:!1,isZeroHop:!1,isGhost:!0,forwardCount:0,reverseCount:0,floodCount:0,directCount:0,avgRssi:null,avgSnr:null,strength:j.confidence,fromName:null,toName:mt.get(S)??null,edgeType:"ghost"})}return c},[a==null?void 0:a.edges,a==null?void 0:a.edgeBetweenness,n,Qe,C,It,mt,b]),ze=(Ms=(Fs=y==null?void 0:y.config)==null?void 0:Fs.radio)==null?void 0:Ms.frequency,ge=(As=(Ts=y==null?void 0:y.config)==null?void 0:Ts.radio)==null?void 0:As.bandwidth,ht=(Is=(Hs=y==null?void 0:y.config)==null?void 0:Hs.radio)==null?void 0:Is.spreading_factor,Ot=(Bs=(Os=y==null?void 0:y.config)==null?void 0:Os.radio)==null?void 0:Bs.tx_power,xt=(zs=(Ps=y==null?void 0:y.config)==null?void 0:Ps.radio)==null?void 0:zs.coding_rate,te=u.useMemo(()=>{if(!a||!Re)return null;const t={frequency:ze,bandwidth:Ie!=null?Ie*1e3:ge,spreading_factor:Xe??ht,tx_power:Ke??Ot,coding_rate:Ye??xt},c={};return Oe!=null&&(c.sensitivityOverrideDbm=Oe),Be!=null&&(c.observedNoiseFloorDbm=Be),Ti(a,t,c)},[a,Re,ze,ge,ht,Ot,xt,Ke,Xe,Ie,Ye,Oe,Be]),Je=u.useMemo(()=>{if(!te)return null;const t=new Map;for(const c of te)t.set(c.edgeKey,c);return t},[te]),fe=u.useMemo(()=>!te||te.length===0?null:Ai(te),[te]),Bt=u.useMemo(()=>{if(!Re||!Je)return Ee;const t=C?"#303038":"#D0D0D8";return Ee.map(c=>{const g=Je.get(c.key);return!g||!g.hasData?{...c,color:t,width:.3}:{...c,color:Ii(g,"margin"),width:Oi(g),linkBudget:g}})},[Ee,Re,Je,C]),Ne=u.useMemo(()=>ye.size===0?pe:pe.filter(t=>!ye.has(t.nodeClass)),[pe,ye]),se=u.useMemo(()=>{if(ye.size===0)return Bt;const t=new Set(Ne.map(c=>c.id));return Bt.filter(c=>t.has(c.source)&&t.has(c.target))},[Bt,Ne,ye]),Pt=u.useRef([]);u.useEffect(()=>{Pt.current=se},[se]);const pt=u.useMemo(()=>{const t=new Map;for(const c of Ee)t.set(c.source,(t.get(c.source)??0)+1),t.set(c.target,(t.get(c.target)??0)+1);return t},[Ee]),me=u.useMemo(()=>{const t=new Map;for(const c of pe)t.set(c.id,c);return t},[pe]);u.useEffect(()=>{if(Ne.length===0){rs(null),ls(null),ds({});return}let t=!1;const g=setTimeout(async()=>{try{const N=Ne.map(R=>({id:R.id,label:R.label,color:R.color,size:R.size,communityId:String(R.communityId)})),j=se.map(R=>({source:R.source,target:R.target,color:R.color,width:R.width})),S=await ua({points:{pointIdBy:"id",pointColorBy:"color",pointColorStrategy:"direct",pointDefaultColor:C?"#9CA3AF":"#374151",pointLabelBy:"label",pointSizeBy:"size",pointSizeStrategy:"direct",pointDefaultSize:8,pointSizeScale:1,pointGreyoutOpacity:.3,pointIncludeColumns:["communityId"]},links:{linkSourceBy:"source",linkTargetsBy:["target"],linkColorBy:"color",linkColorStrategy:"direct",linkDefaultColor:C?"#6B7280":"#9CA3AF",linkWidthBy:"width",linkWidthStrategy:"direct",linkDefaultWidth:1,linkWidthScale:1,linkGreyoutOpacity:.1}},N,j);if(t||!S)return;console.log("[MeshGraph] Prepared data:",{points:S.points,links:S.links,config:S.cosmographConfig}),rs(S.points??null),ls(S.links??null),ds(S.cosmographConfig??{})}catch(N){console.error("[MeshGraph] Data preparation failed:",N)}},100);return()=>{t=!0,clearTimeout(g)}},[Ne,se,C]);const ms=u.useCallback(t=>{t&&(W.current=t,t.start(),setTimeout(()=>{t.fitView(Ct)},1500))},[]),_n=u.useCallback(()=>{var t;(t=W.current)==null||t.fitView(Ct)},[]),Wn=u.useCallback(()=>{const t=W.current;t&&(A?t.pause():t.start(),_(!A))},[A]),gt=u.useCallback(async t=>{const c=W.current,g=me.get(t);if(g){if(c)try{const N=await c.getPointIndicesByIds([t]);N&&N.length>0&&N[0]!==void 0&&(c.zoomToPoint(N[0],ir,2.5),c.selectPoint(N[0],!1,!0))}catch{}ee(null),V({hash:t,name:g.name,prefix:g.prefix,nodeClass:g.nodeClass,packetCount:g.packetCount,edgeCount:pt.get(t)??0,degree:g.degree,betweenness:g.betweenness,communityId:g.communityId,isLocal:g.isLocal,isHub:g.isHub,isGateway:g.isGateway,isBackbone:g.isBackbone,isMobile:g.isMobile,isZeroHop:g.isZeroHop,isGhost:g.isGhost,isInLoop:g.isInLoop,activityLevel:g.activityLevel,prefixConfidence:g.prefixConfidence,hasCollision:g.hasCollision,inDegree:g.inDegree,outDegree:g.outDegree,avgRssi:g.avgRssi,avgSnr:g.avgSnr})}},[me,pt]),hs=u.useRef(null);u.useEffect(()=>{hs.current=Je},[Je]);const xs=u.useCallback(t=>{var N;if(t===void 0){ee(null);return}const c=Pt.current[t];if(!c)return;const g=(N=hs.current)==null?void 0:N.get(c.key);ee(g&&!c.linkBudget?{...c,linkBudget:g}:c),V(null)},[]),ps=u.useCallback(async(t,c,g)=>{var j;if(t===void 0){V(null),Le(null),(j=W.current)==null||j.unselectAllPoints();return}ee(null);const N=W.current;if(N)try{const M=await N.getPointIdsByIndices([t]);if(!M||M.length===0)return;const S=M[0],R=me.get(S);if(!R)return;N.selectPoint(t,!1,!0),V({hash:S,name:R.name,prefix:R.prefix,nodeClass:R.nodeClass,packetCount:R.packetCount,edgeCount:pt.get(S)??0,degree:R.degree,betweenness:R.betweenness,communityId:R.communityId,isLocal:R.isLocal,isHub:R.isHub,isGateway:R.isGateway,isBackbone:R.isBackbone,isMobile:R.isMobile,isZeroHop:R.isZeroHop,isGhost:R.isGhost,isInLoop:R.isInLoop,activityLevel:R.activityLevel,prefixConfidence:R.prefixConfidence,hasCollision:R.hasCollision,inDegree:R.inDegree,outDegree:R.outDegree,avgRssi:R.avgRssi,avgSnr:R.avgSnr})}catch{}},[me,pt]),et=u.useMemo(()=>{if(!ce||!ne.trim())return[];const t=ne.toLowerCase();return pe.filter(c=>{var g;return c.prefix.toLowerCase().includes(t)||((g=c.name)==null?void 0:g.toLowerCase().includes(t))||c.id.toLowerCase().includes(t)}).slice(0,8)},[pe,ne,ce]),gs=u.useCallback(t=>{H(!1),Ce(""),gt(t.id)},[gt]),fs=u.useCallback(()=>{rt(t=>!t)},[]),Zn=u.useCallback(t=>{Yt(c=>{const g=new Set(c);return g.has(t)?g.delete(t):g.add(t),g})},[]),Vn=u.useCallback(()=>{Bn(t=>{const c=!t,g=W.current;return g&&g.start(.5),c})},[]),Kn=u.useCallback(()=>{Jt(t=>{const c=!t,g=W.current;return g&&(c?g.activatePolygonalSelection():(g.deactivatePolygonalSelection(),Le(null),g.unselectAllPoints())),c})},[]),bs=u.useCallback(async()=>{const t=W.current;if(!t)return;await new Promise(B=>setTimeout(B,80));const c=t.getSelectedPointIndices();if(!c||c.length===0){Le(null);return}const g=await t.getPointIdsByIndices(c);if(!g||g.length===0){Le(null);return}const N=new Set(g);let j=0,M=0;for(const B of Pt.current)N.has(B.source)&&N.has(B.target)&&(j++,M+=B.confidence);let S=0;const R={},q={};for(const B of g){const k=me.get(B);k&&(S+=k.betweenness,R[k.communityId]=(R[k.communityId]??0)+1,q[k.nodeClass]=(q[k.nodeClass]??0)+1)}const Q=new Set;for(const B of g){const k=me.get(B);k&&Q.add(k.prefix.toLowerCase())}let ie=0,re=0;for(const B of d)if(B.hops.length>=2){const k=B.hops[0].toLowerCase(),G=B.hops[B.hops.length-1].toLowerCase();Q.has(k)&&Q.has(G)&&(ie+=B.healthScore,re++)}Le({nodeCount:g.length,edgeCount:j,avgBetweenness:g.length>0?S/g.length:0,avgConfidence:j>0?M/j:0,avgPathHealth:re>0?ie/re:null,communities:R,nodeClasses:q}),V(null),ee(null)},[me,d]),vs=u.useCallback(()=>{var t;Le(null),(t=W.current)==null||t.unselectAllPoints()},[]),ys=u.useMemo(()=>{var B;if(!T)return null;const t=T.hash,c=new Set;for(const k of se)k.source===t?c.add(k.target):k.target===t&&c.add(k.source);if(c.size===0)return{clusteringCoeff:0,avgNeighborBetweenness:0,neighborCount:0,avgEdgeConfidence:0,avgRssi:null,avgSnr:null};let g=0;for(const k of se)c.has(k.source)&&c.has(k.target)&&g++;const N=c.size,j=N>1?2*g/(N*(N-1)):0;let M=0;for(const k of c)M+=((B=me.get(k))==null?void 0:B.betweenness)??0;let S=0,R=0,q=0,Q=0,ie=0,re=0;for(const k of se)(k.source===t||k.target===t)&&(S+=k.confidence,R++,k.avgRssi!=null&&(q+=k.avgRssi,Q++),k.avgSnr!=null&&(ie+=k.avgSnr,re++));return{clusteringCoeff:Math.min(1,j),avgNeighborBetweenness:M/N,neighborCount:N,avgEdgeConfidence:R>0?S/R:0,avgRssi:Q>0?q/Q:null,avgSnr:re>0?ie/re:null}},[T,se,me]),js=u.useMemo(()=>!T||!f?null:f.get(T.hash)??null,[T,f]),Ns=u.useMemo(()=>{if(!T)return[];const t=T.hash,c=[],g=new Set;for(const N of se){let j=null;if(N.source===t?j=N.target:N.target===t&&(j=N.source),!j||g.has(j))continue;g.add(j);const M=me.get(j);c.push({hash:j,prefix:(M==null?void 0:M.prefix)??j.slice(2,4).toUpperCase(),name:(M==null?void 0:M.name)??null,edgeConfidence:N.confidence,edgeType:N.edgeType,avgRssi:N.avgRssi,avgSnr:N.avgSnr})}return c.sort((N,j)=>j.edgeConfidence-N.edgeConfidence),c},[T,se,me]),ws=u.useCallback(async()=>{const t=W.current;if(!t||!T)return;const c=await t.getPointIndicesByIds([T.hash]);if(!c||c[0]===void 0)return;const g=c[0],N=t.getConnectedPointIndices(g)??[],j=new Set([g,...N]);for(const S of N){const R=t.getConnectedPointIndices(S)??[];for(const q of R)j.add(q)}const M=Array.from(j);t.selectPoints(M),t.fitViewByIndices(M,Ct,.15)},[T]);u.useEffect(()=>{if(!He)return;const t=c=>{var g,N;c.key==="Escape"&&(Jt(!1),(g=W.current)==null||g.deactivatePolygonalSelection(),Le(null),(N=W.current)==null||N.unselectAllPoints())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[He]);const Un=u.useCallback((t,c)=>{a&&(vi(a,{format:t,dataset:c}),Rt(!1))},[a]),Y=u.useMemo(()=>{if(!a||!d.length)return null;const t=a.edges??[];return t.length===0?null:tr(d,t)},[a,d]),we=u.useMemo(()=>{const t=a==null?void 0:a.edges;if(!t||t.length===0||!p||p.size<3)return null;const c=Array.from(p.keys());return Ma(t,c)},[a==null?void 0:a.edges,p]),ft=u.useMemo(()=>{if(be!=="louvain")return null;const t=a==null?void 0:a.edges;if(!t||t.length===0||!p||p.size<3)return null;const c=Array.from(p.keys());return an(t,c,ut)},[be,a==null?void 0:a.edges,p,ut]);u.useEffect(()=>{if(!a)return;const t=new Map;for(const[g,N]of a.nodeMetrics)t.set(g,N.name);const c=Tt.current.update(a,t);c.totalCount>0&&(ns(Tt.current.getLog()),as(g=>g+c.totalCount))},[a]);const Xn=u.useCallback(()=>{as(0),ss(t=>!t)},[]),ve=u.useMemo(()=>rr(we,C),[we,C]),bt=e.jsxs("div",{className:"absolute top-0 left-0 right-0 z-20 px-4 py-3 pointer-events-none flex items-start justify-between",children:[e.jsxs("h1",{className:"type-title text-fg-primary flex items-center gap-2 sm:gap-3 pointer-events-auto",children:[e.jsx(Us,{className:"w-5 h-5 sm:w-6 sm:h-6 text-icon-page-title"}),e.jsx("span",{children:"MeshGraph"}),e.jsx(X,{color:"violet",compact:!0,children:"Analytics"})]}),ve&&e.jsx(L,{content:e.jsxs("div",{className:"max-w-xs space-y-2",children:[e.jsx("div",{className:"font-semibold text-fg-primary",children:"Mesh Resilience Score"}),e.jsx("div",{className:"text-fg-secondary",children:"Derived from the Fiedler eigenvalue (λ₂) — the second-smallest eigenvalue of the graph Laplacian. Measures how well-connected the mesh is and how resistant it is to partitioning."}),e.jsxs("div",{className:"space-y-0.5 font-mono text-[10px]",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-fg-muted",children:"Raw λ₂"}),e.jsx("span",{className:"text-fg-primary tabular-nums",children:(we==null?void 0:we.toFixed(6))??"—"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-fg-muted",children:"Score"}),e.jsxs("span",{className:"tabular-nums",style:{color:ve.color},children:[ve.score,"/100"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-fg-muted",children:"Grade"}),e.jsx("span",{className:"capitalize",style:{color:ve.color},children:ve.grade})]})]}),e.jsxs("div",{className:"pt-1 border-t border-edge-subtle/30 space-y-0.5 text-[10px]",children:[e.jsx("div",{className:"text-fg-muted font-medium",children:"Grade thresholds"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:$e.excellent[0]},children:"Excellent"}),e.jsx("span",{className:"text-fg-muted tabular-nums",children:"80-100 (λ₂ > 0.3)"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:$e.good[0]},children:"Good"}),e.jsx("span",{className:"text-fg-muted tabular-nums",children:"55-79 (λ₂ 0.03-0.3)"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:$e.fair[0]},children:"Fair"}),e.jsx("span",{className:"text-fg-muted tabular-nums",children:"30-54 (λ₂ 0.003-0.03)"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:$e.poor[0]},children:"Poor"}),e.jsx("span",{className:"text-fg-muted tabular-nums",children:"10-29 (λ₂ 0.0001-0.003)"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:$e.critical[0]},children:"Critical"}),e.jsx("span",{className:"text-fg-muted tabular-nums",children:"<10 (λ₂ ≈ 0)"})]})]}),e.jsx("div",{className:"text-[10px] text-fg-muted italic",children:"Near-zero λ₂ = one bridge away from network partition. Log-scale mapping: small λ₂ changes at low values have outsized impact."})]}),children:e.jsxs("div",{className:"pointer-events-auto surface-control radius-inner px-3 py-1.5 flex items-center gap-2 cursor-help",children:[e.jsxs("div",{className:"flex items-baseline gap-1.5",children:[e.jsx("span",{className:"text-[10px] text-fg-muted uppercase tracking-wider",children:"Resilience"}),e.jsx("span",{className:"text-lg font-semibold tabular-nums leading-none",style:{color:ve.color},children:ve.score})]}),e.jsx("div",{className:"w-12 h-1.5 rounded-full bg-subtle-fill overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${ve.score}%`,backgroundColor:ve.color}})})]})})]}),ae=(t,c=!1)=>{const g="flex flex-col items-center gap-0.5 px-1.5 py-1 radius-inner transition-all duration-100 active:scale-95";return t&&c?`${g} bg-status-warning/15 text-status-warning shadow-inner`:t?`${g} bg-sys-blue/20 text-sys-blue shadow-inner`:`${g} hover:bg-white/5 hover:scale-105 text-fg-secondary`},tt=e.jsx("div",{className:"w-px h-6 bg-border-subtle/40 mx-0.5 shrink-0"}),Cs=e.jsxs("div",{className:"absolute top-12 right-3 z-10 flex items-center gap-0.5 surface-control radius-inner px-1.5 py-1",children:[e.jsx(L,{content:"Visible nodes / edges in the graph",children:e.jsxs("span",{className:"text-[9px] text-fg-muted tabular-nums mr-1.5 leading-none cursor-help",children:[Ne.length,e.jsx("br",{}),se.length]})}),tt,e.jsx(L,{content:ue?"Hide labels (L)":"Show labels (L)",children:e.jsxs("button",{onClick:()=>Te(t=>!t),className:ae(!ue,!0),children:[ue?e.jsx(Ba,{className:"w-3.5 h-3.5"}):e.jsx(Pa,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Lbl"})]})}),e.jsx(L,{content:je?"Disable clustering":"Community clustering",children:e.jsxs("button",{onClick:Vn,className:ae(je),children:[e.jsx(za,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Grp"})]})}),e.jsx(L,{content:He?"Exit lasso (Esc)":"Lasso selection",children:e.jsxs("button",{onClick:Kn,className:ae(He,!0),children:[e.jsx(jn,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Sel"})]})}),tt,e.jsx(L,{content:"Legend",children:e.jsxs("button",{onClick:()=>Ve(t=>!t),className:ae(Ze),children:[e.jsx(Xs,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Map"})]})}),e.jsx(L,{content:"Search (/)",children:e.jsxs("button",{onClick:()=>{H(!0),setTimeout(()=>{var t;return(t=At.current)==null?void 0:t.focus()},50)},className:ae(ce),children:[e.jsx(Ys,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Fnd"})]})}),tt,e.jsx(L,{content:A?"Pause (Space)":"Play (Space)",children:e.jsxs("button",{onClick:Wn,className:ae(!A),children:[A?e.jsx(Ga,{className:"w-3.5 h-3.5 text-sys-green"}):e.jsx($a,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:A?"Run":"Stop"})]})}),e.jsx(L,{content:"Fit view (F)",children:e.jsxs("button",{onClick:_n,className:ae(!1),children:[e.jsx(_a,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Fit"})]})}),tt,e.jsx(L,{content:Re?"Disable link budget":"Link budget overlay",children:e.jsxs("button",{onClick:()=>zn(t=>!t),className:ae(Re),children:[e.jsx(Zt,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"RF"})]})}),e.jsx(L,{content:"Anomaly log",children:e.jsxs("button",{onClick:Xn,className:`relative ${ae(ts,!0)}`,children:[e.jsx(yt,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Alert"}),Mt>0&&e.jsx("span",{className:"absolute -top-1 -right-0.5 w-3 h-3 rounded-full bg-status-danger text-[7px] font-bold text-white flex items-center justify-center",children:Mt>9?"9+":Mt})]})}),e.jsx(L,{content:"Export topology",children:e.jsxs("button",{onClick:()=>Rt(t=>!t),className:ae(es),children:[e.jsx(qs,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Exp"})]})}),e.jsx(L,{content:"Settings",children:e.jsxs("button",{onClick:()=>K(t=>!t),className:ae(de),children:[e.jsx(Qs,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Cfg"})]})}),tt,e.jsx(L,{content:le?"Exit fullscreen":"Fullscreen",children:e.jsxs("button",{onClick:fs,className:ae(le),children:[le?e.jsx(Js,{className:"w-3.5 h-3.5"}):e.jsx(yn,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[7px] uppercase tracking-wider leading-none",children:"Max"})]})})]}),Ss=e.jsxs(wt,{id:"settings",title:"Graph Settings",icon:e.jsx(Qs,{}),open:de,onClose:()=>K(!1),defaultPosition:{x:typeof window<"u"?window.innerWidth-308:600,y:60},defaultSize:{width:288,height:420},minSize:{width:260,height:200},maxSize:{width:400,height:600},headerActions:e.jsx(L,{content:"Reset to defaults",children:e.jsx("button",{onClick:$n,className:"p-0.5 radius-badge hover-bg transition-base",children:e.jsx(en,{className:"w-2.5 h-2.5 text-fg-muted"})})}),children:[e.jsx("div",{className:"flex border-b border-edge-subtle",children:["simulation","points","links","rendering"].map(t=>e.jsx("button",{onClick:()=>Me(t),className:`flex-1 px-2 py-1.5 text-[10px] font-medium capitalize transition-colors ${xe===t?"text-sys-blue border-b-2 border-sys-blue":"text-fg-muted hover:text-fg-secondary"}`,children:t},t))}),e.jsxs("div",{className:"p-3 space-y-3",children:[xe==="simulation"&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{label:"Gravity",value:O.simulationGravity,onChange:t=>z("simulationGravity",t),min:0,max:1,step:.01}),e.jsx(Z,{label:"Repulsion",value:O.simulationRepulsion,onChange:t=>z("simulationRepulsion",t),min:0,max:5,step:.1}),e.jsx(Z,{label:"Link Spring",value:O.simulationLinkSpring,onChange:t=>z("simulationLinkSpring",t),min:0,max:2,step:.05}),e.jsx(Z,{label:"Link Distance",value:O.simulationLinkDistance,onChange:t=>z("simulationLinkDistance",t),min:1,max:100,step:1}),e.jsx(Z,{label:"Friction",value:O.simulationFriction,onChange:t=>z("simulationFriction",t),min:0,max:1,step:.01}),e.jsx(Z,{label:"Center Force",value:O.simulationCenter,onChange:t=>z("simulationCenter",t),min:0,max:1,step:.01}),e.jsx(Z,{label:"Decay",value:O.simulationDecay,onChange:t=>z("simulationDecay",t),min:100,max:2e4,step:100}),e.jsx(Z,{label:"Repulsion Theta",value:O.simulationRepulsionTheta,onChange:t=>z("simulationRepulsionTheta",t),min:.1,max:3,step:.05}),e.jsx(Z,{label:"Mouse Repulsion",value:O.simulationRepulsionFromMouse,onChange:t=>z("simulationRepulsionFromMouse",t),min:0,max:10,step:.5})]}),xe==="points"&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{label:"Size Scale",value:O.pointSizeScale,onChange:t=>z("pointSizeScale",t),min:.1,max:5,step:.1}),e.jsx(Z,{label:"Opacity",value:O.pointOpacity,onChange:t=>z("pointOpacity",t),min:0,max:1,step:.05}),e.jsx(Z,{label:"Greyout Opacity",value:O.pointGreyoutOpacity,onChange:t=>z("pointGreyoutOpacity",t),min:0,max:1,step:.05}),e.jsx(Ge,{label:"Scale on Zoom",checked:O.scalePointsOnZoom,onChange:t=>z("scalePointsOnZoom",t)}),e.jsx(Ge,{label:"Hover Ring",checked:O.renderHoveredPointRing,onChange:t=>z("renderHoveredPointRing",t)})]}),xe==="links"&&e.jsxs(e.Fragment,{children:[e.jsx(Ge,{label:"Show Links",checked:O.renderLinks,onChange:t=>z("renderLinks",t)}),e.jsx(Ge,{label:"Curved Links",checked:O.curvedLinks,onChange:t=>z("curvedLinks",t)}),e.jsx(Ge,{label:"Show Arrows",checked:O.linkDefaultArrows,onChange:t=>z("linkDefaultArrows",t)}),e.jsx(Z,{label:"Width Scale",value:O.linkWidthScale,onChange:t=>z("linkWidthScale",t),min:.1,max:5,step:.1}),e.jsx(Z,{label:"Opacity",value:O.linkOpacity,onChange:t=>z("linkOpacity",t),min:0,max:1,step:.05}),e.jsx(Z,{label:"Greyout Opacity",value:O.linkGreyoutOpacity,onChange:t=>z("linkGreyoutOpacity",t),min:0,max:1,step:.05}),O.curvedLinks&&e.jsx(Z,{label:"Curve Weight",value:O.curvedLinkWeight,onChange:t=>z("curvedLinkWeight",t),min:0,max:1,step:.05}),O.linkDefaultArrows&&e.jsx(Z,{label:"Arrow Size",value:O.linkArrowsSizeScale,onChange:t=>z("linkArrowsSizeScale",t),min:.1,max:3,step:.1}),e.jsx(Ge,{label:"Scale on Zoom",checked:O.scaleLinksOnZoom,onChange:t=>z("scaleLinksOnZoom",t)})]}),xe==="rendering"&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{label:"Space Size",value:O.spaceSize,onChange:t=>z("spaceSize",t),min:1024,max:16384,step:512}),e.jsx("div",{className:"pt-2 border-t border-edge-subtle/50",children:e.jsx("p",{className:"text-[9px] text-fg-muted",children:"Space size defines the simulation boundary. Larger values allow more spread."})})]})]})]}),Yn=[{label:"Full Topology (JSON)",format:"json",dataset:"full",desc:"All data: nodes, edges, paths, TX delay"},{label:"Gephi Graph (GEXF)",format:"gexf",dataset:"full",desc:"Import into Gephi for advanced analysis"},{label:"Nodes (CSV)",format:"csv",dataset:"nodes",desc:"Node metrics: centrality, class, signal"},{label:"Edges (CSV)",format:"csv",dataset:"edges",desc:"Edge metrics: confidence, symmetry, type"},{label:"Path Health (CSV)",format:"csv",dataset:"pathHealth",desc:"Route health scores and trends"},{label:"TX Delay (CSV)",format:"csv",dataset:"txDelay",desc:"TX delay recommendations per node"}],ks=e.jsxs(wt,{id:"export",title:"Export Topology",icon:e.jsx(qs,{}),open:es,onClose:()=>Rt(!1),defaultPosition:{x:typeof window<"u"?window.innerWidth-280:600,y:100},defaultSize:{width:256,height:320},minSize:{width:220,height:150},autoHeight:!0,children:[e.jsx("div",{className:"py-1",children:Yn.map(({label:t,format:c,dataset:g,desc:N})=>e.jsxs("button",{onClick:()=>Un(c,g),className:"w-full flex flex-col px-3 py-2 text-left hover-bg transition-base",children:[e.jsx("span",{className:"text-[11px] font-medium text-fg-primary",children:t}),e.jsx("span",{className:"text-[9px] text-fg-muted",children:N})]},`${c}-${g}`))}),e.jsx("div",{className:"px-3 py-1.5 border-t border-edge-subtle",children:e.jsxs("span",{className:"text-[9px] text-fg-muted",children:[((Gs=a==null?void 0:a.nodeMetrics)==null?void 0:Gs.size)??0," nodes · ",(($s=a==null?void 0:a.validatedEdges)==null?void 0:$s.length)??0," edges"]})})]}),qn={info:{dot:"bg-sys-blue",text:"text-fg-secondary"},warning:{dot:"bg-status-warning",text:"text-status-warning"},critical:{dot:"bg-status-danger",text:"text-status-danger"}},Qn={"edge-appeared":"Link Discovered","edge-disappeared":"Link Lost","ghost-appeared":"Ghost Discovered","ghost-disappeared":"Ghost Resolved","betweenness-shift":"Traffic Rerouting","community-change":"Community Change","class-change":"Role Change","node-appeared":"Node Appeared","node-disappeared":"Node Dropped","snr-degradation":"SNR Degradation","asymmetry-shift":"Asymmetry Shift"},U=(t,c,g)=>c==null||c===""?null:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx("span",{className:"text-fg-muted",children:t}),e.jsx("span",{className:`tabular-nums text-right ${g??"text-fg-secondary"}`,children:c})]}),Jn=t=>{const c=[];return t.isZeroHop&&c.push({label:"Zero-Hop",color:"text-status-warning"}),t.isDirectPath&&c.push({label:"Direct",color:"text-sys-blue"}),t.isBackbone&&c.push({label:"Backbone",color:"text-fg-primary"}),t.isLoop&&c.push({label:"Loop",color:"text-sys-indigo"}),c.length===0?null:e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:c.map(g=>e.jsx("span",{className:`text-[8px] font-medium uppercase tracking-wider px-1 py-px radius-badge bg-subtle-fill ${g.color}`,children:g.label},g.label))})},ea=(t,c)=>e.jsxs("div",{className:"text-[9px] space-y-0.5",children:[(t.fromClass||t.toClass)&&e.jsxs("div",{className:"flex items-center gap-1 text-fg-muted",children:[e.jsx("span",{className:"capitalize",children:t.fromClass??"?"}),e.jsx("span",{className:"text-fg-muted/40",children:"↔"}),e.jsx("span",{className:"capitalize",children:t.toClass??"?"})]}),c==="edge-appeared"&&t.packetCount>0&&e.jsxs(e.Fragment,{children:[U("Packets",t.packetCount),U("Confidence",`${(t.confidence*100).toFixed(0)}%`,t.confidence>=.8?"text-sys-green":t.confidence>=.5?"text-sys-indigo":"text-signal-poor"),U("Symmetry",`${(t.symmetryRatio*100).toFixed(0)}%`)]}),t.isZeroHop&&t.avgRssi!=null&&U("RSSI",`${t.avgRssi.toFixed(0)} dBm`),t.isZeroHop&&t.avgSnr!=null&&U("SNR",`${t.avgSnr.toFixed(1)} dB`),t.fromBetweenness!=null&&t.fromBetweenness>.01&&U(`${t.fromName??"A"} centrality`,t.fromBetweenness.toFixed(3)),t.toBetweenness!=null&&t.toBetweenness>.01&&U(`${t.toName??"B"} centrality`,t.toBetweenness.toFixed(3)),Jn(t)]}),ta=t=>e.jsxs("div",{className:"text-[9px] space-y-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"capitalize font-medium text-fg-secondary",children:t.nodeClass}),t.isZeroHop&&e.jsx("span",{className:"text-[8px] font-medium uppercase tracking-wider px-1 py-px radius-badge bg-subtle-fill text-status-warning",children:"Neighbor"})]}),U("Degree",t.degree),t.betweenness>.01&&U("Betweenness",t.betweenness.toFixed(3)),U("Packets",t.packetCount),U("Community",`#${t.communityId}`),U("Activity",t.activityLevel),t.avgRssi!=null&&U("RSSI",`${t.avgRssi.toFixed(0)} dBm`),t.avgSnr!=null&&U("SNR",`${t.avgSnr.toFixed(1)} dB`)]}),sa=t=>e.jsxs("div",{className:"text-[9px] space-y-0.5",children:[t.previousValue!=null&&t.currentValue!=null&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-fg-muted font-mono",children:typeof t.previousValue=="number"?t.previousValue.toFixed(3):t.previousValue}),e.jsx("span",{className:"text-fg-muted/40",children:"→"}),e.jsx("span",{className:"text-fg-secondary font-mono",children:typeof t.currentValue=="number"?t.currentValue.toFixed(3):t.currentValue}),typeof t.previousValue=="number"&&typeof t.currentValue=="number"&&e.jsxs("span",{className:t.currentValue>t.previousValue?"text-sys-green":"text-signal-poor",children:["(",t.currentValue>t.previousValue?"+":"",(t.currentValue-t.previousValue).toFixed(3),")"]})]}),t.nodeDetail&&e.jsxs(e.Fragment,{children:[U("Class",t.nodeDetail.nodeClass),U("Degree",t.nodeDetail.degree),t.nodeDetail.betweenness>.01&&U("Betweenness",t.nodeDetail.betweenness.toFixed(3))]})]}),na=u.useCallback(t=>{is(c=>c===t?null:t)},[]),Ls=e.jsxs(wt,{id:"anomaly",title:"Anomaly Log",icon:e.jsx(yt,{}),open:ts,onClose:()=>ss(!1),defaultPosition:{x:typeof window<"u"?window.innerWidth-328:600,y:100},defaultSize:{width:308,height:400},minSize:{width:260,height:180},maxSize:{width:440,height:700},headerActions:Pe.length>0?e.jsx("button",{onClick:()=>{Tt.current.clear(),ns([]),is(null)},className:"p-0.5 radius-badge hover-bg transition-base",title:"Clear all",children:e.jsx(en,{className:"w-2.5 h-2.5 text-fg-muted"})}):void 0,children:[Pe.length===0?e.jsxs("div",{className:"px-3 py-6 text-center",children:[e.jsx(yt,{className:"w-5 h-5 text-fg-muted mx-auto mb-1.5"}),e.jsx("p",{className:"text-[11px] text-fg-muted",children:"No anomalies detected yet"}),e.jsx("p",{className:"text-[9px] text-fg-muted/60 mt-0.5",children:"Changes appear after topology recomputes"})]}):e.jsx("div",{className:"overflow-y-auto",children:Pe.slice(0,50).map(t=>{const c=qn[t.severity],g=Sa(t.detectedAt/1e3),N=Gn===t.id,j=!!(t.edgeDetail||t.nodeDetail||t.previousValue!=null);return e.jsxs("div",{className:`border-b border-edge-subtle/50 last:border-0 transition-colors ${j?"cursor-pointer hover-bg":""} ${N?"bg-subtle-fill/50":""}`,onClick:j?()=>na(t.id):void 0,children:[e.jsxs("div",{className:"flex items-start gap-2 px-3 py-1.5",children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full shrink-0 mt-1.5 ${c.dot}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-[10px] leading-tight ${c.text}`,children:t.description}),e.jsxs("p",{className:"text-[9px] text-fg-muted/60 mt-0.5",children:[Qn[t.category]??t.category," · ",g]})]}),j&&e.jsx(nt,{className:`w-3 h-3 text-fg-muted/40 shrink-0 mt-0.5 transition-transform duration-150 ${N?"rotate-180":""}`})]}),N&&e.jsx("div",{className:"px-3 pb-2 pl-6",children:e.jsxs("div",{className:"border-l-2 border-edge-subtle/60 pl-2 py-0.5",children:[t.edgeDetail&&ea(t.edgeDetail,t.category),t.nodeDetail&&!t.edgeDetail&&(t.category==="node-appeared"||t.category==="node-disappeared")&&ta(t.nodeDetail),(t.category==="betweenness-shift"||t.category==="community-change"||t.category==="class-change")&&sa(t)]})})]},t.id)})}),Pe.length>0&&e.jsx("div",{className:"px-3 py-1.5 border-t border-edge-subtle",children:e.jsxs("span",{className:"text-[9px] text-fg-muted",children:[Pe.length," total · showing ",Math.min(Pe.length,50)]})})]}),aa=[["local","Local"],["hub","Hub"],["gateway","Gateway"],["backbone","Backbone"],["neighbor","Neighbor"],["mobile","Mobile"],["ghost","Ghost"],["standard","Standard"]],ia=[{type:"zero-hop",label:"Zero-Hop RF"},{type:"direct-path",label:"Direct Path"},{type:"loop",label:"Loop"},{type:"backbone",label:"Backbone"},{type:"standard",label:"Standard"},{type:"ghost",label:"Ghost"}],ra=u.useMemo(()=>{const t={};for(const c of Ee)t[c.edgeType]=(t[c.edgeType]??0)+1;return t},[Ee]),Rs=e.jsxs(wt,{id:"legend",title:"Legend",icon:e.jsx(Xs,{}),open:Ze,onClose:()=>Ve(!1),defaultPosition:{x:12,y:60},defaultSize:{width:224,height:400},minSize:{width:200,height:150},maxSize:{width:360,height:700},autoHeight:!0,children:[e.jsxs("div",{className:"border-b border-edge-subtle",children:[e.jsxs("button",{onClick:()=>Lt(t=>!t),className:"w-full flex items-center gap-1.5 px-3 py-1.5 text-[10px] font-medium text-fg-secondary hover-bg transition-base",children:[Se?e.jsx(nt,{className:"w-3 h-3"}):e.jsx(zt,{className:"w-3 h-3"}),"Nodes",e.jsx("span",{className:"text-fg-muted ml-auto tabular-nums",children:Ne.length})]}),Se&&e.jsx("div",{className:"px-2 pb-2 space-y-0.5",children:aa.map(([t,c])=>{const g=v[t]??0;if(g===0&&t!=="local")return null;const N=ye.has(t);return e.jsx(L,{content:hr[t],children:e.jsxs("button",{onClick:()=>Zn(t),className:`w-full flex items-center gap-2 px-2 py-1 radius-badge transition-base text-left ${N?"opacity-40":"hover-bg"}`,children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-full shrink-0",style:{backgroundColor:D[t]}}),e.jsx("span",{className:"text-[10px] text-fg-secondary flex-1",children:c}),e.jsx("span",{className:"text-[10px] text-fg-muted tabular-nums",children:g})]})},t)})})]}),e.jsxs("div",{className:"border-b border-edge-subtle",children:[e.jsxs("button",{onClick:()=>Ae(t=>!t),className:"w-full flex items-center gap-1.5 px-3 py-1.5 text-[10px] font-medium text-fg-secondary hover-bg transition-base",children:[ot?e.jsx(nt,{className:"w-3 h-3"}):e.jsx(zt,{className:"w-3 h-3"}),"Edges",e.jsx("span",{className:"text-fg-muted ml-auto tabular-nums",children:se.length})]}),ot&&e.jsx("div",{className:"px-2 pb-2 space-y-0.5",children:ia.map(({type:t,label:c})=>{const g=ra[t]??0;if(g===0)return null;const N=xn(t,.8,C);return e.jsx(L,{content:gr[t],children:e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 cursor-help",children:[e.jsx("span",{className:"w-4 h-0.5 shrink-0 rounded-full",style:{backgroundColor:N}}),e.jsx("span",{className:"text-[10px] text-fg-secondary flex-1",children:c}),e.jsx("span",{className:"text-[10px] text-fg-muted tabular-nums",children:g})]})},t)})})]}),Re&&fe&&e.jsxs("div",{className:"border-b border-edge-subtle",children:[e.jsxs("div",{className:"px-3 py-1.5 text-[10px] font-medium text-sys-green flex items-center gap-1.5",children:[e.jsx(Zt,{className:"w-3 h-3"}),"Link Budget",e.jsxs("span",{className:"text-fg-muted ml-auto tabular-nums",children:[fe.analyzedEdges+fe.rssiOnlyEdges,"/",fe.totalEdges]})]}),e.jsxs("div",{className:"px-3 pb-2 space-y-0.5",children:[(()=>{const t=ze&&ze>1e5?ze/1e6:ze||915,c=Xe??ht??12,g=Ie??(ge&&ge>1e3?ge/1e3:ge||125),N=Ye??xt??5,j=Ke??Ot??22,M=Ut(c,g,N),S=Oe??M,R=Ln(g*1e3),q=Be??R,Q=(te==null?void 0:te.filter(k=>k.isTraceEstimated).length)??0,ie=(te==null?void 0:te.filter(k=>k.isZeroHop).length)??0,re=Ke!=null||Xe!=null||Ie!=null||Ye!=null||Oe!=null,B="w-10 px-1 py-0 text-[10px] text-right tabular-nums bg-subtle-fill border border-edge-subtle rounded text-fg-secondary focus:outline-none focus:border-sys-blue";return e.jsxs("div",{className:"pb-1 mb-1 border-b border-edge-subtle space-y-0.5",children:[e.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[e.jsx("span",{className:"text-fg-muted",children:"Frequency"}),e.jsxs("span",{className:"text-fg-secondary tabular-nums",children:[t.toFixed(3)," MHz"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-[10px] gap-1",children:[e.jsx("span",{className:"text-fg-muted",children:"SF"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("select",{value:c,onChange:k=>{const G=parseInt(k.target.value,10);Dt(G===(ht??12)?null:G)},className:B+" w-12 appearance-none",children:[7,8,9,10,11,12].map(k=>e.jsxs("option",{value:k,children:["SF",k]},k))}),Xe!=null&&e.jsx("button",{onClick:()=>Dt(null),className:"text-[8px] text-sys-blue hover:underline",title:"Reset",children:"↺"})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-[10px] gap-1",children:[e.jsx("span",{className:"text-fg-muted",children:"BW"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("select",{value:g,onChange:k=>{const G=parseFloat(k.target.value),st=ge&&ge>1e3?ge/1e3:ge||125;Et(G===st?null:G)},className:B+" w-14 appearance-none",children:[62.5,125,250,500].map(k=>e.jsxs("option",{value:k,children:[k," kHz"]},k))}),Ie!=null&&e.jsx("button",{onClick:()=>Et(null),className:"text-[8px] text-sys-blue hover:underline",title:"Reset",children:"↺"})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-[10px] gap-1",children:[e.jsx("span",{className:"text-fg-muted",children:"CR"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("select",{value:N,onChange:k=>{const G=parseInt(k.target.value,10);Ft(G===(xt??5)?null:G)},className:B+" w-12 appearance-none",children:[5,6,7,8].map(k=>e.jsxs("option",{value:k,children:["4/",k]},k))}),Ye!=null&&e.jsx("button",{onClick:()=>Ft(null),className:"text-[8px] text-sys-blue hover:underline",title:"Reset",children:"↺"})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-[10px] gap-1",children:[e.jsx("span",{className:"text-fg-muted",children:"TX Power"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"number",min:1,max:36,step:1,value:j,onChange:k=>{const G=parseInt(k.target.value,10);isNaN(G)||Ue(G)},onBlur:k=>{const G=parseInt(k.target.value,10);if(isNaN(G)){Ue(null);return}Ue(Math.max(1,Math.min(36,G)))},className:B}),e.jsx("span",{className:"text-fg-muted",children:"dBm"}),Ke!=null&&e.jsx("button",{onClick:()=>Ue(null),className:"text-[8px] text-sys-blue hover:underline",title:"Reset",children:"↺"})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-[10px] gap-1",children:[e.jsx("span",{className:"text-fg-muted",children:"Sensitivity"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"number",min:-150,max:-80,step:.5,value:Math.round(S*10)/10,onChange:k=>{const G=parseFloat(k.target.value);isNaN(G)||qe(G)},onBlur:k=>{const G=parseFloat(k.target.value);if(isNaN(G)){qe(null);return}qe(Math.max(-150,Math.min(-80,G)))},className:B+" w-12"}),e.jsx("span",{className:"text-fg-muted",children:"dBm"}),Oe!=null&&e.jsx("button",{onClick:()=>qe(null),className:"text-[8px] text-sys-blue hover:underline",title:"Reset",children:"↺"})]})]}),Q>0&&e.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[e.jsx("span",{className:"text-fg-muted",children:"Noise Floor"}),e.jsxs("span",{className:`text-fg-secondary tabular-nums ${Be!=null?"":"italic text-fg-muted"}`,children:[q.toFixed(1)," dBm",Be!=null?"":" (est.)"]})]}),re&&e.jsx("button",{onClick:()=>{Ue(null),Dt(null),Et(null),Ft(null),qe(null)},className:"w-full text-[9px] text-sys-blue hover:underline text-center pt-0.5",children:"Reset all to radio config"}),(ie>0||Q>0)&&e.jsxs("div",{className:"flex items-center justify-between text-[10px] pt-0.5",children:[e.jsx("span",{className:"text-fg-muted",children:"Sources"}),e.jsxs("span",{className:"text-fg-secondary tabular-nums",children:[ie>0&&e.jsxs("span",{children:[ie," direct"]}),ie>0&&Q>0&&e.jsx("span",{className:"text-fg-muted",children:" · "}),Q>0&&e.jsxs("span",{className:"text-sys-indigo",children:[Q," trace"]})]})]})]})})(),fe.avgMarginDb!=null&&e.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[e.jsx("span",{className:"text-fg-muted",children:"Avg Margin"}),e.jsxs("span",{className:"text-fg-secondary tabular-nums",children:[fe.avgMarginDb>0?"+":"",fe.avgMarginDb.toFixed(1)," dB"]})]}),["excellent","good","fair","marginal","critical"].map(t=>{const c=fe.marginCounts[t];return c===0?null:e.jsxs("div",{className:"flex items-center gap-2 px-1 py-0.5",children:[e.jsx("span",{className:"w-3 h-0.5 shrink-0 rounded-full",style:{backgroundColor:Xt[t]}}),e.jsx("span",{className:"text-[10px] text-fg-secondary flex-1 capitalize",children:t}),e.jsx("span",{className:"text-[10px] text-fg-muted tabular-nums",children:c})]},t)}),fe.anomalousCount>0&&e.jsxs("div",{className:"flex items-center justify-between text-[10px] pt-0.5",children:[e.jsx("span",{className:"text-status-warning",children:"Anomalous"}),e.jsx("span",{className:"text-status-warning tabular-nums",children:fe.anomalousCount})]})]})]}),Y&&Y.atRiskPaths.length>0&&e.jsxs("div",{className:"border-b border-edge-subtle",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("button",{onClick:()=>On(t=>!t),className:"flex-1 flex items-center gap-1.5 px-3 py-1.5 text-[10px] font-medium text-status-warning hover-bg transition-base",children:[ke?e.jsx(nt,{className:"w-3 h-3"}):e.jsx(zt,{className:"w-3 h-3"}),"At-Risk Paths",e.jsxs("span",{className:"text-fg-muted ml-auto tabular-nums",children:[Y.criticalCount>0&&e.jsxs("span",{className:"text-status-danger",children:[Y.criticalCount,"c"]}),Y.criticalCount>0&&Y.highCount>0&&" ",Y.highCount>0&&e.jsxs("span",{className:"text-status-warning",children:[Y.highCount,"h"]}),(Y.criticalCount>0||Y.highCount>0)&&Y.moderateCount>0&&" ",Y.moderateCount>0&&e.jsxs("span",{className:"text-fg-muted",children:[Y.moderateCount,"m"]})]})]}),e.jsx(L,{content:e.jsxs("div",{className:"max-w-xs space-y-1.5",children:[e.jsx("div",{className:"font-semibold text-fg-primary",children:"Predictive Path Failure"}),e.jsx("div",{className:"text-fg-secondary text-[11px]",children:"Identifies paths at risk of failure by combining four weighted factors. Paths below the moderate threshold (35%) are not shown."}),e.jsxs("div",{className:"pt-1 border-t border-edge-subtle/30 space-y-0.5 text-[10px]",children:[e.jsx("div",{className:"text-fg-muted font-medium",children:"Factor weights"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-fg-secondary",children:"Declining usage"}),e.jsx("span",{className:"text-fg-muted tabular-nums",children:"35%"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-fg-secondary",children:"Weak link certainty"}),e.jsx("span",{className:"text-fg-muted tabular-nums",children:"30%"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-fg-secondary",children:"No alternate paths"}),e.jsx("span",{className:"text-fg-muted tabular-nums",children:"20%"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-fg-secondary",children:"Low signal margin"}),e.jsx("span",{className:"text-fg-muted tabular-nums",children:"15%"})]})]}),e.jsxs("div",{className:"pt-1 border-t border-edge-subtle/30 space-y-0.5 text-[10px]",children:[e.jsx("div",{className:"text-fg-muted font-medium",children:"Risk thresholds"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-status-danger",children:"Critical"}),e.jsx("span",{className:"text-fg-muted tabular-nums",children:"≥75% — failure likely imminent"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-status-warning",children:"High"}),e.jsx("span",{className:"text-fg-muted tabular-nums",children:"55-74% — significant risk"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-fg-muted",children:"Moderate"}),e.jsx("span",{className:"text-fg-muted tabular-nums",children:"35-54% — worth monitoring"})]})]}),e.jsxs("div",{className:"pt-1 border-t border-edge-subtle/30 text-[10px] text-fg-muted font-mono space-y-0.5",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Edges analyzed"}),e.jsx("span",{className:"tabular-nums",children:Y.edgesAnalyzed})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"With signal data"}),e.jsx("span",{className:"tabular-nums",children:Y.edgesWithSignal})]})]})]}),children:e.jsx("span",{className:"px-2 py-1.5 text-fg-muted cursor-help",children:e.jsx(yt,{className:"w-3 h-3"})})})]}),ke&&e.jsx("div",{className:"px-2 pb-2 space-y-1",children:Y.atRiskPaths.slice(0,8).map(t=>{const c=t.riskLevel==="critical"?"#EF4444":t.riskLevel==="high"?"#F97316":"#FBBF24",g=t.urgency==="imminent"?"IMM":t.urgency==="near-term"?"NEAR":"WATCH";return e.jsx(L,{content:e.jsxs("div",{className:"max-w-xs space-y-1.5",children:[e.jsx("div",{className:"font-semibold text-fg-primary font-mono text-[11px]",children:t.hops.join(" → ")}),e.jsxs("div",{className:"space-y-0.5 text-[10px]",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-fg-muted",children:"Risk score"}),e.jsxs("span",{className:"font-semibold tabular-nums",style:{color:c},children:[(t.riskScore*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-fg-muted",children:"Health score"}),e.jsxs("span",{className:"text-fg-primary tabular-nums",children:[(t.healthScore*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-fg-muted",children:"Obs. trend"}),e.jsxs("span",{className:`tabular-nums ${t.observationTrend<0?"text-status-danger":"text-fg-secondary"}`,children:[t.observationTrend>0?"+":"",t.observationTrend.toFixed(3)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-fg-muted",children:"Alt. paths"}),e.jsx("span",{className:`tabular-nums ${t.alternatePathsCount===0?"text-status-danger":"text-fg-secondary"}`,children:t.alternatePathsCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-fg-muted",children:"Urgency"}),e.jsx("span",{className:"capitalize",style:{color:c},children:t.urgency})]})]}),t.factors.length>0&&e.jsxs("div",{className:"pt-1 border-t border-edge-subtle/30 space-y-0.5 text-[10px]",children:[e.jsx("div",{className:"text-fg-muted font-medium",children:"Contributing factors"}),t.factors.map((N,j)=>e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-fg-secondary",children:N.name}),e.jsxs("span",{className:"text-fg-muted tabular-nums",children:[(N.score*N.weight*100).toFixed(1),"% (",(N.weight*100).toFixed(0),"w × ",(N.score*100).toFixed(0),"s)"]})]}),e.jsx("div",{className:"text-fg-muted pl-1",children:N.description})]},j))]})]}),children:e.jsxs("div",{className:"px-2 py-1 radius-badge bg-subtle-fill/30 cursor-help",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full shrink-0",style:{backgroundColor:c}}),e.jsx("span",{className:"text-[10px] text-fg-secondary font-mono truncate flex-1",children:t.hops.join(" → ")}),e.jsx("span",{className:"text-[8px] uppercase tracking-wide px-1 py-px radius-badge",style:{backgroundColor:`${c}20`,color:c},children:g}),e.jsxs("span",{className:"text-[10px] tabular-nums font-semibold",style:{color:c},children:[(t.riskScore*100).toFixed(0),"%"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-0.5 pl-3",children:t.factors.map((N,j)=>e.jsxs("span",{className:"text-[8px] text-fg-muted",children:[N.name," (",(N.score*N.weight*100).toFixed(0),"%)",j<t.factors.length-1?" ·":""]},j))})]})},t.pathKey)})})]}),e.jsxs("div",{className:"px-3 py-2 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[e.jsx(L,{content:"Number of detected community clusters via graph partitioning",children:e.jsx("span",{className:"text-fg-muted cursor-help",children:"Communities"})}),e.jsx("span",{className:"text-fg-secondary tabular-nums",children:be==="louvain"&&ft?ft.numCommunities:h})]}),e.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[e.jsx(L,{content:"Spectral uses eigenvector decomposition; Louvain maximizes modularity iteratively. Click to switch.",children:e.jsx("span",{className:"text-fg-muted cursor-help",children:"Algorithm"})}),e.jsx("button",{onClick:()=>Pn(t=>t==="spectral"?"louvain":"spectral"),className:"text-sys-blue hover:underline cursor-pointer",children:be==="spectral"?"Spectral":"Louvain"})]}),be==="louvain"&&ft&&e.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[e.jsx(L,{content:"Louvain modularity score — quality of community partition (higher = better defined communities)",children:e.jsx("span",{className:"text-fg-muted cursor-help",children:"Modularity Q"})}),e.jsx("span",{className:"text-fg-secondary tabular-nums",children:ft.modularity.toFixed(4)})]}),be==="louvain"&&e.jsxs("div",{className:"mt-1.5 pt-1.5 border-t border-edge-subtle space-y-1.5",children:[e.jsx(Z,{label:"Resolution γ",value:lt,onChange:qt,min:.01,max:5,step:.01}),e.jsx(Z,{label:"K-weight",value:ct,onChange:Qt,min:.01,max:5,step:.01}),(lt!==1||ct!==1)&&e.jsx("button",{onClick:()=>{qt(1),Qt(1)},className:"w-full text-[10px] text-sys-blue hover:underline text-center",children:"Reset defaults"})]}),e.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[e.jsx(L,{content:"Redundant path cycles in the topology — indicates alternate routing options",children:e.jsx("span",{className:"text-fg-muted cursor-help",children:"Loops"})}),e.jsx("span",{className:"text-fg-secondary tabular-nums",children:((_s=a==null?void 0:a.loops)==null?void 0:_s.length)??0})]}),e.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[e.jsx(L,{content:"High-betweenness edges that carry disproportionate traffic flow",children:e.jsx("span",{className:"text-fg-muted cursor-help",children:"Backbone"})}),e.jsx("span",{className:"text-fg-secondary tabular-nums",children:((Ws=a==null?void 0:a.backboneEdges)==null?void 0:Ws.length)??0})]}),e.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[e.jsx(L,{content:"Unresolved prefix nodes inferred by Viterbi HMM from repeated path patterns",children:e.jsx("span",{className:"text-fg-muted cursor-help",children:"Ghosts"})}),e.jsx("span",{className:"text-fg-secondary tabular-nums",children:b.length})]}),e.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[e.jsx(L,{content:"Community-aware node coloring — groups nodes by cluster assignment",children:e.jsx("span",{className:"text-fg-muted cursor-help",children:"Clustering"})}),e.jsx("span",{className:`tabular-nums ${je?"text-sys-blue":"text-fg-muted"}`,children:je?"On":"Off"})]}),we!=null&&e.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[e.jsx(L,{content:"Algebraic connectivity — 2nd-smallest eigenvalue of the graph Laplacian. Near-zero = one bridge from network partition.",children:e.jsx("span",{className:"text-fg-muted cursor-help",children:"Fiedler λ₂"})}),e.jsx("span",{className:`tabular-nums ${we<.01?"text-status-warning":"text-fg-secondary"}`,children:we.toFixed(4)})]}),ye.size>0&&e.jsxs("button",{onClick:()=>Yt(new Set),className:"w-full mt-1 text-[10px] text-sys-blue hover:underline text-center",children:["Clear filters (",ye.size,")"]})]})]}),Ds=e.jsx(at,{children:ce&&e.jsx(We.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.15},className:"absolute top-4 left-1/2 -translate-x-1/2 z-30 w-80",children:e.jsxs("div",{className:"surface-elevated radius-inset shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2.5 border-b border-edge-subtle",children:[e.jsx(Ys,{className:"w-4 h-4 text-fg-muted shrink-0"}),e.jsx("input",{ref:At,type:"text",value:ne,onChange:t=>Ce(t.target.value),placeholder:"Search by name or prefix...",className:"flex-1 bg-transparent text-sm text-fg-primary placeholder:text-fg-muted focus:outline-none",onKeyDown:t=>{t.key==="Escape"?(H(!1),Ce("")):t.key==="Enter"&&et.length>0&&gs(et[0])}}),ne&&e.jsx("button",{onClick:()=>Ce(""),className:"p-0.5 radius-badge hover-bg transition-base",children:e.jsx(it,{className:"w-3 h-3 text-fg-muted"})})]}),et.length>0&&e.jsx("div",{className:"max-h-64 overflow-y-auto",children:et.map((t,c)=>e.jsxs("button",{onClick:()=>gs(t),className:`w-full flex items-center gap-3 px-3 py-2 text-left hover-bg transition-base ${c===0?"bg-subtle-fill/50":""}`,children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-full shrink-0",style:{backgroundColor:D[t.nodeClass]}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm text-fg-primary truncate",children:t.name||t.prefix}),t.name&&e.jsx("div",{className:"text-[10px] text-fg-muted",children:t.prefix})]}),e.jsx(Wa,{className:"w-3 h-3 text-fg-muted shrink-0"})]},t.id))}),ne&&et.length===0&&e.jsx("div",{className:"px-3 py-4 text-center text-sm text-fg-muted",children:"No nodes found"}),!ne&&e.jsx("div",{className:"px-3 py-2 type-data-xs text-fg-muted",children:"Type to search • Enter to select • Esc to close"})]})})});return n?pe.length===0?e.jsxs("div",{className:"relative h-[calc(100dvh-56px)] lg:h-dvh min-h-[500px] -mx-4 sm:-mx-6 lg:-mx-8 -mt-5 -mb-4 sm:-mb-6 lg:-mb-8 overflow-hidden",children:[bt,e.jsx("div",{className:"absolute inset-0 bg-body flex items-center justify-center",children:e.jsx(vr,{})})]}):Ht?le?e.jsxs("div",{className:"fixed inset-0 z-50 bg-body flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5 surface-header z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Us,{className:"w-5 h-5 text-icon-page-title"}),e.jsxs("h1",{className:"type-title text-fg-primary flex items-center gap-2",children:["MeshGraph",e.jsx(X,{color:"violet",compact:!0,children:"Analytics"})]}),e.jsxs("span",{className:"text-[10px] text-fg-muted tabular-nums",children:[Ne.length," nodes • ",se.length," edges"]})]}),e.jsx(L,{content:"Exit fullscreen",children:e.jsx("button",{onClick:fs,className:"p-1.5 radius-inner hover-bg transition-base",children:e.jsx(Js,{className:"w-4 h-4 text-fg-muted"})})})]}),e.jsxs("div",{className:"flex-1 relative min-h-0 m-2 surface-base radius-inset overflow-hidden border border-edge-subtle",children:[e.jsx(Zs,{className:"absolute inset-0",points:Ht,links:os,...cs,...O,backgroundColor:I,fitViewOnInit:!0,fitViewPadding:E.fitViewPadding,showLabels:ue,showDynamicLabels:!1,showTopLabels:ue,showTopLabelsLimit:200,showHoveredPointLabel:!0,pointLabelColor:P,pointClusterBy:je?"communityId":void 0,onPolygonSelected:He?bs:void 0,polygonalSelectorStrokeColor:C?"#FBBF24":"#D97706",onClick:ps,onLinkClick:xs,onMount:ms,hoveredPointRingColor:C?"#FBBF24":"#D97706",hoveredPointCursor:"pointer",hoveredLinkCursor:"pointer"}),Ds,Rs,Cs,Ss,ks,Ls,e.jsxs(at,{children:[T&&e.jsx(gn,{node:T,egoMetrics:ys,onExpandEgo:ws,neighbors:Ns,onSelectNeighbor:gt,txDelayRec:js,onClose:()=>{var t;V(null),(t=W.current)==null||t.unselectAllPoints()}}),oe&&!T&&e.jsx(pn,{edge:oe,onClose:()=>ee(null)}),dt&&!T&&!oe&&e.jsx(fn,{metrics:dt,onClose:vs})]})]})]}):e.jsxs("div",{className:"relative h-[calc(100dvh-56px)] lg:h-dvh min-h-[500px] -mx-4 sm:-mx-6 lg:-mx-8 -mt-5 -mb-4 sm:-mb-6 lg:-mb-8 overflow-hidden",children:[bt,e.jsxs("div",{className:"absolute inset-0",children:[e.jsx(Zs,{className:"absolute inset-0",points:Ht,links:os,...cs,...O,backgroundColor:I,fitViewOnInit:!0,fitViewPadding:E.fitViewPadding,showLabels:ue,showDynamicLabels:!1,showTopLabels:ue,showTopLabelsLimit:200,showHoveredPointLabel:!0,pointLabelColor:P,pointClusterBy:je?"communityId":void 0,onPolygonSelected:He?bs:void 0,polygonalSelectorStrokeColor:C?"#FBBF24":"#D97706",onClick:ps,onLinkClick:xs,onMount:ms,hoveredPointRingColor:C?"#FBBF24":"#D97706",hoveredPointCursor:"pointer",hoveredLinkCursor:"pointer"}),Ds,Rs,Cs,Ss,ks,Ls,e.jsxs("div",{className:"absolute bottom-4 right-4 z-10 hidden lg:flex items-center gap-3 type-data-xs text-fg-muted/60",children:[e.jsxs("span",{children:[e.jsx("kbd",{className:"px-1 py-0.5 radius-badge bg-subtle-fill/50 font-mono",children:"/"})," Search"]}),e.jsxs("span",{children:[e.jsx("kbd",{className:"px-1 py-0.5 radius-badge bg-subtle-fill/50 font-mono",children:"F"})," Fit"]}),e.jsxs("span",{children:[e.jsx("kbd",{className:"px-1 py-0.5 radius-badge bg-subtle-fill/50 font-mono",children:"L"})," Labels"]}),e.jsxs("span",{children:[e.jsx("kbd",{className:"px-1 py-0.5 radius-badge bg-subtle-fill/50 font-mono",children:"Space"})," Pause"]}),e.jsxs("span",{children:[e.jsx("kbd",{className:"px-1 py-0.5 radius-badge bg-subtle-fill/50 font-mono",children:"Esc"})," Clear"]})]}),e.jsxs(at,{children:[T&&e.jsx(gn,{node:T,egoMetrics:ys,onExpandEgo:ws,neighbors:Ns,onSelectNeighbor:gt,txDelayRec:js,onClose:()=>{var t;V(null),(t=W.current)==null||t.unselectAllPoints()}}),oe&&!T&&e.jsx(pn,{edge:oe,onClose:()=>ee(null)}),dt&&!T&&!oe&&e.jsx(fn,{metrics:dt,onClose:vs})]})]})]}):e.jsxs("div",{className:"relative h-[calc(100dvh-56px)] lg:h-dvh min-h-[500px] -mx-4 sm:-mx-6 lg:-mx-8 -mt-5 -mb-4 sm:-mb-6 lg:-mb-8 overflow-hidden",children:[bt,e.jsxs("div",{className:"absolute inset-0 bg-body flex flex-col items-center justify-center gap-3",children:[e.jsx(tn,{className:"w-8 h-8 text-sys-blue animate-spin"}),e.jsx("span",{className:"type-body text-fg-muted",children:"Preparing graph..."})]})]}):e.jsxs("div",{className:"relative h-[calc(100dvh-56px)] lg:h-dvh min-h-[500px] -mx-4 sm:-mx-6 lg:-mx-8 -mt-5 -mb-4 sm:-mb-6 lg:-mb-8 overflow-hidden",children:[bt,e.jsxs("div",{className:"absolute inset-0 bg-body flex items-center justify-center",children:[e.jsx(Ta,{isOpen:r,onClose:m}),!r&&e.jsx(tn,{className:"w-8 h-8 text-sys-blue animate-spin"})]})]})}export{Hr as default};
