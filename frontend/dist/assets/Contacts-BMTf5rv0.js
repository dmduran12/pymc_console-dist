const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ContactsMapMapLibre-E5Wf0FGa.js","assets/vendor-react-CHg3w57L.js","assets/vendor-core-CgllfypI.js","assets/cosmograph-RBQGoH9-.js","assets/consumer-registry-CWCmZQuW.js","assets/index-B4woLUMa.js","assets/vendor-charts-DuSK2RSZ.js","assets/vendor-motion-CXybMqb1.js","assets/vendor-icons-rRVc_l7g.js","assets/vendor-fonts-CgDm-k6O.js","assets/link-scoring-BOldcAf5.js","assets/ConfirmModal-rLO2D5gF.js","assets/DeepAnalysisModal-Bv12uRie.js","assets/geo-utils-BP1zBK9h.js","assets/useMapViewStore-Dxt0JgN_.js","assets/BasemapLayer-VM7R8hCP.js","assets/vendor-geo-D3MPFrqo.js","assets/node-types-CTinVm-W.js","assets/easing-DOExzd0X.js","assets/badge-colors-BNUqIXCA.js","assets/LightSparkline-Cju8m-oY.js","assets/ping-C2srVunZ.js","assets/PageLayout-vzO_WRlt.js","assets/listbox-Cj7yU5AR.js","assets/TimeRangeStepper-CHvn0Aaa.js","assets/chat-utils-pV5FH_xH.js","assets/SignalIndicator-C8dAI7pL.js","assets/CollisionExplorerModal-CSqahLo8.js","assets/DataBox-CbYpEKKd.js","assets/maplibre-gl-B1CfjdFi.css","assets/vendor-charts-D1GxaB_c.css","assets/vendor-fonts-hkYiuhFD.css","assets/index-BbN7miMT.css","assets/ContactsMapMapLibre-BwWOEply.css"])))=>i.map(i=>d[i]);
import{j as e,r as n}from"./vendor-react-CHg3w57L.js";import{c as ve}from"./vendor-core-CgllfypI.js";import{as as Te,at as _e,H as te,V as Pe,au as Je,h as C,av as Ze,t as es,aw as ss,ax as ts,ay as as,r as ns,az as rs,aA as ls,aB as is,v as cs,W as os,D as be,aC as ds,aD as ms,e as xs,I as us}from"./index-B4woLUMa.js";import{p as ps}from"./ping-C2srVunZ.js";import{c as ye}from"./node-types-CTinVm-W.js";import{P as hs,a as fs,B as gs}from"./PageLayout-vzO_WRlt.js";import{L as js,a as xe}from"./listbox-Cj7yU5AR.js";import{T as Re}from"./TimeRangeStepper-CHvn0Aaa.js";import{_ as bs}from"./cosmograph-RBQGoH9-.js";import{u as Ns,e as vs,f as ys,r as ws}from"./consumer-registry-CWCmZQuW.js";import{e as Cs,g as ks,a as Ss}from"./chat-utils-pV5FH_xH.js";import{a as Ms}from"./SignalIndicator-C8dAI7pL.js";import{C as Ps}from"./CollisionExplorerModal-CSqahLo8.js";import{ah as Rs,a as we,ai as Ls,j as pe,aj as Ts,R as ue,a2 as Ee,ak as _s,al as Es,A as Fs,am as $s,T as Os,an as Ds,ao as Hs,ap as zs,aq as Fe,a7 as $e,L as Oe,ar as As,as as Is,U as se,at as Le,a1 as Bs,X as Us,au as Vs,av as qs,a5 as Ws,aw as Gs}from"./vendor-icons-rRVc_l7g.js";import{D as Qs}from"./DataBox-CbYpEKKd.js";import{C as W}from"./badge-colors-BNUqIXCA.js";import{C as Ks}from"./ConfirmModal-rLO2D5gF.js";class Ys extends n.Component{constructor(i){super(i),this.state={hasError:!1}}static getDerivedStateFromError(i){return{hasError:!0,error:i}}render(){var i;return this.state.hasError?e.jsx("div",{className:"map-container-16-9 flex items-center justify-center rounded-2xl surface-base",role:"alert","aria-live":"assertive",children:e.jsxs("div",{className:"text-center text-fg-muted p-4",children:[e.jsx("p",{className:"text-lg mb-2",children:"Map failed to load"}),e.jsx("p",{className:"text-sm text-fg-muted",children:((i=this.state.error)==null?void 0:i.message)||"Unknown error"}),e.jsx("p",{className:"text-xs text-fg-muted mt-2",children:"Try refreshing the page or check your browser's WebGL support."})]})}):this.props.children}}const Xs=n.lazy(()=>bs(()=>import("./ContactsMapMapLibre-E5Wf0FGa.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33])));function Js({neighbors:r,localNode:i,localHash:f,onRemoveNode:x,selectedNodeHash:g,onNodeSelected:N,highlightedEdgeKey:h,highlightedGhost:d}){return e.jsx(Ys,{children:e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"map-container-16-9 flex items-center justify-center rounded-2xl surface-base",role:"status","aria-live":"polite","aria-label":"Loading map",children:e.jsxs("div",{className:"text-fg-muted flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-sys-blue border-t-transparent rounded-full animate-spin","aria-hidden":"true"}),e.jsx("span",{children:"Loading map..."})]})}),children:e.jsx(Xs,{neighbors:r,localNode:i,localHash:f,onRemoveNode:x,selectedNodeHash:g,onNodeSelected:N,highlightedEdgeKey:h,highlightedGhost:d})})})}function Zs({hash:r,className:i="",size:f="sm",collisionInfo:x,isViterbiResolved:g}){const N=Te(),h=_e(),[d,D]=n.useState(!1),k=n.useMemo(()=>te(r),[r]),T=n.useMemo(()=>x!==void 0?x:k?N.find(u=>u.prefix===k)??null:null,[k,N,x]),_=g??(h.totalPaths>0&&h.avgPathConfidence>=.7),O=n.useCallback(u=>{u.preventDefault(),u.stopPropagation(),D(!0)},[]),H=n.useCallback(()=>{D(!1)},[]);if(!T)return null;const v=f==="sm"?"w-3.5 h-3.5":"w-4 h-4",z=_?"text-sys-cyan hover:text-sys-cyan hover:bg-sys-cyan/10 focus:ring-sys-cyan/50":"text-signal-fair hover:text-sys-indigo hover:bg-signal-fair/10 focus:ring-signal-fair/50",G=_?`Prefix conflict resolved by Viterbi HMM (${(h.avgPathConfidence*100).toFixed(0)}% confidence)`:`Prefix conflict: ${T.candidateCount} nodes share prefix "${k}"`;return e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:O,className:`inline-flex items-center justify-center p-0.5 rounded focus:outline-none focus:ring-2 transition-colors cursor-pointer touch-manipulation ${z} ${i}`,title:G,"aria-label":`View prefix conflict for ${k}${_?" (Viterbi resolved)":""}`,children:_?e.jsxs("span",{className:"relative",children:[e.jsx(Rs,{className:v}),e.jsx(we,{className:"absolute -bottom-0.5 -right-0.5 w-2 h-2 text-sys-green"})]}):e.jsx(Ls,{className:v})}),e.jsx(Ps,{isOpen:d,prefix:T.prefix,candidateHashes:T.candidateHashes,onClose:H})]})}const et=n.memo(Zs),De=[{target:"Contacts",fn:"name",minStage:1,when:vs},{target:"Contacts",fn:"traceLinks.directed",minStage:2,when:ys}];ws(De);function st(r){return r<1e3?`${Math.round(r)}m`:`${(r/1e3).toFixed(1)}km`}function tt({hash:r,contact:i,isHub:f,isNeighbor:x,distance:g,centrality:N,sparklineData:h,neighborSignal:d,collisionInfo:D,isViterbiResolved:k,isPinging:T,isPingingThis:_,pingResult:O,pingError:H,gatewayInfo:v,lastForwarderPrefix:z,isMobile:G,pathStability:u,onRowClick:Q,onPing:E,onRemove:he}){Ns(De);const B=i.latitude&&i.longitude&&i.latitude!==0&&i.longitude!==0,F=i.node_name||i.name||"Unknown",y=x&&d,ae=ye(i),{isRepeater:P,isCompanion:K,isRoomServer:j,isClient:Y,label:X}=ae,ne=x?`${X} — Direct RF contact (zero-hop neighbor)`:`${X} — Flood routing (multi-hop via mesh)`,J=i.first_seen?Pe(i.first_seen).replace(/ ago$/i," old"):null;return e.jsxs("div",{className:`contacts-grid-row ${f?"bg-sys-amber/5 border-l-2 border-l-sys-amber":""} ${B?"cursor-pointer hover:bg-subtle-fill":""}`,onClick:()=>Q(r),children:[e.jsxs("div",{className:"contacts-col-node flex items-center gap-2 min-w-0",children:[y&&(d==null?void 0:d.avgSnr)!==null?e.jsx("div",{className:`w-2 h-2 rounded-full flex-shrink-0 self-center ${Je(d.avgSnr)}`}):e.jsx("div",{className:"w-2 flex-shrink-0"}),e.jsx("div",{className:"w-6 h-6 flex items-center justify-center flex-shrink-0",title:ne,children:(()=>{if(j&&P)return e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx(pe,{className:"w-5 h-5 absolute inset-0 text-sys-pink"}),e.jsx(Ts,{className:"w-2.5 h-2.5 absolute -bottom-0.5 -right-0.5 text-sys-teal"})]});if(j)return e.jsx(pe,{className:"w-5 h-5 text-sys-pink"});if(P)return e.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center ring-[1.5px] ring-sys-blue",children:e.jsx(ue,{className:"w-3.5 h-3.5 text-sys-blue"})});if((K||Y)&&F!=="Unknown"){const{emoji:w,cleanName:R}=Cs(F);return e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center",style:{backgroundColor:ks(R)},children:w?e.jsx("span",{className:"text-sm leading-none",children:w}):e.jsx("span",{className:"text-white text-[9px] font-bold tracking-tighter",children:Ss(F)})})}return e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center bg-zinc-500/20",children:e.jsx(Ee,{className:"w-3.5 h-3.5 text-sys-amber"})})})()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 overflow-hidden",children:[e.jsx("span",{className:"roster-title truncate",title:F,children:F}),x&&e.jsx(C,{color:W.neighbor,compact:!0,className:"flex-shrink-0",children:"NBR"}),f&&e.jsxs(C,{color:W.hub,compact:!0,className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx(_s,{className:"w-3 h-3"}),"HUB"]}),P&&e.jsx(C,{color:W.repeater,compact:!0,className:"flex-shrink-0",children:"RPT"}),j&&e.jsx(C,{color:W.room,compact:!0,className:"flex-shrink-0",children:"ROOM"}),K&&e.jsx(C,{color:W.companion,compact:!0,className:"flex-shrink-0",children:"COMP"}),Y&&e.jsx(C,{color:W.client,compact:!0,className:"flex-shrink-0",children:"CLIENT"}),G&&e.jsxs(C,{color:"cyan",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0",children:[e.jsx(Es,{className:"w-2.5 h-2.5"}),"MOBILE"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[e.jsx(Qs,{copy:!0,size:"compact",truncate:[8,6],children:r}),e.jsx(et,{hash:r,collisionInfo:D,isViterbiResolved:k}),!x&&v&&e.jsxs(C,{color:"zinc",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0",title:`Via ${v.name||v.prefix} (${v.hopCount} hop${v.hopCount!==1?"s":""})`,children:[e.jsx(Fs,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"font-mono",children:v.prefix}),v.hopCount>1&&e.jsxs("span",{className:"opacity-60",children:["+",v.hopCount-1]})]}),z&&!x&&e.jsxs(C,{color:"zinc",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0",title:`Last forwarded by ${z}`,children:[e.jsx($s,{className:"w-2.5 h-2.5"}),e.jsx("span",{className:"font-mono",children:z})]}),u!=null&&u!==0&&e.jsx(C,{color:u>0?"green":"amber",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0",title:u>0?"Path stability improving":"Path stability declining",children:u>0?e.jsx(Os,{className:"w-2.5 h-2.5"}):e.jsx(Ds,{className:"w-2.5 h-2.5"})}),h.length>0&&(()=>{const w=h.reduce((re,fe)=>re+fe.count,0);if(w===0)return null;const R=w/24;return e.jsxs(C,{color:"zinc",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0",title:`${w} packets in last 24h (~${R.toFixed(1)}/hr)`,children:[e.jsx(Hs,{className:"w-2.5 h-2.5"}),e.jsxs("span",{children:[R<1?"<1":R.toFixed(0),"/hr"]})]})})(),J&&e.jsxs(C,{color:"zinc",compact:!0,className:"flex items-center gap-0.5 flex-shrink-0 opacity-70",title:`First discovered ${J}`,children:[e.jsx(zs,{className:"w-2.5 h-2.5"}),e.jsx("span",{children:J})]})]})]})]}),e.jsxs("div",{className:"contacts-col-signal flex items-center justify-end gap-2",children:[y&&(d==null?void 0:d.avgRssi)!==null&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ms,{rssi:d.avgRssi,className:"w-3.5 h-3.5"}),e.jsx("span",{className:"type-data-xs text-fg-muted",children:Math.round(d.avgRssi)})]}),y&&(d==null?void 0:d.avgSnr)!==null&&e.jsxs("span",{className:"type-data-xs text-fg-muted",children:[d.avgSnr.toFixed(1)," dB"]})]}),e.jsx("div",{className:"contacts-col-distance flex items-center justify-end gap-1 text-fg-muted",children:g!=null&&e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"w-3 h-3"}),e.jsx("span",{className:"type-data-xs",children:st(g)})]})}),e.jsx("div",{className:"contacts-col-centrality flex items-center justify-end gap-1",children:N>0&&e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-3 h-3 text-sys-indigo"}),e.jsxs("span",{className:"type-data-xs text-fg-muted",children:[(N*100).toFixed(0),"%"]})]})}),e.jsx("div",{className:"contacts-col-seen flex items-center justify-end",children:e.jsx("span",{className:"type-data-xs text-fg-primary whitespace-nowrap",children:i.last_seen?Pe(i.last_seen):"—"})}),e.jsxs("div",{className:"contacts-col-actions flex items-center justify-end gap-1",children:[x&&e.jsx(e.Fragment,{children:O?e.jsxs("div",{className:"flex items-center gap-1 text-sys-green",title:`RTT: ${O.rtt_ms.toFixed(0)}ms`,children:[e.jsx(we,{className:"w-3.5 h-3.5"}),e.jsxs("span",{className:"type-data-xs hidden sm:inline",children:[O.snr_db.toFixed(1),"dB"]})]}):H?e.jsx("span",{className:"text-sys-red text-xs",title:H,children:"✗"}):e.jsx("button",{onClick:w=>E(r,w),disabled:T,className:"p-1 sm:p-1.5 radius-inner text-fg-muted/50 hover:text-sys-blue hover:bg-sys-blue/10 transition-base disabled:opacity-50 disabled:cursor-not-allowed",title:"Ping neighbor for updated signal info",children:_?e.jsx(Oe,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 animate-spin"}):e.jsx(As,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})}),e.jsx("button",{onClick:w=>{w.stopPropagation(),he(r,F)},className:"p-1 sm:p-1.5 radius-inner text-fg-muted/50 hover:text-sys-red hover:bg-sys-red/10 transition-base",title:"Remove contact",children:e.jsx(Is,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})]})]})}const at=n.memo(tt),nt=6371e3,rt=[],lt=[{field:"lastHeard",icon:Ws,label:"Recent"},{field:"distance",icon:Fe,label:"Distance"},{field:"centrality",icon:$e,label:"Centrality"}];function it(r){switch(r){case"room_server":return"room";case"repeater":return"repeater";case"companion":return"companion";case"unknown":return"companion"}}function ct(r){const i=ye(r);return it(i.type)}function Ne(r,i){const{color:f="primary",border:x=!1}=i??{};return ve("flex items-center gap-1.5 px-2 py-1.5 text-sm radius-inner transition-base",r?f==="success"?"bg-sys-green/20 text-sys-green":"bg-sys-blue/20 text-sys-blue":"text-fg-muted hover:text-fg-secondary hover-bg",x&&(r?f==="success"?"border border-sys-green/30":"border border-sys-blue/30":"border border-transparent"))}function ot(r,i,f,x){const g=(f-r)*Math.PI/180,N=(x-i)*Math.PI/180,h=Math.sin(g/2)*Math.sin(g/2)+Math.cos(r*Math.PI/180)*Math.cos(f*Math.PI/180)*Math.sin(N/2)*Math.sin(N/2),d=2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h));return nt*d}function dt(){const{stats:r}=Ze(),i=es(),f=ss(),x=ts(),g=as(),N=ns(),h=rs(),d=ls(),D=is(),k=cs(),T=os(),_=be[k],O=Te(),H=_e(),v=ds(),z=H.totalPaths>0&&H.avgPathConfidence>=.7,G=n.useMemo(()=>{const s=new Map;for(const t of O)s.set(t.prefix,t);return s},[O]),[u,Q]=n.useState(null),[E,he]=n.useState("lastHeard"),[B,F]=n.useState("desc"),[y,ae]=n.useState(""),[P,K]=n.useState(!1),[j,Y]=n.useState(new Set),[X,ne]=n.useState(!1),[J,w]=n.useState(null),[R,re]=n.useState(null),[fe,ge]=n.useState(new Map),[He,Z]=n.useState(new Map),[S,ze]=n.useState(25),[U,le]=n.useState(25),je=n.useRef(null),ie=n.useMemo(()=>(r==null?void 0:r.neighbors)??{},[r==null?void 0:r.neighbors]),A=n.useMemo(()=>{const t=Date.now()/1e3-_.minutes*60;return Object.fromEntries(Object.entries(ie).filter(([a,l])=>i.has(a)?!1:(l.last_seen??0)>=t))},[ie,i,_.minutes]),L=ms(),V=r==null?void 0:r.local_hash,Ae=n.useMemo(()=>{const s=new Map;if(!V||h.size===0)return s;for(const[t,a]of h)if(t.endsWith(`→${V}`)&&a.hops.length>1){const l=t.split("→")[0],c=a.hops[a.hops.length-1];s.set(l,c)}return s},[h,V]),ce=n.useMemo(()=>{const s=new Map;if(!(L!=null&&L.latitude)||!(L!=null&&L.longitude))return s;for(const[t,a]of Object.entries(A))a.latitude&&a.longitude&&a.latitude!==0&&a.longitude!==0?s.set(t,ot(L.latitude,L.longitude,a.latitude,a.longitude)):s.set(t,null);return s},[A,L]),{neighborHashSet:oe,neighborSignalMap:Ie}=n.useMemo(()=>{const s=new Set,t=new Map;for(const a of N)s.add(a.hash),t.set(a.hash,{avgRssi:a.avgRssi,avgSnr:a.avgSnr});return{neighborHashSet:s,neighborSignalMap:t}},[N]),Ce=n.useMemo(()=>{const s=y.toLowerCase().trim(),t=s==="neighbor"||s==="neighbors",a=P||t,l=j.size>0;return Object.fromEntries(Object.entries(A).filter(([c,o])=>{if(l){const M=ct(o);if(!j.has(M))return!1}if(a&&!oe.has(c))return!1;if(t||!s)return!0;const I=(o.node_name||o.name||"").toLowerCase(),b=te(c).toLowerCase();return I.includes(s)||b.includes(s)||c.toLowerCase().includes(s)}))},[A,y,P,oe,j]),p=n.useMemo(()=>{const s=Object.entries(Ce),t=y.toLowerCase().trim(),a=t.length===2&&/^[0-9a-f]{2}$/i.test(t);return s.sort(([l,c],[o,I])=>{if(a){const M=te(l).toLowerCase(),$=te(o).toLowerCase(),ee=M===t,de=$===t;if(ee&&!de)return-1;if(de&&!ee)return 1}let b=0;switch(E){case"lastHeard":b=(c.last_seen||0)-(I.last_seen||0);break;case"distance":{const M=ce.get(l)??null,$=ce.get(o)??null;M===null&&$===null?b=0:M===null?b=1:$===null?b=-1:b=M-$;break}case"centrality":{const M=g.get(l)||0,$=g.get(o)||0;b=M-$;break}}return B==="desc"?-b:b})},[Ce,E,B,ce,g,y]),m=n.useMemo(()=>{let s=0,t=0,a=0,l=0,c=0;for(const[,o]of p){const I=ye(o),b=o.latitude&&o.longitude&&o.latitude!==0&&o.longitude!==0;switch(I.type){case"room_server":a++;break;case"repeater":t++;break;case"companion":s++;break;case"unknown":c++;break}b&&l++}return{companions:s,repeaters:t,roomServers:a,total:p.length,withLocation:l,unknown:c}},[p]),Be=n.useMemo(()=>new Set(x),[x]),ke=n.useMemo(()=>S===0?p:p.slice(0,U),[p,U,S]);n.useEffect(()=>{le(S||p.length)},[E,B,y,P,j,S,p.length]),n.useEffect(()=>{const s=t=>{t.target.closest("[data-dropdown]")||ne(!1)};return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[]),n.useEffect(()=>{if(S===0)return;const s=new IntersectionObserver(t=>{t[0].isIntersecting&&U<p.length&&le(a=>Math.min(a+S,p.length))},{threshold:.1,rootMargin:"100px"});return je.current&&s.observe(je.current),()=>s.disconnect()},[S,U,p.length]);const Ue=n.useCallback(s=>{ze(s),le(s||p.length)},[p.length]),Ve=n.useCallback(s=>{E===s?F(t=>t==="desc"?"asc":"desc"):(he(s),F("desc"))},[E]),qe=n.useCallback(s=>{const t=A[s];t!=null&&t.latitude&&(t!=null&&t.longitude)&&t.latitude!==0&&t.longitude!==0&&w(s)},[A]),We=n.useCallback(()=>{w(null)},[]),Ge=n.useCallback((s,t)=>{Q({hash:s,name:t})},[]),Qe=n.useCallback(async(s,t)=>{if(t.stopPropagation(),!R){re(s),ge(a=>{const l=new Map(a);return l.delete(s),l}),Z(a=>{const l=new Map(a);return l.delete(s),l});try{const a=s.startsWith("0x")?s.slice(0,4):`0x${s.slice(0,2)}`,l=await ps(a,30);l.success&&l.data?(ge(c=>new Map(c).set(s,l.data)),setTimeout(()=>{ge(c=>{const o=new Map(c);return o.delete(s),o})},1e4)):(Z(c=>new Map(c).set(s,l.error||"Ping failed")),setTimeout(()=>{Z(c=>{const o=new Map(c);return o.delete(s),o})},5e3))}catch(a){const l=a instanceof Error?a.message:"Ping failed";Z(c=>new Map(c).set(s,l)),setTimeout(()=>{Z(c=>{const o=new Map(c);return o.delete(s),o})},5e3)}finally{re(null)}}},[R]);return e.jsxs(hs,{children:[e.jsx(fs,{title:"Contacts",icon:e.jsx(se,{}),controls:e.jsxs("div",{className:"flex items-center gap-3 sm:gap-5",children:[e.jsxs("div",{className:"hidden sm:flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs text-fg-muted",children:"Total:"}),e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:`${m.total} discovered node${m.total!==1?"s":""} on the mesh network`,children:[e.jsx(se,{className:"w-3.5 h-3.5 text-fg-secondary"}),e.jsx("span",{children:m.total})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs text-fg-muted",children:"Types:"}),m.repeaters>0&&e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:"Repeaters",children:[e.jsx(ue,{className:"w-3.5 h-3.5 text-sys-blue"}),e.jsx("span",{children:m.repeaters})]}),m.companions>0&&e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:"Companions",children:[e.jsx(Le,{className:"w-3.5 h-3.5 text-fg-muted"}),e.jsx("span",{children:m.companions})]}),m.roomServers>0&&e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:"Room Servers",children:[e.jsx(pe,{className:"w-3.5 h-3.5 text-sys-pink"}),e.jsx("span",{children:m.roomServers})]}),m.withLocation>0&&e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:"With GPS location",children:[e.jsx(Bs,{className:"w-3.5 h-3.5 text-sys-green"}),e.jsx("span",{children:m.withLocation})]}),m.unknown>0&&e.jsxs("span",{className:"data-box flex items-center gap-1.5 cursor-default",title:"Unknown type",children:[e.jsx(Ee,{className:"w-3.5 h-3.5 text-sys-amber"}),e.jsx("span",{children:m.unknown})]})]})]}),e.jsxs("div",{className:"flex sm:hidden items-center gap-1.5",children:[e.jsxs("span",{className:"data-box !px-1.5 !py-0.5 !text-[10px] flex items-center gap-1",children:[e.jsx(se,{className:"w-3 h-3 text-fg-secondary"}),e.jsx("span",{children:m.total})]}),m.repeaters>0&&e.jsxs("span",{className:"data-box !px-1.5 !py-0.5 !text-[10px] flex items-center gap-1",children:[e.jsx(ue,{className:"w-3 h-3 text-sys-blue"}),e.jsx("span",{children:m.repeaters})]}),m.companions>0&&e.jsxs("span",{className:"data-box !px-1.5 !py-0.5 !text-[10px] flex items-center gap-1",children:[e.jsx(Le,{className:"w-3 h-3 text-fg-muted"}),e.jsx("span",{children:m.companions})]}),m.roomServers>0&&e.jsxs("span",{className:"data-box !px-1.5 !py-0.5 !text-[10px] flex items-center gap-1",children:[e.jsx(pe,{className:"w-3 h-3 text-sys-pink"}),e.jsx("span",{children:m.roomServers})]}),e.jsx(Re,{ranges:be,selectedIndex:k,onSelect:T,size:"sm"})]}),e.jsx("div",{className:"hidden sm:block",children:e.jsx(Re,{ranges:be,selectedIndex:k,onSelect:T})})]})}),e.jsxs(gs,{children:[D?e.jsx(Js,{neighbors:A,localNode:L??void 0,localHash:V,onRemoveNode:f,selectedNodeHash:J,onNodeSelected:We}):e.jsx("div",{className:"surface-base radius-card aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-sys-blue border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm text-fg-muted",children:"Loading map..."})]})}),e.jsx(xs,{noPadding:!0,children:D?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2.5 border-b border-edge-subtle",children:[e.jsx("span",{className:"icon-md flex items-center justify-center text-icon-card-title flex-shrink-0",children:e.jsx(se,{})}),e.jsx("span",{className:"type-micro flex-shrink-0 mr-auto hidden sm:block",children:"Discovered Contacts"}),e.jsx(us,{type:"search",size:"sm",value:y,onChange:s=>ae(s.target.value),placeholder:"Search...",leadingIcon:e.jsx(Vs,{className:"w-3.5 h-3.5"}),trailingIcon:y?e.jsx("button",{onClick:()=>{ae(""),(y.toLowerCase().trim()==="neighbor"||y.toLowerCase().trim()==="neighbors")&&K(!1)},className:"text-fg-muted hover:text-fg-secondary",children:e.jsx(Us,{className:"w-3 h-3"})}):void 0,className:"w-24 sm:w-32 xl:w-44","aria-label":"Search contacts"}),e.jsx("div",{className:"h-4 w-px bg-border-subtle flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsxs("div",{className:"relative","data-dropdown":!0,children:[e.jsxs("button",{onClick:()=>ne(!X),className:Ne(j.size>0,{border:!0}),title:"Filter by contact type",children:[e.jsx(qs,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden xl:inline",children:"Filter"}),j.size>0&&e.jsx("span",{className:"tabular-nums text-xs bg-sys-blue/30 px-1 rounded",children:j.size})]}),X&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 z-50 surface-elevated radius-inner py-1 min-w-[140px]",children:[[{key:"repeater",label:"Repeaters"},{key:"companion",label:"Companions"},{key:"room",label:"Rooms"}].map(({key:s,label:t})=>e.jsxs("button",{onClick:()=>{Y(a=>{const l=new Set(a);return l.has(s)?l.delete(s):l.add(s),l})},className:"w-full px-3 py-1.5 text-sm text-left hover-bg transition-base flex items-center gap-2",children:[e.jsx("span",{className:ve("w-4 h-4 flex items-center justify-center radius-badge border",j.has(s)?"bg-sys-blue border-sys-blue text-white":"border-edge-subtle"),children:j.has(s)&&e.jsx(we,{className:"w-3 h-3"})}),e.jsx("span",{className:j.has(s)?"text-fg-primary":"text-fg-secondary",children:t})]},s)),j.size>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-edge-subtle my-1"}),e.jsx("button",{onClick:()=>Y(new Set),className:"w-full px-3 py-1.5 text-sm text-left text-fg-muted hover:text-fg-secondary hover-bg transition-base",children:"Clear filters"})]})]})]}),oe.size>0&&e.jsxs("button",{onClick:()=>K(!P),className:Ne(P,{color:"success",border:!0}),title:P?"Show all contacts":"Show only MeshCore neighbors (direct RF contact)",children:[e.jsx(ue,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden xl:inline",children:"Neighbors"})]})]}),e.jsx("div",{className:"h-4 w-px bg-border-subtle flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[lt.map(({field:s,icon:t,label:a})=>e.jsxs("button",{onClick:()=>Ve(s),className:Ne(E===s),title:`Sort by ${a.toLowerCase()}`,children:[e.jsx(t,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden xl:inline",children:a}),E===s&&e.jsx(Gs,{className:ve("w-3 h-3",B==="asc"&&"rotate-180")})]},s)),e.jsx("div",{className:"h-4 w-px bg-border-subtle"}),e.jsxs(js,{value:S,onChange:Ue,className:"w-auto min-w-[50px] [&_button]:py-1 [&_button]:px-2 [&_button]:text-xs [&_button]:min-h-0","aria-label":"Items per page",children:[e.jsx(xe,{value:25,children:"25"}),e.jsx(xe,{value:50,children:"50"}),e.jsx(xe,{value:100,children:"100"}),e.jsx(xe,{value:0,children:"All"})]})]})]}),p.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden sm:grid contacts-grid-header border-b border-edge-subtle/50 px-3 py-2 type-micro text-fg-muted",children:[e.jsx("div",{className:"contacts-col-node",children:"Node"}),e.jsx("div",{className:"contacts-col-signal text-right",children:"Signal"}),e.jsx("div",{className:"contacts-col-distance text-right",children:"Distance"}),e.jsx("div",{className:"contacts-col-centrality text-right",children:"Centrality"}),e.jsx("div",{className:"contacts-col-seen text-right",children:"Last Seen"}),e.jsx("div",{className:"contacts-col-actions"})]}),e.jsx("div",{className:"divide-y divide-edge-subtle/30",children:ke.map(([s,t])=>{const a=te(s),l=Be.has(s),c=oe.has(s),o=ce.get(s)??null,I=g.get(s)||0,b=c?Ie.get(s):void 0,M=a?G.get(a)??null:null,$=v.get(s)??rt;let ee=null;if(!c&&V&&h.size>0){const Ye=`${s}→${V}`,me=h.get(Ye);if(me&&me.hops.length>0){const Se=me.hops[0],Me=Object.keys(ie).find(Xe=>Xe.toUpperCase().startsWith(Se.toUpperCase())),q=Me?ie[Me]:null;ee={prefix:Se,name:(q==null?void 0:q.node_name)??(q==null?void 0:q.name)??null,hopCount:me.hopCount}}}const de=d.has(s),Ke=Ae.get(s)??null;return e.jsx(at,{hash:s,contact:t,isHub:l,isNeighbor:c,distance:o,centrality:I,sparklineData:$,neighborSignal:b,collisionInfo:M,isViterbiResolved:z,isPinging:R!==null,isPingingThis:R===s,pingResult:fe.get(s),pingError:He.get(s),gatewayInfo:ee,lastForwarderPrefix:Ke,isMobile:de,onRowClick:qe,onPing:Qe,onRemove:Ge},s)})}),S>0&&U<p.length&&e.jsxs("div",{ref:je,className:"flex items-center justify-center py-4 text-fg-muted",children:[e.jsx(Oe,{className:"w-4 h-4 animate-spin mr-2"}),e.jsx("span",{className:"text-xs",children:"Loading more..."})]}),e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-t border-edge-subtle/50 text-xs text-fg-muted",children:[e.jsxs("span",{className:"tabular-nums",children:["Showing ",ke.length," of ",p.length]}),S>0&&U<p.length&&e.jsx("button",{onClick:()=>le(s=>Math.min(s+S,p.length)),className:"text-sys-blue hover:text-sys-blue/80 transition-base",children:"Load more"})]})]}):e.jsxs("div",{className:"roster-empty",children:[e.jsx(se,{className:"roster-empty-icon"}),e.jsx("div",{className:"type-label text-fg-secondary",children:"No Contacts Discovered"}),e.jsx("div",{className:"type-data-xs text-fg-muted mt-1",children:"Contacts will appear here as they advertise on the mesh network."})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-edge-subtle",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-elevated animate-pulse"}),e.jsx("div",{className:"w-32 h-4 rounded bg-elevated animate-pulse"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 h-6 rounded bg-elevated animate-pulse"}),e.jsx("div",{className:"w-24 h-6 rounded bg-elevated animate-pulse"}),e.jsx("div",{className:"w-16 h-6 rounded bg-elevated animate-pulse"})]})]}),e.jsx("div",{className:"px-3 py-3 space-y-3",children:[...Array(5)].map((s,t)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 rounded bg-elevated animate-pulse"}),e.jsxs("div",{className:"flex-1 space-y-1.5",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-elevated animate-pulse"}),e.jsx("div",{className:"h-3 w-24 rounded bg-elevated animate-pulse"})]}),e.jsx("div",{className:"w-12 h-4 rounded bg-elevated animate-pulse"}),e.jsx("div",{className:"w-16 h-4 rounded bg-elevated animate-pulse"})]},t))})]})})]}),e.jsx(Ks,{isOpen:!!u,title:"Remove Contact",message:`Are you sure you would like to remove ${(u==null?void 0:u.name)||"this contact"}?`,confirmLabel:"Remove",cancelLabel:"Cancel",variant:"danger",onConfirm:()=>{u&&f(u.hash),Q(null)},onCancel:()=>Q(null)})]})}const Pt=Object.freeze(Object.defineProperty({__proto__:null,default:dt},Symbol.toStringTag,{value:"Module"}));export{Pt as C,et as P};
