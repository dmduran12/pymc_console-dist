var e,t,n=Object.defineProperty,r=(e,t,r)=>((e,t,r)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);import{c as s,j as i,G as o,_ as a,af as l,ag as c,f as u,ah as h}from"./index-DJZzIT5o.js";import{b as d,g as f,c as p,r as g}from"./recharts-bmHCCfxU.js";import{a as m,P as _,S as y,L as b,u as v,M as x,N as w,b as E}from"./maplibre-gl-DDViHvUF.js";import{G as T,N as S,T as A,M as R,C}from"./Contacts-BYZ4yupV.js";import{a as k,C as I}from"./HashBadge-Bw92Kxy4.js";import{L as P}from"./loader-circle-KHtnwzaq.js";import{I as M}from"./info-CPIlh1n-.js";import{H as N}from"./house-ClJ2ctnj.js";import{R as L}from"./refresh-cw-J4C9PxWk.js";import{N as O}from"./trending-up-B0SMYyTs.js";import"./maplibre-gl-CFO9X1Ek.js";import"./SignalIndicator-TYN_Wy0w.js";import"./triangle-alert-CG0Hcq6I.js";import"./zap-RVsBptYq.js";import"./activity-B9TYkhlb.js";import"./PageLayout-v625f7fI.js";import"./users--u_9e887.js";const F=s("chart-no-axes-column",[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V3",key:"1lcnhd"}],["path",{d:"M19 21V9",key:"unv183"}]]),D=s("chevrons-left-right-ellipsis",[["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"m17 7 5 5-5 5",key:"1xlxn0"}],["path",{d:"m7 7-5 5 5 5",key:"19njba"}],["path",{d:"M8 12h.01",key:"czm47f"}]]),B=s("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),U=s("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),j=s("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),V=s("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]),G=s("minimize-2",[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]]);function z(e,t){const n=Math.max(5,Math.min(e,300)),r=Math.log(5),s=Math.log(300);return 1+(Math.log(n)-r)/(s-r)*5}const W="#4338CA";function H({label:e,icon:t,status:n,detail:r}){return i.jsxs("div",{className:p("flex items-center gap-3 py-3 px-4 rounded-xl transition-all duration-300","active"===n&&"bg-[#4338CA]/10","complete"===n&&"bg-accent-success/10","pending"===n&&"opacity-40"),children:[i.jsx("div",{className:p("w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 transition-all duration-300","active"===n&&"bg-[#4338CA]/20","complete"===n&&"bg-accent-success/20","pending"===n&&"bg-white/5"),children:"complete"===n?i.jsx(k,{className:"w-4 h-4 text-accent-success"}):"active"===n?i.jsx(P,{className:"w-4 h-4 animate-spin",style:{color:W}}):i.jsx("span",{className:"text-text-muted",children:t})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("div",{className:p("text-sm font-medium transition-colors","active"===n&&"text-[#4338CA]","complete"===n&&"text-accent-success","pending"===n&&"text-text-muted"),children:e}),r&&"pending"!==n&&i.jsx("div",{className:"text-xs text-text-muted mt-0.5 truncate",children:r})]})]})}const $=d.memo(function({isOpen:e,currentStep:t,packetCount:n,onClose:r}){if(d.useEffect(()=>{if(!e)return;const t=e=>{"Escape"===e.key&&r&&r()};window.addEventListener("keydown",t);const n=document.body.style.overflow,s=document.body.style.position,i=document.body.style.width,o=document.body.style.top,a=window.scrollY;return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.top=`-${a}px`,()=>{window.removeEventListener("keydown",t),document.body.style.overflow=n,document.body.style.position=s,document.body.style.width=i,document.body.style.top=o,window.scrollTo(0,a)}},[e,r]),!e)return null;const s="complete"===t,o=e=>{const n=["fetching","analyzing","building","complete"],r=n.indexOf(t),s=n.indexOf(e);return s<r?"complete":s===r?"active":"pending"};return f.createPortal(i.jsxs("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center",role:"dialog","aria-modal":"true","aria-labelledby":"deep-analysis-modal-title",children:[i.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm"}),i.jsx("div",{className:"relative glass-card w-full max-w-sm mx-4 p-6 animate-in fade-in zoom-in-95 duration-200",style:{background:"rgba(20, 20, 22, 0.95)",border:"1px solid rgba(140, 160, 200, 0.15)"},children:s?i.jsxs("div",{className:"flex flex-col items-center py-6",children:[i.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center mb-4 animate-in zoom-in-50 duration-300",style:{backgroundColor:"rgba(57, 217, 138, 0.2)"},children:i.jsx(k,{className:"w-8 h-8 text-accent-success"})}),i.jsx("h3",{className:"text-lg font-semibold text-accent-success",children:"Ready!"})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[i.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{backgroundColor:"rgba(67, 56, 202, 0.15)"},children:i.jsx(T,{className:"w-5 h-5",style:{color:W}})}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-semibold text-text-primary",children:"Deep Analysis"}),i.jsx("p",{className:"text-xs text-text-muted",children:"Building mesh topology"})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(H,{label:"Fetching Packets",icon:i.jsx(U,{className:"w-4 h-4"}),status:o("fetching"),detail:n>0?`${n.toLocaleString()} packets`:"Loading database..."}),i.jsx(H,{label:"Analyzing Database",icon:i.jsx(B,{className:"w-4 h-4"}),status:o("analyzing"),detail:"Processing packet paths"}),i.jsx(H,{label:"Building Topology",icon:i.jsx(T,{className:"w-4 h-4"}),status:o("building"),detail:"Computing mesh edges"})]}),i.jsx("p",{className:"text-xs text-text-muted text-center mt-5",children:"This may take a few seconds..."})]})})]}),document.body)}),X="#4338CA",q="#FBBF24",Y="#6366F1",K="#F97316",Z="#F59E0B",Q="#FBBF24",J="#4B5563",ee="#6B7280",te="#374151",ne="#5EEAD4",re="#6366F1",se="#9CA3AF",ie="#6B7280",oe="#FBBF24",ae=2e3;function le({text:e}){return i.jsxs("span",{className:"group relative cursor-help",children:[i.jsx(M,{className:"w-3 h-3 text-text-muted"}),i.jsx("div",{className:"absolute bottom-full left-0 mb-1 hidden group-hover:block w-44 p-2 text-[10px] leading-tight rounded-lg z-10",style:{background:"rgba(20, 20, 22, 0.98)",border:"1px solid rgba(140, 160, 200, 0.3)"},children:e})]})}function ce(e){const t=new Date(1e3*e);return`${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getDate().toString().padStart(2,"0")}`}function ue({hash:e,hashPrefix:t,name:n,isHub:r,isZeroHop:s,isMobile:a,isRoomServer:l,isStale:c,lastSeenTimestamp:u,centrality:h,affinity:f,meanSnr:p,meanRssi:g,neighbor:m,onRemove:_,txDelayRec:y}){var b,v,x;const[w,E]=d.useState(!1),T=s?"Direct":(null==f?void 0:f.typicalHopPosition)?`${f.typicalHopPosition}-hop`:null,R=[{label:"Packets",value:(null==f?void 0:f.frequency)||0},{label:"Adverts",value:m.advert_count||0}];s&&void 0!==p&&R.push({label:"SNR",value:`${p.toFixed(1)} dB`}),s&&void 0!==g&&R.push({label:"RSSI",value:`${Math.round(g)} dBm`});const C=y&&!y.insufficientData,P={hub:{bg:"bg-amber-500/20",text:"text-amber-400",title:"Hub: High-connectivity node (4+ neighbors) that bridges many paths"},backbone:{bg:"bg-purple-500/20",text:"text-purple-400",title:"Backbone: Critical relay with 4+ neighbors and high traffic"},relay:{bg:"bg-cyan-500/20",text:"text-cyan-400",title:"Relay: Standard forwarding node with symmetric traffic"},edge:{bg:"bg-gray-500/20",text:"text-gray-400",title:"Edge: Peripheral node with few connections"}},M={high:{bg:"bg-green-500/20",text:"text-green-400",title:"1000+ packets observed"},medium:{bg:"bg-amber-500/20",text:"text-amber-400",title:"500-999 packets observed"},low:{bg:"bg-red-500/20",text:"text-red-400",title:"100-499 packets observed"}};return i.jsxs("div",{className:"w-[220px] pr-3",children:[i.jsx("div",{className:"text-[14px] font-semibold text-text-primary leading-snug truncate mb-0.5",children:n}),i.jsxs("div",{className:"flex items-center gap-1 flex-wrap mb-1.5",children:[i.jsx("code",{className:"font-mono text-[10px] text-text-muted/70 bg-white/5 px-1 py-px rounded",children:t}),i.jsx("button",{onClick:()=>{navigator.clipboard.writeText(e),E(!0),setTimeout(()=>E(!1),1500)},className:"p-0.5 hover:bg-white/10 rounded transition-colors",title:"Copy full hash",children:w?i.jsx(k,{className:"w-2.5 h-2.5 text-accent-success"}):i.jsx(I,{className:"w-2.5 h-2.5 text-text-muted/50"})}),r&&i.jsx("span",{className:"px-1 py-px text-[8px] font-bold uppercase rounded",style:{backgroundColor:"#FBBF24",color:"#000"},children:"Hub"}),T&&i.jsx("span",{className:"px-1 py-px text-[8px] font-bold uppercase rounded",style:{backgroundColor:s?Q:"rgba(255,255,255,0.08)",color:s?"#000":"rgba(255,255,255,0.5)"},children:T}),a&&i.jsx("span",{className:"px-1 py-px text-[8px] font-bold uppercase rounded bg-orange-500/25 text-orange-300",children:"Mobile"}),m.is_repeater&&i.jsx("span",{className:"px-1 py-px text-[8px] font-bold uppercase rounded bg-cyan-500/20 text-cyan-400",children:"Rptr"}),l&&i.jsx("span",{className:"px-1 py-px text-[8px] font-bold uppercase rounded bg-amber-500/25 text-amber-400",children:"Room"}),c&&u&&i.jsxs("span",{className:"px-1 py-px text-[8px] font-medium rounded bg-gray-500/30 text-gray-300",title:"Neighbor not heard in 7+ days",children:["Idle ",ce(u)]})]}),i.jsxs("div",{className:"text-[10px] text-text-muted/60 mb-2 leading-tight",children:[i.jsx("span",{children:o(m.last_seen)}),(null==f?void 0:f.distanceMeters)&&i.jsxs("span",{className:"font-medium text-text-muted/80",children:[" · ",(N=f.distanceMeters,null===N?"—":N<1e3?`${Math.round(N)}m`:`${(N/1e3).toFixed(1)}km`)]}),m.latitude&&m.longitude&&0!==m.latitude&&0!==m.longitude&&i.jsxs("span",{className:"font-mono text-[9px]",children:[" · ",m.latitude.toFixed(4),", ",m.longitude.toFixed(4)]})]}),i.jsx("div",{className:"mb-2",children:i.jsx(S,{nodeHash:e,width:"100%",height:28,showArea:!0,showTooltip:!0})}),i.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-0.5 text-[11px] mb-2",children:[R.map((e,t)=>i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-text-muted/50",children:e.label}),i.jsx("span",{className:"font-semibold tabular-nums "+("highlight"in e&&e.highlight?"text-amber-400":""),children:e.value})]},t)),C&&y.networkRole&&i.jsx(i.Fragment,{children:i.jsxs("div",{className:"flex items-center justify-between col-span-2 mt-1 pt-1 border-t border-white/5",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("span",{className:"text-text-muted/50",children:"Role"}),i.jsx("span",{className:`px-1.5 py-px text-[8px] font-bold uppercase rounded ${P[y.networkRole].bg} ${P[y.networkRole].text}`,title:P[y.networkRole].title,children:y.networkRole})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("span",{className:"text-text-muted/50",children:"Data"}),i.jsx("span",{className:`px-1.5 py-px text-[8px] font-bold uppercase rounded ${(null==(b=M[y.dataConfidence])?void 0:b.bg)||""} ${(null==(v=M[y.dataConfidence])?void 0:v.text)||""}`,title:(null==(x=M[y.dataConfidence])?void 0:x.title)||"",children:y.dataConfidence})]})]})})]}),(C||_)&&i.jsxs("div",{className:"pt-1.5 border-t border-white/5",children:[C&&i.jsxs("div",{className:"flex items-center gap-2 text-[10px]",children:[i.jsx("span",{className:"text-text-muted/50",children:"TX Delay"}),i.jsxs("span",{className:"font-semibold tabular-nums text-amber-400",children:["×",(y.floodFactor??y.txDelayFactor).toFixed(1)]}),i.jsx("span",{className:"text-text-muted/30",children:"flood"}),i.jsxs("span",{className:"font-semibold tabular-nums text-amber-400",children:["×",(y.directFactor??y.directTxDelayFactor).toFixed(1)]}),i.jsx("span",{className:"text-text-muted/30",children:"direct"})]}),_&&i.jsx("div",{className:"flex justify-end "+(C?"mt-1.5":""),children:i.jsx("button",{onClick:_,className:"flex items-center gap-0.5 p-1 text-[10px] text-text-muted/30 hover:text-red-400 hover:bg-red-500/10 rounded transition-colors",title:"Remove from contacts",children:i.jsx(A,{className:"w-3 h-3"})})})]})]});var N}function he({showTopology:e,validatedPolylineCount:t,filteredNeighborCount:n,hasLocalNode:r,meshTopology:s,zeroHopNeighbors:o,neighborsWithLocation:a}){return i.jsxs("div",{className:"absolute bottom-4 left-4 z-[600] text-xs",style:{background:"rgba(20, 20, 22, 0.95)",borderRadius:"0.75rem",padding:"0.625rem",border:"1px solid rgba(140, 160, 200, 0.2)",maxWidth:"150px"},children:[i.jsxs("div",{className:"text-text-secondary font-medium mb-1.5 flex items-center gap-1",children:["Nodes",i.jsx(le,{text:"Node type shown by shape/color. Yellow outer ring = direct RF neighbor."})]}),i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{background:"transparent",border:`3px solid ${X}`,boxSizing:"border-box"}}),i.jsx("span",{className:"text-text-muted",children:"Node"}),i.jsx(le,{text:"Standard mesh node. Can be a repeater, client, or companion device."})]}),i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:Y}}),i.jsx("span",{className:"text-text-muted",children:"Hub"}),i.jsx(le,{text:"High-connectivity node with 4+ direct neighbors. Hubs are central to mesh traffic flow and use higher TX delays to reduce collision impact."})]}),i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx(N,{className:"w-3 h-3 flex-shrink-0",style:{color:q},strokeWidth:2.5}),i.jsx("span",{className:"text-text-muted",children:"Local"}),i.jsx(le,{text:"Your repeater. This is the node running pyMC_Repeater that you're connected to."})]}),(l=a,l.some(([,e])=>{var t;const n=null==(t=e.contact_type)?void 0:t.toLowerCase();return"room server"===n||"room_server"===n||"room"===n||"server"===n})&&i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx(R,{className:"w-3 h-3 flex-shrink-0",style:{color:Z},strokeWidth:2.5}),i.jsx("span",{className:"text-text-muted",children:"Room"}),i.jsx(le,{text:"Room Server identity. Hosts a chat room that clients can sync messages with."})]})),s.mobileNodes.length>0&&i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{background:"transparent",border:`3px solid ${K}`,boxSizing:"border-box"}}),i.jsx("span",{className:"text-text-muted",children:"Mobile"}),i.jsx(le,{text:"Volatile node that frequently appears/disappears from paths. Likely a portable or vehicle-mounted device."})]}),o.size>0&&i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsxs("div",{className:"relative w-4 h-4 flex-shrink-0",children:[i.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:"transparent",border:`1px solid ${Q}`,boxSizing:"border-box",opacity:.8}}),i.jsx("div",{className:"absolute rounded-full",style:{top:"4px",left:"4px",width:"8px",height:"8px",background:"transparent",border:`2px solid ${X}`,boxSizing:"border-box"}})]}),i.jsx("span",{className:"text-text-muted",children:"Neighbor"}),i.jsx(le,{text:"Zero-hop direct RF contact. We receive their ADVERTs directly without any relay hops."})]})]}),o.size>0&&i.jsx("div",{className:"mt-1.5 pt-1.5 border-t border-white/10",children:i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx("div",{className:"flex-shrink-0",style:{width:"14px",height:"2px",backgroundImage:`repeating-linear-gradient(90deg, ${ie} 0, ${ie} 3px, transparent 3px, transparent 5px)`,borderRadius:"1px"}}),i.jsx("span",{className:"text-text-muted",children:"Neighbor"}),i.jsx(le,{text:"Dashed gray → yellow on hover. Direct RF contact with local."})]})}),e&&t>0&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"text-text-secondary font-medium mt-2 pt-2 border-t border-white/10 mb-1 flex items-center gap-1",children:["Topology",i.jsx(le,{text:"Links with 5+ validations. Thickness = relative strength."})]}),i.jsxs("div",{className:"flex flex-col gap-0.5 text-text-muted",children:[i.jsxs("div",{className:"flex justify-between tabular-nums",children:[i.jsx("span",{children:"Nodes"}),i.jsx("span",{className:"text-text-secondary",children:n+(r?1:0)})]}),i.jsxs("div",{className:"flex justify-between tabular-nums",children:[i.jsx("span",{children:"Links"}),i.jsx("span",{className:"text-text-secondary",children:t})]}),s.hubNodes.length>0&&i.jsxs("div",{className:"flex justify-between tabular-nums",children:[i.jsx("span",{children:"Hubs"}),i.jsx("span",{style:{color:Y},children:s.hubNodes.length})]})]}),i.jsxs("div",{className:"flex flex-col gap-1 mt-1.5 pt-1.5 border-t border-white/10",children:[i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx("div",{className:"flex-shrink-0",style:{width:"14px",height:"3px",backgroundColor:J,borderRadius:"1px"}}),i.jsx("span",{className:"text-text-muted",children:"Link"}),i.jsx(le,{text:"Gray at rest. Hover to reveal type (teal=direct, indigo=loop)."})]}),s.loops.length>0&&i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsxs("div",{className:"flex-shrink-0 flex flex-col gap-0.5",style:{width:"14px"},children:[i.jsx("div",{style:{height:"2px",backgroundColor:J,borderRadius:"1px"}}),i.jsx("div",{style:{height:"2px",backgroundColor:J,borderRadius:"1px"}})]}),i.jsx("span",{className:"text-text-muted",children:"Redundant"})]})]}),s.loops.length>0&&i.jsx("div",{className:"mt-1.5 pt-1.5 border-t border-white/10",children:i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx(L,{className:"w-3 h-3 flex-shrink-0",style:{color:re}}),i.jsxs("div",{className:"flex flex-col",children:[i.jsxs("span",{style:{color:re},className:"font-medium",children:[s.loops.length," ",1===s.loops.length?"Loop":"Loops"]}),i.jsx("span",{className:"text-text-muted text-[10px] leading-tight",children:"Redundant paths"})]})]})})]})]});var l}const de={background:"rgba(20, 20, 22, 0.95)",borderRadius:"0.75rem",border:"1px solid rgba(140, 160, 200, 0.2)"},fe=(e,t=.4)=>({background:e,borderRadius:"0.75rem",border:`1px solid ${e.replace(/[\d.]+\)$/,`${t})`)}`});function pe({isDeepLoading:e,showDeepAnalysisModal:t,onDeepAnalysis:n,showTopology:r,onToggleTopology:s,hasValidatedPolylines:o,soloHubs:a,onToggleSoloHubs:l,hasHubNodes:c,soloDirect:u,onToggleSoloDirect:h,hasZeroHopNeighbors:d,isFullscreen:f,onToggleFullscreen:p}){return i.jsxs("div",{className:"absolute top-4 right-4 z-[600] flex gap-2",children:[i.jsxs("button",{onClick:n,disabled:e||t,className:"px-3 py-2 flex items-center gap-2 transition-colors hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed",style:de,title:"Deep Analysis - Load full packet history and rebuild topology",children:[i.jsx("span",{className:"text-xs font-medium text-text-primary",children:"Deep Analysis"}),i.jsx(F,{className:"w-4 h-4 text-accent-primary"})]}),o&&i.jsx("button",{onClick:s,className:"p-2 transition-colors hover:bg-white/10",style:r?fe("rgba(74, 222, 128, 0.2)"):de,title:r?"Hide topology lines":"Show topology lines",children:r?i.jsx(T,{className:"w-4 h-4 text-green-400"}):i.jsx(j,{className:"w-4 h-4 text-text-secondary"})}),c&&i.jsx("button",{onClick:l,className:"p-2 transition-colors hover:bg-white/10",style:a?{...de,background:"rgba(251, 191, 36, 0.25)",border:"1px solid rgba(251, 191, 36, 0.5)"}:de,title:a?"Show all nodes":"Solo hubs & connections",children:i.jsx(O,{className:"w-4 h-4 "+(a?"text-amber-400":"text-text-secondary")})}),d&&i.jsx("button",{onClick:h,className:"p-2 transition-colors hover:bg-white/10",style:u?{...de,background:"rgba(67, 56, 202, 0.35)",border:"1px solid rgba(67, 56, 202, 0.6)"}:de,title:u?"Show all nodes":"Solo direct (0-hop) nodes",children:i.jsx(D,{className:"w-4 h-4 "+(u?"text-indigo-400":"text-text-secondary")})}),i.jsx("button",{onClick:p,className:"p-2 transition-colors hover:bg-white/10",style:de,title:f?"Exit fullscreen":"Fullscreen",children:f?i.jsx(G,{className:"w-4 h-4 text-text-secondary"}):i.jsx(V,{className:"w-4 h-4 text-text-secondary"})})]})}function ge(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}function me(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}var _e,ye={},be={};var ve,xe,we={};var Ee,Te,Se=(xe||(xe=1,Ee=function(){if(_e)return be;_e=1;var e=g();function t(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=Object.prototype.hasOwnProperty,r=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,s={},i={};function o(e){return!!n.call(i,e)||!n.call(s,e)&&(r.test(e)?i[e]=!0:(s[e]=!0,!1))}function a(e,t,n,r,s,i,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var l={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){l[e]=new a(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];l[t]=new a(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){l[e]=new a(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){l[e]=new a(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){l[e]=new a(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){l[e]=new a(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){l[e]=new a(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){l[e]=new a(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){l[e]=new a(e,5,!1,e.toLowerCase(),null,!1,!1)});var c=/[\-:]([a-z])/g;function u(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(c,u);l[t]=new a(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(c,u);l[t]=new a(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(c,u);l[t]=new a(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){l[e]=new a(e,1,!1,e.toLowerCase(),null,!1,!1)}),l.xlinkHref=new a("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){l[e]=new a(e,1,!1,e.toLowerCase(),null,!0,!0)});var h={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},d=["Webkit","ms","Moz","O"];Object.keys(h).forEach(function(e){d.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),h[t]=h[e]})});var f=/["'&<>]/;function p(e){if("boolean"==typeof e||"number"==typeof e)return""+e;e=""+e;var t=f.exec(e);if(t){var n,r="",s=0;for(n=t.index;n<e.length;n++){switch(e.charCodeAt(n)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#x27;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}s!==n&&(r+=e.substring(s,n)),s=n+1,r+=t}e=s!==n?r+e.substring(s,n):r}return e}var m=/([A-Z])/g,_=/^ms-/,y=Array.isArray;function b(e,t){return{insertionMode:e,selectedValue:t}}var v=new Map;function x(e,r,s){if("object"!=typeof s)throw Error(t(62));for(var i in r=!0,s)if(n.call(s,i)){var o=s[i];if(null!=o&&"boolean"!=typeof o&&""!==o){if(0===i.indexOf("--")){var a=p(i);o=p((""+o).trim())}else{a=i;var l=v.get(a);void 0!==l||(l=p(a.replace(m,"-$1").toLowerCase().replace(_,"-ms-")),v.set(a,l)),a=l,o="number"==typeof o?0===o||n.call(h,i)?""+o:o+"px":p((""+o).trim())}r?(r=!1,e.push(' style="',a,":",o)):e.push(";",a,":",o)}}r||e.push('"')}function w(e,t,n,r){switch(n){case"style":return void x(e,t,r);case"defaultValue":case"defaultChecked":case"innerHTML":case"suppressContentEditableWarning":case"suppressHydrationWarning":return}if(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])if(null!==(t=l.hasOwnProperty(n)?l[n]:null)){switch(typeof r){case"function":case"symbol":return;case"boolean":if(!t.acceptsBooleans)return}switch(n=t.attributeName,t.type){case 3:r&&e.push(" ",n,'=""');break;case 4:!0===r?e.push(" ",n,'=""'):!1!==r&&e.push(" ",n,'="',p(r),'"');break;case 5:isNaN(r)||e.push(" ",n,'="',p(r),'"');break;case 6:!isNaN(r)&&1<=r&&e.push(" ",n,'="',p(r),'"');break;default:t.sanitizeURL&&(r=""+r),e.push(" ",n,'="',p(r),'"')}}else if(o(n)){switch(typeof r){case"function":case"symbol":return;case"boolean":if("data-"!==(t=n.toLowerCase().slice(0,5))&&"aria-"!==t)return}e.push(" ",n,'="',p(r),'"')}}function E(e,n,r){if(null!=n){if(null!=r)throw Error(t(60));if("object"!=typeof n||!("__html"in n))throw Error(t(61));null!=(n=n.__html)&&e.push(""+n)}}function T(e,t,r,s){e.push(R(r));var i,o=r=null;for(i in t)if(n.call(t,i)){var a=t[i];if(null!=a)switch(i){case"children":r=a;break;case"dangerouslySetInnerHTML":o=a;break;default:w(e,s,i,a)}}return e.push(">"),E(e,o,r),"string"==typeof r?(e.push(p(r)),null):r}var S=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,A=new Map;function R(e){var n=A.get(e);if(void 0===n){if(!S.test(e))throw Error(t(65,e));n="<"+e,A.set(e,n)}return n}function C(e,n,r){if(e.push('\x3c!--$?--\x3e<template id="'),null===r)throw Error(t(395));return e.push(r),e.push('"></template>')}var k=/[<\u2028\u2029]/g;function I(e){return JSON.stringify(e).replace(k,function(e){switch(e){case"<":return"\\u003c";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:throw Error("escapeJSStringsForInstructionScripts encountered a match it does not know how to replace. this means the match regex and the replacement characters are no longer in sync. This is a bug in React")}})}function P(e,t,n,r){return n.generateStaticMarkup?(e.push(p(t)),!1):(""===t?e=r:(r&&e.push("\x3c!-- --\x3e"),e.push(p(t)),e=!0),e)}var M=Object.assign,N=Symbol.for("react.element"),L=Symbol.for("react.portal"),O=Symbol.for("react.fragment"),F=Symbol.for("react.strict_mode"),D=Symbol.for("react.profiler"),B=Symbol.for("react.provider"),U=Symbol.for("react.context"),j=Symbol.for("react.forward_ref"),V=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),z=Symbol.for("react.memo"),W=Symbol.for("react.lazy"),H=Symbol.for("react.scope"),$=Symbol.for("react.debug_trace_mode"),X=Symbol.for("react.legacy_hidden"),q=Symbol.for("react.default_value"),Y=Symbol.iterator;function K(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case O:return"Fragment";case L:return"Portal";case D:return"Profiler";case F:return"StrictMode";case V:return"Suspense";case G:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case U:return(e.displayName||"Context")+".Consumer";case B:return(e._context.displayName||"Context")+".Provider";case j:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case z:return null!==(t=e.displayName||null)?t:K(e.type)||"Memo";case W:t=e._payload,e=e._init;try{return K(e(t))}catch(n){}}return null}var Z={};function Q(e,t){if(!(e=e.contextTypes))return Z;var n,r={};for(n in e)r[n]=t[n];return r}var J=null;function ee(e,n){if(e!==n){e.context._currentValue2=e.parentValue,e=e.parent;var r=n.parent;if(null===e){if(null!==r)throw Error(t(401))}else{if(null===r)throw Error(t(401));ee(e,r)}n.context._currentValue2=n.value}}function te(e){e.context._currentValue2=e.parentValue,null!==(e=e.parent)&&te(e)}function ne(e){var t=e.parent;null!==t&&ne(t),e.context._currentValue2=e.value}function re(e,n){if(e.context._currentValue2=e.parentValue,null===(e=e.parent))throw Error(t(402));e.depth===n.depth?ee(e,n):re(e,n)}function se(e,n){var r=n.parent;if(null===r)throw Error(t(402));e.depth===r.depth?ee(e,r):se(e,r),n.context._currentValue2=n.value}function ie(e){var t=J;t!==e&&(null===t?ne(e):null===e?te(t):t.depth===e.depth?ee(t,e):t.depth>e.depth?re(t,e):se(t,e),J=e)}var oe={isMounted:function(){return!1},enqueueSetState:function(e,t){null!==(e=e._reactInternals).queue&&e.queue.push(t)},enqueueReplaceState:function(e,t){(e=e._reactInternals).replace=!0,e.queue=[t]},enqueueForceUpdate:function(){}};function ae(e,t,n,r){var s=void 0!==e.state?e.state:null;e.updater=oe,e.props=n,e.state=s;var i={queue:[],replace:!1};e._reactInternals=i;var o=t.contextType;if(e.context="object"==typeof o&&null!==o?o._currentValue2:r,"function"==typeof(o=t.getDerivedStateFromProps)&&(s=null==(o=o(n,s))?s:M({},s,o),e.state=s),"function"!=typeof t.getDerivedStateFromProps&&"function"!=typeof e.getSnapshotBeforeUpdate&&("function"==typeof e.UNSAFE_componentWillMount||"function"==typeof e.componentWillMount))if(t=e.state,"function"==typeof e.componentWillMount&&e.componentWillMount(),"function"==typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),t!==e.state&&oe.enqueueReplaceState(e,e.state,null),null!==i.queue&&0<i.queue.length)if(t=i.queue,o=i.replace,i.queue=null,i.replace=!1,o&&1===t.length)e.state=t[0];else{for(i=o?t[0]:e.state,s=!0,o=o?1:0;o<t.length;o++){var a=t[o];null!=(a="function"==typeof a?a.call(e,i,n,r):a)&&(s?(s=!1,i=M({},i,a)):M(i,a))}e.state=i}else i.queue=null}var le={id:1,overflow:""};function ce(e,t,n){var r=e.id;e=e.overflow;var s=32-ue(r)-1;r&=~(1<<s),n+=1;var i=32-ue(t)+s;if(30<i){var o=s-s%5;return i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,{id:1<<32-ue(t)+s|n<<s|r,overflow:i+e}}return{id:1<<i|n<<s|r,overflow:e}}var ue=Math.clz32?Math.clz32:function(e){return 0==(e>>>=0)?32:31-(he(e)/de|0)|0},he=Math.log,de=Math.LN2,fe="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},pe=null,ge=null,me=null,ye=null,ve=!1,xe=!1,we=0,Ee=null,Te=0;function Se(){if(null===pe)throw Error(t(321));return pe}function Ae(){if(0<Te)throw Error(t(312));return{memoizedState:null,queue:null,next:null}}function Re(){return null===ye?null===me?(ve=!1,me=ye=Ae()):(ve=!0,ye=me):null===ye.next?(ve=!1,ye=ye.next=Ae()):(ve=!0,ye=ye.next),ye}function Ce(){ge=pe=null,xe=!1,me=null,Te=0,ye=Ee=null}function ke(e,t){return"function"==typeof t?t(e):t}function Ie(e,t,n){if(pe=Se(),ye=Re(),ve){var r=ye.queue;if(t=r.dispatch,null!==Ee&&void 0!==(n=Ee.get(r))){Ee.delete(r),r=ye.memoizedState;do{r=e(r,n.action),n=n.next}while(null!==n);return ye.memoizedState=r,[r,t]}return[ye.memoizedState,t]}return e=e===ke?"function"==typeof t?t():t:void 0!==n?n(t):t,ye.memoizedState=e,e=(e=ye.queue={last:null,dispatch:null}).dispatch=Me.bind(null,pe,e),[ye.memoizedState,e]}function Pe(e,t){if(pe=Se(),t=void 0===t?null:t,null!==(ye=Re())){var n=ye.memoizedState;if(null!==n&&null!==t){var r=n[1];e:if(null===r)r=!1;else{for(var s=0;s<r.length&&s<t.length;s++)if(!fe(t[s],r[s])){r=!1;break e}r=!0}if(r)return n[0]}}return e=e(),ye.memoizedState=[e,t],e}function Me(e,n,r){if(25<=Te)throw Error(t(301));if(e===pe)if(xe=!0,e={action:r,next:null},null===Ee&&(Ee=new Map),void 0===(r=Ee.get(n)))Ee.set(n,e);else{for(n=r;null!==n.next;)n=n.next;n.next=e}}function Ne(){throw Error(t(394))}function Le(){}var Oe={readContext:function(e){return e._currentValue2},useContext:function(e){return Se(),e._currentValue2},useMemo:Pe,useReducer:Ie,useRef:function(e){pe=Se();var t=(ye=Re()).memoizedState;return null===t?(e={current:e},ye.memoizedState=e):t},useState:function(e){return Ie(ke,e)},useInsertionEffect:Le,useLayoutEffect:function(){},useCallback:function(e,t){return Pe(function(){return e},t)},useImperativeHandle:Le,useEffect:Le,useDebugValue:Le,useDeferredValue:function(e){return Se(),e},useTransition:function(){return Se(),[!1,Ne]},useId:function(){var e=ge.treeContext,n=e.overflow;e=((e=e.id)&~(1<<32-ue(e)-1)).toString(32)+n;var r=Fe;if(null===r)throw Error(t(404));return n=we++,e=":"+r.idPrefix+"R"+e,0<n&&(e+="H"+n.toString(32)),e+":"},useMutableSource:function(e,t){return Se(),t(e._source)},useSyncExternalStore:function(e,n,r){if(void 0===r)throw Error(t(407));return r()}},Fe=null,De=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentDispatcher;function Be(e){return null}function Ue(){}function je(e,t,n,r,s,i,o,a){e.allPendingTasks++,null===n?e.pendingRootTasks++:n.pendingTasks++;var l={node:t,ping:function(){var t=e.pingedTasks;t.push(l),1===t.length&&tt(e)},blockedBoundary:n,blockedSegment:r,abortSet:s,legacyContext:i,context:o,treeContext:a};return s.add(l),l}function Ve(e,t,n,r,s,i){return{status:0,id:-1,index:t,parentFlushed:!1,chunks:[],children:[],formatContext:r,boundary:n,lastPushedText:s,textEmbedded:i}}function Ge(e,t){if(null!=(e=e.onError(t))&&"string"!=typeof e)throw Error('onError returned something with a type other than "string". onError should return a string and may return null or undefined but must not return anything else. It received something of type "'+typeof e+'" instead');return e}function ze(e,t){var n=e.onShellError;n(t),(n=e.onFatalError)(t),null!==e.destination?(e.status=2,e.destination.destroy(t)):(e.status=1,e.fatalError=t)}function We(e,t,n,r,s){for(pe={},ge=t,we=0,e=n(r,s);xe;)xe=!1,we=0,Te+=1,ye=null,e=n(r,s);return Ce(),e}function He(e,n,r,s){var i=r.render(),o=s.childContextTypes;if(null!=o){var a=n.legacyContext;if("function"!=typeof r.getChildContext)s=a;else{for(var l in r=r.getChildContext())if(!(l in o))throw Error(t(108,K(s)||"Unknown",l));s=M({},a,r)}n.legacyContext=s,qe(e,n,i),n.legacyContext=a}else qe(e,n,i)}function $e(e,t){if(e&&e.defaultProps){for(var n in t=M({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function Xe(r,s,i,a,l){if("function"==typeof i)if(i.prototype&&i.prototype.isReactComponent){l=Q(i,s.legacyContext);var c=i.contextType;ae(c=new i(a,"object"==typeof c&&null!==c?c._currentValue2:l),i,a,l),He(r,s,c,i)}else{l=We(r,s,i,a,c=Q(i,s.legacyContext));var u=0!==we;if("object"==typeof l&&null!==l&&"function"==typeof l.render&&void 0===l.$$typeof)ae(l,i,a,c),He(r,s,l,i);else if(u){a=s.treeContext,s.treeContext=ce(a,1,0);try{qe(r,s,l)}finally{s.treeContext=a}}else qe(r,s,l)}else{if("string"!=typeof i){switch(i){case X:case $:case F:case D:case O:case G:return void qe(r,s,a.children);case H:throw Error(t(343));case V:e:{i=s.blockedBoundary,l=s.blockedSegment,c=a.fallback,a=a.children;var h={id:null,rootSegmentID:-1,parentFlushed:!1,pendingTasks:0,forceClientRender:!1,completedSegments:[],byteSize:0,fallbackAbortableTasks:u=new Set,errorDigest:null},d=Ve(0,l.chunks.length,h,l.formatContext,!1,!1);l.children.push(d),l.lastPushedText=!1;var f=Ve(0,0,null,l.formatContext,!1,!1);f.parentFlushed=!0,s.blockedBoundary=h,s.blockedSegment=f;try{if(Ke(r,s,a),r.responseState.generateStaticMarkup||f.lastPushedText&&f.textEmbedded&&f.chunks.push("\x3c!-- --\x3e"),f.status=1,Je(h,f),0===h.pendingTasks)break e}catch(g){f.status=4,h.forceClientRender=!0,h.errorDigest=Ge(r,g)}finally{s.blockedBoundary=i,s.blockedSegment=l}s=je(r,c,i,d,u,s.legacyContext,s.context,s.treeContext),r.pingedTasks.push(s)}return}if("object"==typeof i&&null!==i)switch(i.$$typeof){case j:if(a=We(r,s,i.render,a,l),0!==we){i=s.treeContext,s.treeContext=ce(i,1,0);try{qe(r,s,a)}finally{s.treeContext=i}}else qe(r,s,a);return;case z:return void Xe(r,s,i=i.type,a=$e(i,a),l);case B:if(l=a.children,i=i._context,a=a.value,c=i._currentValue2,i._currentValue2=a,J=a={parent:u=J,depth:null===u?0:u.depth+1,context:i,parentValue:c,value:a},s.context=a,qe(r,s,l),null===(r=J))throw Error(t(403));return a=r.parentValue,r.context._currentValue2=a===q?r.context._defaultValue:a,r=J=r.parent,void(s.context=r);case U:return void qe(r,s,a=(a=a.children)(i._currentValue2));case W:return void Xe(r,s,i=(l=i._init)(i._payload),a=$e(i,a),void 0)}throw Error(t(130,null==i?i:typeof i,""))}switch(c=function(r,s,i,a,l){switch(s){case"select":r.push(R("select"));var c=null,u=null;for(g in i)if(n.call(i,g)){var h=i[g];if(null!=h)switch(g){case"children":c=h;break;case"dangerouslySetInnerHTML":u=h;break;case"defaultValue":case"value":break;default:w(r,a,g,h)}}return r.push(">"),E(r,u,c),c;case"option":u=l.selectedValue,r.push(R("option"));var d=h=null,f=null,g=null;for(c in i)if(n.call(i,c)){var m=i[c];if(null!=m)switch(c){case"children":h=m;break;case"selected":f=m;break;case"dangerouslySetInnerHTML":g=m;break;case"value":d=m;default:w(r,a,c,m)}}if(null!=u)if(i=null!==d?""+d:function(t){var n="";return e.Children.forEach(t,function(e){null!=e&&(n+=e)}),n}(h),y(u)){for(a=0;a<u.length;a++)if(""+u[a]===i){r.push(' selected=""');break}}else""+u===i&&r.push(' selected=""');else f&&r.push(' selected=""');return r.push(">"),E(r,g,h),h;case"textarea":for(h in r.push(R("textarea")),g=u=c=null,i)if(n.call(i,h)&&null!=(d=i[h]))switch(h){case"children":g=d;break;case"value":c=d;break;case"defaultValue":u=d;break;case"dangerouslySetInnerHTML":throw Error(t(91));default:w(r,a,h,d)}if(null===c&&null!==u&&(c=u),r.push(">"),null!=g){if(null!=c)throw Error(t(92));if(y(g)&&1<g.length)throw Error(t(93));c=""+g}return"string"==typeof c&&"\n"===c[0]&&r.push("\n"),null!==c&&r.push(p(""+c)),null;case"input":for(u in r.push(R("input")),d=g=h=c=null,i)if(n.call(i,u)&&null!=(f=i[u]))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(t(399,"input"));case"defaultChecked":d=f;break;case"defaultValue":h=f;break;case"checked":g=f;break;case"value":c=f;break;default:w(r,a,u,f)}return null!==g?w(r,a,"checked",g):null!==d&&w(r,a,"checked",d),null!==c?w(r,a,"value",c):null!==h&&w(r,a,"value",h),r.push("/>"),null;case"menuitem":for(var _ in r.push(R("menuitem")),i)if(n.call(i,_)&&null!=(c=i[_]))switch(_){case"children":case"dangerouslySetInnerHTML":throw Error(t(400));default:w(r,a,_,c)}return r.push(">"),null;case"title":for(m in r.push(R("title")),c=null,i)if(n.call(i,m)&&null!=(u=i[m]))switch(m){case"children":c=u;break;case"dangerouslySetInnerHTML":throw Error(t(434));default:w(r,a,m,u)}return r.push(">"),c;case"listing":case"pre":for(d in r.push(R(s)),u=c=null,i)if(n.call(i,d)&&null!=(h=i[d]))switch(d){case"children":c=h;break;case"dangerouslySetInnerHTML":u=h;break;default:w(r,a,d,h)}if(r.push(">"),null!=u){if(null!=c)throw Error(t(60));if("object"!=typeof u||!("__html"in u))throw Error(t(61));null!=(i=u.__html)&&("string"==typeof i&&0<i.length&&"\n"===i[0]?r.push("\n",i):r.push(""+i))}return"string"==typeof c&&"\n"===c[0]&&r.push("\n"),c;case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":for(var b in r.push(R(s)),i)if(n.call(i,b)&&null!=(c=i[b]))switch(b){case"children":case"dangerouslySetInnerHTML":throw Error(t(399,s));default:w(r,a,b,c)}return r.push("/>"),null;case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return T(r,i,s,a);case"html":return 0===l.insertionMode&&r.push("<!DOCTYPE html>"),T(r,i,s,a);default:if(-1===s.indexOf("-")&&"string"!=typeof i.is)return T(r,i,s,a);for(f in r.push(R(s)),u=c=null,i)if(n.call(i,f)&&null!=(h=i[f]))switch(f){case"children":c=h;break;case"dangerouslySetInnerHTML":u=h;break;case"style":x(r,a,h);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":break;default:o(f)&&"function"!=typeof h&&"symbol"!=typeof h&&r.push(" ",f,'="',p(h),'"')}return r.push(">"),E(r,u,c),c}}((l=s.blockedSegment).chunks,i,a,r.responseState,l.formatContext),l.lastPushedText=!1,u=l.formatContext,l.formatContext=function(e,t,n){switch(t){case"select":return b(1,null!=n.value?n.value:n.defaultValue);case"svg":return b(2,null);case"math":return b(3,null);case"foreignObject":return b(1,null);case"table":return b(4,null);case"thead":case"tbody":case"tfoot":return b(5,null);case"colgroup":return b(7,null);case"tr":return b(6,null)}return 4<=e.insertionMode||0===e.insertionMode?b(1,null):e}(u,i,a),Ke(r,s,c),l.formatContext=u,i){case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"input":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":break;default:l.chunks.push("</",i,">")}l.lastPushedText=!1}}function qe(e,n,r){if(n.node=r,"object"==typeof r&&null!==r){switch(r.$$typeof){case N:return void Xe(e,n,r.type,r.props,r.ref);case L:throw Error(t(257));case W:var s=r._init;return void qe(e,n,r=s(r._payload))}if(y(r))return void Ye(e,n,r);if((s=null===r||"object"!=typeof r?null:"function"==typeof(s=Y&&r[Y]||r["@@iterator"])?s:null)&&(s=s.call(r))){if(!(r=s.next()).done){var i=[];do{i.push(r.value),r=s.next()}while(!r.done);Ye(e,n,i)}return}throw e=Object.prototype.toString.call(r),Error(t(31,"[object Object]"===e?"object with keys {"+Object.keys(r).join(", ")+"}":e))}"string"==typeof r?(s=n.blockedSegment).lastPushedText=P(n.blockedSegment.chunks,r,e.responseState,s.lastPushedText):"number"==typeof r&&((s=n.blockedSegment).lastPushedText=P(n.blockedSegment.chunks,""+r,e.responseState,s.lastPushedText))}function Ye(e,t,n){for(var r=n.length,s=0;s<r;s++){var i=t.treeContext;t.treeContext=ce(i,r,s);try{Ke(e,t,n[s])}finally{t.treeContext=i}}}function Ke(e,t,n){var r=t.blockedSegment.formatContext,s=t.legacyContext,i=t.context;try{return qe(e,t,n)}catch(l){if(Ce(),"object"!=typeof l||null===l||"function"!=typeof l.then)throw t.blockedSegment.formatContext=r,t.legacyContext=s,t.context=i,ie(i),l;n=l;var o=t.blockedSegment,a=Ve(0,o.chunks.length,null,o.formatContext,o.lastPushedText,!0);o.children.push(a),o.lastPushedText=!1,e=je(e,t.node,t.blockedBoundary,a,t.abortSet,t.legacyContext,t.context,t.treeContext).ping,n.then(e,e),t.blockedSegment.formatContext=r,t.legacyContext=s,t.context=i,ie(i)}}function Ze(e){var t=e.blockedBoundary;(e=e.blockedSegment).status=3,et(this,t,e)}function Qe(e,n,r){var s=e.blockedBoundary;e.blockedSegment.status=3,null===s?(n.allPendingTasks--,2!==n.status&&(n.status=2,null!==n.destination&&n.destination.push(null))):(s.pendingTasks--,s.forceClientRender||(s.forceClientRender=!0,e=void 0===r?Error(t(432)):r,s.errorDigest=n.onError(e),s.parentFlushed&&n.clientRenderedBoundaries.push(s)),s.fallbackAbortableTasks.forEach(function(e){return Qe(e,n,r)}),s.fallbackAbortableTasks.clear(),n.allPendingTasks--,0===n.allPendingTasks&&(s=n.onAllReady)())}function Je(e,t){if(0===t.chunks.length&&1===t.children.length&&null===t.children[0].boundary){var n=t.children[0];n.id=t.id,n.parentFlushed=!0,1===n.status&&Je(e,n)}else e.completedSegments.push(t)}function et(e,n,r){if(null===n){if(r.parentFlushed){if(null!==e.completedRootSegment)throw Error(t(389));e.completedRootSegment=r}e.pendingRootTasks--,0===e.pendingRootTasks&&(e.onShellError=Ue,(n=e.onShellReady)())}else n.pendingTasks--,n.forceClientRender||(0===n.pendingTasks?(r.parentFlushed&&1===r.status&&Je(n,r),n.parentFlushed&&e.completedBoundaries.push(n),n.fallbackAbortableTasks.forEach(Ze,e),n.fallbackAbortableTasks.clear()):r.parentFlushed&&1===r.status&&(Je(n,r),1===n.completedSegments.length&&n.parentFlushed&&e.partialBoundaries.push(n)));e.allPendingTasks--,0===e.allPendingTasks&&(e=e.onAllReady)()}function tt(e){if(2!==e.status){var t=J,n=De.current;De.current=Oe;var r=Fe;Fe=e.responseState;try{var s,i=e.pingedTasks;for(s=0;s<i.length;s++){var o=i[s],a=e,l=o.blockedSegment;if(0===l.status){ie(o.context);try{qe(a,o,o.node),a.responseState.generateStaticMarkup||l.lastPushedText&&l.textEmbedded&&l.chunks.push("\x3c!-- --\x3e"),o.abortSet.delete(o),l.status=1,et(a,o.blockedBoundary,l)}catch(f){if(Ce(),"object"==typeof f&&null!==f&&"function"==typeof f.then){var c=o.ping;f.then(c,c)}else{o.abortSet.delete(o),l.status=4;var u=o.blockedBoundary,h=f,d=Ge(a,h);null===u?ze(a,h):(u.pendingTasks--,u.forceClientRender||(u.forceClientRender=!0,u.errorDigest=d,u.parentFlushed&&a.clientRenderedBoundaries.push(u))),a.allPendingTasks--,0===a.allPendingTasks&&(0,a.onAllReady)()}}}}i.splice(0,s),null!==e.destination&&at(e,e.destination)}catch(f){Ge(e,f),ze(e,f)}finally{Fe=r,De.current=n,n===Oe&&ie(t)}}}function nt(e,n,r){switch(r.parentFlushed=!0,r.status){case 0:var s=r.id=e.nextSegmentId++;return r.lastPushedText=!1,r.textEmbedded=!1,e=e.responseState,n.push('<template id="'),n.push(e.placeholderPrefix),e=s.toString(16),n.push(e),n.push('"></template>');case 1:r.status=2;var i=!0;s=r.chunks;var o=0;r=r.children;for(var a=0;a<r.length;a++){for(i=r[a];o<i.index;o++)n.push(s[o]);i=rt(e,n,i)}for(;o<s.length-1;o++)n.push(s[o]);return o<s.length&&(i=n.push(s[o])),i;default:throw Error(t(390))}}function rt(e,n,r){var s=r.boundary;if(null===s)return nt(e,n,r);if(s.parentFlushed=!0,s.forceClientRender)return e.responseState.generateStaticMarkup||(s=s.errorDigest,n.push("\x3c!--$!--\x3e"),n.push("<template"),s&&(n.push(' data-dgst="'),s=p(s),n.push(s),n.push('"')),n.push("></template>")),nt(e,n,r),!!e.responseState.generateStaticMarkup||n.push("\x3c!--/$--\x3e");if(0<s.pendingTasks){s.rootSegmentID=e.nextSegmentId++,0<s.completedSegments.length&&e.partialBoundaries.push(s);var i=e.responseState,o=i.nextSuspenseID++;return i=i.boundaryPrefix+o.toString(16),s=s.id=i,C(n,e.responseState,s),nt(e,n,r),n.push("\x3c!--/$--\x3e")}if(s.byteSize>e.progressiveChunkSize)return s.rootSegmentID=e.nextSegmentId++,e.completedBoundaries.push(s),C(n,e.responseState,s.id),nt(e,n,r),n.push("\x3c!--/$--\x3e");if(e.responseState.generateStaticMarkup||n.push("\x3c!--$--\x3e"),1!==(r=s.completedSegments).length)throw Error(t(391));return rt(e,n,r[0]),!!e.responseState.generateStaticMarkup||n.push("\x3c!--/$--\x3e")}function st(e,n,r){return function(e,n,r,s){switch(r.insertionMode){case 0:case 1:return e.push('<div hidden id="'),e.push(n.segmentPrefix),n=s.toString(16),e.push(n),e.push('">');case 2:return e.push('<svg aria-hidden="true" style="display:none" id="'),e.push(n.segmentPrefix),n=s.toString(16),e.push(n),e.push('">');case 3:return e.push('<math aria-hidden="true" style="display:none" id="'),e.push(n.segmentPrefix),n=s.toString(16),e.push(n),e.push('">');case 4:return e.push('<table hidden id="'),e.push(n.segmentPrefix),n=s.toString(16),e.push(n),e.push('">');case 5:return e.push('<table hidden><tbody id="'),e.push(n.segmentPrefix),n=s.toString(16),e.push(n),e.push('">');case 6:return e.push('<table hidden><tr id="'),e.push(n.segmentPrefix),n=s.toString(16),e.push(n),e.push('">');case 7:return e.push('<table hidden><colgroup id="'),e.push(n.segmentPrefix),n=s.toString(16),e.push(n),e.push('">');default:throw Error(t(397))}}(n,e.responseState,r.formatContext,r.id),rt(e,n,r),function(e,n){switch(n.insertionMode){case 0:case 1:return e.push("</div>");case 2:return e.push("</svg>");case 3:return e.push("</math>");case 4:return e.push("</table>");case 5:return e.push("</tbody></table>");case 6:return e.push("</tr></table>");case 7:return e.push("</colgroup></table>");default:throw Error(t(397))}}(n,r.formatContext)}function it(e,n,r){for(var s=r.completedSegments,i=0;i<s.length;i++)ot(e,n,r,s[i]);if(s.length=0,e=e.responseState,s=r.id,r=r.rootSegmentID,n.push(e.startInlineScript),e.sentCompleteBoundaryFunction?n.push('$RC("'):(e.sentCompleteBoundaryFunction=!0,n.push('function $RC(a,b){a=document.getElementById(a);b=document.getElementById(b);b.parentNode.removeChild(b);if(a){a=a.previousSibling;var f=a.parentNode,c=a.nextSibling,e=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d)if(0===e)break;else e--;else"$"!==d&&"$?"!==d&&"$!"!==d||e++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;b.firstChild;)f.insertBefore(b.firstChild,c);a.data="$";a._reactRetry&&a._reactRetry()}};$RC("')),null===s)throw Error(t(395));return r=r.toString(16),n.push(s),n.push('","'),n.push(e.segmentPrefix),n.push(r),n.push('")<\/script>')}function ot(e,n,r,s){if(2===s.status)return!0;var i=s.id;if(-1===i){if(-1===(s.id=r.rootSegmentID))throw Error(t(392));return st(e,n,s)}return st(e,n,s),e=e.responseState,n.push(e.startInlineScript),e.sentCompleteSegmentFunction?n.push('$RS("'):(e.sentCompleteSegmentFunction=!0,n.push('function $RS(a,b){a=document.getElementById(a);b=document.getElementById(b);for(a.parentNode.removeChild(a);a.firstChild;)b.parentNode.insertBefore(a.firstChild,b);b.parentNode.removeChild(b)};$RS("')),n.push(e.segmentPrefix),i=i.toString(16),n.push(i),n.push('","'),n.push(e.placeholderPrefix),n.push(i),n.push('")<\/script>')}function at(e,n){try{var r=e.completedRootSegment;if(null!==r&&0===e.pendingRootTasks){rt(e,n,r),e.completedRootSegment=null;var s=e.responseState.bootstrapChunks;for(r=0;r<s.length-1;r++)n.push(s[r]);r<s.length&&n.push(s[r])}var i,o=e.clientRenderedBoundaries;for(i=0;i<o.length;i++){var a=o[i];s=n;var l=e.responseState,c=a.id,u=a.errorDigest,h=a.errorMessage,d=a.errorComponentStack;if(s.push(l.startInlineScript),l.sentClientRenderFunction?s.push('$RX("'):(l.sentClientRenderFunction=!0,s.push('function $RX(b,c,d,e){var a=document.getElementById(b);a&&(b=a.previousSibling,b.data="$!",a=a.dataset,c&&(a.dgst=c),d&&(a.msg=d),e&&(a.stck=e),b._reactRetry&&b._reactRetry())};$RX("')),null===c)throw Error(t(395));if(s.push(c),s.push('"'),u||h||d){s.push(",");var f=I(u||"");s.push(f)}if(h||d){s.push(",");var p=I(h||"");s.push(p)}if(d){s.push(",");var g=I(d);s.push(g)}if(!s.push(")<\/script>"))return e.destination=null,i++,void o.splice(0,i)}o.splice(0,i);var m=e.completedBoundaries;for(i=0;i<m.length;i++)if(!it(e,n,m[i]))return e.destination=null,i++,void m.splice(0,i);m.splice(0,i);var _=e.partialBoundaries;for(i=0;i<_.length;i++){var y=_[i];e:{o=e,a=n;var b=y.completedSegments;for(l=0;l<b.length;l++)if(!ot(o,a,y,b[l])){l++,b.splice(0,l);var v=!1;break e}b.splice(0,l),v=!0}if(!v)return e.destination=null,i++,void _.splice(0,i)}_.splice(0,i);var x=e.completedBoundaries;for(i=0;i<x.length;i++)if(!it(e,n,x[i]))return e.destination=null,i++,void x.splice(0,i);x.splice(0,i)}finally{0===e.allPendingTasks&&0===e.pingedTasks.length&&0===e.clientRenderedBoundaries.length&&0===e.completedBoundaries.length&&n.push(null)}}function lt(e,t){try{var n=e.abortableTasks;n.forEach(function(n){return Qe(n,e,t)}),n.clear(),null!==e.destination&&at(e,e.destination)}catch(r){Ge(e,r),ze(e,r)}}function ct(){}function ut(e,n,r,s){var i=!1,o=null,a="",l={push:function(e){return null!==e&&(a+=e),!0},destroy:function(e){i=!0,o=e}},c=!1;if(e=function(e,t,n,r,s,i,o){var a=[],l=new Set;return(n=Ve(t={destination:null,responseState:t,progressiveChunkSize:r,status:0,fatalError:null,nextSegmentId:0,allPendingTasks:0,pendingRootTasks:0,completedRootSegment:null,abortableTasks:l,pingedTasks:a,clientRenderedBoundaries:[],completedBoundaries:[],partialBoundaries:[],onError:void 0===s?Be:s,onAllReady:Ue,onShellReady:void 0===o?Ue:o,onShellError:Ue,onFatalError:Ue},0,null,n,!1,!1)).parentFlushed=!0,e=je(t,e,null,n,l,Z,null,le),a.push(e),t}(e,function(e,t){return{bootstrapChunks:[],startInlineScript:"<script>",placeholderPrefix:(t=void 0===t?"":t)+"P:",segmentPrefix:t+"S:",boundaryPrefix:t+"B:",idPrefix:t,nextSuspenseID:0,sentCompleteSegmentFunction:!1,sentCompleteBoundaryFunction:!1,sentClientRenderFunction:!1,generateStaticMarkup:e}}(r,n?n.identifierPrefix:void 0),{insertionMode:1,selectedValue:null},1/0,ct,0,function(){c=!0}),tt(e),lt(e,s),1===e.status)e.status=2,l.destroy(e.fatalError);else if(2!==e.status&&null===e.destination){e.destination=l;try{at(e,l)}catch(u){Ge(e,u),ze(e,u)}}if(i)throw o;if(!c)throw Error(t(426));return a}return be.renderToNodeStream=function(){throw Error(t(207))},be.renderToStaticMarkup=function(e,t){return ut(e,t,!0,'The server used "renderToStaticMarkup" which does not support Suspense. If you intended to have the server wait for the suspended component please switch to "renderToReadableStream" which supports Suspense on the server')},be.renderToStaticNodeStream=function(){throw Error(t(208))},be.renderToString=function(e,t){return ut(e,t,!1,'The server used "renderToString" which does not support Suspense. If you intended for this Suspense boundary to render the fallback content on the server consider throwing an Error somewhere within the Suspense boundary. If you intended to have the server wait for the suspended component please switch to "renderToReadableStream" which supports Suspense on the server')},be.version="18.3.1",be}(),Te=function(){if(ve)return we;ve=1;var e=g();function t(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=null,r=0;function s(e,t){if(0!==t.length)if(512<t.length)0<r&&(e.enqueue(new Uint8Array(n.buffer,0,r)),n=new Uint8Array(512),r=0),e.enqueue(t);else{var s=n.length-r;s<t.length&&(0===s?e.enqueue(n):(n.set(t.subarray(0,s),r),e.enqueue(n),t=t.subarray(s)),n=new Uint8Array(512),r=0),n.set(t,r),r+=t.length}}function i(e,t){return s(e,t),!0}function o(e){n&&0<r&&(e.enqueue(new Uint8Array(n.buffer,0,r)),n=null,r=0)}var a=new TextEncoder;function l(e){return a.encode(e)}function c(e){return a.encode(e)}function u(e,t){"function"==typeof e.error?e.error(t):e.close()}var h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function m(e){return!!h.call(p,e)||!h.call(f,e)&&(d.test(e)?p[e]=!0:(f[e]=!0,!1))}function _(e,t,n,r,s,i,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var y={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){y[e]=new _(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];y[t]=new _(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){y[e]=new _(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){y[e]=new _(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){y[e]=new _(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){y[e]=new _(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){y[e]=new _(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){y[e]=new _(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){y[e]=new _(e,5,!1,e.toLowerCase(),null,!1,!1)});var b=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(b,v);y[t]=new _(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(b,v);y[t]=new _(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(b,v);y[t]=new _(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){y[e]=new _(e,1,!1,e.toLowerCase(),null,!1,!1)}),y.xlinkHref=new _("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){y[e]=new _(e,1,!1,e.toLowerCase(),null,!0,!0)});var x={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},w=["Webkit","ms","Moz","O"];Object.keys(x).forEach(function(e){w.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),x[t]=x[e]})});var E=/["'&<>]/;function T(e){if("boolean"==typeof e||"number"==typeof e)return""+e;e=""+e;var t=E.exec(e);if(t){var n,r="",s=0;for(n=t.index;n<e.length;n++){switch(e.charCodeAt(n)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#x27;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}s!==n&&(r+=e.substring(s,n)),s=n+1,r+=t}e=s!==n?r+e.substring(s,n):r}return e}var S=/([A-Z])/g,A=/^ms-/,R=Array.isArray,C=c("<script>"),k=c("<\/script>"),I=c('<script src="'),P=c('<script type="module" src="'),M=c('" async=""><\/script>'),N=/(<\/|<)(s)(cript)/gi;function L(e,t,n,r){return t+("s"===n?"\\u0073":"\\u0053")+r}function O(e,t){return{insertionMode:e,selectedValue:t}}var F=c("\x3c!-- --\x3e");function D(e,t,n,r){return""===t?r:(r&&e.push(F),e.push(l(T(t))),!0)}var B=new Map,U=c(' style="'),j=c(":"),V=c(";");function G(e,n,r){if("object"!=typeof r)throw Error(t(62));for(var s in n=!0,r)if(h.call(r,s)){var i=r[s];if(null!=i&&"boolean"!=typeof i&&""!==i){if(0===s.indexOf("--")){var o=l(T(s));i=l(T((""+i).trim()))}else{o=s;var a=B.get(o);void 0!==a||(a=c(T(o.replace(S,"-$1").toLowerCase().replace(A,"-ms-"))),B.set(o,a)),o=a,i="number"==typeof i?0===i||h.call(x,s)?l(""+i):l(i+"px"):l(T((""+i).trim()))}n?(n=!1,e.push(U,o,j,i)):e.push(V,o,j,i)}}n||e.push(H)}var z=c(" "),W=c('="'),H=c('"'),$=c('=""');function X(e,t,n,r){switch(n){case"style":return void G(e,t,r);case"defaultValue":case"defaultChecked":case"innerHTML":case"suppressContentEditableWarning":case"suppressHydrationWarning":return}if(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])if(null!==(t=y.hasOwnProperty(n)?y[n]:null)){switch(typeof r){case"function":case"symbol":return;case"boolean":if(!t.acceptsBooleans)return}switch(n=l(t.attributeName),t.type){case 3:r&&e.push(z,n,$);break;case 4:!0===r?e.push(z,n,$):!1!==r&&e.push(z,n,W,l(T(r)),H);break;case 5:isNaN(r)||e.push(z,n,W,l(T(r)),H);break;case 6:!isNaN(r)&&1<=r&&e.push(z,n,W,l(T(r)),H);break;default:t.sanitizeURL&&(r=""+r),e.push(z,n,W,l(T(r)),H)}}else if(m(n)){switch(typeof r){case"function":case"symbol":return;case"boolean":if("data-"!==(t=n.toLowerCase().slice(0,5))&&"aria-"!==t)return}e.push(z,l(n),W,l(T(r)),H)}}var q=c(">"),Y=c("/>");function K(e,n,r){if(null!=n){if(null!=r)throw Error(t(60));if("object"!=typeof n||!("__html"in n))throw Error(t(61));null!=(n=n.__html)&&e.push(l(""+n))}}var Z=c(' selected=""');function Q(e,t,n,r){e.push(ne(n));var s,i=n=null;for(s in t)if(h.call(t,s)){var o=t[s];if(null!=o)switch(s){case"children":n=o;break;case"dangerouslySetInnerHTML":i=o;break;default:X(e,r,s,o)}}return e.push(q),K(e,i,n),"string"==typeof n?(e.push(l(T(n))),null):n}var J=c("\n"),ee=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,te=new Map;function ne(e){var n=te.get(e);if(void 0===n){if(!ee.test(e))throw Error(t(65,e));n=c("<"+e),te.set(e,n)}return n}var re=c("<!DOCTYPE html>"),se=c("</"),ie=c(">"),oe=c('<template id="'),ae=c('"></template>'),le=c("\x3c!--$--\x3e"),ce=c('\x3c!--$?--\x3e<template id="'),ue=c('"></template>'),he=c("\x3c!--$!--\x3e"),de=c("\x3c!--/$--\x3e"),fe=c("<template"),pe=c('"'),ge=c(' data-dgst="');c(' data-msg="'),c(' data-stck="');var me=c("></template>");function _e(e,n,r){if(s(e,ce),null===r)throw Error(t(395));return s(e,r),i(e,ue)}var ye=c('<div hidden id="'),be=c('">'),xe=c("</div>"),Ee=c('<svg aria-hidden="true" style="display:none" id="'),Te=c('">'),Se=c("</svg>"),Ae=c('<math aria-hidden="true" style="display:none" id="'),Re=c('">'),Ce=c("</math>"),ke=c('<table hidden id="'),Ie=c('">'),Pe=c("</table>"),Me=c('<table hidden><tbody id="'),Ne=c('">'),Le=c("</tbody></table>"),Oe=c('<table hidden><tr id="'),Fe=c('">'),De=c("</tr></table>"),Be=c('<table hidden><colgroup id="'),Ue=c('">'),je=c("</colgroup></table>"),Ve=c('function $RS(a,b){a=document.getElementById(a);b=document.getElementById(b);for(a.parentNode.removeChild(a);a.firstChild;)b.parentNode.insertBefore(a.firstChild,b);b.parentNode.removeChild(b)};$RS("'),Ge=c('$RS("'),ze=c('","'),We=c('")<\/script>'),He=c('function $RC(a,b){a=document.getElementById(a);b=document.getElementById(b);b.parentNode.removeChild(b);if(a){a=a.previousSibling;var f=a.parentNode,c=a.nextSibling,e=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d)if(0===e)break;else e--;else"$"!==d&&"$?"!==d&&"$!"!==d||e++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;b.firstChild;)f.insertBefore(b.firstChild,c);a.data="$";a._reactRetry&&a._reactRetry()}};$RC("'),$e=c('$RC("'),Xe=c('","'),qe=c('")<\/script>'),Ye=c('function $RX(b,c,d,e){var a=document.getElementById(b);a&&(b=a.previousSibling,b.data="$!",a=a.dataset,c&&(a.dgst=c),d&&(a.msg=d),e&&(a.stck=e),b._reactRetry&&b._reactRetry())};$RX("'),Ke=c('$RX("'),Ze=c('"'),Qe=c(")<\/script>"),Je=c(","),et=/[<\u2028\u2029]/g;function tt(e){return JSON.stringify(e).replace(et,function(e){switch(e){case"<":return"\\u003c";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:throw Error("escapeJSStringsForInstructionScripts encountered a match it does not know how to replace. this means the match regex and the replacement characters are no longer in sync. This is a bug in React")}})}var nt=Object.assign,rt=Symbol.for("react.element"),st=Symbol.for("react.portal"),it=Symbol.for("react.fragment"),ot=Symbol.for("react.strict_mode"),at=Symbol.for("react.profiler"),lt=Symbol.for("react.provider"),ct=Symbol.for("react.context"),ut=Symbol.for("react.forward_ref"),ht=Symbol.for("react.suspense"),dt=Symbol.for("react.suspense_list"),ft=Symbol.for("react.memo"),pt=Symbol.for("react.lazy"),gt=Symbol.for("react.scope"),mt=Symbol.for("react.debug_trace_mode"),_t=Symbol.for("react.legacy_hidden"),yt=Symbol.for("react.default_value"),bt=Symbol.iterator;function vt(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case it:return"Fragment";case st:return"Portal";case at:return"Profiler";case ot:return"StrictMode";case ht:return"Suspense";case dt:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case ct:return(e.displayName||"Context")+".Consumer";case lt:return(e._context.displayName||"Context")+".Provider";case ut:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case ft:return null!==(t=e.displayName||null)?t:vt(e.type)||"Memo";case pt:t=e._payload,e=e._init;try{return vt(e(t))}catch(n){}}return null}var xt={};function wt(e,t){if(!(e=e.contextTypes))return xt;var n,r={};for(n in e)r[n]=t[n];return r}var Et=null;function Tt(e,n){if(e!==n){e.context._currentValue=e.parentValue,e=e.parent;var r=n.parent;if(null===e){if(null!==r)throw Error(t(401))}else{if(null===r)throw Error(t(401));Tt(e,r)}n.context._currentValue=n.value}}function St(e){e.context._currentValue=e.parentValue,null!==(e=e.parent)&&St(e)}function At(e){var t=e.parent;null!==t&&At(t),e.context._currentValue=e.value}function Rt(e,n){if(e.context._currentValue=e.parentValue,null===(e=e.parent))throw Error(t(402));e.depth===n.depth?Tt(e,n):Rt(e,n)}function Ct(e,n){var r=n.parent;if(null===r)throw Error(t(402));e.depth===r.depth?Tt(e,r):Ct(e,r),n.context._currentValue=n.value}function kt(e){var t=Et;t!==e&&(null===t?At(e):null===e?St(t):t.depth===e.depth?Tt(t,e):t.depth>e.depth?Rt(t,e):Ct(t,e),Et=e)}var It={isMounted:function(){return!1},enqueueSetState:function(e,t){null!==(e=e._reactInternals).queue&&e.queue.push(t)},enqueueReplaceState:function(e,t){(e=e._reactInternals).replace=!0,e.queue=[t]},enqueueForceUpdate:function(){}};function Pt(e,t,n,r){var s=void 0!==e.state?e.state:null;e.updater=It,e.props=n,e.state=s;var i={queue:[],replace:!1};e._reactInternals=i;var o=t.contextType;if(e.context="object"==typeof o&&null!==o?o._currentValue:r,"function"==typeof(o=t.getDerivedStateFromProps)&&(s=null==(o=o(n,s))?s:nt({},s,o),e.state=s),"function"!=typeof t.getDerivedStateFromProps&&"function"!=typeof e.getSnapshotBeforeUpdate&&("function"==typeof e.UNSAFE_componentWillMount||"function"==typeof e.componentWillMount))if(t=e.state,"function"==typeof e.componentWillMount&&e.componentWillMount(),"function"==typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),t!==e.state&&It.enqueueReplaceState(e,e.state,null),null!==i.queue&&0<i.queue.length)if(t=i.queue,o=i.replace,i.queue=null,i.replace=!1,o&&1===t.length)e.state=t[0];else{for(i=o?t[0]:e.state,s=!0,o=o?1:0;o<t.length;o++){var a=t[o];null!=(a="function"==typeof a?a.call(e,i,n,r):a)&&(s?(s=!1,i=nt({},i,a)):nt(i,a))}e.state=i}else i.queue=null}var Mt={id:1,overflow:""};function Nt(e,t,n){var r=e.id;e=e.overflow;var s=32-Lt(r)-1;r&=~(1<<s),n+=1;var i=32-Lt(t)+s;if(30<i){var o=s-s%5;return i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,{id:1<<32-Lt(t)+s|n<<s|r,overflow:i+e}}return{id:1<<i|n<<s|r,overflow:e}}var Lt=Math.clz32?Math.clz32:function(e){return 0==(e>>>=0)?32:31-(Ot(e)/Ft|0)|0},Ot=Math.log,Ft=Math.LN2,Dt="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},Bt=null,Ut=null,jt=null,Vt=null,Gt=!1,zt=!1,Wt=0,Ht=null,$t=0;function Xt(){if(null===Bt)throw Error(t(321));return Bt}function qt(){if(0<$t)throw Error(t(312));return{memoizedState:null,queue:null,next:null}}function Yt(){return null===Vt?null===jt?(Gt=!1,jt=Vt=qt()):(Gt=!0,Vt=jt):null===Vt.next?(Gt=!1,Vt=Vt.next=qt()):(Gt=!0,Vt=Vt.next),Vt}function Kt(){Ut=Bt=null,zt=!1,jt=null,$t=0,Vt=Ht=null}function Zt(e,t){return"function"==typeof t?t(e):t}function Qt(e,t,n){if(Bt=Xt(),Vt=Yt(),Gt){var r=Vt.queue;if(t=r.dispatch,null!==Ht&&void 0!==(n=Ht.get(r))){Ht.delete(r),r=Vt.memoizedState;do{r=e(r,n.action),n=n.next}while(null!==n);return Vt.memoizedState=r,[r,t]}return[Vt.memoizedState,t]}return e=e===Zt?"function"==typeof t?t():t:void 0!==n?n(t):t,Vt.memoizedState=e,e=(e=Vt.queue={last:null,dispatch:null}).dispatch=en.bind(null,Bt,e),[Vt.memoizedState,e]}function Jt(e,t){if(Bt=Xt(),t=void 0===t?null:t,null!==(Vt=Yt())){var n=Vt.memoizedState;if(null!==n&&null!==t){var r=n[1];e:if(null===r)r=!1;else{for(var s=0;s<r.length&&s<t.length;s++)if(!Dt(t[s],r[s])){r=!1;break e}r=!0}if(r)return n[0]}}return e=e(),Vt.memoizedState=[e,t],e}function en(e,n,r){if(25<=$t)throw Error(t(301));if(e===Bt)if(zt=!0,e={action:r,next:null},null===Ht&&(Ht=new Map),void 0===(r=Ht.get(n)))Ht.set(n,e);else{for(n=r;null!==n.next;)n=n.next;n.next=e}}function tn(){throw Error(t(394))}function nn(){}var rn={readContext:function(e){return e._currentValue},useContext:function(e){return Xt(),e._currentValue},useMemo:Jt,useReducer:Qt,useRef:function(e){Bt=Xt();var t=(Vt=Yt()).memoizedState;return null===t?(e={current:e},Vt.memoizedState=e):t},useState:function(e){return Qt(Zt,e)},useInsertionEffect:nn,useLayoutEffect:function(){},useCallback:function(e,t){return Jt(function(){return e},t)},useImperativeHandle:nn,useEffect:nn,useDebugValue:nn,useDeferredValue:function(e){return Xt(),e},useTransition:function(){return Xt(),[!1,tn]},useId:function(){var e=Ut.treeContext,n=e.overflow;e=((e=e.id)&~(1<<32-Lt(e)-1)).toString(32)+n;var r=sn;if(null===r)throw Error(t(404));return n=Wt++,e=":"+r.idPrefix+"R"+e,0<n&&(e+="H"+n.toString(32)),e+":"},useMutableSource:function(e,t){return Xt(),t(e._source)},useSyncExternalStore:function(e,n,r){if(void 0===r)throw Error(t(407));return r()}},sn=null,on=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentDispatcher;function an(e){return null}function ln(){}function cn(e,t,n,r,s,i,o,a){e.allPendingTasks++,null===n?e.pendingRootTasks++:n.pendingTasks++;var l={node:t,ping:function(){var t=e.pingedTasks;t.push(l),1===t.length&&Tn(e)},blockedBoundary:n,blockedSegment:r,abortSet:s,legacyContext:i,context:o,treeContext:a};return s.add(l),l}function un(e,t,n,r,s,i){return{status:0,id:-1,index:t,parentFlushed:!1,chunks:[],children:[],formatContext:r,boundary:n,lastPushedText:s,textEmbedded:i}}function hn(e,t){if(null!=(e=e.onError(t))&&"string"!=typeof e)throw Error('onError returned something with a type other than "string". onError should return a string and may return null or undefined but must not return anything else. It received something of type "'+typeof e+'" instead');return e}function dn(e,t){var n=e.onShellError;n(t),(n=e.onFatalError)(t),null!==e.destination?(e.status=2,u(e.destination,t)):(e.status=1,e.fatalError=t)}function fn(e,t,n,r,s){for(Bt={},Ut=t,Wt=0,e=n(r,s);zt;)zt=!1,Wt=0,$t+=1,Vt=null,e=n(r,s);return Kt(),e}function pn(e,n,r,s){var i=r.render(),o=s.childContextTypes;if(null!=o){var a=n.legacyContext;if("function"!=typeof r.getChildContext)s=a;else{for(var l in r=r.getChildContext())if(!(l in o))throw Error(t(108,vt(s)||"Unknown",l));s=nt({},a,r)}n.legacyContext=s,_n(e,n,i),n.legacyContext=a}else _n(e,n,i)}function gn(e,t){if(e&&e.defaultProps){for(var n in t=nt({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function mn(n,r,s,i,o){if("function"==typeof s)if(s.prototype&&s.prototype.isReactComponent){o=wt(s,r.legacyContext);var a=s.contextType;Pt(a=new s(i,"object"==typeof a&&null!==a?a._currentValue:o),s,i,o),pn(n,r,a,s)}else{o=fn(n,r,s,i,a=wt(s,r.legacyContext));var c=0!==Wt;if("object"==typeof o&&null!==o&&"function"==typeof o.render&&void 0===o.$$typeof)Pt(o,s,i,a),pn(n,r,o,s);else if(c){i=r.treeContext,r.treeContext=Nt(i,1,0);try{_n(n,r,o)}finally{r.treeContext=i}}else _n(n,r,o)}else{if("string"!=typeof s){switch(s){case _t:case mt:case ot:case at:case it:case dt:return void _n(n,r,i.children);case gt:throw Error(t(343));case ht:e:{s=r.blockedBoundary,o=r.blockedSegment,a=i.fallback,i=i.children;var u={id:null,rootSegmentID:-1,parentFlushed:!1,pendingTasks:0,forceClientRender:!1,completedSegments:[],byteSize:0,fallbackAbortableTasks:c=new Set,errorDigest:null},d=un(0,o.chunks.length,u,o.formatContext,!1,!1);o.children.push(d),o.lastPushedText=!1;var f=un(0,0,null,o.formatContext,!1,!1);f.parentFlushed=!0,r.blockedBoundary=u,r.blockedSegment=f;try{if(bn(n,r,i),f.lastPushedText&&f.textEmbedded&&f.chunks.push(F),f.status=1,wn(u,f),0===u.pendingTasks)break e}catch(p){f.status=4,u.forceClientRender=!0,u.errorDigest=hn(n,p)}finally{r.blockedBoundary=s,r.blockedSegment=o}r=cn(n,a,s,d,c,r.legacyContext,r.context,r.treeContext),n.pingedTasks.push(r)}return}if("object"==typeof s&&null!==s)switch(s.$$typeof){case ut:if(i=fn(n,r,s.render,i,o),0!==Wt){s=r.treeContext,r.treeContext=Nt(s,1,0);try{_n(n,r,i)}finally{r.treeContext=s}}else _n(n,r,i);return;case ft:return void mn(n,r,s=s.type,i=gn(s,i),o);case lt:if(o=i.children,s=s._context,i=i.value,a=s._currentValue,s._currentValue=i,Et=i={parent:c=Et,depth:null===c?0:c.depth+1,context:s,parentValue:a,value:i},r.context=i,_n(n,r,o),null===(n=Et))throw Error(t(403));return i=n.parentValue,n.context._currentValue=i===yt?n.context._defaultValue:i,n=Et=n.parent,void(r.context=n);case ct:return void _n(n,r,i=(i=i.children)(s._currentValue));case pt:return void mn(n,r,s=(o=s._init)(s._payload),i=gn(s,i),void 0)}throw Error(t(130,null==s?s:typeof s,""))}switch(a=function(n,r,s,i,o){switch(r){case"select":n.push(ne("select"));var a=null,c=null;for(p in s)if(h.call(s,p)){var u=s[p];if(null!=u)switch(p){case"children":a=u;break;case"dangerouslySetInnerHTML":c=u;break;case"defaultValue":case"value":break;default:X(n,i,p,u)}}return n.push(q),K(n,c,a),a;case"option":c=o.selectedValue,n.push(ne("option"));var d=u=null,f=null,p=null;for(a in s)if(h.call(s,a)){var g=s[a];if(null!=g)switch(a){case"children":u=g;break;case"selected":f=g;break;case"dangerouslySetInnerHTML":p=g;break;case"value":d=g;default:X(n,i,a,g)}}if(null!=c)if(s=null!==d?""+d:function(t){var n="";return e.Children.forEach(t,function(e){null!=e&&(n+=e)}),n}(u),R(c)){for(i=0;i<c.length;i++)if(""+c[i]===s){n.push(Z);break}}else""+c===s&&n.push(Z);else f&&n.push(Z);return n.push(q),K(n,p,u),u;case"textarea":for(u in n.push(ne("textarea")),p=c=a=null,s)if(h.call(s,u)&&null!=(d=s[u]))switch(u){case"children":p=d;break;case"value":a=d;break;case"defaultValue":c=d;break;case"dangerouslySetInnerHTML":throw Error(t(91));default:X(n,i,u,d)}if(null===a&&null!==c&&(a=c),n.push(q),null!=p){if(null!=a)throw Error(t(92));if(R(p)&&1<p.length)throw Error(t(93));a=""+p}return"string"==typeof a&&"\n"===a[0]&&n.push(J),null!==a&&n.push(l(T(""+a))),null;case"input":for(c in n.push(ne("input")),d=p=u=a=null,s)if(h.call(s,c)&&null!=(f=s[c]))switch(c){case"children":case"dangerouslySetInnerHTML":throw Error(t(399,"input"));case"defaultChecked":d=f;break;case"defaultValue":u=f;break;case"checked":p=f;break;case"value":a=f;break;default:X(n,i,c,f)}return null!==p?X(n,i,"checked",p):null!==d&&X(n,i,"checked",d),null!==a?X(n,i,"value",a):null!==u&&X(n,i,"value",u),n.push(Y),null;case"menuitem":for(var _ in n.push(ne("menuitem")),s)if(h.call(s,_)&&null!=(a=s[_]))switch(_){case"children":case"dangerouslySetInnerHTML":throw Error(t(400));default:X(n,i,_,a)}return n.push(q),null;case"title":for(g in n.push(ne("title")),a=null,s)if(h.call(s,g)&&null!=(c=s[g]))switch(g){case"children":a=c;break;case"dangerouslySetInnerHTML":throw Error(t(434));default:X(n,i,g,c)}return n.push(q),a;case"listing":case"pre":for(d in n.push(ne(r)),c=a=null,s)if(h.call(s,d)&&null!=(u=s[d]))switch(d){case"children":a=u;break;case"dangerouslySetInnerHTML":c=u;break;default:X(n,i,d,u)}if(n.push(q),null!=c){if(null!=a)throw Error(t(60));if("object"!=typeof c||!("__html"in c))throw Error(t(61));null!=(s=c.__html)&&("string"==typeof s&&0<s.length&&"\n"===s[0]?n.push(J,l(s)):n.push(l(""+s)))}return"string"==typeof a&&"\n"===a[0]&&n.push(J),a;case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":for(var y in n.push(ne(r)),s)if(h.call(s,y)&&null!=(a=s[y]))switch(y){case"children":case"dangerouslySetInnerHTML":throw Error(t(399,r));default:X(n,i,y,a)}return n.push(Y),null;case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return Q(n,s,r,i);case"html":return 0===o.insertionMode&&n.push(re),Q(n,s,r,i);default:if(-1===r.indexOf("-")&&"string"!=typeof s.is)return Q(n,s,r,i);for(f in n.push(ne(r)),c=a=null,s)if(h.call(s,f)&&null!=(u=s[f]))switch(f){case"children":a=u;break;case"dangerouslySetInnerHTML":c=u;break;case"style":G(n,i,u);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":break;default:m(f)&&"function"!=typeof u&&"symbol"!=typeof u&&n.push(z,l(f),W,l(T(u)),H)}return n.push(q),K(n,c,a),a}}((o=r.blockedSegment).chunks,s,i,n.responseState,o.formatContext),o.lastPushedText=!1,c=o.formatContext,o.formatContext=function(e,t,n){switch(t){case"select":return O(1,null!=n.value?n.value:n.defaultValue);case"svg":return O(2,null);case"math":return O(3,null);case"foreignObject":return O(1,null);case"table":return O(4,null);case"thead":case"tbody":case"tfoot":return O(5,null);case"colgroup":return O(7,null);case"tr":return O(6,null)}return 4<=e.insertionMode||0===e.insertionMode?O(1,null):e}(c,s,i),bn(n,r,a),o.formatContext=c,s){case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"input":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":break;default:o.chunks.push(se,l(s),ie)}o.lastPushedText=!1}}function _n(e,n,r){if(n.node=r,"object"==typeof r&&null!==r){switch(r.$$typeof){case rt:return void mn(e,n,r.type,r.props,r.ref);case st:throw Error(t(257));case pt:var s=r._init;return void _n(e,n,r=s(r._payload))}if(R(r))return void yn(e,n,r);if((s=null===r||"object"!=typeof r?null:"function"==typeof(s=bt&&r[bt]||r["@@iterator"])?s:null)&&(s=s.call(r))){if(!(r=s.next()).done){var i=[];do{i.push(r.value),r=s.next()}while(!r.done);yn(e,n,i)}return}throw e=Object.prototype.toString.call(r),Error(t(31,"[object Object]"===e?"object with keys {"+Object.keys(r).join(", ")+"}":e))}"string"==typeof r?(s=n.blockedSegment).lastPushedText=D(n.blockedSegment.chunks,r,e.responseState,s.lastPushedText):"number"==typeof r&&((s=n.blockedSegment).lastPushedText=D(n.blockedSegment.chunks,""+r,e.responseState,s.lastPushedText))}function yn(e,t,n){for(var r=n.length,s=0;s<r;s++){var i=t.treeContext;t.treeContext=Nt(i,r,s);try{bn(e,t,n[s])}finally{t.treeContext=i}}}function bn(e,t,n){var r=t.blockedSegment.formatContext,s=t.legacyContext,i=t.context;try{return _n(e,t,n)}catch(l){if(Kt(),"object"!=typeof l||null===l||"function"!=typeof l.then)throw t.blockedSegment.formatContext=r,t.legacyContext=s,t.context=i,kt(i),l;n=l;var o=t.blockedSegment,a=un(0,o.chunks.length,null,o.formatContext,o.lastPushedText,!0);o.children.push(a),o.lastPushedText=!1,e=cn(e,t.node,t.blockedBoundary,a,t.abortSet,t.legacyContext,t.context,t.treeContext).ping,n.then(e,e),t.blockedSegment.formatContext=r,t.legacyContext=s,t.context=i,kt(i)}}function vn(e){var t=e.blockedBoundary;(e=e.blockedSegment).status=3,En(this,t,e)}function xn(e,n,r){var s=e.blockedBoundary;e.blockedSegment.status=3,null===s?(n.allPendingTasks--,2!==n.status&&(n.status=2,null!==n.destination&&n.destination.close())):(s.pendingTasks--,s.forceClientRender||(s.forceClientRender=!0,e=void 0===r?Error(t(432)):r,s.errorDigest=n.onError(e),s.parentFlushed&&n.clientRenderedBoundaries.push(s)),s.fallbackAbortableTasks.forEach(function(e){return xn(e,n,r)}),s.fallbackAbortableTasks.clear(),n.allPendingTasks--,0===n.allPendingTasks&&(s=n.onAllReady)())}function wn(e,t){if(0===t.chunks.length&&1===t.children.length&&null===t.children[0].boundary){var n=t.children[0];n.id=t.id,n.parentFlushed=!0,1===n.status&&wn(e,n)}else e.completedSegments.push(t)}function En(e,n,r){if(null===n){if(r.parentFlushed){if(null!==e.completedRootSegment)throw Error(t(389));e.completedRootSegment=r}e.pendingRootTasks--,0===e.pendingRootTasks&&(e.onShellError=ln,(n=e.onShellReady)())}else n.pendingTasks--,n.forceClientRender||(0===n.pendingTasks?(r.parentFlushed&&1===r.status&&wn(n,r),n.parentFlushed&&e.completedBoundaries.push(n),n.fallbackAbortableTasks.forEach(vn,e),n.fallbackAbortableTasks.clear()):r.parentFlushed&&1===r.status&&(wn(n,r),1===n.completedSegments.length&&n.parentFlushed&&e.partialBoundaries.push(n)));e.allPendingTasks--,0===e.allPendingTasks&&(e=e.onAllReady)()}function Tn(e){if(2!==e.status){var t=Et,n=on.current;on.current=rn;var r=sn;sn=e.responseState;try{var s,i=e.pingedTasks;for(s=0;s<i.length;s++){var o=i[s],a=e,l=o.blockedSegment;if(0===l.status){kt(o.context);try{_n(a,o,o.node),l.lastPushedText&&l.textEmbedded&&l.chunks.push(F),o.abortSet.delete(o),l.status=1,En(a,o.blockedBoundary,l)}catch(f){if(Kt(),"object"==typeof f&&null!==f&&"function"==typeof f.then){var c=o.ping;f.then(c,c)}else{o.abortSet.delete(o),l.status=4;var u=o.blockedBoundary,h=f,d=hn(a,h);null===u?dn(a,h):(u.pendingTasks--,u.forceClientRender||(u.forceClientRender=!0,u.errorDigest=d,u.parentFlushed&&a.clientRenderedBoundaries.push(u))),a.allPendingTasks--,0===a.allPendingTasks&&(0,a.onAllReady)()}}}}i.splice(0,s),null!==e.destination&&In(e,e.destination)}catch(f){hn(e,f),dn(e,f)}finally{sn=r,on.current=n,n===rn&&kt(t)}}}function Sn(e,n,r){switch(r.parentFlushed=!0,r.status){case 0:var o=r.id=e.nextSegmentId++;return r.lastPushedText=!1,r.textEmbedded=!1,e=e.responseState,s(n,oe),s(n,e.placeholderPrefix),s(n,e=l(o.toString(16))),i(n,ae);case 1:r.status=2;var a=!0;o=r.chunks;var c=0;r=r.children;for(var u=0;u<r.length;u++){for(a=r[u];c<a.index;c++)s(n,o[c]);a=An(e,n,a)}for(;c<o.length-1;c++)s(n,o[c]);return c<o.length&&(a=i(n,o[c])),a;default:throw Error(t(390))}}function An(e,n,r){var o=r.boundary;if(null===o)return Sn(e,n,r);if(o.parentFlushed=!0,o.forceClientRender)o=o.errorDigest,i(n,he),s(n,fe),o&&(s(n,ge),s(n,l(T(o))),s(n,pe)),i(n,me),Sn(e,n,r);else if(0<o.pendingTasks){o.rootSegmentID=e.nextSegmentId++,0<o.completedSegments.length&&e.partialBoundaries.push(o);var a=e.responseState,u=a.nextSuspenseID++;a=c(a.boundaryPrefix+u.toString(16)),o=o.id=a,_e(n,e.responseState,o),Sn(e,n,r)}else if(o.byteSize>e.progressiveChunkSize)o.rootSegmentID=e.nextSegmentId++,e.completedBoundaries.push(o),_e(n,e.responseState,o.id),Sn(e,n,r);else{if(i(n,le),1!==(r=o.completedSegments).length)throw Error(t(391));An(e,n,r[0])}return i(n,de)}function Rn(e,n,r){return function(e,n,r,o){switch(r.insertionMode){case 0:case 1:return s(e,ye),s(e,n.segmentPrefix),s(e,l(o.toString(16))),i(e,be);case 2:return s(e,Ee),s(e,n.segmentPrefix),s(e,l(o.toString(16))),i(e,Te);case 3:return s(e,Ae),s(e,n.segmentPrefix),s(e,l(o.toString(16))),i(e,Re);case 4:return s(e,ke),s(e,n.segmentPrefix),s(e,l(o.toString(16))),i(e,Ie);case 5:return s(e,Me),s(e,n.segmentPrefix),s(e,l(o.toString(16))),i(e,Ne);case 6:return s(e,Oe),s(e,n.segmentPrefix),s(e,l(o.toString(16))),i(e,Fe);case 7:return s(e,Be),s(e,n.segmentPrefix),s(e,l(o.toString(16))),i(e,Ue);default:throw Error(t(397))}}(n,e.responseState,r.formatContext,r.id),An(e,n,r),function(e,n){switch(n.insertionMode){case 0:case 1:return i(e,xe);case 2:return i(e,Se);case 3:return i(e,Ce);case 4:return i(e,Pe);case 5:return i(e,Le);case 6:return i(e,De);case 7:return i(e,je);default:throw Error(t(397))}}(n,r.formatContext)}function Cn(e,n,r){for(var o=r.completedSegments,a=0;a<o.length;a++)kn(e,n,r,o[a]);if(o.length=0,e=e.responseState,o=r.id,r=r.rootSegmentID,s(n,e.startInlineScript),e.sentCompleteBoundaryFunction?s(n,$e):(e.sentCompleteBoundaryFunction=!0,s(n,He)),null===o)throw Error(t(395));return r=l(r.toString(16)),s(n,o),s(n,Xe),s(n,e.segmentPrefix),s(n,r),i(n,qe)}function kn(e,n,r,o){if(2===o.status)return!0;var a=o.id;if(-1===a){if(-1===(o.id=r.rootSegmentID))throw Error(t(392));return Rn(e,n,o)}return Rn(e,n,o),s(n,(e=e.responseState).startInlineScript),e.sentCompleteSegmentFunction?s(n,Ge):(e.sentCompleteSegmentFunction=!0,s(n,Ve)),s(n,e.segmentPrefix),s(n,a=l(a.toString(16))),s(n,ze),s(n,e.placeholderPrefix),s(n,a),i(n,We)}function In(e,a){n=new Uint8Array(512),r=0;try{var c=e.completedRootSegment;if(null!==c&&0===e.pendingRootTasks){An(e,a,c),e.completedRootSegment=null;var u=e.responseState.bootstrapChunks;for(c=0;c<u.length-1;c++)s(a,u[c]);c<u.length&&i(a,u[c])}var h,d=e.clientRenderedBoundaries;for(h=0;h<d.length;h++){var f=d[h];u=a;var p=e.responseState,g=f.id,m=f.errorDigest,_=f.errorMessage,y=f.errorComponentStack;if(s(u,p.startInlineScript),p.sentClientRenderFunction?s(u,Ke):(p.sentClientRenderFunction=!0,s(u,Ye)),null===g)throw Error(t(395));s(u,g),s(u,Ze),(m||_||y)&&(s(u,Je),s(u,l(tt(m||"")))),(_||y)&&(s(u,Je),s(u,l(tt(_||"")))),y&&(s(u,Je),s(u,l(tt(y)))),i(u,Qe)}d.splice(0,h);var b=e.completedBoundaries;for(h=0;h<b.length;h++)Cn(e,a,b[h]);b.splice(0,h),o(a),n=new Uint8Array(512),r=0;var v=e.partialBoundaries;for(h=0;h<v.length;h++){var x=v[h];e:{d=e,f=a;var w=x.completedSegments;for(p=0;p<w.length;p++)if(!kn(d,f,x,w[p])){p++,w.splice(0,p);var E=!1;break e}w.splice(0,p),E=!0}if(!E)return e.destination=null,h++,void v.splice(0,h)}v.splice(0,h);var T=e.completedBoundaries;for(h=0;h<T.length;h++)Cn(e,a,T[h]);T.splice(0,h)}finally{o(a),0===e.allPendingTasks&&0===e.pingedTasks.length&&0===e.clientRenderedBoundaries.length&&0===e.completedBoundaries.length&&a.close()}}function Pn(e,t){try{var n=e.abortableTasks;n.forEach(function(n){return xn(n,e,t)}),n.clear(),null!==e.destination&&In(e,e.destination)}catch(r){hn(e,r),dn(e,r)}}return we.renderToReadableStream=function(e,t){return new Promise(function(n,r){var s,i,o=new Promise(function(e,t){i=e,s=t}),a=function(e,t,n,r,s,i,o,a,l){var c=[],u=new Set;return(n=un(t={destination:null,responseState:t,progressiveChunkSize:void 0===r?12800:r,status:0,fatalError:null,nextSegmentId:0,allPendingTasks:0,pendingRootTasks:0,completedRootSegment:null,abortableTasks:u,pingedTasks:c,clientRenderedBoundaries:[],completedBoundaries:[],partialBoundaries:[],onError:void 0===s?an:s,onAllReady:void 0===i?ln:i,onShellReady:void 0===o?ln:o,onShellError:void 0===a?ln:a,onFatalError:void 0===l?ln:l},0,null,n,!1,!1)).parentFlushed=!0,e=cn(t,e,null,n,u,xt,null,Mt),c.push(e),t}(e,function(e,t,n,r,s){e=void 0===e?"":e,t=void 0===t?C:c('<script nonce="'+T(t)+'">');var i=[];if(void 0!==n&&i.push(t,l((""+n).replace(N,L)),k),void 0!==r)for(n=0;n<r.length;n++)i.push(I,l(T(r[n])),M);if(void 0!==s)for(r=0;r<s.length;r++)i.push(P,l(T(s[r])),M);return{bootstrapChunks:i,startInlineScript:t,placeholderPrefix:c(e+"P:"),segmentPrefix:c(e+"S:"),boundaryPrefix:e+"B:",idPrefix:e,nextSuspenseID:0,sentCompleteSegmentFunction:!1,sentCompleteBoundaryFunction:!1,sentClientRenderFunction:!1}}(t?t.identifierPrefix:void 0,t?t.nonce:void 0,t?t.bootstrapScriptContent:void 0,t?t.bootstrapScripts:void 0,t?t.bootstrapModules:void 0),function(e){return O("http://www.w3.org/2000/svg"===e?2:"http://www.w3.org/1998/Math/MathML"===e?3:0,null)}(t?t.namespaceURI:void 0),t?t.progressiveChunkSize:void 0,t?t.onError:void 0,i,function(){var e=new ReadableStream({type:"bytes",pull:function(e){if(1===a.status)a.status=2,u(e,a.fatalError);else if(2!==a.status&&null===a.destination){a.destination=e;try{In(a,e)}catch(t){hn(a,t),dn(a,t)}}},cancel:function(){Pn(a)}},{highWaterMark:0});e.allReady=o,n(e)},function(e){o.catch(function(){}),r(e)},s);if(t&&t.signal){var h=t.signal,d=function(){Pn(a,h.reason),h.removeEventListener("abort",d)};h.addEventListener("abort",d)}Tn(a)})},we.version="18.3.1",we}(),ye.version=Ee.version,ye.renderToString=Ee.renderToString,ye.renderToStaticMarkup=Ee.renderToStaticMarkup,ye.renderToNodeStream=Ee.renderToNodeStream,ye.renderToStaticNodeStream=Ee.renderToStaticNodeStream,ye.renderToReadableStream=Te.renderToReadableStream),ye);const Ae=new Map;function Re(e,t){const n=Ae.get(e);if(n)return n;if(Ae.size>=200){const e=Ae.keys().next().value;e&&Ae.delete(e)}const r=t();return Ae.set(e,r),r}const Ce=Se.renderToStaticMarkup(i.jsx(N,{size:16,color:q,strokeWidth:2.5,fill:"none"})),ke=Se.renderToStaticMarkup(i.jsx(R,{size:16,color:Z,strokeWidth:2.5,fill:"none"}));function Ie(e){var t;const n=null==(t=e.contact_type)?void 0:t.toLowerCase();return"room server"===n||"room_server"===n||"room"===n||"server"===n}function Pe(e){return e.startsWith("0x")?e.slice(2,4).toUpperCase():e.slice(0,2).toUpperCase()}function Me({hash:e,neighbor:t,isZeroHop:n,isHub:r,isMobile:s,isRoomServer:o,centrality:a,lastHopData:l,affinity:c,txDelayRec:u,nodeOpacity:h,isHovered:f,onHover:p,onRequestRemove:g,isPopupOpen:y,onOpenPopup:b,onClosePopup:v}){const x=t.node_name||t.name||"Unknown",w=Pe(e),E=(null==l?void 0:l.avgSnr)??void 0,T=(null==l?void 0:l.avgRssi)??void 0,S="stale"===(null==l?void 0:l.status),A=(null==l?void 0:l.lastSeen)??void 0,R=S?Math.min(h,.5):h,C=Math.round(20*R)/20,k=d.useMemo(()=>o?function(e=1,t=!1,n=!1){return Re(`roomserver:${e}:${t}:${n}`,()=>{const r=t?1.25:1;if(n){const t=16,n=t+4,s=n+2,i=(s-t)/2,o=(s-n)/2;return`<div style="\n        position: relative;\n        width: ${s}px;\n        height: ${s}px;\n        opacity: ${e};\n        filter: drop-shadow(0 1px 2px rgba(0,0,0,0.4)) brightness(${r});\n        transition: filter 0s ease-in, filter 150ms ease-out;\n      ">\n        \x3c!-- Yellow inner stroke ring --\x3e\n        <div style="\n          position: absolute;\n          top: ${o}px;\n          left: ${o}px;\n          width: ${n}px;\n          height: ${n}px;\n          background: transparent;\n          border-radius: 50%;\n          border: 2px solid ${Q};\n          box-sizing: border-box;\n          opacity: 0.85;\n        "></div>\n        \x3c!-- Icon --\x3e\n        <div style="\n          position: absolute;\n          top: ${i}px;\n          left: ${i}px;\n          width: ${t}px;\n          height: ${t}px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        ">${ke}</div>\n      </div>`}return`<div style="\n      width: 16px;\n      height: 16px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      opacity: ${e};\n      filter: drop-shadow(0 1px 2px rgba(0,0,0,0.4)) brightness(${r});\n      transition: filter 0s ease-in, filter 150ms ease-out;\n    ">${ke}</div>`})}(C,f,n):r?function(e=Y,t=1,n=!1,r=!1){return Re(`filled:${e}:${t}:${n}:${r}`,()=>{const s=n?1.25:1;if(r){const n=18,r=n+2,i=(r-14)/2,o=(r-n)/2;return`<div style="\n        position: relative;\n        width: ${r}px;\n        height: ${r}px;\n        opacity: ${t};\n        filter: brightness(${s});\n        transition: filter 0s ease-in, filter 150ms ease-out;\n      ">\n        \x3c!-- Yellow inner stroke ring --\x3e\n        <div style="\n          position: absolute;\n          top: ${o}px;\n          left: ${o}px;\n          width: ${n}px;\n          height: ${n}px;\n          background: transparent;\n          border-radius: 50%;\n          border: 2px solid ${Q};\n          box-sizing: border-box;\n          opacity: 0.85;\n        "></div>\n        \x3c!-- Inner filled dot --\x3e\n        <div style="\n          position: absolute;\n          top: ${i}px;\n          left: ${i}px;\n          width: 14px;\n          height: 14px;\n          background-color: ${e};\n          border-radius: 50%;\n          box-sizing: border-box;\n        "></div>\n      </div>`}return`<div style="\n      width: 14px;\n      height: 14px;\n      background-color: ${e};\n      border-radius: 50%;\n      box-sizing: border-box;\n      opacity: ${t};\n      filter: brightness(${s});\n      transition: filter 0s ease-in, filter 150ms ease-out;\n    "></div>`})}(Y,C,f,n):function(e=X,t=1,n=!1,r=!1){return Re(`ring:${e}:${t}:${n}:${r}`,()=>{const s=n?1.25:1;if(r){const n=18,r=n+2,i=(r-14)/2,o=(r-n)/2;return`<div style="\n        position: relative;\n        width: ${r}px;\n        height: ${r}px;\n        opacity: ${t};\n        filter: brightness(${s});\n        transition: filter 0s ease-in, filter 150ms ease-out;\n      ">\n        \x3c!-- Yellow inner stroke ring --\x3e\n        <div style="\n          position: absolute;\n          top: ${o}px;\n          left: ${o}px;\n          width: ${n}px;\n          height: ${n}px;\n          background: transparent;\n          border-radius: 50%;\n          border: 2px solid ${Q};\n          box-sizing: border-box;\n          opacity: 0.85;\n        "></div>\n        \x3c!-- Inner colored ring --\x3e\n        <div style="\n          position: absolute;\n          top: ${i}px;\n          left: ${i}px;\n          width: 14px;\n          height: 14px;\n          background: transparent;\n          border-radius: 50%;\n          border: 5px solid ${e};\n          box-sizing: border-box;\n        "></div>\n      </div>`}return`<div style="\n      width: 14px;\n      height: 14px;\n      background: transparent;\n      border-radius: 50%;\n      border: 5px solid ${e};\n      box-sizing: border-box;\n      opacity: ${t};\n      filter: brightness(${s});\n      transition: filter 0s ease-in, filter 150ms ease-out;\n    "></div>`})}(s?K:X,C,f,n),[o,r,s,n,C,f]),I=n?20:14,P=d.useCallback(()=>p(e),[e,p]),M=d.useCallback(()=>p(null),[p]),N=d.useCallback(t=>{t.stopPropagation(),b(e)},[e,b]);return t.latitude&&t.longitude?i.jsxs(i.Fragment,{children:[i.jsx(m,{longitude:t.longitude,latitude:t.latitude,anchor:"center",children:i.jsx("div",{role:"button",tabIndex:0,"aria-label":`Node ${x}`,style:{width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",touchAction:"manipulation",WebkitTapHighlightColor:"transparent"},onClick:N,onTouchEnd:N,onMouseEnter:P,onMouseLeave:M,onKeyDown:t=>"Enter"===t.key&&b(e),children:i.jsx("div",{style:{pointerEvents:"none"},dangerouslySetInnerHTML:{__html:k}})})}),y&&i.jsx(_,{longitude:t.longitude,latitude:t.latitude,anchor:"bottom",offset:[0,-I/2],closeOnClick:!0,onClose:v,className:"maplibre-popup",children:i.jsx(ue,{hash:e,hashPrefix:w,name:x,isHub:r,isZeroHop:n,isMobile:s,isRoomServer:o,isStale:S,lastSeenTimestamp:A,centrality:a,affinity:c,meanSnr:E,meanRssi:T,neighbor:t,txDelayRec:u,onRemove:g?()=>g(e,x):void 0})})]}):null}function Ne({localNode:e,localHash:t,isHovered:n,onHover:r,isPopupOpen:s,onOpenPopup:o,onClosePopup:a}){const l=d.useMemo(()=>function(e=!1){return Re(`local:${e}`,()=>`<div style="\n      width: 16px;\n      height: 16px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      filter: drop-shadow(0 1px 2px rgba(0,0,0,0.4)) brightness(${e?1.25:1});\n      transition: filter 0s ease-in, filter 150ms ease-out;\n    ">${Ce}</div>`)}(n),[n]),c=d.useCallback(()=>r("local"),[r]),u=d.useCallback(()=>r(null),[r]),h=d.useCallback(e=>{e.stopPropagation(),o()},[o]);return e.latitude&&e.longitude?i.jsxs(i.Fragment,{children:[i.jsx(m,{longitude:e.longitude,latitude:e.latitude,anchor:"center",children:i.jsx("div",{role:"button",tabIndex:0,"aria-label":`Local node ${e.name}`,style:{width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",touchAction:"manipulation",WebkitTapHighlightColor:"transparent"},onClick:h,onTouchEnd:h,onMouseEnter:c,onMouseLeave:u,onKeyDown:e=>"Enter"===e.key&&o(),children:i.jsx("div",{style:{pointerEvents:"none"},dangerouslySetInnerHTML:{__html:l}})})}),s&&i.jsx(_,{longitude:e.longitude,latitude:e.latitude,anchor:"bottom",offset:[0,-8],closeOnClick:!0,onClose:a,className:"maplibre-popup",children:i.jsxs("div",{className:"text-sm",children:[i.jsx("strong",{className:"text-base",children:e.name}),t&&i.jsx("span",{className:"ml-2 font-mono text-xs text-text-muted bg-surface-elevated px-1.5 py-0.5 rounded",children:Pe(t)}),i.jsx("br",{}),i.jsx("span",{style:{color:q},className:"font-medium",children:"This Node (Local)"}),i.jsx("br",{}),i.jsxs("span",{className:"text-xs text-text-muted",children:[e.latitude.toFixed(5),", ",e.longitude.toFixed(5)]})]})})]}):null}function Le({neighborsWithLocation:e,localNode:t,localHash:n,zeroHopNeighbors:r,lastHopNeighborMap:s,meshTopology:o,hoveredMarker:a,onMarkerHover:l,getNodeOpacity:c,shouldShowNode:u,onRequestRemove:h}){const[f,p]=d.useState(null),g=d.useCallback(e=>{p(e)},[]),m=d.useCallback(()=>{p(null)},[]),_=d.useMemo(()=>[...e].sort(([e,t],[n,s])=>{const i=(e,t)=>Ie(t)?5e3:r.has(e)?2e3:o.hubNodes.includes(e)?1e3:0;return i(e,t)-i(n,s)}),[e,r,o.hubNodes]);return i.jsxs(i.Fragment,{children:[_.map(([e,t])=>{if(!t.latitude||!t.longitude)return null;const n=u(e),d=c(e,n);if(d<=.01)return null;const p=r.has(e),_=o.hubNodes.includes(e),y=o.mobileNodes.includes(e),b=Ie(t),v=o.centrality.get(e)||0,x=s.get(e)??null,w=o.fullAffinity.get(e),E=o.txDelayRecommendations.get(e);return i.jsx(Me,{hash:e,neighbor:t,isZeroHop:p,isHub:_,isMobile:y,isRoomServer:b,centrality:v,lastHopData:x,affinity:w,txDelayRec:E,nodeOpacity:d,isHovered:a===e,onHover:l,onRequestRemove:h,isPopupOpen:f===e,onOpenPopup:g,onClosePopup:m},e)}),t&&t.latitude&&t.longitude&&i.jsx(Ne,{localNode:t,localHash:n,isHovered:"local"===a,onHover:l,isPopupOpen:"local"===f,onOpenPopup:()=>g("local"),onClosePopup:m})]})}function Oe(e,t=!1,n=!1,r=!1,s=.7){return e?t?ne:n?re:se:r?s>=.75?ee:J:s>=.85?J:s>=.7?te:"#1F2937"}function Fe(e,t,n){const r=t[1]-e[1],s=t[0]-e[0],i=Math.sqrt(r*r+s*s);if(0===i)return{line1:[e,t],line2:[e,t]};const o=2e-5*n,a=-s/i*o,l=r/i*o;return{line1:[[e[0]+a,e[1]+l],[t[0]+a,t[1]+l]],line2:[[e[0]-a,e[1]-l],[t[0]-a,t[1]-l]]}}function De(e){return[e[1],e[0]]}const Be={id:"topology-weak-edges",type:"line",paint:{"line-color":["get","color"],"line-width":["get","width"],"line-opacity":["get","opacity"]},layout:{"line-cap":"round","line-join":"round"}},Ue={id:"topology-validated-edges",type:"line",paint:{"line-color":["get","color"],"line-width":["get","width"],"line-opacity":["get","opacity"]},layout:{"line-cap":"round","line-join":"round"}},je={id:"topology-validated-edges-hitarea",type:"line",paint:{"line-color":"transparent","line-width":16,"line-opacity":0},layout:{"line-cap":"round","line-join":"round"}};function Ve({showTopology:e,isExiting:t,validatedPolylines:n,weakPolylines:r,edgeAnimProgress:s,weightAnimProgress:o,animStartWeights:a,animTargetWeights:l,maxCertainCount:c,loopEdgeKeys:u,backboneEdgeKeys:h,hoveredEdgeKey:f,onEdgeHover:p,highlightedEdgeKey:g,neighbors:m}){const _=e||t,v=d.useMemo(()=>_?function(e,t){const n=[];for(const{from:r,to:s,edge:i}of e){const e=t.get(i.key)??0;if(e<=0)continue;const o=[r[0]+(s[0]-r[0])*e,r[1]+(s[1]-r[1])*e];n.push({type:"Feature",properties:{key:i.key,color:te,width:1.5,opacity:.5*e,isLoopEdge:!1,isBackbone:!1,isDirectPath:!1,isHubConnection:!1,certainCount:i.certainCount,confidence:i.avgConfidence??.7,symmetryRatio:i.symmetryRatio??1,dominantDirection:i.dominantDirection??"balanced",fromName:"",toName:""},geometry:{type:"LineString",coordinates:[De(r),De(o)]}})}return{type:"FeatureCollection",features:n}}(r,s):{type:"FeatureCollection",features:[]},[r,s,_]),x=d.useMemo(()=>_?function(e,t,n,r,s,i,o,a,l,c,u){const h=[];for(const{from:d,to:f,edge:p}of e){const e=t.get(p.key)??0;if(e<=0)continue;const i=s.get(p.key)??z(p.certainCount),g=r.get(p.key)??i,m=g+(i-g)*n,_=o.has(p.key),y=a.has(p.key),b=p.avgConfidence??.7,v=l===p.key,x=null!==l,w=c===p.key,E=u[p.fromHash],T=u[p.toHash],S=(null==E?void 0:E.node_name)||(null==E?void 0:E.name)||p.fromHash.slice(0,8),A=(null==T?void 0:T.node_name)||(null==T?void 0:T.name)||p.toHash.slice(0,8),R=[d[0]+(f[0]-d[0])*e,d[1]+(f[1]-d[1])*e],C=.82*Math.min(1.5*e,1),k=x?v?1.25:.4:1;if(_){const{line1:e,line2:t}=Fe(d,R,1.5*m),n=v?re:J,r=1.1*C*k,s=v?Math.max(2.5,.8*m):Math.max(1.5,.6*m);h.push({type:"Feature",properties:{key:`${p.key}-loop1`,color:n,width:s,opacity:r,isLoopEdge:!0,isBackbone:!1,isDirectPath:p.isDirectPathEdge??!1,isHubConnection:p.isHubConnection??!1,certainCount:p.certainCount,confidence:b,symmetryRatio:p.symmetryRatio??1,dominantDirection:p.dominantDirection??"balanced",fromName:S,toName:A},geometry:{type:"LineString",coordinates:[De(e[0]),De(e[1])]}}),h.push({type:"Feature",properties:{key:`${p.key}-loop2`,color:n,width:s,opacity:r,isLoopEdge:!0,isBackbone:!1,isDirectPath:p.isDirectPathEdge??!1,isHubConnection:p.isHubConnection??!1,certainCount:p.certainCount,confidence:b,symmetryRatio:p.symmetryRatio??1,dominantDirection:p.dominantDirection??"balanced",fromName:S,toName:A},geometry:{type:"LineString",coordinates:[De(t[0]),De(t[1])]}});continue}const I=w?"#FFD700":Oe(v,p.isDirectPathEdge??!1,!1,y,b);let P=w?Math.max(1.6*m,4.5):y?1.3*m:m;v&&!w&&(P=Math.max(1.2*P,3));let M=w?.95:y?1.15*C:C;M*=k,h.push({type:"Feature",properties:{key:p.key,color:I,width:P,opacity:M,isLoopEdge:!1,isBackbone:y,isDirectPath:p.isDirectPathEdge??!1,isHubConnection:p.isHubConnection??!1,certainCount:p.certainCount,confidence:b,symmetryRatio:p.symmetryRatio??1,dominantDirection:p.dominantDirection??"balanced",fromName:S,toName:A},geometry:{type:"LineString",coordinates:[De(d),De(R)]}})}return{type:"FeatureCollection",features:h}}(n,s,o,a,l,0,u,h,f,g,m):{type:"FeatureCollection",features:[]},[n,s,o,a,l,c,u,h,f,g,m,_]);return _?i.jsxs(i.Fragment,{children:[i.jsx(y,{id:"weak-edges",type:"geojson",data:v,children:i.jsx(b,{...Be})}),i.jsxs(y,{id:"validated-edges",type:"geojson",data:x,children:[i.jsx(b,{...je}),i.jsx(b,{...Ue})]})]}):null}const Ge=["topology-validated-edges-hitarea","topology-validated-edges"];function ze(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const We=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser),He="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);He&&parseFloat(He[1]);const $e=globalThis,Xe=globalThis.process||{},qe=globalThis.navigator||{};function Ye(e){var t,n;if("undefined"!=typeof window&&"renderer"===(null==(t=window.process)?void 0:t.type))return!0;if("undefined"!=typeof process&&Boolean(null==(n=process.versions)?void 0:n.electron))return!0;const r="undefined"!=typeof navigator&&navigator.userAgent;return Boolean(r&&r.indexOf("Electron")>=0)}function Ke(){return!("object"==typeof process&&"[object process]"===String(process)&&!(null==process?void 0:process.browser))||Ye()}const Ze="4.1.0";class Qe{constructor(e,t,n="sessionStorage"){this.storage=function(e){try{const t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),t}catch(Ci){return null}}(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}var Je,et;function tt(e){return"string"!=typeof e?e:(e=e.toUpperCase(),Je[e]||Je.WHITE)}function nt(e,t){if(!e)throw new Error("Assertion failed")}function rt(){var e,t,n;let r;if(Ke()&&$e.performance)r=null==(t=null==(e=null==$e?void 0:$e.performance)?void 0:e.now)?void 0:t.call(e);else if("hrtime"in Xe){const e=null==(n=null==Xe?void 0:Xe.hrtime)?void 0:n.call(Xe);r=1e3*e[0]+e[1]/1e6}else r=Date.now();return r}(et=Je||(Je={}))[et.BLACK=30]="BLACK",et[et.RED=31]="RED",et[et.GREEN=32]="GREEN",et[et.YELLOW=33]="YELLOW",et[et.BLUE=34]="BLUE",et[et.MAGENTA=35]="MAGENTA",et[et.CYAN=36]="CYAN",et[et.WHITE=37]="WHITE",et[et.BRIGHT_BLACK=90]="BRIGHT_BLACK",et[et.BRIGHT_RED=91]="BRIGHT_RED",et[et.BRIGHT_GREEN=92]="BRIGHT_GREEN",et[et.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",et[et.BRIGHT_BLUE=94]="BRIGHT_BLUE",et[et.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",et[et.BRIGHT_CYAN=96]="BRIGHT_CYAN",et[et.BRIGHT_WHITE=97]="BRIGHT_WHITE";const st={debug:Ke()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},it={enabled:!0,level:0};function ot(){}const at={},lt={once:!0};class ct{constructor({id:e}={id:""}){this.VERSION=Ze,this._startTs=rt(),this._deltaTs=rt(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new Qe(`__probe-${this.id}__`,it),this.timeStamp(`${this.id} started`),function(e,t=["constructor"]){const n=Object.getPrototypeOf(e),r=Object.getOwnPropertyNames(n),s=e;for(const i of r){const n=s[i];"function"==typeof n&&(t.find(e=>i===e)||(s[i]=n.bind(e)))}}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((rt()-this._startTs).toPrecision(10))}getDelta(){return Number((rt()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,st.warn,arguments,lt)}error(e){return this._getLogFunction(0,e,st.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,st.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,st.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,st.debug||st.info,arguments,lt)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||ot,n&&[n],{tag:dt(t)}):ot}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||ot)}group(e,t,n={collapsed:!1}){const r=ht({logLevel:e,message:t,opts:n}),{collapsed:s}=n;return r.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,t,n={}){return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ot)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=ut(e)}_getLogFunction(e,t,n,r,s){if(this._shouldLog(e)){s=ht({logLevel:e,message:t,args:r,opts:s}),nt(n=n||s.method),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=rt();const i=s.tag||s.message;if(s.once&&i){if(at[i])return ot;at[i]=rt()}return t=function(e,t,n){if("string"==typeof t){const o=n.time?function(e,t=8){const n=Math.max(t-e.length,0);return`${" ".repeat(n)}${e}`}(function(e){let t;return t=e<10?`${e.toFixed(2)}ms`:e<100?`${e.toFixed(1)}ms`:e<1e3?`${e.toFixed(0)}ms`:`${(e/1e3).toFixed(2)}s`,t}(n.total)):"";r=t=n.time?`${e}: ${o}  ${t}`:`${e}: ${t}`,s=n.color,i=n.background,Ke||"string"!=typeof r||(s&&(r=`[${tt(s)}m${r}[39m`),i&&(r=`[${tt(i)+10}m${r}[49m`)),t=r}var r,s,i;return t}(this.id,s.message,s),n.bind(console,t,...s.args)}return ot}}function ut(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return nt(Number.isFinite(t)&&t>=0),t}function ht(e){const{logLevel:t,message:n}=e;e.logLevel=ut(t);const r=e.args?Array.from(e.args):[];for(;r.length&&r.shift()!==n;);switch(typeof t){case"string":case"function":void 0!==n&&r.unshift(n),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());const s=typeof e.message;return nt("string"===s||"object"===s),Object.assign(e,{args:r},e.opts)}function dt(e){for(const t in e)for(const n in e[t])return n||"untitled";return"empty"}ct.VERSION=Ze;const ft="4.3.3",pt=ft[0]>="0"&&ft[0]<="9"?`v${ft}`:"",gt=function(){const e=new ct({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=e,globalThis.loaders.version=pt,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=e,e}();function mt(e,t){return _t(e||{},t)}function _t(e,t,n=0){if(n>3)return t;const r={...e};for(const[s,i]of Object.entries(t))i&&"object"==typeof i&&!Array.isArray(i)?r[s]=_t(r[s]||{},t[s],n+1):r[s]=t[s];return r}var yt;function bt(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}(null==(yt=globalThis._loadersgl_)?void 0:yt.version)||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version;const vt="object"!=typeof process||"[object process]"!==String(process)||process.browser,xt="undefined"!=typeof window&&void 0!==window.orientation,wt="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);wt&&parseFloat(wt[1]);class Et{constructor(e,t){r(this,"name"),r(this,"workerThread"),r(this,"isRunning",!0),r(this,"result"),r(this,"_resolve",()=>{}),r(this,"_reject",()=>{}),this.name=e,this.workerThread=t,this.result=new Promise((e,t)=>{this._resolve=e,this._reject=t})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){bt(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){bt(this.isRunning),this.isRunning=!1,this._reject(e)}}class Tt{terminate(){}}const St=new Map;function At(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function Rt(e,t=!0,n){const r=n||new Set;if(e)if(Ct(e))r.add(e);else if(Ct(e.buffer))r.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(const s in e)Rt(e[s],t,r);return void 0===n?Array.from(r):[]}function Ct(e){return!!e&&(e instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&e instanceof MessagePort||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)}const kt=()=>{};class It{constructor(e){r(this,"name"),r(this,"source"),r(this,"url"),r(this,"terminated",!1),r(this,"worker"),r(this,"onMessage"),r(this,"onError"),r(this,"_loadableURL","");const{name:t,source:n,url:s}=e;bt(n||s),this.name=t,this.source=n,this.url=s,this.onMessage=kt,this.onError=e=>{},this.worker=vt?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return"undefined"!=typeof Worker&&vt||void 0!==Tt&&!vt}destroy(){this.onMessage=kt,this.onError=kt,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||Rt(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=function(e){bt(e.source&&!e.url||!e.source&&e.url);let t=St.get(e.source||e.url);return t||(e.url&&(t=(n=e.url).startsWith("http")?At(`try {\n  importScripts('${n}');\n} catch (error) {\n  console.error(error);\n  throw error;\n}`):n,St.set(e.url,t)),e.source&&(t=At(e.source),St.set(e.source,t))),bt(t),t;var n}({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>{},e}_createNodeWorker(){let e;if(this.url){const t=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Tt(t,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new Tt(this.source,{eval:!0})}return e.on("message",e=>{this.onMessage(e)}),e.on("error",e=>{this.onError(e)}),e.on("exit",e=>{}),e}}class Pt{constructor(e){r(this,"name","unnamed"),r(this,"source"),r(this,"url"),r(this,"maxConcurrency",1),r(this,"maxMobileConcurrency",1),r(this,"onDebug",()=>{}),r(this,"reuseWorkers",!0),r(this,"props",{}),r(this,"jobQueue",[]),r(this,"idleQueue",[]),r(this,"count",0),r(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return It.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e,t=(e,t,n)=>e.done(n),n=(e,t)=>e.error(t)){const r=new Promise(r=>(this.jobQueue.push({name:e,onMessage:t,onError:n,onStart:r}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new Et(t.name,e);e.onMessage=e=>t.onMessage(r,e.type,e.payload),e.onError=e=>t.onError(r,e),t.onStart(r);try{await r.result}catch(n){}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!vt||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new It({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return xt?this.maxMobileConcurrency:this.maxConcurrency}}const Mt={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Nt=class e{constructor(e){r(this,"props"),r(this,"workerPools",new Map),this.props={...Mt},this.setProps(e),this.workerPools=new Map}static isSupported(){return It.isSupported()}static getWorkerFarm(t={}){return e._workerFarm=e._workerFarm||new e({}),e._workerFarm.setProps(t),e._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:n,url:r}=e;let s=this.workerPools.get(t);return s||(s=new Pt({name:t,source:n,url:r}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};r(Nt,"_workerFarm");let Lt=Nt;async function Ot(e,t,n,r,s){const i=e.id,o=function(e,t={}){const n=t[e.id]||{},r=vt?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let s=n.workerUrl;if(s||"compression"!==e.id||(s=t.workerUrl),"test"===t._workerType&&(s=vt?`modules/${e.module}/dist/${r}`:`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!s){let t=e.version;"latest"===t&&(t="latest");const n=t?`@${t}`:"";s=`https://unpkg.com/@loaders.gl/${e.module}${n}/dist/${r}`}return bt(s),s}(e,n),a=Lt.getWorkerFarm(n).getWorkerPool({name:i,url:o});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const l=await a.startJob("process-on-worker",Ft.bind(null,s));l.postMessage("process",{input:t,options:n,context:r});const c=await l.result;return await c.result}async function Ft(e,t,n,r){switch(n){case"done":t.done(r);break;case"error":t.error(new Error(r.error));break;case"process":const{id:n,input:i,options:o}=r;try{const r=await e(i,o);t.postMessage("done",{id:n,result:r})}catch(s){const e=s instanceof Error?s.message:"unknown error";t.postMessage("error",{id:n,error:e})}}}function Dt(){let e;if("undefined"!=typeof window&&window.performance)e=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){const t=process.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}class Bt{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Dt(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Dt()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Ut{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(e=>this._getOrCreate(e))}_getOrCreate(e){const{name:t,type:n}=e;let r=this.stats[t];return r||(r=e instanceof Bt?e:new Bt(t,n),this.stats[t]=r),r}}const jt={};function Vt(e){if((t=e)&&"object"==typeof t&&t.isBuffer)return e;var t;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){const t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function Gt(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}const zt=e=>"function"==typeof e,Wt=e=>null!==e&&"object"==typeof e,Ht=e=>Wt(e)&&e.constructor==={}.constructor,$t=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,Xt=e=>"undefined"!=typeof Blob&&e instanceof Blob,qt=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||Wt(e)&&zt(e.tee)&&zt(e.cancel)&&zt(e.getReader))(e)||(e=>Wt(e)&&zt(e.read)&&zt(e.pipe)&&(e=>"boolean"==typeof e)(e.readable))(e);class Yt extends Error{constructor(e,t){super(e),r(this,"reason"),r(this,"url"),r(this,"response"),this.reason=t.reason,this.url=t.url,this.response=t.response}}const Kt=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Zt=/^([-\w.]+\/[-\w.+]+)/;function Qt(e,t){return e.toLowerCase()===t.toLowerCase()}function Jt(e){const t=Kt.exec(e);return t?t[1]:""}const en=/\?.*/;function tn(e){return e.replace(en,"")}function nn(e){return $t(e)?e.url:Xt(e)?e.name||"":"string"==typeof e?e:""}function rn(e){if($t(e)){const t=e,n=t.headers.get("content-type")||"",r=tn(t.url);return function(e){const t=Zt.exec(e);return t?t[1]:e}(n)||Jt(r)}return Xt(e)?e.type||"":"string"==typeof e?Jt(e):""}async function sn(e){if($t(e))return e;const t={},n=function(e){return $t(e)?e.headers["content-length"]||-1:Xt(e)?e.size:"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}(e);n>=0&&(t["content-length"]=String(n));const r=nn(e),s=rn(e);s&&(t["content-type"]=s);const i=await async function(e){if("string"==typeof e)return`data:,${e.slice(0,5)}`;if(e instanceof Blob){const t=e.slice(0,5);return await new Promise(e=>{const n=new FileReader;n.onload=t=>{var n;return e(null==(n=null==t?void 0:t.target)?void 0:n.result)},n.readAsDataURL(t)})}return e instanceof ArrayBuffer?`data:base64,${function(e){let t="";const n=new Uint8Array(e);for(let r=0;r<n.byteLength;r++)t+=String.fromCharCode(n[r]);return btoa(t)}(e.slice(0,5))}`:null}(e);i&&(t["x-first-bytes"]=i),"string"==typeof e&&(e=(new TextEncoder).encode(e));const o=new Response(e,{headers:t});return Object.defineProperty(o,"url",{value:r}),o}async function on(e,t){var n,r;if("string"==typeof e){const s=function(e){for(const t in jt)if(e.startsWith(t)){const n=jt[t];e=e.replace(t,n)}return e.startsWith("http://")||e.startsWith("https://")||(e=`${e}`),e}(e);return function(e){return!function(e){return e.startsWith("http:")||e.startsWith("https:")}(e)&&!function(e){return e.startsWith("data:")}(e)}(s)&&(null==(n=globalThis.loaders)?void 0:n.fetchNode)?null==(r=globalThis.loaders)?void 0:r.fetchNode(s,t):await fetch(s,t)}return await sn(e)}const an=new ct({id:"loaders.gl"});class ln{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}const cn={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){r(this,"console"),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:We,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},un={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function hn(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function dn(){const e=hn();return e.globalOptions=e.globalOptions||{...cn},e.globalOptions}function fn(e,t,n,r,s){const i=t||"Top level",o=t?`${t}.`:"";for(const a in e){const l=!t&&Wt(e[a]);if(!(a in n)&&("baseUri"!==a||t)&&("workerUrl"!==a||!t))if(a in r)an.warn(`${i} loader option '${o}${a}' no longer supported, use '${r[a]}'`)();else if(!l){const e=pn(a,s);an.warn(`${i} loader option '${o}${a}' not recognized. ${e}`)()}}}function pn(e,t){const n=e.toLowerCase();let r="";for(const s of t)for(const t in s.options){if(e===t)return`Did you mean '${s.id}.${t}'?`;const i=t.toLowerCase();(n.startsWith(i)||i.startsWith(n))&&(r=r||`Did you mean '${s.id}.${t}'?`)}return r}function gn(e,t){for(const n in t)if(n in t){const r=t[n];Ht(r)&&Ht(e[n])?e[n]={...e[n],...t[n]}:e[n]=t[n]}}function mn(e){return!!e&&(Array.isArray(e)&&(e=e[0]),Array.isArray(null==e?void 0:e.extensions))}function _n(e){let t;return ze(e,"null loader"),ze(mn(e),"invalid loader"),Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),((null==e?void 0:e.parseTextSync)||(null==e?void 0:e.parseText))&&(e.text=!0),e.text||(e.binary=!0),e}const yn=()=>{const e=hn();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry},bn=/\.([^.]+)$/;function vn(e,t=[],n,r){if(!xn(e))return null;if(t&&!Array.isArray(t))return _n(t);let s=[];t&&(s=s.concat(t)),(null==n?void 0:n.ignoreRegisteredLoaders)||s.push(...yn()),function(e){for(const t of e)_n(t)}(s);const i=function(e,t,n,r){const s=nn(e),i=rn(e),o=tn(s)||(null==r?void 0:r.url);let a=null,l="";return(null==n?void 0:n.mimeType)&&(a=En(t,null==n?void 0:n.mimeType),l=`match forced by supplied MIME type ${null==n?void 0:n.mimeType}`),a=a||function(e,t){const n=t&&bn.exec(t),r=n&&n[1];return r?function(e,t){t=t.toLowerCase();for(const n of e)for(const e of n.extensions)if(e.toLowerCase()===t)return n;return null}(e,r):null}(t,o),l=l||(a?`matched url ${o}`:""),a=a||En(t,i),l=l||(a?`matched MIME type ${i}`:""),a=a||function(e,t){if(!t)return null;for(const n of e)if("string"==typeof t){if(Tn(t,n))return n}else if(ArrayBuffer.isView(t)){if(Sn(t.buffer,t.byteOffset,n))return n}else if(t instanceof ArrayBuffer&&Sn(t,0,n))return n;return null}(t,e),l=l||(a?`matched initial data ${An(e)}`:""),(null==n?void 0:n.fallbackMimeType)&&(a=a||En(t,null==n?void 0:n.fallbackMimeType),l=l||(a?`matched fallback MIME type ${i}`:"")),l&&gt.log(1,`selectLoader selected ${null==a?void 0:a.name}: ${l}.`),a}(e,s,n,r);if(!i&&!(null==n?void 0:n.nothrow))throw new Error(wn(e));return i}function xn(e){return!(e instanceof Response&&204===e.status)}function wn(e){const t=nn(e),n=rn(e);let r="No valid loader found (";r+=t?`${Gt(t)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const s=e?An(e):"";return r+=s?` first bytes: "${s}"`:"first bytes: not available",r+=")",r}function En(e,t){var n;for(const r of e){if(null==(n=r.mimeTypes)?void 0:n.some(e=>Qt(t,e)))return r;if(Qt(t,`application/x.${r.id}`))return r}return null}function Tn(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(t=>e.startsWith(t))}function Sn(e,t,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(n=>function(e,t,n,r){if(r instanceof ArrayBuffer)return function(e,t,n){if(n=n||e.byteLength,e.byteLength<n||t.byteLength<n)return!1;const r=new Uint8Array(e),s=new Uint8Array(t);for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(r,e,r.byteLength);switch(typeof r){case"function":return r(e);case"string":return r===Rn(e,t,r.length);default:return!1}}(e,t,0,n))}function An(e,t=5){return"string"==typeof e?e.slice(0,t):ArrayBuffer.isView(e)?Rn(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?Rn(e,0,t):""}function Rn(e,t,n){if(e.byteLength<t+n)return"";const r=new DataView(e);let s="";for(let i=0;i<n;i++)s+=String.fromCharCode(r.getUint8(t+i));return s}const Cn=262144;function kn(e,t){return We?async function*(e,t){const n=e.getReader();let r;try{for(;;){const e=r||n.read();(null==t?void 0:t._streamReadAhead)&&(r=n.read());const{done:s,value:i}=await e;if(s)return;yield Vt(i)}}catch(s){n.releaseLock()}}(e,t):async function*(e){for await(const t of e)yield Vt(t)}(e)}const In="Cannot convert supplied data type";async function Pn(e,t,n){const r=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||r)return function(e,t){if(t.text&&"string"==typeof e)return e;var n;if((n=e)&&"object"==typeof n&&n.isBuffer&&(e=e.buffer),e instanceof ArrayBuffer){const n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer;const r=e.byteLength||e.length;return 0===e.byteOffset&&r===n.byteLength||(n=n.slice(e.byteOffset,e.byteOffset+r)),n}throw new Error(In)}(e,t);if(Xt(e)&&(e=await sn(e)),$t(e)){const n=e;return await async function(e){if(!e.ok){const t=await async function(e){const n=function(e){if(e.length<50)return e;const t=e.slice(e.length-15);return`${e.substr(0,32)}...${t}`}(e.url);let r=`Failed to fetch resource (${e.status}) ${e.statusText}: ${n}`;r=r.length>100?`${r.slice(0,100)}...`:r;const s={reason:e.statusText,url:e.url,response:e};try{const t=e.headers.get("Content-Type");s.reason=!e.bodyUsed&&(null==t?void 0:t.includes("application/json"))?await e.json():await e.text()}catch(t){}return new Yt(r,s)}(e);throw t}}(n),t.binary?await n.arrayBuffer():await n.text()}if(qt(e)&&(e=function(e,t){if("string"==typeof e)return function*(e,t){const n=(null==t?void 0:t.chunkSize)||262144;let r=0;const s=new TextEncoder;for(;r<e.length;){const t=Math.min(e.length-r,n),i=e.slice(r,r+t);r+=t,yield s.encode(i)}}(e,t);if(e instanceof ArrayBuffer)return function*(e,t={}){const{chunkSize:n=Cn}=t;let r=0;for(;r<e.byteLength;){const t=Math.min(e.byteLength-r,n),s=new ArrayBuffer(t),i=new Uint8Array(e,r,t);new Uint8Array(s).set(i),r+=t,yield s}}(e,t);if(Xt(e))return async function*(e,t){const n=(null==t?void 0:t.chunkSize)||1048576;let r=0;for(;r<e.size;){const t=r+n,s=await e.slice(r,t).arrayBuffer();r=t,yield s}}(e,t);if(qt(e))return kn(e,t);if($t(e))return kn(e.body,t);throw new Error("makeIterator")}(e,n)),s=e,Boolean(s)&&"function"==typeof s[Symbol.iterator]||(e=>e&&"function"==typeof e[Symbol.asyncIterator])(e))return async function(e){const t=[];for await(const n of e)t.push(n);return function(...e){return function(e){const t=e.map(e=>e instanceof ArrayBuffer?new Uint8Array(e):e),n=t.reduce((e,t)=>e+t.byteLength,0),r=new Uint8Array(n);let s=0;for(const i of t)r.set(i,s),s+=i.byteLength;return r.buffer}(e)}(...t)}(e);var s;throw new Error(In)}function Mn(e,t){const n=dn(),r=e||n;return"function"==typeof r.fetch?r.fetch:Wt(r.fetch)?e=>on(e,r.fetch):(null==t?void 0:t.fetch)?null==t?void 0:t.fetch:on}async function Nn(e,t,n,r){!t||Array.isArray(t)||mn(t)||(r=void 0,n=t,t=void 0),n=n||{};const s=nn(e=await e),i=function(e,t){if(e&&!Array.isArray(e))return e;let n;if(e&&(n=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];n=n?[...n,...e]:e}return n&&n.length?n:void 0}(t,r),o=await async function(e,t=[],n,r){if(!xn(e))return null;let s=vn(e,t,{...n,nothrow:!0},r);if(s)return s;if(Xt(e)&&(s=vn(e=await e.slice(0,10).arrayBuffer(),t,n,r)),!s&&!(null==n?void 0:n.nothrow))throw new Error(wn(e));return s}(e,i,n);return o?(r=function(e,t,n){if(n)return n;const r={fetch:Mn(t,e),...e};if(r.url){const e=tn(r.url);r.baseUrl=e,r.queryString=function(e){const t=e.match(en);return t&&t[0]}(r.url),r.filename=Gt(e),r.baseUrl=function(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}(e)}return Array.isArray(r.loaders)||(r.loaders=null),r}({url:s,_parse:Nn,loaders:i},n=function(e,t,n,r){return n=n||[],function(e,t){fn(e,null,cn,un,t);for(const n of t){const r=e&&e[n.id]||{},s=n.options&&n.options[n.id]||{},i=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};fn(r,n.id,s,i,t)}}(e,n=Array.isArray(n)?n:[n]),function(e,t,n){const r={...e.options||{}};return function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}(r,n),null===r.log&&(r.log=new ln),gn(r,dn()),gn(r,t),r}(t,e,r)}(n,o,i,s),r||null),await async function(e,t,n,r){if(function(e){bt(e,"no worker provided");e.version}(e),n=mt(e.options,n),$t(t)){const e=t,{ok:n,redirected:s,status:i,statusText:o,type:a,url:l}=e,c=Object.fromEntries(e.headers.entries());r.response={headers:c,ok:n,redirected:s,status:i,statusText:o,type:a,url:l}}t=await Pn(t,e,n);const s=e;if(s.parseTextSync&&"string"==typeof t)return s.parseTextSync(t,n,r);if(function(e,t){return!!Lt.isSupported()&&!(!vt&&!(null==t?void 0:t._nodeWorkers))&&e.worker&&(null==t?void 0:t.worker)}(e,n))return await Ot(e,t,n,r,Nn);if(s.parseText&&"string"==typeof t)return await s.parseText(t,n,r);if(s.parse)return await s.parse(t,n,r);throw bt(!s.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}(o,e,n,r)):null}async function Ln(e,t,n,r){let s,i;Array.isArray(t)||mn(t)?(s=t,i=n):(s=[],i=t);const o=Mn(i);let a=e;return"string"==typeof e&&(a=await o(e)),Xt(e)&&(a=await o(e)),Array.isArray(s),await Nn(a,s,i)}const On=null==(e=globalThis.loaders)?void 0:e.parseImageNode,Fn="undefined"!=typeof Image,Dn="undefined"!=typeof ImageBitmap,Bn=Boolean(On),Un=!!We||Bn;const jn=/^data:image\/svg\+xml/,Vn=/\.svg((\?|#).*)?$/;function Gn(e){return e&&(jn.test(e)||Vn.test(e))}function zn(e,t){if(Gn(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function Wn(e,t,n){const r=function(e,t){if(Gn(t)){let t=(new TextDecoder).decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(n){throw new Error(n.message)}return`data:image/svg+xml;base64,${btoa(t)}`}return zn(e,t)}(e,n),s=self.URL||self.webkitURL,i="string"!=typeof r&&s.createObjectURL(r);try{return await async function(e,t){const n=new Image;return n.src=e,t.image&&t.image.decode&&n.decode?(await n.decode(),n):await new Promise((e,t)=>{try{n.onload=()=>e(n),n.onerror=e=>{const n=e instanceof Error?e.message:"error";t(new Error(n))}}catch(r){t(r)}})}(i||r,t)}finally{i&&s.revokeObjectURL(i)}}const Hn={};let $n=!0;const Xn=!1,qn=!0;function Yn(e){const t=Kn(e);return function(e){const t=Kn(e);return t.byteLength>=24&&2303741511===t.getUint32(0,Xn)?{mimeType:"image/png",width:t.getUint32(16,Xn),height:t.getUint32(20,Xn)}:null}(t)||function(e){const t=Kn(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,Xn)&&255===t.getUint8(2)))return null;const{tableMarkers:n,sofMarkers:r}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}();let s=2;for(;s+9<t.byteLength;){const e=t.getUint16(s,Xn);if(r.has(e))return{mimeType:"image/jpeg",height:t.getUint16(s+5,Xn),width:t.getUint16(s+7,Xn)};if(!n.has(e))return null;s+=2,s+=t.getUint16(s,Xn)}return null}(t)||function(e){const t=Kn(e);return t.byteLength>=10&&1195984440===t.getUint32(0,Xn)?{mimeType:"image/gif",width:t.getUint16(6,qn),height:t.getUint16(8,qn)}:null}(t)||function(e){const t=Kn(e);return t.byteLength>=14&&16973===t.getUint16(0,Xn)&&t.getUint32(2,qn)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,qn),height:t.getUint32(22,qn)}:null}(t)||function(e){const t=function(e){return function(e,t,n=0){const r=(s="ftyp",[...s].map(e=>e.charCodeAt(0)));var s;for(let i=0;i<r.length;++i)if(r[i]!==e[i+n])return!1;return!0}(e,0,4)&&96&e[8]?function(e){switch((t=e,String.fromCharCode(...t.slice(8,12))).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}var t}(e):null}(new Uint8Array(e instanceof DataView?e.buffer:e));return t?{mimeType:t.mimeType,width:0,height:0}:null}(t)}function Kn(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}const Zn={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:"4.3.3",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:async function(e,t,n){const r=((t=t||{}).image||{}).type||"auto",{url:s}=n||{};let i;switch(function(e){switch(e){case"auto":case"data":return function(){if(Dn)return"imagebitmap";if(Fn)return"image";if(Un)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return Dn||Fn||Un;case"imagebitmap":return Dn;case"image":return Fn;case"data":return Un;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}(e),e}}(r)){case"imagebitmap":i=await async function(e,t,n){let r;r=Gn(n)?await Wn(e,t,n):zn(e,n);const s=t&&t.imagebitmap;return await async function(e,t=null){if(!function(e){for(const t in e||Hn)return!1;return!0}(t)&&$n||(t=null),t)try{return await createImageBitmap(e,t)}catch(n){$n=!1}return await createImageBitmap(e)}(r,s)}(e,t,s);break;case"image":i=await Wn(e,t,s);break;case"data":i=await async function(e){var t;const{mimeType:n}=Yn(e)||{},r=null==(t=globalThis.loaders)?void 0:t.parseImageNode;return ze(r),await r(e,n)}(e);break;default:ze(!1)}return"data"===r&&(i=function(e){switch(function(e){const t=function(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&e instanceof Image?"image":e&&"object"==typeof e&&e.data&&e.width&&e.height?"data":null}(e);if(!t)throw new Error("Not an image");return t}(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("getImageData");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}(i)),i},tests:[e=>Boolean(Yn(new DataView(e)))],options:{image:{type:"auto",decode:!0}}},Qn=new ct({id:"deck"});let Jn={};function er(e){Jn=e}function tr(e,t,n,r){Qn.level>0&&Jn[e]&&Jn[e].call(null,t,n,r)}const nr={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(e){const t=e[0],n=e[e.length-1];return"{"===t&&"}"===n||"["===t&&"]"===n},parseTextSync:JSON.parse},rr=function(){const e="9.2.5",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${e}`);return t||(Qn.log(1,`deck.gl ${e}`)(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:Qn,_registerLoggers:er},function(e){const t=yn();e=Array.isArray(e)?e:[e];for(const n of e){const e=_n(n);t.find(t=>e===t)||t.unshift(e)}}([nr,[Zn,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}();function sr(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}const ir={number:{type:"number",validate:(e,t)=>Number.isFinite(e)&&"object"==typeof t&&(void 0===t.max||e<=t.max)&&(void 0===t.min||e>=t.min)},array:{type:"array",validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function or(e){let t=ar(e);if("object"!==t)return{value:e,...ir[t],type:t};if("object"==typeof e)return e?void 0!==e.type?{...e,...ir[e.type],type:e.type}:void 0===e.value?{type:"object",value:e}:(t=ar(e.value),{...e,...ir[t],type:t}):{type:"object",value:null};throw new Error("props")}function ar(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const lr={vertex:"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n",fragment:"#ifdef MODULE_MATERIAL\n  fragColor = material_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  fragColor = lighting_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_FOG\n  fragColor = fog_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  fragColor = picking_filterHighlightColor(fragColor);\n  fragColor = picking_filterPickingColor(fragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"},cr=/void\s+main\s*\([^)]*\)\s*\{\n?/,ur=/}\n?[^{}]*$/,hr=[],dr="__LUMA_INJECT_DECLARATIONS__";function fr(e){const t={vertex:{},fragment:{}};for(const n in e){let r=e[n];"string"==typeof r&&(r={order:0,injection:r}),t[pr(n)][n]=r}return t}function pr(e){const t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function gr(e,t,n,r=!1){const s="vertex"===t;for(const i in n){const t=n[i];t.sort((e,t)=>e.order-t.order),hr.length=t.length;for(let e=0,n=t.length;e<n;++e)hr[e]=t[e].injection;const r=`${hr.join("\n")}\n`;switch(i){case"vs:#decl":s&&(e=e.replace(dr,r));break;case"vs:#main-start":s&&(e=e.replace(cr,e=>e+r));break;case"vs:#main-end":s&&(e=e.replace(ur,e=>r+e));break;case"fs:#decl":s||(e=e.replace(dr,r));break;case"fs:#main-start":s||(e=e.replace(cr,e=>e+r));break;case"fs:#main-end":s||(e=e.replace(ur,e=>r+e));break;default:e=e.replace(i,e=>e+r)}}return e=e.replace(dr,""),r&&(e=e.replace(/\}\s*$/,e=>e+lr[t])),e}function mr(e){e.map(e=>function(e){if(e.instance)return;mr(e.dependencies||[]);const{propTypes:t={},deprecations:n=[],inject:r={}}=e,s={normalizedInjections:fr(r),parsedDeprecations:yr(n)};t&&(s.propValidators=function(e){const t={};for(const[n,r]of Object.entries(e))t[n]=or(r);return t}(t)),e.instance=s;let i={};t&&(i=Object.entries(t).reduce((e,[t,n])=>{const r=null==n?void 0:n.value;return r&&(e[t]=r),e},{})),e.defaultUniforms={...e.defaultUniforms,...i}}(e))}function _r(e,t,n){var r;null==(r=e.deprecations)||r.forEach(e=>{var r;(null==(r=e.regex)?void 0:r.test(t))&&(e.deprecated?n.deprecated(e.old,e.new)():n.removed(e.old,e.new)())})}function yr(e){return e.forEach(e=>{"function"===e.type?e.regex=new RegExp(`\\b${e.old}\\(`):e.regex=new RegExp(`${e.type} ${e.old};`)}),e}function br(e){mr(e);const t={},n={};vr({modules:e,level:0,moduleMap:t,moduleDepth:n});const r=Object.keys(n).sort((e,t)=>n[t]-n[e]).map(e=>t[e]);return mr(r),r}function vr(e){const{modules:t,level:n,moduleMap:r,moduleDepth:s}=e;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const i of t)r[i.name]=i,(void 0===s[i.name]||s[i.name]<n)&&(s[i.name]=n);for(const i of t)i.dependencies&&vr({modules:i.dependencies,level:n+1,moduleMap:r,moduleDepth:s})}const xr=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],wr=[...xr,[Sr("attribute"),"in $1"],[Sr("varying"),"out $1"]],Er=[...xr,[Sr("varying"),"in $1"]];function Tr(e,t){for(const[n,r]of t)e=e.replace(n,r);return e}function Sr(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function Ar(e,t){let n="";for(const r in e){const s=e[r];if(n+=`void ${s.signature} {\n`,s.header&&(n+=`  ${s.header}`),t[r]){const e=t[r];e.sort((e,t)=>e.order-t.order);for(const t of e)n+=`  ${t.injection}\n`}s.footer&&(n+=`  ${s.footer}`),n+="}\n"}return n}function Rr(e){const t={vertex:{},fragment:{}};for(const n of e){let e,r;"string"!=typeof n?(e=n,r=e.hook):(e={},r=n),r=r.trim();const[s,i]=r.split(":"),o=r.replace(/\(.+/,""),a=Object.assign(e,{signature:i});switch(s){case"vs":t.vertex[o]=a;break;case"fs":t.fragment[o]=a;break;default:throw new Error(s)}}return t}function Cr(e,t="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return n?n[1]:t}function kr(e){let t=100;const n=e.match(/[^\s]+/g);if(n&&n.length>=2&&"#version"===n[0]){const e=parseInt(n[1],10);Number.isFinite(e)&&(t=e)}if(100!==t&&300!==t)throw new Error(`Invalid GLSL version ${t}`);return t}const Ir=`\n\n${dr}\n`;function Pr(e,t){var n;const{source:r,stage:s,modules:i,hookFunctions:o=[],inject:a={},log:l}=t;sr("string"==typeof r,"shader source must be a string");const c=r;let u="";const h=Rr(o),d={},f={},p={};for(const m in a){const e="string"==typeof a[m]?{injection:a[m],order:0}:a[m],t=/^(v|f)s:(#)?([\w-]+)$/.exec(m);if(t){const n=t[2],r=t[3];n?"decl"===r?f[m]=[e]:p[m]=[e]:d[m]=[e]}else p[m]=[e]}const g=i;for(const m of g){l&&_r(m,c,l),u+=Lr(m,"wgsl");const e=(null==(n=m.injections)?void 0:n[s])||{};for(const t in e){const n=/^(v|f)s:#([\w-]+)$/.exec(t);if(n){const r="decl"===n[2]?f:p;r[t]=r[t]||[],r[t].push(e[t])}else d[t]=d[t]||[],d[t].push(e[t])}}return u+=Ir,u=gr(u,s,f),u+=Ar(h[s],d),u+=c,u=gr(u,s,p),u}function Mr(e,t){var n;const{source:r,stage:s,language:i="glsl",modules:o,defines:a={},hookFunctions:l=[],inject:c={},prologue:u=!0,log:h}=t;sr("string"==typeof r,"shader source must be a string");const d="glsl"===i?function(e){return{name:Cr(e,void 0),language:"glsl",version:kr(e)}}(r).version:-1,f=e.shaderLanguageVersion,p=100===d?"#version 100":"#version 300 es",g=r.split("\n").slice(1).join("\n"),m={};o.forEach(e=>{Object.assign(m,e.defines)}),Object.assign(m,a);let _="";switch(i){case"wgsl":break;case"glsl":_=u?`${p}\n\n// ----- PROLOGUE -------------------------\n#define SHADER_TYPE_${s.toUpperCase()}\n\n${function(e){switch(null==e?void 0:e.gpu.toLowerCase()){case"apple":return"#define APPLE_GPU\n// Apple optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Headless Chrome's software shader 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// If the GPU doesn't have full 32 bits precision, will causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}(e)}\n${"fragment"===s?"precision highp float;\n":""}\n\n// ----- APPLICATION DEFINES -------------------------\n\n${function(e={}){let t="";for(const n in e){const r=e[n];(r||Number.isFinite(r))&&(t+=`#define ${n.toUpperCase()} ${e[n]}\n`)}return t}(m)}\n\n`:`${p}\n`}const y=Rr(l),b={},v={},x={};for(const w in c){const e="string"==typeof c[w]?{injection:c[w],order:0}:c[w],t=/^(v|f)s:(#)?([\w-]+)$/.exec(w);if(t){const n=t[2],r=t[3];n?"decl"===r?v[w]=[e]:x[w]=[e]:b[w]=[e]}else x[w]=[e]}for(const w of o){h&&_r(w,g,h),_+=Lr(w,s);const e=(null==(n=w.instance)?void 0:n.normalizedInjections[s])||{};for(const t in e){const n=/^(v|f)s:#([\w-]+)$/.exec(t);if(n){const r="decl"===n[2]?v:x;r[t]=r[t]||[],r[t].push(e[t])}else b[t]=b[t]||[],b[t].push(e[t])}}return _+="// ----- MAIN SHADER SOURCE -------------------------",_+=Ir,_=gr(_,s,v),_+=Ar(y[s],b),_+=g,_=gr(_,s,x),"glsl"===i&&d!==f&&(_=function(e,t){var n;if(300!==Number((null==(n=e.match(/^#version[ \t]+(\d+)/m))?void 0:n[1])||100))throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return Tr(e,wr);case"fragment":return Tr(e,Er);default:throw new Error(t)}}(_,s)),_.trim()}function Nr(e){return function(t){var n;const r={};for(const s of e){const e=null==(n=s.getUniforms)?void 0:n.call(s,t,r);Object.assign(r,e)}return r}}function Lr(e,t){let n;switch(t){case"vertex":n=e.vs||"";break;case"fragment":n=e.fs||"";break;case"wgsl":n=e.source||"";break;default:sr(!1)}if(!e.name)throw new Error("Shader module must have a name");const r=e.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let s=`// ----- MODULE ${e.name} ---------------\n\n`;return"wgsl"!==t&&(s+=`#define MODULE_${r}\n`),s+=`${n}\n`,s}const Or=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,Fr=/^\s*\#\s*endif\s*$/,Dr=class e{constructor(){r(this,"_hookFunctions",[]),r(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return e.defaultShaderAssembler=e.defaultShaderAssembler||new e,e.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===("string"==typeof e?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter(e=>e.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,{source:r,getUniforms:s}=function(e){const t=br(e.modules||[]);return{source:Pr(e.platformInfo,{...e,source:e.source,stage:"vertex",modules:t}),getUniforms:Nr(t)}}({...e,source:e.source,modules:t,hookFunctions:n}),i="wgsl"===e.platformInfo.shaderLanguage?function(e){const t=e.split("\n"),n=[];let r=!0,s=null;for(const i of t){const e=i.match(Or),t=i.match(Fr);e?(s=e[1],r=Boolean(null==void 0?void 0:undefined[s])):t?r=!0:r&&n.push(i)}return n.join("\n")}(r):r;return{source:i,getUniforms:s,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,r=function(e){const{vs:t,fs:n}=e,r=br(e.modules||[]);return{vs:Mr(e.platformInfo,{...e,source:t,stage:"vertex",modules:r}),fs:Mr(e.platformInfo,{...e,source:n,stage:"fragment",modules:r}),getUniforms:Nr(r)}}({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:n});return{...r,modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),n={};let r=0;for(let s=0,i=this._defaultModules.length;s<i;++s){const e=this._defaultModules[s],i=e.name;t[r++]=e,n[i]=!0}for(let s=0,i=e.length;s<i;++s){const i=e[s],o=i.name;n[o]||(t[r++]=i,n[o]=!0)}return t.length=r,mr(t),t}};r(Dr,"defaultShaderAssembler");let Br=Dr;function Ur(e){const{input:t,inputChannels:n,output:r}={};if(!t)return"#version 300 es\nout vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}";if(!n)throw new Error("inputChannels");return`#version 300 es\nin ${function(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${e}`)}}(n)} ${t};\nout vec4 ${r};\nvoid main() {\n  ${r} = ${function(e,t){switch(t){case 1:return`vec4(${e}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${e}, 0.0, 1.0)`;case 3:return`vec4(${e}, 1.0)`;case 4:return e;default:throw new Error(`invalid channels: ${t}`)}}(t,n)};\n}`}const jr=new class{constructor(){r(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Ut({id:e})),this.stats.get(e)}},Vr=new ct({id:"luma.gl"}),Gr={};function zr(e="id"){return Gr[e]=Gr[e]||1,`${e}-${Gr[e]++}`}let Wr=(t=class{constructor(e,t,n){if(r(this,"id"),r(this,"props"),r(this,"userData",{}),r(this,"_device"),r(this,"destroyed",!1),r(this,"allocatedBytes",0),r(this,"_attachedResources",new Set),!e)throw new Error("no device");this._device=e,this.props=function(e,t){const n={...t};for(const r in e)void 0!==e[r]&&(n[r]=e[r]);return n}(t,n);const s="undefined"!==this.props.id?this.props.id:zr(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},r(t,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),t);const Hr=class e extends Wr{constructor(t,n){const s={...n};(n.usage||0)&e.INDEX&&!n.indexType&&(n.data instanceof Uint32Array?s.indexType="uint32":n.data instanceof Uint16Array&&(s.indexType="uint16")),delete s.data,super(t,s,e.defaultProps),r(this,"usage"),r(this,"indexType"),r(this,"updateTimestamp"),r(this,"debugData",new ArrayBuffer(0)),this.usage=s.usage||0,this.indexType=s.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(e){return this.device.createBuffer({...this.props,...e})}_setDebugData(t,n,r){const s=ArrayBuffer.isView(t)?t.buffer:t,i=Math.min(t?t.byteLength:r,e.DEBUG_DATA_MAX_LENGTH);null===s?this.debugData=new ArrayBuffer(i):0===n&&r===s.byteLength?this.debugData=s.slice(0,i):this.debugData=s.slice(n,n+i)}};r(Hr,"INDEX",16),r(Hr,"VERTEX",32),r(Hr,"UNIFORM",64),r(Hr,"STORAGE",128),r(Hr,"INDIRECT",256),r(Hr,"QUERY_RESOLVE",512),r(Hr,"MAP_READ",1),r(Hr,"MAP_WRITE",2),r(Hr,"COPY_SRC",4),r(Hr,"COPY_DST",8),r(Hr,"DEBUG_DATA_MAX_LENGTH",32),r(Hr,"defaultProps",{...Wr.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0});let $r=Hr;function Xr(e){const[t,n,r]=Zr[e],s=e.includes("norm");return{signedType:t,primitiveType:n,byteLength:r,normalized:s,integer:!s&&!e.startsWith("float"),signed:e.startsWith("s")}}function qr(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}function Yr(e){const t=ArrayBuffer.isView(e)?e.constructor:e;if(t===Uint8ClampedArray)return"uint8";const n=Object.values(Zr).find(e=>t===e[4]);if(!n)throw new Error(t.name);return n[0]}function Kr(e){const[,,,,t]=Zr[e];return t}const Zr={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]};function Qr(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);const[n,r]=e.split("x"),s=n,i=r?parseInt(r):1,o=Xr(s),a={type:s,components:i,byteLength:o.byteLength*i,integer:o.integer,signed:o.signed,normalized:o.normalized};return t&&(a.webglOnly=!0),a}function Jr(e,t,n){if(!t||t>4)throw new Error(`size ${t}`);const r=t;return function(e,t,n){const r=n?function(e){const t=e;switch(t){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return t}}(e):e;switch(r){case"unorm8":return 1===t?"unorm8":3===t?"unorm8x3-webgl":`${r}x${t}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(1===t||3===t)throw new Error(`size: ${t}`);return`${r}x${t}`;default:return 1===t?r:`${r}x${t}`}}(Yr(e),r,n)}const es="texture-compression-bc",ts="texture-compression-astc",ns="texture-compression-etc2",rs="texture-compression-pvrtc-webgl",ss="texture-compression-atc-webgl",is="float32-renderable-webgl",os="float16-renderable-webgl",as="snorm8-renderable-webgl",ls="norm16-renderable-webgl",cs="snorm16-renderable-webgl",us="float32-filterable",hs="float16-filterable-webgl";function ds(e){const t=fs[e];if(!t)throw new Error(`Unsupported texture format ${e}`);return t}const fs={r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:as},rg8snorm:{render:as},"rgb8snorm-webgl":{},rgba8snorm:{render:as},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:ls},rg16unorm:{render:ls},"rgb16unorm-webgl":{f:ls},rgba16unorm:{render:ls},r16snorm:{f:cs},rg16snorm:{render:cs},"rgb16snorm-webgl":{f:ls},rgba16snorm:{render:cs},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:os,filter:"float16-filterable-webgl"},rg16float:{render:os,filter:hs},rgba16float:{render:os,filter:hs},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:is,filter:us},rg32float:{render:!1,filter:us},"rgb32float-webgl":{render:is,filter:us},rgba32float:{render:is,filter:us},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:"rgb9e5ufloat-renderable-webgl"},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:is},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:es},"bc1-rgb-unorm-srgb-webgl":{f:es},"bc1-rgba-unorm":{f:es},"bc1-rgba-unorm-srgb":{f:es},"bc2-rgba-unorm":{f:es},"bc2-rgba-unorm-srgb":{f:es},"bc3-rgba-unorm":{f:es},"bc3-rgba-unorm-srgb":{f:es},"bc4-r-unorm":{f:es},"bc4-r-snorm":{f:es},"bc5-rg-unorm":{f:es},"bc5-rg-snorm":{f:es},"bc6h-rgb-ufloat":{f:es},"bc6h-rgb-float":{f:es},"bc7-rgba-unorm":{f:es},"bc7-rgba-unorm-srgb":{f:es},"etc2-rgb8unorm":{f:ns},"etc2-rgb8unorm-srgb":{f:ns},"etc2-rgb8a1unorm":{f:ns},"etc2-rgb8a1unorm-srgb":{f:ns},"etc2-rgba8unorm":{f:ns},"etc2-rgba8unorm-srgb":{f:ns},"eac-r11unorm":{f:ns},"eac-r11snorm":{f:ns},"eac-rg11unorm":{f:ns},"eac-rg11snorm":{f:ns},"astc-4x4-unorm":{f:ts},"astc-4x4-unorm-srgb":{f:ts},"astc-5x4-unorm":{f:ts},"astc-5x4-unorm-srgb":{f:ts},"astc-5x5-unorm":{f:ts},"astc-5x5-unorm-srgb":{f:ts},"astc-6x5-unorm":{f:ts},"astc-6x5-unorm-srgb":{f:ts},"astc-6x6-unorm":{f:ts},"astc-6x6-unorm-srgb":{f:ts},"astc-8x5-unorm":{f:ts},"astc-8x5-unorm-srgb":{f:ts},"astc-8x6-unorm":{f:ts},"astc-8x6-unorm-srgb":{f:ts},"astc-8x8-unorm":{f:ts},"astc-8x8-unorm-srgb":{f:ts},"astc-10x5-unorm":{f:ts},"astc-10x5-unorm-srgb":{f:ts},"astc-10x6-unorm":{f:ts},"astc-10x6-unorm-srgb":{f:ts},"astc-10x8-unorm":{f:ts},"astc-10x8-unorm-srgb":{f:ts},"astc-10x10-unorm":{f:ts},"astc-10x10-unorm-srgb":{f:ts},"astc-12x10-unorm":{f:ts},"astc-12x10-unorm-srgb":{f:ts},"astc-12x12-unorm":{f:ts},"astc-12x12-unorm-srgb":{f:ts},"pvrtc-rgb4unorm-webgl":{f:rs},"pvrtc-rgba4unorm-webgl":{f:rs},"pvrtc-rbg2unorm-webgl":{f:rs},"pvrtc-rgba2unorm-webgl":{f:rs},"etc1-rbg-unorm-webgl":{f:"texture-compression-etc1-webgl"},"atc-rgb-unorm-webgl":{f:ss},"atc-rgba-unorm-webgl":{f:ss},"atc-rgbai-unorm-webgl":{f:ss}},ps=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],gs=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/,ms=new class{getInfo(e){return _s(e)}isColor(e){return e.startsWith("rgba")||e.startsWith("bgra")||e.startsWith("rgb")}isDepthStencil(e){return e.startsWith("depth")||e.startsWith("stencil")}isCompressed(e){return ps.some(t=>e.startsWith(t))}getCapabilities(e){const t=ds(e),n={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},r=_s(e),s=e.startsWith("depth")||e.startsWith("stencil"),i=null==r?void 0:r.signed,o=null==r?void 0:r.integer,a=null==r?void 0:r.webgl;return n.render&&(n.render=!i),n.filter&&(n.filter=!(s||i||o||a)),n}};function _s(e){let t=function(e){var t;const n=ds(e),r=n.bytesPerPixel||1,s=n.bitsPerChannel||[8,8,8,8];delete n.bitsPerChannel,delete n.bytesPerPixel,delete n.f,delete n.render,delete n.filter,delete n.blend,delete n.store;return{...n,format:e,attachment:n.attachment||"color",channels:n.channels||"r",components:n.components||(null==(t=n.channels)?void 0:t.length)||1,bytesPerPixel:r,bitsPerChannel:s,dataType:n.dataType||"uint8",srgb:n.srgb??!1,packed:n.packed??!1,webgl:n.webgl??!1,integer:n.integer??!1,signed:n.signed??!1,normalized:n.normalized??!1,compressed:n.compressed??!1}}(e);if(ms.isCompressed(e)){t.channels="rgb",t.components=3,t.bytesPerPixel=1,t.srgb=!1,t.compressed=!0;const n=function(e){const t=/.*-(\d+)x(\d+)-.*/.exec(e);if(t){const[,e,n]=t;return{blockWidth:Number(e),blockHeight:Number(n)}}return null}(e);n&&(t.blockWidth=n.blockWidth,t.blockHeight=n.blockHeight)}const n=gs.exec(e);if(n){const[,r,s,i,o,a]=n,l=Xr(`${i}${s}`),c=8*l.byteLength,u=r.length,h=[c,u>=2?c:0,u>=3?c:0,u>=4?c:0];t={format:e,attachment:t.attachment,dataType:l.signedType,components:u,channels:r,integer:l.integer,signed:l.signed,normalized:l.normalized,bitsPerChannel:h,bytesPerPixel:l.byteLength*r.length,packed:t.packed,srgb:t.srgb},"-webgl"===a&&(t.webgl=!0),"-srgb"===o&&(t.srgb=!0)}return e.endsWith("-webgl")&&(t.webgl=!0),e.endsWith("-srgb")&&(t.srgb=!0),t}class ys{}class bs{constructor(e=[],t){r(this,"features"),r(this,"disabledFeatures"),this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){var t;return!(null==(t=this.disabledFeatures)?void 0:t[e])&&this.features.has(e)}}const vs=class e{constructor(t){r(this,"id"),r(this,"props"),r(this,"userData",{}),r(this,"statsManager",jr),r(this,"timestamp",0),r(this,"_reused",!1),r(this,"_lumaData",{}),r(this,"_textureCaps",{}),this.props={...e.defaultProps,...t},this.id=this.props.id||zr(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}getVertexFormatInfo(e){return Qr(e)}isVertexFormatSupported(e){return!0}getTextureFormatInfo(e){return ms.getInfo(e)}getTextureFormatCapabilities(e){let t=this._textureCaps[e];if(!t){const n=this._getDeviceTextureFormatCapabilities(e);t=this._getDeviceSpecificTextureFormatCapabilities(n),this._textureCaps[e]=t}return t}getMipLevelCount(e,t,n=1){const r=Math.max(e,t,n);return 1+Math.floor(Math.log2(r))}isExternalImage(e){return function(e){return"undefined"!=typeof ImageData&&e instanceof ImageData||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas}(e)}getExternalImageSize(e){return function(e){if("undefined"!=typeof ImageData&&e instanceof ImageData||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if("undefined"!=typeof VideoFrame&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}(e)}isTextureFormatSupported(e){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return ms.isCompressed(e)}pushDebugGroup(e){this.commandEncoder.pushDebugGroup(e)}popDebugGroup(){var e;null==(e=this.commandEncoder)||e.popDebugGroup()}insertDebugMarker(e){var t;null==(t=this.commandEncoder)||t.insertDebugMarker(e)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(e,t,...n){return this.props.onError(e,t)?()=>{}:Vr.error(e.message,t,...n)}debug(){if(this.props.debug);else{const e="'Type luma.log.set({debug: true}) in console to enable debug breakpoints',\nor create a device with the 'debug: true' prop.";Vr.once(0,e)()}}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(e){return this.commandEncoder.beginRenderPass(e)}beginComputePass(e){return this.commandEncoder.beginComputePass(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return!0===e.createCanvasContext?{}:e.createCanvasContext}_getDeviceTextureFormatCapabilities(e){const t=ms.getCapabilities(e),n=e=>("string"==typeof e?this.features.has(e):e)??!0,r=n(t.create);return{format:e,create:r,render:r&&n(t.render),filter:r&&n(t.filter),blend:r&&n(t.blend),store:r&&n(t.store)}}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};if((e.usage||0)&$r.INDEX&&(e.indexType||(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array&&(t.indexType="uint16")),!t.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return t}};r(vs,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(e,t)=>{},onResize:(e,t)=>{const[n,r]=e.getDevicePixelSize();Vr.log(1,`${e} resized => ${n}x${r}px`)()},onPositionChange:(e,t)=>{const[n,r]=e.getPosition();Vr.log(1,`${e} repositioned => ${n},${r}`)()},onVisibilityChange:e=>Vr.log(1,`${e} Visibility changed ${e.isVisible}`)(),onDevicePixelRatioChange:(e,t)=>Vr.log(1,`${e} DPR changed ${t.oldRatio} => ${e.devicePixelRatio}`)(),debug:Vr.get("debug")||void 0,debugShaders:Vr.get("debug-shaders")||void 0,debugFramebuffers:Boolean(Vr.get("debug-framebuffers")),debugFactories:Boolean(Vr.get("debug-factories")),debugWebGL:Boolean(Vr.get("debug-webgl")),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0});let xs=vs;const ws="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",Es=class e{constructor(){if(r(this,"stats",jr),r(this,"log",Vr),r(this,"VERSION","9.2.5"),r(this,"spector"),r(this,"preregisteredAdapters",new Map),globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Vr.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),Vr.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Vr.error("This version of luma.gl has already been initialized")()}Vr.log(1,`${this.VERSION} - set luma.log.level=1 (or higher) to trace rendering`)(),globalThis.luma=this}async createDevice(t={}){const n={...e.defaultProps,...t},r=this.selectAdapter(n.type,n.adapters);if(!r)throw new Error(ws);return n.waitForPageLoad&&await r.pageLoaded,await r.create(n)}async attachDevice(e,t){var n;const r=this._getTypeFromHandle(e,t.adapters),s=r&&this.selectAdapter(r,t.adapters);if(!s)throw new Error(ws);return await(null==(n=null==s?void 0:s.attach)?void 0:n.call(s,e,t))}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this._getAdapterMap(e);return Array.from(t).map(([,e])=>e).filter(e=>{var t;return null==(t=e.isSupported)?void 0:t.call(e)}).map(e=>e.type)}getBestAvailableAdapterType(e=[]){var t,n;const r=["webgpu","webgl","null"],s=this._getAdapterMap(e);for(const i of r)if(null==(n=null==(t=s.get(i))?void 0:t.isSupported)?void 0:n.call(t))return i;return null}selectAdapter(e,t=[]){let n=e;"best-available"===e&&(n=this.getBestAvailableAdapterType(t));const r=this._getAdapterMap(t);return n&&r.get(n)||null}enforceWebGL2(e=!0,t=[]){var n;const r=this._getAdapterMap(t).get("webgl");r||Vr.warn("enforceWebGL2: webgl adapter not found")(),null==(n=null==r?void 0:r.enforceWebGL2)||n.call(r,e)}setDefaultDeviceProps(t){Object.assign(e.defaultProps,t)}_getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const n of e)t.set(n.type,n);return t}_getTypeFromHandle(e,t=[]){return e instanceof WebGL2RenderingContext?"webgl":"undefined"!=typeof GPUDevice&&e instanceof GPUDevice||(null==e?void 0:e.queue)?"webgpu":null===e?"null":(e instanceof WebGLRenderingContext?Vr.warn("WebGL1 is not supported",e)():Vr.warn("Unknown handle type",e)(),null)}};r(Es,"defaultProps",{...xs.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0});const Ts=new Es;class Ss{get pageLoaded(){return Cs||(Cs=Rs()||"undefined"==typeof window?Promise.resolve():new Promise(e=>window.addEventListener("load",()=>e()))),Cs}}const As=Ke()&&"undefined"!=typeof document,Rs=()=>As&&"complete"===document.readyState;let Cs=null;const ks=class e{constructor(t){var n,s;if(r(this,"id"),r(this,"props"),r(this,"canvas"),r(this,"htmlCanvas"),r(this,"offscreenCanvas"),r(this,"type"),r(this,"initialized"),r(this,"isInitialized",!1),r(this,"isVisible",!0),r(this,"cssWidth"),r(this,"cssHeight"),r(this,"devicePixelRatio"),r(this,"devicePixelWidth"),r(this,"devicePixelHeight"),r(this,"drawingBufferWidth"),r(this,"drawingBufferHeight"),r(this,"_initializedResolvers",function(){let e,t;return{promise:new Promise((n,r)=>{e=n,t=r}),resolve:e,reject:t}}()),r(this,"_resizeObserver"),r(this,"_intersectionObserver"),r(this,"_position"),r(this,"destroyed",!1),this.props={...e.defaultProps,...t},t=this.props,this.initialized=this._initializedResolvers.promise,Ke()?t.canvas?"string"==typeof t.canvas?this.canvas=function(e){const t=document.getElementById(e);if(!Is.isHTMLCanvas(t))throw new Error("Object is not a canvas element");return t}(t.canvas):this.canvas=t.canvas:this.canvas=function(e){const{width:t,height:n}=e,r=document.createElement("canvas");r.id=zr("lumagl-auto-created-canvas"),r.width=t||1,r.height=n||1,r.style.width=Number.isFinite(t)?`${t}px`:"100%",r.style.height=Number.isFinite(n)?`${n}px`:"100%",(null==e?void 0:e.visible)||(r.style.visibility="hidden");const s=function(e){if("string"==typeof e){const t=document.getElementById(e);if(!t)throw new Error(`${e} is not an HTML element`);return t}return e||document.body}((null==e?void 0:e.container)||null);return s.insertBefore(r,s.firstChild),r}(t):this.canvas={width:t.width||1,height:t.height||1},e.isHTMLCanvas(this.canvas)?(this.id=t.id||this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):e.isOffscreenCanvas(this.canvas)?(this.id=t.id||"offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas):(this.id=t.id||"node-canvas-context",this.type="node"),this.cssWidth=(null==(n=this.htmlCanvas)?void 0:n.clientWidth)||this.canvas.width,this.cssHeight=(null==(s=this.htmlCanvas)?void 0:s.clientHeight)||this.canvas.height,this.devicePixelWidth=this.canvas.width,this.devicePixelHeight=this.canvas.height,this.drawingBufferWidth=this.canvas.width,this.drawingBufferHeight=this.canvas.height,this.devicePixelRatio=globalThis.devicePixelRatio||1,this._position=[0,0],e.isHTMLCanvas(this.canvas)){this._intersectionObserver=new IntersectionObserver(e=>this._handleIntersection(e)),this._intersectionObserver.observe(this.canvas),this._resizeObserver=new ResizeObserver(e=>this._handleResize(e));try{this._resizeObserver.observe(this.canvas,{box:"device-pixel-content-box"})}catch{this._resizeObserver.observe(this.canvas,{box:"content-box"})}setTimeout(()=>this._observeDevicePixelRatio(),0),this.props.trackPosition&&this._trackPosition()}}static isHTMLCanvas(e){return"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement}static isOffscreenCanvas(e){return"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}destroy(){this.destroyed=!0}setProps(e){return"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1,this._updateDrawingBufferSize()),this}getCSSSize(){return[this.cssWidth,this.cssHeight]}getPosition(){return this._position}getDevicePixelSize(){return[this.devicePixelWidth,this.devicePixelHeight]}getDrawingBufferSize(){return[this.drawingBufferWidth,this.drawingBufferHeight]}getMaxDrawingBufferSize(){const e=this.device.limits.maxTextureDimension2D;return[e,e]}setDrawingBufferSize(e,t){this.canvas.width=e,this.canvas.height=t,this.drawingBufferWidth=e,this.drawingBufferHeight=t}getDevicePixelRatio(){return"undefined"!=typeof window&&window.devicePixelRatio||1}cssToDevicePixels(e,t=!0){const n=this.cssToDeviceRatio(),[r,s]=this.getDrawingBufferSize();return function(e,t,n,r,s){const i=e,o=Ps(i[0],t,n);let a=Ms(i[1],t,r,s),l=Ps(i[0]+1,t,n);const c=l===n-1?l:l-1;let u;return l=Ms(i[1]+1,t,r,s),s?(l=0===l?l:l+1,u=a,a=l):u=l===r-1?l:l-1,{x:o,y:a,width:Math.max(c-o+1,1),height:Math.max(u-a+1,1)}}(e,n,r,s,t)}getPixelSize(){return this.getDevicePixelSize()}getAspect(){const[e,t]=this.getDevicePixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),[t]=this.getCSSSize();return t?e/t:1}catch{return 1}}resize(e){this.setDrawingBufferSize(e.width,e.height)}_setAutoCreatedCanvasId(e){var t;"lumagl-auto-created-canvas"===(null==(t=this.htmlCanvas)?void 0:t.id)&&(this.htmlCanvas.id=e)}_handleIntersection(e){const t=e.find(e=>e.target===this.canvas);if(!t)return;const n=t.isIntersecting;this.isVisible!==n&&(this.isVisible=n,this.device.props.onVisibilityChange(this))}_handleResize(e){var t,n;const r=e.find(e=>e.target===this.canvas);if(!r)return;this.cssWidth=r.contentBoxSize[0].inlineSize,this.cssHeight=r.contentBoxSize[0].blockSize;const s=this.getDevicePixelSize(),i=(null==(t=r.devicePixelContentBoxSize)?void 0:t[0].inlineSize)||r.contentBoxSize[0].inlineSize*devicePixelRatio,o=(null==(n=r.devicePixelContentBoxSize)?void 0:n[0].blockSize)||r.contentBoxSize[0].blockSize*devicePixelRatio,[a,l]=this.getMaxDrawingBufferSize();this.devicePixelWidth=Math.max(1,Math.min(i,a)),this.devicePixelHeight=Math.max(1,Math.min(o,l)),this._updateDrawingBufferSize(),this.device.props.onResize(this,{oldPixelSize:s})}_updateDrawingBufferSize(){if(this.props.autoResize){if("number"==typeof this.props.useDevicePixels){const e=this.props.useDevicePixels;this.setDrawingBufferSize(this.cssWidth*e,this.cssHeight*e)}else this.props.useDevicePixels?this.setDrawingBufferSize(this.devicePixelWidth,this.devicePixelHeight):this.setDrawingBufferSize(this.cssWidth,this.cssHeight);this._updateDevice()}this._initializedResolvers.resolve(),this.isInitialized=!0,this.updatePosition()}_observeDevicePixelRatio(){const e=this.devicePixelRatio;this.devicePixelRatio=window.devicePixelRatio,this.updatePosition(),this.device.props.onDevicePixelRatioChange(this,{oldRatio:e}),matchMedia(`(resolution: ${this.devicePixelRatio}dppx)`).addEventListener("change",()=>this._observeDevicePixelRatio(),{once:!0})}_trackPosition(e=100){const t=setInterval(()=>{this.destroyed?clearInterval(t):this.updatePosition()},e)}updatePosition(){var e,t,n;const r=null==(e=this.htmlCanvas)?void 0:e.getBoundingClientRect();if(r){const e=[r.left,r.top];if(this._position??(this._position=e),e[0]!==this._position[0]||e[1]!==this._position[1]){const r=this._position;this._position=e,null==(n=(t=this.device.props).onPositionChange)||n.call(t,this,{oldPosition:r})}}}};r(ks,"defaultProps",{id:void 0,canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb",trackPosition:!1});let Is=ks;function Ps(e,t,n){return Math.min(Math.round(e*t),n-1)}function Ms(e,t,n,r){return r?Math.max(0,n-1-Math.round(e*t)):Math.min(Math.round(e*t),n-1)}const Ns=class e extends Wr{get[Symbol.toStringTag](){return"Sampler"}constructor(t,n){super(t,n=e.normalizeProps(t,n),e.defaultProps)}static normalizeProps(e,t){return t}};r(Ns,"defaultProps",{...Wr.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Ls=Ns;const Os={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"},Fs=class e extends Wr{constructor(t,n){if(super(t,n=e.normalizeProps(t,n),e.defaultProps),r(this,"dimension"),r(this,"baseDimension"),r(this,"format"),r(this,"width"),r(this,"height"),r(this,"depth"),r(this,"mipLevels"),r(this,"updateTimestamp"),this.dimension=this.props.dimension,this.baseDimension=Os[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,void 0===this.props.width||void 0===this.props.height)if(t.isExternalImage(n.data)){const e=t.getExternalImageSize(n.data);this.width=(null==e?void 0:e.width)||1,this.height=(null==e?void 0:e.height)||1}else this.width=1,this.height=1,void 0!==this.props.width&&void 0!==this.props.height||Vr.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}setSampler(e){this.sampler=e instanceof Ls?e:this.device.createSampler(e)}clone(e){return this.device.createTexture({...this.props,...e})}static normalizeProps(e,t){const n={...t},{width:r,height:s}=n;return"number"==typeof r&&(n.width=Math.max(1,Math.ceil(r))),"number"==typeof s&&(n.height=Math.max(1,Math.ceil(s))),n}_initializeData(e){this.device.isExternalImage(e)?this.copyExternalImage({image:e,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):e&&this.copyImageData({data:e,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(t){const{width:n,height:r,depth:s}=this,i={...e.defaultCopyDataOptions,width:n,height:r,depth:s,...t},o=this.device.getTextureFormatInfo(this.format);if(!t.bytesPerRow&&!o.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return i.bytesPerRow=t.bytesPerRow||n*(o.bytesPerPixel||4),i.rowsPerImage=t.rowsPerImage||r,i}_normalizeCopyExternalImageOptions(t){const n=this.device.getExternalImageSize(t.image),r={...e.defaultCopyExternalImageOptions,...n,...t};return r.width=Math.min(r.width,this.width-r.x),r.height=Math.min(r.height,this.height-r.y),r}};r(Fs,"SAMPLE",4),r(Fs,"STORAGE",8),r(Fs,"RENDER",16),r(Fs,"COPY_SRC",1),r(Fs,"COPY_DST",2),r(Fs,"TEXTURE",4),r(Fs,"RENDER_ATTACHMENT",16),r(Fs,"defaultProps",{...Wr.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:Fs.TEXTURE|Fs.RENDER_ATTACHMENT|Fs.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0}),r(Fs,"defaultCopyDataOptions",{data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"}),r(Fs,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let Ds=Fs;const Bs=class e extends Wr{get[Symbol.toStringTag](){return"TextureView"}constructor(t,n){super(t,n,e.defaultProps)}};r(Bs,"defaultProps",{...Wr.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Us=Bs;function js(e,t,n,r){if(null==r?void 0:r.inlineSource){const r=function(e,t){let n="";for(let r=t-2;r<=t;r++){const s=e[r-1];void 0!==s&&(n+=Vs(s,t,undefined))}return n}(t,n);return`\n${r}${e.linePos>0?`${" ".repeat(e.linePos+5)}^^^\n`:""}${e.type.toUpperCase()}: ${e.message}\n\n`}const s="error"===e.type?"red":"#8B4000";return(null==r?void 0:r.html)?`<div class='luma-compiler-log-error' style="color:${s};"><b> ${e.type.toUpperCase()}: ${e.message}</b></div>`:`${e.type.toUpperCase()}: ${e.message}`}function Vs(e,t,n){const r=(null==n?void 0:n.html)?e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"):e;return`${function(e){let t="";for(let n=e.length;n<4;++n)t+=" ";return t+e}(String(t))}: ${r}${(null==n?void 0:n.html)?"<br/>":"\n"}`}const Gs=class e extends Wr{constructor(t,n){super(t,{id:Ws(n={...n,debugShaders:n.debugShaders||t.props.debugShaders||"errors"}),...n},e.defaultProps),r(this,"stage"),r(this,"source"),r(this,"compilationStatus","pending"),this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if("success"===this.compilationStatus)return}const t=await this.getCompilationInfo();"warnings"===e&&0===(null==t?void 0:t.length)||this._displayShaderLog(t,this.id)}_displayShaderLog(e,t){var n;if("undefined"==typeof document||!(null==document?void 0:document.createElement))return;const r=t,s=`${this.stage} shader "${r}"`;let i=function(e,t,n){let r="";const s=t.split(/\r?\n/),i=e.slice().sort((e,t)=>e.lineNum-t.lineNum);switch((null==n?void 0:n.showSourceCode)||"no"){case"all":let t=0;for(let e=1;e<=s.length;e++)for(r+=Vs(s[e-1],e,n);i.length>t&&i[t].lineNum===e;){const e=i[t++];r+=js(e,s,e.lineNum,{...n,inlineSource:!1})}for(;i.length>t;)r+=js(i[t++],[],0,{...n,inlineSource:!1});return r;case"issues":case"no":for(const i of e)r+=js(i,s,i.lineNum,{inlineSource:"no"!==(null==n?void 0:n.showSourceCode)});return r}}(e,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(i+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`\n<h1>Compilation error in ${s}</h1><br /><br />\n<code style="user-select:text;"><pre>\n${i}\n</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a),null==(n=document.getElementsByClassName("luma-compiler-log-error")[0])||n.scrollIntoView(),a.onclick=()=>{const e=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(e)}}};r(Gs,"defaultProps",{...Wr.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let zs=Gs;function Ws(e){return function(e,t="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return n?n[1]:t}(e.source)||e.id||zr(`unnamed ${e.stage}-shader`)}const Hs=class e extends Wr{constructor(t,n={}){super(t,n,e.defaultProps),r(this,"width"),r(this,"height"),this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(e){const t=this.colorAttachments.map(t=>t.texture.clone(e)),n=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:t,depthStencilAttachment:n})}resize(e){let t=!e;if(e){const[n,r]=Array.isArray(e)?e:[e.width,e.height];t=t||r!==this.height||n!==this.width,this.width=n,this.height=r}t&&(Vr.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(0===this.props.colorAttachments.length&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((e,t)=>{if("string"==typeof e){const n=this.createColorTexture(e,t);return this.attachResource(n),n.view}return e instanceof Ds?e.view:e});const e=this.props.depthStencilAttachment;if(e)if("string"==typeof e){const t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else this.depthStencilAttachment=e instanceof Ds?e.view:e}createColorTexture(e,t){return this.device.createTexture({id:`${this.id}-color-attachment-${t}`,usage:Ds.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:Ds.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,t){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const r=this.colorAttachments[n].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=r.view,this.attachResource(r.view)}if(this.depthStencilAttachment){const n=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}this.updateAttachments()}};r(Hs,"defaultProps",{...Wr.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let $s=Hs;const Xs=class e extends Wr{constructor(t,n){super(t,n,e.defaultProps),r(this,"shaderLayout"),r(this,"bufferLayout"),r(this,"linkStatus","pending"),r(this,"hash",""),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}};r(Xs,"defaultProps",{...Wr.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}});let qs=Xs;const Ys=class e extends Wr{get[Symbol.toStringTag](){return"RenderPass"}constructor(t,n){super(t,n=e.normalizeProps(t,n),e.defaultProps)}static normalizeProps(e,t){return t}};r(Ys,"defaultClearColor",[0,0,0,1]),r(Ys,"defaultClearDepth",1),r(Ys,"defaultClearStencil",0),r(Ys,"defaultProps",{...Wr.defaultProps,framebuffer:null,parameters:void 0,clearColor:Ys.defaultClearColor,clearColors:void 0,clearDepth:Ys.defaultClearDepth,clearStencil:Ys.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Ks=Ys;const Zs=class e extends Wr{constructor(t,n){super(t,n,e.defaultProps),r(this,"hash",""),r(this,"shaderLayout"),this.shaderLayout=n.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};r(Zs,"defaultProps",{...Wr.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Qs=Zs;const Js=class e extends Wr{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(t,n){super(t,n,e.defaultProps)}};r(Js,"defaultProps",{...Wr.defaultProps,measureExecutionTime:void 0});let ei=Js;const ti=class e extends Wr{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(t,n){super(t,n,e.defaultProps)}};r(ti,"defaultProps",{...Wr.defaultProps});let ni=ti;function ri(e){return oi[e]}const si={f32:4,f16:2,i32:4,u32:4},ii={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},oi={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}};function ai(e,t){const n={};for(const r of e.attributes){const s=li(e,t,r.name);s&&(n[r.name]=s)}return n}function li(e,t,n){const r=function(e,t){const n=e.attributes.find(e=>e.name===t);return n||Vr.warn(`shader layout attribute "${t}" not present in shader`),n||null}(e,n),s=function(e,t){!function(e){for(const t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&Vr.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}(e);let n=function(e,t){for(const n of e)if(n.format&&n.name===t)return{attributeName:n.name,bufferName:t,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}(e,t);return n||(n=function(e,t){var n;for(const r of e){let e=r.byteStride;if("number"!=typeof r.byteStride)for(const t of r.attributes||[])e+=Qr(t.format).byteLength;const s=null==(n=r.attributes)?void 0:n.find(e=>e.attribute===t);if(s)return{attributeName:s.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:e}}return null}(e,t),n||(Vr.warn(`layout for attribute "${t}" not present in buffer layout`),null))}(t,n);if(!r)return null;const i=function(e){const[t,n]=ii[e];return{primitiveType:t,components:n,byteLength:si[t]*n,integer:"i32"===t||"u32"===t,signed:"u32"!==t}}(r.type),o=function(e){let t;switch(e.primitiveType){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e.components<=2?"float16x2":"float16x4"}return 1===e.components?t:`${t}x${e.components}`}(i),a=(null==s?void 0:s.vertexFormat)||o,l=Qr(a);return{attributeName:(null==s?void 0:s.attributeName)||r.name,bufferName:(null==s?void 0:s.bufferName)||r.name,location:r.location,shaderType:r.type,primitiveType:i.primitiveType,shaderComponents:i.components,vertexFormat:a,bufferDataType:l.type,bufferComponents:l.components,normalized:l.normalized,integer:i.integer,stepMode:(null==s?void 0:s.stepMode)||r.stepMode||"vertex",byteOffset:(null==s?void 0:s.byteOffset)||0,byteStride:(null==s?void 0:s.byteStride)||0}}const ci=class e extends Wr{constructor(t,n){super(t,n,e.defaultProps),r(this,"maxVertexAttributes"),r(this,"attributeInfos"),r(this,"indexBuffer",null),r(this,"attributes"),this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=function(e,t,n=16){const r=ai(e,t),s=new Array(n).fill(null);for(const i of Object.values(r))s[i.location]=i;return s}(n.shaderLayout,n.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(e,t){this.device.reportError(new Error("constant attributes not supported"),this)()}};r(ci,"defaultProps",{...Wr.defaultProps,shaderLayout:void 0,bufferLayout:[]});let ui=ci;const hi=class e extends Wr{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(t,n){super(t,n,e.defaultProps)}};r(hi,"defaultProps",{...Wr.defaultProps,layout:void 0,buffers:{}});let di=hi;const fi=class e extends Wr{get[Symbol.toStringTag](){return"QuerySet"}constructor(t,n){super(t,n,e.defaultProps)}};r(fi,"defaultProps",{...Wr.defaultProps,type:void 0,count:void 0});let pi,gi=fi;function mi(e){return(!pi||pi.byteLength<e)&&(pi=new ArrayBuffer(e)),pi}function _i(e){return Array.isArray(e)?0===e.length||"number"==typeof e[0]:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(e)}class yi{constructor(e,t={}){r(this,"layout",{}),r(this,"byteLength");let n=0;for(const[r,i]of Object.entries(e)){const e=ri(i),{type:s,components:o}=e,a=o*((null==t?void 0:t[r])??1);n=qr(n,a);const l=n;n+=a,this.layout[r]={type:s,size:a,offset:l}}n+=(4-n%4)%4;const s=4*n;this.byteLength=Math.max(s,1024)}getData(e){const t=mi(this.byteLength),n={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(const[r,s]of Object.entries(e)){const e=this.layout[r];if(!e){Vr.warn(`Supplied uniform value ${r} not present in uniform block layout`)();continue}const{type:t,size:i,offset:o}=e,a=n[t];if(1===i){if("number"!=typeof s&&"boolean"!=typeof s){Vr.warn(`Supplied value for single component uniform ${r} is not a number: ${s}`)();continue}a[o]=Number(s)}else{if(!_i(s)){Vr.warn(`Supplied value for multi component / array uniform ${r} is not a numeric array: ${s}`)();continue}a.set(s,o)}}return new Uint8Array(t,0,this.byteLength)}has(e){return Boolean(this.layout[e])}get(e){return this.layout[e]}}class bi{constructor(e){var t;if(r(this,"name"),r(this,"uniforms",{}),r(this,"modifiedUniforms",{}),r(this,"modified",!0),r(this,"bindingLayout",{}),r(this,"needsRedraw","initialized"),this.name=(null==e?void 0:e.name)||"unnamed",(null==e?void 0:e.name)&&(null==e?void 0:e.shaderLayout)){const n=null==(t=null==e?void 0:e.shaderLayout.bindings)?void 0:t.find(t=>"uniform"===t.type&&t.name===(null==e?void 0:e.name));if(!n)throw new Error(null==e?void 0:e.name);const r=n;for(const e of r.uniforms||[])this.bindingLayout[e.name]=e}}setUniforms(e){for(const[t,n]of Object.entries(e))this._setUniform(t,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){var n;(function(e,t){if(e!==t)return!1;const n=e,r=t;if(!_i(n))return!1;if(_i(r)&&n.length===r.length)for(let s=0;s<n.length;++s)if(r[s]!==n[s])return!1;return!0})(this.uniforms[e],t)||(this.uniforms[e]=_i(n=t)?n.slice():n,this.modifiedUniforms[e]=!0,this.modified=!0)}}class vi{constructor(e){r(this,"uniformBlocks",new Map),r(this,"uniformBufferLayouts",new Map),r(this,"uniformBuffers",new Map);for(const[t,n]of Object.entries(e)){const e=t,r=new yi(n.uniformTypes??{},n.uniformSizes??{});this.uniformBufferLayouts.set(e,r);const s=new bi({name:t});s.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(e,s)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var t;for(const[n,r]of Object.entries(e))null==(t=this.uniformBlocks.get(n))||t.setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){var t;return(null==(t=this.uniformBufferLayouts.get(e))?void 0:t.byteLength)||0}getUniformBufferData(e){var t,n;const r=(null==(t=this.uniformBlocks.get(e))?void 0:t.getAllUniforms())||{};return null==(n=this.uniformBufferLayouts.get(e))?void 0:n.getData(r)}createUniformBuffer(e,t,n){n&&this.setUniforms(n);const r=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:$r.UNIFORM|$r.COPY_DST,byteLength:r}),i=this.getUniformBufferData(t);return s.write(i),s}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const n=this.getUniformBufferByteLength(t),r=e.createBuffer({usage:$r.UNIFORM|$r.COPY_DST,byteLength:n});this.uniformBuffers.set(t,r)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(t);e||(e=n)}return e&&Vr.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var t;const n=this.uniformBlocks.get(e);let r=this.uniformBuffers.get(e),s=!1;if(r&&(null==n?void 0:n.needsRedraw)){s||(s=n.needsRedraw);const i=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),null==r||r.write(i);const o=null==(t=this.uniformBlocks.get(e))?void 0:t.getAllUniforms();Vr.log(4,`Writing to uniform buffer ${String(e)}`,i,o)()}return s}}class xi{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class wi{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Ei extends xi{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Ti extends xi{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class Si extends xi{constructor(e,t,n){super(e,n),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class Ai extends xi{constructor(e,t,n,r){super(e,n),this.format=t,this.access=r}get isTemplate(){return!0}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+="f",e;if("i32"===this.format.name)return e+="i",e;if("u32"===this.format.name)return e+="u",e;if("bool"===this.format.name)return e+="b",e;if("f16"===this.format.name)return e+="h",e}e+=`<${this.format.name}>`}else if("vec2"===e||"vec3"===e||"vec4"===e)return e;return e}}var Ri,Ci;(Ci=Ri||(Ri={}))[Ci.Uniform=0]="Uniform",Ci[Ci.Storage=1]="Storage",Ci[Ci.Texture=2]="Texture",Ci[Ci.Sampler=3]="Sampler",Ci[Ci.StorageTexture=4]="StorageTexture";class ki{constructor(e,t,n,r,s,i,o){this.name=e,this.type=t,this.group=n,this.binding=r,this.attributes=s,this.resourceType=i,this.access=o}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Ii{constructor(e,t){this.name=e,this.type=t}}class Pi{constructor(e,t,n,r){this.name=e,this.type=t,this.locationType=n,this.location=r,this.interpolation=null}}class Mi{constructor(e,t,n,r){this.name=e,this.type=t,this.locationType=n,this.location=r}}class Ni{constructor(e,t,n,r){this.name=e,this.type=t,this.attributes=n,this.id=r}}class Li{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n}}class Oi{constructor(e,t=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=n}}class Fi{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function Di(e){var t=(32768&e)>>15,n=(31744&e)>>10,r=1023&e;return 0==n?(t?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):31==n?r?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,n-15)*(1+r/Math.pow(2,10))}const Bi=new Float32Array(1),Ui=new Int32Array(Bi.buffer),ji=new Uint16Array(1);function Vi(e){Bi[0]=e;const t=Ui[0],n=t>>31&1;let r=t>>23&255,s=8388607&t;if(255===r)return ji[0]=n<<15|31744|(0!==s?512:0),ji[0];if(0===r){if(0===s)return ji[0]=n<<15,ji[0];s|=8388608;let e=113;for(;!(8388608&s);)s<<=1,e--;return r=127-e,s&=8388607,r>0?(s=(s>>126-r)+(s>>127-r&1),ji[0]=n<<15|r<<10|s>>13,ji[0]):(ji[0]=n<<15,ji[0])}return r=r-127+15,r>=31?(ji[0]=n<<15|31744,ji[0]):r<=0?r<-10?(ji[0]=n<<15,ji[0]):(s=(8388608|s)>>1-r,ji[0]=n<<15|s>>13,ji[0]):(s>>=13,ji[0]=n<<15|r<<10|s,ji[0])}const Gi=new Uint32Array(1),zi=new Float32Array(Gi.buffer,0,1);function Wi(e){const t=112+(e>>6&31)<<23|(63&e)<<17;return Gi[0]=t,zi[0]}function Hi(e,t,n,r){const s=[0,0,0,0];for(let i=0;i<r;++i)switch(n){case"8unorm":s[i]=e[t]/255,t++;break;case"8snorm":s[i]=e[t]/255*2-1,t++;break;case"8uint":s[i]=e[t],t++;break;case"8sint":s[i]=e[t]-127,t++;break;case"16uint":s[i]=e[t]|e[t+1]<<8,t+=2;break;case"16sint":s[i]=(e[t]|e[t+1]<<8)-32768,t+=2;break;case"16float":s[i]=Di(e[t]|e[t+1]<<8),t+=2;break;case"32uint":case"32sint":s[i]=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,t+=4;break;case"32float":s[i]=new Float32Array(e.buffer,t,1)[0],t+=4}return s}function $i(e,t,n,r,s){for(let i=0;i<r;++i)switch(n){case"8unorm":e[t]=255*s[i],t++;break;case"8snorm":e[t]=.5*(s[i]+1)*255,t++;break;case"8uint":e[t]=s[i],t++;break;case"8sint":e[t]=s[i]+127,t++;break;case"16uint":new Uint16Array(e.buffer,t,1)[0]=s[i],t+=2;break;case"16sint":new Int16Array(e.buffer,t,1)[0]=s[i],t+=2;break;case"16float":{const n=Vi(s[i]);new Uint16Array(e.buffer,t,1)[0]=n,t+=2;break}case"32uint":new Uint32Array(e.buffer,t,1)[0]=s[i],t+=4;break;case"32sint":new Int32Array(e.buffer,t,1)[0]=s[i],t+=4;break;case"32float":new Float32Array(e.buffer,t,1)[0]=s[i],t+=4}return s}const Xi={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class qi{constructor(){this.id=qi._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(Yi.instance);for(const n of e)n instanceof Array?this.searchBlock(n,t):n.search(t);t(Ki.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}qi._id=0;class Yi extends qi{}Yi.instance=new Yi;class Ki extends qi{}Ki.instance=new Ki;const Zi=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class Qi extends qi{constructor(){super()}}class Ji extends Qi{constructor(e,t,n,r,s,i){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=n,this.body=r,this.startLine=s,this.endLine=i}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class eo extends Qi{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class to extends Qi{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class no extends Qi{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class ro extends Qi{constructor(e,t,n,r){super(),this.init=e,this.condition=t,this.increment=n,this.body=r}get astNodeType(){return"for"}search(e){var t,n,r;null===(t=this.init)||void 0===t||t.search(e),null===(n=this.condition)||void 0===n||n.search(e),null===(r=this.increment)||void 0===r||r.search(e),this.searchBlock(this.body,e)}}class so extends Qi{constructor(e,t,n,r,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=r,this.value=s}get astNodeType(){return"var"}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}class io extends Qi{constructor(e,t,n){super(),this.attributes=null,this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}search(e){var t;null===(t=this.value)||void 0===t||t.search(e)}}class oo extends Qi{constructor(e,t,n,r,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=r,this.value=s}get astNodeType(){return"let"}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}class ao extends Qi{constructor(e,t,n,r,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=r,this.value=s}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}var lo,co,uo,ho;(e=>{e.increment="++",e.decrement="--"})(lo||(lo={})),(e=>{e.parse=function(t){const n=t;if("parse"==n)throw new Error("Invalid value for IncrementOperator");return e[n]}})(lo||(lo={}));class fo extends Qi{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(e=>{e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="})(co||(co={})),(co||(co={})).parse=function(e){const t=e;if("parse"==t)throw new Error("Invalid value for AssignOperator");return t};class po extends Qi{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class go extends Qi{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return Zi.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class mo extends Qi{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),null===(t=this.continuing)||void 0===t||t.search(e)}}class _o extends Qi{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class yo extends Qi{constructor(e,t,n,r){super(),this.condition=e,this.body=t,this.elseif=n,this.else=r}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class bo extends Qi{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;null===(t=this.value)||void 0===t||t.search(e)}}class vo extends Qi{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class xo extends Qi{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class wo extends Qi{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class Eo extends Qi{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class To extends Qi{constructor(){super()}get astNodeType(){return"discard"}}class So extends Qi{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class Ao extends Qi{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class Ro extends Qi{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if("f32"===t.name)return t;for(let n=1;n<e.length;++n){const r=Ro._priority.get(t.name);Ro._priority.get(e[n].name)<r&&(t=e[n])}return"x32"===t.name?Ro.i32:t}getTypeName(){return this.name}}Ro.x32=new Ro("x32"),Ro.f32=new Ro("f32"),Ro.i32=new Ro("i32"),Ro.u32=new Ro("u32"),Ro.f16=new Ro("f16"),Ro.bool=new Ro("bool"),Ro.void=new Ro("void"),Ro._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Co extends Ro{constructor(e){super(e)}}class ko extends Ro{constructor(e,t,n,r){super(e),this.members=t,this.startLine=n,this.endLine=r}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class Io extends Ro{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+="f",e;if("i32"===this.format.name)return e+="i",e;if("u32"===this.format.name)return e+="u",e;if("bool"===this.format.name)return e+="b",e;if("f16"===this.format.name)return e+="h",e}e+=`<${this.format.name}>`}else if("vec2"===e||"vec3"===e||"vec4"===e)return e;return e}}Io.vec2f=new Io("vec2",Ro.f32,null),Io.vec3f=new Io("vec3",Ro.f32,null),Io.vec4f=new Io("vec4",Ro.f32,null),Io.vec2i=new Io("vec2",Ro.i32,null),Io.vec3i=new Io("vec3",Ro.i32,null),Io.vec4i=new Io("vec4",Ro.i32,null),Io.vec2u=new Io("vec2",Ro.u32,null),Io.vec3u=new Io("vec3",Ro.u32,null),Io.vec4u=new Io("vec4",Ro.u32,null),Io.vec2h=new Io("vec2",Ro.f16,null),Io.vec3h=new Io("vec3",Ro.f16,null),Io.vec4h=new Io("vec4",Ro.f16,null),Io.vec2b=new Io("vec2",Ro.bool,null),Io.vec3b=new Io("vec3",Ro.bool,null),Io.vec4b=new Io("vec4",Ro.bool,null),Io.mat2x2f=new Io("mat2x2",Ro.f32,null),Io.mat2x3f=new Io("mat2x3",Ro.f32,null),Io.mat2x4f=new Io("mat2x4",Ro.f32,null),Io.mat3x2f=new Io("mat3x2",Ro.f32,null),Io.mat3x3f=new Io("mat3x3",Ro.f32,null),Io.mat3x4f=new Io("mat3x4",Ro.f32,null),Io.mat4x2f=new Io("mat4x2",Ro.f32,null),Io.mat4x3f=new Io("mat4x3",Ro.f32,null),Io.mat4x4f=new Io("mat4x4",Ro.f32,null),Io.mat2x2h=new Io("mat2x2",Ro.f16,null),Io.mat2x3h=new Io("mat2x3",Ro.f16,null),Io.mat2x4h=new Io("mat2x4",Ro.f16,null),Io.mat3x2h=new Io("mat3x2",Ro.f16,null),Io.mat3x3h=new Io("mat3x3",Ro.f16,null),Io.mat3x4h=new Io("mat3x4",Ro.f16,null),Io.mat4x2h=new Io("mat4x2",Ro.f16,null),Io.mat4x3h=new Io("mat4x3",Ro.f16,null),Io.mat4x4h=new Io("mat4x4",Ro.f16,null),Io.mat2x2i=new Io("mat2x2",Ro.i32,null),Io.mat2x3i=new Io("mat2x3",Ro.i32,null),Io.mat2x4i=new Io("mat2x4",Ro.i32,null),Io.mat3x2i=new Io("mat3x2",Ro.i32,null),Io.mat3x3i=new Io("mat3x3",Ro.i32,null),Io.mat3x4i=new Io("mat3x4",Ro.i32,null),Io.mat4x2i=new Io("mat4x2",Ro.i32,null),Io.mat4x3i=new Io("mat4x3",Ro.i32,null),Io.mat4x4i=new Io("mat4x4",Ro.i32,null),Io.mat2x2u=new Io("mat2x2",Ro.u32,null),Io.mat2x3u=new Io("mat2x3",Ro.u32,null),Io.mat2x4u=new Io("mat2x4",Ro.u32,null),Io.mat3x2u=new Io("mat3x2",Ro.u32,null),Io.mat3x3u=new Io("mat3x3",Ro.u32,null),Io.mat3x4u=new Io("mat3x4",Ro.u32,null),Io.mat4x2u=new Io("mat4x2",Ro.u32,null),Io.mat4x3u=new Io("mat4x3",Ro.u32,null),Io.mat4x4u=new Io("mat4x4",Ro.u32,null);class Po extends Ro{constructor(e,t,n,r){super(e),this.storage=t,this.type=n,this.access=r}get astNodeType(){return"pointer"}}class Mo extends Ro{constructor(e,t,n,r){super(e),this.attributes=t,this.format=n,this.count=r}get astNodeType(){return"array"}get isArray(){return!0}}class No extends Ro{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}}class Lo extends qi{constructor(){super(),this.postfix=null}}class Oo extends Lo{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Fo extends Lo{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class Do extends Lo{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return Zi.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class Bo extends Lo{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class Uo extends Lo{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const t=e.evalExpression(this.initializer,e.context);return null!==t&&this.postfix?t.getSubData(e,this.postfix,e.context):t}return null}search(e){this.initializer.search(e)}}class jo extends Lo{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return void 0!==t&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof ra}get isVector(){return this.value instanceof ia||this.value instanceof oa}get scalarValue(){return this.value instanceof ra?this.value.value:0}get vectorValue(){return this.value instanceof ia||this.value instanceof oa?this.value.data:new Float32Array(0)}}class Vo extends Lo{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Go extends Lo{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class zo extends Lo{constructor(){super()}}class Wo extends zo{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Ho extends zo{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:"f32"===e.name||"f32"===t.name?Ro.f32:"u32"===e.name||"u32"===t.name?Ro.u32:Ro.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class $o extends qi{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class Xo extends Lo{constructor(){super()}get astNodeType(){return"default"}}class qo extends $o{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class Yo extends $o{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class Ko extends qi{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}}class Zo extends qi{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Qo extends qi{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}}class Jo extends qi{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class ea{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=ea._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,n,r){}getSubData(e,t,n){return null}toString(){return`<${this.typeInfo.getTypeName()}>`}}ea._id=0;class ta extends ea{constructor(){super(new xi("void",null),null)}toString(){return"void"}}ta.void=new ta;class na extends ea{constructor(e){super(new Si("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,n,r){this.reference.setDataValue(e,t,n,r)}getSubData(e,t,n){return t?this.reference.getSubData(e,t,n):this}toString(){return`&${this.reference.toString()}`}}class ra extends ea{constructor(e,t,n=null){super(t,n),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:"x32"===this.typeInfo.name?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):"i32"===this.typeInfo.name||"bool"===this.typeInfo.name?this.data=new Int32Array([e]):"u32"===this.typeInfo.name?this.data=new Uint32Array([e]):("f32"===this.typeInfo.name||"f16"===this.typeInfo.name)&&(this.data=new Float32Array([e]))}clone(){if(this.data instanceof Float32Array)return new ra(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new ra(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new ra(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,n,r){if(n)return;if(!(t instanceof ra))return;let s=t.data[0];"i32"===this.typeInfo.name||"u32"===this.typeInfo.name?s=Math.floor(s):"bool"===this.typeInfo.name&&(s=s?1:0),this.data[0]=s}getSubData(e,t,n){return t?null:this}toString(){return`${this.value}`}}function sa(e,t,n){const r=t.length;return 2===r?"f32"===n?new ia(new Float32Array(t),e.getTypeInfo("vec2f")):"i32"===n||"bool"===n?new ia(new Int32Array(t),e.getTypeInfo("vec2i")):"u32"===n?new ia(new Uint32Array(t),e.getTypeInfo("vec2u")):"f16"===n?new ia(new Float32Array(t),e.getTypeInfo("vec2h")):null:3===r?"f32"===n?new ia(new Float32Array(t),e.getTypeInfo("vec3f")):"i32"===n||"bool"===n?new ia(new Int32Array(t),e.getTypeInfo("vec3i")):"u32"===n?new ia(new Uint32Array(t),e.getTypeInfo("vec3u")):"f16"===n?new ia(new Float32Array(t),e.getTypeInfo("vec3h")):null:4===r?"f32"===n?new ia(new Float32Array(t),e.getTypeInfo("vec4f")):"i32"===n||"bool"===n?new ia(new Int32Array(t),e.getTypeInfo("vec4i")):"u32"===n?new ia(new Uint32Array(t),e.getTypeInfo("vec4u")):"f16"===n?new ia(new Float32Array(t),e.getTypeInfo("vec4h")):null:null}class ia extends ea{constructor(e,t,n=null){if(super(t,n),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?this.data=new Float32Array(e):"vec2i"===t||"vec3i"===t||"vec4i"===t?this.data=new Int32Array(e):"vec2u"===t||"vec3u"===t||"vec4u"===t?this.data=new Uint32Array(e):"vec2h"===t||"vec3h"===t||"vec4h"===t?this.data=new Float32Array(e):"vec2b"===t||"vec3b"===t||"vec4b"===t?this.data=new Int32Array(e):("vec2"===t||"vec3"===t||"vec4"===t)&&(this.data=new Float32Array(e))}}clone(){if(this.data instanceof Float32Array)return new ia(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new ia(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new ia(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,n,r){n instanceof Oo||t instanceof ia&&(this.data=t.data)}getSubData(e,t,n){if(null===t)return this;let r=e.getTypeInfo("f32");if(this.typeInfo instanceof Ai)r=this.typeInfo.format||r;else{const t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?r=e.getTypeInfo("f32"):"vec2i"===t||"vec3i"===t||"vec4i"===t?r=e.getTypeInfo("i32"):"vec2b"===t||"vec3b"===t||"vec4b"===t?r=e.getTypeInfo("bool"):"vec2u"===t||"vec3u"===t||"vec4u"===t?r=e.getTypeInfo("u32"):("vec2h"===t||"vec3h"===t||"vec4h"===t)&&(r=e.getTypeInfo("f16"))}let s=this;for(;null!==t&&null!==s;){if(t instanceof Go){const i=t.index;let o=-1;if(i instanceof jo){if(!(i.value instanceof ra))return null;o=i.value.value}else{const t=e.evalExpression(i,n);if(!(t instanceof ra))return null;o=t.value}if(o<0||o>=s.data.length)return null;if(s.data instanceof Float32Array){const e=new Float32Array(s.data.buffer,s.data.byteOffset+4*o,1);return new ra(e,r)}if(s.data instanceof Int32Array){const e=new Int32Array(s.data.buffer,s.data.byteOffset+4*o,1);return new ra(e,r)}if(s.data instanceof Uint32Array){const e=new Uint32Array(s.data.buffer,s.data.byteOffset+4*o,1);return new ra(e,r)}throw"GetSubData: Invalid data type"}if(!(t instanceof Oo))return null;{const n=t.value.toLowerCase();if(1===n.length){let e=0;if("x"===n||"r"===n)e=0;else if("y"===n||"g"===n)e=1;else if("z"===n||"b"===n)e=2;else{if("w"!==n&&"a"!==n)return null;e=3}if(this.data instanceof Float32Array){let t=new Float32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new ra(t,r,this)}if(this.data instanceof Int32Array){let t=new Int32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new ra(t,r,this)}if(this.data instanceof Uint32Array){let t=new Uint32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new ra(t,r,this)}}const i=[];for(const e of n)"x"===e||"r"===e?i.push(this.data[0]):"y"===e||"g"===e?i.push(this.data[1]):"z"===e||"b"===e?i.push(this.data[2]):("w"===e||"a"===e)&&i.push(this.data[3]);s=sa(e,i,r.name)}t=t.postfix}return s}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class oa extends ea{constructor(e,t,n=null){super(t,n),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new oa(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,n,r){n instanceof Oo||t instanceof oa&&(this.data=t.data)}getSubData(e,t,n){if(null===t)return this;const r=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Ai)this.typeInfo.format;else if(r.endsWith("f"))e.getTypeInfo("f32");else if(r.endsWith("i"))e.getTypeInfo("i32");else if(r.endsWith("u"))e.getTypeInfo("u32");else{if(!r.endsWith("h"))return null;e.getTypeInfo("f16")}if(t instanceof Go){const s=t.index;let i=-1;if(s instanceof jo){if(!(s.value instanceof ra))return null;i=s.value.value}else{const t=e.evalExpression(s,n);if(!(t instanceof ra))return null;i=t.value}if(i<0||i>=this.data.length)return null;const o=r.endsWith("h")?"h":"f";let a;if("mat2x2"===r||"mat2x2f"===r||"mat2x2h"===r||"mat3x2"===r||"mat3x2f"===r||"mat3x2h"===r||"mat4x2"===r||"mat4x2f"===r||"mat4x2h"===r)a=new ia(new Float32Array(this.data.buffer,this.data.byteOffset+2*i*4,2),e.getTypeInfo(`vec2${o}`));else if("mat2x3"===r||"mat2x3f"===r||"mat2x3h"===r||"mat3x3"===r||"mat3x3f"===r||"mat3x3h"===r||"mat4x3"===r||"mat4x3f"===r||"mat4x3h"===r)a=new ia(new Float32Array(this.data.buffer,this.data.byteOffset+3*i*4,3),e.getTypeInfo(`vec3${o}`));else{if("mat2x4"!==r&&"mat2x4f"!==r&&"mat2x4h"!==r&&"mat3x4"!==r&&"mat3x4f"!==r&&"mat3x4h"!==r&&"mat4x4"!==r&&"mat4x4f"!==r&&"mat4x4h"!==r)return null;a=new ia(new Float32Array(this.data.buffer,this.data.byteOffset+4*i*4,4),e.getTypeInfo(`vec4${o}`))}return t.postfix?a.getSubData(e,t.postfix,n):a}return null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class aa extends ea{constructor(e,t,n=0,r=null){super(t,r),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new aa(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,n,r){if(null===t)return;let s=this.offset,i=this.typeInfo;for(;n;){if(n instanceof Go){if(i instanceof Ti){const t=n.index;if(t instanceof jo){if(!(t.value instanceof ra))return;s+=t.value.value*i.stride}else{const n=e.evalExpression(t,r);if(!(n instanceof ra))return;s+=n.value*i.stride}i=i.format}}else{if(!(n instanceof Oo))return;{const e=n.value;if(i instanceof Ei){let t=!1;for(const n of i.members)if(n.name===e){s+=n.offset,i=n.type,t=!0;break}if(!t)return}else if(i instanceof xi){const n=i.getTypeName();let r=0;if("x"===e||"r"===e)r=0;else if("y"===e||"g"===e)r=1;else if("z"===e||"b"===e)r=2;else{if("w"!==e&&"a"!==e)return;r=3}if(!(t instanceof ra))return;const o=t.value;return"vec2f"===n?void(new Float32Array(this.buffer,s,2)[r]=o):"vec3f"===n?void(new Float32Array(this.buffer,s,3)[r]=o):"vec4f"===n?void(new Float32Array(this.buffer,s,4)[r]=o):"vec2i"===n?void(new Int32Array(this.buffer,s,2)[r]=o):"vec3i"===n?void(new Int32Array(this.buffer,s,3)[r]=o):"vec4i"===n?void(new Int32Array(this.buffer,s,4)[r]=o):"vec2u"===n?void(new Uint32Array(this.buffer,s,2)[r]=o):"vec3u"===n?void(new Uint32Array(this.buffer,s,3)[r]=o):"vec4u"===n?void(new Uint32Array(this.buffer,s,4)[r]=o):void 0}}}n=n.postfix}this.setData(e,t,i,s,r)}setData(e,t,n,r,s){const i=n.getTypeName();if("f32"!==i&&"f16"!==i)if("i32"!==i&&"atomic<i32>"!==i&&"x32"!==i)if("u32"!==i&&"atomic<u32>"!==i)if("bool"!==i){if("vec2f"===i||"vec2h"===i){const e=new Float32Array(this.buffer,r,2);return void(t instanceof ia?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3f"===i||"vec3h"===i){const e=new Float32Array(this.buffer,r,3);return void(t instanceof ia?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4f"===i||"vec4h"===i){const e=new Float32Array(this.buffer,r,4);return void(t instanceof ia?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2i"===i){const e=new Int32Array(this.buffer,r,2);return void(t instanceof ia?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3i"===i){const e=new Int32Array(this.buffer,r,3);return void(t instanceof ia?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4i"===i){const e=new Int32Array(this.buffer,r,4);return void(t instanceof ia?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2u"===i){const e=new Uint32Array(this.buffer,r,2);return void(t instanceof ia?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3u"===i){const e=new Uint32Array(this.buffer,r,3);return void(t instanceof ia?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4u"===i){const e=new Uint32Array(this.buffer,r,4);return void(t instanceof ia?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2b"===i){const e=new Uint32Array(this.buffer,r,2);return void(t instanceof ia?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3b"===i){const e=new Uint32Array(this.buffer,r,3);return void(t instanceof ia?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4b"===i){const e=new Uint32Array(this.buffer,r,4);return void(t instanceof ia?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("mat2x2f"===i||"mat2x2h"===i){const e=new Float32Array(this.buffer,r,4);return void(t instanceof oa?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("mat2x3f"===i||"mat2x3h"===i){const e=new Float32Array(this.buffer,r,6);return void(t instanceof oa?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]))}if("mat2x4f"===i||"mat2x4h"===i){const e=new Float32Array(this.buffer,r,8);return void(t instanceof oa?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]))}if("mat3x2f"===i||"mat3x2h"===i){const e=new Float32Array(this.buffer,r,6);return void(t instanceof oa?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]))}if("mat3x3f"===i||"mat3x3h"===i){const e=new Float32Array(this.buffer,r,9);return void(t instanceof oa?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]))}if("mat3x4f"===i||"mat3x4h"===i){const e=new Float32Array(this.buffer,r,12);return void(t instanceof oa?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]))}if("mat4x2f"===i||"mat4x2h"===i){const e=new Float32Array(this.buffer,r,8);return void(t instanceof oa?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]))}if("mat4x3f"===i||"mat4x3h"===i){const e=new Float32Array(this.buffer,r,12);return void(t instanceof oa?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]))}if("mat4x4f"===i||"mat4x4h"===i){const e=new Float32Array(this.buffer,r,16);return void(t instanceof oa?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11],e[12]=t.data[12],e[13]=t.data[13],e[14]=t.data[14],e[15]=t.data[15]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}if(t instanceof aa&&n===t.typeInfo)return void new Uint8Array(this.buffer,r,t.buffer.byteLength).set(new Uint8Array(t.buffer))}else t instanceof ra&&(new Int32Array(this.buffer,r,1)[0]=t.value);else t instanceof ra&&(new Uint32Array(this.buffer,r,1)[0]=t.value);else t instanceof ra&&(new Int32Array(this.buffer,r,1)[0]=t.value);else t instanceof ra&&(new Float32Array(this.buffer,r,1)[0]=t.value)}getSubData(e,t,n){var r,s;if(null===t)return this;let i=this.offset,o=this.typeInfo;for(;t;){if(t instanceof Go){const r=t.index,s=r instanceof Lo?e.evalExpression(r,n):r;let a=0;if(s instanceof ra?a=s.value:"number"==typeof s&&(a=s),o instanceof Ti)i+=a*o.stride,o=o.format;else{const t=o.getTypeName();("mat4x4"===t||"mat4x4f"===t||"mat4x4h"===t)&&(i+=16*a,o=e.getTypeInfo("vec4f"))}}else{if(!(t instanceof Oo))return null;{const n=t.value;if(o instanceof Ei){let e=!1;for(const t of o.members)if(t.name===n){i+=t.offset,o=t.type,e=!0;break}if(!e)return null}else if(o instanceof xi){const t=o.getTypeName();if("vec2f"===t||"vec3f"===t||"vec4f"===t||"vec2i"===t||"vec3i"===t||"vec4i"===t||"vec2u"===t||"vec3u"===t||"vec4u"===t||"vec2b"===t||"vec3b"===t||"vec4b"===t||"vec2h"===t||"vec3h"===t||"vec4h"===t||"vec2"===t||"vec3"===t||"vec4"===t){if(n.length>0&&n.length<5){let r="f";const s=[];for(let o=0;o<n.length;++o){const a=n[o].toLowerCase();let l=0;if("x"===a||"r"===a)l=0;else if("y"===a||"g"===a)l=1;else if("z"===a||"b"===a)l=2;else{if("w"!==a&&"a"!==a)return null;l=3}if(1===n.length){if(t.endsWith("f"))return this.buffer.byteLength<i+4*l+4?null:new ra(new Float32Array(this.buffer,i+4*l,1),e.getTypeInfo("f32"),this);if(t.endsWith("h"))return new ra(new Float32Array(this.buffer,i+4*l,1),e.getTypeInfo("f16"),this);if(t.endsWith("i"))return new ra(new Int32Array(this.buffer,i+4*l,1),e.getTypeInfo("i32"),this);if(t.endsWith("b"))return new ra(new Int32Array(this.buffer,i+4*l,1),e.getTypeInfo("bool"),this);if(t.endsWith("u"))return new ra(new Uint32Array(this.buffer,i+4*l,1),e.getTypeInfo("i32"),this)}if("vec2f"===t)s.push(new Float32Array(this.buffer,i,2)[l]);else if("vec3f"===t){if(i+12>=this.buffer.byteLength)return null;const e=new Float32Array(this.buffer,i,3);s.push(e[l])}else if("vec4f"===t)s.push(new Float32Array(this.buffer,i,4)[l]);else if("vec2i"===t)r="i",s.push(new Int32Array(this.buffer,i,2)[l]);else if("vec3i"===t)r="i",s.push(new Int32Array(this.buffer,i,3)[l]);else if("vec4i"===t)r="i",s.push(new Int32Array(this.buffer,i,4)[l]);else if("vec2u"===t){r="u";const e=new Uint32Array(this.buffer,i,2);s.push(e[l])}else"vec3u"===t?(r="u",s.push(new Uint32Array(this.buffer,i,3)[l])):"vec4u"===t&&(r="u",s.push(new Uint32Array(this.buffer,i,4)[l]))}return 2===s.length?o=e.getTypeInfo(`vec2${r}`):3===s.length?o=e.getTypeInfo(`vec3${r}`):4===s.length&&(o=e.getTypeInfo(`vec4${r}`)),new ia(s,o,null)}return null}return null}}}t=t.postfix}const a=o.getTypeName();return"f32"===a?new ra(new Float32Array(this.buffer,i,1),o,this):"i32"===a?new ra(new Int32Array(this.buffer,i,1),o,this):"u32"===a?new ra(new Uint32Array(this.buffer,i,1),o,this):"vec2f"===a?new ia(new Float32Array(this.buffer,i,2),o,this):"vec3f"===a?new ia(new Float32Array(this.buffer,i,3),o,this):"vec4f"===a?new ia(new Float32Array(this.buffer,i,4),o,this):"vec2i"===a?new ia(new Int32Array(this.buffer,i,2),o,this):"vec3i"===a?new ia(new Int32Array(this.buffer,i,3),o,this):"vec4i"===a?new ia(new Int32Array(this.buffer,i,4),o,this):"vec2u"===a?new ia(new Uint32Array(this.buffer,i,2),o,this):"vec3u"===a?new ia(new Uint32Array(this.buffer,i,3),o,this):"vec4u"===a?new ia(new Uint32Array(this.buffer,i,4),o,this):o instanceof Ai&&"atomic"===o.name?"u32"===(null===(r=o.format)||void 0===r?void 0:r.name)?new ra(new Uint32Array(this.buffer,i,1)[0],o.format,this):"i32"===(null===(s=o.format)||void 0===s?void 0:s.name)?new ra(new Int32Array(this.buffer,i,1)[0],o.format,this):null:new aa(this.buffer,o,i,this)}toString(){let e="";if(this.typeInfo instanceof Ti)if("f32"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("i32"===this.typeInfo.format.name){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("u32"===this.typeInfo.format.name){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("vec2f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let n=1;n<t.length/2;++n)e+=`, [${t[2*n]}, ${t[2*n+1]}]`}else if("vec3f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}]`}else if("vec4f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}, ${t[n+3]}]`}else e="[...]";else this.typeInfo instanceof Ei?e+="{...}":e="[...]";return e}}class la extends ea{constructor(e,t,n,r){super(t,null),this.data=e,this.descriptor=n,this.view=r}clone(){return new la(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>0?null!==(e=n[0])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.width)&&void 0!==t?t:0}get height(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>1?null!==(e=n[1])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.height)&&void 0!==t?t:0}get depthOrArrayLayers(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>2?null!==(e=n[2])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.depthOrArrayLayers)&&void 0!==t?t:0}get format(){var e;return this.descriptor&&null!==(e=this.descriptor.format)&&void 0!==e?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&null!==(e=this.descriptor.sampleCount)&&void 0!==e?e:1}get mipLevelCount(){var e;return this.descriptor&&null!==(e=this.descriptor.mipLevelCount)&&void 0!==e?e:1}get dimension(){var e;return this.descriptor&&null!==(e=this.descriptor.dimension)&&void 0!==e?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<t.length;++n)t[n]=Math.max(1,t[n]>>e);return t}get texelByteSize(){const e=this.format,t=Xi[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=Xi[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=Xi[e],n=this.width;if(!e||n<=0||!t)return-1;const r=this.height,s=this.depthOrArrayLayers,i=this.dimension;return n/t.blockWidth*("1d"===i?1:r/t.blockHeight)*t.bytesPerBlock*s}getPixel(e,t,n=0,r=0){const s=this.texelByteSize,i=this.bytesPerRow,o=this.height,a=this.data[r];return function(e,t,n,r,s,i,o,a,l){const c=r*(o>>=s)*(i>>=s)+n*o+t*a;switch(l){case"r8unorm":return[Hi(e,c,"8unorm",1)[0]];case"r8snorm":return[Hi(e,c,"8snorm",1)[0]];case"r8uint":return[Hi(e,c,"8uint",1)[0]];case"r8sint":return[Hi(e,c,"8sint",1)[0]];case"rg8unorm":{const t=Hi(e,c,"8unorm",2);return[t[0],t[1]]}case"rg8snorm":{const t=Hi(e,c,"8snorm",2);return[t[0],t[1]]}case"rg8uint":{const t=Hi(e,c,"8uint",2);return[t[0],t[1]]}case"rg8sint":{const t=Hi(e,c,"8sint",2);return[t[0],t[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const t=Hi(e,c,"8unorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8snorm":{const t=Hi(e,c,"8snorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8uint":{const t=Hi(e,c,"8uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba8sint":{const t=Hi(e,c,"8sint",4);return[t[0],t[1],t[2],t[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const t=Hi(e,c,"8unorm",4);return[t[2],t[1],t[0],t[3]]}case"r16uint":return[Hi(e,c,"16uint",1)[0]];case"r16sint":return[Hi(e,c,"16sint",1)[0]];case"r16float":return[Hi(e,c,"16float",1)[0]];case"rg16uint":{const t=Hi(e,c,"16uint",2);return[t[0],t[1]]}case"rg16sint":{const t=Hi(e,c,"16sint",2);return[t[0],t[1]]}case"rg16float":{const t=Hi(e,c,"16float",2);return[t[0],t[1]]}case"rgba16uint":{const t=Hi(e,c,"16uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16sint":{const t=Hi(e,c,"16sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16float":{const t=Hi(e,c,"16float",4);return[t[0],t[1],t[2],t[3]]}case"r32uint":return[Hi(e,c,"32uint",1)[0]];case"r32sint":return[Hi(e,c,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Hi(e,c,"32float",1)[0]];case"rg32uint":{const t=Hi(e,c,"32uint",2);return[t[0],t[1]]}case"rg32sint":{const t=Hi(e,c,"32sint",2);return[t[0],t[1]]}case"rg32float":{const t=Hi(e,c,"32float",2);return[t[0],t[1]]}case"rgba32uint":{const t=Hi(e,c,"32uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32sint":{const t=Hi(e,c,"32sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32float":{const t=Hi(e,c,"32float",4);return[t[0],t[1],t[2],t[3]]}case"rg11b10ufloat":{const t=new Uint32Array(e.buffer,c,1)[0],n=(4192256&t)>>11,r=(4290772992&t)>>22;return[Wi(2047&t),Wi(n),function(e){const t=112+(e>>5&31)<<23|(31&e)<<18;return Gi[0]=t,zi[0]}(r),1]}}return null}(new Uint8Array(a),e,t,n,r,o,i,s,this.format)}setPixel(e,t,n,r,s){const i=this.texelByteSize,o=this.bytesPerRow,a=this.height,l=this.data[r];!function(e,t,n,r,s,i,o,a,l,c){const u=r*(o>>=s)*(i>>=s)+n*o+t*a;switch(l){case"r8unorm":return void $i(e,u,"8unorm",1,c);case"r8snorm":return void $i(e,u,"8snorm",1,c);case"r8uint":return void $i(e,u,"8uint",1,c);case"r8sint":return void $i(e,u,"8sint",1,c);case"rg8unorm":return void $i(e,u,"8unorm",2,c);case"rg8snorm":return void $i(e,u,"8snorm",2,c);case"rg8uint":return void $i(e,u,"8uint",2,c);case"rg8sint":return void $i(e,u,"8sint",2,c);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void $i(e,u,"8unorm",4,c);case"rgba8snorm":return void $i(e,u,"8snorm",4,c);case"rgba8uint":return void $i(e,u,"8uint",4,c);case"rgba8sint":return void $i(e,u,"8sint",4,c);case"r16uint":return void $i(e,u,"16uint",1,c);case"r16sint":return void $i(e,u,"16sint",1,c);case"r16float":return void $i(e,u,"16float",1,c);case"rg16uint":return void $i(e,u,"16uint",2,c);case"rg16sint":return void $i(e,u,"16sint",2,c);case"rg16float":return void $i(e,u,"16float",2,c);case"rgba16uint":return void $i(e,u,"16uint",4,c);case"rgba16sint":return void $i(e,u,"16sint",4,c);case"rgba16float":return void $i(e,u,"16float",4,c);case"r32uint":return void $i(e,u,"32uint",1,c);case"r32sint":return void $i(e,u,"32sint",1,c);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void $i(e,u,"32float",1,c);case"rg32uint":return void $i(e,u,"32uint",2,c);case"rg32sint":return void $i(e,u,"32sint",2,c);case"rg32float":return void $i(e,u,"32float",2,c);case"rgba32uint":return void $i(e,u,"32uint",4,c);case"rgba32sint":return void $i(e,u,"32sint",4,c);case"rgba32float":$i(e,u,"32float",4,c)}}(new Uint8Array(l),e,t,n,r,a,o,i,this.format,s)}}(e=>{e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"})(ho||(ho={}));class ca{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}}class ua{}uo=ua,ua.none=new ca("",ho.reserved,""),ua.eof=new ca("EOF",ho.token,""),ua.reserved={asm:new ca("asm",ho.reserved,"asm"),bf16:new ca("bf16",ho.reserved,"bf16"),do:new ca("do",ho.reserved,"do"),enum:new ca("enum",ho.reserved,"enum"),f16:new ca("f16",ho.reserved,"f16"),f64:new ca("f64",ho.reserved,"f64"),handle:new ca("handle",ho.reserved,"handle"),i8:new ca("i8",ho.reserved,"i8"),i16:new ca("i16",ho.reserved,"i16"),i64:new ca("i64",ho.reserved,"i64"),mat:new ca("mat",ho.reserved,"mat"),premerge:new ca("premerge",ho.reserved,"premerge"),regardless:new ca("regardless",ho.reserved,"regardless"),typedef:new ca("typedef",ho.reserved,"typedef"),u8:new ca("u8",ho.reserved,"u8"),u16:new ca("u16",ho.reserved,"u16"),u64:new ca("u64",ho.reserved,"u64"),unless:new ca("unless",ho.reserved,"unless"),using:new ca("using",ho.reserved,"using"),vec:new ca("vec",ho.reserved,"vec"),void:new ca("void",ho.reserved,"void")},ua.keywords={array:new ca("array",ho.keyword,"array"),atomic:new ca("atomic",ho.keyword,"atomic"),bool:new ca("bool",ho.keyword,"bool"),f32:new ca("f32",ho.keyword,"f32"),i32:new ca("i32",ho.keyword,"i32"),mat2x2:new ca("mat2x2",ho.keyword,"mat2x2"),mat2x3:new ca("mat2x3",ho.keyword,"mat2x3"),mat2x4:new ca("mat2x4",ho.keyword,"mat2x4"),mat3x2:new ca("mat3x2",ho.keyword,"mat3x2"),mat3x3:new ca("mat3x3",ho.keyword,"mat3x3"),mat3x4:new ca("mat3x4",ho.keyword,"mat3x4"),mat4x2:new ca("mat4x2",ho.keyword,"mat4x2"),mat4x3:new ca("mat4x3",ho.keyword,"mat4x3"),mat4x4:new ca("mat4x4",ho.keyword,"mat4x4"),ptr:new ca("ptr",ho.keyword,"ptr"),sampler:new ca("sampler",ho.keyword,"sampler"),sampler_comparison:new ca("sampler_comparison",ho.keyword,"sampler_comparison"),struct:new ca("struct",ho.keyword,"struct"),texture_1d:new ca("texture_1d",ho.keyword,"texture_1d"),texture_2d:new ca("texture_2d",ho.keyword,"texture_2d"),texture_2d_array:new ca("texture_2d_array",ho.keyword,"texture_2d_array"),texture_3d:new ca("texture_3d",ho.keyword,"texture_3d"),texture_cube:new ca("texture_cube",ho.keyword,"texture_cube"),texture_cube_array:new ca("texture_cube_array",ho.keyword,"texture_cube_array"),texture_multisampled_2d:new ca("texture_multisampled_2d",ho.keyword,"texture_multisampled_2d"),texture_storage_1d:new ca("texture_storage_1d",ho.keyword,"texture_storage_1d"),texture_storage_2d:new ca("texture_storage_2d",ho.keyword,"texture_storage_2d"),texture_storage_2d_array:new ca("texture_storage_2d_array",ho.keyword,"texture_storage_2d_array"),texture_storage_3d:new ca("texture_storage_3d",ho.keyword,"texture_storage_3d"),texture_depth_2d:new ca("texture_depth_2d",ho.keyword,"texture_depth_2d"),texture_depth_2d_array:new ca("texture_depth_2d_array",ho.keyword,"texture_depth_2d_array"),texture_depth_cube:new ca("texture_depth_cube",ho.keyword,"texture_depth_cube"),texture_depth_cube_array:new ca("texture_depth_cube_array",ho.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new ca("texture_depth_multisampled_2d",ho.keyword,"texture_depth_multisampled_2d"),texture_external:new ca("texture_external",ho.keyword,"texture_external"),u32:new ca("u32",ho.keyword,"u32"),vec2:new ca("vec2",ho.keyword,"vec2"),vec3:new ca("vec3",ho.keyword,"vec3"),vec4:new ca("vec4",ho.keyword,"vec4"),bitcast:new ca("bitcast",ho.keyword,"bitcast"),block:new ca("block",ho.keyword,"block"),break:new ca("break",ho.keyword,"break"),case:new ca("case",ho.keyword,"case"),continue:new ca("continue",ho.keyword,"continue"),continuing:new ca("continuing",ho.keyword,"continuing"),default:new ca("default",ho.keyword,"default"),diagnostic:new ca("diagnostic",ho.keyword,"diagnostic"),discard:new ca("discard",ho.keyword,"discard"),else:new ca("else",ho.keyword,"else"),enable:new ca("enable",ho.keyword,"enable"),fallthrough:new ca("fallthrough",ho.keyword,"fallthrough"),false:new ca("false",ho.keyword,"false"),fn:new ca("fn",ho.keyword,"fn"),for:new ca("for",ho.keyword,"for"),function:new ca("function",ho.keyword,"function"),if:new ca("if",ho.keyword,"if"),let:new ca("let",ho.keyword,"let"),const:new ca("const",ho.keyword,"const"),loop:new ca("loop",ho.keyword,"loop"),while:new ca("while",ho.keyword,"while"),private:new ca("private",ho.keyword,"private"),read:new ca("read",ho.keyword,"read"),read_write:new ca("read_write",ho.keyword,"read_write"),return:new ca("return",ho.keyword,"return"),requires:new ca("requires",ho.keyword,"requires"),storage:new ca("storage",ho.keyword,"storage"),switch:new ca("switch",ho.keyword,"switch"),true:new ca("true",ho.keyword,"true"),alias:new ca("alias",ho.keyword,"alias"),type:new ca("type",ho.keyword,"type"),uniform:new ca("uniform",ho.keyword,"uniform"),var:new ca("var",ho.keyword,"var"),override:new ca("override",ho.keyword,"override"),workgroup:new ca("workgroup",ho.keyword,"workgroup"),write:new ca("write",ho.keyword,"write"),r8unorm:new ca("r8unorm",ho.keyword,"r8unorm"),r8snorm:new ca("r8snorm",ho.keyword,"r8snorm"),r8uint:new ca("r8uint",ho.keyword,"r8uint"),r8sint:new ca("r8sint",ho.keyword,"r8sint"),r16uint:new ca("r16uint",ho.keyword,"r16uint"),r16sint:new ca("r16sint",ho.keyword,"r16sint"),r16float:new ca("r16float",ho.keyword,"r16float"),rg8unorm:new ca("rg8unorm",ho.keyword,"rg8unorm"),rg8snorm:new ca("rg8snorm",ho.keyword,"rg8snorm"),rg8uint:new ca("rg8uint",ho.keyword,"rg8uint"),rg8sint:new ca("rg8sint",ho.keyword,"rg8sint"),r32uint:new ca("r32uint",ho.keyword,"r32uint"),r32sint:new ca("r32sint",ho.keyword,"r32sint"),r32float:new ca("r32float",ho.keyword,"r32float"),rg16uint:new ca("rg16uint",ho.keyword,"rg16uint"),rg16sint:new ca("rg16sint",ho.keyword,"rg16sint"),rg16float:new ca("rg16float",ho.keyword,"rg16float"),rgba8unorm:new ca("rgba8unorm",ho.keyword,"rgba8unorm"),rgba8unorm_srgb:new ca("rgba8unorm_srgb",ho.keyword,"rgba8unorm_srgb"),rgba8snorm:new ca("rgba8snorm",ho.keyword,"rgba8snorm"),rgba8uint:new ca("rgba8uint",ho.keyword,"rgba8uint"),rgba8sint:new ca("rgba8sint",ho.keyword,"rgba8sint"),bgra8unorm:new ca("bgra8unorm",ho.keyword,"bgra8unorm"),bgra8unorm_srgb:new ca("bgra8unorm_srgb",ho.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new ca("rgb10a2unorm",ho.keyword,"rgb10a2unorm"),rg11b10float:new ca("rg11b10float",ho.keyword,"rg11b10float"),rg32uint:new ca("rg32uint",ho.keyword,"rg32uint"),rg32sint:new ca("rg32sint",ho.keyword,"rg32sint"),rg32float:new ca("rg32float",ho.keyword,"rg32float"),rgba16uint:new ca("rgba16uint",ho.keyword,"rgba16uint"),rgba16sint:new ca("rgba16sint",ho.keyword,"rgba16sint"),rgba16float:new ca("rgba16float",ho.keyword,"rgba16float"),rgba32uint:new ca("rgba32uint",ho.keyword,"rgba32uint"),rgba32sint:new ca("rgba32sint",ho.keyword,"rgba32sint"),rgba32float:new ca("rgba32float",ho.keyword,"rgba32float"),static_assert:new ca("static_assert",ho.keyword,"static_assert")},ua.tokens={decimal_float_literal:new ca("decimal_float_literal",ho.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new ca("hex_float_literal",ho.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new ca("int_literal",ho.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new ca("uint_literal",ho.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new ca("name",ho.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new ca("ident",ho.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new ca("and",ho.token,"&"),and_and:new ca("and_and",ho.token,"&&"),arrow:new ca("arrow ",ho.token,"->"),attr:new ca("attr",ho.token,"@"),forward_slash:new ca("forward_slash",ho.token,"/"),bang:new ca("bang",ho.token,"!"),bracket_left:new ca("bracket_left",ho.token,"["),bracket_right:new ca("bracket_right",ho.token,"]"),brace_left:new ca("brace_left",ho.token,"{"),brace_right:new ca("brace_right",ho.token,"}"),colon:new ca("colon",ho.token,":"),comma:new ca("comma",ho.token,","),equal:new ca("equal",ho.token,"="),equal_equal:new ca("equal_equal",ho.token,"=="),not_equal:new ca("not_equal",ho.token,"!="),greater_than:new ca("greater_than",ho.token,">"),greater_than_equal:new ca("greater_than_equal",ho.token,">="),shift_right:new ca("shift_right",ho.token,">>"),less_than:new ca("less_than",ho.token,"<"),less_than_equal:new ca("less_than_equal",ho.token,"<="),shift_left:new ca("shift_left",ho.token,"<<"),modulo:new ca("modulo",ho.token,"%"),minus:new ca("minus",ho.token,"-"),minus_minus:new ca("minus_minus",ho.token,"--"),period:new ca("period",ho.token,"."),plus:new ca("plus",ho.token,"+"),plus_plus:new ca("plus_plus",ho.token,"++"),or:new ca("or",ho.token,"|"),or_or:new ca("or_or",ho.token,"||"),paren_left:new ca("paren_left",ho.token,"("),paren_right:new ca("paren_right",ho.token,")"),semicolon:new ca("semicolon",ho.token,";"),star:new ca("star",ho.token,"*"),tilde:new ca("tilde",ho.token,"~"),underscore:new ca("underscore",ho.token,"_"),xor:new ca("xor",ho.token,"^"),plus_equal:new ca("plus_equal",ho.token,"+="),minus_equal:new ca("minus_equal",ho.token,"-="),times_equal:new ca("times_equal",ho.token,"*="),division_equal:new ca("division_equal",ho.token,"/="),modulo_equal:new ca("modulo_equal",ho.token,"%="),and_equal:new ca("and_equal",ho.token,"&="),or_equal:new ca("or_equal",ho.token,"|="),xor_equal:new ca("xor_equal",ho.token,"^="),shift_right_equal:new ca("shift_right_equal",ho.token,">>="),shift_left_equal:new ca("shift_left_equal",ho.token,"<<=")},ua.simpleTokens={"@":uo.tokens.attr,"{":uo.tokens.brace_left,"}":uo.tokens.brace_right,":":uo.tokens.colon,",":uo.tokens.comma,"(":uo.tokens.paren_left,")":uo.tokens.paren_right,";":uo.tokens.semicolon},ua.literalTokens={"&":uo.tokens.and,"&&":uo.tokens.and_and,"->":uo.tokens.arrow,"/":uo.tokens.forward_slash,"!":uo.tokens.bang,"[":uo.tokens.bracket_left,"]":uo.tokens.bracket_right,"=":uo.tokens.equal,"==":uo.tokens.equal_equal,"!=":uo.tokens.not_equal,">":uo.tokens.greater_than,">=":uo.tokens.greater_than_equal,">>":uo.tokens.shift_right,"<":uo.tokens.less_than,"<=":uo.tokens.less_than_equal,"<<":uo.tokens.shift_left,"%":uo.tokens.modulo,"-":uo.tokens.minus,"--":uo.tokens.minus_minus,".":uo.tokens.period,"+":uo.tokens.plus,"++":uo.tokens.plus_plus,"|":uo.tokens.or,"||":uo.tokens.or_or,"*":uo.tokens.star,"~":uo.tokens.tilde,_:uo.tokens.underscore,"^":uo.tokens.xor,"+=":uo.tokens.plus_equal,"-=":uo.tokens.minus_equal,"*=":uo.tokens.times_equal,"/=":uo.tokens.division_equal,"%=":uo.tokens.modulo_equal,"&=":uo.tokens.and_equal,"|=":uo.tokens.or_equal,"^=":uo.tokens.xor_equal,">>=":uo.tokens.shift_right_equal,"<<=":uo.tokens.shift_left_equal},ua.regexTokens={decimal_float_literal:uo.tokens.decimal_float_literal,hex_float_literal:uo.tokens.hex_float_literal,int_literal:uo.tokens.int_literal,uint_literal:uo.tokens.uint_literal,ident:uo.tokens.ident},ua.storage_class=[uo.keywords.function,uo.keywords.private,uo.keywords.workgroup,uo.keywords.uniform,uo.keywords.storage],ua.access_mode=[uo.keywords.read,uo.keywords.write,uo.keywords.read_write],ua.sampler_type=[uo.keywords.sampler,uo.keywords.sampler_comparison],ua.sampled_texture_type=[uo.keywords.texture_1d,uo.keywords.texture_2d,uo.keywords.texture_2d_array,uo.keywords.texture_3d,uo.keywords.texture_cube,uo.keywords.texture_cube_array],ua.multisampled_texture_type=[uo.keywords.texture_multisampled_2d],ua.storage_texture_type=[uo.keywords.texture_storage_1d,uo.keywords.texture_storage_2d,uo.keywords.texture_storage_2d_array,uo.keywords.texture_storage_3d],ua.depth_texture_type=[uo.keywords.texture_depth_2d,uo.keywords.texture_depth_2d_array,uo.keywords.texture_depth_cube,uo.keywords.texture_depth_cube_array,uo.keywords.texture_depth_multisampled_2d],ua.texture_external_type=[uo.keywords.texture_external],ua.any_texture_type=[...uo.sampled_texture_type,...uo.multisampled_texture_type,...uo.storage_texture_type,...uo.depth_texture_type,...uo.texture_external_type],ua.texel_format=[uo.keywords.r8unorm,uo.keywords.r8snorm,uo.keywords.r8uint,uo.keywords.r8sint,uo.keywords.r16uint,uo.keywords.r16sint,uo.keywords.r16float,uo.keywords.rg8unorm,uo.keywords.rg8snorm,uo.keywords.rg8uint,uo.keywords.rg8sint,uo.keywords.r32uint,uo.keywords.r32sint,uo.keywords.r32float,uo.keywords.rg16uint,uo.keywords.rg16sint,uo.keywords.rg16float,uo.keywords.rgba8unorm,uo.keywords.rgba8unorm_srgb,uo.keywords.rgba8snorm,uo.keywords.rgba8uint,uo.keywords.rgba8sint,uo.keywords.bgra8unorm,uo.keywords.bgra8unorm_srgb,uo.keywords.rgb10a2unorm,uo.keywords.rg11b10float,uo.keywords.rg32uint,uo.keywords.rg32sint,uo.keywords.rg32float,uo.keywords.rgba16uint,uo.keywords.rgba16sint,uo.keywords.rgba16float,uo.keywords.rgba32uint,uo.keywords.rgba32sint,uo.keywords.rgba32float],ua.const_literal=[uo.tokens.int_literal,uo.tokens.uint_literal,uo.tokens.decimal_float_literal,uo.tokens.hex_float_literal,uo.keywords.true,uo.keywords.false],ua.literal_or_ident=[uo.tokens.ident,uo.tokens.int_literal,uo.tokens.uint_literal,uo.tokens.decimal_float_literal,uo.tokens.hex_float_literal,uo.tokens.name],ua.element_count_expression=[uo.tokens.int_literal,uo.tokens.uint_literal,uo.tokens.ident],ua.template_types=[uo.keywords.vec2,uo.keywords.vec3,uo.keywords.vec4,uo.keywords.mat2x2,uo.keywords.mat2x3,uo.keywords.mat2x4,uo.keywords.mat3x2,uo.keywords.mat3x3,uo.keywords.mat3x4,uo.keywords.mat4x2,uo.keywords.mat4x3,uo.keywords.mat4x4,uo.keywords.atomic,uo.keywords.bitcast,...uo.any_texture_type],ua.attribute_name=[uo.tokens.ident,uo.keywords.block,uo.keywords.diagnostic],ua.assignment_operators=[uo.tokens.equal,uo.tokens.plus_equal,uo.tokens.minus_equal,uo.tokens.times_equal,uo.tokens.division_equal,uo.tokens.modulo_equal,uo.tokens.and_equal,uo.tokens.or_equal,uo.tokens.xor_equal,uo.tokens.shift_right_equal,uo.tokens.shift_left_equal],ua.increment_operators=[uo.tokens.plus_plus,uo.tokens.minus_minus];class ha{constructor(e,t,n,r,s){this.type=e,this.lexeme=t,this.line=n,this.start=r,this.end=s}toString(){return this.lexeme}isTemplateType(){return-1!=ua.template_types.indexOf(this.type)}isArrayType(){return this.type==ua.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class da{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=null!=e?e:""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new ha(ua.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if("\n"==e)return this._line++,!0;if(this._isWhitespace(e))return!0;if("/"==e){if("/"==this._peekAhead()){for(;"\n"!=e;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if("*"==this._peekAhead()){this._advance();let t=1;for(;t>0;){if(this._isAtEnd())return!0;if(e=this._advance(),"\n"==e)this._line++;else if("*"==e){if("/"==this._peekAhead()&&(this._advance(),t--,0==t))return!0}else"/"==e&&"*"==this._peekAhead()&&(this._advance(),t++)}return!0}}const t=ua.simpleTokens[e];if(t)return this._addToken(t),!0;let n=ua.none;const r=this._isAlpha(e),s="_"===e;if(this._isAlphaNumeric(e)){let t=this._peekAhead();for(;this._isAlphaNumeric(t);)e+=this._advance(),t=this._peekAhead()}if(r){const t=ua.keywords[e];if(t)return this._addToken(t),!0}if(r||s)return this._addToken(ua.tokens.ident),!0;for(;;){let t=this._findType(e);const r=this._peekAhead();if("-"==e&&this._tokens.length>0){if("="==r)return this._current++,e+=r,this._addToken(ua.tokens.minus_equal),!0;if("-"==r)return this._current++,e+=r,this._addToken(ua.tokens.minus_minus),!0;const n=this._tokens.length-1;if((-1!=ua.literal_or_ident.indexOf(this._tokens[n].type)||this._tokens[n].type==ua.tokens.paren_right)&&">"!=r)return this._addToken(t),!0}if(">"==e&&(">"==r||"="==r)){let e=!1,n=this._tokens.length-1;for(let t=0;t<5&&n>=0&&-1===ua.assignment_operators.indexOf(this._tokens[n].type);++t,--n)if(this._tokens[n].type===ua.tokens.less_than){n>0&&this._tokens[n-1].isArrayOrTemplateType()&&(e=!0);break}if(e)return this._addToken(t),!0}if(t===ua.none){let r=e,s=0;const i=2;for(let e=0;e<i;++e)if(r+=this._peekAhead(e),t=this._findType(r),t!==ua.none){s=e;break}if(t===ua.none)return n!==ua.none&&(this._current--,this._addToken(n),!0);e=r,this._current+=s+1}if(n=t,this._isAtEnd())break;e+=this._advance()}return n!==ua.none&&(this._addToken(n),!0)}_findType(e){for(const t in ua.regexTokens){const n=ua.regexTokens[t];if(this._match(e,n.rule))return n}return ua.literalTokens[e]||ua.none}_match(e,t){const n=t.exec(e);return n&&0==n.index&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&"_"!==e&&"."!==e&&"("!==e&&")"!==e&&"["!==e&&"]"!==e&&"{"!==e&&"}"!==e&&","!==e&&";"!==e&&":"!==e&&"="!==e&&"!"!==e&&"<"!==e&&">"!==e&&"+"!==e&&"-"!==e&&"*"!==e&&"/"!==e&&"%"!==e&&"&"!==e&&"|"!==e&&"^"!==e&&"~"!==e&&"@"!==e&&"#"!==e&&"?"!==e&&"'"!==e&&"`"!==e&&'"'!==e&&"\\"!==e&&"\n"!==e&&"\r"!==e&&"\t"!==e&&"\0"!==e}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||"_"===e}_isWhitespace(e){return" "==e||"\t"==e||"\r"==e}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new ha(e,t,this._line,this._start,this._current))}}function fa(e){return Array.isArray(e)||(null==e?void 0:e.buffer)instanceof ArrayBuffer}const pa=new Float32Array(1),ga=new Uint32Array(pa.buffer),ma=new Uint32Array(pa.buffer),_a=new Int32Array(1),ya=new Float32Array(_a.buffer),ba=new Uint32Array(_a.buffer),va=new Uint32Array(1),xa=new Float32Array(va.buffer),wa=new Int32Array(va.buffer);function Ea(e,t,n){if(t===n)return e;if("f32"===t){if("i32"===n||"x32"===n)return pa[0]=e,ga[0];if("u32"===n)return pa[0]=e,ma[0]}else if("i32"===t||"x32"===t){if("f32"===n)return _a[0]=e,ya[0];if("u32"===n)return _a[0]=e,ba[0]}else if("u32"===t){if("f32"===n)return va[0]=e,xa[0];if("i32"===n||"x32"===n)return va[0]=e,wa[0]}return e}class Ta{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Sa{constructor(e,t){this.align=e,this.size=t}}class Aa{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new Fi,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return"texture_storage_1d"==e.name||"texture_storage_2d"==e.name||"texture_storage_2d_array"==e.name||"texture_storage_3d"==e.name}updateAST(e){for(const t of e)t instanceof Ji&&this._functions.set(t.name,new Ta(t));for(const t of e)if(t instanceof ko){const e=this.getTypeInfo(t,null);e instanceof Ei&&this.structs.push(e)}for(const t of e)if(t instanceof Eo)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof io){const e=t,n=this._getAttributeNum(e.attributes,"id",0),r=null!=e.type?this.getTypeInfo(e.type,e.attributes):null;this.overrides.push(new Ni(e.name,r,e.attributes,n));continue}if(this._isUniformVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),r=this._getAttributeNum(e.attributes,"binding",0),s=this.getTypeInfo(e.type,e.attributes),i=new ki(e.name,s,n,r,e.attributes,Ri.Uniform,e.access);i.access||(i.access="read"),this.uniforms.push(i);continue}if(this._isStorageVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),r=this._getAttributeNum(e.attributes,"binding",0),s=this.getTypeInfo(e.type,e.attributes),i=this._isStorageTexture(s),o=new ki(e.name,s,n,r,e.attributes,i?Ri.StorageTexture:Ri.Storage,e.access);o.access||(o.access="read"),this.storage.push(o);continue}if(this._isTextureVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),r=this._getAttributeNum(e.attributes,"binding",0),s=this.getTypeInfo(e.type,e.attributes),i=this._isStorageTexture(s),o=new ki(e.name,s,n,r,e.attributes,i?Ri.StorageTexture:Ri.Texture,e.access);o.access||(o.access="read"),i?this.storage.push(o):this.textures.push(o);continue}if(this._isSamplerVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),r=this._getAttributeNum(e.attributes,"binding",0),s=this.getTypeInfo(e.type,e.attributes),i=new ki(e.name,s,n,r,e.attributes,Ri.Sampler,e.access);this.samplers.push(i);continue}}for(const t of e)if(t instanceof Ji){const e=this._getAttribute(t,"vertex"),n=this._getAttribute(t,"fragment"),r=this._getAttribute(t,"compute"),s=e||n||r,i=new Oi(t.name,null==s?void 0:s.name,t.attributes);i.attributes=t.attributes,i.startLine=t.startLine,i.endLine=t.endLine,this.functions.push(i),this._functions.get(t.name).info=i,s&&(this._functions.get(t.name).inUse=!0,i.inUse=!0,i.resources=this._findResources(t,!!s),i.inputs=this._getInputs(t.args),i.outputs=this._getOutputs(t.returnType),this.entry[s.name].push(i)),i.arguments=t.args.map(e=>new Li(e.name,this.getTypeInfo(e.type,e.attributes),e.attributes)),i.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(e=>{var n,r,s;if(e instanceof Jo){if(e.value)if(fa(e.value))for(const i of e.value)for(const e of this.overrides)i===e.name&&(null===(n=t.info)||void 0===n||n.overrides.push(e));else for(const i of this.overrides)e.value===i.name&&(null===(r=t.info)||void 0===r||r.overrides.push(i))}else if(e instanceof Bo)for(const i of this.overrides)e.name===i.name&&(null===(s=t.info)||void 0===s||s.overrides.push(i))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getFunctionInfo(e){for(const t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var n;for(const r of e.calls){const e=null===(n=this._functions.get(r.name))||void 0===n?void 0:n.info;e&&t.add(e)}}findResource(e,t,n){if(n){for(const r of this.entry.compute)if(r.name===n)for(const n of r.resources)if(n.group==e&&n.binding==t)return n;for(const r of this.entry.vertex)if(r.name===n)for(const n of r.resources)if(n.group==e&&n.binding==t)return n;for(const r of this.entry.fragment)if(r.name===n)for(const n of r.resources)if(n.group==e&&n.binding==t)return n}for(const r of this.uniforms)if(r.group==e&&r.binding==t)return r;for(const r of this.storage)if(r.group==e&&r.binding==t)return r;for(const r of this.textures)if(r.group==e&&r.binding==t)return r;for(const r of this.samplers)if(r.group==e&&r.binding==t)return r;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const n=[],r=this,s=[];return e.search(i=>{if(i instanceof Yi)s.push({});else if(i instanceof Ki)s.pop();else if(i instanceof so){const e=i;t&&null!==e.type&&this._markStructsFromAST(e.type),s.length>0&&(s[s.length-1][e.name]=e)}else if(i instanceof Fo){const e=i;t&&null!==e.type&&this._markStructsFromAST(e.type)}else if(i instanceof oo){const e=i;t&&null!==e.type&&this._markStructsFromAST(e.type),s.length>0&&(s[s.length-1][e.name]=e)}else if(i instanceof Bo){const e=i;if(s.length>0&&s[s.length-1][e.name])return;const t=r._findResource(e.name);t&&n.push(t)}else if(i instanceof Do){const s=i,o=r._functions.get(s.name);o&&(t&&(o.inUse=!0),e.calls.add(o.node),null===o.resources&&(o.resources=r._findResources(o.node,t)),n.push(...o.resources))}else if(i instanceof go){const s=i,o=r._functions.get(s.name);o&&(t&&(o.inUse=!0),e.calls.add(o.node),null===o.resources&&(o.resources=r._findResources(o.node,t)),n.push(...o.resources))}}),[...new Map(n.map(e=>[e.name,e])).values()]}getBindGroups(){const e=[];function t(t,n){t>=e.length&&(e.length=t+1),void 0===e[t]&&(e[t]=[]),n>=e[t].length&&(e[t].length=n+1)}for(const n of this.uniforms)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)t(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e,t=void 0){if(void 0===t&&(t=[]),e instanceof ko)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);null!==n&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof ko)this._getStructOutputs(n.type,t);else{const e=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(null!==e){const r=this.getTypeInfo(n.type,n.type.attributes),s=this._parseInt(e.value),i=new Mi(n.name,r,e.name,s);t.push(i)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this.getTypeInfo(e,e.attributes),r=this._parseInt(t.value);return new Mi("",n,t.name,r)}return null}_getInputs(e,t=void 0){void 0===t&&(t=[]);for(const n of e)if(n.type instanceof ko)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof ko)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this._getAttribute(e,"interpolation"),r=this.getTypeInfo(e.type,e.attributes),s=this._parseInt(t.value),i=new Pi(e.name,r,t.name,s);return null!==n&&(i.interpolation=this._parseString(n.value)),i}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new Ii(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof Po){const n=e.type?this.getTypeInfo(e.type,e.attributes):null,r=new Si(e.name,n,t);return this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof Mo){const n=e,r=n.format?this.getTypeInfo(n.format,n.attributes):null,s=new Ti(n.name,t);return s.format=r,s.count=n.count,this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof ko){const n=e,r=new Ei(n.name,t);r.startLine=n.startLine,r.endLine=n.endLine;for(const e of n.members){const t=this.getTypeInfo(e.type,e.attributes);r.members.push(new wi(e.name,t,e.attributes))}return this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof No){const n=e,r=n.format instanceof Ro,s=n.format?r?this.getTypeInfo(n.format,null):new xi(n.format,null):null,i=new Ai(n.name,s,t,n.access);return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof Io){const n=e,r=n.format?this.getTypeInfo(n.format,null):null,s=new Ai(n.name,r,t,n.access);return this._types.set(e,s),this._updateTypeInfo(s),s}const n=new xi(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n,r;const s=this._getTypeSize(e);if(e.size=null!==(t=null==s?void 0:s.size)&&void 0!==t?t:0,e instanceof Ti&&e.format){const t=this._getTypeSize(e.format);e.stride=Math.max(null!==(n=null==t?void 0:t.size)&&void 0!==n?n:0,null!==(r=null==t?void 0:t.align)&&void 0!==r?r:0),this._updateTypeInfo(e.format)}e instanceof Si&&this._updateTypeInfo(e.format),e instanceof Ei&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,r=0,s=0,i=0;for(let o=0,a=e.members.length;o<a;++o){const a=e.members[o],l=this._getTypeSize(a);if(!l)continue;null!==(t=this._getAlias(a.type.name))&&void 0!==t||a.type;const c=l.align,u=l.size;n=this._roundUp(c,n+r),r=u,s=n,i=Math.max(i,c),a.offset=n,a.size=u,this._updateTypeInfo(a.type)}e.size=this._roundUp(i,s+r),e.align=i}_getTypeSize(e){var t,n;if(null==e)return null;const r=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof wi&&(e=e.type),e instanceof xi){const t=this._getAlias(e.name);null!==t&&(e=t)}{const n=Aa._typeInfo[e.name];if(void 0!==n){const i="f16"===(null===(t=e.format)||void 0===t?void 0:t.name)?2:1;return new Sa(Math.max(s,n.align/i),Math.max(r,n.size/i))}}{const t=Aa._typeInfo[e.name.substring(0,e.name.length-1)];if(t){const n="h"===e.name[e.name.length-1]?2:1;return new Sa(Math.max(s,t.align/n),Math.max(r,t.size/n))}}if(e instanceof Ti){let t=e,i=8,o=8;const a=this._getTypeSize(t.format);return null!==a&&(o=a.size,i=a.align),o=t.count*this._getAttributeNum(null!==(n=null==e?void 0:e.attributes)&&void 0!==n?n:null,"stride",this._roundUp(i,o)),r&&(o=r),new Sa(Math.max(s,i),Math.max(r,o))}if(e instanceof Ei){let t=0,n=0,i=0,o=0,a=0;for(const r of e.members){const e=this._getTypeSize(r.type);null!==e&&(t=Math.max(e.align,t),i=this._roundUp(e.align,i+o),o=e.size,a=i)}return n=this._roundUp(t,a+o),new Sa(Math.max(s,t),Math.max(r,n))}return null}_isUniformVar(e){return e instanceof so&&"uniform"==e.storage}_isStorageVar(e){return e instanceof so&&"storage"==e.storage}_isTextureVar(e){return e instanceof so&&null!==e.type&&-1!=Aa._textureTypes.indexOf(e.type.name)}_isSamplerVar(e){return e instanceof so&&null!==e.type&&-1!=Aa._samplerTypes.indexOf(e.type.name)}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const r=n.attributes;for(let s of r)if(s.name==t)return s;return null}_getAttributeNum(e,t,n){if(null===e)return n;for(let r of e)if(r.name==t){let e=null!==r&&null!==r.value?r.value:n;return e instanceof Array&&(e=e[0]),"number"==typeof e?e:"string"==typeof e?parseInt(e):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}}Aa._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Aa._textureTypes=ua.any_texture_type.map(e=>e.name),Aa._samplerTypes=ua.sampler_type.map(e=>e.name);let Ra=0;class Ca{constructor(e,t,n){this.id=Ra++,this.name=e,this.value=t,this.node=n}clone(){return new Ca(this.name,this.value,this.node)}}class ka{constructor(e){this.id=Ra++,this.name=e.name,this.node=e}clone(){return new ka(this.node)}}class Ia{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=Ra++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?null!==(t=this.variables.get(e))&&void 0!==t?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?null!==(t=this.functions.get(e))&&void 0!==t?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,n){this.variables.set(e,new Ca(e,t,null!=n?n:null))}setVariable(e,t,n){const r=this.getVariable(e);null!==r?r.value=t:this.createVariable(e,t,n)}getVariableValue(e){var t;const n=this.getVariable(e);return null!==(t=null==n?void 0:n.value)&&void 0!==t?t:null}clone(){return new Ia(this)}}class Pa{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class Ma{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const n=this.exec.evalExpression(e.args[0],t);let r=!0;if(n instanceof ia)return n.data.forEach(e=>{e||(r=!1)}),new ra(r?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia){const e=n.data.some(e=>e);return new ra(e?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const n=this.exec.evalExpression(e.args[2],t);if(!(n instanceof ra))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return n.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let n=e.args[0];n instanceof Wo&&(n=n.right);const r=this.exec.evalExpression(n,t);if(r instanceof aa&&0===r.typeInfo.size){const e=r.typeInfo,t=r.buffer.byteLength/e.stride;return new ra(t,this.getTypeInfo("u32"))}return new ra(r.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.abs(e)),n.typeInfo);const r=n;return new ra(Math.abs(r.value),r.typeInfo)}Acos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.acos(e)),n.typeInfo);const r=n;return new ra(Math.acos(r.value),n.typeInfo)}Acosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.acosh(e)),n.typeInfo);const r=n;return new ra(Math.acosh(r.value),n.typeInfo)}Asin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.asin(e)),n.typeInfo);const r=n;return new ra(Math.asin(r.value),n.typeInfo)}Asinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.asinh(e)),n.typeInfo);const r=n;return new ra(Math.asinh(r.value),n.typeInfo)}Atan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.atan(e)),n.typeInfo);const r=n;return new ra(Math.atan(r.value),n.typeInfo)}Atanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.atanh(e)),n.typeInfo);const r=n;return new ra(Math.atanh(r.value),n.typeInfo)}Atan2(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof ia&&r instanceof ia)return new ia(n.data.map((e,t)=>Math.atan2(e,r.data[t])),n.typeInfo);const s=n,i=r;return new ra(Math.atan2(s.value,i.value),n.typeInfo)}Ceil(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.ceil(e)),n.typeInfo);const r=n;return new ra(Math.ceil(r.value),n.typeInfo)}_clamp(e,t,n){return Math.min(Math.max(e,t),n)}Clamp(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof ia&&r instanceof ia&&s instanceof ia)return new ia(n.data.map((e,t)=>this._clamp(e,r.data[t],s.data[t])),n.typeInfo);const i=n,o=r,a=s;return new ra(this._clamp(i.value,o.value,a.value),n.typeInfo)}Cos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.cos(e)),n.typeInfo);const r=n;return new ra(Math.cos(r.value),n.typeInfo)}Cosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.cosh(e)),n.typeInfo);const r=n;return new ra(Math.cos(r.value),n.typeInfo)}CountLeadingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.clz32(e)),n.typeInfo);const r=n;return new ra(Math.clz32(r.value),n.typeInfo)}_countOneBits(e){let t=0;for(;0!==e;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>this._countOneBits(e)),n.typeInfo);const r=n;return new ra(this._countOneBits(r.value),n.typeInfo)}_countTrailingZeros(e){if(0===e)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>this._countTrailingZeros(e)),n.typeInfo);const r=n;return new ra(this._countTrailingZeros(r.value),n.typeInfo)}Cross(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof ia&&r instanceof ia){if(3!==n.data.length||3!==r.data.length)return null;const e=n.data,t=r.data;return new ia([e[1]*t[2]-t[1]*e[2],e[2]*t[0]-t[2]*e[0],e[0]*t[1]-t[0]*e[1]],n.typeInfo)}return null}Degrees(e,t){const n=this.exec.evalExpression(e.args[0],t),r=180/Math.PI;return n instanceof ia?new ia(n.data.map(e=>e*r),n.typeInfo):new ra(n.value*r,this.getTypeInfo("f32"))}Determinant(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof oa){const e=n.data,t=n.typeInfo.getTypeName(),r=t.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t)return new ra(e[0]*e[3]-e[1]*e[2],r);if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t)return new ra(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),r);if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t);else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t);else if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t)return new ra(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),r)}return null}Distance(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof ia&&r instanceof ia){let e=0;for(let t=0;t<n.data.length;++t)e+=(n.data[t]-r.data[t])*(n.data[t]-r.data[t]);return new ra(Math.sqrt(e),this.getTypeInfo("f32"))}const s=n,i=r;return new ra(Math.abs(s.value-i.value),n.typeInfo)}_dot(e,t){let n=0;for(let r=0;r<e.length;++r)n+=t[r]*e[r];return n}Dot(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);return n instanceof ia&&r instanceof ia?new ra(this._dot(n.data,r.data),this.getTypeInfo("f32")):null}Dot4U8Packed(e,t){return null}Dot4I8Packed(e,t){return null}Exp(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.exp(e)),n.typeInfo);const r=n;return new ra(Math.exp(r.value),n.typeInfo)}Exp2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.pow(2,e)),n.typeInfo);const r=n;return new ra(Math.pow(2,r.value),n.typeInfo)}ExtractBits(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if("u32"!==r.typeInfo.name&&"x32"!==r.typeInfo.name)return null;if("u32"!==s.typeInfo.name&&"x32"!==s.typeInfo.name)return null;const i=r.value,o=s.value;if(n instanceof ia)return new ia(n.data.map(e=>e>>i&(1<<o)-1),n.typeInfo);if("i32"!==n.typeInfo.name&&"x32"!==n.typeInfo.name)return null;const a=n.value;return new ra(a>>i&(1<<o)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof ia&&r instanceof ia&&s instanceof ia){const e=this._dot(r.data,s.data);return new ia(e<0?Array.from(n.data):n.data.map(e=>-e),n.typeInfo)}return null}_firstLeadingBit(e){return 0===e?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>this._firstLeadingBit(e)),n.typeInfo);const r=n;return new ra(this._firstLeadingBit(r.value),n.typeInfo)}_firstTrailingBit(e){return 0===e?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>this._firstTrailingBit(e)),n.typeInfo);const r=n;return new ra(this._firstTrailingBit(r.value),n.typeInfo)}Floor(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.floor(e)),n.typeInfo);const r=n;return new ra(Math.floor(r.value),n.typeInfo)}Fma(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof ia&&r instanceof ia&&s instanceof ia)return n.data.length!==r.data.length||n.data.length!==s.data.length?null:new ia(n.data.map((e,t)=>e*r.data[t]+s.data[t]),n.typeInfo);const i=n,o=r,a=s;return new ra(i.value*o.value+a.value,i.typeInfo)}Fract(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>e-Math.floor(e)),n.typeInfo);const r=n;return new ra(r.value-Math.floor(r.value),n.typeInfo)}Frexp(e,t){return null}InsertBits(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t),i=this.exec.evalExpression(e.args[3],t);if("u32"!==s.typeInfo.name&&"x32"!==s.typeInfo.name)return null;const o=s.value,a=(1<<i.value)-1<<o,l=~a;if(n instanceof ia&&r instanceof ia)return new ia(n.data.map((e,t)=>e&l|r.data[t]<<o&a),n.typeInfo);const c=n.value,u=r.value;return new ra(c&l|u<<o&a,n.typeInfo)}InverseSqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>1/Math.sqrt(e)),n.typeInfo);const r=n;return new ra(1/Math.sqrt(r.value),n.typeInfo)}Ldexp(e,t){return null}Length(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia){let e=0;return n.data.forEach(t=>{e+=t*t}),new ra(Math.sqrt(e),this.getTypeInfo("f32"))}const r=n;return new ra(Math.abs(r.value),n.typeInfo)}Log(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.log(e)),n.typeInfo);const r=n;return new ra(Math.log(r.value),n.typeInfo)}Log2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.log2(e)),n.typeInfo);const r=n;return new ra(Math.log2(r.value),n.typeInfo)}Max(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof ia&&r instanceof ia)return new ia(n.data.map((e,t)=>Math.max(e,r.data[t])),n.typeInfo);const s=n,i=r;return new ra(Math.max(s.value,i.value),n.typeInfo)}Min(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof ia&&r instanceof ia)return new ia(n.data.map((e,t)=>Math.min(e,r.data[t])),n.typeInfo);const s=n,i=r;return new ra(Math.min(s.value,i.value),n.typeInfo)}Mix(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof ia&&r instanceof ia&&s instanceof ia)return new ia(n.data.map((e,t)=>n.data[t]*(1-s.data[t])+r.data[t]*s.data[t]),n.typeInfo);const i=r,o=s;return new ra(n.value*(1-o.value)+i.value*o.value,n.typeInfo)}Modf(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof ia&&r instanceof ia)return new ia(n.data.map((e,t)=>e%r.data[t]),n.typeInfo);const s=r;return new ra(n.value%s.value,n.typeInfo)}Normalize(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia){const r=this.Length(e,t).value;return new ia(n.data.map(e=>e/r),n.typeInfo)}return null}Pow(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof ia&&r instanceof ia)return new ia(n.data.map((e,t)=>Math.pow(e,r.data[t])),n.typeInfo);const s=n,i=r;return new ra(Math.pow(s.value,i.value),n.typeInfo)}QuantizeToF16(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof ia?new ia(n.data.map(e=>e),n.typeInfo):new ra(n.value,n.typeInfo)}Radians(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof ia?new ia(n.data.map(e=>e*Math.PI/180),n.typeInfo):new ra(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof ia&&r instanceof ia){const e=this._dot(n.data,r.data);return new ia(n.data.map((t,n)=>t-2*e*r.data[n]),n.typeInfo)}return null}Refract(e,t){let n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof ia&&r instanceof ia&&s instanceof ra){const e=this._dot(r.data,n.data);return new ia(n.data.map((t,n)=>{const i=1-s.value*s.value*(1-e*e);if(i<0)return 0;const o=Math.sqrt(i);return s.value*t-(s.value*e+o)*r.data[n]}),n.typeInfo)}return null}ReverseBits(e,t){return null}Round(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.round(e)),n.typeInfo);const r=n;return new ra(Math.round(r.value),n.typeInfo)}Saturate(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.min(Math.max(e,0),1)),n.typeInfo);const r=n;return new ra(Math.min(Math.max(r.value,0),1),n.typeInfo)}Sign(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.sign(e)),n.typeInfo);const r=n;return new ra(Math.sign(r.value),n.typeInfo)}Sin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.sin(e)),n.typeInfo);const r=n;return new ra(Math.sin(r.value),n.typeInfo)}Sinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.sinh(e)),n.typeInfo);const r=n;return new ra(Math.sinh(r.value),n.typeInfo)}_smoothstep(e,t,n){const r=Math.min(Math.max((n-e)/(t-e),0),1);return r*r*(3-2*r)}SmoothStep(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(s instanceof ia&&n instanceof ia&&r instanceof ia)return new ia(s.data.map((e,t)=>this._smoothstep(n.data[t],r.data[t],e)),s.typeInfo);const i=n,o=r,a=s;return new ra(this._smoothstep(i.value,o.value,a.value),s.typeInfo)}Sqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.sqrt(e)),n.typeInfo);const r=n;return new ra(Math.sqrt(r.value),n.typeInfo)}Step(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(r instanceof ia&&n instanceof ia)return new ia(r.data.map((e,t)=>e<n.data[t]?0:1),r.typeInfo);const s=n;return new ra(r.value<s.value?0:1,s.typeInfo)}Tan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.tan(e)),n.typeInfo);const r=n;return new ra(Math.tan(r.value),n.typeInfo)}Tanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.tanh(e)),n.typeInfo);const r=n;return new ra(Math.tanh(r.value),n.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return"mat2x2f"===t||"mat2x2h"===t?e:"mat2x3f"===t?this.getTypeInfo("mat3x2f"):"mat2x3h"===t?this.getTypeInfo("mat3x2h"):"mat2x4f"===t?this.getTypeInfo("mat4x2f"):"mat2x4h"===t?this.getTypeInfo("mat4x2h"):"mat3x2f"===t?this.getTypeInfo("mat2x3f"):"mat3x2h"===t?this.getTypeInfo("mat2x3h"):"mat3x3f"===t||"mat3x3h"===t?e:"mat3x4f"===t?this.getTypeInfo("mat4x3f"):"mat3x4h"===t?this.getTypeInfo("mat4x3h"):"mat4x2f"===t?this.getTypeInfo("mat2x4f"):"mat4x2h"===t?this.getTypeInfo("mat2x4h"):"mat4x3f"===t?this.getTypeInfo("mat3x4f"):"mat4x3h"===t?this.getTypeInfo("mat3x4h"):e}Transpose(e,t){const n=this.exec.evalExpression(e.args[0],t);if(!(n instanceof oa))return null;const r=this._getTransposeType(n.typeInfo);if("mat2x2"===n.typeInfo.name||"mat2x2f"===n.typeInfo.name||"mat2x2h"===n.typeInfo.name){const e=n.data;return new oa([e[0],e[2],e[1],e[3]],r)}if("mat2x3"===n.typeInfo.name||"mat2x3f"===n.typeInfo.name||"mat2x3h"===n.typeInfo.name){const e=n.data;return new oa([e[0],e[3],e[6],e[1],e[4],e[7]],r)}if("mat2x4"===n.typeInfo.name||"mat2x4f"===n.typeInfo.name||"mat2x4h"===n.typeInfo.name){const e=n.data;return new oa([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13]],r)}if("mat3x2"===n.typeInfo.name||"mat3x2f"===n.typeInfo.name||"mat3x2h"===n.typeInfo.name){const e=n.data;return new oa([e[0],e[3],e[1],e[4],e[2],e[5]],r)}if("mat3x3"===n.typeInfo.name||"mat3x3f"===n.typeInfo.name||"mat3x3h"===n.typeInfo.name){const e=n.data;return new oa([e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]],r)}if("mat3x4"===n.typeInfo.name||"mat3x4f"===n.typeInfo.name||"mat3x4h"===n.typeInfo.name){const e=n.data;return new oa([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14]],r)}if("mat4x2"===n.typeInfo.name||"mat4x2f"===n.typeInfo.name||"mat4x2h"===n.typeInfo.name){const e=n.data;return new oa([e[0],e[4],e[1],e[5],e[2],e[6]],r)}if("mat4x3"===n.typeInfo.name||"mat4x3f"===n.typeInfo.name||"mat4x3h"===n.typeInfo.name){const e=n.data;return new oa([e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]],r)}if("mat4x4"===n.typeInfo.name||"mat4x4f"===n.typeInfo.name||"mat4x4h"===n.typeInfo.name){const e=n.data;return new oa([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]],r)}return null}Trunc(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ia)return new ia(n.data.map(e=>Math.trunc(e)),n.typeInfo);const r=n;return new ra(Math.trunc(r.value),n.typeInfo)}Dpdx(e,t){return null}DpdxCoarse(e,t){return null}DpdxFine(e,t){return null}Dpdy(e,t){return null}DpdyCoarse(e,t){return null}DpdyFine(e,t){return null}Fwidth(e,t){return null}FwidthCoarse(e,t){return null}FwidthFine(e,t){return null}TextureDimensions(e,t){const n=e.args[0],r=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(n instanceof Bo){const e=n.name,s=t.getVariableValue(e);if(s instanceof la){if(r<0||r>=s.mipLevelCount)return null;const e=s.getMipLevelSize(r),t=s.dimension;return"1d"===t?new ra(e[0],this.getTypeInfo("u32")):"3d"===t?new ia(e,this.getTypeInfo("vec3u")):"2d"===t?new ia(e.slice(0,2),this.getTypeInfo("vec2u")):null}return null}return null}TextureGather(e,t){return null}TextureGatherCompare(e,t){return null}TextureLoad(e,t){const n=e.args[0],r=this.exec.evalExpression(e.args[1],t),s=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(r instanceof ia)||2!==r.data.length)return null;if(n instanceof Bo){const e=n.name,i=t.getVariableValue(e);if(i instanceof la){const e=Math.floor(r.data[0]),t=Math.floor(r.data[1]);if(e<0||e>=i.width||t<0||t>=i.height)return null;const n=i.getPixel(e,t,0,s);return null===n?null:new ia(n,this.getTypeInfo("vec4f"))}return null}return null}TextureNumLayers(e,t){const n=e.args[0];if(n instanceof Bo){const e=n.name,r=t.getVariableValue(e);return r instanceof la?new ra(r.depthOrArrayLayers,this.getTypeInfo("u32")):null}return null}TextureNumLevels(e,t){const n=e.args[0];if(n instanceof Bo){const e=n.name,r=t.getVariableValue(e);return r instanceof la?new ra(r.mipLevelCount,this.getTypeInfo("u32")):null}return null}TextureNumSamples(e,t){const n=e.args[0];if(n instanceof Bo){const e=n.name,r=t.getVariableValue(e);return r instanceof la?new ra(r.sampleCount,this.getTypeInfo("u32")):null}return null}TextureSample(e,t){return null}TextureSampleBias(e,t){return null}TextureSampleCompare(e,t){return null}TextureSampleCompareLevel(e,t){return null}TextureSampleGrad(e,t){return null}TextureSampleLevel(e,t){return null}TextureSampleBaseClampToEdge(e,t){return null}TextureStore(e,t){const n=e.args[0],r=this.exec.evalExpression(e.args[1],t),s=4===e.args.length?this.exec.evalExpression(e.args[2],t).value:0,i=4===e.args.length?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(4!==i.length)return null;if(!(r instanceof ia)||2!==r.data.length)return null;if(n instanceof Bo){const e=n.name,o=t.getVariableValue(e);if(o instanceof la){const e=o.getMipLevelSize(0),t=Math.floor(r.data[0]),n=Math.floor(r.data[1]);return t<0||t>=e[0]||n<0||n>=e[1]||o.setPixel(t,n,0,s,Array.from(i)),null}return null}return null}AtomicLoad(e,t){let n=e.args[0];n instanceof Wo&&(n=n.right);const r=this.exec.getVariableName(n,t);return t.getVariable(r).value.getSubData(this.exec,n.postfix,t)}AtomicStore(e,t){let n=e.args[0];n instanceof Wo&&(n=n.right);const r=this.exec.getVariableName(n,t),s=t.getVariable(r);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=s.value.getSubData(this.exec,n.postfix,t);return a instanceof ra&&o instanceof ra&&(a.value=o.value),s.value instanceof aa&&s.value.setDataValue(this.exec,a,n.postfix,t),null}AtomicAdd(e,t){let n=e.args[0];n instanceof Wo&&(n=n.right);const r=this.exec.getVariableName(n,t),s=t.getVariable(r);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=s.value.getSubData(this.exec,n.postfix,t),l=new ra(a.value,a.typeInfo);return a instanceof ra&&o instanceof ra&&(a.value+=o.value),s.value instanceof aa&&s.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicSub(e,t){let n=e.args[0];n instanceof Wo&&(n=n.right);const r=this.exec.getVariableName(n,t),s=t.getVariable(r);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=s.value.getSubData(this.exec,n.postfix,t),l=new ra(a.value,a.typeInfo);return a instanceof ra&&o instanceof ra&&(a.value-=o.value),s.value instanceof aa&&s.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicMax(e,t){let n=e.args[0];n instanceof Wo&&(n=n.right);const r=this.exec.getVariableName(n,t),s=t.getVariable(r);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=s.value.getSubData(this.exec,n.postfix,t),l=new ra(a.value,a.typeInfo);return a instanceof ra&&o instanceof ra&&(a.value=Math.max(a.value,o.value)),s.value instanceof aa&&s.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicMin(e,t){let n=e.args[0];n instanceof Wo&&(n=n.right);const r=this.exec.getVariableName(n,t),s=t.getVariable(r);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=s.value.getSubData(this.exec,n.postfix,t),l=new ra(a.value,a.typeInfo);return a instanceof ra&&o instanceof ra&&(a.value=Math.min(a.value,o.value)),s.value instanceof aa&&s.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicAnd(e,t){let n=e.args[0];n instanceof Wo&&(n=n.right);const r=this.exec.getVariableName(n,t),s=t.getVariable(r);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=s.value.getSubData(this.exec,n.postfix,t),l=new ra(a.value,a.typeInfo);return a instanceof ra&&o instanceof ra&&(a.value=a.value&o.value),s.value instanceof aa&&s.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicOr(e,t){let n=e.args[0];n instanceof Wo&&(n=n.right);const r=this.exec.getVariableName(n,t),s=t.getVariable(r);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=s.value.getSubData(this.exec,n.postfix,t),l=new ra(a.value,a.typeInfo);return a instanceof ra&&o instanceof ra&&(a.value=a.value|o.value),s.value instanceof aa&&s.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicXor(e,t){let n=e.args[0];n instanceof Wo&&(n=n.right);const r=this.exec.getVariableName(n,t),s=t.getVariable(r);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=s.value.getSubData(this.exec,n.postfix,t),l=new ra(a.value,a.typeInfo);return a instanceof ra&&o instanceof ra&&(a.value=a.value^o.value),s.value instanceof aa&&s.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicExchange(e,t){let n=e.args[0];n instanceof Wo&&(n=n.right);const r=this.exec.getVariableName(n,t),s=t.getVariable(r);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=s.value.getSubData(this.exec,n.postfix,t),l=new ra(a.value,a.typeInfo);return a instanceof ra&&o instanceof ra&&(a.value=o.value),s.value instanceof aa&&s.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicCompareExchangeWeak(e,t){return null}Pack4x8snorm(e,t){return null}Pack4x8unorm(e,t){return null}Pack4xI8(e,t){return null}Pack4xU8(e,t){return null}Pack4x8Clamp(e,t){return null}Pack4xU8Clamp(e,t){return null}Pack2x16snorm(e,t){return null}Pack2x16unorm(e,t){return null}Pack2x16float(e,t){return null}Unpack4x8snorm(e,t){return null}Unpack4x8unorm(e,t){return null}Unpack4xI8(e,t){return null}Unpack4xU8(e,t){return null}Unpack2x16snorm(e,t){return null}Unpack2x16unorm(e,t){return null}Unpack2x16float(e,t){return null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return null}SubgroupExclusiveAdd(e,t){return null}SubgroupInclusiveAdd(e,t){return null}SubgroupAll(e,t){return null}SubgroupAnd(e,t){return null}SubgroupAny(e,t){return null}SubgroupBallot(e,t){return null}SubgroupBroadcast(e,t){return null}SubgroupBroadcastFirst(e,t){return null}SubgroupElect(e,t){return null}SubgroupMax(e,t){return null}SubgroupMin(e,t){return null}SubgroupMul(e,t){return null}SubgroupExclusiveMul(e,t){return null}SubgroupInclusiveMul(e,t){return null}SubgroupOr(e,t){return null}SubgroupShuffle(e,t){return null}SubgroupShuffleDown(e,t){return null}SubgroupShuffleUp(e,t){return null}SubgroupShuffleXor(e,t){return null}SubgroupXor(e,t){return null}QuadBroadcast(e,t){return null}QuadSwapDiagonal(e,t){return null}QuadSwapX(e,t){return null}QuadSwapY(e,t){return null}}const Na={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},La={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Oa extends Pa{constructor(e,t){var n;super(),this.ast=null!=e?e:[],this.reflection=new Aa,this.reflection.updateAST(this.ast),this.context=null!==(n=null==t?void 0:t.clone())&&void 0!==n?n:new Ia,this.builtins=new Ma(this),this.typeInfo={bool:this.getTypeInfo(Ro.bool),i32:this.getTypeInfo(Ro.i32),u32:this.getTypeInfo(Ro.u32),f32:this.getTypeInfo(Ro.f32),f16:this.getTypeInfo(Ro.f16),vec2f:this.getTypeInfo(Io.vec2f),vec2u:this.getTypeInfo(Io.vec2u),vec2i:this.getTypeInfo(Io.vec2i),vec2h:this.getTypeInfo(Io.vec2h),vec3f:this.getTypeInfo(Io.vec3f),vec3u:this.getTypeInfo(Io.vec3u),vec3i:this.getTypeInfo(Io.vec3i),vec3h:this.getTypeInfo(Io.vec3h),vec4f:this.getTypeInfo(Io.vec4f),vec4u:this.getTypeInfo(Io.vec4u),vec4i:this.getTypeInfo(Io.vec4i),vec4h:this.getTypeInfo(Io.vec4h),mat2x2f:this.getTypeInfo(Io.mat2x2f),mat2x3f:this.getTypeInfo(Io.mat2x3f),mat2x4f:this.getTypeInfo(Io.mat2x4f),mat3x2f:this.getTypeInfo(Io.mat3x2f),mat3x3f:this.getTypeInfo(Io.mat3x3f),mat3x4f:this.getTypeInfo(Io.mat3x4f),mat4x2f:this.getTypeInfo(Io.mat4x2f),mat4x3f:this.getTypeInfo(Io.mat4x3f),mat4x4f:this.getTypeInfo(Io.mat4x4f)}}getVariableValue(e){var t,n;const r=null!==(n=null===(t=this.context.getVariable(e))||void 0===t?void 0:t.value)&&void 0!==n?n:null;if(null===r)return null;if(r instanceof ra)return r.value;if(r instanceof ia)return Array.from(r.data);if(r instanceof oa)return Array.from(r.data);if(r instanceof aa&&r.typeInfo instanceof Ti){if("u32"===r.typeInfo.format.name)return Array.from(new Uint32Array(r.buffer,r.offset,r.typeInfo.count));if("i32"===r.typeInfo.format.name)return Array.from(new Int32Array(r.buffer,r.offset,r.typeInfo.count));if("f32"===r.typeInfo.format.name)return Array.from(new Float32Array(r.buffer,r.offset,r.typeInfo.count))}return null}execute(e){(e=null!=e?e:{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,n,r){const s=this.context.clone();(r=null!=r?r:{}).constants&&this._setOverrides(r.constants,s),this._execStatements(this.ast,s);const i=s.getFunction(e);if(!i)return;if("number"==typeof t)t=[t,1,1];else{if(0===t.length)return;1===t.length?t=[t[0],1,1]:2===t.length?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const o=t[0],a=t[1],l=t[2],c=this.getTypeInfo("vec3u");s.setVariable("@num_workgroups",new ia(t,c));const u=this.reflection.getFunctionInfo(e);for(const h in n)for(const e in n[h]){const t=n[h][e];s.variables.forEach(n=>{var r;const s=n.node;if(null==s?void 0:s.attributes){let i=null,o=null;for(const e of s.attributes)"binding"===e.name?i=e.value:"group"===e.name&&(o=e.value);if(e==i&&h==o){let i=!1;for(const t of u.resources)if(t.name===n.name&&t.group===parseInt(h)&&t.binding===parseInt(e)){i=!0;break}if(i)if(void 0!==t.texture&&void 0!==t.descriptor){const e=new la(t.texture,this.getTypeInfo(s.type),t.descriptor,null!==(r=t.texture.view)&&void 0!==r?r:null);n.value=e}else void 0!==t.uniform?n.value=new aa(t.uniform,this.getTypeInfo(s.type)):n.value=new aa(t,this.getTypeInfo(s.type))}}})}for(let h=0;h<l;++h)for(let e=0;e<a;++e)for(let t=0;t<o;++t)s.setVariable("@workgroup_id",new ia([t,e,h],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(i,[t,e,h],s)}execStatement(e,t){if(e instanceof bo)return this.evalExpression(e.value,t);if(e instanceof So){if(e.condition){const n=this.evalExpression(e.condition,t);if(!(n instanceof ra))throw new Error("Invalid break-if condition");if(!n.value)return null}return Oa._breakObj}if(e instanceof Ao)return Oa._continueObj;if(e instanceof oo)this._let(e,t);else if(e instanceof so)this._var(e,t);else if(e instanceof ao)this._const(e,t);else if(e instanceof Ji)this._function(e,t);else{if(e instanceof yo)return this._if(e,t);if(e instanceof _o)return this._switch(e,t);if(e instanceof ro)return this._for(e,t);if(e instanceof to)return this._while(e,t);if(e instanceof mo)return this._loop(e,t);if(e instanceof no){const n=t.clone();return n.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof po)this._assign(e,t);else if(e instanceof fo)this._increment(e,t);else{if(e instanceof ko)return null;if(e instanceof io){const n=e.name;null===t.getVariable(n)&&t.setVariable(n,new ra(0,this.getTypeInfo("u32")))}else if(e instanceof go)this._call(e,t);else{if(e instanceof wo)return null;if(e instanceof Eo)return null}}}return null}evalExpression(e,t){return e instanceof Ho?this._evalBinaryOp(e,t):e instanceof jo?this._evalLiteral(e,t):e instanceof Bo?this._evalVariable(e,t):e instanceof Do?this._evalCall(e,t):e instanceof Fo?this._evalCreate(e,t):e instanceof Uo?this._evalConst(e,t):e instanceof Vo?this._evalBitcast(e,t):e instanceof Wo?this._evalUnaryOp(e,t):null}getTypeInfo(e){var t;if(e instanceof Ro){const t=this.reflection.getTypeInfo(e);if(null!==t)return t}let n=null!==(t=this.typeInfo[e])&&void 0!==t?t:null;return null!==n||(n=this.reflection.getTypeInfoByName(e)),n}_setOverrides(e,t){for(const n in e){const r=e[n],s=this.reflection.getOverrideInfo(n);null!==s&&(null===s.type&&(s.type=this.getTypeInfo("u32")),"u32"===s.type.name||"i32"===s.type.name||"f32"===s.type.name||"f16"===s.type.name?t.setVariable(n,new ra(r,s.type)):"bool"===s.type.name?t.setVariable(n,new ra(r?1:0,s.type)):("vec2"===s.type.name||"vec3"===s.type.name||"vec4"===s.type.name||"vec2f"===s.type.name||"vec3f"===s.type.name||"vec4f"===s.type.name||"vec2i"===s.type.name||"vec3i"===s.type.name||"vec4i"===s.type.name||"vec2u"===s.type.name||"vec3u"===s.type.name||"vec4u"===s.type.name||"vec2h"===s.type.name||"vec3h"===s.type.name||"vec4h"===s.type.name)&&t.setVariable(n,new ia(r,s.type)))}}_dispatchWorkgroup(e,t,n){const r=[1,1,1];for(const c of e.node.attributes)if("workgroup_size"===c.name){if(c.value.length>0){const e=n.getVariableValue(c.value[0]);r[0]=e instanceof ra?e.value:parseInt(c.value[0])}if(c.value.length>1){const e=n.getVariableValue(c.value[1]);r[1]=e instanceof ra?e.value:parseInt(c.value[1])}if(c.value.length>2){const e=n.getVariableValue(c.value[2]);r[2]=e instanceof ra?e.value:parseInt(c.value[2])}}const s=this.getTypeInfo("vec3u"),i=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new ia(r,s));const o=r[0],a=r[1],l=r[2];for(let c=0,u=0;c<l;++c)for(let l=0;l<a;++l)for(let a=0;a<o;++a,++u){const o=[a,l,c],h=[a+t[0]*r[0],l+t[1]*r[1],c+t[2]*r[2]];n.setVariable("@local_invocation_id",new ia(o,s)),n.setVariable("@global_invocation_id",new ia(h,s)),n.setVariable("@local_invocation_index",new ra(u,i)),this._dispatchExec(e,n)}}_dispatchExec(e,t){for(const n of e.node.args)for(const e of n.attributes)if("builtin"===e.name){const r=`@${e.value}`,s=t.getVariable(r);void 0!==s&&t.variables.set(n.name,s)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof Wo;)e=e.right;return e instanceof Bo?e.name:null}_execStatements(e,t){for(const n of e){if(n instanceof Array){const e=t.clone(),r=this._execStatements(n,e);if(r)return r;continue}const e=this.execStatement(n,t);if(e)return e}return null}_call(e,t){const n=t.clone();n.currentFunctionName=e.name;const r=t.getFunction(e.name);if(r){for(let t=0;t<r.node.args.length;++t){const s=r.node.args[t],i=this.evalExpression(e.args[t],n);n.setVariable(s.name,i,s)}this._execStatements(r.node.body,n)}else e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const n=this.getVariableName(e.variable,t),r=t.getVariable(n);r&&("++"===e.operator?r.value instanceof ra&&r.value.value++:"--"===e.operator&&r.value instanceof ra&&r.value.value--)}_getVariableData(e,t){if(e instanceof Bo){const n=this.getVariableName(e,t),r=t.getVariable(n);return null===r?null:r.value.getSubData(this,e.postfix,t)}if(e instanceof Wo){if("*"===e.operator){const n=this._getVariableData(e.right,t);return n instanceof na?n.reference.getSubData(this,e.postfix,t):null}if("&"===e.operator){const n=this._getVariableData(e.right,t);return new na(n)}}return null}_assign(e,t){let n=null,r="<var>",s=null;if(e.variable instanceof Wo){const n=this._getVariableData(e.variable,t),r=this.evalExpression(e.value,t),s=e.operator;if("="===s){if(n instanceof ra||n instanceof ia||n instanceof oa){if(r instanceof ra||r instanceof ia||r instanceof oa&&n.data.length===r.data.length)return void n.data.set(r.data)}else if(n instanceof aa&&r instanceof aa&&n.buffer.byteLength-n.offset>=r.buffer.byteLength-r.offset)return void(n.buffer.byteLength%4==0?new Uint32Array(n.buffer,n.offset,n.typeInfo.size/4).set(new Uint32Array(r.buffer,r.offset,r.typeInfo.size/4)):new Uint8Array(n.buffer,n.offset,n.typeInfo.size).set(new Uint8Array(r.buffer,r.offset,r.typeInfo.size)));return null}if("+="===s)return(n instanceof ra||n instanceof ia||n instanceof oa)&&(r instanceof ra||r instanceof ia||r instanceof oa)?void n.data.set(r.data.map((e,t)=>n.data[t]+e)):void 0;if("-="===s)return(n instanceof ra||n instanceof ia||n instanceof oa)&&(r instanceof ra||r instanceof ia||r instanceof oa)?void n.data.set(r.data.map((e,t)=>n.data[t]-e)):void 0}if(e.variable instanceof Wo){if("*"===e.variable.operator){r=this.getVariableName(e.variable.right,t);const s=t.getVariable(r);if(!(s&&s.value instanceof na))return;n=s.value.reference;let i=e.variable.postfix;if(!i){let t=e.variable.right;for(;t instanceof Wo;){if(t.postfix){i=t.postfix;break}t=t.right}}i&&(n=n.getSubData(this,i,t))}}else{s=e.variable.postfix,r=this.getVariableName(e.variable,t);const i=t.getVariable(r);if(null===i)return;n=i.value}if(n instanceof na&&(n=n.reference),null===n)return;const i=this.evalExpression(e.value,t),o=e.operator;if("="!==o){const e=n.getSubData(this,s,t);if(e instanceof ia&&i instanceof ra){const t=e.data,n=i.value;if("+="===o)for(let e=0;e<t.length;++e)t[e]+=n;else if("-="===o)for(let e=0;e<t.length;++e)t[e]-=n;else if("*="===o)for(let e=0;e<t.length;++e)t[e]*=n;else if("/="===o)for(let e=0;e<t.length;++e)t[e]/=n;else if("%="===o)for(let e=0;e<t.length;++e)t[e]%=n;else if("&="===o)for(let e=0;e<t.length;++e)t[e]&=n;else if("|="===o)for(let e=0;e<t.length;++e)t[e]|=n;else if("^="===o)for(let e=0;e<t.length;++e)t[e]^=n;else if("<<="===o)for(let e=0;e<t.length;++e)t[e]<<=n;else if(">>="===o)for(let e=0;e<t.length;++e)t[e]>>=n}else if(e instanceof ia&&i instanceof ia){const t=e.data,n=i.data;if(t.length!==n.length)return;if("+="===o)for(let e=0;e<t.length;++e)t[e]+=n[e];else if("-="===o)for(let e=0;e<t.length;++e)t[e]-=n[e];else if("*="===o)for(let e=0;e<t.length;++e)t[e]*=n[e];else if("/="===o)for(let e=0;e<t.length;++e)t[e]/=n[e];else if("%="===o)for(let e=0;e<t.length;++e)t[e]%=n[e];else if("&="===o)for(let e=0;e<t.length;++e)t[e]&=n[e];else if("|="===o)for(let e=0;e<t.length;++e)t[e]|=n[e];else if("^="===o)for(let e=0;e<t.length;++e)t[e]^=n[e];else if("<<="===o)for(let e=0;e<t.length;++e)t[e]<<=n[e];else if(">>="===o)for(let e=0;e<t.length;++e)t[e]>>=n[e]}else{if(!(e instanceof ra&&i instanceof ra))return;"+="===o?e.value+=i.value:"-="===o?e.value-=i.value:"*="===o?e.value*=i.value:"/="===o?e.value/=i.value:"%="===o?e.value%=i.value:"&="===o?e.value&=i.value:"|="===o?e.value|=i.value:"^="===o?e.value^=i.value:"<<="===o?e.value<<=i.value:">>="===o&&(e.value>>=i.value)}return void(n instanceof aa&&n.setDataValue(this,e,s,t))}if(n instanceof aa)n.setDataValue(this,i,s,t);else if(s){if(!(n instanceof ia||n instanceof oa))return;if(s instanceof Go){const e=this.evalExpression(s.index,t).value;if(n instanceof ia){if(!(i instanceof ra))return;n.data[e]=i.value}else{if(!(n instanceof oa))return;{const e=this.evalExpression(s.index,t).value;if(e<0)return;if(!(i instanceof ia))return;{const t=n.typeInfo.getTypeName();if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t){if(!(e<2&&2===i.data.length))return;n.data[2*e]=i.data[0],n.data[2*e+1]=i.data[1]}else if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t){if(!(e<2&&3===i.data.length))return;n.data[3*e]=i.data[0],n.data[3*e+1]=i.data[1],n.data[3*e+2]=i.data[2]}else if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t){if(!(e<2&&4===i.data.length))return;n.data[4*e]=i.data[0],n.data[4*e+1]=i.data[1],n.data[4*e+2]=i.data[2],n.data[4*e+3]=i.data[3]}else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t){if(!(e<3&&2===i.data.length))return;n.data[2*e]=i.data[0],n.data[2*e+1]=i.data[1]}else if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t){if(!(e<3&&3===i.data.length))return;n.data[3*e]=i.data[0],n.data[3*e+1]=i.data[1],n.data[3*e+2]=i.data[2]}else if("mat3x4"===t||"mat3x4f"===t||"mat3x4h"===t){if(!(e<3&&4===i.data.length))return;n.data[4*e]=i.data[0],n.data[4*e+1]=i.data[1],n.data[4*e+2]=i.data[2],n.data[4*e+3]=i.data[3]}else if("mat4x2"===t||"mat4x2f"===t||"mat4x2h"===t){if(!(e<4&&2===i.data.length))return;n.data[2*e]=i.data[0],n.data[2*e+1]=i.data[1]}else if("mat4x3"===t||"mat4x3f"===t||"mat4x3h"===t){if(!(e<4&&3===i.data.length))return;n.data[3*e]=i.data[0],n.data[3*e+1]=i.data[1],n.data[3*e+2]=i.data[2]}else{if("mat4x4"!==t&&"mat4x4f"!==t&&"mat4x4h"!==t)return;if(!(e<4&&4===i.data.length))return;n.data[4*e]=i.data[0],n.data[4*e+1]=i.data[1],n.data[4*e+2]=i.data[2],n.data[4*e+3]=i.data[3]}}}}}else if(s instanceof Oo){const e=s.value;if(!(n instanceof ia))return;if(i instanceof ra){if(e.length>1)return;if("x"===e)n.data[0]=i.value;else if("y"===e){if(n.data.length<2)return;n.data[1]=i.value}else if("z"===e){if(n.data.length<3)return;n.data[2]=i.value}else if("w"===e){if(n.data.length<4)return;n.data[3]=i.value}}else{if(!(i instanceof ia))return;if(e.length!==i.data.length)return;for(let t=0;t<e.length;++t){const r=e[t];if("x"===r||"r"===r)n.data[0]=i.data[t];else if("y"===r||"g"===r){if(i.data.length<2)return;n.data[1]=i.data[t]}else if("z"===r||"b"===r){if(i.data.length<3)return;n.data[2]=i.data[t]}else{if("w"!==r&&"a"!==r)return;if(i.data.length<4)return;n.data[3]=i.data[t]}}}}}else n instanceof ra&&i instanceof ra?n.value=i.value:(n instanceof ia&&i instanceof ia||n instanceof oa&&i instanceof oa)&&n.data.set(i.data)}_function(e,t){const n=new ka(e);t.functions.set(e.name,n)}_const(e,t){let n=null;null!==e.value&&(n=this.evalExpression(e.value,t)),t.createVariable(e.name,n,e)}_let(e,t){let n=null;if(null!==e.value){if(n=this.evalExpression(e.value,t),null===n)return;e.value instanceof Wo||(n=n.clone())}else{const r=e.type.name;if("f32"===r||"i32"===r||"u32"===r||"bool"===r||"f16"===r||"vec2"===r||"vec3"===r||"vec4"===r||"vec2f"===r||"vec3f"===r||"vec4f"===r||"vec2i"===r||"vec3i"===r||"vec4i"===r||"vec2u"===r||"vec3u"===r||"vec4u"===r||"vec2h"===r||"vec3h"===r||"vec4h"===r||"vec2b"===r||"vec3b"===r||"vec4b"===r||"mat2x2"===r||"mat2x3"===r||"mat2x4"===r||"mat3x2"===r||"mat3x3"===r||"mat3x4"===r||"mat4x2"===r||"mat4x3"===r||"mat4x4"===r||"mat2x2f"===r||"mat2x3f"===r||"mat2x4f"===r||"mat3x2f"===r||"mat3x3f"===r||"mat3x4f"===r||"mat4x2f"===r||"mat4x3f"===r||"mat4x4f"===r||"mat2x2h"===r||"mat2x3h"===r||"mat2x4h"===r||"mat3x2h"===r||"mat3x3h"===r||"mat3x4h"===r||"mat4x2h"===r||"mat4x3h"===r||"mat4x4h"===r||"array"===r){const r=new Fo(e.type,[]);n=this._evalCreate(r,t)}}t.createVariable(e.name,n,e)}_var(e,t){let n=null;if(null!==e.value){if(n=this.evalExpression(e.value,t),null===n)return;e.value instanceof Wo||(n=n.clone())}else{if(null===e.type)return;const r=e.type.name;if("f32"===r||"i32"===r||"u32"===r||"bool"===r||"f16"===r||"vec2"===r||"vec3"===r||"vec4"===r||"vec2f"===r||"vec3f"===r||"vec4f"===r||"vec2i"===r||"vec3i"===r||"vec4i"===r||"vec2u"===r||"vec3u"===r||"vec4u"===r||"vec2h"===r||"vec3h"===r||"vec4h"===r||"vec2b"===r||"vec3b"===r||"vec4b"===r||"mat2x2"===r||"mat2x3"===r||"mat2x4"===r||"mat3x2"===r||"mat3x3"===r||"mat3x4"===r||"mat4x2"===r||"mat4x3"===r||"mat4x4"===r||"mat2x2f"===r||"mat2x3f"===r||"mat2x4f"===r||"mat3x2f"===r||"mat3x3f"===r||"mat3x4f"===r||"mat4x2f"===r||"mat4x3f"===r||"mat4x4f"===r||"mat2x2h"===r||"mat2x3h"===r||"mat2x4h"===r||"mat3x2h"===r||"mat3x3h"===r||"mat3x4h"===r||"mat4x2h"===r||"mat4x3h"===r||"mat4x4h"===r||e.type instanceof Mo||e.type instanceof ko||e.type instanceof Io){const r=new Fo(e.type,[]);n=this._evalCreate(r,t)}}t.createVariable(e.name,n,e)}_switch(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof ra))return null;let r=null;for(const s of e.cases)if(s instanceof qo)for(const e of s.selectors){if(e instanceof Xo){r=s;continue}const i=this.evalExpression(e,t);if(!(i instanceof ra))return null;if(i.value===n.value)return this._execStatements(s.body,t)}else s instanceof Yo&&(r=s);return r?this._execStatements(r.body,t):null}_if(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof ra))return null;if(n.value)return this._execStatements(e.body,t);for(const r of e.elseif){const e=this.evalExpression(r.condition,t);if(!(e instanceof ra))return null;if(e.value)return this._execStatements(r.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof ra?e.value:0}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===Oa._breakObj)break;if(null!==n&&n!==Oa._continueObj)return n;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const n=this._execStatements(e.body,t);if(n===Oa._breakObj)break;if(n===Oa._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===Oa._breakObj)break}else if(null!==n)return n}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===Oa._breakObj)break;if(n!==Oa._continueObj&&null!==n)return n}return null}_evalBitcast(e,t){const n=this.evalExpression(e.value,t),r=e.type;if(n instanceof ra){const e=Ea(n.value,n.typeInfo.name,r.name);return new ra(e,this.getTypeInfo(r))}if(n instanceof ia){const e=n.typeInfo.getTypeName();let t="";if(e.endsWith("f"))t="f32";else if(e.endsWith("i"))t="i32";else if(e.endsWith("u"))t="u32";else if(e.endsWith("b"))t="bool";else{if(!e.endsWith("h"))return null;t="f16"}const s=r.getTypeName();let i="";if(s.endsWith("f"))i="f32";else if(s.endsWith("i"))i="i32";else if(s.endsWith("u"))i="u32";else if(s.endsWith("b"))i="bool";else{if(!s.endsWith("h"))return null;i="f16"}const o=function(e,t,n){if(t===n)return e;const r=new Array(e.length);for(let s=0;s<e.length;s++)r[s]=Ea(e[s],t,n);return r}(Array.from(n.data),t,i);return new ia(o,this.getTypeInfo(r))}return null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var n;if(e instanceof Fo){if(null===e.type)return ta.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}e instanceof Fo?e.type.name:e.name;const r=e instanceof Fo?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(null===r)return null;if(0===r.size)return null;const s=new aa(new ArrayBuffer(r.size),r,0);if(r instanceof Ei){if(e.args)for(let i=0;i<e.args.length;++i){const n=r.members[i],o=e.args[i],a=this.evalExpression(o,t);s.setData(this,a,n.type,n.offset,t)}}else if(r instanceof Ti){let i=0;if(e.args)for(let o=0;o<e.args.length;++o){const a=e.args[o],l=this.evalExpression(a,t);null===r.format&&("x32"===(null===(n=l.typeInfo)||void 0===n?void 0:n.name)?r.format=this.getTypeInfo("i32"):r.format=l.typeInfo),s.setData(this,l,r.format,i,t),i+=r.stride}}return e instanceof Fo?s.getSubData(this,e.postfix,t):s}_evalLiteral(e,t){const n=this.getTypeInfo(e.type),r=n.name;return"x32"===r||"u32"===r||"f32"===r||"f16"===r||"i32"===r||"bool"===r?new ra(e.scalarValue,n):"vec2"===r||"vec3"===r||"vec4"===r||"vec2f"===r||"vec3f"===r||"vec4f"===r||"vec2h"===r||"vec3h"===r||"vec4h"===r||"vec2i"===r||"vec3i"===r||"vec4i"===r||"vec2u"===r||"vec3u"===r||"vec4u"===r?this._callConstructorVec(e,t):"mat2x2"===r||"mat2x3"===r||"mat2x4"===r||"mat3x2"===r||"mat3x3"===r||"mat3x4"===r||"mat4x2"===r||"mat4x3"===r||"mat4x4"===r||"mat2x2f"===r||"mat2x3f"===r||"mat2x4f"===r||"mat3x2f"===r||"mat3x3f"===r||"mat3x4f"===r||"mat4x2f"===r||"mat4x3f"===r||"mat4x4f"===r||"mat2x2h"===r||"mat2x3h"===r||"mat2x4h"===r||"mat3x2h"===r||"mat3x3h"===r||"mat3x4h"===r||"mat4x2h"===r||"mat4x3h"===r||"mat4x4h"===r?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const n=t.getVariableValue(e.name);return null===n?n:n.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if("f32"===t.name)return t;for(let n=1;n<e.length;++n){const r=Oa._priority.get(t.name);Oa._priority.get(e[n].name)<r&&(t=e[n])}return"x32"===t.name?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const n=this.evalExpression(e.right,t);if("&"===e.operator)return new na(n);if("*"===e.operator)return n instanceof na?n.reference.getSubData(this,e.postfix,t):null;const r=n instanceof ra?n.value:n instanceof ia?Array.from(n.data):null;switch(e.operator){case"+":{if(fa(r)){const e=r.map((e,t)=>+e);return new ia(e,n.typeInfo)}const e=r,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new ra(+e,t)}case"-":{if(fa(r)){const e=r.map((e,t)=>-e);return new ia(e,n.typeInfo)}const e=r,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new ra(-e,t)}case"!":{if(fa(r)){const e=r.map((e,t)=>e?0:1);return new ia(e,n.typeInfo)}const e=r,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new ra(e?0:1,t)}case"~":{if(fa(r)){const e=r.map((e,t)=>~e);return new ia(e,n.typeInfo)}const e=r,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new ra(~e,t)}}return null}_evalBinaryOp(e,t){const n=this.evalExpression(e.left,t),r=this.evalExpression(e.right,t),s=n instanceof ra?n.value:n instanceof ia||n instanceof oa?Array.from(n.data):null,i=r instanceof ra?r.value:r instanceof ia||r instanceof oa?Array.from(r.data):null;switch(e.operator){case"+":{if(fa(s)&&fa(i)){const e=s,t=i;if(e.length!==t.length)return null;const r=e.map((e,n)=>e+t[n]);return new ia(r,n.typeInfo)}if(fa(s)){const e=i,t=s.map((t,n)=>t+e);return new ia(t,n.typeInfo)}if(fa(i)){const e=s,t=i.map((t,n)=>e+t);return new ia(t,r.typeInfo)}const e=s,t=i,o=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ra(e+t,o)}case"-":{if(fa(s)&&fa(i)){const e=s,t=i;if(e.length!==t.length)return null;const r=e.map((e,n)=>e-t[n]);return new ia(r,n.typeInfo)}if(fa(s)){const e=i,t=s.map((t,n)=>t-e);return new ia(t,n.typeInfo)}if(fa(i)){const e=s,t=i.map((t,n)=>e-t);return new ia(t,r.typeInfo)}const e=s,t=i,o=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ra(e-t,o)}case"*":{if(fa(s)&&fa(i)){const e=s,t=i;if(n instanceof oa&&r instanceof oa){const s=function(e,t,n,r){if(void 0===La[t.name]||void 0===La[r.name])return null;const s=La[t.name][0],i=La[t.name][1],o=La[r.name][0];if(s!==La[r.name][1])return null;const a=new Array(o*i);for(let l=0;l<i;l++)for(let t=0;t<o;t++){let r=0;for(let o=0;o<s;o++)r+=e[o*i+l]*n[t*s+o];a[l*o+t]=r}return a}(e,n.typeInfo,t,r.typeInfo);if(null===s)return null;const i=La[r.typeInfo.name][0],o=La[n.typeInfo.name][1],a=this.getTypeInfo(`mat${i}x${o}f`);return new oa(s,a)}if(n instanceof oa&&r instanceof ia){const s=function(e,t,n,r){if(void 0===La[t.name]||void 0===Na[r.name])return null;const s=La[t.name][0],i=La[t.name][1];if(s!==n.length)return null;const o=new Array(i);for(let a=0;a<i;a++){let t=0;for(let r=0;r<s;r++)t+=e[r*i+a]*n[r];o[a]=t}return o}(e,n.typeInfo,t,r.typeInfo);return null===s?null:new ia(s,r.typeInfo)}if(n instanceof ia&&r instanceof oa){const s=function(e,t,n,r){if(void 0===Na[t.name]||void 0===La[r.name])return null;const s=La[r.name][0],i=La[r.name][1];if(i!==e.length)return null;const o=[];for(let a=0;a<s;a++){let t=0;for(let r=0;r<i;r++)t+=e[r]*n[r*s+a];o[a]=t}return o}(e,n.typeInfo,t,r.typeInfo);return null===s?null:new ia(s,n.typeInfo)}{if(e.length!==t.length)return null;const r=e.map((e,n)=>e*t[n]);return new ia(r,n.typeInfo)}}if(fa(s)){const e=i,t=s.map((t,n)=>t*e);return n instanceof oa?new oa(t,n.typeInfo):new ia(t,n.typeInfo)}if(fa(i)){const e=s,t=i.map((t,n)=>e*t);return r instanceof oa?new oa(t,r.typeInfo):new ia(t,r.typeInfo)}const e=s,t=i,o=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ra(e*t,o)}case"%":{if(fa(s)&&fa(i)){const e=s,t=i;if(e.length!==t.length)return null;const r=e.map((e,n)=>e%t[n]);return new ia(r,n.typeInfo)}if(fa(s)){const e=i,t=s.map((t,n)=>t%e);return new ia(t,n.typeInfo)}if(fa(i)){const e=s,t=i.map((t,n)=>e%t);return new ia(t,r.typeInfo)}const e=s,t=i,o=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ra(e%t,o)}case"/":{if(fa(s)&&fa(i)){const e=s,t=i;if(e.length!==t.length)return null;const r=e.map((e,n)=>e/t[n]);return new ia(r,n.typeInfo)}if(fa(s)){const e=i,t=s.map((t,n)=>t/e);return new ia(t,n.typeInfo)}if(fa(i)){const e=s,t=i.map((t,n)=>e/t);return new ia(t,r.typeInfo)}const e=s,t=i,o=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ra(e/t,o)}case"&":{if(fa(s)&&fa(i)){const e=s,t=i;if(e.length!==t.length)return null;const r=e.map((e,n)=>e&t[n]);return new ia(r,n.typeInfo)}if(fa(s)){const e=i,t=s.map((t,n)=>t&e);return new ia(t,n.typeInfo)}if(fa(i)){const e=s,t=i.map((t,n)=>e&t);return new ia(t,r.typeInfo)}const e=s,t=i,o=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ra(e&t,o)}case"|":{if(fa(s)&&fa(i)){const e=s,t=i;if(e.length!==t.length)return null;const r=e.map((e,n)=>e|t[n]);return new ia(r,n.typeInfo)}if(fa(s)){const e=i,t=s.map((t,n)=>t|e);return new ia(t,n.typeInfo)}if(fa(i)){const e=s,t=i.map((t,n)=>e|t);return new ia(t,r.typeInfo)}const e=s,t=i,o=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ra(e|t,o)}case"^":{if(fa(s)&&fa(i)){const e=s,t=i;if(e.length!==t.length)return null;const r=e.map((e,n)=>e^t[n]);return new ia(r,n.typeInfo)}if(fa(s)){const e=i,t=s.map((t,n)=>t^e);return new ia(t,n.typeInfo)}if(fa(i)){const e=s,t=i.map((t,n)=>e^t);return new ia(t,r.typeInfo)}const e=s,t=i,o=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ra(e^t,o)}case"<<":{if(fa(s)&&fa(i)){const e=s,t=i;if(e.length!==t.length)return null;const r=e.map((e,n)=>e<<t[n]);return new ia(r,n.typeInfo)}if(fa(s)){const e=i,t=s.map((t,n)=>t<<e);return new ia(t,n.typeInfo)}if(fa(i)){const e=s,t=i.map((t,n)=>e<<t);return new ia(t,r.typeInfo)}const e=s,t=i,o=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ra(e<<t,o)}case">>":{if(fa(s)&&fa(i)){const e=s,t=i;if(e.length!==t.length)return null;const r=e.map((e,n)=>e>>t[n]);return new ia(r,n.typeInfo)}if(fa(s)){const e=i,t=s.map((t,n)=>t>>e);return new ia(t,n.typeInfo)}if(fa(i)){const e=s,t=i.map((t,n)=>e>>t);return new ia(t,r.typeInfo)}const e=s,t=i,o=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ra(e>>t,o)}case">":if(fa(s)&&fa(i)){const e=s,t=i;if(e.length!==t.length)return null;const r=e.map((e,n)=>e>t[n]?1:0);return new ia(r,n.typeInfo)}if(fa(s)){const e=i,t=s.map((t,n)=>t>e?1:0);return new ia(t,n.typeInfo)}if(fa(i)){const e=s,t=i.map((t,n)=>e>t?1:0);return new ia(t,r.typeInfo)}return new ra(s>i?1:0,this.getTypeInfo("bool"));case"<":if(fa(s)&&fa(i)){const e=s,t=i;if(e.length!==t.length)return null;const r=e.map((e,n)=>e<t[n]?1:0);return new ia(r,n.typeInfo)}if(fa(s)){const e=i,t=s.map((t,n)=>t<e?1:0);return new ia(t,n.typeInfo)}if(fa(i)){const e=s,t=i.map((t,n)=>e<t?1:0);return new ia(t,r.typeInfo)}return new ra(s<i?1:0,this.getTypeInfo("bool"));case"==":if(fa(s)&&fa(i)){const e=s,t=i;if(e.length!==t.length)return null;const r=e.map((e,n)=>e===t[n]?1:0);return new ia(r,n.typeInfo)}if(fa(s)){const e=i,t=s.map((t,n)=>t==e?1:0);return new ia(t,n.typeInfo)}if(fa(i)){const e=s,t=i.map((t,n)=>e==t?1:0);return new ia(t,r.typeInfo)}return new ra(s===i?1:0,this.getTypeInfo("bool"));case"!=":if(fa(s)&&fa(i)){const e=s,t=i;if(e.length!==t.length)return null;const r=e.map((e,n)=>e!==t[n]?1:0);return new ia(r,n.typeInfo)}if(fa(s)){const e=i,t=s.map((t,n)=>t!==e?1:0);return new ia(t,n.typeInfo)}if(fa(i)){const e=s,t=i.map((t,n)=>e!==t?1:0);return new ia(t,r.typeInfo)}return new ra(s!==i?1:0,this.getTypeInfo("bool"));case">=":if(fa(s)&&fa(i)){const e=s,t=i;if(e.length!==t.length)return null;const r=e.map((e,n)=>e>=t[n]?1:0);return new ia(r,n.typeInfo)}if(fa(s)){const e=i,t=s.map((t,n)=>t>=e?1:0);return new ia(t,n.typeInfo)}if(fa(i)){const e=s,t=i.map((t,n)=>e>=t?1:0);return new ia(t,r.typeInfo)}return new ra(s>=i?1:0,this.getTypeInfo("bool"));case"<=":if(fa(s)&&fa(i)){const e=s,t=i;if(e.length!==t.length)return null;const r=e.map((e,n)=>e<=t[n]?1:0);return new ia(r,n.typeInfo)}if(fa(s)){const e=i,t=s.map((t,n)=>t<=e?1:0);return new ia(t,n.typeInfo)}if(fa(i)){const e=s,t=i.map((t,n)=>e<=t?1:0);return new ia(t,r.typeInfo)}return new ra(s<=i?1:0,this.getTypeInfo("bool"));case"&&":if(fa(s)&&fa(i)){const e=s,t=i;if(e.length!==t.length)return null;const r=e.map((e,n)=>e&&t[n]?1:0);return new ia(r,n.typeInfo)}if(fa(s)){const e=i,t=s.map((t,n)=>t&&e?1:0);return new ia(t,n.typeInfo)}if(fa(i)){const e=s,t=i.map((t,n)=>e&&t?1:0);return new ia(t,r.typeInfo)}return new ra(s&&i?1:0,this.getTypeInfo("bool"));case"||":if(fa(s)&&fa(i)){const e=s,t=i;if(e.length!==t.length)return null;const r=e.map((e,n)=>e||t[n]?1:0);return new ia(r,n.typeInfo)}if(fa(s)){const e=i,t=s.map((t,n)=>t||e?1:0);return new ia(t,n.typeInfo)}if(fa(i)){const e=s,t=i.map((t,n)=>e||t?1:0);return new ia(t,r.typeInfo)}return new ra(s||i?1:0,this.getTypeInfo("bool"))}return null}_evalCall(e,t){if(null!==e.cachedReturnValue)return e.cachedReturnValue;const n=t.clone();n.currentFunctionName=e.name;const r=t.getFunction(e.name);if(!r)return e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)?this._evalCreate(e,t):null;for(let s=0;s<r.node.args.length;++s){const t=r.node.args[s],i=this.evalExpression(e.args[s],n);n.createVariable(t.name,i,t)}return this._execStatements(r.node.body,n)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const n=t.getFunction(e.name);if(n){const r=t.clone();for(let t=0;t<n.node.args.length;++t){const s=n.node.args[t],i=this.evalExpression(e.args[t],r);r.setVariable(s.name,i,s)}return this._execStatements(n.node.body,r)}return null}_callConstructorValue(e,t){if(!e.args||0===e.args.length)return new ra(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],t);return n.typeInfo=this.getTypeInfo(e.type),n.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const n=this.getTypeInfo(e.type),r=e.type.getTypeName(),s=Na[r];if(void 0===s)return null;const i=[];if(e instanceof jo)if(e.isVector){const t=e.vectorValue;for(const e of t)i.push(e)}else i.push(e.scalarValue);else if(e.args)for(const o of e.args){const e=this.evalExpression(o,t);if(e instanceof ia){const t=e.data;for(let e=0;e<t.length;++e){let n=t[e];i.push(n)}}else if(e instanceof ra){let t=e.value;i.push(t)}}if(e.type instanceof Io&&null===e.type.format&&(e.type.format=Io.f32),0===i.length){const r=new Array(s).fill(0);return new ia(r,n).getSubData(this,e.postfix,t)}if(1===i.length)for(;i.length<s;)i.push(i[0]);return i.length<s?null:new ia(i.length>s?i.slice(0,s):i,n).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const n=this.getTypeInfo(e.type),r=e.type.getTypeName(),s=La[r];if(void 0===s)return null;const i=[];if(e instanceof jo)if(e.isVector){const t=e.vectorValue;for(const e of t)i.push(e)}else i.push(e.scalarValue);else if(e.args)for(const o of e.args){const e=this.evalExpression(o,t);e instanceof ia?i.push(...e.data):e instanceof ra?i.push(e.value):e instanceof oa&&i.push(...e.data)}if(n instanceof Ai&&null===n.format&&(n.format=this.getTypeInfo("f32")),0===i.length){const r=new Array(s[2]).fill(0);return new oa(r,n).getSubData(this,e.postfix,t)}return i.length!==s[2]?null:new oa(i,n).getSubData(this,e.postfix,t)}}Oa._breakObj=new ea(new xi("BREAK",null),null),Oa._continueObj=new ea(new xi("CONTINUE",null),null),Oa._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Fa{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class Da{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new Fa,this._exec=new Oa,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const e=this._global_decl_or_directive();if(!e)break;t.push(e)}if(this._deferArrayCountEval.length>0){for(const e of this._deferArrayCountEval){const t=e.arrayType,r=e.countNode;if(r instanceof Bo){const e=r.name,s=this._context.constants.get(e);if(s)try{const e=s.constEvaluate(this._exec);t.count=e}catch(n){}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const r of t)r.search(e=>{e instanceof Qo||e instanceof Po?e.type=this._forwardType(e.type):e instanceof Mo?e.format=this._forwardType(e.format):e instanceof so||e instanceof oo||e instanceof ao?e.type=this._forwardType(e.type):e instanceof Ji?e.returnType=this._forwardType(e.returnType):e instanceof Ko&&(e.type=this._forwardType(e.type))});return t}_forwardType(e){if(e instanceof Co){const t=this._getType(e.name);if(t)return t}else e instanceof Po?e.type=this._forwardType(e.type):e instanceof Mo&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if("string"==typeof e){const t=new da(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=null!=t?t:this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==ua.eof}_match(e){if(e instanceof ca)return!!this._check(e)&&(this._advance(),!0);for(let t=0,n=e.length;t<n;++t){const n=e[t];if(this._check(n))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const n=t.type;let r=!1;for(const t of e){if(n===t)return!0;t===ua.tokens.name&&(r=!0)}if(r){const e=ua.tokens.name.rule.exec(t.lexeme);if(e&&0==e.index&&e[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===ua.tokens.name){const e=ua.tokens.name.rule.exec(t.lexeme);return e&&0==e.index&&e[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=null!==(t=null===(e=this._peek())||void 0===e?void 0:e.line)&&void 0!==t?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(ua.tokens.semicolon)&&!this._isAtEnd(););if(this._match(ua.keywords.alias)){const e=this._type_alias();return this._consume(ua.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(ua.keywords.diagnostic)){const e=this._diagnostic();return this._consume(ua.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(ua.keywords.requires)){const e=this._requires_directive();return this._consume(ua.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(ua.keywords.enable)){const e=this._enable_directive();return this._consume(ua.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}const e=this._attribute();if(this._check(ua.keywords.var)){const t=this._global_variable_decl();return null!=t&&(t.attributes=e),this._consume(ua.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(ua.keywords.override)){const t=this._override_variable_decl();return null!=t&&(t.attributes=e),this._consume(ua.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(ua.keywords.let)){const t=this._global_let_decl();return null!=t&&(t.attributes=e),this._consume(ua.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(ua.keywords.const)){const t=this._global_const_decl();return null!=t&&(t.attributes=e),this._consume(ua.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(ua.keywords.struct)){const t=this._struct_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(ua.keywords.fn)){const t=this._function_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(ua.keywords.fn))return null;const e=this._currentLine,t=this._consume(ua.tokens.ident,"Expected function name.").toString();this._consume(ua.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(ua.tokens.paren_right))do{if(this._check(ua.tokens.paren_right))break;const e=this._attribute(),t=this._consume(ua.tokens.name,"Expected argument name.").toString();this._consume(ua.tokens.colon,"Expected ':' for argument type.");const r=this._attribute(),s=this._type_decl();null!=s&&(s.attributes=r,n.push(this._updateNode(new Ko(t,s,e))))}while(this._match(ua.tokens.comma));this._consume(ua.tokens.paren_right,"Expected ')' after function arguments.");let r=null;if(this._match(ua.tokens.arrow)){const e=this._attribute();r=this._type_decl(),null!=r&&(r.attributes=e)}const s=this._compound_statement(),i=this._currentLine;return this._updateNode(new Ji(t,n,r,s,e,i),e)}_compound_statement(){const e=[];for(this._consume(ua.tokens.brace_left,"Expected '{' for block.");!this._check(ua.tokens.brace_right);){const t=this._statement();null!==t&&e.push(t)}return this._consume(ua.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(ua.tokens.semicolon)&&!this._isAtEnd(););if(this._check(ua.tokens.attr)&&this._attribute(),this._check(ua.keywords.if))return this._if_statement();if(this._check(ua.keywords.switch))return this._switch_statement();if(this._check(ua.keywords.loop))return this._loop_statement();if(this._check(ua.keywords.for))return this._for_statement();if(this._check(ua.keywords.while))return this._while_statement();if(this._check(ua.keywords.continuing))return this._continuing_statement();if(this._check(ua.keywords.static_assert))return this._static_assert_statement();if(this._check(ua.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(ua.keywords.return))e=this._return_statement();else if(this._check([ua.keywords.var,ua.keywords.let,ua.keywords.const]))e=this._variable_statement();else if(this._match(ua.keywords.discard))e=this._updateNode(new To);else if(this._match(ua.keywords.break)){const t=this._updateNode(new So);if(this._currentLoop.length>0){const e=this._currentLoop[this._currentLoop.length-1];t.loopId=e.id}e=t,this._check(ua.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(ua.keywords.continue)){const t=this._updateNode(new Ao);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const e=this._currentLoop[this._currentLoop.length-1];t.loopId=e.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return null!=e&&this._consume(ua.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(ua.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new eo(t),e)}_while_statement(){if(!this._match(ua.keywords.while))return null;const e=this._updateNode(new to(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(ua.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(ua.keywords.continuing))return null;const t=this._currentLine,n=this._compound_statement();return this._updateNode(new no(n,e),t)}_for_statement(){if(!this._match(ua.keywords.for))return null;this._consume(ua.tokens.paren_left,"Expected '('.");const e=this._updateNode(new ro(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(ua.tokens.semicolon)?null:this._for_init(),this._consume(ua.tokens.semicolon,"Expected ';'."),e.condition=this._check(ua.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(ua.tokens.semicolon,"Expected ';'."),e.increment=this._check(ua.tokens.paren_right)?null:this._for_increment(),this._consume(ua.tokens.paren_right,"Expected ')'."),this._check(ua.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(ua.keywords.var)){const e=this._variable_decl();if(null===e)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(ua.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new so(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(ua.keywords.let)){const e=this._currentLine,t=this._consume(ua.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(ua.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}this._consume(ua.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return this._updateNode(new oo(t,n,null,null,r),e)}if(this._match(ua.keywords.const)){const e=this._currentLine,t=this._consume(ua.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(ua.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}this._consume(ua.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return null===n&&r instanceof jo&&(n=r.type),this._updateNode(new ao(t,n,null,null,r),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(null==t)return null;if(!this._check(ua.increment_operators))return this._current=e,null;const n=this._consume(ua.increment_operators,"Expected increment operator");return this._updateNode(new fo(n.type===ua.tokens.plus_plus?lo.increment:lo.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(ua.tokens.brace_right))return null;let n=this._match(ua.tokens.underscore);if(n||(e=this._unary_expression()),!n&&null==e)return null;const r=this._consume(ua.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return this._updateNode(new po(co.parse(r.lexeme),e,s),t)}_func_call_statement(){if(!this._check(ua.tokens.ident))return null;const e=this._currentLine,t=this._current,n=this._consume(ua.tokens.ident,"Expected function name."),r=this._argument_expression_list();return null===r?(this._current=t,null):this._updateNode(new go(n.lexeme,r),e)}_loop_statement(){if(!this._match(ua.keywords.loop))return null;this._check(ua.tokens.attr)&&this._attribute(),this._consume(ua.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new mo([],null));this._currentLoop.push(e);let t=this._statement();for(;null!==t;){if(Array.isArray(t))for(let n of t)e.body.push(n);else e.body.push(t);if(t instanceof no){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(ua.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(ua.keywords.switch))return null;const e=this._updateNode(new _o(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(ua.tokens.attr)&&this._attribute(),this._consume(ua.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),null==e.cases||0==e.cases.length)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(ua.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([ua.keywords.default,ua.keywords.case]);){if(this._match(ua.keywords.case)){const n=this._case_selectors();for(const e of n)if(e instanceof Xo){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(ua.tokens.colon),this._check(ua.tokens.attr)&&this._attribute(),this._consume(ua.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(ua.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new qo(n,r)))}if(this._match(ua.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(ua.tokens.colon),this._check(ua.tokens.attr)&&this._attribute(),this._consume(ua.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(ua.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new Yo(n)))}}return e}_case_selectors(){const e=[];for(this._match(ua.keywords.default)?e.push(this._updateNode(new Xo)):e.push(this._shift_expression());this._match(ua.tokens.comma);)this._match(ua.keywords.default)?e.push(this._updateNode(new Xo)):e.push(this._shift_expression());return e}_case_body(){if(this._match(ua.keywords.fallthrough))return this._consume(ua.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(null==e)return[];e instanceof Array||(e=[e]);const t=this._case_body();return 0==t.length?e:[...e,t[0]]}_if_statement(){if(!this._match(ua.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(ua.tokens.attr)&&this._attribute();const n=this._compound_statement();let r=[];this._match_elseif()&&(this._check(ua.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let s=null;return this._match(ua.keywords.else)&&(this._check(ua.tokens.attr)&&this._attribute(),s=this._compound_statement()),this._updateNode(new yo(t,n,r,s),e)}_match_elseif(){return this._tokens[this._current].type===ua.keywords.else&&this._tokens[this._current+1].type===ua.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new Zo(t,n))),this._match_elseif()&&(this._check(ua.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(ua.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new bo(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(ua.tokens.or_or);)e=this._updateNode(new Ho(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(ua.tokens.and_and);)e=this._updateNode(new Ho(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(ua.tokens.or);)e=this._updateNode(new Ho(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(ua.tokens.xor);)e=this._updateNode(new Ho(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(ua.tokens.and);)e=this._updateNode(new Ho(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([ua.tokens.equal_equal,ua.tokens.not_equal])?this._updateNode(new Ho(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([ua.tokens.less_than,ua.tokens.greater_than,ua.tokens.less_than_equal,ua.tokens.greater_than_equal]);)e=this._updateNode(new Ho(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([ua.tokens.shift_left,ua.tokens.shift_right]);)e=this._updateNode(new Ho(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([ua.tokens.plus,ua.tokens.minus]);)e=this._updateNode(new Ho(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([ua.tokens.star,ua.tokens.forward_slash,ua.tokens.modulo]);)e=this._updateNode(new Ho(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([ua.tokens.minus,ua.tokens.bang,ua.tokens.tilde,ua.tokens.star,ua.tokens.and])?this._updateNode(new Wo(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(ua.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(ua.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new Go(e)),n=this._postfix_expression();return n&&(t.postfix=n),t}if(this._match(ua.tokens.period)){const e=this._consume(ua.tokens.name,"Expected member name."),t=this._postfix_expression(),n=this._updateNode(new Oo(e.lexeme));return t&&(n.postfix=t),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(null!==t)return t;switch(e){case"void":return Ro.void;case"bool":return Ro.bool;case"i32":return Ro.i32;case"u32":return Ro.u32;case"f32":return Ro.f32;case"f16":return Ro.f16;case"vec2f":return Io.vec2f;case"vec3f":return Io.vec3f;case"vec4f":return Io.vec4f;case"vec2i":return Io.vec2i;case"vec3i":return Io.vec3i;case"vec4i":return Io.vec4i;case"vec2u":return Io.vec2u;case"vec3u":return Io.vec3u;case"vec4u":return Io.vec4u;case"vec2h":return Io.vec2h;case"vec3h":return Io.vec3h;case"vec4h":return Io.vec4h;case"mat2x2f":return Io.mat2x2f;case"mat2x3f":return Io.mat2x3f;case"mat2x4f":return Io.mat2x4f;case"mat3x2f":return Io.mat3x2f;case"mat3x3f":return Io.mat3x3f;case"mat3x4f":return Io.mat3x4f;case"mat4x2f":return Io.mat4x2f;case"mat4x3f":return Io.mat4x3f;case"mat4x4f":return Io.mat4x4f;case"mat2x2h":return Io.mat2x2h;case"mat2x3h":return Io.mat2x3h;case"mat2x4h":return Io.mat2x4h;case"mat3x2h":return Io.mat3x2h;case"mat3x3h":return Io.mat3x3h;case"mat3x4h":return Io.mat3x4h;case"mat4x2h":return Io.mat4x2h;case"mat4x3h":return Io.mat4x3h;case"mat4x4h":return Io.mat4x4h;case"mat2x2i":return Io.mat2x2i;case"mat2x3i":return Io.mat2x3i;case"mat2x4i":return Io.mat2x4i;case"mat3x2i":return Io.mat3x2i;case"mat3x3i":return Io.mat3x3i;case"mat3x4i":return Io.mat3x4i;case"mat4x2i":return Io.mat4x2i;case"mat4x3i":return Io.mat4x3i;case"mat4x4i":return Io.mat4x4i;case"mat2x2u":return Io.mat2x2u;case"mat2x3u":return Io.mat2x3u;case"mat2x4u":return Io.mat2x4u;case"mat3x2u":return Io.mat3x2u;case"mat3x3u":return Io.mat3x3u;case"mat3x4u":return Io.mat3x4u;case"mat4x2u":return Io.mat4x2u;case"mat4x3u":return Io.mat4x3u;case"mat4x4u":return Io.mat4x4u}return null}_validateTypeRange(e,t){if("i32"===t.name){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if("u32"===t.name&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(ua.tokens.ident)){const e=this._previous().toString();if(this._check(ua.tokens.paren_left)){const t=this._argument_expression_list(),n=this._getType(e);return null!==n?this._updateNode(new Fo(n,t)):this._updateNode(new Do(e,t))}if(this._context.constants.has(e)){const t=this._context.constants.get(e);return this._updateNode(new Uo(e,t.value))}return this._updateNode(new Bo(e))}if(this._match(ua.tokens.int_literal)){const e=this._previous().toString();let t=e.endsWith("i")||e.endsWith("i")?Ro.i32:e.endsWith("u")||e.endsWith("U")?Ro.u32:Ro.x32;const n=parseInt(e);return this._validateTypeRange(n,t),this._updateNode(new jo(new ra(n,this._exec.getTypeInfo(t)),t))}if(this._match(ua.tokens.uint_literal)){const e=parseInt(this._previous().toString());return this._validateTypeRange(e,Ro.u32),this._updateNode(new jo(new ra(e,this._exec.getTypeInfo(Ro.u32)),Ro.u32))}if(this._match([ua.tokens.decimal_float_literal,ua.tokens.hex_float_literal])){let e=this._previous().toString(),t=e.endsWith("h");t&&(e=e.substring(0,e.length-1));const n=parseFloat(e);this._validateTypeRange(n,t?Ro.f16:Ro.f32);const r=t?Ro.f16:Ro.f32;return this._updateNode(new jo(new ra(n,this._exec.getTypeInfo(r)),r))}if(this._match([ua.keywords.true,ua.keywords.false])){let e=this._previous().toString()===ua.keywords.true.rule;return this._updateNode(new jo(new ra(e?1:0,this._exec.getTypeInfo(Ro.bool)),Ro.bool))}if(this._check(ua.tokens.paren_left))return this._paren_expression();if(this._match(ua.keywords.bitcast)){this._consume(ua.tokens.less_than,"Expected '<'.");const e=this._type_decl();this._consume(ua.tokens.greater_than,"Expected '>'.");const t=this._paren_expression();return this._updateNode(new Vo(e,t))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new Fo(e,t))}_argument_expression_list(){if(!this._match(ua.tokens.paren_left))return null;const e=[];do{if(this._check(ua.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(ua.tokens.comma));return this._consume(ua.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(ua.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(ua.tokens.paren_right),e}_paren_expression(){this._consume(ua.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(ua.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(ua.keywords.struct))return null;const e=this._currentLine,t=this._consume(ua.tokens.ident,"Expected name for struct.").toString();this._consume(ua.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(ua.tokens.brace_right);){const e=this._attribute(),t=this._consume(ua.tokens.name,"Expected variable name.").toString();this._consume(ua.tokens.colon,"Expected ':' for struct member type.");const r=this._attribute(),s=this._type_decl();null!=s&&(s.attributes=r),this._check(ua.tokens.brace_right)?this._match(ua.tokens.comma):this._consume(ua.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new Qo(t,s,e)))}this._consume(ua.tokens.brace_right,"Expected '}' after struct body.");const r=this._currentLine,s=this._updateNode(new ko(t,n,e,r),e);return this._context.structs.set(t,s),s}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(ua.tokens.equal)){const t=this._const_expression();e.value=t}if(null!==e.type&&e.value instanceof jo){if("x32"!==e.value.type.name&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else null===e.type&&e.value instanceof jo&&(e.type="x32"===e.value.type.name?Ro.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(ua.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(ua.keywords.const))return null;const t=this._consume(ua.tokens.name,"Expected variable name"),n=this._currentLine;let r=null;if(this._match(ua.tokens.colon)){const e=this._attribute();r=this._type_decl(),null!=r&&(r.attributes=e)}let s=null;this._consume(ua.tokens.equal,"const declarations require an assignment");const i=this._short_circuit_or_expression();try{let e=[Ro.f32],n=i.constEvaluate(this._exec,e);n instanceof ra&&this._validateTypeRange(n.value,e[0]),e[0]instanceof Io&&null===e[0].format&&n.typeInfo instanceof Ai&&null!==n.typeInfo.format&&("f16"===n.typeInfo.format.name?e[0].format=Ro.f16:"f32"===n.typeInfo.format.name?e[0].format=Ro.f32:"i32"===n.typeInfo.format.name?e[0].format=Ro.i32:"u32"===n.typeInfo.format.name?e[0].format=Ro.u32:"bool"===n.typeInfo.format.name&&(e[0].format=Ro.bool)),s=this._updateNode(new jo(n,e[0])),this._exec.context.setVariable(t.toString(),n)}catch(a){s=i}if(null!==r&&s instanceof jo){if("x32"!==s.type.name&&r.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${r.name}. Line:${this._currentLine}`);s.type=r,s.isScalar&&this._validateTypeRange(s.scalarValue,s.type)}else null===r&&s instanceof jo&&(r=null!==(e=null==s?void 0:s.type)&&void 0!==e?e:Ro.f32,r===Ro.x32&&(r=Ro.i32));const o=this._updateNode(new ao(t.toString(),r,"","",s),n);return this._context.constants.set(o.name,o),o}_global_let_decl(){if(!this._match(ua.keywords.let))return null;const e=this._currentLine,t=this._consume(ua.tokens.name,"Expected variable name");let n=null;if(this._match(ua.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}let r=null;if(this._match(ua.tokens.equal)&&(r=this._const_expression()),null!==n&&r instanceof jo){if("x32"!==r.type.name&&n.getTypeName()!==r.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${r.type.name} to ${n.name}. Line:${this._currentLine}`);r.type=n}else null===n&&r instanceof jo&&(n="x32"===r.type.name?Ro.i32:r.type);return r instanceof jo&&r.isScalar&&this._validateTypeRange(r.scalarValue,n),this._updateNode(new oo(t.toString(),n,"","",r),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(ua.keywords.var))return null;const e=this._currentLine;let t="",n="";this._match(ua.tokens.less_than)&&(t=this._consume(ua.storage_class,"Expected storage_class.").toString(),this._match(ua.tokens.comma)&&(n=this._consume(ua.access_mode,"Expected access_mode.").toString()),this._consume(ua.tokens.greater_than,"Expected '>'."));const r=this._consume(ua.tokens.name,"Expected variable name");let s=null;if(this._match(ua.tokens.colon)){const e=this._attribute();s=this._type_decl(),null!=s&&(s.attributes=e)}return this._updateNode(new so(r.toString(),s,t,n,null),e)}_override_decl(){if(!this._match(ua.keywords.override))return null;const e=this._consume(ua.tokens.name,"Expected variable name");let t=null;if(this._match(ua.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}return this._updateNode(new io(e.toString(),t,null))}_diagnostic(){this._consume(ua.tokens.paren_left,"Expected '('");const e=this._consume(ua.tokens.ident,"Expected severity control name.");this._consume(ua.tokens.comma,"Expected ','");let t=this._consume(ua.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(ua.tokens.period)&&(t+=`.${this._consume(ua.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(ua.tokens.paren_right,"Expected ')'"),this._updateNode(new wo(e.toString(),t))}_enable_directive(){const e=this._consume(ua.tokens.ident,"identity expected.");return this._updateNode(new vo(e.toString()))}_requires_directive(){const e=[this._consume(ua.tokens.ident,"identity expected.").toString()];for(;this._match(ua.tokens.comma);){const t=this._consume(ua.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new xo(e))}_type_alias(){const e=this._consume(ua.tokens.ident,"identity expected.");this._consume(ua.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(null===t)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=this._updateNode(new Eo(e.toString(),t));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([ua.tokens.ident,...ua.texel_format,ua.keywords.bool,ua.keywords.f32,ua.keywords.i32,ua.keywords.u32])){const e=this._advance().toString();if(this._context.structs.has(e))return this._context.structs.get(e);if(this._context.aliases.has(e))return this._context.aliases.get(e).type;if(!this._getType(e)){const t=this._updateNode(new Co(e));return this._forwardTypeCount++,t}return this._updateNode(new Ro(e))}let e=this._texture_sampler_types();if(e)return e;if(this._check(ua.template_types)){let e=this._advance().toString(),t=null,n=null;return this._match(ua.tokens.less_than)&&(t=this._type_decl(),n=null,this._match(ua.tokens.comma)&&(n=this._consume(ua.access_mode,"Expected access_mode for pointer").toString()),this._consume(ua.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new Io(e,t,n))}if(this._match(ua.keywords.ptr)){let e=this._previous().toString();this._consume(ua.tokens.less_than,"Expected '<' for pointer.");const t=this._consume(ua.storage_class,"Expected storage_class for pointer");this._consume(ua.tokens.comma,"Expected ',' for pointer.");const n=this._type_decl();let r=null;return this._match(ua.tokens.comma)&&(r=this._consume(ua.access_mode,"Expected access_mode for pointer").toString()),this._consume(ua.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Po(e,t.toString(),n,r))}const t=this._attribute();if(this._match(ua.keywords.array)){let e=null,r=-1;const s=this._previous();let i=null;if(this._match(ua.tokens.less_than)){e=this._type_decl(),this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);let t="";if(this._match(ua.tokens.comma)){i=this._shift_expression();try{t=i.constEvaluate(this._exec).toString(),i=null}catch(n){t="1"}}this._consume(ua.tokens.greater_than,"Expected '>' for array."),r=t?parseInt(t):0}const o=this._updateNode(new Mo(s.toString(),t,e,r));return i&&this._deferArrayCountEval.push({arrayType:o,countNode:i}),o}return null}_texture_sampler_types(){if(this._match(ua.sampler_type))return this._updateNode(new No(this._previous().toString(),null,null));if(this._match(ua.depth_texture_type))return this._updateNode(new No(this._previous().toString(),null,null));if(this._match(ua.sampled_texture_type)||this._match(ua.multisampled_texture_type)){const e=this._previous();this._consume(ua.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(ua.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new No(e.toString(),t,null))}if(this._match(ua.storage_texture_type)){const e=this._previous();this._consume(ua.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(ua.texel_format,"Invalid texel format.").toString();this._consume(ua.tokens.comma,"Expected ',' after texel format.");const n=this._consume(ua.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(ua.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new No(e.toString(),t,n))}return null}_attribute(){let e=[];for(;this._match(ua.tokens.attr);){const t=this._consume(ua.attribute_name,"Expected attribute name"),n=this._updateNode(new Jo(t.toString(),null));if(this._match(ua.tokens.paren_left)){if(n.value=this._consume(ua.literal_or_ident,"Expected attribute value").toString(),this._check(ua.tokens.comma)){this._advance();do{const e=this._consume(ua.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(e)}while(this._match(ua.tokens.comma))}this._consume(ua.tokens.paren_right,"Expected ')'")}e.push(n)}return 0==e.length?null:e}}class Ba extends Aa{constructor(e){super(),e&&this.update(e)}update(e){const t=(new Da).parse(e);this.updateAST(t)}}function Ua(e){return(null==e?void 0:e.format)?`${e.name}<${e.format.name}>`:e.name}globalThis.mathgl=globalThis.mathgl||{config:{EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1}};const ja=globalThis.mathgl.config;function Va(e,{precision:t=ja.precision}={}){return e=function(e){return Math.round(e/ja.EPSILON)*ja.EPSILON}(e),`${parseFloat(e.toPrecision(t))}`}function Ga(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function za(e,t,n){return function(e,t,n){if(Ga(e)){const r=e;n=n||function(e){return e.clone?e.clone():new Array(e.length)}(r);for(let s=0;s<n.length&&s<r.length;++s){const r="number"==typeof e?e:e[s];n[s]=t(r)}return n}return t(e)}(e,e=>Math.max(t,Math.min(n,e)))}function Wa(e,t,n){return Ga(e)?e.map((e,r)=>Wa(e,t[r],n)):n*t+(1-n)*e}function Ha(e,t,n){const r=ja.EPSILON;try{if(e===t)return!0;if(Ga(e)&&Ga(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Ha(e[n],t[n]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):"number"==typeof e&&"number"==typeof t&&Math.abs(e-t)<=ja.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))}finally{ja.EPSILON=r}}class $a extends Array{clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(e=[],t=0){for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Ga(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ja)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+Va(this[n],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Ha(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(void 0===n)return this.lerp(this,e,t);for(let r=0;r<this.ELEMENTS;++r){const s=e[r],i="number"==typeof t?t:t[r];this[r]=s+n*(i-s)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]+=t[e];return this.check()}subtract(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]-=t[e];return this.check()}scale(e){if("number"==typeof e)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(ja.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}}function Xa(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function qa(e,t,n=""){if(ja.debug&&!function(e,t){if(e.length!==t)return!1;for(let n=0;n<e.length;++n)if(!Number.isFinite(e[n]))return!1;return!0}(e,t))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return e}function Ya(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}class Ka extends $a{get x(){return this[0]}set x(e){this[0]=Xa(e)}get y(){return this[1]}set y(e){this[1]=Xa(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const r=this[n]-e[n];t+=r*r}return Xa(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return Xa(t)}normalize(){const e=this.magnitude();if(0!==e)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t[e];return this.check()}divide(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t[e];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Ya(e>=0&&e<this.ELEMENTS,"index is out of range"),Xa(this[e])}setComponent(e,t){return Ya(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const Za=1e-6;let Qa="undefined"!=typeof Float32Array?Float32Array:Array;function Ja(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function el(e,t,n,r){const s=t[0],i=t[1];return e[0]=s+r*(n[0]-s),e[1]=i+r*(n[1]-i),e}function tl(e,t,n){const r=t[0],s=t[1],i=t[2],o=n[3]*r+n[7]*s+n[11]*i||1;return e[0]=(n[0]*r+n[4]*s+n[8]*i)/o,e[1]=(n[1]*r+n[5]*s+n[9]*i)/o,e[2]=(n[2]*r+n[6]*s+n[10]*i)/o,e}function nl(e,t,n){const r=t[0],s=t[1],i=t[2];let o=n[3]*r+n[7]*s+n[11]*i+n[15];return o=o||1,e[0]=(n[0]*r+n[4]*s+n[8]*i+n[12])/o,e[1]=(n[1]*r+n[5]*s+n[9]*i+n[13])/o,e[2]=(n[2]*r+n[6]*s+n[10]*i+n[14])/o,e}!function(){const e=new Qa(2);Qa!=Float32Array&&(e[0]=0,e[1]=0)}();const rl=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},sl=function(e){const t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r};!function(){const e=new Qa(3);Qa!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0)}();const il=[0,0,0];let ol;class al extends Ka{static get ZERO(){return ol||(ol=new al(0,0,0),Object.freeze(ol)),ol}constructor(e=0,t=0,n=0){super(-0,-0,-0),1===arguments.length&&Ga(e)?this.copy(e):(ja.debug&&(Xa(e),Xa(t),Xa(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return ja.debug&&(Xa(e.x),Xa(e.y),Xa(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Xa(e)}angle(e){return function(e,t){const n=e[0],r=e[1],s=e[2],i=t[0],o=t[1],a=t[2],l=Math.sqrt((n*n+r*r+s*s)*(i*i+o*o+a*a)),c=l&&function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))}(this,e)}cross(e){return function(e,t,n){const r=t[0],s=t[1],i=t[2],o=n[0],a=n[1],l=n[2];e[0]=s*l-i*a,e[1]=i*o-r*l,e[2]=r*a-s*o}(this,this,e),this.check()}rotateX({radians:e,origin:t=il}){return function(e,t,n,r){const s=[],i=[];s[0]=t[0]-n[0],s[1]=t[1]-n[1],s[2]=t[2]-n[2],i[0]=s[0],i[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),i[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2]}(this,this,t,e),this.check()}rotateY({radians:e,origin:t=il}){return function(e,t,n,r){const s=[],i=[];s[0]=t[0]-n[0],s[1]=t[1]-n[1],s[2]=t[2]-n[2],i[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),i[1]=s[1],i[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2]}(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=il}){return function(e,t,n,r){const s=[],i=[];s[0]=t[0]-n[0],s[1]=t[1]-n[1],s[2]=t[2]-n[2],i[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),i[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),i[2]=s[2],e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2]}(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return nl(this,this,e),this.check()}transformAsVector(e){return tl(this,this,e),this.check()}transformByMatrix3(e){return function(e,t,n){const r=t[0],s=t[1],i=t[2];e[0]=r*n[0]+s*n[3]+i*n[6],e[1]=r*n[1]+s*n[4]+i*n[7],e[2]=r*n[2]+s*n[5]+i*n[8]}(this,this,e),this.check()}transformByMatrix2(e){return function(e,t,n){const r=t[0],s=t[1];e[0]=n[0]*r+n[2]*s,e[1]=n[1]*r+n[3]*s,e[2]=t[2]}(this,this,e),this.check()}transformByQuaternion(e){return function(e,t,n){const r=n[0],s=n[1],i=n[2],o=n[3],a=t[0],l=t[1],c=t[2];let u=s*c-i*l,h=i*a-r*c,d=r*l-s*a,f=s*d-i*h,p=i*u-r*d,g=r*h-s*u;const m=2*o;u*=m,h*=m,d*=m,f*=2,p*=2,g*=2,e[0]=a+u+f,e[1]=l+h+p,e[2]=c+d+g}(this,this,e),this.check()}}class ll extends $a{toString(){let e="[";if(ja.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=Xa(n),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let r=0;r<this.RANK;++r)t[r]=this[n+r];return t}setColumn(e,t){const n=e*this.RANK;for(let r=0;r<this.RANK;++r)this[n+r]=t[r];return this}}function cl(e,t){const n=t[0],r=t[1],s=t[2],i=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11],p=t[12],g=t[13],m=t[14],_=t[15],y=n*a-r*o,b=n*l-s*o,v=n*c-i*o,x=r*l-s*a,w=r*c-i*a,E=s*c-i*l,T=u*g-h*p,S=u*m-d*p,A=u*_-f*p,R=h*m-d*g,C=h*_-f*g,k=d*_-f*m;let I=y*k-b*C+v*R+x*A-w*S+E*T;return I?(I=1/I,e[0]=(a*k-l*C+c*R)*I,e[1]=(s*C-r*k-i*R)*I,e[2]=(g*E-m*w+_*x)*I,e[3]=(d*w-h*E-f*x)*I,e[4]=(l*A-o*k-c*S)*I,e[5]=(n*k-s*A+i*S)*I,e[6]=(m*v-p*E-_*b)*I,e[7]=(u*E-d*v+f*b)*I,e[8]=(o*C-a*A+c*T)*I,e[9]=(r*A-n*C-i*T)*I,e[10]=(p*w-g*v+_*y)*I,e[11]=(h*v-u*w-f*y)*I,e[12]=(a*S-o*R-l*T)*I,e[13]=(n*R-r*S+s*T)*I,e[14]=(g*b-p*x-m*y)*I,e[15]=(u*x-h*b+d*y)*I,e):null}function ul(e,t,n){const r=t[0],s=t[1],i=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],g=t[12],m=t[13],_=t[14],y=t[15];let b=n[0],v=n[1],x=n[2],w=n[3];return e[0]=b*r+v*a+x*h+w*g,e[1]=b*s+v*l+x*d+w*m,e[2]=b*i+v*c+x*f+w*_,e[3]=b*o+v*u+x*p+w*y,b=n[4],v=n[5],x=n[6],w=n[7],e[4]=b*r+v*a+x*h+w*g,e[5]=b*s+v*l+x*d+w*m,e[6]=b*i+v*c+x*f+w*_,e[7]=b*o+v*u+x*p+w*y,b=n[8],v=n[9],x=n[10],w=n[11],e[8]=b*r+v*a+x*h+w*g,e[9]=b*s+v*l+x*d+w*m,e[10]=b*i+v*c+x*f+w*_,e[11]=b*o+v*u+x*p+w*y,b=n[12],v=n[13],x=n[14],w=n[15],e[12]=b*r+v*a+x*h+w*g,e[13]=b*s+v*l+x*d+w*m,e[14]=b*i+v*c+x*f+w*_,e[15]=b*o+v*u+x*p+w*y,e}function hl(e,t,n){const r=n[0],s=n[1],i=n[2];let o,a,l,c,u,h,d,f,p,g,m,_;return t===e?(e[12]=t[0]*r+t[4]*s+t[8]*i+t[12],e[13]=t[1]*r+t[5]*s+t[9]*i+t[13],e[14]=t[2]*r+t[6]*s+t[10]*i+t[14],e[15]=t[3]*r+t[7]*s+t[11]*i+t[15]):(o=t[0],a=t[1],l=t[2],c=t[3],u=t[4],h=t[5],d=t[6],f=t[7],p=t[8],g=t[9],m=t[10],_=t[11],e[0]=o,e[1]=a,e[2]=l,e[3]=c,e[4]=u,e[5]=h,e[6]=d,e[7]=f,e[8]=p,e[9]=g,e[10]=m,e[11]=_,e[12]=o*r+u*s+p*i+t[12],e[13]=a*r+h*s+g*i+t[13],e[14]=l*r+d*s+m*i+t[14],e[15]=c*r+f*s+_*i+t[15]),e}function dl(e,t,n){const r=n[0],s=n[1],i=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function fl(e,t,n){const r=Math.sin(n),s=Math.cos(n),i=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*s+c*r,e[5]=o*s+u*r,e[6]=a*s+h*r,e[7]=l*s+d*r,e[8]=c*s-i*r,e[9]=u*s-o*r,e[10]=h*s-a*r,e[11]=d*s-l*r,e}function pl(e,t,n){const r=Math.sin(n),s=Math.cos(n),i=t[0],o=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*s+c*r,e[1]=o*s+u*r,e[2]=a*s+h*r,e[3]=l*s+d*r,e[4]=c*s-i*r,e[5]=u*s-o*r,e[6]=h*s-a*r,e[7]=d*s-l*r,e}function gl(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function ml(e,t,n){const r=t[0],s=t[1],i=t[2],o=t[3];return e[0]=n[0]*r+n[4]*s+n[8]*i+n[12]*o,e[1]=n[1]*r+n[5]*s+n[9]*i+n[13]*o,e[2]=n[2]*r+n[6]*s+n[10]*i+n[14]*o,e[3]=n[3]*r+n[7]*s+n[11]*i+n[15]*o,e}var _l,yl;!function(){const e=new Qa(4);Qa!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}(),(yl=_l||(_l={}))[yl.COL0ROW0=0]="COL0ROW0",yl[yl.COL0ROW1=1]="COL0ROW1",yl[yl.COL0ROW2=2]="COL0ROW2",yl[yl.COL0ROW3=3]="COL0ROW3",yl[yl.COL1ROW0=4]="COL1ROW0",yl[yl.COL1ROW1=5]="COL1ROW1",yl[yl.COL1ROW2=6]="COL1ROW2",yl[yl.COL1ROW3=7]="COL1ROW3",yl[yl.COL2ROW0=8]="COL2ROW0",yl[yl.COL2ROW1=9]="COL2ROW1",yl[yl.COL2ROW2=10]="COL2ROW2",yl[yl.COL2ROW3=11]="COL2ROW3",yl[yl.COL3ROW0=12]="COL3ROW0",yl[yl.COL3ROW1=13]="COL3ROW1",yl[yl.COL3ROW2=14]="COL3ROW2",yl[yl.COL3ROW3=15]="COL3ROW3";const bl=45*Math.PI/180,vl=1,xl=.1,wl=500,El=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Tl extends ll{static get IDENTITY(){return Al||(Al=new Tl,Object.freeze(Al)),Al}static get ZERO(){return Sl||(Sl=new Tl([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Sl)),Sl}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return _l}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,r,s,i,o,a,l,c,u,h,d,f,p,g){return this[0]=e,this[1]=t,this[2]=n,this[3]=r,this[4]=s,this[5]=i,this[6]=o,this[7]=a,this[8]=l,this[9]=c,this[10]=u,this[11]=h,this[12]=d,this[13]=f,this[14]=p,this[15]=g,this.check()}setRowMajor(e,t,n,r,s,i,o,a,l,c,u,h,d,f,p,g){return this[0]=e,this[1]=s,this[2]=l,this[3]=d,this[4]=t,this[5]=i,this[6]=c,this[7]=f,this[8]=n,this[9]=o,this[10]=u,this[11]=p,this[12]=r,this[13]=a,this[14]=h,this[15]=g,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(El)}fromObject(e){return this.check()}fromQuaternion(e){return function(e,t){const n=t[0],r=t[1],s=t[2],i=t[3],o=n+n,a=r+r,l=s+s,c=n*o,u=r*o,h=r*a,d=s*o,f=s*a,p=s*l,g=i*o,m=i*a,_=i*l;e[0]=1-h-p,e[1]=u+_,e[2]=d-m,e[3]=0,e[4]=u-_,e[5]=1-c-p,e[6]=f+g,e[7]=0,e[8]=d+m,e[9]=f-g,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(this,e),this.check()}frustum(e){const{left:t,right:n,bottom:r,top:s,near:i=xl,far:o=wl}=e;return o===1/0?function(e,t,n,r,s,i){const o=2*i/(n-t),a=2*i/(s-r),l=(n+t)/(n-t),c=(s+r)/(s-r),u=-2*i;e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=l,e[9]=c,e[10]=-1,e[11]=-1,e[12]=0,e[13]=0,e[14]=u,e[15]=0}(this,t,n,r,s,i):function(e,t,n,r,s,i,o){const a=1/(n-t),l=1/(s-r),c=1/(i-o);e[0]=2*i*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*i*l,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(s+r)*l,e[10]=(o+i)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*i*2*c,e[15]=0}(this,t,n,r,s,i,o),this.check()}lookAt(e){const{eye:t,center:n=[0,0,0],up:r=[0,1,0]}=e;return function(e,t,n,r){let s,i,o,a,l,c,u,h,d,f;const p=t[0],g=t[1],m=t[2],_=r[0],y=r[1],b=r[2],v=n[0],x=n[1],w=n[2];Math.abs(p-v)<Za&&Math.abs(g-x)<Za&&Math.abs(m-w)<Za?function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(e):(h=p-v,d=g-x,f=m-w,s=1/Math.sqrt(h*h+d*d+f*f),h*=s,d*=s,f*=s,i=y*f-b*d,o=b*h-_*f,a=_*d-y*h,s=Math.sqrt(i*i+o*o+a*a),s?(s=1/s,i*=s,o*=s,a*=s):(i=0,o=0,a=0),l=d*a-f*o,c=f*i-h*a,u=h*o-d*i,s=Math.sqrt(l*l+c*c+u*u),s?(s=1/s,l*=s,c*=s,u*=s):(l=0,c=0,u=0),e[0]=i,e[1]=l,e[2]=h,e[3]=0,e[4]=o,e[5]=c,e[6]=d,e[7]=0,e[8]=a,e[9]=u,e[10]=f,e[11]=0,e[12]=-(i*p+o*g+a*m),e[13]=-(l*p+c*g+u*m),e[14]=-(h*p+d*g+f*m),e[15]=1)}(this,t,n,r),this.check()}ortho(e){const{left:t,right:n,bottom:r,top:s,near:i=xl,far:o=wl}=e;return function(e,t,n,r,s,i,o){const a=1/(t-n),l=1/(r-s),c=1/(i-o);e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(s+r)*l,e[14]=(o+i)*c,e[15]=1}(this,t,n,r,s,i,o),this.check()}orthographic(e){const{fovy:t=bl,aspect:n=vl,focalDistance:r=1,near:s=xl,far:i=wl}=e;Rl(t);const o=t/2,a=r*Math.tan(o),l=a*n;return this.ortho({left:-l,right:l,bottom:-a,top:a,near:s,far:i})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:n=1,near:r=.1,far:s=500}=e;return Rl(t),function(e,t,n,r,s){const i=1/Math.tan(t/2);if(e[0]=i/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=s&&s!==1/0){const t=1/(r-s);e[10]=(s+r)*t,e[14]=2*s*r*t}else e[10]=-1,e[14]=-2*r}(this,t,n,r,s),this.check()}determinant(){return function(e){const t=e[0],n=e[1],r=e[2],s=e[3],i=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],f=e[12],p=e[13],g=e[14],m=t*o-n*i,_=t*a-r*i,y=n*a-r*o,b=c*p-u*f,v=c*g-h*f,x=u*g-h*p;return l*(t*x-n*v+r*b)-s*(i*x-o*v+a*b)+e[15]*(c*y-u*_+h*m)-d*(f*y-p*_+g*m)}(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),r=1/n[0],s=1/n[1],i=1/n[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*i,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*s,e[6]=this[6]*i,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*s,e[10]=this[10]*i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),r=1/n[0],s=1/n[1],i=1/n[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*i,e[3]=this[4]*r,e[4]=this[5]*s,e[5]=this[6]*i,e[6]=this[8]*r,e[7]=this[9]*s,e[8]=this[10]*i,e}transpose(){return function(e,t){if(e===t){const n=t[1],r=t[2],s=t[3],i=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=i,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15]}(this,this),this.check()}invert(){return cl(this,this),this.check()}multiplyLeft(e){return ul(this,e,this),this.check()}multiplyRight(e){return ul(this,this,e),this.check()}rotateX(e){return fl(this,this,e),this.check()}rotateY(e){return function(e,t,n){const r=Math.sin(n),s=Math.cos(n),i=t[0],o=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*s-c*r,e[1]=o*s-u*r,e[2]=a*s-h*r,e[3]=l*s-d*r,e[8]=i*r+c*s,e[9]=o*r+u*s,e[10]=a*r+h*s,e[11]=l*r+d*s}(this,this,e),this.check()}rotateZ(e){return pl(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return function(e,t,n,r){let s,i,o,a,l,c,u,h,d,f,p,g,m,_,y,b,v,x,w,E,T,S,A,R,C=r[0],k=r[1],I=r[2],P=Math.sqrt(C*C+k*k+I*I);P<Za||(P=1/P,C*=P,k*=P,I*=P,i=Math.sin(n),s=Math.cos(n),o=1-s,a=t[0],l=t[1],c=t[2],u=t[3],h=t[4],d=t[5],f=t[6],p=t[7],g=t[8],m=t[9],_=t[10],y=t[11],b=C*C*o+s,v=k*C*o+I*i,x=I*C*o-k*i,w=C*k*o-I*i,E=k*k*o+s,T=I*k*o+C*i,S=C*I*o+k*i,A=k*I*o-C*i,R=I*I*o+s,e[0]=a*b+h*v+g*x,e[1]=l*b+d*v+m*x,e[2]=c*b+f*v+_*x,e[3]=u*b+p*v+y*x,e[4]=a*w+h*E+g*T,e[5]=l*w+d*E+m*T,e[6]=c*w+f*E+_*T,e[7]=u*w+p*E+y*T,e[8]=a*S+h*A+g*R,e[9]=l*S+d*A+m*R,e[10]=c*S+f*A+_*R,e[11]=u*S+p*A+y*R,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}(this,this,e,t),this.check()}scale(e){return dl(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return hl(this,this,e),this.check()}transform(e,t){return 4===e.length?(qa(t=ml(t||[-0,-0,-0,-0],e,this),4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;let r;switch(n){case 2:r=function(e,t,n){const r=t[0],s=t[1];return e[0]=n[0]*r+n[4]*s+n[12],e[1]=n[1]*r+n[5]*s+n[13],e}(t||[-0,-0],e,this);break;case 3:r=nl(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return qa(r,e.length),r}transformAsVector(e,t){let n;switch(e.length){case 2:n=function(e,t,n){const r=t[0],s=t[1],i=n[3]*r+n[7]*s||1;return e[0]=(n[0]*r+n[4]*s)/i,e[1]=(n[1]*r+n[5]*s)/i,e}(t||[-0,-0],e,this);break;case 3:n=tl(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return qa(n,e.length),n}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}}let Sl,Al;function Rl(e){if(e>2*Math.PI)throw Error("expected radians")}function Cl(e,t=[],n=0){const r=Math.fround(e),s=e-r;return t[n]=r,t[n+1]=s,t}const kl={name:"fp64arithmetic",vs:"\nuniform fp64arithmeticUniforms {\n  uniform float ONE;\n} fp64;\n\n/*\nAbout LUMA_FP64_CODE_ELIMINATION_WORKAROUND\n\nThe purpose of this workaround is to prevent shader compilers from\noptimizing away necessary arithmetic operations by swapping their sequences\nor transform the equation to some 'equivalent' form.\n\nThe method is to multiply an artifical variable, ONE, which will be known to\nthe compiler to be 1 only at runtime. The whole expression is then represented\nas a polynomial with respective to ONE. In the coefficients of all terms, only one a\nand one b should appear\n\nerr = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE\n*/\n\n// Divide float number to high and low floats to extend fraction bits\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float a_hi = t * fp64.ONE - (t - a);\n  float a_lo = a * fp64.ONE - a_hi;\n#else\n  float a_hi = t - (t - a);\n  float a_lo = a - a_hi;\n#endif\n  return vec2(a_hi, a_lo);\n}\n\n// Divide float number again when high float uses too many fraction bits\nvec2 split2(vec2 a) {\n  vec2 b = split(a.x);\n  b.y += a.y;\n  return b;\n}\n\n// Special sum operation when a > b\nvec2 quickTwoSum(float a, float b) {\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float sum = (a + b) * fp64.ONE;\n  float err = b - (sum - a) * fp64.ONE;\n#else\n  float sum = a + b;\n  float err = b - (sum - a);\n#endif\n  return vec2(sum, err);\n}\n\n// General sum operation\nvec2 twoSum(float a, float b) {\n  float s = (a + b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * fp64.ONE - a) * fp64.ONE;\n  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) + (b - v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSub(float a, float b) {\n  float s = (a - b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * fp64.ONE - a) * fp64.ONE;\n  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) - (b + v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *\n    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;\n#else\n  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n#endif\n  return vec2(prod, err);\n}\n\nvec2 twoProd(float a, float b) {\n  float prod = a * b;\n  vec2 a_fp64 = split(a);\n  vec2 b_fp64 = split(b);\n  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\n    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\n  return vec2(prod, err);\n}\n\nvec2 sum_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSum(a.x, b.x);\n  t = twoSum(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 sub_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSub(a.x, b.x);\n  t = twoSub(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 mul_fp64(vec2 a, vec2 b) {\n  vec2 prod = twoProd(a.x, b.x);\n  // y component is for the error\n  prod.y += a.x * b.y;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  prod.y += a.y * b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  return prod;\n}\n\nvec2 div_fp64(vec2 a, vec2 b) {\n  float xn = 1.0 / b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  vec2 yn = mul_fp64(a, vec2(xn, 0));\n#else\n  vec2 yn = a * xn;\n#endif\n  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;\n  vec2 prod = twoProd(xn, diff);\n  return sum_fp64(yn, prod);\n}\n\nvec2 sqrt_fp64(vec2 a) {\n  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n\n  float x = 1.0 / sqrt(a.x);\n  float yn = a.x * x;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;\n#else\n  vec2 yn_sqr = twoSqr(yn);\n#endif\n  float diff = sub_fp64(a, yn_sqr).x;\n  vec2 prod = twoProd(x * 0.5, diff);\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  return sum_fp64(split(yn), prod);\n#else\n  return sum_fp64(vec2(yn, 0.0), prod);\n#endif\n}\n",defaultUniforms:{ONE:1},uniformTypes:{ONE:"f32"},fp64ify:Cl,fp64LowPart:function(e){return e-Math.fround(e)},fp64ifyMatrix4:function(e){const t=new Float32Array(32);for(let n=0;n<4;++n)for(let r=0;r<4;++r){const s=4*n+r;Cl(e[4*r+n],t,2*s)}return t}},Il={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:[0,1,1,1]},vs:"uniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nout vec4 picking_vRGBcolor_Avalid;\n\n// Normalize unsigned byte color to 0-1 range\nvec3 picking_normalizeColor(vec3 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\n// Normalize unsigned byte color to 0-1 range\nvec4 picking_normalizeColor(vec4 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\nbool picking_isColorZero(vec3 color) {\n  return dot(color, vec3(1.0)) < 0.00001;\n}\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.00001;\n}\n\n// Check if this vertex is highlighted \nbool isVertexHighlighted(vec3 vertexColor) {\n  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);\n  return\n    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));\n}\n\n// Set the current picking color\nvoid picking_setPickingColor(vec3 pickingColor) {\n  pickingColor = picking_normalizeColor(pickingColor);\n\n  if (bool(picking.isActive)) {\n    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    if (!bool(picking.isAttribute)) {\n      // Stores the picking color so that the fragment shader can render it during picking\n      picking_vRGBcolor_Avalid.rgb = pickingColor;\n    }\n  } else {\n    // Do the comparison with selected item color in vertex shader as it should mean fewer compares\n    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec2 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec3 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n",fs:"uniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nin vec4 picking_vRGBcolor_Avalid;\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 picking_filterHighlightColor(vec4 color) {\n  // If we are still picking, we don't highlight\n  if (picking.isActive > 0.5) {\n    return color;\n  }\n\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    // Blend in highlight color based on its alpha value\n    float highLightAlpha = picking.highlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 picking_filterPickingColor(vec4 color) {\n  if (bool(picking.isActive)) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 picking_filterColor(vec4 color) {\n  vec4 highlightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highlightColor);\n}\n",getUniforms:function(e={},t){const n={};if(void 0===e.highlightedObjectColor);else if(null===e.highlightedObjectColor)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const t=e.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=t}if(e.highlightColor){const t=Array.from(e.highlightColor,e=>e/255);Number.isFinite(t[3])||(t[3]=1),n.highlightColor=t}return void 0!==e.isActive&&(n.isActive=Boolean(e.isActive),n.isAttribute=Boolean(e.isAttribute)),void 0!==e.useFloatColors&&(n.useFloatColors=Boolean(e.useFloatColors)),n}},Pl="uniform layerUniforms {\n  uniform float opacity;\n} layer;\n",Ml={name:"layer",vs:Pl,fs:Pl,getUniforms:e=>({opacity:Math.pow(e.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},Nl="#define SMOOTH_EDGE_RADIUS 0.5",Ll={name:"geometry",source:"const SMOOTH_EDGE_RADIUS: f32 = 0.5;\n\nstruct VertexGeometry {\n  position: vec4<f32>,\n  worldPosition: vec3<f32>,\n  worldPositionAlt: vec3<f32>,\n  normal: vec3<f32>,\n  uv: vec2<f32>,\n  pickingColor: vec3<f32>,\n};\n\nvar<private> geometry_: VertexGeometry = VertexGeometry(\n  vec4<f32>(0.0, 0.0, 1.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0),\n  vec2<f32>(0.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0)\n);\n\nstruct FragmentGeometry {\n  uv: vec2<f32>,\n};\n\nvar<private> fragmentGeometry: FragmentGeometry;\n\nfn smoothedge(edge: f32, x: f32) -> f32 {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n",vs:`${Nl}\n\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry = VertexGeometry(\n  vec4(0.0, 0.0, 1.0, 0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec2(0.0),\n  vec3(0.0)\n);\n`,fs:`${Nl}\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n`};var Ol,Fl,Dl,Bl,Ul,jl;(Fl=Ol||(Ol={}))[Fl.Start=1]="Start",Fl[Fl.Move=2]="Move",Fl[Fl.End=4]="End",Fl[Fl.Cancel=8]="Cancel",(Bl=Dl||(Dl={}))[Bl.None=0]="None",Bl[Bl.Left=1]="Left",Bl[Bl.Right=2]="Right",Bl[Bl.Up=4]="Up",Bl[Bl.Down=8]="Down",Bl[Bl.Horizontal=3]="Horizontal",Bl[Bl.Vertical=12]="Vertical",Bl[Bl.All=15]="All",(jl=Ul||(Ul={}))[jl.Possible=1]="Possible",jl[jl.Began=2]="Began",jl[jl.Changed=4]="Changed",jl[jl.Ended=8]="Ended",jl[jl.Recognized=8]="Recognized",jl[jl.Cancelled=16]="Cancelled",jl[jl.Failed=32]="Failed";const Vl="manipulation",Gl="none",zl="pan-x",Wl="pan-y";class Hl{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){"compute"===e&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return function(e){if(e.includes(Gl))return Gl;const t=e.includes(zl),n=e.includes(Wl);return t&&n?Gl:t||n?t?zl:Wl:e.includes(Vl)?Vl:"auto"}(e.join(" "))}}function $l(e){return e.trim().split(/\s+/g)}function Xl(e,t,n){if(e)for(const r of $l(t))e.addEventListener(r,n,!1)}function ql(e,t,n){if(e)for(const r of $l(t))e.removeEventListener(r,n,!1)}function Yl(e){return(e.ownerDocument||e).defaultView}function Kl(e){const t=e.length;if(1===t)return{x:Math.round(e[0].clientX),y:Math.round(e[0].clientY)};let n=0,r=0,s=0;for(;s<t;)n+=e[s].clientX,r+=e[s].clientY,s++;return{x:Math.round(n/t),y:Math.round(r/t)}}function Zl(e){const t=[];let n=0;for(;n<e.pointers.length;)t[n]={clientX:Math.round(e.pointers[n].clientX),clientY:Math.round(e.pointers[n].clientY)},n++;return{timeStamp:Date.now(),pointers:t,center:Kl(t),deltaX:e.deltaX,deltaY:e.deltaY}}function Ql(e,t){const n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}function Jl(e,t){const n=t.clientX-e.clientX,r=t.clientY-e.clientY;return Math.sqrt(n*n+r*r)}function ec(e,t){const n=t.clientX-e.clientX,r=t.clientY-e.clientY;return 180*Math.atan2(r,n)/Math.PI}function tc(e,t){return e===t?Dl.None:Math.abs(e)>=Math.abs(t)?e<0?Dl.Left:Dl.Right:t<0?Dl.Up:Dl.Down}function nc(e,t,n){return{x:t/e||0,y:n/e||0}}let rc=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=e=>{this.manager.options.enable&&this.handler(e)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){!function(e,t,n){const r=n.pointers.length,s=n.changedPointers.length,i=t&Ol.Start&&r-s===0,o=t&(Ol.End|Ol.Cancel)&&r-s===0;n.isFirst=Boolean(i),n.isFinal=Boolean(o),i&&(e.session={}),n.eventType=t;const a=function(e,t){const{session:n}=e,{pointers:r}=t,{length:s}=r;n.firstInput||(n.firstInput=Zl(t)),s>1&&!n.firstMultiple?n.firstMultiple=Zl(t):1===s&&(n.firstMultiple=!1);const{firstInput:i,firstMultiple:o}=n,a=o?o.center:i.center,l=t.center=Kl(r);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-i.timeStamp,t.angle=function(e,t){const n=t.x-e.x,r=t.y-e.y;return 180*Math.atan2(r,n)/Math.PI}(a,l),t.distance=Ql(a,l);const{deltaX:c,deltaY:u}=function(e,t){const n=t.center;let r=e.offsetDelta,s=e.prevDelta;const i=e.prevInput;return t.eventType!==Ol.Start&&(null==i?void 0:i.eventType)!==Ol.End||(s=e.prevDelta={x:(null==i?void 0:i.deltaX)||0,y:(null==i?void 0:i.deltaY)||0},r=e.offsetDelta={x:n.x,y:n.y}),{deltaX:s.x+(n.x-r.x),deltaY:s.y+(n.y-r.y)}}(n,t);t.deltaX=c,t.deltaY=u,t.offsetDirection=tc(t.deltaX,t.deltaY);const h=nc(t.deltaTime,t.deltaX,t.deltaY);var d,f;t.overallVelocityX=h.x,t.overallVelocityY=h.y,t.overallVelocity=Math.abs(h.x)>Math.abs(h.y)?h.x:h.y,t.scale=o?(d=o.pointers,Jl((f=r)[0],f[1])/Jl(d[0],d[1])):1,t.rotation=o?function(e,t){return ec(t[1],t[0])-ec(e[1],e[0])}(o.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length;let p=e.element;return function(e,t){let n=e;for(;n;){if(n===t)return!0;n=n.parentNode}return!1}(t.srcEvent.target,p)&&(p=t.srcEvent.target),t.target=p,function(e,t){const n=e.lastInterval||t,r=t.timeStamp-n.timeStamp;let s,i,o,a;if(t.eventType!==Ol.Cancel&&(r>25||void 0===n.velocity)){const l=t.deltaX-n.deltaX,c=t.deltaY-n.deltaY,u=nc(r,l,c);i=u.x,o=u.y,s=Math.abs(u.x)>Math.abs(u.y)?u.x:u.y,a=tc(l,c),e.lastInterval=t}else s=n.velocity,i=n.velocityX,o=n.velocityY,a=n.direction;t.velocity=s,t.velocityX=i,t.velocityY=o,t.direction=a}(n,t),t}(e,n);e.emit("hammer.input",a),e.recognize(a),e.session.prevInput=a}(this.manager,e,t)}init(){Xl(this.element,this.evEl,this.domHandler),Xl(this.target,this.evTarget,this.domHandler),Xl(Yl(this.element),this.evWin,this.domHandler)}destroy(){ql(this.element,this.evEl,this.domHandler),ql(this.target,this.evTarget,this.domHandler),ql(Yl(this.element),this.evWin,this.domHandler)}};const sc={pointerdown:Ol.Start,pointermove:Ol.Move,pointerup:Ol.End,pointercancel:Ol.Cancel,pointerout:Ol.Cancel};class ic extends rc{constructor(e){super(e),this.evEl="pointerdown",this.evWin="pointermove pointerup pointercancel",this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let n=!1;const r=sc[e.type],s=e.pointerType,i="touch"===s;let o=t.findIndex(t=>t.pointerId===e.pointerId);r&Ol.Start&&(e.buttons||i)?o<0&&(t.push(e),o=t.length-1):r&(Ol.End|Ol.Cancel)&&(n=!0),o<0||(t[o]=e,this.callback(r,{pointers:t,changedPointers:[e],eventType:r,pointerType:s,srcEvent:e}),n&&t.splice(o,1))}}const oc=["","webkit","Moz","MS","ms","o"];function ac(e,t){const n=t[0].toUpperCase()+t.slice(1);for(const r of oc){const s=r?r+n:t;if(s in e)return s}}const lc={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class cc{constructor(e,t){this.options={...lc,...t,cssProps:{...lc.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new ic(this),this.touchAction=new Hl(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?2:1}recognize(e){const{session:t}=this;if(t.stopped)return;let n;this.session.prevented&&e.srcEvent.preventDefault();const{recognizers:r}=this;let{curRecognizer:s}=t;(!s||s&&s.state&Ul.Recognized)&&(s=t.curRecognizer=null);let i=0;for(;i<r.length;)n=r[i],2===t.stopped||s&&n!==s&&!n.canRecognizeWith(s)?n.reset():n.recognize(e),!s&&n.state&(Ul.Began|Ul.Changed|Ul.Ended)&&(s=t.curRecognizer=n),i++}get(e){const{recognizers:t}=this;for(let n=0;n<t.length;n++)if(t[n].options.event===e)return t[n];return null}add(e){if(Array.isArray(e)){for(const t of e)this.add(t);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const t of e)this.remove(t);return this}const t="string"==typeof e?this.get(e):e;if(t){const{recognizers:e}=this,n=e.indexOf(t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:n}=this;for(const r of $l(e))n[r]=n[r]||[],n[r].push(t)}off(e,t){if(!e)return;const{handlers:n}=this;for(const r of $l(e))t?n[r]&&n[r].splice(n[r].indexOf(t),1):delete n[r]}emit(e,t){const n=this.handlers[e]&&this.handlers[e].slice();if(!n||!n.length)return;const r=t;r.type=e,r.preventDefault=function(){t.srcEvent.preventDefault()};let s=0;for(;s<n.length;)n[s](r),s++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[n,r]of Object.entries(this.options.cssProps)){const s=ac(t.style,n);e?(this.oldCssProps[s]=t.style[s],t.style[s]=r):t.style[s]=this.oldCssProps[s]||""}e||(this.oldCssProps={})}}}let uc=1;function hc(e){return e&Ul.Cancelled?"cancel":e&Ul.Ended?"end":e&Ul.Changed?"move":e&Ul.Began?"start":""}class dc{constructor(e){this.options=e,this.id=uc++,this.state=Ul.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const t of e)this.recognizeWith(t);return this}let t;if("string"==typeof e){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:n}=this;return n[t.id]||(n[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const t of e)this.dropRecognizeWith(t);return this}let t;return t="string"==typeof e?this.manager.get(e):e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const t of e)this.requireFailure(t);return this}let t;if("string"==typeof e){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:n}=this;return-1===n.indexOf(t)&&(n.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const t of e)this.dropRequireFailure(t);return this}let t;if(t="string"==typeof e?this.manager.get(e):e,t){const e=this.requireFail.indexOf(t);e>-1&&this.requireFail.splice(e,1)}return this}hasRequireFailures(){return Boolean(this.requireFail.find(e=>e.options.enable))}canRecognizeWith(e){return Boolean(this.simultaneous[e.id])}emit(e){if(!e)return;const{state:t}=this;t<Ul.Ended&&this.manager.emit(this.options.event+hc(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=Ul.Ended&&this.manager.emit(this.options.event+hc(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Ul.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Ul.Failed|Ul.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable)return this.reset(),void(this.state=Ul.Failed);this.state&(Ul.Recognized|Ul.Cancelled|Ul.Failed)&&(this.state=Ul.Possible),this.state=this.process(t),this.state&(Ul.Began|Ul.Changed|Ul.Ended|Ul.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class fc extends dc{attrTest(e){const t=this.options.pointers;return 0===t||e.pointers.length===t}process(e){const{state:t}=this,{eventType:n}=e,r=t&(Ul.Began|Ul.Changed),s=this.attrTest(e);return r&&(n&Ol.Cancel||!s)?t|Ul.Cancelled:r||s?n&Ol.End?t|Ul.Ended:t&Ul.Began?t|Ul.Changed:Ul.Began:Ul.Failed}}class pc extends dc{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[Vl]}process(e){const{options:t}=this,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,s=e.deltaTime<t.time;if(this.reset(),e.eventType&Ol.Start&&0===this.count)return this.failTimeout();if(r&&s&&n){if(e.eventType!==Ol.End)return this.failTimeout();const n=!this.pTime||e.timeStamp-this.pTime<t.interval,r=!this.pCenter||Ql(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,r&&n?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Ul.Recognized,this.tryEmit(this._input)},t.interval),Ul.Began):Ul.Recognized}return Ul.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Ul.Failed},this.options.interval),Ul.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Ul.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const gc=["","start","move","end","cancel","up","down","left","right"];class mc extends fc{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Dl.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&Dl.Horizontal&&t.push(Wl),e&Dl.Vertical&&t.push(zl),t}getEventNames(){return gc.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let n=!0,{distance:r}=e,{direction:s}=e;const i=e.deltaX,o=e.deltaY;return s&t.direction||(t.direction&Dl.Horizontal?(s=0===i?Dl.None:i<0?Dl.Left:Dl.Right,n=i!==this.pX,r=Math.abs(e.deltaX)):(s=0===o?Dl.None:o<0?Dl.Up:Dl.Down,n=o!==this.pY,r=Math.abs(e.deltaY))),e.direction=s,n&&r>t.threshold&&Boolean(s&t.direction)}attrTest(e){return super.attrTest(e)&&(Boolean(this.state&Ul.Began)||!(this.state&Ul.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=Dl[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const _c=["","start","move","end","cancel","in","out"];class yc{constructor(e,t,n){this.element=e,this.callback=t,this.options=n}}const bc=-1!==("undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"").indexOf("firefox"),vc=4.000244140625;class xc extends yc{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=e=>{if(!this.options.enable)return;let t=e.deltaY;globalThis.WheelEvent&&(bc&&e.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(t/=globalThis.devicePixelRatio),e.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(t*=40)),0!==t&&t%vc===0&&(t=Math.floor(t/vc)),e.shiftKey&&t&&(t*=.25),this.callback({type:"wheel",center:{x:e.clientX,y:e.clientY},delta:-t,srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){"wheel"===e&&(this.options.enable=t)}}const wc=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class Ec extends yc{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=e=>{this.handleOverEvent(e),this.handleOutEvent(e),this.handleEnterEvent(e),this.handleLeaveEvent(e),this.handleMoveEvent(e)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,wc.forEach(t=>e.addEventListener(t,this.handleEvent))}destroy(){wc.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t}}handleOverEvent(e){this.enableOverEvent&&"mouseover"===e.type&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&"mouseout"===e.type&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&"mouseenter"===e.type&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&"mouseleave"===e.type&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":0===e.buttons&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const Tc=["keydown","keyup"];class Sc extends yc{constructor(e,t,n){super(e,t,{enable:!0,tabIndex:0,...n}),this.handleEvent=e=>{const t=e.target||e.srcElement;"INPUT"===t.tagName&&"text"===t.type||"TEXTAREA"===t.tagName||(this.enableDownEvent&&"keydown"===e.type&&this.callback({type:"keydown",srcEvent:e,key:e.key,target:e.target}),this.enableUpEvent&&"keyup"===e.type&&this.callback({type:"keyup",srcEvent:e,key:e.key,target:e.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",Tc.forEach(t=>e.addEventListener(t,this.handleEvent))}destroy(){Tc.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){"keydown"===e&&(this.enableDownEvent=t),"keyup"===e&&(this.enableUpEvent=t)}}class Ac extends yc{constructor(e,t,n){super(e,t,n),this.handleEvent=e=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){"contextmenu"===e&&(this.options.enable=t)}}const Rc={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4};function Cc(e){const t=Rc[e.srcEvent.type];if(!t)return null;const{buttons:n,button:r}=e.srcEvent;let s=!1,i=!1,o=!1;return 2===t?(s=Boolean(1&n),i=Boolean(4&n),o=Boolean(2&n)):(s=0===r,i=1===r,o=2===r),{leftButton:s,middleButton:i,rightButton:o}}function kc(e,t){const n=e.center;if(!n)return null;const r=t.getBoundingClientRect(),s=r.width/t.offsetWidth||1,i=r.height/t.offsetHeight||1;return{center:n,offsetCenter:{x:(n.x-r.left-t.clientLeft)/s,y:(n.y-r.top-t.clientTop)/i}}}const Ic={srcElement:"root",priority:0};class Pc{constructor(e,t){this.handleEvent=e=>{if(this.isEmpty())return;const t=this._normalizeEvent(e);let n=e.srcEvent.target;for(;n&&n!==t.rootElement;){if(this._emit(t,n),t.handled)return;n=n.parentNode}this._emit(t,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,n,r=!1,s=!1){const{handlers:i,handlersByElement:o}=this,a={...Ic,...n};let l=o.get(a.srcElement);l||(l=[],o.set(a.srcElement,l));const c={type:e,handler:t,srcElement:a.srcElement,priority:a.priority};r&&(c.once=!0),s&&(c.passive=!0),i.push(c),this._active=this._active||!c.passive;let u=l.length-1;for(;u>=0&&!(l[u].priority>=c.priority);)u--;l.splice(u+1,0,c)}remove(e,t){const{handlers:n,handlersByElement:r}=this;for(let s=n.length-1;s>=0;s--){const i=n[s];if(i.type===e&&i.handler===t){n.splice(s,1);const e=r.get(i.srcElement);e.splice(e.indexOf(i),1),0===e.length&&r.delete(i.srcElement)}}this._active=n.some(e=>!e.passive)}_emit(e,t){const n=this.handlersByElement.get(t);if(n){let t=!1;const r=()=>{e.handled=!0},s=()=>{e.handled=!0,t=!0},i=[];for(let o=0;o<n.length;o++){const{type:a,handler:l,once:c}=n[o];if(l({...e,type:a,stopPropagation:r,stopImmediatePropagation:s}),c&&i.push(n[o]),t)break}for(let e=0;e<i.length;e++){const{type:t,handler:n}=i[e];this.remove(t,n)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...Cc(e),...kc(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function Mc(e){if("recognizer"in e)return e;let t;const n=Array.isArray(e)?[...e]:[e];return t="function"==typeof n[0]?new(n.shift())(n.shift()||{}):n.shift(),{recognizer:t,recognizeWith:"string"==typeof n[0]?[n[0]]:n[0],requireFailure:"string"==typeof n[1]?[n[1]]:n[1]}}class Nc{constructor(e=null,t={}){if(this._onBasicInput=e=>{this.manager.emit(e.srcEvent.type,e)},this._onOtherEvent=e=>{this.manager.emit(e.type,e)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,e){this.manager=new cc(e,this.options);for(const e of this.options.recognizers){const{recognizer:t,recognizeWith:n,requireFailure:r}=Mc(e);this.manager.add(t),n&&t.recognizeWith(n),r&&t.requireFailure(r)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new xc(e,this._onOtherEvent,{enable:!1}),this.moveInput=new Ec(e,this._onOtherEvent,{enable:!1}),this.keyInput=new Sc(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new Ac(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,n){this._addEventHandler(e,t,n,!1)}once(e,t,n){this._addEventHandler(e,t,n,!0)}watch(e,t,n){this._addEventHandler(e,t,n,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){var n,r,s,i;const{manager:o}=this;if(!o)return;const a=o.get(e);a&&(a.set({enable:t}),o.touchAction.update()),null==(n=this.wheelInput)||n.enableEventType(e,t),null==(r=this.moveInput)||r.enableEventType(e,t),null==(s=this.keyInput)||s.enableEventType(e,t),null==(i=this.contextmenuInput)||i.enableEventType(e,t)}_addEventHandler(e,t,n,r,s){if("string"!=typeof e){n=t;for(const[t,i]of Object.entries(e))this._addEventHandler(t,i,n,r,s);return}const{manager:i,events:o}=this;if(!i)return;let a=o.get(e);if(!a){const t=this._getRecognizerName(e)||e;a=new Pc(this,t),o.set(e,a),i&&i.on(e,a.handleEvent)}a.add(e,t,n,r,s),a.isEmpty()||this._toggleRecognizer(a.recognizerName,!0)}_removeEventHandler(e,t){if("string"!=typeof e){for(const[t,n]of Object.entries(e))this._removeEventHandler(t,n);return}const{events:n}=this,r=n.get(e);if(r&&(r.remove(e,t),r.isEmpty())){const{recognizerName:e}=r;let t=!1;for(const r of n.values())if(r.recognizerName===e&&!r.isEmpty()){t=!0;break}t||this._toggleRecognizer(e,!1)}}_getRecognizerName(e){var t;return null==(t=this.manager.recognizers.find(t=>t.getEventNames().includes(e)))?void 0:t.options.event}}const Lc={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Lc,"IDENTITY",{get:()=>(Qn.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Oc={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Fc={common:0,meters:1,pixels:2},Dc={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},Bc={multipan:[mc,{threshold:10,direction:Dl.Vertical,pointers:2}],pinch:[class extends fc{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Gl]}getEventNames(){return _c.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||Boolean(this.state&Ul.Began))}emit(e){if(1!==e.scale){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}},{},null,["multipan"]],pan:[mc,{threshold:1},["pinch"],["multipan"]],dblclick:[pc,{event:"dblclick",taps:2}],click:[pc,{event:"click"},null,["dblclick"]]};function Uc(e,t){if(e===t)return!0;if(Array.isArray(e)){const n=e.length;if(!t||t.length!==n)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}return!1}function jc(e){let t,n={};return r=>{for(const s in r)if(!Uc(r[s],n[s])){t=e(r),n=r;break}return t}}const Vc=[0,0,0,0],Gc=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],zc=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Wc=[0,0,0],Hc=[0,0,0],$c=jc(function({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:s,viewProjectionMatrix:i,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=function(e,t,n){const{viewMatrixUncentered:r,projectionMatrix:s}=e;let{viewMatrix:i,viewProjectionMatrix:o}=e,a=Vc,l=Vc,c=e.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:d}=Xc(e,t,n);return d&&(l=e.projectPosition(u||h),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=ml([],l,o),i=r||i,o=ul([],s,i),o=ul([],o,Gc)),{viewMatrix:i,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:h,geospatialOrigin:u}}(e,n,r),u=e.getDistanceScales(),h=[e.width*t,e.height*t],d=ml([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,f={coordinateSystem:n,projectionMode:e.projectionMode,coordinateOrigin:l,commonOrigin:o.slice(0,3),center:s,pseudoMeters:Boolean(e._pseudoMeters),viewportSize:h,devicePixelRatio:t,focalDistance:d,commonUnitsPerMeter:u.unitsPerMeter,commonUnitsPerWorldUnit:u.unitsPerMeter,commonUnitsPerWorldUnit2:Wc,scale:e.scale,wrapLongitude:!1,viewProjectionMatrix:i,modelMatrix:zc,cameraPosition:a};if(c){const t=e.getDistanceScales(c);switch(n){case Lc.METER_OFFSETS:f.commonUnitsPerWorldUnit=t.unitsPerMeter,f.commonUnitsPerWorldUnit2=t.unitsPerMeter2;break;case Lc.LNGLAT:case Lc.LNGLAT_OFFSETS:e._pseudoMeters||(f.commonUnitsPerMeter=t.unitsPerMeter),f.commonUnitsPerWorldUnit=t.unitsPerDegree,f.commonUnitsPerWorldUnit2=t.unitsPerDegree2;break;case Lc.CARTESIAN:f.commonUnitsPerWorldUnit=[1,1,t.unitsPerMeter[2]],f.commonUnitsPerWorldUnit2=[0,0,t.unitsPerMeter2[2]]}}return f});function Xc(e,t,n=Hc){n.length<3&&(n=[n[0],n[1],0]);let r,s=n,i=!0;switch(r=t===Lc.LNGLAT_OFFSETS||t===Lc.METER_OFFSETS?n:e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case Oc.WEB_MERCATOR:t!==Lc.LNGLAT&&t!==Lc.CARTESIAN||(r=[0,0,0],i=!1);break;case Oc.WEB_MERCATOR_AUTO_OFFSET:t===Lc.LNGLAT?s=r:t===Lc.CARTESIAN&&(s=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],r=e.unprojectPosition(s),s[0]-=n[0],s[1]-=n[1],s[2]-=n[2]);break;case Oc.IDENTITY:s=e.position.map(Math.fround),s[2]=s[2]||0;break;case Oc.GLOBE:i=!1,r=null;break;default:i=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:s,offsetMode:i}}const qc=`${Object.keys(Lc).map(e=>`const COORDINATE_SYSTEM_${e}: i32 = ${Lc[e]};`).join("")}\n${Object.keys(Oc).map(e=>`const PROJECTION_MODE_${e}: i32 = ${Oc[e]};`).join("")}\n${Object.keys(Fc).map(e=>`const UNIT_${e.toUpperCase()}: i32 = ${Fc[e]};`).join("")}\n\nconst TILE_SIZE: f32 = 512.0;\nconst PI: f32 = 3.1415926536;\nconst WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);\nconst ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);\nconst EARTH_RADIUS: f32 = 6370972.0; // meters\nconst GLOBE_RADIUS: f32 = 256.0;\n\n// -----------------------------------------------------------------------------\n// Uniform block (converted from GLSL uniform block)\n// -----------------------------------------------------------------------------\nstruct ProjectUniforms {\n  wrapLongitude: i32,\n  coordinateSystem: i32,\n  commonUnitsPerMeter: vec3<f32>,\n  projectionMode: i32,\n  scale: f32,\n  commonUnitsPerWorldUnit: vec3<f32>,\n  commonUnitsPerWorldUnit2: vec3<f32>,\n  center: vec4<f32>,\n  modelMatrix: mat4x4<f32>,\n  viewProjectionMatrix: mat4x4<f32>,\n  viewportSize: vec2<f32>,\n  devicePixelRatio: f32,\n  focalDistance: f32,\n  cameraPosition: vec3<f32>,\n  coordinateOrigin: vec3<f32>,\n  commonOrigin: vec3<f32>,\n  pseudoMeters: i32,\n};\n\n@group(0) @binding(0)\nvar<uniform> project: ProjectUniforms;\n\n// -----------------------------------------------------------------------------\n// Geometry data\n// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,\n// you might supply this via vertex attributes or a uniform. Here we define a\n// uniform struct for demonstration.)\n// -----------------------------------------------------------------------------\n\n// Structure to carry additional geometry data used by deck.gl filters.\nstruct Geometry {\n  worldPosition: vec3<f32>,\n  worldPositionAlt: vec3<f32>,\n  position: vec4<f32>,\n  normal: vec3<f32>,\n  uv: vec2<f32>,\n  pickingColor: vec3<f32>,\n};\n\n// @group(0) @binding(1)\nvar<private> geometry: Geometry;\n\n\n// -----------------------------------------------------------------------------\n// Functions\n// -----------------------------------------------------------------------------\n\n// Returns an adjustment factor for commonUnitsPerMeter\nfn _project_size_at_latitude(lat: f32) -> f32 {\n  let y = clamp(lat, -89.9, 89.9);\n  return 1.0 / cos(radians(y));\n}\n\n// Overloaded version: scales a value in meters at a given latitude.\nfn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {\n  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);\n}\n\n// Computes a non-linear scale factor based on geometry.\n// (Note: This function relies on "geometry" being provided.)\nfn project_size() -> f32 {\n  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&\n      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\n      project.pseudoMeters == 0) {\n    if (geometry.position.w == 0.0) {\n      return _project_size_at_latitude(geometry.worldPosition.y);\n    }\n    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\n    let y2 = y * y;\n    let y4 = y2 * y2;\n    let y6 = y4 * y2;\n    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n  }\n  return 1.0;\n}\n\n// Overloads to scale offsets (meters to world units)\nfn project_size_float(meters: f32) -> f32 {\n  return meters * project.commonUnitsPerMeter.z * project_size();\n}\n\nfn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {\n  return meters * project.commonUnitsPerMeter.xy * project_size();\n}\n\nfn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {\n  return meters * project.commonUnitsPerMeter * project_size();\n}\n\nfn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {\n  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);\n}\n\n// Returns a rotation matrix aligning the z‑axis with the given up vector.\nfn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {\n  let uz = normalize(up);\n  let ux = select(\n    vec3<f32>(1.0, 0.0, 0.0),\n    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),\n    abs(uz.z) == 1.0\n  );\n  let uy = cross(uz, ux);\n  return mat3x3<f32>(ux, uy, uz);\n}\n\n// Since WGSL does not support "out" parameters, we return a struct.\nstruct RotationResult {\n  needsRotation: bool,\n  transform: mat3x3<f32>,\n};\n\nfn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {\n  if (project.projectionMode == PROJECTION_MODE_GLOBE) {\n    return RotationResult(true, project_get_orientation_matrix(commonPosition));\n  } else {\n    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed\n  };\n}\n\n// Projects a normal vector from the current coordinate system to world space.\nfn project_normal(vector: vec3<f32>) -> vec3<f32> {\n  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);\n  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);\n  let rotResult = project_needs_rotation(geometry.position.xyz);\n  if (rotResult.needsRotation) {\n    n = rotResult.transform * n;\n  }\n  return n;\n}\n\n// Applies a scale offset based on y-offset (dy)\nfn project_offset_(offset: vec4<f32>) -> vec4<f32> {\n  let dy: f32 = offset.y;\n  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;\n  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\n\n// Projects lng/lat coordinates to a unit tile [0,1]\nfn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {\n  var x = lnglat.x;\n  if (project.wrapLongitude != 0) {\n    x = ((x + 180.0) % 360.0) - 180.0;\n  }\n  let y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2<f32>(\n    radians(x) + PI,\n    PI + log(tan(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\n// Projects lng/lat/z coordinates for a globe projection.\nfn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {\n  let lambda = radians(lnglatz.x);\n  let phi = radians(lnglatz.y);\n  let cosPhi = cos(phi);\n  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\n  return vec3<f32>(\n    sin(lambda) * cosPhi,\n    -cos(lambda) * cosPhi,\n    sin(phi)\n  ) * D;\n}\n\n// Projects positions (with an optional 64-bit low part) from the input\n// coordinate system to the common space.\nfn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {\n  var position_world = project.modelMatrix * position;\n\n  // Work around for a Mac+NVIDIA bug:\n  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {\n    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4<f32>(\n        project_mercator_(position_world.xy),\n        _project_size_at_latitude_m(position_world.z, position_world.y),\n        position_world.w\n      );\n    }\n    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\n      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);\n    }\n  }\n  if (project.projectionMode == PROJECTION_MODE_GLOBE) {\n    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4<f32>(\n        project_globe_(position_world.xyz),\n        position_world.w\n      );\n    }\n  }\n  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {\n        return vec4<f32>(\n          project_mercator_(position_world.xy) - project.commonOrigin.xy,\n          project_size_float(position_world.z),\n          position_world.w\n        );\n      }\n    }\n  }\n  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||\n      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\n    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);\n  }\n\n  return project_offset_(position_world) +\n         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));\n}\n\n// Overloaded versions for different input types.\nfn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {\n  return project_position_vec4_f64(position, ZERO_64_LOW);\n}\n\nfn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {\n  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);\n  return projected_position.xyz;\n}\n\nfn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {\n  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);\n  return projected_position.xyz;\n}\n\nfn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {\n  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);\n  return projected_position.xy;\n}\n\n// Transforms a common space position to clip space.\nfn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {\n  return viewProjectionMatrix * position + center;\n}\n\n// Uses the project viewProjectionMatrix and center.\nfn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {\n  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);\n}\n\n// Returns a clip space offset corresponding to a given number of screen pixels.\nfn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {\n  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;\n  return offset * project.focalDistance;\n}\n\nfn project_meter_size_to_pixel(meters: f32) -> f32 {\n  return project_size_float(meters) * project.scale;\n}\n\nfn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {\n  if (unit == UNIT_METERS) {\n    return project_meter_size_to_pixel(size);\n  } else if (unit == UNIT_COMMON) {\n    return size * project.scale;\n  }\n  // UNIT_PIXELS: no scaling applied.\n  return size;\n}\n\nfn project_pixel_size_float(pixels: f32) -> f32 {\n  return pixels / project.scale;\n}\n\nfn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {\n  return pixels / project.scale;\n}\n`,Yc=Object.keys(Lc).map(e=>`const int COORDINATE_SYSTEM_${e} = ${Lc[e]};`).join(""),Kc=Object.keys(Oc).map(e=>`const int PROJECTION_MODE_${e} = ${Oc[e]};`).join(""),Zc=Object.keys(Fc).map(e=>`const int UNIT_${e.toUpperCase()} = ${Fc[e]};`).join(""),Qc={},Jc={name:"project",dependencies:[{name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n\n// All these functions are for substituting tan() function from Intel GPU only\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n\n    // 2pi range reduction\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 1.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 1.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n"},Ll],source:qc,vs:`${Yc}\n${Kc}\n${Zc}\nuniform projectUniforms {\nbool wrapLongitude;\nint coordinateSystem;\nvec3 commonUnitsPerMeter;\nint projectionMode;\nfloat scale;\nvec3 commonUnitsPerWorldUnit;\nvec3 commonUnitsPerWorldUnit2;\nvec4 center;\nmat4 modelMatrix;\nmat4 viewProjectionMatrix;\nvec2 viewportSize;\nfloat devicePixelRatio;\nfloat focalDistance;\nvec3 cameraPosition;\nvec3 coordinateOrigin;\nvec3 commonOrigin;\nbool pseudoMeters;\n} project;\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0;\nconst float GLOBE_RADIUS = 256.0;\nfloat project_size_at_latitude(float lat) {\nfloat y = clamp(lat, -89.9, 89.9);\nreturn 1.0 / cos(radians(y));\n}\nfloat project_size() {\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&\nproject.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\nproject.pseudoMeters == false) {\nif (geometry.position.w == 0.0) {\nreturn project_size_at_latitude(geometry.worldPosition.y);\n}\nfloat y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\nfloat y2 = y * y;\nfloat y4 = y2 * y2;\nfloat y6 = y4 * y2;\nreturn 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n}\nreturn 1.0;\n}\nfloat project_size_at_latitude(float meters, float lat) {\nreturn meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);\n}\nfloat project_size(float meters) {\nreturn meters * project.commonUnitsPerMeter.z * project_size();\n}\nvec2 project_size(vec2 meters) {\nreturn meters * project.commonUnitsPerMeter.xy * project_size();\n}\nvec3 project_size(vec3 meters) {\nreturn meters * project.commonUnitsPerMeter * project_size();\n}\nvec4 project_size(vec4 meters) {\nreturn vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);\n}\nmat3 project_get_orientation_matrix(vec3 up) {\nvec3 uz = normalize(up);\nvec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\nvec3 uy = cross(uz, ux);\nreturn mat3(ux, uy, uz);\n}\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\nif (project.projectionMode == PROJECTION_MODE_GLOBE) {\ntransform = project_get_orientation_matrix(commonPosition);\nreturn true;\n}\nreturn false;\n}\nvec3 project_normal(vec3 vector) {\nvec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);\nvec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);\nmat3 rotation;\nif (project_needs_rotation(geometry.position.xyz, rotation)) {\nn = rotation * n;\n}\nreturn n;\n}\nvec4 project_offset_(vec4 offset) {\nfloat dy = offset.y;\nvec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;\nreturn vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\nfloat x = lnglat.x;\nif (project.wrapLongitude) {\nx = mod(x + 180., 360.0) - 180.;\n}\nfloat y = clamp(lnglat.y, -89.9, 89.9);\nreturn vec2(\nradians(x) + PI,\nPI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))\n) * WORLD_SCALE;\n}\nvec3 project_globe_(vec3 lnglatz) {\nfloat lambda = radians(lnglatz.x);\nfloat phi = radians(lnglatz.y);\nfloat cosPhi = cos(phi);\nfloat D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\nreturn vec3(\nsin(lambda) * cosPhi,\n-cos(lambda) * cosPhi,\nsin(phi)\n) * D;\n}\nvec4 project_position(vec4 position, vec3 position64Low) {\nvec4 position_world = project.modelMatrix * position;\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn vec4(\nproject_mercator_(position_world.xy),\nproject_size_at_latitude(position_world.z, position_world.y),\nposition_world.w\n);\n}\nif (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\nposition_world.xyz += project.coordinateOrigin;\n}\n}\nif (project.projectionMode == PROJECTION_MODE_GLOBE) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn vec4(\nproject_globe_(position_world.xyz),\nposition_world.w\n);\n}\n}\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nif (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {\nreturn vec4(\nproject_mercator_(position_world.xy) - project.commonOrigin.xy,\nproject_size(position_world.z),\nposition_world.w\n);\n}\n}\n}\nif (project.projectionMode == PROJECTION_MODE_IDENTITY ||\n(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\nproject.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\nposition_world.xyz -= project.coordinateOrigin;\n}\nreturn project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));\n}\nvec4 project_position(vec4 position) {\nreturn project_position(position, ZERO_64_LOW);\n}\nvec3 project_position(vec3 position, vec3 position64Low) {\nvec4 projected_position = project_position(vec4(position, 1.0), position64Low);\nreturn projected_position.xyz;\n}\nvec3 project_position(vec3 position) {\nvec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\nreturn projected_position.xyz;\n}\nvec2 project_position(vec2 position) {\nvec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\nreturn projected_position.xy;\n}\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\nreturn viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\nreturn project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\nvec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;\nreturn offset * project.focalDistance;\n}\nfloat project_size_to_pixel(float meters) {\nreturn project_size(meters) * project.scale;\n}\nfloat project_size_to_pixel(float size, int unit) {\nif (unit == UNIT_METERS) return project_size_to_pixel(size);\nif (unit == UNIT_COMMON) return size * project.scale;\nreturn size;\n}\nfloat project_pixel_size(float pixels) {\nreturn pixels / project.scale;\n}\nvec2 project_pixel_size(vec2 pixels) {\nreturn pixels / project.scale;\n}\n`,getUniforms:function(e=Qc){return"viewport"in e?function({viewport:e,devicePixelRatio:t=1,modelMatrix:n=null,coordinateSystem:r=Lc.DEFAULT,coordinateOrigin:s=Hc,autoWrapLongitude:i=!1}){r===Lc.DEFAULT&&(r=e.isGeospatial?Lc.LNGLAT:Lc.CARTESIAN);const o=$c({viewport:e,devicePixelRatio:t,coordinateSystem:r,coordinateOrigin:s});return o.wrapLongitude=i,o.modelMatrix=n||zc,o}(e):{}},uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},eu={name:"project32",dependencies:[Jc],source:"// Define a structure to hold both the clip-space position and the common position.\nstruct ProjectResult {\n  clipPosition: vec4<f32>,\n  commonPosition: vec4<f32>,\n};\n\n// This function mimics the GLSL version with the 'out' parameter by returning both values.\nfn project_position_to_clipspace_and_commonspace(\n    position: vec3<f32>,\n    position64Low: vec3<f32>,\n    offset: vec3<f32>\n) -> ProjectResult {\n  // Compute the projected position.\n  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);\n\n  // Start with the provided offset.\n  var finalOffset: vec3<f32> = offset;\n\n  // Get whether a rotation is needed and the rotation matrix.\n  let rotationResult = project_needs_rotation(projectedPosition);\n\n  // If rotation is needed, update the offset.\n  if (rotationResult.needsRotation) {\n    finalOffset = rotationResult.transform * offset;\n  }\n\n  // Compute the common position.\n  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);\n\n  // Convert to clip-space.\n  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);\n\n  return ProjectResult(clipPosition, commonPosition);\n}\n\n// A convenience overload that returns only the clip-space position.\nfn project_position_to_clipspace(\n    position: vec3<f32>,\n    position64Low: vec3<f32>,\n    offset: vec3<f32>\n) -> vec4<f32> {\n  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;\n}\n",vs:"vec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  mat3 rotation;\n  if (project_needs_rotation(projectedPosition, rotation)) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n"};function tu(e,t){const n=ml([],t,e);return gl(n,n,1/n[3]),n}function nu(e,t){const n=e%t;return n<0?t+n:n}function ru(e,t,n){return e<t?t:e>n?n:e}const su=Math.log2||function(e){return Math.log(e)*Math.LOG2E};function iu(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const ou=Math.PI,au=ou/4,lu=ou/180,cu=180/ou,uu=512,hu=85.051129,du=1.5;function fu(e){const[t,n]=e;iu(Number.isFinite(t)),iu(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=n*lu;return[uu*(t*lu+ou)/(2*ou),uu*(ou+Math.log(Math.tan(au+.5*r)))/(2*ou)]}function pu(e){const[t,n]=e,r=t/uu*(2*ou)-ou,s=2*(Math.atan(Math.exp(n/uu*(2*ou)-ou))-au);return[r*cu,s*cu]}function gu(e){return 12790407194604047e-21/Math.cos(e*lu)}function mu(e){const{latitude:t,longitude:n,highPrecision:r=!1}=e;iu(Number.isFinite(t)&&Number.isFinite(n));const s=Math.cos(t*lu),i=512/360,o=i/s,a=12790407194604047e-21/s,l={unitsPerMeter:[a,a,a],metersPerUnit:[1/a,1/a,1/a],unitsPerDegree:[i,o,a],degreesPerUnit:[.703125,1/o,1/a]};if(r){const e=lu*Math.tan(t*lu)/s,n=i*e/2,r=12790407194604047e-21*e,c=r/o*a;l.unitsPerDegree2=[0,n,r],l.unitsPerMeter2=[c,0,c]}return l}function _u(e,t){const[n,r,s]=e,[i,o,a]=t,{unitsPerMeter:l,unitsPerMeter2:c}=mu({longitude:n,latitude:r,highPrecision:!0}),u=fu(e);u[0]+=i*(l[0]+c[0]*o),u[1]+=o*(l[1]+c[1]*o);const h=pu(u),d=(s||0)+(a||0);return Number.isFinite(s)||Number.isFinite(a)?[h[0],h[1],d]:h}function yu(e){return 2*Math.atan(.5/e)*cu}function bu(e){return.5/Math.tan(.5*e*lu)}function vu(e,t){const[n,r,s=0]=e;return iu(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(s)),tu(t,[n,r,s,1])}function xu(e,t,n=0){const[r,s,i]=e;if(iu(Number.isFinite(r)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(i))return tu(t,[r,s,i,1]);const o=tu(t,[r,s,0,1]),a=tu(t,[r,s,1,1]),l=o[2],c=a[2];return el([],o,a,l===c?0:((n||0)-l)/(c-l))}const wu=Math.PI/180;function Eu(e,t,n){const{pixelUnprojectionMatrix:r}=e,s=tu(r,[t,0,1,1]),i=tu(r,[t,e.height,1,1]),o=pu(el([],s,i,(n*e.distanceScales.unitsPerMeter[2]-s[2])/(i[2]-s[2])));return o.push(n),o}const Tu="\nuniform shadowUniforms {\n  bool drawShadowMap;\n  bool useShadowMap;\n  vec4 color;\n  highp int lightId;\n  float lightCount;\n  mat4 viewProjectionMatrix0;\n  mat4 viewProjectionMatrix1;\n  vec4 projectCenter0;\n  vec4 projectCenter1;\n} shadow;\n",Su=`\n${Tu}\n\nconst int max_lights = 2;\n\nout vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  mat4 viewProjectionMatrices[max_lights];\n  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;\n  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;\n  vec4 projectCenters[max_lights];\n  projectCenters[0] = shadow.projectCenter0;\n  projectCenters[1] = shadow.projectCenter1;\n\n  if (shadow.drawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);\n  }\n  if (shadow.useShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow.lightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n\n`,Au=`\n${Tu}\n\nconst int max_lights = 2;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\n\nin vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow.drawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow.useShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow.lightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow.color.a / shadow.lightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n\n`,Ru=jc(function({viewport:e,center:t}){return new Tl(e.viewProjectionMatrix).invert().transform(t)}),Cu=jc(function({viewport:e,shadowMatrices:t}){const n=[],r=e.pixelUnprojectionMatrix,s=e.isGeospatial?void 0:1,i=[[0,0,s],[e.width,0,s],[0,e.height,s],[e.width,e.height,s],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(e=>function(e,t){const[n,r,s]=e,i=xu([n,r,s],t);return Number.isFinite(s)?i:[i[0],i[1],0]}(e,r));for(const o of t){const t=o.clone().translate(new al(e.center).negate()),r=i.map(e=>t.transform(e)),s=(new Tl).ortho({left:Math.min(...r.map(e=>e[0])),right:Math.max(...r.map(e=>e[0])),bottom:Math.min(...r.map(e=>e[1])),top:Math.max(...r.map(e=>e[1])),near:Math.min(...r.map(e=>-e[2])),far:Math.max(...r.map(e=>-e[2]))});n.push(s.multiplyRight(o))}return n}),ku=[0,0,0,1],Iu=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Pu={name:"shadow",dependencies:[Jc],vs:Su,fs:Au,inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    position = shadow_setVertexPosition(geometry.position);\n    ","fs:DECKGL_FILTER_COLOR":"\n    color = shadow_filterShadowColor(color);\n    "},getUniforms:function(e){const{shadowEnabled:t=!0,project:n}=e;if(!(t&&n&&e.shadowMatrices&&e.shadowMatrices.length))return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};const r=Jc.getUniforms(n),s=Ru({viewport:n.viewport,center:r.center}),i=[],o=Cu({shadowMatrices:e.shadowMatrices,viewport:n.viewport}).slice();for(let l=0;l<e.shadowMatrices.length;l++){const e=o[l],t=e.clone().translate(new al(n.viewport.center).negate());r.coordinateSystem===Lc.LNGLAT&&r.projectionMode===Oc.WEB_MERCATOR?(o[l]=t,i[l]=s):(o[l]=e.clone().multiplyRight(Iu),i[l]=t.transform(s))}const a={drawShadowMap:Boolean(e.drawToShadowMap),useShadowMap:!!e.shadowMaps&&e.shadowMaps.length>0,color:e.shadowColor||ku,lightId:e.shadowLightId||0,lightCount:e.shadowMatrices.length,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};for(let l=0;l<o.length;l++)a[`viewProjectionMatrix${l}`]=o[l],a[`projectCenter${l}`]=i[l];for(let l=0;l<2;l++)a[`shadow_uShadowMap${l}`]=e.shadowMaps&&e.shadowMaps[l]||e.dummyShadowMap;return a},uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},Mu={...Il,defaultUniforms:{...Il.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    // for picking depth values\n    picking_setPickingAttribute(position.z / position.w);\n  ","vs:DECKGL_FILTER_COLOR":"\n  picking_setPickingColor(geometry.pickingColor);\n  ","fs:DECKGL_FILTER_COLOR":{order:99,injection:"\n  // use highlight color if this fragment belongs to the selected object.\n  color = picking_filterHighlightColor(color);\n\n  // use picking color if rendering to picking FBO.\n  color = picking_filterPickingColor(color);\n    "}}},Nu=[Ll],Lu=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],Ou=[];function Fu(e){const t=Br.getDefaultShaderAssembler();for(const r of Nu)t.addDefaultModule(r);t._hookFunctions.length=0;const n="glsl"===e?Lu:Ou;for(const r of n)t.addShaderHook(r);return t}const Du=[255,255,255],Bu=1;let Uu=0;class ju{constructor(e={}){this.type="ambient";const{color:t=Du}=e,{intensity:n=Bu}=e;this.id=e.id||"ambient-"+Uu++,this.color=t,this.intensity=n}}const Vu=[255,255,255],Gu=1,zu=[0,0,-1];let Wu=0;class Hu{constructor(e={}){this.type="directional";const{color:t=Vu}=e,{intensity:n=Gu}=e,{direction:r=zu}=e,{_shadow:s=!1}=e;this.id=e.id||"directional-"+Wu++,this.color=t,this.intensity=n,this.type="directional",this.direction=new al(r).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class $u{constructor(e,t={id:"pass"}){const{id:n}=t;this.id=n,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Xu extends $u{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,n]=this.device.canvasContext.getDrawingBufferSize(),r=e.clearCanvas??!0,s=e.clearColor??(!!r&&[0,0,0,0]),i=!!r&&1,o=!!r&&0,a=e.colorMask??15,l={viewport:[0,0,t,n]};e.colorMask&&(l.colorMask=a),e.scissorRect&&(l.scissorRect=e.scissorRect);const c=this.device.beginRenderPass({framebuffer:e.target,parameters:l,clearColor:s,clearDepth:i,clearStencil:o});try{return this._drawLayers(c,e)}finally{c.end(),this.device.submit()}}_drawLayers(e,t){const{target:n,shaderModuleProps:r,viewports:s,views:i,onViewportActive:o,clearStack:a=!0}=t;t.pass=t.pass||"unknown",a&&(this._lastRenderIndex=-1);const l=[];for(const c of s){const s=i&&i[c.id];null==o||o(c);const a=this._getDrawLayerParams(c,t),u=c.subViewports||[c];for(const i of u){const o=this._drawLayersInViewport(e,{target:n,shaderModuleProps:r,viewport:i,view:s,pass:t.pass,layers:t.layers},a);l.push(o)}}return l}_getDrawLayerParams(e,{layers:t,pass:n,isPicking:r=!1,layerFilter:s,cullRect:i,effects:o,shaderModuleProps:a},l=!1){var c;const u=[],h=qu(this._lastRenderIndex+1),d={layer:t[0],viewport:e,isPicking:r,renderPass:n,cullRect:i},f={};for(let p=0;p<t.length;p++){const r=t[p],i=this._shouldDrawLayer(r,d,s,f),g={shouldDrawLayer:i};i&&!l&&(g.shouldDrawLayer=!0,g.layerRenderIndex=h(r,i),g.shaderModuleProps=this._getShaderModuleProps(r,o,n,a),g.layerParameters={...null==(c=r.context.deck)?void 0:c.props.parameters,...this.getLayerParameters(r,p,e)}),u[p]=g}return u}_drawLayersInViewport(e,{layers:t,shaderModuleProps:n,pass:r,target:s,viewport:i,view:o},a){const l=function(e,{shaderModuleProps:t,target:n,viewport:r}){var s;const i=(null==(s=null==t?void 0:t.project)?void 0:s.devicePixelRatio)??e.canvasContext.cssToDeviceRatio(),[,o]=e.canvasContext.getDrawingBufferSize(),a=n?n.height:o,l=r;return[l.x*i,a-(l.y+l.height)*i,l.width*i,l.height*i]}(this.device,{shaderModuleProps:n,target:s,viewport:i});if(o){const{clear:e,clearColor:t,clearDepth:n,clearStencil:r}=o.props;if(e){let e=[0,0,0,0],i=1,o=0;Array.isArray(t)?e=[...t.slice(0,3),t[3]||255].map(e=>e/255):!1===t&&(e=!1),void 0!==n&&(i=n),void 0!==r&&(o=r),this.device.beginRenderPass({framebuffer:s,parameters:{viewport:l,scissorRect:l},clearColor:e,clearDepth:i,clearStencil:o}).end()}}const c={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:l});for(let h=0;h<t.length;h++){const n=t[h],s=a[h],{shouldDrawLayer:o}=s;if(o&&n.props.pickable&&c.pickableCount++,n.isComposite&&c.compositeCount++,n.isDrawable&&s.shouldDrawLayer){const{layerRenderIndex:t,shaderModuleProps:o,layerParameters:a}=s;c.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,t),o.project&&(o.project.viewport=i),n.context.renderPass=e;try{n._drawLayer({renderPass:e,shaderModuleProps:o,uniforms:{layerIndex:t},parameters:a})}catch(u){n.raiseError(u,`drawing ${n} to ${r}`)}}}return c}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,n){return null}getLayerParameters(e,t,n){return e.props.parameters}_shouldDrawLayer(e,t,n,r){if(!e.props.visible||!this.shouldDrawLayer(e))return!1;t.layer=e;let s=e.parent;for(;s;){if(!s.props.visible||!s.filterSubLayer(t))return!1;t.layer=s,s=s.parent}if(n){const e=t.layer.id;if(e in r||(r[e]=n(t)),!r[e])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,n,r){var s,i;const o=this.device.canvasContext.cssToDeviceRatio(),a=(null==(s=e.internalState)?void 0:s.propsInTransition)||e.props,l={layer:a,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:o,modelMatrix:a.modelMatrix,coordinateSystem:a.coordinateSystem,coordinateOrigin:a.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const c of t)Yu(l,null==(i=c.getShaderModuleProps)?void 0:i.call(c,e,l));return Yu(l,this.getShaderModuleProps(e,t,l),r)}}function qu(e=0,t={}){const n={},r=(s,i)=>{const o=s.props._offset,a=s.id,l=s.parent&&s.parent.id;let c;if(l&&!(l in t)&&r(s.parent,!1),l in n){const e=n[l]=n[l]||qu(t[l],t);c=e(s,i),n[a]=e}else Number.isFinite(o)?(c=o+(t[l]||0),n[a]=null):c=e;return i&&c>=e&&(e=c+1),t[a]=c,c};return r}function Yu(e,...t){for(const n of t)if(n)for(const t in n)e[t]?Object.assign(e[t],n[t]):e[t]=n[t];return e}class Ku extends Xu{constructor(e,t){super(e,t);const n=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),r=e.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:r})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),r=e.viewports[0],s=r.width*n,i=r.height*n;s===t.width&&i===t.height||t.resize({width:s,height:i}),super.render({...e,clearColor:[1,1,1,1],target:t,pass:"shadow"})}getLayerParameters(e,t,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return!1!==e.props.shadowEnabled}getShaderModuleProps(e,t,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const Zu={color:[255,255,255],intensity:1},Qu=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Ju=[0,0,0,200/255];class eh{constructor(e={}){this.id="lighting-effect",this.shadowColor=Ju,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),n._addDefaultShaderModule(Pu),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const n=e[t];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:n,onViewportActive:r,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let i=0;i<this.shadowPasses.length;i++)this.shadowPasses[i].render({layers:e,layerFilter:t,viewports:n,onViewportActive:r,views:s,shaderModuleProps:{shadow:{shadowLightId:i,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const n=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(e=>e.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},r={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(t=>t.getProjectedLight({layer:e})),pointLights:this.pointLights.map(t=>t.getProjectedLight({layer:e}))},s=e.props.material;return{shadow:n,lighting:r,phongMaterial:s,gouraudMaterial:s}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Pu))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const n=(new Tl).lookAt({eye:new al(t.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const n=new Ku(e);this.shadowPasses[t]=n}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:n}=this;e||0!==t.length||0!==n.length||(this.ambientLight=new ju(Zu),this.directionalLights.push(new Hu(Qu[0]),new Hu(Qu[1])))}}const th=new class{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:n=1,type:r,padding:s=0,copy:i=!1,initialize:o=!1,maxCount:a}){const l=r||e&&e.constructor||Float32Array,c=t*n+s;if(ArrayBuffer.isView(e)){if(c<=e.length)return e;if(c*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new l(e.buffer,0,c)}let u=1/0;a&&(u=a*n+s);const h=this._allocate(l,c,o,u);return e&&i?h.set(e):o||h.fill(0,0,4),this._release(e),h}release(e){this._release(e)}_allocate(e,t,n,r){let s=Math.max(Math.ceil(t*this.opts.overAlloc),1);s>r&&(s=r);const i=this._pool,o=e.BYTES_PER_ELEMENT*s,a=i.findIndex(e=>e.byteLength>=o);if(a>=0){const t=new e(i.splice(a,1)[0],0,s);return n&&t.fill(0),t}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:n}=e,{byteLength:r}=n,s=t.findIndex(e=>e.byteLength>=r);s<0?t.push(n):(s>0||t.length<this.opts.poolSize)&&t.splice(s,0,n),t.length>this.opts.poolSize&&t.shift()}},nh=new al;function rh(e,t,n,r){nh.set(e,t,n);const s=nh.len();return{distance:r/s,normal:new al(-e/s,-t/s,-n/s)}}function sh(e){return e-Math.fround(e)}let ih;function oh(e,t){const{size:n=1,startIndex:r=0}=t,s=void 0!==t.endIndex?t.endIndex:e.length,i=(s-r)/n;ih=th.allocate(ih,i,{type:Float32Array,size:2*n});let o=r,a=0;for(;o<s;){for(let t=0;t<n;t++){const r=e[o++];ih[a+t]=r,ih[a+t+n]=sh(r)}a+=2*n}return ih.subarray(0,i*n*2)}function ah(e){let t=null,n=!1;for(const r of e)r&&(t?(n||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],n=!0),t[0][0]=Math.min(t[0][0],r[0][0]),t[0][1]=Math.min(t[0][1],r[0][1]),t[1][0]=Math.max(t[1][0],r[1][0]),t[1][1]=Math.max(t[1][1],r[1][1])):t=r);return t}const lh=Math.PI/180,ch=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],uh=[0,0,0],hh={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class dh{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||hh,this.focalDistance=e.focalDistance||1,this.position=e.position||uh,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Oc.WEB_MERCATOR:Oc.WEB_MERCATOR_AUTO_OFFSET:Oc.IDENTITY}equals(e){return e instanceof dh&&(this===e||e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Ha(e.projectionMatrix,this.projectionMatrix)&&Ha(e.viewMatrix,this.viewMatrix))}project(e,{topLeft:t=!0}={}){const n=vu(this.projectPosition(e),this.pixelProjectionMatrix),[r,s]=n,i=t?s:this.height-s;return 2===e.length?[r,i]:[r,i,n[2]]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[r,s,i]=e,o=t?s:this.height-s,a=n&&n*this.distanceScales.unitsPerMeter[2],l=xu([r,o,i],this.pixelUnprojectionMatrix,a),[c,u,h]=this.unprojectPosition(l);return Number.isFinite(i)?[c,u,h]:Number.isFinite(n)?[c,u,n]:[c,u]}projectPosition(e){const[t,n]=this.projectFlat(e);return[t,n,(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(e){const[t,n]=this.unprojectFlat(e);return[t,n,(e[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(e){if(this.isGeospatial){const t=fu(e);return t[1]=za(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?pu(e):e}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,0],t),r=this.unproject([this.width,0],t),s=this.unproject([0,this.height],t),i=this.unproject([this.width,this.height],t);return[Math.min(n[0],r[0],s[0],i[0]),Math.min(n[1],r[1],s[1],i[1]),Math.max(n[0],r[0],s[0],i[0]),Math.max(n[1],r[1],s[1],i[1])]}getDistanceScales(e){return e&&this.isGeospatial?mu({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:n=1,height:r=1}){return e<this.x+this.width&&this.x<e+n&&t<this.y+this.height&&this.y<t+r}getFrustumPlanes(){return this._frustumPlanes.near||Object.assign(this._frustumPlanes,{left:rh((e=this.viewProjectionMatrix)[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:rh(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:rh(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:rh(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:rh(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:rh(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}),this._frustumPlanes;var e}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=function(e){const{latitude:t}=e;iu(Number.isFinite(t));const n=Math.cos(t*lu);return su(4003e4*n)-9}({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||mu({latitude:n,longitude:t}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:s,modelMatrix:i}=e;let o=uh;if(s&&(o=i?new Tl(i).transformAsVector(s,[]):s),this.isGeospatial){const e=this.projectPosition([t,n,0]);this.center=new al(o).scale(this.distanceScales.unitsPerMeter).add(e)}else this.center=this.projectPosition(o)}_initMatrices(e){const{viewMatrix:t=ch,projectionMatrix:n=null,orthographic:r=!1,fovyRadians:s,fovy:i=75,near:o=.1,far:a=1e3,padding:l=null,focalDistance:c=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=(new Tl).multiplyRight(t).translate(new al(this.center).negate()),this.projectionMatrix=n||function({width:e,height:t,orthographic:n,fovyRadians:r,focalDistance:s,padding:i,near:o,far:a}){const l=e/t,c=n?(new Tl).orthographic({fovy:r,aspect:l,focalDistance:s,near:o,far:a}):(new Tl).perspective({fovy:r,aspect:l,near:o,far:a});if(i){const{left:n=0,right:r=0,top:s=0,bottom:o=0}=i,a=za((n+e-r)/2,0,e)-e/2,l=za((s+t-o)/2,0,t)-t/2;c[8]-=2*a/e,c[9]+=2*l/t}return c}({width:this.width,height:this.height,orthographic:r,fovyRadians:s||i*lh,focalDistance:c,padding:l,near:o,far:a});const u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var h;ul(u,u,this.projectionMatrix),ul(u,u,this.viewMatrix),this.viewProjectionMatrix=u,this.viewMatrixInverse=cl([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=[(h=this.viewMatrixInverse)[12],h[13],h[14]];const d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],f=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];dl(d,d,[this.width/2,-this.height/2,1]),hl(d,d,[1,-1,0]),ul(f,d,this.viewProjectionMatrix),this.pixelProjectionMatrix=f,this.pixelUnprojectionMatrix=cl([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Qn.warn("Pixel project matrix not invertible")()}}dh.displayName="Viewport";class fh extends dh{constructor(e={}){const{latitude:t=0,longitude:n=0,zoom:r=0,pitch:s=0,bearing:i=0,nearZMultiplier:o=.1,farZMultiplier:a=1.01,nearZ:l,farZ:c,orthographic:u=!1,projectionMatrix:h,repeat:d=!1,worldOffset:f=0,position:p,padding:g,legacyMeterSizes:m=!1}=e;let{width:_,height:y,altitude:b=1.5}=e;const v=Math.pow(2,r);let x;_=_||1,y=y||1;let w=null;if(h)b=h[5]/2,x=yu(b);else{let n;if(e.fovy?(x=e.fovy,b=bu(x)):x=yu(b),g){const{top:e=0,bottom:t=0}=g;n=[0,za((e+y-t)/2,0,y)-y/2]}w=function(e){const{width:t,height:n,altitude:r,pitch:s=0,offset:i,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=e;let{fovy:u=yu(du)}=e;void 0!==r&&(u=yu(r));const h=u*lu,d=s*lu,f=bu(u);let p=f;o&&(p+=o[2]*a/Math.cos(d)/n);const g=h*(.5+(i?i[1]:0)/n),m=Math.sin(g)*p/Math.sin(ru(Math.PI/2-d-g,.01,Math.PI-.01)),_=Math.sin(d)*m+p,y=10*p;return{fov:h,aspect:t/n,focalDistance:f,near:l,far:Math.min(_*c,y)}}({width:_,height:y,scale:v,center:p&&[0,0,p[2]*gu(t)],offset:n,pitch:s,fovy:x,nearZMultiplier:o,farZMultiplier:a}),Number.isFinite(l)&&(w.near=l),Number.isFinite(c)&&(w.far=c)}let E=function(e){const{height:t,pitch:n,bearing:r,altitude:s,scale:i,center:o}=e,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];hl(a,a,[0,0,-s]),fl(a,a,-n*lu),pl(a,a,r*lu);const l=i/t;var c,u;return dl(a,a,[l,l,l]),o&&hl(a,a,((c=[])[0]=-(u=o)[0],c[1]=-u[1],c[2]=-u[2],c)),a}({height:y,pitch:s,bearing:i,scale:v,altitude:b});f&&(E=(new Tl).translate([512*f,0,0]).multiplyLeft(E)),super({...e,width:_,height:y,viewMatrix:E,longitude:n,latitude:t,zoom:r,...w,fovy:x,focalDistance:b}),this.latitude=t,this.longitude=n,this.zoom=r,this.pitch=s,this.bearing=i,this.altitude=b,this.fovy=x,this.orthographic=u,this._subViewports=d?[]:null,this._pseudoMeters=m,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let r=t;r<=n;r++){const e=r?new fh({...this,worldOffset:r}):this;this._subViewports.push(e)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,n]=this.projectFlat(e);return[t,n,(e[2]||0)*gu(e[1])]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,n]=this.unprojectFlat(e);return[t,n,(e[2]||0)/gu(n)]}addMetersToLngLat(e,t){return _u(e,t)}panByPosition(e,t){const n=xu(t,this.pixelUnprojectionMatrix),r=Ja([],this.projectFlat(e),((s=[])[0]=-(i=n)[0],s[1]=-i[1],s));var s,i;const o=Ja([],this.center,r),[a,l]=this.unprojectFlat(o);return{longitude:a,latitude:l}}getBounds(e={}){const t=function(e,t=0){const{width:n,height:r,unproject:s}=e,i={targetZ:t},o=s([0,r],i),a=s([n,r],i);let l,c;return(e.fovy?.5*e.fovy*wu:Math.atan(.5/e.altitude))>(90-e.pitch)*wu-.01?(l=Eu(e,0,t),c=Eu(e,n,t)):(l=s([0,0],i),c=s([n,0],i)),[o,a,c,l]}(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:n,height:r}=this,{longitude:s,latitude:i,zoom:o}=function(e){const{width:t,height:n,bounds:r,minExtent:s=0,maxZoom:i=24,offset:o=[0,0]}=e,[[a,l],[c,u]]=r,h=function(e=0){return"number"==typeof e?{top:e,bottom:e,left:e,right:e}:(iu(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}(e.padding),d=fu([a,ru(u,-85.051129,hu)]),f=fu([c,ru(l,-85.051129,hu)]),p=[Math.max(Math.abs(f[0]-d[0]),s),Math.max(Math.abs(f[1]-d[1]),s)],g=[t-h.left-h.right-2*Math.abs(o[0]),n-h.top-h.bottom-2*Math.abs(o[1])];iu(g[0]>0&&g[1]>0);const m=g[0]/p[0],_=g[1]/p[1],y=(h.right-h.left)/2/m,b=(h.top-h.bottom)/2/_,v=pu([(f[0]+d[0])/2+y,(f[1]+d[1])/2+b]),x=Math.min(i,su(Math.abs(Math.min(m,_))));return iu(Number.isFinite(x)),{longitude:v[0],latitude:v[1],zoom:x}}({width:n,height:r,bounds:e,...t});return new fh({width:n,height:r,longitude:s,latitude:i,zoom:o})}}fh.displayName="WebMercatorViewport";const ph=[0,0,0];function gh(e,t,n=!1){const r=t.projectPosition(e);if(n&&t instanceof fh){const[n,s,i=0]=e,o=t.getDistanceScales([n,s]);r[2]=i*o.unitsPerMeter[2]}return r}function mh(e,{viewport:t,modelMatrix:n,coordinateSystem:r,coordinateOrigin:s,offsetMode:i}){let[o,a,l=0]=e;switch(n&&([o,a,l]=ml([],[o,a,l,1],n)),r){case Lc.LNGLAT:return gh([o,a,l],t,i);case Lc.LNGLAT_OFFSETS:return gh([o+s[0],a+s[1],l+(s[2]||0)],t,i);case Lc.METER_OFFSETS:return gh(_u(s,[o,a,l]),t,i);default:return t.isGeospatial?[o+s[0],a+s[1],l+s[2]]:t.projectPosition([o,a,l])}}let _h=1,yh=1;class bh{constructor(){r(this,"time",0),r(this,"channels",new Map),r(this,"animations",new Map),r(this,"playing",!1),r(this,"lastEngineTime",-1)}addChannel(e){const{delay:t=0,duration:n=Number.POSITIVE_INFINITY,rate:r=1,repeat:s=1}=e,i=_h++,o={time:0,delay:t,duration:n,rate:r,repeat:s};return this._setChannelTime(o,this.time),this.channels.set(i,o),i}removeChannel(e){this.channels.delete(e);for(const[t,n]of this.animations)n.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}getTime(e){if(void 0===e)return this.time;const t=this.channels.get(e);return void 0===t?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const r of t)this._setChannelTime(r,this.time);const n=this.animations.values();for(const r of n){const{animation:e,channel:t}=r;e.setTime(this.getTime(t))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const n=yh++;return this.animations.set(n,{animation:e,channel:t}),e.setTime(this.getTime(t)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const n=t-e.delay;n>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}let vh=0;const xh=class e{constructor(t){if(r(this,"device",null),r(this,"canvas",null),r(this,"props"),r(this,"animationProps",null),r(this,"timeline",null),r(this,"stats"),r(this,"cpuTime"),r(this,"gpuTime"),r(this,"frameRate"),r(this,"display"),r(this,"needsRedraw","initialized"),r(this,"_initialized",!1),r(this,"_running",!1),r(this,"_animationFrameId",null),r(this,"_nextFramePromise",null),r(this,"_resolveNextFrame",null),r(this,"_cpuStartTime",0),r(this,"_error",null),this.props={...e.defaultAnimationLoopProps,...t},!(t=this.props).device)throw new Error("No device provided");this.stats=t.stats||new Ut({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:t.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(e){this.props.onError(e),this._error=e}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(!1!==e&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(null==(e=this.device)?void 0:e.isLost)||this._error||(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers()),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){var e;this._running&&(this._animationFrameId=(e=this._animationFrame.bind(this),"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)))}_cancelAnimationFrame(){var e;null!==this._animationFrameId&&(e=this._animationFrameId,"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var t;this.display?this.display._renderFrame(e):(this.props.onRender(this._getAnimationProps()),null==(t=this.device)||t.submit())}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){var e;const t=null==(e=this.device)?void 0:e.getDefaultCanvasContext();if(!this.device||!t)throw new Error("loop");const n=null==t?void 0:t.canvas,r=t.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:t,canvas:n,useDevicePixels:r,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:n}=this._getSizeAndAspect();e===this.animationProps.width&&t===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){var e,t;if(!this.device)return{width:1,height:1,aspect:1};const[n,r]=(null==(e=this.device)?void 0:e.getDefaultCanvasContext().getDevicePixelSize())||[1,1];let s=1;const i=null==(t=this.device)?void 0:t.getDefaultCanvasContext().canvas;return i&&i.clientHeight?s=i.clientWidth/i.clientHeight:n>0&&r>0&&(s=n/r),{width:n,height:r,aspect:s}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}};r(xh,"defaultAnimationLoopProps",{device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>{},stats:Ts.stats.get("animation-loop-"+vh++),autoResizeViewport:!1});let wh=xh;const Eh={};function Th(e="id"){return Eh[e]=Eh[e]||1,`${e}-${Eh[e]++}`}class Sh{constructor(e){if(r(this,"id"),r(this,"userData",{}),r(this,"topology"),r(this,"bufferLayout",[]),r(this,"vertexCount"),r(this,"indices"),r(this,"attributes"),this.id=e.id||Th("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&$r.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;null==(e=this.indices)||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}const Ah=class e{constructor(e){r(this,"device"),r(this,"cachingEnabled"),r(this,"destroyPolicy"),r(this,"debug"),r(this,"_hashCounter",0),r(this,"_hashes",{}),r(this,"_renderPipelineCache",{}),r(this,"_computePipelineCache",{}),this.device=e,this.cachingEnabled=e.props._cachePipelines,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=e.props.debugFactories}static getDefaultPipelineFactory(t){return t._lumaData.defaultPipelineFactory=t._lumaData.defaultPipelineFactory||new e(t),t._lumaData.defaultPipelineFactory}get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}createRenderPipeline(e){var t;if(!this.cachingEnabled)return this.device.createRenderPipeline(e);const n={...qs.defaultProps,...e},r=this._renderPipelineCache,s=this._hashRenderPipeline(n);let i=null==(t=r[s])?void 0:t.pipeline;return i?(r[s].useCount++,this.debug&&Vr.log(3,`${this}: ${r[s].pipeline} reused, count=${r[s].useCount}, (id=${e.id})`)()):(i=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:Th("unnamed-cached")}),i.hash=s,r[s]={pipeline:i,useCount:1},this.debug&&Vr.log(3,`${this}: ${i} created, count=${r[s].useCount}`)()),i}createComputePipeline(e){var t;if(!this.cachingEnabled)return this.device.createComputePipeline(e);const n={...Qs.defaultProps,...e},r=this._computePipelineCache,s=this._hashComputePipeline(n);let i=null==(t=r[s])?void 0:t.pipeline;return i?(r[s].useCount++,this.debug&&Vr.log(3,`${this}: ${r[s].pipeline} reused, count=${r[s].useCount}, (id=${e.id})`)()):(i=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0}),i.hash=s,r[s]={pipeline:i,useCount:1},this.debug&&Vr.log(3,`${this}: ${i} created, count=${r[s].useCount}`)()),i}release(e){if(!this.cachingEnabled)return void e.destroy();const t=this._getCache(e),n=e.hash;t[n].useCount--,0===t[n].useCount?(this._destroyPipeline(e),this.debug&&Vr.log(3,`${this}: ${e} released and destroyed`)()):t[n].useCount<0?(Vr.error(`${this}: ${e} released, useCount < 0, resetting`)(),t[n].useCount=0):this.debug&&Vr.log(3,`${this}: ${e} released, count=${t[n].useCount}`)()}_destroyPipeline(e){const t=this._getCache(e);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete t[e.hash],e.destroy(),!0}}_getCache(e){let t;if(e instanceof Qs&&(t=this._computePipelineCache),e instanceof qs&&(t=this._renderPipelineCache),!t)throw new Error(`${this}`);if(!t[e.hash])throw new Error(`${this}: ${e} matched incorrect entry`);return t}_hashComputePipeline(e){const{type:t}=this.device;return`${t}/C/${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,r=this._getHash(JSON.stringify(e.bufferLayout)),{type:s}=this.device;if("webgl"===s)return`${s}/R/${t}/${n}V-BL${r}`;{const i=this._getHash(JSON.stringify(e.parameters));return`${s}/R/${t}/${n}V-T${e.topology}P${i}BL${r}`}}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};r(Ah,"defaultProps",{...qs.defaultProps});let Rh=Ah;const Ch=class e{constructor(e){r(this,"device"),r(this,"cachingEnabled"),r(this,"destroyPolicy"),r(this,"debug"),r(this,"_cache",{}),this.device=e,this.cachingEnabled=e.props._cacheShaders,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=!0}static getDefaultShaderFactory(t){var n;return(n=t._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new e(t)),t._lumaData.defaultShaderFactory}get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}createShader(e){if(!this.cachingEnabled)return this.device.createShader(e);const t=this._hashShader(e);let n=this._cache[t];if(n)n.useCount++,this.debug&&Vr.log(3,`${this}: Reusing shader ${n.shader.id} count=${n.useCount}`)();else{const r=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=n={shader:r,useCount:1},this.debug&&Vr.log(3,`${this}: Created new shader ${r.id}`)()}return n.shader}release(e){if(!this.cachingEnabled)return void e.destroy();const t=this._hashShader(e),n=this._cache[t];if(n)if(n.useCount--,0===n.useCount)"unused"===this.destroyPolicy&&(delete this._cache[t],n.shader.destroy(),this.debug&&Vr.log(3,`${this}: Releasing shader ${e.id}, destroyed`)());else{if(n.useCount<0)throw new Error(`ShaderFactory: Shader ${e.id} released too many times`);this.debug&&Vr.log(3,`${this}: Releasing shader ${e.id} count=${n.useCount}`)()}}_hashShader(e){return`${e.stage}:${e.source}`}};r(Ch,"defaultProps",{...zs.defaultProps});let kh=Ch,Ih=null,Ph=null;function Mh(e,t,n){if(e===t)return!0;if(!n||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!Mh(e[r],t[r],n-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){const r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(const i of r){if(!t.hasOwnProperty(i))return!1;if(!Mh(e[i],t[i],n-1))return!1}return!0}return!1}class Nh{constructor(e){r(this,"bufferLayouts"),this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){var t;return e.attributes?null==(t=e.attributes)?void 0:t.map(e=>e.attribute):[e.name]}mergeBufferLayouts(e,t){const n=[...e];for(const r of t){const e=n.findIndex(e=>e.name===r.name);e<0?n.push(r):n[e]=r}return n}getBufferIndex(e){const t=this.bufferLayouts.findIndex(t=>t.name===e);return-1===t&&Vr.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function Lh(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach(n=>{const r=e[n];var s;!function(e){return function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(e)||function(e){return!!Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}(e)}(s=r)&&"number"!=typeof s&&"boolean"!=typeof s?t.bindings[n]=r:t.uniforms[n]=r}),t}class Oh{constructor(e,t){r(this,"options",{disableWarnings:!1}),r(this,"modules"),r(this,"moduleUniforms"),r(this,"moduleBindings"),Object.assign(this.options,t);const n=br(Object.values(e).filter(e=>e.dependencies));for(const r of n)e[r.name]=r;Vr.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[r,s]of Object.entries(e))this._addModule(s),s.name&&r!==s.name&&!this.options.disableWarnings&&Vr.warn(`Module name: ${r} vs ${s.name}`)()}destroy(){}setProps(e){var t;for(const n of Object.keys(e)){const r=n,s=e[r]||{},i=this.modules[r];if(!i){this.options.disableWarnings||Vr.warn(`Module ${n} not found`)();continue}const o=this.moduleUniforms[r],a=this.moduleBindings[r],l=(null==(t=i.getUniforms)?void 0:t.call(i,s,o))||s,{uniforms:c,bindings:u}=Lh(l);this.moduleUniforms[r]={...o,...c},this.moduleBindings[r]={...a,...u}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var e;const t={};for(const[n,r]of Object.entries(this.moduleUniforms))for(const[s,i]of Object.entries(r))t[`${n}.${s}`]={type:null==(e=this.modules[n].uniformTypes)?void 0:e[s],value:String(i)};return t}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}const Fh=["+X","-X","+Y","-Y","+Z","-Z"],Dh=["+X","-X","+Y","-Y","+Z","-Z"],Bh=class e{constructor(t,n){r(this,"device"),r(this,"id"),r(this,"props"),r(this,"texture"),r(this,"sampler"),r(this,"view"),r(this,"ready"),r(this,"isReady",!1),r(this,"destroyed",!1),r(this,"resolveReady",()=>{}),r(this,"rejectReady",()=>{}),this.device=t;const s=Th("async-texture");this.props={...e.defaultProps,id:s,...n},this.id=this.props.id,"string"==typeof(null==(n={...n})?void 0:n.data)&&"2d"===n.dimension&&(n.data=async function(e){const t=new Image;return t.crossOrigin="anonymous",t.src=e.startsWith("http")?e:""+e,await t.decode(),await createImageBitmap(t)}(n.data)),n.mipmaps&&(n.mipLevels="auto"),this.ready=new Promise((e,t)=>{this.resolveReady=()=>{this.isReady=!0,e()},this.rejectReady=t}),this.initAsync(n)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){const t=e.data,n=await jh(t).then(void 0,this.rejectReady);if(this.destroyed)return;const r=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(n);if(!r)throw new Error("Texture size could not be determined");const s={...r,...e,data:void 0,mipLevels:1},i=this.device.getMipLevelCount(s.width,s.height);if(s.mipLevels="auto"===this.props.mipLevels?i:Math.min(i,this.props.mipLevels),this.texture=this.device.createTexture(s),this.sampler=this.texture.sampler,this.view=this.texture.view,e.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,n);break;case"2d":this._setTexture2DData(n);break;case"3d":this._setTexture3DData(this.texture,n);break;case"2d-array":this._setTextureArrayData(this.texture,n);break;case"cube":this._setTextureCubeData(this.texture,n);break;case"cube-array":this._setTextureCubeArrayData(this.texture,n)}this.props.mipmaps&&this.generateMipmaps(),Vr.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(e={}){this.texture.setSampler(e instanceof Ls?e:this.device.createSampler(e))}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}isTextureLevelData(e){const t=null==e?void 0:e.data;return ArrayBuffer.isView(t)}getTextureDataSize(e){if(!e)return null;if(ArrayBuffer.isView(e))return null;if(Array.isArray(e))return this.getTextureDataSize(e[0]);if(this.device.isExternalImage(e))return this.device.getExternalImageSize(e);if(e&&"object"==typeof e&&e.constructor===Object){const t=Object.values(e)[0];return{width:t.width,height:t.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}setTextureData(e){}_setTexture1DData(e,t){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(e,t=0){if(!this.texture)throw new Error("Texture not initialized");const n=this._normalizeTextureData(e);n.length>1&&!1!==this.props.mipmaps&&Vr.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let r=0;r<n.length;r++){const e=n[r];this.device.isExternalImage(e)?this.texture.copyExternalImage({image:e,depth:t,mipLevel:r,flipY:!0}):this.texture.copyImageData({data:e.data,mipLevel:r})}}_setTexture3DData(e,t){var n;if("3d"!==(null==(n=this.texture)?void 0:n.props.dimension))throw new Error(this.id);for(let r=0;r<t.length;r++)this._setTexture2DData(t[r],r)}_setTextureCubeData(e,t){var n;if("cube"!==(null==(n=this.texture)?void 0:n.props.dimension))throw new Error(this.id);for(const[r,s]of Object.entries(t)){const e=Dh.indexOf(r);this._setTexture2DData(s,e)}}_setTextureArrayData(e,t){var n;if("2d-array"!==(null==(n=this.texture)?void 0:n.props.dimension))throw new Error(this.id);for(let r=0;r<t.length;r++)this._setTexture2DData(t[r],r)}_setTextureCubeArrayData(e,t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(e,t,n,r=0){Array.isArray(t)&&t.length>1&&!1!==this.props.mipmaps&&Vr.warn(`${this.id} has mipmap and multiple LODs.`)();const s=Fh.indexOf(n);this._setTexture2DData(t,s)}_normalizeTextureData(e){const t=this.texture;let n;return n=ArrayBuffer.isView(e)?[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?e:[e],n}};r(Bh,"defaultProps",{...Ds.defaultProps,data:null,mipmaps:!1});let Uh=Bh;async function jh(e){if(e=await e,Array.isArray(e))return await Promise.all(e.map(jh));if(e&&"object"==typeof e&&e.constructor===Object){const t=e,n=await Promise.all(Object.values(t)),r=Object.keys(t),s={};for(let e=0;e<r.length;e++)s[r[e]]=n[e];return s}return e}const Vh=class e{constructor(t,n){var s,i,o,a;r(this,"device"),r(this,"id"),r(this,"source"),r(this,"vs"),r(this,"fs"),r(this,"pipelineFactory"),r(this,"shaderFactory"),r(this,"userData",{}),r(this,"parameters"),r(this,"topology"),r(this,"bufferLayout"),r(this,"isInstanced"),r(this,"instanceCount",0),r(this,"vertexCount"),r(this,"indexBuffer",null),r(this,"bufferAttributes",{}),r(this,"constantAttributes",{}),r(this,"bindings",{}),r(this,"vertexArray"),r(this,"transformFeedback",null),r(this,"pipeline"),r(this,"shaderInputs"),r(this,"_uniformStore"),r(this,"_attributeInfos",{}),r(this,"_gpuGeometry",null),r(this,"props"),r(this,"_pipelineNeedsUpdate","newly created"),r(this,"_needsRedraw","initializing"),r(this,"_destroyed",!1),r(this,"_lastDrawTimestamp",-1),r(this,"_lastLogTime",0),r(this,"_logOpen",!1),r(this,"_drawCount",0),this.props={...e.defaultProps,...n},n=this.props,this.id=n.id||Th("model"),this.device=t,Object.assign(this.userData,n.userData);const l=Object.fromEntries((null==(s=this.props.modules)?void 0:s.map(e=>[e.name,e]))||[]),c=n.shaderInputs||new Oh(l,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(c);const u=function(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}(t),h=((null==(i=this.props.modules)?void 0:i.length)>0?this.props.modules:null==(o=this.shaderInputs)?void 0:o.getModules())||[];if("webgpu"===this.device.type&&this.props.source){const{source:e,getUniforms:t}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:u,...this.props,modules:h});this.source=e,this._getModuleUniforms=t,(a=this.props).shaderLayout||(a.shaderLayout=function(e){var t;const n={attributes:[],bindings:[]};let r;try{r=function(e){try{return new Ba(e)}catch(t){if(t instanceof Error)throw t;let e="WGSL parse error";throw"object"==typeof t&&(null==t?void 0:t.message)&&(e+=`: ${t.message} `),"object"==typeof t&&(null==t?void 0:t.token)&&(e+=t.token.line||""),new Error(e,{cause:t})}}(e)}catch(o){return Vr.error(o.message)(),n}for(const a of r.uniforms){const e=[];for(const n of(null==(t=a.type)?void 0:t.members)||[])e.push({name:n.name,type:Ua(n.type)});n.bindings.push({type:"uniform",name:a.name,group:a.group,location:a.binding,members:e})}for(const a of r.textures)n.bindings.push({type:"texture",name:a.name,group:a.group,location:a.binding});for(const a of r.samplers)n.bindings.push({type:"sampler",name:a.name,group:a.group,location:a.binding});const s=r.entry.vertex[0],i=(null==s?void 0:s.inputs.length)||0;for(let a=0;a<i;a++){const e=s.inputs[a];if("location"===e.locationType){const t=Ua(e.type);n.attributes.push({name:e.name,location:Number(e.location),type:t})}}return n}(this.source))}else{const{vs:e,fs:t,getUniforms:n}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:u,...this.props,modules:h});this.vs=e,this.fs=t,this._getModuleUniforms=n}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||Rh.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||kh.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=t.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in n&&(this.isInstanced=n.isInstanced),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.vertexCount&&this.setVertexCount(n.vertexCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),null==(e=this._gpuGeometry)||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return Vr.info(2,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const t=this._getBindings();this.pipeline.setBindings(t,{disableWarnings:this.props.disableWarnings});const{indexBuffer:r}=this.vertexArray,s=r?r.byteLength/("uint32"===r.indexType?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:s,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var t;null==(t=this._gpuGeometry)||t.destroy();const n=e&&function(e,t){if(t instanceof Sh)return t;const n=function(e,t){if(!t.indices)return;const n=t.indices.value;return e.createBuffer({usage:$r.INDEX,data:n})}(e,t),{attributes:r,bufferLayout:s}=function(e,t){const n=[],r={};for(const[s,i]of Object.entries(t.attributes)){let t=s;switch(s){case"POSITION":t="positions";break;case"NORMAL":t="normals";break;case"TEXCOORD_0":t="texCoords";break;case"COLOR_0":t="colors"}if(i){r[t]=e.createBuffer({data:i.value,id:`${s}-buffer`});const{value:o,size:a,normalized:l}=i;n.push({name:t,format:Jr(o,a,l)})}}return{attributes:r,bufferLayout:n,vertexCount:t._calculateVertexCount(t.attributes,t.indices)}}(e,t);return new Sh({topology:t.topology||"triangle-list",bufferLayout:s,vertexCount:t.vertexCount,indices:n,attributes:r})}(this.device,e);if(n){this.setTopology(n.topology||"triangle-list");const e=new Nh(this.bufferLayout);this.bufferLayout=e.mergeBufferLayouts(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)}this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new Nh(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Mh(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,void 0===this.isInstanced&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new vi(this.shaderInputs.modules);for(const[t,n]of Object.entries(this.shaderInputs.modules))if(zh(n)){const e=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=e}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const n=(null==t?void 0:t.disableWarnings)??this.props.disableWarnings;e.indices&&Vr.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=function(e,t){const n=Object.fromEntries(e.attributes.map(e=>[e.name,e.location])),r=t.slice();return r.sort((e,t)=>{const r=e.attributes?e.attributes.map(e=>e.attribute):[e.name],s=t.attributes?t.attributes.map(e=>e.attribute):[t.name];return Math.min(...r.map(e=>n[e]))-Math.min(...s.map(e=>n[e]))}),r}(this.pipeline.shaderLayout,this.bufferLayout);const r=new Nh(this.bufferLayout);for(const[s,i]of Object.entries(e)){const e=r.getBufferLayout(s);if(!e){n||Vr.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}const t=r.getAttributeNamesForBuffer(e);let o=!1;for(const n of t){const e=this._attributeInfos[n];if(e){const t="webgpu"===this.device.type?r.getBufferIndex(e.bufferName):e.location;this.vertexArray.setBuffer(t,i),o=!0}}o||n||Vr.warn(`Model(${this.id}): Ignoring buffer "${i.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[n,r]of Object.entries(e)){const e=this._attributeInfos[n];e?this.vertexArray.setConstantWebGL(e.location,r):((null==t?void 0:t.disableWarnings)??this.props.disableWarnings)||Vr.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Uh&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,n]of Object.entries(this.bindings))n instanceof Uh?n.isReady&&(e[t]=n.texture):e[t]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof Us?e=Math.max(e,t.texture.updateTimestamp):t instanceof $r||t instanceof Ds?e=Math.max(e,t.updateTimestamp):t instanceof Uh?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof Ls||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[n]of Object.entries(t))this.pipeline.shaderLayout.attributes.find(e=>e.name===n)||"positions"===n||delete t[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(Vr.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let r=null;this.source?r=n:this.fs&&(r=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:r}),this._attributeInfos=ai(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=Vr.level>3?0:1e4;Vr.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Vr.group(2,`>>> DRAWING MODEL ${this.id}`,{collapsed:Vr.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=function(e){var t;const n={},r="Values";if(0===e.attributes.length&&!(null==(t=e.varyings)?void 0:t.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const s of e.attributes)s&&(n[`in ${s.location} ${s.name}: ${s.type}`]={[r]:s.stepMode||"vertex"});for(const s of e.varyings||[])n[`out ${s.location} ${s.name}`]={[r]:JSON.stringify(s)};return n}(this.pipeline.shaderLayout,this.id);Vr.table(2,e)();const t=this.shaderInputs.getDebugTable();Vr.table(2,t)();const n=this._getAttributeDebugTable();Vr.table(2,this._attributeInfos)(),Vr.table(2,n)(),Vr.groupEnd(2)(),this._logOpen=!1}}_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const n=e.props.framebuffer;n&&function(e,{id:t,minimap:n,opaque:r,top:s="0",left:i="0",rgbaScale:o=1}){Ih||(Ih=document.createElement("canvas"),Ih.id=t,Ih.title=t,Ih.style.zIndex="100",Ih.style.position="absolute",Ih.style.top=s,Ih.style.left=i,Ih.style.border="blue 5px solid",Ih.style.transform="scaleY(-1)",document.body.appendChild(Ih),Ph=Ih.getContext("2d")),Ih.width===e.width&&Ih.height===e.height||(Ih.width=e.width/2,Ih.height=e.height/2,Ih.style.width="400px",Ih.style.height="400px");const a=e.device.readPixelsToArrayWebGL(e),l=null==Ph?void 0:Ph.createImageData(e.width,e.height);if(l){const e=0;for(let t=0;t<a.length;t+=4)l.data[e+t+0]=a[t+0]*o,l.data[e+t+1]=a[t+1]*o,l.data[e+t+2]=a[t+2]*o,l.data[e+t+3]=r?255:a[t+3]*o;null==Ph||Ph.putImageData(l,0,0)}}(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,n]of Object.entries(this._attributeInfos)){const r=this.vertexArray.attributes[n.location];e[n.location]={name:t,type:n.shaderType,values:r?this._getBufferOrConstantValues(r,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,n="uint32"===t.indexType?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,t){const n=Kr(t);return(e instanceof $r?new n(e.debugData):e).toString()}};r(Vh,"defaultProps",{...qs.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Br.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Gh=Vh;function zh(e){return Boolean(e.uniformTypes&&!function(e){for(const t in e)return!1;return!0}(e.uniformTypes))}const Wh=class e{constructor(t,n=e.defaultProps){if(r(this,"device"),r(this,"model"),r(this,"transformFeedback"),!e.isSupported(t))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=t,this.model=new Gh(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||Ur(),topology:n.topology||"point-list",varyings:n.outputs||n.varyings,...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var t;return"webgl"===(null==(t=null==e?void 0:e.info)?void 0:t.type)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){(null==e?void 0:e.inputBuffers)&&this.model.setAttributes(e.inputBuffers),(null==e?void 0:e.outputBuffers)&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof $r)return t.readAsync();const{buffer:n,byteOffset:r=0,byteLength:s=n.byteLength}=t;return n.readAsync(r,s)}};r(Wh,"defaultProps",{...Gh.defaultProps,outputs:void 0,feedbackBuffers:void 0});let Hh=Wh;const $h={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class Xh extends Xu{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:n,viewports:r,onViewportActive:s,pickingFBO:i,deviceRect:{x:o,y:a,width:l,height:c},cullRect:u,effects:h,pass:d="picking",pickZ:f,shaderModuleProps:p}){this.pickZ=f;const g=this._resetColorEncoder(f),m=[o,a,l,c],_=super.render({target:i,layers:e,layerFilter:t,views:n,viewports:r,onViewportActive:s,cullRect:u,effects:null==h?void 0:h.filter(e=>e.useInPicking),pass:d,isPicking:!0,shaderModuleProps:p,clearColor:[0,0,0,0],colorMask:15,scissorRect:m});return this._colorEncoderState=null,{decodePickingColor:g&&qh.bind(null,g),stats:_}}shouldDrawLayer(e){const{pickable:t,operation:n}=e.props;return t&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(e,t,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,n){const r={...e.props.parameters},{pickable:s,operation:i}=e.props;return!this._colorEncoderState||i.includes("terrain")?r.blend=!1:s&&i.includes("draw")&&(Object.assign(r,$h),r.blend=!0,r.blendColor=function(e,t,n){const{byLayer:r,byAlpha:s}=e;let i,o=r.get(t);return o?(o.viewports.push(n),i=o.a):(i=r.size+1,i<=255?(o={a:i,layer:t,viewports:[n]},r.set(t,o),s[i]=o):(Qn.warn("Too many pickable layers, only picking the first 255")(),i=0)),[0,0,0,i/255]}(this._colorEncoderState,e,n)),r}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function qh(e,t){const n=e.byAlpha[t[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(t)}}const Yh=Symbol.for("component"),Kh=Symbol.for("propTypes"),Zh=Symbol.for("deprecatedProps"),Qh=Symbol.for("asyncPropDefaults"),Jh=Symbol.for("asyncPropOriginal"),ed=Symbol.for("asyncPropResolved");function td(e,t=()=>!0){return Array.isArray(e)?nd(e,t,[]):t(e)?[e]:[]}function nd(e,t,n){let r=-1;for(;++r<e.length;){const s=e[r];Array.isArray(s)?nd(s,t,n):t(s)&&n.push(s)}return n}function rd({target:e,source:t,start:n=0,count:r=1}){const s=t.length,i=r*s;let o=0;for(let a=n;o<s;o++)e[a++]=t[o];for(;o<i;)o<i-o?(e.copyWithin(n+o,n,n+o),o*=2):(e.copyWithin(n+o,n,n+i-o),o=i);return e}class sd{constructor(e,t,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const n=++this._loadCount;let r=e;"string"==typeof e&&(r=Ln(e)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(e=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=e)}).catch(e=>{this._loadCount===n&&(this.isLoaded=!0,this._error=e||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class id{constructor(e){var t;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:null==(t=e.device)?void 0:t.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return!!e.startsWith(this.protocol)||e in this._resources}add({resourceId:e,data:t,forceUpdate:n=!1,persistent:r=!0}){let s=this._resources[e];s?s.setData(t,n):(s=new sd(e,t,this._context),this._resources[e]=s),s.persistent=r}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const e in t){const n=t[e],r=this._resources[n.resourceId];r&&r.unsubscribe(n)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:n,requestId:r="default"}){const{_resources:s,protocol:i}=this;e.startsWith(i)&&(s[e=e.replace(i,"")]||this.add({resourceId:e,data:null,persistent:!1}));const o=s[e];if(this._track(n,r,o,t),o)return o.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,n,r){const s=this._consumers,i=s[e]=s[e]||{};let o=i[t];const a=o&&o.resourceId&&this._resources[o.resourceId];a&&(a.unsubscribe(o),this.prune()),n&&(o?(o.onChange=r,o.resourceId=n.id):o={onChange:r,resourceId:n.id},i[t]=o,n.subscribe(o))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];t.persistent||t.inUse()||(t.delete(),delete this._resources[e])}}}class od{constructor(e,t){var n;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=e=>{tr("layerManager.activateViewport",this,e),e&&(this.context.viewport=e)};const{deck:r,stats:s,viewport:i,timeline:o}=t||{};this.layers=[],this.resourceManager=new id({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:null==e?void 0:e.gl,deck:r,shaderAssembler:Fu((null==(n=null==e?void 0:e.info)?void 0:n.shadingLanguage)||"glsl"),defaultShaderModules:[Ml],renderPass:void 0,stats:s||new Ut({id:"deck.gl"}),viewport:i||new dh({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new bh,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const r=n.getNeedsRedraw(e);t=t||r}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(e=>0===t.id.indexOf(e))):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){tr("layerManager.setLayers",this,t,e),this._lastRenderedLayers=e;const n=td(e,Boolean);for(const r of n)r.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(t=>t.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,n=t.findIndex(t=>t.name===e.name);n>=0&&(t.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,n){n.raiseError(t,`${e} of ${n}`)}_updateLayers(e,t){const n={};for(const i of e)n[i.id]?Qn.warn(`Multiple old layers with same id ${i.id}`)():n[i.id]=i;if(this._defaultShaderModulesChanged){for(const t of e)t.setNeedsUpdate(),t.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const r=[];this._updateSublayersRecursively(t,n,r),this._finalizeOldLayers(n);let s=!1;for(const i of r)if(i.hasUniformTransition()){s=`Uniform transition in ${i}`;break}this._needsUpdate=s,this.layers=r}_updateSublayersRecursively(e,t,n){for(const s of e){s.context=this.context;const e=t[s.id];null===e&&Qn.warn(`Multiple new layers with same id ${s.id}`)(),t[s.id]=null;let i=null;try{this._debug&&e!==s&&s.validateProps(),e?(this._transferLayerState(e,s),this._updateLayer(s)):this._initializeLayer(s),n.push(s),i=s.isComposite?s.getSubLayers():null}catch(r){this._handleError("matching",r,s)}i&&this._updateSublayersRecursively(i,t,n)}}_finalizeOldLayers(e){for(const t in e){const n=e[t];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle="Initialized"}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle="Matched. State transferred from previous layer",t!==e&&(e.lifecycle="Discarded. Awaiting garbage collection")}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle="No longer matched. Awaiting garbage collection";try{e._finalize(),e.lifecycle="Finalized! Awaiting garbage collection"}catch(t){this._handleError("finalization",t,e)}}}function ad(e,t,n){if(e===t)return!0;if(!n||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!ad(e[r],t[r],n-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){const r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(const i of r){if(!t.hasOwnProperty(i))return!1;if(!ad(e[i],t[i],n-1))return!1}return!0}return!1}class ld{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t="string"==typeof e?this.getView(e):e,n=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,t){const n=this.getViewports(),r={x:e[0],y:e[1]};for(let s=n.length-1;s>=0;--s){const i=n[s];if(i.containsPixel(r)){const n=e.slice();return n[0]-=i.x,n[1]-=i.y,i.unproject(n,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){e===this.width&&t===this.height||(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=td(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!ad(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Qn.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const n=new(0,t.type)({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:t=>{var n;return null==(n=this.getView(e.id))?void 0:n.makeViewport({viewState:t,width:this.width,height:this.height})}});return n}_updateController(e,t,n,r){const s=e.controller;if(s&&n){const i={...t,...s,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return r&&r.constructor===s.type||(r=this._createController(e,i)),r&&r.setProps(i),r}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let r=e.length;r--;){const s=e[r],i=this.getViewState(s),o=s.makeViewport({viewState:i,width:this.width,height:this.height});let a=t[s.id];const l=Boolean(s.controller);l&&!a&&(n=!0),!n&&l||!a||(a.finalize(),a=null),this.controllers[s.id]=this._updateController(s,i,o,a),o&&this._viewports.unshift(o)}for(const r in t){const e=t[r];e&&!this.controllers[r]&&e.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length||e.some((n,r)=>!e[r].equals(t[r]))}}const cd=/([0-9]+\.?[0-9]*)(%|px)/;function ud(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":const t=cd.exec(e);if(t&&t.length>=3){const e="%"===t[2],n=parseFloat(t[1]);return{position:e?n/100:n,relative:e}}default:throw new Error(`Could not parse position string ${e}`)}}function hd(e,t){return e.relative?Math.round(e.position*t):e.position}class dd{constructor(e){const{id:t,x:n=0,y:r=0,width:s="100%",height:i="100%",padding:o=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=ud(n),this._y=ud(r),this._width=ud(s),this._height=ud(i),this._padding=o&&{left:ud(o.left||0),right:ud(o.right||0),top:ud(o.top||0),bottom:ud(o.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e||this.constructor===e.constructor&&ad(this.props,e.props,2)}clone(e){return new(0,this.constructor)({...this.props,...e})}makeViewport({width:e,height:t,viewState:n}){n=this.filterViewState(n);const r=this.getDimensions({width:e,height:t});return r.height&&r.width?new(this.getViewportType(n))({...n,...this.props,...r}):null}getViewStateId(){const{viewState:e}=this.props;return"string"==typeof e?e:(null==e?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&"object"==typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const e in this.props.viewState)"id"!==e&&(t[e]=this.props.viewState[e]);return t}return e}getDimensions({width:e,height:t}){const n={x:hd(this._x,e),y:hd(this._y,t),width:hd(this._width,e),height:hd(this._height,t)};return this._padding&&(n.padding={left:hd(this._padding.left,e),top:hd(this._padding.top,t),right:hd(this._padding.right,e),bottom:hd(this._padding.bottom,t)}),n}get controller(){const e=this.props.controller;return e?!0===e?{type:this.ControllerType}:"function"==typeof e?{type:e}:{type:this.ControllerType,...e}:null}}class fd{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,n;this.cancel(),this.settings=e,this._inProgress=!0,null==(n=(t=this.settings).onStart)||n.call(t,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,null==(t=(e=this.settings).onEnd)||t.call(e,this))}cancel(){var e,t;this._inProgress&&(null==(t=(e=this.settings).onInterrupt)||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(null===this._handle){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),null==(t=(e=this.settings).onUpdate)||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const pd=()=>{},gd=e=>e;class md{constructor(e){this._onTransitionUpdate=e=>{const{time:t,settings:{interpolator:n,startProps:r,endProps:s,duration:i,easing:o}}=e,a=o(t/i),l=n.interpolateProps(r,s,a);this.propsInTransition=this.getControllerState({...this.props,...l}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new fd(e.timeline),this.onViewStateChange=e.onViewStateChange||pd,this.onStateChange=e.onStateChange||pd}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let r=n;if(this.transition.inProgress){const{interruption:e,endProps:t}=this.transition.settings;r={...n,...2===e?t:this.propsInTransition||n}}this._triggerTransition(r,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:n}=e;return(t>0||"auto"===t)&&Boolean(n)}_isUpdateDueToCurrentTransition(e){return!(!this.transition.inProgress||!this.propsInTransition)&&this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition)}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?3===this.transition.settings.interruption||this._isUpdateDueToCurrentTransition(t):!this._isTransitionEnabled(t)||t.transitionInterpolator.arePropsEqual(e,t)}_triggerTransition(e,t){const n=this.getControllerState(e),r=this.getControllerState(t).shortestPathFrom(n),s=t.transitionInterpolator,i=s.getDuration?s.getDuration(e,t):t.transitionDuration;if(0===i)return;const o=s.initializeProps(e,r);this.propsInTransition={};const a={duration:i,easing:t.transitionEasing||gd,interpolator:s,interruption:t.transitionInterruption||1,startProps:o.start,endProps:o.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(a),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),null==e||e(t)}}}function _d(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}class yd{constructor(e){const{compare:t,extract:n,required:r}=e;this._propsToCompare=t,this._propsToExtract=n||t,this._requiredProps=r}arePropsEqual(e,t){for(const n of this._propsToCompare)if(!(n in e)||!(n in t)||!Ha(e[n],t[n]))return!1;return!0}initializeProps(e,t){const n={},r={};for(const s of this._propsToExtract)(s in e||s in t)&&(n[s]=e[s],r[s]=t[s]);return this._checkRequiredProps(n),this._checkRequiredProps(r),{start:n,end:r}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const n=e[t];_d(Number.isFinite(n)||Array.isArray(n),`${t} is required for transition`)})}}const bd=["longitude","latitude","zoom","bearing","pitch"],vd=["longitude","latitude","zoom"];class xd extends yd{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:bd,required:vd},super(n.transitionProps),this.opts=n}initializeProps(e,t){const n=super.initializeProps(e,t),{makeViewport:r,around:s}=this.opts;if(r&&s){const i=r(e),o=r(t),a=i.unproject(s);n.start.around=s,Object.assign(n.end,{around:o.project(a),aroundPosition:a,width:t.width,height:t.height})}return n}interpolateProps(e,t,n){const r={};for(const s of this._propsToExtract)r[s]=Wa(e[s]||0,t[s]||0,n);if(t.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...t,...r});Object.assign(r,s.panByPosition(t.aroundPosition,Wa(e.around,t.around,n)))}return r}}const wd={transitionDuration:0},Ed=e=>1-(1-e)*(1-e),Td=["wheel"],Sd=["panstart","panmove","panend"],Ad=["pinchstart","pinchmove","pinchend"],Rd=["multipanstart","multipanmove","multipanend"],Cd=["dblclick"],kd=["keydown"],Id={};class Pd{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new md({...e,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const t in this._events)this._events[t]&&(null==(e=this.eventManager)||e.off(t,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return!t&&this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return!t&&this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return!t&&this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:n}=this.props,{offsetCenter:r}=e;return[r.x-t,r.y-n]}isPointInBounds(e,t){const{width:n,height:r}=this.props;if(t&&t.handled)return!1;const s=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=r;return s&&t&&t.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:t}=e;return Boolean(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:!0===t?300:0;const{scrollZoom:n=!0,dragPan:r=!0,dragRotate:s=!0,doubleClickZoom:i=!0,touchZoom:o=!0,touchRotate:a=!1,keyboard:l=!0}=e,c=Boolean(this.onViewStateChange);this.toggleEvents(Td,c&&n),this.toggleEvents(Sd,c),this.toggleEvents(Ad,c&&(o||a)),this.toggleEvents(Rd,c&&a),this.toggleEvents(Cd,c&&i),this.toggleEvents(kd,c&&l),this.scrollZoom=n,this.dragPan=r,this.dragRotate=s,this.doubleClickZoom=i,this.touchZoom=o,this.touchRotate=a,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(e=>{this._events[e]!==t&&(this._events[e]=t,t?this.eventManager.on(e,this.handleEvent):this.eventManager.off(e,this.handleEvent))})}updateViewport(e,t=null,n={}){const r={...e.getViewportProps(),...t},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),s){const e=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:e,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||"pan"===this.dragMode)&&(n=!n);const r=this.controllerState[n?"panStart":"rotateStart"]({pos:t});return this._panMove=n,this.updateViewport(r,wd,{isDragging:!0}),!0}_onPan(e){return!!this.isDragging()&&(this._panMove?this._onPanMove(e):this._onPanRotate(e))}_onPanEnd(e){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e))}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),n=this.controllerState.pan({pos:t});return this.updateViewport(n,wd,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const n=this.getCenter(e),r=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],s=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Ed},{isDragging:!1,isPanning:!0})}else{const e=this.controllerState.panEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),n=this.controllerState.rotate({pos:t});return this.updateViewport(n,wd,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const n=this.getCenter(e),r=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],s=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Ed},{isDragging:!1,isRotating:!0})}else{const e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:r=!1}=!0===this.scrollZoom?{}:this.scrollZoom,{delta:s}=e;let i=2/(1+Math.exp(-Math.abs(s*n)));s<0&&0!==i&&(i=1/i);const o=r?{...this._getTransitionProps({around:t}),transitionDuration:250}:wd,a=this.controllerState.zoom({pos:t,scale:i});return this.updateViewport(a,o,{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.rotateStart({pos:t});return this.updateViewport(n,wd,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate)return!1;if(!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const n=this.controllerState.rotate({pos:t});return this.updateViewport(n,wd,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const n=this.getCenter(e),r=[n[0],n[1]+=e.velocityY*t/2],s=this.controllerState.rotate({pos:r});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Ed},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Id._startPinchRotation=e.rotation,Id._lastPinchEvent=e,this.updateViewport(n,wd,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate)return!1;if(!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:n}=e,r=this.getCenter(e);t=t.zoom({pos:r,scale:n})}if(this.touchRotate){const{rotation:n}=e;t=t.rotate({deltaAngleX:Id._startPinchRotation-n})}return this.updateViewport(t,wd,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Id._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:n}=Id;if(this.touchZoom&&t&&n&&e.scale!==n.scale){const r=this.getCenter(e);let s=this.controllerState.rotateEnd();const i=Math.log2(e.scale),o=(i-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),a=Math.pow(2,i+o*t/2);s=s.zoom({pos:r,scale:a}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:r}),transitionDuration:t,transitionEasing:Ed},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const e=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Id._startPinchRotation=null,Id._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.isFunctionKeyPressed(e),r=this.controllerState.zoom({pos:t,scale:n?.5:2});return this.updateViewport(r,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:r,rotateSpeedX:s,rotateSpeedY:i}=!0===this.keyboard?{}:this.keyboard,{controllerState:o}=this;let a;const l={};switch(e.srcEvent.code){case"Minus":a=t?o.zoomOut(n).zoomOut(n):o.zoomOut(n),l.isZooming=!0;break;case"Equal":a=t?o.zoomIn(n).zoomIn(n):o.zoomIn(n),l.isZooming=!0;break;case"ArrowLeft":t?(a=o.rotateLeft(s),l.isRotating=!0):(a=o.moveLeft(r),l.isPanning=!0);break;case"ArrowRight":t?(a=o.rotateRight(s),l.isRotating=!0):(a=o.moveRight(r),l.isPanning=!0);break;case"ArrowUp":t?(a=o.rotateUp(i),l.isRotating=!0):(a=o.moveUp(r),l.isPanning=!0);break;case"ArrowDown":t?(a=o.rotateDown(i),l.isRotating=!0):(a=o.moveDown(r),l.isPanning=!0);break;default:return!1}return this.updateViewport(a,this._getTransitionProps(),l),!0}_getTransitionProps(e){const{transition:t}=this;return t&&t.transitionInterpolator?e?{...t,transitionInterpolator:new xd({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t:wd}}class Md{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}class Nd extends Md{constructor(e){const{width:t,height:n,latitude:r,longitude:s,zoom:i,bearing:o=0,pitch:a=0,altitude:l=1.5,position:c=[0,0,0],maxZoom:u=20,minZoom:h=0,maxPitch:d=60,minPitch:f=0,startPanLngLat:p,startZoomLngLat:g,startRotatePos:m,startBearing:_,startPitch:y,startZoom:b,normalize:v=!0}=e;_d(Number.isFinite(s)),_d(Number.isFinite(r)),_d(Number.isFinite(i)),super({width:t,height:n,latitude:r,longitude:s,zoom:i,bearing:o,pitch:a,altitude:l,maxZoom:u,minZoom:h,maxPitch:d,minPitch:f,normalize:v,position:c},{startPanLngLat:p,startZoomLngLat:g,startRotatePos:m,startBearing:_,startPitch:y,startZoom:b}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const n=this.getState().startPanLngLat||this._unproject(t);if(!n)return this;const r=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(r)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:n=0}){const{startRotatePos:r,startBearing:s,startPitch:i}=this.getState();if(!r||void 0===s||void 0===i)return this;let o;return o=e?this._getNewRotation(e,r,i,s):{bearing:s+t,pitch:i+n},this._getUpdatedState(o)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:n}){let{startZoom:r,startZoomLngLat:s}=this.getState();if(s||(r=this.getViewportProps().zoom,s=this._unproject(t)||this._unproject(e)),!s)return this;const{maxZoom:i,minZoom:o}=this.getViewportProps();let a=r+Math.log2(n);a=za(a,o,i);const l=this.makeViewport({...this.getViewportProps(),zoom:a});return this._getUpdatedState({zoom:a,...l.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),n={...this.getViewportProps()},{bearing:r,longitude:s}=n;return Math.abs(r-t.bearing)>180&&(n.bearing=r<0?r+360:r-360),Math.abs(s-t.longitude)>180&&(n.longitude=s<0?s+360:s-360),n}applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:r}=e;e.zoom=za(r,n,t);const{maxPitch:s,minPitch:i,pitch:o}=e;e.pitch=za(o,i,s);const{normalize:a=!0}=e;return a&&Object.assign(e,function(e){const{width:t,height:n,pitch:r=0}=e;let{longitude:s,latitude:i,zoom:o,bearing:a=0}=e;(s<-180||s>180)&&(s=nu(s+180,360)-180),(a<-180||a>180)&&(a=nu(a+180,360)-180);const l=su(n/512);if(o<=l)o=l,i=0;else{const e=n/2/Math.pow(2,o),t=pu([0,e])[1];if(i<t)i=t;else{const t=pu([0,512-e])[1];i>t&&(i=t)}}return{width:t,height:n,longitude:s,latitude:i,zoom:o,pitch:r,bearing:a}}(e)),e}_zoomFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.zoom({pos:[t/2,n/2],scale:e})}_panFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.pan({startPos:[t/2,n/2],pos:[t/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,n,r){const s=e[0]-t[0],i=e[1]-t[1],o=e[1],a=t[1],{width:l,height:c}=this.getViewportProps(),u=s/l;let h=0;i>0?Math.abs(c-a)>5&&(h=i/(a-c)*1.2):i<0&&a>5&&(h=1-o/a),h=za(h,-1,1);const{minPitch:d,maxPitch:f}=this.getViewportProps();let p=n;return h>0?p=n+h*(f-n):h<0&&(p=n-h*(d-n)),{pitch:p,bearing:r+180*u}}}class Ld extends Pd{constructor(){super(...arguments),this.ControllerState=Nd,this.transition={transitionDuration:300,transitionInterpolator:new xd({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class Od extends dd{constructor(e={}){super(e)}getViewportType(){return fh}get ControllerType(){return Ld}}Od.displayName="MapView";const Fd=new eh;class Dd{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(t=>t.id===e.id)){const n=t.findIndex(t=>function(e,t){return(e.order??1/0)-(t.order??1/0)}(t,e)>0);n<0?t.push(e):t.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(ad(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const r of this.effects)t[r.id]=r;const n=[];for(const r of e){const e=t[r.id];let s=r;e&&e!==r?e.setProps?(e.setProps(r.props),s=e):e.cleanup(this._context):e||r.setup(this._context),n.push(s),delete t[r.id]}for(const r in t)t[r].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(e=>e instanceof eh)||this._resolvedEffects.push(Fd),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class Bd extends Xu{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}class Ud{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Bd(e),this.pickLayersPass=new Xh(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const r=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const s=t.render({...n,target:r});n.effects&&(this.lastPostProcessEffect&&(n.clearCanvas=void 0===e.clearCanvas||e.clearCanvas),this._postRender(n.effects,n)),this.renderCount++,tr("deckRenderer.renderLayers",this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const n of e)t.preRenderStats[n.id]=n.preRender(t),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize(),[n,r]=t;0===e.length&&[0,1].map(t=>{const s=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:n,height:r});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${t}`,colorAttachments:[s]}))});for(const s of e)s.resize(t)}_postRender(e,t){const{renderBuffers:n}=this,r={...t,inputBuffer:n[0],swapBuffer:n[1]};for(const s of e)if(s.postRender){r.target=s.id===this.lastPostProcessEffect?t.target:void 0;const e=s.postRender(r);r.inputBuffer=e,r.swapBuffer=e===n[0]?n[1]:n[0]}}}const jd={pickedColor:null,pickedObjectIndex:-1};function Vd({pickedColors:e,decodePickingColor:t,deviceX:n,deviceY:r,deviceRadius:s,deviceRect:i}){const{x:o,y:a,width:l,height:c}=i;let u=s*s,h=-1,d=0;for(let f=0;f<c;f++){const t=f+a-r,s=t*t;if(s>u)d+=4*l;else for(let r=0;r<l;r++){if(e[d+3]-1>=0){const e=r+o-n,t=e*e+s;t<=u&&(u=t,h=d)}d+=4}}if(h>=0){const n=e.slice(h,h+4),r=t(n);if(r){const e=Math.floor(h/4/l),t=h/4-e*l;return{...r,pickedColor:n,pickedX:o+t,pickedY:a+e}}Qn.error("Picked non-existent layer. Is picking buffer corrupt?")()}return jd}function Gd({pickedColors:e,decodePickingColor:t}){const n=new Map;if(e)for(let r=0;r<e.length;r+=4)if(e[r+3]-1>=0){const s=e.slice(r,r+4),i=s.join(",");if(!n.has(i)){const e=t(s);e?n.set(i,{...e,color:s}):Qn.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return Array.from(n.values())}function zd({pickInfo:e,viewports:t,pixelRatio:n,x:r,y:s,z:i}){let o,a=t[0];if(t.length>1&&(a=function(e,t){for(let n=e.length-1;n>=0;n--){const r=e[n];if(r.containsPixel(t))return r}return e[0]}((null==e?void 0:e.pickedViewports)||t,{x:r,y:s})),a){const e=[r-a.x,s-a.y];void 0!==i&&(e[2]=i),o=a.unproject(e)}return{color:null,layer:null,viewport:a,index:-1,picked:!1,x:r,y:s,pixel:[r,s],coordinate:o,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:n}}function Wd(e){const{pickInfo:t,lastPickedInfo:n,mode:r,layers:s}=e,{pickedColor:i,pickedLayer:o,pickedObjectIndex:a}=t,l=o?[o]:[];if("hover"===r){const e=n.index,t=n.layerId,r=o?o.props.id:null;if(r!==t||a!==e){if(r!==t){const e=s.find(e=>e.props.id===t);e&&l.unshift(e)}n.layerId=r,n.index=a,n.info=null}}const c=zd(e),u=new Map;return u.set(null,c),l.forEach(e=>{let t={...c};e===o&&(t.color=i,t.index=a,t.picked=!0),t=Hd({layer:e,info:t,mode:r});const s=t.layer;e===o&&"hover"===r&&(n.info=t),u.set(s.id,t),"hover"===r&&s.updateAutoHighlight(t)}),u}function Hd({layer:e,info:t,mode:n}){for(;e&&t;){const r=t.layer||null;t.sourceLayer=r,t.layer=e,t=e.getPickingInfo({info:t,mode:n,sourceLayer:r}),e=e.parent}return t}class $d{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new Xh(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(e){return this._pickClosestObjectAsync(e)}pickObjectsAsync(e){return this._pickVisibleObjectsAsync(e)}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:n,viewports:r},s=this.lastPickedInfo.info){const i=s&&s.layer&&s.layer.id,o=s&&s.viewport&&s.viewport.id,a=i?n.find(e=>e.id===i):null,l=o&&r.find(e=>e.id===o)||r[0],c=l&&l.unproject([e-l.x,t-l.y]),u={x:e,y:t,viewport:l,coordinate:c,layer:a};return{...s,...u}}_resizeBuffer(){var e,t;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const e=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=e}const{canvas:n}=this.device.getDefaultCanvasContext();null==(e=this.pickingFBO)||e.resize({width:n.width,height:n.height}),null==(t=this.depthFBO)||t.resize({width:n.width,height:n.height})}_getPickable(e){if(!1===this._pickable)return null;const t=e.filter(e=>this.pickLayersPass.shouldDrawLayer(e)&&!e.isComposite);return t.length?t:null}async _pickClosestObjectAsync({layers:e,views:t,viewports:n,x:r,y:s,radius:i=0,depth:o=1,mode:a="query",unproject3D:l,onViewportActive:c,effects:u}){const h=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(e);if(!d||0===n.length)return{result:[],emptyInfo:zd({viewports:n,x:r,y:s,pixelRatio:h})};this._resizeBuffer();const f=this.device.canvasContext.cssToDevicePixels([r,s],!0),p=[f.x+Math.floor(f.width/2),f.y+Math.floor(f.height/2)],g=Math.round(i*h),{width:m,height:_}=this.pickingFBO,y=this._getPickingRect({deviceX:p[0],deviceY:p[1],deviceRadius:g,deviceWidth:m,deviceHeight:_}),b={x:r-i,y:s-i,width:2*i+1,height:2*i+1};let v;const x=[],w=new Set;for(let E=0;E<o;E++){let e,i;if(e=y?Vd({...this._drawAndSample({layers:d,views:t,viewports:n,onViewportActive:c,deviceRect:y,cullRect:b,effects:u,pass:`picking:${a}`}),deviceX:p[0],deviceY:p[1],deviceRadius:g,deviceRect:y}):{pickedColor:null,pickedObjectIndex:-1},e.pickedLayer&&l&&this.depthFBO){const{pickedColors:r}=this._drawAndSample({layers:[e.pickedLayer],views:t,viewports:n,onViewportActive:c,deviceRect:{x:e.pickedX,y:e.pickedY,width:1,height:1},cullRect:b,effects:u,pass:`picking:${a}:z`},!0);r[3]&&(i=r[0])}e.pickedLayer&&E+1<o&&(w.add(e.pickedLayer),e.pickedLayer.disablePickingIndex(e.pickedObjectIndex)),v=Wd({pickInfo:e,lastPickedInfo:this.lastPickedInfo,mode:a,layers:d,viewports:n,x:r,y:s,z:i,pixelRatio:h});for(const t of v.values())t.layer&&x.push(t);if(!e.pickedColor)break}for(const E of w)E.restorePickingColors();return{result:x,emptyInfo:v.get(null)}}_pickClosestObject({layers:e,views:t,viewports:n,x:r,y:s,radius:i=0,depth:o=1,mode:a="query",unproject3D:l,onViewportActive:c,effects:u}){const h=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(e);if(!d||0===n.length)return{result:[],emptyInfo:zd({viewports:n,x:r,y:s,pixelRatio:h})};this._resizeBuffer();const f=this.device.canvasContext.cssToDevicePixels([r,s],!0),p=[f.x+Math.floor(f.width/2),f.y+Math.floor(f.height/2)],g=Math.round(i*h),{width:m,height:_}=this.pickingFBO,y=this._getPickingRect({deviceX:p[0],deviceY:p[1],deviceRadius:g,deviceWidth:m,deviceHeight:_}),b={x:r-i,y:s-i,width:2*i+1,height:2*i+1};let v;const x=[],w=new Set;for(let E=0;E<o;E++){let e,i;if(e=y?Vd({...this._drawAndSample({layers:d,views:t,viewports:n,onViewportActive:c,deviceRect:y,cullRect:b,effects:u,pass:`picking:${a}`}),deviceX:p[0],deviceY:p[1],deviceRadius:g,deviceRect:y}):{pickedColor:null,pickedObjectIndex:-1},e.pickedLayer&&l&&this.depthFBO){const{pickedColors:r}=this._drawAndSample({layers:[e.pickedLayer],views:t,viewports:n,onViewportActive:c,deviceRect:{x:e.pickedX,y:e.pickedY,width:1,height:1},cullRect:b,effects:u,pass:`picking:${a}:z`},!0);r[3]&&(i=r[0])}e.pickedLayer&&E+1<o&&(w.add(e.pickedLayer),e.pickedLayer.disablePickingIndex(e.pickedObjectIndex)),v=Wd({pickInfo:e,lastPickedInfo:this.lastPickedInfo,mode:a,layers:d,viewports:n,x:r,y:s,z:i,pixelRatio:h});for(const t of v.values())t.layer&&x.push(t);if(!e.pickedColor)break}for(const E of w)E.restorePickingColors();return{result:x,emptyInfo:v.get(null)}}async _pickVisibleObjectsAsync({layers:e,views:t,viewports:n,x:r,y:s,width:i=1,height:o=1,mode:a="query",maxObjects:l=null,onViewportActive:c,effects:u}){const h=this._getPickable(e);if(!h||0===n.length)return[];this._resizeBuffer();const d=this.device.canvasContext.cssToDeviceRatio(),f=this.device.canvasContext.cssToDevicePixels([r,s],!0),p=f.x,g=f.y+f.height,m=this.device.canvasContext.cssToDevicePixels([r+i,s+o],!0),_=m.x+m.width,y=m.y,b={x:p,y:y,width:_-p,height:g-y},v=Gd(this._drawAndSample({layers:h,views:t,viewports:n,onViewportActive:c,deviceRect:b,cullRect:{x:r,y:s,width:i,height:o},effects:u,pass:`picking:${a}`})),x=new Map,w=[],E=Number.isFinite(l);for(let T=0;T<v.length&&!(E&&w.length>=l);T++){const e=v[T];let t={color:e.pickedColor,layer:null,index:e.pickedObjectIndex,picked:!0,x:r,y:s,pixelRatio:d};t=Hd({layer:e.pickedLayer,info:t,mode:a});const n=t.layer.id;x.has(n)||x.set(n,new Set);const i=x.get(n),o=t.object??t.index;i.has(o)||(i.add(o),w.push(t))}return w}_pickVisibleObjects({layers:e,views:t,viewports:n,x:r,y:s,width:i=1,height:o=1,mode:a="query",maxObjects:l=null,onViewportActive:c,effects:u}){const h=this._getPickable(e);if(!h||0===n.length)return[];this._resizeBuffer();const d=this.device.canvasContext.cssToDeviceRatio(),f=this.device.canvasContext.cssToDevicePixels([r,s],!0),p=f.x,g=f.y+f.height,m=this.device.canvasContext.cssToDevicePixels([r+i,s+o],!0),_=m.x+m.width,y=m.y,b={x:p,y:y,width:_-p,height:g-y},v=Gd(this._drawAndSample({layers:h,views:t,viewports:n,onViewportActive:c,deviceRect:b,cullRect:{x:r,y:s,width:i,height:o},effects:u,pass:`picking:${a}`})),x=new Map,w=[],E=Number.isFinite(l);for(let T=0;T<v.length&&!(E&&w.length>=l);T++){const e=v[T];let t={color:e.pickedColor,layer:null,index:e.pickedObjectIndex,picked:!0,x:r,y:s,pixelRatio:d};t=Hd({layer:e.pickedLayer,info:t,mode:a});const n=t.layer.id;x.has(n)||x.set(n,new Set);const i=x.get(n),o=t.object??t.index;i.has(o)||(i.add(o),w.push(t))}return w}async _drawAndSampleAsync({layers:e,views:t,viewports:n,onViewportActive:r,deviceRect:s,cullRect:i,effects:o,pass:a},l=!1){const c=l?this.depthFBO:this.pickingFBO,u={layers:e,layerFilter:this.layerFilter,views:t,viewports:n,onViewportActive:r,pickingFBO:c,deviceRect:s,cullRect:i,effects:o,pass:a,pickZ:l,preRenderStats:{},isPicking:!0};for(const _ of o)_.useInPicking&&(u.preRenderStats[_.id]=_.preRender(u));const{decodePickingColor:h}=this.pickLayersPass.render(u),{x:d,y:f,width:p,height:g}=s,m=new(l?Float32Array:Uint8Array)(p*g*4);return this.device.readPixelsToArrayWebGL(c,{sourceX:d,sourceY:f,sourceWidth:p,sourceHeight:g,target:m}),{pickedColors:m,decodePickingColor:h}}_drawAndSample({layers:e,views:t,viewports:n,onViewportActive:r,deviceRect:s,cullRect:i,effects:o,pass:a},l=!1){const c=l?this.depthFBO:this.pickingFBO,u={layers:e,layerFilter:this.layerFilter,views:t,viewports:n,onViewportActive:r,pickingFBO:c,deviceRect:s,cullRect:i,effects:o,pass:a,pickZ:l,preRenderStats:{},isPicking:!0};for(const _ of o)_.useInPicking&&(u.preRenderStats[_.id]=_.preRender(u));const{decodePickingColor:h}=this.pickLayersPass.render(u),{x:d,y:f,width:p,height:g}=s,m=new(l?Float32Array:Uint8Array)(p*g*4);return this.device.readPixelsToArrayWebGL(c,{sourceX:d,sourceY:f,sourceWidth:p,sourceHeight:g,target:m}),{pickedColors:m,decodePickingColor:h}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:n,deviceWidth:r,deviceHeight:s}){const i=Math.max(0,e-n),o=Math.max(0,t-n),a=Math.min(r,e+n+1)-i,l=Math.min(s,t+n+1)-o;return a<=0||l<=0?null:{x:i,y:o,width:a,height:l}}}const Xd={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},qd="top-left",Yd="__root";class Kd{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,null==t||t.classList.add("deck-widget-container"),this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){if(e.widgets&&!ad(e.widgets,this.widgets,1)){const t=e.widgets.filter(Boolean);this._setWidgets(t)}}finalize(){for(const e of this.getWidgets())this._removeWidget(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._addWidget(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}onRedraw({viewports:e,layers:t}){var n,r;const s=e.reduce((e,t)=>(e[t.id]=t,e),{});for(const i of this.getWidgets()){const{viewId:o}=i;if(o){const e=s[o];e&&(i.onViewportChange&&i.onViewportChange(e),null==(n=i.onRedraw)||n.call(i,{viewports:[e],layers:t}))}else{if(i.onViewportChange)for(const t of e)i.onViewportChange(t);null==(r=i.onRedraw)||r.call(i,{viewports:e,layers:t})}}this.lastViewports=s,this._updateContainers()}onHover(e,t){var n,r;for(const s of this.getWidgets()){const{viewId:i}=s;i&&i!==(null==(n=e.viewport)?void 0:n.id)||null==(r=s.onHover)||r.call(s,e,t)}}onEvent(e,t){var n,r;const s=Dc[t.type];if(s)for(const i of this.getWidgets()){const{viewId:o}=i;o&&o!==(null==(n=e.viewport)?void 0:n.id)||null==(r=i[s])||r.call(i,e,t)}}_setWidgets(e){const t={};for(const n of this.resolvedWidgets)t[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)t[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const e=t[n.id];e?e.viewId!==n.viewId||e.placement!==n.placement?(this._removeWidget(e),this._addWidget(n)):n!==e&&(e.setProps(n.props),n=e):this._addWidget(n),t[n.id]=null,this.resolvedWidgets.push(n)}for(const n in t){const e=t[n];e&&this._removeWidget(e)}this.widgets=e}_addWidget(e){const{viewId:t=null,placement:n=qd}=e;e.widgetManager=this,e.deck=this.deck,e.rootElement=e._onAdd({deck:this.deck,viewId:t}),e.rootElement&&this._getContainer(t,n).append(e.rootElement),e.updateHTML()}_removeWidget(e){var t;null==(t=e.onRemove)||t.call(e),e.rootElement&&e.rootElement.remove(),e.rootElement=void 0,e.deck=void 0,e.widgetManager=void 0}_getContainer(e,t){var n;const r=e||Yd;let s=this.containers[r];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",null==(n=this.parentElement)||n.append(s),this.containers[r]=s);let i=s.querySelector(`.${t}`);return i||(i=globalThis.document.createElement("div"),i.className=t,i.style.position="absolute",i.style.zIndex="2",Object.assign(i.style,Xd[t]),s.append(i)),i}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const n in this.containers){const r=this.lastViewports[n]||null,s=n===Yd||r,i=this.containers[n];s?(i.style.display="block",i.style.left=`${r?r.x:0}px`,i.style.top=`${r?r.y:0}px`,i.style.width=`${r?r.width:e}px`,i.style.height=`${r?r.height:t}px`):i.style.display="none"}}}function Zd(e,t){t&&Object.entries(t).map(([t,n])=>{t.startsWith("--")?e.style.setProperty(t,n):e.style[t]=n})}class Qd{constructor(e){this.viewId=null,this.props={...this.constructor.defaultProps,...e},this.id=this.props.id}setProps(e){const t=this.props,n=this.rootElement;var r,s;n&&t.className!==e.className&&(t.className&&n.classList.remove(t.className),e.className&&n.classList.add(e.className)),n&&!ad(t.style,e.style,1)&&(r=n,(s=t.style)&&Object.keys(s).map(e=>{e.startsWith("--")?r.style.removeProperty(e):r.style[e]=""}),Zd(n,e.style)),Object.assign(this.props,e),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){const e=["deck-widget",this.className,this.props.className],t=document.createElement("div");return e.filter(e=>"string"==typeof e&&e.length>0).forEach(e=>t.classList.add(e)),Zd(t,this.props.style),t}_onAdd(e){return this.onAdd(e)??this.onCreateRootElement()}onAdd(e){}onRemove(){}onViewportChange(e){}onRedraw(e){}onHover(e,t){}onClick(e,t){}onDrag(e,t){}onDragStart(e,t){}onDragEnd(e,t){}}Qd.defaultProps={id:"widget",style:{},className:""};const Jd={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class ef extends Qd{constructor(e={}){super(e),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(e)}onCreateRootElement(){const e=document.createElement("div");return e.className=this.className,Object.assign(e.style,Jd),e}onRenderHTML(e){}onViewportChange(e){var t;this.isVisible&&e.id===(null==(t=this.lastViewport)?void 0:t.id)&&!e.equals(this.lastViewport)&&this.setTooltip(null),this.lastViewport=e}onHover(e){const{deck:t}=this,n=t&&t.props.getTooltip;if(!n)return;const r=n(e);this.setTooltip(r,e.x,e.y)}setTooltip(e,t,n){const r=this.rootElement;if(r){if("string"==typeof e)r.innerText=e;else{if(!e)return this.isVisible=!1,void(r.style.display="none");e.text&&(r.innerText=e.text),e.html&&(r.innerHTML=e.html),e.className&&(r.className=e.className)}this.isVisible=!0,r.style.display="block",r.style.transform=`translate(${t}px, ${n}px)`,e&&"object"==typeof e&&"style"in e&&Object.assign(r.style,e.style)}}}var tf,nf;ef.defaultProps={...Qd.defaultProps},(nf=tf||(tf={}))[nf.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",nf[nf.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",nf[nf.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",nf[nf.POINTS=0]="POINTS",nf[nf.LINES=1]="LINES",nf[nf.LINE_LOOP=2]="LINE_LOOP",nf[nf.LINE_STRIP=3]="LINE_STRIP",nf[nf.TRIANGLES=4]="TRIANGLES",nf[nf.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",nf[nf.TRIANGLE_FAN=6]="TRIANGLE_FAN",nf[nf.ZERO=0]="ZERO",nf[nf.ONE=1]="ONE",nf[nf.SRC_COLOR=768]="SRC_COLOR",nf[nf.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",nf[nf.SRC_ALPHA=770]="SRC_ALPHA",nf[nf.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",nf[nf.DST_ALPHA=772]="DST_ALPHA",nf[nf.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",nf[nf.DST_COLOR=774]="DST_COLOR",nf[nf.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",nf[nf.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",nf[nf.CONSTANT_COLOR=32769]="CONSTANT_COLOR",nf[nf.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",nf[nf.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",nf[nf.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",nf[nf.FUNC_ADD=32774]="FUNC_ADD",nf[nf.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",nf[nf.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",nf[nf.BLEND_EQUATION=32777]="BLEND_EQUATION",nf[nf.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",nf[nf.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",nf[nf.BLEND_DST_RGB=32968]="BLEND_DST_RGB",nf[nf.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",nf[nf.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",nf[nf.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",nf[nf.BLEND_COLOR=32773]="BLEND_COLOR",nf[nf.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",nf[nf.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",nf[nf.LINE_WIDTH=2849]="LINE_WIDTH",nf[nf.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",nf[nf.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",nf[nf.CULL_FACE_MODE=2885]="CULL_FACE_MODE",nf[nf.FRONT_FACE=2886]="FRONT_FACE",nf[nf.DEPTH_RANGE=2928]="DEPTH_RANGE",nf[nf.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",nf[nf.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",nf[nf.DEPTH_FUNC=2932]="DEPTH_FUNC",nf[nf.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",nf[nf.STENCIL_FUNC=2962]="STENCIL_FUNC",nf[nf.STENCIL_FAIL=2964]="STENCIL_FAIL",nf[nf.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",nf[nf.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",nf[nf.STENCIL_REF=2967]="STENCIL_REF",nf[nf.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",nf[nf.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",nf[nf.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",nf[nf.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",nf[nf.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",nf[nf.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",nf[nf.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",nf[nf.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",nf[nf.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",nf[nf.VIEWPORT=2978]="VIEWPORT",nf[nf.SCISSOR_BOX=3088]="SCISSOR_BOX",nf[nf.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",nf[nf.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",nf[nf.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",nf[nf.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",nf[nf.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",nf[nf.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",nf[nf.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",nf[nf.RED_BITS=3410]="RED_BITS",nf[nf.GREEN_BITS=3411]="GREEN_BITS",nf[nf.BLUE_BITS=3412]="BLUE_BITS",nf[nf.ALPHA_BITS=3413]="ALPHA_BITS",nf[nf.DEPTH_BITS=3414]="DEPTH_BITS",nf[nf.STENCIL_BITS=3415]="STENCIL_BITS",nf[nf.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",nf[nf.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",nf[nf.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",nf[nf.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",nf[nf.SAMPLES=32937]="SAMPLES",nf[nf.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",nf[nf.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",nf[nf.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",nf[nf.VENDOR=7936]="VENDOR",nf[nf.RENDERER=7937]="RENDERER",nf[nf.VERSION=7938]="VERSION",nf[nf.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",nf[nf.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",nf[nf.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",nf[nf.STATIC_DRAW=35044]="STATIC_DRAW",nf[nf.STREAM_DRAW=35040]="STREAM_DRAW",nf[nf.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",nf[nf.ARRAY_BUFFER=34962]="ARRAY_BUFFER",nf[nf.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",nf[nf.BUFFER_SIZE=34660]="BUFFER_SIZE",nf[nf.BUFFER_USAGE=34661]="BUFFER_USAGE",nf[nf.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",nf[nf.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",nf[nf.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",nf[nf.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",nf[nf.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",nf[nf.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",nf[nf.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",nf[nf.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",nf[nf.CULL_FACE=2884]="CULL_FACE",nf[nf.FRONT=1028]="FRONT",nf[nf.BACK=1029]="BACK",nf[nf.FRONT_AND_BACK=1032]="FRONT_AND_BACK",nf[nf.BLEND=3042]="BLEND",nf[nf.DEPTH_TEST=2929]="DEPTH_TEST",nf[nf.DITHER=3024]="DITHER",nf[nf.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",nf[nf.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",nf[nf.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",nf[nf.SCISSOR_TEST=3089]="SCISSOR_TEST",nf[nf.STENCIL_TEST=2960]="STENCIL_TEST",nf[nf.NO_ERROR=0]="NO_ERROR",nf[nf.INVALID_ENUM=1280]="INVALID_ENUM",nf[nf.INVALID_VALUE=1281]="INVALID_VALUE",nf[nf.INVALID_OPERATION=1282]="INVALID_OPERATION",nf[nf.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",nf[nf.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",nf[nf.CW=2304]="CW",nf[nf.CCW=2305]="CCW",nf[nf.DONT_CARE=4352]="DONT_CARE",nf[nf.FASTEST=4353]="FASTEST",nf[nf.NICEST=4354]="NICEST",nf[nf.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",nf[nf.BYTE=5120]="BYTE",nf[nf.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",nf[nf.SHORT=5122]="SHORT",nf[nf.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",nf[nf.INT=5124]="INT",nf[nf.UNSIGNED_INT=5125]="UNSIGNED_INT",nf[nf.FLOAT=5126]="FLOAT",nf[nf.DOUBLE=5130]="DOUBLE",nf[nf.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",nf[nf.ALPHA=6406]="ALPHA",nf[nf.RGB=6407]="RGB",nf[nf.RGBA=6408]="RGBA",nf[nf.LUMINANCE=6409]="LUMINANCE",nf[nf.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",nf[nf.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",nf[nf.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",nf[nf.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",nf[nf.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",nf[nf.VERTEX_SHADER=35633]="VERTEX_SHADER",nf[nf.COMPILE_STATUS=35713]="COMPILE_STATUS",nf[nf.DELETE_STATUS=35712]="DELETE_STATUS",nf[nf.LINK_STATUS=35714]="LINK_STATUS",nf[nf.VALIDATE_STATUS=35715]="VALIDATE_STATUS",nf[nf.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",nf[nf.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",nf[nf.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",nf[nf.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",nf[nf.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",nf[nf.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",nf[nf.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",nf[nf.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",nf[nf.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",nf[nf.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",nf[nf.SHADER_TYPE=35663]="SHADER_TYPE",nf[nf.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",nf[nf.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",nf[nf.NEVER=512]="NEVER",nf[nf.LESS=513]="LESS",nf[nf.EQUAL=514]="EQUAL",nf[nf.LEQUAL=515]="LEQUAL",nf[nf.GREATER=516]="GREATER",nf[nf.NOTEQUAL=517]="NOTEQUAL",nf[nf.GEQUAL=518]="GEQUAL",nf[nf.ALWAYS=519]="ALWAYS",nf[nf.KEEP=7680]="KEEP",nf[nf.REPLACE=7681]="REPLACE",nf[nf.INCR=7682]="INCR",nf[nf.DECR=7683]="DECR",nf[nf.INVERT=5386]="INVERT",nf[nf.INCR_WRAP=34055]="INCR_WRAP",nf[nf.DECR_WRAP=34056]="DECR_WRAP",nf[nf.NEAREST=9728]="NEAREST",nf[nf.LINEAR=9729]="LINEAR",nf[nf.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",nf[nf.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",nf[nf.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",nf[nf.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",nf[nf.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",nf[nf.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",nf[nf.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",nf[nf.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",nf[nf.TEXTURE_2D=3553]="TEXTURE_2D",nf[nf.TEXTURE=5890]="TEXTURE",nf[nf.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",nf[nf.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",nf[nf.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",nf[nf.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",nf[nf.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",nf[nf.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",nf[nf.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",nf[nf.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",nf[nf.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",nf[nf.TEXTURE0=33984]="TEXTURE0",nf[nf.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",nf[nf.REPEAT=10497]="REPEAT",nf[nf.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",nf[nf.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",nf[nf.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",nf[nf.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",nf[nf.FLOAT_VEC2=35664]="FLOAT_VEC2",nf[nf.FLOAT_VEC3=35665]="FLOAT_VEC3",nf[nf.FLOAT_VEC4=35666]="FLOAT_VEC4",nf[nf.INT_VEC2=35667]="INT_VEC2",nf[nf.INT_VEC3=35668]="INT_VEC3",nf[nf.INT_VEC4=35669]="INT_VEC4",nf[nf.BOOL=35670]="BOOL",nf[nf.BOOL_VEC2=35671]="BOOL_VEC2",nf[nf.BOOL_VEC3=35672]="BOOL_VEC3",nf[nf.BOOL_VEC4=35673]="BOOL_VEC4",nf[nf.FLOAT_MAT2=35674]="FLOAT_MAT2",nf[nf.FLOAT_MAT3=35675]="FLOAT_MAT3",nf[nf.FLOAT_MAT4=35676]="FLOAT_MAT4",nf[nf.SAMPLER_2D=35678]="SAMPLER_2D",nf[nf.SAMPLER_CUBE=35680]="SAMPLER_CUBE",nf[nf.LOW_FLOAT=36336]="LOW_FLOAT",nf[nf.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",nf[nf.HIGH_FLOAT=36338]="HIGH_FLOAT",nf[nf.LOW_INT=36339]="LOW_INT",nf[nf.MEDIUM_INT=36340]="MEDIUM_INT",nf[nf.HIGH_INT=36341]="HIGH_INT",nf[nf.FRAMEBUFFER=36160]="FRAMEBUFFER",nf[nf.RENDERBUFFER=36161]="RENDERBUFFER",nf[nf.RGBA4=32854]="RGBA4",nf[nf.RGB5_A1=32855]="RGB5_A1",nf[nf.RGB565=36194]="RGB565",nf[nf.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",nf[nf.STENCIL_INDEX=6401]="STENCIL_INDEX",nf[nf.STENCIL_INDEX8=36168]="STENCIL_INDEX8",nf[nf.DEPTH_STENCIL=34041]="DEPTH_STENCIL",nf[nf.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",nf[nf.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",nf[nf.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",nf[nf.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",nf[nf.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",nf[nf.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",nf[nf.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",nf[nf.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",nf[nf.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",nf[nf.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",nf[nf.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",nf[nf.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",nf[nf.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",nf[nf.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",nf[nf.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",nf[nf.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",nf[nf.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",nf[nf.NONE=0]="NONE",nf[nf.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",nf[nf.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",nf[nf.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",nf[nf.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",nf[nf.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",nf[nf.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",nf[nf.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",nf[nf.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",nf[nf.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",nf[nf.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",nf[nf.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",nf[nf.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",nf[nf.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",nf[nf.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",nf[nf.READ_BUFFER=3074]="READ_BUFFER",nf[nf.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",nf[nf.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",nf[nf.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",nf[nf.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",nf[nf.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",nf[nf.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",nf[nf.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",nf[nf.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",nf[nf.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",nf[nf.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",nf[nf.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",nf[nf.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",nf[nf.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",nf[nf.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",nf[nf.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",nf[nf.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",nf[nf.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",nf[nf.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",nf[nf.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",nf[nf.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",nf[nf.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",nf[nf.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",nf[nf.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",nf[nf.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",nf[nf.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",nf[nf.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",nf[nf.RED=6403]="RED",nf[nf.RGB8=32849]="RGB8",nf[nf.RGBA8=32856]="RGBA8",nf[nf.RGB10_A2=32857]="RGB10_A2",nf[nf.TEXTURE_3D=32879]="TEXTURE_3D",nf[nf.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",nf[nf.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",nf[nf.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",nf[nf.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",nf[nf.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",nf[nf.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",nf[nf.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",nf[nf.SRGB=35904]="SRGB",nf[nf.SRGB8=35905]="SRGB8",nf[nf.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",nf[nf.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",nf[nf.RGBA32F=34836]="RGBA32F",nf[nf.RGB32F=34837]="RGB32F",nf[nf.RGBA16F=34842]="RGBA16F",nf[nf.RGB16F=34843]="RGB16F",nf[nf.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",nf[nf.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",nf[nf.R11F_G11F_B10F=35898]="R11F_G11F_B10F",nf[nf.RGB9_E5=35901]="RGB9_E5",nf[nf.RGBA32UI=36208]="RGBA32UI",nf[nf.RGB32UI=36209]="RGB32UI",nf[nf.RGBA16UI=36214]="RGBA16UI",nf[nf.RGB16UI=36215]="RGB16UI",nf[nf.RGBA8UI=36220]="RGBA8UI",nf[nf.RGB8UI=36221]="RGB8UI",nf[nf.RGBA32I=36226]="RGBA32I",nf[nf.RGB32I=36227]="RGB32I",nf[nf.RGBA16I=36232]="RGBA16I",nf[nf.RGB16I=36233]="RGB16I",nf[nf.RGBA8I=36238]="RGBA8I",nf[nf.RGB8I=36239]="RGB8I",nf[nf.RED_INTEGER=36244]="RED_INTEGER",nf[nf.RGB_INTEGER=36248]="RGB_INTEGER",nf[nf.RGBA_INTEGER=36249]="RGBA_INTEGER",nf[nf.R8=33321]="R8",nf[nf.RG8=33323]="RG8",nf[nf.R16F=33325]="R16F",nf[nf.R32F=33326]="R32F",nf[nf.RG16F=33327]="RG16F",nf[nf.RG32F=33328]="RG32F",nf[nf.R8I=33329]="R8I",nf[nf.R8UI=33330]="R8UI",nf[nf.R16I=33331]="R16I",nf[nf.R16UI=33332]="R16UI",nf[nf.R32I=33333]="R32I",nf[nf.R32UI=33334]="R32UI",nf[nf.RG8I=33335]="RG8I",nf[nf.RG8UI=33336]="RG8UI",nf[nf.RG16I=33337]="RG16I",nf[nf.RG16UI=33338]="RG16UI",nf[nf.RG32I=33339]="RG32I",nf[nf.RG32UI=33340]="RG32UI",nf[nf.R8_SNORM=36756]="R8_SNORM",nf[nf.RG8_SNORM=36757]="RG8_SNORM",nf[nf.RGB8_SNORM=36758]="RGB8_SNORM",nf[nf.RGBA8_SNORM=36759]="RGBA8_SNORM",nf[nf.RGB10_A2UI=36975]="RGB10_A2UI",nf[nf.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",nf[nf.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",nf[nf.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",nf[nf.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",nf[nf.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",nf[nf.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",nf[nf.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",nf[nf.HALF_FLOAT=5131]="HALF_FLOAT",nf[nf.RG=33319]="RG",nf[nf.RG_INTEGER=33320]="RG_INTEGER",nf[nf.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",nf[nf.CURRENT_QUERY=34917]="CURRENT_QUERY",nf[nf.QUERY_RESULT=34918]="QUERY_RESULT",nf[nf.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",nf[nf.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",nf[nf.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",nf[nf.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",nf[nf.DRAW_BUFFER0=34853]="DRAW_BUFFER0",nf[nf.DRAW_BUFFER1=34854]="DRAW_BUFFER1",nf[nf.DRAW_BUFFER2=34855]="DRAW_BUFFER2",nf[nf.DRAW_BUFFER3=34856]="DRAW_BUFFER3",nf[nf.DRAW_BUFFER4=34857]="DRAW_BUFFER4",nf[nf.DRAW_BUFFER5=34858]="DRAW_BUFFER5",nf[nf.DRAW_BUFFER6=34859]="DRAW_BUFFER6",nf[nf.DRAW_BUFFER7=34860]="DRAW_BUFFER7",nf[nf.DRAW_BUFFER8=34861]="DRAW_BUFFER8",nf[nf.DRAW_BUFFER9=34862]="DRAW_BUFFER9",nf[nf.DRAW_BUFFER10=34863]="DRAW_BUFFER10",nf[nf.DRAW_BUFFER11=34864]="DRAW_BUFFER11",nf[nf.DRAW_BUFFER12=34865]="DRAW_BUFFER12",nf[nf.DRAW_BUFFER13=34866]="DRAW_BUFFER13",nf[nf.DRAW_BUFFER14=34867]="DRAW_BUFFER14",nf[nf.DRAW_BUFFER15=34868]="DRAW_BUFFER15",nf[nf.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",nf[nf.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",nf[nf.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",nf[nf.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",nf[nf.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",nf[nf.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",nf[nf.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",nf[nf.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",nf[nf.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",nf[nf.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",nf[nf.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",nf[nf.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",nf[nf.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",nf[nf.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",nf[nf.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",nf[nf.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",nf[nf.SAMPLER_3D=35679]="SAMPLER_3D",nf[nf.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",nf[nf.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",nf[nf.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",nf[nf.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",nf[nf.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",nf[nf.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",nf[nf.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",nf[nf.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",nf[nf.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",nf[nf.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",nf[nf.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",nf[nf.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",nf[nf.MAX_SAMPLES=36183]="MAX_SAMPLES",nf[nf.SAMPLER_BINDING=35097]="SAMPLER_BINDING",nf[nf.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",nf[nf.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",nf[nf.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",nf[nf.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",nf[nf.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",nf[nf.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",nf[nf.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",nf[nf.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",nf[nf.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",nf[nf.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",nf[nf.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",nf[nf.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",nf[nf.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",nf[nf.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",nf[nf.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",nf[nf.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",nf[nf.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",nf[nf.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",nf[nf.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",nf[nf.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",nf[nf.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",nf[nf.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",nf[nf.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",nf[nf.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",nf[nf.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",nf[nf.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",nf[nf.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",nf[nf.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",nf[nf.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",nf[nf.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",nf[nf.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",nf[nf.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",nf[nf.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",nf[nf.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",nf[nf.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",nf[nf.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",nf[nf.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",nf[nf.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",nf[nf.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",nf[nf.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",nf[nf.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",nf[nf.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",nf[nf.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",nf[nf.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",nf[nf.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",nf[nf.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",nf[nf.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",nf[nf.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",nf[nf.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",nf[nf.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",nf[nf.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",nf[nf.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",nf[nf.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",nf[nf.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",nf[nf.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",nf[nf.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",nf[nf.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",nf[nf.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",nf[nf.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",nf[nf.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",nf[nf.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",nf[nf.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",nf[nf.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",nf[nf.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",nf[nf.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",nf[nf.UNIFORM_TYPE=35383]="UNIFORM_TYPE",nf[nf.UNIFORM_SIZE=35384]="UNIFORM_SIZE",nf[nf.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",nf[nf.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",nf[nf.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",nf[nf.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",nf[nf.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",nf[nf.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",nf[nf.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",nf[nf.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",nf[nf.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",nf[nf.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",nf[nf.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",nf[nf.OBJECT_TYPE=37138]="OBJECT_TYPE",nf[nf.SYNC_CONDITION=37139]="SYNC_CONDITION",nf[nf.SYNC_STATUS=37140]="SYNC_STATUS",nf[nf.SYNC_FLAGS=37141]="SYNC_FLAGS",nf[nf.SYNC_FENCE=37142]="SYNC_FENCE",nf[nf.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",nf[nf.UNSIGNALED=37144]="UNSIGNALED",nf[nf.SIGNALED=37145]="SIGNALED",nf[nf.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",nf[nf.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",nf[nf.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",nf[nf.WAIT_FAILED=37149]="WAIT_FAILED",nf[nf.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",nf[nf.COLOR=6144]="COLOR",nf[nf.DEPTH=6145]="DEPTH",nf[nf.STENCIL=6146]="STENCIL",nf[nf.MIN=32775]="MIN",nf[nf.MAX=32776]="MAX",nf[nf.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",nf[nf.STREAM_READ=35041]="STREAM_READ",nf[nf.STREAM_COPY=35042]="STREAM_COPY",nf[nf.STATIC_READ=35045]="STATIC_READ",nf[nf.STATIC_COPY=35046]="STATIC_COPY",nf[nf.DYNAMIC_READ=35049]="DYNAMIC_READ",nf[nf.DYNAMIC_COPY=35050]="DYNAMIC_COPY",nf[nf.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",nf[nf.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",nf[nf.INVALID_INDEX=4294967295]="INVALID_INDEX",nf[nf.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",nf[nf.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",nf[nf.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",nf[nf.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",nf[nf.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",nf[nf.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",nf[nf.R16_EXT=33322]="R16_EXT",nf[nf.RG16_EXT=33324]="RG16_EXT",nf[nf.RGB16_EXT=32852]="RGB16_EXT",nf[nf.RGBA16_EXT=32859]="RGBA16_EXT",nf[nf.R16_SNORM_EXT=36760]="R16_SNORM_EXT",nf[nf.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",nf[nf.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",nf[nf.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",nf[nf.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",nf[nf.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",nf[nf.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",nf[nf.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",nf[nf.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",nf[nf.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",nf[nf.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",nf[nf.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",nf[nf.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",nf[nf.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",nf[nf.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",nf[nf.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",nf[nf.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",nf[nf.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",nf[nf.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",nf[nf.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",nf[nf.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",nf[nf.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",nf[nf.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",nf[nf.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",nf[nf.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",nf[nf.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",nf[nf.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",nf[nf.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",nf[nf.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",nf[nf.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",nf[nf.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",nf[nf.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",nf[nf.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",nf[nf.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",nf[nf.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",nf[nf.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",nf[nf.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",nf[nf.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",nf[nf.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",nf[nf.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",nf[nf.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",nf[nf.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",nf[nf.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",nf[nf.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",nf[nf.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",nf[nf.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",nf[nf.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",nf[nf.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",nf[nf.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",nf[nf.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",nf[nf.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",nf[nf.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",nf[nf.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",nf[nf.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",nf[nf.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",nf[nf.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",nf[nf.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",nf[nf.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",nf[nf.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",nf[nf.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",nf[nf.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",nf[nf.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",nf[nf.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",nf[nf.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",nf[nf.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",nf[nf.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",nf[nf.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",nf[nf.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",nf[nf.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",nf[nf.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",nf[nf.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",nf[nf.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",nf[nf.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",nf[nf.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",nf[nf.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",nf[nf.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",nf[nf.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",nf[nf.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",nf[nf.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",nf[nf.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",nf[nf.LINE_WEBGL=6913]="LINE_WEBGL",nf[nf.FILL_WEBGL=6914]="FILL_WEBGL",nf[nf.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",nf[nf.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",nf[nf.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",nf[nf.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",nf[nf.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",nf[nf.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",nf[nf.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",nf[nf.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",nf[nf.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",nf[nf.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",nf[nf.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",nf[nf.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",nf[nf.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",nf[nf.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",nf[nf.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",nf[nf.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",nf[nf.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",nf[nf.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",nf[nf.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",nf[nf.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",nf[nf.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",nf[nf.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",nf[nf.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",nf[nf.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT";const rf={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},sf=e=>({drawBuffersWEBGL:t=>e.drawBuffers(t),COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),of=e=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES:()=>e.createVertexArray(),deleteVertexArrayOES:t=>e.deleteVertexArray(t),isVertexArrayOES:t=>e.isVertexArray(t),bindVertexArrayOES:t=>e.bindVertexArray(t)}),af=e=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE:(...t)=>e.drawArraysInstanced(...t),drawElementsInstancedANGLE:(...t)=>e.drawElementsInstanced(...t),vertexAttribDivisorANGLE:(...t)=>e.vertexAttribDivisor(...t)});async function lf(e,t){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",e),new Promise((t,s)=>{r.onload=t,r.onerror=t=>s(new Error(`Unable to load script '${e}': ${t}`)),n.appendChild(r)})}let cf=null,uf=!1;const hf={debugSpectorJS:Vr.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};function df(e){return e.luma=e.luma||{},e.luma}function ff(e,t={}){return t.debugWebGL||t.traceWebGL?function(e,t){if(!globalThis.WebGLDebugUtils)return Vr.warn("webgl-debug not loaded")(),e;const n=df(e);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...tf,...e});const r=globalThis.WebGLDebugUtils.makeDebugContext(e,gf.bind(null,t),mf.bind(null,t));for(const o in tf)o in r||"number"!=typeof tf[o]||(r[o]=tf[o]);class s{}Object.setPrototypeOf(r,Object.getPrototypeOf(e)),Object.setPrototypeOf(s,r);const i=Object.create(s);return n.realContext=e,n.debugContext=i,i.debug=!0,i}(e,t):function(e){const t=df(e);return t.realContext?t.realContext:e}(e)}function pf(e,t){t=Array.from(t).map(e=>void 0===e?"undefined":e);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${e}(${n})`}function gf(e,t,n,r){r=Array.from(r).map(e=>void 0===e?"undefined":e);const s=`${globalThis.WebGLDebugUtils.glEnumToString(t)} in gl.${n}(${globalThis.WebGLDebugUtils.glFunctionArgsToString(n,r)})`;Vr.error(s)()}function mf(e,t,n){let r="";Vr.level>=1&&(r=pf(t,n),e.traceWebGL&&Vr.log(1,r)());for(const s of n)void 0===s&&(r=r||pf(t,n))}const _f=new class extends Ss{constructor(){super(),r(this,"type","webgl"),xs.defaultProps={...xs.defaultProps,...hf}}enforceWebGL2(e){!function(e=!0){const t=HTMLCanvasElement.prototype;if(!e&&t.originalGetContext)return t.getContext=t.originalGetContext,void(t.originalGetContext=void 0);t.originalGetContext=t.getContext,t.getContext=function(e,t){if("webgl"===e||"experimental-webgl"===e){const e=this.originalGetContext("webgl2",t);return e instanceof HTMLElement&&function(e){e.getExtension("EXT_color_buffer_float");const t={...rf,WEBGL_disjoint_timer_query:e.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:sf(e),OES_vertex_array_object:of(e),ANGLE_instanced_arrays:af(e)},n=e.getExtension;e.getExtension=function(r){return n.call(e,r)||(r in t?t[r]:null)};const r=e.getSupportedExtensions;e.getSupportedExtensions=function(){const n=r.apply(e)||[];return null==n?void 0:n.concat(Object.keys(t))}}(e),e}return this.originalGetContext(e,t)}}(e)}isSupported(){return"undefined"!=typeof WebGL2RenderingContext}isDeviceHandle(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||("undefined"!=typeof WebGLRenderingContext&&e instanceof WebGLRenderingContext&&Vr.warn("WebGL1 is not supported",e)(),!1)}async attach(e,t={}){const{WebGLDevice:n}=await a(async()=>{const{WebGLDevice:e}=await Promise.resolve().then(()=>qp);return{WebGLDevice:e}},void 0);if(e instanceof n)return e;if((null==e?void 0:e.device)instanceof n)return e.device;if(!function(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&Number.isFinite(e._version))}(e))throw new Error("Invalid WebGL2RenderingContext");const r=!0===t.createCanvasContext?{}:t.createCanvasContext;return new n({...t,_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1,...r}})}async create(e={}){const{WebGLDevice:t}=await a(async()=>{const{WebGLDevice:e}=await Promise.resolve().then(()=>qp);return{WebGLDevice:e}},void 0);Vr.groupCollapsed(1,"WebGLDevice created")();try{const n=[];(e.debugWebGL||e.debug)&&n.push(async function(){Ke()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await lf("https://unpkg.com/webgl-debug@2.0.1/index.js"))}()),e.debugSpectorJS&&n.push(async function(e){if(!globalThis.SPECTOR)try{await lf(e.debugSpectorJSUrl||hf.debugSpectorJSUrl)}catch(t){Vr.warn(String(t))}}(e));const r=await Promise.allSettled(n);for(const e of r)"rejected"===e.status&&Vr.error(`Failed to initialize debug libraries ${e.reason}`)();const s=new t(e),i=`${s._reused?"Reusing":"Created"} device with WebGL2 ${s.props.debug?"debug ":""}context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return Vr.probe(1,i)(),Vr.table(1,s.info)(),s}finally{Vr.groupEnd(1)()}}},yf={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},bf=(e,t,n)=>t?e.enable(n):e.disable(n),vf=(e,t,n)=>e.hint(n,t),xf=(e,t,n)=>e.pixelStorei(n,t),wf=(e,t,n)=>{const r=36006===n?36009:36008;return e.bindFramebuffer(r,t)},Ef=(e,t,n)=>{const r={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];e.bindBuffer(r,t)};function Tf(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}const Sf={3042:bf,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:bf,2885:(e,t)=>e.cullFace(t),2929:bf,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:bf,35723:vf,35725:(e,t)=>e.useProgram(t),36007:(e,t)=>e.bindRenderbuffer(36161,t),36389:(e,t)=>{var n;return null==(n=e.bindTransformFeedback)?void 0:n.call(e,36386,t)},34229:(e,t)=>e.bindVertexArray(t),36006:wf,36010:wf,34964:Ef,36662:Ef,36663:Ef,35053:Ef,35055:Ef,2886:(e,t)=>e.frontFace(t),33170:vf,2849:(e,t)=>e.lineWidth(t),32823:bf,32824:"polygonOffset",10752:"polygonOffset",35977:bf,32926:bf,32928:bf,32938:"sampleCoverage",32939:"sampleCoverage",3089:bf,3088:(e,t)=>e.scissor(...t),2960:bf,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),34383:bf,10754:bf,12288:bf,12289:bf,12290:bf,12291:bf,12292:bf,12293:bf,12294:bf,12295:bf,3333:xf,3317:xf,37440:xf,37441:xf,37443:xf,3330:xf,3332:xf,3331:xf,3314:xf,32878:xf,3316:xf,3315:xf,32877:xf,framebuffer:(e,t)=>{const n=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,n)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{const n="number"==typeof t?[t,t]:t;e.blendEquationSeparate(...n)},blendFunc:(e,t)=>{const n=2===(null==t?void 0:t.length)?[...t,...t]:t;e.blendFuncSeparate(...n)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(t[0],t[1]||!1),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=Tf(t)?t:[t,t];const[n,r]=t;e.stencilMaskSeparate(1028,n),e.stencilMaskSeparate(1029,r)},stencilFunc:(e,t)=>{t=Tf(t)&&3===t.length?[...t,...t]:t;const[n,r,s,i,o,a]=t;e.stencilFuncSeparate(1028,n,r,s),e.stencilFuncSeparate(1029,i,o,a)},stencilOp:(e,t)=>{t=Tf(t)&&3===t.length?[...t,...t]:t;const[n,r,s,i,o,a]=t;e.stencilOpSeparate(1028,n,r,s),e.stencilOpSeparate(1029,i,o,a)},viewport:(e,t)=>e.viewport(...t)};function Af(e,t,n){return void 0!==t[e]?t[e]:n[e]}const Rf={blendEquation:(e,t,n)=>e.blendEquationSeparate(Af(32777,t,n),Af(34877,t,n)),blendFunc:(e,t,n)=>e.blendFuncSeparate(Af(32969,t,n),Af(32968,t,n),Af(32971,t,n),Af(32970,t,n)),polygonOffset:(e,t,n)=>e.polygonOffset(Af(32824,t,n),Af(10752,t,n)),sampleCoverage:(e,t,n)=>e.sampleCoverage(Af(32938,t,n),Af(32939,t,n)),stencilFuncFront:(e,t,n)=>e.stencilFuncSeparate(1028,Af(2962,t,n),Af(2967,t,n),Af(2963,t,n)),stencilFuncBack:(e,t,n)=>e.stencilFuncSeparate(1029,Af(34816,t,n),Af(36003,t,n),Af(36004,t,n)),stencilOpFront:(e,t,n)=>e.stencilOpSeparate(1028,Af(2964,t,n),Af(2965,t,n),Af(2966,t,n)),stencilOpBack:(e,t,n)=>e.stencilOpSeparate(1029,Af(34817,t,n),Af(34818,t,n),Af(34819,t,n))},Cf={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,n)=>e({[t]:n}),hint:(e,t,n)=>e({[t]:n}),useProgram:(e,t)=>e({35725:t}),bindRenderbuffer:(e,t,n)=>e({36007:n}),bindTransformFeedback:(e,t,n)=>e({36389:n}),bindVertexArray:(e,t)=>e({34229:t}),bindFramebuffer:(e,t,n)=>{switch(t){case 36160:return e({36006:n,36010:n});case 36009:return e({36006:n});case 36008:return e({36010:n});default:return null}},bindBuffer:(e,t,n)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return r?e({[r]:n}):{valueChanged:!0}},blendColor:(e,t,n,r,s)=>e({32773:new Float32Array([t,n,r,s])}),blendEquation:(e,t)=>e({32777:t,34877:t}),blendEquationSeparate:(e,t,n)=>e({32777:t,34877:n}),blendFunc:(e,t,n)=>e({32969:t,32968:n,32971:t,32970:n}),blendFuncSeparate:(e,t,n,r,s)=>e({32969:t,32968:n,32971:r,32970:s}),clearColor:(e,t,n,r,s)=>e({3106:new Float32Array([t,n,r,s])}),clearDepth:(e,t)=>e({2931:t}),clearStencil:(e,t)=>e({2961:t}),colorMask:(e,t,n,r,s)=>e({3107:[t,n,r,s]}),cullFace:(e,t)=>e({2885:t}),depthFunc:(e,t)=>e({2932:t}),depthRange:(e,t,n)=>e({2928:new Float32Array([t,n])}),depthMask:(e,t)=>e({2930:t}),frontFace:(e,t)=>e({2886:t}),lineWidth:(e,t)=>e({2849:t}),polygonOffset:(e,t,n)=>e({32824:t,10752:n}),sampleCoverage:(e,t,n)=>e({32938:t,32939:n}),scissor:(e,t,n,r,s)=>e({3088:new Int32Array([t,n,r,s])}),stencilMask:(e,t)=>e({2968:t,36005:t}),stencilMaskSeparate:(e,t,n)=>e({[1028===t?2968:36005]:n}),stencilFunc:(e,t,n,r)=>e({2962:t,2967:n,2963:r,34816:t,36003:n,36004:r}),stencilFuncSeparate:(e,t,n,r,s)=>e({[1028===t?2962:34816]:n,[1028===t?2967:36003]:r,[1028===t?2963:36004]:s}),stencilOp:(e,t,n,r)=>e({2964:t,2965:n,2966:r,34817:t,34818:n,34819:r}),stencilOpSeparate:(e,t,n,r,s)=>e({[1028===t?2964:34817]:n,[1028===t?2965:34818]:r,[1028===t?2966:34819]:s}),viewport:(e,t,n,r,s)=>e({2978:[t,n,r,s]})},kf=(e,t)=>e.isEnabled(t),If={3042:kf,2884:kf,2929:kf,3024:kf,32823:kf,32926:kf,32928:kf,3089:kf,2960:kf,35977:kf},Pf=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Mf(e,t){if(function(e){for(const t in e)return!1;return!0}(t))return;const n={};for(const s in t){const r=Number(s),i=Sf[s];i&&("string"==typeof i?n[i]=!0:i(e,t[s],r))}const r=e.state&&e.state.cache;if(r)for(const s in n)(0,Rf[s])(e,t,r)}function Nf(e,t=yf){if("number"==typeof t){const n=t,r=If[n];return r?r(e,n):e.getParameter(n)}const n=Array.isArray(t)?t:Object.keys(t),r={};for(const s of n){const t=If[s];r[s]=t?t(e,Number(s)):e.getParameter(Number(s))}return r}function Lf(e,t){if(e===t)return!0;if(Of(e)&&Of(t)&&e.length===t.length){for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}return!1}function Of(e){return Array.isArray(e)||ArrayBuffer.isView(e)}class Ff{constructor(e,t){r(this,"gl"),r(this,"program",null),r(this,"stateStack",[]),r(this,"enable",!0),r(this,"cache",null),r(this,"log"),r(this,"initialized",!1),this.gl=e,this.log=(null==t?void 0:t.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Mf(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=(null==t?void 0:t.copyState)?Nf(e):Object.assign({},yf),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,function(e){const t=e.useProgram.bind(e);e.useProgram=function(n){const r=Ff.get(e);r.program!==n&&(t(n),r.program=n)}}(e);for(const n in Cf)Bf(e,n,Cf[n]);Df(e,"getParameter"),Df(e,"isEnabled")}_updateCache(e){let t,n=!1;const r=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){const i=e[s],o=this.cache[s];Lf(i,o)||(n=!0,t=o,r&&!(s in r)&&(r[s]=o),this.cache[s]=i)}return{valueChanged:n,oldValue:t}}}function Df(e,t){const n=e[t].bind(e);e[t]=function(t){if(void 0===t||Pf.has(t))return n(t);const r=Ff.get(e);return t in r.cache||(r.cache[t]=n(t)),r.enable?r.cache[t]:n(t)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function Bf(e,t,n){if(!e[t])return;const r=e[t].bind(e);e[t]=function(...t){const s=Ff.get(e),{valueChanged:i,oldValue:o}=n(s._updateCache,...t);return i&&r(...t),o},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}function Uf(e,t,n){return void 0===n[t]&&(n[t]=e.getExtension(t)||null),n[t]}function jf(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}function Vf(e){switch(e){case"uint8":case"unorm8":return 5121;case"sint8":case"snorm8":return 5120;case"uint16":case"unorm16":return 5123;case"sint16":case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(e))}const Gf="WEBGL_compressed_texture_s3tc",zf="WEBGL_compressed_texture_s3tc_srgb",Wf="EXT_texture_compression_rgtc",Hf="EXT_texture_compression_bptc",$f="EXT_texture_norm16",Xf="EXT_render_snorm",qf={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[Xf],"norm16-renderable-webgl":[$f],"snorm16-renderable-webgl":[$f,Xf],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Gf,zf,Wf,Hf],"texture-compression-bc5-webgl":[Wf],"texture-compression-bc7-webgl":[Hf],"texture-compression-etc2":["WEBGL_compressed_texture_etc"],"texture-compression-astc":["WEBGL_compressed_texture_astc"],"texture-compression-etc1-webgl":["WEBGL_compressed_texture_etc1"],"texture-compression-pvrtc-webgl":["WEBGL_compressed_texture_pvrtc"],"texture-compression-atc-webgl":["WEBGL_compressed_texture_atc"]},Yf={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},r16unorm:{gl:33322,rb:!0},r16snorm:{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},rg16unorm:{gl:33324},rg16snorm:{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},rgb10a2uint:{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},rgba16unorm:{gl:32859,rb:!0},rgba16snorm:{gl:36763},"rgb32float-webgl":{gl:34837,x:"EXT_color_buffer_float",dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Gf},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:zf},"bc1-rgba-unorm":{gl:33777,x:Gf},"bc1-rgba-unorm-srgb":{gl:35916,x:zf},"bc2-rgba-unorm":{gl:33778,x:Gf},"bc2-rgba-unorm-srgb":{gl:35918,x:zf},"bc3-rgba-unorm":{gl:33779,x:Gf},"bc3-rgba-unorm-srgb":{gl:35919,x:zf},"bc4-r-unorm":{gl:36283,x:Wf},"bc4-r-snorm":{gl:36284,x:Wf},"bc5-rg-unorm":{gl:36285,x:Wf},"bc5-rg-snorm":{gl:36286,x:Wf},"bc6h-rgb-ufloat":{gl:36495,x:Hf},"bc6h-rgb-float":{gl:36494,x:Hf},"bc7-rgba-unorm":{gl:36492,x:Hf},"bc7-rgba-unorm-srgb":{gl:36493,x:Hf},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function Kf(e){var t;const n=Yf[e],r=function(e){const t=Yf[e],n=null==t?void 0:t.gl;if(void 0===n)throw new Error(`Unsupported texture format ${e}`);return n}(e),s=ms.getInfo(e);return s.compressed&&(n.dataFormat=r),{internalFormat:r,format:(null==n?void 0:n.dataFormat)||Zf(s.channels,s.integer,s.normalized,r),type:s.dataType?Vf(s.dataType):(null==(t=null==n?void 0:n.types)?void 0:t[0])||5121,compressed:s.compressed||!1}}function Zf(e,t,n,r){if(6408===r||6407===r)return r;switch(e){case"r":return t&&!n?36244:6403;case"rg":return t&&!n?33320:33319;case"rgb":return t&&!n?36248:6407;case"rgba":return t&&!n?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}const Qf={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class Jf extends bs{constructor(e,t,n){super([],n),r(this,"gl"),r(this,"extensions"),r(this,"testedFeatures",new Set),this.gl=e,this.extensions=t,Uf(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){const e=this.getFeatures();for(const t of e)this.has(t)&&(yield t);return[]}has(e){var t;return!(null==(t=this.disabledFeatures)?void 0:t[e])&&(this.testedFeatures.has(e)||(this.testedFeatures.add(e),function(e){return e in qf}(e)&&function(e,t,n){return(qf[t]||[]).every(t=>Uf(e,t,n))}(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(e=>"polygon-mode-webgl"!==e);for(const t of e)this.has(t)}getFeatures(){return[...Object.keys(Qf),...Object.keys(qf)]}getWebGLFeature(e){const t=Qf[e];return"string"==typeof t?Boolean(Uf(this.gl,t,this.extensions)):Boolean(t)}}class ep extends ys{constructor(e){super(),r(this,"gl"),r(this,"limits",{}),this.gl=e}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderVariables(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(e){return void 0===this.limits[e]&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class tp extends $s{constructor(e,t){super(e,t),r(this,"device"),r(this,"gl"),r(this,"handle"),r(this,"colorAttachments",[]),r(this,"depthStencilAttachment",null);const n=null===t.handle;this.device=e,this.gl=e.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),n||(e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),this.destroyed||null===this.handle||this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let t=0;t<this.colorAttachments.length;++t){const e=this.colorAttachments[t];if(e){const n=36064+t;this._attachTextureView(n,e)}}if(this.depthStencilAttachment){const e=function(e){switch(ms.getInfo(e).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${e}`)}}(this.depthStencilAttachment.props.format);this._attachTextureView(e,this.depthStencilAttachment)}if(this.device.props.debug){const e=this.gl.checkFramebufferStatus(36160);if(36053!==e)throw new Error(`Framebuffer ${function(e){switch(e){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${e}`}}(e)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,t){const{gl:n}=this.device,{texture:r}=t,s=t.props.baseMipLevel,i=t.props.baseArrayLayer;switch(n.bindTexture(r.glTarget,r.handle),r.glTarget){case 35866:case 32879:n.framebufferTextureLayer(36160,e,r.handle,s,i);break;case 34067:const t=function(e){return e<34069?e+34069:e}(i);n.framebufferTexture2D(36160,e,t,r.handle,s);break;case 3553:n.framebufferTexture2D(36160,e,3553,r.handle,s);break;default:throw new Error("Illegal texture type")}n.bindTexture(r.glTarget,null)}}class np extends Is{constructor(e,t){super(t),r(this,"device"),r(this,"handle",null),r(this,"_framebuffer",null),this.device=e,this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this._updateDevice()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this._framebuffer=this._framebuffer||new tp(this.device,{handle:null}),this._framebuffer}_updateDevice(){}}const rp={};function sp(e="id"){return rp[e]=rp[e]||1,`${e}-${rp[e]++}`}class ip extends $r{constructor(e,t={}){super(e,t),r(this,"device"),r(this,"gl"),r(this,"handle"),r(this,"glTarget"),r(this,"glUsage"),r(this,"glIndexType",5123),r(this,"byteLength",0),r(this,"bytesUsed",0),this.device=e,this.gl=this.device.gl;const n="object"==typeof t?t.handle:void 0;var s;this.handle=n||this.gl.createBuffer(),e._setWebGLDebugMetadata(this.handle,this,{spector:{...this.props,data:typeof this.props.data}}),this.glTarget=(s=this.props.usage)&$r.INDEX?34963:s&$r.VERTEX?34962:s&$r.UNIFORM?35345:34962,this.glUsage=function(e){return e&$r.INDEX||e&$r.VERTEX?35044:e&$r.UNIFORM?35048:35044}(this.props.usage),this.glIndexType="uint32"===this.props.indexType?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}_initWithData(e,t=0,n=e.byteLength+t){const r=this.glTarget;this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,n,this.glUsage),this.gl.bufferSubData(r,t,e),this.gl.bindBuffer(r,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(e,t,n),this.trackAllocatedMemory(n)}_initWithByteLength(e){let t=e;0===e&&(t=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,t,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}write(e,t=0){const n=ArrayBuffer.isView(e)?e:new Uint8Array(e),r=36663;this.gl.bindBuffer(r,this.handle),this.gl.bufferSubData(r,t,n),this.gl.bindBuffer(r,null),this._setDebugData(e,t,e.byteLength)}async mapAndWriteAsync(e,t=0,n=this.byteLength-t){const r=new ArrayBuffer(n);await e(r,"copied"),this.write(r,t)}async readAsync(e=0,t){return this.readSyncWebGL(e,t)}async mapAndReadAsync(e,t=0,n){const r=await this.readAsync(t,n);return await e(r.buffer,"copied")}readSyncWebGL(e=0,t){t=t??this.byteLength-e;const n=new Uint8Array(t);return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,n,0,t),this.gl.bindBuffer(36662,null),this._setDebugData(n,e,t),n}}function op(e){const t=e.toLowerCase();return["warning","error","info"].includes(t)?t:"info"}class ap extends zs{constructor(e,t){switch(super(e,t),r(this,"device"),r(this,"handle"),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0,this.handle.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>(this._getCompilationStatus(),this.compilationStatus))}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?function(e){const t=e.split(/\r?\n/),n=[];for(const r of t){if(r.length<=1)continue;const e=r.split(":");if(2===e.length){const[t,r]=e;n.push({message:r.trim(),type:op(t),lineNum:0,linePos:0});continue}const[t,s,i,...o]=e;let a=parseInt(i,10);isNaN(a)&&(a=0);let l=parseInt(s,10);isNaN(l)&&(l=0),n.push({message:o.join(":").trim(),type:op(t),lineNum:a,linePos:l})}return n}(e):[]}getTranslatedSource(){const e=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(null==e?void 0:e.getTranslatedShaderSource(this.handle))||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es\n${e}`;const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),this.device.props.debug){if(this.device.features.has("compilation-status-async-webgl"))Vr.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Vr.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader();else if(this._getCompilationStatus(),this.debugShader(),"error"===this.compilationStatus)throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`)}else this.compilationStatus="pending"}async _waitForCompilationComplete(){const e=async e=>await new Promise(t=>setTimeout(t,e));if(!this.device.features.has("compilation-status-async-webgl"))return void(await e(10));const{gl:t}=this.device;for(;;){if(t.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function lp(e,t){return dp(e,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function cp(e,t){return dp(e,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function up(e,t){return dp(e,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function hp(e,t,n="color"){return dp(e,t,{one:1,zero:0,src:768,"one-minus-src":769,dst:774,"one-minus-dst":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,constant:"color"===n?32769:32771,"one-minus-constant":"color"===n?32770:32772,src1:768,"one-minus-src1":769,"src1-alpha":770,"one-minus-src1-alpha":771})}function dp(e,t,n){if(!(t in n))throw new Error(function(e,t){return`Illegal parameter ${t} for ${e}`}(e,t));return n[t]}function fp(e){const t={};return e.addressModeU&&(t[10242]=pp(e.addressModeU)),e.addressModeV&&(t[10243]=pp(e.addressModeV)),e.addressModeW&&(t[32882]=pp(e.addressModeW)),e.magFilter&&(t[10240]=gp(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[10241]=function(e,t="none"){if(!t)return gp(e);switch(t){case"none":return gp(e);case"nearest":switch(e){case"nearest":return 9984;case"linear":return 9985}break;case"linear":switch(e){case"nearest":return 9986;case"linear":return 9987}}}(e.minFilter||"linear",e.mipmapFilter)),void 0!==e.lodMinClamp&&(t[33082]=e.lodMinClamp),void 0!==e.lodMaxClamp&&(t[33083]=e.lodMaxClamp),"comparison-sampler"===e.type&&(t[34892]=34894),e.compare&&(t[34893]=lp("compare",e.compare)),e.maxAnisotropy&&(t[34046]=e.maxAnisotropy),t}function pp(e){switch(e){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function gp(e){switch(e){case"nearest":return 9728;case"linear":return 9729}}class mp extends Ls{constructor(e,t){super(e,t),r(this,"device"),r(this,"handle"),r(this,"parameters"),this.device=e,this.parameters=fp(t),this.handle=t.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[t,n]of Object.entries(e)){const e=Number(t);switch(e){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,e,n);break;default:this.device.gl.samplerParameteri(this.handle,e,n)}}}}function _p(e,t,n){if(function(e){for(const t in e)return!1;return!0}(t))return n(e);const{nocatch:r=!0}=t,s=Ff.get(e);let i;if(s.push(),Mf(e,t),r)i=n(e),s.pop();else try{i=n(e)}finally{s.pop()}return i}class yp extends Us{constructor(e,t){super(e,{...Ds.defaultProps,...t}),r(this,"device"),r(this,"gl"),r(this,"handle"),r(this,"texture"),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}class bp extends Ds{constructor(e,t){super(e,t),r(this,"device"),r(this,"gl"),r(this,"handle"),r(this,"sampler"),r(this,"view"),r(this,"glTarget"),r(this,"glFormat"),r(this,"glType"),r(this,"glInternalFormat"),r(this,"compressed"),r(this,"_textureUnit",0),this.device=e,this.gl=this.device.gl;const n=Kf(this.props.format);this.glTarget=function(e){switch(e){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(e)}(this.props.dimension),this.glInternalFormat=n.internalFormat,this.glFormat=n.format,this.glType=n.type,this.compressed=n.compressed,this.handle=this.props.handle||this.gl.createTexture(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.gl.bindTexture(this.glTarget,this.handle);const{dimension:s,width:i,height:o,depth:a,mipLevels:l,glTarget:c,glInternalFormat:u}=this;switch(s){case"2d":case"cube":this.gl.texStorage2D(c,l,u,i,o);break;case"2d-array":case"3d":this.gl.texStorage3D(c,l,u,i,o,a);break;default:throw new Error(s)}this.gl.bindTexture(this.glTarget,null),this._initializeData(t.data),this.setSampler(this.props.sampler),this.view=new yp(this.device,{...this.props,texture:this}),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new yp(this.device,{...e,texture:this})}setSampler(e={}){super.setSampler(e);const t=fp(this.sampler.props);this._setSamplerParameters(t)}copyImageData(e){const t=this._normalizeCopyImageDataOptions(e),n=t.data,{width:r,height:s,depth:i}=this,{mipLevel:o=0,byteOffset:a=0,x:l=0,y:c=0,z:u=0}=t,{glFormat:h,glType:d,compressed:f}=this,p=vp(this.glTarget,this.dimension,u);let g;if(!this.compressed){const{bytesPerPixel:e}=this.device.getTextureFormatInfo(this.format);if(e){if(t.bytesPerRow%e!==0)throw new Error(`bytesPerRow (${t.bytesPerRow}) must be a multiple of bytesPerPixel (${e}) for ${this.format}`);g=t.bytesPerRow/e}}const m=this.compressed?{}:{...void 0!==g?{3314:g}:{},32878:t.rowsPerImage};this.gl.bindTexture(p,this.handle),_p(this.gl,m,()=>{switch(this.dimension){case"2d":case"cube":f?this.gl.compressedTexSubImage2D(p,o,l,c,r,s,h,n,a):this.gl.texSubImage2D(p,o,l,c,r,s,h,d,n,a);break;case"2d-array":case"3d":f?this.gl.compressedTexSubImage3D(p,o,l,c,u,r,s,i,h,n,a):this.gl.texSubImage3D(p,o,l,c,u,r,s,i,h,d,n,a)}}),this.gl.bindTexture(p,null)}copyExternalImage(e){const t=this._normalizeCopyExternalImageOptions(e);if(t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");const{glFormat:n,glType:r}=this,{image:s,depth:i,mipLevel:o,x:a,y:l,z:c,width:u,height:h}=t,d=vp(this.glTarget,this.dimension,i),f=t.flipY?{37440:!0}:{};return this.gl.bindTexture(this.glTarget,this.handle),_p(this.gl,f,()=>{switch(this.dimension){case"2d":case"cube":this.gl.texSubImage2D(d,o,a,l,u,h,n,r,s);break;case"2d-array":case"3d":this.gl.texSubImage3D(d,o,a,l,c,u,h,i,n,r,s)}}),this.gl.bindTexture(this.glTarget,null),{width:t.width,height:t.height}}generateMipmapsWebGL(e){if(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format)||(Vr.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),null==e?void 0:e.force))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(t){Vr.warn(`Error generating mipmap for ${this}: ${t.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}_setSamplerParameters(e){Vr.log(2,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[t,n]of Object.entries(e)){const e=Number(t),r=n;switch(e){case 33082:case 33083:this.gl.texParameterf(this.glTarget,e,r);break;case 10240:case 10241:case 10242:case 10243:case 32882:case 34892:case 34893:this.gl.texParameteri(this.glTarget,e,r);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,e,r)}}this.gl.bindTexture(this.glTarget,null)}_getActiveUnit(){return this.gl.getParameter(34016)-33984}_bind(e){const{gl:t}=this;return void 0!==e&&(this._textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,this.handle),e}_unbind(e){const{gl:t}=this;return void 0!==e&&(this._textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,null),e}}function vp(e,t,n){return"cube"===t?34069+n:e}function xp(e){return Tp[e]}function wp(e){return Boolean(Sp[e])}function Ep(e){return Sp[e]}const Tp={5126:"f32",35664:"vec2<f32>",35665:"vec3<f32>",35666:"vec4<f32>",5124:"i32",35667:"vec2<i32>",35668:"vec3<i32>",35669:"vec4<i32>",5125:"u32",36294:"vec2<u32>",36295:"vec3<u32>",36296:"vec4<u32>",35670:"f32",35671:"vec2<f32>",35672:"vec3<f32>",35673:"vec4<f32>",35674:"mat2x2<f32>",35685:"mat2x3<f32>",35686:"mat2x4<f32>",35687:"mat3x2<f32>",35675:"mat3x3<f32>",35688:"mat3x4<f32>",35689:"mat4x2<f32>",35690:"mat4x3<f32>",35676:"mat4x4<f32>"},Sp={35678:{viewDimension:"2d",sampleType:"float"},35680:{viewDimension:"cube",sampleType:"float"},35679:{viewDimension:"3d",sampleType:"float"},35682:{viewDimension:"3d",sampleType:"depth"},36289:{viewDimension:"2d-array",sampleType:"float"},36292:{viewDimension:"2d-array",sampleType:"depth"},36293:{viewDimension:"cube",sampleType:"float"},36298:{viewDimension:"2d",sampleType:"sint"},36299:{viewDimension:"3d",sampleType:"sint"},36300:{viewDimension:"cube",sampleType:"sint"},36303:{viewDimension:"2d-array",sampleType:"uint"},36306:{viewDimension:"2d",sampleType:"uint"},36307:{viewDimension:"3d",sampleType:"uint"},36308:{viewDimension:"cube",sampleType:"uint"},36311:{viewDimension:"2d-array",sampleType:"uint"}},Ap={uint8:5121,sint8:5120,unorm8:5121,snorm8:5120,uint16:5123,sint16:5122,unorm16:5123,snorm16:5122,uint32:5125,sint32:5124,float16:5131,float32:5126};function Rp(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:t[1],length:t[2]?1:0,isArray:Boolean(t[2])}}function Cp(e,t,n,r){const s=e;let i=r;!0===i&&(i=1),!1===i&&(i=0);const o="number"==typeof i?[i]:i;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if("number"!=typeof r)throw new Error("samplers must be set to integers");return e.uniform1i(t,r);case 5126:return e.uniform1fv(t,o);case 35664:return e.uniform2fv(t,o);case 35665:return e.uniform3fv(t,o);case 35666:return e.uniform4fv(t,o);case 5124:case 35670:return e.uniform1iv(t,o);case 35667:case 35671:return e.uniform2iv(t,o);case 35668:case 35672:return e.uniform3iv(t,o);case 35669:case 35673:return e.uniform4iv(t,o);case 5125:return s.uniform1uiv(t,o,1);case 36294:return s.uniform2uiv(t,o,2);case 36295:return s.uniform3uiv(t,o,3);case 36296:return s.uniform4uiv(t,o,4);case 35674:return e.uniformMatrix2fv(t,!1,o);case 35675:return e.uniformMatrix3fv(t,!1,o);case 35676:return e.uniformMatrix4fv(t,!1,o);case 35685:return s.uniformMatrix2x3fv(t,!1,o);case 35686:return s.uniformMatrix2x4fv(t,!1,o);case 35687:return s.uniformMatrix3x2fv(t,!1,o);case 35688:return s.uniformMatrix3x4fv(t,!1,o);case 35689:return s.uniformMatrix4x2fv(t,!1,o);case 35690:return s.uniformMatrix4x3fv(t,!1,o)}throw new Error("Illegal uniform")}class kp extends qs{constructor(e,t){super(e,t),r(this,"device"),r(this,"handle"),r(this,"vs"),r(this,"fs"),r(this,"introspectedLayout"),r(this,"uniforms",{}),r(this,"bindings",{}),r(this,"varyings",null),r(this,"_uniformCount",0),r(this,"_uniformSetters",{}),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:{id:this.props.id}}),this.vs=t.vs,this.fs=t.fs;const{varyings:n,bufferMode:s=35981}=t;n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,s)),this._linkShaders(),Vr.time(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=function(e,t){const n={attributes:[],bindings:[]};n.attributes=function(e,t){const n=[],r=e.getProgramParameter(t,35721);for(let s=0;s<r;s++){const r=e.getActiveAttrib(t,s);if(!r)throw new Error("activeInfo");const{name:i,type:o}=r,a=e.getAttribLocation(t,i);if(a>=0){const e=xp(o),t=/instance/i.test(i)?"instance":"vertex";n.push({name:i,location:a,stepMode:t,type:e})}}return n.sort((e,t)=>e.location-t.location),n}(e,t);const r=function(e,t){const n=(n,r)=>e.getActiveUniformBlockParameter(t,n,r),r=[],s=e.getProgramParameter(t,35382);for(let i=0;i<s;i++){const s={name:e.getActiveUniformBlockName(t,i)||"",location:n(i,35391),byteLength:n(i,35392),vertex:n(i,35396),fragment:n(i,35398),uniformCount:n(i,35394),uniforms:[]},o=n(i,35395)||[],a=e.getActiveUniforms(t,o,35383),l=e.getActiveUniforms(t,o,35384),c=e.getActiveUniforms(t,o,35387),u=e.getActiveUniforms(t,o,35388);for(let n=0;n<s.uniformCount;++n){const r=e.getActiveUniform(t,o[n]);if(!r)throw new Error("activeInfo");const i=xp(a[n]);s.uniforms.push({name:r.name,format:i,type:a[n],arrayLength:l[n],byteOffset:c[n],byteStride:u[n]})}r.push(s)}return r.sort((e,t)=>e.location-t.location),r}(e,t);for(const a of r){const e=a.uniforms.map(e=>({name:e.name,format:e.format,byteOffset:e.byteOffset,byteStride:e.byteStride,arrayLength:e.arrayLength}));n.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:e})}const s=function(e,t){const n=[],r=e.getProgramParameter(t,35718);for(let s=0;s<r;s++){const r=e.getActiveUniform(t,s);if(!r)throw new Error("activeInfo");const{name:i,size:o,type:a}=r,{name:l,isArray:c}=Rp(i);let u=e.getUniformLocation(t,l);const h={location:u,name:l,size:o,type:a,isArray:c};if(n.push(h),h.size>1)for(let s=0;s<h.size;s++){const r=`${l}[${s}]`;u=e.getUniformLocation(t,r);const i={...h,name:r,location:u};n.push(i)}}return n}(e,t);let i=0;for(const a of s)if(wp(a.type)){const{viewDimension:e,sampleType:t}=Ep(a.type);n.bindings.push({type:"texture",name:a.name,group:0,location:i,viewDimension:e,sampleType:t}),a.textureUnit=i,i+=1}s.length&&(n.uniforms=s);const o=function(e,t){const n=[],r=e.getProgramParameter(t,35971);for(let s=0;s<r;s++){const r=e.getTransformFeedbackVarying(t,s);if(!r)throw new Error("activeInfo");const{name:i,type:o,size:a}=r,l=xp(o),{type:c,components:u}=ri(l);n.push({location:s,name:i,type:c,size:a*u})}return n.sort((e,t)=>e.location-t.location),n}(e,t);return(null==o?void 0:o.length)&&(n.varyings=o),n}(this.device.gl,this.handle),Vr.timeEnd(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=t.shaderLayout?function(e,t){const n={...e,attributes:e.attributes.map(e=>({...e}))};for(const r of(null==t?void 0:t.attributes)||[]){const e=n.attributes.find(e=>e.name===r.name);e?(e.type=r.type||e.type,e.stepMode=r.stepMode||e.stepMode):Vr.warn(`shader layout attribute ${r.name} not present in shader`)}return n}(this.introspectedLayout,t.shaderLayout):this.introspectedLayout}get[Symbol.toStringTag](){return"WEBGLRenderPipeline"}destroy(){this.handle&&(this.device.gl.useProgram(null),this.device.gl.deleteProgram(this.handle),this.destroyed=!0,this.handle.destroyed=!0,this.handle=null)}setBindings(e,t){for(const[n,r]of Object.entries(e)){const e=this.shaderLayout.bindings.find(e=>e.name===n)||this.shaderLayout.bindings.find(e=>e.name===`${n}Uniforms`);if(!e){const e=this.shaderLayout.bindings.map(e=>`"${e.name}"`).join(", ");(null==t?void 0:t.disableWarnings)||Vr.warn(`No binding "${n}" in render pipeline "${this.id}", expected one of ${e}`,r)();continue}switch(r||Vr.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),e.type){case"uniform":if(!(r instanceof ip||r.buffer instanceof ip))throw new Error("buffer value");break;case"texture":if(!(r instanceof yp||r instanceof bp||r instanceof tp))throw new Error(`${this} Bad texture binding for ${n}`);break;case"sampler":Vr.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(e.type)}this.bindings[n]=r}}draw(e){var t;const{renderPass:n,parameters:r=this.props.parameters,topology:s=this.props.topology,vertexArray:i,vertexCount:o,instanceCount:a,isInstanced:l=!1,firstVertex:c=0,transformFeedback:u}=e,h=function(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(e)}}(s),d=Boolean(i.indexBuffer),f=null==(t=i.indexBuffer)?void 0:t.glIndexType;if("success"!==this.linkStatus)return Vr.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return Vr.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),i.bindBeforeRender(n),u&&u.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const p=n;return function(e,t,n,r){if(function(e){let t=!0;for(const n in e){t=!1;break}return t}(t))return r(e);const s=e;s.pushState();try{return function(e,t){const n=e,{gl:r}=n;if(t.cullMode)switch(t.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029)}if(t.frontFace&&r.frontFace(dp("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&e.features.has("depth-clip-control")&&r.enable(34383),void 0!==t.depthBias&&(r.enable(32823),r.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&e.features.has("provoking-vertex-webgl")){const e=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,r=dp("provokingVertex",t.provokingVertex,{first:36429,last:36430});null==e||e.provokingVertexWEBGL(r)}if((t.polygonMode||t.polygonOffsetLine)&&e.features.has("polygon-mode-webgl")){if(t.polygonMode){const e=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,r=dp("polygonMode",t.polygonMode,{fill:6914,line:6913});null==e||e.polygonModeWEBGL(1028,r),null==e||e.polygonModeWEBGL(1029,r)}t.polygonOffsetLine&&r.enable(10754)}if(e.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&r.enable(12288),t.clipDistance1&&r.enable(12289),t.clipDistance2&&r.enable(12290),t.clipDistance3&&r.enable(12291),t.clipDistance4&&r.enable(12292),t.clipDistance5&&r.enable(12293),t.clipDistance6&&r.enable(12294),t.clipDistance7&&r.enable(12295)),void 0!==t.depthWriteEnabled&&r.depthMask(t.depthWriteEnabled),t.depthCompare&&("always"!==t.depthCompare?r.enable(2929):r.disable(2929),r.depthFunc(lp("depthCompare",t.depthCompare))),t.stencilWriteMask){const e=t.stencilWriteMask;r.stencilMaskSeparate(1028,e),r.stencilMaskSeparate(1029,e)}if(t.stencilReadMask&&Vr.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){const e=t.stencilReadMask||4294967295,n=lp("depthCompare",t.stencilCompare);"always"!==t.stencilCompare?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,n,0,e),r.stencilFuncSeparate(1029,n,0,e)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){const e=cp("stencilPassOperation",t.stencilPassOperation),n=cp("stencilFailOperation",t.stencilFailOperation),s=cp("stencilDepthFailOperation",t.stencilDepthFailOperation);r.stencilOpSeparate(1028,n,s,e),r.stencilOpSeparate(1029,n,s,e)}switch(t.blend){case!0:r.enable(3042);break;case!1:r.disable(3042)}if(t.blendColorOperation||t.blendAlphaOperation){const e=up("blendColorOperation",t.blendColorOperation||"add"),n=up("blendAlphaOperation",t.blendAlphaOperation||"add");r.blendEquationSeparate(e,n);const s=hp("blendColorSrcFactor",t.blendColorSrcFactor||"one"),i=hp("blendColorDstFactor",t.blendColorDstFactor||"zero"),o=hp("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),a=hp("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");r.blendFuncSeparate(s,i,o,a)}}(e,t),Mf(s.gl,n),r(e)}finally{s.popState()}}(this.device,r,p.glParameters,()=>{d&&l?this.device.gl.drawElementsInstanced(h,o||0,f,c,a||0):d?this.device.gl.drawElements(h,o||0,f,c):l?this.device.gl.drawArraysInstanced(h,c,o||0,a||0):this.device.gl.drawArrays(h,c,o||0),u&&u.end()}),i.unbindAfterRender(n),!0}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Vr.time(4,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),Vr.timeEnd(4,`linkProgram for ${this.id}`)(),Vr.level,!this.device.features.has("compilation-status-async-webgl")){const e=this._getLinkStatus();return void this._reportLinkStatus(e)}Vr.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Vr.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const t=this._getLinkStatus();this._reportLinkStatus(t)}async _reportLinkStatus(e){var t;if("success"!==e){const n="link-error"===e?"Link error":"Validation error";switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`${this} ${n} during compilation of ${this.vs}`);case"pending":await this.vs.asyncCompilationStatus,this.vs.debugShader()}switch(null==(t=this.fs)?void 0:t.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`${this} ${n} during compilation of ${this.fs}`);case"pending":await this.fs.asyncCompilationStatus,this.fs.debugShader()}const r=this.device.gl.getProgramInfoLog(this.handle);this.device.reportError(new Error(`${n} during ${e}: ${r}`),this)(),this.device.debug()}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation-error")):(this.linkStatus="error","link-error")}async _waitForLinkComplete(){const e=async e=>await new Promise(t=>setTimeout(t,e));if(!this.device.features.has("compilation-status-async-webgl"))return void(await e(10));const{gl:t}=this.device;for(;;){if(t.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const t of this.shaderLayout.bindings)this.bindings[t.name]||this.bindings[t.name.replace(/Uniforms$/,"")]||(Vr.warn(`Binding ${t.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if("success"!==this.linkStatus)return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,n=0;for(const r of this.shaderLayout.bindings){const s=this.bindings[r.name]||this.bindings[r.name.replace(/Uniforms$/,"")];if(!s)throw new Error(`No value for binding ${r.name} in ${this.id}`);switch(r.type){case"uniform":const{name:i}=r,o=e.getUniformBlockIndex(this.handle,i);if(4294967295===o)throw new Error(`Invalid uniform block name ${i}`);e.uniformBlockBinding(this.handle,n,o),s instanceof ip?e.bindBufferBase(35345,n,s.handle):e.bindBufferRange(35345,n,s.buffer.handle,s.offset||0,s.size||s.buffer.byteLength-s.offset),n+=1;break;case"texture":if(!(s instanceof yp||s instanceof bp||s instanceof tp))throw new Error("texture");let a;if(s instanceof yp)a=s.texture;else if(s instanceof bp)a=s;else{if(!(s instanceof tp&&s.colorAttachments[0]instanceof yp))throw new Error("No texture");Vr.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),a=s.colorAttachments[0].texture}e.activeTexture(33984+t),e.bindTexture(a.glTarget,a.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${r.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:t,location:n,type:r,textureUnit:s}=e,i=this.uniforms[t]??s;void 0!==i&&Cp(this.device.gl,n,r,i)}}}class Ip extends ni{constructor(e){super(e,{}),r(this,"device"),r(this,"handle",null),r(this,"commands",[]),this.device=e}_executeCommands(e=this.commands){for(const t of e)switch(t.name){case"copy-buffer-to-buffer":Pp(this.device,t.options);break;case"copy-buffer-to-texture":Mp(this.device,t.options);break;case"copy-texture-to-buffer":Np(this.device,t.options);break;case"copy-texture-to-texture":Lp(this.device,t.options);break;default:throw new Error(t.name)}}}function Pp(e,t){const n=t.sourceBuffer,r=t.destinationBuffer;e.gl.bindBuffer(36662,n.handle),e.gl.bindBuffer(36663,r.handle),e.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),e.gl.bindBuffer(36662,null),e.gl.bindBuffer(36663,null)}function Mp(e,t){throw new Error("Not implemented")}function Np(e,t){const{sourceTexture:n,mipLevel:r=0,aspect:s="all",width:i=t.sourceTexture.width,height:o=t.sourceTexture.height,depthOrArrayLayers:a=0,origin:l=[0,0],destinationBuffer:c,byteOffset:u=0,bytesPerRow:h,rowsPerImage:d}=t;if("all"!==s)throw new Error("aspect not supported in WebGL");if(0!==r||0!==a||h||d)throw new Error("not implemented");const{framebuffer:f,destroyFramebuffer:p}=Op(n);let g;try{const t=c,n=i||f.width,r=o||f.height,s=Kf(f.colorAttachments[0].texture.props.format),a=s.format,h=s.type;e.gl.bindBuffer(35051,t.handle),g=e.gl.bindFramebuffer(36160,f.handle),e.gl.readPixels(l[0],l[1],n,r,a,h,u)}finally{e.gl.bindBuffer(35051,null),void 0!==g&&e.gl.bindFramebuffer(36160,g),p&&f.destroy()}}function Lp(e,t){const{sourceTexture:n,destinationMipLevel:r=0,origin:s=[0,0],destinationOrigin:i=[0,0],destinationTexture:o}=t;let{width:a=t.destinationTexture.width,height:l=t.destinationTexture.height}=t;const{framebuffer:c,destroyFramebuffer:u}=Op(n),[h,d]=s,[f,p,g]=i,m=e.gl.bindFramebuffer(36160,c.handle);let _,y;if(!(o instanceof bp))throw new Error("invalid destination");switch(_=o,a=Number.isFinite(a)?a:_.width,l=Number.isFinite(l)?l:_.height,_._bind(0),y=_.glTarget,y){case 3553:case 34067:e.gl.copyTexSubImage2D(y,r,f,p,h,d,a,l);break;case 35866:case 32879:e.gl.copyTexSubImage3D(y,r,f,p,g,h,d,a,l)}_&&_._unbind(),e.gl.bindFramebuffer(36160,m),u&&c.destroy()}function Op(e){if(e instanceof Ds){const{width:t,height:n,id:r}=e;return{framebuffer:e.device.createFramebuffer({id:`framebuffer-for-${r}`,width:t,height:n,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}const Fp=[1,2,4,8];class Dp extends Ks{constructor(e,t){var n;let s;if(super(e,t),r(this,"device"),r(this,"handle",null),r(this,"glParameters",{}),this.device=e,!(null==(n=null==t?void 0:t.parameters)?void 0:n.viewport))if(null==t?void 0:t.framebuffer){const{width:e,height:n}=t.framebuffer;s=[0,0,e,n]}else{const[t,n]=e.getDefaultCanvasContext().getDrawingBufferSize();s=[0,0,t,n]}this.device.pushState(),this.setParameters({viewport:s,...this.props.parameters});const i=this.props.framebuffer;if(this.props.framebuffer&&(null==i?void 0:i.handle)){const e=this.props.framebuffer.colorAttachments.map((e,t)=>36064+t);this.device.gl.drawBuffers(e)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const t={...this.glParameters};t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(t[2967]=e.stencilReference),"colorMask"in e&&(t.colorMask=Fp.map(t=>Boolean(t&e.colorMask))),this.glParameters=t,Mf(this.device.gl,t)}beginOcclusionQuery(e){const t=this.props.occlusionQuerySet;null==t||t.beginOcclusionQuery()}endOcclusionQuery(){const e=this.props.occlusionQuerySet;null==e||e.endOcclusionQuery()}clear(){const e={...this.glParameters};let t=0;this.props.clearColors&&this.props.clearColors.forEach((e,t)=>{e&&this.clearColorBuffer(t,e)}),!1!==this.props.clearColor&&void 0===this.props.clearColors&&(t|=16384,e.clearColor=this.props.clearColor),!1!==this.props.clearDepth&&(t|=256,e.clearDepth=this.props.clearDepth),!1!==this.props.clearStencil&&(t|=1024,e.clearStencil=this.props.clearStencil),0!==t&&_p(this.device.gl,e,()=>{this.device.gl.clear(t)})}clearColorBuffer(e=0,t=[0,0,0,0]){_p(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,t);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,t);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}class Bp extends ei{constructor(e,t){super(e,t),r(this,"device"),r(this,"handle",null),r(this,"commandBuffer"),this.device=e,this.commandBuffer=new Ip(e)}destroy(){}finish(){return this.commandBuffer}beginRenderPass(e){return new Dp(this.device,e)}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,n){}}class Up extends ui{constructor(e,t){super(e,t),r(this,"device"),r(this,"handle"),r(this,"buffer",null),r(this,"bufferValue",null),this.device=e,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(e){return"Chrome"==(Ke()?Ye()?"Electron":(qe.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node")}destroy(){var e;super.destroy(),this.buffer&&(null==(e=this.buffer)||e.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&34963!==t.glTarget)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){const n=t;if(34963===n.glTarget)throw new Error("Use .setIndexBuffer()");const{size:r,type:s,stride:i,offset:o,normalized:a,integer:l,divisor:c}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),l?this.device.gl.vertexAttribIPointer(e,r,s,i,o):this.device.gl.vertexAttribPointer(e,r,s,a,i,o),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,c||0),this.attributes[e]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error(`Unknown attribute location ${e}`);const n=Vf(t.bufferDataType);return{size:t.bufferComponents,type:n,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:"instance"===t.stepMode?1:0}}_enable(e,t=!0){const n=Up.isConstantAttributeZeroSupported(this.device);(t||n||0!==e)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const n=(i=t,Array.isArray(i)?new Float32Array(i):i),r=n.byteLength*e,s=n.length*e;var i;if(this.buffer&&r!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${r} !== ${this.buffer.byteLength}.`);let o=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:r}),o||(o=!function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(n,this.bufferValue)),o){const e=function(e,t){return new e(mi(e.BYTES_PER_ELEMENT*t),0,t)}(t.constructor,s);!function(e){const{target:t,source:n,start:r=0,count:s=1}=e,i=n.length,o=s*i;let a=0;for(let l=r;a<i;a++)t[l++]=n[a];for(;a<o;)a<o-a?(t.copyWithin(r+a,r,r+a),a*=2):(t.copyWithin(r+a,r,r+o-a),a=o)}({target:e,source:n,start:0,count:s}),this.buffer.write(e),this.bufferValue=t}return this.buffer}}class jp extends di{constructor(e,t){super(e,t),r(this,"device"),r(this,"gl"),r(this,"handle"),r(this,"layout"),r(this,"buffers",{}),r(this,"unusedBuffers",{}),r(this,"bindOnUse",!0),r(this,"_bound",!1),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(function(e){switch(e){case"point-list":return 0;case"line-list":case"line-strip":return 1;case"triangle-list":case"triangle-strip":return 4;default:throw new Error(e)}}(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])})}setBuffer(e,t){const n=this._getVaryingIndex(e),{buffer:r,byteLength:s,byteOffset:i}=this._getBufferRange(t);if(n<0)return this.unusedBuffers[e]=r,void Vr.warn(`${this.id} unusedBuffers varying buffer ${e}`)();this.buffers[n]={buffer:r,byteLength:s,byteOffset:i},this.bindOnUse||this._bindBuffer(n,r,i,s)}getBuffer(e){if(Vp(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e=this.handle){if("function"!=typeof e)return this.gl.bindTransformFeedback(36386,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof ip)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:n=0,byteLength:r=e.buffer.byteLength}=e;return{buffer:t,byteOffset:n,byteLength:r}}_getVaryingIndex(e){if(Vp(e))return Number(e);for(const t of this.layout.varyings||[])if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:n,byteOffset:r}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,r,n)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t,n=0,r){const s=t&&t.handle;s&&void 0!==r?this.gl.bindBufferRange(35982,e,s,n,r):this.gl.bindBufferBase(35982,e,s)}}function Vp(e){return"number"==typeof e?Number.isInteger(e):/^\d+$/.test(e)}class Gp extends gi{constructor(e,t){if(super(e,t),r(this,"device"),r(this,"handle"),r(this,"target",null),r(this,"_queryPending",!1),r(this,"_pollingPromise",null),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");const n=this.device.gl.createQuery();if(!n)throw new Error("WebGL query not supported");this.handle=n,Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin((null==e?void 0:e.conservative)?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((n,r)=>{const s=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):t++>e?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}}function zp(e){switch(e){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}const Wp={5124:"sint32",5125:"uint32",5122:"sint16",5123:"uint16",5120:"sint8",5121:"uint8",5126:"float32",5131:"float16",33635:"uint16",32819:"uint16",32820:"uint16",33640:"uint32",35899:"uint32",35902:"uint32",34042:"uint32",36269:"uint32"};function Hp(e){return e instanceof $s?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:$p(e),deleteFramebuffer:!0}}function $p(e,t){const{device:n,width:r,height:s,id:i}=e;return n.createFramebuffer({...t,id:`framebuffer-for-${i}`,width:r,height:s,colorAttachments:[e]})}class Xp extends xs{constructor(e){var t,n;super({...e,id:e.id||sp("webgl-device")}),r(this,"type","webgl"),r(this,"handle"),r(this,"features"),r(this,"limits"),r(this,"info"),r(this,"canvasContext"),r(this,"preferredColorFormat","rgba8unorm"),r(this,"preferredDepthFormat","depth24plus"),r(this,"commandEncoder"),r(this,"lost"),r(this,"_resolveContextLost"),r(this,"gl"),r(this,"_constants"),r(this,"_extensions",{}),r(this,"_polyfilled",!1),r(this,"spectorJS");const s=xs._getCanvasContextProps(e);if(!s)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=null==(n=null==(t=s.canvas)?void 0:t.gl)?void 0:n.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new np(this,s),this.lost=new Promise(e=>{this._resolveContextLost=e});const o={...e.webgl};"premultiplied"===s.alphaMode&&(o.premultipliedAlpha=!0),void 0!==e.powerPreference&&(o.powerPreference=e.powerPreference);const a=this.props._handle||function(e,t,n){let r="";const s={preserveDrawingBuffer:!0,...n};let i=null;if(i||(i=e.getContext("webgl2",s)),s.failIfMajorPerformanceCaveat&&(r||(r="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),i||n.failIfMajorPerformanceCaveat||(s.failIfMajorPerformanceCaveat=!1,i=e.getContext("webgl2",s),i.luma||(i.luma={}),i.luma.softwareRenderer=!0),i||(i=e.getContext("webgl",{}),i&&(i=null,r||(r="Your browser only supports WebGL1"))),!i)throw r||(r="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${r}`);const{onContextLost:o,onContextRestored:a}=t;return e.addEventListener("webglcontextlost",e=>o(e),!1),e.addEventListener("webglcontextrestored",e=>a(e),!1),i.luma||(i.luma={}),i}(this.canvasContext.canvas,{onContextLost:e=>{var t;return null==(t=this._resolveContextLost)?void 0:t.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:e=>{}},o);if(!a)throw new Error("WebGL context creation failed");if(i=a.device,i){if(e._reuseDevices)return Vr.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=a,this.gl=a,this.spectorJS=function(e){var t;if(!(e={...hf,...e}).debugSpectorJS)return null;if(!cf&&globalThis.SPECTOR&&!(null==(t=globalThis.luma)?void 0:t.spector)){Vr.probe(1,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;cf=new e,globalThis.luma&&(globalThis.luma.spector=cf)}if(!cf)return null;if(uf||(uf=!0,cf.spyCanvases(),null==cf||cf.onCaptureStarted.add(e=>Vr.info("Spector capture started:",e)()),null==cf||cf.onCapture.add(e=>{Vr.info("Spector capture complete:",e)(),null==cf||cf.getResultUI(),null==cf||cf.resultView.display(),null==cf||cf.resultView.addCapture(e)})),e.gl){const t=e.gl,n=t.device;null==cf||cf.startCapture(e.gl,500),t.device=n,new Promise(e=>setTimeout(e,2e3)).then(e=>{Vr.info("Spector capture stopped after 2 seconds")(),null==cf||cf.stopCapture()})}return cf}({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=function(e,t){const n=e.getParameter(7936),r=e.getParameter(7937);Uf(e,"WEBGL_debug_renderer_info",t);const s=t.WEBGL_debug_renderer_info,i=e.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936)||n,o=e.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937)||r,a=e.getParameter(7938),l=jf(i,o),c=function(e,t){return/Metal/i.exec(e)||/Metal/i.exec(t)?"metal":/ANGLE/i.exec(e)||/ANGLE/i.exec(t)?"opengl":"unknown"}(i,o),u=function(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(jf(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}(i,o);return{type:"webgl",gpu:l,gpuType:u,gpuBackend:c,vendor:i,renderer:o,version:a,shadingLanguage:"glsl",shadingLanguageVersion:300}}(this.gl,this._extensions),this.limits=new ep(this.gl),this.features=new Jf(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),new Ff(this.gl,{log:(...e)=>Vr.log(1,...e)()}).trackState(this.gl,{copyState:!1});const l=e.debugWebGL||e.debug,c=e.debugWebGL;l&&(this.gl=ff(this.gl,{debugWebGL:l,traceWebGL:c}),Vr.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(Vr.level=Math.max(Vr.level,1))),this.commandEncoder=new Bp(this,{id:`${this}-command-encoder`})}get[Symbol.toStringTag](){return"WebGLDevice"}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}isVertexFormatSupported(e){return"unorm8x4-bgra"!==e}destroy(){this.props._reuseDevices||this._reused||delete this.gl.device}get isLost(){return this.gl.isContextLost()}getTextureByteAlignment(){return 4}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._normalizeBufferProps(e);return new ip(this,t)}createTexture(e){return new bp(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new mp(this,e)}createShader(e){return new ap(this,e)}createFramebuffer(e){return new tp(this,e)}createVertexArray(e){return new Up(this,e)}createTransformFeedback(e){return new jp(this,e)}createQuerySet(e){return new Gp(this,e)}createRenderPipeline(e){return new kp(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}createCommandEncoder(e={}){return new Bp(this,e)}submit(e){e||(e=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:`${this.id}-default-encoder`})),e._executeCommands()}readPixelsToArrayWebGL(e,t){return function(e,t){var n;const{sourceX:r=0,sourceY:s=0,sourceAttachment:i=0}=t||{};let{target:o=null,sourceWidth:a,sourceHeight:l,sourceDepth:c,sourceFormat:u,sourceType:h}=t||{};const{framebuffer:d,deleteFramebuffer:f}=Hp(e),{gl:p,handle:g}=d;a||(a=d.width),l||(l=d.height);const m=null==(n=d.colorAttachments[i])?void 0:n.texture;if(!m)throw new Error(`Invalid framebuffer attachment ${i}`);c=(null==m?void 0:m.depth)||1,u||(u=(null==m?void 0:m.glFormat)||6408),h||(h=(null==m?void 0:m.glType)||5121),_=o,y=h,b=u,v=a,x=l,o=_||(y||(y=5121),new(Kr(Wp[y]))(v*x*zp(b)));var _,y,b,v,x;const w=Yr(o);h=h||Ap[w];const E=p.bindFramebuffer(36160,g);return p.readBuffer(36064+i),p.readPixels(r,s,a,l,u,h,o),p.readBuffer(36064),p.bindFramebuffer(36160,E||null),f&&d.destroy(),o}(e,t)}readPixelsToBufferWebGL(e,t){return function(e,t){const{target:n,sourceX:r=0,sourceY:s=0,sourceFormat:i=6408,targetByteOffset:o=0}=t||{};let{sourceWidth:a,sourceHeight:l,sourceType:c}=t||{};const{framebuffer:u,deleteFramebuffer:h}=Hp(e);a=a||u.width,l=l||u.height;const d=u;c=c||5121;let f=n;if(!f){const e=o+a*l*zp(i)*function(e){switch(e){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}(c);f=d.device.createBuffer({byteLength:e})}const p=e.device.createCommandEncoder();return p.copyTextureToBuffer({sourceTexture:e,width:a,height:l,origin:[r,s],destinationBuffer:f,byteOffset:o}),p.destroy(),h&&u.destroy(),f}(e,t)}setParametersWebGL(e){Mf(this.gl,e)}getParametersWebGL(e){return Nf(this.gl,e)}withParametersWebGL(e,t){return _p(this.gl,e,t)}resetWebGL(){Vr.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),Mf(this.gl,yf)}_getDeviceSpecificTextureFormatCapabilities(e){return function(e,t,n){let r=t.create;const s=Yf[t.format];return void 0===(null==s?void 0:s.gl)&&(r=!1),(null==s?void 0:s.x)&&(r=r&&Boolean(Uf(e,s.x,n))),{format:t.format,create:r&&t.create,render:r&&t.render,filter:r&&t.filter,blend:r&&t.blend,store:r&&t.store}}(this.gl,e,this._extensions)}loseDevice(){var e;let t=!1;const n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(t=!0,n.loseContext()),null==(e=this._resolveContextLost)||e.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){Ff.get(this.gl).push()}popState(){Ff.get(this.gl).pop()}getGLKey(e,t){const n=Number(e);for(const r in this.gl)if(this.gl[r]===n)return`GL.${r}`;return(null==t?void 0:t.emptyIfUnknown)?"":String(e)}getGLKeys(e){const t={emptyIfUnknown:!0};return Object.entries(e).reduce((e,[n,r])=>(e[`${n}:${this.getGLKey(n,t)}`]=`${r}:${this.getGLKey(r,t)}`,e),{})}setConstantAttributeWebGL(e,t){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const r=this._constants[e];switch(r&&function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(r,t)&&Vr.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:!function(e,t,n){switch(n.length){case 1:e.gl.vertexAttrib1fv(t,n);break;case 2:e.gl.vertexAttrib2fv(t,n);break;case 3:e.gl.vertexAttrib3fv(t,n);break;case 4:e.gl.vertexAttrib4fv(t,n)}}(this,e,t);break;case Int32Array:!function(e,t,n){e.gl.vertexAttribI4iv(t,n)}(this,e,t);break;case Uint32Array:!function(e,t,n){e.gl.vertexAttribI4uiv(t,n)}(this,e,t);break;default:throw new Error("constant")}}getExtension(e){return Uf(this.gl,e,this._extensions),this._extensions}_setWebGLDebugMetadata(e,t,n){e.luma=t;const r={props:n.spector,id:n.spector.id};e.__SPECTOR_Metadata=r}}const qp=Object.freeze(Object.defineProperty({__proto__:null,WebGLDevice:Xp},Symbol.toStringTag,{value:"Module"}));function Yp(){}const Kp={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Yp,onWebGLInitialized:Yp,onResize:Yp,onViewStateChange:Yp,onInteractionStateChange:Yp,onBeforeRender:Yp,onAfterRender:Yp,onLoad:Yp,onError:e=>Qn.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:({isDragging:e})=>e?"grabbing":"grab",getTooltip:null,debug:!1,drawPickingColors:!1};class Zp{constructor(e){var t;this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Ut({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=e=>{const{_pickRequest:t}=this;if("pointerleave"===e.type)t.x=-1,t.y=-1,t.radius=0;else{if(e.leftButton||e.rightButton)return;{const n=e.offsetCenter;if(!n)return;t.x=n.x,t.y=n.y,t.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:t.x,y:t.y}),t.event=e},this._onEvent=e=>{const t=Dc[e.type],n=e.offsetCenter;if(!t||!n||!this.layerManager)return;const r=this.layerManager.getLayers(),s=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:r,viewports:this.getViewports(n)},this._lastPointerDownInfo),{layer:i}=s,o=i&&(i[t]||i.props[t]),a=this.props[t];let l=!1;o&&(l=o.call(i,s,e)),l||(null==a||a(s,e),this.widgetManager.onEvent(s,e))},this._onPointerDown=e=>{var t;if("webgpu"===(null==(t=this.device)?void 0:t.type))return;const n=e.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:n.x,y:n.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo},this.props={...Kp,...e},(e=this.props).viewState&&e.initialViewState&&Qn.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let n=this.device;if(!n&&e.gl){e.gl instanceof WebGLRenderingContext&&Qn.error("WebGL1 context not supported.")();const r=null==(t=this.props.deviceProps)?void 0:t.onResize;n=_f.attach(e.gl,{...this.props.deviceProps,onResize:(e,t)=>{const{width:n,height:s}=e.canvas;e.drawingBufferWidth=n,e.drawingBufferHeight=s,this._needsRedraw="Canvas resized",null==r||r(e,t)}})}n||(n=this._createDevice(e)),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&th.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,n,r,s,i,o,a,l,c;null==(e=this.animationLoop)||e.stop(),null==(t=this.animationLoop)||t.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,null==(n=this.layerManager)||n.finalize(),this.layerManager=null,null==(r=this.viewManager)||r.finalize(),this.viewManager=null,null==(s=this.effectManager)||s.finalize(),this.effectManager=null,null==(i=this.deckRenderer)||i.finalize(),this.deckRenderer=null,null==(o=this.deckPicker)||o.finalize(),this.deckPicker=null,null==(a=this.eventManager)||a.destroy(),this.eventManager=null,null==(l=this.widgetManager)||l.finalize(),this.widgetManager=null,this.props.canvas||this.props.device||this.props.gl||!this.canvas||(null==(c=this.canvas.parentElement)||c.removeChild(this.canvas),this.canvas=null)}setProps(e){var t,n,r,s,i,o,a;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Qn.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Qn.removed("onLayerClick","onClick")(),e.initialViewState&&!ad(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const l=Object.create(this.props);Object.assign(l,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),e.device&&e.device.id!==(null==(t=this.device)?void 0:t.id)&&(null==(n=this.animationLoop)||n.stop(),this.canvas!==(null==(r=e.device.canvasContext)?void 0:r.canvas)&&(null==(s=this.canvas)||s.remove(),null==(i=this.eventManager)||i.destroy(),this.canvas=null),Qn.log(`recreating animation loop for new device! id=${e.device.id}`)(),this.animationLoop=this._createAnimationLoop(e.device,e),this.animationLoop.start()),null==(o=this.animationLoop)||o.setProps(l),void 0!==e.useDevicePixels&&(null==(a=this.device)?void 0:a.canvasContext)&&this.device.canvasContext.setProps({useDevicePixels:e.useDevicePixels}),this.layerManager&&(this.viewManager.setProps(l),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(l),this.effectManager.setProps(l),this.deckRenderer.setProps(l),this.deckPicker.setProps(l),this.widgetManager.setProps(l)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),r=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),i=this.deckRenderer.needsRedraw(e);return t=t||n||r||s||i,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return null!==this.viewManager}getViews(){return _d(this.viewManager),this.viewManager.views}getViewports(e){return _d(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var t;null==(t=this.layerManager)||t.removeDefaultShaderModule(e)}_pick(e,t,n){_d(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(t).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return r.get(t).timeEnd(),s}_createCanvas(e){let t=e.canvas;return"string"==typeof t&&(t=document.getElementById(t),_d(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",e.width&&"number"==typeof e.width&&(t.width=e.width),e.height&&"number"==typeof e.height&&(t.height=e.height),(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){var t;if(!this.canvas)return;const{width:n,height:r}=e;if(n||0===n){const e=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=e}if(r||0===r){const n=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=(null==(t=e.style)?void 0:t.position)||"absolute",this.canvas.style.height=n}}_updateCanvasSize(){var e,t;const{canvas:n}=this;if(!n)return;const r=n.clientWidth??n.width,s=n.clientHeight??n.height;r===this.width&&s===this.height||(this.width=r,this.height=s,null==(e=this.viewManager)||e.setProps({width:r,height:s}),null==(t=this.layerManager)||t.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:s}))}_createAnimationLoop(e,t){const{gl:n,onError:r}=t;return new wh({device:e,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:e=>this._setDevice(e.device),onRender:this._onRenderFrame.bind(this),onError:r})}_createDevice(e){var t,n,r;const s=null==(t=this.props.deviceProps)?void 0:t.createCanvasContext,i="object"==typeof s?s:void 0,o={adapters:[],_cacheShaders:!0,_cachePipelines:!0,...e.deviceProps};o.adapters.includes(_f)||o.adapters.push(_f);const a={alphaMode:"webgpu"===(null==(n=this.props.deviceProps)?void 0:n.type)?"premultiplied":void 0},l=null==(r=this.props.deviceProps)?void 0:r.onResize;return Ts.createDevice({_reuseDevices:!0,type:"webgl",...o,createCanvasContext:{...a,...i,canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!0},onResize:(e,t)=>{this._needsRedraw="Canvas resized",null==l||l(e,t)}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new Od({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var e,t,n,r;if("webgpu"===(null==(e=this.device)?void 0:e.type))return;const{_pickRequest:s}=this;if(s.event){const{result:e,emptyInfo:i}=this._pick("pickObject","pickObject Time",s);this.cursorState.isHovering=e.length>0;let o=i,a=!1;for(const n of e)o=n,a=(null==(t=n.layer)?void 0:t.onHover(n,s.event))||a;a||(null==(r=(n=this.props).onHover)||r.call(n,o,s.event),this.widgetManager.onHover(o,s.event)),s.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var t,n;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=null==(t=this.device.canvasContext)?void 0:t.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),"webgl"===this.device.type&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),"webgl"===this.device.type&&this.props.onWebGLInitialized(this.device.gl);const r=new bh;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new Nc(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(Bc).map(e=>{var t;const[n,r,s,i]=Bc[e];return{recognizer:new n({...r,...null==(t=this.props.eventRecognizerOptions)?void 0:t[e],event:e}),recognizeWith:s,requestFailure:i}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in Dc)this.eventManager.on(i,this._onEvent);this.viewManager=new ld({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const s=this.viewManager.getViewports()[0];this.layerManager=new od(this.device,{deck:this,stats:this.stats,viewport:s,timeline:r}),this.effectManager=new Dd({deck:this,device:this.device}),this.deckRenderer=new Ud(this.device),this.deckPicker=new $d(this.device),this.widgetManager=new Kd({deck:this,parentElement:null==(n=this.canvas)?void 0:n.parentElement}),this.widgetManager.addDefault(new ef),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){var n;const{device:r,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:s});const i={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};null==(n=this.deckRenderer)||n.renderLayers(i),"screen"===i.pass&&this.widgetManager.onRedraw({viewports:i.viewports,layers:i.layers}),this.props.onAfterRender({device:r,gl:s})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),Qn.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),"webgpu"!==(null==(e=this.device)?void 0:e.type)&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const n=Ts.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}Zp.defaultProps=Kp,Zp.VERSION=rr;const Qp=Yr;function Jp(e,t,n){const r="webgpu"===n&&"uint8"===t.type?"unorm8":t.type;return{attribute:e,format:t.size>1?`${r}x${t.size}`:t.type,byteOffset:t.offset||0}}function eg(e){return e.stride||e.size*e.bytesPerElement}function tg(e,t){t.offset&&Qn.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=eg(e),r=(void 0!==t.vertexOffset?t.vertexOffset:e.vertexOffset||0)*n+(t.elementOffset||0)*e.bytesPerElement+(e.offset||0);return{...t,offset:r,stride:n}}class ng{constructor(e,t,n){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const r=t.logicalType||t.type,s="float64"===r;let i,{defaultValue:o}=t;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0),i=s?"float32":!r&&t.isIndexed?"uint32":r||"float32";let a=function(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return Kr(e)}}(r||i);this.doublePrecision=s,s&&!1===t.fp64&&(a=Float32Array),this.value=null,this.settings={...t,defaultType:a,defaultValue:o,logicalType:r,type:i,normalized:i.includes("norm"),size:this.size,bytesPerElement:a.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*eg(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),th.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const n={};if(this.state.constant){const r=this.value;if(t){const s=tg(this.getAccessor(),t),i=s.offset/r.BYTES_PER_ELEMENT,o=s.size||this.size;n[e]=r.subarray(i,i+o)}else n[e]=r}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(e=this.id,t=null){const n=this.getAccessor(),r=[],s={name:this.id,byteStride:eg(n),attributes:r};if(this.doublePrecision){const s=function(e,t){const n=tg(e,t);return{high:n,low:{...n,offset:n.offset+4*e.size}}}(n,t||{});r.push(Jp(e,{...n,...s.high},this.device.type),Jp(`${e}64Low`,{...n,...s.low},this.device.type))}else if(t){const s=tg(n,t);r.push(Jp(e,{...n,...s},this.device.type))}else r.push(Jp(e,n,this.device.type));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:n,size:r}=this,s=n*r;if(t&&s&&t.length>=s){const n=new Array(r).fill(1/0),i=new Array(r).fill(-1/0);for(let e=0;e<s;)for(let s=0;s<r;s++){const r=t[e++];r<n[s]&&(n[s]=r),r>i[s]&&(i[s]=r)}e=[n,i]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let n;n=ArrayBuffer.isView(e)?{value:e}:e instanceof $r?{buffer:e}:e;const r={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)r.type="float32";else{const e=Qp(n.value);r.type=r.normalized?e.replace("int","norm"):e}r.bytesPerElement=n.value.BYTES_PER_ELEMENT,r.stride=eg(r)}if(t.bounds=null,n.constant){let e=n.value;if(e=this._normalizeValue(e,[],0),this.settings.normalized&&(e=this.normalizeConstant(e)),t.constant&&this._areValuesEqual(e,this.value))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(e)?e:new Float32Array(e)}else if(n.buffer){const e=n.buffer;t.externalBuffer=e,t.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let e=n.value;t.externalBuffer=null,t.constant=!1,this.value=e;let{buffer:s}=this;const i=eg(r),o=(r.vertexOffset||0)*i;if(this.doublePrecision&&e instanceof Float64Array&&(e=oh(e,r)),this.settings.isIndexed){const t=this.settings.defaultType;e.constructor!==t&&(e=new t(e))}const a=e.byteLength+o+2*i;(!s||s.byteLength<a)&&(s=this._createBuffer(a)),s.write(e,o)}return this.setAccessor(r),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:n=0,endOffset:r}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?oh(t,{size:this.size,startIndex:n,endIndex:r}):t.subarray(n,r),n*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:n}=this,r=n.allocatedValue,s=th.allocate(r,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=s;const{byteOffset:i}=this;let{buffer:o}=this;return(!o||o.byteLength<s.byteLength+i)&&(o=this._createBuffer(s.byteLength+i),t&&r&&o.write(r instanceof Float64Array?oh(r,this):r,i)),n.allocatedValue=s,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=t.BYTES_PER_ELEMENT<4),r)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);t instanceof n||!this.settings.normalized||"normalized"in e||Qn.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(e=>(e+128)/255*2-1);case"snorm16":return new Float32Array(e).map(e=>(e+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(e=>e/255);case"unorm16":return new Float32Array(e).map(e=>e/65535);default:return e}}_normalizeValue(e,t,n){const{defaultValue:r,size:s}=this.settings;if(Number.isFinite(e))return t[n]=e,t;if(!e){let e=s;for(;--e>=0;)t[n+e]=r[e];return t}switch(s){case 4:t[n+3]=Number.isFinite(e[3])?e[3]:r[3];case 3:t[n+2]=Number.isFinite(e[2])?e[2]:r[2];case 2:t[n+1]=Number.isFinite(e[1])?e[1]:r[1];case 1:t[n+0]=Number.isFinite(e[0])?e[0]:r[0];break;default:let i=s;for(;--i>=0;)t[n+i]=Number.isFinite(e[i])?e[i]:r[i]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:n}=this;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}_createBuffer(e){var t;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:r}=this.settings;return this._buffer=this.device.createBuffer({...null==(t=this._buffer)?void 0:t.props,id:this.id,usage:(n?$r.INDEX:$r.VERTEX)|$r.COPY_DST,indexType:n?r:void 0,byteLength:e}),this._buffer}}const rg=[],sg=[];function ig(e){return e&&e[Symbol.asyncIterator]}const og=[],ag=[[0,1/0]],lg={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function cg(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});const n=e.type||"interpolation";return{...lg[n],...t,...e,type:n}}class ug extends ng{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:ag}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t,n,r;(t=this.state).layoutChanged||(t.layoutChanged=(n=e,r=this.getAccessor(),!(n.type===r.type&&n.size===r.size&&eg(n)===eg(r)&&(n.offset||0)===(r.offset||0)))),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat("function"!=typeof e&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,n=this.settings.transition;return cg(Array.isArray(t)?e[t.find(t=>e[t])]:e[t],n)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:e=0,endRow:n=1/0}=t;this.state.updateRanges=function(e,t){if(e===ag)return e;if(t[0]<0&&(t[0]=0),t[0]>=t[1])return e;const n=[],r=e.length;let s=0;for(let i=0;i<r;i++){const r=e[i];r[1]<t[0]?(n.push(r),s=i+1):r[0]>t[1]?n.push(r):t=[Math.min(r[0],t[0]),Math.max(r[1],t[1])]}return n.splice(s,0,t),n}(this.state.updateRanges,[e,n])}else this.state.updateRanges=ag}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=og}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:n}=this;return!n.noAlloc&&!!n.update&&(super.allocate(e,t.updateRanges!==ag),!0)}updateBuffer({numInstances:e,data:t,props:n,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:i,noAlloc:o}}=this;let a=!0;if(i){for(const[o,a]of s)i.call(r,this,{data:t,startRow:o,endRow:a,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[t,n]of s){const r=Number.isFinite(t)?this.getVertexOffset(t):0,s=Number.isFinite(n)?this.getVertexOffset(n):o||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:r,endOffset:s})}this._checkAttributeArray()}else a=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),a}setConstantValue(e,t){const n="webgpu"===this.device.type;if(n||void 0===t||"function"==typeof t){if(n&&"function"!=typeof t){const e=this._normalizeValue(t,[],0);this._areValuesEqual(e,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}const r=this.settings.transform&&e?this.settings.transform.call(e,t):t;return this.setData({constant:!0,value:r})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:n,settings:r}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),r.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const s=e;_d(ArrayBuffer.isView(s.value),`invalid ${r.accessor}`);const i=Boolean(s.size)&&s.size!==this.size;return n.binaryAccessor=function(e,t){const{size:n,stride:r,offset:s,startIndices:i,nested:o}=t,a=e.BYTES_PER_ELEMENT,l=r?r/a:n,c=s?s/a:0,u=Math.floor((e.length-c)/l);return(t,{index:r,target:s})=>{if(!i){const t=r*l+c;for(let r=0;r<n;r++)s[r]=e[t+r];return s}const a=i[r],h=i[r+1]||u;let d;if(o){d=new Array(h-a);for(let t=a;t<h;t++){const r=t*l+c;s=new Array(n);for(let t=0;t<n;t++)s[t]=e[r+t];d[t-a]=s}}else if(l===n)d=e.subarray(a*n+c,h*n+c);else{d=new e.constructor((h-a)*n);let t=0;for(let r=a;r<h;r++){const s=r*l+c;for(let r=0;r<n;r++)d[t++]=e[s+r]}}return d}}(s.value,{size:s.size||this.size,stride:s.stride,offset:s.offset,startIndices:t,nested:i}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const n in e)Object.assign(t,super.getValue(n,e[n]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:r}=this.settings;if(n.stepMode="dynamic"===r?e?e.isInstanced?"instance":"vertex":"instance":r??"vertex",!t)return n;for(const s in t){const e=super._getBufferLayout(s,t[s]);n.attributes.push(...e.attributes)}return n}_autoUpdater(e,{data:t,startRow:n,endRow:r,props:s,numInstances:i}){if(e.constant&&"webgpu"!==this.context.device.type)return;const{settings:o,state:a,value:l,size:c,startIndices:u}=e,{accessor:h,transform:d}=o;let f=a.binaryAccessor||("function"==typeof h?h:s[h]);"function"!=typeof f&&"string"==typeof h&&(f=()=>s[h]),_d("function"==typeof f,`accessor "${h}" is not a function`);let p=e.getVertexOffset(n);const{iterable:g,objectInfo:m}=function(e,t=0,n=1/0){let r=rg;const s={index:-1,data:e,target:[]};return e?"function"==typeof e[Symbol.iterator]?r=e:e.length>0&&(sg.length=e.length,r=sg):r=rg,(t>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(t,n),s.index=t-1),{iterable:r,objectInfo:s}}(t,n,r);for(const _ of g){m.index++;let t=f(_,m);if(d&&(t=d.call(this,t)),u){const n=(m.index<u.length-1?u[m.index+1]:i)-u[m.index];if(t&&Array.isArray(t[0])){let n=p;for(const r of t)e._normalizeValue(r,l,n),n+=c}else t&&t.length>c?l.set(t,p):(e._normalizeValue(t,m.target,0),rd({target:l,source:m.target,start:p,count:n}));p+=n*c}else e._normalizeValue(t,l,p),p+=c}}_validateAttributeUpdaters(){const{settings:e}=this;if(!e.noAlloc&&"function"!=typeof e.update)throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let n=!0;switch(t){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function hg(e){const{source:t,target:n,start:r=0,size:s,getData:i}=e,o=e.end||n.length,a=t.length,l=o-r;if(a>l)return void n.set(t.subarray(0,l),r);if(n.set(t,r),!i)return;let c=a;for(;c<l;){const e=i(c,t);for(let t=0;t<s;t++)n[r+c]=e[t]||0,c++}}function dg(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${e}"`)}}function fg(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function pg(e){e.push(e.shift())}function gg({device:e,source:t,target:n}){return(!n||n.byteLength<t.byteLength)&&(null==n||n.destroy(),n=e.createBuffer({byteLength:t.byteLength,usage:t.usage})),n}function mg({device:e,buffer:t,attribute:n,fromLength:r,toLength:s,fromStartIndices:i,getData:o=e=>e}){const a=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*a,c=n.byteOffset,u=n.settings.bytesPerElement<4?c/n.settings.bytesPerElement*4:c,h=n.startIndices,d=i&&h,f=n.isConstant;if(!d&&t&&r>=s)return t;const p=n.value instanceof Float64Array?Float32Array:n.value.constructor,g=f?n.value:new p(n.getBuffer().readSyncWebGL(c,s*p.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!f){const e=o;o=(t,r)=>n.normalizeConstant(e(t,r))}const m=f?(e,t)=>o(g,t):(e,t)=>o(g.subarray(e+c,e+c+l),t),_=t?new Float32Array(t.readSyncWebGL(u,4*r).buffer):new Float32Array(0),y=new Float32Array(s);return function({source:e,target:t,size:n,getData:r,sourceStartIndices:s,targetStartIndices:i}){if(!s||!i)return hg({source:e,target:t,size:n,getData:r}),t;let o=0,a=0;const l=r&&((e,t)=>r(e+a,t)),c=Math.min(s.length,i.length);for(let u=1;u<c;u++){const r=s[u]*n,c=i[u]*n;hg({source:e.subarray(o,r),target:t,start:a,end:c,size:n,getData:l}),o=r,a=c}a<t.length&&hg({source:[],target:t,start:a,size:n,getData:l})}({source:_,target:y,sourceStartIndices:i,targetStartIndices:h,size:l,getData:m}),(!t||t.byteLength<y.byteLength+u)&&(null==t||t.destroy(),t=e.createBuffer({byteLength:y.byteLength+u,usage:35050})),t.write(y,u),t}class _g{constructor({device:e,attribute:t,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new fd(n),this.attribute=t,this.attributeInTransition=function(e){const{device:t,settings:n,value:r}=e,s=new ug(t,n);return s.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),s}(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=function(e,t){const{doublePrecision:n,settings:r,value:s,size:i}=e,o=n&&s instanceof Float64Array?2:1;let a=0;const{shaderAttributes:l}=e.settings;if(l)for(const c of Object.values(l))a=Math.max(a,c.vertexOffset??0);return(r.noAlloc?s.length:(t+a)*i)*o}(this.attribute,t),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}const yg={name:"interpolation",vs:"uniform interpolationUniforms {\n  float time;\n} interpolation;\n",uniformTypes:{time:"f32"}};function bg(e){return e.doublePrecision&&e.value instanceof Float64Array}const vg={name:"spring",vs:"uniform springUniforms {\n  float damping;\n  float stiffness;\n} spring;\n",uniformTypes:{damping:"f32",stiffness:"f32"}},xg={interpolation:class extends _g{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="interpolation",this.transform=function(e,t){const n=t.size,r=dg(n),s=fg(n),i=t.getBufferLayout();return bg(t)?new Hh(e,{vs:"#version 300 es\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nin ATTRIBUTE_TYPE aFrom;\nin ATTRIBUTE_TYPE aFrom64Low;\nin ATTRIBUTE_TYPE aTo;\nin ATTRIBUTE_TYPE aTo64Low;\nout ATTRIBUTE_TYPE vCurrent;\nout ATTRIBUTE_TYPE vCurrent64Low;\n\nvec2 mix_fp64(vec2 a, vec2 b, float x) {\n  vec2 range = sub_fp64(b, a);\n  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));\n}\n\nvoid main(void) {\n  for (int i=0; i<ATTRIBUTE_SIZE; i++) {\n    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);\n    vCurrent[i] = value.x;\n    vCurrent64Low[i] = value.y;\n  }\n  gl_Position = vec4(0.0);\n}\n",bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*n}]}],modules:[kl,yg],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Hh(e,{vs:"#version 300 es\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nin ATTRIBUTE_TYPE aFrom;\nin ATTRIBUTE_TYPE aTo;\nout ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, interpolation.time);\n  gl_Position = vec4(0.0);\n}\n",bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:i.attributes[0].format}],modules:[yg],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}(e,t)}start(e,t){const n=this.currentLength,r=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0)return void this.transition.cancel();const{buffers:s,attribute:i}=this;pg(s),s[0]=mg({device:this.device,buffer:s[0],attribute:i,fromLength:n,toLength:this.currentLength,fromStartIndices:r,getData:e.enter}),s[1]=gg({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:o}=this,a=o.model;let l=Math.floor(this.currentLength/i.size);bg(i)&&(l/=2),a.setVertexCount(l),i.isConstant?(a.setAttributes({aFrom:s[0]}),a.setConstantAttributes({aTo:i.value})):a.setAttributes({aFrom:s[0],aTo:i.getBuffer()}),o.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:n}=this.transition;let r=n/e;t&&(r=t(r));const{model:s}=this.transform,i={time:r};s.shaderInputs.setProps({interpolation:i}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},spring:class extends _g{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="spring",this.texture=function(e){return e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1})}(e),this.framebuffer=function(e,t){return e.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}(e,this.texture),this.transform=function(e,t){const n=dg(t.size),r=fg(t.size);return new Hh(e,{vs:"#version 300 es\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nin ATTRIBUTE_TYPE aPrev;\nin ATTRIBUTE_TYPE aCur;\nin ATTRIBUTE_TYPE aTo;\nout ATTRIBUTE_TYPE vNext;\nout float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE force = delta * spring.stiffness;\n  ATTRIBUTE_TYPE resistance = velocity * spring.damping;\n  return force - resistance + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",fs:"#version 300 es\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nin float vIsTransitioningFlag;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  fragColor = vec4(1.0);\n}",bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[vg],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}(e,t)}start(e,t){const n=this.currentLength,r=this.currentStartIndices;super.start(e,t);const{buffers:s,attribute:i}=this;for(let a=0;a<2;a++)s[a]=mg({device:this.device,buffer:s[a],attribute:i,fromLength:n,toLength:this.currentLength,fromStartIndices:r,getData:e.enter});s[2]=gg({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:o}=this.transform;o.setVertexCount(Math.floor(this.currentLength/i.size)),i.isConstant?o.setConstantAttributes({aTo:i.value}):o.setAttributes({aTo:i.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:n,transition:r}=this,s=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const i={stiffness:s.stiffness,damping:s.damping};t.model.shaderInputs.setProps({spring:i}),t.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),pg(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||r.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}};class wg{constructor(e,{id:t,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:n}){this.numInstances=n||1;for(const r in e){const n=e[r],s=n.getTransitionSetting(t);s&&this._updateAttribute(r,n,s)}for(const r in this.transitions){const n=e[r];n&&n.getTransitionSetting(t)||this._removeTransition(r)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const n=this.transitions[t];n.inProgress&&(e[t]=n.attributeInTransition)}return e}run(){if(0===this.numInstances)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,n){const r=this.transitions[e];let s=!r||r.type!==n.type;if(s){r&&this._removeTransition(e);const i=xg[n.type];i?this.transitions[e]=new i({attribute:t,timeline:this.timeline,device:this.device}):(Qn.error(`unsupported transition type '${n.type}'`)(),s=!1)}(s||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const Eg="attributeManager.invalidate";class Tg{constructor(e,{id:t="attribute-manager",stats:n,timeline:r}={}){this.mergeBoundsMemoized=jc(ah),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new wg(e,{id:`${t}-transitions`,timeline:r}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)void 0!==this.attributes[t]&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const n=this._invalidateTrigger(e,t);tr(Eg,this,e,n)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);tr(Eg,this,"all")}update({data:e,numInstances:t,startIndices:n=null,transitions:r,props:s={},buffers:i={},context:o={}}){let a=!1;tr("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const l in this.attributes){const r=this.attributes[l],c=r.settings.accessor;r.startIndices=n,r.numInstances=t,s[l]&&Qn.removed(`props.${l}`,`data.attributes.${l}`)(),r.setExternalBuffer(i[l])||r.setBinaryValue("string"==typeof c?i[c]:void 0,e.startIndices)||"string"==typeof c&&!i[c]&&r.setConstantValue(o,s[c])||r.needsUpdate()&&(a=!0,this._updateAttribute({attribute:r,numInstances:t,data:e,props:s,context:o})),this.needsRedraw=this.needsRedraw||r.needsRedraw()}a&&tr("attributeManager.updateEnd",this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:r})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(e=>{var t;return null==(t=this.attributes[e])?void 0:t.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:n}=this,r={...n.getAttributes()};for(const s in t){const i=t[s];i.needsRedraw(e)&&!n.hasAttribute(s)&&(r[s]=i)}return r}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const n in e){const r=e[n],s={...r,id:n,size:(r.isIndexed?1:r.size)||1,...t};this.attributes[n]=new ug(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(n=>{e[n]||(e[n]=[]),e[n].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:n,updateTriggers:r}=this,s=r[e];return s&&s.forEach(e=>{const r=n[e];r&&r.setNeedsUpdate(r.id,t)}),s}_updateAttribute(e){const{attribute:t,numInstances:n}=e;tr("attribute.updateStart",t),t.constant?t.setConstantValue(e.context,t.value):(t.allocate(n)&&tr("attribute.allocate",t,n),t.updateBuffer(e)&&(this.needsRedraw=!0,tr("attribute.updateEnd",t,n)))}}const Sg=1e-5;function Ag(e,t,n,r,s){const i=t-e;return(n-t)*s+-i*r+i+t}function Rg(e,t){if(Array.isArray(e)){let n=0;for(let r=0;r<e.length;r++){const s=e[r]-t[r];n+=s*s}return Math.sqrt(n)}return Math.abs(e-t)}const Cg={interpolation:class extends fd{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:n,duration:r,easing:s}}=this,i=s(e/r);this._value=Wa(t,n,i)}},spring:class extends fd{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:n,stiffness:r}=this.settings,{_prevValue:s=e,_currValue:i=e}=this;let o=function(e,t,n,r,s){if(Array.isArray(n)){const i=[];for(let o=0;o<n.length;o++)i[o]=Ag(e[o],t[o],n[o],r,s);return i}return Ag(e,t,n,r,s)}(s,i,t,n,r);const a=Rg(o,t),l=Rg(o,i);a<Sg&&l<Sg&&(o=t,this.end()),this._prevValue=i,this._currValue=o}}};class kg{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,n,r){const{transitions:s}=this;if(s.has(e)){const n=s.get(e),{value:r=n.settings.fromValue}=n;t=r,this.remove(e)}if(!(r=cg(r)))return;const i=Cg[r.type];if(!i)return void Qn.error(`unsupported transition type '${r.type}'`)();const o=new i(this.timeline);o.start({...r,fromValue:t,toValue:n}),s.set(e,o)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,n]of this.transitions)n.update(),e[t]=n.value,n.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function Ig(e,t){if(!e.transitions)return!1;const n={},r=e[Kh];let s=!1;for(const i in e.transitions){const o=r[i],a=o&&o.type;("number"===a||"color"===a||"array"===a)&&Mg(e[i],t[i],o)&&(n[i]=!0,s=!0)}return!!s&&n}function Pg({newProps:e,oldProps:t,ignoreProps:n={},propTypes:r={},triggerName:s="props"}){if(t===e)return!1;if("object"!=typeof e||null===e)return`${s} changed shallowly`;if("object"!=typeof t||null===t)return`${s} changed shallowly`;for(const i of Object.keys(e))if(!(i in n)){if(!(i in t))return`${s}.${i} added`;const n=Mg(e[i],t[i],r[i]);if(n)return`${s}.${i} ${n}`}for(const i of Object.keys(t))if(!(i in n)){if(!(i in e))return`${s}.${i} dropped`;if(!Object.hasOwnProperty.call(e,i)){const n=Mg(e[i],t[i],r[i]);if(n)return`${s}.${i} ${n}`}}return!1}function Mg(e,t,n){let r=n&&n.equal;return r&&!r(e,t,n)?"changed deeply":r||(r=e&&t&&e.equals,!r||r.call(e,t))?r||t===e?null:"changed shallowly":"changed deeply"}function Ng(e,t){if(null===t)return!0;const n=t.extensions,{extensions:r}=e;if(r===n)return!1;if(!n||!r)return!0;if(r.length!==n.length)return!0;for(let s=0;s<r.length;s++)if(!r[s].equals(n[s]))return!0;return!1}function Lg(e,t,n){let r=e.updateTriggers[n];r=null==r?{}:r;let s=t.updateTriggers[n];return s=null==s?{}:s,Pg({oldProps:s,newProps:r,triggerName:n})}function Og(e,t){if(!t)return e;const n={...e,...t};if("defines"in t&&(n.defines={...e.defines,...t.defines}),"modules"in t&&(n.modules=(e.modules||[]).concat(t.modules),t.modules.some(e=>"project64"===e.name))){const e=n.modules.findIndex(e=>"project32"===e.name);e>=0&&n.modules.splice(e,1)}if("inject"in t)if(e.inject){const r={...e.inject};for(const e in t.inject)r[e]=(r[e]||"")+t.inject[e];n.inject=r}else n.inject=t.inject;return n}const Fg={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Dg={},Bg={boolean:{validate:(e,t)=>!0,equal:(e,t,n)=>Boolean(e)===Boolean(t)},number:{validate:(e,t)=>Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)},color:{validate:(e,t)=>t.optional&&!e||Vg(e)&&(3===e.length||4===e.length),equal:(e,t,n)=>ad(e,t,1)},accessor:{validate(e,t){const n=Gg(e);return"function"===n||n===Gg(t.value)},equal:(e,t,n)=>"function"==typeof t||ad(e,t,1)},array:{validate:(e,t)=>t.optional&&!e||Vg(e),equal(e,t,n){const{compare:r}=n,s=Number.isInteger(r)?r:r?1:0;return r?ad(e,t,s):e===t}},object:{equal(e,t,n){if(n.ignore)return!0;const{compare:r}=n,s=Number.isInteger(r)?r:r?1:0;return r?ad(e,t,s):e===t}},function:{validate:(e,t)=>t.optional&&!e||"function"==typeof e,equal:(e,t,n)=>!n.compare&&!1!==n.ignore||e===t},data:{transform:(e,t,n)=>{if(!e)return e;const{dataTransform:r}=n.props;return r?r(e):"string"==typeof e.shape&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,n)=>{const r=n.context;return r&&r.device?function(e,t,n,r){if(n instanceof Ds)return n;n.constructor&&"Object"!==n.constructor.name&&(n={data:n});let s=null;n.compressed&&(s={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const{width:i,height:o}=n.data,a=t.createTexture({...n,sampler:{...Fg,...s,...r},mipLevels:t.getMipLevelCount(i,o)});return a.generateMipmapsWebGL(),Dg[a.id]=e,a}(n.id,r.device,e,{...t.parameters,...n.props.textureParameters}):null},release:(e,t,n)=>{var r,s;r=n.id,(s=e)&&s instanceof Ds&&Dg[s.id]===r&&(s.delete(),delete Dg[s.id])}}};function Ug(e,t){switch(Gg(t)){case"object":return jg(e,t);case"array":return jg(e,{type:"array",value:t,compare:!1});case"boolean":return jg(e,{type:"boolean",value:t});case"number":return jg(e,{type:"number",value:t});case"function":return jg(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function jg(e,t){return"type"in t?{name:e,...Bg[t.type],...t}:"value"in t?{name:e,type:Gg(t.value),...t}:{name:e,type:"object",value:t}}function Vg(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function Gg(e){return Vg(e)?"array":null===e?"null":typeof e}function zg(e,t){if(!(e instanceof qg.constructor))return{};let n="_mergedDefaultProps";if(t)for(const r of t){const e=r.constructor;e&&(n+=`:${e.extensionName||e.name}`)}return $g(e,n)||(e[n]=function(e,t){if(!e.prototype)return null;const n=zg(Object.getPrototypeOf(e)),r=function(e){const t={},n={},r={};for(const[s,i]of Object.entries(e)){const e=null==i?void 0:i.deprecatedFor;if(e)r[s]=Array.isArray(e)?e:[e];else{const e=Ug(s,i);t[s]=e,n[s]=e.value}}return{propTypes:t,defaultProps:n,deprecatedProps:r}}($g(e,"defaultProps")||{}),s=Object.assign(Object.create(null),n,r.defaultProps),i=Object.assign(Object.create(null),null==n?void 0:n[Kh],r.propTypes),o=Object.assign(Object.create(null),null==n?void 0:n[Zh],r.deprecatedProps);for(const a of t){const e=zg(a.constructor);e&&(Object.assign(s,e),Object.assign(i,e[Kh]),Object.assign(o,e[Zh]))}return function(e,t){const n=function(e){const t=e.componentName;return t||Qn.warn(`${e.name}.componentName not specified`)(),t||e.name}(t);Object.defineProperties(e,{id:{writable:!0,value:n}})}(s,e),function(e,t){const n={},r={};for(const s in t){const e=t[s],{name:i,value:o}=e;e.async&&(n[i]=o,r[i]=Wg(i))}e[Qh]=n,e[Jh]={},Object.defineProperties(e,r)}(s,i),function(e,t){for(const n in t)Object.defineProperty(e,n,{enumerable:!1,set(e){const r=`${this.id}: ${n}`;for(const s of t[n])Hg(this,s)||(this[s]=e);Qn.deprecated(r,t[n].join("/"))()}})}(s,o),s[Kh]=i,s[Zh]=o,0!==t.length||Hg(e,"_propTypes")||(e._propTypes=i),s}(e,t||[]))}function Wg(e){return{enumerable:!0,set(t){"string"==typeof t||t instanceof Promise||ig(t)?this[Jh][e]=t:this[ed][e]=t},get(){if(this[ed]){if(e in this[ed])return this[ed][e]||this[Qh][e];if(e in this[Jh]){const t=this[Yh]&&this[Yh].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[Qh][e]}}return this[Qh][e]}}}function Hg(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function $g(e,t){return Hg(e,t)&&e[t]}let Xg=0;class qg{constructor(...e){this.props=function(e,t){let n;for(let i=t.length-1;i>=0;i--){const e=t[i];"extensions"in e&&(n=e.extensions)}const r=zg(e.constructor,n),s=Object.create(r);s[Yh]=e,s[Jh]={},s[ed]={};for(let i=0;i<t.length;++i){const e=t[i];for(const t in e)s[t]=e[t]}return Object.freeze(s),s}(this,e),this.id=this.props.id,this.count=Xg++}clone(e){const{props:t}=this,n={};for(const r in t[Qh])r in t[ed]?n[r]=t[ed][r]:r in t[Jh]&&(n[r]=t[Jh][r]);return new this.constructor({...t,...n,...e})}}qg.componentName="Component",qg.defaultProps={};const Yg=Object.freeze({});class Kg{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||Yg}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return Boolean(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[Yh]||this.component;const t=e[ed]||{},n=e[Jh]||e,r=e[Qh]||{};for(const s in t){const e=t[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,e),t[s]=this.getAsyncProp(s)}for(const s in n){const e=n[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,e)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){this._didAsyncInputValueChange(e,t)&&("string"==typeof t&&(t=this._fetch(e,t)),t instanceof Promise?this._watchPromise(e,t):ig(t)?this._resolveAsyncIterable(e,t):this._setPropValue(e,t))}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const n=this.asyncProps[e];return t!==n.resolvedValue&&t!==n.lastValue&&(n.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(t=this._postProcessValue(n,t),n.resolvedValue=t,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,t,n){const r=this.asyncProps[e];r&&n>=r.resolvedLoadCount&&void 0!==t&&(this._freezeAsyncOldProps(),r.resolvedValue=t,r.resolvedLoadCount=n,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const r=n.pendingLoadCount;t.then(t=>{this.component&&(t=this._postProcessValue(n,t),this._setAsyncPropValue(e,t,r),this._onResolve(e,t))}).catch(t=>{this._onError(e,t)})}}async _resolveAsyncIterable(e,t){if("data"!==e)return void this._setPropValue(e,t);const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const r=n.pendingLoadCount;let s=[],i=0;for await(const o of t){if(!this.component)return;const{dataTransform:t}=this.component.props;s=t?t(o,s):s.concat(o),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:i,endRow:s.length}]}),i=s.length,this._setAsyncPropValue(e,s,r)}this._onResolve(e,s)}_postProcessValue(e,t){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(t,n,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const n=this.component&&this.component.props[Kh];this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class Zg extends Kg{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const n=this.layer,r=null==n?void 0:n.props.fetch;return r?r(t,{propName:e,layer:n}):super._fetch(e,t)}_onResolve(e,t){const n=this.layer;if(n){const r=n.props.onDataLoad;"data"===e&&r&&r(t,{propName:e,layer:n})}}_onError(e,t){const n=this.layer;n&&n.raiseError(t,`loading ${e} of ${this.layer}`)}}const Qg=2**24-1,Jg=Object.freeze([]),em=jc(({oldViewport:e,viewport:t})=>e.equals(t));let tm=new Uint8ClampedArray(0);const nm={data:{type:"data",value:Jg,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:n,loaders:r,loadOptions:s,signal:i})=>{const{resourceManager:o}=n.context;s=s||n.getLoadOptions(),r=r||n.props.loaders,i&&(s={...s,fetch:{...null==s?void 0:s.fetch,signal:i}});let a=o.contains(e);return a||s||(o.add({resourceId:e,data:Ln(e,r),persistent:!1}),a=!0),a?o.subscribe({resourceId:e,onChange:e=>{var r;return null==(r=n.internalState)?void 0:r.reloadAsyncProp(t,e)},consumerId:n.id,requestId:t}):Ln(e,r,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Lc.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,100*-e]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class rm extends qg{constructor(){super(...arguments),this.internalState=null,this.lifecycle="Awaiting state",this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){_d(this.internalState);const t=this.internalState.viewport||this.context.viewport,n=mh(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,s,i]=vu(n,t.pixelProjectionMatrix);return 2===e.length?[r,s]:[r,s,i]}unproject(e){return _d(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){return _d(this.internalState),function(e,t){const{viewport:n,coordinateSystem:r,coordinateOrigin:s,modelMatrix:i,fromCoordinateSystem:o,fromCoordinateOrigin:a}=function(e){const{viewport:t,modelMatrix:n,coordinateOrigin:r}=e;let{coordinateSystem:s,fromCoordinateSystem:i,fromCoordinateOrigin:o}=e;return s===Lc.DEFAULT&&(s=t.isGeospatial?Lc.LNGLAT:Lc.CARTESIAN),void 0===i&&(i=s),void 0===o&&(o=r),{viewport:t,coordinateSystem:s,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:i,fromCoordinateOrigin:o}}(t),{autoOffset:l=!0}=t,{geospatialOrigin:c=ph,shaderCoordinateOrigin:u=ph,offsetMode:h=!1}=l?Xc(n,r,s):{},d=mh(e,{viewport:n,modelMatrix:i,coordinateSystem:o,coordinateOrigin:a,offsetMode:h});if(h){const e=n.projectPosition(c||u);rl(d,d,e)}return d}(e,{viewport:this.internalState.viewport||this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return!!this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Lc.DEFAULT||e===Lc.LNGLAT||e===Lc.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){_d(e instanceof Uint8Array);const[t,n,r]=e;return t+256*n+65536*r-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:function(e){if(null===(t=e)||"object"!=typeof t)throw new Error("count(): argument not an object");var t;if("function"==typeof e.count)return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(function(e){return null!==e&&"object"==typeof e&&e.constructor===Object}(e))return Object.keys(e).length;throw new Error("count(): argument not a container")}(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return null==(e=this.getAttributeManager())?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=Og(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=Og(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&t)if(Array.isArray(n))for(const r of n)t.invalidateAll(r);else t.invalidateAll();if(t){const{props:n}=e,r=this.internalState.hasPickingBuffer,s=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(e=>e.getNeedsPickingBuffer.call(this,e));if(r!==s){this.internalState.hasPickingBuffer=s;const{pickingColors:e,instancePickingColors:n}=t.attributes,r=e||n;r&&(s&&r.constant&&(r.constant=!1,t.invalidate(r.id)),r.value||s||(r.constant=!0,r.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:n}){const{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(e,t){var n,r,s,i;t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),(null==(r=(n=this.props).onError)?void 0:r.call(n,e))||null==(i=null==(s=this.context)?void 0:s.onError)||i.call(s,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return!!this.internalState&&(this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()))}hasUniformTransition(){var e;return(null==(e=this.internalState)?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,t&&em({oldViewport:t,viewport:e})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&("all"===e?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const n in e)e[n].layoutChanged()&&(t=!0);for(const n of this.getModels())this._setModelAttributes(n,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,n=this.getNumInstances(),r=this.getStartIndices();e.update({data:t.data,numInstances:n,startIndices:r,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),n=Object.create(this.props);for(const e in t)Object.defineProperty(n,e,{value:t[e]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const n=Math.floor(tm.length/4);if(this.internalState.usesPickingColorCache=!0,n<t){t>Qg&&Qn.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),tm=th.allocate(tm,t,{size:4,copy:!0,maxCount:Math.max(t,Qg)});const e=Math.floor(tm.length/4),r=[0,0,0];for(let t=n;t<e;t++)this.encodePickingColor(t,r),tm[4*t+0]=r[0],tm[4*t+1]=r[1],tm[4*t+2]=r[2],tm[4*t+3]=0}e.value=tm.subarray(0,4*t)}_setModelAttributes(e,t,n=!1){var r;if(!Object.keys(t).length)return;if(n){const n=this.getAttributeManager();e.setBufferLayout(n.getBufferLayouts(e)),t=n.getAttributes()}const s=(null==(r=e.userData)?void 0:r.excludeAttributes)||{},i={},o={};for(const a in t){if(s[a])continue;const n=t[a].getValue();for(const r in n){const s=n[r];s instanceof $r?t[a].settings.isIndexed?e.setIndexBuffer(s):i[r]=s:s&&(o[r]=s)}}e.setAttributes(i),e.setConstantAttributes(o)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t))return void this._disablePickingIndex(e);const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,s=n||r,i=s&&t.attributes&&t.attributes[s.id];if(i&&i.value){const n=i.value,r=this.encodePickingColor(e);for(let e=0;e<t.length;e++){const t=s.getVertexOffset(e);n[t]===r[0]&&n[t+1]===r[1]&&n[t+2]===r[2]&&this._disablePickingIndex(e)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:n}=this.getAttributeManager().attributes,r=t||n;if(!r)return;const s=r.getVertexOffset(e),i=r.getVertexOffset(e+1);r.buffer.write(new Uint8Array(i-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,n=e||t;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==tm.buffer&&(n.value=tm.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){_d(!this.internalState),_d(Number.isFinite(this.props.coordinateSystem)),tr("layer.initialize",this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Zg({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Qn.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new kg(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){tr("layer.matched",this,this===e);const{state:t,internalState:n}=e;this!==e&&(this.internalState=n,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(tr("layer.update",this,e),!e)return;const t=this.props,n=this.context,r=this.internalState,s=n.viewport,i=this._updateUniformTransition();r.propsInTransition=i,n.viewport=r.viewport||s,this.props=i;try{const e=this._getUpdateParams(),t=this.getModels();if(n.device)this.updateState(e);else try{this.updateState(e)}catch(o){}for(const n of this.props.extensions)n.updateState.call(this,e,n);this.setNeedsRedraw(),this._updateAttributes();const r=this.getModels()[0]!==t[0];this._postUpdate(e,r)}finally{n.viewport=s,this.props=t,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){tr("layer.finalize",this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:n={},parameters:r={}}){this._updateAttributeTransition();const s=this.props,i=this.context;this.props=this.internalState.propsInTransition||s;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:s}=this.props,o=s&&s(n)||[0,0];i.device instanceof Xp&&i.device.setParametersWebGL({polygonOffset:o});for(const e of this.getModels())"webgpu"===e.device.type?e.setParameters({...e.parameters,...r}):e.setParameters(r);if(i.device instanceof Xp)i.device.withParametersWebGL(r,()=>{const s={renderPass:e,shaderModuleProps:t,uniforms:n,parameters:r,context:i};for(const e of this.props.extensions)e.draw.call(this,s,e);this.draw(s)});else{const s={renderPass:e,shaderModuleProps:t,uniforms:n,parameters:r,context:i};for(const e of this.props.extensions)e.draw.call(this,s,e);this.draw(s)}}finally{this.props=s}}getChangeFlags(){var e;return null==(e=this.internalState)?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const r in e)if(e[r]){let n=!1;if("dataChanged"===r){const s=e[r],i=t[r];s&&Array.isArray(i)&&(t.dataChanged=Array.isArray(s)?i.concat(s):s,n=!0)}t[r]||(t[r]=e[r],n=!0),n&&tr("layer.changeFlag",this,r,e)}const n=Boolean(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=n,t.somethingChanged=n||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){var n;const r=function(e,t){const n=Pg({newProps:e,oldProps:t,propTypes:e[Kh],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=function(e,t){if(null===t)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:s}=e;return r?r(e.data,t.data)||(n="Data comparator detected a change"):e.data!==t.data&&(n="A new data container was supplied"),n&&s&&(n=s(e.data,t.data)||n),n}(e,t);let s=!1;return r||(s=function(e,t){if(null===t)return{all:!0};if("all"in e.updateTriggers&&Lg(e,t,"all"))return{all:!0};const n={};let r=!1;for(const s in e.updateTriggers)"all"!==s&&Lg(e,t,s)&&(n[s]=!0,r=!0);return!!r&&n}(e,t)),{dataChanged:r,propsChanged:n,updateTriggersChanged:s,extensionsChanged:Ng(e,t),transitionsChanged:Ig(e,t)}}(e,t);if(r.updateTriggersChanged)for(const s in r.updateTriggersChanged)r.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(r.transitionsChanged)for(const s in r.transitionsChanged)this.internalState.uniformTransitions.add(s,t[s],e[s],null==(n=e.transitions)?void 0:n[s]);return this.setChangeFlags(r)}validateProps(){!function(e){const t=e[Kh];for(const n in t){const r=t[n],{validate:s}=r;if(s&&!s(e[n],r))throw new Error(`Invalid prop ${n}: ${e[n]}`)}}(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&"function"==typeof n&&(t.highlightColor=n(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new Tg(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:n,oldProps:r}=e,s=this.state.model;(null==s?void 0:s.isInstanced)&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:i,highlightedObjectIndex:o,highlightColor:a}=n;if(t||r.autoHighlight!==i||r.highlightedObjectIndex!==o||r.highlightColor!==a){const e={};Array.isArray(a)&&(e.highlightColor=a),(t||r.autoHighlight!==i||o!==r.highlightedObjectIndex)&&(e.highlightedObjectColor=Number.isFinite(o)&&o>=0?this.encodePickingColor(o):null),this.setShaderModuleProps({picking:e})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),r=!!n&&n.getNeedsRedraw(e);if(t=t||r,t)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}rm.defaultProps=nm,rm.layerName="Layer";const sm=Math.PI/180,im=180/Math.PI,om=6370972,am=256;function lm(){const e=4018225162502676e-20,t=Math.PI/180*am;return{unitsPerMeter:[e,e,e],unitsPerMeter2:[0,0,0],metersPerUnit:[24886.609375,24886.609375,24886.609375],unitsPerDegree:[t,t,e],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,24886.609375]}}class cm extends dh{constructor(e={}){const{longitude:t=0,zoom:n=0,nearZMultiplier:r=.5,farZMultiplier:s=1,resolution:i=10}=e;let{latitude:o=0,height:a,altitude:l=1.5,fovy:c}=e;o=Math.max(Math.min(o,hu),-85.051129),a=a||1,c?l=bu(c):c=yu(l);const u=1/Math.PI/Math.cos(o*Math.PI/180),h=Math.pow(2,n)*u,d=e.nearZ??r,f=e.farZ??(l+512*h/a)*s,p=(new Tl).lookAt({eye:[0,-l,0],up:[0,0,1]});p.rotateX(o*sm),p.rotateZ(-t*sm),p.scale(h/a),super({...e,height:a,viewMatrix:p,longitude:t,latitude:o,zoom:n,distanceScales:lm(),fovy:c,focalDistance:l,near:d,far:f}),this.scale=h,this.latitude=o,this.longitude=t,this.resolution=i}get projectionMode(){return Oc.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,this.height/2],t),r=this.unproject([this.width/2,0],t),s=this.unproject([this.width,this.height/2],t),i=this.unproject([this.width/2,this.height],t);return s[0]<this.longitude&&(s[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],s[0],r[0],i[0]),Math.min(n[1],s[1],r[1],i[1]),Math.max(n[0],s[0],r[0],i[0]),Math.max(n[1],s[1],r[1],i[1])]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[r,s,i]=e,o=t?s:this.height-s,{pixelUnprojectionMatrix:a}=this;let l;if(Number.isFinite(i))l=um(a,[r,o,i,1]);else{const e=um(a,[r,o,-1,1]),t=um(a,[r,o,1,1]),s=((n||0)/om+1)*am,i=sl(rl([],e,t)),c=sl(e),u=sl(t),h=(4*c*u-(i-c-u)**2)/16*4/i;l=function(e,t,n,r){const s=t[0],i=t[1],o=t[2];return e[0]=s+r*(n[0]-s),e[1]=i+r*(n[1]-i),e[2]=o+r*(n[2]-o),e}([],e,t,(Math.sqrt(c-h)-Math.sqrt(Math.max(0,s*s-h)))/Math.sqrt(i))}const[c,u,h]=this.unprojectPosition(l);return Number.isFinite(i)?[c,u,h]:Number.isFinite(n)?[c,u,n]:[c,u]}projectPosition(e){const[t,n,r=0]=e,s=t*sm,i=n*sm,o=Math.cos(i),a=(r/om+1)*am;return[Math.sin(s)*o*a,-Math.cos(s)*o*a,Math.sin(i)*a]}unprojectPosition(e){const[t,n,r]=e,s=function(e){const t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)}(e),i=Math.asin(r/s);return[Math.atan2(t,-n)*im,i*im,(s/am-1)*om]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const n=this.unproject(t);return{longitude:e[0]-n[0]+this.longitude,latitude:e[1]-n[1]+this.latitude}}}function um(e,t){const n=ml([],t,e);return gl(n,n,1/n[3]),n}class hm extends Nd{applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:r}=e;e.zoom=za(r,n,t);const{longitude:s,latitude:i}=e;return(s<-180||s>180)&&(e.longitude=function(e){const t=e%360;return t<0?360+t:t}(s+180)-180),e.latitude=za(i,-85.051129,hu),e}}class dm extends Pd{constructor(){super(...arguments),this.ControllerState=hm,this.transition={transitionDuration:300,transitionInterpolator:new xd(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}}class fm extends dd{constructor(e={}){super(e)}getViewportType(e){return e.zoom>12?fh:cm}get ControllerType(){return dm}}fm.displayName="GlobeView";const pm="mapbox",gm=Math.PI/180;function mm({map:e,gl:t,deck:n}){if(e.__deck)return e.__deck;const r=null==n?void 0:n.props._customRender,s=null==n?void 0:n.props.onLoad,i={...null==n?void 0:n.props,_customRender:()=>{e.triggerRepaint(),null==r||r("")}};let o;return i.parameters={...bm(e,!0),...i.parameters},i.views||(i.views=xm(e)),n&&n.props.gl!==t||(Object.assign(i,{gl:t,width:null,height:null,touchAction:"unset",viewState:wm(e)}),(null==n?void 0:n.isInitialized)?_m(n,e):i.onLoad=()=>{null==s||s(),_m(o,e)}),n?(o=n,n.setProps(i),n.userData.isExternal=!0):(o=new Zp(i),e.on("remove",()=>{ym(e)})),o.userData.mapboxLayers=new Set,e.__deck=o,e.on("render",()=>{o.isInitialized&&function(e,t){const{mapboxLayers:n,isExternal:r}=e.userData;if(r){const r=Array.from(n,e=>e.id),s=td(e.props.layers,Boolean).some(e=>e&&!r.includes(e.id));let i=e.getViewports();const o=i.findIndex(e=>e.id===pm),a=i.length>1||o<0;(s||a)&&(o>=0&&(i=i.slice(),i[o]=Em(e,t)),e._drawLayers("mapbox-repaint",{viewports:i,layerFilter:t=>(!e.props.layerFilter||e.props.layerFilter(t))&&(t.viewport.id!==pm||!r.includes(t.layer.id)),clearCanvas:!1}))}e.userData.currentViewport=null}(o,e)}),o}function _m(e,t){const n=()=>{e.isInitialized?function(e,t){e.setProps({viewState:wm(t)}),e.needsRedraw({clearRedrawFlags:!0})}(e,t):t.off("move",n)};t.on("move",n)}function ym(e){var t;null==(t=e.__deck)||t.finalize(),e.__deck=null}function bm(e,t){const n=t?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return"globe"===vm(e)&&(n.cullMode="back"),n}function vm(e){var t;const n=null==(t=e.getProjection)?void 0:t.call(e),r=(null==n?void 0:n.type)||(null==n?void 0:n.name);if("globe"===r)return"globe";if(r&&"mercator"!==r)throw new Error("Unsupported projection");return"mercator"}function xm(e){return"globe"===vm(e)?new fm({id:pm}):new Od({id:pm})}function wm(e){var t;const{lng:n,lat:r}=e.getCenter(),s={longitude:(n+540)%360-180,latitude:r,zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch(),padding:e.getPadding(),repeat:e.getRenderWorldCopies()};return(null==(t=e.getTerrain)?void 0:t.call(e))&&function(e,t){if(e.getFreeCameraOptions){const{position:n}=e.getFreeCameraOptions();if(!n||void 0===n.z)return;const r=e.transform.height,{longitude:s,latitude:i,pitch:o}=t,a=512*n.x,l=512*(1-n.y),c=512*n.z,u=fu([s,i]),h=a-u[0],d=l-u[1],f=Math.sqrt(h*h+d*d),p=o*gm,g=1.5*r,m=p<.001?g*Math.cos(p)/c:g*Math.sin(p)/f;t.zoom=Math.log2(m);const _=c-g*Math.cos(p)/m;t.position=[0,0,_/gu(i)]}else"number"==typeof e.transform.elevation&&(t.position=[0,0,e.transform.elevation])}(e,s),s}function Em(e,t,n){const r=wm(t),{views:s}=e.props,i=s&&td(s).find(e=>e.id===pm)||xm(t);n&&(i.props.nearZMultiplier=.2);const o=(null==n?void 0:n.nearZ)??t.transform._nearZ,a=(null==n?void 0:n.farZ)??t.transform._farZ;return Number.isFinite(o)&&(r.nearZ=o/t.transform.height,r.farZ=a/t.transform.height),i.makeViewport({width:e.width,height:e.height,viewState:r})}function Tm(e){if(e.userData.isExternal)return;const t=[];e.userData.mapboxLayers.forEach(e=>{const n=new(0,e.props.type)(e.props);t.push(n)}),e.setProps({layers:t})}class Sm{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.map=null,this.deck=null,this.props=e}onAdd(e,t){var n;this.map=e,this.deck=mm({map:e,gl:t,deck:this.props.deck}),(n=this.deck).userData.mapboxLayers.add(this),Tm(n)}onRemove(){var e;this.deck&&((e=this.deck).userData.mapboxLayers.delete(this),Tm(e))}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&Tm(this.deck)}render(e,t){!function(e,t,n,r){let{currentViewport:s}=e.userData,i=!1;s||(s=Em(e,t,r),e.userData.currentViewport=s,i=!0),e.isInitialized&&e._drawLayers("mapbox-repaint",{viewports:[s],layerFilter:t=>(!e.props.layerFilter||e.props.layerFilter(t))&&(n.id===t.layer.id||t.layer.props.operation.includes("terrain")),clearStack:i,clearCanvas:!1})}(this.deck,this.map,this,t)}}const Am="__UNDEFINED__";function Rm(e,t,n,r){if(!(e&&t&&e.style&&e.style._loaded))return;const s=td(r,Boolean);if(n!==r){const t=td(n,Boolean),r=new Set(t.map(e=>e.id));for(const e of s)r.delete(e.id);for(const n of r)e.getLayer(n)&&e.removeLayer(n)}for(const a of s){const n=e.getLayer(a.id);n?(n.implementation||n).setProps(a.props):e.addLayer(new Sm({id:a.id,deck:t,slot:a.props.slot}),a.props.beforeId)}const i=e.style._order,o={};for(const a of s){let{beforeId:e}=a.props;e&&i.includes(e)||(e=Am),o[e]=o[e]||[],o[e].push(a.id)}for(const a in o){const t=o[a];let n=a===Am?i.length:i.indexOf(a),r=a===Am?void 0:a;for(let s=t.length-1;s>=0;s--){const o=t[s],a=i.indexOf(o);a!==n-1&&(e.moveLayer(o,r),a>n&&n++),n--,r=o}}}class Cm{constructor(e){this._handleStyleChange=()=>{var e;Rm(this._map,this._deck,this._props.layers,this._props.layers),this._map&&vm(this._map)&&!this._props.views&&(null==(e=this._deck)||e.setProps({views:xm(this._map)}))},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:e,clientHeight:t}=this._map.getContainer();Object.assign(this._container.style,{width:`${e}px`,height:`${t}px`})}},this._updateViewState=()=>{const e=this._deck,t=this._map;e&&t&&(e.setProps({views:this._props.views||xm(t),viewState:wm(t)}),e.isInitialized&&e.redraw())},this._handleMouseEvent=e=>{const t=this._deck;if(!t||!t.isInitialized)return;const n={type:e.type,offsetCenter:e.point,srcEvent:e},r=this._lastMouseDownPoint;switch(!e.point&&r&&(n.deltaX=e.originalEvent.clientX-r.clientX,n.deltaY=e.originalEvent.clientY-r.clientY,n.offsetCenter={x:r.x+n.deltaX,y:r.y+n.deltaY}),n.type){case"mousedown":t._onPointerDown(n),this._lastMouseDownPoint={...e.point,clientX:e.originalEvent.clientX,clientY:e.originalEvent.clientY};break;case"dragstart":n.type="panstart",t._onEvent(n);break;case"drag":n.type="panmove",t._onEvent(n);break;case"dragend":n.type="panend",t._onEvent(n);break;case"click":n.tapCount=1,t._onEvent(n);break;case"dblclick":n.type="click",n.tapCount=2,t._onEvent(n);break;case"mousemove":n.type="pointermove",t._onPointerMove(n);break;case"mouseout":n.type="pointerleave",t._onPointerMove(n);break;default:return}};const{interleaved:t=!1}=e;this._interleaved=t,this._props=this.filterProps(e)}filterProps(e){const{interleaved:t=!1,useDevicePixels:n,...r}=e;return t||void 0===n||(r.useDevicePixels=n),r}setProps(e){this._interleaved&&e.layers&&Rm(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,this.filterProps(e)),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...bm(this._map,this._interleaved),...this._props.parameters}})}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const t=document.createElement("div");return Object.assign(t.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=t,this._deck=new Zp({...this._props,parent:t,parameters:{...bm(e,!1),...this._props.parameters},views:this._props.views||xm(e),viewState:wm(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),t}_onAddInterleaved(e){const t=e.painter.context.gl;return t instanceof WebGLRenderingContext&&Qn.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=mm({map:e,gl:t,deck:new Zp({...this._props,gl:t,parameters:{...bm(e,!0),...this._props.parameters}})}),e.on("styledata",this._handleStyleChange),Rm(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){var t;e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),null==(t=this._deck)||t.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),Rm(e,this._deck,this._props.layers,[]),ym(e)}getDefaultPosition(){return"top-left"}pickObject(e){return _d(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return _d(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return _d(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}const km="uniform arcUniforms {\n  bool greatCircle;\n  bool useShortestPath;\n  float numSegments;\n  float widthScale;\n  float widthMinPixels;\n  float widthMaxPixels;\n  highp int widthUnits;\n} arc;\n",Im={name:"arc",vs:km,fs:km,uniformTypes:{greatCircle:"f32",useShortestPath:"f32",numSegments:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",widthUnits:"i32"}},Pm=[0,0,0,255],Mm={getSourcePosition:{type:"accessor",value:e=>e.sourcePosition},getTargetPosition:{type:"accessor",value:e=>e.targetPosition},getSourceColor:{type:"accessor",value:Pm},getTargetColor:{type:"accessor",value:Pm},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class Nm extends rm{getBounds(){var e;return null==(e=this.getAttributeManager())?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME arc-layer-vertex-shader\nin vec4 instanceSourceColors;\nin vec4 instanceTargetColors;\nin vec3 instanceSourcePositions;\nin vec3 instanceSourcePositions64Low;\nin vec3 instanceTargetPositions;\nin vec3 instanceTargetPositions64Low;\nin vec3 instancePickingColors;\nin float instanceWidths;\nin float instanceHeights;\nin float instanceTilts;\nout vec4 vColor;\nout vec2 uv;\nout float isValid;\nfloat paraboloid(float distance, float sourceZ, float targetZ, float ratio) {\nfloat deltaZ = targetZ - sourceZ;\nfloat dh = distance * instanceHeights;\nif (dh == 0.0) {\nreturn sourceZ + deltaZ * ratio;\n}\nfloat unitZ = deltaZ / dh;\nfloat p2 = unitZ * unitZ + 1.0;\nfloat dir = step(deltaZ, 0.0);\nfloat z0 = mix(sourceZ, targetZ, dir);\nfloat r = mix(ratio, 1.0 - ratio, dir);\nreturn sqrt(r * (p2 - r)) * dh + z0;\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\nvec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn dir_screenspace * offset_direction * width / 2.0;\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (arc.numSegments - 1.0));\n}\nvec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {\nfloat distance = length(source.xy - target.xy);\nfloat z = paraboloid(distance, source.z, target.z, segmentRatio);\nfloat tiltAngle = radians(instanceTilts);\nvec2 tiltDirection = normalize(target.xy - source.xy);\nvec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);\nreturn vec3(\nmix(source.xy, target.xy, segmentRatio) + tilt,\nz * cos(tiltAngle)\n);\n}\nfloat getAngularDist (vec2 source, vec2 target) {\nvec2 sourceRadians = radians(source);\nvec2 targetRadians = radians(target);\nvec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);\nvec2 shd_sq = sin_half_delta * sin_half_delta;\nfloat a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;\nreturn 2.0 * asin(sqrt(a));\n}\nvec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {\nvec2 lngLat;\nif(abs(angularDist - PI) < 0.001) {\nlngLat = (1.0 - t) * source.xy + t * target.xy;\n} else {\nfloat a = sin((1.0 - t) * angularDist);\nfloat b = sin(t * angularDist);\nvec3 p = source3D.yxz * a + target3D.yxz * b;\nlngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));\n}\nfloat z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);\nreturn vec3(lngLat, z);\n}\nvoid main(void) {\ngeometry.worldPosition = instanceSourcePositions;\ngeometry.worldPositionAlt = instanceTargetPositions;\nfloat segmentIndex = float(gl_VertexID / 2);\nfloat segmentSide = mod(float(gl_VertexID), 2.) == 0. ? -1. : 1.;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));\nfloat nextSegmentRatio = getSegmentRatio(min(arc.numSegments - 1.0, segmentIndex + 1.0));\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nisValid = 1.0;\nuv = vec2(segmentRatio, segmentSide);\ngeometry.uv = uv;\ngeometry.pickingColor = instancePickingColors;\nvec4 curr;\nvec4 next;\nvec3 source;\nvec3 target;\nif ((arc.greatCircle || project.projectionMode == PROJECTION_MODE_GLOBE) && project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nsource = project_globe_(vec3(instanceSourcePositions.xy, 0.0));\ntarget = project_globe_(vec3(instanceTargetPositions.xy, 0.0));\nfloat angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);\nvec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);\nvec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);\nvec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);\nif (abs(currPos.x - prevPos.x) > 180.0) {\nindexDir = -1.0;\nisValid = 0.0;\n} else if (abs(currPos.x - nextPos.x) > 180.0) {\nindexDir = 1.0;\nisValid = 0.0;\n}\nnextPos = indexDir < 0.0 ? prevPos : nextPos;\nnextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;\nif (isValid == 0.0) {\nnextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;\nfloat t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);\ncurrPos = mix(currPos, nextPos, t);\nsegmentRatio = mix(segmentRatio, nextSegmentRatio, t);\n}\nvec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);\nvec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);\ncurr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);\nnext = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));\n} else {\nvec3 source_world = instanceSourcePositions;\nvec3 target_world = instanceTargetPositions;\nif (arc.useShortestPath) {\nsource_world.x = mod(source_world.x + 180., 360.0) - 180.;\ntarget_world.x = mod(target_world.x + 180., 360.0) - 180.;\nfloat deltaLng = target_world.x - source_world.x;\nif (deltaLng > 180.) target_world.x -= 360.;\nif (deltaLng < -180.) source_world.x -= 360.;\n}\nsource = project_position(source_world, instanceSourcePositions64Low);\ntarget = project_position(target_world, instanceTargetPositions64Low);\nfloat antiMeridianX = 0.0;\nif (arc.useShortestPath) {\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\nantiMeridianX = -(project.coordinateOrigin.x + 180.) / 360. * TILE_SIZE;\n}\nfloat thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);\nif (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {\nisValid = 0.0;\nindexDir = sign(segmentRatio - thresholdRatio);\nsegmentRatio = thresholdRatio;\n}\n}\nnextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;\nvec3 currPos = interpolateFlat(source, target, segmentRatio);\nvec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);\nif (arc.useShortestPath) {\nif (nextPos.x < antiMeridianX) {\ncurrPos.x += TILE_SIZE;\nnextPos.x += TILE_SIZE;\n}\n}\ncurr = project_common_position_to_clipspace(vec4(currPos, 1.0));\nnext = project_common_position_to_clipspace(vec4(nextPos, 1.0));\ngeometry.position = vec4(currPos, 1.0);\n}\nfloat widthPixels = clamp(\nproject_size_to_pixel(instanceWidths * arc.widthScale, arc.widthUnits),\narc.widthMinPixels, arc.widthMaxPixels\n);\nvec3 offset = vec3(\ngetExtrusionOffset((next.xy - curr.xy) * indexDir, segmentSide, widthPixels),\n0.0);\nDECKGL_FILTER_SIZE(offset, geometry);\nDECKGL_FILTER_GL_POSITION(curr, geometry);\ngl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\nvec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);\nvColor = vec4(color.rgb, color.a * layer.opacity);\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME arc-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nin vec2 uv;\nin float isValid;\nout vec4 fragColor;\nvoid main(void) {\nif (isValid == 0.0) {\ndiscard;\n}\nfragColor = vColor;\ngeometry.uv = uv;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[eu,Mu,Im]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:Pm},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:Pm},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&(null==(t=this.state.model)||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:t,widthScale:n,widthMinPixels:r,widthMaxPixels:s,greatCircle:i,wrapLongitude:o,numSegments:a}=this.props,l={numSegments:a,widthUnits:Fc[t],widthScale:n,widthMinPixels:r,widthMaxPixels:s,greatCircle:i,useShortestPath:o},c=this.state.model;c.shaderInputs.setProps({arc:l}),c.setVertexCount(2*a),c.draw(this.context.renderPass)}_getModel(){return new Gh(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-strip",isInstanced:!0})}}function Lm(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[128,128,128]}Nm.layerName="ArcLayer",Nm.defaultProps=Mm;const Om=Lm(ie),Fm=Lm(oe);function Dm({neighborPolylines:e,hoveredEdgeKey:t,onEdgeHover:n}){const{current:r}=v(),s=d.useRef(null),i=d.useMemo(()=>e.map(({from:e,to:t,hash:n,neighbor:r,lastHopData:s})=>{const i=r.node_name||r.name||n.slice(0,8),o=(null==s?void 0:s.avgSnr)??r.snr,a=(null==s?void 0:s.avgRssi)??r.rssi;return{sourcePosition:[e[1],e[0]],targetPosition:[t[1],t[0]],key:`neighbor-${n}`,hash:n,name:i,prefix:null==s?void 0:s.prefix,rssi:a,snr:o,packetCount:null==s?void 0:s.count,confidence:null==s?void 0:s.confidence,hasAvgRssi:void 0!==(null==s?void 0:s.avgRssi),hasAvgSnr:void 0!==(null==s?void 0:s.avgSnr)}}),[e]),o=d.useMemo(()=>new Nm({id:"neighbor-arcs",data:i,pickable:!0,getSourcePosition:e=>e.sourcePosition,getTargetPosition:e=>e.targetPosition,getSourceColor:e=>e.key===t?[...Fm,255]:[...Om,153],getTargetColor:e=>e.key===t?[...Fm,255]:[...Om,153],getWidth:e=>e.key===t?2.5:1.5,getHeight:.5,greatCircle:!1,onHover:e=>{e.object?n(e.object.key):n(null)},updateTriggers:{getSourceColor:[t],getTargetColor:[t],getWidth:[t]}}),[i,t,n]);return d.useEffect(()=>{const e=null==r?void 0:r.getMap();if(e)return s.current||(s.current=new Cm({interleaved:!0,layers:[]}),e.addControl(s.current)),s.current.setProps({layers:[o]}),()=>{if(s.current&&e){try{e.removeControl(s.current)}catch{}s.current=null}}},[r,o]),null}const Bm=["neighbor-arcs"];function Um({positions:e}){const{current:t}=v(),n=d.useRef(!1);return d.useEffect(()=>{if(t&&0!==e.length&&!n.current)if(n.current=!0,1===e.length)t.flyTo({center:[e[0][1],e[0][0]],zoom:14,duration:1e3});else{const n=e.map(([e,t])=>[t,e]);let r=1/0,s=-1/0,i=1/0,o=-1/0;for(const[e,t]of n)r=Math.min(r,e),s=Math.max(s,e),i=Math.min(i,t),o=Math.max(o,t);const a=[[r,i],[s,o]];t.fitBounds(a,{padding:{top:15,bottom:15,left:15,right:15},maxZoom:16,duration:1e3})}},[t,e]),null}function jm({targetHash:e,nodeCoordinates:t,onComplete:n}){const{current:r}=v(),s=d.useRef(null);return d.useEffect(()=>{if(!r||!e||e===s.current)return;const i=t.get(e);if(!i)return;s.current=e;const[o,a]=i;r.flyTo({center:[a,o],zoom:15,duration:2500,essential:!0}),setTimeout(()=>{null==n||n()},2600)},[e,t,r,n]),null}function Vm({highlightedEdgeKey:e,validatedPolylines:t,weakPolylines:n,onEnsureTopology:r}){const{current:s}=v();return d.useEffect(()=>{if(!s||!e)return;r();const i=t.find(t=>t.edge.key===e)||n.find(t=>t.edge.key===e);if(!i)return;const o=(i.from[0]+i.to[0])/2,a=(i.from[1]+i.to[1])/2,l=s.getZoom(),c=Math.max(l,11);s.flyTo({center:[a,o],zoom:c,duration:500,essential:!0})},[e,t,n,s,r]),null}const Gm={longitude:0,latitude:0,zoom:2};function zm({type:e,properties:t,maxCertainCount:n}){if("neighbor"===e){const e=t;return i.jsxs("div",{className:"text-xs",children:[i.jsxs("div",{className:"font-medium text-text-primary",children:[i.jsx("span",{className:"text-amber-400",children:"●"})," ",e.name,e.prefix&&i.jsxs("span",{className:"ml-1 text-text-muted font-mono text-[10px]",children:["(",e.prefix,")"]})]}),i.jsxs("div",{className:"text-text-secondary flex gap-2",children:[void 0!==e.rssi&&null!==e.rssi&&i.jsxs("span",{children:["RSSI: ",Math.round(e.rssi)," dBm",e.hasAvgRssi&&" avg"]}),void 0!==e.snr&&null!==e.snr&&i.jsxs("span",{children:["SNR: ",Number(e.snr).toFixed(1)," dB",e.hasAvgSnr&&" avg"]})]}),void 0!==e.packetCount&&i.jsxs("div",{className:"text-text-muted text-[10px]",children:[Number(e.packetCount).toLocaleString()," packets",void 0!==e.confidence&&` • ${Math.round(100*Number(e.confidence))}% conf`]}),i.jsx("div",{className:"text-amber-400 text-[10px] mt-0.5",children:"Direct RF neighbor"})]})}const r=t,s=n>0?Number(r.certainCount)/n:0;return i.jsxs("div",{className:"text-xs",children:[i.jsxs("div",{className:"font-medium text-text-primary",children:[r.fromName," ↔ ",r.toName]}),i.jsxs("div",{className:"text-text-secondary",children:[r.certainCount," validations (",Math.round(100*s),"%) • ",Math.round(100*Number(r.confidence)),"% conf"]}),r.isBackbone&&i.jsx("div",{className:"text-gray-300 font-semibold",children:"Backbone"}),r.isLoopEdge&&i.jsx("div",{className:"text-indigo-400 text-[10px] mt-0.5",children:"Redundant path"}),r.isDirectPath&&i.jsx("div",{className:"text-teal-400 text-[10px]",children:"Direct path"})]})}function Wm({neighbors:e,localNode:t,localHash:n,onRemoveNode:r,selectedNodeHash:s,onNodeSelected:o,highlightedEdgeKey:a}){const f=d.useRef(null),p=l(),g=c(),m=u(),y=h(),[b,v]=d.useState(Gm),[T,S]=d.useState(!1),[A,R]=d.useState(!1),[k,I]=d.useState(!1),[P,M]=d.useState(!1),[N,L]=d.useState(null),[O,F]=d.useState(null),[D,B]=d.useState(null),[U,j]=d.useState(""),[V,G]=d.useState(!1),[W,H]=d.useState("fetching"),[X,q]=d.useState(!1),[Y,K]=d.useState(0),[Z,Q]=d.useState(null),J=d.useMemo(()=>Object.entries(e).filter(([,e])=>e.latitude&&e.longitude),[e]),ee=d.useMemo(()=>{const e=[];(null==t?void 0:t.latitude)&&(null==t?void 0:t.longitude)&&e.push([t.latitude,t.longitude]);for(const[,t]of J)t.latitude&&t.longitude&&e.push([t.latitude,t.longitude]);return e},[t,J]),te=d.useMemo(()=>{const e=new Map;n&&(null==t?void 0:t.latitude)&&(null==t?void 0:t.longitude)&&e.set(n,[t.latitude,t.longitude]);for(const[t,n]of J)n.latitude&&n.longitude&&e.set(t,[n.latitude,n.longitude]);return e},[n,t,J]),ne=d.useMemo(()=>{const e=new Map;for(const t of m)"expired"!==t.status&&e.set(t.hash,{hash:t.hash,prefix:t.prefix,count:t.count,avgRssi:t.avgRssi,avgSnr:t.avgSnr,lastSeen:t.lastSeen,confidence:1,status:t.status});return e},[m]),re=d.useMemo(()=>{var t,n;const r=new Set;for(const s of ne.keys())(null==(t=e[s])?void 0:t.latitude)&&(null==(n=e[s])?void 0:n.longitude)&&r.add(s);return r},[ne,e]),se=d.useMemo(()=>{const e=[];for(const t of p.validatedEdges){const n=te.get(t.fromHash),r=te.get(t.toHash);n&&r&&e.push({from:n,to:r,edge:t})}return e},[p.validatedEdges,te]),ie=d.useMemo(()=>{const e=[];for(const t of p.weakEdges){const n=te.get(t.fromHash),r=te.get(t.toHash);n&&r&&e.push({from:n,to:r,edge:t})}return e},[p.weakEdges,te]),oe=d.useMemo(()=>{if(!(null==t?void 0:t.latitude)||!(null==t?void 0:t.longitude))return[];const n=[],r=[t.latitude,t.longitude];for(const t of re){const s=e[t];(null==s?void 0:s.latitude)&&(null==s?void 0:s.longitude)&&n.push({from:r,to:[s.latitude,s.longitude],hash:t,neighbor:s,lastHopData:ne.get(t)??null})}return n},[t,re,e,ne]),le=d.useMemo(()=>new Set(p.loopEdgeKeys),[p.loopEdgeKeys]),ce=d.useMemo(()=>new Set(p.backboneEdges),[p.backboneEdges]),ue=d.useMemo(()=>{let e=0;for(const t of p.validatedEdges)t.certainCount>e&&(e=t.certainCount);return e||1},[p.validatedEdges]),{edgeAnimProgress:de,weightAnimProgress:fe,animStartWeights:_e,animTargetWeights:ye,isExiting:be,resetAnimationState:ve}=function({showTopology:e,polylines:t,weakPolylines:n,maxCertainCount:r,getWeight:s}){const[i,o]=d.useState(new Map),[a,l]=d.useState(1),[c,u]=d.useState(!1),h=d.useRef(e),f=d.useRef(new Set),p=d.useRef(""),[g,m]=d.useState(new Map),[_,y]=d.useState(new Map),b=d.useRef(new Map),v=d.useRef(new Map);d.useEffect(()=>{v.current=i},[i]);const x=d.useCallback(()=>{o(new Map),f.current=new Set,p.current="",m(new Map),y(new Map)},[]);return d.useEffect(()=>{const t=h.current,n=e;if(h.current=e,t&&!n&&!c){u(!0);const e=new Map(v.current);let t=null;const n=r=>{t||(t=r);const s=r-t,i=Math.min(s/500,1),a=(l=i,1-Math.pow(1-l,3));var l;o(()=>{const t=new Map;for(const[n,r]of e)t.set(n,r*(1-a));return t}),i<1?requestAnimationFrame(n):(u(!1),o(new Map),f.current=new Set,p.current="",m(new Map),y(new Map))};requestAnimationFrame(n)}!t&&n&&(o(new Map),f.current=new Set,p.current="")},[e,c]),d.useEffect(()=>{if(!e||c)return;const i=[...t,...n],a=i.map(e=>`${e.edge.key}:${e.edge.certainCount}`).sort().join(","),u=0===f.current.size,h=""!==p.current&&p.current!==a;if(u||h){const e=[],n=[];for(const{edge:t}of i)f.current.has(t.key)?n.push(t.key):e.push(t.key);if(h&&n.length>0){const e=new Map;for(const t of n){const n=b.current.get(t);void 0!==n&&e.set(t,n)}m(e),l(0)}const a=new Map;for(const{edge:i}of t){const e=s(i.certainCount,r);a.set(i.key,e)}if(y(a),o(t=>{const r=new Map(t);for(const n of e)r.set(n,0);for(const e of n)r.has(e)||r.set(e,1);return r}),e.length>0){let t=null;const n=Math.min(100,ae/e.length/2),r=s=>{t||(t=s);const i=s-t;o(t=>{const r=new Map(t);return e.forEach((e,t)=>{const s=t*n,o=Math.max(0,i-s),a=ge(Math.min(o/ae,1));r.set(e,a)}),r});const a=ae+(e.length-1)*n;i<a&&requestAnimationFrame(r)};requestAnimationFrame(r)}if(h&&n.length>0){let e=null;const t=n=>{e||(e=n);const r=n-e,s=Math.min(r/ae,1),i=ge(s);l(i),s<1&&requestAnimationFrame(t)};requestAnimationFrame(t)}for(const t of e)f.current.add(t)}for(const{edge:e}of t){const t=s(e.certainCount,r);b.current.set(e.key,t)}p.current=a},[e,c,t,n,r,s]),{edgeAnimProgress:i,weightAnimProgress:a,isExiting:c,animStartWeights:g,animTargetWeights:_,resetAnimationState:x}}({showTopology:A,polylines:se,weakPolylines:ie,maxCertainCount:ue,getWeight:z}),xe=d.useMemo(()=>{const e=new Set;for(const t of p.hubNodes){e.add(t);for(const n of p.validatedEdges)n.fromHash===t&&e.add(n.toHash),n.toHash===t&&e.add(n.fromHash)}return e},[p.hubNodes,p.validatedEdges]),we=d.useMemo(()=>{const e=new Set;if(!n)return e;for(const t of p.validatedEdges)t.fromHash===n&&e.add(t.toHash),t.toHash===n&&e.add(t.fromHash);return e},[n,p.validatedEdges]),{getNodeOpacity:Ee}=function({soloDirect:e,soloHubs:t,neighborHashes:n,hubConnectedNodes:r,directNodeSet:s,localConnectedNodes:i,showTopology:o}){const[a,l]=d.useState(new Map),c=d.useRef(e),u=d.useRef(t),h=d.useRef(new Map),f=d.useRef(null),p=d.useRef(r),g=d.useRef(s),m=d.useRef(i),_=d.useRef(o);return d.useEffect(()=>{p.current=r,g.current=s,m.current=i,_.current=o},[r,s,i,o]),d.useEffect(()=>{const r=c.current,s=u.current,i=e,o=t;if(c.current=e,u.current=t,r===i&&s===o)return;f.current&&(cancelAnimationFrame(f.current),f.current=null);const a=p.current,d=g.current,y=m.current,b=_.current;for(const e of n)h.current.has(e)||h.current.set(e,Math.random());const v=(e,t,n)=>{const r=a.has(e),s=d.has(e),i=b&&y.has(e);return!t&&!n||(t&&n?r||s||i:n?r:!t||s||i)},x=[];for(const e of n){const t=v(e,r,s),n=v(e,i,o);t!==n&&x.push({hash:e,startOpacity:t?1:0,targetOpacity:n?1:0})}if(0===x.length)return;l(e=>{const t=new Map(e);for(const{hash:n,startOpacity:r}of x)t.set(n,r);return t});const w=x;let E=null;const T=e=>{E||(E=e);const t=e-E;let n=!0;l(()=>{const e=new Map;for(const{hash:r,startOpacity:s,targetOpacity:i}of w){const o=250*(h.current.get(r)??0),a=Math.max(0,t-o),l=Math.min(a/500,1),c=s+(i-s)*me(l);e.set(r,c),l<1&&(n=!1)}return e}),t<750&&!n?f.current=requestAnimationFrame(T):(f.current=null,l(new Map))};return f.current=requestAnimationFrame(T),()=>{f.current&&(cancelAnimationFrame(f.current),f.current=null)}},[e,t,n]),{nodeOpacities:a,getNodeOpacity:(e,t)=>a.has(e)?a.get(e):t?1:0}}({soloDirect:k,soloHubs:P,neighborHashes:J.map(([e])=>e),hubConnectedNodes:xe,directNodeSet:re,localConnectedNodes:we,showTopology:A}),Te=d.useCallback(e=>{if(!k&&!P)return!0;if(k)return re.has(e);if(P){if(p.hubNodes.includes(e))return!0;for(const t of p.validatedEdges){if(t.fromHash===e&&p.hubNodes.includes(t.toHash))return!0;if(t.toHash===e&&p.hubNodes.includes(t.fromHash))return!0}return!1}return!0},[k,P,re,p.hubNodes,p.validatedEdges]),Se=d.useCallback(async()=>{q(!0),G(!0),H("fetching"),K(0),await g(),K(y.packetCount),H("analyzing"),await new Promise(e=>setTimeout(e,200)),H("building");const e=Date.now(),t=Date.now()-e;t<1700&&await new Promise(e=>setTimeout(e,1700-t)),H("complete"),await new Promise(e=>setTimeout(e,1e3)),G(!1),q(!1),ve(),setTimeout(()=>{R(!0)},150)},[g,ve,y.packetCount]),Ae=d.useCallback(e=>{v(e.viewState)},[]),Re=d.useCallback(()=>{S(e=>!e)},[]),Ce=d.useCallback(()=>{R(e=>!e)},[]),ke=d.useCallback(()=>{I(e=>!e)},[]),Ie=d.useCallback(()=>{M(e=>!e)},[]),Pe=d.useCallback(()=>{A||R(!0)},[A]),Me=d.useCallback((e,t)=>{B(e),j(t)},[]),Ne=d.useCallback(()=>{D&&r&&r(D),B(null),j("")},[D,r]),Oe=d.useMemo(()=>[...Ge,...Bm],[]),Fe=d.useCallback(e=>{var t;if(!e.features||0===e.features.length)return;const n=e.features[0],r=null==(t=n.layer)?void 0:t.id,s=n.properties;if(!(null==s?void 0:s.key))return;const i=null==r?void 0:r.startsWith("topology-"),o=null==r?void 0:r.startsWith("neighbor-");if(i||o){const t=s.key.replace(/-loop[12]$/,"");F(t),e.lngLat&&Q({longitude:e.lngLat.lng,latitude:e.lngLat.lat,type:i?"topology":"neighbor",properties:s})}f.current&&(f.current.getCanvas().style.cursor="pointer")},[]),De=d.useCallback(()=>{F(null),Q(null),f.current&&(f.current.getCanvas().style.cursor="")},[]),Be=T?"h-screen":"h-[500px]",Ue=T?"fixed inset-0 z-50 bg-surface":"glass-card overflow-hidden";return i.jsxs("div",{className:`${Ue} ${Be}`,children:[i.jsxs("div",{className:"relative w-full h-full",children:[i.jsxs(x,{ref:f,...b,onMove:Ae,mapStyle:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",style:{width:"100%",height:"100%"},attributionControl:!1,interactiveLayerIds:Oe,onMouseMove:Fe,onMouseLeave:De,onLoad:e=>{const t=e.target,n=t.getStyle();if(null==n?void 0:n.layers){for(const e of n.layers)("water"===e.id||e.id.includes("water"))&&"fill"===e.type&&t.setPaintProperty(e.id,"fill-opacity",0),"background"===e.type&&t.setPaintProperty(e.id,"background-opacity",0),"symbol"===e.type&&(t.setPaintProperty(e.id,"text-color","rgba(50, 52, 58, 1)"),t.setPaintProperty(e.id,"text-halo-color","rgba(8, 9, 11, 0.9)"),t.setPaintProperty(e.id,"text-halo-width",1),t.setLayoutProperty(e.id,"text-font",["Inter","Open Sans Regular","Arial Unicode MS Regular"]));t.getSource("carto")&&t.addLayer({id:"land-cover-opaque",type:"fill",source:"carto","source-layer":"landcover",paint:{"fill-color":"#0c0c0f","fill-opacity":1}},"water")}const r=t.getCanvas();r&&(r.style.background="transparent")},children:[i.jsx(w,{position:"top-left",style:{marginTop:"1rem",marginLeft:"1rem"}}),i.jsx(E,{position:"bottom-right"}),i.jsx(Um,{positions:ee}),s&&i.jsx(jm,{targetHash:s,nodeCoordinates:te,onComplete:o}),a&&i.jsx(Vm,{highlightedEdgeKey:a,validatedPolylines:se,weakPolylines:ie,onEnsureTopology:Pe}),i.jsx(Ve,{showTopology:A,isExiting:be,validatedPolylines:se,weakPolylines:ie,edgeAnimProgress:de,weightAnimProgress:fe,animStartWeights:_e,animTargetWeights:ye,maxCertainCount:ue,loopEdgeKeys:le,backboneEdgeKeys:ce,hoveredEdgeKey:O,onEdgeHover:F,highlightedEdgeKey:a,neighbors:e}),i.jsx(Le,{neighborsWithLocation:J,localNode:t,localHash:n,zeroHopNeighbors:re,lastHopNeighborMap:ne,meshTopology:p,hoveredMarker:N,onMarkerHover:L,getNodeOpacity:Ee,shouldShowNode:Te,onRequestRemove:r?Me:void 0}),i.jsx(Dm,{neighborPolylines:oe,hoveredEdgeKey:O,onEdgeHover:F}),Z&&i.jsx(_,{longitude:Z.longitude,latitude:Z.latitude,anchor:"bottom",offset:[0,-20],closeButton:!1,closeOnClick:!1,className:"maplibre-popup",children:i.jsx(zm,{type:Z.type,properties:Z.properties,maxCertainCount:ue})})]}),i.jsx(pe,{isDeepLoading:X,showDeepAnalysisModal:V,onDeepAnalysis:Se,showTopology:A,onToggleTopology:Ce,hasValidatedPolylines:se.length>0,soloHubs:P,onToggleSoloHubs:Ie,hasHubNodes:p.hubNodes.length>0,soloDirect:k,onToggleSoloDirect:ke,hasZeroHopNeighbors:re.size>0,isFullscreen:T,onToggleFullscreen:Re}),i.jsx(he,{showTopology:A,validatedPolylineCount:se.length,filteredNeighborCount:J.length,hasLocalNode:!(!(null==t?void 0:t.latitude)||!(null==t?void 0:t.longitude)),meshTopology:p,zeroHopNeighbors:re,neighborsWithLocation:J})]}),!T&&i.jsxs("div",{className:"absolute inset-0 pointer-events-none rounded-[1.125rem] overflow-hidden",children:[i.jsx("div",{className:"absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-white/20 to-transparent"}),i.jsx("div",{className:"absolute top-0 left-0 w-24 h-24 bg-gradient-to-br from-white/[0.03] to-transparent"}),i.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-gradient-to-bl from-white/[0.03] to-transparent"}),i.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-16 bg-gradient-to-t from-black/20 to-transparent"})]}),i.jsx(C,{isOpen:null!==D,onCancel:()=>B(null),onConfirm:Ne,title:"Remove Node?",message:`Remove "${U}" from the contacts list? This will hide the node until it sends a new packet.`,confirmLabel:"Remove",cancelLabel:"Cancel",variant:"danger"}),i.jsx($,{isOpen:V,currentStep:W,packetCount:Y})]})}export{Wm as default};
