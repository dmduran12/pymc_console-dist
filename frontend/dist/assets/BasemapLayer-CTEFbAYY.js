import{c as t,bn as e,r as a}from"./vendor-react-0D__tamq.js";const r="pymc-basemap-mode",o="light";function s(){if("undefined"==typeof window)return o;try{const t=localStorage.getItem(r);if("light"===t||"dark"===t)return t}catch{}return o}function n(t){if("undefined"!=typeof window)try{localStorage.setItem(r,t)}catch{}}const i=t(t=>({mode:s(),toggle:()=>t(t=>{const e="light"===t.mode?"dark":"light";return n(e),{mode:e}}),setMode:e=>{n(e),t({mode:e})}})),c=()=>i(t=>t.mode),l=()=>i(t=>t.toggle),d={light:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",dark:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json"},u={light:"basemap-light-",dark:"basemap-dark-"},f={};function y({mode:t}){const{current:r}=e(),o=a.useRef({light:!1,dark:!1}),s=a.useRef({light:[],dark:[]}),n=a.useCallback(async(t,e,a)=>{var r,n;if(o.current[e])return;const i=u[e],c=await async function(t){if(f[t])return f[t];const e=await fetch(d[t]),a=await e.json();return f[t]=a,a}(e),l=[];for(const[o,s]of Object.entries(c.sources||{})){const e=i+o;t.getSource(e)||t.addSource(e,s)}const y=null==(n=((null==(r=t.getStyle())?void 0:r.layers)||[]).find(t=>!t.id.startsWith("basemap-light-")&&!t.id.startsWith("basemap-dark-")))?void 0:n.id;for(const o of c.layers||[]){const e=i+o.id;if(l.push(e),t.getLayer(e))continue;const r={...o,id:e};"source"in r&&"string"==typeof r.source&&(r.source=i+r.source),r.layout||(r.layout={}),r.layout.visibility=a?"visible":"none";try{t.addLayer(r,y)}catch(g){}}s.current[e]=l,o.current[e]=!0},[]),i=a.useCallback((t,e,a)=>{const r=s.current[e],o=a?"visible":"none";for(const s of r)if(t.getLayer(s))try{t.setLayoutProperty(s,"visibility",o)}catch{}},[]),c=a.useCallback(t=>{var e;const a=((null==(e=t.getStyle())?void 0:e.layers)||[]).filter(t=>!t.id.startsWith("basemap-light-")&&!t.id.startsWith("basemap-dark-"));for(const r of a)try{t.moveLayer(r.id)}catch{}},[]);return a.useEffect(()=>{var e;const a=null==(e=null==r?void 0:r.getMap)?void 0:e.call(r);if(!a)return;let s=!1;const i=async()=>{if(!s)try{await Promise.all([n(a,"light","light"===t),n(a,"dark","dark"===t)]),s||c(a)}catch(e){}};a.isStyleLoaded()?i():a.once("style.load",i);const l=()=>{s||setTimeout(()=>{!s&&o.current.light&&o.current.dark&&c(a)},100)};return a.on("styledata",l),()=>{s=!0,a.off("styledata",l)}},[r,n,c,t]),a.useEffect(()=>{var e;const a=null==(e=null==r?void 0:r.getMap)?void 0:e.call(r);a&&o.current.light&&o.current.dark&&(i(a,"light","light"===t),i(a,"dark","dark"===t))},[r,t,i]),null}export{y as B,l as a,c as u};
