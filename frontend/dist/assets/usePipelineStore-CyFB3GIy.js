const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C8IY8K2r.js","assets/index-DUfCykEc.css"])))=>i.map(i=>d[i]);
import{$ as L,bH as X,ep as se,eq as ae,bh as ce,r as re,em as q,er as ie,bo as Z}from"./index-C8IY8K2r.js";import{c as fe,m as K,i as V}from"./node-types-3T9Wr7vI.js";import{c as U,P as $}from"./geo-utils-BP1zBK9h.js";function de(o){if(o.contact_type){const d=o.contact_type.toLowerCase();if(d==="repeater"||d==="rep")return!0;if(d==="companion"||d==="client"||d==="cli"||d==="room server"||d==="room_server"||d==="room"||d==="server")return!1}return o.is_repeater===!0?!0:(o.is_repeater===!1,!1)}function le(o){const d={};for(const[t,i]of Object.entries(o))de(i)&&(d[t]=i);return d}const Y={position:.15,cooccurrence:.15,geographic:.35,recency:.35},k=5,he=336,Q=12,ee=72;function ue(o,d){if(!o||o<=0)return .1;const i=(Math.floor(Date.now()/1e3)-o)/3600;return i<0?1:Math.exp(-i/Q)}function pe(o){return!o||o<=0?!1:(Math.floor(Date.now()/1e3)-o)/3600>he}function je(o,d,t,i,l){const s=new Map,v=le(d),g=new Map,p=i!==void 0&&l!==void 0&&(i!==0||l!==0);if(t){const h=L(t),e={hash:t,prefix:h,positionCounts:new Array(k).fill(0),totalAppearances:0,typicalPosition:0,positionConsistency:0,adjacentPrefixCounts:new Map,totalAdjacentObservations:0,latitude:i,longitude:l,distanceToLocal:0,srcGeoEvidenceScore:0,srcGeoEvidenceCount:0,lastSeenTimestamp:Math.floor(Date.now()/1e3),recencyScore:1,positionScore:0,cooccurrenceScore:0,geographicScore:1,combinedScore:0};g.set(h,[e])}for(const[h,e]of Object.entries(v)){const n=L(h),f=e.last_seen??0;if(pe(f))continue;let c;const y=e.zero_hop===!0;p&&e.latitude&&e.longitude&&(e.latitude!==0||e.longitude!==0)&&(c=U(i,l,e.latitude,e.longitude));let a=.2;c!==void 0?c<$.VERY_CLOSE?a=1:c<$.CLOSE?a=.8:c<$.MEDIUM?a=.6:c<$.FAR?a=.4:c<$.VERY_FAR?a=.2:a=.1:e.latitude&&e.longitude&&(a=.5);const u=ue(f);if(y&&u>.01){const O=f>0?(Math.floor(Date.now()/1e3)-f)/3600:1/0,C=Math.exp(-O/ee);a=Math.max(a,.95*C)}const b={hash:h,prefix:n,name:e.name||e.node_name,positionCounts:new Array(k).fill(0),totalAppearances:0,typicalPosition:0,positionConsistency:0,adjacentPrefixCounts:new Map,totalAdjacentObservations:0,latitude:e.latitude,longitude:e.longitude,distanceToLocal:c,srcGeoEvidenceScore:0,srcGeoEvidenceCount:0,lastSeenTimestamp:f,recencyScore:u,positionScore:0,cooccurrenceScore:0,geographicScore:a,combinedScore:0},P=g.get(n)||[];P.push(b),g.set(n,P)}for(const h of o){const e=se(h,t);if(!e||e.effectiveLength===0)continue;const n=e.effective,f=h.src_hash,c=f?d[f]:void 0,y=(c==null?void 0:c.latitude)&&(c==null?void 0:c.longitude)&&(c.latitude!==0||c.longitude!==0);for(let a=0;a<n.length;a++){const u=n[a],b=g.get(u);if(!b)continue;const P=ae(a,e.effectiveLength),O=Math.min(P-1,k-1);for(const C of b){if(C.positionCounts[O]++,C.totalAppearances++,P===1&&b.length>1&&y&&C.latitude&&C.longitude){const r=U(c.latitude,c.longitude,C.latitude,C.longitude);let N=0;r<500?N=1:r<2e3?N=.8:r<5e3?N=.5:r<1e4?N=.3:N=.1,C.distanceToLocal!==void 0&&(C.distanceToLocal<500?N*=1.2:C.distanceToLocal<2e3?N*=1:N*=.8),C.srcGeoEvidenceScore+=N,C.srcGeoEvidenceCount++}if(a>0&&b.length>1&&C.latitude&&C.longitude){const r=a-1,N=n[r],D=g.get(N);if(D&&D.length>0){let I,A,E=0;if(D.length===1){const H=D[0];H.latitude&&H.longitude&&(I=H.latitude,A=H.longitude,E=1)}else{const H=[...D].sort((S,T)=>T.combinedScore-S.combinedScore),M=H[0],_=H[1];if(M.latitude&&M.longitude&&M.combinedScore>0){const S=_?(M.combinedScore-_.combinedScore)/M.combinedScore:1;E=Math.min(1,S+.3),E>.4&&(I=M.latitude,A=M.longitude)}}if(I!==void 0&&A!==void 0){const H=U(C.latitude,C.longitude,I,A);let M=0;H<500?M=1:H<2e3?M=.8:H<5e3?M=.5:H<1e4?M=.3:M=.1,M*=E,C.srcGeoEvidenceScore+=M,C.srcGeoEvidenceCount++}}}if(P>1&&b.length>1&&C.latitude&&C.longitude){const r=a+1;if(r<n.length){const N=n[r],D=g.get(N);if(D&&D.length>0){let I,A,E=0;if(D.length===1){const H=D[0];H.latitude&&H.longitude&&(I=H.latitude,A=H.longitude,E=1)}else{const H=[...D].sort((S,T)=>T.combinedScore-S.combinedScore),M=H[0],_=H[1];if(M.latitude&&M.longitude&&M.combinedScore>0){const S=_?(M.combinedScore-_.combinedScore)/M.combinedScore:1;E=Math.min(1,S+.3),E>.4&&(I=M.latitude,A=M.longitude)}}if(I!==void 0&&A!==void 0){const H=U(C.latitude,C.longitude,I,A);let M=0;H<500?M=1:H<2e3?M=.8:H<5e3?M=.5:H<1e4?M=.3:M=.1,M*=E,C.srcGeoEvidenceScore+=M,C.srcGeoEvidenceCount++}}}}if(a>0){const r=n[a-1];C.adjacentPrefixCounts.set(r,(C.adjacentPrefixCounts.get(r)||0)+1),C.totalAdjacentObservations++}if(a<n.length-1){const r=n[a+1];C.adjacentPrefixCounts.set(r,(C.adjacentPrefixCounts.get(r)||0)+1),C.totalAdjacentObservations++}}}}let m=1,w=1;for(const h of g.values())for(const e of h)m=Math.max(m,e.totalAppearances),w=Math.max(w,e.totalAdjacentObservations);for(const h of g.values())for(const e of h){if(e.totalAppearances>0){let n=0,f=1;for(let y=0;y<k;y++)e.positionCounts[y]>n&&(n=e.positionCounts[y],f=y+1);e.typicalPosition=f,e.positionConsistency=n/e.totalAppearances;const c=e.totalAppearances/m;e.positionScore=e.positionConsistency*.6+c*.4}if(e.totalAdjacentObservations>0&&(e.cooccurrenceScore=e.totalAdjacentObservations/w),e.combinedScore=e.positionScore*Y.position+e.cooccurrenceScore*Y.cooccurrence+e.geographicScore*Y.geographic+e.recencyScore*Y.recency,e.srcGeoEvidenceCount>0){const n=e.srcGeoEvidenceScore/e.srcGeoEvidenceCount,f=Math.min(e.srcGeoEvidenceCount/50,1),c=n*f*.3;e.combinedScore+=c}}for(const[h,e]of g){e.sort((a,u)=>u.combinedScore-a.combinedScore);const n=e.length>0?e[0].hash:null;let f=0;if(e.length===1)f=1;else if(e.length>1){const a=e[0].combinedScore,u=e[1].combinedScore;a>0&&(f=Math.min(1,(a-u)/a)),e[0].totalAppearances>e[1].totalAppearances*2&&(f=Math.min(1,f+.2));const b=0,P=e[0].positionCounts[b]||0,O=e[1].positionCounts[b]||0,C=P+O;if(C>=20&&P>=10){const A=P/C;if(A>=.8){const E=.3+(A-.8)*1.5;f=Math.min(1,f+E)}}const r=e.reduce((A,E)=>A+E.combinedScore,0);if(r>0){const A=[],E=e.reduce((S,T)=>S+(T.positionCounts[0]||0),0);for(const S of e){const T=S.combinedScore/r,x=E*T;A.push(x)}const H=A[0],M=A[1]||0,_=H+M;if(_>=20&&H>=10){const S=H/_;if(S>=.6){const T=.2+(S-.6)*1;f=Math.min(1,f+T)}}}const N=e[0].srcGeoEvidenceScore,D=e[1].srcGeoEvidenceScore;if(e[0].srcGeoEvidenceCount>=10&&N>D*1.5){const A=D>0?N/(N+D):1,E=Math.min(.3,(A-.5)*.6);f=Math.min(1,f+E)}}const c=new Map;for(let a=1;a<=k;a++){const u=[...e].sort((b,P)=>{const O=b.positionCounts[a-1]||0;return(P.positionCounts[a-1]||0)-O});if(u.length>0&&u[0].positionCounts[a-1]>0){const b=u[0];let P=1;if(u.length>1){const O=b.positionCounts[a-1],C=u[1].positionCounts[a-1]||0,r=O+C;P=r>0?O/r:0}c.set(a,{hash:b.hash,confidence:P})}}const y={prefix:h,candidates:e,bestMatch:n,confidence:f,isUnambiguous:e.length===1,bestMatchForPosition:c};s.set(h,y)}return s}function Ge(o,d,t){const i=d.toUpperCase(),l=o.get(i);if(!l||l.candidates.length===0)return{hash:null,confidence:0};if(t!=null&&t.isLastHop)return{hash:l.bestMatch,confidence:l.confidence};if((t==null?void 0:t.position)===1)return{hash:l.bestMatch,confidence:l.confidence};if(t!=null&&t.position&&l.bestMatchForPosition.has(t.position)){const s=l.bestMatchForPosition.get(t.position),v=Math.max(s.confidence,l.confidence);return{hash:s.hash,confidence:v}}if(t!=null&&t.adjacentPrefixes&&t.adjacentPrefixes.length>0){let s=l.bestMatch,v=0;for(const g of l.candidates){let p=0;for(const w of t.adjacentPrefixes)p+=g.adjacentPrefixCounts.get(w.toUpperCase())||0;const m=g.combinedScore+p/Math.max(1,g.totalAdjacentObservations)*.3;m>v&&(v=m,s=g.hash)}return{hash:s,confidence:l.confidence}}return{hash:l.bestMatch,confidence:l.confidence}}function ge(o,d,t){const i=new Map;for(const s of o){if(!s._advertSender)continue;const v=d.get(s._advertSender);if(!v)continue;const g=L(v);if(!t.has(g))continue;let p=i.get(v);p||(p={hash:v,advertCount:0,forwarderPrefixes:new Map,totalForwarderObservations:0},i.set(v,p)),p.advertCount++;const m=s.original_path??s.forwarded_path;if(m&&Array.isArray(m))for(const w of m){const h=String(w).toUpperCase().slice(0,2);if(h.length<2||h===g)continue;const e=p.forwarderPrefixes.get(h)||0;p.forwarderPrefixes.set(h,e+1),p.totalForwarderObservations++}}const l=new Map;for(const s of i.values()){const v=L(s.hash),g=l.get(v)||[];g.push(s),l.set(v,g)}return l}function me(o,d,t){const i=(t==null?void 0:t.recencyDecayHours)??Q,l=(t==null?void 0:t.zeroHopDecayHours)??ee,s=new Map,v=new Map;for(const e of Object.keys(d)){const n=(e.startsWith("0x")?e.slice(2):e).toLowerCase();v.set(n,e)}const g=new Map;for(const[e,n]of Object.entries(d)){const f=L(e),c=g.get(f)||[];c.push({hash:e,info:n}),g.set(f,c)}const p=new Set;for(const[e,n]of g)n.length===1?s.set(e,n[0].hash):p.add(e);if(p.size===0)return{resolver:s,topologyProfiles:new Map};const m=new Map,w=Math.floor(Date.now()/1e3);for(const e of p){const n=new Map;for(const f of g.get(e)){let c=0;const y=f.info.last_seen??0;if(f.info.zero_hop&&y>0){const a=(w-y)/3600;c+=50*Math.exp(-a/l)}if(y>0){const a=(w-y)/3600;c+=Math.exp(-a/i)*20}f.info.latitude&&f.info.longitude&&(f.info.latitude!==0||f.info.longitude!==0)&&(c+=5),n.set(f.hash,c)}m.set(e,n)}for(const e of o){if((e.type??e.payload_type)!==X.ADVERT||!e.src_hash)continue;const n=L(e.src_hash);if(!p.has(n))continue;const f=e._advertLatitude,c=e._advertLongitude;if(f!=null&&c!=null&&(f!==0||c!==0)){const y=g.get(n),a=m.get(n);for(const u of y){if(!u.info.latitude||!u.info.longitude||u.info.latitude===0&&u.info.longitude===0)continue;const b=U(f,c,u.info.latitude,u.info.longitude);b<$.VERY_CLOSE?a.set(u.hash,(a.get(u.hash)||0)+10):b<$.CLOSE?a.set(u.hash,(a.get(u.hash)||0)+5):b<$.FAR&&a.set(u.hash,(a.get(u.hash)||0)+1)}}if(e._advertName){const y=e._advertName.trim().toLowerCase();if(y){const a=g.get(n),u=m.get(n);for(const b of a){const P=(b.info.name||b.info.node_name||"").trim().toLowerCase();P&&P===y&&u.set(b.hash,(u.get(b.hash)||0)+15)}}}}const h=ge(o,v,p);for(const e of p){const n=h.get(e);if(!n)continue;const f=m.get(e);for(const c of n){let y=0;y+=Math.min(c.advertCount*2,30),y+=Math.min(c.forwarderPrefixes.size*3,15),f.set(c.hash,(f.get(c.hash)||0)+y)}}for(const e of o){if((e.type??e.payload_type)===X.ADVERT||!e.src_hash)continue;const n=L(e.src_hash);if(!p.has(n))continue;const f=h.get(n);if(!f||f.length<2)continue;const c=e.original_path??e.forwarded_path;if(!c||!Array.isArray(c)||c.length===0)continue;const y=new Set;for(const u of c){const b=String(u).toUpperCase().slice(0,2);b.length>=2&&b!==n&&y.add(b)}if(y.size===0)continue;const a=m.get(n);for(const u of f){if(u.totalForwarderObservations===0)continue;let b=0;for(const P of y)u.forwarderPrefixes.has(P)&&b++;if(b>0){const O=b/y.size*3;a.set(u.hash,(a.get(u.hash)||0)+O)}}}for(const e of p){const n=m.get(e);let f=null,c=-1/0;for(const[y,a]of n)a>c&&(c=a,f=y);f&&s.set(e,f)}return{resolver:s,topologyProfiles:h}}function te(o){if(!o||o.length<6)return null;const d=o,t=parseInt(d.slice(0,2),16);if(isNaN(t))return null;const i=t&3;let l=2;if((i===0||i===3)&&(l=10),l+2>d.length)return null;const s=parseInt(d.slice(l,l+2),16);if(isNaN(s)||(l+=2+s*2,l>=d.length))return null;const v=d.slice(l);return v.length>=38?v.slice(0,38):v}function J(o,d="name-only"){const t=o.decoded;if(!t||!t.decrypted)return null;if(t.macCorrupted)switch(d){case"strict":return null;case"name-only":return{senderName:t.senderName||null,channelName:t.channelName||null,channelHash:t.channelHash||null,text:null,corrupted:!0,decrypted:!0}}return{senderName:t.senderName||null,channelName:t.channelName||null,channelHash:t.channelHash||null,text:t.text||null,corrupted:!!t.macCorrupted,decrypted:!0}}function ye(o,d){var l;const t=new Map,i=new Map;for(const s of o){const v=s.payload_type??s.type;if(v!==X.GRP_TXT)continue;const g=d.get(s.packet_hash);if(!((l=g==null?void 0:g.decoded)!=null&&l.decrypted)||g.decoded.macCorrupted)continue;const p=s._payloadHexPrefix??te(s.raw_packet);p&&!t.has(p)&&t.set(p,g);const m=s.payload_length??s.length??0,w=Math.floor((s.timestamp??0)/60),h=`${v}:${m}:${w}`;i.has(h)||i.set(h,g)}return{byPayload:t,byApprox:i}}function ve(o,d,t,i="name-only"){const l=o.payload_type??o.type;if(l!==X.GRP_TXT)return null;const s=d.get(o.packet_hash);if(s)return J(s,i);const v=o._payloadHexPrefix??te(o.raw_packet),g=(v?t.byPayload.get(v):null)??t.byApprox.get(`${l}:${o.payload_length??o.length??0}:${Math.floor((o.timestamp??0)/60)}`);return g?J(g,i):null}function _e(o){return o.name||o.node_name||null}function R(o,d,t,i,l,s,v){return{hash:o,type:d,name:t,isRepeater:d==="repeater",isCompanion:d==="companion",confident:i,advertObservations:l,topologyNeighborCount:s,topologyAffinity:v}}const oe=Object.freeze(R(null,"unknown",null,!1,0,0,0)),Se=5,ne={disambiguationEnabled:!0,recencyDecayHours:12,zeroHopDecayHours:72,confidenceThreshold:.6,macCorruptedPolicy:"name-only"};function we(o){const d=new Map,t=new Map,i=new Map,l=new Map,s=new Map,v=new Map,g=new Map;for(const[w,h]of Object.entries(o)){const n=fe(h).type;d.set(w,n);const f=(w.startsWith("0x")?w.slice(2):w).toLowerCase();t.set(f,w);const c=L(w),y=_e(h);let a=i.get(c);a||(a=[],i.set(c,a)),a.push({hash:w,name:y,type:n});const u=l.get(c)||{repeaters:0,others:0};if(n==="repeater"?u.repeaters++:u.others++,l.set(c,u),y){v.set(w,y);const b=y.toLowerCase(),P=g.get(b)??0,O=h.last_seen??0;(!s.has(b)||O>P)&&(s.set(b,w),g.set(b,O))}}const p=new Set,m=new Set;for(const[w,h]of l)h.repeaters>0&&h.others>0&&p.add(w),(h.repeaters>=2||h.others>=2)&&m.add(w);return{hashToType:d,pubKeyMap:t,prefixIndex:i,crossClassPrefixes:p,sameClassAmbiguous:m,nameToHash:s,hashToName:v}}function be(o,d,t,i){const l=new Map(d),s=new Map,v=new Map,g=new Map,p=new Map;for(const m of o){if(m._advertNodeType==null&&!m._advertName)continue;const w=m._advertSender;if(m._advertNodeType!=null){let h;if(w&&(h=t.get(w)),!h&&m.src_hash&&l.has(m.src_hash)&&(h=m.src_hash),h){const e=l.get(h);if(!e||e==="unknown"){const n=K(m._advertNodeType);n!=="unknown"&&l.set(h,n)}}}if(m._advertName&&w){const h=t.get(w)??w,e=m.timestamp??0,n=m._advertName.toLowerCase();if(!i.has(n)){const c=g.get(n)??0;(!s.has(n)||e>c)&&(s.set(n,h),g.set(n,e))}const f=p.get(h)??0;(!v.has(h)||e>f)&&(v.set(h,m._advertName),p.set(h,e))}}return{extendedHashToType:l,advertNameToHash:s,advertHashToName:v}}function Ce(o,d,t,i,l){var m;const s=new Map,v=new Map;if(d.size===0)return{decryptedNameToHash:s,decryptedHashToName:v};const{prefixIndex:g,nameToHash:p}=t;for(const w of o){if((w.type??w.payload_type)!==Se)continue;const e=d.get(w.packet_hash);if(!((m=e==null?void 0:e.decoded)!=null&&m.decrypted)||e.decoded.macCorrupted)continue;const n=e.decoded.senderName;if(!n)continue;const f=w.src_hash;if(!f)continue;const c=L(f);let y=l.get(c);if(!y){const u=g.get(c);(u==null?void 0:u.length)===1&&(y=u[0].hash)}if(!y&&f.length>4&&(y=f),!y)continue;const a=n.toLowerCase();!p.has(a)&&!i.has(a)&&s.set(a,y),v.has(y)||v.set(y,n)}return{decryptedNameToHash:s,decryptedHashToName:v}}function Me(o,d,t,i,l,s,v,g,p,m,w){var D,I,A,E,H,M;const h=o.src_hash,e=g==null?void 0:g.get(o.packet_hash),n=((D=e==null?void 0:e.decoded)==null?void 0:D.senderName)??null,{nameToHash:f}=d;if(!h){const _=o.type??o.payload_type,S=V(_),T=o._advertName??null;if(n){const x=n.toLowerCase(),F=f.get(x)??i.get(x)??p.get(x);if(F){const j=t.get(F)??S;return R(F,j,n,!0)}return R(null,S!=="unknown"?S:"companion",n,!1)}if(S!=="unknown")return R(null,S,T,!1);if(o._advertNodeType!=null){const x=K(o._advertNodeType);if(x!=="unknown")return R(null,x,T,!1)}return T?R(null,"unknown",T,!1):oe}const c=o.type??o.payload_type??-1,y=o._advertSender?`${h}\0${o._advertSender}`:`${h}\0${c}\0${n??""}`,a=w.get(y);if(a)return a;const u=L(h),{pubKeyMap:b,prefixIndex:P,crossClassPrefixes:O,sameClassAmbiguous:C}=d;let r;if(o._advertSender){const _=b.get(o._advertSender);if(_){const S=t.get(_)??"unknown",T=(I=P.get(u))==null?void 0:I.find(x=>x.hash===_);r=R(_,S,(T==null?void 0:T.name)??null,!0)}}if(!r&&n){const _=P.get(u),S=_==null?void 0:_.find(T=>{var x;return((x=T.name)==null?void 0:x.toLowerCase())===n.toLowerCase()});if(S){const T=t.get(S.hash)??S.type;r=R(S.hash,T,S.name,!0)}else{const T=n.toLowerCase(),x=f.get(T)??i.get(T)??p.get(T);if(x){const F=t.get(x)??"unknown",j=(A=P.get(L(x)))==null?void 0:A.find(z=>z.hash===x);r=R(x,F,(j==null?void 0:j.name)??n,!0)}}}if(!r&&O.has(u)){const _=V(o.type??o.payload_type);if(_!=="unknown"){const S=(E=P.get(u))==null?void 0:E.find(T=>T.type===_);S&&(r=R(S.hash,_,S.name,!0))}if(!r){const S=P.get(u),T=s.get(u),x=T?S==null?void 0:S.find(z=>z.hash===T):S==null?void 0:S[0],F=x?t.get(x.hash)??x.type:"unknown",j=!!T&&!!x&&x.hash===T;r=R((x==null?void 0:x.hash)??null,F,(x==null?void 0:x.name)??null,j)}}if(!r){const _=s.get(u);if(_){const S=t.get(_)??"unknown",T=(H=P.get(u))==null?void 0:H.find(x=>x.hash===_);r=R(_,S,(T==null?void 0:T.name)??null,!0)}}if(!r&&C.has(u)){const _=(M=P.get(u))==null?void 0:M[0];r=R((_==null?void 0:_.hash)??null,(_==null?void 0:_.type)??"unknown",(_==null?void 0:_.name)??null,!1)}if(!r){const _=P.get(u);if((_==null?void 0:_.length)===1){const S=_[0];r=R(S.hash,S.type,S.name,!0)}else r=R(null,V(c),null,!1)}const N=V(c);if(N!=="unknown"&&N!==r.type&&(r=R(r.hash,N,r.name,r.confident)),r.type==="unknown"&&o._advertNodeType!=null){const _=K(o._advertNodeType);_!=="unknown"&&(r=R(r.hash,_,r.name,r.confident))}if(r.hash){const _=v.get(u);if(_){const S=_.find(T=>T.hash===r.hash);if(S){let T=0;const x=o.original_path??o.forwarded_path;if(x&&Array.isArray(x)&&x.length>0&&S.totalForwarderObservations>0){const F=new Set;for(const j of x){const z=String(j).toUpperCase().slice(0,2);z.length>=2&&z!==u&&F.add(z)}if(F.size>0){let j=0;for(const z of F)S.forwarderPrefixes.has(z)&&j++;T=j/F.size}}r=R(r.hash,r.type,r.name,r.confident,S.advertCount,S.forwarderPrefixes.size,T)}}}if(r.name===null&&r.hash){const _=d.hashToName.get(r.hash)??l.get(r.hash)??m.get(r.hash)??null;_&&(r=R(r.hash,r.type,_,r.confident,r.advertObservations,r.topologyNeighborCount,r.topologyAffinity))}return w.set(y,r),r}const Te={hashToType:new Map,pubKeyMap:new Map,prefixIndex:new Map,crossClassPrefixes:new Set,sameClassAmbiguous:new Set,nameToHash:new Map,hashToName:new Map},xe={byPayload:new Map,byApprox:new Map},G=ce((o,d)=>({config:ne,neighborContext:Te,extendedHashToType:new Map,advertNameToHash:new Map,advertHashToName:new Map,resolverMap:new Map,topologyProfiles:new Map,decryptedNameToHash:new Map,decryptedHashToName:new Map,srcHashResolverMap:new Map,contentInheritanceIndex:xe,_cache:new Map,_neighborFingerprint:"",_resolverFingerprint:"",_advertScanFingerprint:"",_decodedNameFingerprint:"",_inheritanceFingerprint:"",_decodedContentVersion:0,resolveSource:t=>{const i=d();return i.config.disambiguationEnabled?Me(t,i.neighborContext,i.extendedHashToType,i.advertNameToHash,i.advertHashToName,i.resolverMap,i.topologyProfiles,B,i.decryptedNameToHash,i.decryptedHashToName,i._cache):oe},getDecodedContent:t=>{const i=d();return ve(t,B,i.contentInheritanceIndex,i.config.macCorruptedPolicy)},setConfig:t=>{const i={...d().config,...t};o({config:i,_cache:new Map}),W==null||W()},recompute:(t,i,l)=>{const s=d(),{config:v}=s,g=`${Object.keys(i).length}`;let p=s.neighborContext;g!==s._neighborFingerprint&&(p=we(i));const m=Math.floor(t.length/50)*50,w=`${g}:${m}`;let h=s.extendedHashToType,e=s.advertNameToHash,n=s.advertHashToName;if(w!==s._advertScanFingerprint||g!==s._neighborFingerprint){const N=be(t,p.hashToType,p.pubKeyMap,p.nameToHash);h=N.extendedHashToType,e=N.advertNameToHash,n=N.advertHashToName}const f=`${Object.keys(i).length}:${m}:${p.crossClassPrefixes.size}:${v.recencyDecayHours}:${v.zeroHopDecayHours}`;let c=s.resolverMap,y=s.topologyProfiles;if(f!==s._resolverFingerprint){const N=me(t,i,{recencyDecayHours:v.recencyDecayHours,zeroHopDecayHours:v.zeroHopDecayHours});c=N.resolver,y=N.topologyProfiles}const a=Math.floor(l.size/20)*20,u=`${m}:${a}:${f}`;let b=s.decryptedNameToHash,P=s.decryptedHashToName;if(u!==s._decodedNameFingerprint){const N=Ce(t,l,p,e,c);b=N.decryptedNameToHash,P=N.decryptedHashToName}const O=new Map(c);for(const[N,D]of b){const I=L(D),A=p.prefixIndex.get(I);if(!A||A.length<=1)continue;const E=A.find(H=>{var M;return((M=H.name)==null?void 0:M.toLowerCase())===N});E&&O.get(I)!==E.hash&&O.set(I,E.hash)}for(const[N,D]of e){const I=L(D),A=p.prefixIndex.get(I);if(!A||A.length<=1)continue;const E=A.find(H=>{var M;return((M=H.name)==null?void 0:M.toLowerCase())===N});E&&O.get(I)!==E.hash&&O.set(I,E.hash)}const C=`${m}:${a}`;let r=s.contentInheritanceIndex;C!==s._inheritanceFingerprint&&(r=ye(t,l)),ie(O),q.active&&q.emit("pipeline:disambig:recompute",{packets:t.length,neighbors:Object.keys(i).length,decoded:l.size}),o({neighborContext:p,extendedHashToType:h,advertNameToHash:e,advertHashToName:n,resolverMap:c,topologyProfiles:y,decryptedNameToHash:b,decryptedHashToName:P,srcHashResolverMap:O,contentInheritanceIndex:r,_cache:new Map,_neighborFingerprint:g,_resolverFingerprint:f,_advertScanFingerprint:w,_decodedNameFingerprint:u,_inheritanceFingerprint:C,_decodedContentVersion:s._decodedContentVersion+1})}}));let B=new Map,W=null;if(typeof window<"u"){let o=function(){v&&clearTimeout(v),v=setTimeout(()=>{var n;if(v=null,!d||!t)return;const p=d.useStore.getState(),m=t.useDecodedMessagesStore.getState(),w=p.packets,h=((n=p.stats)==null?void 0:n.neighbors)??{},e=m.stableMessages;G.getState().recompute(w,h,e)},g)},d=null,t=null,i=[],l,s=new Map,v=null;const g=150;W=o,setTimeout(()=>{Z(()=>import("./index-C8IY8K2r.js").then(p=>p.fW),__vite__mapDeps([0,1])).then(p=>{var h,e;d=p,p.useStore.subscribe(n=>{var y,a;const f=n.packets!==i,c=((y=n.stats)==null?void 0:y.neighbors)!==l;(f||c)&&(i=n.packets,l=(a=n.stats)==null?void 0:a.neighbors,o())});const m=p.useStore.getState();i=m.packets,l=(h=m.stats)==null?void 0:h.neighbors;const w=((e=m.stats)==null?void 0:e.neighbors)??{};(i.length>0||Object.keys(w).length>0)&&G.getState().recompute(i,w,new Map)}),Z(()=>import("./index-C8IY8K2r.js").then(p=>p.fV),__vite__mapDeps([0,1])).then(p=>{t=p,B=p.useDecodedMessagesStore.getState().messages,p.useDecodedMessagesStore.subscribe(m=>{m.messages!==B&&(B=m.messages),m.stableMessages!==s&&(s=m.stableMessages,o())})})},0)}const He=G;function Pe(){return G(o=>o.resolveSource)}function Ne(){return G(o=>o.neighborContext)}function Ae(){return G(o=>o.topologyProfiles)}function Ee(){return G(o=>o.advertNameToHash)}function Oe(){const o=G(t=>t.getDecodedContent),d=G(t=>t._decodedContentVersion);return re.useCallback(t=>o(t),[o,d])}function De(){return G(o=>o.config)}function Ie(){return G(o=>o.srcHashResolverMap)}const ze=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_PIPELINE_CONFIG:ne,useAdvertNameToHash:Ee,useGetDecodedContent:Oe,useNeighborContext:Ne,usePipelineConfig:De,usePipelineStore:He,useResolveSource:Pe,useSrcHashResolverMap:Ie,useTopologyProfiles:Ae},Symbol.toStringTag,{value:"Module"}));export{Pe as a,je as b,He as c,ze as d,le as f,Ge as r,Oe as u};
