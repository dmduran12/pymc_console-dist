import{c as e,am as t,c8 as s,c9 as n,aR as a,el as i,em as o,a8 as l,en as r,a9 as c,m as h,q as u,L as f}from"./index-C66hrd0t.js";import{c as m}from"./geo-utils-DJn8DnxF.js";import{r as d,j as g,c as p}from"./vendor-react-Co0R0q1H.js";import{D as y}from"./download-B2IRqEGX.js";import{D as x}from"./database-D5Q6aY4M.js";const b=e("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),j=e("ghost",[["path",{d:"M9 10h.01",key:"qbtxuw"}],["path",{d:"M15 10h.01",key:"1qmjsl"}],["path",{d:"M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z",key:"uwwb07"}]]),v=e("git-branch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]),k=e("grip-vertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),w=e("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]),M=e("minimize-2",[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]]);class N{constructor(){this.componentControls=new Set}subscribe(e){return this.componentControls.add(e),()=>this.componentControls.delete(e)}start(e,t){this.componentControls.forEach(s=>{s.start(e.nativeEvent||e,t)})}cancel(){this.componentControls.forEach(e=>{e.cancel()})}stop(){this.componentControls.forEach(e=>{e.stop()})}}const C=()=>new N;function A(){return t(C)}const H={hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1,transition:{type:"spring",stiffness:400,damping:15}},exit:{opacity:0,scale:.9,transition:{duration:n.fast}}},q={hidden:{opacity:0,y:"100%"},visible:{opacity:1,y:0,transition:{type:"spring",stiffness:400,damping:30}},exit:{opacity:0,y:"100%",transition:{duration:n.medium,ease:s.easeIn}}};function z(e,t){let s=0;for(let n=0;n<e.length;n++)s+=e[n]*t[n];return s}function L(e){const t=function(e){return Math.sqrt(z(e,e))}(e);if(t>0)for(let s=0;s<e.length;s++)e[s]/=t}function T(e,t){const s=z(e,t);for(let n=0;n<e.length;n++)e[n]-=s*t[n]}function V(e,t){const s=e.length,n=new Array(s).fill(0);for(let a=0;a<s;a++)for(let i=0;i<s;i++)n[a]+=e[a][i]*t[i];return n}function D(e){const t=Math.exp(-e/30);return Math.max(.05,t)}function E(e){const t=e.length,s=Array(t).fill(null).map(()=>Array(t).fill(0));for(let n=0;n<t;n++){let a=0;for(let i=0;i<t;i++)a+=e[n][i],s[n][i]=-e[n][i];s[n][n]=a}return s}function S(e){const t=e.length,s=Array(t).fill(1/Math.sqrt(t));let n=0;for(let l=0;l<t;l++){let s=0;for(let n=0;n<t;n++)s+=Math.abs(e[l][n]);n=Math.max(n,s)}const a=Array(t).fill(null).map(()=>Array(t).fill(0));for(let l=0;l<t;l++){for(let s=0;s<t;s++)a[l][s]=-e[l][s];a[l][l]=n+a[l][l]}let i=Array(t).fill(0).map((e,t)=>43758.5453*Math.sin(12.9898*t)%1-.5);T(i,s),L(i);let o=0;for(let l=0;l<100;l++){const e=V(a,i);T(e,s);const t=z(e,e)/z(i,e);if(L(e),i=e,Math.abs(t-o)<1e-8)return{vector:i,eigenvalue:n-t};o=t}return{vector:i,eigenvalue:n-o}}function P(e,t){if(e.length<2)return 0;const s=[];for(const o of e){const e=t.get(o);e&&s.push(e)}if(s.length<2)return 0;const n=Math.min(s.length,20),a=s.length<=n?s:function(e,t){if(t>=e.length)return e;const s=[],n=e.length/t;for(let a=0;a<t;a++)s.push(e[Math.floor(a*n)]);return s}(s,n);let i=0;for(let o=0;o<a.length;o++)for(let e=o+1;e<a.length;e++){const t=m(a[o][0],a[o][1],a[e][0],a[e][1])/1e3;i=Math.max(i,t)}return i}function F(e,t,s,n){const a=t.length;if(a<3)return null;const i=new Set(t),o=e.filter(e=>i.has(e.fromHash)&&i.has(e.toHash));if(0===o.length)return null;const l=function(e,t,s,n){const a=t.length,i=new Map(t.map((e,t)=>[e,t])),o=Array(a).fill(null).map(()=>Array(a).fill(0));for(const l of e){const e=i.get(l.fromHash),t=i.get(l.toHash);if(void 0!==e&&void 0!==t&&e!==t){const a=l.strength*l.certainCount;let i=1;if(s){const e=s.get(l.fromHash),t=s.get(l.toHash);e&&t&&(i=D(m(e[0],e[1],t[0],t[1])/1e3))}let r=1;if(n){const e=[l.fromHash,l.toHash].sort().join("-");r=1-.7*(n.get(e)??0)}const c=.3+.7*(l.symmetryRatio??0),h=Math.pow(a,.7)*Math.pow(i,.3)*r*c;o[e][t]=h,o[t][e]=h}}return o}(o,t,s,n),r=E(l),{vector:c,eigenvalue:h}=S(r);if(h<.001)return null;const u=[],f=[];for(let m=0;m<a;m++)c[m]<0?u.push(t[m]):f.push(t[m]);return u.length<5||f.length<5?null:{group0:u,group1:f,fiedlerValue:h}}function R(e,t,s,n){const a=t.length;if(a<3)return{communities:new Map([[0,t]]),nodePartitions:t.map(e=>({hash:e,community:0,fiedlerValue:0})),numCommunities:1,fiedlerValue:0,isConnected:a<=1};const i=[];let o=1/0;const l=[[t,0]];for(;l.length>0;){const[t,a]=l.shift();if((s?P(t,s):0)>20&&a<4&&t.length>=10){const i=F(e,t,s,n);if(i){o=Math.min(o,i.fiedlerValue),l.push([i.group0,a+1]),l.push([i.group1,a+1]);continue}}i.push(t)}const r=new Map,c=[],h=new Map;for(let u=0;u<i.length;u++){r.set(u,i[u]);for(const e of i[u])h.set(e,u)}for(const u of t)c.push({hash:u,community:h.get(u)??0,fiedlerValue:0});return{communities:r,nodePartitions:c,numCommunities:i.length,fiedlerValue:o===1/0?0:o,isConnected:!0}}function $(e){const t=["rgba(139, 92, 246, 0.25)","rgba(16, 185, 129, 0.25)","rgba(245, 158, 11, 0.25)","rgba(239, 68, 68, 0.25)","rgba(59, 130, 246, 0.25)","rgba(236, 72, 153, 0.25)","rgba(20, 184, 166, 0.25)","rgba(249, 115, 22, 0.25)"];return t[e%t.length]}function O(e,t){if(t.length<3)return 0;const s=t.length,n=new Map(t.map((e,t)=>[e,t])),a=Array(s).fill(null).map(()=>Array(s).fill(0));for(const l of e){const e=n.get(l.fromHash),t=n.get(l.toHash);void 0!==e&&void 0!==t&&e!==t&&(a[e][t]=1,a[t][e]=1)}const i=E(a),{eigenvalue:o}=S(i);return Math.max(0,o)}function B(e){const t=["rgba(139, 92, 246, 0.6)","rgba(16, 185, 129, 0.6)","rgba(245, 158, 11, 0.6)","rgba(239, 68, 68, 0.6)","rgba(59, 130, 246, 0.6)","rgba(236, 72, 153, 0.6)","rgba(20, 184, 166, 0.6)","rgba(249, 115, 22, 0.6)"];return t[e%t.length]}function G({label:e,icon:t,status:s,detail:n}){return g.jsxs("div",{className:p("flex items-center gap-3 py-3 px-4 radius-inset transition-base","active"===s&&"bg-sys-blue/10","complete"===s&&"bg-sys-blue/10 ring-2 ring-inset ring-sys-blue","pending"===s&&"opacity-40"),children:[g.jsx("div",{className:p("w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 transition-all duration-300","active"===s&&"bg-sys-blue/20","complete"===s&&"bg-sys-blue/20","pending"===s&&"bg-subtle-fill"),children:"complete"===s?g.jsx(u,{className:"w-4 h-4 text-sys-blue"}):"active"===s?g.jsx(f,{className:"w-4 h-4 animate-spin text-sys-blue"}):g.jsx("span",{className:"text-fg-muted",children:t})}),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("div",{className:p("text-sm font-medium transition-colors","active"===s&&"text-sys-blue","complete"===s&&"text-sys-blue","pending"===s&&"text-fg-muted"),children:e}),n&&"pending"!==s&&g.jsx("div",{className:"text-xs text-fg-muted mt-0.5 truncate",children:n})]})]})}const I=d.memo(function({isOpen:e,onClose:t}){const{packetCacheState:s,triggerDeepAnalysis:n}=a(),f=i(),m=o(),p=s.packetCount,[b,k]=d.useState("fetching");d.useEffect(()=>{e&&n()},[e,n]),d.useEffect(()=>{if(e)if(s.isTopologyLoading)k("fetching");else if(f)k("analyzing"),setTimeout(()=>k("building"),500),setTimeout(()=>k("discovering"),1e3);else if(m>0&&!s.isTopologyLoading){k("complete");const e=setTimeout(()=>{t()},1500);return()=>clearTimeout(e)}},[e,s.isTopologyLoading,f,m,t]);const w="complete"===b,M=s.loadProgress,N=d.useMemo(()=>M&&M.target>0?`Loading... ${(M.loaded/1e3).toFixed(1)}k / ${(M.target/1e3).toFixed(1)}k packets (${M.percent}%)`:p>0?`${p.toLocaleString()} packets loaded`:"Connecting to database...",[M,p]),C=e=>{const t=["fetching","analyzing","building","discovering","complete"],s=t.indexOf(b),n=t.indexOf(e);return n<s?"complete":n===s?"active":"pending"},A=w?t:()=>{};return g.jsx(l,{open:e,onClose:A,size:"sm",bottomSheet:!1,children:g.jsx(r,{isLoading:!w,borderRadius:16,children:g.jsx(c,{className:"p-6 radius-card overflow-hidden",children:w?g.jsxs("div",{className:"flex flex-col items-center py-6",children:[g.jsx(h.div,{variants:H,initial:"hidden",animate:"visible",className:"w-16 h-16 rounded-full flex items-center justify-center mb-4 bg-sys-blue/20",children:g.jsx(u,{className:"w-8 h-8 text-sys-blue"})}),g.jsx("h3",{className:"type-micro text-sys-blue",children:"Ready!"}),g.jsx("button",{onClick:t,className:"mt-3 sm:hidden min-h-[44px] min-w-[44px] px-4 flex items-center justify-center text-[15px] font-medium text-sys-blue active:text-sys-blue/70 transition-base radius-inner active:bg-subtle-fill",children:"Done"})]}):g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[g.jsx("div",{className:"w-10 h-10 radius-inset flex items-center justify-center bg-sys-blue/15",children:g.jsx(v,{className:"w-5 h-5 text-sys-blue"})}),g.jsxs("div",{children:[g.jsx("h3",{className:"type-micro",children:"Deep Analysis"}),g.jsx("p",{className:"text-xs text-fg-muted",children:"Building mesh topology"})]})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsx(G,{label:"Fetching Packets",icon:g.jsx(y,{className:"w-4 h-4"}),status:C("fetching"),detail:N}),g.jsx(G,{label:"Analyzing Database",icon:g.jsx(x,{className:"w-4 h-4"}),status:C("analyzing"),detail:"Processing packet paths"}),g.jsx(G,{label:"Building Topology",icon:g.jsx(v,{className:"w-4 h-4"}),status:C("building"),detail:"Computing mesh edges"}),g.jsx(G,{label:"Discovering Nodes",icon:g.jsx(j,{className:"w-4 h-4"}),status:C("discovering"),detail:"Viterbi HMM ghost detection"})]}),g.jsx("p",{className:"text-xs text-fg-muted text-center mt-5",children:"This may take a few seconds..."})]})})})})});export{I as D,b as E,k as G,w as M,M as a,j as b,O as c,v as d,$ as e,R as f,B as g,q as s,A as u};
