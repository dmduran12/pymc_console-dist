import{P as z,c as B,e as N,f as D}from"./payload-decoders-CXnzAzcz.js";import{a8 as V,a7 as O,ae as h,cr as S,Q as f,cb as R,cc as M,cd as A}from"./index-B4woLUMa.js";import{j as o,r as j}from"./vendor-react-CHg3w57L.js";function E(e){const t=e&3,n=e>>2&15,s=e>>6&3;return[{bits:"0-1",field:"Route Type",value:V(t),binary:(t&3).toString(2).padStart(2,"0")},{bits:"2-5",field:"Payload Type",value:O(n),binary:(n&15).toString(2).padStart(4,"0")},{bits:"6-7",field:"Version",value:s.toString(),binary:(s&3).toString(2).padStart(2,"0")}]}function Y(e){if(!e||e.length<4)return null;const t=z.fromHex(e);if(!t.success||!t.packet)return null;const n=t.packet,s=E(n.header),a=e.slice(0,2);let r=2,i="";n.hasTransportCodes()&&(i=e.slice(2,10),r=10);const c=e.slice(r,r+2),p=r+2,x=p+n.pathLen*2,g=e.slice(p,x),u=e.slice(x),m=B(n),l=Math.floor(r/2),d=Math.floor(p/2);return{packet:n,headerHex:a,headerFields:s,transportCodesHex:i,pathLengthHex:c,pathDataHex:g,payloadHex:u,pathLenByteOffset:l,pathByteOffset:d,payloadStartByte:Math.floor(x/2),decoded:m}}function q(e){if(!e||e.length<8)return null;const t=parseInt(e.slice(0,2),16),n=parseInt(e.slice(2,4),16),s=parseInt(e.slice(4,6),16),a=parseInt(e.slice(6,8),16);return isNaN(t)||isNaN(n)||isNaN(s)||isNaN(a)?null:((t|n<<8|s<<16|a<<24)>>>0).toString(16).toUpperCase().padStart(8,"0")}function L(e){return e>=10?"excellent":e>=5?"good":e>=0?"fair":e>=-5?"poor":"critical"}function U(e){if(e._traceSnrPath!=null&&e._traceSnrPath.length>0)return e._traceSnrPath;if(e.raw_packet){const t=e.payload_type??e.type,n=S(e.raw_packet,t);if(n&&n.length>0)return n}return[]}function F(e){if(!e.payload)return null;try{const t=h(e.payload),n=U(e),s=N(t,n);return s?{packet:e,decoded:s,timestamp:e.timestamp??0,hopCount:s.snrValues.length,rssi:e.rssi,snr:e.snr}:null}catch{return null}}function X(e){const t=new Map;for(const n of e){const s=F(n);if(!s)continue;const a=s.decoded.traceTag,r=t.get(a)||[];r.push(s),t.set(a,r)}for(const[n,s]of t)s.sort((a,r)=>a.timestamp-r.timestamp),t.set(n,s);return t}function J(e,t){if(t.length===0)return{traceTag:e,traceTagValue:0,targetPath:[],targetHopCount:0,observations:[],observationCount:0,firstSeen:0,lastSeen:0,duration:0,isComplete:!1,maxHopsObserved:0,progressPercent:0,bestObservation:null,hopStats:[],linkQuality:null};const n=[...t].sort((l,d)=>l.timestamp-d.timestamp),s=n.reduce((l,d)=>d.hopCount>l.hopCount?d:l,n[0]),a=n[0].timestamp,r=n[n.length-1].timestamp,i=s.decoded.pathHashes,c=i.length,p=s.hopCount,x=s.decoded.isComplete,g=[],u=s.decoded.snrValues;for(let l=0;l<u.length&&l<i.length;l++)g.push({prefix:i[l],snr:u[l],position:l,quality:L(u[l])});let m=null;if(u.length>0){const l=Math.min(...u),d=Math.max(...u),P=u.reduce(($,_)=>$+_,0)/u.length,w=u.indexOf(l),k=u.indexOf(d);m={minSnr:l,maxSnr:d,avgSnr:P,weakestLinkPosition:w,strongestLinkPosition:k}}return{traceTag:e,traceTagValue:s.decoded.traceTagValue,targetPath:i,targetHopCount:c,observations:n,observationCount:n.length,firstSeen:a,lastSeen:r,duration:r-a,isComplete:x,maxHopsObserved:p,progressPercent:c>0?Math.round(p/c*100):0,bestObservation:s,hopStats:g,linkQuality:m,srcHash:s.packet.src_hash,dstHash:s.packet.dst_hash}}function H(e){const t=e.payload_type??e.type;if(t!==f.TRACE||!e.payload)return null;try{const n=h(e.payload);let s=[];if(e._traceSnrPath!=null&&e._traceSnrPath.length>0)s=e._traceSnrPath;else if(e.raw_packet){const a=S(e.raw_packet,t);a&&a.length>0&&(s=a)}return N(n,s)}catch{return null}}function W(e){if((e.payload_type??e.type)!==f.ADVERT||!e.payload)return null;try{const n=h(e.payload),s=D(n);if(!s)return null;const a=s.publicKey.slice(0,2).toUpperCase(),r={...s,prefix:a};let i=null;return s.latitude&&s.longitude&&(i={latitude:s.latitude,longitude:s.longitude,name:s.name||`Node ${a||"??"}`,prefix:a,publicKey:s.publicKey}),{data:r,sourceNode:i}}catch{return null}}function C(e){if(!e)return null;const t=e.trim(),n=/(-?\d+\.?\d*)\s*[,\s]\s*(-?\d+\.?\d*)/,s=t.match(n);if(!s)return null;const a=parseFloat(s[1]),r=parseFloat(s[2]);return isNaN(a)||isNaN(r)||a<-90||a>90||r<-180||r>180||a===0&&r===0?null:{lat:a,lon:r}}function K(e){var n,s;if(!e.decrypted||!((n=e.channelName)!=null&&n.toLowerCase().includes("wardrive")))return null;const t=C(e.text);return t?{latitude:t.lat,longitude:t.lon,name:e.senderName||"Wardrive Ping",prefix:((s=e.senderName)==null?void 0:s.slice(0,2).toUpperCase())||"WD",nodeType:"wardrive"}:null}function Z(e,t){const n=e.payload_type??e.type;if(n===f.TRACE){const s=H(e);if(s)return{kind:"trace",data:s,snrValues:s.snrValues}}if(n===f.ADVERT){const s=W(e);if(s)return{kind:"advert",data:s.data,sourceNode:s.sourceNode}}if(n===f.GRP_TXT&&t){const s=C(t.text),a=K(t);return{kind:"grp_txt",decoded:t,wardriveCoords:s,wardriveSourceNode:a}}return{kind:"generic"}}const y={zinc:{stem:"bg-zinc-500/40",dot:"bg-zinc-400",row:"bg-zinc-500/8",text:"text-fg-muted/60",chip:"bg-zinc-500/20 text-fg-muted"},green:{stem:"bg-sys-green/50",dot:"bg-sys-green",row:"bg-sys-green/8",text:"text-sys-green",chip:"bg-sys-green/15 text-sys-green"},amber:{stem:"bg-sys-amber/50",dot:"bg-sys-amber",row:"bg-sys-amber/8",text:"text-sys-amber",chip:"bg-sys-amber/15 text-sys-amber"},red:{stem:"bg-sys-red/50",dot:"bg-sys-red",row:"bg-sys-red/8",text:"text-sys-red",chip:"bg-sys-red/15 text-sys-red"},blue:{stem:"bg-sys-blue/50",dot:"bg-sys-blue",row:"bg-sys-blue/8",text:"text-sys-blue",chip:"bg-sys-blue/15 text-sys-blue"},purple:{stem:"bg-sys-purple/50",dot:"bg-sys-purple",row:"bg-sys-purple/8",text:"text-sys-purple",chip:"bg-sys-purple/15 text-sys-purple"},teal:{stem:"bg-sys-teal/50",dot:"bg-sys-teal",row:"bg-sys-teal/8",text:"text-sys-teal",chip:"bg-sys-teal/15 text-sys-teal"},cyan:{stem:"bg-sys-cyan/50",dot:"bg-sys-cyan",row:"bg-sys-cyan/8",text:"text-sys-cyan",chip:"bg-sys-cyan/15 text-sys-cyan"},sky:{stem:"bg-sys-sky/50",dot:"bg-sys-sky",row:"bg-sys-sky/8",text:"text-sys-sky",chip:"bg-sys-sky/15 text-sys-sky"},pink:{stem:"bg-sys-pink/50",dot:"bg-sys-pink",row:"bg-sys-pink/8",text:"text-sys-pink",chip:"bg-sys-pink/15 text-sys-pink"},orange:{stem:"bg-sys-orange/50",dot:"bg-sys-orange",row:"bg-sys-orange/8",text:"text-sys-orange",chip:"bg-sys-orange/15 text-sys-orange"}};Object.fromEntries(Object.entries(y).map(([e,t])=>[e,t.text]));const v=j.createContext("");function ee({prefix:e,children:t}){return o.jsx(v.Provider,{value:e,children:t})}function T(){return j.useContext(v)}function te({children:e,color:t="zinc"}){var n;return o.jsx("span",{className:`inline-flex items-center px-1.5 py-px rounded-full text-[9px] font-mono font-medium leading-tight ${((n=y[t])==null?void 0:n.chip)??y.zinc.chip}`,children:e})}function se({fn:e,value:t,color:n="zinc"}){var r;const s=T(),a=s?`${s}(${e})`:e;return o.jsxs("span",{title:a,className:"inline-flex items-baseline gap-0 font-mono",children:[o.jsx("span",{className:"text-fg-muted/40",children:e}),o.jsx("span",{className:"text-fg-muted/20",children:"("}),t?o.jsx("span",{className:((r=y[n])==null?void 0:r.text)??y.zinc.text,children:t}):o.jsx("span",{className:"text-fg-muted/20",children:"·"}),o.jsx("span",{className:"text-fg-muted/20",children:")"})]})}function ne({label:e,children:t,mono:n=!0,padY:s=!1}){const a=T(),r=e.trim(),i=a?`${a}(${r})`:r;return o.jsxs("div",{className:`flex items-center gap-2 ${s?"py-1":"py-0.5"}`,children:[o.jsx("dt",{className:"text-fg-muted shrink-0 w-28 text-right",children:e}),o.jsx("dd",{title:i,className:n?"text-fg-primary break-all":"text-fg-primary",children:t})]})}function re({value:e,className:t}){const n=typeof e=="number"?`0x${e.toString(16).toUpperCase().padStart(2,"0")}`:e.startsWith("0x")?e:`0x${e}`;return o.jsx("span",{className:t??"text-sys-blue",children:n})}function ae({value:e}){const t=typeof e=="number"?e.toString(16).toUpperCase().padStart(2,"0"):e.replace(/^0x/i,"").toUpperCase();return o.jsxs("span",{className:"px-1 py-px rounded bg-zinc-500/15 text-fg-secondary font-mono text-[11px]",children:["0x",t]})}function oe({value:e}){return o.jsx("span",{className:"px-1 py-px rounded bg-zinc-500/10 text-fg-muted font-mono text-[10px]",children:e.toString(2).padStart(8,"0")})}function ie({raw:e,children:t}){return o.jsxs("span",{className:"inline-flex items-center gap-1.5 flex-wrap",children:[o.jsx("span",{className:"font-mono text-fg-muted",children:e}),o.jsx("span",{className:"text-fg-muted/40 text-[10px]",children:"→"}),t]})}const b={blue:"text-sys-blue",amber:"text-sys-amber",green:"text-sys-green",teal:"text-sys-teal",purple:"text-sys-purple"};function le({hops:e,hexPrefix:t,color:n="amber"}){if(e.length===0)return o.jsx("span",{className:"text-fg-muted italic",children:"∅ zero-hop"});const s=b[n]??b.amber;return o.jsxs("span",{className:"inline-flex items-center gap-1 flex-wrap",children:[t&&o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"font-mono text-fg-muted text-[10px]",children:t}),o.jsx("span",{className:"text-fg-muted/40 text-[10px] mx-0.5",children:"→"})]}),e.map((a,r)=>o.jsxs("span",{className:"inline-flex items-center",children:[r>0&&o.jsx("span",{className:"text-fg-muted/40 text-[10px]",children:"→"}),o.jsx("span",{className:`inline-block border border-edge-subtle rounded px-1.5 py-0.5 font-mono text-[11px] ${s}`,children:a.toUpperCase()})]},r))]})}function ce({title:e}){return o.jsx("div",{className:"mt-2 pt-2 border-t border-edge-subtle",children:e&&o.jsx("p",{className:"text-sys-amber font-semibold mb-0.5",children:e})})}function ue(e){if(!e||e<=0)return"never";const t=Math.floor(Date.now()/1e3)-e;return t<60?`${t}s ago`:t<3600?`${Math.floor(t/60)}m ago`:t<86400?`${Math.floor(t/3600)}h ago`:`${Math.floor(t/86400)}d ago`}function de(e){return e>0?"green":"zinc"}function pe({children:e,c:t}){return o.jsx("span",{className:t??"text-fg-muted",children:e})}function xe({tokens:e,label:t="emits"}){const n=e.filter(r=>r.value!=null&&r.value!=="");if(n.length===0)return null;const s=[];let a;for(let r=0;r<n.length;r++){const i=n[r].group;i&&i!==a?(s.push({type:"label",group:i}),a=i):!i&&a&&(a=void 0),s.push({type:"token",token:n[r],idx:r})}return o.jsx("div",{className:"mt-3 pt-2 border-t border-dashed border-edge-subtle/40",children:o.jsxs(R,{children:[o.jsxs(M,{className:"text-[8px] uppercase tracking-widest font-mono w-full text-left",children:[o.jsxs("span",{className:"text-fg-muted/30",children:[t," →"]}),o.jsxs("span",{className:"ml-1.5 text-fg-muted/50",children:[n.length," tokens"]})]}),o.jsx(A,{children:o.jsx("div",{className:"flex flex-wrap items-center gap-x-1.5 gap-y-1 mt-1",children:s.map((r,i)=>{var x;if(r.type==="label")return o.jsx("span",{className:"text-[8px] text-fg-muted/40 uppercase tracking-wider font-mono",children:r.group},`g-${i}`);const c=r.token,p=c.raw?`${c.fn}(${c.raw} → ${c.value})`:`${c.fn}(${c.value})`;return o.jsx("span",{title:p,className:`inline-block border border-edge-subtle rounded px-1.5 py-0.5 font-mono cursor-default ${((x=y[c.color??"zinc"])==null?void 0:x.text)??y.zinc.text}`,children:c.value},r.idx)})})})]})})}export{y as A,oe as B,te as C,ae as H,ne as K,le as P,ie as R,ee as S,se as T,H as a,J as b,xe as c,Z as d,q as e,ce as f,X as g,re as h,pe as i,ue as j,Y as p,de as s};
