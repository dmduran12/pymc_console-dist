import{r as e,j as t,c as s}from"./vendor-react-54o2BuWt.js";import{c as a,bp as r,aU as l,bq as n,br as c,bs as i,X as o,aH as d,bt as u,bu as m,bv as x,C as p,bw as b,R as h,bm as y}from"./index-W7HOJkA3.js";import{T as g,P as f,C as j}from"./ConfirmModal-nlFN36A2.js";import{l as v}from"./font-loader-jlbdh9Fw.js";import{N}from"./NodeInformationCard-BPUrZtwI.js";import{a as w,P as k,b as C}from"./PageLayout-BreM1jWS.js";import{C as S}from"./Card-ADh2cW78.js";import{L as _}from"./loader-circle-BFq8BFSi.js";import{C as T,a as F}from"./DataBox-B3hWOq8z.js";import{I as E}from"./info-nrh0xMkz.js";import{R as L,C as M}from"./Grid-CORrqWoE.js";import{C as P}from"./circle-check-BReqF2aY.js";import{T as R}from"./triangle-alert-DJGP4SlO.js";import{R as z}from"./refresh-cw-B9GYY3zQ.js";import{C as D}from"./chevron-right-B-fW81Tj.js";import"./deckgl-DTsmDcfs.js";import"./vendor-core-dnrJb0w-.js";const A=a("antenna",[["path",{d:"M2 12 7 2",key:"117k30"}],["path",{d:"m7 12 5-10",key:"1tvx22"}],["path",{d:"m12 12 5-10",key:"ev1o1a"}],["path",{d:"m17 12 5-10",key:"1e4ti3"}],["path",{d:"M4.5 7h15",key:"vlsxkz"}],["path",{d:"M12 16v6",key:"c8a4gj"}]]),I=a("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),O=a("folder-key",[["circle",{cx:"16",cy:"20",r:"2",key:"1vifvg"}],["path",{d:"M10 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v2",key:"3hgo9p"}],["path",{d:"m22 14-4.5 4.5",key:"1ef6z8"}],["path",{d:"m21 15 1 1",key:"1ejcpy"}]]),q=a("folder-lock",[["rect",{width:"8",height:"5",x:"14",y:"17",rx:"1",key:"19aais"}],["path",{d:"M10 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v2.5",key:"1w6v7t"}],["path",{d:"M20 17v-2a2 2 0 1 0-4 0v2",key:"pwaxnr"}]]),K=a("key-round",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]),H=a("monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),V=a("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),$=a("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Y=a("shield-x",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m14.5 9.5-5 5",key:"17q4r4"}],["path",{d:"m9.5 9.5 5 5",key:"18nt4w"}]]),U=a("triangle-dashed",[["path",{d:"M10.17 4.193a2 2 0 0 1 3.666.013",key:"pltmmw"}],["path",{d:"M14 21h2",key:"v4qezv"}],["path",{d:"m15.874 7.743 1 1.732",key:"10m0iw"}],["path",{d:"m18.849 12.952 1 1.732",key:"zadnam"}],["path",{d:"M21.824 18.18a2 2 0 0 1-1.835 2.824",key:"fvwuk4"}],["path",{d:"M4.024 21a2 2 0 0 1-1.839-2.839",key:"1e1kah"}],["path",{d:"m5.136 12.952-1 1.732",key:"1u4ldi"}],["path",{d:"M8 21h2",key:"i9zjee"}],["path",{d:"m8.102 7.743-1 1.732",key:"1zzo4u"}]]);async function B(e){return r("/api/update_web_config",{method:"POST",body:JSON.stringify(e)})}const X=e.memo(function(){const{theme:e}=l(),{colorScheme:s}=e,a=n.find(e=>e.colorScheme===s)??n[0],r=a.displaySize,c=`clamp(${.8*r}rem, ${.6*r}rem + 1.5vw, ${1.4*r}rem)`;return t.jsx("div",{className:"h-10 flex items-center justify-center",children:t.jsxs("span",{className:"font-medium transition-all duration-300 leading-none text-center",style:{fontFamily:a.displayFont,color:a.displayColor,fontSize:c,fontOpticalSizing:"auto",letterSpacing:"-0.03em"},children:["Theme: ",a.displayName]})})}),J=e.memo(function(){const{theme:a,setThemePreset:r,setBrightness:i}=l(),{colorScheme:o,brightness:d}=a,[u,m]=e.useState(!1),[x,p]=e.useState(!1),b=e.useRef(null),h=e.useRef(null),y=(n.find(e=>e.colorScheme===o)??n[0]).id,g=e.useCallback((e,t)=>{if(!h.current)return d;const s=(h.current.y-e)/(t?200:80)*100;return Math.round(Math.max(0,Math.min(100,h.current.brightness+s)))},[d]),f=e.useCallback(e=>{r(e),m(!0)},[r]),j=e.useCallback(e=>{i(e)},[i]),v=e.useCallback(e=>{const t=n.find(t=>t.id===e);t&&c(t.backgroundImage)},[]);return t.jsx("div",{className:"grid grid-cols-4 gap-[3%] w-full",children:n.map(e=>{const a=y===e.id,r=!e.backgroundImage,l=a&&!r&&(u||x);return t.jsxs("div",{ref:a?b:void 0,title:e.displayName,className:s("flex flex-col items-stretch rounded-sm transition-all duration-300 ease-out overflow-hidden",a?"ring-2 ring-accent-primary scale-105 "+(r?"cursor-pointer":"cursor-ns-resize"):"cursor-pointer"),onMouseEnter:()=>{a&&!r?m(!0):a||v(e.id)},onMouseLeave:()=>!x&&m(!1),onClick:()=>!a&&f(e.id),onTouchStart:e=>{if(!a||r)return;e.preventDefault();const t=e.touches[0];h.current={y:t.clientY,brightness:d},p(!0),m(!0);const s=e=>{e.preventDefault();const t=e.touches[0];j(g(t.clientY,!0))},l=()=>{document.removeEventListener("touchmove",s),document.removeEventListener("touchend",l),h.current=null,p(!1),setTimeout(()=>m(!1),1500)};document.addEventListener("touchmove",s,{passive:!1}),document.addEventListener("touchend",l)},onMouseDown:e=>{if(!a||r)return;e.preventDefault(),h.current={y:e.clientY,brightness:d},p(!0),m(!0);const t=e=>{j(g(e.clientY,!1))},s=()=>{document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",s),h.current=null,p(!1)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",s)},children:[t.jsxs("div",{className:"glass-thumbnail w-full aspect-square sm:aspect-[4/3] lg:aspect-video relative !rounded-b-none",children:["kde breeze"===e.id?t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-[#242627]",style:{opacity:l?.4:1},children:t.jsx("span",{className:"text-[#58b99d] text-[1.5em] font-bold font-mono",children:">"})}):"ribbon"===e.id?t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-[#F5F5F5]",style:{opacity:l?.4:1},children:t.jsx("span",{className:"text-[#2D2D2D] text-[1.5em] font-bold font-mono",children:"R"})}):t.jsx("div",{className:"absolute bg-cover bg-center transition-opacity duration-200",style:{inset:0,backgroundImage:`url(${e.backgroundImage})`,opacity:l?.4:1,filter:"brightness(var(--thumbnail-brightness, 1.5))"}}),a&&t.jsxs("div",{className:s("absolute inset-0 transition-opacity duration-200",l?"opacity-100":"opacity-0"),children:[t.jsx("div",{className:"absolute inset-x-0 bottom-0 bg-black/70 transition-all duration-100 ease-out",style:{height:100-d+"%"}}),t.jsx("div",{className:"absolute inset-x-[8%] h-0.5 bg-white rounded-full shadow-lg transition-all duration-100 ease-out",style:{top:100-d+"%"}}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsxs("span",{className:"text-[0.6em] font-mono font-bold text-white drop-shadow-lg",children:[d,"%"]})})]})]}),t.jsx("div",{className:"flex flex-col w-full",children:e.paletteColors.map((e,s)=>t.jsx("div",{className:"flex",children:e.map((e,s)=>t.jsx("div",{className:"flex-1 aspect-[2/1]",style:{backgroundColor:e}},s))},s))})]},e.id)})})}),G=e.memo(function({layout:s="horizontal"}){return e.useEffect(()=>{v()},[]),"logo-only"===s?t.jsx(X,{}):"thumbnails-only"===s?t.jsx(J,{}):t.jsxs("div",{className:"flex flex-col items-center gap-3",children:[t.jsx(X,{}),t.jsx(J,{})]})});function W(){const{latitude:a,longitude:r,enabled:l,setLocation:n,enable:c,disable:d,clear:u}=i(),[m,x]=e.useState(!1),[p,b]=e.useState(""),[h,y]=e.useState(""),[f,j]=e.useState("idle"),[v,N]=e.useState(null),k=e.useRef(null),C=e.useRef(null),F=e.useRef(!0);e.useEffect(()=>(F.current=!0,()=>{F.current=!1,C.current&&clearTimeout(C.current)}),[]);const L=()=>{x(!1),N(null)};e.useEffect(()=>{if(!m)return;const e=e=>{"loading"!==f&&k.current&&!k.current.contains(e.target)&&L()};return document.addEventListener("mouseup",e),()=>document.removeEventListener("mouseup",e)},[m,f]);const M=null!==a&&null!==r;return t.jsx(w,{children:t.jsxs("div",{ref:k,children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx(S,{icon:t.jsx(U,{}),title:"Stealth",largeTitle:!0}),t.jsxs("div",{className:"flex items-center gap-1",children:[M&&!m&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>{l?d():c()},className:s("relative inline-flex h-6 w-11 items-center rounded-full transition-colors border-2 mr-2",l?"bg-toggle-on border-toggle-on":"bg-toggle-off border-border-subtle"),title:l?"Disable stealth location":"Enable stealth location",children:t.jsx("span",{className:s("inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-lg",l?"translate-x-5":"translate-x-0.5")})}),t.jsx("button",{onClick:()=>{u(),x(!1)},className:"p-2 rounded-lg transition-colors text-text-muted hover:text-accent-danger hover:bg-accent-danger/10",title:"Clear stealth location",children:t.jsx(g,{className:"w-4 h-4"})})]}),m?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:L,disabled:"loading"===f,className:s("p-2 rounded-lg transition-colors","loading"===f?"text-text-muted cursor-not-allowed":"text-text-muted hover:text-accent-danger hover:bg-accent-danger/10"),title:"Cancel",children:t.jsx(o,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>{if("loading"===f)return;C.current&&clearTimeout(C.current);const e=((e,t)=>{const s=parseFloat(e),a=parseFloat(t);return isNaN(s)||isNaN(a)?"Please enter valid numbers":s<-90||s>90?"Latitude must be between -90 and 90":a<-180||a>180?"Longitude must be between -180 and 180":0===s&&0===a?"Coordinates (0, 0) are invalid":null})(p,h);if(e)return void N(e);j("loading"),N(null);const t=parseFloat(p),s=parseFloat(h);n(t,s),l||c(),j("success"),C.current=setTimeout(()=>{F.current&&(j("idle"),x(!1))},1e3)},disabled:"loading"===f,className:s("p-2 rounded-lg transition-colors","loading"===f?"text-accent-primary cursor-wait":"success"===f?"text-accent-success":"error"===f?"text-accent-danger":"text-accent-success hover:bg-accent-success/10"),title:"Save",children:"loading"===f?t.jsx(_,{className:"w-4 h-4 animate-spin"}):"success"===f?t.jsx(T,{className:"w-4 h-4"}):"error"===f?t.jsx(o,{className:"w-4 h-4"}):t.jsx(T,{className:"w-4 h-4"})})]}):t.jsx("button",{onClick:()=>{b((null==a?void 0:a.toFixed(6))??""),y((null==r?void 0:r.toFixed(6))??""),N(null),x(!0)},className:"p-2 rounded-lg transition-colors text-text-muted hover:text-text-primary hover:bg-bg-subtle",title:M?"Edit stealth location":"Set stealth location",children:t.jsx(V,{className:"w-4 h-4"})})]})]}),t.jsx("div",{className:"bg-accent-tertiary/5 rounded-xl p-3 mb-4",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx(E,{className:"w-4 h-4 text-accent-tertiary flex-shrink-0 mt-0.5"}),t.jsxs("p",{className:"type-body-sm text-text-muted",children:[t.jsx("span",{className:"text-text-secondary",children:"Stealth mode"})," allows you to appear on the map and in topology analysis without broadcasting your location. Coordinates are stored locally in your browser only — ",t.jsx("span",{className:"text-accent-tertiary",children:"never sent to config.yaml or the mesh"}),"."]})]})}),v&&t.jsx("div",{className:"text-xs mb-3 px-2 py-1.5 rounded-md text-accent-danger bg-accent-danger/10",children:v}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:m?"Latitude (°)":"Latitude"}),t.jsx("div",{className:s("h-[38px] rounded-full px-4 flex items-center transition-colors",m?"bg-white/5":"bg-white/[0.02]"),children:m?t.jsx("input",{type:"number",value:p,onChange:e=>b(e.target.value),step:"0.000001",min:"-90",max:"90",placeholder:"e.g. 34.052234",className:"w-full bg-transparent text-text-primary focus:outline-none type-data placeholder:text-text-muted/50"}):t.jsx("span",{className:s("type-data",M&&l?"text-text-primary":"text-text-muted"),children:M?a.toFixed(6):"Not set"})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:m?"Longitude (°)":"Longitude"}),t.jsx("div",{className:s("h-[38px] rounded-full px-4 flex items-center transition-colors",m?"bg-white/5":"bg-white/[0.02]"),children:m?t.jsx("input",{type:"number",value:h,onChange:e=>y(e.target.value),step:"0.000001",min:"-180",max:"180",placeholder:"e.g. -118.243685",className:"w-full bg-transparent text-text-primary focus:outline-none type-data placeholder:text-text-muted/50"}):t.jsx("span",{className:s("type-data",M&&l?"text-text-primary":"text-text-muted"),children:M?r.toFixed(6):"Not set"})})]})]}),M&&!m&&t.jsx("div",{className:"mt-3 pt-3 border-t border-border-subtle",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:s("w-2 h-2 rounded-full",l?"bg-accent-success":"bg-text-muted")}),t.jsx("span",{className:"type-body-sm text-text-muted",children:l?"Stealth location active — you appear on maps with these coordinates":"Stealth location disabled — coordinates saved but not in use"})]})})]})})}const Q=[{value:7.8,label:"7.8 kHz"},{value:10.4,label:"10.4 kHz"},{value:15.6,label:"15.6 kHz"},{value:20.8,label:"20.8 kHz"},{value:31.25,label:"31.25 kHz"},{value:41.7,label:"41.7 kHz"},{value:62.5,label:"62.5 kHz"},{value:125,label:"125 kHz"},{value:250,label:"250 kHz"},{value:500,label:"500 kHz"}],Z=[5,6,7,8,9,10,11,12],ee=[{value:5,label:"4/5"},{value:6,label:"4/6"},{value:7,label:"4/7"},{value:8,label:"4/8"}],te="radioConfig",se="repeaterSettings",ae="operatingMode";function re({node:e,level:a,expandedKeys:r,selectedKeyId:l,globalFloodPolicy:n,onSelect:c,onToggle:i}){const o=r.has(e.id),d=l===e.id,u=e.children&&e.children.length>0,m="allow"===n;return t.jsxs("div",{children:[t.jsxs("div",{className:s("flex items-center gap-2 h-[36px] px-3 rounded-full cursor-pointer transition-colors",d?"bg-accent-primary/15":"hover:bg-subtle-fill",m&&"opacity-50 cursor-not-allowed"),style:{marginLeft:16*a+"px"},onClick:()=>!m&&c(e.id),children:[u?t.jsx("button",{onClick:t=>{t.stopPropagation(),i(e.id)},className:"p-1 hover:bg-subtle-fill-hover rounded-full transition-colors",children:t.jsx(D,{className:s("w-3.5 h-3.5 text-text-muted transition-transform",o&&"rotate-90")})}):t.jsx("span",{className:"w-5"}),t.jsx(O,{className:"w-4 h-4 text-accent-primary flex-shrink-0"}),t.jsx("span",{className:"type-data text-text-primary flex-1 truncate",children:e.name}),t.jsx("span",{className:s("type-data-xs px-2 py-0.5 rounded-full","allow"===e.floodPolicy?"bg-accent-success/15 text-accent-success":"bg-accent-danger/15 text-accent-danger"),children:"allow"===e.floodPolicy?"Allow":"Deny"})]}),u&&o&&t.jsx("div",{children:e.children.map(e=>t.jsx(re,{node:e,level:a+1,expandedKeys:r,selectedKeyId:l,globalFloodPolicy:n,onSelect:c,onToggle:i},e.id))})]})}function le(){var a,l,n,c,i,v;const{stats:D,setMode:O,clearModeMutation:U,setDutyCycleConfig:X,clearDutyCycleMutation:J,fetchStats:le,startMutation:ne,clearMutation:ce}=d(),ie=null==(a=null==D?void 0:D.config)?void 0:a.radio,oe=null==(l=null==D?void 0:D.config)?void 0:l.repeater,de=null==(n=null==D?void 0:D.config)?void 0:n.duty_cycle,ue=(null==D?void 0:D.node_name)||(null==(c=null==D?void 0:D.config)?void 0:c.node_name)||"Unknown Node",me=(null==oe?void 0:oe.mode)??"forward",xe=(null==de?void 0:de.enforcement_enabled)??!1,pe=null==(i=null==D?void 0:D.config)?void 0:i.delays,[be,he]=e.useState(!1),[ye,ge]=e.useState(""),[fe,je]=e.useState(62.5),[ve,Ne]=e.useState(7),[we,ke]=e.useState(5),[Ce,Se]=e.useState(""),[_e,Te]=e.useState("idle"),[Fe,Ee]=e.useState(null),Le=e.useRef(null),Me=e.useRef(null),[Pe,Re]=e.useState(!1),[ze,De]=e.useState(""),[Ae,Ie]=e.useState(""),[Oe,qe]=e.useState(""),[Ke,He]=e.useState("idle"),Ve=e.useRef(null),$e=e.useRef(null),[Ye,Ue]=e.useState(!1),[Be,Xe]=e.useState(""),[Je,Ge]=e.useState(""),[We,Qe]=e.useState(""),[Ze,et]=e.useState(""),[tt,st]=e.useState("idle"),[at,rt]=e.useState(null),lt=e.useRef(null),nt=e.useRef(null),[ct,it]=e.useState("idle"),[ot,dt]=e.useState("idle"),[ut,mt]=e.useState(null),[xt,pt]=e.useState(null),bt=e.useRef(!0),ht=e.useRef(null),yt=e.useRef(null),gt=e.useRef(null),ft=e.useRef(null),jt=e.useRef(!1),vt=e.useRef(!1);e.useEffect(()=>(bt.current=!0,()=>{bt.current=!1,ht.current&&clearTimeout(ht.current),yt.current&&clearTimeout(yt.current),gt.current&&clearTimeout(gt.current),ft.current&&clearTimeout(ft.current),_t.current&&clearTimeout(_t.current),Tt.current&&clearTimeout(Tt.current),Me.current&&clearTimeout(Me.current),Ve.current&&clearTimeout(Ve.current),nt.current&&clearTimeout(nt.current)}),[]),e.useEffect(()=>{const e=e=>{if(be||Ye||Pe)return e.preventDefault(),e.returnValue="You have unsaved changes. Are you sure you want to leave?",e.returnValue};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[be,Ye,Pe]);const Nt=null==(v=null==D?void 0:D.config)?void 0:v.web,[wt,kt]=e.useState("idle"),[Ct,St]=e.useState(null),_t=e.useRef(null),Tt=e.useRef(null),Ft=e.useRef(!1),[Et,Lt]=e.useState([]),[Mt,Pt]=e.useState(!1),[Rt,zt]=e.useState(null),[Dt,At]=e.useState(!1),[It,Ot]=e.useState(""),[qt,Kt]=e.useState(null),[Ht,Vt]=e.useState(!1),[$t,Yt]=e.useState(null),[Ut,Bt]=e.useState(!1),[Xt,Jt]=e.useState(!1),[Gt,Wt]=e.useState(!1),[Qt,Zt]=e.useState([]),[es,ts]=e.useState(!1),[ss,as]=e.useState(null),[rs,ls]=e.useState("deny"),[ns,cs]=e.useState(!1),[is,os]=e.useState(null),[ds,us]=e.useState(new Set),[ms,xs]=e.useState(!1),[ps,bs]=e.useState(!1),[hs,ys]=e.useState(!1),[gs,fs]=e.useState(null),[js,vs]=e.useState(null),[Ns,ws]=e.useState(""),[ks,Cs]=e.useState("deny"),[Ss,_s]=e.useState(!1),[Ts,Fs]=e.useState(!0),[Es,Ls]=e.useState(!1),[Ms,Ps]=e.useState(!0),[Rs,zs]=e.useState("idle"),[Ds,As]=e.useState(!1),[Is,Os]=e.useState(!1),qs=e.useRef(!1);e.useEffect(()=>{const e=be&&!qs.current;qs.current=be,ie&&e&&(ge((ie.frequency/1e6).toFixed(3)),je(ie.bandwidth/1e3),Ne(ie.spreading_factor),ke(ie.coding_rate),Se(String(ie.tx_power)))},[ie,be]);const Ks=e.useMemo(()=>{if(!ie||!be)return!1;const e=ie.frequency/1e6,t=ie.bandwidth/1e3,s=parseFloat(ye)||0;return Math.abs(s-e)>1e-4||fe!==t||ve!==ie.spreading_factor||we!==ie.coding_rate||parseInt(Ce)!==ie.tx_power},[ie,be,ye,fe,ve,we,Ce]),Hs=e.useCallback(()=>{he(!1),Ee(null),ie&&(ge((ie.frequency/1e6).toFixed(3)),je(ie.bandwidth/1e3),Ne(ie.spreading_factor),ke(ie.coding_rate),Se(String(ie.tx_power)))},[ie]);e.useEffect(()=>{if(!be)return;const e=e=>{"loading"!==_e&&Le.current&&!Le.current.contains(e.target)&&Hs()};return document.addEventListener("mouseup",e),()=>{document.removeEventListener("mouseup",e)}},[be,Hs,_e]);const Vs=e.useCallback(()=>{const e=null==pe?void 0:pe.tx_delay_factor;return e&&"object"==typeof e&&"parsedValue"in e?e.parsedValue??1:"number"==typeof e?e:1},[pe]),$s=e.useCallback(()=>{const e=null==pe?void 0:pe.direct_tx_delay_factor;return"number"==typeof e?e:.5},[pe]),Ys=e.useCallback(()=>{const e=null==de?void 0:de.max_airtime_percent;return"number"==typeof e?e:e&&"object"==typeof e&&"parsedValue"in e?e.parsedValue??6:6},[de]),Us=e.useCallback(()=>{De(Vs().toFixed(2)),Ie($s().toFixed(2)),qe(Ys().toFixed(1)),Re(!0)},[Vs,$s,Ys]),Bs=e.useCallback(()=>{Re(!1)},[]);e.useEffect(()=>{if(!Pe)return;const e=e=>{"loading"!==Ke&&$e.current&&!$e.current.contains(e.target)&&Bs()};return document.addEventListener("mouseup",e),()=>document.removeEventListener("mouseup",e)},[Pe,Bs,Ke]);const Xs=e.useCallback(()=>{var e,t,s;Xe(ue),Ge((null==(e=null==oe?void 0:oe.latitude)?void 0:e.toString())||"0"),Qe((null==(t=null==oe?void 0:oe.longitude)?void 0:t.toString())||"0"),et((null==(s=null==oe?void 0:oe.send_advert_interval_hours)?void 0:s.toString())||"0"),rt(null),Ue(!0)},[ue,oe]),Js=e.useCallback(()=>{Ue(!1),rt(null)},[]);e.useEffect(()=>{if(!Ye)return;const e=e=>{"loading"!==tt&&lt.current&&!lt.current.contains(e.target)&&Js()};return document.addEventListener("mouseup",e),()=>document.removeEventListener("mouseup",e)},[Ye,Js,tt]);const Gs=async()=>{var e;if("loading"===wt)return;const t=(null==Nt?void 0:Nt.cors_enabled)??!1,s=!t,a=t;_t.current&&clearTimeout(_t.current),Tt.current&&clearTimeout(Tt.current),Ft.current=!1,St(s),kt("loading"),_t.current=setTimeout(()=>{Ft.current||bt.current&&(St(a),kt("error"),Tt.current=setTimeout(()=>{bt.current&&(kt("idle"),St(null))},2e3))},1e4);try{const t=await B({web:{cors_enabled:s}});if(Ft.current=!0,_t.current&&clearTimeout(_t.current),!bt.current)return;t.success||(null==(e=t.data)?void 0:e.persisted)?(await le(),kt("success"),Tt.current=setTimeout(()=>{bt.current&&(kt("idle"),St(null))},2e3)):(St(a),kt("error"),Tt.current=setTimeout(()=>{bt.current&&(kt("idle"),St(null))},2e3))}catch{if(Ft.current=!0,_t.current&&clearTimeout(_t.current),!bt.current)return;St(a),kt("error"),Tt.current=setTimeout(()=>{bt.current&&(kt("idle"),St(null))},2e3)}};e.useEffect(()=>{(async()=>{Ps(!0);try{const e=await async function(){return r("/api/check_pymc_console")}();e.success&&e.data?Ls(e.data.exists):Ls(!1);const t=null==Nt?void 0:Nt.web_path;Fs(!t||""===t)}catch{Ls(!1)}finally{Ps(!1)}})()},[null==Nt?void 0:Nt.web_path]);const Ws=async e=>{var t;if("loading"!==Rs){zs("loading");try{const s=await B({web:{web_path:e?null:"/opt/pymc_console/web/html"}});if(!bt.current)return;s.success||(null==(t=s.data)?void 0:t.persisted)?(Fs(e),zs("success"),As(!0),setTimeout(()=>{bt.current&&zs("idle")},2e3)):(zs("error"),setTimeout(()=>{bt.current&&zs("idle")},2e3))}catch{if(!bt.current)return;zs("error"),setTimeout(()=>{bt.current&&zs("idle")},2e3)}}},Qs=e.useCallback(async()=>{Pt(!0),zt(null);try{const e=await async function(){return r("/auth/tokens")}();Lt(e.tokens||[])}catch(e){zt(e instanceof Error?e.message:"Failed to fetch tokens")}finally{Pt(!1)}},[]);e.useEffect(()=>{Qs()},[Qs]);const Zs=async()=>{if(It.trim()){Bt(!0),zt(null);try{const e=await async function(e){return r("/auth/tokens",{method:"POST",body:JSON.stringify({name:e})})}(It.trim());Kt(e.token||null),At(!1),Vt(!0),Ot(""),await Qs()}catch(e){zt(e instanceof Error?e.message:"Failed to create token")}finally{Bt(!1)}}else zt("Token name is required")},ea=e=>e?new Date(1e3*e).toLocaleString():"Never",ta=e.useCallback(e=>{const t=new Map,s=[];return e.forEach(e=>{const s={id:e.id,name:e.name,floodPolicy:e.flood_policy,transport_key:e.transport_key,last_used:e.last_used,parent_id:e.parent_id,children:[]};t.set(e.id,s)}),t.forEach(e=>{e.parent_id&&t.has(e.parent_id)?t.get(e.parent_id).children.push(e):s.push(e)}),s},[]),sa=e.useCallback(async()=>{ts(!0),as(null);try{const e=await async function(){return r("/api/transport_keys")}();e.success&&e.data?Zt(ta(e.data)):as(e.error||"Failed to load transport keys")}catch(e){as(e instanceof Error?e.message:"Unknown error occurred")}finally{ts(!1)}},[ta]);e.useEffect(()=>{sa()},[sa]);const aa=e.useCallback((e,t)=>{for(const s of e){if(s.id===t)return s;if(s.children){const e=aa(s.children,t);if(e)return e}}return null},[]),ra=e.useCallback(()=>{if(!is)return;const e=aa(Qt,is);return null==e?void 0:e.name},[is,Qt,aa]),la=e.useCallback(e=>{us(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[]),na=async e=>{cs(!0),as(null);try{const t=await async function(e){return r("/api/global_flood_policy",{method:"POST",body:JSON.stringify({global_flood_allow:e})})}("allow"===e);t.success?ls(e):as(t.error||"Failed to update global flood policy")}catch(t){as(t instanceof Error?t.message:"Failed to update global flood policy")}finally{cs(!1)}},ca=async()=>{if(Ns.trim()){_s(!0),as(null);try{const e=await async function(e){return r("/api/transport_keys",{method:"POST",body:JSON.stringify(e)})}({name:Ns.trim(),flood_policy:ks,parent_id:is??void 0});e.success?(await sa(),xs(!1),ws(""),Cs("deny")):as(e.error||"Failed to add transport key")}catch(e){as(e instanceof Error?e.message:"Failed to add transport key")}finally{_s(!1)}}else as("Key name is required")},ia=e.useCallback(()=>{if(!is)return;const e=aa(Qt,is);e&&(fs({...e}),bs(!0))},[is,Qt,aa]);e.useEffect(()=>{const e=e=>{"Escape"===e.key&&(ms&&(xs(!1),ws(""),Cs("deny")),ps&&(bs(!1),fs(null)),hs&&(ys(!1),vs(null)),Dt&&(At(!1),Ot("")),Ht&&(Vt(!1),Kt(null)))};if(ms||ps||hs||Dt||Ht)return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ms,ps,hs,Dt,Ht]);const oa=e.useCallback(()=>{if(!is)return;const e=aa(Qt,is);e&&(vs(e),ys(!0))},[is,Qt,aa]);return t.jsxs(k,{children:[t.jsx(C,{title:"Configuration",icon:t.jsx(u,{})}),t.jsxs(L,{template:"standard",children:[t.jsx(M,{span:12,md:6,children:t.jsx(w,{children:t.jsxs("div",{ref:lt,children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"type-subheading text-text-primary flex items-center gap-2",children:[t.jsx(m,{className:"icon-md text-accent-primary"}),"Repeater Settings"]}),t.jsx("div",{className:"flex items-center gap-1",children:oe&&(Ye?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:Js,disabled:"loading"===tt,className:s("p-2 rounded-lg transition-colors","loading"===tt?"text-text-muted cursor-not-allowed":"text-text-muted hover:text-accent-danger hover:bg-accent-danger/10"),title:"Cancel",children:t.jsx(o,{className:"w-4 h-4"})}),t.jsx("button",{onClick:async()=>{if("loading"!==tt){nt.current&&clearTimeout(nt.current),ne(se),st("loading"),rt(null);try{const e={};Be&&Be!==ue&&(e.node_name=Be);const t=parseFloat(Je);isNaN(t)||t===(null==oe?void 0:oe.latitude)||(e.latitude=t);const s=parseFloat(We);isNaN(s)||s===(null==oe?void 0:oe.longitude)||(e.longitude=s);const a=parseInt(Ze);if(isNaN(a)||a===(null==oe?void 0:oe.send_advert_interval_hours)||(e.flood_advert_interval_hours=a),0===Object.keys(e).length)return rt({success:!0,message:"No changes to save"}),st("idle"),void ce(se);const r=await y(e);if(!bt.current)return void ce(se);if(r.success&&r.data){const e=r.data.applied.join(", ");rt({success:!0,message:`Updated: ${e}`}),await le({force:!0}),st("success"),nt.current=setTimeout(()=>{bt.current&&(st("idle"),Ue(!1),rt(null),ce(se))},1500)}else rt({success:!1,message:r.error||"Failed to save"}),st("error"),ce(se),nt.current=setTimeout(()=>{bt.current&&st("idle")},2e3)}catch(e){if(!bt.current)return void ce(se);rt({success:!1,message:String(e)}),st("error"),ce(se),nt.current=setTimeout(()=>{bt.current&&st("idle")},2e3)}}},disabled:"loading"===tt,className:s("p-2 rounded-lg transition-colors","loading"===tt?"text-accent-primary cursor-wait":"success"===tt?"text-accent-success":"error"===tt?"text-accent-danger":"text-accent-success hover:bg-accent-success/10"),title:"Save changes",children:"loading"===tt?t.jsx(_,{className:"w-4 h-4 animate-spin"}):"success"===tt?t.jsx(T,{className:"w-4 h-4"}):"error"===tt?t.jsx(o,{className:"w-4 h-4"}):t.jsx(T,{className:"w-4 h-4"})})]}):t.jsx("button",{onClick:Xs,className:"p-2 rounded-lg transition-colors text-text-muted hover:text-text-primary hover:bg-bg-subtle",title:"Edit repeater settings",children:t.jsx(V,{className:"w-4 h-4"})}))})]}),at&&t.jsx("div",{className:s("text-xs mb-3 px-2 py-1.5 rounded-md",at.success?"text-accent-success bg-accent-success/10":"text-accent-danger bg-accent-danger/10"),children:at.message}),oe?t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"col-span-2",children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Node Name"}),t.jsx("div",{className:s("h-[38px] rounded-full px-4 flex items-center transition-colors",Ye?"bg-subtle-fill-hover":"bg-subtle-fill"),children:Ye?t.jsx("input",{type:"text",value:Be,onChange:e=>Xe(e.target.value),maxLength:50,className:"w-full bg-transparent text-text-primary focus:outline-none type-data",placeholder:"Enter node name"}):t.jsx("span",{className:"type-data text-text-primary",children:ue})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:Ye?"Latitude (°)":"Latitude"}),t.jsx("div",{className:s("h-[38px] rounded-full px-4 flex items-center transition-colors",Ye?"bg-subtle-fill-hover":"bg-subtle-fill"),children:Ye?t.jsx("input",{type:"number",value:Je,onChange:e=>Ge(e.target.value),step:"0.000001",min:"-90",max:"90",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):t.jsx("span",{className:"type-data text-text-primary",children:0!==oe.latitude?oe.latitude.toFixed(6):"Not set"})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:Ye?"Longitude (°)":"Longitude"}),t.jsx("div",{className:s("h-[38px] rounded-full px-4 flex items-center transition-colors",Ye?"bg-subtle-fill-hover":"bg-subtle-fill"),children:Ye?t.jsx("input",{type:"number",value:We,onChange:e=>Qe(e.target.value),step:"0.000001",min:"-180",max:"180",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):t.jsx("span",{className:"type-data text-text-primary",children:0!==oe.longitude?oe.longitude.toFixed(6):"Not set"})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:Ye?"Advert Interval (hours)":"Advert Interval"}),t.jsx("div",{className:s("h-[38px] rounded-full px-4 flex items-center transition-colors",Ye?"bg-subtle-fill-hover":"bg-subtle-fill"),children:Ye?t.jsx("input",{type:"number",value:Ze,onChange:e=>et(e.target.value),min:"0",max:"48",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):t.jsx("span",{className:"type-data text-text-primary",children:oe.send_advert_interval_hours>0?`${oe.send_advert_interval_hours}h`:"Disabled"})}),Ye&&t.jsx("p",{className:"type-data-xs text-text-muted mt-1 ml-4",children:"0 = disabled, 3-48 hours"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Score-based TX"}),t.jsx("div",{className:"h-[38px] rounded-full px-4 flex items-center bg-subtle-fill",children:t.jsx("span",{className:"type-data text-text-primary",children:oe.use_score_for_tx?"Enabled":"Disabled"})})]})]}):t.jsx("p",{className:"text-text-muted",children:"Loading repeater settings..."})]})})}),t.jsx(M,{span:12,md:6,children:t.jsx(w,{children:t.jsxs("div",{ref:Le,children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"type-subheading text-text-primary flex items-center gap-2",children:[t.jsx(A,{className:"icon-md text-accent-primary"}),"Radio Configuration"]}),t.jsx("div",{className:"flex items-center gap-1",children:ie&&(be?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:Hs,disabled:"loading"===_e,className:s("p-2 rounded-lg transition-colors","loading"===_e?"text-text-muted cursor-not-allowed":"text-text-muted hover:text-accent-danger hover:bg-accent-danger/10"),title:"Cancel",children:t.jsx(o,{className:"w-4 h-4"})}),t.jsx("button",{onClick:async()=>{if("loading"!==_e){Me.current&&clearTimeout(Me.current),ne(te),Te("loading"),Ee(null);try{const e={},t=parseFloat(ye),s=ie?ie.frequency/1e6:0;Math.abs(t-s)>1e-4&&(e.frequency_mhz=t);const a=ie?ie.bandwidth/1e3:0;fe!==a&&(e.bandwidth_khz=fe),ve!==(null==ie?void 0:ie.spreading_factor)&&(e.spreading_factor=ve),we!==(null==ie?void 0:ie.coding_rate)&&(e.coding_rate=we);const r=parseInt(Ce);if(r!==(null==ie?void 0:ie.tx_power)&&(e.tx_power=r),0===Object.keys(e).length)return Ee({success:!0,message:"No changes to save"}),Te("idle"),void ce(te);const l=await y(e);if(!bt.current)return void ce(te);if(l.success&&l.data){const e=l.data.applied.join(", "),t=l.data.live_update?" (applied live)":" (restart required)";Ee({success:!0,message:`Updated: ${e}${t}`}),await le({force:!0}),Te("success"),Me.current=setTimeout(()=>{bt.current&&(Te("idle"),he(!1),Ee(null),ce(te))},1500)}else Ee({success:!1,message:l.error||"Failed to save"}),Te("error"),ce(te),Me.current=setTimeout(()=>{bt.current&&Te("idle")},2e3)}catch(e){if(!bt.current)return void ce(te);Ee({success:!1,message:String(e)}),Te("error"),ce(te),Me.current=setTimeout(()=>{bt.current&&Te("idle")},2e3)}}},disabled:"loading"===_e||!Ks,className:s("p-2 rounded-lg transition-colors","loading"===_e?"text-accent-primary cursor-wait":"success"===_e?"text-accent-success":"error"===_e?"text-accent-danger":Ks?"text-accent-success hover:bg-accent-success/10":"text-text-muted cursor-not-allowed"),title:Ks?"Save changes":"No changes to save",children:"loading"===_e?t.jsx(_,{className:"w-4 h-4 animate-spin"}):"success"===_e?t.jsx(T,{className:"w-4 h-4"}):"error"===_e?t.jsx(o,{className:"w-4 h-4"}):t.jsx(T,{className:"w-4 h-4"})})]}):t.jsx("button",{onClick:()=>{ie&&(ge((ie.frequency/1e6).toFixed(3)),je(ie.bandwidth/1e3),Ne(ie.spreading_factor),ke(ie.coding_rate),Se(String(ie.tx_power))),Ee(null),he(!0)},className:"p-2 rounded-lg transition-colors text-text-muted hover:text-text-primary hover:bg-bg-subtle",title:"Edit radio settings",children:t.jsx(V,{className:"w-4 h-4"})}))})]}),Fe&&t.jsx("div",{className:s("text-xs mb-3 px-2 py-1.5 rounded-md",Fe.success?"text-accent-success bg-accent-success/10":"text-accent-danger bg-accent-danger/10"),children:Fe.message}),ie?t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:be?"Frequency (MHz)":"Frequency"}),t.jsx("div",{className:s("h-[38px] rounded-full px-4 flex items-center transition-colors",be?"bg-subtle-fill-hover":"bg-subtle-fill"),children:be?t.jsx("input",{type:"number",value:ye,onChange:e=>ge(e.target.value),step:"0.001",min:"400",max:"930",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):t.jsx("span",{className:"type-data text-text-primary",children:x(ie.frequency)})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:be?"TX Power (dBm)":"TX Power"}),t.jsx("div",{className:s("h-[38px] rounded-full px-4 flex items-center transition-colors",be?"bg-subtle-fill-hover":"bg-subtle-fill"),children:be?t.jsx("input",{type:"number",value:Ce,onChange:e=>Se(e.target.value),min:"-9",max:"22",className:"w-full bg-transparent text-text-primary focus:outline-none type-data"}):t.jsxs("span",{className:"type-data text-text-primary",children:[ie.tx_power," dBm"]})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Bandwidth"}),t.jsx("div",{className:s("h-[38px] rounded-full px-4 flex items-center transition-colors relative",be?"bg-subtle-fill-hover":"bg-subtle-fill"),children:be?t.jsxs(t.Fragment,{children:[t.jsx("select",{value:fe,onChange:e=>je(parseFloat(e.target.value)),className:"w-full bg-transparent text-text-primary focus:outline-none appearance-none cursor-pointer type-data pr-6",children:Q.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))}),t.jsx(p,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]}):t.jsx("span",{className:"type-data text-text-primary",children:b(ie.bandwidth)})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Spreading Factor"}),t.jsx("div",{className:s("h-[38px] rounded-full px-4 flex items-center transition-colors relative",be?"bg-subtle-fill-hover":"bg-subtle-fill"),children:be?t.jsxs(t.Fragment,{children:[t.jsx("select",{value:ve,onChange:e=>Ne(parseInt(e.target.value)),className:"w-full bg-transparent text-text-primary focus:outline-none appearance-none cursor-pointer type-data pr-6",children:Z.map(e=>t.jsxs("option",{value:e,children:["SF",e]},e))}),t.jsx(p,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]}):t.jsxs("span",{className:"type-data text-text-primary",children:["SF",ie.spreading_factor]})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Coding Rate"}),t.jsx("div",{className:s("h-[38px] rounded-full px-4 flex items-center transition-colors relative",be?"bg-subtle-fill-hover":"bg-subtle-fill"),children:be?t.jsxs(t.Fragment,{children:[t.jsx("select",{value:we,onChange:e=>ke(parseInt(e.target.value)),className:"w-full bg-transparent text-text-primary focus:outline-none appearance-none cursor-pointer type-data pr-6",children:ee.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))}),t.jsx(p,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted pointer-events-none"})]}):t.jsxs("span",{className:"type-data text-text-primary",children:["4/",ie.coding_rate]})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-1",children:"Preamble"}),t.jsx("div",{className:"h-[38px] rounded-full px-4 flex items-center bg-subtle-fill",children:t.jsxs("span",{className:"type-data text-text-primary",children:[ie.preamble_length," symbols"]})})]})]}):t.jsx("p",{className:"text-text-muted",children:"Loading radio configuration..."})]})})})]}),t.jsxs(L,{template:"standard",children:[t.jsx(M,{span:12,md:6,children:t.jsx(w,{children:t.jsxs("div",{ref:$e,children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("h2",{className:"type-subheading text-text-primary flex items-center gap-3",children:[t.jsx(h,{className:"icon-md text-icon-card-title"}),"Operating Mode"]}),t.jsx("div",{className:"flex items-center gap-1",children:Pe?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:async()=>{if("loading"!==Ke){Ve.current&&clearTimeout(Ve.current),ne(ae),He("loading");try{const e=await y({tx_delay_factor:parseFloat(ze),direct_tx_delay_factor:parseFloat(Ae)});if(await X({max_airtime_percent:parseFloat(Oe),enforcement_enabled:xe}),!bt.current)return void ce(ae);e.success&&e.data?(await le({force:!0}),He("success"),Ve.current=setTimeout(()=>{bt.current&&(He("idle"),Re(!1),ce(ae))},1500)):(He("error"),ce(ae),Ve.current=setTimeout(()=>{bt.current&&He("idle")},2e3))}catch{if(!bt.current)return void ce(ae);He("error"),ce(ae),Ve.current=setTimeout(()=>{bt.current&&He("idle")},2e3)}}},disabled:"loading"===Ke,className:s("p-2 rounded-lg transition-colors","loading"===Ke?"text-accent-primary cursor-wait":"success"===Ke?"text-accent-success":"error"===Ke?"text-accent-danger":"text-accent-success hover:bg-accent-success/10"),title:"Save",children:"loading"===Ke?t.jsx(_,{className:"w-4 h-4 animate-spin"}):"success"===Ke?t.jsx(T,{className:"w-4 h-4"}):"error"===Ke?t.jsx(o,{className:"w-4 h-4"}):t.jsx(T,{className:"w-4 h-4"})}),t.jsx("button",{onClick:Bs,className:"p-2 rounded-lg text-text-muted hover:text-accent-danger hover:bg-accent-danger/10",title:"Cancel",children:t.jsx(o,{className:"w-4 h-4"})})]}):t.jsx("button",{onClick:Us,className:"p-2 rounded-lg transition-colors text-text-muted hover:text-text-primary hover:bg-bg-subtle",title:"Edit settings",children:t.jsx(V,{className:"w-4 h-4"})})})]}),t.jsx("p",{className:"type-label text-text-muted mb-3",children:"Control how the repeater handles packets"}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsxs("div",{className:"flex-1 space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"type-label text-text-muted",children:"Repeat"}),t.jsx("div",{className:"flex items-center gap-2",children:(()=>{const e=null!==ut?ut:"forward"===me;return t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:async()=>{if("loading"===ct)return;const t=!e,s="forward"===me;ht.current&&clearTimeout(ht.current),yt.current&&clearTimeout(yt.current),jt.current=!1,mt(t),it("loading"),ht.current=setTimeout(()=>{jt.current||bt.current&&(mt(s),it("error"),yt.current=setTimeout(()=>{bt.current&&(it("idle"),mt(null))},2e3))},1e4);try{if(await O(t?"forward":"monitor"),jt.current=!0,ht.current&&clearTimeout(ht.current),!bt.current)return;it("success"),yt.current=setTimeout(()=>{bt.current&&(it("idle"),mt(null),U())},2e3)}catch{if(jt.current=!0,ht.current&&clearTimeout(ht.current),!bt.current)return;mt(s),it("error"),yt.current=setTimeout(()=>{bt.current&&(it("idle"),mt(null))},2e3)}},disabled:"loading"===ct,className:s("relative inline-flex h-6 w-11 items-center rounded-full transition-colors border-2",e?"bg-toggle-on border-toggle-on":"bg-toggle-off border-border-subtle","loading"===ct&&"opacity-70"),"aria-label":"Toggle forward mode",children:t.jsx("span",{className:s("inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-lg",e?"translate-x-5":"translate-x-0.5")})}),t.jsx("span",{className:s("type-data text-sm w-7",e?"text-accent-success":"text-text-muted"),children:e?"On":"Off"}),"loading"===ct&&t.jsx(_,{className:"w-4 h-4 text-text-muted animate-spin"}),"success"===ct&&t.jsx(T,{className:"w-4 h-4 text-accent-success"}),"error"===ct&&t.jsx(o,{className:"w-4 h-4 text-accent-danger"})]})})()})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"type-label text-text-muted",children:"Duty Cycle"}),t.jsx("div",{className:"flex items-center gap-2",children:(()=>{const e=null!==xt?xt:xe;return t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:async()=>{if("loading"===ot)return;const t=!e,s=xe;gt.current&&clearTimeout(gt.current),ft.current&&clearTimeout(ft.current),vt.current=!1,pt(t),dt("loading"),gt.current=setTimeout(()=>{vt.current||bt.current&&(pt(s),dt("error"),ft.current=setTimeout(()=>{bt.current&&(dt("idle"),pt(null))},2e3))},1e4);try{if(await X({max_airtime_percent:Ys(),enforcement_enabled:t}),vt.current=!0,gt.current&&clearTimeout(gt.current),!bt.current)return;dt("success"),ft.current=setTimeout(()=>{bt.current&&(dt("idle"),pt(null),J())},2e3)}catch{if(vt.current=!0,gt.current&&clearTimeout(gt.current),!bt.current)return;pt(s),dt("error"),ft.current=setTimeout(()=>{bt.current&&(dt("idle"),pt(null))},2e3)}},disabled:"loading"===ot,className:s("relative inline-flex h-6 w-11 items-center rounded-full transition-colors border-2",e?"bg-toggle-on border-toggle-on":"bg-toggle-off border-border-subtle","loading"===ot&&"opacity-70"),"aria-label":"Toggle duty cycle",children:t.jsx("span",{className:s("inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-lg",e?"translate-x-5":"translate-x-0.5")})}),t.jsx("span",{className:s("type-data text-sm w-7",e?"text-accent-success":"text-text-muted"),children:e?"On":"Off"}),"loading"===ot&&t.jsx(_,{className:"w-4 h-4 text-text-muted animate-spin"}),"success"===ot&&t.jsx(T,{className:"w-4 h-4 text-accent-success"}),"error"===ot&&t.jsx(o,{className:"w-4 h-4 text-accent-danger"})]})})()})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"type-label text-text-muted",children:"Max Airtime"}),t.jsx("div",{className:s("h-[32px] rounded-full px-3 flex items-center justify-end transition-colors min-w-[80px]",Pe?"bg-subtle-fill-hover":"bg-subtle-fill"),children:Pe?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("input",{type:"number",value:Oe,onChange:e=>qe(e.target.value),step:"0.5",min:"0.1",max:"100",className:"w-12 bg-transparent text-text-primary text-right focus:outline-none type-data"}),t.jsx("span",{className:"text-text-muted type-data",children:"%"})]}):t.jsxs("span",{className:"type-data text-text-primary",children:[Ys().toFixed(1),"%"]})})]})]}),t.jsx("div",{className:"hidden sm:block w-px bg-border-subtle"}),t.jsxs("div",{className:"flex-1 pt-4 sm:pt-0 border-t sm:border-t-0 border-border-subtle",children:[t.jsx("label",{className:"type-label text-text-muted block mb-3",children:"TX Delays"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"type-label text-text-muted",children:"Flood"}),t.jsx("div",{className:s("h-[32px] rounded-full px-3 flex items-center justify-end transition-colors min-w-[80px]",Pe?"bg-subtle-fill-hover":"bg-subtle-fill"),children:Pe?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("input",{type:"number",value:ze,onChange:e=>De(e.target.value),step:"0.1",min:"0",max:"5",className:"w-12 bg-transparent text-text-primary text-right focus:outline-none type-data"}),t.jsx("span",{className:"text-text-muted type-data",children:"x"})]}):t.jsxs("span",{className:"type-data text-text-primary",children:[Vs().toFixed(2),"x"]})})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"type-label text-text-muted",children:"Direct"}),t.jsx("div",{className:s("h-[32px] rounded-full px-3 flex items-center justify-end transition-colors min-w-[80px]",Pe?"bg-subtle-fill-hover":"bg-subtle-fill"),children:Pe?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("input",{type:"number",value:Ae,onChange:e=>Ie(e.target.value),step:"0.1",min:"0",max:"5",className:"w-12 bg-transparent text-text-primary text-right focus:outline-none type-data"}),t.jsx("span",{className:"text-text-muted type-data",children:"s"})]}):t.jsxs("span",{className:"type-data text-text-primary",children:[$s().toFixed(2),"s"]})})]})]})]})]})]})})}),t.jsx(M,{span:12,md:6,children:t.jsxs(w,{children:[t.jsx(S,{icon:t.jsx(u,{}),title:"App Settings",largeTitle:!0}),t.jsx("p",{className:"type-body-sm text-text-muted mb-4",children:"Appearance and web server options."}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("span",{className:"type-body text-text-primary font-medium block",children:"Enable CORS"}),t.jsx("span",{className:"type-body-sm text-text-muted",children:"Allow cross-origin API access"})]}),t.jsx("div",{className:"flex items-center gap-2",children:(()=>{const e=null!==Ct?Ct:(null==Nt?void 0:Nt.cors_enabled)??!1;return t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:Gs,disabled:"loading"===wt,className:s("relative inline-flex h-6 w-11 items-center rounded-full transition-colors border-2",e?"bg-toggle-on border-toggle-on":"bg-toggle-off border-border-subtle","loading"===wt&&"opacity-70"),title:e?"Disable CORS":"Enable CORS",children:t.jsx("span",{className:s("inline-block h-4 w-4 transform rounded-full bg-white transition-transform shadow-lg",e?"translate-x-5":"translate-x-0.5")})}),"loading"===wt&&t.jsx(_,{className:"w-4 h-4 text-text-muted animate-spin"}),"success"===wt&&t.jsx(T,{className:"w-4 h-4 text-accent-success"}),"error"===wt&&t.jsx(o,{className:"w-4 h-4 text-accent-danger"})]})})()})]}),t.jsx("div",{children:t.jsx(G,{})})]})]})})]}),t.jsx(L,{template:"auto",children:t.jsxs(w,{children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"type-heading text-text-primary flex items-center gap-2",children:[t.jsx(q,{className:"icon-md text-accent-primary"}),"Regions / Transport Keys"]}),t.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Manage regional key hierarchy for flood control"})]}),t.jsxs("div",{className:"flex gap-2 flex-wrap",children:[t.jsxs("button",{onClick:()=>xs(!0),disabled:"allow"===rs,className:s("flex items-center gap-1.5 h-[32px] px-3 rounded-full transition-colors type-body-sm font-medium","allow"===rs?"bg-subtle-fill text-text-muted cursor-not-allowed":"bg-accent-success/10 hover:bg-accent-success/20 text-accent-success"),children:[t.jsx(f,{className:"w-3.5 h-3.5"}),"Add"]}),t.jsx("button",{onClick:ia,disabled:!is||"allow"===rs,className:s("h-[32px] px-3 rounded-full transition-colors type-body-sm font-medium",is&&"allow"!==rs?"bg-accent-primary/10 hover:bg-accent-primary/20 text-accent-primary":"bg-subtle-fill text-text-muted cursor-not-allowed"),children:"Edit"}),t.jsx("button",{onClick:oa,disabled:!is||"allow"===rs,className:s("h-[32px] px-3 rounded-full transition-colors type-body-sm font-medium",is&&"allow"!==rs?"bg-accent-danger/10 hover:bg-accent-danger/20 text-accent-danger":"bg-subtle-fill text-text-muted cursor-not-allowed"),children:"Delete"})]})]}),t.jsx("div",{className:"bg-subtle-fill rounded-2xl p-4 mb-4",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:s("w-10 h-10 rounded-full flex items-center justify-center","allow"===rs?"bg-accent-success/20":"bg-accent-danger/20"),children:"allow"===rs?t.jsx($,{className:"w-5 h-5 text-accent-success"}):t.jsx(Y,{className:"w-5 h-5 text-accent-danger"})}),t.jsxs("div",{children:[t.jsx("h4",{className:"type-body text-text-primary font-medium",children:"Global Flood Policy"}),t.jsx("p",{className:"type-body-sm text-text-muted",children:"Master control for repeater flooding"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"flex bg-subtle-fill rounded-full p-1",children:[t.jsx("button",{onClick:()=>na("deny"),disabled:ns,className:s("px-4 py-1.5 rounded-full transition-colors type-body-sm font-medium","deny"===rs?"bg-accent-danger/20 text-accent-danger":"text-text-muted hover:text-text-secondary",ns&&"opacity-50"),children:"Deny"}),t.jsx("button",{onClick:()=>na("allow"),disabled:ns,className:s("px-4 py-1.5 rounded-full transition-colors type-body-sm font-medium","allow"===rs?"bg-accent-success/20 text-accent-success":"text-text-muted hover:text-text-secondary",ns&&"opacity-50"),children:"Allow"})]}),ns&&t.jsx(_,{className:"w-4 h-4 animate-spin text-text-muted"})]})]})}),ss&&t.jsx("div",{className:"type-body-sm mb-3 px-3 py-2 rounded-full text-accent-danger bg-accent-danger/10",children:ss}),t.jsx("div",{className:"bg-subtle-fill rounded-2xl p-4 min-h-[120px]",children:es?t.jsxs("div",{className:"flex items-center justify-center py-6",children:[t.jsx(_,{className:"w-5 h-5 animate-spin text-accent-primary mr-2"}),t.jsx("span",{className:"type-body-sm text-text-muted",children:"Loading transport keys..."})]}):0===Qt.length?t.jsxs("div",{className:"text-center py-6",children:[t.jsx("div",{className:"w-12 h-12 rounded-full bg-subtle-fill mx-auto mb-3 flex items-center justify-center",children:t.jsx(q,{className:"w-6 h-6 text-text-muted/50"})}),t.jsx("p",{className:"type-body text-text-muted",children:"No transport keys found"}),t.jsx("p",{className:"type-body-sm text-text-muted/70 mt-1",children:"Add your first transport key to get started"})]}):t.jsx("div",{className:"space-y-1",children:Qt.map(e=>t.jsx(re,{node:e,level:0,expandedKeys:ds,selectedKeyId:is,globalFloodPolicy:rs,onSelect:os,onToggle:la},e.id))})})]})}),t.jsx(L,{template:"auto",children:t.jsxs(w,{children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"type-heading text-text-primary flex items-center gap-2",children:[t.jsx(K,{className:"icon-md text-accent-primary"}),"API Tokens"]}),t.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Manage API tokens for machine-to-machine authentication"})]}),t.jsxs("button",{onClick:()=>At(!0),className:"flex items-center justify-center gap-2 h-[32px] px-4 bg-accent-primary/10 hover:bg-accent-primary/20 text-accent-primary rounded-full transition-colors type-body-sm font-medium",children:[t.jsx(f,{className:"w-4 h-4"}),"Create Token"]})]}),t.jsx("div",{className:"bg-accent-tertiary/5 rounded-2xl p-4 mb-4",children:t.jsxs("div",{className:"flex gap-3",children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-accent-tertiary/20 flex items-center justify-center flex-shrink-0",children:t.jsx(E,{className:"w-4 h-4 text-accent-tertiary"})}),t.jsxs("div",{className:"type-body-sm text-text-muted",children:[t.jsxs("p",{children:[t.jsx("span",{className:"text-text-secondary",children:"API tokens"})," are used for machine-to-machine authentication. Include the token in the ",t.jsx("code",{className:"type-code bg-accent-tertiary/20 px-1.5 py-0.5 rounded-full text-accent-tertiary",children:"X-API-Key"})," header when making API requests."]}),t.jsx("p",{className:"mt-1 text-text-muted/70",children:"Tokens are only shown once at creation. Store them securely."})]})]})}),Rt&&t.jsx("div",{className:"type-body-sm mb-3 px-3 py-2 rounded-full text-accent-danger bg-accent-danger/10",children:Rt}),Mt&&0===Et.length?t.jsxs("div",{className:"flex items-center justify-center py-6",children:[t.jsx(_,{className:"w-5 h-5 animate-spin text-accent-primary mr-2"}),t.jsx("span",{className:"type-body-sm text-text-muted",children:"Loading tokens..."})]}):Et.length>0?t.jsx("div",{className:"space-y-2",children:Et.map(e=>t.jsx("div",{className:"bg-subtle-fill hover:bg-subtle-fill-strong rounded-2xl p-4 transition-colors",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-accent-primary/10 flex items-center justify-center flex-shrink-0",children:t.jsx(K,{className:"w-5 h-5 text-accent-primary"})}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("h3",{className:"type-body text-text-primary font-medium truncate",children:e.name}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:gap-4 mt-0.5",children:[t.jsxs("span",{className:"type-data-sm text-text-muted truncate",children:["Created: ",ea(e.created_at)]}),t.jsxs("span",{className:"type-data-sm text-text-muted truncate",children:["Last used: ",ea(e.last_used)]})]})]})]}),t.jsxs("button",{onClick:()=>Yt({id:e.id,name:e.name}),disabled:Xt,className:"h-[32px] px-4 bg-accent-danger/10 hover:bg-accent-danger/20 text-accent-danger rounded-full transition-colors disabled:opacity-50 type-body-sm font-medium flex items-center justify-center gap-1.5",children:[t.jsx(g,{className:"w-3.5 h-3.5"}),"Revoke"]})]})},e.id))}):t.jsxs("div",{className:"bg-subtle-fill rounded-2xl p-6 text-center",children:[t.jsx("div",{className:"w-14 h-14 rounded-full bg-subtle-fill mx-auto mb-4 flex items-center justify-center",children:t.jsx(K,{className:"w-7 h-7 text-text-muted/50"})}),t.jsx("h3",{className:"type-body text-text-primary font-medium mb-1",children:"No API Tokens"}),t.jsx("p",{className:"type-body-sm text-text-muted mb-4",children:"Create a token to enable API access"}),t.jsx("button",{onClick:()=>At(!0),className:"h-[32px] px-4 bg-accent-primary/10 hover:bg-accent-primary/20 text-accent-primary rounded-full transition-colors type-body-sm font-medium",children:"Create Your First Token"})]})]})}),t.jsx(L,{template:"auto",children:t.jsxs(w,{children:[t.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:t.jsxs("div",{children:[t.jsxs("h2",{className:"type-heading text-text-primary flex items-center gap-2",children:[t.jsx(H,{className:"icon-md text-accent-primary"}),"Web Frontend"]}),t.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Choose which web interface to use"})]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("label",{className:s("flex items-start gap-3 p-4 bg-subtle-fill rounded-2xl border-2 cursor-pointer transition-all",Ts?"border-accent-primary bg-accent-primary/5":"border-transparent hover:border-accent-primary/30","loading"===Rs&&"opacity-50 pointer-events-none"),children:[t.jsx("input",{type:"radio",name:"frontend",checked:Ts,onChange:()=>Ws(!0),disabled:"loading"===Rs,className:"mt-1 h-4 w-4 text-accent-primary focus:ring-accent-primary focus:ring-offset-bg-elevated"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"type-body text-text-primary font-medium",children:"Default Frontend"}),t.jsx("a",{href:"https://github.com/rightup/pyMC_Repeater",target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"type-data-xs bg-accent-tertiary/15 text-accent-tertiary px-2.5 py-0.5 rounded-full font-medium hover:bg-accent-tertiary/25 transition-colors",children:"@RightUp"})]}),t.jsx("div",{className:"type-body-sm text-text-muted mt-1",children:"Built-in pyMC Repeater web interface"}),t.jsx("div",{className:"type-data-xs text-text-muted/60 mt-1 font-mono",children:"/opt/pymc_repeater/repeater/web/html"})]})]}),t.jsxs("label",{className:s("flex items-start gap-3 p-4 bg-subtle-fill rounded-2xl border-2 cursor-pointer transition-all",Ts?"border-transparent hover:border-accent-primary/30":"border-accent-primary bg-accent-primary/5","loading"===Rs&&"opacity-50 pointer-events-none"),children:[t.jsx("input",{type:"radio",name:"frontend",checked:!Ts,onChange:()=>Ws(!1),disabled:"loading"===Rs,className:"mt-1 h-4 w-4 text-accent-primary focus:ring-accent-primary focus:ring-offset-bg-elevated"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"type-body text-text-primary font-medium",children:"PyMC Console"}),t.jsx("span",{className:"type-data-xs bg-accent-secondary/15 text-accent-secondary px-2.5 py-0.5 rounded-full font-medium",children:"@Treehouse ⚡"})]}),t.jsx("div",{className:"type-body-sm text-text-muted mt-1",children:"Alternative web interface for pyMC Repeater"}),t.jsx("div",{className:"type-data-xs text-text-muted/60 mt-1 font-mono",children:"/opt/pymc_console/web/html"})]})]})]}),!Ms&&t.jsx("div",{className:s("bg-subtle-fill rounded-2xl p-4",Es?"border border-accent-success/20":"border border-accent-tertiary/20"),children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:s("w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",Es?"bg-accent-success/20":"bg-accent-tertiary/20"),children:Es?t.jsx(P,{className:"w-4 h-4 text-accent-success"}):t.jsx(E,{className:"w-4 h-4 text-accent-tertiary"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"type-body text-text-primary font-medium",children:Es?"PyMC Console has been detected":"PyMC Console Not Installed"}),Es?t.jsxs("p",{className:"type-body-sm text-text-muted mt-1",children:["PyMC Console is installed at ",t.jsx("code",{className:"type-code bg-accent-success/10 px-1.5 py-0.5 rounded-full text-accent-success",children:"/opt/pymc_console/web/html"})]}):t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"type-body-sm text-text-muted mt-1 mb-3",children:["PyMC Console must be installed at ",t.jsx("code",{className:"type-code bg-accent-tertiary/10 px-1.5 py-0.5 rounded-full text-accent-tertiary",children:"/opt/pymc_console/web/html"})," before selecting this option."]}),t.jsxs("a",{href:"https://github.com/dmduran12/pymc_console-dist",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 h-[32px] px-4 bg-accent-tertiary/10 hover:bg-accent-tertiary/20 text-accent-tertiary rounded-full type-body-sm font-medium transition-colors",children:[t.jsx(I,{className:"w-4 h-4"}),"PyMC Console Install Instructions"]})]})]})]})}),Ds&&t.jsx("div",{className:"bg-subtle-fill rounded-2xl p-4 border border-accent-secondary/30",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[t.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-accent-secondary/20 flex items-center justify-center flex-shrink-0",children:t.jsx(R,{className:"w-4 h-4 text-accent-secondary"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"type-body text-text-primary font-medium",children:"Service restart required"}),t.jsx("p",{className:"type-body-sm text-text-muted mt-1",children:"Web frontend changes will take effect after restarting the pymc-repeater service."})]})]}),t.jsx("button",{onClick:async()=>{if(!Is){Os(!0);try{await async function(){return r("/api/restart_service",{method:"POST",body:"{}"})}(),As(!1),setTimeout(()=>{window.location.reload()},2e3)}catch{As(!1),setTimeout(()=>{window.location.reload()},3e3)}}},disabled:Is,className:"h-[32px] px-4 bg-accent-secondary/10 hover:bg-accent-secondary/20 text-accent-secondary rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 whitespace-nowrap type-body-sm font-medium",children:Is?t.jsxs(t.Fragment,{children:[t.jsx(_,{className:"w-4 h-4 animate-spin"}),"Restarting..."]}):t.jsxs(t.Fragment,{children:[t.jsx(z,{className:"w-4 h-4"}),"Restart Now"]})})]})})]})]})}),D&&t.jsx(L,{template:"auto",children:t.jsx(N,{nodeName:ue,repeaterVersion:D.version,coreVersion:D.core_version,localHash:D.local_hash,publicKey:D.public_key})}),D&&(0===(null==oe?void 0:oe.latitude)||!(null==oe?void 0:oe.latitude))&&(0===(null==oe?void 0:oe.longitude)||!(null==oe?void 0:oe.longitude))&&t.jsx(L,{template:"auto",children:t.jsx(W,{})}),Dt&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&At(!1),role:"dialog","aria-modal":"true","aria-labelledby":"create-token-modal-title",children:t.jsxs("div",{className:"bg-bg-elevated border border-border-subtle rounded-xl p-6 max-w-md w-full shadow-2xl",children:[t.jsx("h3",{id:"create-token-modal-title",className:"type-subheading text-text-primary mb-4",children:"Create API Token"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Token Name"}),t.jsx("input",{type:"text",value:It,onChange:e=>Ot(e.target.value),placeholder:"e.g., Production Server, CI/CD Pipeline",className:"w-full px-4 py-2 bg-bg-subtle border border-border-subtle rounded-lg text-text-primary placeholder-text-muted focus:outline-none focus:ring-2 focus:ring-accent-primary/50 transition-colors",onKeyDown:e=>"Enter"===e.key&&Zs(),autoFocus:!0}),t.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Give your token a descriptive name to identify its purpose"})]}),t.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[t.jsx("button",{onClick:()=>{At(!1),Ot(""),zt(null)},disabled:Ut,className:"px-4 py-2 bg-bg-subtle hover:bg-bg-elevated text-text-secondary rounded-lg border border-border-subtle transition-colors disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:Zs,disabled:Ut||!It.trim(),className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary rounded-lg border border-accent-primary/50 transition-colors disabled:opacity-50 flex items-center gap-2",children:Ut?t.jsxs(t.Fragment,{children:[t.jsx(_,{className:"w-4 h-4 animate-spin"}),"Creating..."]}):"Create Token"})]})]})]})}),Ht&&qt&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&Vt(!1),role:"dialog","aria-modal":"true","aria-labelledby":"show-token-modal-title",children:t.jsxs("div",{className:"bg-bg-elevated border border-border-subtle rounded-xl p-6 max-w-lg w-full shadow-2xl",children:[t.jsx("h3",{id:"show-token-modal-title",className:"type-subheading text-text-primary mb-4",children:"Token Created Successfully"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"bg-accent-secondary/10 border border-accent-secondary/30 rounded-lg p-3",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx(R,{className:"w-4 h-4 text-accent-secondary flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"text-sm text-text-secondary",children:[t.jsx("strong",{children:"Save this token now!"})," For security reasons, it will not be shown again."]})]})}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Your API Token"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{value:qt,readOnly:!0,className:"flex-1 px-4 py-2 bg-bg-subtle border border-border-subtle rounded-lg text-text-primary font-mono text-sm"}),t.jsxs("button",{onClick:()=>{qt&&(navigator.clipboard.writeText(qt),Wt(!0),setTimeout(()=>Wt(!1),2e3))},className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary rounded-lg border border-accent-primary/50 transition-colors flex items-center gap-2",title:"Copy to clipboard",children:[Gt?t.jsx(T,{className:"w-4 h-4 text-accent-success"}):t.jsx(F,{className:"w-4 h-4"}),Gt?"Copied!":"Copy"]})]})]}),t.jsxs("div",{className:"bg-accent-tertiary/10 border border-accent-tertiary/30 rounded-lg p-3",children:[t.jsx("p",{className:"text-sm text-text-secondary mb-2",children:t.jsx("strong",{children:"Usage Example:"})}),t.jsxs("code",{className:"block bg-accent-tertiary/20 px-3 py-2 rounded text-xs text-accent-tertiary font-mono overflow-x-auto",children:['curl -H "X-API-Key: ',qt.slice(0,12),'..." ',window.location.origin,"/api/stats"]})]}),t.jsx("div",{className:"flex justify-end mt-6",children:t.jsx("button",{onClick:()=>{Vt(!1),Kt(null)},className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary rounded-lg border border-accent-primary/50 transition-colors",children:"Done"})})]})]})}),t.jsx(j,{isOpen:!!$t,title:"Revoke API Token",message:`Are you sure you want to revoke the token '${null==$t?void 0:$t.name}'? This action cannot be undone.`,confirmLabel:Xt?"Revoking...":"Revoke",cancelLabel:"Cancel",variant:"danger",onConfirm:async()=>{if($t){Jt(!0),zt(null);try{await async function(e){return r(`/auth/tokens/${e}`,{method:"DELETE"})}($t.id),await Qs(),Yt(null)}catch(e){zt(e instanceof Error?e.message:"Failed to revoke token")}finally{Jt(!1)}}},onCancel:()=>Yt(null)}),ms&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&xs(!1),role:"dialog","aria-modal":"true","aria-labelledby":"add-key-modal-title",children:t.jsxs("div",{className:"bg-bg-elevated border border-border-subtle rounded-xl p-6 max-w-md w-full shadow-2xl",children:[t.jsx("h3",{id:"add-key-modal-title",className:"type-subheading text-text-primary mb-4",children:"Add Transport Key"}),t.jsxs("div",{className:"space-y-4",children:[is&&t.jsxs("div",{className:"bg-accent-tertiary/10 border border-accent-tertiary/30 rounded-lg p-3 text-sm text-text-secondary",children:["Adding as child of: ",t.jsx("strong",{className:"text-text-primary",children:ra()})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Key Name"}),t.jsx("input",{type:"text",value:Ns,onChange:e=>ws(e.target.value),placeholder:"e.g., Region Name, Group Key",className:"w-full px-4 py-2 bg-bg-subtle border border-border-subtle rounded-lg text-text-primary placeholder-text-muted focus:outline-none focus:ring-2 focus:ring-accent-primary/50 transition-colors",onKeyDown:e=>"Enter"===e.key&&ca(),autoFocus:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Flood Policy"}),t.jsxs("div",{className:"flex bg-bg-subtle rounded-lg border border-border-subtle p-1",children:[t.jsx("button",{onClick:()=>Cs("deny"),className:s("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","deny"===ks?"bg-accent-danger/20 text-accent-danger border border-accent-danger/50":"text-text-muted hover:text-text-secondary"),children:"DENY"}),t.jsx("button",{onClick:()=>Cs("allow"),className:s("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","allow"===ks?"bg-accent-success/20 text-accent-success border border-accent-success/50":"text-text-muted hover:text-text-secondary"),children:"ALLOW"})]})]}),t.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[t.jsx("button",{onClick:()=>{xs(!1),ws(""),Cs("deny")},disabled:Ss,className:"px-4 py-2 bg-bg-subtle hover:bg-bg-elevated text-text-secondary rounded-lg border border-border-subtle transition-colors disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:ca,disabled:Ss||!Ns.trim(),className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary rounded-lg border border-accent-primary/50 transition-colors disabled:opacity-50 flex items-center gap-2",children:Ss?t.jsxs(t.Fragment,{children:[t.jsx(_,{className:"w-4 h-4 animate-spin"}),"Adding..."]}):"Add Key"})]})]})]})}),ps&&gs&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&bs(!1),role:"dialog","aria-modal":"true","aria-labelledby":"edit-key-modal-title",children:t.jsxs("div",{className:"bg-bg-elevated border border-border-subtle rounded-xl p-6 max-w-md w-full shadow-2xl",children:[t.jsx("h3",{id:"edit-key-modal-title",className:"type-subheading text-text-primary mb-4",children:"Edit Transport Key"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Key Name"}),t.jsx("input",{type:"text",value:gs.name,onChange:e=>fs({...gs,name:e.target.value}),className:"w-full px-4 py-2 bg-bg-subtle border border-border-subtle rounded-lg text-text-primary focus:outline-none focus:ring-2 focus:ring-accent-primary/50 transition-colors",autoFocus:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Flood Policy"}),t.jsxs("div",{className:"flex bg-bg-subtle rounded-lg border border-border-subtle p-1",children:[t.jsx("button",{onClick:()=>fs({...gs,floodPolicy:"deny"}),className:s("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","deny"===gs.floodPolicy?"bg-accent-danger/20 text-accent-danger border border-accent-danger/50":"text-text-muted hover:text-text-secondary"),children:"DENY"}),t.jsx("button",{onClick:()=>fs({...gs,floodPolicy:"allow"}),className:s("flex-1 px-3 py-2 text-sm font-medium rounded transition-colors","allow"===gs.floodPolicy?"bg-accent-success/20 text-accent-success border border-accent-success/50":"text-text-muted hover:text-text-secondary"),children:"ALLOW"})]})]}),gs.transport_key&&t.jsxs("div",{children:[t.jsx("label",{className:"type-label text-text-muted block mb-2",children:"Transport Key"}),t.jsx("code",{className:"block bg-bg-subtle px-3 py-2 rounded-lg text-xs text-text-muted font-mono overflow-x-auto",children:gs.transport_key})]}),t.jsxs("div",{className:"flex justify-between gap-3 mt-6",children:[t.jsx("button",{onClick:()=>{bs(!1),vs(gs),ys(!0),fs(null)},disabled:Ss,className:"px-4 py-2 bg-accent-danger/20 hover:bg-accent-danger/30 text-accent-danger rounded-lg border border-accent-danger/50 transition-colors disabled:opacity-50",children:"Delete"}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:()=>{bs(!1),fs(null)},disabled:Ss,className:"px-4 py-2 bg-bg-subtle hover:bg-bg-elevated text-text-secondary rounded-lg border border-border-subtle transition-colors disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(gs){_s(!0),as(null);try{const e=await async function(e,t){return r(`/api/transport_key/${e}`,{method:"PUT",body:JSON.stringify(t)})}(gs.id,{name:gs.name,flood_policy:gs.floodPolicy});e.success?(await sa(),bs(!1),fs(null)):as(e.error||"Failed to update transport key")}catch(e){as(e instanceof Error?e.message:"Failed to update transport key")}finally{_s(!1)}}},disabled:Ss||!gs.name.trim(),className:"px-4 py-2 bg-accent-primary/20 hover:bg-accent-primary/30 text-text-primary rounded-lg border border-accent-primary/50 transition-colors disabled:opacity-50 flex items-center gap-2",children:Ss?t.jsxs(t.Fragment,{children:[t.jsx(_,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):"Save"})]})]})]})]})}),hs&&js&&t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:e=>e.target===e.currentTarget&&ys(!1),role:"dialog","aria-modal":"true","aria-labelledby":"delete-key-modal-title",children:t.jsxs("div",{className:"bg-bg-elevated border border-border-subtle rounded-xl p-6 max-w-md w-full shadow-2xl",children:[t.jsx("h3",{id:"delete-key-modal-title",className:"type-subheading text-text-primary mb-4",children:"Delete Transport Key"}),t.jsxs("p",{className:"text-text-secondary mb-4",children:["Are you sure you want to delete ",t.jsxs("strong",{className:"text-text-primary",children:["'",js.name,"'"]}),"?"]}),js.children&&js.children.length>0&&t.jsx("div",{className:"bg-accent-secondary/10 border border-accent-secondary/30 rounded-lg p-3 mb-4",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx(R,{className:"w-4 h-4 text-accent-secondary flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"text-sm text-text-secondary",children:["This key has ",js.children.length," child key(s). Deleting will also remove all children."]})]})}),t.jsxs("div",{className:"flex justify-end gap-3",children:[t.jsx("button",{onClick:()=>{ys(!1),vs(null)},disabled:Ss,className:"px-4 py-2 bg-bg-subtle hover:bg-bg-elevated text-text-secondary rounded-lg border border-border-subtle transition-colors disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(js){_s(!0),as(null);try{const e=await async function(e){return r(`/api/transport_key/${e}`,{method:"DELETE"})}(js.id);e.success?(await sa(),ys(!1),vs(null),os(null)):as(e.error||"Failed to delete transport key")}catch(e){as(e instanceof Error?e.message:"Failed to delete transport key")}finally{_s(!1)}}},disabled:Ss,className:"px-4 py-2 bg-accent-danger/20 hover:bg-accent-danger/30 text-accent-danger rounded-lg border border-accent-danger/50 transition-colors disabled:opacity-50 flex items-center gap-2",children:Ss?t.jsxs(t.Fragment,{children:[t.jsx(_,{className:"w-4 h-4 animate-spin"}),"Deleting..."]}):"Delete"})]})]})})]})}export{le as default};
