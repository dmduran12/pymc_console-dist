import{r as e,j as t,c as s,R as a,T as n}from"./vendor-react-BKIq8k5U.js";import{c as l,b as i,aE as r,aF as o,aG as c,ad as m,aH as d,B as u,aI as h,aJ as x,u as p,aK as g,V as f,aL as y,aM as b,aN as j,aO as v,aP as N,aQ as k,ah as w,aR as M,aS as S,as as C,aT as T,aU as A,at as F,j as P,n as L,k as $,e as R,aA as D,N as z,o as B,F as E,aV as _,p as H,aW as q,Q as O,R as W,aX as G}from"./index-CrU_Ps9k.js";import{u as I}from"./usePolling-_rZ6EKji.js";import{L as X,H as Y,R as V}from"./route-BsYhRSod.js";import{C as Q}from"./compass-88H432HX.js";import{E as K,A as U,T as Z}from"./TimeRangeSelector-BzCEWjlJ.js";import{a as J,P as ee,b as te,B as se}from"./PageLayout-BlXA3E6H.js";import{D as ae}from"./DataBox-sJHphnZd.js";import{C as ne}from"./CollisionExplorerModal-Bgt7baHs.js";import{C as le,a as ie}from"./Card-Cq7dyTi6.js";import{I as re}from"./info-KKRXPMHC.js";import{T as oe}from"./triangle-alert-DrmOKr32.js";import{G as ce}from"./git-branch-CkXjQHb9.js";import{R as me,C as de}from"./Grid-BkE6UU8f.js";import{S as ue}from"./settings-2-D7yA0852.js";import{N as he}from"./network-BfZEswvU.js";import"./deckgl-DTsmDcfs.js";import"./vendor-core-D1aqi_5O.js";import"./index-n30bZfID.js";import"./BasemapLayer-BldfARb5.js";import"./maplibre-gl-Bk5DsYkB.js";import"./map-pin-BUNSWVCM.js";const xe=l("chart-line",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]),pe=l("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),ge=l("grid-3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),fe=l("grip",[["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"19",cy:"5",r:"1",key:"w8mnmm"}],["circle",{cx:"5",cy:"5",r:"1",key:"lttvr7"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}],["circle",{cx:"19",cy:"19",r:"1",key:"shf9b7"}],["circle",{cx:"5",cy:"19",r:"1",key:"bfqh0e"}]]),ye=l("id-card",[["path",{d:"M16 10h2",key:"8sgtl7"}],["path",{d:"M16 14h2",key:"epxaof"}],["path",{d:"M6.17 15a3 3 0 0 1 5.66 0",key:"n6f512"}],["circle",{cx:"9",cy:"11",r:"2",key:"yxgjnd"}],["rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",key:"qneu4z"}]]),be=l("radar",[["path",{d:"M19.07 4.93A10 10 0 0 0 6.99 3.34",key:"z3du51"}],["path",{d:"M4 6h.01",key:"oypzma"}],["path",{d:"M2.29 9.62A10 10 0 1 0 21.31 8.35",key:"qzzz0"}],["path",{d:"M16.24 7.76A6 6 0 1 0 8.23 16.67",key:"1yjesh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M17.99 11.66A6 6 0 0 1 15.77 16.67",key:"1u2y91"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"m13.41 10.59 5.66-5.66",key:"mhq4k0"}]]),je=l("sparkle",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}]]),ve=l("waves",[["path",{d:"M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"knzxuh"}],["path",{d:"M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"2jd2cc"}],["path",{d:"M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"rd2r6e"}]]),Ne={useAbsoluteThresholds:!0,baselinePercentile:6,spikePercentile:50,baselineDbm:-107,spikeDbm:-100,mergeGapSeconds:45,minSequenceLength:16,similarityToleranceDbm:5};function ke(e,t){if(0===e.length)return 0;const s=t/100*(e.length-1),a=Math.floor(s),n=Math.ceil(s);return a===n?e[a]:e[a]+(e[n]-e[a])*(s-a)}function we(e){if(0===e.length)return{median:0,p90:0,p95:0,p99:0,max:0,min:0};const t=[...e].sort((e,t)=>e-t);return{median:ke(t,50),p90:ke(t,90),p95:ke(t,95),p99:ke(t,99),max:t[t.length-1],min:t[0]}}function Me(e,t,s){const a=s-t;if(0===a)return"moderate";const n=(e-t)/a;return n>.66?"critical":n>.33?"severe":"moderate"}function Se({sortedTypes:a,highlightedType:n,onTypeHover:l,aggregateShares:r,hoverData:o}){const c=e.useMemo(()=>{if(!o)return null;const e=new Map;for(const t of o.items)e.set(t.key,t.value);return e},[o]),m=null!==c;return t.jsx("div",{className:"flex-shrink-0 pt-3 mt-2",children:t.jsx("div",{className:"flex flex-wrap gap-x-4 gap-y-1 font-mono text-xs ml-9",onMouseLeave:()=>l(null),children:a.map(e=>{const a=i(e.typeNum),o=(null==c?void 0:c.get(e.key))??0,d=r.get(e.key)??0,u=m?o:d,h=u>1e-4,x=n===e.key,p=n&&!x||m&&o<=1e-4;return t.jsxs("div",{className:s("flex items-center gap-1.5 transition-opacity cursor-pointer hover:opacity-80",p&&"opacity-30"),onMouseEnter:()=>l(e.key),children:[t.jsx("div",{className:"shrink-0 w-3 h-3 rounded-xs",style:{backgroundColor:a}}),t.jsx("span",{className:"text-text-secondary whitespace-nowrap",children:e.label}),h&&t.jsxs("span",{className:s("tabular-nums",m?"text-text-primary":"text-text-muted"),children:[(100*u).toFixed(1),"%"]})]},e.key)})})})}const Ce='ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace';function Te({x:e,y:s,width:a,height:n,name:l,size:r,index:o,depth:c,hoveredIndex:m,onHover:d,total:u,typeNum:h}){if(1!==c)return null;const x=null!==m&&!(m===o),p=i(h),g=u>0?r/u*100:0,f=a>36&&n>20,y=a>36&&n>32;return t.jsxs("g",{onMouseEnter:e=>d(o,e),onMouseLeave:()=>d(null),style:{cursor:"default"},children:[t.jsx("rect",{x:e,y:s,width:a,height:n,fill:p,opacity:x?.4:1,stroke:"rgba(0,0,0,0.2)",strokeWidth:1,rx:3,style:{transition:"opacity 150ms ease"}}),f&&t.jsxs(t.Fragment,{children:[y&&t.jsxs("text",{x:e+4,y:s+n-4-11,textAnchor:"start",dominantBaseline:"auto",fill:"rgba(0,0,0,0.6)",fontSize:8,fontFamily:Ce,fontWeight:500,style:{pointerEvents:"none"},children:[g.toFixed(1),"%"]}),t.jsx("text",{x:e+4,y:s+n-4,textAnchor:"start",dominantBaseline:"auto",fill:"rgba(0,0,0,0.85)",fontSize:9,fontFamily:Ce,fontWeight:600,style:{pointerEvents:"none"},children:l})]})]})}function Ae({data:e,total:s,color:a,position:n,containerWidth:l}){if(!e||!n)return null;const i=(e.value/s*100).toFixed(1),r=l-n.x<184?Math.max(8,n.x-160-8):n.x+16;return t.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:r,top:Math.max(8,n.y-60)},children:t.jsxs("div",{className:"bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 shadow-xl min-w-[140px]",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-sm flex-shrink-0",style:{backgroundColor:a}}),t.jsx("span",{className:"type-data-sm font-semibold text-text-primary",children:e.name})]}),t.jsxs("div",{className:"space-y-0.5 type-data-xs text-text-muted",children:[t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("span",{children:"Count"}),t.jsx("span",{className:"text-text-primary tabular-nums font-medium",children:e.value.toLocaleString()})]}),t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("span",{children:"Share"}),t.jsxs("span",{className:"text-text-primary tabular-nums font-medium",children:[i,"%"]})]}),t.jsxs("div",{className:"flex justify-between gap-4",children:[t.jsx("span",{children:"Total"}),t.jsx("span",{className:"text-text-primary tabular-nums font-medium",children:s.toLocaleString()})]})]})]})})}function Fe({sortedTypes:s,aggregateShares:l}){var r,o,c;const[m,d]=e.useState(null),[u,h]=e.useState(null),[x,p]=e.useState(0),[g,f]=e.useState(null),y=e.useRef(null),b=e.useMemo(()=>s.reduce((e,t)=>e+t.totalCount,0),[s]),j=e.useMemo(()=>s.map((e,t)=>({name:e.label,size:e.totalCount,index:t,typeNum:e.typeNum,key:e.key})),[s]),v=e.useCallback((e,t)=>{if(d(e),t&&null!==e){const e=y.current;if(e){const s=e.getBoundingClientRect();p(s.width),h({x:t.clientX-s.left,y:t.clientY-s.top})}}else h(null)},[]),N=e.useCallback(e=>{if(f(e),e){const t=j.findIndex(t=>t.key===e);d(t>=0?t:null)}else d(null)},[j]),k=null!==m?{name:(null==(r=j[m])?void 0:r.name)??"",value:(null==(o=j[m])?void 0:o.size)??0}:null,w=null!==m?i(null==(c=j[m])?void 0:c.typeNum):"";return 0===s.length||0===b?t.jsxs("div",{className:"h-full flex items-center justify-center text-text-muted",children:[t.jsx(X,{className:"w-6 h-6 mr-2 opacity-50"}),t.jsx("span",{children:"No packet type data available"})]}):t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("div",{className:"analyzer-chart-height relative flex-shrink-0",ref:y,children:[t.jsx(a,{width:"100%",height:"100%",children:t.jsx(n,{data:j,dataKey:"size",aspectRatio:4/3,stroke:"none",isAnimationActive:!1,content:t.jsx(Te,{x:0,y:0,width:0,height:0,name:"",size:0,index:0,depth:0,hoveredIndex:m,onHover:v,total:b,typeNum:0})})}),t.jsx(Ae,{data:k,total:b,color:w,position:u,containerWidth:x})]}),t.jsx(Se,{sortedTypes:s,highlightedType:g,onTypeHover:N,aggregateShares:l})]})}function Pe(e){return e>=1e9?`${(e/1e9).toFixed(1)} Gb`:e>=1e6?`${(e/1e6).toFixed(1)} Mb`:e>=1e3?`${(e/1e3).toFixed(1)} Kb`:`${e.toFixed(0)} B`}function Le({packets:s,mode:a,startTs:n,endTs:l,radioConfig:i,bucketCount:h}){const x=e.useMemo(()=>r(),[]),p=x.blue,g=x.red,f=x.yellow,[y,b]=e.useState(null),{trendData:j,totals:v}=e.useMemo(()=>{if(0===s.length)return{trendData:[],totals:{rxBytes:0,txBytes:0,rxAirtime:0,txAirtime:0}};const e=l-n,t=Math.min(Math.ceil(e/300),h),r=e/t,m=[];let d=0,u=0,x=0,p=0;for(const a of s){const e=a.timestamp;if(e<n||e>=l)continue;const t=o(a),s=c(a,{spreadingFactor:i.sf,bandwidthHz:i.bw,codingRate:i.cr,preambleLength:i.preamble}),r={timestamp:e,rxAirtime:0,txAirtime:0,rxBytes:0,txBytes:0};a.transmitted?(r.txAirtime=s,r.txBytes=t,u+=t,p+=s):(r.rxAirtime=s,r.rxBytes=t,d+=t,x+=s),m.push(r)}m.sort((e,t)=>e.timestamp-t.timestamp);const g=new Float64Array(m.length+1),f=new Float64Array(m.length+1),y=new Float64Array(m.length+1),b=new Float64Array(m.length+1),j=new Float64Array(m.length);for(let s=0;s<m.length;s++)g[s+1]=g[s]+m[s].rxAirtime,f[s+1]=f[s]+m[s].txAirtime,y[s+1]=y[s]+m[s].rxBytes,b[s+1]=b[s]+m[s].txBytes,j[s]=m[s].timestamp;const v=e=>{let t=0,s=j.length;for(;t<s;){const a=t+s>>>1;j[a]<e?t=a+1:s=a}return t},N=[],k=1e3*r;for(let s=0;s<t;s++){const e=n+s*r,t=e+r,l=v(e),i=v(t);if("share"===a){const t=y[i]-y[l],s=b[i]-b[l];N.push({timestamp:e,rx:t>0?t:null,tx:s>0?s:null})}else{const t=(g[i]-g[l])/k*100,s=(f[i]-f[l])/k*100;N.push({timestamp:e,rx:t>0?t:null,tx:s>0?s:null})}}const w=2/31;let M=null;return{trendData:N.map(e=>{const t=e.rx;return null!==t&&t>0&&(M=null===M?t:w*t+(1-w)*M),{...e,rxSmooth:null!==M&&M>0?M:null}}),totals:{rxBytes:d,txBytes:u,rxAirtime:x,txAirtime:p}}},[s,n,l,h,a,i]),N=e.useMemo(()=>{if(0===j.length)return"share"===a?100:10;let e=0;for(const s of j){const t=s.rx??0,a=s.tx??0;t>e&&(e=t),a>e&&(e=a)}const t=1.1*e;return"share"===a?t<=100?100:t<=500?100*Math.ceil(t/100):t<=1e3?200*Math.ceil(t/200):t<=5e3?500*Math.ceil(t/500):t<=1e4?1e3*Math.ceil(t/1e3):5e3*Math.ceil(t/5e3):Math.max(1,Math.ceil(t))},[j,a]),k=e.useMemo(()=>{if(null!==y&&j[y]){const e=j[y],t=e.rx??0,s=e.tx??0;return"share"===a?{rx:Pe(t),tx:Pe(s),total:Pe(t+s),isHovered:!0}:{rx:`${t.toFixed(2)}%`,tx:`${s.toFixed(2)}%`,total:`${(t+s).toFixed(2)}%`,isHovered:!0}}if("share"===a)return{rx:Pe(v.rxBytes),tx:Pe(v.txBytes),total:Pe(v.rxBytes+v.txBytes),isHovered:!1};{let e=0,t=0,s=0;for(const l of j)null===l.rx&&null===l.tx||(e+=l.rx??0,t+=l.tx??0,s++);const a=s>0?e/s:0,n=s>0?t/s:0;return{rx:`${a.toFixed(2)}%`,tx:`${n.toFixed(2)}%`,total:`${(a+n).toFixed(2)}%`,isHovered:!1}}},[y,j,v,a]),w=e.useMemo(()=>{const e=l-n,t=e/3600;return[0,.25,.5,.75,1].map(s=>{const a=new Date(1e3*(n+e*s)),l=a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),i=a.toLocaleDateString([],{weekday:"short"});return{pct:s,label:t>24?`${i} ${l}`:l,mobileHidden:.25===s||.75===s}})},[n,l]),M=e.useCallback(e=>{b(e)},[]);return 0===j.length?t.jsxs("div",{className:"h-full flex items-center justify-center text-text-muted",children:[t.jsx(X,{className:"w-6 h-6 mr-2 opacity-50"}),t.jsx("span",{children:"No packet data available"})]}):t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("div",{className:"analyzer-chart-height relative flex-shrink-0",children:[t.jsx("div",{className:"absolute top-0 left-0 right-0 z-10 flex items-center text-text-secondary",style:{height:20,paddingLeft:44,paddingRight:8},children:t.jsx("div",{className:"relative w-full h-full flex items-center",children:w.map((e,s)=>t.jsxs("div",{className:"absolute flex items-center gap-0.5 sm:gap-1 type-data-xs "+(e.mobileHidden?"hidden sm:flex":""),style:{left:100*e.pct+"%",transform:0===e.pct?"translateX(0)":1===e.pct?"translateX(-100%)":"translateX(-50%)"},children:[t.jsx(m,{className:"w-2.5 h-2.5 opacity-60 hidden sm:block"}),t.jsx("span",{className:"tabular-nums",children:e.label})]},s))})}),t.jsx("div",{className:"absolute inset-0 rounded-lg overflow-hidden",style:{paddingTop:20},children:t.jsx(d,{data:j,yAxisMode:"share"===a?"share":"airtime",yMax:N,onHover:M})})]}),t.jsxs("div",{className:"flex items-center justify-between mt-1.5 sm:mt-2",children:[t.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 text-xs font-mono pl-2 sm:pl-11",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"w-3 sm:w-4 h-0.5",style:{backgroundColor:p}}),t.jsx("span",{className:"text-text-secondary",children:"RX"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"w-3 sm:w-4 h-0.5",style:{backgroundColor:g}}),t.jsx("span",{className:"text-text-secondary",children:"TX"})]}),t.jsxs("div",{className:"hidden sm:flex items-center gap-1.5",children:[t.jsx("div",{className:"w-4 h-0.5",style:{backgroundColor:f}}),t.jsx("span",{className:"text-text-secondary",children:"Avg"})]})]}),t.jsxs("div",{className:"flex flex-wrap gap-4 sm:gap-8",children:[t.jsxs("div",{className:"flex items-end gap-2",children:[t.jsx("div",{className:"type-data-xl text-text-primary",children:k.rx}),t.jsx(u,{color:"zinc",className:"mb-0.5 sm:mb-1",children:"RX"})]}),t.jsxs("div",{className:"flex items-end gap-2",children:[t.jsx("div",{className:"type-data-xl text-text-primary",children:k.tx}),t.jsx(u,{color:"zinc",className:"mb-0.5 sm:mb-1",children:"TX"})]})]})]})]})}const $e=h;function Re({mode:s,packets:a,startTs:n,endTs:l,radioConfig:i,sortedTypes:r,aggregateShares:m,noiseFloorAnomalies:d,showNoiseFloorOverlay:u,overlayOpacity:h=.5}){const[p,g]=e.useState(null),[f,y]=e.useState(null),b=e.useMemo(()=>(l-n)/3600,[n,l]),j=e.useCallback(e=>{y(e)},[]),v=function(t,s,a,n,l){return e.useMemo(()=>{if(0===t.length||!l)return null;const e=t.filter(e=>e.timestamp>=s&&e.timestamp<=a);if(0===e.length)return null;const i=[],r=new Map;for(const t of e){const e=t.type??t.payload_type??-1,a=o(t);let m;if(m="airtime"===n?c(t,{spreadingFactor:l.sf,bandwidthHz:l.bw,codingRate:l.cr,preambleLength:l.preamble}):1,a<=0)continue;const d=Math.floor((t.timestamp-s)/300),u={timestamp:t.timestamp,airtimeMs:m,byteSize:a,packetType:e,bucketIndex:d};i.push(u),r.has(d)||r.set(d,[]),r.get(d).push(u)}if(0===i.length)return null;const m=[],d=[],u=[],h=new Map;if("share"===n)for(const[,t]of r)for(const e of t)h.set(e,e.byteSize);else for(const[,t]of r){const e=t.reduce((e,t)=>e+t.airtimeMs,0)/3e5*100;let s=0;for(const a of t)a.airtimeMs>s&&(s=a.airtimeMs);for(const a of t){const t=a.airtimeMs/s*e;h.set(a,t)}}for(const t of i){const e=h.get(t);void 0!==e&&(m.push(e),d.push(t.timestamp),u.push(t.packetType))}let x=d[0],p=d[0];for(let t=1;t<d.length;t++)d[t]<x&&(x=d[t]),d[t]>p&&(p=d[t]);const g=p-x||1,f=[...m].sort((e,t)=>e-t),y=f[0],b=f[f.length-1],j=Math.floor(.05*f.length),v=Math.floor(.5*f.length),N=Math.min(Math.ceil(.95*f.length),f.length-1),k=f[j],w=f[v],M=f[N],S=new Map;for(const t of m){const e=Math.round(100*t)/100;S.set(e,(S.get(e)??0)+1)}const C=S.size,T=[...S.entries()].sort((e,t)=>t[1]-e[1]).slice(0,5).map(([e,t])=>({value:e,count:t,percent:t/m.length*100}));let A;if("share"===n)A=200;else{const e=5,t=Math.ceil(b/e)*e;A=t<=10?10:t+e}const F=new Float32Array(2*m.length),P=new Float32Array(m.length),L=new Uint8Array(m.length),$=new Float32Array(m.length);for(let t=0;t<m.length;t++){const e=(d[t]-x)/g,s=1-Math.max(0,Math.min(A,m[t]))/A;F[2*t]=e,F[2*t+1]=s,P[t]=m[t],L[t]=u[t]>=0?u[t]:255,$[t]=d[t]}return{points:F,rawValues:P,packetTypes:L,timestamps:$,count:m.length,minTime:x,maxTime:p,minValue:0,maxValue:A,rawMinValue:y,rawMaxValue:b,unit:"%",stats:{p5:k,p50:w,p95:M,uniqueValues:C,topValues:T}}},[t,s,a,n,l])}(a,n,l,"share"===s?"share":"airtime",i),[N,k]=e.useState(null),w=e.useCallback((e,t)=>{g(e),k(t??null)},[]),M=e.useMemo(()=>{if(null===N||!v||0===v.count)return null;const e=v.maxTime-v.minTime||1,t=v.minTime+N*e;let s;s=b>=168?75:b>=72?35:b>=24?15:b>=3?10:5;const a=60*s/2;return{start:t-a,end:t+a}},[N,v,b]),S=e.useMemo(()=>M?new Date((M.start+M.end)/2*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}):null,[M]),C=e.useMemo(()=>{if(null===p||!M)return null;const e=S??"",{start:t,end:n}=M,l=a.filter(e=>e.timestamp>=t&&e.timestamp<n);if(0===l.length)return{timestamp:(t+n)/2,timeLabel:e,items:r.map(e=>({key:e.key,label:e.label,value:0,color:$e(e.typeNum)}))};const o=new Map,m=new Map;let d=0,u=0;for(const s of l){const e=`TYPE_${s.type??s.payload_type??-1}`;if(o.set(e,(o.get(e)??0)+1),d++,i){const t=c(s,{spreadingFactor:i.sf,bandwidthHz:i.bw,codingRate:i.cr,preambleLength:i.preamble});m.set(e,(m.get(e)??0)+t),u+=t}}const h=r.map(e=>{let t;return t="airtime"===s?u>0?(m.get(e.key)??0)/u:0:d>0?(o.get(e.key)??0)/d:0,{key:e.key,label:e.label,value:t,color:$e(e.typeNum)}});return{timestamp:(t+n)/2,timeLabel:e,items:h}},[p,M,S,a,r,s,i]);return v&&0!==v.count?t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("div",{className:"analyzer-chart-height relative flex-shrink-0",children:[t.jsx("div",{className:"absolute inset-0 rounded-lg overflow-hidden",children:t.jsx(x,{scatterData:v,yAxisMode:"share"===s?"share":"airtime",onHover:w,noiseFloorAnomalies:d,showNoiseFloorOverlay:u,overlayOpacity:h,highlightedType:f,timeRangeHours:b})}),S&&t.jsx("div",{className:"absolute top-1 right-1 px-2 py-0.5 bg-bg-elevated/90 rounded text-xs text-accent-secondary font-mono pointer-events-none",children:S})]}),t.jsx(Se,{sortedTypes:r,highlightedType:f,onTypeHover:j,aggregateShares:m,hoverData:C})]}):t.jsxs("div",{className:"h-full flex items-center justify-center text-text-muted",children:[t.jsx(X,{className:"w-6 h-6 mr-2 opacity-50"}),t.jsx("span",{children:"No packet data available"})]})}function De({mode:e,onChange:s}){return t.jsxs("div",{className:"toggle-group toggle-group-sm",children:[t.jsx("button",{onClick:()=>s("share"),className:"toggle-group-item "+("share"===e?"active":""),children:"Total"}),t.jsx("button",{onClick:()=>s("airtime"),className:"toggle-group-item "+("airtime"===e?"active":""),children:"Airtime"})]})}function ze({smoothing:e,onChange:s}){return t.jsxs("div",{className:"toggle-group toggle-group-sm",children:[t.jsx("button",{onClick:()=>s("stats"),className:"toggle-group-item "+("stats"===e?"active":""),title:"Statistics view (scatter plot)",children:t.jsx(fe,{className:"w-3.5 h-3.5"})}),t.jsx("button",{onClick:()=>s("trend"),className:"toggle-group-item "+("trend"===e?"active":""),title:"Trend line chart",children:t.jsx(xe,{className:"w-3.5 h-3.5"})}),t.jsx("button",{onClick:()=>s("ema"),className:"toggle-group-item "+("ema"===e?"active":""),title:"Stacked area (moderate smoothing)",children:t.jsx(X,{className:"w-3.5 h-3.5"})}),t.jsx("button",{onClick:()=>s("ultra"),className:"toggle-group-item "+("ultra"===e?"active":""),title:"Stacked area (heavy smoothing)",children:t.jsx(ve,{className:"w-3.5 h-3.5"})}),t.jsx("button",{onClick:()=>s("mosaic"),className:"toggle-group-item "+("mosaic"===e?"active":""),title:"Mosaic view (treemap)",children:t.jsx(ge,{className:"w-3.5 h-3.5"})})]})}function Be({enabled:e,onChange:s,anomalyCount:a=0,showTuning:n=!1,onTuningChange:l}){return t.jsxs("div",{className:"relative inline-flex items-center gap-1",children:[e&&l&&t.jsx("button",{onClick:()=>l(!n),className:"toggle-group toggle-group-sm "+(n?"active":""),title:n?"Hide tuning panel":"Show tuning panel",children:t.jsx("span",{className:"toggle-group-item "+(n?"active":""),children:t.jsx(ue,{className:"w-3.5 h-3.5"})})}),t.jsx("button",{onClick:()=>s(!e),className:"toggle-group toggle-group-sm "+(e?"active":""),title:e?"Hide noise floor anomalies":"Show noise floor anomalies",children:t.jsx("span",{className:"toggle-group-item "+(e?"active":""),children:t.jsx(K,{className:"w-3.5 h-3.5"})})}),a>0&&t.jsx("span",{className:"absolute -top-2 -right-2 min-w-[18px] h-[18px] px-1 rounded-full bg-accent-danger text-white text-[10px] font-bold flex items-center justify-center pointer-events-none z-10",children:a>99?"99+":a})]})}const Ee={sf:10,bw:25e4,cr:5,preamble:8};function _e(e){return f[e]??`TYPE_${e.toString(16).toUpperCase()}`}function He(e,t,s,a){const n=2*a+1;let l=0;for(let i=0;i<=a;i++)l+=e[Math.min(i,s-1)];for(let i=0;i<a;i++)l+=e[0];for(let i=0;i<s;i++){t[i]=l/n;const r=i-a,o=i+a+1;l-=e[Math.max(0,Math.min(r,s-1))],l+=e[Math.max(0,Math.min(o,s-1))]}}const qe={ema:1800,ultra:14400},Oe={ema:"sma",ultra:"gaussian"};function We(e,t,s){const a=qe[e],n=Oe[e]??"sma";if(!a)return{sigma:0,window:1,handleSize:0};let l=Math.round(a/t);l=Math.max(3,Math.min(l,Math.floor(s/3))),l%2==0&&(l+=1);const i="gaussian"===n?Math.ceil(l*Math.sqrt(4/12)*3):Math.ceil(l/2);return"gaussian"===n?{sigma:l*Math.sqrt(4/12),window:l,handleSize:i}:{sigma:0,window:l,handleSize:i}}const Ge=e.memo(function({packets:s,startTs:a,endTs:n,bucketCount:l,radioConfig:r=Ee,mode:o="share",smoothing:m="stats",noiseFloorAnomalies:d=null,showNoiseFloorOverlay:u=!1,overlayOpacity:h=.5}){const x=p(),[f,y]=e.useState(null),[b,j]=e.useState(null),[v,N]=e.useState([]),k=e.useRef(null),w=e.useRef(0);e.useEffect(()=>{const e=Math.abs(s.length-w.current);if(0===e&&v.length>0)return;k.current&&clearTimeout(k.current);const t=e>100?50:500;return k.current=setTimeout(()=>{w.current=s.length,N(s)},t),()=>{k.current&&clearTimeout(k.current)}},[s,v.length]);const M=e.useMemo(()=>function(e,t){const s=new Map;for(const n of e){const e=n.type??n.payload_type??-1,a=c(n,{spreadingFactor:t.sf,bandwidthHz:t.bw,codingRate:t.cr,preambleLength:t.preamble}),l=s.get(e)??{count:0,airtime:0};s.set(e,{count:l.count+1,airtime:l.airtime+a})}const a=[];for(const[n,l]of s)a.push({typeNum:n,key:`TYPE_${n}`,label:_e(n),totalCount:l.count,totalAirtime:l.airtime});return a.sort((e,t)=>t.totalCount-e.totalCount)}(v,r),[v,r]),S=e.useMemo(()=>{if("ema"!==m&&"ultra"!==m)return 0;const e=(n-a)/l,{handleSize:t}=We(m,e,l);return t},[m,a,n,l]),C=e.useMemo(()=>function(e,t,s,a,n,l,i=0){const r=s-t,o=r/a,m=1e3*o,d=r/3600,u=t-i*o,h=s+i*o,x=a+2*i,p=[];for(let c=0;c<x;c++){const e=u+c*o,t=new Date(1e3*e),s={timestamp:e,time:d>24?t.toLocaleDateString([],{weekday:"short",hour:"2-digit",minute:"2-digit",hour12:!1}):t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),counts:{},shares:{},airtimes:{},total:0,totalAirtime:0,bucketDurationMs:m};for(const a of l)s.counts[a.key]=0,s.airtimes[a.key]=0;p.push(s)}for(const g of e){const e=g.timestamp;if(e<u||e>=h)continue;const t=Math.min(Math.floor((e-u)/o),x-1),s=`TYPE_${g.type??g.payload_type??-1}`;p[t].counts[s]=(p[t].counts[s]??0)+1,p[t].total++;const a=c(g,{spreadingFactor:n.sf,bandwidthHz:n.bw,codingRate:n.cr,preambleLength:n.preamble});p[t].airtimes[s]=(p[t].airtimes[s]??0)+a,p[t].totalAirtime+=a}for(const c of p)for(const e of l)c.shares[e.key]=c.total>0?c.counts[e.key]/c.total*100:0;return{buckets:p,visibleStart:i,visibleEnd:i+a}}(v,a,n,l,r,M,S),[v,a,n,l,r,M,S]),T=e.useMemo(()=>M.reduce((e,t)=>e+t.totalCount,0),[M]),A=e.useMemo(()=>M.reduce((e,t)=>e+t.totalAirtime,0),[M]),{sortedTypes:F,aggregateShares:P}=e.useMemo(()=>{const e=new Map,t="share"===o?T:A;if(t>0)for(const s of M){const a="share"===o?s.totalCount:s.totalAirtime;e.set(s.key,a/t)}return{sortedTypes:[...M].sort((t,s)=>(e.get(s.key)??0)-(e.get(t.key)??0)),aggregateShares:e}},[M,T,A,o]),L=e.useMemo(()=>function(e,t,s,a="ultra",n,l,i){var r;const{buckets:o,visibleStart:c,visibleEnd:m}=e,d=o.length,u=s.length,h=m-c;if(0===d||0===u)return[];const x=i&&void 0!==n&&void 0!==l?(l-n)/i:(null==(r=o[0])?void 0:r.bucketDurationMs)?o[0].bucketDurationMs/1e3:240,p=Array.from({length:u},()=>new Array(d).fill(0));for(let N=0;N<d;N++){const e=o[N];if("share"===t){if(e.total>0)for(let t=0;t<u;t++)p[t][N]=(e.counts[s[t].key]??0)/e.total}else{let t=0;for(let a=0;a<u;a++)t+=e.airtimes[s[a].key]??0;if(t>0)for(let a=0;a<u;a++)p[a][N]=(e.airtimes[s[a].key]??0)/t}}const{sigma:g,window:f}=We(a,x,h);let y;y=g>0?p.map(e=>function(e,t){const s=e.length;if(0===s)return[];if(t<.5)return[...e];const a=Math.sqrt(12*t*t/3+1);let n=Math.floor(a);n%2==0&&n--;const l=n+2,i=(12*t*t-3*n*n-12*n-9)/(-4*n-4),r=Math.round(i),o=[r>0?n:l,r>1?n:l,r>2?n:l];let c=new Float32Array(e);const m=new Float32Array(s);for(const d of o){He(c,m,s,(d-1)/2);const e=c;c=m,m.set(e)}return Array.from(c)}(e,g)):p.map(e=>function(e,t){if(0===e.length)return[];if(t<=1)return[...e];const s=e.length,a=new Float32Array(s),n=Math.floor(t/2);let l=0,i=0;for(let r=0;r<=Math.min(n,s-1);r++)l+=e[r],i++;for(let r=0;r<s;r++){a[r]=l/i;const t=r-n,o=r+n+1;t>=0&&(l-=e[t],i--),o<s&&(l+=e[o],i++)}return Array.from(a)}(e,f));for(let N=0;N<d;N++){let e=0;for(let t=0;t<u;t++)y[t][N]=Math.max(0,y[t][N]),e+=y[t][N];if(e>0){const t=1/e;for(let e=0;e<u;e++)y[e][N]*=t}}const b=h>360?Math.ceil(h/360):1,j=Math.ceil(h/b),v=[];for(let N=0;N<j;N++){const e=c+N*b,t=Math.min(c+(N+1)*b,m),a=t-e,n=new Array(u).fill(0);for(let s=e;s<t;s++)for(let e=0;e<u;e++)n[e]+=y[e][s];for(let s=0;s<u;s++)n[s]/=a;let l=0;for(let s=0;s<u;s++)l+=n[s];if(l>0){const e=1/l;for(let t=0;t<u;t++)n[t]*=e}const i={timestamp:o[e].timestamp,time:o[e].time};for(let r=0;r<u;r++)i[s[r].key]=n[r];v.push(i)}return v}(C,o,F,m,a,n,l),[C,o,F,m,a,n,l]),$=e.useCallback(e=>y(e),[]),R=e.useCallback(e=>j(e),[]),D=e.useCallback(e=>y(e),[]),z=e.useMemo(()=>{if(null===b||!L[b])return null;const e=L[b];return{timestamp:e.timestamp,timeLabel:e.time,items:F.map(t=>({key:t.key,label:t.label,value:e[t.key]??0,color:i(t.typeNum)}))}},[b,L,F]),B=e.useMemo(()=>({timestamps:L.map(e=>e.timestamp),series:F.map(e=>({key:e.key,label:e.label,color:i(e.typeNum),values:L.map(t=>t[e.key]??0)}))}),[L,F]);return 0===v.length?0===s.length?t.jsxs("div",{className:"h-full flex items-center justify-center text-text-muted",children:[t.jsx(X,{className:"w-6 h-6 mr-2 opacity-50"}),t.jsx("span",{children:"No packet data available"})]}):null:"mosaic"===m?t.jsx(Fe,{sortedTypes:F,aggregateShares:P}):"stats"===m?t.jsx(Re,{mode:o,packets:v,startTs:a,endTs:n,radioConfig:r,sortedTypes:F,aggregateShares:P,noiseFloorAnomalies:d,showNoiseFloorOverlay:u,overlayOpacity:h}):"trend"===m?t.jsx(Le,{packets:v,mode:o,startTs:a,endTs:n,radioConfig:r,bucketCount:l}):t.jsxs("div",{className:"flex flex-col",children:[t.jsx("div",{className:"analyzer-chart-height relative flex-shrink-0",children:t.jsx("div",{className:"absolute inset-0 rounded-lg overflow-hidden",children:t.jsx(g,{timestamps:B.timestamps,series:B.series,highlightedKey:f,cursorColor:x.cursor,onHover:R,onSeriesHover:D,overlayLine:null})})}),t.jsx(Se,{sortedTypes:F,highlightedType:f,onTypeHover:$,aggregateShares:P,hoverData:z})]})}),Ie={"1x":1,"2x":2,"4x":4,"8x":8,"16x":16,"36x":36},Xe=[1,5,10,25,50,100,150];function Ye(e,t,s,a){const n=Math.PI/180,l=(a-t)*n,i=e*n,r=s*n,o=Math.sin(l)*Math.cos(r),c=Math.cos(i)*Math.sin(r)-Math.sin(i)*Math.cos(r)*Math.cos(l);return(180*Math.atan2(o,c)/Math.PI+360)%360}function Ve(e,t,s,a){const n=Math.PI/180,l=(s-e)*n,i=(a-t)*n,r=Math.sin(l/2)**2+Math.cos(e*n)*Math.cos(s*n)*Math.sin(i/2)**2;return 12742*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))}const Qe=[{min:10,label:"Excellent"},{min:7,label:"Very Good"},{min:4,label:"Good"},{min:1,label:"Fair+"},{min:-2,label:"Fair"},{min:-5,label:"Fair-"},{min:-8,label:"Poor"},{min:-11,label:"Bad"},{min:-1/0,label:"Critical"}];function Ke(e,t){return t[w(e)]||"#808080"}const Ue=e.memo(function({neighbors:s,quickNeighbors:a,localLat:n,localLon:l,onStatsChange:i}){const[r,o]=e.useState(null),[c,m]=e.useState(new Set),[d,u]=e.useState({width:0,height:0}),[h,x]=e.useState("1x"),[p,g]=e.useState(1),f=e.useRef(null),w=e.useRef({}),M=e.useRef(null),S=e.useRef(null),C=e.useRef(p);C.current=p;const T=y(),A=b(),F=j(),P=v(),L=N(),$=L?P.secondary:P.primary,R=L?.4:.15,D=L?.25:.08,z=L?P.primary:A.primary;e.useEffect(()=>{const e=S.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e){const{width:e,height:s}=t.contentRect;e>0&&s>0&&u({width:e,height:s})}});t.observe(e);const s=e.getBoundingClientRect();return s.width>0&&s.height>0&&u({width:s.width,height:s.height}),()=>t.disconnect()},[]);const B=e.useMemo(()=>{const e=new Set;if(a)for(const t of a)e.add(t.hash);return e},[a]),E=e.useMemo(()=>{const e=new Map;if(a)for(const t of a)e.set(t.hash,{snr:t.avgSnr,rssi:t.avgRssi});return e},[a]),{processedNeighbors:_,maxDistance:H,totalNeighbors:q,zeroHopCount:O}=e.useMemo(()=>{const e=[];for(const[a,i]of Object.entries(s)){if(!i.latitude||!i.longitude||0===i.latitude||0===i.longitude)continue;if(!B.has(a))continue;const t=Ye(n,l,i.latitude,i.longitude),s=Ve(n,l,i.latitude,i.longitude),r=E.get(a);e.push({hash:a.slice(0,8),name:i.node_name||i.name||"Unknown",snr:(null==r?void 0:r.snr)??i.snr??null,rssi:(null==r?void 0:r.rssi)??i.rssi??null,bearing:t,distance:s,normalizedDistance:0,lastSeen:i.last_seen,isZeroHop:!0})}const t=1.08*(e.length>0?Math.max(...e.map(e=>e.distance)):0);return e.sort((e,t)=>(e.snr??-1/0)-(t.snr??-1/0)),{processedNeighbors:e,maxDistance:t,totalNeighbors:e.length,zeroHopCount:e.length}},[s,n,l,B,E]);e.useEffect(()=>{null==i||i({zeroHopCount:O,totalCount:q,maxDistanceKm:H})},[O,q,H]),e.useEffect(()=>{const e=Ie[h],t=C.current;f.current&&cancelAnimationFrame(f.current);const s=performance.now(),a=n=>{const l=n-s,i=Math.min(l/400,1),r=(o=i)<.5?8*o*o*o*o:1-Math.pow(-2*o+2,4)/2;var o;g(t+(e-t)*r),f.current=i<1?requestAnimationFrame(a):null};return f.current=requestAnimationFrame(a),()=>{f.current&&cancelAnimationFrame(f.current)}},[h]);const W=H/p,G=e.useMemo(()=>Xe.filter(e=>e<=1.1*W),[W]);e.useEffect(()=>{const e=[];for(const s of _){const t=w.current[s.hash];void 0!==t&&t!==s.lastSeen&&e.push(s.hash),w.current[s.hash]=s.lastSeen}if(0===e.length)return;queueMicrotask(()=>{m(t=>new Set([...t,...e]))});const t=setTimeout(()=>{m(t=>{const s=new Set(t);return e.forEach(e=>s.delete(e)),s})},600);return()=>clearTimeout(t)},[_]);const I=0!==n&&0!==l,X=e.useMemo(()=>{const{width:e,height:t}=d,s=e/2,a=t/2,n=Math.max(10,e/2-12),l=Math.max(10,t/2-12),i=Math.max(10,n-16),r=Math.max(10,l-16);return{width:e,height:t,centerX:s,centerY:a,maxRadiusX:i,maxRadiusY:r,labelRadiusX:n,labelRadiusY:l,cornerRadius:.2*Math.min(i,r)}},[d]),{width:Y,height:V,centerX:K,centerY:U,maxRadiusX:Z,maxRadiusY:J,labelRadiusX:ee,labelRadiusY:te,cornerRadius:se}=X,ae=e.useCallback((e,t=1)=>{const s=Z*t,a=J*t,n=Math.min(se*t,s,a),l=(e%360+360)%360,i=l*Math.PI/180,r=180*Math.atan2(a-n,s-n)/Math.PI;let o,c;if(l<=45-r||l>315+r){const e=Math.tan(i);o=Math.max(K-s+n,Math.min(K+s-n,K+a*e*(s/a))),c=U-a}else if(l>45-r&&l<=45+r)o=K+s-n+n*Math.sin(i),c=U-a+n-n*Math.cos(i);else if(l>45+r&&l<=135-r){const e=1/Math.tan(i);c=Math.max(U-a+n,Math.min(U+a-n,U-s*e*(a/s))),o=K+s}else if(l>135-r&&l<=135+r)o=K+s-n+n*Math.sin(i),c=U+a-n-n*Math.cos(i);else if(l>135+r&&l<=225-r){const e=Math.tan(i);o=Math.max(K-s+n,Math.min(K+s-n,K-a*e*(s/a))),c=U+a}else if(l>225-r&&l<=225+r)o=K-s+n+n*Math.sin(i),c=U+a-n-n*Math.cos(i);else if(l>225+r&&l<=315-r){const e=1/Math.tan(i);c=Math.max(U-a+n,Math.min(U+a-n,U-s*e*(a/s))),o=K-s}else o=K-s+n+n*Math.sin(i),c=U-a+n-n*Math.cos(i);return{x:o,y:c}},[K,U,Z,J,se]),ne=e.useCallback((e,t)=>{const s=ae(e,1);return{x:K+(s.x-K)*t,y:U+(s.y-U)*t}},[ae,K,U]),le=e.useCallback(e=>({N:{x:K,y:U-te},S:{x:K,y:U+te},E:{x:K+ee,y:U},W:{x:K-ee,y:U},NE:{x:K+ee,y:U-te},SE:{x:K+ee,y:U+te},SW:{x:K-ee,y:U+te},NW:{x:K-ee,y:U-te}}[e]),[K,U,ee,te]),ie=e.useCallback(e=>{const t=Z*e,s=J*e,a=Math.min(se*e,t,s),n=K-t,l=K+t,i=U-s,r=U+s;return[`M ${n+a} ${i}`,`L ${l-a} ${i}`,`Q ${l} ${i} ${l} ${i+a}`,`L ${l} ${r-a}`,`Q ${l} ${r} ${l-a} ${r}`,`L ${n+a} ${r}`,`Q ${n} ${r} ${n} ${r-a}`,`L ${n} ${i+a}`,`Q ${n} ${i} ${n+a} ${i}`,"Z"].join(" ")},[K,U,Z,J,se]),re=e.useCallback(e=>{o(e)},[]),oe=e.useCallback(e=>{x(e)},[]),ce=e.useCallback(e=>H<=0?0:e/H*p,[H,p]),me=e=>`${e}km`,de=e.useMemo(()=>{const e=G.map(e=>{const t=e/H*p;return{km:e,scale:t,labelY:U-J*t*.71}}).filter(e=>e.scale<=1.05&&e.scale>=.02).sort((e,t)=>t.km-e.km),t=[];for(const s of e)t.some(e=>Math.abs(e.labelY-s.labelY)<28)||t.push(s);return t},[G,H,p,U,J]),ue=d.width>0&&d.height>0;return I?0===q?t.jsxs("div",{ref:M,className:"flex flex-col items-center justify-center h-full text-text-secondary",children:[t.jsx(Q,{className:"w-8 h-8 mb-2 opacity-50"}),t.jsx("p",{children:"No nodes with location data"})]}):t.jsxs("div",{ref:M,className:"relative h-full w-full flex overflow-hidden",children:[t.jsx("div",{ref:S,className:"relative flex-1 min-w-0 h-full",children:ue&&t.jsxs("svg",{width:Y,height:V,className:"absolute inset-0 z-0",children:[t.jsxs("defs",{children:[t.jsx("style",{children:"\n                @keyframes neighbor-blink-scale {\n                  0%, 100% {\n                    transform: scale(1);\n                    opacity: 0;\n                  }\n                  50% {\n                    transform: scale(1.3);\n                    opacity: 0.8;\n                  }\n                }\n                .neighbor-blink-ring {\n                  transform-origin: center;\n                  animation: neighbor-blink-scale 600ms ease-out forwards;\n                }\n              "}),t.jsx("clipPath",{id:"radar-clip",children:t.jsx("path",{d:ie(1)})})]}),G.map(e=>{const s=ce(e);if(s>1.05||s<.02)return null;const a=de.some(t=>t.km===e),n=K+Z*s*.71,l=U-J*s*.71;return t.jsxs("g",{children:[t.jsx("path",{d:ie(s),fill:"none",stroke:$,strokeOpacity:R,strokeWidth:1}),a&&t.jsx("text",{x:n+4,y:l-2,textAnchor:"start",dominantBaseline:"auto",className:"fill-text-secondary",fontSize:10,fontFamily:k,children:me(e)})]},`ring-${e}`)}),["N","E","S","W"].map(e=>{const s="N"===e||"S"===e,a=s?K:"E"===e?K+Z:K-Z,n=s?"N"===e?U-J:U+J:U;return t.jsx("line",{x1:K,y1:U,x2:a,y2:n,stroke:$,strokeOpacity:R,strokeWidth:1,strokeDasharray:"4 4"},e)}),["NE","SE","SW","NW"].map(e=>{const s=le(e);return t.jsx("line",{x1:K,y1:U,x2:s.x,y2:s.y,stroke:$,strokeOpacity:D,strokeWidth:1,strokeDasharray:"4 4"},`diag-${e}`)}),["N","E","S","W"].map(e=>{const s=le(e),a="E"===e?"end":"W"===e?"start":"middle",n="N"===e?"hanging":"S"===e?"auto":"middle";return t.jsx("text",{x:s.x,y:s.y,textAnchor:a,dominantBaseline:n,fill:z,fontSize:16,fontWeight:600,fontFamily:k,"aria-hidden":"true",children:e},e)}),["NE","SE","SW","NW"].map(e=>{const s=le(e),a="NE"===e||"SE"===e?"end":"start",n="NE"===e||"NW"===e?"hanging":"auto";return t.jsx("text",{x:s.x,y:s.y,textAnchor:a,dominantBaseline:n,fill:z,fontSize:16,fontWeight:600,fontFamily:k,"aria-hidden":"true",children:e},e)}),t.jsx("circle",{cx:K,cy:U,r:5,fill:F.chart6,stroke:"rgba(255,255,255,0.3)",strokeWidth:1,role:"img","aria-label":"Local node"}),t.jsx("g",{clipPath:"url(#radar-clip)",children:_.map(e=>{const s=H>0?e.distance/H*p:0;if(s>1)return null;const{x:a,y:n}=ne(e.bearing,s),l=null!==e.snr?Ke(e.snr,T):"#808080",i=(null==r?void 0:r.hash)===e.hash,o=c.has(e.hash);return t.jsxs("g",{role:"img","aria-label":`${e.name}: ${e.distance.toFixed(1)}km ${e.bearing.toFixed(0)}°`,children:[o&&t.jsx("circle",{cx:a,cy:n,r:10.5,fill:"none",stroke:"rgba(255,255,255,0.9)",strokeWidth:2,className:"neighbor-blink-ring"}),i&&t.jsx("circle",{cx:a,cy:n,r:10.5,fill:l,opacity:.3}),t.jsx("circle",{cx:a,cy:n,r:i?7:5,fill:l,stroke:"rgba(0,0,0,0.5)",strokeWidth:1,style:{cursor:"pointer",transition:"r 0.15s"},onMouseEnter:()=>re(e),onMouseLeave:()=>re(null)})]},e.hash)})})]})}),t.jsx("div",{className:"flex flex-col h-full items-stretch gap-1 py-2 pl-2 flex-shrink-0",role:"group","aria-label":"Zoom level",children:["1x","2x","4x","8x","16x","36x"].map(e=>t.jsx("button",{onClick:()=>oe(e),"aria-pressed":h===e,className:"flex flex-1 items-center justify-center px-1.5 text-xs font-medium rounded transition-colors "+(h===e?"bg-accent-primary/20 text-accent-primary":"bg-white/5 text-text-secondary hover:bg-white/10 hover:text-text-primary"),children:e},e))}),r&&t.jsxs("div",{className:"absolute bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 text-sm pointer-events-none z-10 shadow-xl",style:{left:"50%",bottom:8,transform:"translateX(-50%)"},children:[t.jsx("div",{className:"font-medium text-text-primary",children:r.name}),t.jsx("div",{className:"text-text-secondary text-xs font-mono",children:r.hash}),null!==r.snr?t.jsx("div",{className:"flex gap-3 mt-1 text-xs",children:t.jsxs("span",{children:[t.jsx("span",{className:"text-text-secondary",children:"SNR:"})," ",t.jsxs("span",{className:"tabular-nums",style:{color:Ke(r.snr,T)},children:[r.snr.toFixed(1)," dB"]}),t.jsxs("span",{className:"text-text-secondary ml-1",children:["(",(he=r.snr,(null==(xe=Qe.find(e=>he>=e.min))?void 0:xe.label)??"Critical"),")"]})]})}):t.jsx("div",{className:"text-xs text-text-secondary mt-1",children:"No SNR data"}),t.jsxs("div",{className:"flex gap-3 text-xs",children:[t.jsxs("span",{children:[t.jsx("span",{className:"text-text-secondary",children:"Distance:"})," ",t.jsxs("span",{className:"tabular-nums text-text-primary",children:[r.distance.toFixed(2)," km"]})]}),t.jsxs("span",{children:[t.jsx("span",{className:"text-text-secondary",children:"Bearing:"})," ",t.jsxs("span",{className:"tabular-nums text-text-primary",children:[r.bearing.toFixed(0),"°"]})]})]})]})]}):t.jsxs("div",{ref:M,className:"flex flex-col items-center justify-center h-full text-text-secondary",children:[t.jsx(Q,{className:"w-8 h-8 mb-2 opacity-50"}),t.jsx("p",{children:"Local node coordinates not configured"}),t.jsx("p",{className:"text-xs mt-1",children:"Set latitude/longitude in config to enable"})]});var he,xe}),Ze={repeater:"var(--accent-primary)",companion:"var(--accent-tertiary)",room_server:"var(--accent-secondary)"};function Je(e){if(e.contact_type){const t=e.contact_type.toLowerCase();if("repeater"===t||"rep"===t)return"repeater";if("room server"===t||"room_server"===t||"room"===t||"server"===t)return"room_server";if("companion"===t||"client"===t||"cli"===t)return"companion"}return e.is_repeater?"repeater":"companion"}const et=e.memo(function({neighbors:s}){const a=e.useMemo(()=>{const e={repeater:0,companion:0,room_server:0};for(const a of Object.values(s)){const t=Je(a);e[t]=(e[t]||0)+1}const t=Object.values(e).reduce((e,t)=>e+t,0);return{items:[{label:"Repeaters",count:e.repeater,percent:0,color:Ze.repeater},{label:"Companions",count:e.companion,percent:0,color:Ze.companion},{label:"Room Servers",count:e.room_server,percent:0,color:Ze.room_server}].map(e=>({...e,percent:t>0?e.count/t*100:0})).filter(e=>e.count>0).sort((e,t)=>t.count-e.count),total:t}},[s]);return 0===a.total?t.jsx("div",{className:"h-full flex items-center justify-center text-text-muted type-body-sm",children:"No neighbors discovered yet"}):t.jsxs("div",{className:"h-full flex flex-col",children:[t.jsx("div",{className:"flex-1 flex flex-col justify-evenly",children:a.items.map(e=>t.jsxs("div",{className:"flex flex-col gap-1.5",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"type-data-sm text-text-secondary",children:e.label}),t.jsxs("span",{className:"type-data-sm text-text-secondary tabular-nums",children:[e.count," ",t.jsxs("span",{className:"text-text-secondary/60",children:["(",e.percent.toFixed(0),"%)"]})]})]}),t.jsx("div",{className:"h-2.5 bg-bg-elevated overflow-hidden",children:t.jsx("div",{className:"h-full transition-all duration-500 ease-out",style:{width:`${e.percent}%`,backgroundColor:e.color,minWidth:e.count>0?"4px":"0"}})})]},e.label))}),t.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border-subtle",children:[t.jsx("span",{className:"type-data-xs text-text-secondary",children:"Total Nodes"}),t.jsx("span",{className:"type-data-sm text-text-primary font-medium tabular-nums",children:a.total})]})]})});function tt({children:s,minHeight:a="100%",rootMargin:n="200px 0px",keepMounted:l=!0,className:i=""}){const r=e.useRef(null),[o,c]=e.useState(!1),[m,d]=e.useState(!1);e.useEffect(()=>{const e=r.current;if(!e)return;const t=new IntersectionObserver(([e])=>{const t=e.isIntersecting;d(t),t&&c(!0)},{rootMargin:n,threshold:0});return t.observe(e),()=>{t.disconnect()}},[n]);const u=m||l&&o;return t.jsx("div",{ref:r,className:`h-full w-full ${i}`,style:{minHeight:a},children:u?s:t.jsx("div",{className:"h-full w-full flex items-center justify-center text-text-muted/50",children:t.jsx("div",{className:"animate-pulse text-xs",children:"Loading chart..."})})})}const st={excellent:"text-signal-excellent",good:"text-signal-good",fair:"text-signal-fair",poor:"text-accent-primary"},at={excellent:"bg-signal-excellent/10",good:"bg-signal-good/10",fair:"bg-signal-fair/10",poor:"bg-accent-primary/10"};function nt(){const s=M(),a=S(),[n,l]=e.useState(null),i=e.useCallback((e,t)=>{l({prefix:e,candidateHashes:t})},[]),r=e.useCallback(()=>{l(null)},[]);if(!a)return t.jsxs(J,{children:[t.jsx(le,{icon:t.jsx(Y,{}),title:"Prefix Conflicts",largeTitle:!0}),t.jsx("div",{className:"flex-1 flex items-center justify-center",children:t.jsxs("div",{className:"text-center text-text-secondary",children:[t.jsx(re,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),t.jsx("p",{className:"type-data-xs",children:"No topology data available"}),t.jsx("p",{className:"type-data-xs opacity-70",children:"Run deep analysis to see stats"})]})})]});const o=(c=s.avgConfidence)>=.9?"excellent":c>=.7?"good":c>=.5?"fair":"poor";var c;const m=(d=s.collisionRate)<=10?"excellent":d<=25?"good":"poor";var d;const u="poor"===o||"poor"===m?"poor":"fair"===o||"fair"===m?"fair":"good"===o||"good"===m?"good":"excellent",h="excellent"===u||"good"===u?pe:oe;return t.jsxs(J,{className:"flex flex-col overflow-hidden",children:[t.jsx(le,{icon:t.jsx(Y,{}),title:"Prefix Conflicts",largeTitle:!0,actions:t.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1 rounded-full ${at[u]}`,children:[t.jsx(h,{className:`w-3.5 h-3.5 ${st[u]}`}),t.jsx("span",{className:`type-data-xs font-medium ${st[u]}`,children:"excellent"===u?"Excellent":"good"===u?"Good":"fair"===u?"Fair":"Needs Attention"})]})}),t.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[t.jsxs("div",{className:"grid grid-cols-3 gap-1.5 sm:gap-2 py-3 sm:py-4",children:[t.jsxs("div",{className:"flex flex-col items-center cursor-help bg-white/5 radius-inner sm:radius-inset py-2 sm:py-3 px-1.5 sm:px-2",title:"Total unique 2-character prefixes observed in packet paths.",children:[t.jsx(U,{value:s.totalPrefixes,className:"font-mono text-2xl sm:text-3xl font-semibold tabular-nums text-text-primary",priority:"low"}),t.jsx("span",{className:"type-data-xs sm:type-data-sm text-text-secondary mt-0.5 sm:mt-1",children:"Prefixes"})]}),t.jsxs("div",{className:"flex flex-col items-center cursor-help bg-white/5 radius-inner sm:radius-inset py-2 sm:py-3 px-1.5 sm:px-2",title:"Prefixes that map to exactly one known node. No disambiguation needed.",children:[t.jsx(U,{value:s.unambiguousPrefixes,className:"font-mono text-2xl sm:text-3xl font-semibold tabular-nums text-text-primary",priority:"low"}),t.jsx("span",{className:"type-data-xs sm:type-data-sm text-text-secondary mt-0.5 sm:mt-1",children:"Unique"})]}),t.jsxs("div",{className:"flex flex-col items-center cursor-help radius-inner sm:radius-inset py-2 sm:py-3 px-1.5 sm:px-2 "+(s.collisionPrefixes>0?"bg-accent-primary/15":"bg-white/5"),title:"Prefixes matching multiple known nodes. Click a prefix below to explore candidates.",children:[t.jsx(U,{value:s.collisionPrefixes,className:"font-mono text-2xl sm:text-3xl font-semibold tabular-nums "+(s.collisionPrefixes>0?"text-accent-primary":"text-text-primary"),priority:"low"}),t.jsx("span",{className:"type-data-xs sm:type-data-sm mt-0.5 sm:mt-1 "+(s.collisionPrefixes>0?"text-accent-primary":"text-text-secondary"),children:"Conflicts"})]})]}),s.highCollisionPrefixes.length>0&&t.jsxs("div",{children:[t.jsx("div",{className:"type-data-xs text-text-secondary mb-1.5",children:"Problem Prefixes"}),t.jsx("div",{className:"flex flex-wrap gap-1.5 content-start",children:s.highCollisionPrefixes.map(({prefix:e,candidateCount:s,candidateHashes:a})=>t.jsxs("button",{type:"button",onClick:()=>i(e,a),className:"inline-flex items-center gap-0.5 group",title:`${s} candidates - click to explore`,children:[t.jsx(ae,{children:e}),t.jsxs("span",{className:"text-text-muted type-data-xs group-hover:text-text-secondary transition-colors",children:["×",s]})]},e))})]}),0===s.lowConfidencePrefixes.length&&0===s.collisionPrefixes&&t.jsx("div",{className:"flex-1 flex items-center",children:t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(pe,{className:"w-3.5 h-3.5 text-signal-excellent"}),t.jsx("span",{className:"type-data-xs text-signal-excellent",children:"All prefixes uniquely identified"})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 mt-auto pt-3",children:[t.jsxs("div",{className:"flex items-center gap-2 cursor-help",title:"Average confidence score across all disambiguated prefixes. Higher = more certain node identification.",children:[t.jsx("span",{className:"type-data-xs text-text-secondary",children:"Confidence"}),t.jsxs("span",{className:`data-box ${st[o]}`,children:[(100*s.avgConfidence).toFixed(1),"%"]})]}),t.jsxs("div",{className:"flex items-center gap-2 cursor-help",title:"Percentage of 2-character prefixes that match multiple known nodes. Lower is better.",children:[t.jsx("span",{className:"type-data-xs text-text-secondary",children:"Collisions"}),t.jsxs("span",{className:`data-box ${st[m]}`,children:[s.collisionRate.toFixed(1),"%"]})]})]})]}),t.jsx(ne,{isOpen:!!n,prefix:(null==n?void 0:n.prefix)||"",candidateHashes:(null==n?void 0:n.candidateHashes)||[],onClose:r})]})}function lt({icon:e,label:s,value:a,sublabel:n,highlight:l,tooltip:i}){return t.jsxs("div",{className:"flex items-center justify-between gap-2 py-1.5 "+(i?"cursor-help":""),title:i,children:[t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 min-w-0",children:[t.jsx("span",{className:"icon-xs text-icon-widget flex-shrink-0",children:e}),t.jsx("span",{className:"type-body-sm text-text-secondary truncate",children:s})]}),t.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5 flex-shrink-0",children:[t.jsx("span",{className:"data-box",style:l?{"--data-box-color":"var(--accent-primary)"}:void 0,children:a}),n&&t.jsx("span",{className:"type-data-xs text-text-secondary hidden sm:inline",children:n})]})]})}function it(){const e=C(),s=T().length;if(!e||0===e.totalPaths)return null;const{totalPaths:a,pathsWithGhosts:n,observationOverrideCount:l,tracePacketsProcessed:i,pathPacketsProcessed:r,distantEdgesDiscovered:o,duplicateGroupsFound:c,duplicatePathsUnique:m,echolocationEdgesInferred:d}=e,u=a>0?((a-n)/a*100).toFixed(1):"0",h=a>0?(l/a*100).toFixed(1):"0",x=i+r,p=x>0||o>0,g=c>0||d>0;return t.jsxs(J,{children:[t.jsx(le,{title:"Path Decoder",icon:t.jsx(V,{}),largeTitle:!0,badge:s>0?`${s} hidden`:void 0}),t.jsxs(ie,{children:[t.jsxs("div",{children:[t.jsx(lt,{icon:t.jsx(ye,{className:"w-3.5 h-3.5"}),label:"Traceable",value:`${u}%`,sublabel:`of ${a.toLocaleString()} paths`,tooltip:"Percentage of packet journeys where every hop was identified. Higher = better visibility into how traffic flows through your mesh."}),t.jsx(lt,{icon:t.jsx(je,{className:"w-3.5 h-3.5"}),label:"Learning Rate",value:`${h}%`,sublabel:"adapted",tooltip:"How often real traffic patterns improved our predictions over geography alone. Higher values mean the decoder is learning your mesh's actual behavior — which routes are preferred, which nodes are most active."})]}),p&&t.jsxs("div",{className:"mt-3",children:[t.jsx("p",{className:"type-micro mb-2",children:"Beyond Line-of-Sight"}),t.jsxs("div",{children:[t.jsx(lt,{icon:t.jsx(be,{className:"w-3.5 h-3.5"}),label:"Route Reports",value:x.toLocaleString(),sublabel:i>0?`(${i} TRACE)`:void 0,tooltip:"TRACE/PATH packets from distant nodes share their routing tables. This reveals connections we can't directly observe — mapping parts of the mesh we don't touch."}),t.jsx(lt,{icon:t.jsx(ce,{className:"w-3.5 h-3.5"}),label:"Remote Links",value:o.toLocaleString(),highlight:o>0,tooltip:"Node-to-node connections discovered from route reports. These links exist outside our RF range but help complete the topology picture."})]})]}),g&&t.jsx(lt,{icon:t.jsx(A,{className:"w-3.5 h-3.5"}),label:"Multi-Path Packets",value:c.toLocaleString(),sublabel:m>0?`(${m} routes)`:void 0,tooltip:"Packets received via multiple paths simultaneously. Like sonar, these 'echoes' reveal redundant routes — important for understanding mesh resilience."}),s>0&&t.jsx(lt,{icon:t.jsx(F,{className:"w-3.5 h-3.5 text-accent-primary"}),label:"Ghost Repeaters",value:s,highlight:!0,tooltip:"High-confidence hidden repeaters: appear in 10+ paths, have 2+ known neighbors, ≥30% confidence, and plausible location. View them on the Contacts map."})]})]})}function rt(){var s,a,n,l,i,r,o,c,m,d,u,h,x,p,g,f,y;const b=P(),j=L(),v=$(),N=R(),k=D(),w=z(),M=B(),S=E(),[C,T]=e.useState([]),[A,F]=e.useState(null),[Y,V]=e.useState(null),[K,U]=e.useState(!0),[ae,ne]=e.useState(null),[ie,re]=e.useState(()=>{const e=localStorage.getItem("statistics-view-mode");return"share"===e||"airtime"===e?e:"airtime"});e.useEffect(()=>{localStorage.setItem("statistics-view-mode",ie)},[ie]);const[oe,ce]=e.useState(()=>{const e=localStorage.getItem("statistics-smoothing-mode");return["ema","ultra","mosaic","stats","trend"].includes(e)?e:"stats"});e.useEffect(()=>{localStorage.setItem("statistics-smoothing-mode",oe)},[oe]);const[ue,xe]=e.useState(!1),[pe,ge]=e.useState(!1),[fe,ye]=e.useState(Ne),[be,je]=e.useState(.5),ve=e.useMemo(()=>({0:0,1:0,2:1,3:2,4:3,5:4,6:5,7:6}[M]??3),[M]),Se=_[ve].hours,Ce=60*Se,Te=_[ve],Ae=q(Se),Fe=w.isBackgroundLoading,Pe=e.useCallback(e=>{S({0:1,1:2,2:3,3:4,4:5,5:6,6:7}[e]??4)},[S]),Le=e.useMemo(()=>{var e;if(!(null==(e=null==b?void 0:b.config)?void 0:e.radio))return null;const t=b.config.radio;return{sf:t.spreading_factor??10,bw:t.bandwidth??25e4,cr:t.coding_rate??5,preamble:t.preamble_length??8}},[null==(a=null==(s=null==b?void 0:b.config)?void 0:s.radio)?void 0:a.spreading_factor,null==(l=null==(n=null==b?void 0:b.config)?void 0:n.radio)?void 0:l.bandwidth,null==(r=null==(i=null==b?void 0:b.config)?void 0:i.radio)?void 0:r.coding_rate,null==(c=null==(o=null==b?void 0:b.config)?void 0:o.radio)?void 0:c.preamble_length]);e.useEffect(()=>{!async function(){var e;ne(null);try{const t=await H(Se);t.success&&(null==(e=t.data)?void 0:e.history)&&T(t.data.history)}catch(t){ne(t instanceof Error?t.message:"Failed to load chart data")}finally{U(!1)}}()},[Se]);const $e=e.useMemo(()=>72===Se?6e5:168===Se?18e5:336===Se?36e5:3e5,[Se]),Re=e.useCallback(async()=>{var e;try{const t=await H(Se);t.success&&(null==(e=t.data)?void 0:e.history)&&T(t.data.history)}catch{}},[Se]);I(Re,$e,!0,!0);const Ee=e.useMemo(()=>0===C.length?{timestamps:[],values:[]}:{timestamps:C.map(e=>e.timestamp),values:C.map(e=>e.noise_floor_dbm)},[C]),_e=e.useMemo(()=>{if(C.length<10)return{anomalies:[],debug:void 0};const e=function(e,t={}){const s={...Ne,...t};if(e.length<10)return{anomalies:[],thresholds:we([]),totalSamples:e.length,anomalySamples:0};const a=e.map(e=>e.noise_floor_dbm),n=we(a),l=[...a].sort((e,t)=>e-t);let i,r;s.useAbsoluteThresholds?(i=s.baselineDbm,r=s.spikeDbm):(i=ke(l,s.baselinePercentile),r=ke(l,s.spikePercentile));const o=[...e].sort((e,t)=>e.timestamp-t.timestamp),c=[];let m=null,d=0;for(const u of o)if(u.noise_floor_dbm>i&&u.noise_floor_dbm<r)if(d++,m){const e=Math.abs(u.noise_floor_dbm-m.rollingAvg)<=s.similarityToleranceDbm,t=u.timestamp-m.endTs<=s.mergeGapSeconds;e&&t?(m.endTs=u.timestamp,m.values.push(u.noise_floor_dbm),m.timestamps.push(u.timestamp),m.rollingAvg=m.values.reduce((e,t)=>e+t,0)/m.values.length):(m.values.length>=s.minSequenceLength&&c.push(m),m={startTs:u.timestamp,endTs:u.timestamp,values:[u.noise_floor_dbm],timestamps:[u.timestamp],rollingAvg:u.noise_floor_dbm})}else m={startTs:u.timestamp,endTs:u.timestamp,values:[u.noise_floor_dbm],timestamps:[u.timestamp],rollingAvg:u.noise_floor_dbm};else m&&m.values.length>=s.minSequenceLength&&c.push(m),m=null;return m&&m.values.length>=s.minSequenceLength&&c.push(m),0===c.length?{anomalies:[],thresholds:n,totalSamples:e.length,anomalySamples:d,debug:{baselineCutoff:i,spikeCutoff:r,midBandSamples:d}}:{anomalies:c.map(e=>{const t=Math.max(...e.values),s=e.values.reduce((e,t)=>e+t,0)/e.values.length;return{startTs:e.startTs,endTs:e.endTs,peakValue:t,avgValue:s,severity:Me(s,i,r),sampleCount:e.values.length}}),thresholds:n,totalSamples:e.length,anomalySamples:d,debug:{baselineCutoff:i,spikeCutoff:r,midBandSamples:d}}}(C,fe);return{anomalies:e.anomalies,debug:e.debug}},[C,fe]),He=_e.anomalies,qe=e.useMemo(()=>{const e=(null==b?void 0:b.neighbors)??{};return Object.fromEntries(Object.entries(e).filter(([e])=>!j.has(e)))},[null==b?void 0:b.neighbors,j]),Oe=e.useMemo(()=>{const e=Date.now()/1e3-3600*Se;return Object.fromEntries(Object.entries(qe).filter(([,t])=>t.last_seen>=e))},[qe,Se]),We=e.useMemo(()=>{const e=60*Ce/Ae,t=Math.floor(Date.now()/1e3),s=Math.floor(t/e)*e;return{start:s-60*Ce,end:s}},[Ce,Ae]);return t.jsxs(ee,{children:[t.jsx(te,{title:"Statistics",icon:t.jsx(O,{}),controls:t.jsx(Z,{ranges:_,selectedIndex:ve,onSelect:Pe,isPending:Fe})}),ae&&t.jsx(J,{className:"border border-accent-red/50 bg-accent-red/10",children:t.jsx("p",{className:"text-accent-red",children:ae})}),ue&&pe&&t.jsxs(J,{className:"border border-accent-purple/30 bg-glass-surface/50",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"type-label",children:"Anomaly Detection Tuning"}),t.jsxs("span",{className:"type-data-xs text-text-muted",children:["(",Te.label,")"]})]}),t.jsx("button",{onClick:()=>ye(e=>({...e,useAbsoluteThresholds:!e.useAbsoluteThresholds})),className:"type-data-xs px-2 py-1 rounded transition-colors "+(fe.useAbsoluteThresholds?"bg-accent-purple/30 text-accent-purple":"bg-glass-elevated text-text-muted hover:text-text-secondary"),children:fe.useAbsoluteThresholds?"Absolute dBm":"Percentile"})]}),t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[t.jsxs("div",{children:[t.jsx("span",{className:"type-micro",children:"Baseline"}),t.jsxs("span",{className:"ml-2 type-data-sm text-status-warning",children:[(null==(d=null==(m=_e.debug)?void 0:m.baselineCutoff)?void 0:d.toFixed(1))??"—"," dBm"]})]}),t.jsxs("div",{children:[t.jsx("span",{className:"type-micro",children:"Spike"}),t.jsxs("span",{className:"ml-2 type-data-sm text-status-warning",children:[(null==(h=null==(u=_e.debug)?void 0:u.spikeCutoff)?void 0:h.toFixed(1))??"—"," dBm"]})]}),t.jsxs("div",{children:[t.jsx("span",{className:"type-micro",children:"Mid-band"}),t.jsx("span",{className:"ml-2 type-data-sm text-accent-purple",children:(null==(x=_e.debug)?void 0:x.midBandSamples)??0})]}),t.jsxs("div",{children:[t.jsx("span",{className:"type-micro",children:"Anomalies"}),t.jsx("span",{className:"ml-2 type-data-sm text-status-danger",children:He.length})]})]}),t.jsxs("div",{className:"mt-4 pt-4 border-t border-border-subtle space-y-4",children:[fe.useAbsoluteThresholds?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"type-micro block mb-1",children:["Baseline (",fe.baselineDbm," dBm)"]}),t.jsx("input",{type:"range",min:"-120",max:"-60",value:fe.baselineDbm,onChange:e=>ye(t=>({...t,baselineDbm:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"type-micro block mb-1",children:["Spike (",fe.spikeDbm," dBm)"]}),t.jsx("input",{type:"range",min:"-100",max:"-20",value:fe.spikeDbm,onChange:e=>ye(t=>({...t,spikeDbm:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"type-micro block mb-1",children:["Merge Gap (",fe.mergeGapSeconds,"s)"]}),t.jsx("input",{type:"range",min:"5",max:"120",step:"5",value:fe.mergeGapSeconds,onChange:e=>ye(t=>({...t,mergeGapSeconds:Number(e.target.value)})),className:"w-full accent-accent-purple"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"type-micro block mb-1",children:["Min Sequence (",fe.minSequenceLength,")"]}),t.jsx("input",{type:"range",min:"2",max:"20",value:fe.minSequenceLength,onChange:e=>ye(t=>({...t,minSequenceLength:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"type-micro block mb-1",children:["Similarity (±",fe.similarityToleranceDbm," dBm)"]}),t.jsx("input",{type:"range",min:"1",max:"15",value:fe.similarityToleranceDbm,onChange:e=>ye(t=>({...t,similarityToleranceDbm:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"type-micro block mb-1",children:["Opacity (",Math.round(100*be),"%)"]}),t.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.05",value:be,onChange:e=>je(Number(e.target.value)),className:"w-full accent-accent-purple"})]})]})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"type-micro block mb-1",children:["Baseline (P",fe.baselinePercentile,")"]}),t.jsx("input",{type:"range",min:"1",max:"50",value:fe.baselinePercentile,onChange:e=>ye(t=>({...t,baselinePercentile:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"type-micro block mb-1",children:["Spike (P",fe.spikePercentile,")"]}),t.jsx("input",{type:"range",min:"50",max:"99",value:fe.spikePercentile,onChange:e=>ye(t=>({...t,spikePercentile:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"type-micro block mb-1",children:["Merge Gap (",fe.mergeGapSeconds,"s)"]}),t.jsx("input",{type:"range",min:"5",max:"120",step:"5",value:fe.mergeGapSeconds,onChange:e=>ye(t=>({...t,mergeGapSeconds:Number(e.target.value)})),className:"w-full accent-accent-purple"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"type-micro block mb-1",children:["Min Sequence (",fe.minSequenceLength,")"]}),t.jsx("input",{type:"range",min:"2",max:"20",value:fe.minSequenceLength,onChange:e=>ye(t=>({...t,minSequenceLength:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"type-micro block mb-1",children:["Similarity (±",fe.similarityToleranceDbm," dBm)"]}),t.jsx("input",{type:"range",min:"1",max:"15",value:fe.similarityToleranceDbm,onChange:e=>ye(t=>({...t,similarityToleranceDbm:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"type-micro block mb-1",children:["Opacity (",Math.round(100*be),"%)"]}),t.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.05",value:be,onChange:e=>je(Number(e.target.value)),className:"w-full accent-accent-purple"})]})]})]}),t.jsxs("div",{className:"mt-4 p-3 bg-glass-elevated radius-inner",children:[t.jsx("div",{className:"type-micro mb-1",children:"Config output"}),t.jsxs("div",{className:"type-data-sm text-status-success",children:[fe.useAbsoluteThresholds?`useAbsoluteThresholds: true, baselineDbm: ${fe.baselineDbm}, spikeDbm: ${fe.spikeDbm}`:`useAbsoluteThresholds: false, baselinePercentile: ${fe.baselinePercentile}, spikePercentile: ${fe.spikePercentile}`,", mergeGapSeconds: ",fe.mergeGapSeconds,", minSequenceLength: ",fe.minSequenceLength,", similarityToleranceDbm: ",fe.similarityToleranceDbm]})]})]})]}),t.jsxs(se,{children:[Fe&&t.jsx(me,{template:"auto",children:t.jsx(J,{className:"border border-accent-primary/30 bg-accent-primary/5",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"relative flex h-3 w-3",children:[t.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-accent-primary opacity-75"}),t.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-accent-primary"})]}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("p",{className:"type-body-sm text-text-primary",children:["Loading ",Te.label," data..."]}),w.loadProgress&&t.jsxs("p",{className:"type-data-xs text-text-muted mt-0.5",children:[w.loadProgress.loaded.toLocaleString()," packets (",w.loadProgress.percent,"%)"]})]})]})})}),K?t.jsx(me,{template:"auto",children:t.jsx(J,{className:"text-center py-12",children:t.jsx("div",{className:"animate-pulse text-text-muted",children:"Loading statistics..."})})}):t.jsxs(t.Fragment,{children:[t.jsx(me,{template:"hero-auto",children:t.jsx(J,{isLoaded:k,skeletonType:"chart",children:k&&t.jsxs(t.Fragment,{children:[t.jsx(le,{icon:t.jsx(X,{}),title:"Packet Analyzer",badge:Te.label,largeTitle:!0,stackActionsOnMobile:!0,actions:t.jsxs("div",{className:"flex flex-wrap items-center gap-2 justify-end",children:["stats"===oe&&t.jsx(Be,{enabled:ue,onChange:xe,anomalyCount:He.length,showTuning:pe,onTuningChange:ge}),t.jsx(ze,{smoothing:oe,onChange:ce}),t.jsx(De,{mode:ie,onChange:re})]})}),t.jsx("div",{className:"flex-1 min-h-0",children:t.jsx(Ge,{packets:N,startTs:We.start,endTs:We.end,bucketCount:Ae,radioConfig:Le??void 0,mode:ie,smoothing:oe,noiseFloorAnomalies:He,showNoiseFloorOverlay:ue,overlayOpacity:be})})]})})}),t.jsxs(me,{template:"panel",children:[t.jsx(de,{span:12,md:6,children:t.jsx(J,{isLoaded:k,skeletonType:"chart",children:k&&t.jsxs(t.Fragment,{children:[t.jsx(le,{icon:t.jsx(Q,{}),title:"Link Quality",badge:Te.label,largeTitle:!0,actions:Y?t.jsxs("div",{className:"flex items-center gap-3 type-data-xs text-text-muted",children:[t.jsxs("span",{children:[t.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:Y.zeroHopCount})," nbr"]}),t.jsxs("span",{children:[t.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:Y.totalCount})," obs"]}),t.jsxs("span",{children:[t.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:Y.maxDistanceKm.toFixed(0)})," km"]})]}):null}),t.jsx("div",{className:"flex-1 min-h-0",children:t.jsx(tt,{children:t.jsx(Ue,{neighbors:Oe,quickNeighbors:v,localLat:(null==(g=null==(p=null==b?void 0:b.config)?void 0:p.repeater)?void 0:g.latitude)??0,localLon:(null==(y=null==(f=null==b?void 0:b.config)?void 0:f.repeater)?void 0:y.longitude)??0,onStatsChange:V})})})]})})}),t.jsx(de,{span:12,md:6,children:t.jsx(J,{isLoaded:k,skeletonType:"chart",children:k&&t.jsxs(t.Fragment,{children:[t.jsx(le,{icon:t.jsx(he,{}),title:"Network Composition",badge:Te.label,largeTitle:!0}),t.jsx("div",{className:"flex-1 min-h-0",children:t.jsx(tt,{children:t.jsx(et,{neighbors:Oe})})})]})})})]}),t.jsxs(me,{template:"panel",children:[t.jsx(de,{span:12,md:6,children:t.jsx(nt,{})}),t.jsx(de,{span:12,md:6,children:t.jsx(it,{})})]}),t.jsx(me,{template:"panel",children:t.jsx(de,{span:12,children:t.jsx(J,{isLoaded:k,skeletonType:"chart",children:k&&t.jsxs(t.Fragment,{children:[t.jsx(le,{icon:t.jsx(W,{}),title:"RF Noise Floor",largeTitle:!0,stackActionsOnMobile:!0,actions:A?t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[t.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["min ",t.jsx("span",{className:"text-text-secondary tabular-nums",children:A.min.toFixed(0)})]}),t.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["avg ",t.jsx("span",{className:"text-text-secondary tabular-nums",children:A.avg.toFixed(0)})]}),t.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["max ",t.jsx("span",{className:"text-text-secondary tabular-nums",children:A.max.toFixed(0)})]}),t.jsx("span",{className:"type-data-xs text-text-muted",children:"dBm"})]}):t.jsx("span",{className:"type-data-xs text-text-muted",children:"dBm"})}),t.jsx("div",{className:"flex-1 min-h-0",children:t.jsx(tt,{children:t.jsx(G,{timestamps:Ee.timestamps,values:Ee.values,onStatsChange:F})})})]})})})})]})]})]})}export{rt as default};
