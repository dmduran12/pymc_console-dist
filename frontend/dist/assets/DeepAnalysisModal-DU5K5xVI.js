import{c as e,aw as t,cW as a,cX as s,H as i,cY as n,I as c,m as r,at as o}from"./index-CrU_Ps9k.js";import{r as l,j as d,c as m}from"./vendor-react-BKIq8k5U.js";import{e as p,d as x}from"./config-C7QO3CEB.js";import{C as h}from"./DataBox-sJHphnZd.js";import{G as g}from"./git-branch-CkXjQHb9.js";import{D as y}from"./database-lWroaxsL.js";import{L as f}from"./loader-circle-D6Apotf0.js";const u=e("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),j=e("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]),b=e("minimize-2",[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]]),v={hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1,transition:{type:"spring",stiffness:400,damping:15}},exit:{opacity:0,scale:.9,transition:{duration:x.fast}}},N={hidden:{opacity:0,y:"100%"},visible:{opacity:1,y:0,transition:{type:"spring",stiffness:400,damping:30}},exit:{opacity:0,y:"100%",transition:{duration:x.medium,ease:p.easeIn}}};function k({label:e,icon:t,status:a,detail:s}){return d.jsxs("div",{className:m("flex items-center gap-3 py-3 px-4 radius-inset transition-base","active"===a&&"bg-accent-primary/10","complete"===a&&"bg-accent-primary/10 ring-2 ring-inset ring-accent-primary","pending"===a&&"opacity-40"),children:[d.jsx("div",{className:m("w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 transition-all duration-300","active"===a&&"bg-accent-primary/20","complete"===a&&"bg-accent-primary/20","pending"===a&&"bg-subtle-fill"),children:"complete"===a?d.jsx(h,{className:"w-4 h-4 text-accent-primary"}):"active"===a?d.jsx(f,{className:"w-4 h-4 animate-spin text-accent-primary"}):d.jsx("span",{className:"text-text-muted",children:t})}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsx("div",{className:m("text-sm font-medium transition-colors","active"===a&&"text-accent-primary","complete"===a&&"text-accent-primary","pending"===a&&"text-text-muted"),children:e}),s&&"pending"!==a&&d.jsx("div",{className:"text-xs text-text-muted mt-0.5 truncate",children:s})]})]})}const w=l.memo(function({isOpen:e,onClose:m}){const{packetCacheState:p,triggerDeepAnalysis:x}=t(),f=a(),j=s(),b=p.packetCount,[N,w]=l.useState("fetching");l.useEffect(()=>{e&&x()},[e,x]),l.useEffect(()=>{if(e)if(p.isTopologyLoading)w("fetching");else if(f)w("analyzing"),setTimeout(()=>w("building"),500),setTimeout(()=>w("discovering"),1e3);else if(j>0&&!p.isTopologyLoading){w("complete");const e=setTimeout(()=>{m()},1500);return()=>clearTimeout(e)}},[e,p.isTopologyLoading,f,j,m]);const M="complete"===N,T=p.loadProgress,z=l.useMemo(()=>T&&T.target>0?`Loading... ${(T.loaded/1e3).toFixed(1)}k / ${(T.target/1e3).toFixed(1)}k packets (${T.percent}%)`:b>0?`${b.toLocaleString()} packets loaded`:"Connecting to database...",[T,b]),C=e=>{const t=["fetching","analyzing","building","discovering","complete"],a=t.indexOf(N),s=t.indexOf(e);return s<a?"complete":s===a?"active":"pending"},D=M?m:()=>{};return d.jsx(i,{open:e,onClose:D,size:"sm",bottomSheet:!1,children:d.jsx(n,{isLoading:!M,borderRadius:16,children:d.jsx(c,{className:"p-6 radius-card overflow-hidden",children:M?d.jsxs("div",{className:"flex flex-col items-center py-6",children:[d.jsx(r.div,{variants:v,initial:"hidden",animate:"visible",className:"w-16 h-16 rounded-full flex items-center justify-center mb-4 bg-accent-primary/20",children:d.jsx(h,{className:"w-8 h-8 text-accent-primary"})}),d.jsx("h3",{className:"text-lg font-semibold text-accent-primary",children:"Ready!"})]}):d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[d.jsx("div",{className:"w-10 h-10 radius-inset flex items-center justify-center bg-accent-primary/15",children:d.jsx(g,{className:"w-5 h-5 text-accent-primary"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-base font-semibold text-text-primary",children:"Deep Analysis"}),d.jsx("p",{className:"text-xs text-text-muted",children:"Building mesh topology"})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(k,{label:"Fetching Packets",icon:d.jsx(u,{className:"w-4 h-4"}),status:C("fetching"),detail:z}),d.jsx(k,{label:"Analyzing Database",icon:d.jsx(y,{className:"w-4 h-4"}),status:C("analyzing"),detail:"Processing packet paths"}),d.jsx(k,{label:"Building Topology",icon:d.jsx(g,{className:"w-4 h-4"}),status:C("building"),detail:"Computing mesh edges"}),d.jsx(k,{label:"Discovering Nodes",icon:d.jsx(o,{className:"w-4 h-4"}),status:C("discovering"),detail:"Viterbi HMM ghost detection"})]}),d.jsx("p",{className:"text-xs text-text-muted text-center mt-5",children:"This may take a few seconds..."})]})})})})});export{w as D,b as M,j as a,u as b,N as s};
