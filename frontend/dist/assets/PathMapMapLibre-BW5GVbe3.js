import{r as e,j as o,aZ as t,a_ as r,a$ as n,b0 as i,b1 as a}from"./vendor-react-CUlQ5-Td.js";import"./maplibre-gl-WBl_4I3M.js";import"./vendor-core-XI_xDZ-M.js";import"./deckgl-MTXp-Y3t.js";const l={nodeColor:"#4338CA",localColor:"#4F46E5",hubColor:"#6366F1",edgeColor:"#3B3F4A",ambiguousColor:"#F9D26F",highlightColor:"#B49DFF",sourceColor:"#39D98A",destinationColor:"#B49DFF"};function s(){if("undefined"==typeof document)return l;const e=document.documentElement,o=getComputedStyle(e);return{nodeColor:o.getPropertyValue("--map-node-stroke").trim()||l.nodeColor,localColor:o.getPropertyValue("--map-local-color").trim()||l.localColor,hubColor:o.getPropertyValue("--map-hub-color").trim()||l.hubColor,edgeColor:o.getPropertyValue("--map-edge-rest").trim()||l.edgeColor,ambiguousColor:o.getPropertyValue("--accent-secondary").trim()||l.ambiguousColor,highlightColor:o.getPropertyValue("--accent-primary").trim()||l.highlightColor,sourceColor:o.getPropertyValue("--accent-success").trim()||l.sourceColor,destinationColor:o.getPropertyValue("--accent-primary").trim()||l.destinationColor}}function d(e,o,t,r=!1,n=!1,i=!1){const a=s(),l=r?`box-shadow: 0 0 0 3px ${a.highlightColor}40, 0 0 8px ${a.highlightColor}60;`:"";let d;d=n?a.sourceColor:i?a.destinationColor:e?a.localColor:o?a.hubColor:t?"transparent":a.ambiguousColor;const c=e||o||!t||n||i;return`<div style="\n    width: 14px;\n    height: 14px;\n    background: ${d};\n    border-radius: 50%;\n    border: ${c?0:5}px solid ${c?"transparent":a.nodeColor};\n    box-sizing: border-box;\n    transition: box-shadow 0.15s ease;\n    ${l}\n  "></div>`}function c({resolvedPath:l,localNode:c,hubNodes:u=[],hoveredHopIndex:p,onHoverHop:m}){const h=e.useRef(null),g=e.useMemo(()=>new Set(u),[u]),[x,C]=e.useState(null),[b,y]=e.useState(0);e.useEffect(()=>{var e;const o=null==(e=h.current)?void 0:e.getMap();if(!o)return;const t=o.getCanvas();if(!t)return;const r=e=>{e.preventDefault()},n=()=>{y(e=>e+1)};return t.addEventListener("webglcontextlost",r),t.addEventListener("webglcontextrestored",n),()=>{t.removeEventListener("webglcontextlost",r),t.removeEventListener("webglcontextrestored",n)}},[b]);const{positions:f,markers:v,pathLineGeoJSON:j}=e.useMemo(()=>{const e=[],o=[],t=[];l.hops.forEach((r,n)=>{const i=r.candidates.filter(e=>{return o=e.latitude,t=e.longitude,0!==o||0!==t;var o,t});if(0===i.length)return;const a=[...i].sort((e,o)=>o.probability-e.probability)[0];t.push([a.longitude,a.latitude]);const l=!0===r.isSource,s=!0===r.isDestination;i.forEach((t,a)=>{const d=[t.latitude,t.longitude];e.push(d);const c=0===a;o.push({position:d,prefix:r.prefix,confidence:r.confidence,candidateCount:i.length,hopIndex:n,candidate:t,isHub:g.has(t.hash),isPrimary:c,isSource:l,isDestination:s})})});const r={type:"FeatureCollection",features:t.length>=2?[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:t}}]:[]};return{positions:e,markers:o,pathLineGeoJSON:r}},[l,g]),{initialBounds:k,center:N,zoom:S}=e.useMemo(()=>{if(0===f.length)return c?{initialBounds:null,center:[c.longitude,c.latitude],zoom:10}:{initialBounds:null,center:[0,0],zoom:2};let e=1/0,o=-1/0,t=1/0,r=-1/0;for(const[a,l]of f)a<e&&(e=a),a>o&&(o=a),l<t&&(t=l),l>r&&(r=l);const n=(e+o)/2,i=(t+r)/2;if(f.length>=2){const a=.15*(o-e)||.01,l=.15*(r-t)||.01;return{initialBounds:[[t-l,e-a],[r+l,o+a]],center:[i,n],zoom:10}}return{initialBounds:null,center:[i,n],zoom:12}},[f,c]),P=e.useCallback(e=>{C({longitude:e.position[1],latitude:e.position[0],marker:e})},[]);if(0===f.length)return o.jsx("div",{className:"h-[200px] flex items-center justify-center text-text-muted text-sm bg-bg-elevated",children:"No mappable path data"});const F=k?{bounds:k,fitBoundsOptions:{padding:30,maxZoom:16}}:{longitude:N[0],latitude:N[1],zoom:S};return o.jsxs(t,{ref:h,initialViewState:F,style:{height:"200px",width:"100%"},mapStyle:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",attributionControl:!1,children:[j.features.length>0&&o.jsx(r,{id:"path-line-source",type:"geojson",data:j,children:o.jsx(n,{id:"path-line",type:"line",paint:{"line-color":s().edgeColor,"line-width":2,"line-opacity":.7},layout:{"line-cap":"round","line-join":"round"}})}),v.map(e=>{const t=p===e.hopIndex;return o.jsx(i,{longitude:e.position[1],latitude:e.position[0],anchor:"center",onClick:()=>P(e),children:o.jsx("div",{style:{cursor:"pointer",opacity:e.isPrimary?1:.5},onMouseEnter:()=>null==m?void 0:m(e.hopIndex),onMouseLeave:()=>null==m?void 0:m(null),dangerouslySetInnerHTML:{__html:d(e.candidate.isLocal||!1,e.isHub,e.isPrimary,t,e.isSource,e.isDestination)}})},`${e.hopIndex}-${e.candidate.hash}`)}),x&&o.jsx(a,{longitude:x.longitude,latitude:x.latitude,anchor:"bottom",offset:[0,-12],closeOnClick:!1,onClose:()=>C(null),className:"maplibre-popup",children:o.jsxs("div",{className:"text-xs",children:[o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("span",{className:"font-semibold",children:x.marker.candidate.name}),(()=>{const e=s();return o.jsxs(o.Fragment,{children:[x.marker.isSource&&o.jsx("span",{className:"px-1 py-0.5 text-[8px] font-bold rounded",style:{backgroundColor:e.sourceColor,color:"#000"},children:"SRC"}),x.marker.isDestination&&o.jsx("span",{className:"px-1 py-0.5 text-[8px] font-bold rounded",style:{backgroundColor:e.destinationColor,color:"#000"},children:"DST"}),x.marker.isHub&&o.jsx("span",{className:"px-1 py-0.5 text-[8px] font-bold rounded",style:{backgroundColor:e.hubColor,color:"#000"},children:"HUB"}),x.marker.candidate.isLocal&&o.jsx("span",{className:"px-1 py-0.5 text-[8px] font-bold rounded",style:{backgroundColor:e.localColor,color:"#fff"},children:"LOCAL"})]})})()]}),o.jsxs("div",{className:"text-text-muted font-mono text-[10px]",children:[x.marker.prefix," â€¢ ",x.marker.candidate.hash.slice(0,10),"..."]}),!x.marker.isPrimary&&x.marker.candidateCount>1&&o.jsxs("div",{style:{color:s().ambiguousColor},children:["Alternative (",(100*x.marker.candidate.probability).toFixed(0),"%)"]}),x.marker.isPrimary&&x.marker.candidateCount>1&&o.jsxs("div",{className:"text-text-muted",children:[x.marker.candidateCount," candidates"]})]})})]},b)}export{c as default};
