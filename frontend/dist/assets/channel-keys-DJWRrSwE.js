var t=Object.defineProperty,e=(e,a,n)=>((e,a,n)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n)(e,"symbol"!=typeof a?a+"":a,n);import{_ as a}from"./deckgl-DTsmDcfs.js";const n=0,r=1,s=2,o=3,i={[n]:"T_FLOOD",[r]:"FLOOD",[s]:"DIRECT",[o]:"T_DIRECT"},c=0,h=1,l=2,p=3,u=4,y=5,d=6,g=7,f=8,m=9,w=10,T=11,A=15,x={REQ:0,RESPONSE:1,ADVERT:4,GRP_TXT:5,GRP_DATA:6,ANON_REQ:7,TRACE:9},C={[c]:"REQ",[h]:"RESPONSE",[l]:"TXT_MSG",[p]:"ACK",[u]:"ADVERT",[y]:"GRP_TXT",[d]:"GRP_DATA",[g]:"ANON_REQ",[f]:"PATH",[m]:"TRACE",[w]:"MULTIPART",[T]:"CONTROL",[A]:"RAW_CUSTOM"};function _(t){return i[t]??`UNKNOWN(${t})`}function b(t){return C[t]??`UNKNOWN(${t})`}function H(t){const e=t.replace(/^0x/i,"").replace(/\s/g,"");if(e.length%2!=0)throw new Error("Invalid hex string: odd number of characters");const a=new Uint8Array(e.length/2);for(let n=0;n<a.length;n++){const t=parseInt(e.substr(2*n,2),16);if(isNaN(t))throw new Error("Invalid hex character at position "+2*n);a[n]=t}return a}function N(t,e=!0,a=!1){let n=Array.from(t).map(t=>t.toString(16).padStart(2,"0")).join("");return e&&(n=n.toUpperCase()),a&&(n="0x"+n),n}function S(t,e=!0){const a=(255&t).toString(16).padStart(2,"0");return e?a.toUpperCase():a}function U(t,e,a,n){if(t+e>a)throw new Error(n)}async function E(t){const e=new ArrayBuffer(t.length);new Uint8Array(e).set(t);const a=await crypto.subtle.digest("SHA-256",e);return new Uint8Array(a)}const D=new Uint8Array([99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22]),L=new Uint8Array([82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125]),v=new Uint8Array([1,2,4,8,16,32,64,128,27,54]);function R(t,e){let a=0;for(let n=0;n<8;n++){1&e&&(a^=t);const n=128&t;t=t<<1&255,n&&(t^=27),e>>=1}return a}function O(t){let e=t[13];t[13]=t[9],t[9]=t[5],t[5]=t[1],t[1]=e,e=t[2],t[2]=t[10],t[10]=e,e=t[6],t[6]=t[14],t[14]=e,e=t[3],t[3]=t[7],t[7]=t[11],t[11]=t[15],t[15]=e}function k(t){for(let e=0;e<16;e++)t[e]=L[t[e]]}function M(t,e){for(let a=0;a<16;a++)t[a]^=e[a]}function P(t){for(let e=0;e<4;e++){const a=4*e,n=t[a],r=t[a+1],s=t[a+2],o=t[a+3];t[a]=R(14,n)^R(11,r)^R(13,s)^R(9,o),t[a+1]=R(9,n)^R(14,r)^R(11,s)^R(13,o),t[a+2]=R(13,n)^R(9,r)^R(14,s)^R(11,o),t[a+3]=R(11,n)^R(13,r)^R(9,s)^R(14,o)}}function $(t,e){const a=new Uint8Array(t);M(a,e[10]);for(let n=9;n>=1;n--)O(a),k(a),M(a,e[n]),P(a);return O(a),k(a),M(a,e[0]),a}function K(t,e){const a=function(t){const e=[],a=new Uint8Array(176);a.set(t.slice(0,16));for(let n=16;n<176;n+=4){let t=a[n-4],e=a[n-3],r=a[n-2],s=a[n-1];if(n%16==0){const a=t;t=D[e]^v[n/16-1],e=D[r],r=D[s],s=D[a]}a[n]=a[n-16]^t,a[n+1]=a[n-15]^e,a[n+2]=a[n-14]^r,a[n+3]=a[n-13]^s}for(let n=0;n<11;n++)e.push(a.slice(16*n,16*(n+1)));return e}(t),n=new Uint8Array(e.length);for(let r=0;r<e.length;r+=16){const t=e.slice(r,Math.min(r+16,e.length)),s=new Uint8Array(16);s.set(t);const o=$(s,a);n.set(o.slice(0,t.length),r)}return n}async function V(t,e,a){const n=[t];9===t&&n.push(e);const r=new Uint8Array(n.length+a.length);return r.set(n),r.set(a,n.length),(await E(r)).slice(0,32)}function j(t,e){return t[e]|t[e+1]<<8}function G(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function I(t,e,a){e[a]=255&t,e[a+1]=t>>8&255}class F{constructor(){e(this,"header",0),e(this,"transportCodes",[0,0]),e(this,"pathLen",0),e(this,"path",new Uint8Array(0)),e(this,"payload",new Uint8Array(0)),e(this,"decrypted",{}),e(this,"_rssi",0),e(this,"_snr",0)}static fromBytes(t){const e=new F;try{return e.readFrom(t),{success:!0,packet:e}}catch(a){return{success:!1,error:a instanceof Error?a.message:String(a)}}}static fromHex(t){try{const e=H(t);return F.fromBytes(e)}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}get routeType(){return 3&this.header}get routeTypeName(){return i[this.routeType]??`UNKNOWN(${this.routeType})`}get payloadType(){return this.header>>2&15}get payloadTypeName(){return C[this.payloadType]??`UNKNOWN(${this.payloadType})`}get payloadVersion(){return this.header>>6&3}hasTransportCodes(){return 0===(t=this.routeType)||3===t;var t}isFlood(){return 1===(t=this.routeType)||0===t;var t}isDirect(){return 2===(t=this.routeType)||3===t;var t}get pathBytes(){return Array.from(this.path)}get pathString(){return((t=this.path)instanceof Uint8Array?Array.from(t):t).map(t=>S(t,!0)).join("->");var t}get pathHexArray(){return Array.from(this.path).map(t=>S(t,!0))}get payloadLen(){return this.payload.length}get payloadHex(){return N(this.payload,!0)}getPayloadAppData(){return this.payload.length>=100?this.payload.slice(100):new Uint8Array(0)}get rssi(){return this._rssi}set rssi(t){this._rssi=t}get snr(){return this._snr}set snr(t){this._snr=t}readFrom(t){let e=0;const a=t.length;U(e,1,a,"Missing header byte"),this.header=t[e++];const n=this.payloadVersion;if(n>1)throw new Error(`Unsupported packet version: ${n}`);if(this.hasTransportCodes()?(U(e,4,a,"Missing transport codes"),this.transportCodes=[j(t,e),j(t,e+2)],e+=4):this.transportCodes=[0,0],U(e,1,a,"Missing path_len"),this.pathLen=t[e++],this.pathLen>64)throw new Error(`path_len too large: ${this.pathLen} > 64`);return U(e,this.pathLen,a,"Truncated path"),this.path=t.slice(e,e+this.pathLen),e+=this.pathLen,this.payload=t.slice(e),function(t){if(t>256)throw new Error(`payload too large: ${t} > 256`)}(this.payload.length),!0}writeTo(){let t=1;this.hasTransportCodes()&&(t+=4),t+=1,t+=this.path.length,t+=this.payload.length;const e=new Uint8Array(t);let a=0;return e[a++]=this.header,this.hasTransportCodes()&&(I(this.transportCodes[0],e,a),I(this.transportCodes[1],e,a+2),a+=4),e[a++]=this.path.length,e.set(this.path,a),a+=this.path.length,e.set(this.payload,a),e}toHex(){return N(this.writeTo(),!0)}async calculateHash(){return V(this.payloadType,this.pathLen,this.payload)}async calculateHashString(t){return async function(t,e,a,n){const r=N(await V(t,e,a),!0);return void 0!==n?r.slice(0,n):r}(this.payloadType,this.pathLen,this.payload,t)}async calculateCRC(){return async function(t,e,a){const n=await V(t,e,a);return(n[0]|n[1]<<8|n[2]<<16|n[3]<<24)>>>0}(this.payloadType,this.pathLen,this.payload)}getRawLength(){let t=2+this.pathLen+this.payload.length;return this.hasTransportCodes()&&(t+=4),t}getSummary(){return{header:S(this.header,!0),routeType:this.routeTypeName,payloadType:this.payloadTypeName,version:this.payloadVersion,pathLen:this.pathLen,pathStr:this.pathString,transportCodes:this.hasTransportCodes()?[this.transportCodes[0].toString(16).toUpperCase().padStart(4,"0"),this.transportCodes[1].toString(16).toUpperCase().padStart(4,"0")]:null,payloadLen:this.payload.length,payloadHex:this.payloadHex,rawLength:this.getRawLength()}}toString(){const t=[`[${this.routeTypeName}/${this.payloadTypeName} v${this.payloadVersion}]`,`path=${this.pathString||"(empty)"}`,`payload=${this.payload.length}B`];return this.hasTransportCodes()&&t.push(`transport=[${this.transportCodes[0]},${this.transportCodes[1]}]`),t.join(" ")}}function B(t){if(t.length<101)return null;let e=0;const a=N(t.slice(e,e+32));e+=32;const n=G(t,e);e+=4;const r=N(t.slice(e,e+64));e+=64;const s=t[e++],o=function(t){const e=[];switch(15&t){case 1:e.push("is companion");break;case 2:e.push("is repeater");break;case 3:e.push("is room server");break;case 4:e.push("is sensor")}return 16&t&&e.push("has location"),32&t&&e.push("has feature 1"),64&t&&e.push("has feature 2"),128&t&&e.push("has name"),e.join(", ")||"none"}(s);let i="unknown";switch(15&s){case 1:i="chat";break;case 2:i="repeater";break;case 3:i="room_server";break;case 4:i="sensor"}const c={type:"advert",publicKey:a,timestamp:n,signature:r,flags:s,flagsDescription:o,nodeType:i,rawAppData:N(t.slice(100))};if(16&s&&e+8<=t.length){const a=t.slice(e,e+8),n=new ArrayBuffer(8);new Uint8Array(n).set(a);const r=new DataView(n),s=r.getInt32(0,!0),o=r.getInt32(4,!0);c.latitude=s/1e6,c.longitude=o/1e6,e+=8}if(128&s&&e<t.length){let a=e;for(;a<t.length&&0!==t[a];)a++;a>e&&(c.name=(new TextDecoder).decode(t.slice(e,a)))}return c}function W(t,e){const a=function(t){if(t.length<9)return{type:"trace",traceTag:"00000000",traceTagValue:0,authCode:0,flags:0,pathHashes:[],pathString:"",snrValues:[],isComplete:!1,path:[],targetHash:""};const e=G(t,0),a=e.toString(16).toUpperCase().padStart(8,"0"),n=G(t,4),r=t[8],s=t.slice(9),o=Array.from(s).map(t=>S(t,!0)),i=o.join("->");return{type:"trace",traceTag:a,traceTagValue:e,authCode:n,flags:r,pathHashes:o,pathString:i,snrValues:[],isComplete:!1,path:o,targetHash:o.length>0?o[0]:""}}(t);if(!a)return null;const n=[],r=e instanceof Uint8Array?Array.from(e):e;for(let o=0;o<r.length;o++){let t=r[o];t>127&&(t-=256),n.push(t/4)}const s=n.length>=a.pathHashes.length;return{...a,snrValues:n,isComplete:s}}async function Q(t){if(t.length<4)return null;const e=t[0],n=S(e,!0),r=t.slice(1,3),s=t.slice(3),o={type:"grp_txt",channelHash:n,text:N(s),decrypted:!1,ciphertextHex:N(s),macHex:N(r)};try{const{tryDecryptGroupMessage:t}=await a(async()=>{const{tryDecryptGroupMessage:t}=await Promise.resolve().then(()=>ot);return{tryDecryptGroupMessage:t}},void 0),n=await t(e,r,s);if(n&&n.plaintext.length>=5){o.channelName=n.channelName;const t=n.plaintext,e=G(t,0),a=t[4],r=new TextDecoder("utf-8",{fatal:!1}).decode(t.slice(5));o.decrypted=!0,o.timestamp=e,o.flags=a;const s=r.indexOf(": ");s>0?(o.senderName=r.slice(0,s),o.text=r.slice(s+2)):o.text=r}}catch(i){}return o}async function z(t){if(t.length<4)return null;const e=t[0],n=S(e,!0),r=t.slice(1,3),s=t.slice(3),o={type:"grp_data",channelHash:n,dataHex:N(s),dataLength:s.length,decrypted:!1,macHex:N(r)};try{const{tryDecryptGroupMessage:t}=await a(async()=>{const{tryDecryptGroupMessage:t}=await Promise.resolve().then(()=>ot);return{tryDecryptGroupMessage:t}},void 0),n=await t(e,r,s);n&&(o.channelName=n.channelName,o.decrypted=!0,o.decryptedHex=N(n.plaintext))}catch(i){}return o}function X(t,e,a){return{type:"generic",payloadType:e,payloadTypeName:a,rawHex:N(t),length:t.length}}function q(t){const{payload:e,payloadType:a,payloadTypeName:n}=t;switch(a){case 4:return B(e)??X(e,a,n);case 3:return function(t){if(t.length<4)return null;const e=G(t,0);return{type:"ack",crc:e.toString(16).toUpperCase().padStart(8,"0"),crcValue:e}}(e)??X(e,a,n);case 8:return function(t){if(0===t.length)return{type:"path",path:[],pathString:""};const e=Array.from(t).map(t=>S(t,!0)),a=e.join("->");return{type:"path",path:e,pathString:a}}(e)??X(e,a,n);case 9:return W(e,t.path)??X(e,a,n);case 2:return function(t){if(t.length<2)return null;const e=S(t[0],!0),a=S(t[1],!0),n=t.slice(2);let r="",s=!0;try{const t=new TextDecoder("utf-8",{fatal:!0}).decode(n);/^[\x20-\x7E\u00A0-\uFFFF\n\r\t]*$/.test(t)&&(r=t,s=!1)}catch{}return s&&(r=N(n)),{type:"txt_msg",destHash:e,srcHash:a,timestamp:0,text:r,encrypted:s}}(e)??X(e,a,n);case 5:return function(t){if(t.length<4)return null;const e=S(t[0],!0),a=t.slice(1,3),n=t.slice(3);return{type:"grp_txt",channelHash:e,text:N(n),decrypted:!1,ciphertextHex:N(n),macHex:N(a)}}(e)??X(e,a,n);case 6:return function(t){if(t.length<4)return null;const e=S(t[0],!0),a=t.slice(1,3),n=t.slice(3);return{type:"grp_data",channelHash:e,dataHex:N(n),dataLength:n.length,decrypted:!1,macHex:N(a)}}(e)??X(e,a,n);case 10:return function(t){return t.length<4?null:{type:"multipart",messageId:N(t.slice(0,2)),partNumber:t[2],totalParts:t[3],partData:N(t.slice(4))}}(e)??X(e,a,n);default:return X(e,a,n)}}const J={name:"Public",secret:"8b3387e9c5cdea6ac9e5edbaa115cd72"},Y=["southbay","bot","ventura","weather","wardrive","test","general","public","main","default","chat","local","mesh","emergency","sos","help","news","info","status","alerts","meshcore","meshtastic","lora","radio","ham","amateur","socal","norcal","bayarea","losangeles","sandiego","sanfrancisco","sanjose","santabarbara","santacruz","monterey","fresno","sacramento","seattle","portland","denver","austin","boston","chicago","miami","atlanta","phoenix","dallas","houston","philly","detroit","minneapolis","tampa","orlando","lasvegas","saltlake","london","toronto","canada","sydney","australia","berlin","germany","paris","france","tokyo","japan","gps","location","tracking","sensor","sensors","telemetry","aprs","beacon","ping","debug","admin",...function(){const t="abcdefghijklmnopqrstuvwxyz0123456789",e=[];for(const a of t)e.push(a);for(const a of t)for(const n of t)e.push(a+n);return e}()];async function Z(t,e=!1){const a=H(t.secret),n=(await E(a))[0],r=new Uint8Array(32);return r.set(a.slice(0,32)),{name:t.name,channelHash:n,aesKey:r.slice(0,16),hmacKey:r,autoDiscovered:e}}async function tt(t){const e=`#${t}`,a=(new TextEncoder).encode(e);return Z({name:`#${t}`,secret:N((await E(a)).slice(0,16),!1)},!0)}let et=null,at=null;const nt=new Map;let rt=null;async function st(t,e,a){const n=await async function(t,e){const a=new ArrayBuffer(t.length);new Uint8Array(a).set(t);const n=new ArrayBuffer(e.length);new Uint8Array(n).set(e);const r=await crypto.subtle.importKey("raw",a,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),s=await crypto.subtle.sign("HMAC",r,n);return new Uint8Array(s)}(t,a);return e[0]===n[0]&&e[1]===n[1]}const ot=Object.freeze(Object.defineProperty({__proto__:null,tryDecryptGroupMessage:async function(t,e,a){await async function(){et||(at||(at=(async()=>{const t=new Map;for(const e of Y)try{const a=await tt(e),n=t.get(a.channelHash)||[];n.push(a),t.set(a.channelHash,n)}catch{}et=t})()),await at)}();const n=await async function(){return rt||(rt=await Z(J)),rt}();if(n.channelHash===t&&await st(n.hmacKey,e,a))return{channelName:"Public",plaintext:K(n.aesKey,a),keys:n};const r=nt.get(t);if(r&&await st(r.hmacKey,e,a)){const t=K(r.aesKey,a);return{channelName:r.name,plaintext:t,keys:r}}const s=(null==et?void 0:et.get(t))||[];for(const o of s)if(await st(o.hmacKey,e,a)){nt.set(t,o);const e=K(o.aesKey,a);return{channelName:o.name,plaintext:e,keys:o}}return null}},Symbol.toStringTag,{value:"Module"}));export{F as P,b as a,W as b,x as c,q as d,Q as e,z as f,_ as g,H as h,C as i,B as j,N as k};
