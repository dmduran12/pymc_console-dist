var e,t,s=Object.defineProperty,a=(e,t,a)=>((e,t,a)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a)(e,"symbol"!=typeof t?t+"":t,a);import{r as n,j as r,aB as l,o as i,aC as o,H as c,aD as m,aE as d,aF as u,aG as h,aH as x,aI as p,aJ as g,aK as f,aL as b,aM as y,aN as v,aO as j,aP as N,aQ as w,a8 as k,aR as M,aS as S,aT as C,aU as T,ac as F,aV as $,h as P,C as R,at as A,p as L}from"./vendor-react-DuLqNXZc.js";import{X as D,Y as E,Z as B,_ as H,t as z,F as _,$ as O,a0 as W,a1 as I,H as V,a2 as q,c as G,f as X,e as K,u as Y,n as U,p as Q,h as Z,o as J,a3 as ee,j as te,a4 as se}from"./index-j51hQqqW.js";import{u as ae}from"./usePolling-B2aIg0-t.js";import{b as ne,c as re,a as le,d as ie,e as oe,f as ce,s as me}from"./useThemeColors-DWNs0_IU.js";import{a as de,b as ue,h as he,g as xe}from"./useScientificColormap-BcO1oAqf.js";import{R as pe,d as ge,L as fe,C as be,X as ye,Y as ve,T as je,a as Ne}from"./recharts-BcVXFyqP.js";import{T as we}from"./TimeRangeSelector-DObdmdMU.js";import{a as ke,P as Me,b as Se}from"./PageLayout-DcevNKfF.js";import{D as Ce}from"./DataBox-Bp3zpxWt.js";import{C as Te}from"./CollisionExplorerModal-BuPo5IYu.js";import{C as Fe,a as $e}from"./Card-DD3rQAGW.js";import{R as Pe,C as Re}from"./Grid-BJmuHylY.js";import"./vendor-core-WoOfkQwm.js";import"./deckgl-DTsmDcfs.js";import"./leaflet-D_ckmI2R.js";const Ae={useAbsoluteThresholds:!0,baselinePercentile:6,spikePercentile:50,baselineDbm:-107,spikeDbm:-100,mergeGapSeconds:45,minSequenceLength:16,similarityToleranceDbm:5};function Le(e,t){if(0===e.length)return 0;const s=t/100*(e.length-1),a=Math.floor(s),n=Math.ceil(s);return a===n?e[a]:e[a]+(e[n]-e[a])*(s-a)}function De(e){if(0===e.length)return{median:0,p90:0,p95:0,p99:0,max:0,min:0};const t=[...e].sort((e,t)=>e-t);return{median:Le(t,50),p90:Le(t,90),p95:Le(t,95),p99:Le(t,99),max:t[t.length-1],min:t[0]}}function Ee(e,t,s){const a=s-t;if(0===a)return"moderate";const n=(e-t)/a;return n>.66?"critical":n>.33?"severe":"moderate"}n.memo(function({options:e,data:t,className:s="",onCreate:a}){const l=n.useRef(null),i=n.useRef(null);return n.useEffect(()=>{const s=l.current;if(!s)return;const n=s.getBoundingClientRect(),r=Math.floor(n.width)||400,o=Math.floor(n.height)||200,c=new D({...e,width:r,height:o},t,s);return i.current=c,null==a||a(c),()=>{c.destroy(),i.current=null}},[e]),n.useEffect(()=>{i.current&&t&&i.current.setData(t)},[t]),n.useEffect(()=>{const e=l.current;if(!e)return;const t=new ResizeObserver(e=>{const t=e[0];if(!t||!i.current)return;const{width:s,height:a}=t.contentRect;s>0&&a>0&&i.current.setSize({width:Math.floor(s),height:Math.floor(a)})});return t.observe(e),()=>{t.disconnect()}},[]),r.jsx("div",{ref:l,className:`w-full h-full ${s}`,style:{minHeight:100}})});const Be=new Map;function He(e){var t;if(!e.startsWith("var("))return e;const s=Be.get(e);if(s)return s;const a=e.match(/var\(([^,)]+)(?:,\s*([^)]+))?\)/);if(!a)return e;const n=a[1].trim(),r=(null==(t=a[2])?void 0:t.trim())||"#888888",l=getComputedStyle(document.documentElement).getPropertyValue(n).trim()||r;return Be.set(e,l),l}function ze(e,t,s=!1){if(t.length<2)return;if(e.beginPath(),e.moveTo(t[0].x,t[0].y),2===t.length)return void e.lineTo(t[1].x,t[1].y);const a=.5;for(let n=0;n<t.length-1;n++){const s=t[Math.max(0,n-1)],r=t[n],l=t[n+1],i=t[Math.min(t.length-1,n+2)],o=r.x+(l.x-s.x)/6*a,c=r.y+(l.y-s.y)/6*a,m=l.x-(i.x-r.x)/6*a,d=l.y-(i.y-r.y)/6*a;e.bezierCurveTo(o,c,m,d,l.x,l.y)}s&&e.closePath()}n.memo(function({data:e,maxValue:t,onHover:s,highlightedItem:a=null,bandColor:l="#E12672",innerBandColor:i="#FF2D7A",meanColor:o="#FF6B9D",medianColor:c="#FF85AD",averageColor:m="#FFE135",cursorColor:d="rgba(255,255,255,0.5)"}){const u=n.useRef(null),h=n.useRef(null),x=n.useRef(e),p=n.useRef(t),g=n.useRef(a),f=n.useRef(s),b=n.useRef(e.length);n.useLayoutEffect(()=>{x.current=e,p.current=t,g.current=a,f.current=s});const y=n.useRef({band:l,innerBand:i,mean:o,median:c,average:m,cursor:d});n.useLayoutEffect(()=>{y.current={band:l,innerBand:i,mean:o,median:c,average:m,cursor:d}});const v=n.useMemo(()=>[e.map(e=>e.timestamp),e.map(e=>e.max)],[e]),j=n.useMemo(()=>{const e=function(e,t,s,a){return{hooks:{draw:n=>{const r=e.current,l=t.current,i=s.current,o=a.current;if(0===r.length)return;const c=n.ctx,m=n.bbox,d=m.left,u=m.top,h=m.width,x=m.height;if(h<=0||x<=0)return;const p=n.data[0],g=p.length;if(0===g)return;const f=p[0],b=p[g-1]-f||1,y=e=>d+(e-f)/b*h,v=e=>u+x*(1-e/l),j={min:r.map(e=>({x:y(e.timestamp),y:v(e.min)})),max:r.map(e=>({x:y(e.timestamp),y:v(e.max)})),p5:r.map(e=>({x:y(e.timestamp),y:v(e.p5)})),p95:r.map(e=>({x:y(e.timestamp),y:v(e.p95)})),p25:r.map(e=>({x:y(e.timestamp),y:v(e.p25)})),p75:r.map(e=>({x:y(e.timestamp),y:v(e.p75)})),mean:r.map(e=>({x:y(e.timestamp),y:v(e.mean)})),median:r.map(e=>({x:y(e.timestamp),y:v(e.median)})),average:r.map(e=>({x:y(e.timestamp),y:v(e.average)}))},N=(e,t)=>i?i===e?Math.min(1,1.5*t):"minMax"===i||"p5p95"===i||"p25p75"===i?.3*t:t:t,w=e=>i?i===e?1:"mean"===i||"median"===i||"average"===i?.3:1:1,k={band:He(o.band),innerBand:He(o.innerBand),mean:He(o.mean),median:He(o.median),average:He(o.average)};c.save(),c.strokeStyle=k.average,c.lineWidth=4,c.globalAlpha=w("average"),ze(c,j.average),c.stroke(),c.globalAlpha=N("minMax",.15),c.fillStyle=k.band,c.beginPath(),ze(c,j.max);const M=[...j.min].reverse();for(const e of M)c.lineTo(e.x,e.y);c.closePath(),c.fill(),c.globalAlpha=N("p5p95",.3),c.fillStyle=k.band,c.beginPath(),ze(c,j.p95);const S=[...j.p5].reverse();for(const e of S)c.lineTo(e.x,e.y);c.closePath(),c.fill(),c.globalAlpha=N("p25p75",.55),c.fillStyle=k.innerBand,c.beginPath(),ze(c,j.p75);const C=[...j.p25].reverse();for(const e of C)c.lineTo(e.x,e.y);c.closePath(),c.fill(),c.strokeStyle=k.median,c.lineWidth=1.5,c.globalAlpha=w("median"),c.setLineDash([4,4]),ze(c,j.median),c.stroke(),c.strokeStyle=k.mean,c.lineWidth=1.5,c.globalAlpha=w("mean"),c.setLineDash([]),ze(c,j.mean),c.stroke(),c.restore()}}}}(x,p,g,y);return{width:400,height:200,padding:[4,4,4,4],cursor:{show:!0,x:!0,y:!1,drag:{x:!1,y:!1},points:{show:!1}},scales:{x:{time:!0},y:{range:[0,t]}},axes:[{show:!1},{show:!1}],series:[{},{show:!1}],hooks:{setCursor:[e=>{var t,s;const a=e.cursor.idx;null!=a&&a>=0?null==(t=f.current)||t.call(f,a):null==(s=f.current)||s.call(f,null)}]},plugins:[e]}},[t]);n.useEffect(()=>{const t=u.current;if(!t||0===e.length)return;const s=b.current,a=e.length,n=Math.abs(a-s);if(!(!h.current||n>100||s>0&&n/s>.1)&&h.current)return h.current.setData(v),void(b.current=a);h.current&&h.current.destroy();const r=t.getBoundingClientRect(),l=Math.floor(r.width)||400,i=Math.floor(r.height)||200,o=new D({...j,width:l,height:i},v,t);return h.current=o,b.current=a,()=>{o.destroy(),h.current=null}},[j,v,e.length]),n.useEffect(()=>{const e=u.current;if(!e)return;const t=new ResizeObserver(e=>{const t=e[0];if(!t||!h.current)return;const{width:s,height:a}=t.contentRect;s>0&&a>0&&h.current.setSize({width:Math.floor(s),height:Math.floor(a)})});return t.observe(e),()=>{t.disconnect()}},[]),n.useEffect(()=>{h.current&&h.current.redraw()},[a,e]);const N=n.useCallback(()=>{null==s||s(null)},[s]);return 0===e.length?r.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No data available"}):r.jsx("div",{ref:u,className:"w-full h-full rounded-2xl overflow-hidden",onMouseLeave:N})});const _e="undefined"!=typeof window&&(null==(t=null==(e=window.matchMedia)?void 0:e.call(window,"(color-gamut: p3)"))?void 0:t.matches);function Oe(){const e=getComputedStyle(document.documentElement);return{fontFamily:e.getPropertyValue("--font-data").trim()||'"JetBrains Mono", ui-monospace, monospace',axisColor:e.getPropertyValue("--chart-axis-tick").trim()||"rgba(255, 255, 255, 0.4)",gridColor:e.getPropertyValue("--chart-grid").trim()||"rgba(255, 255, 255, 0.06)",textMuted:e.getPropertyValue("--text-muted").trim()||"#727272",textPrimary:e.getPropertyValue("--text-primary").trim()||"#FFFFFF"}}const We=["min","max","p75","p95","p99","mean","median","average","midpoint"];function Ie(e){const t=ue(e),s=he(t),a=`color(display-p3 ${(s.r/255).toFixed(3)} ${(s.g/255).toFixed(3)} ${(s.b/255).toFixed(3)})`;return{...s,p3:a}}function Ve(e,t,s,a,n,r,l,i,o,c=null,m=null,d=1,u=null,h="airtime",x=.5){if(0===t.length)return;const p=e.ctx,{left:g,top:f,width:b,height:y}=e.bbox,v=window.devicePixelRatio||1;if(b<=0||y<=0)return;const j=e.data[0],N=j.length;if(0===N)return;const w=j[0],k=j[N-1],M=s,S="share"===h,C=S?function(e){const t=[10,20,25,50,100,200,250,500,1e3],s=e/4.5;for(const a of t)if(a>=s)return a;return e>5e3?1e3*Math.ceil(s/1e3):100*Math.ceil(s/100)}(M):5,T=getComputedStyle(document.documentElement),F=T.getPropertyValue("--signal-critical").trim()||"#EF4444",$=T.getPropertyValue("--bg-body").trim()||"#171717";p.save(),p.fillStyle="#000000";const P=8*v;p.beginPath(),p.roundRect(g,f,b,y,P),p.fill(),p.restore();const R=parseInt($.slice(1,3),16)||23,A=parseInt($.slice(3,5),16)||23,L=parseInt($.slice(5,7),16)||23;if(!S&&M>=20){p.save();const e=f+y*(1-20/M);p.fillStyle=`rgba(${R}, ${A}, ${L}, 0.5)`,p.fillRect(g,f,b,e-f),p.restore()}p.save(),p.lineWidth=1*v,p.setLineDash([4*v,4*v]);for(let E=C;E<M;E+=C){const e=E/M,t=Math.round(f+y*(1-e))+.5;S||20!==E?(p.strokeStyle=r.textPrimary,p.globalAlpha=.25):(p.strokeStyle=F,p.globalAlpha=1),p.beginPath(),p.moveTo(Math.round(g),t),p.lineTo(Math.round(g+b),t),p.stroke()}p.restore(),p.save(),p.font=`bold ${10*v}px ${r.fontFamily}`,p.fillStyle=r.textPrimary,p.textBaseline="middle",p.textAlign="left";const D=8*v;for(let E=0;E<=M;E+=C){const e=f+y*(1-E/M),t=Math.max(f+D,Math.min(f+y-D,e)),s=S?`${E}B`:`${E}%`;p.fillText(s,0,t)}if(p.restore(),function(e,t,s,a,n,r,l){if(null===t)return;if(t<s||t>s+n)return;const i=getComputedStyle(document.documentElement).getPropertyValue("--text-primary").trim()||"#FFFFFF";e.save(),e.strokeStyle=i,e.globalAlpha=.5,e.lineWidth=1*l,e.setLineDash([4*l,4*l]),e.beginPath(),e.moveTo(Math.round(t)+.5,a),e.lineTo(Math.round(t)+.5,a+r),e.stroke(),e.restore()}(p,u,g,f,b,y,v),l){!function(e,t,s,a,n,r,l=null,i=null,o=1,c=25){const{points:m,rawValues:d,count:u,packetTypes:h,timestamps:x}=t,p=1*o*(window.devicePixelRatio||1);e.globalCompositeOperation="source-over";const g=l?parseInt(l.replace("TYPE_",""),10):null;for(let f=0;f<u;f++){const t=m[2*f],l=d[f],o=s+t*n,u=a+(1-Math.min(1,Math.max(0,l/c)))*r,b=h[f],y=de(b);let v=!0;if(i&&x){const e=x[f];v=e>=i.start&&e<i.end}const j=!v||null!==g&&b!==g?.03:.5;e.fillStyle=`rgba(${y.r}, ${y.g}, ${y.b}, ${j})`,e.beginPath(),e.arc(o,u,p,0,2*Math.PI),e.fill()}e.globalCompositeOperation="source-over"}(p,l,g,f,b,y,c,m,d,M),p.save(),p.font=`bold ${9*v}px ${r.fontFamily}`,p.textBaseline="middle",p.textAlign="left";const e=l.maxValue,t=[{pct:0,label:`${e.toFixed(0)}%`},{pct:.25,label:`${(.75*e).toFixed(0)}%`},{pct:.5,label:`${(.5*e).toFixed(0)}%`},{pct:.75,label:`${(.25*e).toFixed(0)}%`},{pct:1,label:"0%"}];for(const{pct:s,label:a}of t){const e=f+y*s,t=Ie(1-s);p.fillStyle=`rgb(${t.r}, ${t.g}, ${t.b})`,p.fillText(a,g+b+8*v,e)}p.restore()}o&&i&&i.length>0&&function(e,t,s,a,n,r,l,i,o,c,m=.5){if(0===t.length)return;const d=o-i||1,u=function(e,t=1.3,s=.15){const a=function(e){const t=e.match(/color\(display-p3\s+([\d.]+)\s+([\d.]+)\s+([\d.]+)/);if(t){const e=parseFloat(t[1]),s=parseFloat(t[2]),a=parseFloat(t[3]);return{r:Math.round(255*e),g:Math.round(255*s),b:Math.round(255*a),p3r:e,p3g:s,p3b:a}}if(e.startsWith("#")){const t=e.replace("#",""),s=parseInt(t.slice(0,2),16),a=parseInt(t.slice(2,4),16),n=parseInt(t.slice(4,6),16);return{r:s,g:a,b:n,p3r:s/255,p3g:a/255,p3b:n/255}}const s=e.match(/rgba?\(([\d.]+),?\s*([\d.]+),?\s*([\d.]+)/);if(s){const e=Math.round(parseFloat(s[1])),t=Math.round(parseFloat(s[2])),a=Math.round(parseFloat(s[3]));return{r:e,g:t,b:a,p3r:e/255,p3g:t/255,p3b:a/255}}return{r:255,g:255,b:255,p3r:1,p3g:1,p3b:1}}(e),n=function(e,t,s,a=1.25,n=.15){const r=(Math.max(e,t,s)+Math.min(e,t,s))/2;return{p3r:Math.min(1,r+(e-r)*a+n),p3g:Math.min(1,r+(t-r)*a+n),p3b:Math.min(1,r+(s-r)*a+n)}}(a.p3r,a.p3g,a.p3b,t,s);return{r:Math.round(255*Math.min(1,n.p3r)),g:Math.round(255*Math.min(1,n.p3g)),b:Math.round(255*Math.min(1,n.p3b)),p3r:Math.min(1,n.p3r),p3g:Math.min(1,n.p3g),p3b:Math.min(1,n.p3b)}}(getComputedStyle(document.documentElement).getPropertyValue("--signal-critical").trim()||"#EF4444");e.save(),e.globalAlpha=m,e.fillStyle=_e?`color(display-p3 ${u.p3r} ${u.p3g} ${u.p3b})`:`rgb(${u.r}, ${u.g}, ${u.b})`;for(const h of t){if(h.endTs<i||h.startTs>o)continue;const t=a+(Math.max(h.startTs,i)-i)/d*r,s=a+(Math.min(h.endTs,o)-i)/d*r,m=Math.max(s-t,2*c);e.fillRect(t,n,m,l)}e.restore()}(p,i,0,g,f,b,y,w,k,v,m?Math.max(.03,.03*x):x)}const qe=n.memo(function({data:e,maxValue:t,visibleLines:s=We,highlightedLine:a=null,onHover:l,scatterData:i=null,noiseFloorAnomalies:o=null,showNoiseFloorOverlay:c=!1,overlayOpacity:m=.5,highlightedType:d=null,hoveredTimeRange:u=null,timeRangeHours:h=24,yAxisMode:x="airtime"}){const p=n.useRef(null),g=n.useRef(null),f=n.useRef(e),b=n.useRef(t),y=n.useRef(s),v=n.useRef(a),j=n.useRef(l),N=n.useRef(i),w=n.useRef(o),k=n.useRef(c),M=n.useRef(d),S=n.useRef(u),C=n.useRef(null),T=n.useRef(null),F=n.useRef(x),$=n.useRef(m),P=h<=12?1.2:1,R=n.useRef(P),A=n.useRef(e.length);n.useLayoutEffect(()=>{f.current=e,b.current=t,y.current=s,v.current=a,j.current=l,N.current=i,w.current=o,k.current=c,M.current=d,S.current=u,R.current=P,F.current=x,$.current=m}),n.useEffect(()=>{C.current=Oe()},[]);const L=n.useMemo(()=>[e.map(e=>e.timestamp),new Array(e.length).fill(1)],[e]),E=n.useMemo(()=>({hooks:{draw:e=>{const t=C.current||Oe();Ve(e,f.current,b.current,y.current,v.current,t,N.current,w.current,k.current,M.current,S.current,R.current,T.current,F.current,$.current)}}}),[]),B=n.useMemo(()=>({width:400,height:200,padding:[8,0,8,28],cursor:{show:!1,x:!1,y:!1,drag:{x:!1,y:!1},points:{show:!1}},scales:{x:{time:!0},y:{range:[0,1]}},axes:[{show:!1},{show:!1}],series:[{},{show:!1}],plugins:[E]}),[E]);n.useEffect(()=>{const t=p.current;if(!t||0===e.length)return;const s=A.current,a=e.length,n=Math.abs(a-s);if(!(!g.current||n>100||s>0&&n/s>.1)&&g.current)return g.current.setData(L),void(A.current=a);g.current&&g.current.destroy();const r=t.getBoundingClientRect(),l=Math.floor(r.width)||400,i=Math.floor(r.height)||200,o=new D({...B,width:l,height:i},L,t);return g.current=o,A.current=a,()=>{o.destroy(),g.current=null}},[B,L,e.length]),n.useEffect(()=>{const e=p.current;if(!e)return;const t=new ResizeObserver(e=>{const t=e[0];if(!t||!g.current)return;const{width:s,height:a}=t.contentRect;s>0&&a>0&&g.current.setSize({width:Math.floor(s),height:Math.floor(a)})});return t.observe(e),()=>{t.disconnect()}},[]),n.useEffect(()=>{g.current&&g.current.redraw()},[a,s,e,i,o,c,m,d,u,P]);const H=n.useCallback(t=>{var s,a;const n=p.current,r=g.current;if(!n||!r||0===e.length)return;const l=n.getBoundingClientRect(),i=t.clientX-l.left,o=window.devicePixelRatio||1,c=r.bbox,m=c.left/o,d=c.width/o;if(i<m||i>m+d)return T.current=null,r.redraw(),void(null==(s=j.current)||s.call(j,null));T.current=i*o;const u=(i-m)/d,h=e.length,x=Math.floor(u*h),f=Math.max(0,Math.min(h-1,x));r.redraw(),null==(a=j.current)||a.call(j,f)},[e.length]),z=n.useCallback(()=>{var e;T.current=null,g.current&&g.current.redraw(),null==(e=j.current)||e.call(j,null)},[]);return 0===e.length?r.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No data available"}):r.jsx("div",{ref:p,className:"w-full h-full rounded-lg overflow-hidden",onMouseMove:H,onMouseLeave:z})}),Ge=xe;function Xe({sortedTypes:e,highlightedType:t,onTypeHover:s,aggregateShares:a,hoverData:l}){const i=n.useMemo(()=>{if(!l)return null;const e=new Map;for(const t of l.items)e.set(t.key,t.value);return e},[l]),o=null!==i;return r.jsx("div",{className:"flex-shrink-0 pt-3 mt-2",children:r.jsx("div",{className:"grid ml-9 gap-y-0.5",style:{gridTemplateColumns:"repeat(auto-fill, minmax(105px, 1fr))"},onMouseLeave:()=>s(null),children:e.map(e=>{const n=Ge(e.typeNum),l=(null==i?void 0:i.get(e.key))??0,c=a.get(e.key)??0,m=o?l:c,d=m>1e-4,u=t===e.key,h=["legend-item",u&&"legend-item-active",(t&&!u||o&&l<=1e-4)&&"legend-item-dimmed",!t&&o&&l>1e-4&&"legend-item-chart-active"].filter(Boolean).join(" ");return r.jsxs("div",{className:h,onMouseEnter:()=>s(e.key),children:[r.jsx("div",{className:"flex-shrink-0",style:{backgroundColor:n,width:9,height:16,borderRadius:1}}),r.jsx("span",{className:"legend-label",children:e.label}),d&&r.jsxs("span",{className:"legend-value "+(o?"legend-value-live":""),children:[(100*m).toFixed(1),"%"]})]},e.key)})})})}const Ke='ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace';function Ye({x:e,y:t,width:s,height:a,name:n,size:l,index:i,depth:o,hoveredIndex:c,onHover:m,total:d,typeNum:u}){if(1!==o)return null;const h=null!==c&&!(c===i),x=Ge(u),p=d>0?l/d*100:0,g=s>36&&a>20,f=s>36&&a>32;return r.jsxs("g",{onMouseEnter:e=>m(i,e),onMouseLeave:()=>m(null),style:{cursor:"default"},children:[r.jsx("rect",{x:e,y:t,width:s,height:a,fill:x,opacity:h?.4:1,stroke:"rgba(0,0,0,0.2)",strokeWidth:1,rx:3,style:{transition:"opacity 150ms ease"}}),g&&r.jsxs(r.Fragment,{children:[f&&r.jsxs("text",{x:e+4,y:t+a-4-11,textAnchor:"start",dominantBaseline:"auto",fill:"rgba(0,0,0,0.6)",fontSize:8,fontFamily:Ke,fontWeight:500,style:{pointerEvents:"none"},children:[p.toFixed(1),"%"]}),r.jsx("text",{x:e+4,y:t+a-4,textAnchor:"start",dominantBaseline:"auto",fill:"rgba(0,0,0,0.85)",fontSize:9,fontFamily:Ke,fontWeight:600,style:{pointerEvents:"none"},children:n})]})]})}function Ue({data:e,total:t,color:s,position:a,containerWidth:n}){if(!e||!a)return null;const l=(e.value/t*100).toFixed(1),i=n-a.x<184?Math.max(8,a.x-160-8):a.x+16;return r.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:i,top:Math.max(8,a.y-60)},children:r.jsxs("div",{className:"bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 shadow-xl min-w-[140px]",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-sm flex-shrink-0",style:{backgroundColor:s}}),r.jsx("span",{className:"type-data-sm font-semibold text-text-primary",children:e.name})]}),r.jsxs("div",{className:"space-y-0.5 type-data-xs text-text-muted",children:[r.jsxs("div",{className:"flex justify-between gap-4",children:[r.jsx("span",{children:"Count"}),r.jsx("span",{className:"text-text-primary tabular-nums font-medium",children:e.value.toLocaleString()})]}),r.jsxs("div",{className:"flex justify-between gap-4",children:[r.jsx("span",{children:"Share"}),r.jsxs("span",{className:"text-text-primary tabular-nums font-medium",children:[l,"%"]})]}),r.jsxs("div",{className:"flex justify-between gap-4",children:[r.jsx("span",{children:"Total"}),r.jsx("span",{className:"text-text-primary tabular-nums font-medium",children:t.toLocaleString()})]})]})]})})}function Qe({sortedTypes:e,aggregateShares:t}){var s,a,i;const[o,c]=n.useState(null),[m,d]=n.useState(null),[u,h]=n.useState(0),[x,p]=n.useState(null),g=n.useRef(null),f=n.useMemo(()=>e.reduce((e,t)=>e+t.totalCount,0),[e]),b=n.useMemo(()=>e.map((e,t)=>({name:e.label,size:e.totalCount,index:t,typeNum:e.typeNum,key:e.key})),[e]),y=n.useCallback((e,t)=>{if(c(e),t&&null!==e){const e=g.current;if(e){const s=e.getBoundingClientRect();h(s.width),d({x:t.clientX-s.left,y:t.clientY-s.top})}}else d(null)},[]),v=n.useCallback(e=>{if(p(e),e){const t=b.findIndex(t=>t.key===e);c(t>=0?t:null)}else c(null)},[b]),j=null!==o?{name:(null==(s=b[o])?void 0:s.name)??"",value:(null==(a=b[o])?void 0:a.size)??0}:null,N=null!==o?Ge(null==(i=b[o])?void 0:i.typeNum):"";return 0===e.length||0===f?r.jsxs("div",{className:"h-full flex items-center justify-center text-text-muted",children:[r.jsx(l,{className:"w-6 h-6 mr-2 opacity-50"}),r.jsx("span",{children:"No packet type data available"})]}):r.jsxs("div",{className:"flex flex-col",children:[r.jsxs("div",{className:"analyzer-chart-height relative flex-shrink-0",ref:g,children:[r.jsx(pe,{width:"100%",height:"100%",children:r.jsx(ge,{data:b,dataKey:"size",aspectRatio:4/3,stroke:"none",isAnimationActive:!1,content:r.jsx(Ye,{x:0,y:0,width:0,height:0,name:"",size:0,index:0,depth:0,hoveredIndex:o,onHover:y,total:f,typeNum:0})})}),r.jsx(Ue,{data:j,total:f,color:N,position:m,containerWidth:u})]}),r.jsx(Xe,{sortedTypes:e,highlightedType:x,onTypeHover:v,aggregateShares:t})]})}function Ze(e){return e>=1e9?`${(e/1e9).toFixed(1)} Gb`:e>=1e6?`${(e/1e6).toFixed(1)} Mb`:e>=1e3?`${(e/1e3).toFixed(1)} Kb`:`${e.toFixed(0)} B`}function Je({active:e,payload:t,label:s,mode:a}){if(!e||!t||0===t.length)return null;const n=t.filter(e=>null!==e.value&&void 0!==e.value);if(0===n.length)return null;const l=s?new Date(1e3*s).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}):"";return r.jsxs("div",{className:"bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 text-sm shadow-xl",children:[r.jsx("div",{className:"font-medium text-text-primary mb-1 font-mono",children:l}),n.map((e,t)=>r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-3 h-0.5",style:{backgroundColor:e.color}}),r.jsxs("span",{className:"text-text-muted",children:[e.name,":"]}),r.jsx("span",{className:"text-text-primary tabular-nums font-mono",children:"share"===a?`${Number(e.value).toLocaleString()} B`:`${Number(e.value).toFixed(2)}%`})]},t))]})}function et({packets:e,mode:t,startTs:s,endTs:a,radioConfig:o,bucketCount:c}){const m=ne(),d=re(),u=m.primary,h=m.tertiary,[x,p]=n.useState(null),{trendData:g,totals:f}=n.useMemo(()=>{if(0===e.length)return{trendData:[],totals:{rxBytes:0,txBytes:0,rxAirtime:0,txAirtime:0}};const n=a-s,r=Math.min(Math.ceil(n/300),c),l=n/r,i=[];let m=0,d=0,u=0,h=0;for(const t of e){const e=t.timestamp;if(e<s||e>=a)continue;const n=E(t),r=B(t,{spreadingFactor:o.sf,bandwidthHz:o.bw,codingRate:o.cr,preambleLength:o.preamble}),l={timestamp:e,rxAirtime:0,txAirtime:0,rxBytes:0,txBytes:0};t.transmitted?(l.txAirtime=r,l.txBytes=n,d+=n,h+=r):(l.rxAirtime=r,l.rxBytes=n,m+=n,u+=r),i.push(l)}i.sort((e,t)=>e.timestamp-t.timestamp);const x=new Float64Array(i.length+1),p=new Float64Array(i.length+1),g=new Float64Array(i.length+1),f=new Float64Array(i.length+1),b=new Float64Array(i.length);for(let e=0;e<i.length;e++)x[e+1]=x[e]+i[e].rxAirtime,p[e+1]=p[e]+i[e].txAirtime,g[e+1]=g[e]+i[e].rxBytes,f[e+1]=f[e]+i[e].txBytes,b[e]=i[e].timestamp;const y=e=>{let t=0,s=b.length;for(;t<s;){const a=t+s>>>1;b[a]<e?t=a+1:s=a}return t},v=[],j=3e5;for(let e=0;e<r;e++){const a=s+e*l,n=a+l,r=y(a),i=y(n);if("share"===t){const e=g[i]-g[r],t=f[i]-f[r];v.push({timestamp:a,rx:e>0?e:null,tx:t>0?t:null})}else{const e=(x[i]-x[r])/j*100,t=(p[i]-p[r])/j*100;v.push({timestamp:a,rx:e>0?e:null,tx:t>0?t:null})}}const N=2/31;let w=null;return{trendData:v.map(e=>{const t=e.rx;return null!==t&&t>0&&(w=null===w?t:N*t+(1-N)*w),{...e,rxSmooth:null!==w&&w>0?w:null}}),totals:{rxBytes:m,txBytes:d,rxAirtime:u,txAirtime:h}}},[e,s,a,c,t,o]),b=n.useMemo(()=>{if(0===g.length)return"share"===t?100:10;let e=0;for(const t of g){const s=t.rx??0,a=t.tx??0;s>e&&(e=s),a>e&&(e=a)}const s=1.1*e;return"share"===t?s<=100?100:s<=500?100*Math.ceil(s/100):s<=1e3?200*Math.ceil(s/200):s<=5e3?500*Math.ceil(s/500):s<=1e4?1e3*Math.ceil(s/1e3):5e3*Math.ceil(s/5e3):Math.max(1,Math.ceil(s))},[g,t]),y=n.useMemo(()=>{if(null!==x&&g[x]){const e=g[x],s=e.rx??0,a=e.tx??0;return"share"===t?{rx:Ze(s),tx:Ze(a),total:Ze(s+a),isHovered:!0}:{rx:`${s.toFixed(2)}%`,tx:`${a.toFixed(2)}%`,total:`${(s+a).toFixed(2)}%`,isHovered:!0}}if("share"===t)return{rx:Ze(f.rxBytes),tx:Ze(f.txBytes),total:Ze(f.rxBytes+f.txBytes),isHovered:!1};{let e=0,t=0,s=0;for(const r of g)null===r.rx&&null===r.tx||(e+=r.rx??0,t+=r.tx??0,s++);const a=s>0?e/s:0,n=s>0?t/s:0;return{rx:`${a.toFixed(2)}%`,tx:`${n.toFixed(2)}%`,total:`${(a+n).toFixed(2)}%`,isHovered:!1}}},[x,g,f,t]),v=n.useMemo(()=>{const e=a-s,t=e/3600;return[0,.25,.5,.75,1].map(a=>{const n=new Date(1e3*(s+e*a)),r=n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),l=n.toLocaleDateString([],{weekday:"short"});return{pct:a,label:t>24?`${l} ${r}`:r,mobileHidden:.25===a||.75===a}})},[s,a]),j=n.useCallback(e=>{const t=null==e?void 0:e.activeTooltipIndex;p("number"==typeof t?t:null)},[]),N=n.useCallback(e=>"share"===t?e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(0)}K`:e.toFixed(0):`${e.toFixed(0)}%`,[t]);return 0===g.length?r.jsxs("div",{className:"h-full flex items-center justify-center text-text-muted",children:[r.jsx(l,{className:"w-6 h-6 mr-2 opacity-50"}),r.jsx("span",{children:"No packet data available"})]}):r.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[r.jsx("div",{className:"flex items-center flex-shrink-0 text-text-secondary",style:{height:20,paddingLeft:44,paddingRight:8},children:r.jsx("div",{className:"relative w-full h-full flex items-center",children:v.map((e,t)=>r.jsxs("div",{className:"absolute flex items-center gap-0.5 sm:gap-1 type-data-xs "+(e.mobileHidden?"hidden sm:flex":""),style:{left:100*e.pct+"%",transform:0===e.pct?"translateX(0)":1===e.pct?"translateX(-100%)":"translateX(-50%)"},children:[r.jsx(i,{className:"w-2.5 h-2.5 opacity-60 hidden sm:block"}),r.jsx("span",{className:"tabular-nums",children:e.label})]},t))})}),r.jsx("div",{className:"flex-1 min-h-0 relative overflow-hidden",children:r.jsx(pe,{width:"100%",height:"100%",minWidth:1,minHeight:1,children:r.jsxs(fe,{data:g,margin:{top:4,right:8,bottom:4,left:0},onMouseMove:j,onMouseLeave:()=>p(null),children:[r.jsx(be,{strokeDasharray:"3 3",stroke:d.secondary,strokeOpacity:.3,vertical:!1}),r.jsx(ye,{dataKey:"timestamp",type:"number",domain:[s,a],axisLine:!1,tickLine:!1,tick:!1,height:0}),r.jsx(ve,{axisLine:!1,tickLine:!1,tick:{fill:d.secondary,fontSize:10,fontFamily:'ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace'},dx:-8,width:44,tickFormatter:N,domain:[0,b]}),r.jsx(je,{content:r.jsx(Je,{mode:t})}),r.jsx(Ne,{type:"linear",dataKey:"rx",name:"RX",stroke:u,strokeWidth:2.5,strokeOpacity:.9,dot:!1,connectNulls:!1,isAnimationActive:!1}),r.jsx(Ne,{type:"linear",dataKey:"tx",name:"TX",stroke:h,strokeWidth:2.5,strokeOpacity:.9,dot:!1,connectNulls:!1,isAnimationActive:!1}),r.jsx(Ne,{type:"basis",dataKey:"rxSmooth",name:"RX Avg",stroke:"var(--sys-brown)",strokeWidth:2,strokeOpacity:1,dot:!1,connectNulls:!0,isAnimationActive:!1})]})})}),r.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between mt-1.5 sm:mt-2",children:[r.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 text-xs font-mono pl-2 sm:pl-11",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-3 sm:w-4 h-0.5",style:{backgroundColor:u}}),r.jsx("span",{className:"text-text-secondary",children:"RX"})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-3 sm:w-4 h-0.5",style:{backgroundColor:h}}),r.jsx("span",{className:"text-text-secondary",children:"TX"})]}),r.jsxs("div",{className:"hidden sm:flex items-center gap-1.5",children:[r.jsx("div",{className:"w-4 h-0.5",style:{backgroundColor:"var(--sys-brown)"}}),r.jsx("span",{className:"text-text-secondary",children:"Avg"})]})]}),r.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 text-right pr-1 sm:pr-2 font-mono",children:[r.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5",children:[r.jsx("span",{className:"text-xs font-medium",style:{color:u},children:"RX"}),r.jsx("span",{className:"font-bold text-lg sm:text-xl text-text-primary",children:y.rx})]}),r.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5",children:[r.jsx("span",{className:"text-xs font-medium",style:{color:h},children:"TX"}),r.jsx("span",{className:"font-bold text-lg sm:text-xl text-text-primary",children:y.tx})]}),y.isHovered&&r.jsx("span",{className:"text-xs text-text-muted hidden sm:inline",children:"bucket"})]})]})]})}function tt(e){const{values:t,sum:s}=e;if(0===t.length)return{min:0,mean:0,median:0,p75:0,p95:0,p99:0,max:0};const a=[...t].sort((e,t)=>e-t),n=a.length,r=s/n,l=a[0],i=a[n-1],o=e=>{const t=Math.min(Math.ceil(e*n)-1,n-1);return a[Math.max(0,t)]};return{min:l,mean:r,median:n%2==0?(a[n/2-1]+a[n/2])/2:a[Math.floor(n/2)],p75:o(.75),p95:o(.95),p99:o(.99),max:i}}function st({statsBuckets:e,mode:t,packets:s,startTs:a,endTs:i,radioConfig:o,sortedTypes:c,aggregateShares:m,noiseFloorAnomalies:d,showNoiseFloorOverlay:u,overlayOpacity:h=.5}){const[x,p]=n.useState(null),[g,f]=n.useState(null),b=n.useMemo(()=>(i-a)/3600,[a,i]),y=n.useCallback(e=>{f(e)},[]),v=function(e,t,s,a,r){return n.useMemo(()=>{if(0===e.length||!r)return null;const n=e.filter(e=>e.timestamp>=t&&e.timestamp<=s);if(0===n.length)return null;const l=[],i=new Map;for(const e of n){const s=e.type??e.payload_type??-1,n=E(e);let o;if(o="airtime"===a?B(e,{spreadingFactor:r.sf,bandwidthHz:r.bw,codingRate:r.cr,preambleLength:r.preamble}):1,n<=0)continue;const c=Math.floor((e.timestamp-t)/300),m={timestamp:e.timestamp,airtimeMs:o,byteSize:n,packetType:s,bucketIndex:c};l.push(m),i.has(c)||i.set(c,[]),i.get(c).push(m)}if(0===l.length)return null;const o=[],c=[],m=[],d=new Map;if("share"===a)for(const[,e]of i)for(const t of e)d.set(t,t.byteSize);else for(const[,e]of i){const t=e.reduce((e,t)=>e+t.airtimeMs,0)/3e5*100;let s=0;for(const a of e)a.airtimeMs>s&&(s=a.airtimeMs);for(const a of e){const e=a.airtimeMs/s*t;d.set(a,e)}}for(const e of l){const t=d.get(e);void 0!==t&&(o.push(t),c.push(e.timestamp),m.push(e.packetType))}let u=c[0],h=c[0];for(let e=1;e<c.length;e++)c[e]<u&&(u=c[e]),c[e]>h&&(h=c[e]);const x=h-u||1,p=[...o].sort((e,t)=>e-t),g=p[0],f=p[p.length-1],b=Math.floor(.05*p.length),y=Math.floor(.5*p.length),v=Math.min(Math.ceil(.95*p.length),p.length-1),j=p[b],N=p[y],w=p[v],k=new Map;for(const e of o){const t=Math.round(100*e)/100;k.set(t,(k.get(t)??0)+1)}const M=k.size,S=[...k.entries()].sort((e,t)=>t[1]-e[1]).slice(0,5).map(([e,t])=>({value:e,count:t,percent:t/o.length*100}));let C;if("share"===a)C=200;else{const e=5,t=Math.ceil(f/e)*e;C=t<=10?10:t+e}const T=new Float32Array(2*o.length),F=new Float32Array(o.length),$=new Uint8Array(o.length),P=new Float32Array(o.length);for(let e=0;e<o.length;e++){const t=(c[e]-u)/x,s=1-Math.max(0,Math.min(C,o[e]))/C;T[2*e]=t,T[2*e+1]=s,F[e]=o[e],$[e]=m[e]>=0?m[e]:255,P[e]=c[e]}return{points:T,rawValues:F,packetTypes:$,timestamps:P,count:o.length,minTime:u,maxTime:h,minValue:0,maxValue:C,rawMinValue:g,rawMaxValue:f,unit:"%",stats:{p5:j,p50:N,p95:w,uniqueValues:M,topValues:S}}},[e,t,s,a,r])}(s,a,i,"share"===t?"share":"airtime",o),{data:j}=n.useMemo(()=>function(e,t){var s;const a=e.length;if(0===a)return{data:[],windowSize:0,windowDurationMs:0};const n=(null==(s=e[0])?void 0:s.bucketDurationMs)??1e3,r=Math.min(Math.max(5,Math.round(3e5/n)),a),l=Math.floor(r/2),i=[];let o=0,c=0;for(let m=0;m<a;m++){const s=e[m],n=Math.max(0,m-l),r=Math.min(a,m+l+1),d=[];let u,h=0;for(let a=n;a<r;a++){const s=e[a];let n;n="share"===t?s.total/Math.max(1,s.bucketDurationMs/1e3):s.totalAirtime/s.bucketDurationMs*100,d.push(n),h+=n}u="share"===t?s.total/Math.max(1,s.bucketDurationMs/1e3):s.totalAirtime/s.bucketDurationMs*100,o+=u,c++;const x=tt({values:d,sum:h}),p=(x.min+x.max)/2;i.push({timestamp:s.timestamp,time:s.time,min:x.min,max:x.max,p75:x.p75,p95:x.p95,p99:x.p99,mean:x.mean,median:x.median,average:o/c,midpoint:p})}return{data:i,windowSize:r,windowDurationMs:r*n}}(e,t),[e,t]),N=n.useMemo(()=>j.map(e=>({timestamp:e.timestamp,min:e.min,max:e.max,p75:e.p75,p95:e.p95,p99:e.p99,mean:e.mean,median:e.median,average:e.average,midpoint:e.midpoint})),[j]),w=n.useMemo(()=>(null==v?void 0:v.maxValue)?v.maxValue:"share"===t?200:10,[v,t]),k=n.useCallback(e=>{p(e)},[]),M=n.useMemo(()=>{if(null===x||!j[x])return null;const e=j[x];let t;t=b>=168?75:b>=72?35:b>=24?15:b>=3?10:5;const s=60*t/2,a=e.timestamp;return{start:a-s,end:a+s}},[x,j,b]),S=n.useMemo(()=>{if(null===x||!j[x]||!M)return null;const e=j[x].time,{start:a,end:n}=M,r=s.filter(e=>e.timestamp>=a&&e.timestamp<n);if(0===r.length)return{timestamp:j[x].timestamp,timeLabel:e,items:c.map(e=>({key:e.key,label:e.label,value:0,color:Ge(e.typeNum)}))};const l=new Map,i=new Map;let m=0,d=0;for(const t of r){const e=`TYPE_${t.type??t.payload_type??-1}`;if(l.set(e,(l.get(e)??0)+1),m++,o){const s=B(t,{spreadingFactor:o.sf,bandwidthHz:o.bw,codingRate:o.cr,preambleLength:o.preamble});i.set(e,(i.get(e)??0)+s),d+=s}}const u=c.map(e=>{let s;return s="airtime"===t?d>0?(i.get(e.key)??0)/d:0:m>0?(l.get(e.key)??0)/m:0,{key:e.key,label:e.label,value:s,color:Ge(e.typeNum)}});return{timestamp:j[x].timestamp,timeLabel:e,items:u}},[x,j,M,s,c,t,o]);if(0===j.length)return r.jsxs("div",{className:"h-full flex items-center justify-center text-text-muted",children:[r.jsx(l,{className:"w-6 h-6 mr-2 opacity-50"}),r.jsx("span",{children:"No packet data available"})]});const C=(null==S?void 0:S.timeLabel)??null;return r.jsxs("div",{className:"flex flex-col",children:[r.jsxs("div",{className:"analyzer-chart-height relative flex-shrink-0",children:[r.jsx("div",{className:"absolute inset-0 rounded-lg overflow-hidden",children:r.jsx(qe,{data:N,maxValue:w,onHover:k,scatterData:v,noiseFloorAnomalies:d,showNoiseFloorOverlay:u,overlayOpacity:h,highlightedType:g,hoveredTimeRange:M,timeRangeHours:b,yAxisMode:"share"===t?"share":"airtime"})}),C&&r.jsx("div",{className:"absolute top-1 right-1 px-2 py-0.5 bg-bg-elevated/90 rounded text-xs text-accent-secondary font-mono pointer-events-none",children:C})]}),r.jsx(Xe,{sortedTypes:c,highlightedType:g,onTypeHover:y,aggregateShares:m,hoverData:S})]})}const at=new class{constructor(){a(this,"buckets",new Map),a(this,"lastProcessedTimestamp",0),a(this,"processedPacketCount",0),a(this,"cacheKey",null),a(this,"bucketDuration",60),a(this,"bucketDurationMs",6e4)}getBuckets(e,t,s,a){const n={startTs:t,endTs:s,radioConfigHash:this.hashRadioConfig(a)};return this.isCacheValid(n)?this.processPackets(e,t,s,a,!1):(this.invalidate(n),this.processPackets(e,t,s,a,!0)),this.toBucketDataArray(t,s)}processPackets(e,t,s,a,n){const r=Math.ceil((s-t)/this.bucketDuration);let l=0;for(const i of e){const e=i.timestamp;if(e<t||e>=s)continue;if(!n&&e<=this.lastProcessedTimestamp)continue;const o=Math.min(Math.floor((e-t)/this.bucketDuration),r-1),c=this.buckets.get(o)??{total:0,totalAirtime:0};c.total+=1,c.totalAirtime+=B(i,{spreadingFactor:a.sf,bandwidthHz:a.bw,codingRate:a.cr,preambleLength:a.preamble}),this.buckets.set(o,c),e>this.lastProcessedTimestamp&&(this.lastProcessedTimestamp=e),l++}this.processedPacketCount+=l}toBucketDataArray(e,t){const s=t-e,a=Math.ceil(s/this.bucketDuration),n=s/3600,r=[];for(let l=0;l<a;l++){const t=e+l*this.bucketDuration,s=new Date(1e3*t),a=n>24?s.toLocaleDateString([],{weekday:"short",hour:"2-digit",minute:"2-digit",hour12:!1}):s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),i=this.buckets.get(l)??{total:0,totalAirtime:0};r.push({timestamp:t,time:a,total:i.total,totalAirtime:i.totalAirtime,bucketDurationMs:this.bucketDurationMs})}return r}isCacheValid(e){return!!this.cacheKey&&this.cacheKey.startTs===e.startTs&&this.cacheKey.endTs===e.endTs&&this.cacheKey.radioConfigHash===e.radioConfigHash}invalidate(e){this.buckets.clear(),this.lastProcessedTimestamp=0,this.processedPacketCount=0,this.cacheKey=e}hashRadioConfig(e){return`${e.sf}-${e.bw}-${e.cr}-${e.preamble}`}clear(){this.buckets.clear(),this.lastProcessedTimestamp=0,this.processedPacketCount=0,this.cacheKey=null}getStats(){return{bucketCount:this.buckets.size,processedPackets:this.processedPacketCount,lastTimestamp:this.lastProcessedTimestamp,cacheKey:this.cacheKey}}};function nt({mode:e,onChange:t}){return r.jsxs("div",{className:"toggle-group toggle-group-sm",children:[r.jsx("button",{onClick:()=>t("share"),className:"toggle-group-item "+("share"===e?"active":""),children:"Total"}),r.jsx("button",{onClick:()=>t("airtime"),className:"toggle-group-item "+("airtime"===e?"active":""),children:"Airtime"})]})}function rt({smoothing:e,onChange:t}){return r.jsxs("div",{className:"toggle-group toggle-group-sm",children:[r.jsx("button",{onClick:()=>t("stats"),className:"toggle-group-item "+("stats"===e?"active":""),title:"Statistics view (scatter plot)",children:r.jsx(m,{className:"w-3.5 h-3.5"})}),r.jsx("button",{onClick:()=>t("trend"),className:"toggle-group-item "+("trend"===e?"active":""),title:"Trend line chart",children:r.jsx(d,{className:"w-3.5 h-3.5"})}),r.jsx("button",{onClick:()=>t("raw"),className:"toggle-group-item "+("raw"===e?"active":""),title:"No smoothing (raw values)",children:r.jsx(u,{className:"w-3.5 h-3.5"})}),r.jsx("button",{onClick:()=>t("zlema"),className:"toggle-group-item "+("zlema"===e?"active":""),title:"Light smoothing",children:r.jsx(h,{className:"w-3.5 h-3.5"})}),r.jsx("button",{onClick:()=>t("ema"),className:"toggle-group-item "+("ema"===e?"active":""),title:"Moderate smoothing",children:r.jsx(x,{className:"w-3.5 h-3.5"})}),r.jsx("button",{onClick:()=>t("smooth"),className:"toggle-group-item "+("smooth"===e?"active":""),title:"Heavy smoothing",children:r.jsx(p,{className:"w-3.5 h-3.5"})}),r.jsx("button",{onClick:()=>t("ultra"),className:"toggle-group-item "+("ultra"===e?"active":""),title:"Ultra smoothing",children:r.jsx(g,{className:"w-3.5 h-3.5"})}),r.jsx("button",{onClick:()=>t("mosaic"),className:"toggle-group-item "+("mosaic"===e?"active":""),title:"Mosaic view (treemap)",children:r.jsx(f,{className:"w-3.5 h-3.5"})})]})}function lt({enabled:e,onChange:t,anomalyCount:s=0,showTuning:a=!1,onTuningChange:n}){return r.jsxs("div",{className:"relative inline-flex items-center gap-1",children:[e&&n&&r.jsx("button",{onClick:()=>n(!a),className:"toggle-group toggle-group-sm "+(a?"active":""),title:a?"Hide tuning panel":"Show tuning panel",children:r.jsx("span",{className:"toggle-group-item "+(a?"active":""),children:r.jsx(o,{className:"w-3.5 h-3.5"})})}),r.jsx("button",{onClick:()=>t(!e),className:"toggle-group toggle-group-sm "+(e?"active":""),title:e?"Hide noise floor anomalies":"Show noise floor anomalies",children:r.jsx("span",{className:"toggle-group-item "+(e?"active":""),children:r.jsx(c,{className:"w-3.5 h-3.5"})})}),s>0&&r.jsx("span",{className:"absolute -top-2 -right-2 min-w-[18px] h-[18px] px-1 rounded-full bg-accent-danger text-white text-[10px] font-bold flex items-center justify-center pointer-events-none z-10",children:s>99?"99+":s})]})}const it={sf:10,bw:25e4,cr:5,preamble:8};function ot(e){return z[e]??`TYPE_${e.toString(16).toUpperCase()}`}function ct(e,t){if(0===e.length)return[];const s=Math.floor((t-1)/2),a=[];for(let n=0;n<e.length;n++){const t=n>=s?e[n-s]:e[0];a.push(e[n]+(e[n]-t))}return function(e,t){if(0===e.length)return[];const s=2/(t+1),a=[e[0]];for(let n=1;n<e.length;n++)a.push(s*e[n]+(1-s)*a[n-1]);return a}(a,t)}const mt=n.memo(function({packets:e,startTs:t,endTs:s,bucketCount:a,radioConfig:i=it,mode:o="share",smoothing:c="raw",noiseFloorAnomalies:m=null,showNoiseFloorOverlay:d=!1,overlayOpacity:u=.5}){const h=le(),[x,p]=n.useState(null),[g,f]=n.useState(null),[b,y]=n.useState([]),v=n.useRef(null),j=n.useRef(0);n.useEffect(()=>{const t=Math.abs(e.length-j.current);if(0===t&&b.length>0)return;v.current&&clearTimeout(v.current);const s=t>100?50:500;return v.current=setTimeout(()=>{j.current=e.length,y(e)},s),()=>{v.current&&clearTimeout(v.current)}},[e,b.length]);const N=n.useMemo(()=>function(e,t){const s=new Map;for(const n of e){const e=n.type??n.payload_type??-1,a=B(n,{spreadingFactor:t.sf,bandwidthHz:t.bw,codingRate:t.cr,preambleLength:t.preamble}),r=s.get(e)??{count:0,airtime:0};s.set(e,{count:r.count+1,airtime:r.airtime+a})}const a=[];for(const[n,r]of s)a.push({typeNum:n,key:`TYPE_${n}`,label:ot(n),totalCount:r.count,totalAirtime:r.airtime});return a.sort((e,t)=>t.totalCount-e.totalCount)}(b,i),[b,i]),w=n.useMemo(()=>function(e,t,s,a,n,r){const l=s-t,i=l/a,o=1e3*i,c=l/3600,m=[];for(let d=0;d<a;d++){const e=t+d*i,s=new Date(1e3*e),a={timestamp:e,time:c>24?s.toLocaleDateString([],{weekday:"short",hour:"2-digit",minute:"2-digit",hour12:!1}):s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),counts:{},shares:{},airtimes:{},total:0,totalAirtime:0,bucketDurationMs:o};for(const t of r)a.counts[t.key]=0,a.airtimes[t.key]=0;m.push(a)}for(const d of e){const e=d.timestamp;if(e<t||e>=s)continue;const r=Math.min(Math.floor((e-t)/i),a-1),l=`TYPE_${d.type??d.payload_type??-1}`;m[r].counts[l]=(m[r].counts[l]??0)+1,m[r].total++;const o=B(d,{spreadingFactor:n.sf,bandwidthHz:n.bw,codingRate:n.cr,preambleLength:n.preamble});m[r].airtimes[l]=(m[r].airtimes[l]??0)+o,m[r].totalAirtime+=o}for(const d of m)for(const e of r)d.shares[e.key]=d.total>0?d.counts[e.key]/d.total*100:0;return m}(b,t,s,a,i,N),[b,t,s,a,i,N]),k=n.useMemo(()=>at.getBuckets(b,t,s,i),[b,t,s,i]),M=n.useMemo(()=>N.reduce((e,t)=>e+t.totalCount,0),[N]),S=n.useMemo(()=>N.reduce((e,t)=>e+t.totalAirtime,0),[N]),{sortedTypes:C,aggregateShares:T}=n.useMemo(()=>{const e=new Map,t="share"===o?M:S;if(t>0)for(const s of N){const a="share"===o?s.totalCount:s.totalAirtime;e.set(s.key,a/t)}return{sortedTypes:[...N].sort((t,s)=>(e.get(s.key)??0)-(e.get(t.key)??0)),aggregateShares:e}},[N,M,S,o]),F=n.useMemo(()=>function(e,t,s,a="raw"){const n=function(e,t,s){if(e.length<=360)return e;const a=Math.ceil(e.length/360),n=[];for(let r=0;r<e.length;r+=a){const t=e.slice(r,Math.min(r+a,e.length));if(0===t.length)continue;const l={timestamp:t[0].timestamp,time:t[0].time,counts:{},shares:{},airtimes:{},total:0,totalAirtime:0,bucketDurationMs:t[0].bucketDurationMs*t.length};for(const e of t){l.total+=e.total,l.totalAirtime+=e.totalAirtime;for(const t of s)l.counts[t.key]=(l.counts[t.key]??0)+(e.counts[t.key]??0),l.airtimes[t.key]=(l.airtimes[t.key]??0)+(e.airtimes[t.key]??0)}for(const e of s)l.shares[e.key]=l.total>0?l.counts[e.key]/l.total*100:0;n.push(l)}return n}(e,0,s),r=n.length,l=s.length,i=Array.from({length:l},()=>new Array(r).fill(0));for(let u=0;u<r;u++){const e=n[u];if("share"===t)for(let t=0;t<l;t++)i[t][u]=e.total>0?(e.counts[s[t].key]??0)/e.total:0;else{let t=0;for(let a=0;a<l;a++)t+=e.airtimes[s[a].key]??0;for(let a=0;a<l;a++)i[a][u]=t>0?(e.airtimes[s[a].key]??0)/t:0}}const o=Array.from({length:l},()=>new Array(r).fill(0));for(let u=0;u<l;u++)for(let e=0;e<r;e++){let t=0;for(let s=0;s<=u;s++)t+=i[s][e];o[u][e]=t}const c=o.map(e=>function(e,t){switch(t){case"zlema":return ct(e,6);case"ema":return ct(e,12);case"smooth":return ct(e,24);case"ultra":return ct(e,96);default:return e}}(e,a)),m=Array.from({length:l},()=>new Array(r).fill(0));for(let u=0;u<l;u++)for(let e=0;e<r;e++){const t=u>0?c[u-1][e]:0;m[u][e]=Math.min(1,Math.max(0,c[u][e]-t))}for(let u=0;u<r;u++){let e=0;for(let t=0;t<l;t++)e+=m[t][u];if(e>0&&Math.abs(e-1)>1e-6){const t=1/e;for(let e=0;e<l;e++)m[e][u]*=t}}const d=[];for(let u=0;u<r;u++){const e={timestamp:n[u].timestamp,time:n[u].time};for(let t=0;t<l;t++)e[s[t].key]=m[t][u];d.push(e)}return d}(w,o,C,c),[w,o,C,c]),$=n.useCallback(e=>p(e),[]),P=n.useCallback(e=>f(e),[]),R=n.useMemo(()=>{if(null===g||!F[g])return null;const e=F[g];return{timestamp:e.timestamp,timeLabel:e.time,items:C.map(t=>({key:t.key,label:t.label,value:e[t.key]??0,color:Ge(t.typeNum)}))}},[g,F,C]),A=n.useMemo(()=>({timestamps:F.map(e=>e.timestamp),series:C.map(e=>({key:e.key,label:e.label,color:Ge(e.typeNum),values:F.map(t=>t[e.key]??0)}))}),[F,C]);return 0===b.length?0===e.length?r.jsxs("div",{className:"h-full flex items-center justify-center text-text-muted",children:[r.jsx(l,{className:"w-6 h-6 mr-2 opacity-50"}),r.jsx("span",{children:"No packet data available"})]}):null:"mosaic"===c?r.jsx(Qe,{sortedTypes:C,aggregateShares:T}):"stats"===c?r.jsx(st,{statsBuckets:k,mode:o,packets:b,startTs:t,endTs:s,radioConfig:i,sortedTypes:C,aggregateShares:T,noiseFloorAnomalies:m,showNoiseFloorOverlay:d,overlayOpacity:u}):"trend"===c?r.jsx(et,{packets:b,mode:o,startTs:t,endTs:s,radioConfig:i,bucketCount:a}):r.jsxs("div",{className:"flex flex-col",children:[r.jsx("div",{className:"analyzer-chart-height relative flex-shrink-0",children:r.jsx("div",{className:"absolute inset-0 rounded-lg overflow-hidden",children:r.jsx(H,{timestamps:A.timestamps,series:A.series,highlightedKey:x,cursorColor:h.cursor,onHover:P})})}),r.jsx(Xe,{sortedTypes:C,highlightedType:x,onTypeHover:$,aggregateShares:T,hoverData:R})]})}),dt={"1x":1,"2x":2,"4x":4,"8x":8,"16x":16,"36x":36},ut=[1,5,10,25,50,100,150];function ht(e,t,s,a){const n=Math.PI/180,r=(a-t)*n,l=e*n,i=s*n,o=Math.sin(r)*Math.cos(i),c=Math.cos(l)*Math.sin(i)-Math.sin(l)*Math.cos(i)*Math.cos(r);return(180*Math.atan2(o,c)/Math.PI+360)%360}function xt(e,t,s,a){const n=Math.PI/180,r=(s-e)*n,l=(a-t)*n,i=Math.sin(r/2)**2+Math.cos(e*n)*Math.cos(s*n)*Math.sin(l/2)**2;return 12742*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}const pt=[{min:10,label:"Excellent"},{min:7,label:"Very Good"},{min:4,label:"Good"},{min:1,label:"Fair+"},{min:-2,label:"Fair"},{min:-5,label:"Fair-"},{min:-8,label:"Poor"},{min:-11,label:"Bad"},{min:-1/0,label:"Critical"}];function gt(e,t){return t[me(e)]||"#808080"}const ft=n.memo(function({neighbors:e,quickNeighbors:t,localLat:s,localLon:a,onStatsChange:l}){const[i,o]=n.useState(null),[c,m]=n.useState(new Set),[d,u]=n.useState({width:0,height:0}),[h,x]=n.useState("1x"),[p,g]=n.useState(1),f=n.useRef(null),y=n.useRef({}),v=n.useRef(null),j=n.useRef(null),N=n.useRef(p);N.current=p;const w=ie(),k=ne(),M=oe(),S=re(),C=ce(),T=C?S.secondary:S.primary,F=C?.4:.15,$=C?.25:.08,P=C?S.primary:k.primary;n.useEffect(()=>{const e=j.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e){const{width:e,height:s}=t.contentRect;e>0&&s>0&&u({width:e,height:s})}});t.observe(e);const s=e.getBoundingClientRect();return s.width>0&&s.height>0&&u({width:s.width,height:s.height}),()=>t.disconnect()},[]);const R=n.useMemo(()=>{const e=new Set;if(t)for(const s of t)e.add(s.hash);return e},[t]),A=n.useMemo(()=>{const e=new Map;if(t)for(const s of t)e.set(s.hash,{snr:s.avgSnr,rssi:s.avgRssi});return e},[t]),{processedNeighbors:L,maxDistance:D,totalNeighbors:E,zeroHopCount:B}=n.useMemo(()=>{const t=[];for(const[r,l]of Object.entries(e)){if(!l.latitude||!l.longitude||0===l.latitude||0===l.longitude)continue;if(!R.has(r))continue;const e=ht(s,a,l.latitude,l.longitude),n=xt(s,a,l.latitude,l.longitude),i=A.get(r);t.push({hash:r.slice(0,8),name:l.node_name||l.name||"Unknown",snr:(null==i?void 0:i.snr)??l.snr??null,rssi:(null==i?void 0:i.rssi)??l.rssi??null,bearing:e,distance:n,normalizedDistance:0,lastSeen:l.last_seen,isZeroHop:!0})}const n=1.08*(t.length>0?Math.max(...t.map(e=>e.distance)):0);return t.sort((e,t)=>(e.snr??-1/0)-(t.snr??-1/0)),{processedNeighbors:t,maxDistance:n,totalNeighbors:t.length,zeroHopCount:t.length}},[e,s,a,R,A]);n.useEffect(()=>{null==l||l({zeroHopCount:B,totalCount:E,maxDistanceKm:D})},[B,E,D]),n.useEffect(()=>{const e=dt[h],t=N.current;f.current&&cancelAnimationFrame(f.current);const s=performance.now(),a=n=>{const r=n-s,l=Math.min(r/400,1),i=(o=l)<.5?8*o*o*o*o:1-Math.pow(-2*o+2,4)/2;var o;g(t+(e-t)*i),f.current=l<1?requestAnimationFrame(a):null};return f.current=requestAnimationFrame(a),()=>{f.current&&cancelAnimationFrame(f.current)}},[h]);const H=D/p,z=n.useMemo(()=>ut.filter(e=>e<=1.1*H),[H]);n.useEffect(()=>{const e=[];for(const s of L){const t=y.current[s.hash];void 0!==t&&t!==s.lastSeen&&e.push(s.hash),y.current[s.hash]=s.lastSeen}if(0===e.length)return;queueMicrotask(()=>{m(t=>new Set([...t,...e]))});const t=setTimeout(()=>{m(t=>{const s=new Set(t);return e.forEach(e=>s.delete(e)),s})},600);return()=>clearTimeout(t)},[L]);const O=0!==s&&0!==a,W=n.useMemo(()=>{const{width:e,height:t}=d,s=e/2,a=t/2,n=Math.max(10,e/2-12),r=Math.max(10,t/2-12),l=Math.max(10,n-16),i=Math.max(10,r-16);return{width:e,height:t,centerX:s,centerY:a,maxRadiusX:l,maxRadiusY:i,labelRadiusX:n,labelRadiusY:r,cornerRadius:.2*Math.min(l,i)}},[d]),{width:I,height:V,centerX:q,centerY:G,maxRadiusX:X,maxRadiusY:K,labelRadiusX:Y,labelRadiusY:U,cornerRadius:Q}=W,Z=n.useCallback((e,t=1)=>{const s=X*t,a=K*t,n=Math.min(Q*t,s,a),r=(e%360+360)%360,l=r*Math.PI/180,i=180*Math.atan2(a-n,s-n)/Math.PI;let o,c;if(r<=45-i||r>315+i){const e=Math.tan(l);o=Math.max(q-s+n,Math.min(q+s-n,q+a*e*(s/a))),c=G-a}else if(r>45-i&&r<=45+i)o=q+s-n+n*Math.sin(l),c=G-a+n-n*Math.cos(l);else if(r>45+i&&r<=135-i){const e=1/Math.tan(l);c=Math.max(G-a+n,Math.min(G+a-n,G-s*e*(a/s))),o=q+s}else if(r>135-i&&r<=135+i)o=q+s-n+n*Math.sin(l),c=G+a-n-n*Math.cos(l);else if(r>135+i&&r<=225-i){const e=Math.tan(l);o=Math.max(q-s+n,Math.min(q+s-n,q-a*e*(s/a))),c=G+a}else if(r>225-i&&r<=225+i)o=q-s+n+n*Math.sin(l),c=G+a-n-n*Math.cos(l);else if(r>225+i&&r<=315-i){const e=1/Math.tan(l);c=Math.max(G-a+n,Math.min(G+a-n,G-s*e*(a/s))),o=q-s}else o=q-s+n+n*Math.sin(l),c=G-a+n-n*Math.cos(l);return{x:o,y:c}},[q,G,X,K,Q]),J=n.useCallback((e,t)=>{const s=Z(e,1);return{x:q+(s.x-q)*t,y:G+(s.y-G)*t}},[Z,q,G]),ee=n.useCallback(e=>({N:{x:q,y:G-U},S:{x:q,y:G+U},E:{x:q+Y,y:G},W:{x:q-Y,y:G},NE:{x:q+Y,y:G-U},SE:{x:q+Y,y:G+U},SW:{x:q-Y,y:G+U},NW:{x:q-Y,y:G-U}}[e]),[q,G,Y,U]),te=n.useCallback(e=>{const t=X*e,s=K*e,a=Math.min(Q*e,t,s),n=q-t,r=q+t,l=G-s,i=G+s;return[`M ${n+a} ${l}`,`L ${r-a} ${l}`,`Q ${r} ${l} ${r} ${l+a}`,`L ${r} ${i-a}`,`Q ${r} ${i} ${r-a} ${i}`,`L ${n+a} ${i}`,`Q ${n} ${i} ${n} ${i-a}`,`L ${n} ${l+a}`,`Q ${n} ${l} ${n+a} ${l}`,"Z"].join(" ")},[q,G,X,K,Q]),se=n.useCallback(e=>{o(e)},[]),ae=n.useCallback(e=>{x(e)},[]),le=n.useCallback(e=>D<=0?0:e/D*p,[D,p]),me=e=>`${e}km`,de=n.useMemo(()=>{const e=z.map(e=>{const t=e/D*p;return{km:e,scale:t,labelY:G-K*t*.71}}).filter(e=>e.scale<=1.05&&e.scale>=.02).sort((e,t)=>t.km-e.km),t=[];for(const s of e)t.some(e=>Math.abs(e.labelY-s.labelY)<28)||t.push(s);return t},[z,D,p,G,K]),ue=d.width>0&&d.height>0;return O?0===E?r.jsxs("div",{ref:v,className:"flex flex-col items-center justify-center h-full text-text-secondary",children:[r.jsx(b,{className:"w-8 h-8 mb-2 opacity-50"}),r.jsx("p",{children:"No nodes with location data"})]}):r.jsxs("div",{ref:v,className:"relative h-full w-full flex overflow-hidden",children:[r.jsx("div",{ref:j,className:"relative flex-1 min-w-0 h-full",children:ue&&r.jsxs("svg",{width:I,height:V,className:"absolute inset-0 z-0",children:[r.jsxs("defs",{children:[r.jsx("style",{children:"\n                @keyframes neighbor-blink-scale {\n                  0%, 100% {\n                    transform: scale(1);\n                    opacity: 0;\n                  }\n                  50% {\n                    transform: scale(1.3);\n                    opacity: 0.8;\n                  }\n                }\n                .neighbor-blink-ring {\n                  transform-origin: center;\n                  animation: neighbor-blink-scale 600ms ease-out forwards;\n                }\n              "}),r.jsx("clipPath",{id:"radar-clip",children:r.jsx("path",{d:te(1)})})]}),z.map(e=>{const t=le(e);if(t>1.05||t<.02)return null;const s=de.some(t=>t.km===e),a=q+X*t*.71,n=G-K*t*.71;return r.jsxs("g",{children:[r.jsx("path",{d:te(t),fill:"none",stroke:T,strokeOpacity:F,strokeWidth:1}),s&&r.jsx("text",{x:a+4,y:n-2,textAnchor:"start",dominantBaseline:"auto",className:"fill-text-secondary",fontSize:10,fontFamily:_,children:me(e)})]},`ring-${e}`)}),["N","E","S","W"].map(e=>{const t="N"===e||"S"===e,s=t?q:"E"===e?q+X:q-X,a=t?"N"===e?G-K:G+K:G;return r.jsx("line",{x1:q,y1:G,x2:s,y2:a,stroke:T,strokeOpacity:F,strokeWidth:1,strokeDasharray:"4 4"},e)}),["NE","SE","SW","NW"].map(e=>{const t=ee(e);return r.jsx("line",{x1:q,y1:G,x2:t.x,y2:t.y,stroke:T,strokeOpacity:$,strokeWidth:1,strokeDasharray:"4 4"},`diag-${e}`)}),["N","E","S","W"].map(e=>{const t=ee(e),s="E"===e?"end":"W"===e?"start":"middle",a="N"===e?"hanging":"S"===e?"auto":"middle";return r.jsx("text",{x:t.x,y:t.y,textAnchor:s,dominantBaseline:a,fill:P,fontSize:16,fontWeight:600,fontFamily:_,"aria-hidden":"true",children:e},e)}),["NE","SE","SW","NW"].map(e=>{const t=ee(e),s="NE"===e||"SE"===e?"end":"start",a="NE"===e||"NW"===e?"hanging":"auto";return r.jsx("text",{x:t.x,y:t.y,textAnchor:s,dominantBaseline:a,fill:P,fontSize:16,fontWeight:600,fontFamily:_,"aria-hidden":"true",children:e},e)}),r.jsx("circle",{cx:q,cy:G,r:5,fill:M.chart6,stroke:"rgba(255,255,255,0.3)",strokeWidth:1,role:"img","aria-label":"Local node"}),r.jsx("g",{clipPath:"url(#radar-clip)",children:L.map(e=>{const t=D>0?e.distance/D*p:0;if(t>1)return null;const{x:s,y:a}=J(e.bearing,t),n=null!==e.snr?gt(e.snr,w):"#808080",l=(null==i?void 0:i.hash)===e.hash,o=c.has(e.hash);return r.jsxs("g",{role:"img","aria-label":`${e.name}: ${e.distance.toFixed(1)}km ${e.bearing.toFixed(0)}`,children:[o&&r.jsx("circle",{cx:s,cy:a,r:10.5,fill:"none",stroke:"rgba(255,255,255,0.9)",strokeWidth:2,className:"neighbor-blink-ring"}),l&&r.jsx("circle",{cx:s,cy:a,r:10.5,fill:n,opacity:.3}),r.jsx("circle",{cx:s,cy:a,r:l?7:5,fill:n,stroke:"rgba(0,0,0,0.5)",strokeWidth:1,style:{cursor:"pointer",transition:"r 0.15s"},onMouseEnter:()=>se(e),onMouseLeave:()=>se(null)})]},e.hash)})})]})}),r.jsx("div",{className:"flex flex-col h-full items-stretch gap-1 py-2 pl-2 flex-shrink-0",role:"group","aria-label":"Zoom level",children:["1x","2x","4x","8x","16x","36x"].map(e=>r.jsx("button",{onClick:()=>ae(e),"aria-pressed":h===e,className:"flex flex-1 items-center justify-center px-1.5 text-xs font-medium rounded transition-colors "+(h===e?"bg-accent-primary/20 text-accent-primary":"bg-white/5 text-text-secondary hover:bg-white/10 hover:text-text-primary"),children:e},e))}),i&&r.jsxs("div",{className:"absolute bg-tooltip-bg border border-border-subtle rounded-lg px-3 py-2 text-sm pointer-events-none z-10 shadow-xl",style:{left:"50%",bottom:8,transform:"translateX(-50%)"},children:[r.jsx("div",{className:"font-medium text-text-primary",children:i.name}),r.jsx("div",{className:"text-text-secondary text-xs font-mono",children:i.hash}),null!==i.snr?r.jsx("div",{className:"flex gap-3 mt-1 text-xs",children:r.jsxs("span",{children:[r.jsx("span",{className:"text-text-secondary",children:"SNR:"})," ",r.jsxs("span",{className:"tabular-nums",style:{color:gt(i.snr,w)},children:[i.snr.toFixed(1)," dB"]}),r.jsxs("span",{className:"text-text-secondary ml-1",children:["(",(he=i.snr,(null==(xe=pt.find(e=>he>=e.min))?void 0:xe.label)??"Critical"),")"]})]})}):r.jsx("div",{className:"text-xs text-text-secondary mt-1",children:"No SNR data"}),r.jsxs("div",{className:"flex gap-3 text-xs",children:[r.jsxs("span",{children:[r.jsx("span",{className:"text-text-secondary",children:"Distance:"})," ",r.jsxs("span",{className:"tabular-nums text-text-primary",children:[i.distance.toFixed(2)," km"]})]}),r.jsxs("span",{children:[r.jsx("span",{className:"text-text-secondary",children:"Bearing:"})," ",r.jsxs("span",{className:"tabular-nums text-text-primary",children:[i.bearing.toFixed(0),""]})]})]})]})]}):r.jsxs("div",{ref:v,className:"flex flex-col items-center justify-center h-full text-text-secondary",children:[r.jsx(b,{className:"w-8 h-8 mb-2 opacity-50"}),r.jsx("p",{children:"Local node coordinates not configured"}),r.jsx("p",{className:"text-xs mt-1",children:"Set latitude/longitude in config to enable"})]});var he,xe});function bt(e,t){if(0===e.length)return 0;const s=t/100*(e.length-1),a=Math.floor(s),n=Math.ceil(s);return a===n?e[a]:e[a]+(e[n]-e[a])*(s-a)}const yt=n.memo(function({timestamps:e,values:t,onStatsChange:s}){var a,l;const{theme:i}=O(),[o,c]=n.useState(!0),m=n.useMemo(()=>{if(0===t.length)return null;const e=Math.min(...t),s=Math.max(...t),a=t.reduce((e,t)=>e+t,0)/t.length,n=[...t].sort((e,t)=>e-t);return{min:e,max:s,avg:a,p5:bt(n,5),p95:bt(n,95)}},[t]);n.useEffect(()=>{null==s||s(m)},[m]);const d=n.useCallback(()=>{c(e=>!e)},[]),{heatmapData:u,xLabels:h,yLabels:x}=n.useMemo(()=>{if(0===e.length||0===t.length||!m)return{heatmapData:null,xLabels:[],yLabels:[]};let s,a;if(o){const e=.1*(m.p95-m.p5||1);s=m.p5-e,a=m.p95+e}else{const e=.1*(m.max-m.min||1);s=m.min-e,a=m.max+e}const n=a-s,r=e[0],l=e[e.length-1]-r||1,i=new Float32Array(2*e.length);for(let o=0;o<e.length;o++){const c=(e[o]-r)/l,m=1-(Math.max(s,Math.min(a,t[o]))-s)/n;i[2*o]=c,i[2*o+1]=m}const c=[];for(let e=0;e<=5;e++){const t=r+l*e/5;c.push({pos:e/5*100,label:new Date(1e3*t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})}const d=[];for(let e=0;e<=4;e++){const t=s+n*e/4;d.push({pos:100*(1-e/4),label:`${Math.round(t)}`})}return{heatmapData:{points:i,count:e.length},xLabels:c,yLabels:d}},[e,t,m,o]),p=n.useRef(null),g=n.useRef(null),[f,b]=n.useState({width:0,height:0});return n.useEffect(()=>{const e=g.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e){const{width:e,height:s}=t.contentRect;e>0&&s>0&&b({width:e,height:s})}});t.observe(e);const s=e.getBoundingClientRect();return s.width>0&&s.height>0&&b({width:s.width,height:s.height}),()=>t.disconnect()},[]),n.useEffect(()=>{const e=p.current;if(!e||!u||0===f.width)return;const t=e.getContext("2d");if(!t)return;const{width:s,height:a}=f,n=window.devicePixelRatio||1;e.width=s*n,e.height=a*n,e.style.width=`${s}px`,e.style.height=`${a}px`,t.scale(n,n),t.clearRect(0,0,s,a);const r=getComputedStyle(document.documentElement).getPropertyValue("--accent-primary").trim(),{r:l,g:i,b:o}=(e=>{const t=e.match(/color\(display-p3\s+([\d.]+)\s+([\d.]+)\s+([\d.]+)\)/);if(t)return{r:Math.round(255*parseFloat(t[1])),g:Math.round(255*parseFloat(t[2])),b:Math.round(255*parseFloat(t[3]))};const s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return s?{r:parseInt(s[1],16),g:parseInt(s[2],16),b:parseInt(s[3],16)}:{r:250,g:189,b:47}})(r),{points:c,count:m}=u,d=Math.max(3,Math.min(8,s/m*4));t.globalCompositeOperation="source-over";for(let u=0;u<m;u++){const e=c[2*u]*s,n=c[2*u+1]*a,r=t.createRadialGradient(e,n,0,e,n,d);r.addColorStop(0,`rgba(${l}, ${i}, ${o}, 0.85)`),r.addColorStop(.25,`rgba(${l}, ${i}, ${o}, 0.85)`),r.addColorStop(.35,`rgba(${l}, ${i}, ${o}, 0.15)`),r.addColorStop(1,`rgba(${l}, ${i}, ${o}, 0)`),t.fillStyle=r,t.beginPath(),t.arc(e,n,d,0,2*Math.PI),t.fill()}},[u,f,i.colorScheme]),u?r.jsxs("div",{className:"relative w-full h-full",role:"img","aria-label":`RF noise floor heatmap showing values from ${(null==(a=null==m?void 0:m.min)?void 0:a.toFixed(0))??"N/A"} to ${(null==(l=null==m?void 0:m.max)?void 0:l.toFixed(0))??"N/A"} dBm`,children:[r.jsx("div",{className:"absolute top-0 left-0 flex flex-col justify-between",style:{width:32,bottom:20},"aria-hidden":"true",children:x.map((e,t)=>r.jsx("span",{className:"type-data-xs text-text-secondary tabular-nums text-right pr-1.5",style:{position:"absolute",top:`${e.pos}%`,transform:"translateY(-50%)",right:0},children:e.label},t))}),r.jsxs("div",{ref:g,className:"absolute overflow-hidden",style:{left:32,right:0,top:0,bottom:20},children:[r.jsx("svg",{className:"absolute inset-0 w-full h-full",preserveAspectRatio:"none","aria-hidden":"true",children:[0,25,50,75,100].map(e=>r.jsx("line",{x1:"0",y1:`${e}%`,x2:"100%",y2:`${e}%`,stroke:"var(--chart-grid-line, rgba(255,255,255,0.06))",strokeDasharray:"3 3"},e))}),r.jsx("canvas",{ref:p,className:"absolute inset-0 w-full h-full","aria-hidden":"true"}),r.jsx("button",{type:"button",onClick:d,className:"absolute bottom-1 right-1 p-1.5 rounded bg-tooltip-bg/80 hover:bg-tooltip-bg active:bg-tooltip-bg transition-colors touch-manipulation",title:o?"Show full range (min/max)":"Show trimmed range (P5-P95)","aria-label":o?"Expand to show full data range":"Shrink to show trimmed percentile range","aria-pressed":!o,children:o?r.jsx(y,{className:"w-3.5 h-3.5 text-text-muted","aria-hidden":"true"}):r.jsx(v,{className:"w-3.5 h-3.5 text-text-muted","aria-hidden":"true"})})]}),r.jsx("div",{className:"absolute left-0 right-0 bottom-0",style:{left:32,height:20},"aria-hidden":"true",children:h.map((e,t)=>r.jsx("span",{className:"type-data-xs text-text-secondary tabular-nums absolute top-1",style:{left:`${e.pos}%`,transform:"translateX(-50%)"},children:e.label},t))})]}):r.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"No noise floor data available"})}),vt={repeater:"var(--accent-primary)",companion:"var(--accent-tertiary)",room_server:"var(--accent-secondary)"};function jt(e){if(e.contact_type){const t=e.contact_type.toLowerCase();if("repeater"===t||"rep"===t)return"repeater";if("room server"===t||"room_server"===t||"room"===t||"server"===t)return"room_server";if("companion"===t||"client"===t||"cli"===t)return"companion"}return e.is_repeater?"repeater":"companion"}const Nt=n.memo(function({neighbors:e}){const t=n.useMemo(()=>{const t={repeater:0,companion:0,room_server:0};for(const a of Object.values(e)){const e=jt(a);t[e]=(t[e]||0)+1}const s=Object.values(t).reduce((e,t)=>e+t,0);return{items:[{label:"Repeaters",count:t.repeater,percent:0,color:vt.repeater},{label:"Companions",count:t.companion,percent:0,color:vt.companion},{label:"Room Servers",count:t.room_server,percent:0,color:vt.room_server}].map(e=>({...e,percent:s>0?e.count/s*100:0})).filter(e=>e.count>0).sort((e,t)=>t.count-e.count),total:s}},[e]);return 0===t.total?r.jsx("div",{className:"h-full flex items-center justify-center text-text-muted type-body-sm",children:"No neighbors discovered yet"}):r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx("div",{className:"flex-1 flex flex-col justify-evenly",children:t.items.map(e=>r.jsxs("div",{className:"flex flex-col gap-1.5",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"type-data-sm text-text-secondary",children:e.label}),r.jsxs("span",{className:"type-data-sm text-text-secondary tabular-nums",children:[e.count," ",r.jsxs("span",{className:"text-text-secondary/60",children:["(",e.percent.toFixed(0),"%)"]})]})]}),r.jsx("div",{className:"h-2.5 bg-bg-elevated overflow-hidden",children:r.jsx("div",{className:"h-full transition-all duration-500 ease-out",style:{width:`${e.percent}%`,backgroundColor:e.color,minWidth:e.count>0?"4px":"0"}})})]},e.label))}),r.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border-subtle",children:[r.jsx("span",{className:"type-data-xs text-text-secondary",children:"Total Nodes"}),r.jsx("span",{className:"type-data-sm text-text-primary font-medium tabular-nums",children:t.total})]})]})});function wt({children:e,minHeight:t="100%",rootMargin:s="200px 0px",keepMounted:a=!0,className:l=""}){const i=n.useRef(null),[o,c]=n.useState(!1),[m,d]=n.useState(!1);n.useEffect(()=>{const e=i.current;if(!e)return;const t=new IntersectionObserver(([e])=>{const t=e.isIntersecting;d(t),t&&c(!0)},{rootMargin:s,threshold:0});return t.observe(e),()=>{t.disconnect()}},[s]);const u=m||a&&o;return r.jsx("div",{ref:i,className:`h-full w-full ${l}`,style:{minHeight:t},children:u?e:r.jsx("div",{className:"h-full w-full flex items-center justify-center text-text-muted/50",children:r.jsx("div",{className:"animate-pulse text-xs",children:"Loading chart..."})})})}const kt={excellent:"text-signal-excellent",good:"text-signal-good",fair:"text-signal-fair",poor:"text-accent-primary"},Mt={excellent:"bg-signal-excellent/10",good:"bg-signal-good/10",fair:"bg-signal-fair/10",poor:"bg-accent-primary/10"};function St(){const e=W(),t=I(),[s,a]=n.useState(null),l=n.useCallback((e,t)=>{a({prefix:e,candidateHashes:t})},[]),i=n.useCallback(()=>{a(null)},[]);if(!t)return r.jsxs(ke,{children:[r.jsx(Fe,{icon:r.jsx(j,{}),title:"Prefix Conflicts",largeTitle:!0}),r.jsx("div",{className:"flex-1 flex items-center justify-center",children:r.jsxs("div",{className:"text-center text-text-secondary",children:[r.jsx(N,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),r.jsx("p",{className:"type-data-xs",children:"No topology data available"}),r.jsx("p",{className:"type-data-xs opacity-70",children:"Run deep analysis to see stats"})]})})]});const o=(c=e.avgConfidence)>=.9?"excellent":c>=.7?"good":c>=.5?"fair":"poor";var c;const m=(d=e.collisionRate)<=10?"excellent":d<=25?"good":"poor";var d;const u="poor"===o||"poor"===m?"poor":"fair"===o||"fair"===m?"fair":"good"===o||"good"===m?"good":"excellent",h="excellent"===u||"good"===u?w:k;return r.jsxs(ke,{className:"flex flex-col overflow-hidden",children:[r.jsx(Fe,{icon:r.jsx(j,{}),title:"Prefix Conflicts",largeTitle:!0,actions:r.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1 rounded-full ${Mt[u]}`,children:[r.jsx(h,{className:`w-3.5 h-3.5 ${kt[u]}`}),r.jsx("span",{className:`type-data-xs font-medium ${kt[u]}`,children:"excellent"===u?"Excellent":"good"===u?"Good":"fair"===u?"Fair":"Needs Attention"})]})}),r.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[r.jsxs("div",{className:"grid grid-cols-3 gap-1.5 sm:gap-2 py-3 sm:py-4",children:[r.jsxs("div",{className:"flex flex-col items-center cursor-help bg-white/5 rounded-lg sm:rounded-xl py-2 sm:py-3 px-1.5 sm:px-2",title:"Total unique 2-character prefixes observed in packet paths.",children:[r.jsx("span",{className:"font-mono text-2xl sm:text-3xl font-semibold tabular-nums text-text-primary",style:{letterSpacing:"-0.05em"},children:e.totalPrefixes}),r.jsx("span",{className:"type-data-xs sm:type-data-sm text-text-secondary mt-0.5 sm:mt-1",children:"Prefixes"})]}),r.jsxs("div",{className:"flex flex-col items-center cursor-help bg-white/5 rounded-lg sm:rounded-xl py-2 sm:py-3 px-1.5 sm:px-2",title:"Prefixes that map to exactly one known node. No disambiguation needed.",children:[r.jsx("span",{className:"font-mono text-2xl sm:text-3xl font-semibold tabular-nums text-text-primary",style:{letterSpacing:"-0.05em"},children:e.unambiguousPrefixes}),r.jsx("span",{className:"type-data-xs sm:type-data-sm text-text-secondary mt-0.5 sm:mt-1",children:"Unique"})]}),r.jsxs("div",{className:"flex flex-col items-center cursor-help rounded-lg sm:rounded-xl py-2 sm:py-3 px-1.5 sm:px-2 "+(e.collisionPrefixes>0?"bg-accent-primary/15":"bg-white/5"),title:"Prefixes matching multiple known nodes. Click a prefix below to explore candidates.",children:[r.jsx("span",{className:"font-mono text-2xl sm:text-3xl font-semibold tabular-nums "+(e.collisionPrefixes>0?"text-accent-primary":"text-text-primary"),style:{letterSpacing:"-0.05em"},children:e.collisionPrefixes}),r.jsx("span",{className:"type-data-xs sm:type-data-sm mt-0.5 sm:mt-1 "+(e.collisionPrefixes>0?"text-accent-primary":"text-text-secondary"),children:"Conflicts"})]})]}),e.highCollisionPrefixes.length>0&&r.jsxs("div",{children:[r.jsx("div",{className:"type-data-xs text-text-secondary mb-1.5",children:"Problem Prefixes"}),r.jsx("div",{className:"flex flex-wrap gap-1.5 content-start",children:e.highCollisionPrefixes.map(({prefix:e,candidateCount:t,candidateHashes:s})=>r.jsxs("button",{type:"button",onClick:()=>l(e,s),className:"inline-flex items-center gap-0.5 group",title:`${t} candidates - click to explore`,children:[r.jsx(Ce,{children:e}),r.jsxs("span",{className:"text-text-muted type-data-xs group-hover:text-text-secondary transition-colors",children:["",t]})]},e))})]}),0===e.lowConfidencePrefixes.length&&0===e.collisionPrefixes&&r.jsx("div",{className:"flex-1 flex items-center",children:r.jsxs("div",{className:"flex items-center gap-1.5",children:[r.jsx(w,{className:"w-3.5 h-3.5 text-signal-excellent"}),r.jsx("span",{className:"type-data-xs text-signal-excellent",children:"All prefixes uniquely identified"})]})}),r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 mt-auto pt-3",children:[r.jsxs("div",{className:"flex items-center gap-2 cursor-help",title:"Average confidence score across all disambiguated prefixes. Higher = more certain node identification.",children:[r.jsx("span",{className:"type-data-xs text-text-secondary",children:"Confidence"}),r.jsxs("span",{className:`data-box ${kt[o]}`,children:[(100*e.avgConfidence).toFixed(1),"%"]})]}),r.jsxs("div",{className:"flex items-center gap-2 cursor-help",title:"Percentage of 2-character prefixes that match multiple known nodes. Lower is better.",children:[r.jsx("span",{className:"type-data-xs text-text-secondary",children:"Collisions"}),r.jsxs("span",{className:`data-box ${kt[m]}`,children:[e.collisionRate.toFixed(1),"%"]})]})]})]}),r.jsx(Te,{isOpen:!!s,prefix:(null==s?void 0:s.prefix)||"",candidateHashes:(null==s?void 0:s.candidateHashes)||[],onClose:i})]})}function Ct({icon:e,label:t,value:s,sublabel:a,highlight:n,tooltip:l}){return r.jsxs("div",{className:"flex items-center justify-between gap-2 py-1.5 "+(l?"cursor-help":""),title:l,children:[r.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 min-w-0",children:[r.jsx("span",{className:"icon-xs text-icon-widget flex-shrink-0",children:e}),r.jsx("span",{className:"type-body-sm text-text-secondary truncate",children:t})]}),r.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5 flex-shrink-0",children:[r.jsx("span",{className:"data-box",style:n?{"--data-box-color":"var(--accent-primary)"}:void 0,children:s}),a&&r.jsx("span",{className:"type-data-xs text-text-secondary hidden sm:inline",children:a})]})]})}function Tt(){const e=V(),t=q().length;if(!e||0===e.totalPaths)return null;const{totalPaths:s,pathsWithGhosts:a,observationOverrideCount:n,tracePacketsProcessed:l,pathPacketsProcessed:i,distantEdgesDiscovered:o,duplicateGroupsFound:c,duplicatePathsUnique:m,echolocationEdgesInferred:d}=e,u=s>0?((s-a)/s*100).toFixed(1):"0",h=s>0?(n/s*100).toFixed(1):"0",x=l+i,p=x>0||o>0,g=c>0||d>0;return r.jsxs(ke,{children:[r.jsx(Fe,{title:"Path Decoder",icon:r.jsx(M,{}),largeTitle:!0,badge:t>0?`${t} hidden`:void 0}),r.jsxs($e,{children:[r.jsxs("div",{children:[r.jsx(Ct,{icon:r.jsx(S,{className:"w-3.5 h-3.5"}),label:"Traceable",value:`${u}%`,sublabel:`of ${s.toLocaleString()} paths`,tooltip:"Percentage of packet journeys where every hop was identified. Higher = better visibility into how traffic flows through your mesh."}),r.jsx(Ct,{icon:r.jsx(C,{className:"w-3.5 h-3.5"}),label:"Learning Rate",value:`${h}%`,sublabel:"adapted",tooltip:"How often real traffic patterns improved our predictions over geography alone. Higher values mean the decoder is learning your mesh's actual behavior  which routes are preferred, which nodes are most active."})]}),p&&r.jsxs("div",{className:"mt-3",children:[r.jsx("p",{className:"type-micro mb-2",children:"Beyond Line-of-Sight"}),r.jsxs("div",{children:[r.jsx(Ct,{icon:r.jsx(T,{className:"w-3.5 h-3.5"}),label:"Route Reports",value:x.toLocaleString(),sublabel:l>0?`(${l} TRACE)`:void 0,tooltip:"TRACE/PATH packets from distant nodes share their routing tables. This reveals connections we can't directly observe  mapping parts of the mesh we don't touch."}),r.jsx(Ct,{icon:r.jsx(F,{className:"w-3.5 h-3.5"}),label:"Remote Links",value:o.toLocaleString(),highlight:o>0,tooltip:"Node-to-node connections discovered from route reports. These links exist outside our RF range but help complete the topology picture."})]})]}),g&&r.jsx(Ct,{icon:r.jsx($,{className:"w-3.5 h-3.5"}),label:"Multi-Path Packets",value:c.toLocaleString(),sublabel:m>0?`(${m} routes)`:void 0,tooltip:"Packets received via multiple paths simultaneously. Like sonar, these 'echoes' reveal redundant routes  important for understanding mesh resilience."}),t>0&&r.jsx(Ct,{icon:r.jsx(P,{className:"w-3.5 h-3.5 text-accent-primary"}),label:"Ghost Repeaters",value:t,highlight:!0,tooltip:"High-confidence hidden repeaters: appear in 10+ paths, have 2+ known neighbors, 30% confidence, and plausible location. View them on the Contacts map."})]})]})}function Ft(){var e,t,s,a,i,o,c,m,d,u,h,x,p,g,f,y,v;const j=G(),N=X(),w=K(),k=Y(),M=U(),S=Q(),C=Z(),T=J(),[F,$]=n.useState([]),[P,D]=n.useState(null),[E,B]=n.useState(null),[H,z]=n.useState(!0),[_,O]=n.useState(null),[W,I]=n.useState(()=>{const e=localStorage.getItem("statistics-view-mode");return"share"===e||"airtime"===e?e:"airtime"});n.useEffect(()=>{localStorage.setItem("statistics-view-mode",W)},[W]);const[V,q]=n.useState(()=>{const e=localStorage.getItem("statistics-smoothing-mode");return["raw","ema","zlema","smooth","ultra","mosaic","stats","trend"].includes(e)?e:"trend"});n.useEffect(()=>{localStorage.setItem("statistics-smoothing-mode",V)},[V]);const[ne,re]=n.useState(!1),[le,ie]=n.useState(!1),[oe,ce]=n.useState(Ae),[me,de]=n.useState(.5),ue=n.useMemo(()=>({0:0,1:0,2:1,3:2,4:3,5:4,6:5,7:6}[C]??3),[C]),he=ee[ue].hours,xe=60*he,pe=ee[ue],ge=se(he),fe=S.isBackgroundLoading,be=n.useCallback(e=>{T({0:1,1:2,2:3,3:4,4:5,5:6,6:7}[e]??4)},[T]),ye=n.useMemo(()=>{var e;if(!(null==(e=null==j?void 0:j.config)?void 0:e.radio))return null;const t=j.config.radio;return{sf:t.spreading_factor??10,bw:t.bandwidth??25e4,cr:t.coding_rate??5,preamble:t.preamble_length??8}},[null==(t=null==(e=null==j?void 0:j.config)?void 0:e.radio)?void 0:t.spreading_factor,null==(a=null==(s=null==j?void 0:j.config)?void 0:s.radio)?void 0:a.bandwidth,null==(o=null==(i=null==j?void 0:j.config)?void 0:i.radio)?void 0:o.coding_rate,null==(m=null==(c=null==j?void 0:j.config)?void 0:c.radio)?void 0:m.preamble_length]);n.useEffect(()=>{!async function(){var e;O(null);try{const t=await te(he);t.success&&(null==(e=t.data)?void 0:e.history)&&$(t.data.history)}catch(t){O(t instanceof Error?t.message:"Failed to load chart data")}finally{z(!1)}}()},[he]);const ve=n.useMemo(()=>72===he?6e5:168===he?18e5:336===he?36e5:3e5,[he]),je=n.useCallback(async()=>{var e;try{const t=await te(he);t.success&&(null==(e=t.data)?void 0:e.history)&&$(t.data.history)}catch{}},[he]);ae(je,ve,!0,!0);const Ne=n.useMemo(()=>0===F.length?{timestamps:[],values:[]}:{timestamps:F.map(e=>e.timestamp),values:F.map(e=>e.noise_floor_dbm)},[F]),Ce=n.useMemo(()=>{if(F.length<10)return{anomalies:[],debug:void 0};const e=function(e,t={}){const s={...Ae,...t};if(e.length<10)return{anomalies:[],thresholds:De([]),totalSamples:e.length,anomalySamples:0};const a=e.map(e=>e.noise_floor_dbm),n=De(a),r=[...a].sort((e,t)=>e-t);let l,i;s.useAbsoluteThresholds?(l=s.baselineDbm,i=s.spikeDbm):(l=Le(r,s.baselinePercentile),i=Le(r,s.spikePercentile));const o=[...e].sort((e,t)=>e.timestamp-t.timestamp),c=[];let m=null,d=0;for(const u of o)if(u.noise_floor_dbm>l&&u.noise_floor_dbm<i)if(d++,m){const e=Math.abs(u.noise_floor_dbm-m.rollingAvg)<=s.similarityToleranceDbm,t=u.timestamp-m.endTs<=s.mergeGapSeconds;e&&t?(m.endTs=u.timestamp,m.values.push(u.noise_floor_dbm),m.timestamps.push(u.timestamp),m.rollingAvg=m.values.reduce((e,t)=>e+t,0)/m.values.length):(m.values.length>=s.minSequenceLength&&c.push(m),m={startTs:u.timestamp,endTs:u.timestamp,values:[u.noise_floor_dbm],timestamps:[u.timestamp],rollingAvg:u.noise_floor_dbm})}else m={startTs:u.timestamp,endTs:u.timestamp,values:[u.noise_floor_dbm],timestamps:[u.timestamp],rollingAvg:u.noise_floor_dbm};else m&&m.values.length>=s.minSequenceLength&&c.push(m),m=null;return m&&m.values.length>=s.minSequenceLength&&c.push(m),0===c.length?{anomalies:[],thresholds:n,totalSamples:e.length,anomalySamples:d,debug:{baselineCutoff:l,spikeCutoff:i,midBandSamples:d}}:{anomalies:c.map(e=>{const t=Math.max(...e.values),s=e.values.reduce((e,t)=>e+t,0)/e.values.length;return{startTs:e.startTs,endTs:e.endTs,peakValue:t,avgValue:s,severity:Ee(s,l,i),sampleCount:e.values.length}}),thresholds:n,totalSamples:e.length,anomalySamples:d,debug:{baselineCutoff:l,spikeCutoff:i,midBandSamples:d}}}(F,oe);return{anomalies:e.anomalies,debug:e.debug}},[F,oe]),Te=Ce.anomalies,$e=n.useMemo(()=>{const e=(null==j?void 0:j.neighbors)??{};return Object.fromEntries(Object.entries(e).filter(([e])=>!N.has(e)))},[null==j?void 0:j.neighbors,N]),Be=n.useMemo(()=>{const e=Date.now()/1e3-3600*he;return Object.fromEntries(Object.entries($e).filter(([,t])=>t.last_seen>=e))},[$e,he]),He=n.useMemo(()=>{const e=60*xe/ge,t=Math.floor(Date.now()/1e3),s=Math.floor(t/e)*e;return{start:s-60*xe,end:s}},[xe,ge]);return r.jsxs(Me,{children:[r.jsx(Se,{title:"Statistics",icon:r.jsx(R,{}),controls:r.jsx(we,{ranges:ee,selectedIndex:ue,onSelect:be,isPending:fe})}),_&&r.jsx(ke,{className:"border border-accent-red/50 bg-accent-red/10",children:r.jsx("p",{className:"text-accent-red",children:_})}),ne&&le&&r.jsxs(ke,{className:"border border-accent-purple/30 bg-glass-surface/50",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"type-label",children:"Anomaly Detection Tuning"}),r.jsxs("span",{className:"type-data-xs text-text-muted",children:["(",pe.label,")"]})]}),r.jsx("button",{onClick:()=>ce(e=>({...e,useAbsoluteThresholds:!e.useAbsoluteThresholds})),className:"type-data-xs px-2 py-1 rounded transition-colors "+(oe.useAbsoluteThresholds?"bg-accent-purple/30 text-accent-purple":"bg-glass-elevated text-text-muted hover:text-text-secondary"),children:oe.useAbsoluteThresholds?"Absolute dBm":"Percentile"})]}),r.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[r.jsxs("div",{children:[r.jsx("span",{className:"type-micro",children:"Baseline"}),r.jsxs("span",{className:"ml-2 type-data-sm text-status-warning",children:[(null==(u=null==(d=Ce.debug)?void 0:d.baselineCutoff)?void 0:u.toFixed(1))??""," dBm"]})]}),r.jsxs("div",{children:[r.jsx("span",{className:"type-micro",children:"Spike"}),r.jsxs("span",{className:"ml-2 type-data-sm text-status-warning",children:[(null==(x=null==(h=Ce.debug)?void 0:h.spikeCutoff)?void 0:x.toFixed(1))??""," dBm"]})]}),r.jsxs("div",{children:[r.jsx("span",{className:"type-micro",children:"Mid-band"}),r.jsx("span",{className:"ml-2 type-data-sm text-accent-purple",children:(null==(p=Ce.debug)?void 0:p.midBandSamples)??0})]}),r.jsxs("div",{children:[r.jsx("span",{className:"type-micro",children:"Anomalies"}),r.jsx("span",{className:"ml-2 type-data-sm text-status-danger",children:Te.length})]})]}),r.jsxs("div",{className:"mt-4 pt-4 border-t border-border-subtle space-y-4",children:[oe.useAbsoluteThresholds?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"type-micro block mb-1",children:["Baseline (",oe.baselineDbm," dBm)"]}),r.jsx("input",{type:"range",min:"-120",max:"-60",value:oe.baselineDbm,onChange:e=>ce(t=>({...t,baselineDbm:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"type-micro block mb-1",children:["Spike (",oe.spikeDbm," dBm)"]}),r.jsx("input",{type:"range",min:"-100",max:"-20",value:oe.spikeDbm,onChange:e=>ce(t=>({...t,spikeDbm:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"type-micro block mb-1",children:["Merge Gap (",oe.mergeGapSeconds,"s)"]}),r.jsx("input",{type:"range",min:"5",max:"120",step:"5",value:oe.mergeGapSeconds,onChange:e=>ce(t=>({...t,mergeGapSeconds:Number(e.target.value)})),className:"w-full accent-accent-purple"})]})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"type-micro block mb-1",children:["Min Sequence (",oe.minSequenceLength,")"]}),r.jsx("input",{type:"range",min:"2",max:"20",value:oe.minSequenceLength,onChange:e=>ce(t=>({...t,minSequenceLength:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"type-micro block mb-1",children:["Similarity (",oe.similarityToleranceDbm," dBm)"]}),r.jsx("input",{type:"range",min:"1",max:"15",value:oe.similarityToleranceDbm,onChange:e=>ce(t=>({...t,similarityToleranceDbm:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"type-micro block mb-1",children:["Opacity (",Math.round(100*me),"%)"]}),r.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.05",value:me,onChange:e=>de(Number(e.target.value)),className:"w-full accent-accent-purple"})]})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"type-micro block mb-1",children:["Baseline (P",oe.baselinePercentile,")"]}),r.jsx("input",{type:"range",min:"1",max:"50",value:oe.baselinePercentile,onChange:e=>ce(t=>({...t,baselinePercentile:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"type-micro block mb-1",children:["Spike (P",oe.spikePercentile,")"]}),r.jsx("input",{type:"range",min:"50",max:"99",value:oe.spikePercentile,onChange:e=>ce(t=>({...t,spikePercentile:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"type-micro block mb-1",children:["Merge Gap (",oe.mergeGapSeconds,"s)"]}),r.jsx("input",{type:"range",min:"5",max:"120",step:"5",value:oe.mergeGapSeconds,onChange:e=>ce(t=>({...t,mergeGapSeconds:Number(e.target.value)})),className:"w-full accent-accent-purple"})]})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"type-micro block mb-1",children:["Min Sequence (",oe.minSequenceLength,")"]}),r.jsx("input",{type:"range",min:"2",max:"20",value:oe.minSequenceLength,onChange:e=>ce(t=>({...t,minSequenceLength:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"type-micro block mb-1",children:["Similarity (",oe.similarityToleranceDbm," dBm)"]}),r.jsx("input",{type:"range",min:"1",max:"15",value:oe.similarityToleranceDbm,onChange:e=>ce(t=>({...t,similarityToleranceDbm:Number(e.target.value)})),className:"w-full accent-accent-purple"})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"type-micro block mb-1",children:["Opacity (",Math.round(100*me),"%)"]}),r.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.05",value:me,onChange:e=>de(Number(e.target.value)),className:"w-full accent-accent-purple"})]})]})]}),r.jsxs("div",{className:"mt-4 p-3 bg-glass-elevated rounded-lg",children:[r.jsx("div",{className:"type-micro mb-1",children:"Config output"}),r.jsxs("div",{className:"type-data-sm text-status-success",children:[oe.useAbsoluteThresholds?`useAbsoluteThresholds: true, baselineDbm: ${oe.baselineDbm}, spikeDbm: ${oe.spikeDbm}`:`useAbsoluteThresholds: false, baselinePercentile: ${oe.baselinePercentile}, spikePercentile: ${oe.spikePercentile}`,", mergeGapSeconds: ",oe.mergeGapSeconds,", minSequenceLength: ",oe.minSequenceLength,", similarityToleranceDbm: ",oe.similarityToleranceDbm]})]})]})]}),fe&&r.jsx(Pe,{template:"auto",children:r.jsx(ke,{className:"border border-accent-primary/30 bg-accent-primary/5",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("div",{className:"relative flex h-3 w-3",children:[r.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-accent-primary opacity-75"}),r.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-accent-primary"})]}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("p",{className:"type-body-sm text-text-primary",children:["Loading ",pe.label," data..."]}),S.loadProgress&&r.jsxs("p",{className:"type-data-xs text-text-muted mt-0.5",children:[S.loadProgress.loaded.toLocaleString()," packets (",S.loadProgress.percent,"%)"]})]})]})})}),H?r.jsx(Pe,{template:"auto",children:r.jsx(ke,{className:"text-center py-12",children:r.jsx("div",{className:"animate-pulse text-text-muted",children:"Loading statistics..."})})}):r.jsxs(r.Fragment,{children:[r.jsx(Pe,{template:"hero-auto",children:r.jsx(ke,{isLoaded:M,skeletonType:"chart",children:M&&r.jsxs(r.Fragment,{children:[r.jsx(Fe,{icon:r.jsx(l,{}),title:"Packet Analyzer",badge:pe.label,largeTitle:!0,stackActionsOnMobile:!0,actions:r.jsxs("div",{className:"flex flex-wrap items-center gap-2 justify-end",children:["stats"===V&&r.jsx(lt,{enabled:ne,onChange:re,anomalyCount:Te.length,showTuning:le,onTuningChange:ie}),r.jsx(rt,{smoothing:V,onChange:q}),r.jsx(nt,{mode:W,onChange:I})]})}),r.jsx("div",{className:"flex-1 min-h-0",children:r.jsx(mt,{packets:k,startTs:He.start,endTs:He.end,bucketCount:ge,radioConfig:ye??void 0,mode:W,smoothing:V,noiseFloorAnomalies:Te,showNoiseFloorOverlay:ne,overlayOpacity:me})})]})})}),r.jsxs(Pe,{template:"panel",children:[r.jsx(Re,{span:12,md:6,children:r.jsx(ke,{isLoaded:M,skeletonType:"chart",children:M&&r.jsxs(r.Fragment,{children:[r.jsx(Fe,{icon:r.jsx(b,{}),title:"Link Quality",badge:pe.label,largeTitle:!0,actions:E?r.jsxs("div",{className:"flex items-center gap-3 type-data-xs text-text-muted",children:[r.jsxs("span",{children:[r.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:E.zeroHopCount})," nbr"]}),r.jsxs("span",{children:[r.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:E.totalCount})," obs"]}),r.jsxs("span",{children:[r.jsx("span",{className:"text-text-secondary tabular-nums font-medium",children:E.maxDistanceKm.toFixed(0)})," km"]})]}):null}),r.jsx("div",{className:"flex-1 min-h-0",children:r.jsx(wt,{children:r.jsx(ft,{neighbors:Be,quickNeighbors:w,localLat:(null==(f=null==(g=null==j?void 0:j.config)?void 0:g.repeater)?void 0:f.latitude)??0,localLon:(null==(v=null==(y=null==j?void 0:j.config)?void 0:y.repeater)?void 0:v.longitude)??0,onStatsChange:B})})})]})})}),r.jsx(Re,{span:12,md:6,children:r.jsx(ke,{isLoaded:M,skeletonType:"chart",children:M&&r.jsxs(r.Fragment,{children:[r.jsx(Fe,{icon:r.jsx(A,{}),title:"Network Composition",badge:pe.label,largeTitle:!0}),r.jsx("div",{className:"flex-1 min-h-0",children:r.jsx(wt,{children:r.jsx(Nt,{neighbors:Be})})})]})})})]}),r.jsxs(Pe,{template:"panel",children:[r.jsx(Re,{span:12,md:6,children:r.jsx(St,{})}),r.jsx(Re,{span:12,md:6,children:r.jsx(Tt,{})})]}),r.jsx(Pe,{template:"panel",children:r.jsx(Re,{span:12,children:r.jsx(ke,{isLoaded:M,skeletonType:"chart",children:M&&r.jsxs(r.Fragment,{children:[r.jsx(Fe,{icon:r.jsx(L,{}),title:"RF Noise Floor",largeTitle:!0,stackActionsOnMobile:!0,actions:P?r.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[r.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["min ",r.jsx("span",{className:"text-text-secondary tabular-nums",children:P.min.toFixed(0)})]}),r.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["avg ",r.jsx("span",{className:"text-text-secondary tabular-nums",children:P.avg.toFixed(0)})]}),r.jsxs("span",{className:"type-data-xs text-text-muted whitespace-nowrap",children:["max ",r.jsx("span",{className:"text-text-secondary tabular-nums",children:P.max.toFixed(0)})]}),r.jsx("span",{className:"type-data-xs text-text-muted",children:"dBm"})]}):r.jsx("span",{className:"type-data-xs text-text-muted",children:"dBm"})}),r.jsx("div",{className:"flex-1 min-h-0",children:r.jsx(wt,{children:r.jsx(yt,{timestamps:Ne.timestamps,values:Ne.values,onStatsChange:D})})})]})})})})]})]})}export{Ft as default};
